<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralInvoiceAuditDBDAOSearchAccountBySimulationRSQL">
			<desc><![CDATA[Tariff에 등록되어 있는 Account 조회]]></desc>
			<sql><![CDATA[
/**** Tariff에 등록되어 있는 Account 조회 ****/
SELECT DISTINCT T2.ACCT_CD  AS ACCT_CD
     , T3.ACCT_ENG_NM       AS ACCT_NM
  FROM TES_LGS_COST T2
     , MDM_ACCOUNT T3
     ,( SELECT DISTINCT LGS_COST_CD
          FROM (SELECT C.YD_CD
                     , C.LGS_COST_CD
                     , C.VNDR_SEQ
                     , C.CPLS_FLG
                     , COUNT( * ) OVER (PARTITION BY C.YD_CD, C.LGS_COST_CD
                         ORDER BY C.YD_CD, C.LGS_COST_CD) AS CNT
                  FROM PSO_YD_CHG C
                 WHERE C.YD_CD LIKE @[port_cd] || NVL(@[yard_cd], '%') /*'BRNVTM1'*/
#if( ${issue_date} != '' )
                   AND TO_DATE(REPLACE(@[issue_date], '-', ''), 'YYYYMMDD') BETWEEN C.EFF_DT AND C.EXP_DT
#end
                   AND C.LST_FLG = 'Y'
                 GROUP BY C.YD_CD
                     , C.LGS_COST_CD
                     , C.VNDR_SEQ
                     , C.CPLS_FLG )
         WHERE 1=1
#if( ${cpls_flg} != '' && ${cpls_flg} == 'Y' )
           --Compulsory flag Y 일대 아래 조건 활성.
           AND (CASE WHEN CNT >= 2 THEN 'Y' ELSE CPLS_FLG END) = CPLS_FLG 
#end
       ) T4
 WHERE 1=1
   AND T2.ACCT_CD       = T3.ACCT_CD
   AND T2.LGS_COST_CD   = T4.LGS_COST_CD
   AND T2.LGS_COST_CD_CLSS_LVL = 'A'
   AND T2.LGS_COST_SUBJ_CD = DECODE(@[port_cd],'EGSCA','CN','PAPCA','CN','PT')
 ORDER BY 1			]]></sql>
			<params>
				<param name="port_cd" type="12" value="" out="N"/>
				<param name="yard_cd" type="12" value="" out="N"/>
				<param name="issue_date" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
