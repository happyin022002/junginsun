<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PortLimitManagmentDBDAOSearchPortLimitsDgTtlWgtShaRSQL">
			<desc><![CDATA[PortLimitManagmentDBDAOSearchPortLimitsDgTtlWgtRSQL/CNSHA]]></desc>
			<sql><![CDATA[
SELECT PORT_CD,
    PORT_LMT_SEQ,
    PORT_LMT_REP_DESC,
    LMT_WGT_TP_CD,
    VSL_CD,
    SKD_VOY_NO,
    SKD_DIR_CD,
    SLAN_CD,
    PRT_CD,
    PIER_TP_CD,
    FLSH_PNT_TEMP,
    BKG_NO,
    IMDG_CLSS_CD,
    IMDG_CLSS_CD_DESC,
    IMDG_COMP_GRP_CD,
    IMDG_SUBS_RSK_LBL_CD,
    IMDG_UN_NO,
    IMDG_PCK_GRP_CD,
    CNTR_TP_CD,
    ARR_DEP_PROHI_FLG,
    LDIS_APLY_TGT_FLG,
    --Arrival
    ARR_CGO_WGT,
    DECODE(ARR_MAX_LMT, 0, NULL, ROUND((ARR_CGO_WGT / ARR_MAX_LMT  * 100), 2)) AS ARR_LMT_RTO,
    DECODE(ARR_DEP_PROHI_FLG, 'Y', NULL, DECODE(ARR_MAX_LMT, 0, NULL, ARR_MAX_LMT)) AS ARR_MAX_LMT,
    --Discharge
    DECODE(LDIS_APLY_TGT_FLG, 'N', NULL, DCHG_CGO_WGT) AS DCHG_CGO_WGT,
    DECODE(LDIS_APLY_TGT_FLG, 'N', NULL, DECODE(DCHG_MAX_LMT, 0, NULL, ROUND((DCHG_CGO_WGT/ DCHG_MAX_LMT * 100), 2))) AS DCHG_LMT_RTO,
    DECODE(LDIS_APLY_TGT_FLG, 'N', NULL, DCHG_MAX_LMT) AS DCHG_MAX_LMT,
    --Load
    DECODE(LDIS_APLY_TGT_FLG, 'N', NULL, LOD_CGO_WGT) AS LOD_CGO_WGT,
    DECODE(LDIS_APLY_TGT_FLG, 'N', NULL, DECODE(LOD_MAX_LMT, 0, NULL, ROUND((LOD_CGO_WGT / LOD_MAX_LMT  * 100), 2))) AS LOD_LMT_RTO,
    DECODE(LDIS_APLY_TGT_FLG, 'N', NULL, LOD_MAX_LMT) AS LOD_MAX_LMT,
    --Depature
	DEP_CGO_WGT,
    DECODE(DEP_MAX_LMT, 0, NULL, ROUND((DEP_CGO_WGT / DEP_MAX_LMT  * 100), 2)) AS DEP_LMT_RTO,
    DECODE(ARR_DEP_PROHI_FLG, 'Y', NULL, DECODE(DEP_MAX_LMT, 0, NULL, DEP_MAX_LMT)) AS DEP_MAX_LMT
FROM (
SELECT --A.RN,
    A.PORT_CD,
    A.PORT_LMT_SEQ,
    A.PORT_LMT_REP_DESC,
    A.LMT_WGT_TP_CD,
    A.VSL_CD,
    A.SKD_VOY_NO,
    A.SKD_DIR_CD,
    A.SLAN_CD,
    A.PRT_CD,
    A.PIER_TP_CD,
    A.FLSH_PNT_TEMP,
    substr(xmlagg(xmlelement(a, DECODE(A.BKG_NO, '', '', ',') ||A.BKG_NO) order by A.BKG_NO).extract('//text()'), 2) BKG_NO,
    substr(xmlagg(xmlelement(a, DECODE(A.IMDG_CLSS_CD, '', '', ',') ||A.IMDG_CLSS_CD) order by A.IMDG_CLSS_CD).extract('//text()'), 2) AS IMDG_CLSS_CD,
    substr(xmlagg(xmlelement(a, DECODE(A.IMDG_CLSS_CD_DESC, '', '', ',') ||A.IMDG_CLSS_CD_DESC) order by A.IMDG_CLSS_CD_DESC).extract('//text()'), 2) AS IMDG_CLSS_CD_DESC,
    substr(xmlagg(xmlelement(a, DECODE(A.IMDG_COMP_GRP_CD, '', '', ',') ||A.IMDG_COMP_GRP_CD) order by A.IMDG_COMP_GRP_CD).extract('//text()'), 2) AS IMDG_COMP_GRP_CD,
    substr(xmlagg(xmlelement(a, DECODE(A.IMDG_SUBS_RSK_LBL_CD, '', '', ',') ||A.IMDG_SUBS_RSK_LBL_CD) order by A.IMDG_SUBS_RSK_LBL_CD).extract('//text()'), 2) AS IMDG_SUBS_RSK_LBL_CD,
    substr(xmlagg(xmlelement(a, DECODE(A.IMDG_UN_NO, '', '', ',') ||A.IMDG_UN_NO) order by A.IMDG_UN_NO).extract('//text()'), 2) AS IMDG_UN_NO,
    MAX(A.IMDG_PCK_GRP_CD) AS IMDG_PCK_GRP_CD,
    MAX(A.CNTR_TP_CD) AS CNTR_TP_CD,
    MAX(A.ARR_DEP_PROHI_FLG) AS ARR_DEP_PROHI_FLG,
    MAX(A.LDIS_APLY_TGT_FLG) AS LDIS_APLY_TGT_FLG,
    NVL(MAX(A.ARR_MAX_LMT), 0)  AS ARR_MAX_LMT,
    NVL(MAX(A.DCHG_MAX_LMT), 0) AS DCHG_MAX_LMT,
    NVL(MAX(A.LOD_MAX_LMT), 0)  AS LOD_MAX_LMT,
	  NVL(MAX(A.DEP_MAX_LMT), 0)  AS DEP_MAX_LMT,
    NVL(SUM(A.ARR_CGO_WGT), 0)  AS ARR_CGO_WGT,
	  NVL(SUM(A.DCHG_CGO_WGT), 0) AS DCHG_CGO_WGT,
	  NVL(SUM(A.LOD_CGO_WGT), 0)  AS LOD_CGO_WGT,
	  NVL(SUM(A.DEP_CGO_WGT), 0)  AS DEP_CGO_WGT
FROM (
SELECT RN,
    PORT_CD,
    PORT_LMT_SEQ,
    PORT_LMT_REP_DESC,
    SLAN_CD,
    PRT_CD,
    PIER_TP_CD,
    VSL_CD,
    SKD_VOY_NO ,
    SKD_DIR_CD ,
    IMDG_CLSS_CD ,
    FLSH_PNT_TEMP,
    IMDG_CLSS_CD_DESC,
    LMT_WGT_TP_CD,
    IMDG_COMP_GRP_CD,
    IMDG_PCK_GRP_CD,
    IMDG_SUBS_RSK_LBL_CD,
    IMDG_UN_NO,
    CNTR_TP_CD,
    ARR_DEP_PROHI_FLG,
    LDIS_APLY_TGT_FLG,
    ARR_MAX_LMT,
    DCHG_MAX_LMT,
    LOD_MAX_LMT,
    DEP_MAX_LMT,
     ARR_CGO_WGT ,
     DCHG_CGO_WGT,
     LOD_CGO_WGT ,
     DEP_CGO_WGT ,
     BKG_NO||
       (CASE WHEN ARR_LMT_RTO > 100 OR (ARR_DEP_PROHI_FLG = 'Y' AND ARR_CGO_WGT > 0) THEN 'R'
            WHEN 75 <= ARR_LMT_RTO  AND ARR_LMT_RTO <= 100 THEN 'Y'
            WHEN ARR_LMT_RTO >= 0 THEN 'G'
            ELSE 'B'
       END)||
       (CASE WHEN DCHG_LMT_RTO > 100  THEN 'R'
            WHEN 75 <= DCHG_LMT_RTO  AND DCHG_LMT_RTO <= 100 THEN 'Y'
            WHEN DCHG_LMT_RTO >= 0 THEN 'G'
            ELSE 'B'
       END)||
       (CASE WHEN LOD_LMT_RTO > 100  THEN 'R'
            WHEN 75 <= LOD_LMT_RTO  AND LOD_LMT_RTO <= 100 THEN 'Y'
            WHEN LOD_LMT_RTO >= 0 THEN 'G'
            ELSE 'B'
       END)||
       (CASE WHEN DEP_LMT_RTO > 100 OR (ARR_DEP_PROHI_FLG = 'Y' AND DEP_CGO_WGT > 0) THEN 'R'
            WHEN 75 <= DEP_LMT_RTO  AND DEP_LMT_RTO <= 100 THEN 'Y'
            WHEN DEP_LMT_RTO >= 0 THEN 'G'
            ELSE 'B'
       END) AS BKG_NO
FROM (
SELECT RN,
    PORT_CD,
    PORT_LMT_SEQ,
    PORT_LMT_REP_DESC,
    LMT_WGT_TP_CD,
    VSL_CD,
    SKD_VOY_NO,
    SKD_DIR_CD,
    SLAN_CD,
    BKG_NO,

    MAX(PRT_CD)                                 PRT_CD,
    MAX(PIER_TP_CD)                         PIER_TP_CD,
    MAX(IMDG_CLSS_CD)                     IMDG_CLSS_CD ,
    MAX(FLSH_PNT_TEMP)                 FLSH_PNT_TEMP,
    MAX(IMDG_CLSS_CD_DESC)         IMDG_CLSS_CD_DESC,
    MAX(IMDG_COMP_GRP_CD)             IMDG_COMP_GRP_CD,
    MAX(IMDG_PCK_GRP_CD)             IMDG_PCK_GRP_CD,
    MAX(IMDG_SUBS_RSK_LBL_CD)    IMDG_SUBS_RSK_LBL_CD,
    MAX(IMDG_UN_NO)                         IMDG_UN_NO,
    MAX(CNTR_TP_CD)                         CNTR_TP_CD,
    MAX(ARR_DEP_PROHI_FLG)       ARR_DEP_PROHI_FLG,
    MAX(LDIS_APLY_TGT_FLG)          LDIS_APLY_TGT_FLG,
    MAX(ARR_MAX_LMT)                      ARR_MAX_LMT,
    MAX(DECODE(LDIS_APLY_TGT_FLG, 'N', '' ,DCHG_MAX_LMT))  DCHG_MAX_LMT,
    MAX(DECODE(LDIS_APLY_TGT_FLG, 'N', '' ,LOD_MAX_LMT))     LOD_MAX_LMT,
    MAX(DEP_MAX_LMT)                      DEP_MAX_LMT,

            SUM(ARR_CGO_WGT)                                                                                                                          AS ARR_CGO_WGT,
        -- LMT 0일 때에도 CNTR Counting 2015-12-04 --
        DECODE(MAX(LDIS_APLY_TGT_FLG), 'N', '', SUM(DCHG_CGO_WGT))                                                                                AS DCHG_CGO_WGT,
        DECODE(MAX(LDIS_APLY_TGT_FLG), 'N', '',  SUM(LOD_CGO_WGT))                                                                                AS LOD_CGO_WGT,
        SUM(DEP_CGO_WGT)                                                                                                                          AS DEP_CGO_WGT,
        DECODE(MAX(ARR_DEP_PROHI_FLG), 'Y', '', DECODE(SUM(ARR_CGO_WGT),0,'',NVL(ROUND( ((SUM(ARR_CGO_WGT)  / MAX(ARR_MAX_LMT)) * 100), 2), 0)))  AS ARR_LMT_RTO,
        DECODE(MAX(LDIS_APLY_TGT_FLG), 'N', '', DECODE(SUM(DCHG_CGO_WGT),0,'',NVL(ROUND( ((SUM(DCHG_CGO_WGT)/ MAX(DCHG_MAX_LMT)) * 100), 2), 0))) AS DCHG_LMT_RTO,
        DECODE(MAX(LDIS_APLY_TGT_FLG), 'N', '', DECODE(SUM(LOD_CGO_WGT),0,'',NVL(ROUND( ((SUM(LOD_CGO_WGT)  / MAX(LOD_MAX_LMT)) * 100), 2), 0)))  AS LOD_LMT_RTO,
        DECODE(MAX(ARR_DEP_PROHI_FLG), 'Y', '', DECODE(SUM(DEP_CGO_WGT),0,'',NVL(ROUND( ((SUM(DEP_CGO_WGT)  / MAX(DEP_MAX_LMT)) * 100), 2), 0)))  AS DEP_LMT_RTO
      FROM(
     SELECT DISTINCT A.RN,
            A.PORT_CD,
            A.PORT_LMT_SEQ,
            A.PORT_LMT_REP_DESC,
            B.BKG_NO,
            B.SLAN_CD,
            B.PRT_CD        AS PRT_CD,
            A.PIER_TP_CD    AS PIER_TP_CD,
            B.VSL_CD             AS VSL_CD,
            B.SKD_VOY_NO         AS SKD_VOY_NO ,
            B.SKD_DIR_CD         AS SKD_DIR_CD ,
            A.IMDG_CLSS_CD  AS IMDG_CLSS_CD ,
            A.FLSH_PNT_TEMP AS FLSH_PNT_TEMP,
            B.IMDG_CLSS_CD_DESC AS IMDG_CLSS_CD_DESC,
                      A.LMT_WGT_TP_CD     AS LMT_WGT_TP_CD,
            A.IMDG_COMP_GRP_CD,
            A.IMDG_PCK_GRP_CD,
            A.IMDG_SUBS_RSK_LBL_CD,
            A.IMDG_UN_NO,
            A.CNTR_TP_CD,
            ---------------------------------------
            B.ARR_CGO_WGT ,
            B.DCHG_CGO_WGT,
            B.LOD_CGO_WGT ,
            B.DEP_CGO_WGT,

            NVL(B.ARR_MAX_LMT,   A.ARR_MAX_QTY)  AS ARR_MAX_LMT,
            NVL(B.DCHG_MAX_LMT, A.DCHG_MAX_QTY) AS DCHG_MAX_LMT,
            NVL(B.LOD_MAX_LMT,   A.LOD_MAX_QTY)   AS LOD_MAX_LMT,
            NVL(B.DEP_MAX_LMT,   A.DEP_MAX_QTY)  AS DEP_MAX_LMT,

            A.ARR_DEP_PROHI_FLG AS ARR_DEP_PROHI_FLG,
            A.LDIS_APLY_TGT_FLG AS LDIS_APLY_TGT_FLG
  FROM
       (
         SELECT  ROWNUM RN,
                      PORT_CD, PORT_LMT_SEQ,
                      IMDG_CLSS_CD, FLSH_PNT_TEMP,
                      LMT_WGT_TP_CD, IMDG_COMP_GRP_CD,
                      IMDG_PCK_GRP_CD, IMDG_SUBS_RSK_LBL_CD,
                      IMDG_UN_NO, CNTR_TP_CD,
                      PIER_TP_CD,
                      '2DISCHARGE' PORT_LMT_KND,
                      ARR_MAX_QTY, DCHG_MAX_QTY, LOD_MAX_QTY, DEP_MAX_QTY,
                      PPT_EXPLO_FLG, PPT_PROHI_FLG, PORT_LMT_REP_DESC,
                      ARR_DEP_PROHI_FLG,             LDIS_APLY_TGT_FLG,
            YD_CD
            FROM  (
                    SELECT   A.PIER_TP_CD, A.PORT_CD, A.PORT_LMT_SEQ, A.FLSH_PNT_TEMP,
                                  A.LMT_WGT_TP_CD, A.IMDG_PCK_GRP_CD, E.IMDG_SUBS_RSK_LBL_CD, A.CNTR_TP_CD,
                                  B.IMDG_CLSS_CD, C.IMDG_COMP_GRP_CD , D.IMDG_UN_NO,
                                  DECODE(A.ARR_MAX_QTY, 0, NULL, A.ARR_MAX_QTY)   AS ARR_MAX_QTY,
                DECODE(A.DCHG_MAX_TEU_QTY, 0, NULL, A.DCHG_MAX_TEU_QTY) AS DCHG_MAX_QTY,
                DECODE(A.LOD_MAX_TEU_QTY, 0, NULL, A.LOD_MAX_TEU_QTY)   AS LOD_MAX_QTY,
                                  DECODE(A.DEP_MAX_QTY, 0, NULL, A.DEP_MAX_QTY)    AS DEP_MAX_QTY,
                                  A.PPT_EXPLO_FLG,  A.PPT_PROHI_FLG, A.PORT_LMT_REP_DESC,
                                              A.ARR_DEP_PROHI_FLG,               A.LDIS_APLY_TGT_FLG,
              A.YD_CD
                        FROM SCG_IMDG_PORT_LMT_MST A,
                                  SCG_IMDG_PORT_LMT_CLSS_CD B,
                                  SCG_IMDG_PORT_LMT_COMP_GRP C,
                                  SCG_IMDG_PORT_LMT_UN_NO D,
                                  SCG_IMDG_PORT_LMT_SUBS_RSK E
                       WHERE A.PORT_CD = B.PORT_CD(+)
                            AND A.PORT_LMT_SEQ = B.PORT_LMT_SEQ(+)
                            AND B.PORT_CD = C.PORT_CD(+)
                            AND B.PORT_LMT_SEQ = C.PORT_LMT_SEQ(+)
                            AND A.PORT_CD = D.PORT_CD(+)
                            AND A.PORT_LMT_SEQ = D.PORT_LMT_SEQ(+)
                            AND A.PORT_CD = E.PORT_CD(+)
                            AND A.PORT_LMT_SEQ = E.PORT_LMT_SEQ(+) 
                            -- Target unckecked 제외 2015-12-04 --
                            AND A.LDIS_APLY_TGT_FLG = 'Y'      
                     )

        UNION ALL

         SELECT  ROWNUM RN,
                      PORT_CD, PORT_LMT_SEQ,
                      IMDG_CLSS_CD, FLSH_PNT_TEMP,
                      LMT_WGT_TP_CD, IMDG_COMP_GRP_CD,
                      IMDG_PCK_GRP_CD, IMDG_SUBS_RSK_LBL_CD,
                      IMDG_UN_NO, CNTR_TP_CD,
                      PIER_TP_CD,
                      '3LOAD' AS PORT_LMT_KND,
                      ARR_MAX_QTY, DCHG_MAX_QTY, LOD_MAX_QTY, DEP_MAX_QTY,
                      PPT_EXPLO_FLG, PPT_PROHI_FLG, PORT_LMT_REP_DESC,
                      ARR_DEP_PROHI_FLG,             LDIS_APLY_TGT_FLG,
            YD_CD
            FROM  (
                    SELECT   A.PIER_TP_CD, A.PORT_CD, A.PORT_LMT_SEQ, A.FLSH_PNT_TEMP,
                                  A.LMT_WGT_TP_CD, A.IMDG_PCK_GRP_CD, E.IMDG_SUBS_RSK_LBL_CD, A.CNTR_TP_CD,
                                  B.IMDG_CLSS_CD, C.IMDG_COMP_GRP_CD , D.IMDG_UN_NO,
                                  DECODE(A.ARR_MAX_QTY, 0, NULL, A.ARR_MAX_QTY)   AS ARR_MAX_QTY,
                DECODE(A.DCHG_MAX_TEU_QTY, 0, NULL, A.DCHG_MAX_TEU_QTY) AS DCHG_MAX_QTY,
                DECODE(A.LOD_MAX_TEU_QTY, 0, NULL, A.LOD_MAX_TEU_QTY)   AS LOD_MAX_QTY,
                                  DECODE(A.DEP_MAX_QTY, 0, NULL, A.DEP_MAX_QTY)    AS DEP_MAX_QTY,
                                  A.PPT_EXPLO_FLG,  A.PPT_PROHI_FLG, A.PORT_LMT_REP_DESC,
                                              A.ARR_DEP_PROHI_FLG,               A.LDIS_APLY_TGT_FLG,
              A.YD_CD
                        FROM SCG_IMDG_PORT_LMT_MST A,
                                  SCG_IMDG_PORT_LMT_CLSS_CD B,
                                  SCG_IMDG_PORT_LMT_COMP_GRP C,
                                  SCG_IMDG_PORT_LMT_UN_NO D,
                                  SCG_IMDG_PORT_LMT_SUBS_RSK E
                       WHERE A.PORT_CD = B.PORT_CD(+)
                            AND A.PORT_LMT_SEQ = B.PORT_LMT_SEQ(+)
                            AND B.PORT_CD = C.PORT_CD(+)
                            AND B.PORT_LMT_SEQ = C.PORT_LMT_SEQ(+)
                            AND A.PORT_CD = D.PORT_CD(+)
                            AND A.PORT_LMT_SEQ = D.PORT_LMT_SEQ(+)
                            AND A.PORT_CD = E.PORT_CD(+)
                            AND A.PORT_LMT_SEQ = E.PORT_LMT_SEQ(+)
                            -- Target unckecked 제외 2015-12-04 --
                            AND A.LDIS_APLY_TGT_FLG = 'Y'   
                     )

) A,

(

SELECT DISTINCT SIPL.RN,
            RANK() OVER(ORDER BY SIPL.RN) AS RNK,
            DGIF.BKG_NO,
            DGIF.SLAN_CD, --SIPL.SLAN_CD,
            DGIF.PRT_CD, --SIPL.UN_LOC_CD,
            SIPL.PIER_TP_CD,
            SIPL.PORT_CD,
            SIPL.PORT_LMT_SEQ,
            DGIF.POL_CD AS POL_CD,
            DGIF.POD_CD AS POD_CD,
            DGIF.VSL_CD,
            DGIF.SKD_VOY_NO,
            DGIF.SKD_DIR_CD,
            SIPL.LMT_WGT_TP_CD AS LMT_WGT_TP_CD,
            SIPL.IMDG_COMP_GRP_CD,
            SIPL.IMDG_PCK_GRP_CD,
            SIPL.IMDG_SUBS_RSK_LBL_CD,
            SIPL.IMDG_UN_NO,
            SIPL.CNTR_TP_CD,
            SIPL.IMDG_CLSS_CD,
            SIPL.FLSH_PNT_TEMP,
            DGIF.FLSH_PNT_CDO_TEMP,
            (SELECT SICC.IMDG_CLSS_CD_DESC
               FROM SCG_IMDG_CLSS_CD SICC
              WHERE 1=1
                AND SICC.IMDG_CLSS_CD = SIPL.IMDG_CLSS_CD) AS IMDG_CLSS_CD_DESC,
            SIPL.PORT_LMT_KND,
            --------------------------
            0                 AS ARR_CGO_WGT,
            DGIF.DCHG_GRS_WGT AS DCHG_CGO_WGT,
            DGIF.LOD_GRS_WGT  AS LOD_CGO_WGT,
            0                 AS DEP_CGO_WGT,
            SIPL.ARR_MAX_QTY   AS ARR_MAX_LMT,
            SIPL.DCHG_MAX_QTY AS DCHG_MAX_LMT,
            SIPL.LOD_MAX_QTY   AS LOD_MAX_LMT,
            SIPL.DEP_MAX_QTY   AS DEP_MAX_LMT,
            DECODE(SIPL.PPT_EXPLO_FLG, 'Y', 'Explosive ', '')||DECODE(SIPL.PPT_PROHI_FLG, 'Y', 'Prohibited', '') AS PPT_FLG_RMK,
            SIPL.YD_CD
  FROM (
         SELECT  ROWNUM RN,
                      PORT_CD, PORT_LMT_SEQ,
                      IMDG_CLSS_CD, FLSH_PNT_TEMP,
                      LMT_WGT_TP_CD, IMDG_COMP_GRP_CD,
                      IMDG_PCK_GRP_CD, IMDG_SUBS_RSK_LBL_CD,
                      IMDG_UN_NO, CNTR_TP_CD,
                      PIER_TP_CD,
                      '2DISCHARGE' PORT_LMT_KND,
                      ARR_MAX_QTY, DCHG_MAX_QTY, LOD_MAX_QTY, DEP_MAX_QTY,
                      PPT_EXPLO_FLG,               PPT_PROHI_FLG,
              YD_CD
            FROM  (
                    SELECT   A.PIER_TP_CD, A.PORT_CD, A.PORT_LMT_SEQ, A.FLSH_PNT_TEMP,
                                  A.LMT_WGT_TP_CD, A.IMDG_PCK_GRP_CD, E.IMDG_SUBS_RSK_LBL_CD, A.CNTR_TP_CD,
                                  B.IMDG_CLSS_CD, C.IMDG_COMP_GRP_CD , D.IMDG_UN_NO,
                                  DECODE(A.ARR_MAX_QTY, 0, NULL, A.ARR_MAX_QTY)   AS ARR_MAX_QTY,
                DECODE(A.DCHG_MAX_TEU_QTY, 0, NULL, A.DCHG_MAX_TEU_QTY) AS DCHG_MAX_QTY,
                DECODE(A.LOD_MAX_TEU_QTY, 0, NULL, A.LOD_MAX_TEU_QTY)   AS LOD_MAX_QTY,
                                  DECODE(A.DEP_MAX_QTY, 0, NULL, A.DEP_MAX_QTY)    AS DEP_MAX_QTY,
                                  A.PPT_EXPLO_FLG,
                                                  A.PPT_PROHI_FLG,
                A.YD_CD
                        FROM SCG_IMDG_PORT_LMT_MST A,
                                  SCG_IMDG_PORT_LMT_CLSS_CD B,
                                  SCG_IMDG_PORT_LMT_COMP_GRP C,
                                  SCG_IMDG_PORT_LMT_UN_NO D,
                                  SCG_IMDG_PORT_LMT_SUBS_RSK E
                       WHERE A.PORT_CD = B.PORT_CD(+)
                            AND A.PORT_LMT_SEQ = B.PORT_LMT_SEQ(+)
                            AND B.PORT_CD = C.PORT_CD(+)
                            AND B.PORT_LMT_SEQ = C.PORT_LMT_SEQ(+)
                            AND A.PORT_CD = D.PORT_CD(+)
                            AND A.PORT_LMT_SEQ = D.PORT_LMT_SEQ(+)
                            AND A.PORT_CD = E.PORT_CD(+)
                            AND A.PORT_LMT_SEQ = E.PORT_LMT_SEQ(+)
                            -- Target unckecked 제외 2015-12-04 --
                            AND A.LDIS_APLY_TGT_FLG = 'Y'         
                     )

        UNION ALL

         SELECT  ROWNUM RN,
                      PORT_CD, PORT_LMT_SEQ,
                      IMDG_CLSS_CD, FLSH_PNT_TEMP,
                      LMT_WGT_TP_CD, IMDG_COMP_GRP_CD,
                      IMDG_PCK_GRP_CD, IMDG_SUBS_RSK_LBL_CD,
                      IMDG_UN_NO, CNTR_TP_CD,
                      PIER_TP_CD,
                      '3LOAD' AS PORT_LMT_KND,
                      ARR_MAX_QTY, DCHG_MAX_QTY, LOD_MAX_QTY, DEP_MAX_QTY,
                      PPT_EXPLO_FLG, PPT_PROHI_FLG, YD_CD
            FROM  (
                    SELECT   A.PIER_TP_CD, A.PORT_CD, A.PORT_LMT_SEQ, A.FLSH_PNT_TEMP,
                                  A.LMT_WGT_TP_CD, A.IMDG_PCK_GRP_CD, E.IMDG_SUBS_RSK_LBL_CD, A.CNTR_TP_CD,
                                  B.IMDG_CLSS_CD, C.IMDG_COMP_GRP_CD , D.IMDG_UN_NO,
                                  DECODE(A.ARR_MAX_QTY, 0, NULL, A.ARR_MAX_QTY)   AS ARR_MAX_QTY,
                DECODE(A.DCHG_MAX_TEU_QTY, 0, NULL, A.DCHG_MAX_TEU_QTY) AS DCHG_MAX_QTY,
                DECODE(A.LOD_MAX_TEU_QTY, 0, NULL, A.LOD_MAX_TEU_QTY)   AS LOD_MAX_QTY,
                                  DECODE(A.DEP_MAX_QTY, 0, NULL, A.DEP_MAX_QTY)    AS DEP_MAX_QTY,
                                  A.PPT_EXPLO_FLG,
                                                  A.PPT_PROHI_FLG,
                A.YD_CD
                        FROM SCG_IMDG_PORT_LMT_MST A,
                                  SCG_IMDG_PORT_LMT_CLSS_CD B,
                                  SCG_IMDG_PORT_LMT_COMP_GRP C,
                                  SCG_IMDG_PORT_LMT_UN_NO D,
                                  SCG_IMDG_PORT_LMT_SUBS_RSK E
                       WHERE A.PORT_CD = B.PORT_CD(+)
                            AND A.PORT_LMT_SEQ = B.PORT_LMT_SEQ(+)
                            AND B.PORT_CD = C.PORT_CD(+)
                            AND B.PORT_LMT_SEQ = C.PORT_LMT_SEQ(+)
                            AND A.PORT_CD = D.PORT_CD(+)
                            AND A.PORT_LMT_SEQ = D.PORT_LMT_SEQ(+)
                            AND A.PORT_CD = E.PORT_CD(+)
                            AND A.PORT_LMT_SEQ = E.PORT_LMT_SEQ(+)
                            -- Target unckecked 제외 2015-12-04 --
                            AND A.LDIS_APLY_TGT_FLG = 'Y'        
                     )

        ) SIPL,

       (

          SELECT SLAN_CD, VSL_CD, SKD_VOY_NO, SKD_DIR_CD, PRT_CD, POL_CD, POD_CD, WGT_UT_CD, IMDG_CLSS_CD, FLSH_PNT_CDO_TEMP, PORT_LMT_KND, VPS_ETA_DT,IMDG_PCK_GRP_CD,
                 IMDG_COMP_GRP_CD, IMDG_UN_NO, IMDG_UN_NO_SEQ, CNTR_TP_CD,IMDG_SUBS_RSK_LBL_CD1, IMDG_SUBS_RSK_LBL_CD2, IMDG_SUBS_RSK_LBL_CD3, IMDG_SUBS_RSK_LBL_CD4,               BKG_NO,
              YD_CD,
                 ------------------------
                 MAX(ARR_NET_WGT) AS ARR_NET_WGT, MAX(ARR_GRS_WGT) AS ARR_GRS_WGT, MAX(ARR_NET_EXPLO_WGT) AS ARR_NET_EXPLO_WGT,
                 MAX(DCHG_NET_WGT) AS DCHG_NET_WGT, MAX(DCHG_GRS_WGT) AS DCHG_GRS_WGT, MAX(DCHG_NET_EXPLO_WGT) AS DCHG_NET_EXPLO_WGT,
                 MAX(LOD_NET_WGT) AS LOD_NET_WGT, MAX(LOD_GRS_WGT) AS LOD_GRS_WGT, MAX(LOD_NET_EXPLO_WGT) AS LOD_NET_EXPLO_WGT,
                 MAX(DEP_NET_WGT) AS DEP_NET_WGT, MAX(DEP_GRS_WGT) AS DEP_GRS_WGT, MAX(DEP_NET_EXPLO_WGT) AS DEP_NET_EXPLO_WGT
            FROM (

                        SELECT BKG_NO,DCGO_SEQ,SLAN_CD,VSL_CD,SKD_VOY_NO,SKD_DIR_CD,PRT_CD,POL_CD,POD_CD,WGT_UT_CD,IMDG_CLSS_CD,FLSH_PNT_CDO_TEMP, IMDG_COMP_GRP_CD, IMDG_UN_NO,IMDG_UN_NO_SEQ,
                         CNTR_TP_CD,IMDG_SUBS_RSK_LBL_CD1,IMDG_SUBS_RSK_LBL_CD2,IMDG_SUBS_RSK_LBL_CD3,IMDG_SUBS_RSK_LBL_CD4,ARR_NET_WGT,ARR_GRS_WGT,ARR_NET_EXPLO_WGT,
                         DCHG_NET_WGT,DCHG_GRS_WGT,DCHG_NET_EXPLO_WGT,LOD_NET_WGT,LOD_GRS_WGT,LOD_NET_EXPLO_WGT,DEP_NET_WGT,DEP_GRS_WGT,DEP_NET_EXPLO_WGT,VPS_ETA_DT,IMDG_PCK_GRP_CD, PORT_LMT_KND,
                YD_CD
                          FROM
                              (
                          SELECT  A.BKG_NO, A.DCGO_SEQ,
                                        A.SLAN_CD,
                                   A.VSL_CD,
                                   A.SKD_VOY_NO,
                                   A.SKD_DIR_CD,
                                   A.PRT_CD,
                                   A.POL_CD,
                                   A.POD_CD,
                                   A.WGT_UT_CD,
                                   A.IMDG_CLSS_CD,
                                   A.FLSH_PNT_CDO_TEMP,
                                   A.IMDG_COMP_GRP_CD,
                                   A.IMDG_UN_NO,
                                   A.IMDG_UN_NO_SEQ,
                                   A.CNTR_TP_CD,
                                   A.IMDG_SUBS_RSK_LBL_CD1,
                                   A.IMDG_SUBS_RSK_LBL_CD2,
                                   A.IMDG_SUBS_RSK_LBL_CD3,
                                   A.IMDG_SUBS_RSK_LBL_CD4,
                                   ---------------------------------
                                    0 AS ARR_NET_WGT, 0 AS ARR_GRS_WGT, 0 AS ARR_NET_EXPLO_WGT,
                                    NET_WGT AS DCHG_NET_WGT, GRS_WGT AS DCHG_GRS_WGT, NET_EXPLO_WGT AS DCHG_NET_EXPLO_WGT,
                                    0 AS LOD_NET_WGT, 0 AS LOD_GRS_WGT, 0 AS LOD_NET_EXPLO_WGT,
                                    0 AS DEP_NET_WGT, 0 AS DEP_GRS_WGT, 0 AS DEP_NET_EXPLO_WGT,
                                   A.VPS_ETA_DT, A.IMDG_PCK_GRP_CD,
                                                     '2DISCHARGE' PORT_LMT_KND,
                  A.YD_CD
                          FROM (

                                        SELECT A.BKG_NO,A.DCGO_SEQ,A.SLAN_CD,A.VSL_CD,A.SKD_VOY_NO,A.SKD_DIR_CD,A.PRT_CD,A.PRT_SEQ,A.POL_CD,A.POL_SEQ,A.POD_CD,A.POD_SEQ,
                                                    A.WGT_UT_CD,A.IMDG_CLSS_CD,A.FLSH_PNT_CDO_TEMP,A.IMDG_COMP_GRP_CD,A.IMDG_UN_NO,A.IMDG_UN_NO_SEQ,A.CNTR_TP_CD,A.IMDG_SUBS_RSK_LBL_CD1,
                                                    A.IMDG_SUBS_RSK_LBL_CD2,A.IMDG_SUBS_RSK_LBL_CD3,A.IMDG_SUBS_RSK_LBL_CD4,A.NET_WGT,A.GRS_WGT,A.NET_EXPLO_WGT,A.VPS_ETA_DT,A.IMDG_PCK_GRP_CD,
                    A.YD_CD
                                          FROM
                                                 (
                                    -- Own BKG`s SPCL CGO Info
                                    SELECT SDC.BKG_NO,SDC.SPCL_CGO_APRO_CD,
                                               SDC.DCGO_SEQ,
                                               VVPS.SLAN_CD,
                                               VVPS.VSL_CD,
                      VVPS.SKD_VOY_NO,
                      VVPS.SKD_DIR_CD,
                      VVPS.YD_CD,
                                               (SELECT SVVPS.VPS_PORT_CD
                                                  FROM VSK_VSL_PORT_SKD  SVVPS
                                                 WHERE 1=1
                                                   AND SVVPS.SLAN_CD      = BVD.SLAN_CD
                                                   AND SVVPS.VSL_CD       = BVD.VSL_CD
                                                   AND SVVPS.SKD_VOY_NO   = BVD.SKD_VOY_NO
                                                   AND SVVPS.SKD_DIR_CD   = BVD.SKD_DIR_CD
                                                   AND SVVPS.VPS_PORT_CD  = 'CNSHA'
                                                   ) AS PRT_CD,
                                               (SELECT SVVPS.CLPT_SEQ
                                                  FROM VSK_VSL_PORT_SKD  SVVPS
                                                 WHERE 1=1
                                                   AND SVVPS.SLAN_CD      = BVD.SLAN_CD
                                                   AND SVVPS.VSL_CD       = BVD.VSL_CD
                                                   AND SVVPS.SKD_VOY_NO   = BVD.SKD_VOY_NO
                                                   AND SVVPS.SKD_DIR_CD   = BVD.SKD_DIR_CD
                                                   AND SVVPS.VPS_PORT_CD  = 'CNSHA'
                                                   ) AS PRT_SEQ,
                                               SVAR.POL_CD,
                                               (SELECT SVVPS.CLPT_SEQ
                                                  FROM VSK_VSL_PORT_SKD  SVVPS
                                                 WHERE 1=1
                                                   AND SVVPS.SLAN_CD      = BVD.SLAN_CD
                                                   AND SVVPS.VSL_CD       = BVD.VSL_CD
                                                   AND SVVPS.SKD_VOY_NO   = BVD.SKD_VOY_NO
                                                   AND SVVPS.SKD_DIR_CD   = BVD.SKD_DIR_CD
                                                   AND SVVPS.CLPT_IND_SEQ = BVD.POL_CLPT_IND_SEQ
                                                   AND SVVPS.VPS_PORT_CD  = BVD.POL_CD
                                                   ) AS POL_SEQ,
                                                SVAR.POD_CD,
                                               (SELECT SVVPS.CLPT_SEQ
                                                  FROM VSK_VSL_PORT_SKD  SVVPS
                                                 WHERE 1=1
                                                   AND SVVPS.SLAN_CD      = BVD.SLAN_CD
                                                   AND SVVPS.VSL_CD       = BVD.VSL_CD
                                                   AND SVVPS.SKD_VOY_NO   = BVD.SKD_VOY_NO
                                                   AND SVVPS.SKD_DIR_CD   = BVD.SKD_DIR_CD
                                                   AND SVVPS.CLPT_IND_SEQ = BVD.POD_CLPT_IND_SEQ
                                                   AND SVVPS.VPS_PORT_CD  = BVD.POD_CD
                                                   ) AS POD_SEQ,
                                               NVL(SDC.WGT_UT_CD, 'KGS') AS WGT_UT_CD,
                                               SDC.IMDG_CLSS_CD,
                                               SDC.FLSH_PNT_CDO_TEMP,
                                               SDC.IMDG_COMP_GRP_CD,
                                               SDC.IMDG_UN_NO,
                                               SDC.IMDG_UN_NO_SEQ,
                                               SUBSTR(SDC.CNTR_TPSZ_CD, 0, 1) AS CNTR_TP_CD,
                                               SDC.IMDG_SUBS_RSK_LBL_CD1,
                                               SDC.IMDG_SUBS_RSK_LBL_CD2,
                                               SDC.IMDG_SUBS_RSK_LBL_CD3,
                                               SDC.IMDG_SUBS_RSK_LBL_CD4,
                                              1 AS NET_WGT,
                                              ( SELECT COUNT(DISTINCT DG_CNTR_SEQ) FROM BKG_DG_CGO  
                                                 WHERE BKG_NO = SDC.BKG_NO
                                                 AND IMDG_CLSS_CD = SDC.IMDG_CLSS_CD
                                                 AND SPCL_CGO_APRO_CD IS NOT NULL
                                                 AND SPCL_CGO_APRO_CD NOT IN ('C','D')) AS GRS_WGT,
                                               1 AS NET_EXPLO_WGT,
                                               VVPS.VPS_ETA_DT, SDC.IMDG_PCK_GRP_CD,
                                                 SVAR.VSL_PRE_PST_CD, SVAR.VSL_SEQ  , SAR.SPCL_CGO_APRO_RQST_SEQ
                                      FROM BKG_DG_CGO        SDC,
                                           SCG_APRO_RQST     SAR,
                                           SCG_VVD_APRO_RQST SVAR,
                                           BKG_VVD           BVD,
                                           VSK_VSL_PORT_SKD  VVPS
                                                                        WHERE 1 = 1
                                       AND SDC.BKG_NO                 = SAR.BKG_NO
                                       AND SAR.BKG_NO                 = SVAR.BKG_NO
                                       AND SAR.SPCL_CGO_APRO_RQST_SEQ = SVAR.SPCL_CGO_APRO_RQST_SEQ
                                       AND SVAR.BKG_NO                = BVD.BKG_NO
                                       AND SVAR.VSL_PRE_PST_CD        = BVD.VSL_PRE_PST_CD
                                       AND SVAR.VSL_SEQ               = BVD.VSL_SEQ
                                       AND SVAR.VSL_CD                = VVPS.VSL_CD
                                       AND SVAR.SKD_VOY_NO            = VVPS.SKD_VOY_NO
                                       AND SVAR.SKD_DIR_CD            = VVPS.SKD_DIR_CD
                                       AND (SVAR.POL_CD                = VVPS.VPS_PORT_CD  OR SVAR.POD_CD                = VVPS.VPS_PORT_CD)
                                       AND NVL(SVAR.POL_CLPT_IND_SEQ, 1) = VVPS.CLPT_IND_SEQ
                                       AND SDC.SPCL_CGO_APRO_CD IS NOT NULL
                                       AND SDC.SPCL_CGO_APRO_CD NOT IN ('C','D')
                                       AND SAR.LST_RQST_DAT_FLG = 'Y'
                                       AND (VVPS.SKD_CNG_STS_CD <> 'S' OR VVPS.SKD_CNG_STS_CD IS NULL)
                                     AND EXISTS (
                                                  SELECT 1
                                                    FROM BKG_BOOKING C
                                                   WHERE SDC.BKG_NO = C.BKG_NO
                                                     AND C.BKG_STS_CD <> 'X'
                                                )

                                       #if (${slan_cd1} != '')
                                        AND SVAR.SLAN_CD = @[slan_cd1]
                                       #end
                                       #if (${imdg_clss_cd} != '')
                                        AND SDC.IMDG_CLSS_CD = @[imdg_clss_cd]
                                       #end
                                       #if (${vsl_cd} != '')
                                        AND SVAR.VSL_CD = @[vsl_cd]
                                       #end
                                       #if (${skd_voy_no} != '')
                                        AND SVAR.SKD_VOY_NO = @[skd_voy_no]
                                       #end
                                       #if (${skd_dir_cd} != '')
                                        AND SVAR.SKD_DIR_CD = @[skd_dir_cd]
                                       #end
                                       #if (${from_eta_dt} != '' && ${to_eta_dt} != '')
                                        AND VVPS.VPS_ETA_DT BETWEEN TO_DATE(@[from_eta_dt],'YYYY-MM-DD') AND TO_DATE(@[to_eta_dt],'YYYY-MM-DD')+0.99999
                                       #end

                                                              )A,SCG_AUTHORIZATION G
                                                                      WHERE A.BKG_NO                           = G.BKG_NO (+)
                                                                     AND A.SPCL_CGO_APRO_RQST_SEQ = G.SPCL_CGO_APRO_RQST_SEQ (+)
                                                                     AND A.VSL_PRE_PST_CD               = G.VSL_PRE_PST_CD (+)
                                                                     AND A.VSL_SEQ                           = G.VSL_SEQ (+)
                                                                     AND A.DCGO_SEQ               = G.DCGO_SEQ (+)
                                                                        #if (${auth_flg} == 'P')
                                                                            AND    G.SPCL_CGO_AUTH_CD             = 'P'
                                                                        #end
                                                                        #if (${auth_flg} == 'R')
                                                                            AND NVL(G.SPCL_CGO_AUTH_CD,'R') = 'R'
                                                                        #end
                                                                        #if (${auth_flg} == 'Y')
                                                                            AND G.SPCL_CGO_AUTH_CD             = 'Y'
                                                                        #end

                                       AND A.SPCL_CGO_APRO_CD IN('P','R','Y')
                                UNION ALL

                                    -- Own BKG`s SPCL CGO Info
                                    SELECT SDC.BKG_NO,
                                               SDC.DCGO_SEQ,
                                               VVPS.SLAN_CD,
                                               VVPS.VSL_CD,
                                               VVPS.SKD_VOY_NO,
                                               VVPS.SKD_DIR_CD,
                                               (SELECT SVVPS.VPS_PORT_CD
                                                  FROM VSK_VSL_PORT_SKD  SVVPS
                                                 WHERE 1=1
                                                   AND SVVPS.SLAN_CD      = BVD.SLAN_CD
                                                   AND SVVPS.VSL_CD       = BVD.VSL_CD
                                                   AND SVVPS.SKD_VOY_NO   = BVD.SKD_VOY_NO
                                                   AND SVVPS.SKD_DIR_CD   = BVD.SKD_DIR_CD
                                                   AND SVVPS.VPS_PORT_CD  = 'CNSHA'
                                                   ) AS PRT_CD,
                                               (SELECT SVVPS.CLPT_SEQ
                                                  FROM VSK_VSL_PORT_SKD  SVVPS
                                                 WHERE 1=1
                                                   AND SVVPS.SLAN_CD      = BVD.SLAN_CD
                                                   AND SVVPS.VSL_CD       = BVD.VSL_CD
                                                   AND SVVPS.SKD_VOY_NO   = BVD.SKD_VOY_NO
                                                   AND SVVPS.SKD_DIR_CD   = BVD.SKD_DIR_CD
                                                   AND SVVPS.VPS_PORT_CD  = 'CNSHA'
                                                   ) AS PRT_SEQ,
                                               SVAR.POL_CD,
                                               (SELECT SVVPS.CLPT_SEQ
                                                  FROM VSK_VSL_PORT_SKD  SVVPS
                                                 WHERE 1=1
                                                   AND SVVPS.SLAN_CD      = BVD.SLAN_CD
                                                   AND SVVPS.VSL_CD       = BVD.VSL_CD
                                                   AND SVVPS.SKD_VOY_NO   = BVD.SKD_VOY_NO
                                                   AND SVVPS.SKD_DIR_CD   = BVD.SKD_DIR_CD
                                                   AND SVVPS.CLPT_IND_SEQ = BVD.POL_CLPT_IND_SEQ
                                                   AND SVVPS.VPS_PORT_CD  = BVD.POL_CD
                                                   ) AS POL_SEQ,
                                                SVAR.POD_CD,
                                               (SELECT SVVPS.CLPT_SEQ
                                                  FROM VSK_VSL_PORT_SKD  SVVPS
                                                 WHERE 1=1
                                                   AND SVVPS.SLAN_CD      = BVD.SLAN_CD
                                                   AND SVVPS.VSL_CD       = BVD.VSL_CD
                                                   AND SVVPS.SKD_VOY_NO   = BVD.SKD_VOY_NO
                                                   AND SVVPS.SKD_DIR_CD   = BVD.SKD_DIR_CD
                                                   AND SVVPS.CLPT_IND_SEQ = BVD.POD_CLPT_IND_SEQ
                                                   AND SVVPS.VPS_PORT_CD  = BVD.POD_CD
                                                   ) AS POD_SEQ,
                                               NVL(SDC.WGT_UT_CD, 'KGS') AS WGT_UT_CD,
                                               SDC.IMDG_CLSS_CD,
                                               SDC.FLSH_PNT_CDO_TEMP,
                                               SDC.IMDG_COMP_GRP_CD,
                                               SDC.IMDG_UN_NO,
                                               SDC.IMDG_UN_NO_SEQ,
                                               SUBSTR(SDC.CNTR_TPSZ_CD, 0, 1) AS CNTR_TP_CD,
                                               SDC.IMDG_SUBS_RSK_LBL_CD1,
                                               SDC.IMDG_SUBS_RSK_LBL_CD2,
                                               SDC.IMDG_SUBS_RSK_LBL_CD3,
                                               SDC.IMDG_SUBS_RSK_LBL_CD4,
                                              1 AS NET_WGT,
                                              ( SELECT COUNT(DISTINCT DG_CNTR_SEQ) FROM SCG_DG_CGO  
                                                 WHERE BKG_NO = SDC.BKG_NO
                                                 AND IMDG_CLSS_CD = SDC.IMDG_CLSS_CD
                                                 AND SPCL_CGO_APRO_CD IS NOT NULL
                                                 AND SPCL_CGO_APRO_CD NOT IN ('C','D')) AS GRS_WGT,
                                              1 AS NET_EXPLO_WGT,
                                               VVPS.VPS_ETA_DT,
                                                                   SDC.IMDG_PCK_GRP_CD,
                    VVPS.YD_CD
                                      FROM SCG_DG_CGO        SDC,
                                           SCG_APRO_RQST     SAR,
                                           SCG_VVD_APRO_RQST SVAR,
                                           BKG_VVD           BVD,
                                           VSK_VSL_PORT_SKD  VVPS,
                                                                                 SCG_AUTHORIZATION G
                                                                        WHERE SDC.BKG_NO                           = G.BKG_NO
                                                                         AND SDC.SPCL_CGO_APRO_RQST_SEQ = G.SPCL_CGO_APRO_RQST_SEQ
                                                                         AND SVAR.VSL_PRE_PST_CD               = G.VSL_PRE_PST_CD
                                                                         AND SVAR.VSL_SEQ                           = G.VSL_SEQ
                                                                         AND SDC.DCGO_SEQ               = G.DCGO_SEQ
                                       AND SDC.BKG_NO                 = SAR.BKG_NO
                                       AND SDC.SPCL_CGO_APRO_RQST_SEQ = SAR.SPCL_CGO_APRO_RQST_SEQ
                                       AND SAR.BKG_NO                 = SVAR.BKG_NO
                                       AND SAR.SPCL_CGO_APRO_RQST_SEQ = SVAR.SPCL_CGO_APRO_RQST_SEQ
                                       AND SVAR.BKG_NO                = BVD.BKG_NO
                                       AND SVAR.VSL_PRE_PST_CD        = BVD.VSL_PRE_PST_CD
                                       AND SVAR.VSL_SEQ               = BVD.VSL_SEQ
                                       AND SVAR.VSL_CD                = VVPS.VSL_CD
                                       AND SVAR.SKD_VOY_NO            = VVPS.SKD_VOY_NO
                                       AND SVAR.SKD_DIR_CD            = VVPS.SKD_DIR_CD
                                       AND (SVAR.POL_CD                = VVPS.VPS_PORT_CD  OR SVAR.POD_CD                = VVPS.VPS_PORT_CD)
                                       AND NVL(SVAR.POL_CLPT_IND_SEQ, 1) = VVPS.CLPT_IND_SEQ
                                       AND SDC.SPCL_CGO_APRO_CD IS NOT NULL
                                       AND SDC.SPCL_CGO_APRO_CD NOT IN ('C','D')
                                       AND SAR.LST_RQST_DAT_FLG = 'Y'
                                       AND (VVPS.SKD_CNG_STS_CD <> 'S' OR VVPS.SKD_CNG_STS_CD IS NULL)
                                     AND EXISTS (
                                                  SELECT 1
                                                    FROM BKG_BOOKING C
                                                   WHERE SDC.BKG_NO = C.BKG_NO
                                                     AND C.BKG_STS_CD <> 'X'
                                                )

                                                                        #if (${auth_flg} == 'P')
                                                                            AND    G.SPCL_CGO_AUTH_CD             = 'P'
                                                                        #end
                                                                        #if (${auth_flg} == 'R')
                                                                            AND NVL(G.SPCL_CGO_AUTH_CD,'R') = 'R'
                                                                        #end
                                                                        #if (${auth_flg} == 'Y')
                                                                            AND G.SPCL_CGO_AUTH_CD             = 'Y'
                                                                        #end
                                       AND SPCL_CGO_APRO_CD IN('P','R','Y')
                                       #if (${slan_cd1} != '')
                                        AND SVAR.SLAN_CD = @[slan_cd1]
                                       #end
                                       #if (${imdg_clss_cd} != '')
                                        AND SDC.IMDG_CLSS_CD = @[imdg_clss_cd]
                                       #end
                                       #if (${vsl_cd} != '')
                                        AND SVAR.VSL_CD = @[vsl_cd]
                                       #end
                                       #if (${skd_voy_no} != '')
                                        AND SVAR.SKD_VOY_NO = @[skd_voy_no]
                                       #end
                                       #if (${skd_dir_cd} != '')
                                        AND SVAR.SKD_DIR_CD = @[skd_dir_cd]
                                       #end
                                       #if (${from_eta_dt} != '' && ${to_eta_dt} != '')
                                        AND VVPS.VPS_ETA_DT BETWEEN TO_DATE(@[from_eta_dt],'YYYY-MM-DD') AND TO_DATE(@[to_eta_dt],'YYYY-MM-DD')+0.99999
                                       #end

                                    UNION ALL

                                    -- Partner Lines SPCL CGO Info
                                    SELECT SPAR.BKG_REF_NO,
                                           SPAC.SPCL_CGO_SEQ,
                                           SPAR.SLAN_CD,
                                           SPAR.VSL_CD,
                                           SPAR.SKD_VOY_NO,
                                           SPAR.SKD_DIR_CD,
                                           (SELECT SVVPS.VPS_PORT_CD
                                                  FROM VSK_VSL_PORT_SKD  SVVPS
                                                 WHERE 1=1
                                                   AND SVVPS.SLAN_CD      = SPAR.SLAN_CD
                                                   AND SVVPS.VSL_CD       = SPAR.VSL_CD
                                                   AND SVVPS.SKD_VOY_NO   = SPAR.SKD_VOY_NO
                                                   AND SVVPS.SKD_DIR_CD   = SPAR.SKD_DIR_CD
                                                   AND SVVPS.VPS_PORT_CD  = 'CNSHA'
                                                   ) AS PRT_CD,
                                               (SELECT SVVPS.CLPT_SEQ
                                                  FROM VSK_VSL_PORT_SKD  SVVPS
                                                 WHERE 1=1
                                                   AND SVVPS.SLAN_CD      = SPAR.SLAN_CD
                                                   AND SVVPS.VSL_CD       = SPAR.VSL_CD
                                                   AND SVVPS.SKD_VOY_NO   = SPAR.SKD_VOY_NO
                                                   AND SVVPS.SKD_DIR_CD   = SPAR.SKD_DIR_CD
                                                   AND SVVPS.VPS_PORT_CD  = 'CNSHA'
                                                   ) AS PRT_SEQ,
                                               SPAR.POL_CD,
                                               (SELECT SVVPS.CLPT_SEQ
                                                  FROM VSK_VSL_PORT_SKD  SVVPS
                                                 WHERE 1=1
                                                   AND SVVPS.SLAN_CD      = SPAR.SLAN_CD
                                                   AND SVVPS.VSL_CD       = SPAR.VSL_CD
                                                   AND SVVPS.SKD_VOY_NO   = SPAR.SKD_VOY_NO
                                                   AND SVVPS.SKD_DIR_CD   = SPAR.SKD_DIR_CD
                                                   AND SVVPS.CLPT_IND_SEQ = SPAR.POL_CLPT_IND_SEQ
                                                   AND SVVPS.VPS_PORT_CD  = SPAR.POL_CD
                                                   ) AS POL_SEQ,
                                                SPAR.POD_CD,
                                               (SELECT SVVPS.CLPT_SEQ
                                                  FROM VSK_VSL_PORT_SKD  SVVPS
                                                 WHERE 1=1
                                                   AND SVVPS.SLAN_CD      = SPAR.SLAN_CD
                                                   AND SVVPS.VSL_CD       = SPAR.VSL_CD
                                                   AND SVVPS.SKD_VOY_NO   = SPAR.SKD_VOY_NO
                                                   AND SVVPS.SKD_DIR_CD   = SPAR.SKD_DIR_CD
                                                   AND SVVPS.CLPT_IND_SEQ = NVL(SPAR.POD_CLPT_IND_SEQ,1)
                                                   AND SVVPS.VPS_PORT_CD  = SPAR.POD_CD
                                                   ) AS POD_SEQ,
                                               NVL(SPAC.WGT_UT_CD, 'KGS') AS WGT_UT_CD,
                                               SPAC.IMDG_CLSS_CD,
                                               SPAC.FLSH_PNT_CDO_TEMP,
                                               (SELECT IMDG_COMP_GRP_CD FROM SCG_IMDG_UN_NO WHERE  IMDG_UN_NO = SPAC.IMDG_UN_NO AND  IMDG_UN_NO_SEQ = SPAC.IMDG_UN_NO_SEQ) AS IMDG_COMP_GRP_CD,
                                                  SPAC.IMDG_UN_NO,
                                               SPAC.IMDG_UN_NO_SEQ,
                                                SUBSTR(SPAC.CNTR_TPSZ_CD, 0, 1) AS CNTR_TP_CD,
                                                SPAC.N1ST_IMDG_SUBS_RSK_LBL_CD AS IMDG_SUBS_RSK_LBL_CD1,
                                                SPAC.N2ND_IMDG_SUBS_RSK_LBL_CD AS IMDG_SUBS_RSK_LBL_CD2,
                                                SPAC.N3RD_IMDG_SUBS_RSK_LBL_CD AS IMDG_SUBS_RSK_LBL_CD3,
                                                SPAC.N4TH_IMDG_SUBS_RSK_LBL_CD AS IMDG_SUBS_RSK_LBL_CD4,
                                               1 AS NET_WGT,
                                               (SELECT COUNT(DISTINCT SPCL_CNTR_SEQ) FROM SCG_PRNR_APRO_RQST_CGO  
                                                WHERE CRR_CD = SPAC.CRR_CD
                                                AND BKG_REF_NO = SPAC.BKG_REF_NO
                                                AND IMDG_CLSS_CD = SPAC.IMDG_CLSS_CD
                                                AND SPCL_CGO_RQST_SEQ = SPAC.SPCL_CGO_RQST_SEQ) AS GRS_WGT,
                                               1 AS NET_EXPLO_WGT,
                                               VVPS.VPS_ETA_DT,
                                               SPAC.IMDG_PCK_GRP_CD,
                                              VVPS.YD_CD
                                     FROM  SCG_PRNR_APRO_RQST      SPAR,
                                           (
                                                                                 SELECT T.*
                                                                                      , AVG(DECODE(T.AUTH_STS_CD,'Y',1,'N',2,-999)) OVER(PARTITION BY T.CRR_CD, T.BKG_REF_NO, T.SPCL_CGO_RQST_SEQ) STS_CT
                                                                                   FROM SCG_PRNR_APRO_RQST_CGO T
                                                                             ) SPAC,
                                           VSK_VSL_PORT_SKD        VVPS
                                     WHERE 1=1
                                       AND SPAR.CRR_CD            = SPAC.CRR_CD
                                       AND SPAR.BKG_REF_NO        = SPAC.BKG_REF_NO
                                       AND SPAR.SPCL_CGO_RQST_SEQ = SPAC.SPCL_CGO_RQST_SEQ
                                       AND SPAR.VSL_CD            = VVPS.VSL_CD
                                       AND SPAR.SKD_VOY_NO        = VVPS.SKD_VOY_NO
                                       AND SPAR.SKD_DIR_CD        = VVPS.SKD_DIR_CD
                                       AND NVL(SPAR.POL_CLPT_IND_SEQ,1)  = VVPS.CLPT_IND_SEQ
                                       AND SPAR.POD_CD            = VVPS.VPS_PORT_CD
                                       AND SPAR.DG_FLG            = 'Y'
                                       AND SPAR.LST_RQST_DAT_FLG  = 'Y'
                                       AND (VVPS.SKD_CNG_STS_CD <> 'S' OR VVPS.SKD_CNG_STS_CD IS NULL)
                                       AND SPAC.STS_CT < 2

                                                                        #if (${auth_flg} == 'P')
                                                                            AND    SPAC.AUTH_STS_CD            = 'P'
                                                                        #end
                                                                        #if (${auth_flg} == 'R')
                                                                            AND SPAC.AUTH_STS_CD = 'R'
                                                                        #end
                                                                        #if (${auth_flg} == 'Y')
                                                                            AND SPAC.AUTH_STS_CD             = 'Y'
                                                                        #end
                                       AND SPAC.AUTH_STS_CD IN('P','R','Y')
                                       --AND SPAC.AUTH_STS_CD IN('Y','N','R','P')

                                       #if (${slan_cd1} != '')
                                        AND SPAR.SLAN_CD = @[slan_cd1]
                                       #end
                                       #if (${imdg_clss_cd} != '')
                                        AND SPAC.IMDG_CLSS_CD = @[imdg_clss_cd]
                                       #end
                                       #if (${vsl_cd} != '')
                                        AND SPAR.VSL_CD = @[vsl_cd]
                                       #end
                                       #if (${skd_voy_no} != '')
                                        AND SPAR.SKD_VOY_NO = @[skd_voy_no]
                                       #end
                                       #if (${skd_dir_cd} != '')
                                        AND SPAR.SKD_DIR_CD = @[skd_dir_cd]
                                       #end
                                       #if (${from_eta_dt} != '' && ${to_eta_dt} != '')
                                        AND VVPS.VPS_ETA_DT BETWEEN TO_DATE(@[from_eta_dt],'YYYY-MM-DD') AND TO_DATE(@[to_eta_dt],'YYYY-MM-DD')+0.99999
                                       #end

                                    ) A
                             WHERE PRT_SEQ = POD_SEQ --DISCHARGE
                        UNION ALL

                       SELECT A.BKG_NO, A.DCGO_SEQ,
                                  A.SLAN_CD,
                                  A.VSL_CD,
                                  A.SKD_VOY_NO,
                                  A.SKD_DIR_CD,
                                  A.PRT_CD,
                                  A.POL_CD,
                                  A.POD_CD,
                                  A.WGT_UT_CD,
                                  A.IMDG_CLSS_CD,
                                  A.FLSH_PNT_CDO_TEMP,
                                  A.IMDG_COMP_GRP_CD,
                                  A.IMDG_UN_NO,
                                  A.IMDG_UN_NO_SEQ,
                                  A.CNTR_TP_CD,
                                  A.IMDG_SUBS_RSK_LBL_CD1,
                                  A.IMDG_SUBS_RSK_LBL_CD2,
                                  A.IMDG_SUBS_RSK_LBL_CD3,
                                  A.IMDG_SUBS_RSK_LBL_CD4,
                                  0 AS ARR_NET_WGT, 0 AS ARR_GRS_WGT, 0 AS ARR_NET_EXPLO_WGT,
                                  0 AS DCHG_NET_WGT, 0 AS DCHG_GRS_WGT, 0 AS DCHG_NET_EXPLO_WGT,
                                  NET_WGT AS LOD_NET_WGT, GRS_WGT AS LOD_GRS_WGT, NET_EXPLO_WGT AS LOD_NET_EXPLO_WGT,
                                  0 AS DEP_NET_WGT, 0 AS DEP_GRS_WGT, 0 AS DEP_NET_EXPLO_WGT,
                                  A.VPS_ETA_DT, A.IMDG_PCK_GRP_CD,
                                  '3LOAD' PORT_LMT_KND,
                                  A.YD_CD
                          FROM (

                                        SELECT A.BKG_NO,A.DCGO_SEQ,A.SLAN_CD,A.VSL_CD,A.SKD_VOY_NO,A.SKD_DIR_CD,A.PRT_CD,A.PRT_SEQ,A.POL_CD,A.POL_SEQ,A.POD_CD,A.POD_SEQ,
                                                    A.WGT_UT_CD,A.IMDG_CLSS_CD,A.FLSH_PNT_CDO_TEMP,A.IMDG_COMP_GRP_CD,A.IMDG_UN_NO,A.IMDG_UN_NO_SEQ,A.CNTR_TP_CD,A.IMDG_SUBS_RSK_LBL_CD1,
                                                    A.IMDG_SUBS_RSK_LBL_CD2,A.IMDG_SUBS_RSK_LBL_CD3,A.IMDG_SUBS_RSK_LBL_CD4,A.NET_WGT,A.GRS_WGT,A.NET_EXPLO_WGT,A.VPS_ETA_DT,A.IMDG_PCK_GRP_CD,A.YD_CD
                                          FROM
                                                 (
                                    -- Own BKG`s SPCL CGO Info
                                    SELECT SDC.BKG_NO,
                                      SDC.SPCL_CGO_APRO_CD,
                                      SDC.DCGO_SEQ,
                                      VVPS.SLAN_CD,
                                      VVPS.VSL_CD,
                                      VVPS.SKD_VOY_NO,
                                      VVPS.SKD_DIR_CD,
                                      (SELECT SVVPS.VPS_PORT_CD
                                      FROM VSK_VSL_PORT_SKD SVVPS
                                      WHERE 1               =1
                                      AND SVVPS.SLAN_CD     = BVD.SLAN_CD
                                      AND SVVPS.VSL_CD      = BVD.VSL_CD
                                      AND SVVPS.SKD_VOY_NO  = BVD.SKD_VOY_NO
                                      AND SVVPS.SKD_DIR_CD  = BVD.SKD_DIR_CD
                                      AND SVVPS.VPS_PORT_CD = 'CNSHA'
                                      ) AS PRT_CD,
                                      (SELECT SVVPS.CLPT_SEQ
                                      FROM VSK_VSL_PORT_SKD SVVPS
                                      WHERE 1               =1
                                      AND SVVPS.SLAN_CD     = BVD.SLAN_CD
                                      AND SVVPS.VSL_CD      = BVD.VSL_CD
                                      AND SVVPS.SKD_VOY_NO  = BVD.SKD_VOY_NO
                                      AND SVVPS.SKD_DIR_CD  = BVD.SKD_DIR_CD
                                      AND SVVPS.VPS_PORT_CD = 'CNSHA'
                                      ) AS PRT_SEQ,
                                      SVAR.POL_CD,
                                      (SELECT SVVPS.CLPT_SEQ
                                      FROM VSK_VSL_PORT_SKD SVVPS
                                      WHERE 1                =1
                                      AND SVVPS.SLAN_CD      = BVD.SLAN_CD
                                      AND SVVPS.VSL_CD       = BVD.VSL_CD
                                      AND SVVPS.SKD_VOY_NO   = BVD.SKD_VOY_NO
                                      AND SVVPS.SKD_DIR_CD   = BVD.SKD_DIR_CD
                                      AND SVVPS.CLPT_IND_SEQ = BVD.POL_CLPT_IND_SEQ
                                      AND SVVPS.VPS_PORT_CD  = BVD.POL_CD
                                      ) AS POL_SEQ,
                                      SVAR.POD_CD,
                                      (SELECT SVVPS.CLPT_SEQ
                                      FROM VSK_VSL_PORT_SKD SVVPS
                                      WHERE 1                =1
                                      AND SVVPS.SLAN_CD      = BVD.SLAN_CD
                                      AND SVVPS.VSL_CD       = BVD.VSL_CD
                                      AND SVVPS.SKD_VOY_NO   = BVD.SKD_VOY_NO
                                      AND SVVPS.SKD_DIR_CD   = BVD.SKD_DIR_CD
                                      AND SVVPS.CLPT_IND_SEQ = BVD.POD_CLPT_IND_SEQ
                                      AND SVVPS.VPS_PORT_CD  = BVD.POD_CD
                                      )                         AS POD_SEQ,
                                      NVL(SDC.WGT_UT_CD, 'KGS') AS WGT_UT_CD,
                                      SDC.IMDG_CLSS_CD,
                                      SDC.FLSH_PNT_CDO_TEMP,
                                      SDC.IMDG_COMP_GRP_CD,
                                      SDC.IMDG_UN_NO,
                                      SDC.IMDG_UN_NO_SEQ,
                                      SUBSTR(SDC.CNTR_TPSZ_CD, 0, 1) AS CNTR_TP_CD,
                                      SDC.IMDG_SUBS_RSK_LBL_CD1,
                                      SDC.IMDG_SUBS_RSK_LBL_CD2,
                                      SDC.IMDG_SUBS_RSK_LBL_CD3,
                                      SDC.IMDG_SUBS_RSK_LBL_CD4,
                                      1 AS NET_WGT,
                                       ( SELECT COUNT(DISTINCT DG_CNTR_SEQ) FROM BKG_DG_CGO  
                                       WHERE BKG_NO = SDC.BKG_NO
                                       AND IMDG_CLSS_CD = SDC.IMDG_CLSS_CD
                                       AND SPCL_CGO_APRO_CD IS NOT NULL
                                       AND SPCL_CGO_APRO_CD NOT IN ('C','D')) AS GRS_WGT,
                                      1 AS NET_EXPLO_WGT,
                                      VVPS.VPS_ETA_DT,
                                      SDC.IMDG_PCK_GRP_CD,
                                      SVAR.VSL_PRE_PST_CD,
                                      SVAR.VSL_SEQ,
                                      SAR.SPCL_CGO_APRO_RQST_SEQ,
                                      VVPS.YD_CD
                                    FROM BKG_DG_CGO SDC,
                                      SCG_APRO_RQST SAR,
                                      SCG_VVD_APRO_RQST SVAR,
                                      BKG_VVD BVD,
                                      VSK_VSL_PORT_SKD VVPS
                                                                        WHERE 1 = 1
                                       AND SDC.BKG_NO                 = SAR.BKG_NO
                                       AND SAR.BKG_NO                 = SVAR.BKG_NO
                                       AND SAR.SPCL_CGO_APRO_RQST_SEQ = SVAR.SPCL_CGO_APRO_RQST_SEQ
                                       AND SVAR.BKG_NO                = BVD.BKG_NO
                                       AND SVAR.VSL_PRE_PST_CD        = BVD.VSL_PRE_PST_CD
                                       AND SVAR.VSL_SEQ               = BVD.VSL_SEQ
                                       AND SVAR.VSL_CD                = VVPS.VSL_CD
                                       AND SVAR.SKD_VOY_NO            = VVPS.SKD_VOY_NO
                                       AND SVAR.SKD_DIR_CD            = VVPS.SKD_DIR_CD
                                       AND (SVAR.POL_CD                = VVPS.VPS_PORT_CD  OR SVAR.POD_CD                = VVPS.VPS_PORT_CD)
                                       AND NVL(SVAR.POL_CLPT_IND_SEQ, 1) = VVPS.CLPT_IND_SEQ
                                       AND SDC.SPCL_CGO_APRO_CD IS NOT NULL
                                       AND SDC.SPCL_CGO_APRO_CD NOT IN ('C','D')
                                       AND SAR.LST_RQST_DAT_FLG = 'Y'
                                       AND (VVPS.SKD_CNG_STS_CD <> 'S' OR VVPS.SKD_CNG_STS_CD IS NULL)
                                     AND EXISTS (
                                                  SELECT 1
                                                    FROM BKG_BOOKING C
                                                   WHERE SDC.BKG_NO = C.BKG_NO
                                                     AND C.BKG_STS_CD <> 'X'
                                                )

                                       #if (${slan_cd1} != '')
                                        AND SVAR.SLAN_CD = @[slan_cd1]
                                       #end
                                       #if (${imdg_clss_cd} != '')
                                        AND SDC.IMDG_CLSS_CD = @[imdg_clss_cd]
                                       #end
                                       #if (${vsl_cd} != '')
                                        AND SVAR.VSL_CD = @[vsl_cd]
                                       #end
                                       #if (${skd_voy_no} != '')
                                        AND SVAR.SKD_VOY_NO = @[skd_voy_no]
                                       #end
                                       #if (${skd_dir_cd} != '')
                                        AND SVAR.SKD_DIR_CD = @[skd_dir_cd]
                                       #end
                                       #if (${from_eta_dt} != '' && ${to_eta_dt} != '')
                                        AND VVPS.VPS_ETA_DT BETWEEN TO_DATE(@[from_eta_dt],'YYYY-MM-DD') AND TO_DATE(@[to_eta_dt],'YYYY-MM-DD')+0.99999
                                       #end

                                                              )A,SCG_AUTHORIZATION G
                                                                      WHERE A.BKG_NO                           = G.BKG_NO (+)
                                                                     AND A.SPCL_CGO_APRO_RQST_SEQ = G.SPCL_CGO_APRO_RQST_SEQ (+)
                                                                     AND A.VSL_PRE_PST_CD               = G.VSL_PRE_PST_CD (+)
                                                                     AND A.VSL_SEQ                           = G.VSL_SEQ (+)
                                                                     AND A.DCGO_SEQ               = G.DCGO_SEQ (+)

                                                                        #if (${auth_flg} == 'P')
                                                                            AND    G.SPCL_CGO_AUTH_CD             = 'P'
                                                                        #end
                                                                        #if (${auth_flg} == 'R')
                                                                            AND NVL(G.SPCL_CGO_AUTH_CD,'R') = 'R'
                                                                        #end
                                                                        #if (${auth_flg} == 'Y')
                                                                            AND G.SPCL_CGO_AUTH_CD             = 'Y'
                                                                        #end
                                       AND A.SPCL_CGO_APRO_CD IN('P','R','Y')

                                   UNION ALL

                                    -- Own BKG`s SPCL CGO Info
                                    SELECT SDC.BKG_NO,
                                           SDC.DCGO_SEQ,
                                           VVPS.SLAN_CD,
                                           VVPS.VSL_CD,
                                           VVPS.SKD_VOY_NO,
                                           VVPS.SKD_DIR_CD,
                                           (SELECT SVVPS.VPS_PORT_CD
                                              FROM VSK_VSL_PORT_SKD  SVVPS
                                             WHERE 1=1
                                               AND SVVPS.SLAN_CD      = BVD.SLAN_CD
                                               AND SVVPS.VSL_CD       = BVD.VSL_CD
                                               AND SVVPS.SKD_VOY_NO   = BVD.SKD_VOY_NO
                                               AND SVVPS.SKD_DIR_CD   = BVD.SKD_DIR_CD
                                               AND SVVPS.VPS_PORT_CD  = 'CNSHA'
                                               ) AS PRT_CD,
                                           (SELECT SVVPS.CLPT_SEQ
                                              FROM VSK_VSL_PORT_SKD  SVVPS
                                             WHERE 1=1
                                               AND SVVPS.SLAN_CD      = BVD.SLAN_CD
                                               AND SVVPS.VSL_CD       = BVD.VSL_CD
                                               AND SVVPS.SKD_VOY_NO   = BVD.SKD_VOY_NO
                                               AND SVVPS.SKD_DIR_CD   = BVD.SKD_DIR_CD
                                               AND SVVPS.VPS_PORT_CD  = 'CNSHA'
                                               ) AS PRT_SEQ,
                                           SVAR.POL_CD,
                                           (SELECT SVVPS.CLPT_SEQ
                                              FROM VSK_VSL_PORT_SKD  SVVPS
                                             WHERE 1=1
                                               AND SVVPS.SLAN_CD      = BVD.SLAN_CD
                                               AND SVVPS.VSL_CD       = BVD.VSL_CD
                                               AND SVVPS.SKD_VOY_NO   = BVD.SKD_VOY_NO
                                               AND SVVPS.SKD_DIR_CD   = BVD.SKD_DIR_CD
                                               AND SVVPS.CLPT_IND_SEQ = BVD.POL_CLPT_IND_SEQ
                                               AND SVVPS.VPS_PORT_CD  = BVD.POL_CD
                                               ) AS POL_SEQ,
                                            SVAR.POD_CD,
                                           (SELECT SVVPS.CLPT_SEQ
                                              FROM VSK_VSL_PORT_SKD  SVVPS
                                             WHERE 1=1
                                               AND SVVPS.SLAN_CD      = BVD.SLAN_CD
                                               AND SVVPS.VSL_CD       = BVD.VSL_CD
                                               AND SVVPS.SKD_VOY_NO   = BVD.SKD_VOY_NO
                                               AND SVVPS.SKD_DIR_CD   = BVD.SKD_DIR_CD
                                               AND SVVPS.CLPT_IND_SEQ = BVD.POD_CLPT_IND_SEQ
                                               AND SVVPS.VPS_PORT_CD  = BVD.POD_CD
                                               ) AS POD_SEQ,
                                           NVL(SDC.WGT_UT_CD, 'KGS') AS WGT_UT_CD,
                                           SDC.IMDG_CLSS_CD,
                                                                                SDC.FLSH_PNT_CDO_TEMP,
                                           SDC.IMDG_COMP_GRP_CD,
                                              SDC.IMDG_UN_NO,
                                           SDC.IMDG_UN_NO_SEQ,
                                          SUBSTR(SDC.CNTR_TPSZ_CD, 0, 1) AS CNTR_TP_CD,
                                           SDC.IMDG_SUBS_RSK_LBL_CD1,
                                           SDC.IMDG_SUBS_RSK_LBL_CD2,
                                           SDC.IMDG_SUBS_RSK_LBL_CD3,
                                           SDC.IMDG_SUBS_RSK_LBL_CD4,
                                          1 AS NET_WGT,
                                           ( SELECT COUNT(DISTINCT DG_CNTR_SEQ) FROM SCG_DG_CGO  
                                           WHERE BKG_NO = SDC.BKG_NO
                                           AND IMDG_CLSS_CD = SDC.IMDG_CLSS_CD
                                           AND SPCL_CGO_APRO_CD IS NOT NULL
                                           AND SPCL_CGO_APRO_CD NOT IN ('C','D')) AS GRS_WGT,
                                          1 AS NET_EXPLO_WGT,
                                          VVPS.VPS_ETA_DT,
                                          SDC.IMDG_PCK_GRP_CD,
                                          VVPS.YD_CD
                                      FROM SCG_DG_CGO        SDC,
                                           SCG_APRO_RQST     SAR,
                                           SCG_VVD_APRO_RQST SVAR,
                                           BKG_VVD           BVD,
                                           VSK_VSL_PORT_SKD  VVPS,
                                           SCG_AUTHORIZATION G
                                      WHERE SDC.BKG_NO                           = G.BKG_NO
                                       AND SDC.SPCL_CGO_APRO_RQST_SEQ = G.SPCL_CGO_APRO_RQST_SEQ
                                       AND SVAR.VSL_PRE_PST_CD               = G.VSL_PRE_PST_CD
                                       AND SVAR.VSL_SEQ                           = G.VSL_SEQ
                                       AND SDC.DCGO_SEQ               = G.DCGO_SEQ
                                       AND SDC.BKG_NO                 = SAR.BKG_NO
                                       AND SDC.SPCL_CGO_APRO_RQST_SEQ = SAR.SPCL_CGO_APRO_RQST_SEQ
                                       AND SAR.BKG_NO                 = SVAR.BKG_NO
                                       AND SAR.SPCL_CGO_APRO_RQST_SEQ = SVAR.SPCL_CGO_APRO_RQST_SEQ
                                       AND SVAR.BKG_NO                = BVD.BKG_NO
                                       AND SVAR.VSL_PRE_PST_CD        = BVD.VSL_PRE_PST_CD
                                       AND SVAR.VSL_SEQ               = BVD.VSL_SEQ
                                       AND SVAR.VSL_CD                = VVPS.VSL_CD
                                       AND SVAR.SKD_VOY_NO            = VVPS.SKD_VOY_NO
                                       AND SVAR.SKD_DIR_CD            = VVPS.SKD_DIR_CD
                                       AND (SVAR.POL_CD                = VVPS.VPS_PORT_CD  OR SVAR.POD_CD                = VVPS.VPS_PORT_CD)
                                       AND NVL(SVAR.POL_CLPT_IND_SEQ, 1) = VVPS.CLPT_IND_SEQ
                                       AND SDC.SPCL_CGO_APRO_CD IS NOT NULL
                                       AND SDC.SPCL_CGO_APRO_CD NOT IN ('C','D')
                                       AND SAR.LST_RQST_DAT_FLG = 'Y'
                                       AND (VVPS.SKD_CNG_STS_CD <> 'S' OR VVPS.SKD_CNG_STS_CD IS NULL)
                                     AND EXISTS (
                                                  SELECT 1
                                                    FROM BKG_BOOKING C
                                                   WHERE SDC.BKG_NO = C.BKG_NO
                                                     AND C.BKG_STS_CD <> 'X'
                                                )

                                        #if (${auth_flg} == 'P')
                                            AND    G.SPCL_CGO_AUTH_CD             = 'P'
                                        #end
                                        #if (${auth_flg} == 'R')
                                            AND NVL(G.SPCL_CGO_AUTH_CD,'R') = 'R'
                                        #end
                                        #if (${auth_flg} == 'Y')
                                            AND G.SPCL_CGO_AUTH_CD             = 'Y'
                                        #end
                                        AND SPCL_CGO_APRO_CD IN('P','R','Y')
                                       #if (${slan_cd1} != '')
                                        AND SVAR.SLAN_CD = @[slan_cd1]
                                       #end
                                       #if (${imdg_clss_cd} != '')
                                        AND SDC.IMDG_CLSS_CD = @[imdg_clss_cd]
                                       #end
                                       #if (${vsl_cd} != '')
                                        AND SVAR.VSL_CD = @[vsl_cd]
                                       #end
                                       #if (${skd_voy_no} != '')
                                        AND SVAR.SKD_VOY_NO = @[skd_voy_no]
                                       #end
                                       #if (${skd_dir_cd} != '')
                                        AND SVAR.SKD_DIR_CD = @[skd_dir_cd]
                                       #end
                                       #if (${from_eta_dt} != '' && ${to_eta_dt} != '')
                                        AND VVPS.VPS_ETA_DT BETWEEN TO_DATE(@[from_eta_dt],'YYYY-MM-DD') AND TO_DATE(@[to_eta_dt],'YYYY-MM-DD')+0.99999
                                       #end

                                    UNION ALL
                                    -- Partner Lines SPCL CGO Info
                                    SELECT SPAR.BKG_REF_NO,
                                           SPAC.SPCL_CGO_SEQ,
                                           SPAR.SLAN_CD,
                                           SPAR.VSL_CD,
                                           SPAR.SKD_VOY_NO,
                                           SPAR.SKD_DIR_CD,
                                           (SELECT SVVPS.VPS_PORT_CD
                                                  FROM VSK_VSL_PORT_SKD  SVVPS
                                                 WHERE 1=1
                                                   AND SVVPS.SLAN_CD      = SPAR.SLAN_CD
                                                   AND SVVPS.VSL_CD       = SPAR.VSL_CD
                                                   AND SVVPS.SKD_VOY_NO   = SPAR.SKD_VOY_NO
                                                   AND SVVPS.SKD_DIR_CD   = SPAR.SKD_DIR_CD
                                                   AND SVVPS.VPS_PORT_CD  = 'CNSHA'
                                                   ) AS PRT_CD,
                                               (SELECT SVVPS.CLPT_SEQ
                                                  FROM VSK_VSL_PORT_SKD  SVVPS
                                                 WHERE 1=1
                                                   AND SVVPS.SLAN_CD      = SPAR.SLAN_CD
                                                   AND SVVPS.VSL_CD       = SPAR.VSL_CD
                                                   AND SVVPS.SKD_VOY_NO   = SPAR.SKD_VOY_NO
                                                   AND SVVPS.SKD_DIR_CD   = SPAR.SKD_DIR_CD
                                                   AND SVVPS.VPS_PORT_CD  = 'CNSHA'
                                                   ) AS PRT_SEQ,
                                               SPAR.POL_CD,
                                               (SELECT SVVPS.CLPT_SEQ
                                                  FROM VSK_VSL_PORT_SKD  SVVPS
                                                 WHERE 1=1
                                                   AND SVVPS.SLAN_CD      = SPAR.SLAN_CD
                                                   AND SVVPS.VSL_CD       = SPAR.VSL_CD
                                                   AND SVVPS.SKD_VOY_NO   = SPAR.SKD_VOY_NO
                                                   AND SVVPS.SKD_DIR_CD   = SPAR.SKD_DIR_CD
                                                   AND SVVPS.CLPT_IND_SEQ = NVL(SPAR.POL_CLPT_IND_SEQ,1)
                                                   AND SVVPS.VPS_PORT_CD  = SPAR.POL_CD
                                                   ) AS POL_SEQ,
                                                SPAR.POD_CD,
                                               (SELECT SVVPS.CLPT_SEQ
                                                  FROM VSK_VSL_PORT_SKD  SVVPS
                                                 WHERE 1=1
                                                   AND SVVPS.SLAN_CD      = SPAR.SLAN_CD
                                                   AND SVVPS.VSL_CD       = SPAR.VSL_CD
                                                   AND SVVPS.SKD_VOY_NO   = SPAR.SKD_VOY_NO
                                                   AND SVVPS.SKD_DIR_CD   = SPAR.SKD_DIR_CD
                                                   AND SVVPS.CLPT_IND_SEQ = NVL(SPAR.POD_CLPT_IND_SEQ,1)
                                                   AND SVVPS.VPS_PORT_CD  = SPAR.POD_CD
                                                   ) AS POD_SEQ,
                                           NVL(SPAC.WGT_UT_CD, 'KGS') AS WGT_UT_CD,
                                           SPAC.IMDG_CLSS_CD,
                                                                                SPAC.FLSH_PNT_CDO_TEMP,
                                           (SELECT IMDG_COMP_GRP_CD FROM SCG_IMDG_UN_NO WHERE  IMDG_UN_NO = SPAC.IMDG_UN_NO AND  IMDG_UN_NO_SEQ = SPAC.IMDG_UN_NO_SEQ) AS IMDG_COMP_GRP_CD,
                                             SPAC.IMDG_UN_NO,
                                           SPAC.IMDG_UN_NO_SEQ,
                                            SUBSTR(SPAC.CNTR_TPSZ_CD, 0, 1) AS CNTR_TP_CD,
                                            SPAC.N1ST_IMDG_SUBS_RSK_LBL_CD AS IMDG_SUBS_RSK_LBL_CD1,
                                            SPAC.N2ND_IMDG_SUBS_RSK_LBL_CD AS IMDG_SUBS_RSK_LBL_CD2,
                                            SPAC.N3RD_IMDG_SUBS_RSK_LBL_CD AS IMDG_SUBS_RSK_LBL_CD3,
                                            SPAC.N4TH_IMDG_SUBS_RSK_LBL_CD AS IMDG_SUBS_RSK_LBL_CD4,
                                            1 AS NET_WGT,
                                            (SELECT COUNT(DISTINCT SPCL_CNTR_SEQ) FROM SCG_PRNR_APRO_RQST_CGO  
                                              WHERE CRR_CD = SPAC.CRR_CD
                                              AND BKG_REF_NO = SPAC.BKG_REF_NO
                                              AND IMDG_CLSS_CD = SPAC.IMDG_CLSS_CD
                                              AND SPCL_CGO_RQST_SEQ = SPAC.SPCL_CGO_RQST_SEQ) AS GRS_WGT,
                                            1 AS NET_EXPLO_WGT,
                                            VVPS.VPS_ETA_DT,
                                            SPAC.IMDG_PCK_GRP_CD,
                                            VVPS.YD_CD
                                     FROM  SCG_PRNR_APRO_RQST      SPAR,
                                           (
                                               SELECT T.*
                                                    , AVG(DECODE(T.AUTH_STS_CD,'Y',1,'N',2,-999)) OVER(PARTITION BY T.CRR_CD, T.BKG_REF_NO, T.SPCL_CGO_RQST_SEQ) STS_CT
                                                 FROM SCG_PRNR_APRO_RQST_CGO T
                                           ) SPAC,
                                           VSK_VSL_PORT_SKD        VVPS
                                     WHERE 1=1
                                       AND SPAR.CRR_CD            = SPAC.CRR_CD
                                       AND SPAR.BKG_REF_NO        = SPAC.BKG_REF_NO
                                       AND SPAR.SPCL_CGO_RQST_SEQ = SPAC.SPCL_CGO_RQST_SEQ
                                       AND SPAR.VSL_CD            = VVPS.VSL_CD
                                       AND SPAR.SKD_VOY_NO        = VVPS.SKD_VOY_NO
                                       AND SPAR.SKD_DIR_CD        = VVPS.SKD_DIR_CD
                                       AND NVL(SPAR.POL_CLPT_IND_SEQ,1)  = VVPS.CLPT_IND_SEQ
                                       AND SPAR.POL_CD            = VVPS.VPS_PORT_CD
                                       AND SPAR.DG_FLG            = 'Y'
                                       AND SPAR.LST_RQST_DAT_FLG  = 'Y'
                                       AND (VVPS.SKD_CNG_STS_CD <> 'S' OR VVPS.SKD_CNG_STS_CD IS NULL)
                                       AND SPAC.STS_CT < 2
                                        #if (${auth_flg} == 'P')
                                            AND    SPAC.AUTH_STS_CD            = 'P'
                                        #end
                                        #if (${auth_flg} == 'R')
                                            AND SPAC.AUTH_STS_CD = 'R'
                                        #end
                                        #if (${auth_flg} == 'Y')
                                            AND SPAC.AUTH_STS_CD             = 'Y'
                                        #end
                                       AND SPAC.AUTH_STS_CD IN('P','R','Y')
                                       #if (${slan_cd1} != '')
                                        AND SPAR.SLAN_CD = @[slan_cd1]
                                       #end
                                       #if (${imdg_clss_cd} != '')
                                        AND SPAC.IMDG_CLSS_CD = @[imdg_clss_cd]
                                       #end
                                       #if (${vsl_cd} != '')
                                        AND SPAR.VSL_CD = @[vsl_cd]
                                       #end
                                       #if (${skd_voy_no} != '')
                                        AND SPAR.SKD_VOY_NO = @[skd_voy_no]
                                       #end
                                       #if (${skd_dir_cd} != '')
                                        AND SPAR.SKD_DIR_CD = @[skd_dir_cd]
                                       #end
                                       #if (${from_eta_dt} != '' && ${to_eta_dt} != '')
                                        AND VVPS.VPS_ETA_DT BETWEEN TO_DATE(@[from_eta_dt],'YYYY-MM-DD') AND TO_DATE(@[to_eta_dt],'YYYY-MM-DD')+0.99999
                                       #end

                                    ) A
                                WHERE PRT_SEQ = POL_SEQ --LOAD
                             )
                            GROUP BY BKG_NO, DCGO_SEQ,SLAN_CD,VSL_CD,SKD_VOY_NO,SKD_DIR_CD,PRT_CD,POL_CD,POD_CD,WGT_UT_CD,IMDG_CLSS_CD,FLSH_PNT_CDO_TEMP,IMDG_COMP_GRP_CD,IMDG_UN_NO,IMDG_UN_NO_SEQ,
                                        CNTR_TP_CD,IMDG_SUBS_RSK_LBL_CD1,IMDG_SUBS_RSK_LBL_CD2,IMDG_SUBS_RSK_LBL_CD3,IMDG_SUBS_RSK_LBL_CD4,ARR_NET_WGT,ARR_GRS_WGT,ARR_NET_EXPLO_WGT,
                                        DCHG_NET_WGT,DCHG_GRS_WGT,DCHG_NET_EXPLO_WGT,LOD_NET_WGT,LOD_GRS_WGT,LOD_NET_EXPLO_WGT,DEP_NET_WGT,DEP_GRS_WGT,DEP_NET_EXPLO_WGT,VPS_ETA_DT,IMDG_PCK_GRP_CD,PORT_LMT_KND,YD_CD
                 )
            GROUP BY SLAN_CD, VSL_CD, SKD_VOY_NO, SKD_DIR_CD, PRT_CD, POL_CD, POD_CD, WGT_UT_CD, IMDG_CLSS_CD, FLSH_PNT_CDO_TEMP, PORT_LMT_KND, VPS_ETA_DT, IMDG_PCK_GRP_CD, IMDG_COMP_GRP_CD,IMDG_UN_NO, IMDG_UN_NO_SEQ, CNTR_TP_CD, IMDG_SUBS_RSK_LBL_CD1, IMDG_SUBS_RSK_LBL_CD2, IMDG_SUBS_RSK_LBL_CD3, IMDG_SUBS_RSK_LBL_CD4, BKG_NO, YD_CD

        ) DGIF

  WHERE 1=1
    AND SIPL.PORT_CD             = DGIF.PRT_CD
    AND (SIPL.IMDG_CLSS_CD IS NULL OR SIPL.IMDG_CLSS_CD = DGIF.IMDG_CLSS_CD)
    AND (SIPL.IMDG_COMP_GRP_CD IS NULL OR SIPL.IMDG_COMP_GRP_CD = DGIF.IMDG_COMP_GRP_CD)
    AND (SIPL.PORT_LMT_KND IS NULL OR SIPL.PORT_LMT_KND = DGIF.PORT_LMT_KND)
    AND (SIPL.IMDG_UN_NO IS NULL OR SIPL.IMDG_UN_NO = DGIF.IMDG_UN_NO)
    AND (SIPL.CNTR_TP_CD IS NULL OR SIPL.CNTR_TP_CD = DGIF.CNTR_TP_CD)
    AND (SIPL.IMDG_SUBS_RSK_LBL_CD IS NULL OR SIPL.IMDG_SUBS_RSK_LBL_CD IN (DGIF.IMDG_SUBS_RSK_LBL_CD1, DGIF.IMDG_SUBS_RSK_LBL_CD2, DGIF.IMDG_SUBS_RSK_LBL_CD3, DGIF.IMDG_SUBS_RSK_LBL_CD4) )
    AND (SIPL.FLSH_PNT_TEMP IS NULL OR SIPL.FLSH_PNT_TEMP >= DGIF.FLSH_PNT_CDO_TEMP)
    AND (SIPL.IMDG_PCK_GRP_CD IS NULL OR SIPL.IMDG_PCK_GRP_CD = DGIF.IMDG_PCK_GRP_CD)
    AND DGIF.PRT_CD = 'CNSHA'
    AND SIPL.YD_CD = DGIF.YD_CD
   ) B

WHERE A.RN = B.RN(+)
    AND A.PORT_CD = B.PORT_CD(+)
    AND A.PORT_LMT_KND = B.PORT_LMT_KND(+)
    AND A.PORT_LMT_SEQ = B.PORT_LMT_SEQ(+)
    AND A.YD_CD        = B.YD_CD
    AND B.VSL_CD IS NOT NULL
)
GROUP BY RN,
    PORT_CD,
    PORT_LMT_SEQ,
    PORT_LMT_REP_DESC,
    BKG_NO,
    SLAN_CD,
    PRT_CD,
    PIER_TP_CD,
    VSL_CD,
    SKD_VOY_NO ,
    SKD_DIR_CD ,
    IMDG_CLSS_CD ,
    FLSH_PNT_TEMP,
    IMDG_CLSS_CD_DESC,
    LMT_WGT_TP_CD,
    IMDG_COMP_GRP_CD,
    IMDG_PCK_GRP_CD,
    IMDG_SUBS_RSK_LBL_CD,
    IMDG_UN_NO,
    CNTR_TP_CD,
    ARR_DEP_PROHI_FLG,
    LDIS_APLY_TGT_FLG,
    ARR_MAX_LMT,
    DCHG_MAX_LMT,
    LOD_MAX_LMT,
    DEP_MAX_LMT

) A

) A
GROUP BY A.PORT_CD,
    A.PORT_LMT_SEQ,
    A.PORT_LMT_REP_DESC,
    A.LMT_WGT_TP_CD,
    A.VSL_CD,
    A.SKD_VOY_NO,
    A.SKD_DIR_CD,
    A.SLAN_CD,
    A.PRT_CD,
    A.PIER_TP_CD,
    A.FLSH_PNT_TEMP
ORDER BY (SELECT B.DP_SEQ FROM SCG_IMDG_PORT_LMT_MST B
      WHERE B.PORT_CD = A.PORT_CD AND B.LMT_WGT_TP_CD IS NULL AND B.PORT_LMT_SEQ = A.PORT_LMT_SEQ)
)			]]></sql>
			<params>
				<param name="slan_cd1" type="12" value="" out="N"/>
				<param name="imdg_clss_cd" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="from_eta_dt" type="12" value="" out="N"/>
				<param name="to_eta_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
