<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BudgetPortChargeMgtBCDBDAOSearchEstCreByMonRSQL">
			<desc><![CDATA[DESC Enter..]]></desc>
			<sql><![CDATA[
SELECT V.*
     , (SELECT MAX(CRE_USR_ID)
          FROM PSO_TGT_YD_EXPN T
         WHERE T.PSO_BZTP_CD = '2'
           AND T.VSL_CD = V.VSL_CD
           AND T.SKD_VOY_NO = V.SKD_VOY_NO
           AND T.SKD_DIR_CD = V.SKD_DIR_CD
           --AND T.RLANE_CD = V.RLANE_CD
           --AND ROWNUM = 1
       ) AS CRE_USR_ID
     , (SELECT /*+INDEX_DESC( T )*/
               TO_CHAR(MAX(T.CRE_DT), 'YYYY-MM-DD HH24:MI')
          FROM PSO_TGT_YD_EXPN T
         WHERE T.PSO_BZTP_CD = '2'
           AND T.VSL_CD = V.VSL_CD
           AND T.SKD_VOY_NO = V.SKD_VOY_NO
           AND T.SKD_DIR_CD = V.SKD_DIR_CD
           --AND T.RLANE_CD = V.RLANE_CD
           --AND ROWNUM = 1
        ) AS CRE_DT
  FROM (SELECT /*+  HASH_SJ(V, TV) */
               NVL(TV.EXPN_YRMON, V.REV_YRMON) AS REV_YRMON
             , V.EXE_YRMON
             , V.VSL_CD || V.SKD_VOY_NO || V.SKD_DIR_CD VVD
             , V.VSL_CD
             , V.SKD_VOY_NO
             , V.SKD_DIR_CD
             , V.REV_DIR_CD
             , V.RLANE_CD
             , V.ESTM_VVD_TP_CD
          FROM GL_ESTM_REV_VVD V
             , PSO_TGT_VVD TV
         WHERE V.EXE_YRMON          = REPLACE(@[rev_yrmon], '-', '') /*EXE_YRMON*/
           AND V.ESTM_VVD_TP_CD     = 'RV'
           AND V.ESTM_IOC_DIV_CD    = 'OO'
#if (${vsl_slan_cd} != '') 
           AND V.RLANE_CD LIKE @[vsl_slan_cd] || '%'
#end 
           AND EXISTS ( SELECT 'Y'
                          FROM VSK_VSL_SKD A
                             , MDM_VSL_CNTR B
                         WHERE A.VSL_CD = B.VSL_CD
                           AND NVL(A.ACT_CRR_CD,B.CRR_CD) = COM_CONSTANTMGR_PKG.COM_GETCOMPANYCODE_FNC()
                           AND A.VSL_CD = V.VSL_CD
                           AND A.SKD_VOY_NO = V.SKD_VOY_NO
                           AND A.SKD_DIR_CD = V.SKD_DIR_CD )
           AND V.VSL_CD             = TV.VSL_CD(+)
           AND V.SKD_VOY_NO         = TV.SKD_VOY_NO(+)
           AND V.SKD_DIR_CD         = TV.SKD_DIR_CD(+)
           AND TV.PSO_BZTP_CD       (+)= '2' ) V
 ORDER BY V.REV_YRMON
     , V.VSL_CD
     , V.SKD_VOY_NO
     , V.SKD_DIR_CD			]]></sql>
			<params>
				<param name="rev_yrmon" type="12" value="" out="N"/>
				<param name="vsl_slan_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
