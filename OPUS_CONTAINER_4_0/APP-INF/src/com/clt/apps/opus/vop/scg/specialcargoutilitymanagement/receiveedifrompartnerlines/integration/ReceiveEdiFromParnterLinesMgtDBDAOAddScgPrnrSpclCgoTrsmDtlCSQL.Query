<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ReceiveEdiFromParnterLinesMgtDBDAOAddScgPrnrSpclCgoTrsmDtlCSQL">
			<desc><![CDATA[AddScgPrnrSpclCgoTrsmHdr]]></desc>
			<sql><![CDATA[
INSERT INTO                        
	   SCG_PRNR_SPCL_CGO_TRSM_DTL
       (
          TRSM_BND_CD
        , TRSM_DT
        , SPCL_CGO_CATE_CD
        , PRNR_SPCL_CGO_SEQ
        , PRNR_SPCL_CGO_SUB_SEQ
        , CNTR_REF_NO
        , CNTR_DMY_REF_NO
        , CNTR_TPSZ_CD_CTNT
        , ISO_CNTR_TPSZ_CD

		  ---------------------------------------------------
        , CNTR_SEQ
        , EDI_ITM_SEQ    -- :2015-07-25: --
        , CGO_SEQ
 		, DCGO_SEQ
		  ---------------------------------------------------

        , DCGO_STS_CD_CTNT

		, DCGO_REF_NO

        , MVMT_SPCL_TP_CD
        , OUT_N1ST_IMDG_PCK_CD_CTNT
        , OUT_N1ST_IMDG_PCK_QTY_CTNT
        , OUT_N1ST_IMDG_PCK_DESC
        , INTMD_N1ST_IMDG_PCK_CD_CTNT
        , INTMD_N1ST_IMDG_PCK_QTY_CTNT
        , INTMD_N1ST_IMDG_PCK_DESC
        , IN_N1ST_IMDG_PCK_CD_CTNT
        , IN_N1ST_IMDG_PCK_QTY_CTNT
        , IN_N1ST_IMDG_PCK_DESC
        , HZD_DESC
        , PRP_SHP_NM
        , IMDG_TEC_NM
        , IMDG_CLSS_CD_CTNT
        , IMDG_PPR_NO

		, IMDG_AMDT_NO

        , IMDG_UN_NO_CTNT
        , IMDG_UN_NO_SEQ
        , CFR_FLG
        , CFR_NO
        , FLSH_PNT_UT_CD_CTNT
        , FLSH_PNT_TEMP_CTNT
        , IMDG_PCK_GRP_CD_CTNT
        , EMS_NO
        , MFAG_NO
        , ESP_NO
        , IMDG_MRN_POLUT_FLG
        , IMDG_MRN_POLUT_CD_CTNT
        , IMDG_LMT_QTY_FLG_CTNT
        , IMDG_EXPT_QTY_FLG_CTNT
        , GRS_WGT_UT_CD_CTNT
        , GRS_WGT_CTNT
        , NET_WGT_UT_CD_CTNT
        , NET_WGT_CTNT
        , NET_EXPLO_WGT_UT_CD_CTNT
        , NET_EXPLO_WGT_CTNT

        , PCK_TP_CD_CTNT
        , PCK_QTY_CTNT
        , DIFF_RMK

        , EMER_CNTC_PHN_NO
        , EMER_CNTC_PSON_NM
        , PSA_NO
        , SPCL_STWG_RQST_DESC
        , RSD_FLG_CTNT
        , CGO_UPD_STS_CD
        , AUTO_UPD_RSLT_CD
        , EDI_ELEM_CNG_CTNT
        , CRE_USR_ID
        , CRE_DT
        , UPD_USR_ID
        , UPD_DT

		, IMDG_COMP_GRP_CD		
		, N1ST_IMDG_SUBS_RSK_LBL_CD    
		, N2ND_IMDG_SUBS_RSK_LBL_CD    
		, N3RD_IMDG_SUBS_RSK_LBL_CD    
		, N4TH_IMDG_SUBS_RSK_LBL_CD    
		, N5TH_IMDG_SUBS_RSK_LBL_CD    
		, N6TH_IMDG_SUBS_RSK_LBL_CD    
		, N7TH_IMDG_SUBS_RSK_LBL_CD    
		, N8TH_IMDG_SUBS_RSK_LBL_CD  

		, EDI_CGO_UNMAP_DTL_CD

		--::2015-10-22::--
		, DCGO_DTL_STS_CD
		, IMDG_ADD_SEGR_GRP_NO
		, IMDG_N1ST_SEGR_GRP_NO
		, IMDG_N2ND_SEGR_GRP_NO
		, IMDG_N3RD_SEGR_GRP_NO
		, IMDG_N4TH_SEGR_GRP_NO

		, CTRL_TEMP_CTNT

       )  

SELECT C.TRSM_BND_CD
     , C.TRSM_DT
     , C.SPCL_CGO_CATE_CD
     , C.PRNR_SPCL_CGO_SEQ

     --:2015-07-25:--, C.PRNR_SPCL_CGO_SUB_SEQ
	 , MP.CGO_MAPG_SEQ		AS NEW_PRNR_SPCL_CGO_SUB_SEQ

     --:2015-09-02:--, C.CNTR_REF_NO
	 , MP.CNTR_REF_NO

     , '' CNTR_DMY_REF_NO
     , B.CNTR_TPSZ_CD_CTNT
     , B.ISO_CNTR_TPSZ_CD

	 --------------------------------------------------
     --::2015-05-30::--, B.CNTR_SEQ

	 , MP.CNTR_SEQ
     , C.EDI_ITM_SEQ        AS EDI_ITM_SEQ      -- TO-BE >> C.EDI_ITM_SEQ :2015-07-25: --    
     , MP.CGO_SEQ      
     --::2015-05-30::--, C.CGO_SEQ
	 , MP.CGO_MAPG_SEQ		AS DCGO_SEQ
     --------------------------------------------------

     , C.DCGO_STS_CD_CTNT

	 , C.DCGO_REF_NO

     , C.MVMT_SPCL_TP_CD
     , C.OUT_N1ST_IMDG_PCK_CD_CTNT
     , C.OUT_N1ST_IMDG_PCK_QTY_CTNT
     , C.OUT_N1ST_IMDG_PCK_DESC
     , C.INTMD_N1ST_IMDG_PCK_CD_CTNT
     , C.INTMD_N1ST_IMDG_PCK_QTY_CTNT
     , C.INTMD_N1ST_IMDG_PCK_DESC
     , C.IN_N1ST_IMDG_PCK_CD_CTNT
     , C.IN_N1ST_IMDG_PCK_QTY_CTNT
     , C.IN_N1ST_IMDG_PCK_DESC
     , C.HZD_DESC
     , C.PRP_SHP_NM
     , C.IMDG_TEC_NM
     , C.IMDG_CLSS_CD_CTNT
     , C.IMDG_PPR_NO

	 , C.IMDG_AMDT_NO

     , C.IMDG_UN_NO_CTNT
     , C.IMDG_UN_NO_SEQ
     , C.CFR_FLG
     , C.CFR_NO
     , C.FLSH_PNT_UT_CD_CTNT
     , C.FLSH_PNT_TEMP_CTNT
     , C.IMDG_PCK_GRP_CD_CTNT
     , C.EMS_NO
     , C.MFAG_NO
     , C.ESP_NO
     , C.IMDG_MRN_POLUT_FLG
     , C.IMDG_MRN_POLUT_CD_CTNT
     , C.IMDG_LMT_QTY_FLG_CTNT
     , C.IMDG_EXPT_QTY_FLG_CTNT

     , C.GRS_WGT_UT_CD_CTNT
     , C.GRS_WGT_CTNT/(SELECT   COUNT(1) 
                       FROM     SCG_PRNR_SPCL_CGO_SEQ_MAPG MPP 
                       WHERE    MPP.PRNR_SPCL_CGO_SEQ      = MP.PRNR_SPCL_CGO_SEQ
                       AND      MPP.EDI_ITM_SEQ            = MP.EDI_ITM_SEQ
                       )        AS GRS_WGT_CTNT

     , C.NET_WGT_UT_CD_CTNT
     , C.NET_WGT_CTNT/(SELECT   COUNT(1) 
                       FROM     SCG_PRNR_SPCL_CGO_SEQ_MAPG MPP 
                       WHERE    MPP.PRNR_SPCL_CGO_SEQ      = MP.PRNR_SPCL_CGO_SEQ
                       AND      MPP.EDI_ITM_SEQ            = MP.EDI_ITM_SEQ
                       )        AS NET_WGT_CTNT

     , C.NET_EXPLO_WGT_UT_CD_CTNT
     , C.NET_EXPLO_WGT_CTNT/(SELECT   COUNT(1) 
                       		 FROM     SCG_PRNR_SPCL_CGO_SEQ_MAPG MPP 
                       		 WHERE    MPP.PRNR_SPCL_CGO_SEQ      = MP.PRNR_SPCL_CGO_SEQ
                       		 AND      MPP.EDI_ITM_SEQ            = MP.EDI_ITM_SEQ
                       		 )        AS NET_EXPLO_WGT_CTNT

     , C.PCK_TP_CD_CTNT
     , C.PCK_QTY_CTNT
     , C.DIFF_RMK

     , C.EMER_CNTC_PHN_NO
     , C.EMER_CNTC_PSON_NM
     , C.PSA_NO
     , C.SPCL_STWG_RQST_DESC

     , C.RSD_FLG_CTNT
     , '' CGO_UPD_STS_CD
     , '' AUTO_UPD_RSLT_CD
     , '' EDI_ELEM_CNG_CTNT
     , C.CRE_USR_ID
     , C.CRE_DT
     , C.UPD_USR_ID
     , C.UPD_DT
 
	,	C.IMDG_COMP_GRP_CD		
	,	C.N1ST_IMDG_SUBS_RSK_LBL_CD    
	,	C.N2ND_IMDG_SUBS_RSK_LBL_CD    
	,	C.N3RD_IMDG_SUBS_RSK_LBL_CD    
	,	C.N4TH_IMDG_SUBS_RSK_LBL_CD    
	,	C.N5TH_IMDG_SUBS_RSK_LBL_CD    
	,	C.N6TH_IMDG_SUBS_RSK_LBL_CD    
	,	C.N7TH_IMDG_SUBS_RSK_LBL_CD    
	,	C.N8TH_IMDG_SUBS_RSK_LBL_CD  

	,   C.EDI_CGO_UNMAP_DTL_CD 

	--::2015-10-22::-- 
	,	C.DCGO_DTL_STS_CD_CTNT
	,	(SELECT X.IMDG_SEGR_GRP_NO FROM SCG_IMDG_SEGR_GRP X WHERE UPPER(X.IMDG_SEGR_GRP_NM) = TRIM(UPPER(C.IMDG_ADD_SEGR_GRP_NO_CTNT)))
	,	SUBSTR(C.IMDG_SEGR_GRP_NO_CTNT,1,INSTR(C.IMDG_SEGR_GRP_NO_CTNT,'*',1,1)-1) 																					AS IMDG_N1ST_SEGR_GRP_NO  
     ,  SUBSTR(C.IMDG_SEGR_GRP_NO_CTNT,INSTR(C.IMDG_SEGR_GRP_NO_CTNT,'*',1,1)+1,INSTR(C.IMDG_SEGR_GRP_NO_CTNT,'*',1,2)-INSTR(C.IMDG_SEGR_GRP_NO_CTNT,'*',1,1)-1) 	AS IMDG_N2ND_SEGR_GRP_NO
     ,  SUBSTR(C.IMDG_SEGR_GRP_NO_CTNT,INSTR(C.IMDG_SEGR_GRP_NO_CTNT,'*',1,2)+1,INSTR(C.IMDG_SEGR_GRP_NO_CTNT,'*',1,3)-INSTR(C.IMDG_SEGR_GRP_NO_CTNT,'*',1,2)-1) 	AS IMDG_N3RD_SEGR_GRP_NO
     ,  SUBSTR(C.IMDG_SEGR_GRP_NO_CTNT,INSTR(C.IMDG_SEGR_GRP_NO_CTNT,'*',1,3)+1,INSTR(C.IMDG_SEGR_GRP_NO_CTNT,'*',1,4)-INSTR(C.IMDG_SEGR_GRP_NO_CTNT,'*',1,3)-1) 	AS IMDG_N4TH_SEGR_GRP_NO
	 
	,	C.CTRL_TEMP_CTNT

 FROM SCG_PRNR_SPCL_CGO_TRSM_HDR 	A
    , SCG_PRNR_SPCL_CGO_CNTR_LOG 	B
    , SCG_PRNR_SPCL_CGO_DTL_LOG  	C
	, SCG_PRNR_SPCL_CGO_SEQ_MAPG 	MP
WHERE A.TRSM_BND_CD       			= @[trsm_bnd_cd]
  AND A.TRSM_DT           			= TO_DATE(@[trsm_dt],'yyyy-MM-dd')
  AND A.SPCL_CGO_CATE_CD  			= @[spcl_cgo_cate_cd]
  AND A.PRNR_SPCL_CGO_SEQ 			= @[prnr_spcl_cgo_seq]
  AND A.TRSM_BND_CD       			= B.TRSM_BND_CD
  AND A.TRSM_DT           			= B.TRSM_DT
  AND A.SPCL_CGO_CATE_CD  			= B.SPCL_CGO_CATE_CD
  AND A.PRNR_SPCL_CGO_SEQ 			= B.PRNR_SPCL_CGO_SEQ
  AND A.TRSM_BND_CD       			= C.TRSM_BND_CD
  AND A.TRSM_DT           			= C.TRSM_DT
  AND A.SPCL_CGO_CATE_CD  			= C.SPCL_CGO_CATE_CD
  AND A.PRNR_SPCL_CGO_SEQ 			= C.PRNR_SPCL_CGO_SEQ

  ----------------------------------------------------------------
  AND A.PRNR_SPCL_CGO_SEQ 			= MP.PRNR_SPCL_CGO_SEQ
  AND B.CNTR_SEQ          			= MP.CNTR_SEQ

  AND C.EDI_ITM_SEQ       			= MP.EDI_ITM_SEQ 

  /* 2015-07-28 AND C.CGO_SEQ       = MP.EDI_ITM_SEQ */
  ----------------------------------------------------------------

  AND NOT EXISTS (SELECT 1 
                    FROM SCG_PRNR_SPCL_CGO_TRSM_ERR ERR
                   WHERE A.TRSM_BND_CD       = ERR.TRSM_BND_CD
                     AND A.TRSM_DT           = ERR.TRSM_DT
                     AND A.SPCL_CGO_CATE_CD  = ERR.SPCL_CGO_CATE_CD
                     AND A.PRNR_SPCL_CGO_SEQ = ERR.PRNR_SPCL_CGO_SEQ
                 )
  AND NOT EXISTS (SELECT 1 
                    FROM SCG_PRNR_SPCL_CGO_DTL_ERR ERR
                   WHERE C.TRSM_BND_CD           = ERR.TRSM_BND_CD
                     AND C.TRSM_DT               = ERR.TRSM_DT
                     AND C.SPCL_CGO_CATE_CD      = ERR.SPCL_CGO_CATE_CD
                     AND C.PRNR_SPCL_CGO_SEQ     = ERR.PRNR_SPCL_CGO_SEQ
                     AND C.PRNR_SPCL_CGO_SUB_SEQ = ERR.PRNR_SPCL_CGO_SUB_SEQ				
                 )			]]></sql>
			<params>
				<param name="trsm_bnd_cd" type="12" value="" out="N"/>
				<param name="trsm_dt" type="12" value="" out="N"/>
				<param name="spcl_cgo_cate_cd" type="12" value="" out="N"/>
				<param name="prnr_spcl_cgo_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
