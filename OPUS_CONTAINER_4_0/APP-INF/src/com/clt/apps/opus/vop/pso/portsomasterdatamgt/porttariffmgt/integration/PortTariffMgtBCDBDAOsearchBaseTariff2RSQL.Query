<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PortTariffMgtBCDBDAOsearchBaseTariff2RSQL">
			<desc><![CDATA[select formula의 tariff조회]]></desc>
			<sql><![CDATA[
SELECT T22.DP_NO AS SEQ
     , T21.CURR_CD CURRENCY
     , (SELECT PSO_OBJ_CD
          FROM PSO_OBJ_LIST
         WHERE OBJ_LIST_NO = T22.OBJ_LIST_NO ) OBJECT
     , T22.OBJ_LIST_NO AS OBJECT_CODE
     , T22.OBJ_LIST_NO AS UOM
     , PSO_TRF_TP_CD AS RATE_CODE
     , T23.FM_VAL RANGE_FROM
     , T23.TO_VAL RANGE_TO
     , T23.TRF_RT_AMT RATE_VALUE
     , T23.COND_NO AS CONDITION
     , T21.FOML_NO AS FORMULA_NO
     , T22.PSO_TRF_TP_CD
     , T23.PORT_TRF_NO
     , T23.TRF_SEQ
     , T21.COND_ALS_NM
  FROM (SELECT T1.CURR_CD
             , T2.PSO_CHG_TP_CD
             , T3.CHG_XPR_NO
             , T3.CHG_XPR_SEQ
             , T3.FOML_NO
             , T4.ROW_NO AS ROW_NO
             , MAX(DECODE(FOML_SEQ, 1, OBJ_LIST_NO)) AS OBJ_CD
             , MAX(DECODE(FOML_SEQ, 2, PSO_FOML_OPR_CD)) AS OPR
             , MAX(DECODE(FOML_SEQ, 3, OBJ_LIST_NO)) AS RATE
             , T3.COND_ALS_NM
          FROM PSO_YD_CHG T1
             , PSO_YD_CHG_XPR T2
             , PSO_CHG_XPR_DTL T3
             , PSO_FOML_DTL T4
             , (SELECT T2.ACCT_CD
                     , T2.LGS_COST_CD
                     , LGS_COST_FULL_NM
                  FROM PSO_INV_OFC_COST T1
                     , TES_LGS_COST T2
                 WHERE T1.LGS_COST_CD = T2.LGS_COST_CD
                   AND T1.OFC_CD = @[OFC_CD]
                   AND T2.ACCT_CD <> '999999'
                   AND LENGTH(T2.LGS_COST_CD) > 4
                 ORDER BY 1 
               ) T5
         WHERE T1.YD_CHG_NO = T2.YD_CHG_NO
           AND T1.YD_CHG_VER_SEQ = T2.YD_CHG_VER_SEQ
           AND T1.LGS_COST_CD = T5.LGS_COST_CD
            --AND     T1.LST_FLG          = 'Y'
           
#if( ${port_cd} == '' )
           AND T1.YD_CD = @[combo1] 
#else
           AND T1.YD_CD = @[port_cd] || @[combo1] 
#end
           
           AND T1.VNDR_SEQ = @[vndr_seq] 
           
#if( ${acct_cd} == '')
           AND T1.LGS_COST_CD = @[combo3] 
#else
           AND T5.ACCT_CD = @[acct_cd] 
#end
           
           AND T1.YD_CHG_VER_SEQ = @[combo4]
           AND T2.CHG_XPR_NO = T3.CHG_XPR_NO
           AND T3.FOML_NO = T4.FOML_NO
         GROUP BY T1.CURR_CD
             , T2.PSO_CHG_TP_CD
             , T3.CHG_XPR_NO
             , T3.CHG_XPR_SEQ
             , COND_NO
             , T3.FOML_NO
             , T4.ROW_NO
             , T3.COND_ALS_NM
       ) T21
     , PSO_TARIFF T22
     , PSO_TRF_DTL T23
 WHERE T21.CHG_XPR_NO = T22.CHG_XPR_NO
   AND T21.CHG_XPR_SEQ = T22.CHG_XPR_SEQ
   AND T22.PORT_TRF_NO = T23.PORT_TRF_NO
 ORDER BY PORT_TRF_NO, TRF_SEQ			]]></sql>
			<params>
				<param name="OFC_CD" type="12" value="" out="N"/>
				<param name="combo1" type="12" value="" out="N"/>
				<param name="port_cd" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
				<param name="combo3" type="12" value="" out="N"/>
				<param name="acct_cd" type="12" value="" out="N"/>
				<param name="combo4" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
