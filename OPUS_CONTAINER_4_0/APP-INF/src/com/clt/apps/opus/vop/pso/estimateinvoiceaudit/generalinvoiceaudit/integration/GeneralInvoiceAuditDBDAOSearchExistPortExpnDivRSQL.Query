<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralInvoiceAuditDBDAOSearchExistPortExpnDivRSQL">
			<desc><![CDATA[Exist Port Expn Div Data Search]]></desc>
			<sql><![CDATA[
SELECT CASE WHEN COUNT(1) > 0 THEN 'Y'
            ELSE 'N'
       END AS EXIST_YN
  FROM PSO_PORT_EXPN_DIV D
     , (SELECT DISTINCT B.VSL_CD
             , B.SKD_VOY_NO
             , B.SKD_DIR_CD
             , A.TURN_PORT_FLG TURN
             , A.SLAN_CD
             , A.VPS_PORT_CD
          FROM VSK_VSL_SKD B
             , VSK_VSL_PORT_SKD A
         WHERE 1=1 
           AND B.VSL_CD         = @[vsl_cd]
           AND B.SKD_VOY_NO     = @[skd_voy_no]
           AND B.SKD_DIR_CD     = @[skd_dir_cd]
           AND B.VSL_CD         = A.VSL_CD
           AND B.SKD_VOY_NO     = A.SKD_VOY_NO
           AND B.SKD_DIR_CD     = A.SKD_DIR_CD
           AND A.YD_CD          = @[yd_cd]
           AND NVL(A.SKD_CNG_STS_CD, 'X') <> 'S'
           AND NVL(A.VT_ADD_CALL_FLG, 'N') = 'N' /*2015.07.21 Add*/ 
           AND A.TURN_PORT_IND_CD IN ('N', 'Y')
           AND A.CLPT_IND_SEQ = NVL(@[clpt_ind_seq],(SELECT MIN(P.CLPT_IND_SEQ) 
                                                       FROM VSK_VSL_PORT_SKD P 
                                                      WHERE 1=1
                                                        AND P.VSL_CD        = @[vsl_cd]
                                                        AND P.SKD_VOY_NO    = @[skd_voy_no]
                                                        AND P.SKD_DIR_CD    = @[skd_dir_cd]
                                                        AND P.YD_CD         = @[yd_cd]
                                                        AND NVL(P.SKD_CNG_STS_CD, ' ') != 'S'
                                                        AND NVL(P.VT_ADD_CALL_FLG, 'N') = 'N' /*2015.07.21 Add*/ 
                                                        AND P.TURN_PORT_IND_CD IN ('N', 'Y')
                                                     )) 
       ) V
 WHERE 1 = 1
   AND V.SLAN_CD        = D.SLAN_CD
   AND V.SKD_DIR_CD     = D.SKD_DIR_CD
   AND V.VPS_PORT_CD    = D.LOC_CD			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="clpt_ind_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
