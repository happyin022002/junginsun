<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RegionDepartureReportDBDAORDRAddSlotVORSQL">
			<desc><![CDATA[RDRAddSlotVO Select Query]]></desc>
			<sql><![CDATA[
SELECT	POL, POD
#foreach($key IN ${opr_cd}) 
	#if($velocityCount < 10)
		, SUM(CASE WHEN	OPR_CD	= '$key' THEN QTY ELSE null END) AS opr_qty_0$velocityCount
	#else
		, SUM(CASE WHEN	OPR_CD	= '$key' THEN QTY ELSE null END) AS opr_qty_$velocityCount
	#end
#end 
		, SUM(QTY) AS total
FROM(
	SELECT M.POL, M.POD, M.OPR_CD, SUM(SLOT) QTY, 1 ROW_NUM                                      
	FROM   RDR_HEADER H, RDR_CNTR_DETAIL M
	WHERE  H.VSL_CD  = @[vsl_cd] 
	AND    H.VOY_NO  = @[voy_no] 
	AND    H.DIR_CD  = @[dir_cd]
	AND    H.REGION  = @[region]

#if (${opt_opr_cd} != '' && ${opt_opr_cd} != 'All')
AND    M.OPR_CD    = @[opt_opr_cd] 
#end

#if (${port_cd} != '') 
	AND    H.PORT_CD  = @[port_cd] 
#end
	AND    H.VSL_CD  = M.VSL_CD                                                                      
	AND    H.VOY_NO  = M.VOY_NO                                                                      
	AND    H.DIR_CD  = M.DIR_CD                                                                      
	AND    H.REGION  = M.REGION                                                                      
	AND    M.CARGO_TYPE IN ('AK','BB')                                                               
	GROUP BY M.POL, M.POD, M.OPR_CD
)
GROUP BY POL, POD
ORDER BY POL, POD			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="voy_no" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
				<param name="region" type="12" value="" out="N"/>
				<param name="opt_opr_cd" type="12" value="" out="N"/>
				<param name="port_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
