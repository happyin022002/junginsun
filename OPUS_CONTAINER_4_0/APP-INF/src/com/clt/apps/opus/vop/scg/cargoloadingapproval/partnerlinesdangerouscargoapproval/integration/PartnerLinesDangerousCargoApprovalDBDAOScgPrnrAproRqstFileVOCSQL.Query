<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PartnerLinesDangerousCargoApprovalDBDAOScgPrnrAproRqstFileVOCSQL">
			<desc><![CDATA[SPCL CGO APVL for Partner Lines 의 Request File 생성]]></desc>
			<sql><![CDATA[
MERGE INTO	SCG_PRNR_APRO_RQST_FILE XX
USING		(
			SELECT		COM_ConstantMgr_PKG.COM_getCompanyCode_FNC()	AS CRR_CD
                  	,  	@[bkg_ref_no]                       			AS BKG_REF_NO
                  	,  	@[spcl_cgo_rqst_seq]                			AS SPCL_CGO_RQST_SEQ
                  	,  	@[prnr_cgo_rqst_seq]                			AS PRNR_CGO_RQST_SEQ
                  	,  	@[spcl_cgo_rqst_atch_file_seq]      			AS SPCL_CGO_RQST_ATCH_FILE_SEQ
                  	
       		 FROM    	DUAL			
			) YY
ON       	(
      		XX.CRR_CD        				= YY.CRR_CD              
		AND	XX.BKG_REF_NO					= YY.BKG_REF_NO		    
		AND	XX.SPCL_CGO_RQST_SEQ			= YY.SPCL_CGO_RQST_SEQ   		    
		AND	XX.PRNR_CGO_RQST_SEQ    		= YY.PRNR_CGO_RQST_SEQ  
		AND	XX.SPCL_CGO_RQST_ATCH_FILE_SEQ 	= YY.SPCL_CGO_RQST_ATCH_FILE_SEQ
			)			
			
WHEN MATCHED THEN
UPDATE
SET		XX.FILE_NM							= @[file_nm]          
	,	XX.FILE_SAV_ID             			= @[file_sav_id]                  
	,	XX.UPD_USR_ID              			= @[upd_usr_id]       
	,	XX.UPD_DT                  			= SYSDATE             
	
WHEN NOT MATCHED THEN
INSERT 
	(	CRR_CD
	,	BKG_REF_NO
	,	SPCL_CGO_RQST_SEQ
	,	SPCL_CGO_RQST_ATCH_FILE_SEQ
	,	FILE_NM
	,	FILE_SAV_ID
	,	CRE_USR_ID
	,	CRE_DT
	,	UPD_USR_ID
	,	UPD_DT
	,	PRNR_CGO_RQST_SEQ
	) 
VALUES
	( 
		COM_ConstantMgr_PKG.COM_getCompanyCode_FNC()
	,	@[bkg_ref_no]
	,	@[spcl_cgo_rqst_seq]
	,	(	SELECT NVL(MAX(SPCL_CGO_RQST_ATCH_FILE_SEQ),0) + 1 
       		FROM SCG_PRNR_APRO_RQST_FILE
      		WHERE CRR_CD            	= COM_ConstantMgr_PKG.COM_getCompanyCode_FNC()
        	AND BKG_REF_NO        		= @[bkg_ref_no]
        	AND SPCL_CGO_RQST_SEQ 		= @[spcl_cgo_rqst_seq]
			AND PRNR_CGO_RQST_SEQ 		= @[prnr_cgo_rqst_seq]	
		)
	,	@[file_nm]
	,	@[file_sav_id]
	,	@[cre_usr_id]
	,	SYSDATE
	,	@[upd_usr_id]
	,	SYSDATE
	,	@[prnr_cgo_rqst_seq]
	)
						]]></sql>
			<params>
				<param name="bkg_ref_no" type="12" value="" out="N"/>
				<param name="spcl_cgo_rqst_seq" type="2" value="" out="N"/>
				<param name="prnr_cgo_rqst_seq" type="12" value="" out="N"/>
				<param name="spcl_cgo_rqst_atch_file_seq" type="12" value="" out="N"/>
				<param name="file_nm" type="12" value="" out="N"/>
				<param name="file_sav_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
