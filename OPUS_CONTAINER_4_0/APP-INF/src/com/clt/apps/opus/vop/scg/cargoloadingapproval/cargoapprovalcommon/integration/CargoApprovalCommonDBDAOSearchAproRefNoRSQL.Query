<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CargoApprovalCommonDBDAOSearchAproRefNoRSQL">
			<desc><![CDATA[Own/Partner Booking 의 Approval Reference Number 생성]]></desc>
			<sql><![CDATA[
-- 2016-04-12 SQL 튜닝
SELECT  COM_CONSTANTMGR_PKG.COM_GETCOMPANYCODE_FNC()
||'${pol_cd}'||TO_CHAR(SYSDATE, 'YYMMDD')
||DECODE(NVL(LENGTH(MAX(SUBSTR(APRO_REF_NO,15,17))+1),0),
          0, '001',
          1, '00'||TO_CHAR(MAX(SUBSTR(APRO_REF_NO,15,17))+1),
          2, '0'||TO_CHAR(MAX(SUBSTR(APRO_REF_NO,15,17))+1),
          3, TO_CHAR(MAX(SUBSTR(APRO_REF_NO,15,17))+1) 
        )  AS APRO_REF_NO 
       -- ,MAX(APRO_REF_NO)
        --,COUNT(*) CNT
FROM
(SELECT   
--/*+ INDEX_DESC(PRNR XAK1SCG_PRNR_APRO_RQST_CGO) */
          PRNR.APRO_REF_NO AS APRO_REF_NO  
  FROM    SCG_PRNR_APRO_RQST_CGO PRNR 
 WHERE    1=1
 AND      PRNR.APRO_REF_NO LIKE COM_ConstantMgr_PKG.COM_getCompanyCode_FNC()||'${pol_cd}'||TO_CHAR(SYSDATE, 'yymmdd')||'%'
 --AND    ROWNUM <=1 
 UNION ALL
 SELECT   
--/*+ INDEX_DESC(OWN XAK1SCG_AUTHORIZATION) */
          OWN.APRO_REF_NO  AS APRO_REF_NO
 FROM     SCG_AUTHORIZATION OWN
 WHERE    OWN.APRO_REF_NO LIKE COM_ConstantMgr_PKG.COM_getCompanyCode_FNC()||'${pol_cd}'||TO_CHAR(SYSDATE, 'yymmdd')||'%'
 --AND    ROWNUM <= 1
 ) APRO			]]></sql>
			<params>
			</params>
		</query>
	</querys>
</sqls>
