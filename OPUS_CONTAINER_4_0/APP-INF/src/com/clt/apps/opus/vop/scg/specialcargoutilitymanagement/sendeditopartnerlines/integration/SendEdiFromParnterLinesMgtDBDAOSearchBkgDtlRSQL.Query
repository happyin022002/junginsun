<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SendEdiFromParnterLinesMgtDBDAOSearchBkgDtlRSQL">
			<desc><![CDATA[flatFile  detail정보 조회 ]]></desc>
			<sql><![CDATA[
SELECT	  X.BKG_NO
		, X.DCGO_SEQ
		, X.DG_CNTR_SEQ
		, X.CNTR_CGO_SEQ

		, X.CNTR_NO

		--------------------------------------------------------------------------------
    	, 	(
      		SELECT   	MAX(LL.CNTR_DMY_REF_NO)
      		FROM     	SCG_APRO_RQST                  XX
            		,  	SCG_VVD_APRO_RQST              YY
            		,  	SCG_PRNR_SPCL_CGO_DTL_LOG      LL
      		WHERE    	1 = 1
      		AND      	XX.BKG_NO                      = YY.BKG_NO
      		AND      	XX.SPCL_CGO_APRO_RQST_SEQ      = YY.SPCL_CGO_APRO_RQST_SEQ
      		AND      	YY.MAPG_TRSM_BND_CD            = LL.TRSM_BND_CD            --(+)
      		AND      	YY.MAPG_TRSM_DT                = LL.TRSM_DT                --(+)
      		AND      	YY.MAPG_TRSM_SPCL_CGO_CATE_CD  = LL.SPCL_CGO_CATE_CD       --(+)  FIXED 'DG'
      		AND      	YY.MAPG_PRNR_SPCL_CGO_SEQ      = LL.PRNR_SPCL_CGO_SEQ      --(+)
      		AND      	YY.MAPG_EDI_TRSM_STS_CD        = 'S'       
      		AND      	LL.PRNR_SPCL_CGO_SEQ           = (	SELECT   MAX(L.PRNR_SPCL_CGO_SEQ)
                                                 			FROM     SCG_PRNR_SPCL_CGO_DTL_LOG L
                                                 			WHERE    L.TRSM_BND_CD             = LL.TRSM_BND_CD
                                                 			AND      L.TRSM_DT                 = LL.TRSM_DT
                                                 			AND      L.SPCL_CGO_CATE_CD        = LL.SPCL_CGO_CATE_CD
                                                 		 )                
      		AND      	LL.DCGO_SEQ                    = X.DCGO_SEQ            

      		AND      	XX.BKG_NO                      = X.BKG_NO

      		----AND      	YY.VSL_PRE_PST_CD          = [vsl_pre_pst_cd]
      		----AND      	YY.VSL_SEQ                 = [vsl_seq]    
      		) 			AS CNTR_DMY_REF_NO
		--------------------------------------------------------------------------------

		, X.CNTR_VOL_QTY
		, X.CNTR_TPSZ_CD
		, (	SELECT CNTR_TPSZ_ISO_CD 
	     	FROM MDM_CNTR_TP_SZ A
	    	WHERE A.CNTR_TPSZ_CD = X.CNTR_TPSZ_CD
	      	AND A.DELT_FLG = 'N'
	  		)
    
  		, 	CASE 	WHEN X.CFR_FLG IS NULL THEN NULL
         			WHEN X.IMDG_AMDT_NO IS NOT NULL THEN X.IMDG_AMDT_NO
         			ELSE (	SELECT  MAX(UN.IMDG_AMDT_NO)
               				FROM    SCG_IMDG_UN_NO    UN
               				WHERE   UN.IMDG_UN_NO     = X.IMDG_UN_NO
               				AND     UN.IMDG_UN_NO_SEQ = X.IMDG_UN_NO_SEQ)
    		END  IMDG_AMDT_NO
    
		, X.IMDG_UN_NO
		, X.IMDG_UN_NO_SEQ
		, X.IMDG_CLSS_CD
		, X.IMDG_COMP_GRP_CD
		, X.IMDG_SUBS_RSK_LBL_CD1
		, X.IMDG_SUBS_RSK_LBL_CD2
		, X.IMDG_SUBS_RSK_LBL_CD3
		, X.IMDG_SUBS_RSK_LBL_CD4

		--, X.IMDG_SUBS_RSK_LBL_CD5
		--, X.IMDG_SUBS_RSK_LBL_CD6
		--, X.IMDG_SUBS_RSK_LBL_CD7
		--, X.IMDG_SUBS_RSK_LBL_CD8

		, X.IMDG_LMT_QTY_FLG
		, X.IMDG_EXPT_QTY_FLG
		, X.NET_WGT
		, X.GRS_WGT
		, DECODE(NVL(X.WGT_UT_CD, 'KGS'),'KGS','KGM') WGT_UT_CD 
		, X.FLSH_PNT_CDO_TEMP
		, X.PRP_SHP_NM
		, X.HZD_DESC
		, X.MEAS_QTY
		, X.MEAS_UT_CD
		, X.CLOD_FLG
		, X.SPCL_STWG_RQST_DESC
		, X.DCGO_STS_CD
		, X.CGO_LCL_FLG
		, X.EMER_RSPN_GID_NO
		, X.EMER_RSPN_GID_CHR_NO
		, X.EMER_CNTC_PHN_NO_CTNT
		, X.EMER_CNTC_PSON_NM
		, X.EMER_TEMP_CTNT
		, X.CTRL_TEMP_CTNT

		--:2016-05-03:--, X.EMS_NO
		, REPLACE(REPLACE(X.EMS_NO,'-',''),',','/')		AS EMS_NO
		, X.IMDG_PCK_GRP_CD
		, X.MRN_POLUT_FLG
		, X.PSA_NO
		, X.CERTI_NO
		, X.IN_IMDG_PCK_QTY1
		, X.IN_IMDG_PCK_CD1
		, (	SELECT IMDG_PCK_DESC 
	     	FROM SCG_IMDG_PCK_CD
	    	WHERE IMDG_PCK_CD = X.IN_IMDG_PCK_CD1
	      	AND IMDG_PCK_TP_CD = 'I'
	      	AND DELT_FLG = 'N'
	  		) IN_IMDG_PCK_DESC1
		, IN_IMDG_PCK_QTY2
		, IN_IMDG_PCK_CD2
		, (	SELECT IMDG_PCK_DESC 
	     	FROM SCG_IMDG_PCK_CD
	    	WHERE IMDG_PCK_CD = X.IN_IMDG_PCK_CD2
	      	AND IMDG_PCK_TP_CD = 'I'
	      	AND DELT_FLG = 'N'
	  		) IN_IMDG_PCK_DESC2
		, INTMD_IMDG_PCK_QTY1
		, INTMD_IMDG_PCK_CD1
		, (	SELECT IMDG_PCK_DESC 
	     	FROM SCG_IMDG_PCK_CD
	    	WHERE IMDG_PCK_CD = X.INTMD_IMDG_PCK_CD1
	      	AND IMDG_PCK_TP_CD = 'M'
	      	AND DELT_FLG = 'N'
	  		) INTMD_IMDG_PCK_DESC1
		, INTMD_IMDG_PCK_QTY2
		, INTMD_IMDG_PCK_CD2
		, (	SELECT IMDG_PCK_DESC 
	     	FROM SCG_IMDG_PCK_CD
	    	WHERE IMDG_PCK_CD = INTMD_IMDG_PCK_CD2
	      	AND IMDG_PCK_TP_CD = 'M'
	      	AND DELT_FLG = 'N'
	  		) INTMD_IMDG_PCK_DESC2
		, OUT_IMDG_PCK_QTY1
		, OUT_IMDG_PCK_CD1
		, (	SELECT IMDG_PCK_DESC 
	     	FROM SCG_IMDG_PCK_CD
	    	WHERE IMDG_PCK_CD = X.OUT_IMDG_PCK_CD1
	      	AND IMDG_PCK_TP_CD = 'O'
	      	AND DELT_FLG = 'N'
	  		) OUT_IMDG_PCK_DESC1
		, OUT_IMDG_PCK_QTY2
		, OUT_IMDG_PCK_CD2
		, (	SELECT IMDG_PCK_DESC 
	     	FROM SCG_IMDG_PCK_CD
	    	WHERE IMDG_PCK_CD = X.OUT_IMDG_PCK_CD2
	      	AND IMDG_PCK_TP_CD = 'O'
	      	AND DELT_FLG = 'N'
	  		) OUT_IMDG_PCK_DESC2
		, X.MAX_IN_PCK_QTY
		, X.MAX_IN_PCK_TP_CD
		, X.CNEE_DTL_DESC
		, X.NET_EXPLO_WGT
		, X.RADA_SKD_NO
		, X.RADA_AMT
		, X.RADA_UT_CD
		, X.RC_FLG
		, X.AWK_CGO_FLG
		, X.BB_CGO_FLG
		, X.RC_SEQ
		, X.AWK_CGO_SEQ
		, X.BB_CGO_SEQ
		, X.HCDG_FLG
  		, X.HCDG_DPND_QTY_FLG
  		, X.RQST_DT
  		, X.RQST_GDT
  		, X.RQST_USR_ID
  		, X.APLY_NO
  		, X.SPCL_CGO_APRO_CD
  		, X.SPCL_RQST_FLG
  		, X.SPCL_RQST_DESC
  		, REPLACE(REPLACE(X.DIFF_RMK,CHR(13),''),CHR(10),' ') DIFF_RMK
  		, X.CRE_USR_ID
  		, X.CRE_DT
  		, X.UPD_USR_ID
  		, X.UPD_DT
  		, X.RADA_TRSP_NO
  		, X.HZD_CTNT
  		, X.STWG_TEMP_CTNT
  		, X.GRS_CAPA_QTY
  		, X.DCGO_RQST_GRP_EML1
  		, X.DCGO_RQST_GRP_EML2
  		, X.CFR_FLG
  		, X.RSD_FLG
  		, X.IMDG_SEGR_GRP_NO
		, (SELECT SG.IMDG_SEGR_GRP_NM FROM SCG_IMDG_SEGR_GRP SG WHERE SG.IMDG_SEGR_GRP_NO = X.IMDG_SEGR_GRP_NO)						AS IMDG_SEGR_GRP_NM
     	, X.DCGO_REF_NO

		--::2015-10-22::--
  		, (SELECT MAX(DECODE(ROWNUM, 1, D.IMDG_SEGR_GRP_NO, NULL)) FROM SCG_IMDG_SEGR_GRP_DTL D WHERE D.IMDG_UN_NO = X.IMDG_UN_NO) 	AS IMDG_N1ST_SEGR_GRP_NO
		, (SELECT MAX(DECODE(ROWNUM, 2, D.IMDG_SEGR_GRP_NO, NULL)) FROM SCG_IMDG_SEGR_GRP_DTL D WHERE D.IMDG_UN_NO = X.IMDG_UN_NO) 	AS IMDG_N2ND_SEGR_GRP_NO
		, (SELECT MAX(DECODE(ROWNUM, 3, D.IMDG_SEGR_GRP_NO, NULL)) FROM SCG_IMDG_SEGR_GRP_DTL D WHERE D.IMDG_UN_NO = X.IMDG_UN_NO) 	AS IMDG_N3RD_SEGR_GRP_NO
		, (SELECT MAX(DECODE(ROWNUM, 4, D.IMDG_SEGR_GRP_NO, NULL)) FROM SCG_IMDG_SEGR_GRP_DTL D WHERE D.IMDG_UN_NO = X.IMDG_UN_NO) 	AS IMDG_N4TH_SEGR_GRP_NO

      	--,	(	SELECT	MAX(T1.DG_CNTR_SEQ)
        --  		FROM    BKG_DG_CGO   		T1
        --  		WHERE	T1.BKG_NO    		= X.BKG_NO
        --  	)	AS 		TTL_CNTR_KNT

		, X.CTRL_TEMP_CTNT
FROM	  BKG_DG_CGO 						X
WHERE     1 = 1
AND       X.BKG_NO 							= @[bkg_no]
AND 	  X.SPCL_CGO_APRO_CD 				NOT IN ('C','D','N')
--AND 	  X.SPCL_CGO_APRO_CD 				IS NOT NULL

ORDER BY  X.DG_CNTR_SEQ        ASC
      ,   X.CNTR_CGO_SEQ       ASC
   
--ORDER BY  X.CNTR_TPSZ_CD
--        , X.CNTR_CGO_SEQ
--        , X.DG_CNTR_SEQ			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
