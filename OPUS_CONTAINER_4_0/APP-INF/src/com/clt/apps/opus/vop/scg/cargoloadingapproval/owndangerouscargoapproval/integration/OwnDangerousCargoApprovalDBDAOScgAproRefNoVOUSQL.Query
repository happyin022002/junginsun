<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OwnDangerousCargoApprovalDBDAOScgAproRefNoVOUSQL">
			<desc><![CDATA[SCG_AUTHORIZATION APRO_REF_NO 수정(생성)]]></desc>
			<sql><![CDATA[
UPDATE SCG_AUTHORIZATION SET 
	APRO_REF_NO = (	SELECT  DECODE(COUNT(A.BKG_NO),  (
								#if (${scg_flg} == 'DG1' || ${scg_flg} == 'DG2')
								SELECT COUNT(BKG_NO) FROM 
									BKG_DG_CGO 
								WHERE BKG_NO = A.BKG_NO 
								AND   SPCL_CGO_APRO_CD NOT IN ('C','D')
								#end
								#if (${scg_flg} == 'AWK')
								SELECT COUNT(BKG_NO) FROM 
									BKG_AWK_CGO
								WHERE BKG_NO = A.BKG_NO 
								AND   SPCL_CGO_APRO_CD NOT IN ('C','D')
								#end
								#if (${scg_flg} == 'BB')
								SELECT COUNT(BKG_NO) FROM 
									BKG_BB_CGO
								WHERE BKG_NO = A.BKG_NO 
								AND   SPCL_CGO_APRO_CD NOT IN ('C','D')
							    #end
								#if (${scg_flg} == 'RF')
								SELECT COUNT(BKG_NO) FROM 
									BKG_RF_CGO
								WHERE BKG_NO = A.BKG_NO 
								AND   SPCL_CGO_APRO_CD NOT IN ('C','D')
							    #end
								#if (${scg_flg} == 'SS')
									 COUNT (A.BKG_NO)
							    #end
 								), 
								--2016-10-26 TimeOut Exception 발생 후 수정 처리
								@[apro_ref_no]
								--2016-10-26
								, ''
		        				) AS APRO_REF_NO 
					FROM SCG_AUTHORIZATION A
					WHERE	BKG_NO = @[bkg_no]
					AND	SPCL_CGO_APRO_RQST_SEQ = @[spcl_cgo_apro_rqst_seq]
					AND	VSL_PRE_PST_CD = @[vsl_pre_pst_cd]
					AND	VSL_SEQ = @[vsl_seq]
					AND SPCL_CGO_AUTH_CD = 'Y'
					GROUP BY A.BKG_NO
					)
WHERE	BKG_NO = @[bkg_no]
AND	SPCL_CGO_APRO_RQST_SEQ = @[spcl_cgo_apro_rqst_seq]
AND	VSL_PRE_PST_CD = @[vsl_pre_pst_cd]
AND	VSL_SEQ = @[vsl_seq]			]]></sql>
			<params>
				<param name="apro_ref_no" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="spcl_cgo_apro_rqst_seq" type="2" value="" out="N"/>
				<param name="vsl_pre_pst_cd" type="12" value="" out="N"/>
				<param name="vsl_seq" type="2" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
