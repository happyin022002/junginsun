<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralInvoiceAuditDBDAOgetIBVolBszRSQL">
			<desc><![CDATA[Tariff 비용 계산을 위해 해당 I/B 의 Volume/Blocksize를 구한다.
[2015.07.21]Virtual Add Calling 처리. VSK_VSL_PORT_SKD.NVL(VT_ADD_CALL_FLG, 'N') = 'N']]></desc>
			<sql><![CDATA[
SELECT ROUND(CASE WHEN (NVL(LOA_LEN, 0) * NVL(VSL_WDT, 0) * NVL(SMR_DRFT_HGT, 0)) <=0 THEN 0 ELSE VOL / (NVL(LOA_LEN, 0) * NVL(VSL_WDT, 0) * NVL(SMR_DRFT_HGT, 0)) END, 4)
  FROM (
        SELECT A.VSL_CD, NVL(
               SUM(DECODE(S.CNTR_TYPE,'E',0,DECODE(S.STATUS,'DS',DECODE(S.CNTR_SIZE,'2',WEIGHT,0),0)))  + 
               SUM(DECODE(S.CNTR_TYPE,'E',0,DECODE(S.STATUS,'DS',DECODE(S.CNTR_SIZE,'3',WEIGHT,0),0)))  + 
               SUM(DECODE(S.CNTR_TYPE,'E',0,DECODE(S.STATUS,'DS',DECODE(S.CNTR_SIZE,'4',WEIGHT,0),0)))  + 
               SUM(DECODE(S.CNTR_TYPE,'E',0,DECODE(S.STATUS,'DS',DECODE(S.CNTR_SIZE,'H',WEIGHT,0),0)))  + 
               SUM(DECODE(S.CNTR_TYPE,'E',0,DECODE(S.STATUS,'DS',DECODE(S.CNTR_SIZE,'L',WEIGHT,0),0)))  + 
               SUM(DECODE(S.CNTR_TYPE,'E',0,DECODE(S.STATUS,'DT',DECODE(S.CNTR_SIZE,'2',WEIGHT,0),0)))  + 
               SUM(DECODE(S.CNTR_TYPE,'E',0,DECODE(S.STATUS,'DT',DECODE(S.CNTR_SIZE,'3',WEIGHT,0),0)))  + 
               SUM(DECODE(S.CNTR_TYPE,'E',0,DECODE(S.STATUS,'DT',DECODE(S.CNTR_SIZE,'4',WEIGHT,0),0)))  + 
               SUM(DECODE(S.CNTR_TYPE,'E',0,DECODE(S.STATUS,'DT',DECODE(S.CNTR_SIZE,'H',WEIGHT,0),0)))  +
               SUM(DECODE(S.CNTR_TYPE,'E',0,DECODE(S.STATUS,'DT',DECODE(S.CNTR_SIZE,'L',WEIGHT,0),0)))  +
               SUM(DECODE(S.CNTR_TYPE,'E',DECODE(S.STATUS,'DS',DECODE(S.CNTR_SIZE,'2',WEIGHT,0),0),0))  +
               SUM(DECODE(S.CNTR_TYPE,'E',DECODE(S.STATUS,'DS',DECODE(S.CNTR_SIZE,'3',WEIGHT,0),0),0))  +
               SUM(DECODE(S.CNTR_TYPE,'E',DECODE(S.STATUS,'DS',DECODE(S.CNTR_SIZE,'4',WEIGHT,0),0),0))  +
               SUM(DECODE(S.CNTR_TYPE,'E',DECODE(S.STATUS,'DS',DECODE(S.CNTR_SIZE,'H',WEIGHT,0),0),0))  +
               SUM(DECODE(S.CNTR_TYPE,'E',DECODE(S.STATUS,'DS',DECODE(S.CNTR_SIZE,'L',WEIGHT,0),0),0))  +
               SUM(DECODE(S.CNTR_TYPE,'E',DECODE(S.STATUS,'DT',DECODE(S.CNTR_SIZE,'2',WEIGHT,0),0),0))  +
               SUM(DECODE(S.CNTR_TYPE,'E',DECODE(S.STATUS,'DT',DECODE(S.CNTR_SIZE,'3',WEIGHT,0),0),0))  +
               SUM(DECODE(S.CNTR_TYPE,'E',DECODE(S.STATUS,'DT',DECODE(S.CNTR_SIZE,'4',WEIGHT,0),0),0))  +
               SUM(DECODE(S.CNTR_TYPE,'E',DECODE(S.STATUS,'DT',DECODE(S.CNTR_SIZE,'H',WEIGHT,0),0),0))  +
               SUM(DECODE(S.CNTR_TYPE,'E',DECODE(S.STATUS,'DT',DECODE(S.CNTR_SIZE,'L',WEIGHT,0),0),0)) 
               , 0 ) VOL 
         FROM VSK_VSL_PORT_SKD A
            , TDR_HEADER H
            , TDR_SUMMARY S
        WHERE 1=1
          AND A.VSL_CD         = SUBSTR(@[vvd], 1, 4)
          AND A.SKD_VOY_NO     = SUBSTR(@[vvd], 5, 4)
          AND A.SKD_DIR_CD     = SUBSTR(@[vvd], 9)
          AND A.VPS_PORT_CD    = SUBSTR(@[yd_cd], 1, 5)
          AND A.YD_CD          = @[yd_cd] /*2016.04.06 Add*/
          AND A.CLPT_IND_SEQ   = @[clpt_ind_seq] /*2016.04.06 Add*/
          AND NVL(A.VT_ADD_CALL_FLG, 'N') = 'N' /*2015.07.21 Add*/ 
          AND A.VSL_CD       = H.VSL_CD
          AND A.SKD_VOY_NO   = H.VOY_NO
          AND A.SKD_DIR_CD   = H.DIR_CD
          AND A.VPS_PORT_CD  = H.PORT_CD
          AND A.CLPT_IND_SEQ = H.CALL_IND
          AND H.VSL_CD       = S.VSL_CD
          AND H.VOY_NO       = S.VOY_NO
          AND H.DIR_CD       = S.DIR_CD
          AND H.PORT_CD      = S.PORT_CD
          AND H.CALL_IND     = S.CALL_IND
          AND S.STATUS       IN ('DS','DT')
        GROUP BY A.VSL_CD
      ) A
    , MDM_VSL_CNTR M
WHERE A.VSL_CD = M.VSL_CD   			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="clpt_ind_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
