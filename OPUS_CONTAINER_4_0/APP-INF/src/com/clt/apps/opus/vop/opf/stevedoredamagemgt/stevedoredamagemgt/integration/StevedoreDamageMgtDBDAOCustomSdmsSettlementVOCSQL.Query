<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="StevedoreDamageMgtDBDAOCustomSdmsSettlementVOCSQL">
			<desc><![CDATA[CustomSdmsSettlementVO Insert Query
[20140821]Merge 쿼리로 변경함.]]></desc>
			<sql><![CDATA[
MERGE INTO OPF_STV_DMG_STL A
USING DUAL ON (A.STV_DMG_NO = @[stv_dmg_no])
WHEN MATCHED
THEN UPDATE SET 
 A.STV_DMG_STL_PROC_STS_CD = @[stv_dmg_stl_proc_sts_cd]
,A.SHP_OWNR_CO_NM          = @[shp_ownr_co_nm]
,A.BIL_INV_NO              = @[bil_inv_no]
,A.PAY_DT                  = TO_DATE(@[pay_dt],'YYYY-MM-DD')
,A.PAY_CURR_CD             = @[pay_curr_cd]
,A.PAY_LOCL_AMT            = @[pay_locl_amt]
,A.PAY_USD_AMT             = (SELECT ROUND(@[pay_locl_amt]/USD_LOCL_XCH_RT,2)
                                FROM GL_MON_XCH_RT
                               WHERE ACCT_XCH_RT_LVL   = 1
                                 AND CURR_CD           = @[pay_curr_cd]
                                 AND ACCT_XCH_RT_YRMON = TO_CHAR(SYSDATE,'YYYYMM'))
,A.PAY_ACCT_NO             = @[pay_acct_no]
,A.STL_RMK                 = @[stv_dmg_rmk]
,A.UPD_USR_ID              = @[cre_usr_id]
,A.UPD_DT = SYSDATE
WHERE A.STV_DMG_NO         = @[stv_dmg_no]
WHEN NOT MATCHED
THEN INSERT (
 A.STV_DMG_NO
,A.STV_DMG_STL_PROC_STS_CD
,A.SHP_OWNR_CO_NM
,A.BIL_INV_NO
,A.PAY_DT
,A.PAY_CURR_CD
,A.PAY_LOCL_AMT
,A.PAY_USD_AMT
,A.PAY_ACCT_NO
,A.STL_RMK
,A.CRE_USR_ID
,A.CRE_DT
,A.UPD_USR_ID
,A.UPD_DT)
VALUES (
 @[stv_dmg_no]
,@[stv_dmg_stl_proc_sts_cd]
,@[shp_ownr_co_nm]
,@[bil_inv_no]
,TO_DATE(@[pay_dt],'YYYY-MM-DD')
,@[pay_curr_cd]
,@[pay_locl_amt]
,(SELECT ROUND(@[pay_locl_amt]/USD_LOCL_XCH_RT,2)
    FROM GL_MON_XCH_RT
   WHERE ACCT_XCH_RT_LVL   = 1
     AND CURR_CD           = @[pay_curr_cd]
     AND ACCT_XCH_RT_YRMON = TO_CHAR(SYSDATE,'YYYYMM'))
,@[pay_acct_no]
,@[stv_dmg_rmk]
,@[cre_usr_id]
,SYSDATE
,@[cre_usr_id]
,SYSDATE
)			]]></sql>
			<params>
				<param name="stv_dmg_no" type="12" value="" out="N"/>
				<param name="stv_dmg_stl_proc_sts_cd" type="12" value="" out="N"/>
				<param name="shp_ownr_co_nm" type="12" value="" out="N"/>
				<param name="bil_inv_no" type="12" value="" out="N"/>
				<param name="pay_dt" type="12" value="" out="N"/>
				<param name="pay_curr_cd" type="12" value="" out="N"/>
				<param name="pay_locl_amt" type="12" value="" out="N"/>
				<param name="pay_acct_no" type="12" value="" out="N"/>
				<param name="stv_dmg_rmk" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
