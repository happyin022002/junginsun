<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralInvoiceAuditDBDAOSearchProviderBySimulationRSQL">
			<desc><![CDATA[Tariff에 해당하는 Vendors 조회]]></desc>
			<sql><![CDATA[
/**** Tariff에 해당하는 Vendors 조회 ****/
SELECT Y.VNDR_SEQ
     , Y.VNDR_LGL_ENG_NM
  FROM (SELECT DISTINCT VNDR_SEQ
          FROM (SELECT C.YD_CD
                     , C.LGS_COST_CD
                     , C.VNDR_SEQ
                     , C.CPLS_FLG
                     , COUNT( * ) OVER (PARTITION BY C.YD_CD, C.LGS_COST_CD
                         ORDER BY C.YD_CD, C.LGS_COST_CD) AS CNT
                  FROM PSO_YD_CHG C
                 WHERE C.YD_CD LIKE @[port_cd] || @[yard_cd] /*'BRNVTM1'*/
       			#if(${issue_date} != '')
                   AND TO_DATE(REPLACE(@[issue_date], '-', ''), 'YYYYMMDD') BETWEEN C.EFF_DT AND C.EXP_DT
       			#end
                   AND C.LST_FLG = 'Y'
                 GROUP BY C.YD_CD
                     , C.LGS_COST_CD
                     , C.VNDR_SEQ
                     , C.CPLS_FLG )
         WHERE 1=1
           AND LGS_COST_CD IN ( 
#if(${cost_cd} != '')
       #foreach($key IN ${cost_cd}) 
         #if($velocityCount < $cost_cd.size()) 
          '$key', 
         #else 
          '$key' 
         #end 
       #end 
#else
	''
#end
                     )
#if( ${cpls_flg} != '' && ${cpls_flg} == 'Y' )
           --Compulsory flag Y 일대 아래 조건 활성.
           AND (CASE WHEN CNT >= 2 THEN 'Y' ELSE CPLS_FLG END) = CPLS_FLG 
#end
       ) X
     , MDM_VENDOR Y
 WHERE X.VNDR_SEQ = Y.VNDR_SEQ
 ORDER BY Y.VNDR_SEQ			]]></sql>
			<params>
				<param name="port_cd" type="12" value="" out="N"/>
				<param name="yard_cd" type="12" value="" out="N"/>
				<param name="issue_date" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
