<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CarrierRestrictionDBDAOPortRestrictionOptionRSQL">
			<desc><![CDATA[DESC Enter..]]></desc>
			<sql><![CDATA[
SELECT DECODE(P.PORT_ROTN_SEQ, PT.POL_SEQ, 'POL', 
                         	   PT.POD_SEQ, 'POD', 
                                           'Pass') AS PORT_TYPE
     , P.PORT_CD 
     , DECODE(DECODE(R.PORT_CD, PT.POL_CD, DECODE(R.PROHI_LOD_FLG, 'Y','Prohibition',DECODE(LD.IMDG_CMPTN_AUTH_CD,'P','Permit','D','Declare','N','No Need')),
                                PT.POD_CD, DECODE(R.PROHI_DCHG_FLG,'Y','Prohibition',DECODE(DD.IMDG_CMPTN_AUTH_CD,'P','Permit','D','Declare','N','No Need')),
                                           DECODE(R.PROHI_PASS_FLG,'Y','Prohibition',DECODE(PD.IMDG_CMPTN_AUTH_CD,'P','Permit','D','Declare','N','No Need'))),NULL,
              DECODE(C.PORT_CD, PT.POL_CD, DECODE(C.PROHI_LOD_FLG, 'Y','Prohibition',DECODE(LC.IMDG_CMPTN_AUTH_CD,'P','Permit','D','Declare','N','No Need')),
                                PT.POD_CD, DECODE(C.PROHI_DCHG_FLG,'Y','Prohibition',DECODE(DC.IMDG_CMPTN_AUTH_CD,'P','Permit','D','Declare','N','No Need')),
                                           DECODE(C.PROHI_PASS_FLG,'Y','Prohibition',DECODE(PC.IMDG_CMPTN_AUTH_CD,'P','Permit','D','Declare','N','No Need'))),
              DECODE(P.PORT_ROTN_SEQ, PT.POL_SEQ, DECODE(R.PROHI_LOD_FLG, 'Y','Prohibition',DECODE(LD.IMDG_CMPTN_AUTH_CD,'P','Permit','D','Declare','N','No Need')),
                                	  PT.POD_SEQ, DECODE(R.PROHI_DCHG_FLG,'Y','Prohibition',DECODE(DD.IMDG_CMPTN_AUTH_CD,'P','Permit','D','Declare','N','No Need')),
                                           DECODE(R.PROHI_PASS_FLG,'Y','Prohibition',DECODE(PD.IMDG_CMPTN_AUTH_CD,'P','Permit','D','Declare','N','No Need')))) AS IMDG_CMPTN_AUTH_CD
     , DECODE(P.PORT_ROTN_SEQ, PT.POL_SEQ, DECODE(R.PROHI_LOD_FLG,NULL,LC.TXT_DESC,LD.TXT_DESC), 
                         	   PT.POD_SEQ, DECODE(R.PROHI_DCHG_FLG,NULL,DC.TXT_DESC,DD.TXT_DESC),
                                    DECODE(R.PROHI_PASS_FLG,NULL,PC.TXT_DESC,PD.TXT_DESC)) AS TXT_DESC
     , '' POL_VPS_PORT_CD
     , '' POD_VPS_PORT_CD
     , '' IMDG_CLSS_CD
     , '' IMDG_UN_NO
     , '' IMDG_UN_NO_SEQ
     , '' SLAN_CD
     , '' POL_PORT_CD
     , '' POD_PORT_CD
  FROM VSK_PF_CALL_PORT P
     , (
        SELECT POL.DIR 
             , POL.DIR_SEQ
             , POL.POL_CD
             , POL.POL_SEQ
             , POD.POD_CD
             , POD.POD_SEQ
             , POL.SLAN_CD
             , POL.TP_CD
          FROM VSK_PF_SKD H,
               (
                SELECT B.SKD_DIR_CD       DIR
                     , D.VSL_SLAN_DIR_SEQ DIR_SEQ
                     , A.PORT_ROTN_SEQ    POL_SEQ
                     , B.PORT_CD          POL_CD
                     , A.VSL_SLAN_CD      SLAN_CD
                     , A.PF_SVC_TP_CD     TP_CD
					 , A.CLPT_SEQ
                   FROM VSK_PF_CALL_PORT     A
                      , VSK_PF_SKD_DTL       B
                      , MDM_VSL_SVC_LANE_DIR D
                  WHERE A.VSL_SLAN_CD   = B.VSL_SLAN_CD(+)
                    AND A.PF_SVC_TP_CD  = B.PF_SVC_TP_CD(+)
                    AND A.SKD_DIR_CD    = B.SKD_DIR_CD(+)
                    AND A.PORT_CD       = B.PORT_CD(+)
                    AND B.VSL_SLAN_CD   = D.VSL_SLAN_CD
                    AND B.SKD_DIR_CD    = D.VSL_SLAN_DIR_CD
                    AND B.TURN_PORT_IND_CD <> 'F'
                  ORDER BY D.VSL_SLAN_DIR_SEQ
                         , B.PORT_ROTN_SEQ
               ) POL, 
               (
                SELECT A.SKD_DIR_CD       DIR
                     , D.VSL_SLAN_DIR_SEQ DIR_SEQ
                     , A.PORT_ROTN_SEQ    POD_SEQ
                     , A.PORT_CD          POD_CD
                     , A.VSL_SLAN_CD      SLAN_CD
                     , A.PF_SVC_TP_CD     TP_CD
					 , A.CLPT_SEQ
                  FROM VSK_PF_CALL_PORT     A
                     , MDM_VSL_SVC_LANE_DIR D
                 WHERE A.VSL_SLAN_CD  = D.VSL_SLAN_CD
                   AND A.SKD_DIR_CD   = D.VSL_SLAN_DIR_CD
                   AND PORT_ROTN_SEQ <> 1
                 ORDER BY D.VSL_SLAN_DIR_SEQ
                        , A.PORT_ROTN_SEQ
               ) POD 
         WHERE H.SLAN_STND_FLG = 'Y'  
           AND H.VSL_SLAN_CD   = POL.SLAN_CD
           AND H.PF_SVC_TP_CD  = POL.TP_CD
		   AND POL.SLAN_CD     = POD.SLAN_CD
           AND POL.DIR         = POD.DIR 
           AND POL.DIR_SEQ     = POD.DIR_SEQ
           AND POL.TP_CD       = POD.TP_CD
           AND POL.POL_SEQ     < POD.POD_SEQ
           AND POL.SLAN_CD     = @[slan_cd]       --:lane_cd
           AND POL.POL_CD      = @[pol_port_cd]   --:pol_cd
           AND POD.POD_CD      = @[pod_port_cd]   --:pod_cd
	  #if (${pol_port_rotn_seq} != '') 
		   AND POL.CLPT_SEQ    =  @[pol_port_rotn_seq]	--:pol_clpt_cd
	  #end
	  #if (${pod_port_rotn_seq} != '') 
		   AND POD.CLPT_SEQ    =  @[pod_port_rotn_seq]  --:pod_clpt_cd
	  #end
           AND ROWNUM          = 1
         ORDER BY POL.DIR_SEQ
                , POL.POL_SEQ
                , POD.POD_SEQ
       ) PT
     , SCG_IMDG_PORT_RSTR R, SCG_IMDG_PORT_RSTR_DTL LD, SCG_IMDG_PORT_RSTR_DTL DD, SCG_IMDG_PORT_RSTR_DTL PD
     , SCG_IMDG_PORT_RSTR C, SCG_IMDG_PORT_RSTR_DTL LC, SCG_IMDG_PORT_RSTR_DTL DC, SCG_IMDG_PORT_RSTR_DTL PC
 WHERE P.VSL_SLAN_CD          = PT.SLAN_CD
   AND P.PF_SVC_TP_CD         = PT.TP_CD
   AND P.SKD_DIR_CD           = PT.DIR
   AND P.PORT_ROTN_SEQ       >= PT.POL_SEQ
   AND P.PORT_ROTN_SEQ       <= PT.POD_SEQ
   AND P.PORT_CD              = R.PORT_CD(+) 
   AND R.IMDG_CLSS_CD(+)      = @[imdg_clss_cd]                      --:class_cd 
   AND R.IMDG_UN_NO(+)        = @[imdg_un_no]                        --:un_no 
   AND R.IMDG_UN_NO_SEQ(+)    = @[imdg_un_no_seq]                    --:un_no_seq
   AND P.PORT_CD              = C.PORT_CD(+)
   AND C.IMDG_CLSS_CD(+)      = @[imdg_clss_cd]                      --:class_cd 
   AND C.IMDG_UN_NO           IS NULL 
   AND C.IMDG_UN_NO_SEQ       IS NULL
   AND R.PORT_CD              = LD.PORT_CD(+)
   AND R.IMDG_PORT_RSTR_SEQ   = LD.IMDG_PORT_RSTR_SEQ(+)
   AND LD.PORT_PROHI_TP_CD(+) = 'L'
   AND R.PORT_CD              = DD.PORT_CD(+)
   AND R.IMDG_PORT_RSTR_SEQ   = DD.IMDG_PORT_RSTR_SEQ(+)
   AND DD.PORT_PROHI_TP_CD(+) = 'D'
   AND R.PORT_CD              = PD.PORT_CD(+)
   AND R.IMDG_PORT_RSTR_SEQ   = PD.IMDG_PORT_RSTR_SEQ(+)
   AND PD.PORT_PROHI_TP_CD(+) = 'P'
   AND C.PORT_CD              = LC.PORT_CD(+)
   AND C.IMDG_PORT_RSTR_SEQ   = LC.IMDG_PORT_RSTR_SEQ(+)
   AND LC.PORT_PROHI_TP_CD(+) = 'L'
   AND C.PORT_CD              = DC.PORT_CD(+)
   AND C.IMDG_PORT_RSTR_SEQ   = DC.IMDG_PORT_RSTR_SEQ(+)
   AND DC.PORT_PROHI_TP_CD(+) = 'D'
   AND C.PORT_CD              = PC.PORT_CD(+)
   AND C.IMDG_PORT_RSTR_SEQ   = PC.IMDG_PORT_RSTR_SEQ(+)
   AND PC.PORT_PROHI_TP_CD(+) = 'P'
 ORDER BY P.PORT_ROTN_SEQ			]]></sql>
			<params>
				<param name="slan_cd" type="12" value="" out="N"/>
				<param name="pol_port_cd" type="12" value="" out="N"/>
				<param name="pod_port_cd" type="12" value="" out="N"/>
				<param name="pol_port_rotn_seq" type="12" value="" out="N"/>
				<param name="pod_port_rotn_seq" type="12" value="" out="N"/>
				<param name="imdg_clss_cd" type="12" value="" out="N"/>
				<param name="imdg_un_no" type="12" value="" out="N"/>
				<param name="imdg_un_no_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
