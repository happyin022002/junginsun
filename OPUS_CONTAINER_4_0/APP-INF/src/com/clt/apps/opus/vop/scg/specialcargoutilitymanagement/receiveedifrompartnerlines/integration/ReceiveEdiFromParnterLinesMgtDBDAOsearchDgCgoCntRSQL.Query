<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ReceiveEdiFromParnterLinesMgtDBDAOsearchDgCgoCntRSQL">
			<desc><![CDATA[searchDgCgoCnt]]></desc>
			<sql><![CDATA[
SELECT 		MAX('Y') AS CGO_CNT
FROM 		SCG_PRNR_SPCL_CGO_TRSM_HDR 	HDR
      	, 	SCG_PRNR_SPCL_CGO_DTL_LOG  	DTL
WHERE 		1 = 1
AND 		HDR.TRSM_MZD_CD        		= 'EDI'							--::EDI, EML::--
AND     	HDR.BKG_REF_NO             	= @[bkg_ref_no]
AND     	HDR.TRSM_BND_CD            	= @[trsm_bnd_cd]
AND      	HDR.CGO_OPR_CD        		= @[cgo_opr_cd]
AND      	HDR.VSL_CD          		= @[vsl_cd]
AND      	HDR.SKD_VOY_NO        		= @[skd_voy_no]
AND      	HDR.SKD_DIR_CD        		= @[skd_dir_cd]

----AND      	HDR.POL_CD          	= [pol_cd]
----AND      	HDR.POD_CD          	= [pod_cd]

AND     	HDR.ERR_KND_CD         		= 'O'

AND 		HDR.TRSM_BND_CD        		= DTL.TRSM_BND_CD
AND 		HDR.TRSM_DT            		= DTL.TRSM_DT
AND 		HDR.SPCL_CGO_CATE_CD   		= DTL.SPCL_CGO_CATE_CD
AND 		HDR.PRNR_SPCL_CGO_SEQ  		= DTL.PRNR_SPCL_CGO_SEQ
AND 		HDR.PRNR_SPCL_CGO_SEQ  		= (	SELECT MAX(PRNR_SPCL_CGO_SEQ)
                                    		FROM SCG_PRNR_SPCL_CGO_TRSM_HDR 	B
                                   			WHERE 1 = 1
                                			AND   	B.TRSM_MZD_CD               = HDR.TRSM_MZD_CD
                                			AND   	B.BKG_REF_NO          		= HDR.BKG_REF_NO
                                			AND   	B.TRSM_BND_CD         		= HDR.TRSM_BND_CD
                                			AND   	B.ERR_KND_CD          		= HDR.ERR_KND_CD
                                			AND   	B.CGO_OPR_CD          		= HDR.CGO_OPR_CD
                                			AND   	B.VSL_CD              		= HDR.VSL_CD
                                			AND   	B.SKD_VOY_NO          		= HDR.SKD_VOY_NO
                                			AND   	B.SKD_DIR_CD          		= HDR.SKD_DIR_CD
                                			----AND   	B.POL_CD              		= HDR.POL_CD
                                			----AND   	B.POD_CD              		= HDR.POD_CD
                                 		)

AND 		DTL.DCGO_REF_NO             = @[dcgo_ref_no]			]]></sql>
			<params>
				<param name="bkg_ref_no" type="12" value="" out="N"/>
				<param name="trsm_bnd_cd" type="12" value="" out="N"/>
				<param name="cgo_opr_cd" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="dcgo_ref_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
