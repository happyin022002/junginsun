<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InterfaceScheduleToExternalDBDAOCreateVskVipsIfDtlUsingVipsIfHisCSQL">
			<desc><![CDATA[VIPS I/F DETAIL USING I/F HISTORY]]></desc>
			<sql><![CDATA[
MERGE INTO	VSK_VSL_SKD_VIPS_IF_DTL 		X
USING        (SELECT  	
				   D.VSL_CD
				  ,D.SKD_VOY_NO
				  ,D.SKD_DIR_CD
				  ,@[vips_if_seq]    	AS VIPS_IF_SEQ
				  ,D.VPS_PORT_CD
				  ,D.CLPT_IND_SEQ
				  ,D.CLPT_SEQ
				  ,D.PORT_SKD_STS_CD
				  ,D.YD_CD
				  ,D.CALL_YD_IND_SEQ
				  ,D.SKD_CNG_STS_CD
				  ,D.VIPS_IB_CONSORTIUM_VOY_NO 
				  ,D.VIPS_OB_CONSORTIUM_VOY_NO 
				  ,D.PF_ETA_DT
				  ,D.PF_ETB_DT
				  ,D.PF_ETD_DT
				  ,D.INIT_ETA_DT             
				  ,D.INIT_ETB_DT
				  ,D.INIT_ETD_DT             
				  ,D.VIPS_VPS_ETA_DT
				  ,D.VIPS_VPS_ETB_DT
				  ,D.VIPS_VPS_ETD_DT
				  ,D.VIPS_ACT_ARR_DT
				  ,D.VIPS_ACT_BRTH_DT
				  ,D.VIPS_ACT_DEP_DT
				  ,D.VIPS_MODI_LOC_CD
				  ,D.TURN_PORT_FLG
				  ,D.TURN_PORT_IND_CD
				  ,D.TURN_SKD_VOY_NO 
				  ,D.TURN_SKD_DIR_CD
				  ,D.TURN_CLPT_IND_SEQ
				  ,D.VIPS_LOD_IND_CD
				  ,D.VIPS_DCHG_IND_CD
				  ,D.VIPS_PASS_IND_CD
				  ,D.SKD_UPD_USR_ID
				  ,D.SKD_UPD_USR_NM
				  ,D.SKD_UPD_DT
				  ,D.ADD_CALL_FLG
				  ,D.VT_ADD_CALL_FLG      
				  ,D.CRE_USR_ID
				  ,D.CRE_DT
				  ,D.UPD_USR_ID
				  ,D.UPD_DT      
			FROM	  VSK_VSL_SKD_VIPS_IF_DTL   D            	
			WHERE     1 = 1
			AND		  D.VSL_CD                	= @[vsl_cd]
			AND       D.SKD_VOY_NO            	= @[skd_voy_no] 
			AND       D.VIPS_IF_SEQ           	= (	SELECT   MAX(H.VIPS_IF_SEQ)
			                                     	FROM     VSK_VSL_SKD_VIPS_IF_HDR H
			                                     	WHERE    H.VSL_CD                = D.VSL_CD
			                                     	AND      H.SKD_VOY_NO            = D.SKD_VOY_NO
			                                     	AND      H.INSF_CNQE_VAL         = 'S'
			                                     	)
            ) XX
  ON    (
           X.VSL_CD                   = XX.VSL_CD
  AND      X.SKD_VOY_NO               = XX.SKD_VOY_NO
  AND      X.SKD_DIR_CD               = XX.SKD_DIR_CD
  AND      X.VIPS_IF_SEQ              = XX.VIPS_IF_SEQ
  AND      X.VPS_PORT_CD              = XX.VPS_PORT_CD
  AND      X.CLPT_IND_SEQ             = XX.CLPT_IND_SEQ
			)

WHEN NOT MATCHED THEN
INSERT
  (
	   VSL_CD
	  ,SKD_VOY_NO
	  ,SKD_DIR_CD
	  ,VIPS_IF_SEQ
	  ,VPS_PORT_CD
	  ,CLPT_IND_SEQ
	  ,CLPT_SEQ
	  ,PORT_SKD_STS_CD
	  ,YD_CD
	  ,CALL_YD_IND_SEQ
	  ,SKD_CNG_STS_CD
	  ,VIPS_IB_CONSORTIUM_VOY_NO 
	  ,VIPS_OB_CONSORTIUM_VOY_NO 
	  ,PF_ETA_DT
	  ,PF_ETB_DT
	  ,PF_ETD_DT
	  ,INIT_ETA_DT             
	  ,INIT_ETB_DT
	  ,INIT_ETD_DT             
	  ,VIPS_VPS_ETA_DT
	  ,VIPS_VPS_ETB_DT
	  ,VIPS_VPS_ETD_DT
	  ,VIPS_ACT_ARR_DT
	  ,VIPS_ACT_BRTH_DT
	  ,VIPS_ACT_DEP_DT
	  ,VIPS_MODI_LOC_CD
	  ,TURN_PORT_FLG
	  ,TURN_PORT_IND_CD
	  ,TURN_SKD_VOY_NO 
	  ,TURN_SKD_DIR_CD
	  ,TURN_CLPT_IND_SEQ
	  ,VIPS_LOD_IND_CD
	  ,VIPS_DCHG_IND_CD
	  ,VIPS_PASS_IND_CD
	  ,SKD_UPD_USR_ID
	  ,SKD_UPD_USR_NM
	  ,SKD_UPD_DT
	  ,ADD_CALL_FLG
	  ,VT_ADD_CALL_FLG      
	  ,CRE_USR_ID
	  ,CRE_DT
	  ,UPD_USR_ID
	  ,UPD_DT
  )
   VALUES
    ( 
	   XX.VSL_CD
	  ,XX.SKD_VOY_NO
	  ,XX.SKD_DIR_CD
	  ,XX.VIPS_IF_SEQ
	  ,XX.VPS_PORT_CD
	  ,XX.CLPT_IND_SEQ
	  ,XX.CLPT_SEQ
	  ,XX.PORT_SKD_STS_CD
	  ,XX.YD_CD
	  ,XX.CALL_YD_IND_SEQ
	  ,XX.SKD_CNG_STS_CD
	  ,XX.VIPS_IB_CONSORTIUM_VOY_NO 
	  ,XX.VIPS_OB_CONSORTIUM_VOY_NO 
	  ,XX.PF_ETA_DT
	  ,XX.PF_ETB_DT
	  ,XX.PF_ETD_DT
	  ,XX.INIT_ETA_DT             
	  ,XX.INIT_ETB_DT
	  ,XX.INIT_ETD_DT             
	  ,XX.VIPS_VPS_ETA_DT
	  ,XX.VIPS_VPS_ETB_DT
	  ,XX.VIPS_VPS_ETD_DT
	  ,XX.VIPS_ACT_ARR_DT
	  ,XX.VIPS_ACT_BRTH_DT
	  ,XX.VIPS_ACT_DEP_DT
	  ,XX.VIPS_MODI_LOC_CD
	  ,XX.TURN_PORT_FLG
	  ,XX.TURN_PORT_IND_CD
	  ,XX.TURN_SKD_VOY_NO 
	  ,XX.TURN_SKD_DIR_CD
	  ,XX.TURN_CLPT_IND_SEQ
	  ,XX.VIPS_LOD_IND_CD
	  ,XX.VIPS_DCHG_IND_CD
	  ,XX.VIPS_PASS_IND_CD
	  ,XX.SKD_UPD_USR_ID
	  ,XX.SKD_UPD_USR_NM
	  ,XX.SKD_UPD_DT
	  ,XX.ADD_CALL_FLG
	  ,XX.VT_ADD_CALL_FLG      
	  ,XX.CRE_USR_ID
	  ,XX.CRE_DT
	  ,XX.UPD_USR_ID
	  ,XX.UPD_DT 
	)			]]></sql>
			<params>
				<param name="vips_if_seq" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
