<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PartnerLinesDangerousCargoApprovalDBDAOSearchDGApprovalStatusListRSQL">
			<desc><![CDATA[Application Request & Approval Status for Partner Lines 조회]]></desc>
			<sql><![CDATA[
SELECT   
  RQS.SPCL_CGO_RQST_SEQ AS SPCL_CGO_APRO_RQST_SEQ,
  RQS.LST_RQST_DAT_FLG,
  '1' AS VSL_SEQ,  
  RQS.SPCL_CGO_RQST_SEQ,
  RQS.SLAN_CD,
  RQS.VSL_CD,
  RQS.SKD_VOY_NO,
  RQS.SKD_DIR_CD,
  CGO.SPCL_CGO_CATE_CD,
  CGO.BKG_REF_NO AS BKG_NO,
  DECODE(CGO.AUTH_STS_CD,'C','C','') AS BKG_STS_CD,
  CGO.SPCL_CNTR_SEQ AS DG_CNTR_SEQ,
  CGO.SPCL_CGO_SEQ AS CNTR_CGO_SEQ,
  DECODE(CGO.SPCL_RQST_FLG, 'Y','S','')||'R'||CGO.SPCL_CGO_RQST_SEQ AS RQST_AUTH_CD,
  RQS.RQST_OFC_CD AS RQST_OFC_CD,
  TO_CHAR(CGO.UPD_DT,'YYYY-MM-DD') AS RQST_DT,  
  --TO_CHAR(SYSDATE,'YYYY-MM-DD') AS RQST_GDT,  
  TO_CHAR(NVL(GLOBALDATE_PKG.TIME_CONV_FNC( GLOBALDATE_PKG.GET_LOCCD_FNC(RQS.RQST_OFC_CD), CGO.CGO_RQST_DT,'GMT'), CGO.CGO_RQST_DT),'YYYY-MM-DD') RQST_GDT,
  CGO.CRE_USR_ID AS RQST_USR_ID,
  DECODE(CGO.AUTH_STS_CD, 'R', NULL, CGO.AUTH_STS_CD) AS SPCL_CGO_AUTH_CD,
  DECODE(CGO.AUTH_STS_CD, 'R', null, 'C', null, TO_CHAR(CGO.AUTH_DT,'YYYY-MM-DD')) AS AUTH_DT,  
  --DECODE(CGO.AUTH_STS_CD, 'R', NULL, 'X', NULL, TO_CHAR(SYSDATE,'YYYY-MM-DD')) AS AUTH_GDT,
  TO_CHAR(NVL(GLOBALDATE_PKG.TIME_CONV_FNC( GLOBALDATE_PKG.GET_LOCCD_FNC(CGO.AUTH_OFC_CD), CGO.AUTH_DT,'GMT'), CGO.AUTH_DT),'YYYY-MM-DD') AS AUTH_GDT,
  DECODE(CGO.AUTH_STS_CD, 'R', null, 'C', null, CGO.AUTH_USR_ID) AS AUTH_USR_ID,
  CGO.SPCL_CGO_AUTH_RJCT_CD,
  CGO.SPCL_CGO_AUTH_RMK,
  RQS.POL_CD,
  RQS.POD_CD,
  DECODE(CGO.APRO_REF_NO,'0','',CGO.APRO_REF_NO) APRO_REF_NO,
  CGO.CNTR_TPSZ_CD,
  'DD' AS SCG_FLG,
  CGO.IMDG_UN_NO,
  CGO.IMDG_UN_NO_SEQ,
  CGO.IMDG_CLSS_CD,  
  (DECODE(CGO.N1ST_IMDG_SUBS_RSK_LBL_CD,'0','',CGO.N1ST_IMDG_SUBS_RSK_LBL_CD)||DECODE(NVL(CGO.N2ND_IMDG_SUBS_RSK_LBL_CD,''),'','','0','','/')
  ||DECODE(CGO.N2ND_IMDG_SUBS_RSK_LBL_CD,'0','',CGO.N2ND_IMDG_SUBS_RSK_LBL_CD)||DECODE(NVL(CGO.N3RD_IMDG_SUBS_RSK_LBL_CD,''),'','','0','','/')
  ||DECODE(CGO.N3RD_IMDG_SUBS_RSK_LBL_CD,'0','',CGO.N3RD_IMDG_SUBS_RSK_LBL_CD)||DECODE(NVL(CGO.N4TH_IMDG_SUBS_RSK_LBL_CD,''),'','','0','','/')
  ||DECODE(CGO.N4TH_IMDG_SUBS_RSK_LBL_CD,'0','',CGO.N4TH_IMDG_SUBS_RSK_LBL_CD)) IMDG_SUBS_RSK_LBL_CD,
  CGO.MRN_POLUT_FLG,
  DECODE(CGO.IMDG_PCK_GRP_CD,'1','I','2','II','3','III','') IMDG_PCK_GRP_CD,
  CGO.IMDG_LMT_QTY_FLG,
  CGO.IMDG_EXPT_QTY_FLG,
  CGO.FLSH_PNT_CDO_TEMP,
  CGO.GRS_WGT,
  CGO.NET_WGT,
  DECODE(TRIM(CGO.IN_N1ST_IMDG_PCK_CD),'','',CGO.IN_N1ST_IMDG_PCK_QTY||'×'||CGO.IN_N1ST_IMDG_PCK_CD)||
  DECODE(TRIM(CGO.IN_N2ND_IMDG_PCK_CD),'','',', '||CGO.IN_N2ND_IMDG_PCK_QTY||'×'||CGO.IN_N2ND_IMDG_PCK_CD) AS IN_IMDG_PCK_QTY1,
  DECODE(TRIM(CGO.OUT_N1ST_IMDG_PCK_CD),'','',CGO.OUT_N1ST_IMDG_PCK_QTY||'×'||CGO.OUT_N1ST_IMDG_PCK_CD)||
  DECODE(TRIM(CGO.OUT_N2ND_IMDG_PCK_CD),'','',', '||CGO.OUT_N2ND_IMDG_PCK_QTY||'×'||CGO.OUT_N2ND_IMDG_PCK_CD) AS OUT_IMDG_PCK_QTY1,
  DECODE(TRIM(CGO.INTMD_N1ST_IMDG_PCK_CD),'','',CGO.INTMD_N1ST_IMDG_PCK_QTY||'×'||CGO.INTMD_N1ST_IMDG_PCK_CD)||
  DECODE(TRIM(CGO.INTMD_N2ND_IMDG_PCK_CD),'','',', '||CGO.INTMD_N2ND_IMDG_PCK_QTY||'×'||CGO.INTMD_N2ND_IMDG_PCK_CD) AS INTMD_IMDG_PCK_QTY1,
  CGO.PSA_NO,
  SUN.HCDG_FLG,
  '' AS SPCL_RQST_DESC
FROM SCG_PRNR_APRO_RQST RQS, SCG_PRNR_APRO_RQST_CGO CGO, SCG_IMDG_UN_NO SUN
WHERE 1=1
  AND RQS.VSL_CD            = @[vsl_cd]
  AND RQS.SKD_VOY_NO        = @[skd_voy_no]
  AND RQS.SKD_DIR_CD        = @[skd_dir_cd]
  AND RQS.DG_FLG            = 'Y'
  AND RQS.AWK_FLG           = 'N'
  AND RQS.CRR_CD            = CGO.CRR_CD
  AND RQS.BKG_REF_NO        = CGO.BKG_REF_NO
  AND RQS.SPCL_CGO_RQST_SEQ = CGO.SPCL_CGO_RQST_SEQ
  AND RQS.PRNR_CGO_RQST_SEQ = CGO.PRNR_CGO_RQST_SEQ
  AND RQS.SRC_TP_CD <> 'EDI'
  AND RQS.BKG_REF_NO = @[booking_no]
  AND CGO.AUTH_STS_CD IS NOT NULL
  AND CGO.IMDG_UN_NO        = SUN.IMDG_UN_NO(+)
  AND CGO.IMDG_UN_NO_SEQ    = SUN.IMDG_UN_NO_SEQ(+)
  ORDER BY RQS.SPCL_CGO_RQST_SEQ, CGO.SPCL_CNTR_SEQ, CGO.SPCL_CGO_SEQ			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="booking_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
