<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="VesselScheduleMgtDBDAOUpdateClptSeqforVirtualAddCallOnlyUSQL">
			<desc><![CDATA[Virtual Add Calling이 포함된 VVD의 CLPT_SEQ 보정]]></desc>
			<sql><![CDATA[
MERGE INTO VSK_VSL_PORT_SKD XX
USING      (
			-------------------------------------------------------------------------------------------
            SELECT    X.VSL_CD
                   ,  X.SKD_VOY_NO
                   ,  X.SKD_DIR_CD
                   ,  X.VPS_PORT_CD
                   ,  X.CLPT_IND_SEQ
                   ,  X.CLPT_SEQ
                   ,  X.VT_ADD_CALL_FLG

                   --:2016-07-08:--,  ROW_NUMBER() OVER (ORDER BY DECODE(X.VT_ADD_CALL_FLG,'Y',9,1) ASC, X.CLPT_SEQ ASC)  CORR_CLPT_SEQ
                   ,  ROW_NUMBER() OVER (ORDER BY X.VPS_ETB_DT ASC, X.VPS_ETA_DT ASC, X.VPS_ETD_DT ASC, X.CLPT_SEQ ASC)  CORR_CLPT_SEQ

            FROM      VSK_VSL_PORT_SKD   X
            WHERE     X.VSL_CD           = @[vsl_cd]
            AND       X.SKD_VOY_NO       = @[skd_voy_no]
            AND       X.SKD_DIR_CD       = @[skd_dir_cd]
            AND       EXISTS             (SELECT    ''
                                          FROM      VSK_VSL_PORT_SKD    PS
                                          WHERE     PS.VSL_CD           = X.VSL_CD
                                          AND       PS.SKD_VOY_NO       = X.SKD_VOY_NO
                                          AND       PS.SKD_DIR_CD       = X.SKD_DIR_CD
                                          AND       PS.VT_ADD_CALL_FLG  = 'Y'
                                          )
			-------------------------------------------------------------------------------------------
            ) YY
ON          (
     XX.VSL_CD        	= YY.VSL_CD
 AND XX.SKD_VOY_NO    	= YY.SKD_VOY_NO
 AND XX.SKD_DIR_CD    	= YY.SKD_DIR_CD
 AND XX.VPS_PORT_CD   	= YY.VPS_PORT_CD
 AND XX.CLPT_IND_SEQ  	= YY.CLPT_IND_SEQ

 --:2016-07-08:--AND XX.VT_ADD_CALL_FLG	= 'Y'
            )
WHEN MATCHED THEN
            UPDATE    SET
               XX.CLPT_SEQ = YY.CORR_CLPT_SEQ			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
