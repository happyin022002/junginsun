<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="VesselReportDBDAOSearchMailingListVORSQL">
			<desc><![CDATA[Mail Preview]]></desc>
			<sql><![CDATA[
WITH A AS (
 SELECT '' BODY_CONTS
   FROM DUAL
)
,B AS (
SELECT 'DEPARTURE REPORT MISSING'||' ('||to_char(sysdate, 'YYYY/MM/DD')||')' SUBJECT
  FROM DUAL
)
,C AS (
SELECT USR_EML FROM_PSN 
  FROM COM_USER
 WHERE 1=1
   AND USR_ID = @[usr_id]
)
,D AS (
        SELECT      SUBSTR( MAX(SYS_CONNECT_BY_PATH(VSL_EML, '; ')),2) AS TO_PSN
          FROM        (
                        SELECT VSL_CD
                             , VSL_EML
                             , SEQ
                          FROM (
                                SELECT DISTINCT
                                       INFO.VSL_CD
                                     , INFO.VSL_EML VSL_EML
                                     , ROWNUM SEQ
                             
                                  FROM MDM_VSL_CNTR  INFO
                                 WHERE 1=1
								#if( ${vel_vsl_cd} != '' )
								   AND INFO.VSL_CD IN (
                                                      #foreach($sVslCd in ${vel_vsl_cd})
                                                      '$sVslCd',
                                                      #end
                                                      ''
                                                      )
								#end                                             
                                 ) MAIL                                 
                       )
           START WITH  SEQ = 1
         CONNECT BY PRIOR SEQ = SEQ-1
)
,E AS (
SELECT '' CC_PSN
  FROM DUAL
)

SELECT (SELECT SUBJECT FROM B) SUBJECT
      ,(SELECT BODY_CONTS FROM A) BODY_CONTS
      ,(SELECT FROM_PSN FROM C) FROM_PSN
      ,(SELECT TO_PSN FROM D) TO_PSN
      ,(SELECT CC_PSN FROM E) CC_PSN
  FROM DUAL			]]></sql>
			<params>
				<param name="usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
