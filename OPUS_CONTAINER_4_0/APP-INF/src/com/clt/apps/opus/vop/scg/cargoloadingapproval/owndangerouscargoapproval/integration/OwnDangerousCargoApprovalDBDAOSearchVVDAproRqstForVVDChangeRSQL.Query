<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OwnDangerousCargoApprovalDBDAOSearchVVDAproRqstForVVDChangeRSQL">
			<desc><![CDATA[SearchVVDAproRqstForVVDChange]]></desc>
			<sql><![CDATA[
SELECT		YY.BKG_NO
     	, 	YY.SPCL_CGO_APRO_RQST_SEQ
     	, 	YY.VSL_CD
     	, 	YY.SKD_VOY_NO
     	, 	YY.SKD_DIR_CD

		,	RSO.RGN_SHP_OPR_CD

     	, 	YY.POL_CD
     	, 	YY.POL_CLPT_IND_SEQ
     	, 	YY.POL_YD_CD
     	, 	YY.POD_CD
     	, 	YY.POD_CLPT_IND_SEQ
     	, 	YY.POD_YD_CD
     
     	,  	'' 							EDI_DEL_STS_CD
     	, 	'R' 						EDI_MSG_STS_CD
     	, 	'EDI_AUTO_CXL'				EDI_STATUS

     	, 	NVL(G.ACT_CRR_CD,D.CRR_CD)  CRR_CD

			     	, 	(
			        	SELECT (
			                	SELECT 	FLT_FILE_REF_NO
			                  	FROM 	SCG_PRNR_SPCL_CGO_TRSM_HDR  A
			                 	WHERE 	1 = 1
			           			AND 	A.TRSM_MZD_CD               = 'EDI'              --::EDI, EML::--
			           			AND 	A.BKG_REF_NO              	= SC2.BKG_NO
			                   	AND 	A.PRNR_SPCL_CGO_SEQ       	= SC2.MAPG_PRNR_SPCL_CGO_SEQ
			               		) 
			           	FROM 	SCG_APRO_RQST 						SC1
			              	, 	SCG_VVD_APRO_RQST 					SC2
			          	WHERE 	1 = 1
			            AND 	SC1.SPCL_CGO_APRO_RQST_SEQ 			= (	SELECT 		MAX(T1.SPCL_CGO_APRO_RQST_SEQ)
			                                                       		FROM 		SCG_APRO_RQST 				T1
			                                                          			, 	SCG_VVD_APRO_RQST 			T2
			                                                      		WHERE 		T1.BKG_NO                 	= T2.BKG_NO
																		AND 		T1.SPCL_CGO_APRO_RQST_SEQ 	= T2.SPCL_CGO_APRO_RQST_SEQ
			                                                        	AND 		T2.MAPG_EDI_TRSM_STS_CD   	= 'S'

			                                                        	AND 		T2.BKG_NO                 	= SC2.BKG_NO
                                                                		AND   		T2.VSL_CD                 	= SC2.VSL_CD
                                                                		AND   		T2.SKD_VOY_NO             	= SC2.SKD_VOY_NO
                                                                		AND   		T2.SKD_DIR_CD             	= SC2.SKD_DIR_CD
			                                                      		)
						
						AND 	SC1.BKG_NO                 			= SC2.BKG_NO
						AND 	SC1.SPCL_CGO_APRO_RQST_SEQ 			= SC2.SPCL_CGO_APRO_RQST_SEQ 

						--AND 	SC2.VSL_PRE_PST_CD         			= YY.VSL_PRE_PST_CD
						--AND 	SC2.VSL_SEQ                			= YY.VSL_SEQ

						AND		SC2.BKG_NO                 			= YY.BKG_NO
                        AND   	SC2.VSL_CD                 			= YY.VSL_CD
                        AND   	SC2.SKD_VOY_NO             			= YY.SKD_VOY_NO
                        AND   	SC2.SKD_DIR_CD             			= YY.SKD_DIR_CD             
			       		) 		FLT_FILE_REF_NO

     	, 	XX.SPCL_CGO_RQST_SEQ
     	, 	YY.SPCL_CGO_APRO_RQST_SEQ
     	, 	YY.VSL_PRE_PST_CD
     	, 	YY.VSL_SEQ

FROM 		VSK_VSL_SKD          		G
     	, 	SCG_APRO_RQST        		XX
     	, 	SCG_VVD_APRO_RQST    		YY
     	, 	MDM_VSL_CNTR         		D
		,	SCG_RGN_SHP_OPR_PORT		RSO
WHERE 		1 = 1
AND 		YY.VSL_CD                   = G.VSL_CD
AND 		YY.SKD_VOY_NO               = G.SKD_VOY_NO
AND 		YY.SKD_DIR_CD               = G.SKD_DIR_CD
AND 		YY.VSL_CD                   = D.VSL_CD
AND 		YY.BKG_NO                   = XX.BKG_NO
AND 		YY.SPCL_CGO_APRO_RQST_SEQ   = XX.SPCL_CGO_APRO_RQST_SEQ
AND        	XX.SPCL_CGO_CATE_CD       	= 'DG'
AND			YY.POL_CD					= LOC_CD

AND    		YY.BKG_NO                   = @[bkg_no]
AND    		YY.SPCL_CGO_APRO_RQST_SEQ   = @[spcl_cgo_apro_rqst_seq]

--AND       	YY.VSL_PRE_PST_CD       = [vsl_pre_pst_cd]
--AND       	YY.VSL_SEQ              = [vsl_seq]

AND       	YY.MAPG_EDI_TRSM_STS_CD   	= 'S'

AND         YY.VSL_CD                   = @[vsl_cd]
AND         YY.SKD_VOY_NO               = @[skd_voy_no]
AND         YY.SKD_DIR_CD               = @[skd_dir_cd]			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="spcl_cgo_apro_rqst_seq" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
