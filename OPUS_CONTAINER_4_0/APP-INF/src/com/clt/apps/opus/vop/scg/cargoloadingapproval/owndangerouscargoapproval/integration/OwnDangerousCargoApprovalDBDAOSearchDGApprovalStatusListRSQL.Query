<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OwnDangerousCargoApprovalDBDAOSearchDGApprovalStatusListRSQL">
			<desc><![CDATA[DG Cargo의 신청 및 승인에 대한 Status를 조회한다.]]></desc>
			<sql><![CDATA[
--::2016-04-19::--
SELECT * FROM
(
SELECT 
	DECODE(A.VSL_PRE_PST_CD,'S','Pre'||A.VSL_SEQ,'T','Trunk','U','Post'||A.VSL_SEQ) AS VSL_PRE_PST_NM,
	A.SPCL_CGO_APRO_RQST_SEQ,
	A.VSL_PRE_PST_CD,
	A.LST_RQST_DAT_FLG,
	C.SPCL_CGO_AUTH_SEQ,
	A.VSL_SEQ,	
	A.SPCL_CGO_RQST_SEQ,
	A.SLAN_CD,
	A.VSL_CD,
	A.SKD_VOY_NO,
	A.SKD_DIR_CD,
	A.SPCL_CGO_CATE_CD,
	A.BKG_NO,
	A.BKG_STS_CD,
	A.DG_CNTR_SEQ,
	A.CNTR_CGO_SEQ,	
	DECODE(A.SPCL_RQST_FLG, 'Y','S','')||'R'||A.SPCL_CGO_RQST_SEQ AS RQST_AUTH_CD,
	A.RQST_OFC_CD,
	TO_CHAR(A.RQST_DT,'YYYY-MM-DD') AS RQST_DT,	
	TO_CHAR(A.RQST_GDT,'YYYY-MM-DD') AS RQST_GDT,	
	A.RQST_USR_ID,
	DECODE(A.SPCL_CGO_APRO_CD,'D','D','C','C',DECODE(A.LST_RQST_DAT_FLG,'N',DECODE(C.SPCL_CGO_AUTH_CD,'','C',C.SPCL_CGO_AUTH_CD),C.SPCL_CGO_AUTH_CD)) AS SPCL_CGO_AUTH_CD,
	DECODE(A.LST_RQST_DAT_FLG,'N',DECODE(C.SPCL_CGO_AUTH_CD,'',(SELECT TO_CHAR(A.RQST_DT,'YYYY-MM-DD') FROM SCG_APRO_RQST H WHERE H.BKG_NO = A.BKG_NO AND H.SPCL_CGO_CATE_CD = A.SPCL_CGO_CATE_CD AND H.SPCL_CGO_RQST_SEQ = A.SPCL_CGO_RQST_SEQ),TO_CHAR(C.AUTH_DT,'YYYY-MM-DD')),TO_CHAR(C.AUTH_DT,'YYYY-MM-DD')) AS AUTH_DT,
	DECODE(A.LST_RQST_DAT_FLG,'N',DECODE(C.SPCL_CGO_AUTH_CD,'',(SELECT TO_CHAR(A.RQST_GDT,'YYYY-MM-DD') FROM SCG_APRO_RQST H WHERE H.BKG_NO = A.BKG_NO AND H.SPCL_CGO_CATE_CD = A.SPCL_CGO_CATE_CD AND H.SPCL_CGO_RQST_SEQ = A.SPCL_CGO_RQST_SEQ),TO_CHAR(C.AUTH_GDT,'YYYY-MM-DD')),TO_CHAR(C.AUTH_GDT,'YYYY-MM-DD')) AS AUTH_GDT,
	DECODE(A.LST_RQST_DAT_FLG,'N',DECODE(C.SPCL_CGO_AUTH_CD,'','SYSTEM',C.AUTH_USR_ID),C.AUTH_USR_ID) AS AUTH_USR_ID,
	DECODE(A.SPCL_CGO_APRO_CD,'D',C.SPCL_CGO_AUTH_RJCT_CD,'C',C.SPCL_CGO_AUTH_RJCT_CD,DECODE(A.LST_RQST_DAT_FLG,'N',DECODE(C.SPCL_CGO_AUTH_CD,'','SYS',C.SPCL_CGO_AUTH_RJCT_CD),C.SPCL_CGO_AUTH_RJCT_CD)) AS SPCL_CGO_AUTH_RJCT_CD,
	DECODE(A.SPCL_CGO_APRO_CD,'D',C.SPCL_CGO_AUTH_RMK,'C',C.SPCL_CGO_AUTH_RMK,DECODE(A.LST_RQST_DAT_FLG,'N',DECODE(C.SPCL_CGO_AUTH_CD,'','Reapplication',C.SPCL_CGO_AUTH_RMK),C.SPCL_CGO_AUTH_RMK)) AS SPCL_CGO_AUTH_RMK,
	A.POL_CD,
	A.POD_CD,
    C.APRO_REF_NO,
	A.CNTR_TPSZ_CD,
	'DD' AS SCG_FLG,
	A.IMDG_UN_NO,
	A.IMDG_UN_NO_SEQ,
	A.IMDG_CLSS_CD,	
    A.IMDG_SUBS_RSK_LBL_CD,
    A.MRN_POLUT_FLG,
	A.IMDG_PCK_GRP_CD,
	A.IMDG_LMT_QTY_FLG,
	A.IMDG_EXPT_QTY_FLG,
	A.FLSH_PNT_CDO_TEMP,
	A.GRS_WGT,
	A.NET_WGT,
	A.IN_IMDG_PCK_QTY1,
	A.OUT_IMDG_PCK_QTY1,
	A.INTMD_IMDG_PCK_QTY1,
	A.PSA_NO,
	A.HCDG_FLG,
	A.SPCL_RQST_DESC,
    --::2016-04-19::--
    ROW_NUMBER() OVER (PARTITION BY NVL(C.BKG_NO, A.BKG_NO), NVL(C.SPCL_CGO_APRO_RQST_SEQ, A.SPCL_CGO_APRO_RQST_SEQ), NVL(C.DCGO_SEQ, A.DCGO_SEQ), NVL(C.VSL_PRE_PST_CD, A.VSL_PRE_PST_CD), NVL(C.VSL_SEQ, A.VSL_SEQ)
    ORDER BY DECODE(C.APRO_REF_NO,NULL,9,1), C.UPD_DT DESC) AS CORR_AUTH_SEQ

FROM (    
    SELECT 
    	A.BKG_NO,
		A.BKG_STS_CD,
    	C.SLAN_CD,
    	B.SPCL_CGO_APRO_RQST_SEQ,     
    	B.SPCL_CGO_CATE_CD,
		B.SPCL_BKG_RQST_FLG,
        B.SPCL_CGO_RQST_SEQ,
    	B.RQST_OFC_CD,
    	B.RQST_DT,
    	B.RQST_GDT,
    	B.RQST_USR_ID,
		B.LST_RQST_DAT_FLG,
    	C.VSL_CD,
    	C.SKD_VOY_NO,
    	C.SKD_DIR_CD,
        C.VSL_PRE_PST_CD,
        C.VSL_SEQ,
    	C.POL_CD,
    	C.POD_CD,
		D.DCGO_SEQ,
		D.DG_CNTR_SEQ,
		D.CNTR_CGO_SEQ,	
		D.CNTR_TPSZ_CD,
		D.IMDG_UN_NO,
		D.IMDG_UN_NO_SEQ,
		D.IMDG_CLSS_CD,	
    	D.IMDG_SUBS_RSK_LBL_CD1||DECODE(D.IMDG_SUBS_RSK_LBL_CD2,NULL,NULL,'/')||
        	D.IMDG_SUBS_RSK_LBL_CD2||DECODE(D.IMDG_SUBS_RSK_LBL_CD3,NULL,NULL,'/')||
	        	D.IMDG_SUBS_RSK_LBL_CD3||DECODE(D.IMDG_SUBS_RSK_LBL_CD4,NULL,NULL,'/')||
    	        	D.IMDG_SUBS_RSK_LBL_CD4 AS IMDG_SUBS_RSK_LBL_CD,
	    D.MRN_POLUT_FLG,
		DECODE(D.IMDG_PCK_GRP_CD,'N',NULL,'1','I','2','II','3','III') AS IMDG_PCK_GRP_CD,
		D.IMDG_LMT_QTY_FLG,
		D.IMDG_EXPT_QTY_FLG,
		D.FLSH_PNT_CDO_TEMP,
		D.GRS_WGT,
		D.NET_WGT,
		DECODE(TRIM(D.IN_IMDG_PCK_CD1),'','',D.IN_IMDG_PCK_QTY1||'×'||D.IN_IMDG_PCK_CD1)||
    		DECODE(TRIM(D.IN_IMDG_PCK_CD2),'','',', '||D.IN_IMDG_PCK_QTY2||'×'||D.IN_IMDG_PCK_CD2) AS IN_IMDG_PCK_QTY1,
		DECODE(TRIM(D.OUT_IMDG_PCK_CD1),'','',D.OUT_IMDG_PCK_QTY1||'×'||D.OUT_IMDG_PCK_CD1)||
		    DECODE(TRIM(D.OUT_IMDG_PCK_CD2),'','',', '||D.OUT_IMDG_PCK_QTY2||'×'||D.OUT_IMDG_PCK_CD2) AS OUT_IMDG_PCK_QTY1,
		DECODE(TRIM(D.INTMD_IMDG_PCK_CD1),'','',D.INTMD_IMDG_PCK_QTY1||'×'||D.INTMD_IMDG_PCK_CD1)||
		    DECODE(TRIM(D.INTMD_IMDG_PCK_CD2),'','',', '||D.INTMD_IMDG_PCK_QTY2||'×'||D.INTMD_IMDG_PCK_CD2) AS INTMD_IMDG_PCK_QTY1,
		D.PSA_NO,
		D.HCDG_FLG,
		D.SPCL_CGO_APRO_CD,
		D.SPCL_RQST_FLG,
		D.SPCL_RQST_DESC

	FROM BKG_BOOKING A, SCG_APRO_RQST B, SCG_VVD_APRO_RQST C, SCG_DG_CGO D
	WHERE A.BKG_NO = B.BKG_NO
	AND B.SPCL_CGO_CATE_CD = 'DG'
	AND B.BKG_NO = C.BKG_NO
	AND B.SPCL_CGO_APRO_RQST_SEQ = C.SPCL_CGO_APRO_RQST_SEQ
	AND B.BKG_NO = D.BKG_NO(+)
	AND B.SPCL_CGO_APRO_RQST_SEQ = D.SPCL_CGO_APRO_RQST_SEQ(+)
	AND B.LST_RQST_DAT_FLG = 'N'
--	AND D.SPCL_CGO_APRO_CD is not null
	
	AND A.BKG_NO = @[booking_no]
	#if (${vsl_cd} != '' && ${vsl_cd} != 'null')
	AND C.VSL_CD = @[vsl_cd]
	AND C.SKD_VOY_NO = @[skd_voy_no]
	AND C.SKD_DIR_CD = @[skd_dir_cd]
	#end
	UNION ALL

    SELECT 
    	A.BKG_NO,
		A.BKG_STS_CD,
    	C.SLAN_CD,
    	B.SPCL_CGO_APRO_RQST_SEQ,     
    	B.SPCL_CGO_CATE_CD,
		B.SPCL_BKG_RQST_FLG,
        B.SPCL_CGO_RQST_SEQ,
    	B.RQST_OFC_CD,
    	B.RQST_DT,
    	B.RQST_GDT,
    	B.RQST_USR_ID,
		B.LST_RQST_DAT_FLG,
    	C.VSL_CD,
    	C.SKD_VOY_NO,
    	C.SKD_DIR_CD,
        C.VSL_PRE_PST_CD,
        C.VSL_SEQ,
    	C.POL_CD,
    	C.POD_CD,
		D.DCGO_SEQ,
		D.DG_CNTR_SEQ,
		D.CNTR_CGO_SEQ,	
		D.CNTR_TPSZ_CD,
		D.IMDG_UN_NO,
		D.IMDG_UN_NO_SEQ,
		D.IMDG_CLSS_CD,	
    	D.IMDG_SUBS_RSK_LBL_CD1||DECODE(D.IMDG_SUBS_RSK_LBL_CD2,NULL,NULL,'/')||
        	D.IMDG_SUBS_RSK_LBL_CD2||DECODE(D.IMDG_SUBS_RSK_LBL_CD3,NULL,NULL,'/')||
	        	D.IMDG_SUBS_RSK_LBL_CD3||DECODE(D.IMDG_SUBS_RSK_LBL_CD4,NULL,NULL,'/')||
    	        	D.IMDG_SUBS_RSK_LBL_CD4 AS IMDG_SUBS_RSK_LBL_CD,
	    D.MRN_POLUT_FLG,
		DECODE(D.IMDG_PCK_GRP_CD,'N',NULL,'1','I','2','II','3','III') AS IMDG_PCK_GRP_CD,
		D.IMDG_LMT_QTY_FLG,
		D.IMDG_EXPT_QTY_FLG,
		D.FLSH_PNT_CDO_TEMP,
		D.GRS_WGT,
		D.NET_WGT,
		DECODE(TRIM(D.IN_IMDG_PCK_CD1),'','',D.IN_IMDG_PCK_QTY1||'×'||D.IN_IMDG_PCK_CD1)||
    		DECODE(TRIM(D.IN_IMDG_PCK_CD2),'','',', '||D.IN_IMDG_PCK_QTY2||'×'||D.IN_IMDG_PCK_CD2) AS IN_IMDG_PCK_QTY1,
		DECODE(TRIM(D.OUT_IMDG_PCK_CD1),'','',D.OUT_IMDG_PCK_QTY1||'×'||D.OUT_IMDG_PCK_CD1)||
		    DECODE(TRIM(D.OUT_IMDG_PCK_CD2),'','',', '||D.OUT_IMDG_PCK_QTY2||'×'||D.OUT_IMDG_PCK_CD2) AS OUT_IMDG_PCK_QTY1,
		DECODE(TRIM(D.INTMD_IMDG_PCK_CD1),'','',D.INTMD_IMDG_PCK_QTY1||'×'||D.INTMD_IMDG_PCK_CD1)||
		    DECODE(TRIM(D.INTMD_IMDG_PCK_CD2),'','',', '||D.INTMD_IMDG_PCK_QTY2||'×'||D.INTMD_IMDG_PCK_CD2) AS INTMD_IMDG_PCK_QTY1,
		D.PSA_NO,
		D.HCDG_FLG,
		D.SPCL_CGO_APRO_CD,
		D.SPCL_RQST_FLG,
		D.SPCL_RQST_DESC

	FROM BKG_BOOKING A, SCG_APRO_RQST B, SCG_VVD_APRO_RQST C, BKG_DG_CGO D
	WHERE A.BKG_NO = B.BKG_NO
	AND B.SPCL_CGO_CATE_CD = 'DG'
	AND B.BKG_NO = C.BKG_NO
	AND B.SPCL_CGO_APRO_RQST_SEQ = C.SPCL_CGO_APRO_RQST_SEQ
	AND B.BKG_NO = D.BKG_NO
	AND B.LST_RQST_DAT_FLG = 'Y'

	--::2015-07-06::--AND D.SPCL_CGO_APRO_CD is not null
	--::2015-07-06::--AND D.SPCL_CGO_APRO_CD not in ('C','D')		
    --::2016-04-19::
	AND NVL(D.SPCL_CGO_APRO_CD, '*') <> 'D'		

	AND A.BKG_NO = @[booking_no]
	#if (${vsl_cd} != '' && ${vsl_cd} != 'null')
	AND C.VSL_CD = @[vsl_cd]
	AND C.SKD_VOY_NO = @[skd_voy_no]
	AND C.SKD_DIR_CD = @[skd_dir_cd]
	#end
) A, SCG_AUTHORIZATION C
WHERE A.BKG_NO = C.BKG_NO(+)
AND A.SPCL_CGO_APRO_RQST_SEQ = C.SPCL_CGO_APRO_RQST_SEQ(+)
AND A.VSL_PRE_PST_CD = C.VSL_PRE_PST_CD(+)
AND A.VSL_SEQ = C.VSL_SEQ(+)
AND A.DCGO_SEQ = C.DCGO_SEQ(+)

ORDER BY A.SPCL_CGO_RQST_SEQ, A.VSL_PRE_PST_CD, A.VSL_SEQ, A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD,
         A.BKG_NO, A.DG_CNTR_SEQ, A.CNTR_CGO_SEQ ASC

) AA
--::2016-04-19::--
WHERE 1=1
AND AA.CORR_AUTH_SEQ 			= 1			]]></sql>
			<params>
				<param name="booking_no" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
