<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PartnerLinesDangerousCargoApprovalDBDAOPartnerApprovalRequestVORSQL">
			<desc><![CDATA[SPCL CGO APVL for Partner Lines 의 Request 조회]]></desc>
			<sql><![CDATA[
SELECT   
       DG_FLG ,
       AWK_FLG ,
       RGN_SHP_OPR_CD ,
       EDI_TRSM_STS_CD ,
       SRC_TP_CD ,
       VSL_CD ,
       VSL_NM ,
       SKD_VOY_NO ,
       SKD_DIR_CD ,
       SLAN_CD ,
       CRR_CD ,
       CGO_OPR_CD ,
       POL_CD ,
       POL_CLPT_IND_SEQ ,
       ETA_DT ,
       POD_CD ,
       POD_CLPT_IND_SEQ ,
       BKG_REF_NO ,
       SPCL_CGO_RQST_SEQ ,
       SPCL_CNTR_SEQ ,
       SPCL_CGO_SEQ ,
       SPCL_CGO_QTY ,
       AUTH_STS_CD ,
       APRO_REF_NO ,
       SPCL_CGO_AUTH_RJCT_CD ,
       SPCL_CGO_AUTH_RMK ,
       CNTR_TPSZ_CD ,
       CMDT_DESC ,
       TTL_DIM_LEN ,
       TTL_DIM_WDT ,
       TTL_DIM_HGT ,
       FWRD_OVR_DIM_LEN ,
       BKWD_OVR_DIM_LEN ,
       LF_SD_OVR_DIM_LEN ,
       RT_SD_OVR_DIM_LEN ,
       HGT_OVR_DIM_LEN ,
       IMDG_UN_NO ,
       IMDG_SEGR_GRP_NM ,
       IMDG_SEGR_GRP_NO ,
       IMDG_UN_NO_SEQ ,
       IMDG_CLSS_CD ,
       N1ST_IMDG_SUBS_RSK_LBL_CD ,
       N2ND_IMDG_SUBS_RSK_LBL_CD ,
       N3RD_IMDG_SUBS_RSK_LBL_CD ,
       N4TH_IMDG_SUBS_RSK_LBL_CD ,
       IMDG_SUBS_RSK_LBL_CD ,
       MRN_POLUT_FLG ,
       IMDG_PCK_GRP_CD ,
       IMDG_LMT_QTY_FLG ,
       IMDG_EXPT_QTY_FLG ,
       RSD_FLG ,
       FLSH_PNT_CDO_TEMP ,
       GRS_WGT ,
       NET_WGT ,
       VOID_SLT_QTY ,
       PSA_NO ,
       CGO_RQST_DT ,
       AUTH_DT ,
       CRE_USR_ID ,
       UPD_USR_ID ,
       UPD_DT ,
       SCG_FLG ,
       AUTH_FLG ,
       SLAN_CD1 ,
       BOOKING_NO ,
       STS_CT ,
       FROM_ETA_DT ,
       TO_ETA_DT ,
       CNTR_REF_NO ,
       WGT_UT_CD ,
       WGT_UT_CD2 ,
       PRP_SHP_NM ,
       HZD_DESC ,
       DCGO_STS_CD ,
       EMER_CNTC_PHN_NO ,
       EMER_CNTC_PSON_NM ,
       CERTI_NO ,
       DIFF_RMK ,
       OUT_N1ST_IMDG_PCK_QTY ,
       OUT_N1ST_IMDG_PCK_CD ,
       OUT_N1ST_IMDG_PCK_DESC ,
       OUT_N2ND_IMDG_PCK_QTY ,
       OUT_N2ND_IMDG_PCK_CD ,
       OUT_N2ND_IMDG_PCK_DESC ,
       IN_N1ST_IMDG_PCK_QTY ,
       IN_N1ST_IMDG_PCK_CD ,
       IN_N1ST_IMDG_PCK_DESC ,
       IN_N2ND_IMDG_PCK_QTY ,
       IN_N2ND_IMDG_PCK_CD ,
       IN_N2ND_IMDG_PCK_DESC ,
       MAX_IN_PCK_QTY ,
       MAX_IN_PCK_TP_CD ,
       HCDG_PCK_RSTR_DESC ,
       HCDG_INTMD_BC_RSTR_DESC ,
       HCDG_TNK_RSTR_DESC ,
       IMDG_LMT_QTY ,
       IMDG_EXPT_QTY_CD ,
       EMS_NO ,
       CTRL_TEMP_CTNT ,
       EMER_RSPN_GID_NO ,
       EMER_RSPN_GID_CHR_NO ,
       EMER_TEMP_CTNT ,
       CNEE_DTL_DESC ,
       NET_EXPLO_WGT ,
       RADA_SKD_NO ,
       RADA_AMT ,
       RADA_UT_CD ,
       RADA_TRSP_NO ,
       SPCL_CGO_CATE_CD ,
       AUTH_OFC_CD ,
       AUTH_USR_ID ,
       IMDG_CO_GRP_CD ,
       MEAS_QTY ,
       MEAS_TP_CD ,
       PCK_QTY ,
       PCK_TP_CD ,
       CLOD_FLG ,
       SPCL_STWG_RQST_DESC ,
       CGO_LCL_FLG ,
       IMDG_LMT_QTY_MEAS_UT_CD ,
       IMDG_COMP_GRP_CD ,
       HCDG_FLG ,
       IMDG_SUBS_RSK_LBL_RMK ,
       IMDG_SPCL_PROVI_NO ,
       NET_WGT_SUM ,
       DCGO_REF_NO ,
       EML_SND_HIS_FLG ,
       PRNR_CGO_RQST_SEQ ,
       ITM_STS_CD ,
       IMDG_AMDT_NO ,
       EDI_UNMAP_DTL_CD
FROM(    
    SELECT		RANK() OVER (ORDER BY XX.ETA_DT , XX.CGO_OPR_CD , XX.VSL_CD , XX.SKD_VOY_NO , XX.SKD_DIR_CD , XX.POL_CD , XX.POD_CD , XX.BKG_REF_NO ) AS RNK 
            ,   MIN(XX.SPCL_CGO_SEQ) OVER(PARTITION BY XX.ETA_DT , XX.CGO_OPR_CD , XX.VSL_CD , XX.SKD_VOY_NO , XX.SKD_DIR_CD , XX.POL_CD , XX.POD_CD , XX.BKG_REF_NO, XX.SPCL_CGO_RQST_SEQ, XX.SPCL_CNTR_SEQ ) SPCL_CGO_SEQ_1
            ,   COUNT(*) OVER(PARTITION BY XX.ETA_DT , XX.CGO_OPR_CD , XX.VSL_CD , XX.SKD_VOY_NO , XX.SKD_DIR_CD , XX.POL_CD , XX.POD_CD , XX.BKG_REF_NO, XX.SPCL_CGO_RQST_SEQ, XX.SPCL_CNTR_SEQ ) SPCL_CGO_QTY
            ,   XX.DG_FLG
            ,	XX.AWK_FLG
            ,	XX.RGN_SHP_OPR_CD
            ,	XX.EDI_TRSM_STS_CD
            ,	XX.SRC_TP_CD
            ,	XX.VSL_CD
            ,	XX.VSL_NM
            ,	XX.SKD_VOY_NO
            ,	XX.SKD_DIR_CD
            ,	XX.SLAN_CD
            ,	XX.CRR_CD
            ,	XX.CGO_OPR_CD
            ,	XX.POL_CD
            ,	XX.POL_CLPT_IND_SEQ
            ,	XX.ETA_DT
            ,	XX.POD_CD
            ,	XX.POD_CLPT_IND_SEQ
            ,	XX.BKG_REF_NO
            ,	XX.SPCL_CGO_RQST_SEQ
            ,	XX.SPCL_CNTR_SEQ
            ,	XX.SPCL_CGO_SEQ
            ,	XX.AUTH_STS_CD
            ,	XX.APRO_REF_NO
            ,	XX.SPCL_CGO_AUTH_RJCT_CD
            ,	XX.SPCL_CGO_AUTH_RMK
            ,	XX.CNTR_TPSZ_CD
            ,	XX.CMDT_DESC
            ,	XX.TTL_DIM_LEN
            ,	XX.TTL_DIM_WDT
            ,	XX.TTL_DIM_HGT
            ,	XX.FWRD_OVR_DIM_LEN
            ,	XX.BKWD_OVR_DIM_LEN
            ,	XX.LF_SD_OVR_DIM_LEN
            ,	XX.RT_SD_OVR_DIM_LEN
            ,	XX.HGT_OVR_DIM_LEN
            ,	XX.IMDG_UN_NO
            ,	XX.IMDG_SEGR_GRP_NM
            ,	XX.IMDG_SEGR_GRP_NO
            ,	XX.IMDG_UN_NO_SEQ
            ,	XX.IMDG_CLSS_CD
            ,	XX.N1ST_IMDG_SUBS_RSK_LBL_CD
            ,	XX.N2ND_IMDG_SUBS_RSK_LBL_CD
            ,	XX.N3RD_IMDG_SUBS_RSK_LBL_CD
            ,	XX.N4TH_IMDG_SUBS_RSK_LBL_CD
            ,	XX.IMDG_SUBS_RSK_LBL_CD
            ,	XX.MRN_POLUT_FLG
            ,	XX.IMDG_PCK_GRP_CD
            ,	XX.IMDG_LMT_QTY_FLG
            ,	XX.IMDG_EXPT_QTY_FLG
            ,	XX.RSD_FLG
            ,	XX.FLSH_PNT_CDO_TEMP
            ,	XX.GRS_WGT
            ,	XX.NET_WGT
            ,	XX.VOID_SLT_QTY
            ,	XX.PSA_NO
            ,	XX.CGO_RQST_DT
            ,	XX.AUTH_DT
            ,	XX.CRE_USR_ID
            ,	XX.UPD_USR_ID
            ,	XX.UPD_DT
            ,	XX.SCG_FLG
            ,	XX.AUTH_FLG
            ,	XX.SLAN_CD1
            ,	XX.BOOKING_NO
            ,	XX.STS_CT
            ,	XX.FROM_ETA_DT
            ,	XX.TO_ETA_DT
            ,	XX.CNTR_REF_NO
            ,	XX.WGT_UT_CD
            ,	XX.WGT_UT_CD2
            ,	XX.PRP_SHP_NM
            ,	XX.HZD_DESC
            ,	XX.DCGO_STS_CD
            ,	XX.EMER_CNTC_PHN_NO
            ,	XX.EMER_CNTC_PSON_NM
            ,	XX.CERTI_NO
            ,	XX.DIFF_RMK
            ,	XX.OUT_N1ST_IMDG_PCK_QTY
            ,	XX.OUT_N1ST_IMDG_PCK_CD
            ,	XX.OUT_N1ST_IMDG_PCK_DESC
            ,	XX.OUT_N2ND_IMDG_PCK_QTY
            ,	XX.OUT_N2ND_IMDG_PCK_CD
            ,	XX.OUT_N2ND_IMDG_PCK_DESC
            ,	XX.IN_N1ST_IMDG_PCK_QTY
            ,	XX.IN_N1ST_IMDG_PCK_CD
            ,	XX.IN_N1ST_IMDG_PCK_DESC
            ,	XX.IN_N2ND_IMDG_PCK_QTY
            ,	XX.IN_N2ND_IMDG_PCK_CD
            ,	XX.IN_N2ND_IMDG_PCK_DESC
            ,	XX.MAX_IN_PCK_QTY
            ,	XX.MAX_IN_PCK_TP_CD
            ,	XX.HCDG_PCK_RSTR_DESC
            ,	XX.HCDG_INTMD_BC_RSTR_DESC
            ,	XX.HCDG_TNK_RSTR_DESC
            ,	XX.IMDG_LMT_QTY
            ,	XX.IMDG_EXPT_QTY_CD
            ,	XX.EMS_NO
            ,	XX.CTRL_TEMP_CTNT
            ,	XX.EMER_RSPN_GID_NO
            ,	XX.EMER_RSPN_GID_CHR_NO
            ,	XX.EMER_TEMP_CTNT
            ,	XX.CNEE_DTL_DESC
            ,	XX.NET_EXPLO_WGT
            ,	XX.RADA_SKD_NO
            ,	XX.RADA_AMT
            ,	XX.RADA_UT_CD
            ,	XX.RADA_TRSP_NO
            ,	XX.SPCL_CGO_CATE_CD
            ,	XX.AUTH_OFC_CD
            ,	XX.AUTH_USR_ID
            ,	XX.IMDG_CO_GRP_CD
            ,	XX.MEAS_QTY
            ,	XX.MEAS_TP_CD
            ,	XX.PCK_QTY
            ,	XX.PCK_TP_CD
            ,	XX.CLOD_FLG
            ,	XX.SPCL_STWG_RQST_DESC
            ,	XX.CGO_LCL_FLG
            ,  	XX.IMDG_LMT_QTY_MEAS_UT_CD
            ,  	XX.IMDG_COMP_GRP_CD
            ,  	XX.HCDG_FLG
            ,  	XX.IMDG_SUBS_RSK_LBL_RMK
            ,  	XX.IMDG_SPCL_PROVI_NO
            ,  	XX.NET_WGT_SUM
            ,  	XX.DCGO_REF_NO
            ,  	XX.EML_SND_HIS_FLG
            ,  	XX.PRNR_CGO_RQST_SEQ
            ,  	CASE 	WHEN XX.IS_APRO_HIST 		IS NULL 			THEN '' 	-- all new item   --
                        WHEN XX.LST_APRO_DCGO_ITM 	IS NULL				THEN 'N' 	-- new added item --
                        WHEN XX.LST_APRO_DCGO_ITM 	<> XX.CUR_DCGO_ITM 	THEN 'U' 	-- unchanged item --            		
                        WHEN XX.LST_APRO_DCGO_ITM 	=  XX.CUR_DCGO_ITM 	THEN '' 	-- unchanged item --
                END		AS ITM_STS_CD
            ,       XX.IMDG_AMDT_NO
            ,   XX.CGO_UNMAP_DTL_CD AS EDI_UNMAP_DTL_CD
            --,   MAX(CGO_UNMAP_DTL_CD||UNMAP_DTL_CD) OVER(PARTITION BY CRR_CD, BKG_REF_NO, SPCL_CGO_RQST_SEQ, PRNR_CGO_RQST_SEQ) UNMAP
    FROM   (
         --=============================================================================
         --=============================================================================

    SELECT 		
        RANK() OVER (ORDER BY RQS.ETA_DT , CGO.CGO_OPR_CD ,RQS.VSL_CD ,RQS.SKD_VOY_NO ,RQS.SKD_DIR_CD ,RQS.POL_CD ,RQS.POD_CD ,RQS.BKG_REF_NO  ) AS RNK
    ,	(  SELECT      MAX(T2.IMDG_CLSS_CD||T2.IMDG_UN_NO||T2.IMDG_UN_NO_SEQ||T2.PRP_SHP_NM||T2.HZD_DESC||T2.GRS_WGT||T2.NET_WGT||T2.IMDG_PCK_GRP_CD||T2.PSA_NO||T2.FLSH_PNT_CDO_TEMP||T2.EMS_NO||T2.MRN_POLUT_FLG||T2.EMER_CNTC_PHN_NO||T2.EMER_CNTC_PSON_NM||T2.CERTI_NO||T2.NET_EXPLO_WGT||T2.OUT_N1ST_IMDG_PCK_QTY||T2.OUT_N1ST_IMDG_PCK_CD||T2.OUT_N2ND_IMDG_PCK_QTY||T2.OUT_N2ND_IMDG_PCK_CD||T2.IN_N1ST_IMDG_PCK_QTY||T2.IN_N1ST_IMDG_PCK_CD||T2.IN_N2ND_IMDG_PCK_QTY||T2.IN_N2ND_IMDG_PCK_CD)
                       FROM        SCG_PRNR_APRO_RQST     T1
                              ,    SCG_PRNR_APRO_RQST_CGO T2
                       WHERE       1 = 1
                       AND         T1.CRR_CD              = T2.CRR_CD
                       AND         T1.BKG_REF_NO          = T2.BKG_REF_NO
                       AND         T1.PRNR_CGO_RQST_SEQ   = T2.PRNR_CGO_RQST_SEQ
                       AND         T1.SPCL_CGO_RQST_SEQ   = T2.SPCL_CGO_RQST_SEQ
                       AND         T1.CRR_CD              = RQS.CRR_CD
                       AND         T1.BKG_REF_NO          = RQS.BKG_REF_NO
                       AND         T1.VSL_CD              = RQS.VSL_CD
                       AND         T1.SKD_VOY_NO          = RQS.SKD_VOY_NO
                       AND         T1.SKD_DIR_CD          = RQS.SKD_DIR_CD
                       AND         T1.POL_CD              = RQS.POL_CD
                       AND         T1.POD_CD              = RQS.POD_CD
                       ---------------------------------------------------
                       AND         T2.CGO_OPR_CD          = CGO.CGO_OPR_CD
                       ---------------------------------------------------
                       AND         T1.DG_FLG              = 'Y'                   
                       AND         T2.AUTH_STS_CD         IN ('Y','N')
        ) AS IS_APRO_HIST

    ,	(  SELECT      MAX(T2.IMDG_CLSS_CD||T2.IMDG_UN_NO||T2.IMDG_UN_NO_SEQ||T2.PRP_SHP_NM||T2.HZD_DESC||T2.GRS_WGT||T2.NET_WGT||T2.IMDG_PCK_GRP_CD||T2.PSA_NO||T2.FLSH_PNT_CDO_TEMP||T2.EMS_NO||T2.MRN_POLUT_FLG||T2.EMER_CNTC_PHN_NO||T2.EMER_CNTC_PSON_NM||T2.CERTI_NO||T2.NET_EXPLO_WGT||T2.OUT_N1ST_IMDG_PCK_QTY||T2.OUT_N1ST_IMDG_PCK_CD||T2.OUT_N2ND_IMDG_PCK_QTY||T2.OUT_N2ND_IMDG_PCK_CD||T2.IN_N1ST_IMDG_PCK_QTY||T2.IN_N1ST_IMDG_PCK_CD||T2.IN_N2ND_IMDG_PCK_QTY||T2.IN_N2ND_IMDG_PCK_CD)
                       FROM        SCG_PRNR_APRO_RQST     T1
                              ,    SCG_PRNR_APRO_RQST_CGO T2
                       WHERE       1 = 1
                       AND         T1.CRR_CD              = T2.CRR_CD
                       AND         T1.BKG_REF_NO          = T2.BKG_REF_NO
                       AND         T1.PRNR_CGO_RQST_SEQ   = T2.PRNR_CGO_RQST_SEQ
                       AND         T1.SPCL_CGO_RQST_SEQ   = T2.SPCL_CGO_RQST_SEQ
                       AND         T1.CRR_CD              = RQS.CRR_CD
                       AND         T1.BKG_REF_NO          = RQS.BKG_REF_NO
                       AND         T1.VSL_CD              = RQS.VSL_CD
                       AND         T1.SKD_VOY_NO          = RQS.SKD_VOY_NO
                       AND         T1.SKD_DIR_CD          = RQS.SKD_DIR_CD
                       AND         T1.POL_CD              = RQS.POL_CD
                       AND         T1.POD_CD              = RQS.POD_CD
                       ---------------------------------------------------
                       AND         T2.CGO_OPR_CD          = CGO.CGO_OPR_CD
                       ---------------------------------------------------
                       AND         T1.DG_FLG              = 'Y'                   
                       AND         T2.AUTH_STS_CD         IN ('Y','N')
                       AND         T2.DCGO_SEQ            = CGO.DCGO_SEQ
                   
                       --AND       T2.SPCL_CNTR_SEQ       = CGO.SPCL_CNTR_SEQ
                       --AND       T2.SPCL_CGO_SEQ        = CGO.SPCL_CGO_SEQ
                   
                       AND         T1.SPCL_CGO_RQST_SEQ   = (	SELECT  MAX(T21.SPCL_CGO_RQST_SEQ)
                                                                FROM    SCG_PRNR_APRO_RQST     T11
                                                                    , 	SCG_PRNR_APRO_RQST_CGO T21
                                                                WHERE   1 = 1
                                                                AND     T11.CRR_CD              = T21.CRR_CD
                                                                AND     T11.BKG_REF_NO          = T21.BKG_REF_NO
                                                                AND     T11.PRNR_CGO_RQST_SEQ   = T21.PRNR_CGO_RQST_SEQ
                                                                AND     T11.SPCL_CGO_RQST_SEQ   = T21.SPCL_CGO_RQST_SEQ
                                                                AND     T11.DG_FLG              = 'Y'
                                                                AND     T21.CRR_CD              = T1.CRR_CD
                                                                AND     T21.BKG_REF_NO          = T1.BKG_REF_NO
                                                                -------------------------------------------------
                                                                AND     T11.VSL_CD              = T1.VSL_CD
                                                                AND     T11.SKD_VOY_NO          = T1.SKD_VOY_NO
                                                                AND     T11.SKD_DIR_CD          = T1.SKD_DIR_CD
                                                                AND     T11.POL_CD              = T1.POL_CD
                                                                AND     T11.POD_CD              = T1.POD_CD
                                                                AND     T21.CGO_OPR_CD          = T2.CGO_OPR_CD
                                                                -------------------------------------------------
                                                                AND     T21.AUTH_STS_CD        	IN ('Y','N')
                                                            )      
        ) AS LST_APRO_DCGO_ITM

    ,	(CGO.IMDG_CLSS_CD||CGO.IMDG_UN_NO||CGO.IMDG_UN_NO_SEQ||CGO.PRP_SHP_NM||CGO.HZD_DESC||CGO.GRS_WGT||CGO.NET_WGT||CGO.IMDG_PCK_GRP_CD||CGO.PSA_NO||CGO.FLSH_PNT_CDO_TEMP||CGO.EMS_NO||CGO.MRN_POLUT_FLG||CGO.EMER_CNTC_PHN_NO||CGO.EMER_CNTC_PSON_NM||CGO.CERTI_NO||CGO.NET_EXPLO_WGT||CGO.OUT_N1ST_IMDG_PCK_QTY||CGO.OUT_N1ST_IMDG_PCK_CD||CGO.OUT_N2ND_IMDG_PCK_QTY||CGO.OUT_N2ND_IMDG_PCK_CD||CGO.IN_N1ST_IMDG_PCK_QTY||CGO.IN_N1ST_IMDG_PCK_CD||CGO.IN_N2ND_IMDG_PCK_QTY||CGO.IN_N2ND_IMDG_PCK_CD) 
        AS CUR_DCGO_ITM
                
    ,   RQS.DG_FLG 
    ,   RQS.AWK_FLG 
    ,   RQS.RGN_SHP_OPR_CD
    ,   RQS.MAPG_EDI_TRSM_STS_CD EDI_TRSM_STS_CD
    ,   RQS.SRC_TP_CD
    ,   RQS.VSL_CD
    ,   MDM.VSL_ENG_NM VSL_NM
    ,   RQS.SKD_VOY_NO
    ,	RQS.SKD_DIR_CD
    ,	RQS.SLAN_CD
    ,   RQS.CRR_CD
    ,	CGO.CGO_OPR_CD
    ,	RQS.POL_CD
    ,   NVL(RQS.POL_CLPT_IND_SEQ, '1')  POL_CLPT_IND_SEQ
    --,	TO_CHAR(RQS.ETA_DT, 'YYYY-MM-DD HH24:MI') ETA_DT
    , (	SELECT 	TO_CHAR(PS.VPS_ETA_DT,'YYYY-MM-DD HH24:MI') VPS_ETA_DT
		 FROM 	VSK_VSL_PORT_SKD 	PS
		 WHERE 	PS.VSL_CD       	= RQS.VSL_CD
		 AND 	PS.SKD_VOY_NO   	= RQS.SKD_VOY_NO
		 AND 	PS.SKD_DIR_CD   	= RQS.SKD_DIR_CD
         AND 	PS.VPS_PORT_CD      = RQS.POL_CD
		 --AND 	PS.CLPT_IND_SEQ 	= RQS.POL_CLPT_IND_SEQ
		 AND 	PS.CLPT_IND_SEQ 	= NVL(RQS.POL_CLPT_IND_SEQ,'1')
		 AND 	PS.CLPT_IND_SEQ 	= NVL(RQS.POL_CLPT_IND_SEQ,'1')
		) ETA_DT
    ,	RQS.POD_CD
    ,   NVL(RQS.POD_CLPT_IND_SEQ, '1') POD_CLPT_IND_SEQ
    ,	RQS.BKG_REF_NO
    ,	RQS.SPCL_CGO_RQST_SEQ
    ,	CGO.SPCL_CNTR_SEQ
    ,	CGO.SPCL_CGO_SEQ
    #if (${scg_flg} == 'AWK' || ${scg_flg} == 'SCG_AWK' || ${scg_flg} == 'SCG_45') 
    ,   CGO.AUTH_STS_CD
    #else
    ,   DECODE(CGO.AUTH_STS_CD,'R',DECODE(CGO.SPCL_RQST_FLG,'Y','S','')||'R'||CGO.SPCL_CGO_RQST_SEQ, CGO.AUTH_STS_CD) AS AUTH_STS_CD
    #end
    --,CGO.AUTH_STS_CD
    ,	DECODE(CGO.APRO_REF_NO,'0','',CGO.APRO_REF_NO) APRO_REF_NO
    ,   CGO.SPCL_CGO_AUTH_RJCT_CD                      AS SPCL_CGO_AUTH_RJCT_CD
    ,   CGO.SPCL_CGO_AUTH_RMK                          AS SPCL_CGO_AUTH_RMK
    ,	CGO.CNTR_TPSZ_CD
    ,	DECODE(CGO.CMDT_DESC,'0','',CGO.CMDT_DESC) CMDT_DESC
    ,	CGO.TTL_DIM_LEN
    ,	CGO.TTL_DIM_WDT
    ,	CGO.TTL_DIM_HGT
    ,	CGO.FWRD_OVR_DIM_LEN
    ,	CGO.BKWD_OVR_DIM_LEN
    ,	CGO.LF_SD_OVR_DIM_LEN
    ,	CGO.RT_SD_OVR_DIM_LEN
    ,	CGO.HGT_OVR_DIM_LEN
    ,	DECODE(CGO.IMDG_UN_NO,'0','',CGO.IMDG_UN_NO) IMDG_UN_NO
    ,   ( SELECT LISTAGG (X.IMDG_SEGR_GRP_NO||'|'||X.IMDG_SEGR_GRP_NM, ',') WITHIN GROUP (ORDER BY X.IMDG_SEGR_GRP_NO||'|'||X.IMDG_SEGR_GRP_NM)
            FROM SCG_IMDG_SEGR_GRP X
               , SCG_IMDG_SEGR_GRP_DTL Y
           WHERE X.IMDG_SEGR_GRP_NO = Y.IMDG_SEGR_GRP_NO
             AND Y.IMDG_UN_NO       = CGO.IMDG_UN_NO
           GROUP BY Y.IMDG_UN_NO 
        ) IMDG_SEGR_GRP_NM 
    ,       CGO.IMDG_SEGR_GRP_NO AS IMDG_SEGR_GRP_NO 
    ,	DECODE(CGO.IMDG_UN_NO_SEQ,'0','',CGO.IMDG_UN_NO_SEQ) IMDG_UN_NO_SEQ
    ,	CGO.IMDG_CLSS_CD
    ,       CGO.IMDG_AMDT_NO
    ,   DECODE(CGO.N1ST_IMDG_SUBS_RSK_LBL_CD,'0','',CGO.N1ST_IMDG_SUBS_RSK_LBL_CD) N1ST_IMDG_SUBS_RSK_LBL_CD
    ,   DECODE(CGO.N2ND_IMDG_SUBS_RSK_LBL_CD,'0','',CGO.N2ND_IMDG_SUBS_RSK_LBL_CD) N2ND_IMDG_SUBS_RSK_LBL_CD
    ,   DECODE(CGO.N3RD_IMDG_SUBS_RSK_LBL_CD,'0','',CGO.N3RD_IMDG_SUBS_RSK_LBL_CD) N3RD_IMDG_SUBS_RSK_LBL_CD
    ,   DECODE(CGO.N4TH_IMDG_SUBS_RSK_LBL_CD,'0','',CGO.N4TH_IMDG_SUBS_RSK_LBL_CD) N4TH_IMDG_SUBS_RSK_LBL_CD
    ,	(DECODE(CGO.N1ST_IMDG_SUBS_RSK_LBL_CD,'0','',CGO.N1ST_IMDG_SUBS_RSK_LBL_CD)||DECODE(NVL(CGO.N2ND_IMDG_SUBS_RSK_LBL_CD,''),'','','0','','/')
       ||DECODE(CGO.N2ND_IMDG_SUBS_RSK_LBL_CD,'0','',CGO.N2ND_IMDG_SUBS_RSK_LBL_CD)||DECODE(NVL(CGO.N3RD_IMDG_SUBS_RSK_LBL_CD,''),'','','0','','/')
       ||DECODE(CGO.N3RD_IMDG_SUBS_RSK_LBL_CD,'0','',CGO.N3RD_IMDG_SUBS_RSK_LBL_CD)||DECODE(NVL(CGO.N4TH_IMDG_SUBS_RSK_LBL_CD,''),'','','0','','/')
       ||DECODE(CGO.N4TH_IMDG_SUBS_RSK_LBL_CD,'0','',CGO.N4TH_IMDG_SUBS_RSK_LBL_CD)) IMDG_SUBS_RSK_LBL_CD
    ,	CGO.MRN_POLUT_FLG
    ,   DECODE(CGO.IMDG_PCK_GRP_CD,'1','I','2','II','3','III','') IMDG_PCK_GRP_CD
    ,	CGO.IMDG_LMT_QTY_FLG
    ,	CGO.IMDG_EXPT_QTY_FLG
    , NVL(CGO.RSD_FLG, 'N') 	AS RSD_FLG
    ,   CGO.FLSH_PNT_CDO_TEMP 	AS FLSH_PNT_CDO_TEMP
    ,	CGO.GRS_WGT
    ,	CGO.NET_WGT
    ,	CGO.VOID_SLT_QTY
    ,   DECODE(CGO.PSA_NO,'0','',CGO.PSA_NO) PSA_NO
    /* 팝업창에서 보여지는 auth_dt는 local_date로 설정됨 
    ,	TO_CHAR(NVL(GLOBALDATE_PKG.TIME_CONV_FNC(COM_ConstantMgr_PKG.COM_getBaseLocationCode_FNC(),CGO.CGO_RQST_DT,'GMT'), CGO.CGO_RQST_DT),'YYYY-MM-DD') CGO_RQST_DT
    ,	DECODE(CGO.AUTH_STS_CD,'R','',TO_CHAR(NVL(GLOBALDATE_PKG.TIME_CONV_FNC(COM_ConstantMgr_PKG.COM_getBaseLocationCode_FNC(),CGO.AUTH_DT,'GMT'),CGO.AUTH_DT),'YYYY-MM-DD')) AUTH_DT
    */
    --,	TO_CHAR(CGO.CGO_RQST_DT,'YYYY-MM-DD') CGO_RQST_DT
    ,   TO_CHAR(NVL(GLOBALDATE_PKG.TIME_CONV_FNC( GLOBALDATE_PKG.GET_LOCCD_FNC(RQS.RQST_OFC_CD), CGO_RQST_DT,'GMT'), CGO_RQST_DT),'YYYY-MM-DD HH24:MI') CGO_RQST_DT
    ,	DECODE(CGO.AUTH_STS_CD,'R','',TO_CHAR(CGO.AUTH_DT,'YYYY-MM-DD')) AUTH_DT

    ,	RQS.CRE_USR_ID
    ,	RQS.UPD_USR_ID
    ,	RQS.UPD_DT
    ,   DECODE(RQS.DG_FLG,'Y','DG','AK') SCG_FLG
    ,   CGO.AUTH_STS_CD AUTH_FLG
    ,	RQS.SLAN_CD SLAN_CD1
    ,   RQS.BKG_REF_NO BOOKING_NO
    ,   CGO.STS_CT
    ,   '' FROM_ETA_DT
    ,   '' TO_ETA_DT

    ,   DECODE(CGO.CNTR_REF_NO,'0','',CGO.CNTR_REF_NO) CNTR_REF_NO
    ,   DECODE(CGO.WGT_UT_CD,'0','KGS',CGO.WGT_UT_CD)  WGT_UT_CD
    ,   DECODE(CGO.WGT_UT_CD,'0','KGS',CGO.WGT_UT_CD)  WGT_UT_CD2
    ,   CGO.PRP_SHP_NM          PRP_SHP_NM
    ,   CGO.HZD_DESC            HZD_DESC
    ,   CGO.DCGO_STS_CD         DCGO_STS_CD
    ,   CGO.EMER_CNTC_PHN_NO    EMER_CNTC_PHN_NO
    ,   CGO.EMER_CNTC_PSON_NM   EMER_CNTC_PSON_NM
    ,   CGO.CERTI_NO            CERTI_NO
    ,   CGO.DIFF_RMK            DIFF_RMK

    ,   DECODE(CGO.OUT_N1ST_IMDG_PCK_QTY,'0','',CGO.OUT_N1ST_IMDG_PCK_QTY)                                   AS OUT_N1ST_IMDG_PCK_QTY
    ,   DECODE(CGO.OUT_N1ST_IMDG_PCK_CD,'0','',CGO.OUT_N1ST_IMDG_PCK_CD)                                     AS OUT_N1ST_IMDG_PCK_CD
    ,   (SELECT PK1.IMDG_PCK_DESC FROM SCG_IMDG_PCK_CD PK1 WHERE PK1.IMDG_PCK_CD = CGO.OUT_N1ST_IMDG_PCK_CD) AS OUT_N1ST_IMDG_PCK_DESC
    ,	DECODE(CGO.OUT_N2ND_IMDG_PCK_QTY,'0','',CGO.OUT_N2ND_IMDG_PCK_QTY)                                   AS OUT_N2ND_IMDG_PCK_QTY
    ,	DECODE(CGO.OUT_N2ND_IMDG_PCK_CD,'0','',CGO.OUT_N2ND_IMDG_PCK_CD)                                     AS OUT_N2ND_IMDG_PCK_CD
    ,   (SELECT PK2.IMDG_PCK_DESC FROM SCG_IMDG_PCK_CD PK2 WHERE PK2.IMDG_PCK_CD = CGO.OUT_N2ND_IMDG_PCK_CD) AS OUT_N2ND_IMDG_PCK_DESC
    ,	DECODE(CGO.IN_N1ST_IMDG_PCK_QTY,'0','',CGO.IN_N1ST_IMDG_PCK_QTY)                                     AS IN_N1ST_IMDG_PCK_QTY
    ,	DECODE(CGO.IN_N1ST_IMDG_PCK_CD,'0','',CGO.IN_N1ST_IMDG_PCK_CD)                                       AS IN_N1ST_IMDG_PCK_CD
    ,   (SELECT PK3.IMDG_PCK_DESC FROM SCG_IMDG_PCK_CD PK3 WHERE PK3.IMDG_PCK_CD = CGO.IN_N1ST_IMDG_PCK_CD)  AS IN_N1ST_IMDG_PCK_DESC
    ,	DECODE(CGO.IN_N2ND_IMDG_PCK_QTY,'0','',CGO.IN_N2ND_IMDG_PCK_QTY)                                     AS IN_N2ND_IMDG_PCK_QTY
    ,	DECODE(CGO.IN_N2ND_IMDG_PCK_CD,'0','',CGO.IN_N2ND_IMDG_PCK_CD)                                       AS IN_N2ND_IMDG_PCK_CD
    ,   (SELECT PK4.IMDG_PCK_DESC FROM SCG_IMDG_PCK_CD PK4 WHERE PK4.IMDG_PCK_CD = CGO.IN_N2ND_IMDG_PCK_CD)  AS IN_N2ND_IMDG_PCK_DESC
    ,	CGO.MAX_IN_PCK_QTY                                                                                   AS MAX_IN_PCK_QTY
    ,	CGO.MAX_IN_PCK_TP_CD                                                                                 AS MAX_IN_PCK_TP_CD
    ,   SUN.HCDG_PCK_RSTR_DESC                                                                               AS HCDG_PCK_RSTR_DESC     
    ,   SUN.HCDG_INTMD_BC_RSTR_DESC                                                                          AS HCDG_INTMD_BC_RSTR_DESC
    ,   SUN.HCDG_TNK_RSTR_DESC                                                                               AS HCDG_TNK_RSTR_DESC     
    ,   SUN.IMDG_LMT_QTY                                                                                     AS IMDG_LMT_QTY   
    ,   SUN.IMDG_EXPT_QTY_CD                                                                                 AS IMDG_EXPT_QTY_CD  

    ,	CGO.EMS_NO                                       AS EMS_NO
    ,	CGO.CTRL_TEMP_CTNT                       AS CTRL_TEMP_CTNT
    ,	CGO.EMER_RSPN_GID_NO                   AS EMER_RSPN_GID_NO
    ,	CGO.EMER_RSPN_GID_CHR_NO           AS EMER_RSPN_GID_CHR_NO
    ,	CGO.EMER_TEMP_CTNT                       AS EMER_TEMP_CTNT

    ,	CGO.CNEE_DTL_DESC                              AS CNEE_DTL_DESC
    ,	CGO.NET_EXPLO_WGT                              AS NET_EXPLO_WGT
    ,	CGO.RADA_SKD_NO                                AS RADA_SKD_NO
    ,	CGO.RADA_AMT                                   AS RADA_AMT
    ,	CGO.RADA_UT_CD                                 AS RADA_UT_CD  
    ,	CGO.RADA_TRSP_NO                               AS RADA_TRSP_NO
    ,	CGO.SPCL_CGO_CATE_CD                           AS SPCL_CGO_CATE_CD
    ,	CGO.AUTH_OFC_CD                                AS AUTH_OFC_CD
    ,	CGO.AUTH_USR_ID                                AS AUTH_USR_ID
    ,	CGO.IMDG_CO_GRP_CD                             AS IMDG_CO_GRP_CD
    ,	CGO.MEAS_QTY                                   AS MEAS_QTY
    ,	CGO.MEAS_TP_CD                                 AS MEAS_TP_CD
    ,	CGO.PCK_QTY                                    AS PCK_QTY
    ,	CGO.PCK_TP_CD                                  AS PCK_TP_CD
    ,	CGO.CLOD_FLG                                   AS CLOD_FLG
    ,	CGO.SPCL_STWG_RQST_DESC                        AS SPCL_STWG_RQST_DESC
    ,	CGO.CGO_LCL_FLG                                AS CGO_LCL_FLG
    ,   SUN.IMDG_LMT_QTY_MEAS_UT_CD                    AS IMDG_LMT_QTY_MEAS_UT_CD
    ,   SUN.IMDG_COMP_GRP_CD                           AS IMDG_COMP_GRP_CD
    ,   SUN.HCDG_FLG                                   AS HCDG_FLG
    ,   SUN.IMDG_SUBS_RSK_LBL_RMK                      AS IMDG_SUBS_RSK_LBL_RMK
    ,   (
         SELECT SP.IMDG_SPCL_PROVI_NO 
           FROM SCG_IMDG_UN_NO_SPCL_PROVI SP 
          WHERE SP.IMDG_UN_NO     = CGO.IMDG_UN_NO
            AND SP.IMDG_UN_NO_SEQ = CGO.IMDG_UN_NO_SEQ 
            AND SP.IMDG_SPCL_PROVI_NO = 274
         ) AS IMDG_SPCL_PROVI_NO 
    ,   SCG_GET_MPA1_NET_FNC(RQS.VSL_CD, RQS.SKD_VOY_NO, RQS.SKD_DIR_CD, RQS.POL_CD, RQS.POD_CD, CGO.IMDG_CLSS_CD) AS NET_WGT_SUM
    ,   CGO.DCGO_REF_NO                                AS DCGO_REF_NO

    ,   CASE WHEN (SELECT COUNT(1) 
                   FROM   SCG_PRNR_APRO_RQST  RQ
                        , COM_EML_SND_INFO    EM
                   WHERE  1 = 1
                   AND    RQ.EML_SND_NO       = EM.EML_SND_NO
                   AND    EM.EML_PROC_STS_CD  = '1'           -- ::'1'-'W','3'-'Y','4'-'F':: --
                   AND    RQ.CRR_CD           = RQS.CRR_CD
                   AND    RQ.BKG_REF_NO       = RQS.BKG_REF_NO
                   AND    RQ.VSL_CD           = RQS.VSL_CD
                   AND    RQ.SKD_VOY_NO       = RQS.SKD_VOY_NO
                   AND    RQ.SKD_DIR_CD       = RQS.SKD_DIR_CD
                   AND	  RQ.POL_CD			  = RQS.POL_CD
                   AND	  RQ.POD_CD			  = RQS.POD_CD
                   ) > 0  THEN 'W'
             WHEN (SELECT COUNT(1) 
                   FROM   SCG_PRNR_APRO_RQST  RQ
                        , COM_EML_SND_INFO    EM
                   WHERE  1 = 1
                   AND    RQ.EML_SND_NO       = EM.EML_SND_NO
                   AND    EM.EML_PROC_STS_CD  = '3'           -- ::'1'-'W','3'-'Y','4'-'F':: --
                   AND    RQ.CRR_CD           = RQS.CRR_CD
                   AND    RQ.BKG_REF_NO       = RQS.BKG_REF_NO
                   AND    RQ.VSL_CD           = RQS.VSL_CD
                   AND    RQ.SKD_VOY_NO       = RQS.SKD_VOY_NO
                   AND    RQ.SKD_DIR_CD       = RQS.SKD_DIR_CD
                   AND	  RQ.POL_CD			  = RQS.POL_CD
                   AND	  RQ.POD_CD			  = RQS.POD_CD
                   ) > 0  THEN 'Y'
             WHEN (SELECT COUNT(1) 
                   FROM   SCG_PRNR_APRO_RQST  RQ
                        , COM_EML_SND_INFO    EM
                   WHERE  1 = 1
                   AND    RQ.EML_SND_NO       = EM.EML_SND_NO
                   AND    EM.EML_PROC_STS_CD  = '4'           -- ::'1'-'W','3'-'Y','4'-'F':: --
                   AND    RQ.CRR_CD           = RQS.CRR_CD
                   AND    RQ.BKG_REF_NO       = RQS.BKG_REF_NO
                   AND    RQ.VSL_CD           = RQS.VSL_CD
                   AND    RQ.SKD_VOY_NO       = RQS.SKD_VOY_NO
                   AND    RQ.SKD_DIR_CD       = RQS.SKD_DIR_CD
                   AND	  RQ.POL_CD			  = RQS.POL_CD
                   AND	  RQ.POD_CD			  = RQS.POD_CD
                   ) > 0  THEN 'F'
              ELSE ''
         END  EML_SND_HIS_FLG

    ,	CASE	WHEN	( 	SELECT      COUNT(T1.BKG_REF_NO)
                            FROM        SCG_PRNR_APRO_RQST     T1
                                    ,   SCG_PRNR_APRO_RQST_CGO T2
                            WHERE       1 = 1
                            AND         T1.CRR_CD              = T2.CRR_CD
                            AND         T1.BKG_REF_NO          = T2.BKG_REF_NO
                            AND         T1.PRNR_CGO_RQST_SEQ   = T2.PRNR_CGO_RQST_SEQ
                            AND         T1.SPCL_CGO_RQST_SEQ   = T2.SPCL_CGO_RQST_SEQ
                            AND         T1.CRR_CD              = RQS.CRR_CD
                            AND         T1.BKG_REF_NO          = RQS.BKG_REF_NO
                            AND         T1.VSL_CD              = RQS.VSL_CD
                            AND         T1.SKD_VOY_NO          = RQS.SKD_VOY_NO
                            AND         T1.SKD_DIR_CD          = RQS.SKD_DIR_CD
                            AND         T1.POL_CD              = RQS.POL_CD
                            AND         T1.POD_CD              = RQS.POD_CD
                            ---------------------------------------------------
                            AND         T2.CGO_OPR_CD          = CGO.CGO_OPR_CD
                            ---------------------------------------------------
                            AND         T1.DG_FLG              = 'Y'                   
                            AND         T2.AUTH_STS_CD         IN ('Y','N')
                        )	= 0 THEN ''   -- all new item --
                
                ELSE  	

                    CASE WHEN (	SELECT    	MAX(T2.IMDG_CLSS_CD||T2.IMDG_UN_NO||T2.IMDG_UN_NO_SEQ||T2.PRP_SHP_NM||T2.HZD_DESC||T2.GRS_WGT||T2.NET_WGT||T2.IMDG_PCK_GRP_CD||T2.PSA_NO||T2.FLSH_PNT_CDO_TEMP||T2.EMS_NO||T2.MRN_POLUT_FLG||T2.EMER_CNTC_PHN_NO||T2.EMER_CNTC_PSON_NM||T2.CERTI_NO||T2.NET_EXPLO_WGT||T2.OUT_N1ST_IMDG_PCK_QTY||T2.OUT_N1ST_IMDG_PCK_CD||T2.OUT_N2ND_IMDG_PCK_QTY||T2.OUT_N2ND_IMDG_PCK_CD||T2.IN_N1ST_IMDG_PCK_QTY||T2.IN_N1ST_IMDG_PCK_CD||T2.IN_N2ND_IMDG_PCK_QTY||T2.IN_N2ND_IMDG_PCK_CD)
                                FROM      	SCG_PRNR_APRO_RQST     T1
                                        ,  	SCG_PRNR_APRO_RQST_CGO T2
                                WHERE     1 = 1
                                AND       T1.CRR_CD              = T2.CRR_CD
                                AND       T1.BKG_REF_NO          = T2.BKG_REF_NO
                                AND       T1.PRNR_CGO_RQST_SEQ   = T2.PRNR_CGO_RQST_SEQ
                                AND       T1.SPCL_CGO_RQST_SEQ   = T2.SPCL_CGO_RQST_SEQ
                                AND       T1.DG_FLG              = 'Y'
                                AND       T1.CRR_CD              = RQS.CRR_CD
                                AND       T1.BKG_REF_NO          = RQS.BKG_REF_NO
                                AND       T1.VSL_CD              = RQS.VSL_CD
                                AND       T1.SKD_VOY_NO          = RQS.SKD_VOY_NO
                                AND       T1.SKD_DIR_CD          = RQS.SKD_DIR_CD
                                AND       T1.POL_CD              = RQS.POL_CD
                                AND       T1.POD_CD              = RQS.POD_CD
                                ---------------------------------------------------
                                AND       T2.CGO_OPR_CD          = CGO.CGO_OPR_CD
                                ---------------------------------------------------
                                AND       T2.DCGO_SEQ            = CGO.DCGO_SEQ
                   
                                --AND       T2.SPCL_CNTR_SEQ       = CGO.SPCL_CNTR_SEQ
                                --AND       T2.SPCL_CGO_SEQ        = CGO.SPCL_CGO_SEQ
                   
                                AND       T1.SPCL_CGO_RQST_SEQ   = (SELECT  MAX(T21.SPCL_CGO_RQST_SEQ)
                                                                    FROM    SCG_PRNR_APRO_RQST     T11
                                                                        ,	SCG_PRNR_APRO_RQST_CGO T21
                                                                    WHERE   1 = 1
                                                                    AND     T11.CRR_CD              = T21.CRR_CD
                                                                    AND     T11.BKG_REF_NO          = T21.BKG_REF_NO
                                                                    AND     T11.PRNR_CGO_RQST_SEQ   = T21.PRNR_CGO_RQST_SEQ
                                                                    AND     T11.SPCL_CGO_RQST_SEQ   = T21.SPCL_CGO_RQST_SEQ
                                                                    AND     T11.DG_FLG              = 'Y'
                                                                    AND     T21.CRR_CD              = T1.CRR_CD
                                                                    AND     T21.BKG_REF_NO          = T1.BKG_REF_NO
                                                                    -------------------------------------------------
                                                                    AND     T11.VSL_CD              = T1.VSL_CD
                                                                    AND     T11.SKD_VOY_NO          = T1.SKD_VOY_NO
                                                                    AND     T11.SKD_DIR_CD          = T1.SKD_DIR_CD
                                                                    AND     T11.POL_CD              = T1.POL_CD
                                                                    AND     T11.POD_CD              = T1.POD_CD
                                                                    AND     T21.CGO_OPR_CD          = T2.CGO_OPR_CD
                                                                    -------------------------------------------------
                                                                    AND     T21.AUTH_STS_CD        IN ('Y','N')
                                                                    )    
                            )
                            <>
                            (CGO.IMDG_CLSS_CD||CGO.IMDG_UN_NO||CGO.IMDG_UN_NO_SEQ||CGO.PRP_SHP_NM||CGO.HZD_DESC||CGO.GRS_WGT||CGO.NET_WGT||CGO.IMDG_PCK_GRP_CD||CGO.PSA_NO||CGO.FLSH_PNT_CDO_TEMP||CGO.EMS_NO||CGO.MRN_POLUT_FLG||CGO.EMER_CNTC_PHN_NO||CGO.EMER_CNTC_PSON_NM||CGO.CERTI_NO||CGO.NET_EXPLO_WGT||CGO.OUT_N1ST_IMDG_PCK_QTY||CGO.OUT_N1ST_IMDG_PCK_CD||CGO.OUT_N2ND_IMDG_PCK_QTY||CGO.OUT_N2ND_IMDG_PCK_CD||CGO.IN_N1ST_IMDG_PCK_QTY||CGO.IN_N1ST_IMDG_PCK_CD||CGO.IN_N2ND_IMDG_PCK_QTY||CGO.IN_N2ND_IMDG_PCK_CD) 
                            THEN 'U' 
                        WHEN (	SELECT    	MAX(T2.IMDG_CLSS_CD||T2.IMDG_UN_NO||T2.IMDG_UN_NO_SEQ||T2.PRP_SHP_NM||T2.HZD_DESC||T2.GRS_WGT||T2.NET_WGT||T2.IMDG_PCK_GRP_CD||T2.PSA_NO||T2.FLSH_PNT_CDO_TEMP||T2.EMS_NO||T2.MRN_POLUT_FLG||T2.EMER_CNTC_PHN_NO||T2.EMER_CNTC_PSON_NM||T2.CERTI_NO||T2.NET_EXPLO_WGT||T2.OUT_N1ST_IMDG_PCK_QTY||T2.OUT_N1ST_IMDG_PCK_CD||T2.OUT_N2ND_IMDG_PCK_QTY||T2.OUT_N2ND_IMDG_PCK_CD||T2.IN_N1ST_IMDG_PCK_QTY||T2.IN_N1ST_IMDG_PCK_CD||T2.IN_N2ND_IMDG_PCK_QTY||T2.IN_N2ND_IMDG_PCK_CD)
                                FROM      	SCG_PRNR_APRO_RQST     T1
                                        ,  	SCG_PRNR_APRO_RQST_CGO T2
                                WHERE     1 = 1
                                AND       T1.CRR_CD              = T2.CRR_CD
                                AND       T1.BKG_REF_NO          = T2.BKG_REF_NO
                                AND       T1.PRNR_CGO_RQST_SEQ   = T2.PRNR_CGO_RQST_SEQ
                                AND       T1.SPCL_CGO_RQST_SEQ   = T2.SPCL_CGO_RQST_SEQ
                                AND       T1.DG_FLG              = 'Y'
                                AND       T1.CRR_CD              = RQS.CRR_CD
                                AND       T1.BKG_REF_NO          = RQS.BKG_REF_NO
                                AND       T1.VSL_CD              = RQS.VSL_CD
                                AND       T1.SKD_VOY_NO          = RQS.SKD_VOY_NO
                                AND       T1.SKD_DIR_CD          = RQS.SKD_DIR_CD
                                AND       T1.POL_CD              = RQS.POL_CD
                                AND       T1.POD_CD              = RQS.POD_CD
                                ---------------------------------------------------
                                AND       T2.CGO_OPR_CD          = CGO.CGO_OPR_CD
                                ---------------------------------------------------
                                AND       T2.DCGO_SEQ            = CGO.DCGO_SEQ
                   
                                --AND       T2.SPCL_CNTR_SEQ       = CGO.SPCL_CNTR_SEQ
                                --AND       T2.SPCL_CGO_SEQ        = CGO.SPCL_CGO_SEQ
                   
                                AND       T1.SPCL_CGO_RQST_SEQ   = (SELECT  MAX(T21.SPCL_CGO_RQST_SEQ)
                                                                    FROM    SCG_PRNR_APRO_RQST     T11
                                                                        , 	SCG_PRNR_APRO_RQST_CGO T21
                                                                    WHERE   1 = 1
                                                                    AND     T11.CRR_CD              = T21.CRR_CD
                                                                    AND     T11.BKG_REF_NO          = T21.BKG_REF_NO
                                                                    AND     T11.PRNR_CGO_RQST_SEQ   = T21.PRNR_CGO_RQST_SEQ
                                                                    AND     T11.SPCL_CGO_RQST_SEQ   = T21.SPCL_CGO_RQST_SEQ
                                                                    AND     T11.DG_FLG              = 'Y'
                                                                    AND     T21.CRR_CD              = T1.CRR_CD
                                                                    AND     T21.BKG_REF_NO          = T1.BKG_REF_NO
                                                                    -------------------------------------------------
                                                                    AND     T11.VSL_CD              = T1.VSL_CD
                                                                    AND     T11.SKD_VOY_NO          = T1.SKD_VOY_NO
                                                                    AND     T11.SKD_DIR_CD          = T1.SKD_DIR_CD
                                                                    AND     T11.POL_CD              = T1.POL_CD
                                                                    AND     T11.POD_CD              = T1.POD_CD
                                                                    AND     T21.CGO_OPR_CD          = T2.CGO_OPR_CD
                                                                    -------------------------------------------------
                                                                    AND     T21.AUTH_STS_CD        IN ('Y','N')
                                                                    )    
                            )
                            =
                            (CGO.IMDG_CLSS_CD||CGO.IMDG_UN_NO||CGO.IMDG_UN_NO_SEQ||CGO.PRP_SHP_NM||CGO.HZD_DESC||CGO.GRS_WGT||CGO.NET_WGT||CGO.IMDG_PCK_GRP_CD||CGO.PSA_NO||CGO.FLSH_PNT_CDO_TEMP||CGO.EMS_NO||CGO.MRN_POLUT_FLG||CGO.EMER_CNTC_PHN_NO||CGO.EMER_CNTC_PSON_NM||CGO.CERTI_NO||CGO.NET_EXPLO_WGT||CGO.OUT_N1ST_IMDG_PCK_QTY||CGO.OUT_N1ST_IMDG_PCK_CD||CGO.OUT_N2ND_IMDG_PCK_QTY||CGO.OUT_N2ND_IMDG_PCK_CD||CGO.IN_N1ST_IMDG_PCK_QTY||CGO.IN_N1ST_IMDG_PCK_CD||CGO.IN_N2ND_IMDG_PCK_QTY||CGO.IN_N2ND_IMDG_PCK_CD) 
                            THEN '' ELSE 'N' END	
            
        END					AS ITM_STS_CD 

    ,	CGO.PRNR_CGO_RQST_SEQ AS PRNR_CGO_RQST_SEQ
#if (${func_flg} == 'EDI')
    ,   (SELECT LISTAGG (EDI_UNMAP_DTL_CD, ',') WITHIN GROUP (ORDER BY BKG_REF_NO)
           FROM SCG_PRNR_RQST_UNMAP
          WHERE CRR_CD = RQS.CRR_CD
            AND BKG_REF_NO = RQS.BKG_REF_NO
            AND SPCL_CGO_RQST_SEQ = RQS.SPCL_CGO_RQST_SEQ
            AND PRNR_CGO_RQST_SEQ = RQS.PRNR_CGO_RQST_SEQ
			AND EDI_UNMAP_CORR_RSLT_CD = 'N'
        ) UNMAP_DTL_CD
    ,   (SELECT LISTAGG (EDI_UNMAP_DTL_CD, ',') WITHIN GROUP (ORDER BY BKG_REF_NO)
           FROM SCG_PRNR_RQST_CGO_UNMAP
          WHERE CRR_CD = CGO.CRR_CD
            AND BKG_REF_NO = CGO.BKG_REF_NO
            AND SPCL_CGO_RQST_SEQ = CGO.SPCL_CGO_RQST_SEQ
            AND SPCL_CNTR_SEQ = CGO.SPCL_CNTR_SEQ
            AND SPCL_CGO_SEQ = CGO.SPCL_CGO_SEQ
            AND PRNR_CGO_RQST_SEQ = CGO.PRNR_CGO_RQST_SEQ
			AND EDI_UNMAP_CORR_RSLT_CD = 'N'
        ) CGO_UNMAP_DTL_CD
#else
    ,   '' AS UNMAP_DTL_CD 
    ,   '' AS CGO_UNMAP_DTL_CD
#end
    FROM SCG_PRNR_APRO_RQST      RQS
       , (
         SELECT T.*
              , AVG(DECODE(T.AUTH_STS_CD,'Y',1,'N',2,-999)) OVER (PARTITION BY T.CRR_CD, T.BKG_REF_NO, T.SPCL_CGO_RQST_SEQ) STS_CT
           FROM SCG_PRNR_APRO_RQST_CGO T
         ) CGO
       , SCG_IMDG_UN_NO          SUN
       , MDM_VSL_CNTR            MDM
    WHERE 1=1
    #if (${rgn_shp_opr_cd} != '')
      #if (${rgn_shp_opr_cd} == 'RST')
      AND RQS.RGN_SHP_OPR_CD    IS NULL
      #else
      AND RQS.RGN_SHP_OPR_CD    = @[rgn_shp_opr_cd]
      #end
    #end
    #if (${vsl_cd} != '')
      AND RQS.VSL_CD            = @[vsl_cd]
    #end
    #if (${skd_voy_no} != '')
      AND RQS.SKD_VOY_NO        = @[skd_voy_no]
    #end
    #if (${skd_dir_cd} != '')
      AND RQS.SKD_DIR_CD        = @[skd_dir_cd]
    #end
    #if (${scg_flg} == 'DG1' || ${scg_flg} == 'SCG_DG') 
      AND RQS.DG_FLG            = 'Y'
      AND RQS.AWK_FLG           = 'N'
    #elseif (${scg_flg} == 'AWK' || ${scg_flg} == 'SCG_AWK' || ${scg_flg} == 'SCG_45') 
      AND RQS.DG_FLG            = 'N'
      AND RQS.AWK_FLG           = 'Y'
    #if (${scg_flg} == 'SCG_AWK') 
      --::2015-04-07::--AND CGO.CNTR_TPSZ_CD <> 'D7'
    #end
    #if (${scg_flg} == 'SCG_45') 
      --::2015-04-07::--AND CGO.CNTR_TPSZ_CD = 'D7'
    #end
    #end
      AND RQS.CRR_CD            = CGO.CRR_CD
      AND RQS.BKG_REF_NO        = CGO.BKG_REF_NO
      AND RQS.PRNR_CGO_RQST_SEQ = CGO.PRNR_CGO_RQST_SEQ
      AND RQS.SPCL_CGO_RQST_SEQ = CGO.SPCL_CGO_RQST_SEQ
      AND RQS.VSL_CD            = MDM.VSL_CD
      AND MDM.DELT_FLG 		    = 'N' 
      AND CGO.IMDG_UN_NO        = SUN.IMDG_UN_NO(+)
      AND CGO.IMDG_UN_NO_SEQ    = SUN.IMDG_UN_NO_SEQ(+)
    --  AND (RQS.SRC_TP_CD = 'EDI' AND LST_RQST_DAT_FLG = 'Y'
    --       OR RQS.SRC_TP_CD <> 'EDI')

      --::2015-06-25::--AND RQS.SRC_TP_CD 		<> 'EDI' 
      AND RQS.LST_RQST_DAT_FLG 	= 'Y'
    #if (${srch_type} == 'R')   -- Recovery
        AND CGO.AUTH_STS_CD IN ('N','Y','R') AND CGO.STS_CT <> -999
        #if (${auth_flg} == 'Y') 
          AND CGO.AUTH_STS_CD = 'Y'
        #elseif (${auth_flg} == 'N')
          AND CGO.AUTH_STS_CD = 'N'
        #end
    #elseif (${srch_type} == 'U') -- Update
    	AND CGO.AUTH_STS_CD IN ('Y','N','R','P')
        #if (${auth_flg} == 'Y') 
          AND CGO.AUTH_STS_CD = 'Y'
        #elseif (${auth_flg} == 'U')
          AND CGO.AUTH_STS_CD IN ('R','P')
        #elseif (${auth_flg} == 'N')
          AND CGO.AUTH_STS_CD = 'N'
        #end
    #else -- Normal
        -- VOP_SCG_0023(Approved)
        #if (${auth_flg} == 'Y') 
          AND (CGO.STS_CT = 1 OR CGO.AUTH_STS_CD = 'Y')
        -- VOP_SCG_0023(Reject)
        #elseif (${auth_flg} == 'N')
          AND CGO.AUTH_STS_CD = 'N'
        -- VOP_SCG_0023(Unapproved)
        #elseif (${auth_flg} == 'U')
          AND CGO.AUTH_STS_CD IN ('R','P')
        -- VOP_SCG_0023(ALL)
        #elseif (${auth_flg} == 'YN')
          AND (CGO.STS_CT = 1 OR (CGO.AUTH_STS_CD IN('Y','N','R','P','C')))
        -- VOP_SCG_0022
        #elseif (${auth_flg} == 'S')
          #if (${func_flg} == 'MNL')
            AND RQS.SRC_TP_CD  <> 'EDI' --20150723
            AND (CGO.AUTH_STS_CD IN('Y','N','R','P','C') OR CGO.AUTH_STS_CD IS NULL)
          #else
            AND RQS.SRC_TP_CD = 'EDI' 
            --:2015-12-23:--AND RQS.EDI_UNMAP_KND_CD IS NOT NULL
            AND CGO.AUTH_STS_CD IS NULL
          #end
        -- VOP_SCG_5001(Pending)
        #elseif (${auth_flg} == 'P')
          AND CGO.AUTH_STS_CD = 'P'
        -- VOP_SCG_5001(Request)
        #elseif (${auth_flg} == 'R')
          AND CGO.AUTH_STS_CD = 'R'
        -- VOP_SCG_5001(ALL)
        #else
            AND CGO.AUTH_STS_CD IN('R','P')
        #end
        

    #end

    #if ($arr_slan_cd.size() > 0) 
      AND RQS.SLAN_CD IN ( 
        #foreach($key IN ${arr_slan_cd}) 
          #if($velocityCount < $arr_slan_cd.size()) 
            '$key', 
          #else 
            '$key' 
          #end 
        #end 
      )
    #end
    #if (${pol_cd} != '')
      AND RQS.POL_CD = @[pol_cd]
    #end
    #if (${pod_cd} != '')
      AND RQS.POD_CD = @[pod_cd]
    #end
    #if (${cgo_opr_cd} != '')
      AND CGO.CGO_OPR_CD = @[cgo_opr_cd]
    #end
    #if (${booking_no} != '') 
      AND RQS.BKG_REF_NO = @[booking_no]
    #end
    #if (${apro_ref_no} != '') 
      AND CGO.APRO_REF_NO = @[apro_ref_no]
    #end
    #if (${imdg_un_no} != '') 
      AND CGO.IMDG_UN_NO = @[imdg_un_no]
    #end
    #if (${imdg_un_no_seq} != '') 
      AND CGO.IMDG_UN_NO_SEQ = @[imdg_un_no_seq]
    #end
    #if (${imdg_clss_cd} != '') 
      AND CGO.IMDG_CLSS_CD = @[imdg_clss_cd]
    #end
    #if (${prp_shp_nm} != '') 
      AND CGO.PRP_SHP_NM LIKE '%'||@[prp_shp_nm]||'%'
    #end
    #if (${apro_ref_no} != '') 
      AND CGO.APRO_REF_NO = @[apro_ref_no]
    #end
    #if (${from_eta_dt} != '' && ${to_eta_dt} != '') 
        AND RQS.ETA_DT BETWEEN TO_DATE(@[from_eta_dt],'YYYYMMDD') AND TO_DATE(@[to_eta_dt],'YYYYMMDD')+0.99999
    #elseif (${from_eta_dt} != ''&& ${srch_type} == 'N') 
        AND RQS.ETA_DT	<= NVL(GLOBALDATE_PKG.TIME_CONV_FNC(COM_ConstantMgr_PKG.COM_getBaseLocationCode_FNC(),SYSDATE,BKG_COM_USER_LOC_FNC(@[upd_usr_id])), SYSDATE) + TO_NUMBER(@[from_eta_dt])
    #end
    #if (${src_tp_cd} != '')
        AND RQS.SRC_TP_CD = @[src_tp_cd]
    #end
    #if (${dcgo_ref_no} != '')
        AND CGO.DCGO_REF_NO = @[dcgo_ref_no]
    #end


    #if (${func_flg} == 'MNL')

        #if (${from_req_dt} != '') 
        AND TO_DATE(DECODE(CGO.AUTH_STS_CD, NULL,
            TO_CHAR(NVL(GLOBALDATE_PKG.TIME_CONV_FNC(GLOBALDATE_PKG.GET_LOCCD_FNC(RQS.RQST_OFC_CD), CGO.UPD_DT,'GMT'), CGO.UPD_DT),'YYYYMMDD'),
            TO_CHAR(NVL(GLOBALDATE_PKG.TIME_CONV_FNC(GLOBALDATE_PKG.GET_LOCCD_FNC(RQS.RQST_OFC_CD), CGO.CGO_RQST_DT,'GMT'), CGO.CGO_RQST_DT),'YYYYMMDD')
            ),'YYYYMMDD')	>= TO_DATE(@[from_req_dt],'YYYYMMDD')
        #end
        #if (${to_req_dt} != '') 
        AND TO_DATE(DECODE(CGO.AUTH_STS_CD, NULL,
            TO_CHAR(NVL(GLOBALDATE_PKG.TIME_CONV_FNC(GLOBALDATE_PKG.GET_LOCCD_FNC(RQS.RQST_OFC_CD), CGO.UPD_DT,'GMT'), CGO.UPD_DT),'YYYYMMDD'),
            TO_CHAR(NVL(GLOBALDATE_PKG.TIME_CONV_FNC(GLOBALDATE_PKG.GET_LOCCD_FNC(RQS.RQST_OFC_CD), CGO.CGO_RQST_DT,'GMT'), CGO.CGO_RQST_DT),'YYYYMMDD')
            ),'YYYYMMDD')	<= TO_DATE(@[to_req_dt],'YYYYMMDD')+0.99999
        #end

    #else

        #if (${from_req_dt} != '') 
        AND	RQS.CRE_DT	>= TO_DATE(@[from_req_dt]	,'YYYYMMDD')
        #end
        #if (${to_req_dt} != '') 
        AND	RQS.CRE_DT	<= TO_DATE(@[to_req_dt]		,'YYYYMMDD')+0.99999
        #end

    #end
         --=============================================================================
         --=============================================================================
        ) XX
)        
WHERE RNK < 1000
#if (${func_flg} == 'EDI')
--AND UNMAP IS NOT NULL
#end
#if (${srch_type} == 'U')
    AND SPCL_CGO_SEQ = SPCL_CGO_SEQ_1
#end
ORDER BY RNK, 
       SPCL_CGO_RQST_SEQ ,
       PRNR_CGO_RQST_SEQ ,
       SPCL_CNTR_SEQ ,
       SPCL_CGO_SEQ 
--WHERE		ROWNUM	<= 1200
--ORDER BY	XX.ETA_DT
--		,	XX.CGO_OPR_CD
--		,	XX.VSL_CD
--		,	XX.SKD_VOY_NO
--		,	XX.SKD_DIR_CD
--		,	XX.POL_CD
--		,	XX.POD_CD
--		,	XX.BKG_REF_NO
--		,	XX.SPCL_CGO_RQST_SEQ
--		,	XX.PRNR_CGO_RQST_SEQ
--		,	XX.SPCL_CNTR_SEQ
--		,	XX.SPCL_CGO_SEQ			]]></sql>
			<params>
				<param name="rgn_shp_opr_cd" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="cgo_opr_cd" type="12" value="" out="N"/>
				<param name="booking_no" type="12" value="" out="N"/>
				<param name="apro_ref_no" type="12" value="" out="N"/>
				<param name="imdg_un_no" type="12" value="" out="N"/>
				<param name="imdg_un_no_seq" type="12" value="" out="N"/>
				<param name="imdg_clss_cd" type="12" value="" out="N"/>
				<param name="prp_shp_nm" type="12" value="" out="N"/>
				<param name="from_eta_dt" type="12" value="" out="N"/>
				<param name="to_eta_dt" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="src_tp_cd" type="12" value="" out="N"/>
				<param name="dcgo_ref_no" type="12" value="" out="N"/>
				<param name="from_req_dt" type="12" value="" out="N"/>
				<param name="to_req_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
