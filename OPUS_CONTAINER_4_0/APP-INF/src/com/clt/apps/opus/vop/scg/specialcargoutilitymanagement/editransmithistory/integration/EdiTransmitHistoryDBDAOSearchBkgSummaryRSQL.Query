<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EdiTransmitHistoryDBDAOSearchBkgSummaryRSQL">
			<desc><![CDATA[]]></desc>
			<sql><![CDATA[
SELECT ROW_NUMBER() OVER(PARTITION BY EDI_MSG_STS_CD, LST_RQST_DAT_FLG ORDER BY LST_RQST_DAT_FLG DESC, IF_DATE DESC, CNTR_SEQ, CGO_SEQ) SEQ
     ----, RANK() OVER(PARTITION BY DCGO_REF_NO ORDER BY LST_RQST_DAT_FLG DESC, IF_DATE DESC, CNTR_SEQ, CGO_SEQ) RANK_SEQ
	 , DENSE_RANK() OVER(PARTITION BY BKG_REF_NO ORDER BY NVL(LST_RQST_DAT_FLG,'A') DESC, PRNR_SPCL_CGO_SEQ DESC) RANK_SEQ
     , BKG_REF_NO
     , EDI_MSG_STS_CD
     , DCGO_REF_NO
     , LST_RQST_DAT_FLG
     , PRNR_SPCL_CGO_SEQ
     , IMDG_UN_NO_CTNT
     , IMDG_CLSS_CD_CTNT
     , DECODE(IMDG_PCK_GRP_CD_CTNT,'1','I','2','II','3','III','')	AS IMDG_PCK_GRP_CD_CTNT
     , PRP_SHP_NM
     , DCGO_STS_CD_CTNT
     , CGO_SEQ
     , CNTR_SEQ
     , GRS_WGT_CTNT
     , NET_WGT_CTNT
     , IF_DATE
  FROM (
SELECT HDR.BKG_REF_NO
     , HDR.EDI_MSG_STS_CD

     --::2015-05-30::--, DTL.REF_NO
     , DTL.DCGO_REF_NO

     , RQS.LST_RQST_DAT_FLG
     , DTL.IMDG_UN_NO_CTNT
     , DTL.IMDG_CLSS_CD_CTNT
     , DTL.IMDG_PCK_GRP_CD_CTNT
     , DTL.PRP_SHP_NM
     , DTL.DCGO_STS_CD_CTNT
     , DTL.CGO_SEQ
     , DTL.CNTR_SEQ
     , DTL.GRS_WGT_CTNT
     , DTL.NET_WGT_CTNT
     , DTL.UPD_DT IF_DATE

	 , RQS.SPCL_CGO_RQST_SEQ
	 , HDR.PRNR_SPCL_CGO_SEQ
 
 FROM SCG_PRNR_SPCL_CGO_TRSM_HDR HDR
    , SCG_PRNR_SPCL_CGO_TRSM_DTL DTL
    , SCG_PRNR_APRO_RQST         RQS
 WHERE 1 = 1
   AND HDR.TRSM_MZD_CD        = 'EDI'							--::EDI, EML::--
   AND HDR.BKG_REF_NO         = @[bkg_ref_no]
   AND HDR.TRSM_BND_CD        = 'I'
   AND HDR.TRSM_BND_CD        = DTL.TRSM_BND_CD
   AND HDR.TRSM_DT            = DTL.TRSM_DT
   AND HDR.SPCL_CGO_CATE_CD   = DTL.SPCL_CGO_CATE_CD
   AND HDR.PRNR_SPCL_CGO_SEQ  = DTL.PRNR_SPCL_CGO_SEQ
   AND HDR.TRSM_BND_CD        = RQS.MAPG_TRSM_BND_CD			(+)
   AND HDR.TRSM_DT            = RQS.MAPG_TRSM_DT				(+)
   AND HDR.SPCL_CGO_CATE_CD   = RQS.MAPG_TRSM_SPCL_CGO_CATE_CD	(+)
   AND HDR.PRNR_SPCL_CGO_SEQ  = RQS.MAPG_PRNR_SPCL_CGO_SEQ		(+)
   )A
----ORDER BY NVL(LST_RQST_DAT_FLG, 1) DESC, IF_DATE DESC, CNTR_SEQ, CGO_SEQ
	ORDER BY NVL(LST_RQST_DAT_FLG,'A') DESC, PRNR_SPCL_CGO_SEQ DESC, CNTR_SEQ ASC, CGO_SEQ ASC			]]></sql>
			<params>
				<param name="bkg_ref_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
