<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PortTariffMgtBCDBDAOSearchLocalCurrencyByPortCdRSQL">
			<desc><![CDATA[PORT_CD를 입력받아 지역통화를 구한다. <단건조회>]]></desc>
			<sql><![CDATA[
WITH V_CURRENCY AS (
    SELECT NVL(A.CURR_CD, B.AR_CURR_CD) AS CURRENCY
      FROM MDM_CURRENCY A
         , MDM_ORGANIZATION B
     WHERE A.CNT_CD(+) = SUBSTR(B.LOC_CD, 1, 2)
       AND B.DELT_FLG = 'N'
       AND B.LOC_CD = @[port_cd]
     GROUP BY  NVL(A.CURR_CD, B.AR_CURR_CD)
) 
/*n or 0 건일경우 MDM_LOCATION 에서 Ofc_cd에 연결된 Currency를 재조회 한다.*/  
SELECT CASE WHEN CURR_CNT = 1  THEN ( SELECT V.CURRENCY
                                        FROM V_CURRENCY V
                                       WHERE ROWNUM = 1
                                    )
           ELSE (  SELECT NVL(C.CURR_CD, O.AR_CURR_CD)
                      FROM MDM_LOCATION L
                         , MDM_ORGANIZATION O
                         , MDM_CURRENCY C
                     WHERE 1=1
                       AND L.DELT_FLG = 'N'
                       AND L.LOC_CD = @[port_cd]
                       AND L.FINC_CTRL_OFC_CD = O.OFC_CD
                       AND O.DELT_FLG = 'N'
                       AND L.CNT_CD = C.CNT_CD(+)
                       AND ROWNUM = 1
                 )
       END AS CURRENCY       
  FROM (SELECT COUNT(*) AS CURR_CNT FROM V_CURRENCY)			]]></sql>
			<params>
				<param name="port_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
