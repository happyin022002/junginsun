<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PortTariffMgtBCDBDAOsearchObjBasicAllRSQL">
			<desc><![CDATA[PortTariffMgtBCDBsearchObjBasicAll]]></desc>
			<sql><![CDATA[
WITH V_YD_CHG AS (
    SELECT D.FOML_NO
         , D.COND_NO
      FROM (SELECT A.YD_CHG_NO
                 , MAX(A.YD_CHG_VER_SEQ) AS YD_CHG_VER_SEQ
              FROM PSO_YD_CHG A
             WHERE 1=1
               AND A.EFF_DT <= SYSDATE
               AND A.EXP_DT >= SYSDATE
               AND A.LST_FLG = 'Y'
             GROUP BY A.YD_CHG_NO ) A
         , PSO_YD_CHG_XPR B
         , PSO_CHG_XPR C
         , PSO_CHG_XPR_DTL D
     WHERE 1=1
       AND A.YD_CHG_NO = B.YD_CHG_NO
       AND A.YD_CHG_VER_SEQ = B.YD_CHG_VER_SEQ
       AND C.CHG_XPR_NO = B.CHG_XPR_NO
       AND C.CHG_XPR_NO = D.CHG_XPR_NO 
)
--SELECT * FROM V_YD_CHG
, V_YD_LINK AS (
    SELECT DISTINCT DECODE(Q.RNUM, 1, P.OBJ_LIST_NO, P.RT_OBJ_LIST_NO) OBJ_LIST_NO
              FROM (SELECT BB.OBJ_LIST_NO
                         , BB.RT_OBJ_LIST_NO
                      FROM V_YD_CHG A
                         , PSO_FORMULA B
                         , PSO_FOML_DTL BB
                     WHERE 1 = 1
                       AND A.FOML_NO = B.FOML_NO
                       AND B.FOML_NO = BB.FOML_NO
                       AND (BB.OBJ_LIST_NO IS NOT NULL OR BB.RT_OBJ_LIST_NO IS NOT NULL) ) P
                 ,(SELECT LEVEL RNUM FROM DUAL CONNECT BY LEVEL <= 2 ) Q
             WHERE DECODE(Q.RNUM, 1, P.OBJ_LIST_NO, P.RT_OBJ_LIST_NO) IS NOT NULL
    UNION 
    SELECT DISTINCT DECODE(Q.RNUM, 1, P.OBJ_LIST_NO, P.RT_OBJ_LIST_NO) OBJ_LIST_NO
      FROM (SELECT CC.OBJ_LIST_NO
                 , CC.RT_OBJ_LIST_NO
              FROM V_YD_CHG A
                 , PSO_CONDITION C
                 , PSO_COND_DTL CC
             WHERE 1 = 1
               AND A.COND_NO = C.COND_NO
               AND C.COND_NO = CC.COND_NO
               AND (CC.OBJ_LIST_NO IS NOT NULL OR CC.RT_OBJ_LIST_NO IS NOT NULL)
               AND CC.OBJ_LIST_NO != -1) P
         ,(SELECT LEVEL RNUM FROM DUAL CONNECT BY LEVEL <= 2) Q
     WHERE DECODE(Q.RNUM, 1, P.OBJ_LIST_NO, P.RT_OBJ_LIST_NO) IS NOT NULL 
)
--SELECT * FROM V_YD_LINK;
, V_FOMLULA AS (
    SELECT DISTINCT DECODE(Q.RNUM, 1, P.OBJ_LIST_NO, P.RT_OBJ_LIST_NO) OBJ_LIST_NO
      FROM (SELECT BB.OBJ_LIST_NO
                 , BB.RT_OBJ_LIST_NO
              FROM PSO_FORMULA B
                 , PSO_FOML_DTL BB
             WHERE 1 = 1
               AND B.UPD_MNU_NO = '2' /*신규 Object 등록시에는 무조건 1 로만 등록한다.*/
               AND B.FOML_NO = BB.FOML_NO
               AND (BB.OBJ_LIST_NO IS NOT NULL OR BB.RT_OBJ_LIST_NO IS NOT NULL) ) P
         ,(SELECT LEVEL RNUM FROM DUAL CONNECT BY LEVEL <= 2 ) Q
     WHERE DECODE(Q.RNUM, 1, P.OBJ_LIST_NO, P.RT_OBJ_LIST_NO) IS NOT NULL
)
--SELECT * FROM V_FOMLULA;
, V_CONDITION AS (
    SELECT DISTINCT DECODE(Q.RNUM, 1, P.OBJ_LIST_NO, P.RT_OBJ_LIST_NO) OBJ_LIST_NO
      FROM (SELECT CC.OBJ_LIST_NO
                 , CC.RT_OBJ_LIST_NO
              FROM PSO_CONDITION C
                 , PSO_COND_DTL CC
             WHERE 1 = 1
               AND C.COND_NO = CC.COND_NO
               AND (CC.OBJ_LIST_NO IS NOT NULL OR CC.RT_OBJ_LIST_NO IS NOT NULL)
               AND CC.OBJ_LIST_NO != -1) P
         ,(SELECT LEVEL RNUM FROM DUAL CONNECT BY LEVEL <= 2) Q
     WHERE DECODE(Q.RNUM, 1, P.OBJ_LIST_NO, P.RT_OBJ_LIST_NO) IS NOT NULL 
)
--SELECT * FROM V_CONDITION;
SELECT OB.OBJ_LIST_NO
     , OB.OBJ_LIST_NM
     , OB.PSO_OBJ_LIST_TP_CD
     , OB.PSO_OBJ_CD
     , OB.PSO_MEAS_UT_CD
     , OB.OBJ_LIST_ABBR_NM
     , OB.DFLT_CTNT
     , OB.DIFF_RMK
     , DECODE(VY.OBJ_LIST_NO,NULL,'N','Y') YD_LINK_YN
     , DECODE(VF.OBJ_LIST_NO,NULL,'N','Y') FOML_USED_YN
     , DECODE(VC.OBJ_LIST_NO,NULL,'N','Y') COND_USED_YN
  FROM PSO_OBJ_LIST OB
     , V_YD_LINK VY
     , V_FOMLULA VF
     , V_CONDITION VC
 WHERE 1 =1
   AND OB.OBJ_LIST_NO = VY.OBJ_LIST_NO(+)
   AND OB.OBJ_LIST_NO = VF.OBJ_LIST_NO(+)
   AND OB.OBJ_LIST_NO = VC.OBJ_LIST_NO(+)
#if(${obj_nm} != '')
AND UPPER (OB.OBJ_LIST_NM) LIKE UPPER('%' || @[obj_nm] || '%')
#end
ORDER BY OB.OBJ_LIST_NO			]]></sql>
			<params>
				<param name="obj_nm" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
