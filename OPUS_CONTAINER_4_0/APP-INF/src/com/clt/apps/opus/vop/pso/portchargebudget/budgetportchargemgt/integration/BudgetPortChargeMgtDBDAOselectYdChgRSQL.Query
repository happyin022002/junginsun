<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BudgetPortChargeMgtDBDAOselectYdChgRSQL">
			<desc><![CDATA[selectYdChg
2016.01.22 ETD Date
2016.04.18 ACCL_FLG = Y Add]]></desc>
			<sql><![CDATA[
/*Estimate Expense Apply Call : YardChargeVO*/
SELECT YD_CHG_NO
     , YD_CHG_VER_SEQ
     , CURR_CD
     , YD_CD
     , LGS_COST_CD
     , VNDR_SEQ
     , CURR_CD
  FROM (SELECT MAX (C.YD_CHG_NO) YD_CHG_NO
             , MAX (C.YD_CHG_VER_SEQ) YD_CHG_VER_SEQ
             , SUBSTR (MAX (C.YD_CHG_VER_SEQ || C.CURR_CD), -3) CURR_CD
             , C.YD_CD
             , C.LGS_COST_CD
             , C.VNDR_SEQ
             , C.CPLS_FLG
             , COUNT( * ) OVER (PARTITION BY C.YD_CD, C.LGS_COST_CD
                 ORDER BY C.YD_CD, C.LGS_COST_CD) CNT
          FROM PSO_YD_CHG C
             , MDM_VENDOR M
         WHERE C.YD_CD = @[yd_cd]
           AND TO_DATE(REPLACE(@[rev_yrmon], '-'),'YYYYMMDD') BETWEEN C.EFF_DT AND C.EXP_DT 
           AND C.VNDR_SEQ = M.VNDR_SEQ
         GROUP BY C.YD_CD
             , C.LGS_COST_CD
             , C.VNDR_SEQ
             , C.CPLS_FLG)
 WHERE ( CASE WHEN CNT >= 2 THEN 'Y' ELSE CPLS_FLG END ) = CPLS_FLG
  /*2016.04.18 Add : Accrual 대상 만 진행함.*/
  AND EXISTS ( SELECT 'Y'
                FROM SCO_AP_COST_ACT_INFO SACAI
                WHERE 1=1
                  AND SACAI.SRC_MDL_CD          = 'PSO'
                  AND NVL(SACAI.ENBL_FLG, 'N')  = 'N'
                  AND NVL(SACAI.ACCL_FLG, 'N')  = 'Y'
                  AND SACAI.ACT_COST_CD         = LGS_COST_CD)			]]></sql>
			<params>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="rev_yrmon" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
