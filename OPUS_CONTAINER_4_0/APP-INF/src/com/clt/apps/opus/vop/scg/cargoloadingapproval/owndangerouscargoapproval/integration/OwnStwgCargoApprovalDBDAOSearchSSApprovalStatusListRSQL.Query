<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OwnStwgCargoApprovalDBDAOSearchSSApprovalStatusListRSQL">
			<desc><![CDATA[DG Stwg의 신청 및 승인에 대한 Status를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT DISTINCT
	DECODE(A.VSL_PRE_PST_CD,'S','Pre'||A.VSL_SEQ,'T','Trunk','U','Post'||A.VSL_SEQ) AS VSL_PRE_PST_NM,
	A.SPCL_CGO_APRO_RQST_SEQ,
	A.VSL_PRE_PST_CD,
	A.LST_RQST_DAT_FLG,
	C.SPCL_CGO_AUTH_SEQ,
	A.VSL_SEQ,	
	A.SPCL_CGO_RQST_SEQ,
	A.SLAN_CD,
	A.VSL_CD,
	A.SKD_VOY_NO,
	A.SKD_DIR_CD,
	A.SPCL_CGO_CATE_CD,
	A.BKG_NO,
	A.BKG_STS_CD,
	A.DG_CNTR_SEQ,
	A.CNTR_CGO_SEQ,	
	DECODE(A.SPCL_RQST_FLG, 'Y','S','')||'R'||A.SPCL_CGO_RQST_SEQ AS RQST_AUTH_CD,
	A.RQST_OFC_CD,
	TO_CHAR(A.RQST_DT,'YYYY-MM-DD') AS RQST_DT,	
	TO_CHAR(A.RQST_GDT,'YYYY-MM-DD') AS RQST_GDT,	
	A.RQST_USR_ID,
	DECODE(A.SPCL_CGO_APRO_CD,'D','D','C','C',DECODE(A.LST_RQST_DAT_FLG,'N',DECODE(C.SPCL_CGO_AUTH_CD,'','C',C.SPCL_CGO_AUTH_CD),C.SPCL_CGO_AUTH_CD)) AS SPCL_CGO_AUTH_CD,
	DECODE(A.LST_RQST_DAT_FLG,'N',DECODE(C.SPCL_CGO_AUTH_CD,'',(SELECT TO_CHAR(A.RQST_DT,'YYYY-MM-DD') FROM SCG_APRO_RQST H WHERE H.BKG_NO = A.BKG_NO AND H.SPCL_CGO_CATE_CD = A.SPCL_CGO_CATE_CD AND H.SPCL_CGO_RQST_SEQ = A.SPCL_CGO_RQST_SEQ),TO_CHAR(C.AUTH_DT,'YYYY-MM-DD')),TO_CHAR(C.AUTH_DT,'YYYY-MM-DD')) AS AUTH_DT,
	DECODE(A.LST_RQST_DAT_FLG,'N',DECODE(C.SPCL_CGO_AUTH_CD,'',(SELECT TO_CHAR(A.RQST_GDT,'YYYY-MM-DD') FROM SCG_APRO_RQST H WHERE H.BKG_NO = A.BKG_NO AND H.SPCL_CGO_CATE_CD = A.SPCL_CGO_CATE_CD AND H.SPCL_CGO_RQST_SEQ = A.SPCL_CGO_RQST_SEQ),TO_CHAR(C.AUTH_GDT,'YYYY-MM-DD')),TO_CHAR(C.AUTH_GDT,'YYYY-MM-DD')) AS AUTH_GDT,
	DECODE(A.LST_RQST_DAT_FLG,'N',DECODE(C.SPCL_CGO_AUTH_CD,'','SYSTEM',C.AUTH_USR_ID),C.AUTH_USR_ID) AS AUTH_USR_ID,
	DECODE(A.SPCL_CGO_APRO_CD,'D',C.SPCL_CGO_AUTH_RJCT_CD,'C',C.SPCL_CGO_AUTH_RJCT_CD,DECODE(A.LST_RQST_DAT_FLG,'N',DECODE(C.SPCL_CGO_AUTH_CD,'','SYS',C.SPCL_CGO_AUTH_RJCT_CD),C.SPCL_CGO_AUTH_RJCT_CD)) AS SPCL_CGO_AUTH_RJCT_CD,
	DECODE(A.SPCL_CGO_APRO_CD,'D',C.SPCL_CGO_AUTH_RMK,'C',C.SPCL_CGO_AUTH_RMK,DECODE(A.LST_RQST_DAT_FLG,'N',DECODE(C.SPCL_CGO_AUTH_CD,'','Reapplication',C.SPCL_CGO_AUTH_RMK),C.SPCL_CGO_AUTH_RMK)) AS SPCL_CGO_AUTH_RMK,
	A.POL_CD,
	A.POD_CD,
    C.APRO_REF_NO,
	A.CNTR_TPSZ_CD,
	'SS' AS SCG_FLG,
	A.IMDG_UN_NO,
	A.IMDG_UN_NO_SEQ,
	A.IMDG_CLSS_CD,	
    A.IMDG_SUBS_RSK_LBL_CD,
    A.MRN_POLUT_FLG,
	A.IMDG_PCK_GRP_CD,
	A.IMDG_LMT_QTY_FLG,
	A.IMDG_EXPT_QTY_FLG,
	A.FLSH_PNT_CDO_TEMP,
    A.OP_CNTR_QTY ,
    (SELECT CASE WHEN (SELECT COUNT(BKG_NO) FROM BKG_QUANTITY WHERE BKG_NO = A.BKG_NO ) > 1 THEN (CASE WHEN A.OP_CNTR_QTY = COUNT(C.BKG_NO) THEN SUM(NVL2(C.WGT_UT_CD, TRS_COMMON_PKG.GET_CONV_WGT_TO_KG_FNC(C.WGT_UT_CD, C.CNTR_WGT), 0))||''
                                                                                                       ELSE ''
                                                                                                  END)       
                 ELSE (CASE WHEN A.OP_CNTR_QTY = COUNT(C.BKG_NO) THEN SUM(NVL2(C.WGT_UT_CD, TRS_COMMON_PKG.GET_CONV_WGT_TO_KG_FNC(C.WGT_UT_CD, C.CNTR_WGT), 0))||''
                            ELSE MAX(NVL2(D.WGT_UT_CD, TRS_COMMON_PKG.GET_CONV_WGT_TO_KG_FNC(D.WGT_UT_CD, D.ACT_WGT), 0))||''
                       END)
            END GRS_WGT
       FROM BKG_CONTAINER C,  BKG_BL_DOC D
      WHERE 1=1
        AND D.BKG_NO = A.BKG_NO
        AND C.BKG_NO(+) = D.BKG_NO
        AND C.CNTR_TPSZ_CD(+) = A.CNTR_TPSZ_CD
      GROUP BY A.BKG_NO, A.CNTR_TPSZ_CD       
    ) GRS_WGT,
	A.NET_WGT,
	A.IN_IMDG_PCK_QTY1,
	A.OUT_IMDG_PCK_QTY1,
	A.INTMD_IMDG_PCK_QTY1,
	A.PSA_NO,
	A.HCDG_FLG,
	A.SPCL_RQST_DESC,
    A.DCGO_FLG,           --@@
    A.RC_FLG,                --@@
    A.AWK_CGO_FLG,     --@@
    A.BB_CGO_FLG,         --@@  
	A.STWG_CD,
    A.CMDT_NM
FROM (    
    SELECT 
        ROW_NUMBER() OVER (PARTITION BY A.BKG_NO, C.VSL_SEQ ORDER BY A.BKG_NO) SEQ,
    	A.BKG_NO,
		A.BKG_STS_CD,
    	C.SLAN_CD,
    	B.SPCL_CGO_APRO_RQST_SEQ,     
    	B.SPCL_CGO_CATE_CD,
		B.SPCL_BKG_RQST_FLG,
        B.SPCL_CGO_RQST_SEQ,
    	B.RQST_OFC_CD,
    	B.RQST_DT,
    	B.RQST_GDT,
    	B.RQST_USR_ID,
		B.LST_RQST_DAT_FLG,
    	C.VSL_CD,
    	C.SKD_VOY_NO,
    	C.SKD_DIR_CD,
        C.VSL_PRE_PST_CD,
        C.VSL_SEQ,
    	C.POL_CD,
    	C.POD_CD,
		'' DCGO_SEQ,
		'' DG_CNTR_SEQ,
		'' CNTR_CGO_SEQ,	
		'' IMDG_UN_NO,
		'' IMDG_UN_NO_SEQ,
		'' IMDG_CLSS_CD,	
    	'' IMDG_SUBS_RSK_LBL_CD,
	    '' MRN_POLUT_FLG,
		'' IMDG_PCK_GRP_CD,
		'' IMDG_LMT_QTY_FLG,
		'' IMDG_EXPT_QTY_FLG,
		'' FLSH_PNT_CDO_TEMP,
		'' GRS_WGT,
		'' NET_WGT,
		'' IN_IMDG_PCK_QTY1,
		'' OUT_IMDG_PCK_QTY1,
		'' INTMD_IMDG_PCK_QTY1,
		'' PSA_NO,
		'' HCDG_FLG,
		'' SPCL_RQST_FLG,
		'' SPCL_RQST_DESC,
        A.DCGO_FLG,           --@@
        A.RC_FLG,                --@@
        A.AWK_CGO_FLG,     --@@
        A.BB_CGO_FLG,        --@@   
		S.STWG_CD,
        S.SPCL_CGO_APRO_CD,
        Q.CNTR_TPSZ_CD,
        Q.OP_CNTR_QTY,
        M.CMDT_NM
	FROM BKG_BOOKING A, 
         SCG_APRO_RQST B, 
         SCG_VVD_APRO_RQST C,
         SCG_STWG_CGO S,
         BKG_QUANTITY Q,
         MDM_COMMODITY M
	WHERE A.BKG_NO = B.BKG_NO
	AND B.SPCL_CGO_CATE_CD = 'SS'
	AND B.BKG_NO = S.BKG_NO(+)
    AND B.SPCL_CGO_APRO_RQST_SEQ = S.SPCL_CGO_APRO_RQST_SEQ(+)
	AND B.SPCL_CGO_APRO_RQST_SEQ = C.SPCL_CGO_APRO_RQST_SEQ
	AND B.BKG_NO = C.BKG_NO
	AND B.LST_RQST_DAT_FLG = 'N'
    AND Q.BKG_NO = A.BKG_NO
    AND M.CMDT_CD(+) = A.CMDT_CD 
	AND A.BKG_NO = @[booking_no]
	#if (${vsl_cd} != '' && ${vsl_cd} != 'null')
	AND C.VSL_CD = @[vsl_cd]
	AND C.SKD_VOY_NO = @[skd_voy_no]
	AND C.SKD_DIR_CD = @[skd_dir_cd]
	#end
    UNION
    SELECT 
        ROW_NUMBER() OVER (PARTITION BY A.BKG_NO, C.VSL_SEQ ORDER BY A.BKG_NO) SEQ,
    	A.BKG_NO,
		A.BKG_STS_CD,
    	C.SLAN_CD,
    	B.SPCL_CGO_APRO_RQST_SEQ,     
    	B.SPCL_CGO_CATE_CD,
		B.SPCL_BKG_RQST_FLG,
        B.SPCL_CGO_RQST_SEQ,
    	B.RQST_OFC_CD,
    	B.RQST_DT,
    	B.RQST_GDT,
    	B.RQST_USR_ID,
		B.LST_RQST_DAT_FLG,
    	C.VSL_CD,
    	C.SKD_VOY_NO,
    	C.SKD_DIR_CD,
        C.VSL_PRE_PST_CD,
        C.VSL_SEQ,
    	C.POL_CD,
    	C.POD_CD,
		'' DCGO_SEQ,
		'' DG_CNTR_SEQ,
		'' CNTR_CGO_SEQ,	
		'' IMDG_UN_NO,
		'' IMDG_UN_NO_SEQ,
		'' IMDG_CLSS_CD,	
    	'' IMDG_SUBS_RSK_LBL_CD,
	    '' MRN_POLUT_FLG,
		'' IMDG_PCK_GRP_CD,
		'' IMDG_LMT_QTY_FLG,
		'' IMDG_EXPT_QTY_FLG,
		'' FLSH_PNT_CDO_TEMP,
		'' GRS_WGT,
		'' NET_WGT,
		'' IN_IMDG_PCK_QTY1,
		'' OUT_IMDG_PCK_QTY1,
		'' INTMD_IMDG_PCK_QTY1,
		'' PSA_NO,
		'' HCDG_FLG,
		'' SPCL_RQST_FLG,
		'' SPCL_RQST_DESC,
        A.DCGO_FLG,           --@@
        A.RC_FLG,                --@@
        A.AWK_CGO_FLG,     --@@
        A.BB_CGO_FLG,        --@@   
		S.STWG_CD,
        S.SPCL_CGO_APRO_CD,
        Q.CNTR_TPSZ_CD,
        Q.OP_CNTR_QTY,
        M.CMDT_NM
	FROM BKG_BOOKING A, 
         SCG_APRO_RQST B, 
         SCG_VVD_APRO_RQST C,
         BKG_STWG_CGO S,
         BKG_QUANTITY Q,
         MDM_COMMODITY M
	WHERE A.BKG_NO = B.BKG_NO
	AND B.SPCL_CGO_CATE_CD = 'SS'
	AND B.BKG_NO = S.BKG_NO
	AND B.SPCL_CGO_APRO_RQST_SEQ = C.SPCL_CGO_APRO_RQST_SEQ
	AND B.BKG_NO = C.BKG_NO
	AND B.LST_RQST_DAT_FLG = 'Y'

	--::2015-07-06::--AND S.SPCL_CGO_APRO_CD is not null
	--::2015-07-06::--AND D.SPCL_CGO_APRO_CD not in ('C','D')		
	AND S.SPCL_CGO_APRO_CD <> 'D'
    AND Q.BKG_NO = A.BKG_NO
    AND M.CMDT_CD(+) = A.CMDT_CD 
	AND A.BKG_NO = @[booking_no]
	#if (${vsl_cd} != '' && ${vsl_cd} != 'null')
	AND C.VSL_CD = @[vsl_cd]
	AND C.SKD_VOY_NO = @[skd_voy_no]
	AND C.SKD_DIR_CD = @[skd_dir_cd]
	#end
) A
	, 	SCG_AUTHORIZATION 			C
WHERE 	A.BKG_NO 					= C.BKG_NO(+)
AND 	A.SPCL_CGO_APRO_RQST_SEQ 	= C.SPCL_CGO_APRO_RQST_SEQ(+)
AND 	A.VSL_PRE_PST_CD 			= C.VSL_PRE_PST_CD(+)
AND 	A.VSL_SEQ 					= C.VSL_SEQ(+)
AND     A.SEQ                       = C.SPCL_CGO_AUTH_SEQ(+)
/* 2015-08-14 by TOP */
----AND 	A.DCGO_SEQ 				= C.DCGO_SEQ(+)

ORDER BY A.SPCL_CGO_RQST_SEQ		ASC
	, 	A.VSL_PRE_PST_CD			ASC
	, 	A.VSL_SEQ					ASC
	, 	A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD	ASC
	,	A.BKG_NO					ASC
	,	A.DG_CNTR_SEQ				ASC
	,	A.CNTR_CGO_SEQ 				ASC			]]></sql>
			<params>
				<param name="booking_no" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
