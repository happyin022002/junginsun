<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChangeOfDestinationMgtDBDAOCODNewOldPODRSQL">
			<desc><![CDATA[COD의 NEW POD CD, OLD POD CD SELECT]]></desc>
			<sql><![CDATA[
select 
AA.NEW_POD_CD,
(SELECT    ML.LOC_NM
FROM       MDM_LOCATION  ML
WHERE      ML.LOC_CD     = AA.NEW_POD_CD
) AS NEW_POD_FULL_NM,
AA.OLD_POD_CD,
(SELECT    ML.LOC_NM
FROM       MDM_LOCATION  ML
WHERE      ML.LOC_CD     = AA.OLD_POD_CD
) AS OLD_POD_FULL_NM,
(SELECT MAX(OB_CSSM_VOY_NO) 
FROM VSK_VSL_PORT_SKD
WHERE VSL_CD    = substr(@[vvd],1,4)
AND SKD_VOY_NO  = substr(@[vvd],5,4)
AND SKD_DIR_CD  = substr(@[vvd],9)
) AS OB_CSSM_VOY_NO       
from (
SELECT    
XX.BKG_NO
      ,   XX.COD_RQST_SEQ
      ,   DECODE(XX.N1ST_PORT_CD, YY.N1ST_PORT_CD, XX.N1ST_PORT_CD, 'ERROR')  ORIGINAL_LOAD_PORT_CD
      ,   CASE WHEN XX.N2ND_PORT_CD <> YY.N2ND_PORT_CD                               THEN XX.N2ND_PORT_CD
               ELSE
                    CASE WHEN XX.N3RD_PORT_CD <> YY.N3RD_PORT_CD                     THEN XX.N3RD_PORT_CD
                         ELSE
                              CASE WHEN XX.N4TH_PORT_CD <> YY.N4TH_PORT_CD           THEN XX.N4TH_PORT_CD
                                   ELSE
                                        CASE WHEN XX.N5TH_PORT_CD <> YY.N5TH_PORT_CD THEN XX.N5TH_PORT_CD
                                             ELSE                                         XX.N6TH_PORT_CD
                                        END 
                              END
                    END
          END  OLD_POD_CD
      ,   CASE WHEN XX.N2ND_PORT_CD <> YY.N2ND_PORT_CD                               THEN YY.N2ND_PORT_CD
               ELSE
                    CASE WHEN XX.N3RD_PORT_CD <> YY.N3RD_PORT_CD                     THEN YY.N3RD_PORT_CD
                         ELSE
                              CASE WHEN XX.N4TH_PORT_CD <> YY.N4TH_PORT_CD           THEN YY.N4TH_PORT_CD
                                   ELSE
                                        CASE WHEN XX.N5TH_PORT_CD <> YY.N5TH_PORT_CD THEN YY.N5TH_PORT_CD
                                             ELSE                                         YY.N6TH_PORT_CD
                                        END 
                              END
                    END
          END  NEW_POD_CD   
          
       
FROM      (
          SELECT    X.BKG_NO
                ,   X.COD_RQST_SEQ
                ,   X.VVD_OP_CD
                ,   MAX(DECODE(SEQ,1,SUBSTR(POL_YD_CD,1,5)))  N1ST_PORT_CD
                ,   MAX(DECODE(SEQ,1,SUBSTR(POD_YD_CD,1,5)))  N2ND_PORT_CD
                ,   MAX(DECODE(SEQ,2,SUBSTR(POD_YD_CD,1,5)))  N3RD_PORT_CD
                ,   MAX(DECODE(SEQ,3,SUBSTR(POD_YD_CD,1,5)))  N4TH_PORT_CD
                ,   MAX(DECODE(SEQ,4,SUBSTR(POD_YD_CD,1,5)))  N5TH_PORT_CD
                ,   MAX(DECODE(SEQ,5,SUBSTR(POD_YD_CD,1,5)))  N6TH_PORT_CD
          FROM      (    
                    SELECT  ROWNUM           AS SEQ
                        ,   V.BKG_NO
                        ,   V.COD_RQST_SEQ
                        ,   V.VVD_OP_CD
                        ,   V.VSL_PRE_PST_CD
                        ,   V.VSL_SEQ
                        ,   V.POL_YD_CD
                        ,   V.POD_YD_CD
                    FROM    (
                            SELECT    V.BKG_NO
                                  ,   V.COD_RQST_SEQ
                                  ,   V.VVD_OP_CD
                                  ,   V.VSL_PRE_PST_CD
                                  ,   V.VSL_SEQ
                                  ,   V.POL_YD_CD
                                  ,   V.POD_YD_CD
                            FROM      BKG_COD_VVD               V
                            WHERE     1 = 1
                            AND       V.VVD_OP_CD               = 'O'   /* O : OLD VVD */
                            AND       V.BKG_NO                  = @[bkg_no]
                            AND       V.COD_RQST_SEQ            = @[cod_rqst_seq]
                            ORDER BY  V.VSL_PRE_PST_CD          ASC
                                  ,   V.VSL_SEQ                 ASC
                            ) V
                    ) X
          GROUP BY  X.BKG_NO
                ,   X.COD_RQST_SEQ
                ,   X.VVD_OP_CD
          ) XX                        
          ,
          (
          SELECT    X.BKG_NO
                ,   X.COD_RQST_SEQ
                ,   X.VVD_OP_CD
                ,   MAX(DECODE(SEQ,1,SUBSTR(POL_YD_CD,1,5)))  N1ST_PORT_CD
                ,   MAX(DECODE(SEQ,1,SUBSTR(POD_YD_CD,1,5)))  N2ND_PORT_CD
                ,   MAX(DECODE(SEQ,2,SUBSTR(POD_YD_CD,1,5)))  N3RD_PORT_CD
                ,   MAX(DECODE(SEQ,3,SUBSTR(POD_YD_CD,1,5)))  N4TH_PORT_CD
                ,   MAX(DECODE(SEQ,4,SUBSTR(POD_YD_CD,1,5)))  N5TH_PORT_CD
                ,   MAX(DECODE(SEQ,5,SUBSTR(POD_YD_CD,1,5)))  N6TH_PORT_CD
          FROM      (    
                    SELECT  ROWNUM           AS SEQ
                        ,   V.BKG_NO
                        ,   V.COD_RQST_SEQ
                        ,   V.VVD_OP_CD
                        ,   V.VSL_PRE_PST_CD
                        ,   V.VSL_SEQ
                        ,   V.POL_YD_CD
                        ,   V.POD_YD_CD
                    FROM    (
                            SELECT    V.BKG_NO
                                  ,   V.COD_RQST_SEQ
                                  ,   V.VVD_OP_CD
                                  ,   V.VSL_PRE_PST_CD
                                  ,   V.VSL_SEQ
                                  ,   V.POL_YD_CD
                                  ,   V.POD_YD_CD
                            FROM      BKG_COD_VVD               V
                            WHERE     1 = 1
                            AND       V.VVD_OP_CD               = 'N'   /* N : NEW VVD */
                            AND       V.BKG_NO                  = @[bkg_no]
                            AND       V.COD_RQST_SEQ            = @[cod_rqst_seq]
                            ORDER BY  V.VSL_PRE_PST_CD          ASC
                                  ,   V.VSL_SEQ                 ASC
                            ) V
                    ) X
          GROUP BY  X.BKG_NO
                ,   X.COD_RQST_SEQ
                ,   X.VVD_OP_CD
           ) YY
WHERE      XX.BKG_NO           = YY.BKG_NO           
AND        XX.COD_RQST_SEQ     = YY.COD_RQST_SEQ
)AA			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="cod_rqst_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
