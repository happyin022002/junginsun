<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OwnDangerousCargoApprovalDBDAOSearchAwkApprovalDetailListRSQL">
			<desc><![CDATA[Awkward 승인조회
[2015.06.25] EML_SND_NO > SCG_VVD_APRO_RQST.INDIV_EML_SND_NO ]]></desc>
			<sql><![CDATA[
SELECT BOOKING_NO
     , BKG_STS_CD
     , AWK_CGO_SEQ
     , SPCL_CNTR_SEQ
     , RQST_DAY
     , SPCL_CGO_AUTH_CD
     , SPCL_CGO_AUTH_RJCT_CD
     , APRO_REF_NO
     , EML_SND_NO
     , SLAN_CD
     , VSL_CD
     , SKD_VOY_NO
     , SKD_DIR_CD
     , CGO_OPR_CD
     , CRR_CD
     , CRR_CODE
     , POR_CD
     , POL_CD
     , VPS_ETA_DT
     , POD_CD
     , DEL_CD
     , CNTR_TPSZ_CD
     , CMDT_NM
     , TTL_DIM_LEN
     , TTL_DIM_WDT
     , TTL_DIM_HGT
     , OVR_FWRD_LEN
     , OVR_BKWD_LEN
     , OVR_LF_LEN
     , OVR_RT_LEN
     , OVR_HGT
     , XTD_OVR_QTY
     , GRS_WGT
     , NET_WGT
     , OVR_VOID_SLT_QTY
     , BKG_NO
     , SPCL_CGO_APRO_RQST_SEQ
     , SPCL_CGO_RQST_SEQ
     , VSL_PRE_PST_CD
     , VSL_SEQ
     , CNTR_NO
     , SPCL_CGO_CATE_CD
     , AWK_CGO_QTY
     , LST_RQST_DAT_FLG
     , BKG_RCV_TERM_CD
     , BKG_DE_TERM_CD
     , POL_CLPT_IND_SEQ
     , POD_CLPT_IND_SEQ
     , POL_YD_CD
     , POD_YD_CD
     , RGN_SHP_OPR_CD
     , SPCL_CGO_AUTH_NO
     , AUTH_OFC_CD
     , SPCL_CGO_AUTH_SEQ
     , SCG_FLG
     , RQST_AUTH_CD
     , RQST_OFC_CD
     , RQST_DT
     , RQST_GDT
     , RQST_USR_ID
     , AUTH_DT
     , AUTH_GDT
     , AUTH_USR_ID
     , SPCL_CGO_AUTH_RMK    
FROM(     
    SELECT ORD_SEQ
         , BOOKING_NO
         , BKG_STS_CD
         , AWK_CGO_SEQ
         , null SPCL_CNTR_SEQ
         , RQST_DAY
         , SPCL_CGO_AUTH_CD
         , SPCL_CGO_AUTH_RJCT_CD
         , APRO_REF_NO
         , EML_SND_NO
         , SLAN_CD
         , VSL_CD
         , SKD_VOY_NO
         , SKD_DIR_CD
         , null CGO_OPR_CD
         , CRR_CD
         , CRR_CODE
         , POR_CD
         , POL_CD
         , VPS_ETA_DT
         , POD_CD
         , DEL_CD
         , CNTR_TPSZ_CD
         , CMDT_NM
         , TTL_DIM_LEN
         , TTL_DIM_WDT
         , TTL_DIM_HGT
         , OVR_FWRD_LEN
         , OVR_BKWD_LEN
         , OVR_LF_LEN
         , OVR_RT_LEN
         , OVR_HGT
         , XTD_OVR_QTY
         , GRS_WGT
         , NET_WGT
         , OVR_VOID_SLT_QTY
         , BKG_NO
         , SPCL_CGO_APRO_RQST_SEQ
         , SPCL_CGO_RQST_SEQ
         , VSL_PRE_PST_CD
         , VSL_SEQ
         , CNTR_NO
         , SPCL_CGO_CATE_CD
         , AWK_CGO_QTY
         , LST_RQST_DAT_FLG
         , BKG_RCV_TERM_CD
         , BKG_DE_TERM_CD
         , POL_CLPT_IND_SEQ
         , POD_CLPT_IND_SEQ
         , POL_YD_CD
         , POD_YD_CD
         , RGN_SHP_OPR_CD
         , SPCL_CGO_AUTH_NO
         , AUTH_OFC_CD
         , SPCL_CGO_AUTH_SEQ
         , SCG_FLG
         , RQST_AUTH_CD
         , RQST_OFC_CD
         , RQST_DT
         , RQST_GDT
         , RQST_USR_ID
         , AUTH_DT
         , AUTH_GDT
         , AUTH_USR_ID
         , SPCL_CGO_AUTH_RMK
      FROM (
         SELECT
            1 AS ORD_SEQ,
            A.BKG_NO AS BOOKING_NO,
            A.BKG_STS_CD,
            A.AWK_CGO_SEQ,
            ROUND( NVL(GLOBALDATE_PKG.TIME_CONV_FNC(COM_ConstantMgr_PKG.COM_getBaseLocationCode_FNC(),SYSDATE,'GMT'), SYSDATE) - A.RQST_GDT, 1 ) AS RQST_DAY,
            DECODE(NVL(G.SPCL_CGO_AUTH_CD,'R'),'R','R'||A.SPCL_CGO_RQST_SEQ, G.SPCL_CGO_AUTH_CD) AS SPCL_CGO_AUTH_CD,
            SUBSTR(DECODE(NVL(G.SPCL_CGO_AUTH_CD,'R'),'R','R'||A.SPCL_CGO_RQST_SEQ, G.SPCL_CGO_AUTH_CD),1,1) AS SPCL_CGO_AUTH_CD_CHK,
            G.SPCL_CGO_AUTH_RJCT_CD,
            G.APRO_REF_NO,
        (	SELECT DECODE(EML_PROC_STS_CD,'1','W', 
                                          '3','Y', 
                                          '4','F', 
                                          '') 
            FROM   COM_EML_SND_INFO 
            WHERE  EML_SND_NO = A.EML_SND_NO) AS EML_SND_NO, 
            A.SLAN_CD,
            A.VSL_CD,
            A.SKD_VOY_NO,
            A.SKD_DIR_CD,
            A.CRR_CD, 
            NVL(( SELECT DISTINCT CRR_CD
                  FROM   (
                           SELECT  DISTINCT NVL(B.VSL_CD,A.VSL_CD) VSL_CD, 
                                   NVL(B.CRR_CD,A.CRR_CD) CRR_CD, 
                                   NVL(A.EFF_DT,B.EFF_DT) EFF_DT, 
                                   NVL(A.EXP_DT,B.EXP_DT) EXP_DT
                           FROM    (
                                      SELECT  DECODE(V.VSL_CD,NULL,C.VSL_CD,V.VSL_CD)               VSL_CD,
                                                 DECODE(C.FLET_CTRT_TP_CD,'OW',COM_ConstantMgr_PKG.COM_getCompanyCode_FNC(),'TI',COM_ConstantMgr_PKG.COM_getCompanyCode_FNC(),'OTH') CRR_CD,
                                                 C.EFF_DT, 
                                                 C.EXP_DT
                                      FROM    FMS_CONTRACT C
                                           ,  FMS_ID_VSL V
                                      WHERE   NVL(C.DELT_FLG,'N') = 'N'
                                      AND     C.FLET_CTRT_FACT_CD = 'ACT'
                                      AND     C.FLET_CTRT_NO = V.FLET_CTRT_NO(+)
                                      AND  V.USE_FLG(+) = 'Y'
                                      AND  C.FLET_CTRT_TP_CD = 'TI'
                                      UNION ALL
                                      SELECT  C.VSL_CD                VSL_CD,
                                              DECODE(C.FLET_CTRT_TP_CD,'OW',COM_ConstantMgr_PKG.COM_getCompanyCode_FNC(),'TI',COM_ConstantMgr_PKG.COM_getCompanyCode_FNC(),'OTH') CRR_CD,
                                              C.EFF_DT, 
                                              C.EXP_DT
                                      FROM   FMS_CONTRACT C
                                      WHERE  NVL(C.DELT_FLG,'N') = 'N'
                                      AND     C.FLET_CTRT_FACT_CD = 'ACT'
                                      AND     C.FLET_CTRT_TP_CD = 'TI'
                                   ) A,
                                   ( 
                                     SELECT  DECODE(V.VSL_CD,NULL,C.VSL_CD,V.VSL_CD)               VSL_CD,
                                             DECODE(C.FLET_CTRT_TP_CD,'OW',COM_ConstantMgr_PKG.COM_getCompanyCode_FNC(),'TI',COM_ConstantMgr_PKG.COM_getCompanyCode_FNC(),'OTH') CRR_CD,
                                             C.EFF_DT, 
                                             C.EXP_DT
                                     FROM    FMS_CONTRACT C
                                          ,  FMS_ID_VSL V
                                     WHERE   NVL(C.DELT_FLG,'N') = 'N'
                                     AND     C.FLET_CTRT_FACT_CD = 'ACT'
                                     AND     C.FLET_CTRT_NO = V.FLET_CTRT_NO(+)
                                     AND     V.USE_FLG(+) = 'Y'
                                     AND     C.FLET_CTRT_TP_CD = 'TO'
                                     UNION ALL
                                     SELECT  C.VSL_CD                 VSL_CD,
                                             DECODE(C.FLET_CTRT_TP_CD,'OW',COM_ConstantMgr_PKG.COM_getCompanyCode_FNC(),'TI',COM_ConstantMgr_PKG.COM_getCompanyCode_FNC(),'OTH') CRR_CD,
                                             C.EFF_DT, 
                                             C.EXP_DT
                                      FROM    FMS_CONTRACT C
                                      WHERE   NVL(C.DELT_FLG,'N') = 'N'
                                      AND     C.FLET_CTRT_FACT_CD = 'ACT'
                                      AND     C.FLET_CTRT_TP_CD = 'TO'
                                       ) B   
                           WHERE A.VSL_CD = B.VSL_CD(+)
                           UNION ALL
                           SELECT  DISTINCT NVL(B.VSL_CD,A.VSL_CD) VSL_CD, 
                                   NVL(B.CRR_CD,A.CRR_CD) CRR_CD, 
                                   NVL(A.EFF_DT,B.EFF_DT) EFF_DT, 
                                   NVL(A.EXP_DT,B.EXP_DT) EXP_DT
                           FROM    (
                                     SELECT  DECODE(V.VSL_CD,NULL,C.VSL_CD,V.VSL_CD)               VSL_CD,
                                             DECODE(C.FLET_CTRT_TP_CD,'OW',COM_ConstantMgr_PKG.COM_getCompanyCode_FNC(),'TI',COM_ConstantMgr_PKG.COM_getCompanyCode_FNC(),'OTH') CRR_CD,
                                             C.EFF_DT, 
                                             C.EXP_DT
                                     FROM    FMS_CONTRACT C, FMS_ID_VSL V
                                     WHERE   NVL(C.DELT_FLG,'N') = 'N'
                                     AND     C.FLET_CTRT_FACT_CD = 'ACT'
                                     AND     C.FLET_CTRT_NO = V.FLET_CTRT_NO(+)
                                     AND     V.USE_FLG(+) = 'Y'
                                     AND     C.FLET_CTRT_TP_CD = 'OW'
                                     UNION ALL
                                     SELECT  C.VSL_CD                 VSL_CD,
                                             DECODE(C.FLET_CTRT_TP_CD,'OW',COM_ConstantMgr_PKG.COM_getCompanyCode_FNC(),'TI',COM_ConstantMgr_PKG.COM_getCompanyCode_FNC(),'OTH') CRR_CD,
                                             C.EFF_DT, 
                                             C.EXP_DT
                                     FROM    FMS_CONTRACT C
                                     WHERE   NVL(C.DELT_FLG,'N') = 'N'
                                     AND     C.FLET_CTRT_FACT_CD = 'ACT'
                                     AND     C.FLET_CTRT_TP_CD = 'OW'
                                   ) A,
                                   ( 
                                     SELECT  DECODE(V.VSL_CD,NULL,C.VSL_CD,V.VSL_CD)               VSL_CD,
                                             DECODE(C.FLET_CTRT_TP_CD,'OW',COM_ConstantMgr_PKG.COM_getCompanyCode_FNC(),'TI',COM_ConstantMgr_PKG.COM_getCompanyCode_FNC(),'OTH') CRR_CD,
                                             C.EFF_DT, 
                                             C.EXP_DT
                                     FROM    FMS_CONTRACT C
                                          ,  FMS_ID_VSL V
                                     WHERE   NVL(C.DELT_FLG,'N') = 'N'
                                     AND     C.FLET_CTRT_FACT_CD = 'ACT'
                                     AND     C.FLET_CTRT_NO = V.FLET_CTRT_NO(+)
                                     AND     V.USE_FLG(+) = 'Y'
                                     AND     C.FLET_CTRT_TP_CD = 'TO'
                                     UNION ALL
                                     SELECT  C.VSL_CD                 VSL_CD,
                                             DECODE(C.FLET_CTRT_TP_CD,'OW',COM_ConstantMgr_PKG.COM_getCompanyCode_FNC(),'TI',COM_ConstantMgr_PKG.COM_getCompanyCode_FNC(),'OTH') CRR_CD,
                                             C.EFF_DT, 
                                             C.EXP_DT
                                     FROM    FMS_CONTRACT C
                                     WHERE   NVL(C.DELT_FLG,'N') = 'N'
                                     AND     C.FLET_CTRT_FACT_CD = 'ACT'
                                     AND     C.FLET_CTRT_TP_CD = 'TO'
                                   ) B   
                           WHERE A.VSL_CD = B.VSL_CD(+)
                         )
                  WHERE VSL_CD = A.VSL_CD
                  AND     (   TO_CHAR(A.VPS_ETA_DT,'YYYYMMDD') BETWEEN TO_CHAR(EFF_DT,'YYYYMMDD') AND TO_CHAR(EXP_DT,'YYYYMMDD')
                           OR TO_CHAR(A.VPS_ETA_DT,'YYYYMMDD') BETWEEN TO_CHAR(EFF_DT,'YYYYMMDD') AND TO_CHAR(EXP_DT,'YYYYMMDD')
                           OR ( TO_CHAR(EFF_DT,'YYYYMMDD') >= TO_CHAR(A.VPS_ETA_DT,'YYYYMMDD') AND TO_CHAR(EXP_DT,'YYYYMMDD') <= TO_CHAR(A.VPS_ETA_DT,'YYYYMMDD') ) 
                          )),A.CRR_CD) AS CRR_CODE, 
            A.POR_CD,
            A.POL_CD,
            TO_CHAR(A.VPS_ETA_DT,'YYYY-MM-DD HH24:MI') AS VPS_ETA_DT,
            A.POD_CD,
            A.DEL_CD,       
            A.CNTR_TPSZ_CD, 
        (	SELECT CMDT_NM FROM MDM_COMMODITY WHERE CMDT_CD = A.CMDT_CD) AS CMDT_NM,
            A.TTL_DIM_LEN,
            A.TTL_DIM_WDT,
            A.TTL_DIM_HGT,
            A.OVR_FWRD_LEN,
            A.OVR_BKWD_LEN,
            A.OVR_LF_LEN,
            A.OVR_RT_LEN,
            A.OVR_HGT,
            A.XTD_OVR_QTY,
            A.GRS_WGT,
            A.NET_WGT,
            A.OVR_VOID_SLT_QTY,
            -- HIDDEN COLUMN --
            A.BKG_NO, 
            A.SPCL_CGO_APRO_RQST_SEQ, 
            A.SPCL_CGO_RQST_SEQ,
            A.VSL_PRE_PST_CD,
            A.VSL_SEQ,
            A.CNTR_NO,
            A.SPCL_CGO_CATE_CD,
            A.AWK_CGO_QTY,
            A.LST_RQST_DAT_FLG,
            A.BKG_RCV_TERM_CD,
            A.BKG_DE_TERM_CD,
            A.POL_CLPT_IND_SEQ,	
            A.POD_CLPT_IND_SEQ,
            A.POL_YD_CD,
            A.POD_YD_CD,
            A.RGN_SHP_OPR_CD,
            G.SPCL_CGO_AUTH_NO,
            G.AUTH_OFC_CD,
            G.SPCL_CGO_AUTH_SEQ,    
            -- HIDDEN COLUMN --
            --HIDDEN COLUMN SCG-1015PAGE--
            '' AS SCG_FLG,
            '' AS RQST_AUTH_CD,
            A.RQST_OFC_CD,
            TO_CHAR(A.RQST_DT, 'YYYY-MM-DD HH24:MI') AS RQST_DT,
            TO_CHAR(A.RQST_GDT, 'YYYY-MM-DD HH24:MI') AS RQST_GDT,
            A.RQST_USR_ID,
            TO_CHAR(G.AUTH_DT, 'YYYY-MM-DD HH24:MI') AS AUTH_DT,
            TO_CHAR(G.AUTH_GDT, 'YYYY-MM-DD HH24:MI') AS AUTH_GDT,
            G.AUTH_USR_ID,
            G.SPCL_CGO_AUTH_RMK,
            --HIDDEN COLUMN SCG-1015PAGE--
            --2016-04-14 duplicated data 조회 방지 
            ROW_NUMBER() OVER (PARTITION BY NVL(G.BKG_NO, A.BKG_NO),NVL(G.SPCL_CGO_APRO_RQST_SEQ, A.SPCL_CGO_APRO_RQST_SEQ),NVL(G.AWK_CGO_SEQ, A.AWK_CGO_SEQ),NVL(G.VSL_PRE_PST_CD, A.VSL_PRE_PST_CD),NVL(G.VSL_SEQ, A.VSL_SEQ)
            ORDER BY  DECODE(G.APRO_REF_NO,NULL,9,1), G.UPD_DT DESC ) AS CORR_AUTH_SEQ
         FROM 
             (SELECT	
                    A.BKG_NO,
                    A.BKG_STS_CD,
                    C.SLAN_CD,
                    B.SPCL_CGO_APRO_RQST_SEQ,
                    B.SPCL_CGO_RQST_SEQ,
                    B.AWK_CGO_QTY,
                    B.LST_RQST_DAT_FLG,
                    B.BKG_RCV_TERM_CD,
                    B.BKG_DE_TERM_CD,              
                    C.INDIV_EML_SND_NO AS EML_SND_NO,
                    B.POR_CD,
                    B.DEL_CD,
                    B.SPCL_CGO_CATE_CD,
                    B.RQST_OFC_CD,
                    B.RQST_DT,
                    B.RQST_GDT,
                    B.RQST_USR_ID,
                    C.VSL_CD,
                    C.SKD_VOY_NO,
                    C.SKD_DIR_CD,
                    C.POL_CD,
                    C.POD_CD,
                    C.VSL_PRE_PST_CD,
                    C.VSL_SEQ,
                    C.POL_CLPT_IND_SEQ,
                    C.POD_CLPT_IND_SEQ,
                    C.POL_YD_CD,
                    C.POD_YD_CD,
                    D.CRR_CD,
                    E.RGN_SHP_OPR_CD,
                    F.AWK_CGO_SEQ,
                    F.CNTR_NO,
                    F.CNTR_TPSZ_CD,
                    F.TTL_DIM_LEN,
                    F.TTL_DIM_WDT,
                    F.TTL_DIM_HGT,
                    F.OVR_FWRD_LEN,
                    F.OVR_BKWD_LEN,
                    F.OVR_LF_LEN,
                    F.OVR_RT_LEN,
                    F.OVR_HGT,
                    F.XTD_OVR_QTY,
                    F.GRS_WGT,
                    F.NET_WGT,
                    F.CMDT_CD,
                    F.OVR_VOID_SLT_QTY,
                    V.VPS_ETA_DT
            FROM	SCG_APRO_RQST B, 
                    SCG_VVD_APRO_RQST C, 
                    SCG_RGN_SHP_OPR_PORT E,
                    MDM_VSL_CNTR D,
                    BKG_AWK_CGO F, 
                    BKG_BOOKING A,
                    VSK_VSL_PORT_SKD V
            WHERE	B.SPCL_CGO_CATE_CD 			= 'AK' 
            AND		B.LST_RQST_DAT_FLG 			= 'Y' 
            AND		B.BKG_NO 					= C.BKG_NO 
            AND 	B.SPCL_CGO_APRO_RQST_SEQ 	= C.SPCL_CGO_APRO_RQST_SEQ 
            AND 	C.POL_CD 					= E.LOC_CD 
            AND 	C.VSL_CD 					= D.VSL_CD 
            AND 	D.DELT_FLG 					= 'N' 
            AND 	E.DELT_FLG 					= 'N' 	
            AND 	B.BKG_NO 					= F.BKG_NO 
            AND 	F.SPCL_CGO_APRO_CD 			IS NOT NULL 
            AND 	V.VSL_CD 					= C.VSL_CD
            AND 	V.SKD_VOY_NO 				= C.SKD_VOY_NO
            AND 	V.SKD_DIR_CD 				= C.SKD_DIR_CD
            AND 	V.VPS_PORT_CD 				= C.POL_CD
            AND 	V.CLPT_IND_SEQ 				= C.POL_CLPT_IND_SEQ
            AND 	B.BKG_NO 					= A.BKG_NO                   
            AND 	A.BKG_STS_CD 				!= 'X'
            --AND   	B.SPCL_CGO_APRO_RQST_SEQ 	= F.SPCL_CGO_APRO_RQST_SEQ
            AND 	F.SPCL_CGO_APRO_CD 			NOT IN ('C','D')
        #if (${rgn_shp_opr_cd} != '') 
            AND		E.RGN_SHP_OPR_CD 	= @[rgn_shp_opr_cd]
        #end

        #if ($slan_cd.size() > 0) 
            AND 	C.SLAN_CD IN ( 
                    #foreach($key IN ${slan_cd}) 
                        #if($velocityCount < $slan_cd.size()) 
                            '$key', 
                        #else 
                            '$key' 
                        #end 
                    #end 
                    )
        #end

        #if (${vsl_cd} != '') 
            AND		C.VSL_CD 			IN ( @[vsl_cd] )
        #end

        #if (${imdg_un_no} != '') 
            AND 	F.IMDG_UN_NO 		= @[imdg_un_no]
        #end

        #if (${imdg_un_no_seq} != '') 
            AND 	F.IMDG_UN_NO_SEQ 	= @[imdg_un_no_seq]
        #end

        #if (${imdg_clss_cd} != '') 
            AND 	F.IMDG_CLSS_CD 		= @[imdg_clss_cd]
        #end

        #if (${skd_voy_no} != '') 
            AND		C.SKD_VOY_NO 		IN ( @[skd_voy_no] )
        #end

        #if (${skd_dir_cd} != '') 
            AND 	C.SKD_DIR_CD 		IN ( @[skd_dir_cd] )
        #end
        
        #if (${pol_cd} != '') 
            AND 	C.POL_CD 			= @[pol_cd]
        #end

        #if (${pod_cd} != '') 
            AND 	C.POD_CD 			= @[pod_cd]
        #end

        #if (${val_opr_tp_cd} == 'H') 
            AND 	D.CRR_CD 			= COM_ConstantMgr_PKG.COM_getCompanyCode_FNC()
        #end
        
        #if (${val_opr_tp_cd} == 'O') 
            AND		D.CRR_CD 			!= COM_ConstantMgr_PKG.COM_getCompanyCode_FNC()
        #end  	
        
        #if (${booking_no} != '') 
            AND 	A.BKG_NO 			= @[booking_no]
        #end

        #if (${shpr_nm} != '') 
            AND 	A.BKG_NO IN (
                        SELECT 	SH.BKG_NO
                        FROM 	BKG_CUSTOMER SH
                        WHERE 	SH.BKG_CUST_TP_CD = 'S'
                        AND 	SH.CUST_NM LIKE '%'||@[shpr_nm]||'%'
                    )
        #end
        
        --For Approved Details
        #if (${from_eta_dt} != '' && ${to_eta_dt} != '') 
            AND V.VPS_ETA_DT BETWEEN TO_DATE(@[from_eta_dt],'YYYYMMDD') AND TO_DATE(@[to_eta_dt],'YYYYMMDD')+0.99999
        #elseif (${from_eta_dt} != '') 
            AND DECODE(C.VSL_PRE_PST_CD,'U',V.VPS_ETA_DT,B.RQST_DT)	<= NVL(GLOBALDATE_PKG.TIME_CONV_FNC(COM_ConstantMgr_PKG.COM_getBaseLocationCode_FNC(),SYSDATE,BKG_COM_USER_LOC_FNC(@[usr_id])), SYSDATE) + TO_NUMBER(@[from_eta_dt])
        #end
            
        ) A
        , SCG_AUTHORIZATION G

    WHERE A.BKG_NO                 		= G.BKG_NO(+)
    AND   A.SPCL_CGO_APRO_RQST_SEQ 		= G.SPCL_CGO_APRO_RQST_SEQ(+)
    AND   A.VSL_PRE_PST_CD         		= G.VSL_PRE_PST_CD(+)
    AND   A.VSL_SEQ                		= G.VSL_SEQ(+)
    AND   A.AWK_CGO_SEQ            		= G.AWK_CGO_SEQ(+)
    )A
    WHERE 1=1
	--2016-04-14 duplicated data 조회 방지
	AND  	A.CORR_AUTH_SEQ 			= 1 	
    #if (${auth_flg} == 'Y') 
        AND SPCL_CGO_AUTH_CD_CHK    	= 'Y'
    #end
    #if (${auth_flg} == 'U') 
        AND SPCL_CGO_AUTH_CD_CHK 	    = 'R'
    #end
    #if (${auth_flg} == 'N') 
        AND SPCL_CGO_AUTH_CD_CHK		= 'N'
    #end
    #if (${auth_flg} == 'YN')
        AND SPCL_CGO_AUTH_CD_CHK		IN ('Y','N','R','P')
    #end
    #if (${apro_ref_no} != '') 
        AND APRO_REF_NO 				= @[apro_ref_no]
    #end
    #if (${scg_all_flg} != 'Y')
        AND ORD_SEQ IS NULL
    #end

UNION ALL

    SELECT	2 AS ORD_SEQ	
        ,   XX.BOOKING_NO
        ,   null BKG_STS_CD
        ,   null AWK_CGO_SEQ 
        ,   XX.SPCL_CNTR_SEQ
        ,   null RQST_DAY
        ,   XX.AUTH_STS_CD SPCL_CGO_AUTH_CD
		,	XX.SPCL_CGO_AUTH_RJCT_CD
		,	XX.APRO_REF_NO
        ,   null EML_SND_NO 
		,	XX.SLAN_CD
		,	XX.VSL_CD
		,	XX.SKD_VOY_NO
		,	XX.SKD_DIR_CD
        ,   XX.CGO_OPR_CD
		,	XX.CRR_CD
        ,   null CRR_CODE
        ,   null POR_CD
		,	XX.POL_CD
        ,   null VPS_ETA_DT
		,	XX.POD_CD
        ,   null DEL_CD
		,	XX.CNTR_TPSZ_CD
        ,   XX.CMDT_DESC AS CMDT_NM
		,	XX.TTL_DIM_LEN
		,	XX.TTL_DIM_WDT
		,	XX.TTL_DIM_HGT
        ,	XX.FWRD_OVR_DIM_LEN  AS OVR_FWRD_LEN
        ,	XX.BKWD_OVR_DIM_LEN  AS OVR_BKWD_LEN
        ,	XX.LF_SD_OVR_DIM_LEN AS OVR_LF_LEN
        ,	XX.RT_SD_OVR_DIM_LEN AS OVR_RT_LEN
        ,	XX.HGT_OVR_DIM_LEN   AS OVR_HGT
        ,   null XTD_OVR_QTY
		,	XX.GRS_WGT
		,	XX.NET_WGT
        ,   XX.VOID_SLT_QTY AS OVR_VOID_SLT_QTY
        ,   XX.BOOKING_NO AS BKG_NO
        ,   null SPCL_CGO_APRO_RQST_SEQ
		,	XX.SPCL_CGO_RQST_SEQ
        ,   null VSL_PRE_PST_CD
        ,   null VSL_SEQ
        ,   null CNTR_NO
		,	XX.SPCL_CGO_CATE_CD
        ,   null AWK_CGO_QTY
        ,   null LST_RQST_DAT_FLG
        ,   null BKG_RCV_TERM_CD
        ,   null BKG_DE_TERM_CD
		,	XX.POL_CLPT_IND_SEQ
		,	XX.POD_CLPT_IND_SEQ
        ,   null POL_YD_CD
        ,   null POD_YD_CD
		,	XX.RGN_SHP_OPR_CD
        ,   null SPCL_CGO_AUTH_NO
		,	XX.AUTH_OFC_CD
        ,   null SPCL_CGO_AUTH_SEQ
		,	XX.SCG_FLG
        ,   null RQST_AUTH_CD
        ,   null RQST_OFC_CD
        ,   XX.CGO_RQST_DT AS RQST_DT
        ,   null RQST_GDT
        ,   null RQST_USR_ID
		,	XX.AUTH_DT
        ,   null AUTH_GDT
        ,   null AUTH_USR_ID
		,	XX.SPCL_CGO_AUTH_RMK
FROM   (
     --=============================================================================
     --=============================================================================
    SELECT 		
        RQS.BKG_REF_NO BOOKING_NO
    ,   CGO.SPCL_CGO_AUTH_RJCT_CD
    ,	DECODE(CGO.APRO_REF_NO,'0','',CGO.APRO_REF_NO) APRO_REF_NO
    ,	RQS.SLAN_CD
    ,   RQS.VSL_CD
    ,   RQS.SKD_VOY_NO
    ,	RQS.SKD_DIR_CD
    ,   CGO.CGO_OPR_CD
    ,   RQS.CRR_CD
    ,	RQS.POL_CD
    ,	RQS.POD_CD
    ,	CGO.CNTR_TPSZ_CD
    ,	CGO.TTL_DIM_LEN
    ,	CGO.TTL_DIM_WDT
    ,	CGO.TTL_DIM_HGT
    ,	CGO.GRS_WGT
    ,	CGO.NET_WGT
    ,	RQS.SPCL_CGO_RQST_SEQ
    ,	CGO.SPCL_CGO_CATE_CD
    ,   NVL(RQS.POL_CLPT_IND_SEQ, '1') POL_CLPT_IND_SEQ
    ,   NVL(RQS.POD_CLPT_IND_SEQ, '1') POD_CLPT_IND_SEQ
    ,   RQS.RGN_SHP_OPR_CD
    ,	CGO.AUTH_OFC_CD
    ,   DECODE(RQS.DG_FLG,'Y','DG','AK') SCG_FLG
    ,	DECODE(CGO.AUTH_STS_CD,'R','',TO_CHAR(NVL(GLOBALDATE_PKG.TIME_CONV_FNC(COM_ConstantMgr_PKG.COM_getBaseLocationCode_FNC(),CGO.AUTH_DT,'GMT'),CGO.AUTH_DT),'YYYY-MM-DD')) AUTH_DT
    ,   CGO.SPCL_CGO_AUTH_RMK                          AS SPCL_CGO_AUTH_RMK
    #if (${scg_flg} == 'AWK' || ${scg_flg} == 'SCG_AWK' || ${scg_flg} == 'SCG_45') 
    ,   CGO.AUTH_STS_CD
    #else
    ,   DECODE(CGO.AUTH_STS_CD,'R',DECODE(CGO.SPCL_RQST_FLG,'Y','S','')||'R'||CGO.SPCL_CGO_RQST_SEQ, CGO.AUTH_STS_CD) AS AUTH_STS_CD
    #end
    ,   TO_CHAR(NVL(GLOBALDATE_PKG.TIME_CONV_FNC( GLOBALDATE_PKG.GET_LOCCD_FNC(RQS.RQST_OFC_CD), CGO_RQST_DT,'GMT'), CGO_RQST_DT),'YYYY-MM-DD HH24:MI') CGO_RQST_DT
    ,	CGO.FWRD_OVR_DIM_LEN
    ,	CGO.BKWD_OVR_DIM_LEN
    ,	CGO.LF_SD_OVR_DIM_LEN
    ,	CGO.RT_SD_OVR_DIM_LEN
    ,	CGO.HGT_OVR_DIM_LEN
    ,	CGO.VOID_SLT_QTY
    ,	CGO.PRNR_CGO_RQST_SEQ AS PRNR_CGO_RQST_SEQ
    ,	DECODE(CGO.CMDT_DESC,'0','',CGO.CMDT_DESC) CMDT_DESC
    ,	CGO.SPCL_CNTR_SEQ
    FROM SCG_PRNR_APRO_RQST      RQS
       , (
         SELECT T.*
              , AVG(DECODE(T.AUTH_STS_CD,'Y',1,'N',2,-999)) OVER (PARTITION BY T.CRR_CD, T.BKG_REF_NO, T.SPCL_CGO_RQST_SEQ) STS_CT
           FROM SCG_PRNR_APRO_RQST_CGO T
         ) CGO
       , SCG_IMDG_UN_NO          SUN
       , MDM_VSL_CNTR            MDM
    WHERE 1=1
    #if (${rgn_shp_opr_cd} != '')
      AND RQS.RGN_SHP_OPR_CD    = @[rgn_shp_opr_cd]
    #end
    #if (${vsl_cd} != '')
      AND RQS.VSL_CD            = @[vsl_cd]
    #end
    #if (${skd_voy_no} != '')
      AND RQS.SKD_VOY_NO        = @[skd_voy_no]
    #end
    #if (${skd_dir_cd} != '')
      AND RQS.SKD_DIR_CD        = @[skd_dir_cd]
    #end
    #if (${scg_flg} == 'DG1' || ${scg_flg} == 'SCG_DG') 
      AND RQS.DG_FLG            = 'Y'
      AND RQS.AWK_FLG           = 'N'
    #elseif (${scg_flg} == 'AWK' || ${scg_flg} == 'SCG_AWK' || ${scg_flg} == 'SCG_45') 
      AND RQS.DG_FLG            = 'N'
      AND RQS.AWK_FLG           = 'Y'
    #if (${scg_flg} == 'SCG_AWK') 
      --::2015-04-07::--AND CGO.CNTR_TPSZ_CD <> 'D7'
    #end
    #if (${scg_flg} == 'SCG_45') 
      --::2015-04-07::--AND CGO.CNTR_TPSZ_CD = 'D7'
    #end
    #end
      AND RQS.CRR_CD            = CGO.CRR_CD
      AND RQS.BKG_REF_NO        = CGO.BKG_REF_NO
      AND RQS.PRNR_CGO_RQST_SEQ = CGO.PRNR_CGO_RQST_SEQ
      AND RQS.SPCL_CGO_RQST_SEQ = CGO.SPCL_CGO_RQST_SEQ
      AND RQS.VSL_CD            = MDM.VSL_CD
      AND MDM.DELT_FLG 		    = 'N' 
      AND CGO.IMDG_UN_NO        = SUN.IMDG_UN_NO(+)
      AND CGO.IMDG_UN_NO_SEQ    = SUN.IMDG_UN_NO_SEQ(+)
    --  AND (RQS.SRC_TP_CD = 'EDI' AND LST_RQST_DAT_FLG = 'Y'
    --       OR RQS.SRC_TP_CD <> 'EDI')

      --::2015-06-25::--AND RQS.SRC_TP_CD 		<> 'EDI' 
      AND RQS.LST_RQST_DAT_FLG 	= 'Y'
    -- VOP_SCG_0023(Approved)
    #if (${auth_flg} == 'Y') 
      AND (CGO.STS_CT = 1 OR CGO.AUTH_STS_CD = 'Y')
    -- VOP_SCG_0023(Reject)
    #elseif (${auth_flg} == 'N')
      AND CGO.AUTH_STS_CD = 'N'
    -- VOP_SCG_0023(Unapproved)
    #elseif (${auth_flg} == 'U')
      AND CGO.AUTH_STS_CD IN ('R','P')
    -- VOP_SCG_0023(ALL)
    #elseif (${auth_flg} == 'YN')
      AND (CGO.STS_CT = 1 OR (CGO.AUTH_STS_CD IN('Y','N','R','P','C')))
    -- VOP_SCG_0022
    #elseif (${auth_flg} == 'S')
      #if (${func_flg} == 'MNL')
        AND RQS.SRC_TP_CD  <> 'EDI' --20150723
        AND (CGO.AUTH_STS_CD IN('Y','N','R','P','C') OR CGO.AUTH_STS_CD IS NULL)
      #else
        AND RQS.SRC_TP_CD = 'EDI' 
        --:2015-12-23:--AND RQS.EDI_UNMAP_KND_CD IS NOT NULL
        AND CGO.AUTH_STS_CD IS NULL
      #end
    -- VOP_SCG_5001(Pending)
    #elseif (${auth_flg} == 'P')
      AND CGO.AUTH_STS_CD = 'P'
    -- VOP_SCG_5001(Request)
    #elseif (${auth_flg} == 'R')
      AND CGO.AUTH_STS_CD = 'R'
    -- VOP_SCG_5001(ALL)
    #else
    AND (CGO.AUTH_STS_CD IN('R','P') OR ((CGO.AUTH_STS_CD = 'Y' OR CGO.AUTH_STS_CD = 'N') AND CGO.STS_CT < 1))
    #end
    #if ($arr_slan_cd.size() > 0) 
      AND RQS.SLAN_CD IN ( 
        #foreach($key IN ${arr_slan_cd}) 
          #if($velocityCount < $arr_slan_cd.size()) 
            '$key', 
          #else 
            '$key' 
          #end 
        #end 
      )
    #end
    #if (${pol_cd} != '')
      AND RQS.POL_CD = @[pol_cd]
    #end
    #if (${pod_cd} != '')
      AND RQS.POD_CD = @[pod_cd]
    #end
    #if (${cgo_opr_cd} != '')
      AND CGO.CGO_OPR_CD = @[cgo_opr_cd]
    #end
    #if (${booking_no} != '') 
      AND RQS.BKG_REF_NO = @[booking_no]
    #end
    #if (${apro_ref_no} != '') 
      AND CGO.APRO_REF_NO = @[apro_ref_no]
    #end
    #if (${imdg_un_no} != '') 
      AND CGO.IMDG_UN_NO = @[imdg_un_no]
    #end
    #if (${imdg_un_no_seq} != '') 
      AND CGO.IMDG_UN_NO_SEQ = @[imdg_un_no_seq]
    #end
    #if (${imdg_clss_cd} != '') 
      AND CGO.IMDG_CLSS_CD = @[imdg_clss_cd]
    #end
    #if (${prp_shp_nm} != '') 
      AND CGO.PRP_SHP_NM LIKE '%'||@[prp_shp_nm]||'%'
    #end
    #if (${apro_ref_no} != '') 
      AND CGO.APRO_REF_NO = @[apro_ref_no]
    #end
    #if (${from_eta_dt} != '' && ${to_eta_dt} != '') 
        AND RQS.ETA_DT BETWEEN TO_DATE(@[from_eta_dt],'YYYYMMDD') AND TO_DATE(@[to_eta_dt],'YYYYMMDD')+0.99999
    #elseif (${from_eta_dt} != '') 
        AND RQS.ETA_DT	<= NVL(GLOBALDATE_PKG.TIME_CONV_FNC(COM_ConstantMgr_PKG.COM_getBaseLocationCode_FNC(),SYSDATE,BKG_COM_USER_LOC_FNC(@[upd_usr_id])), SYSDATE) + TO_NUMBER(@[from_eta_dt])
    #end
    #if (${src_tp_cd} != '')
        AND RQS.SRC_TP_CD = @[src_tp_cd]
    #end
    #if (${dcgo_ref_no} != '')
        AND CGO.DCGO_REF_NO = @[dcgo_ref_no]
    #end


    #if (${func_flg} == 'MNL')

        #if (${from_req_dt} != '') 
        AND TO_DATE(DECODE(CGO.AUTH_STS_CD, NULL,
            TO_CHAR(NVL(GLOBALDATE_PKG.TIME_CONV_FNC(GLOBALDATE_PKG.GET_LOCCD_FNC(RQS.RQST_OFC_CD), CGO.UPD_DT,'GMT'), CGO.UPD_DT),'YYYYMMDD'),
            TO_CHAR(NVL(GLOBALDATE_PKG.TIME_CONV_FNC(GLOBALDATE_PKG.GET_LOCCD_FNC(RQS.RQST_OFC_CD), CGO.CGO_RQST_DT,'GMT'), CGO.CGO_RQST_DT),'YYYYMMDD')
            ),'YYYYMMDD')	>= TO_DATE(@[from_req_dt],'YYYYMMDD')
        #end
        #if (${to_req_dt} != '') 
        AND TO_DATE(DECODE(CGO.AUTH_STS_CD, NULL,
            TO_CHAR(NVL(GLOBALDATE_PKG.TIME_CONV_FNC(GLOBALDATE_PKG.GET_LOCCD_FNC(RQS.RQST_OFC_CD), CGO.UPD_DT,'GMT'), CGO.UPD_DT),'YYYYMMDD'),
            TO_CHAR(NVL(GLOBALDATE_PKG.TIME_CONV_FNC(GLOBALDATE_PKG.GET_LOCCD_FNC(RQS.RQST_OFC_CD), CGO.CGO_RQST_DT,'GMT'), CGO.CGO_RQST_DT),'YYYYMMDD')
            ),'YYYYMMDD')	<= TO_DATE(@[to_req_dt],'YYYYMMDD')+0.99999
        #end

    #else

        #if (${from_req_dt} != '') 
        AND	RQS.CRE_DT	>= TO_DATE(@[from_req_dt]	,'YYYYMMDD')
        #end
        #if (${to_req_dt} != '') 
        AND	RQS.CRE_DT	<= TO_DATE(@[to_req_dt]		,'YYYYMMDD')+0.99999
        #end

    #end

    #if (${func_flg} == 'EDI')
    AND RQS.EDI_UNMAP_KND_CD IS NOT NULL
    #end

     --=============================================================================
     --=============================================================================
	) XX

) 
ORDER BY ORD_SEQ ,
         VPS_ETA_DT, 
         SLAN_CD, 
         VSL_CD ,
         SKD_VOY_NO, 
         SKD_DIR_CD, 
         CRR_CD, 
         POL_CD, 
         POD_CD, 
         BKG_NO,  
         AWK_CGO_SEQ			]]></sql>
			<params>
				<param name="rgn_shp_opr_cd" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="imdg_un_no" type="12" value="" out="N"/>
				<param name="imdg_un_no_seq" type="12" value="" out="N"/>
				<param name="imdg_clss_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="booking_no" type="12" value="" out="N"/>
				<param name="shpr_nm" type="12" value="" out="N"/>
				<param name="from_eta_dt" type="12" value="" out="N"/>
				<param name="to_eta_dt" type="12" value="" out="N"/>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="apro_ref_no" type="12" value="" out="N"/>
				<param name="cgo_opr_cd" type="12" value="" out="N"/>
				<param name="prp_shp_nm" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="src_tp_cd" type="12" value="" out="N"/>
				<param name="dcgo_ref_no" type="12" value="" out="N"/>
				<param name="from_req_dt" type="12" value="" out="N"/>
				<param name="to_req_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
