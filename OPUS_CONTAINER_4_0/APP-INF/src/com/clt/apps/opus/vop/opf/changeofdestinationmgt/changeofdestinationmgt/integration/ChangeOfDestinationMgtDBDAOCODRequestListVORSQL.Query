<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChangeOfDestinationMgtDBDAOCODRequestListVORSQL">
			<desc><![CDATA[History-------------------------------------
2010.07.26 LHJ [Ticket-ID:CHM-201004935] COD application 조회 기능 추가 요청 및 에러 수정건]]></desc>
			<sql><![CDATA[
SELECT A.VSL_SLAN_CD,A.VSL_OPR_CD,
       A.VVD,
       A.BKG_NO,
       A.COD_RQST_RSN_CD,
       A.OLD_POL,
       A.OLD_POD,
       A.OLD_DEL,
       A.NEW_POL,
       A.NEW_POD,
       A.NEW_DEL,
       --COUNT(C.CNTR_NO) CNTR_QTY,
       A.RAT_AS_QTY CNTR_QTY,
       A.COD_RQST_OFC_CD,	
       A.COD_STS_CD,
       A.CHG_AMT,
       --A.DIFF_RMK,
       REPLACE(A.DIFF_RMK,CHR(10),'\r\n') DIFF_RMK,
       A.BL_NO,
       A.COD_RQST_SEQ,
       A.COD_RHND_PORT_CD,
       A.ACT_DEPT_YN,
       A.POD_ETA_DT,
       ----::2015-06-10::----A.COD_EMAIL_SEND_YN
	   'Y'	AS COD_EMAIL_SEND_YN,
       A.COD_RHND_PORT_YD_CD,
       A.COST_CD_RQST_SEQ
FROM   (SELECT I.VSL_SLAN_CD,I.VSL_OPR_CD,
               I.VVD,
               I.BKG_NO,
               I.COD_RQST_RSN_CD,
               I.OLD_POL,
               I.OLD_POD,
               I.OLD_DEL,
               I.NEW_POL,
               I.NEW_POD,
               I.NEW_DEL,
               I.COD_RQST_OFC_CD,
               I.COD_STS_CD,
               --( SELECT SUM(CHG_AMT)
               --  FROM   BKG_COD_COST C
               --  WHERE  I.BKG_NO = C.BKG_NO
               --  AND    I.COD_RQST_SEQ = C.COD_RQST_SEQ ) CHG_AMT,
               I.CHG_AMT,
               I.DIFF_RMK,
               I.BL_NO,
               I.COD_RQST_SEQ,
               I.COD_RHND_PORT_CD,
               I.ACT_DEPT_YN,
			   I.POD_ETA_DT,
               I.COD_EMAIL_SEND_YN,
               I.COD_RHND_PORT_YD_CD,
               I.COST_CD_RQST_SEQ,
               I.RAT_AS_QTY
        FROM   (
                 SELECT VS.VSL_SLAN_CD,NVL(VS.ACT_CRR_CD,VC.CRR_CD) AS VSL_OPR_CD,
                        BC.OLD_VSL_CD||BC.OLD_SKD_VOY_NO||BC.OLD_SKD_DIR_CD VVD,
                        BC.BKG_NO,
                        BC.COD_RQST_RSN_CD,
                        SUBSTR(BC.OLD_POL_YD_CD, 1, 5) OLD_POL,
                        SUBSTR(BC.OLD_POD_YD_CD, 1, 5) OLD_POD,
                        SUBSTR(BC.OLD_DEL_YD_CD, 1, 5) OLD_DEL,
                        SUBSTR(BC.NEW_POL_YD_CD, 1, 5) NEW_POL,
                        SUBSTR(BC.NEW_POD_YD_CD, 1, 5) NEW_POD,
                        SUBSTR(BC.NEW_DEL_YD_CD, 1, 5) NEW_DEL,
                        BC.COD_RQST_OFC_CD,
                        BC.COD_STS_CD,
                        BC.DIFF_RMK,
                        BB.BL_NO,
                        MAX(BC.COD_RQST_SEQ) COD_RQST_SEQ,
                        --BC.COD_RHND_PORT_CD,
                        DECODE(BCC.COD_RHND_PORT_YD_CD,NULL,'',SUBSTR(BCC.COD_RHND_PORT_YD_CD,0,5)) COD_RHND_PORT_CD,
                        DECODE(BC.COD_STS_CD, 'R', DECODE(VAPS.ACT_DEP_DT, NULL, 'Y', 'N'), 'Y') ACT_DEPT_YN,
						BB.POD_ETA_DT,
                        CASE WHEN BB.POD_ETA_DT > SYSDATE THEN 'Y' ELSE 'N'
                        END COD_EMAIL_SEND_YN,
                        BCC.COD_RHND_PORT_YD_CD,
                        BCC.COST_CD_RQST_SEQ,
                        BCC.CHG_AMT,
                        BCC.RAT_AS_QTY
                 FROM   BKG_COD 				BC 
					,	VSK_VSL_SKD 			VS 
					,	BKG_COD_CNTR 			BCN 
					,	BKG_BOOKING 			BB 
					,	VSK_ACT_PORT_SKD 		VAPS
					,	BKG_COD_COST 			BCC
					,	MDM_VSL_CNTR 			VC
                 WHERE  BC.OLD_VSL_CD     		= VS.VSL_CD				(+)
                 AND    BC.OLD_SKD_VOY_NO 		= VS.SKD_VOY_NO			(+)
                 AND    BC.OLD_SKD_DIR_CD 		= VS.SKD_DIR_CD			(+)
                 AND    BC.OLD_VSL_CD     		= VAPS.VSL_CD			(+)
                 AND    BC.OLD_SKD_VOY_NO 		= VAPS.SKD_VOY_NO		(+)
                 AND    BC.OLD_SKD_DIR_CD 		= VAPS.SKD_DIR_CD		(+)
                 AND    SUBSTR(BC.OLD_POD_YD_CD,1,5) = VAPS.VPS_PORT_CD	(+)
				 AND    VS.VSL_CD        		= VC.VSL_CD

AND    BC.RGN_CD         = @[rso]
#if (${slan_cd} != '')
AND    VS.VSL_SLAN_CD    = @[slan_cd]
#end
#if (${vsl_cd} != '')
AND    ( BC.OLD_VSL_CD     = @[vsl_cd] )
#end
#if (${skd_voy_no} != '')
AND    ( BC.OLD_SKD_VOY_NO = @[skd_voy_no] )
#end
#if (${skd_dir_cd} != '')
AND    ( BC.OLD_SKD_DIR_CD = @[skd_dir_cd] )
#end
#if (${cod_sts_cd} != '')
AND    BC.COD_STS_CD     = @[cod_sts_cd]
#end
#if (${cod_rqst_rsn_cd} != 'All')
AND    BC.COD_RQST_RSN_CD     = @[cod_rqst_rsn_cd]
#end
#if (${bkg_no} != '')
AND    BC.BKG_NO     = @[bkg_no]
#end
                 AND    DECODE(BC.COD_MNL_FLG, 'Y', 'Y', 'N') = 'N'
                 AND    BCN.COD_SLCT_FLG = 'Y'
                 AND    BC.COD_STS_CD != 'M'
                 AND    BC.BKG_NO = BCN.BKG_NO
                 AND    BC.COD_RQST_SEQ = BCN.COD_RQST_SEQ
                 AND    BC.BKG_NO = BB.BKG_NO
                 AND    BC.COD_STS_CD IS NOT NULL
                 AND    BC.BKG_NO = BCC.BKG_NO(+)
                 AND    BC.COD_RQST_SEQ = BCC.COD_RQST_SEQ(+)
                 GROUP BY VS.VSL_SLAN_CD, BC.OLD_VSL_CD||BC.OLD_SKD_VOY_NO||BC.OLD_SKD_DIR_CD, BC.BKG_NO, BC.COD_RQST_RSN_CD, 
                          BC.OLD_POL_YD_CD, BC.OLD_POD_YD_CD, BC.OLD_DEL_YD_CD, BC.NEW_POL_YD_CD, BC.NEW_POD_YD_CD, 
                          BC.NEW_DEL_YD_CD, BC.COD_RQST_OFC_CD, BC.COD_STS_CD, BC.DIFF_RMK, BB.BL_NO, 
                          DECODE(BC.COD_STS_CD, 'R', DECODE(VAPS.ACT_DEP_DT, NULL, 'Y', 'N'), 'Y'),
                          BB.POD_ETA_DT,BCC.COD_RHND_PORT_YD_CD,BCC.COST_CD_RQST_SEQ,BCC.CHG_AMT,BCC.RAT_AS_QTY,NVL(VS.ACT_CRR_CD,VC.CRR_CD)  
               ) I) A
		,	BKG_COD_CNTR 	C
WHERE  		A.BKG_NO 		= C.BKG_NO
AND    		A.COD_RQST_SEQ 	= C.COD_RQST_SEQ
AND    		C.COD_SLCT_FLG 	= 'Y'  -- //::2014-10-27::TOP:://

GROUP BY 	A.VSL_SLAN_CD, A.VVD, A.BKG_NO, A.COD_RQST_RSN_CD, A.OLD_POL, A.OLD_POD, A.OLD_DEL, A.NEW_POL, A.NEW_POD, A.NEW_DEL,
         	A.COD_RQST_OFC_CD, A.COD_STS_CD, A.CHG_AMT, A.DIFF_RMK, A.BL_NO, A.COD_RQST_SEQ, A.COD_RHND_PORT_CD, A.ACT_DEPT_YN, 
         	A.POD_ETA_DT, A.COD_EMAIL_SEND_YN, A.COD_RHND_PORT_YD_CD, A.COST_CD_RQST_SEQ, A.RAT_AS_QTY,A.VSL_OPR_CD

ORDER BY 	A.VSL_SLAN_CD
		, 	A.VVD
		, 	A.BKG_NO
		, 	A.COD_RQST_SEQ DESC
		,	A.COST_CD_RQST_SEQ
 			]]></sql>
			<params>
				<param name="rso" type="12" value="" out="N"/>
				<param name="slan_cd" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="cod_sts_cd" type="12" value="" out="N"/>
				<param name="cod_rqst_rsn_cd" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
