<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PSOCodeFinderDBDAOcheckVslPortSkdVvdRSQL">
			<desc><![CDATA[checkVslPortSkdVvd
[2015.07.21]Virtual Add Calling 처리. VSK_VSL_PORT_SKD.NVL(VT_ADD_CALL_FLG, 'N') = 'N']]></desc>
			<sql><![CDATA[
SELECT MAX(FLAG) FLAG
  FROM (SELECT NVL(MAX(1), 0) flag
          FROM VSK_VSL_PORT_SKD VPS
         WHERE 1 = 1
           AND VPS.YD_CD = @[yd_cd] /*2009.11.26.adding*/
           AND VPS.PORT_SKD_STS_CD = 'D'
		   AND NVL(VPS.VT_ADD_CALL_FLG, 'N') = 'N' /*2015.07.21 Add*/
           AND NOT EXISTS (
               SELECT INTG_CD_VAL_CTNT /*List of countries that do not require a Actual SKD input*/
                  FROM COM_INTG_CD_DTL
                 WHERE INTG_CD_ID='CD20074' 
                   AND (INTG_CD_VAL_CTNT = SUBSTR(VPS.VPS_PORT_CD,1,5) OR  INTG_CD_VAL_CTNT = SUBSTR(VPS.VPS_PORT_CD,1,2))
           ) 
           #if(${vsl_cd}!='')
            AND VPS.VSL_CD = @[vsl_cd] 
           #end 
           #if(${vsl_cd}=='')
            AND 1=2 
           #end 
           #if(${skd_voy_no}!='')
            AND VPS.SKD_VOY_NO = @[skd_voy_no] 
           #end 
           #if(${skd_dir_cd}!='')
            AND VPS.SKD_DIR_CD = @[skd_dir_cd] 
           #end
           AND EXISTS (
                SELECT 'O'
                  FROM (
                        SELECT ACT_CRR_CD
                             , (SELECT CRR_CD
                                  FROM MDM_VSL_CNTR
                                 WHERE VSL_CD = T1.VSL_CD) AS SRC_CRR_CD
                          FROM VSK_VSL_SKD T1
                         WHERE 1=1
                           AND VSL_CD = @[vsl_cd]
                           AND SKD_VOY_NO = @[skd_voy_no]
                           AND SKD_DIR_CD = @[skd_dir_cd] )
                 WHERE NVL(ACT_CRR_CD, SRC_CRR_CD) = COM_ConstantMgr_PKG.COM_getCompanyCode_FNC())
           AND ROWNUM <= 1
         UNION ALL
        SELECT /* 2010.04.28 Japan은 Actual 입력여부를 체크하지 않는다.*/
          NVL(MAX(1), 0) flag
          FROM VSK_VSL_PORT_SKD VPS
         WHERE 1 = 1
           AND VPS.YD_CD = @[yd_cd] /*2009.11.26.adding*/
		   AND NVL(VPS.VT_ADD_CALL_FLG, 'N') = 'N' /*2015.07.21 Add*/
           AND EXISTS (
               SELECT INTG_CD_VAL_CTNT /*List of countries that do not require a Actual SKD input*/
                  FROM COM_INTG_CD_DTL
                 WHERE INTG_CD_ID='CD20074' 
                   AND ( INTG_CD_VAL_CTNT = SUBSTR(VPS.VPS_PORT_CD,1,5) OR  INTG_CD_VAL_CTNT = SUBSTR(VPS.VPS_PORT_CD,1,2) )
           )
           #if(${vsl_cd}!='')
            AND VPS.VSL_CD = @[vsl_cd] 
           #end 
           #if(${vsl_cd}=='')
            AND 1=2 
           #end 
           #if(${skd_voy_no}!='')
            AND VPS.SKD_VOY_NO = @[skd_voy_no] 
           #end 
           #if(${skd_dir_cd}!='')
            AND VPS.SKD_DIR_CD = @[skd_dir_cd] 
           #end
           AND EXISTS (SELECT 'O'
                  FROM (SELECT ACT_CRR_CD
                             , (SELECT CRR_CD
                                  FROM MDM_VSL_CNTR
                                 WHERE VSL_CD = T1.VSL_CD) AS SRC_CRR_CD
                          FROM VSK_VSL_SKD T1
                         WHERE 1=1
                           AND VSL_CD = @[vsl_cd]
                           AND SKD_VOY_NO = @[skd_voy_no]
                           AND SKD_DIR_CD = @[skd_dir_cd] )
                 WHERE NVL(ACT_CRR_CD, SRC_CRR_CD) = COM_ConstantMgr_PKG.COM_getCompanyCode_FNC())
           AND ROWNUM <= 1
         UNION ALL
        SELECT NVL(MAX(1), 0) flag
          FROM AR_MST_REV_VVD
         WHERE 1 = 1
           AND DELT_FLG = 'N' 
           #if(${vsl_cd}!='')
           AND VSL_CD = @[vsl_cd] 
           #end 
           #if(${vsl_cd}=='')
           AND 1=2 
           #end 
           #if(${skd_voy_no}!='')
           AND SKD_VOY_NO = @[skd_voy_no] 
           #end 
           #if(${skd_dir_cd}!='')
           AND SKD_DIR_CD = @[skd_dir_cd] 
           #end
           AND NOT EXISTS (
                SELECT 'O'
                  FROM VSK_VSL_SKD
                 WHERE 1=1
                   AND VSL_CD = @[vsl_cd]
                   AND SKD_VOY_NO = @[skd_voy_no]
                   AND SKD_DIR_CD = @[skd_dir_cd])
           AND ROWNUM <= 1 )			]]></sql>
			<params>
				<param name="yd_cd" type="12" value="KRPUS01" out="N"/>
				<param name="vsl_cd" type="12" value="ACKT" out="N"/>
				<param name="skd_voy_no" type="12" value="0024" out="N"/>
				<param name="skd_dir_cd" type="12" value="S" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
