<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PortTariffMgtBCDBDAOsearchUseStatusConditonRSQL">
			<desc><![CDATA[condition 조회]]></desc>
			<sql><![CDATA[
SELECT A.ID
     , A.DESCRIPT
     , CASE WHEN A.LINK = 'Y' THEN ( CASE WHEN SUM(A.VENDOR_CNT) > 0 THEN 'Y' ELSE 'N' END )
         ELSE 'N'
       END AS LINK
     , A.CRE_DATE
     , A.CRE_USR
     , A.UPD_MNU_NO_COND
  FROM (
        SELECT DISTINCT T1.COND_NO                  AS ID
             , T1.COND_DESC                         AS DESCRIPT
             , DECODE(T3.COND_NO, NULL, 'N', 'Y')   AS LINK
             , TO_CHAR(T1.UPD_DT, 'YYYY-MM-DD')     AS CRE_DATE
             , T1.UPD_USR_ID                        AS CRE_USR
             , T1.UPD_MNU_NO                        AS UPD_MNU_NO_COND
             , (SELECT COUNT(MV.VNDR_LGL_ENG_NM)
                  FROM PSO_YD_CHG YC
                     , MDM_VENDOR MV
                 WHERE 1=1
                   AND YC.YD_CHG_NO = T4.YD_CHG_NO
                   AND YC.YD_CHG_VER_SEQ = T4.YD_CHG_VER_SEQ
                   AND YC.YD_CHG_VER_SEQ    = (SELECT MAX(YD_CHG_VER_SEQ) FROM PSO_YD_CHG WHERE YD_CHG_NO = T4.YD_CHG_NO ) /*최신버전은 항상 Max Version*/
                   AND YC.VNDR_SEQ = MV.VNDR_SEQ
                   AND MV.DELT_FLG = 'N' )          AS VENDOR_CNT
          FROM PSO_CONDITION    T1
             , PSO_COND_DTL     T2
             , PSO_CHG_XPR_DTL  T3
             , PSO_YD_CHG_XPR   T4
         WHERE 1 = 1
           AND T1.COND_NO               = T2.COND_NO
           AND T2.PSO_COND_DTL_TP_CD    = 'O'
           AND EXISTS (  SELECT 'X'
                          FROM PSO_OBJ_LIST S1
                         WHERE T2.OBJ_LIST_NO = S1.OBJ_LIST_NO 
#if (${combo3} != '') 
                           AND S1.OBJ_LIST_NO   = @[combo3]
#end                         
                         )
           AND T1.COND_NO               = T3.COND_NO(+)
           AND T3.CHG_XPR_NO            = T4.CHG_XPR_NO(+)
#if (${combo1} != '') 
AND T1.COND_NO      = @[combo1]
#end

AND T1.COND_NO = T3.COND_NO(+)
AND T3.CHG_XPR_NO = T4.CHG_XPR_NO(+)

#if (${combo2} != '') 
AND T4.PSO_CHG_TP_CD = @[combo2]  
#end

#if (${cre_usr} != '') 
AND UPPER(T1.UPD_USR_ID)   LIKE '%'||UPPER(@[cre_usr])||'%'
#end
#if (${descript} != '') 
AND UPPER(T1.COND_DESC) LIKE '%'||UPPER(@[descript])||'%'
#end
       ) A
 GROUP BY A.ID
     , A.DESCRIPT
     , A.LINK
     , A.CRE_DATE
     , A.CRE_USR
     , A.UPD_MNU_NO_COND
 ORDER BY A.ID			]]></sql>
			<params>
				<param name="combo3" type="12" value="" out="N"/>
				<param name="combo1" type="12" value="" out="N"/>
				<param name="combo2" type="12" value="" out="N"/>
				<param name="cre_usr" type="12" value="" out="N"/>
				<param name="descript" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
