<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GEMMasterCodeMgtDBDAOAddExpenseCopyCSQL">
			<desc><![CDATA[일관적으로 비용코드를 조직별로 매핑 ( fmOfc -> toOfc )]]></desc>
			<sql><![CDATA[
INSERT INTO GEM_OFC_MTX
            (OFC_CD, GEN_EXPN_CD, DELT_FLG, CRE_USR_ID, CRE_DT, UPD_USR_ID, UPD_DT)
    SELECT @[to_ofc_cd]
          ,A.GEN_EXPN_CD
          ,A.DELT_FLG
          ,@[cre_usr_id]
          ,SYSDATE
          ,@[upd_usr_id]
          ,SYSDATE
    FROM   GEM_OFC_MTX A
    WHERE  A.OFC_CD = @[from_ofc_cd]
      AND  A.GEN_EXPN_CD IN ( SELECT GEN_EXPN_CD
                                FROM GEM_EXPENSE
                               WHERE GEN_EXPN_GRP_LVL = '4'
                                 AND SALY_FLG = 'N'
                                 AND GEN_EXPN_SLS_DIV_CD IN (
                                                               SELECT DECODE(FM_SLS_FLG, 'Y', DECODE(TO_SLS_FLG, 'Y', 'Y'), DECODE(TO_SLS_FLG, 'N', 'N'))
                                                                 FROM 
                                                                     (
                                                                      SELECT SLS_OFC_FLG AS FM_SLS_FLG
                                                                        FROM GEM_OFFICE
                                                                       WHERE OFC_CD = @[from_ofc_cd]
                                                                     ) A
                                                                    ,(  
                                                                      SELECT SLS_OFC_FLG AS TO_SLS_FLG 
                                                                        FROM GEM_OFFICE
                                                                       WHERE OFC_CD = @[to_ofc_cd]
                                                                     ) B
                                                                    UNION ALL
                                                                    SELECT 'C' FROM DUAL
                                                               )
                             )
    AND    A.GEN_EXPN_CD NOT IN (SELECT DISTINCT GEN_EXPN_CD
                            	   FROM GEM_OFC_MTX
                            	  WHERE OFC_CD = @[to_ofc_cd])			]]></sql>
			<params>
				<param name="to_ofc_cd" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="from_ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
