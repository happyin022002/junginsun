<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralCodeSearchMgtDBDAOsearchBkgTrdCodeDataRSQL">
			<desc><![CDATA[DESC Enter..]]></desc>
			<sql><![CDATA[
SELECT B.BKG_NO, 
       CASE WHEN SUBSTR(A.N1ST_FINC_VVD_CD, 1, 9) = B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD THEN A.N1ST_TRD_CD
            WHEN SUBSTR(A.N2ND_FINC_VVD_CD, 1, 9) = B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD THEN A.N2ND_TRD_CD
            WHEN SUBSTR(A.N3RD_FINC_VVD_CD, 1, 9) = B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD THEN A.N3RD_TRD_CD
            WHEN SUBSTR(A.N4TH_FINC_VVD_CD, 1, 9) = B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD THEN A.N4TH_TRD_CD
            ELSE NULL 
       END AS TRD_CD
FROM COA_RGST_BKG A, BKG_BOOKING B
WHERE 1=1
  AND A.BKG_NO = B.BKG_NO
  AND B.BKG_NO = (
#if(${eq_type} == 'U')
        SELECT /*+ INDEX_DESC (A XFN1CTM_MOVEMENT) */
             A.BKG_NO
#elseif(${eq_type} == 'Z')
        SELECT /*+ INDEX_DESC (A XAK17CTM_MOVEMENT) */
             A.BKG_NO
#elseif(${eq_type} == 'G')
        SELECT /*+ INDEX_DESC (A XAK20CTM_MOVEMENT) */
             A.BKG_NO
#end
          FROM CTM_MOVEMENT A, BKG_BOOKING B
         WHERE 1 = 1
		  #if(${pl} == 'P')
	       AND TO_CHAR(A.CNMV_EVNT_DT, 'YYYYMMDD') <= @[rpr_rslt_dt]
          #elseif(${pl} == 'L')
           AND TO_CHAR(A.CNMV_EVNT_DT, 'YYYYMMDD') >= @[rpr_rslt_dt]
           AND A.MVMT_STS_CD = 'OP'
          #end
	      #if(${eq_type} == 'U')
           AND A.CNTR_NO = @[eq_no]
		  #elseif(${eq_type} == 'Z')
           AND A.CHSS_NO = @[eq_no]
          #elseif(${eq_type} == 'G')
           AND A.MGST_NO = @[eq_no]
          #end
          #if(${fm} == 'F')
           AND A.BKG_CGO_TP_CD IN ('F', 'R')
          #elseif(${fm} == 'E')
           AND A.BKG_CGO_TP_CD NOT IN ('F', 'R')  
          #end
           AND A.BKG_NO = B.BKG_NO
           AND B.VSL_CD NOT IN ('COXX', 'COYY', 'COZZ')
           AND B.BKG_STS_CD = 'F'
           AND ROWNUM = 1

)			]]></sql>
			<params>
				<param name="rpr_rslt_dt" type="12" value="" out="N"/>
				<param name="eq_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
