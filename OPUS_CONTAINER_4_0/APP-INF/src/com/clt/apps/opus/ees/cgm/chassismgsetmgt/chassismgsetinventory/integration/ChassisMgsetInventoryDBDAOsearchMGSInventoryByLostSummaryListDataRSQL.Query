<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChassisMgsetInventoryDBDAOsearchMGSInventoryByLostSummaryListDataRSQL">
			<desc><![CDATA[chungpa 20090915 2080 start

[CHM-201004960-01] Genset Ineventory Logic error 수정건
    : SCC를 조회조건으로 Retrive시 사용되는 조회쿼리 수정 by 김상수
]]></desc>
			<sql><![CDATA[
#if(${program_id}== '2020')
	#if ( ${s_eq_tpsz_cd} == 'LST')
	SELECT
			 AAA.EQ_NO
			,AAA.AGMT_NO
			,AAA.AGMT_LSTM_CD
			,AAA.EQ_TPSZ_CD
			,AAA.VNDR_ABBR_NM
			,AAA.CHSS_NO
			,AAA.CNTR_NO
			,AAA.LCC_CD
			,AAA.SCC_CD
			,AAA.CRNT_YD_CD
			,AAA.LSDAYS
		FROM (
		SELECT
						 A.EQ_NO
						,A.AGMT_OFC_CTY_CD || LPAD(A.AGMT_SEQ, 6, '0') AS AGMT_NO
						,A.AGMT_LSTM_CD
						,A.EQ_TPSZ_CD
						,F.VNDR_LGL_ENG_NM VNDR_ABBR_NM
						,E.CHSS_NO
						,E.CNTR_NO
						,D.LCC_CD
						,C.SCC_CD
						,A.CRNT_YD_CD
						, CASE WHEN LAG ( B.EQ_ASET_STS_CD ) OVER (PARTITION BY  B.EQ_NO ORDER BY B.EQ_NO,B.STS_EVNT_DT,B.EQ_STS_SEQ )  = 'LST' AND  B.EQ_ASET_STS_CD = 'FND' THEN NULL
							ELSE  B.EQ_ASET_STS_CD
						  END EVENT_KNT
						,  CASE WHEN E.CHSS_NO != '' THEN
								(SELECT CHSS_MVMT_STS_CD FROM CGM_EQUIPMENT WHERE EQ_NO = E.CHSS_NO)
							ELSE
								(SELECT CNMV_STS_CD FROM MST_CONTAINER WHERE CNTR_NO = E.CNTR_NO)
							END MVMT,
							CASE WHEN E.CHSS_NO != '' THEN
								(SELECT CHSS_MVMT_DT FROM CGM_EQUIPMENT WHERE EQ_NO = E.CHSS_NO)
							ELSE
								(SELECT CNMV_DT FROM MST_CONTAINER WHERE CNTR_NO = E.CNTR_NO)
							END MVMT_DATE,
							CASE WHEN E.CHSS_NO != '' THEN
								(SELECT TRUNC(SYSDATE - CHSS_MVMT_DT,0) FROM CGM_EQUIPMENT WHERE EQ_NO = E.CHSS_NO)
							ELSE
								(SELECT TRUNC(SYSDATE - CNMV_DT,0) FROM MST_CONTAINER WHERE CNTR_NO = E.CNTR_NO)
							END LSDAYS
				FROM CGM_EQUIPMENT A
				,CGM_EQ_STS_HIS B
				,MDM_LOCATION C
				,MDM_EQ_ORZ_CHT D
				,CGM_EQ_ATCH_DTCH_HIS E
				,MDM_VENDOR F
				WHERE  A.EQ_KND_CD = 'G'
				AND A.EQ_NO = B.EQ_NO
				--AND A.AGMT_OFC_CTY_CD = C.AGMT_OFC_CTY_CD
				--AND A.AGMT_SEQ = C.AGMT_SEQ
				AND A.VNDR_SEQ = F.VNDR_SEQ
				#if ( ${s_eq_tpsz_cd} != '')
				AND B.STS_EVNT_DT >= TO_DATE(@[sts_evnt_dt_fr],'YYYY-MM-DD')
				AND B.STS_EVNT_DT <  TO_DATE(@[sts_evnt_dt_to] ,'YYYY-MM-DD')+1
				#end
				AND  C.SCC_CD = D.SCC_CD
				AND  C.DELT_FLG = 'N'
				AND  D.DELT_FLG = 'N'
					  AND A.EQ_NO = E.EQ_NO(+)
					  AND NVL(E.ATCH_DT,  sysdate )= (SELECT  /*+ INDEX_DESC(B XPKCGM_EQ_ATCH_DTCH_HIS) */
															NVL(MAX(ATCH_DT), sysdate )
														 FROM CGM_EQ_ATCH_DTCH_HIS B
														 WHERE
															B.EQ_NO = A.EQ_NO
															AND ROWNUM =1
														)
				AND B.STS_EVNT_LOC_CD = C.LOC_CD
				AND B.EQ_ASET_STS_CD IN  ('LST','FND','TLL' )

				#if ( ${scc_cd} != '' )
					#if ( ${s_location} == 'R' )
						AND  D.RCC_CD = @[scc_cd]
					#elseif ( ${s_location} == 'L' )
						AND  D.LCC_CD = @[scc_cd]
					#elseif ( ${s_location} == 'S' )
						AND   D.SCC_CD = @[scc_cd]
					#else
						AND   D.SCC_CD = @[scc_cd]
					#end
				#end
				#if ( ${sts_evnt_yd_cd} != '' )
				 AND B.STS_EVNT_YD_CD = @[sts_evnt_yd_cd]
				#end

				#if ( ${s_crnt_loc_cd} != '' )
					 #if ( ${s_location} == 'R' )
						AND D.LCC_CD = @[s_crnt_loc_cd]
					 #elseif ( ${s_location} == 'L' )
						AND  D.SCC_CD = @[s_crnt_loc_cd]
					 #else
						AND B.STS_EVNT_YD_CD = @[s_crnt_loc_cd]
					#end
				#end


				#if ( ${eq_tpsz_cd} != '')

						AND A.EQ_TPSZ_CD = @[eq_tpsz_cd]

				#end

				#if ( ${s2_agmt_lstm_cd} != '')
					AND A.AGMT_LSTM_CD = @[s2_agmt_lstm_cd]
				#end
			) AAA
			WHERE AAA.EVENT_KNT IS NOT NULL
	#else
			SELECT
					 A.EQ_NO
					,A.AGMT_OFC_CTY_CD || LPAD(A.AGMT_SEQ, 6, '0') AS AGMT_NO
					,A.AGMT_LSTM_CD
					,A.EQ_TPSZ_CD
					,F.VNDR_LGL_ENG_NM VNDR_ABBR_NM
					,E.CHSS_NO
					,E.CNTR_NO
					,D.LCC_CD
					,C.SCC_CD
					,A.CRNT_YD_CD
					,  CASE WHEN E.CHSS_NO != '' THEN
							(SELECT CHSS_MVMT_STS_CD FROM CGM_EQUIPMENT WHERE EQ_NO = E.CHSS_NO)
						ELSE
							(SELECT CNMV_STS_CD FROM MST_CONTAINER WHERE CNTR_NO = E.CNTR_NO)
						END MVMT,
						CASE WHEN E.CHSS_NO != '' THEN
							(SELECT CHSS_MVMT_DT FROM CGM_EQUIPMENT WHERE EQ_NO = E.CHSS_NO)
						ELSE
							(SELECT CNMV_DT FROM MST_CONTAINER WHERE CNTR_NO = E.CNTR_NO)
						END MVMT_DATE,
						CASE WHEN E.CHSS_NO != '' THEN
							(SELECT TRUNC(SYSDATE - CHSS_MVMT_DT,0) FROM CGM_EQUIPMENT WHERE EQ_NO = E.CHSS_NO)
						ELSE
							(SELECT TRUNC(SYSDATE - CNMV_DT,0) FROM MST_CONTAINER WHERE CNTR_NO = E.CNTR_NO)
						END LSDAYS
			FROM CGM_EQUIPMENT A
			,CGM_EQ_STS_HIS B
			,MDM_LOCATION C
			,MDM_EQ_ORZ_CHT D
			,CGM_EQ_ATCH_DTCH_HIS E
			,MDM_VENDOR F
			WHERE  A.EQ_KND_CD = 'G'
			AND A.EQ_NO = B.EQ_NO
			--AND A.AGMT_OFC_CTY_CD = C.AGMT_OFC_CTY_CD
			--AND A.AGMT_SEQ = C.AGMT_SEQ
			AND A.VNDR_SEQ = F.VNDR_SEQ
			#if ( ${s_eq_tpsz_cd} != '')
			AND B.STS_EVNT_DT >= TO_DATE(@[sts_evnt_dt_fr],'YYYY-MM-DD')
			AND B.STS_EVNT_DT <  TO_DATE(@[sts_evnt_dt_to] ,'YYYY-MM-DD')+1
			#end
			AND  C.SCC_CD = D.SCC_CD
			AND  C.DELT_FLG = 'N'
			AND  D.DELT_FLG = 'N'
				  AND A.EQ_NO = E.EQ_NO(+)
				  AND NVL(E.ATCH_DT,  sysdate )= (SELECT  /*+ INDEX_DESC(B XPKCGM_EQ_ATCH_DTCH_HIS) */
														NVL(MAX(ATCH_DT), sysdate )
													 FROM CGM_EQ_ATCH_DTCH_HIS B
													 WHERE
														B.EQ_NO = A.EQ_NO
														AND ROWNUM =1
													)
			AND B.STS_EVNT_LOC_CD = C.LOC_CD
			#if ( ${s_eq_tpsz_cd} == 'LST')
				AND B.EQ_ASET_STS_CD IN  ('LST','FND' )
			#end
			#if ( ${scc_cd} != '' )
				#if ( ${s_location} == 'R' )
					AND  D.RCC_CD = @[scc_cd]
				#elseif ( ${s_location} == 'L' )
					AND  D.LCC_CD = @[scc_cd]
				#elseif ( ${s_location} == 'S' )
					AND   D.SCC_CD = @[scc_cd]
				#else
					AND   D.SCC_CD = @[scc_cd]
				#end
			#end
			#if ( ${sts_evnt_yd_cd} != '' )
			 AND B.STS_EVNT_YD_CD = @[sts_evnt_yd_cd]
			#end

			#if ( ${s_crnt_loc_cd} != '' )
				 #if ( ${s_location} == 'R' )
					AND D.LCC_CD = @[s_crnt_loc_cd]
				 #elseif ( ${s_location} == 'L' )
					AND  D.SCC_CD = @[s_crnt_loc_cd]
				 #else
					AND B.STS_EVNT_YD_CD = @[s_crnt_loc_cd]
				#end
			#end

			#if ( ${s_eq_tpsz_cd} == 'FND')
				AND B.EQ_ASET_STS_CD =  'FND'

			#end

			#if ( ${s_eq_tpsz_cd} == '')
				AND A.EQ_NO = B.EQ_NO
				AND A.EQ_STS_SEQ = B.EQ_STS_SEQ
				AND B.EQ_ASET_STS_CD =  'LST'
			#end

			#if ( ${eq_tpsz_cd} != '')

					AND A.EQ_TPSZ_CD = @[eq_tpsz_cd]

			#end

			#if ( ${s2_agmt_lstm_cd} != '')
				AND A.AGMT_LSTM_CD = @[s2_agmt_lstm_cd]
			#end
	#end

#elseif ( ${program_id}== '2012' )
	SELECT
			 A.EQ_NO
			,A.AGMT_OFC_CTY_CD || LPAD(A.AGMT_SEQ, 6, '0') AS AGMT_NO
			,A.AGMT_LSTM_CD
			,A.EQ_TPSZ_CD
			,F.VNDR_LGL_ENG_NM VNDR_ABBR_NM
			,E.CHSS_NO
			,E.CNTR_NO
			,D.LCC_CD
			,C.SCC_CD
			,A.CRNT_YD_CD
			,  CASE WHEN E.CHSS_NO != '' THEN
					(SELECT CHSS_MVMT_STS_CD FROM CGM_EQUIPMENT WHERE EQ_NO = E.CHSS_NO)
				ELSE
					(SELECT CNMV_STS_CD FROM MST_CONTAINER WHERE CNTR_NO = E.CNTR_NO)
				END MVMT,
				CASE WHEN E.CHSS_NO != '' THEN
					(SELECT CHSS_MVMT_DT FROM CGM_EQUIPMENT WHERE EQ_NO = E.CHSS_NO)
				ELSE
					(SELECT CNMV_DT FROM MST_CONTAINER WHERE CNTR_NO = E.CNTR_NO)
				END MVMT_DATE,
				CASE WHEN E.CHSS_NO != '' THEN
					(SELECT TRUNC(SYSDATE - CHSS_MVMT_DT,0) FROM CGM_EQUIPMENT WHERE EQ_NO = E.CHSS_NO)
				ELSE
					(SELECT TRUNC(SYSDATE - CNMV_DT,0) FROM MST_CONTAINER WHERE CNTR_NO = E.CNTR_NO)
				END LSDAYS
	FROM CGM_EQUIPMENT A
	,CGM_EQ_STS_HIS B
	,MDM_LOCATION C
    ,CGM_AGREEMENT CC
	,MDM_EQ_ORZ_CHT D
	,CGM_EQ_ATCH_DTCH_HIS E
	,MDM_VENDOR F
	WHERE  A.EQ_KND_CD = 'G'
	AND A.EQ_NO = B.EQ_NO
	AND A.AGMT_OFC_CTY_CD = CC.AGMT_OFC_CTY_CD
	AND A.AGMT_SEQ = CC.AGMT_SEQ
	AND A.VNDR_SEQ = F.VNDR_SEQ
    AND CC.LST_VER_FLG ='Y'
	AND B.STS_EVNT_DT >= TO_DATE(@[sts_evnt_dt_fr],'YYYY-MM-DD')
	AND B.STS_EVNT_DT <  TO_DATE(@[sts_evnt_dt_to] ,'YYYY-MM-DD')+1
    AND B.TERM_CNG_SEQ IS NULL
	AND  C.SCC_CD = D.SCC_CD
	AND  C.DELT_FLG = 'N'
	AND  D.DELT_FLG = 'N'
		  AND A.EQ_NO = E.EQ_NO(+)
		  AND NVL(E.ATCH_DT,  sysdate )= (SELECT  /*+ INDEX_DESC(B XPKCGM_EQ_ATCH_DTCH_HIS) */
												NVL(MAX(ATCH_DT), sysdate )
											 FROM CGM_EQ_ATCH_DTCH_HIS B
											 WHERE
												B.EQ_NO = A.EQ_NO
												AND ROWNUM =1
											)
	AND B.STS_EVNT_LOC_CD = C.LOC_CD
    AND B.EQ_ASET_STS_CD = @[s1_inq_to_dys]
    #if (${s_crnt_loc_cd} != '')
       #if (${s_location} == 'S')
  	AND B.STS_EVNT_YD_CD = @[s_crnt_loc_cd]
       #else
   	AND B.STS_EVNT_LOC_CD = @[s_crnt_loc_cd]
       #end
    #end

    #if (${s_vndr_seq} != '')
       #if (${s2_group1} == 'L' )
		   AND	CC.VNDR_SEQ IN ($s_vndr_seq)
	   #elseif ( ${s2_group1} == 'A' )
		   AND  (CC.AGMT_OFC_CTY_CD,CC.AGMT_SEQ ) IN ($vndr_seq)
	   #end
    #end

    #if (${s2_agmt_lstm_cd} != '')
    	AND A.AGMT_LSTM_CD = @[s2_agmt_lstm_cd]
    #end

	#if (${s_agmt_lstm_cd} != '')
		AND A.AGMT_LSTM_CD IN ($s_agmt_lstm_cd)
	#end

	#if( ${s_crnt_yd_cd} != '')
		AND B.STS_EVNT_YD_CD = @[s_crnt_yd_cd]
    #end

	#if ( ${s2_loc_cd} != '' )
		#if ( ${s_location} == 'R' )
			AND  D.RCC_CD = @[s2_loc_cd]
		#elseif ( ${s_location} == 'L' )
			AND  D.LCC_CD = @[s2_loc_cd]
		#elseif ( ${s_location} == 'S' )
			AND   D.SCC_CD = @[s2_loc_cd]
		#else
			AND   D.SCC_CD = @[s2_loc_cd]
		#end
	#end

    #if(${eq_tpsz_cd} != '')
		AND A.EQ_TPSZ_CD = @[eq_tpsz_cd]
    #end





#end			]]></sql>
			<params>
				<param name="sts_evnt_dt_fr" type="12" value="" out="N"/>
				<param name="sts_evnt_dt_to" type="12" value="" out="N"/>
				<param name="scc_cd" type="12" value="" out="N"/>
				<param name="sts_evnt_yd_cd" type="12" value="" out="N"/>
				<param name="s_crnt_loc_cd" type="12" value="" out="N"/>
				<param name="eq_tpsz_cd" type="12" value="" out="N"/>
				<param name="s2_agmt_lstm_cd" type="12" value="" out="N"/>
				<param name="s1_inq_to_dys" type="12" value="" out="N"/>
				<param name="s_crnt_yd_cd" type="12" value="" out="N"/>
				<param name="s2_loc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
