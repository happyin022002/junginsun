/*=========================================================
*Copyright(c) 2016 CyberLogitec
*@FileName : CntrRepoExecutionPlanEstablishDBDAOSearchShuttleCntrRepoPlanRSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2016.05.02
*@LastModifier : 
*@LastVersion : 1.0
* 2016.05.02 
* 1.0 Creation
=========================================================*/
package com.clt.apps.opus.ees.eqr.repoplanmanage.cntrrepoexecutionplanestablish.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.clt.framework.support.db.ISQLTemplate;

/**
 *
 * @author 
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class CntrRepoExecutionPlanEstablishDBDAOSearchShuttleCntrRepoPlanRSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * 컨테이너 이송 실행 계획 조회 Shuttle (EES_EQR_083) 정보 조회
	  * </pre>
	  */
	public CntrRepoExecutionPlanEstablishDBDAOSearchShuttleCntrRepoPlanRSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("off_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("repoPlanID",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("toWeek",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("sosend",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("fromWeek",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.clt.apps.opus.ees.eqr.repoplanmanage.cntrrepoexecutionplanestablish.integration").append("\n"); 
		query.append("FileName : CntrRepoExecutionPlanEstablishDBDAOSearchShuttleCntrRepoPlanRSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("SELECT" ).append("\n"); 
		query.append("	T4_PLN_YRWK	PLN_YRWK												  						" ).append("\n"); 
		query.append("    ,COMPANY                                                      " ).append("\n"); 
		query.append("    ,DIVISION                                                     " ).append("\n"); 
		query.append("    ,ITEM                                                         " ).append("\n"); 
		query.append("    ,T4_FRLOC FRLOC                                                             " ).append("\n"); 
		query.append("    ,ETD														  " ).append("\n"); 
		query.append("    ,T4_TOLOC TOLOC                                               " ).append("\n"); 
		query.append("    ,ETA														  " ).append("\n"); 
		query.append("    ,PURPOSE                                                      " ).append("\n"); 
		query.append("    ,CNTRNO                                                       " ).append("\n"); 
		query.append("    ,SOSEND		                                                  " ).append("\n"); 
		query.append("    ,T4_REF_ID REF_ID      						                          " ).append("\n"); 
		query.append("    ,CMB_REF_ID    " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    ,TOTALVOL                                      " ).append("\n"); 
		query.append("    #foreach(${key} in ${tpszArr}) " ).append("\n"); 
		query.append("        ,${key}VOL			  " ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("         	" ).append("\n"); 
		query.append("    ,REPO_PLN_ID 	## HIDDEN                                     " ).append("\n"); 
		query.append("    ,SORTNUM    	## HIDDEN	PLAN(1), Execution(2), SO(3)를 구분" ).append("\n"); 
		query.append("    ,NUM        	## HIDDEN 	NORMAL ROW(1), SUB TOTAL(2), GRAND TOTAL(3) 구분 " ).append("\n"); 
		query.append("    ,CNTRNOINPUT  ## HIDDEN                                    " ).append("\n"); 
		query.append("    ,TPSZINPUT    ## HIDDEN                                            " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    " ).append("\n"); 
		query.append("    " ).append("\n"); 
		query.append("    ## TYPE SIZE별 수정된 VOL 정보를 확인하기 위한 FLAG" ).append("\n"); 
		query.append("    #foreach(${key} in ${tpszArr}) " ).append("\n"); 
		query.append("          ,${key}FLAG									" ).append("\n"); 
		query.append("    #end        	" ).append("\n"); 
		query.append("    ,WK_ST_DT  ## week from date " ).append("\n"); 
		query.append("    ,WK_END_DT ## week to date      " ).append("\n"); 
		query.append("    ,WK_MAX_DT ## WEEK MAX DATE +7    	    " ).append("\n"); 
		query.append("    ,FRLOC_RCC     ## from ecc's RCC      							" ).append("\n"); 
		query.append("    ,FRLOC_ECC     ## FROM ECC      							" ).append("\n"); 
		query.append("    ,TOLOC_ECC     ## TO   ECC      							" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    ,TRSPNO_P     ## TRSP P CD COUNT (HIDDEN)					            " ).append("\n"); 
		query.append("    ,TRSPNO_D     ## TRSP D CD COUNT (HIDDEN)					            " ).append("\n"); 
		query.append("    " ).append("\n"); 
		query.append("    ,SORT_FRLOC                 ## NOT SHOW             " ).append("\n"); 
		query.append("    ,SORT_TOLOC                 ## NOT SHOW             " ).append("\n"); 
		query.append("    ,SORT1 ## NOT SHOW   " ).append("\n"); 
		query.append("	" ).append("\n"); 
		query.append("	,NVL((SELECT 'Y' FROM MDM_EQ_ORZ_CHT EOC, MDM_LOCATION ML WHERE EOC.SCC_CD = ML.SCC_CD AND ML.LOC_CD = SUBSTR(T4_FRLOC,1,5) AND EOC.DELT_FLG = 'N'" ).append("\n"); 
		query.append("             AND EOC.RCC_CD = (SELECT SUB.RCC_CD FROM MDM_ORGANIZATION MO, MDM_EQ_ORZ_CHT SUB, MDM_LOCATION ML WHERE MO.OFC_CD = @[off_cd]" ).append("\n"); 
		query.append("			 					AND MO.LOC_CD = ML.LOC_CD" ).append("\n"); 
		query.append("			 					AND ML.SCC_CD = SUB.SCC_CD" ).append("\n"); 
		query.append("			 					AND SUB.DELT_FLG = 'N'" ).append("\n"); 
		query.append("								AND ROWNUM = 1)) , 'Y') AS T4_FM_CHK_FLG  " ).append("\n"); 
		query.append("	,NVL ((SELECT 'Y'FROM MDM_EQ_ORZ_CHT EOC, MDM_LOCATION ML WHERE EOC.SCC_CD = ML.SCC_CD AND ML.LOC_CD = SUBSTR(T4_TOLOC,1,5) AND EOC.DELT_FLG = 'N'" ).append("\n"); 
		query.append("             AND EOC.RCC_CD = (SELECT SUB.RCC_CD FROM MDM_ORGANIZATION MO, MDM_EQ_ORZ_CHT SUB, MDM_LOCATION ML WHERE MO.OFC_CD = @[off_cd]" ).append("\n"); 
		query.append("                                  AND MO.LOC_CD = ML.LOC_CD" ).append("\n"); 
		query.append("                                  AND ML.SCC_CD = SUB.SCC_CD" ).append("\n"); 
		query.append("                                  AND SUB.DELT_FLG = 'N'" ).append("\n"); 
		query.append("                                  AND ROWNUM = 1)) , 'Y') AS T4_TO_CHK_FLG  " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	,CASE WHEN DIVISION != 'Plan' THEN " ).append("\n"); 
		query.append("        (SELECT OFC_CD FROM COM_USER WHERE USR_ID = (SELECT UPD_USR_ID FROM EQR_ECC_INTER_EXE_PLN WHERE REPO_PLN_ID =  @[repoPlanID] AND PLN_YRWK = T4_PLN_YRWK AND REF_ID = T4_REF_ID ))" ).append("\n"); 
		query.append("     ELSE " ).append("\n"); 
		query.append("        (SELECT OFC_CD FROM COM_USER WHERE USR_ID = (SELECT UPD_USR_ID FROM EQR_ECC_INTER_EXE_PLN WHERE REPO_PLN_ID =  @[repoPlanID] AND PLN_YRWK = T4_PLN_YRWK AND REF_ID = T4_REF_ID))" ).append("\n"); 
		query.append("     END T4_OFC_CD  " ).append("\n"); 
		query.append("             " ).append("\n"); 
		query.append("     ,CASE WHEN DIVISION != 'Plan' THEN " ).append("\n"); 
		query.append("          (SELECT UPD_USR_ID FROM EQR_ECC_INTER_EXE_PLN WHERE REPO_PLN_ID =  @[repoPlanID] AND PLN_YRWK = T4_PLN_YRWK AND REF_ID = T4_REF_ID )" ).append("\n"); 
		query.append("     ELSE " ).append("\n"); 
		query.append("          (SELECT UPD_USR_ID FROM EQR_ECC_INTER_EXE_PLN WHERE REPO_PLN_ID =  @[repoPlanID] AND	PLN_YRWK = T4_PLN_YRWK  AND REF_ID = T4_REF_ID )" ).append("\n"); 
		query.append("     END T4_UPD_USR_ID " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	,CASE WHEN DIVISION != 'Plan' THEN " ).append("\n"); 
		query.append("         TO_CHAR((SELECT UPD_DT FROM EQR_ECC_INTER_EXE_PLN WHERE REPO_PLN_ID =  @[repoPlanID] AND PLN_YRWK = T4_PLN_YRWK AND REF_ID = T4_REF_ID ),'YYYY-MM-DD HH24:MI:SS')" ).append("\n"); 
		query.append("     ELSE " ).append("\n"); 
		query.append("         TO_CHAR((SELECT UPD_DT FROM EQR_ECC_INTER_EXE_PLN WHERE REPO_PLN_ID =  @[repoPlanID] AND	PLN_YRWK = T4_PLN_YRWK AND	REF_ID = T4_REF_ID),'YYYY-MM-DD HH24:MI:SS')" ).append("\n"); 
		query.append("     END T4_UPD_DT " ).append("\n"); 
		query.append("FROM " ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("SELECT " ).append("\n"); 
		query.append("    PLN_YRWK T4_PLN_YRWK													  						" ).append("\n"); 
		query.append("    ,COMPANY                                                      " ).append("\n"); 
		query.append("    ,DIVISION                                                     " ).append("\n"); 
		query.append("    ,ITEM                                                         " ).append("\n"); 
		query.append("    ,FRLOC T4_FRLOC                                                                  " ).append("\n"); 
		query.append("    ,ETD														  " ).append("\n"); 
		query.append("    ,TOLOC T4_TOLOC                                                     " ).append("\n"); 
		query.append("    ,ETA														  " ).append("\n"); 
		query.append("    ,PURPOSE                                                      " ).append("\n"); 
		query.append("    ,CNTRNO                                                       " ).append("\n"); 
		query.append("    ,SOSEND		                                                  " ).append("\n"); 
		query.append("    ,REF_ID T4_REF_ID      						                          " ).append("\n"); 
		query.append("    ,CMB_REF_ID    " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    ,SUM(TOTALVOL)  TOTALVOL                                      " ).append("\n"); 
		query.append("    #foreach(${key} in ${tpszArr}) " ).append("\n"); 
		query.append("        ,SUM(${key}VOL)     ${key}VOL			  " ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("    ,SUM(TOTALCOST) TOTALCOST                                     " ).append("\n"); 
		query.append("    #foreach(${key} in ${tpszArr}) " ).append("\n"); 
		query.append("        ,SUM(${key}COST)    ${key}COST            " ).append("\n"); 
		query.append("    #end        	" ).append("\n"); 
		query.append("    ,REPO_PLN_ID 	## HIDDEN                                     " ).append("\n"); 
		query.append("    ,SORTNUM    	## HIDDEN	PLAN(1), Execution(2), SO(3)를 구분" ).append("\n"); 
		query.append("    ,NUM        	## HIDDEN 	NORMAL ROW(1), SUB TOTAL(2), GRAND TOTAL(3) 구분 " ).append("\n"); 
		query.append("    ,'' CNTRNOINPUT  ## HIDDEN                                    " ).append("\n"); 
		query.append("    ,'' TPSZINPUT    ## HIDDEN                                            " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    #foreach(${key} in ${tpszArr}) " ).append("\n"); 
		query.append("        ,SUM(${key}CNTRVOL) ${key}CNTRVOL	    	" ).append("\n"); 
		query.append("    #end  " ).append("\n"); 
		query.append("    " ).append("\n"); 
		query.append("    ## TYPE SIZE별 수정된 VOL 정보를 확인하기 위한 FLAG" ).append("\n"); 
		query.append("    #foreach(${key} in ${tpszArr}) " ).append("\n"); 
		query.append("          ,'F' ${key}FLAG									" ).append("\n"); 
		query.append("    #end        	" ).append("\n"); 
		query.append("    ,(" ).append("\n"); 
		query.append("        SELECT " ).append("\n"); 
		query.append("            WK_ST_DT  " ).append("\n"); 
		query.append("        FROM " ).append("\n"); 
		query.append("            EQR_WK_PRD " ).append("\n"); 
		query.append("        WHERE " ).append("\n"); 
		query.append("            PLN_YR||PLN_WK = PLN_YRWK " ).append("\n"); 
		query.append("    ) WK_ST_DT  ## week from date " ).append("\n"); 
		query.append("    ,(" ).append("\n"); 
		query.append("        SELECT " ).append("\n"); 
		query.append("            WK_END_DT " ).append("\n"); 
		query.append("        FROM " ).append("\n"); 
		query.append("            EQR_WK_PRD " ).append("\n"); 
		query.append("        WHERE " ).append("\n"); 
		query.append("            PLN_YR||PLN_WK = PLN_YRWK " ).append("\n"); 
		query.append("    ) WK_END_DT ## week to date      " ).append("\n"); 
		query.append("    ,(" ).append("\n"); 
		query.append("        SELECT " ).append("\n"); 
		query.append("            TO_CHAR(TO_DATE(WK_END_DT, 'YYYYMMDD')+49, 'YYYYMMDD') WK_MAX_DT " ).append("\n"); 
		query.append("        FROM " ).append("\n"); 
		query.append("            EQR_WK_PRD " ).append("\n"); 
		query.append("        WHERE " ).append("\n"); 
		query.append("            PLN_YR||PLN_WK = PLN_YRWK " ).append("\n"); 
		query.append("    ) WK_MAX_DT ## WEEK MAX DATE +7    	    " ).append("\n"); 
		query.append("    ,(" ).append("\n"); 
		query.append("        SELECT " ).append("\n"); 
		query.append("            DISTINCT RCC_CD " ).append("\n"); 
		query.append("        FROM " ).append("\n"); 
		query.append("            MDM_EQ_ORZ_CHT EOC, MDM_LOCATION ML" ).append("\n"); 
		query.append("        WHERE" ).append("\n"); 
		query.append("            EOC.SCC_CD = ML.SCC_CD" ).append("\n"); 
		query.append("            AND ML.LOC_CD = SUBSTR(FRLOC, 0, 5)" ).append("\n"); 
		query.append("    ) FRLOC_RCC     ## from ecc's RCC      							" ).append("\n"); 
		query.append("    ,(" ).append("\n"); 
		query.append("        SELECT " ).append("\n"); 
		query.append("            DISTINCT ECC_CD " ).append("\n"); 
		query.append("        FROM " ).append("\n"); 
		query.append("            MDM_EQ_ORZ_CHT EOC, MDM_LOCATION ML " ).append("\n"); 
		query.append("        WHERE " ).append("\n"); 
		query.append("            EOC.SCC_CD = ML.SCC_CD" ).append("\n"); 
		query.append("            AND ML.LOC_CD = SUBSTR(FRLOC, 0, 5)" ).append("\n"); 
		query.append("    ) FRLOC_ECC     ## FROM ECC      							" ).append("\n"); 
		query.append("    ,(" ).append("\n"); 
		query.append("        SELECT " ).append("\n"); 
		query.append("            DISTINCT ECC_CD " ).append("\n"); 
		query.append("        FROM " ).append("\n"); 
		query.append("            MDM_EQ_ORZ_CHT EOC, MDM_LOCATION ML" ).append("\n"); 
		query.append("        WHERE " ).append("\n"); 
		query.append("            EOC.SCC_CD = ML.SCC_CD" ).append("\n"); 
		query.append("            AND ML.LOC_CD = SUBSTR(TOLOC, 0, 5)" ).append("\n"); 
		query.append("    ) TOLOC_ECC     ## TO   ECC      							" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    ,TRSPNO_P     ## TRSP P CD COUNT (HIDDEN)					            " ).append("\n"); 
		query.append("    ,TRSPNO_D     ## TRSP D CD COUNT (HIDDEN)					            " ).append("\n"); 
		query.append("    " ).append("\n"); 
		query.append("    ,SUBSTR(FRLOC, 0, 5) SORT_FRLOC                 ## NOT SHOW             " ).append("\n"); 
		query.append("    ,SUBSTR(TOLOC, 0, 5) SORT_TOLOC                 ## NOT SHOW             " ).append("\n"); 
		query.append("    ,SUBSTR(FRLOC, 0, 5) || SUBSTR(TOLOC, 0, 5) SORT1 ## NOT SHOW   " ).append("\n"); 
		query.append("FROM                                                                " ).append("\n"); 
		query.append("    (                                                                   " ).append("\n"); 
		query.append("        SELECT " ).append("\n"); 
		query.append("            DECODE(B.NUM, 1, A.PLN_YRWK, 2, A.PLN_YRWK||' TTL', 3, 'TOTAL') PLN_YRWK                                          " ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.COMPANY,  2, '', 3, '')  COMPANY   		" ).append("\n"); 
		query.append("            ,A.DIVISION                                               	" ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.ITEM ,  2, '', 3, '')     ITEM          " ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.FRLOC,  2, '', 3, '')     FRLOC         " ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.ETD  ,  2, NULL, 3, NULL) ETD         	" ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.TOLOC,  2, '', 3, '')     TOLOC         " ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.ETA  ,  2, NULL, 3, NULL) ETA         	" ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.PURPOSE,  2, '', 3, '')   PURPOSE       " ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.CNTRNO,  2, '', 3, '')   CNTRNO         " ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.SOSEND,  2, '', 3, '')   SOSEND			 " ).append("\n"); 
		query.append("            ,SUM(A.TOTALVOL)  TOTALVOL                                	" ).append("\n"); 
		query.append("            ,SUM(A.TOTALCOST) TOTALCOST                               	" ).append("\n"); 
		query.append("            #foreach(${key} in ${tpszArr})                                                " ).append("\n"); 
		query.append("                ,SUM(A.${key}VOL)     ${key}VOL       	" ).append("\n"); 
		query.append("                ,SUM(A.${key}COST)    ${key}COST      	" ).append("\n"); 
		query.append("            #end " ).append("\n"); 
		query.append("            ## TPSZ별 CNTR 갯수" ).append("\n"); 
		query.append("            #foreach(${key} in ${tpszArr}) " ).append("\n"); 
		query.append("                ,SUM(A.${key}CNTRVOL) ${key}CNTRVOL " ).append("\n"); 
		query.append("            #end" ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.REF_ID,  2, '', 3, '') REF_ID   	   " ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.CMB_REF_ID,  2, '', 3, '') CMB_REF_ID " ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.REPO_PLN_ID,  2, '', 3, '') REPO_PLN_ID ## HIDDEN   " ).append("\n"); 
		query.append("            ,A.SORTNUM    	    ## HIDDEN							  	  " ).append("\n"); 
		query.append("            ,B.NUM           	## HIDDEN 										                                                                             " ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.TRSPNO_P,  2, '', 3, '') TRSPNO_P	## HIDDEN 			                                                                             " ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.TRSPNO_D,  2, '', 3, '') TRSPNO_D	## HIDDEN 			                                                                             " ).append("\n"); 
		query.append("        FROM															" ).append("\n"); 
		query.append("            (                                                             " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            ## query 시작(NORMAL, SUB, GRAND TOTAL 공동사용)" ).append("\n"); 
		query.append("            ## PLAN(없음)####################################-          " ).append("\n"); 
		query.append("            ## Execution ######################################-          " ).append("\n"); 
		query.append("                SELECT " ).append("\n"); 
		query.append("                    A.PLN_YRWK 		PLN_YRWK           					                       " ).append("\n"); 
		query.append("                    ,A.CO_CD 			COMPANY                                  " ).append("\n"); 
		query.append("                    ,'Execution' 		DIVISION                            " ).append("\n"); 
		query.append("                    ,A.TRSP_MOD_CD 	ITEM                                " ).append("\n"); 
		query.append("                    ,A.FM_YD_CD  		FRLOC                               " ).append("\n"); 
		query.append("                    ,TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') 		ETD                   " ).append("\n"); 
		query.append("                    ,A.TO_YD_CD  		TOLOC                               " ).append("\n"); 
		query.append("                    ,TO_CHAR(A.TO_ETA_DT, 'YYYYMMDD') 		ETA         " ).append("\n"); 
		query.append("                    ,A.EQ_REPO_PURP_CD PURPOSE                            " ).append("\n"); 
		query.append("                    ,CASE WHEN A.PLN_YRWK = C.PLN_YRWK AND A.REF_ID = C.REF_ID " ).append("\n"); 
		query.append("                        THEN " ).append("\n"); 
		query.append("                            '0'  ## CNTR 존재       " ).append("\n"); 
		query.append("                        ELSE " ).append("\n"); 
		query.append("                            '1'  ## CNTR 존재안함 " ).append("\n"); 
		query.append("                    END CNTRNO             " ).append("\n"); 
		query.append("                    ,A.EXE_ISS_FLG    	 SOSEND			                                     " ).append("\n"); 
		query.append("                    ," ).append("\n"); 
		query.append("                    #foreach(${key} in ${tpszArr}) " ).append("\n"); 
		query.append("                        NVL(MAX(DECODE(A.CNTR_TPSZ_CD, '${key}', A.CNTR_QTY)),0)" ).append("\n"); 
		query.append("                        #if($velocityCount < $tpszArr.size()) " ).append("\n"); 
		query.append("                            +" ).append("\n"); 
		query.append("                        #end " ).append("\n"); 
		query.append("                    #end	" ).append("\n"); 
		query.append("                    TOTALVOL                       									" ).append("\n"); 
		query.append("                    ," ).append("\n"); 
		query.append("                    #foreach(${key} in ${tpszArr}) " ).append("\n"); 
		query.append("                        NVL(MAX(DECODE(A.CNTR_TPSZ_CD, '${key}', A.TRSP_COST_AMT)),0)" ).append("\n"); 
		query.append("                        #if($velocityCount < $tpszArr.size()) " ).append("\n"); 
		query.append("                            +" ).append("\n"); 
		query.append("                        #end " ).append("\n"); 
		query.append("                    #end	" ).append("\n"); 
		query.append("                    TOTALCOST                       									" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("                    #foreach(${key} in ${tpszArr}) " ).append("\n"); 
		query.append("                        ,NVL(MAX(DECODE(A.CNTR_TPSZ_CD, '${key}', A.CNTR_QTY)),0) 	 ${key}VOL  " ).append("\n"); 
		query.append("                        ,NVL(MAX(DECODE(A.CNTR_TPSZ_CD, '${key}', A.TRSP_COST_AMT)),0) ${key}COST " ).append("\n"); 
		query.append("                    #end	" ).append("\n"); 
		query.append("                    ## TPSZ별 CNTR 갯수" ).append("\n"); 
		query.append("                    #foreach(${key} in ${tpszArr}) " ).append("\n"); 
		query.append("                        ,NVL(MAX(DECODE(A.CNTR_TPSZ_CD, '${key}', D.REFCOUNT)),0) 		  ${key}CNTRVOL  " ).append("\n"); 
		query.append("                    #end	" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("                    ,A.REF_ID                                             " ).append("\n"); 
		query.append("                    ,A.CMB_REF_ID                                         " ).append("\n"); 
		query.append("                    ,A.REPO_PLN_ID 				## HIDDEN               " ).append("\n"); 
		query.append("                    ,2 SORTNUM   					## HIDDEN               	" ).append("\n"); 
		query.append("                    ,CASE WHEN A.PLN_YRWK = E.PLN_YRWK AND A.REF_ID = E.REF_ID " ).append("\n"); 
		query.append("                        THEN " ).append("\n"); 
		query.append("                            E.TRSPCOUNT_P  ## TRSP 존재    " ).append("\n"); 
		query.append("                        ELSE " ).append("\n"); 
		query.append("                            0            ## TRSP 존재안함  " ).append("\n"); 
		query.append("                    END TRSPNO_P              				" ).append("\n"); 
		query.append("                    ,CASE WHEN A.PLN_YRWK = E.PLN_YRWK AND A.REF_ID = E.REF_ID " ).append("\n"); 
		query.append("                        THEN " ).append("\n"); 
		query.append("                            E.TRSPCOUNT_D  ## TRSP 존재    " ).append("\n"); 
		query.append("                        ELSE " ).append("\n"); 
		query.append("                            0            ## TRSP 존재안함  " ).append("\n"); 
		query.append("                    END TRSPNO_D              				" ).append("\n"); 
		query.append("                FROM " ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                        SELECT" ).append("\n"); 
		query.append("                            A.REPO_PLN_ID,    " ).append("\n"); 
		query.append("                            A.PLN_YRWK,       " ).append("\n"); 
		query.append("                            A.REF_ID,         " ).append("\n"); 
		query.append("                            A.CO_CD,          " ).append("\n"); 
		query.append("                            A.TRSP_MOD_CD,    " ).append("\n"); 
		query.append("                            A.FM_YD_CD,       " ).append("\n"); 
		query.append("                            A.FM_ETD_DT,      " ).append("\n"); 
		query.append("                            A.TO_YD_CD,       " ).append("\n"); 
		query.append("                            A.TO_ETA_DT,      " ).append("\n"); 
		query.append("                            A.EQ_REPO_PURP_CD," ).append("\n"); 
		query.append("                            A.EXE_ISS_FLG,    " ).append("\n"); 
		query.append("                            A.CMB_REF_ID,     " ).append("\n"); 
		query.append("                            A.CRE_USR_ID,     " ).append("\n"); 
		query.append("                            A.CRE_DT,         " ).append("\n"); 
		query.append("                            A.UPD_USR_ID,     " ).append("\n"); 
		query.append("                            A.UPD_DT," ).append("\n"); 
		query.append("                            Q.CNTR_TPSZ_CD," ).append("\n"); 
		query.append("                            Q.TRSP_COST_AMT," ).append("\n"); 
		query.append("                            Q.CNTR_QTY" ).append("\n"); 
		query.append("                        FROM                            " ).append("\n"); 
		query.append("                            EQR_ECC_INTER_EXE_PLN A, " ).append("\n"); 
		query.append("                            EQR_ECC_INTER_EXE_PLN_QTY Q    " ).append("\n"); 
		query.append("                        WHERE" ).append("\n"); 
		query.append("                            A.REPO_PLN_ID = Q.REPO_PLN_ID                " ).append("\n"); 
		query.append("                            AND   A.PLN_YRWK    = Q.PLN_YRWK                   " ).append("\n"); 
		query.append("                            AND   A.REF_ID      = Q.REF_ID" ).append("\n"); 
		query.append("                    ) A ,                      " ).append("\n"); 
		query.append("                    (                                                      " ).append("\n"); 
		query.append("                        SELECT " ).append("\n"); 
		query.append("                            A.REPO_PLN_ID" ).append("\n"); 
		query.append("                            , A.PLN_YRWK" ).append("\n"); 
		query.append("                            , A.REF_ID" ).append("\n"); 
		query.append("                            , NVL(COUNT(*), 0) REFCOUNT  " ).append("\n"); 
		query.append("                        FROM " ).append("\n"); 
		query.append("                            EQR_EXE_PLN_CNTR A,							" ).append("\n"); 
		query.append("                            EQR_ECC_INTER_EXE_PLN B,							" ).append("\n"); 
		query.append("                            EQR_ECC_INTER_EXE_PLN_QTY Q                       " ).append("\n"); 
		query.append("                        WHERE " ).append("\n"); 
		query.append("                            A.REPO_PLN_ID = B.REPO_PLN_ID                " ).append("\n"); 
		query.append("                            AND   A.PLN_YRWK    = B.PLN_YRWK                   " ).append("\n"); 
		query.append("                            AND   A.REF_ID      = B.REF_ID                     " ).append("\n"); 
		query.append("                            AND   B.REPO_PLN_ID = @[repoPlanID]	            " ).append("\n"); 
		query.append("                            AND   Q.REPO_PLN_ID = B.REPO_PLN_ID               " ).append("\n"); 
		query.append("                            AND   Q.PLN_YRWK    = B.PLN_YRWK                   " ).append("\n"); 
		query.append("                            AND   Q.REF_ID      = B.REF_ID   " ).append("\n"); 
		query.append("                            #if(${userECC} != ${userECC})     	        " ).append("\n"); 
		query.append("                                AND (	" ).append("\n"); 
		query.append("        								SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        															SELECT " ).append("\n"); 
		query.append("        																SCC_CD " ).append("\n"); 
		query.append("        															FROM " ).append("\n"); 
		query.append("        																MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        															WHERE " ).append("\n"); 
		query.append("        																ECC_CD IN ( ${userLocStrArr} )" ).append("\n"); 
		query.append("        								) " ).append("\n"); 
		query.append("        								OR " ).append("\n"); 
		query.append("        								SUBSTR(B.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        															SELECT " ).append("\n"); 
		query.append("        																SCC_CD " ).append("\n"); 
		query.append("        															FROM " ).append("\n"); 
		query.append("        																MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        															WHERE " ).append("\n"); 
		query.append("        																ECC_CD IN ( ${userLocStrArr} )" ).append("\n"); 
		query.append("        								)" ).append("\n"); 
		query.append("        							)                 	" ).append("\n"); 
		query.append("            				#end" ).append("\n"); 
		query.append("        					#if(${fmtoat} == '1')    ## FROM TO" ).append("\n"); 
		query.append("                		 		AND   B.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek]   " ).append("\n"); 
		query.append("        					" ).append("\n"); 
		query.append("        						#if(${fromStatus} != '') 	        " ).append("\n"); 
		query.append("        							AND SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        															SELECT " ).append("\n"); 
		query.append("        																SCC_CD " ).append("\n"); 
		query.append("        															FROM " ).append("\n"); 
		query.append("        																MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        															WHERE " ).append("\n"); 
		query.append("        																ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        							)      " ).append("\n"); 
		query.append("        						#end   " ).append("\n"); 
		query.append("        						#if(${toStatus} != '')   	        " ).append("\n"); 
		query.append("        							AND SUBSTR(B.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        															SELECT " ).append("\n"); 
		query.append("        																SCC_CD " ).append("\n"); 
		query.append("        															FROM " ).append("\n"); 
		query.append("        																MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        															WHERE " ).append("\n"); 
		query.append("        																ECC_CD IN ( ${toLocStrArr} )" ).append("\n"); 
		query.append("        							)" ).append("\n"); 
		query.append("        						#end						" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        					## CSR No  N200906040080 의거 변경 " ).append("\n"); 
		query.append("        					## fmtoat 3   Fm ETD" ).append("\n"); 
		query.append("        					## fmtoat 4   To ETA" ).append("\n"); 
		query.append("        					#elseif(${fmtoat} == '3') " ).append("\n"); 
		query.append("                       			AND  TO_CHAR(B.FM_ETD_DT ,'YYYYMMDD') BETWEEN 	(" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			WK_ST_DT  " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			EQR_WK_PRD " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("        																	   	)  " ).append("\n"); 
		query.append("        																	AND " ).append("\n"); 
		query.append("        																		(" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			WK_END_DT  " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			EQR_WK_PRD " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("        						)    	  	" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        						#if(${fromStatus} != '') 	        " ).append("\n"); 
		query.append("        							AND SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        															SELECT " ).append("\n"); 
		query.append("        																SCC_CD " ).append("\n"); 
		query.append("        															FROM " ).append("\n"); 
		query.append("        																MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        															WHERE " ).append("\n"); 
		query.append("        																ECC_CD IN ( ${fromLocStrArr} )" ).append("\n"); 
		query.append("        							) " ).append("\n"); 
		query.append("        						#end        " ).append("\n"); 
		query.append("        						#if(${toStatus} != '')   	        " ).append("\n"); 
		query.append("        							AND SUBSTR(B.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        															SELECT" ).append("\n"); 
		query.append("        																SCC_CD " ).append("\n"); 
		query.append("        															FROM " ).append("\n"); 
		query.append("        																MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        															WHERE " ).append("\n"); 
		query.append("        																ECC_CD IN ( ${toLocStrArr})" ).append("\n"); 
		query.append("        							)" ).append("\n"); 
		query.append("        						#end						" ).append("\n"); 
		query.append("        					#elseif (${fmtoat} == '4') " ).append("\n"); 
		query.append("                       			AND  TO_CHAR(B.TO_ETA_DT ,'YYYYMMDD') BETWEEN 	(" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			WK_ST_DT  " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			EQR_WK_PRD " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("        																		)   " ).append("\n"); 
		query.append("        																	AND " ).append("\n"); 
		query.append("        																		(" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			WK_END_DT  " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			EQR_WK_PRD " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("        						)    	  	" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        						#if(${fromStatus} != '') 	        " ).append("\n"); 
		query.append("        							AND SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        															SELECT " ).append("\n"); 
		query.append("        																SCC_CD " ).append("\n"); 
		query.append("        														    FROM " ).append("\n"); 
		query.append("        														        MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        														    WHERE " ).append("\n"); 
		query.append("        														        ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        							)" ).append("\n"); 
		query.append("        						#end         " ).append("\n"); 
		query.append("        						#if(${toStatus} != '')   	        " ).append("\n"); 
		query.append("        							AND SUBSTR(B.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        															SELECT " ).append("\n"); 
		query.append("        																SCC_CD " ).append("\n"); 
		query.append("        															FROM " ).append("\n"); 
		query.append("        																MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        															WHERE 	" ).append("\n"); 
		query.append("        																ECC_CD IN ( ${toLocStrArr} )" ).append("\n"); 
		query.append("        							)						" ).append("\n"); 
		query.append("        					## CSR No  N200906040080 끝   " ).append("\n"); 
		query.append("        						#end" ).append("\n"); 
		query.append("        					#else                     ## AT" ).append("\n"); 
		query.append("        						#if(${atStatus} != '') " ).append("\n"); 
		query.append("        	        		 		AND   " ).append("\n"); 
		query.append("        								(												      	" ).append("\n"); 
		query.append("        					        		(" ).append("\n"); 
		query.append("        										B.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        										AND " ).append("\n"); 
		query.append("        										SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			SCC_CD " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        										)" ).append("\n"); 
		query.append("        									)   " ).append("\n"); 
		query.append("        						    	OR												 " ).append("\n"); 
		query.append("        									(" ).append("\n"); 
		query.append("        										(" ).append("\n"); 
		query.append("        											SELECT " ).append("\n"); 
		query.append("        												PLN_YR||PLN_WK " ).append("\n"); 
		query.append("        											FROM " ).append("\n"); 
		query.append("        												EQR_WK_PRD " ).append("\n"); 
		query.append("        											WHERE " ).append("\n"); 
		query.append("        												TO_CHAR(B.TO_ETA_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT" ).append("\n"); 
		query.append("        										) BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        										AND " ).append("\n"); 
		query.append("        										SUBSTR(B.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																	SELECT " ).append("\n"); 
		query.append("        																		SCC_CD " ).append("\n"); 
		query.append("        																	FROM " ).append("\n"); 
		query.append("        																		MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																	WHERE " ).append("\n"); 
		query.append("        																		ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        										)" ).append("\n"); 
		query.append("        									)   " ).append("\n"); 
		query.append("        	                       		)												" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        						#else " ).append("\n"); 
		query.append("        	        		 		AND   " ).append("\n"); 
		query.append("        								(														      	" ).append("\n"); 
		query.append("        					        		(" ).append("\n"); 
		query.append("        										B.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        									)   " ).append("\n"); 
		query.append("        						    	OR														 " ).append("\n"); 
		query.append("        	                        		(" ).append("\n"); 
		query.append("        										(" ).append("\n"); 
		query.append("        											SELECT " ).append("\n"); 
		query.append("        												PLN_YR||PLN_WK " ).append("\n"); 
		query.append("        											FROM " ).append("\n"); 
		query.append("        												EQR_WK_PRD " ).append("\n"); 
		query.append("        											WHERE " ).append("\n"); 
		query.append("        												TO_CHAR(B.TO_ETA_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT" ).append("\n"); 
		query.append("        										) BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        									)   " ).append("\n"); 
		query.append("        	                       		)														     		" ).append("\n"); 
		query.append("        						#end	        " ).append("\n"); 
		query.append("        					#end" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        					#if(${tpsz} != '' && ${tpsztype} != '')        		 " ).append("\n"); 
		query.append("        						AND Q.CNTR_TPSZ_CD IN ( ${tpszStrArr} )" ).append("\n"); 
		query.append("        					#end 	                " ).append("\n"); 
		query.append("							## AS-IS TRSP_MOD_CD decode 구문 없음 오류 수정 09.11.30 Modify By ChungEunHo" ).append("\n"); 
		query.append("        					#if(${itemname} != '') 	    			        		 " ).append("\n"); 
		query.append("        						AND DECODE(B.TRSP_MOD_CD, 'W', 'S', 'T', 'S', 'R', 'S') IN ( ${itemnameStrArr} )" ).append("\n"); 
		query.append("        					#end					         " ).append("\n"); 
		query.append("        					#if(${sosend} != '')  	    			        		 " ).append("\n"); 
		query.append("        						AND B.EXE_ISS_FLG = @[sosend]" ).append("\n"); 
		query.append("        					#end									" ).append("\n"); 
		query.append("                      " ).append("\n"); 
		query.append("        				GROUP BY " ).append("\n"); 
		query.append("        					A.REPO_PLN_ID" ).append("\n"); 
		query.append("        					, A.PLN_YRWK" ).append("\n"); 
		query.append("        					, A.REF_ID       " ).append("\n"); 
		query.append("                		 HAVING NVL(COUNT(*), 0) > 0                        " ).append("\n"); 
		query.append("        			) C,                                                           " ).append("\n"); 
		query.append("        			(                                                      " ).append("\n"); 
		query.append("        				SELECT " ).append("\n"); 
		query.append("        					A.REPO_PLN_ID" ).append("\n"); 
		query.append("        					, A.PLN_YRWK" ).append("\n"); 
		query.append("        					, A.REF_ID" ).append("\n"); 
		query.append("        					, Q.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("        					, NVL(COUNT(*), 0) REFCOUNT  	    " ).append("\n"); 
		query.append("                		FROM " ).append("\n"); 
		query.append("        					EQR_EXE_PLN_CNTR A,							" ).append("\n"); 
		query.append("        					EQR_ECC_INTER_EXE_PLN B ,							" ).append("\n"); 
		query.append("        					EQR_ECC_INTER_EXE_PLN_QTY Q                       " ).append("\n"); 
		query.append("        				WHERE " ).append("\n"); 
		query.append("        					A.REPO_PLN_ID = B.REPO_PLN_ID                " ).append("\n"); 
		query.append("                			AND   A.PLN_YRWK    = B.PLN_YRWK                   " ).append("\n"); 
		query.append("                			AND   A.REF_ID      = B.REF_ID    " ).append("\n"); 
		query.append("                			AND   Q.REPO_PLN_ID = B.REPO_PLN_ID                " ).append("\n"); 
		query.append("                			AND   Q.PLN_YRWK    = B.PLN_YRWK                   " ).append("\n"); 
		query.append("                			AND   Q.REF_ID      = B.REF_ID                   " ).append("\n"); 
		query.append("                			AND   A.CNTR_TPSZ_CD= Q.CNTR_TPSZ_CD				" ).append("\n"); 
		query.append("                			AND   B.REPO_PLN_ID = @[repoPlanID]	            " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        					#if(${userECC} != ${userECC})      	        " ).append("\n"); 
		query.append("        						AND (" ).append("\n"); 
		query.append("        								SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        															SELECT " ).append("\n"); 
		query.append("        																SCC_CD " ).append("\n"); 
		query.append("        															FROM " ).append("\n"); 
		query.append("        																MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        															WHERE " ).append("\n"); 
		query.append("        																ECC_CD IN ( ${userLocStrArr} )" ).append("\n"); 
		query.append("        								) " ).append("\n"); 
		query.append("        							OR " ).append("\n"); 
		query.append("        								SUBSTR(B.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        															SELECT " ).append("\n"); 
		query.append("        																SCC_CD " ).append("\n"); 
		query.append("        															FROM " ).append("\n"); 
		query.append("        																MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        															WHERE " ).append("\n"); 
		query.append("        																ECC_CD IN ( ${userLocStrArr} )" ).append("\n"); 
		query.append("        								)" ).append("\n"); 
		query.append("        							)                 		   " ).append("\n"); 
		query.append("        					#end" ).append("\n"); 
		query.append("        					#if(${fmtoat} == '1')    ## FROM TO" ).append("\n"); 
		query.append("                		 		AND   B.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek]   " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        						#if(${fromStatus} != '') 	        " ).append("\n"); 
		query.append("        							AND SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        															SELECT " ).append("\n"); 
		query.append("        																SCC_CD " ).append("\n"); 
		query.append("        															FROM " ).append("\n"); 
		query.append("        																MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        															WHERE " ).append("\n"); 
		query.append("        																ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        							)" ).append("\n"); 
		query.append("        						#end         " ).append("\n"); 
		query.append("        						#if(${toStatus} != '') 	        " ).append("\n"); 
		query.append("        							AND SUBSTR(B.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        															SELECT " ).append("\n"); 
		query.append("        																SCC_CD " ).append("\n"); 
		query.append("        															FROM " ).append("\n"); 
		query.append("        																MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        															WHERE " ).append("\n"); 
		query.append("        																ECC_CD IN ( ${toLocStrArr} )" ).append("\n"); 
		query.append("        							) " ).append("\n"); 
		query.append("        						#end" ).append("\n"); 
		query.append("        					##		      CSR No  N200906040080 의거 변경 " ).append("\n"); 
		query.append("        					## fmtoat 3   Fm ETD" ).append("\n"); 
		query.append("        					## fmtoat 4   To ETA" ).append("\n"); 
		query.append("        					#elseif(${fmtoat} == '3') " ).append("\n"); 
		query.append("                       			AND  TO_CHAR(B.FM_ETD_DT ,'YYYYMMDD') BETWEEN 	(" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			WK_ST_DT  " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			EQR_WK_PRD " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("        																		)   " ).append("\n"); 
		query.append("        																	AND (" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			WK_END_DT  " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			EQR_WK_PRD " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("        						)    	  	" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        						#if(${fromStatus} != '') 	        " ).append("\n"); 
		query.append("        							AND SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        															SELECT " ).append("\n"); 
		query.append("        																SCC_CD " ).append("\n"); 
		query.append("        															FROM " ).append("\n"); 
		query.append("        																MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        															WHERE " ).append("\n"); 
		query.append("        																ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        							)    " ).append("\n"); 
		query.append("        						#end     " ).append("\n"); 
		query.append("        						#if(${toStatus} != '')   	        " ).append("\n"); 
		query.append("        							AND SUBSTR(B.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        															SELECT " ).append("\n"); 
		query.append("        																SCC_CD " ).append("\n"); 
		query.append("        															FROM " ).append("\n"); 
		query.append("        																MDM_EQ_ORZ_CHT" ).append("\n"); 
		query.append("        															WHERE " ).append("\n"); 
		query.append("        																ECC_CD IN ( ${toLocStrArr} )" ).append("\n"); 
		query.append("        							)" ).append("\n"); 
		query.append("        						#end						" ).append("\n"); 
		query.append("        					#elseif(${fmtoat} == '4') " ).append("\n"); 
		query.append("                       			AND  TO_CHAR(B.TO_ETA_DT ,'YYYYMMDD') BETWEEN 	(" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			WK_ST_DT  " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			EQR_WK_PRD " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("        																		)   " ).append("\n"); 
		query.append("        																	AND (" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			WK_END_DT  " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			EQR_WK_PRD " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("        						)    	  	" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        						#if(${fromStatus} != '') 	        " ).append("\n"); 
		query.append("        							AND SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        															SELECT " ).append("\n"); 
		query.append("        																SCC_CD " ).append("\n"); 
		query.append("        															FROM " ).append("\n"); 
		query.append("        																MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        															WHERE " ).append("\n"); 
		query.append("        																ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        							)" ).append("\n"); 
		query.append("        						#end         " ).append("\n"); 
		query.append("        						#if(${toStatus} != '')   	        " ).append("\n"); 
		query.append("        							AND SUBSTR(B.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        															SELECT " ).append("\n"); 
		query.append("        																SCC_CD " ).append("\n"); 
		query.append("        															FROM " ).append("\n"); 
		query.append("        																MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        															WHERE " ).append("\n"); 
		query.append("        																ECC_CD IN ( ${toLocStrArr} )" ).append("\n"); 
		query.append("        							)" ).append("\n"); 
		query.append("        						#end						" ).append("\n"); 
		query.append("        					## CSR No  N200906040080 끝   " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        					#else                     ## AT" ).append("\n"); 
		query.append("        						#if(${atStatus} != '') " ).append("\n"); 
		query.append("        	        		 		AND   " ).append("\n"); 
		query.append("        								(												      	" ).append("\n"); 
		query.append("        					        		(" ).append("\n"); 
		query.append("        										B.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        										AND SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			SCC_CD " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        										)" ).append("\n"); 
		query.append("        									)   " ).append("\n"); 
		query.append("        						    	OR												 " ).append("\n"); 
		query.append("        									(	" ).append("\n"); 
		query.append("        										(" ).append("\n"); 
		query.append("        											SELECT " ).append("\n"); 
		query.append("        												PLN_YR||PLN_WK " ).append("\n"); 
		query.append("        											FROM " ).append("\n"); 
		query.append("        												EQR_WK_PRD " ).append("\n"); 
		query.append("        											WHERE " ).append("\n"); 
		query.append("        												TO_CHAR(B.TO_ETA_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT" ).append("\n"); 
		query.append("        										) BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        										AND " ).append("\n"); 
		query.append("        										SUBSTR(B.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																	SELECT " ).append("\n"); 
		query.append("        																		SCC_CD " ).append("\n"); 
		query.append("        																	FROM " ).append("\n"); 
		query.append("        																		MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																	WHERE " ).append("\n"); 
		query.append("        																		ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        										)" ).append("\n"); 
		query.append("        									)   " ).append("\n"); 
		query.append("        	                       		)												" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        						#else " ).append("\n"); 
		query.append("        	        		 		AND   " ).append("\n"); 
		query.append("        								(														      	" ).append("\n"); 
		query.append("        					        		(" ).append("\n"); 
		query.append("        										B.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        									)   " ).append("\n"); 
		query.append("        						    	OR														 " ).append("\n"); 
		query.append("        	                        		(" ).append("\n"); 
		query.append("        										(" ).append("\n"); 
		query.append("        											SELECT " ).append("\n"); 
		query.append("        												PLN_YR||PLN_WK " ).append("\n"); 
		query.append("        											FROM " ).append("\n"); 
		query.append("        												EQR_WK_PRD " ).append("\n"); 
		query.append("        											WHERE " ).append("\n"); 
		query.append("        												TO_CHAR(B.TO_ETA_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT" ).append("\n"); 
		query.append("        										) BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        									)   " ).append("\n"); 
		query.append("        	                       		)														 		" ).append("\n"); 
		query.append("        						#end	       " ).append("\n"); 
		query.append("        					#end" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        					#if(${tpsz} != ''  && ${tpsztype} != '')        		 " ).append("\n"); 
		query.append("        						AND Q.CNTR_TPSZ_CD IN ( ${tpszStrArr} ) 	                " ).append("\n"); 
		query.append("        						## CSR NO  N200905180100 (ECC internal mode에서 'Rail' 추가) Modified by Lee Byoung Hun" ).append("\n"); 
		query.append("        					#end" ).append("\n"); 
		query.append("        					#if(${itemname} != '') 					        		 " ).append("\n"); 
		query.append("        						AND DECODE(B.TRSP_MOD_CD, 'W', 'S', 'T', 'S', 'R', 'S') IN ( ${itemnameStrArr} )" ).append("\n"); 
		query.append("        					#end" ).append("\n"); 
		query.append("        					#if(${sosend} != '')	    				        		 " ).append("\n"); 
		query.append("        						AND B.EXE_ISS_FLG = @[sosend]" ).append("\n"); 
		query.append("        					#end									" ).append("\n"); 
		query.append("                      		" ).append("\n"); 
		query.append("        				GROUP BY " ).append("\n"); 
		query.append("        					A.REPO_PLN_ID" ).append("\n"); 
		query.append("        					, A.PLN_YRWK" ).append("\n"); 
		query.append("        					, A.REF_ID" ).append("\n"); 
		query.append("        					, Q.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("        			) D,                                                           " ).append("\n"); 
		query.append("        			(                                                      " ).append("\n"); 
		query.append("        				SELECT " ).append("\n"); 
		query.append("        					A.REPO_PLN_ID" ).append("\n"); 
		query.append("        					, A.PLN_YRWK" ).append("\n"); 
		query.append("        					, A.REF_ID" ).append("\n"); 
		query.append("        					, NVL(SUM(DECODE(A.TRSP_SO_STS_CD, 'P', 1, 0)), 0) TRSPCOUNT_P" ).append("\n"); 
		query.append("        					, NVL(SUM(DECODE(A.TRSP_SO_STS_CD, 'D', 1, 0)), 0) TRSPCOUNT_D    	    	    " ).append("\n"); 
		query.append("              			FROM												" ).append("\n"); 
		query.append("                			(													        " ).append("\n"); 
		query.append("                		    	SELECT " ).append("\n"); 
		query.append("        							A.REPO_PLN_ID" ).append("\n"); 
		query.append("        								, A.PLN_YRWK" ).append("\n"); 
		query.append("        								, A.REF_ID" ).append("\n"); 
		query.append("        								, A.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("        								, A.TRSP_SO_STS_CD         " ).append("\n"); 
		query.append("                		     	FROM " ).append("\n"); 
		query.append("        							EQR_REPO_EXE_SO_IF A						" ).append("\n"); 
		query.append("                		          	, EQR_ECC_INTER_EXE_PLN B  					" ).append("\n"); 
		query.append("                		          	, EQR_ECC_INTER_EXE_PLN_QTY Q                   " ).append("\n"); 
		query.append("                		     	WHERE " ).append("\n"); 
		query.append("        							A.REPO_PLN_ID = B.REPO_PLN_ID                " ).append("\n"); 
		query.append("                		     		AND   A.PLN_YRWK    = B.PLN_YRWK                   " ).append("\n"); 
		query.append("                		     		AND   A.REF_ID      = B.REF_ID                     " ).append("\n"); 
		query.append("                		     		AND   Q.REPO_PLN_ID = B.REPO_PLN_ID                " ).append("\n"); 
		query.append("                		     		AND   Q.PLN_YRWK    = B.PLN_YRWK                   " ).append("\n"); 
		query.append("                		     		AND   Q.REF_ID      = B.REF_ID                     " ).append("\n"); 
		query.append("                		     		AND   A.CNTR_TPSZ_CD= Q.CNTR_TPSZ_CD				" ).append("\n"); 
		query.append("                		     		AND   B.REPO_PLN_ID = @[repoPlanID]	            " ).append("\n"); 
		query.append("                		     		AND   B.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek]   " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        ## P - S/O Send 최초 " ).append("\n"); 
		query.append("        ## D - TRS모듈에서 W/O 시도후 취소 상태" ).append("\n"); 
		query.append("        ## P, D 모두 S/O Cancel 대상으로 포함	             			" ).append("\n"); 
		query.append("                		     		AND   A.TRSP_SO_STS_CD IN ('P', 'D')                  ## 중요" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        							#if(${userECC} != ${userECC})     	        		     " ).append("\n"); 
		query.append("        								AND (" ).append("\n"); 
		query.append("        										SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			SCC_CD " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			ECC_CD IN ( ${userLocStrArr} )" ).append("\n"); 
		query.append("        										) " ).append("\n"); 
		query.append("        									OR " ).append("\n"); 
		query.append("        										SUBSTR(B.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			SCC_CD " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			ECC_CD IN ( ${userLocStrArr} )" ).append("\n"); 
		query.append("        										)" ).append("\n"); 
		query.append("        									)                 	" ).append("\n"); 
		query.append("        							#end" ).append("\n"); 
		query.append("        							#if(${fmtoat} == '1')    ## FROM TO" ).append("\n"); 
		query.append("                		     			AND   B.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek]   " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        								#if(${fromStatus} != '')          		     " ).append("\n"); 
		query.append("        									AND SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																	SELECT " ).append("\n"); 
		query.append("        																		SCC_CD " ).append("\n"); 
		query.append("        																	FROM " ).append("\n"); 
		query.append("        																		MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																	WHERE " ).append("\n"); 
		query.append("        																		ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        									)" ).append("\n"); 
		query.append("        								#end         " ).append("\n"); 
		query.append("        								#if(${toStatus} != '')            		     " ).append("\n"); 
		query.append("        									AND SUBSTR(B.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																	SELECT " ).append("\n"); 
		query.append("        																		SCC_CD " ).append("\n"); 
		query.append("        																	FROM " ).append("\n"); 
		query.append("        																		MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																	WHERE " ).append("\n"); 
		query.append("        																		ECC_CD IN ( ${toLocStrArr} )" ).append("\n"); 
		query.append("        									)" ).append("\n"); 
		query.append("        								#end " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        							## CSR No  N200906040080 의거 변경 " ).append("\n"); 
		query.append("        							## fmtoat 3   Fm ETD" ).append("\n"); 
		query.append("        							## fmtoat 4   To ETA" ).append("\n"); 
		query.append("        							#elseif(${fmtoat} == '3') " ).append("\n"); 
		query.append("                       					AND  TO_CHAR(B.FM_ETD_DT ,'YYYYMMDD') BETWEEN 	(" ).append("\n"); 
		query.append("        																				SELECT " ).append("\n"); 
		query.append("        																					WK_ST_DT  " ).append("\n"); 
		query.append("        																				FROM " ).append("\n"); 
		query.append("        																					EQR_WK_PRD " ).append("\n"); 
		query.append("        																				WHERE " ).append("\n"); 
		query.append("        																					PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("        																				)   " ).append("\n"); 
		query.append("        																			AND (" ).append("\n"); 
		query.append("        																				SELECT 	" ).append("\n"); 
		query.append("        																					WK_END_DT  " ).append("\n"); 
		query.append("        																				FROM " ).append("\n"); 
		query.append("        																					EQR_WK_PRD " ).append("\n"); 
		query.append("        																				WHERE PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("        								)    	  	" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        								#if(${fromStatus} != '') 	                   " ).append("\n"); 
		query.append("        									AND SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																	SELECT " ).append("\n"); 
		query.append("        																		SCC_CD " ).append("\n"); 
		query.append("        																	FROM " ).append("\n"); 
		query.append("        																		MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																	WHERE " ).append("\n"); 
		query.append("        																		ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        									)" ).append("\n"); 
		query.append("        								#end         " ).append("\n"); 
		query.append("        								#if(${toStatus} != '')   	                   " ).append("\n"); 
		query.append("        									AND SUBSTR(B.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																	SELECT " ).append("\n"); 
		query.append("        																		SCC_CD " ).append("\n"); 
		query.append("        																	FROM " ).append("\n"); 
		query.append("        																		MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																	WHERE " ).append("\n"); 
		query.append("        																		ECC_CD IN ( ${toLocStrArr} )" ).append("\n"); 
		query.append("        									)			" ).append("\n"); 
		query.append("        								#end			" ).append("\n"); 
		query.append("        							#elseif(${fmtoat} == '4') " ).append("\n"); 
		query.append("                       					AND  TO_CHAR(B.TO_ETA_DT ,'YYYYMMDD') BETWEEN 	(" ).append("\n"); 
		query.append("        																				SELECT " ).append("\n"); 
		query.append("        																					WK_ST_DT  " ).append("\n"); 
		query.append("        																				FROM " ).append("\n"); 
		query.append("        																					EQR_WK_PRD " ).append("\n"); 
		query.append("        																				WHERE " ).append("\n"); 
		query.append("        																					PLN_YR||PLN_WK = @[fromWeek]	" ).append("\n"); 
		query.append("        																				)   " ).append("\n"); 
		query.append("        																			AND (" ).append("\n"); 
		query.append("        																				SELECT " ).append("\n"); 
		query.append("        																					WK_END_DT  " ).append("\n"); 
		query.append("        																				FROM" ).append("\n"); 
		query.append("        																					EQR_WK_PRD " ).append("\n"); 
		query.append("        																				WHERE " ).append("\n"); 
		query.append("        																					PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("        								)    	  	" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        								#if(${fromStatus} != '') 	                   " ).append("\n"); 
		query.append("        									AND SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			SCC_CD " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        									)" ).append("\n"); 
		query.append("        								#end         " ).append("\n"); 
		query.append("        								#if(${toStatus} != '')   	                   " ).append("\n"); 
		query.append("        									AND SUBSTR(B.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			SCC_CD " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			ECC_CD IN ( ${toLocStrArr} )" ).append("\n"); 
		query.append("        									)" ).append("\n"); 
		query.append("        								#end						" ).append("\n"); 
		query.append("        							## CSR No  N200906040080 끝   	" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        							#else                     ## AT" ).append("\n"); 
		query.append("        								#if(${atStatus} != '') " ).append("\n"); 
		query.append("        	        						AND" ).append("\n"); 
		query.append("        										(												      	" ).append("\n"); 
		query.append("        								        	(" ).append("\n"); 
		query.append("        												B.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        												AND SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																					SELECT " ).append("\n"); 
		query.append("        																						SCC_CD " ).append("\n"); 
		query.append("        																					FROM " ).append("\n"); 
		query.append("        																						MDM_EQ_ORZ_CHT 	" ).append("\n"); 
		query.append("        																					WHERE " ).append("\n"); 
		query.append("        																						ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        												)" ).append("\n"); 
		query.append("        											)   " ).append("\n"); 
		query.append("        						    			OR												 " ).append("\n"); 
		query.append("        	                        				(" ).append("\n"); 
		query.append("        												(" ).append("\n"); 
		query.append("        													SELECT " ).append("\n"); 
		query.append("        														PLN_YR||PLN_WK " ).append("\n"); 
		query.append("        													FROM " ).append("\n"); 
		query.append("        														EQR_WK_PRD " ).append("\n"); 
		query.append("        													WHERE " ).append("\n"); 
		query.append("        														TO_CHAR(B.TO_ETA_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT" ).append("\n"); 
		query.append("        												) BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        												AND SUBSTR(B.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																					SELECT " ).append("\n"); 
		query.append("        																						SCC_CD " ).append("\n"); 
		query.append("        																					FROM " ).append("\n"); 
		query.append("        																						MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																					WHERE " ).append("\n"); 
		query.append("        																						ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        												)" ).append("\n"); 
		query.append("        											)   " ).append("\n"); 
		query.append("        	                       				)												" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        								#else " ).append("\n"); 
		query.append("        	        		 				AND   " ).append("\n"); 
		query.append("        										(														      	" ).append("\n"); 
		query.append("        					        				(" ).append("\n"); 
		query.append("        												B.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        											)   " ).append("\n"); 
		query.append("        						    			OR														 " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        	                        				(" ).append("\n"); 
		query.append("        												(" ).append("\n"); 
		query.append("        													SELECT " ).append("\n"); 
		query.append("        														PLN_YR||PLN_WK " ).append("\n"); 
		query.append("        													FROM " ).append("\n"); 
		query.append("        														EQR_WK_PRD " ).append("\n"); 
		query.append("        													WHERE " ).append("\n"); 
		query.append("        														TO_CHAR(B.TO_ETA_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT" ).append("\n"); 
		query.append("        												) BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        											)   " ).append("\n"); 
		query.append("        	                       				)														 		" ).append("\n"); 
		query.append("        								#end	       	        	    " ).append("\n"); 
		query.append("        							#end" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        							#if(${tpsz} != ''  && ${tpsztype} != '')        		     " ).append("\n"); 
		query.append("        								AND Q.CNTR_TPSZ_CD IN ( ${tpszStrArr} ) 	        " ).append("\n"); 
		query.append("        							#end        " ).append("\n"); 
		query.append("        								## CSR NO  N200905180100 (ECC internal mode에서 'Rail' 추가) Modified by Lee Byoung Hun							" ).append("\n"); 
		query.append("        							#if(${itemname} != '') 	    			        		     " ).append("\n"); 
		query.append("        								AND DECODE(B.TRSP_MOD_CD, 'W', 'S', 'T', 'S', 'R', 'S') IN ( ${itemnameStrArr} )" ).append("\n"); 
		query.append("        							#end" ).append("\n"); 
		query.append("        							#if(${sosend} != '')	    				        		     " ).append("\n"); 
		query.append("        								AND B.EXE_ISS_FLG = @[sosend]" ).append("\n"); 
		query.append("        							#end									" ).append("\n"); 
		query.append("                		 	) A                                                        " ).append("\n"); 
		query.append("        				GROUP BY " ).append("\n"); 
		query.append("        					A.REPO_PLN_ID" ).append("\n"); 
		query.append("        					, A.PLN_YRWK" ).append("\n"); 
		query.append("        					, A.REF_ID   	                      		        " ).append("\n"); 
		query.append("        			) E                                               		        " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        		WHERE " ).append("\n"); 
		query.append("        			A.PLN_YRWK = C.PLN_YRWK(+)							" ).append("\n"); 
		query.append("                	AND   A.REF_ID   = C.REF_ID(+)   							 " ).append("\n"); 
		query.append("                	AND   A.PLN_YRWK = D.PLN_YRWK(+)							 			" ).append("\n"); 
		query.append("                	AND   A.REF_ID   = D.REF_ID(+) 							 " ).append("\n"); 
		query.append("                	AND   A.CNTR_TPSZ_CD = D.CNTR_TPSZ_CD(+)   				 " ).append("\n"); 
		query.append("                	AND   A.PLN_YRWK = E.PLN_YRWK(+)							 " ).append("\n"); 
		query.append("                	AND   A.REF_ID   = E.REF_ID(+) 							 " ).append("\n"); 
		query.append("                	AND   A.REPO_PLN_ID = @[repoPlanID]  " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        			#if(${userECC} != ${userECC})    	            " ).append("\n"); 
		query.append("        				AND " ).append("\n"); 
		query.append("        					(" ).append("\n"); 
		query.append("        						SUBSTR(A.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        													SELECT " ).append("\n"); 
		query.append("        														SCC_CD " ).append("\n"); 
		query.append("        													FROM " ).append("\n"); 
		query.append("        														MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        													WHERE " ).append("\n"); 
		query.append("        														ECC_CD IN ( ${userLocStrArr} )" ).append("\n"); 
		query.append("        						) " ).append("\n"); 
		query.append("        					OR " ).append("\n"); 
		query.append("        						SUBSTR(A.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        													SELECT " ).append("\n"); 
		query.append("        														SCC_CD " ).append("\n"); 
		query.append("        													FROM " ).append("\n"); 
		query.append("        														MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        													WHERE " ).append("\n"); 
		query.append("        														ECC_CD IN ( ${userLocStrArr} )" ).append("\n"); 
		query.append("        						)" ).append("\n"); 
		query.append("        					)                 	" ).append("\n"); 
		query.append("        			#end" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        			#if(${fmtoat} == '1')    ## FROM TO" ).append("\n"); 
		query.append("        				AND   A.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek]    " ).append("\n"); 
		query.append("        			" ).append("\n"); 
		query.append("        				#if(${fromStatus} != '')	        " ).append("\n"); 
		query.append("        					AND SUBSTR(A.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        													SELECT " ).append("\n"); 
		query.append("        														SCC_CD " ).append("\n"); 
		query.append("        													FROM " ).append("\n"); 
		query.append("        														MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        													WHERE " ).append("\n"); 
		query.append("        														ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        					)	" ).append("\n"); 
		query.append("        				#end         " ).append("\n"); 
		query.append("        				#if(${toStatus} != '') 	        " ).append("\n"); 
		query.append("        					AND SUBSTR(A.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        													SELECT " ).append("\n"); 
		query.append("        														SCC_CD " ).append("\n"); 
		query.append("        													FROM " ).append("\n"); 
		query.append("        														MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        													WHERE " ).append("\n"); 
		query.append("        														ECC_CD IN ( ${toLocStrArr} )" ).append("\n"); 
		query.append("        					)" ).append("\n"); 
		query.append("        				#end " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        			##		      CSR No  N200906040080 의거 변경 " ).append("\n"); 
		query.append("        			## fmtoat 3   Fm ETD" ).append("\n"); 
		query.append("        			## fmtoat 4   To ETA" ).append("\n"); 
		query.append("        			#elseif(${fmtoat} == '3') " ).append("\n"); 
		query.append("                       AND  TO_CHAR(A.FM_ETD_DT ,'YYYYMMDD') BETWEEN 	(" ).append("\n"); 
		query.append("        																SELECT " ).append("\n"); 
		query.append("        																	WK_ST_DT  " ).append("\n"); 
		query.append("        																FROM " ).append("\n"); 
		query.append("        																	EQR_WK_PRD " ).append("\n"); 
		query.append("        																WHERE " ).append("\n"); 
		query.append("        																	PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("        																)   " ).append("\n"); 
		query.append("        															AND (" ).append("\n"); 
		query.append("        																SELECT " ).append("\n"); 
		query.append("        																	WK_END_DT  " ).append("\n"); 
		query.append("        																FROM " ).append("\n"); 
		query.append("        																	EQR_WK_PRD " ).append("\n"); 
		query.append("        																WHERE " ).append("\n"); 
		query.append("        																	PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("        				)    	  	" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        				#if(${fromStatus} != '') 	        " ).append("\n"); 
		query.append("        					AND SUBSTR(A.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        													SELECT " ).append("\n"); 
		query.append("        														SCC_CD " ).append("\n"); 
		query.append("        													FROM " ).append("\n"); 
		query.append("        														MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        													WHERE " ).append("\n"); 
		query.append("        														ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        					)" ).append("\n"); 
		query.append("        				#end         " ).append("\n"); 
		query.append("        				#if(${toStatus} != '')   	        " ).append("\n"); 
		query.append("        					AND SUBSTR(A.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        													SELECT " ).append("\n"); 
		query.append("        														SCC_CD " ).append("\n"); 
		query.append("        													FROM " ).append("\n"); 
		query.append("        														MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        													WHERE " ).append("\n"); 
		query.append("        														ECC_CD IN ( ${toLocStrArr} )" ).append("\n"); 
		query.append("        					)" ).append("\n"); 
		query.append("        				#end						" ).append("\n"); 
		query.append("        			#elseif(${fmtoat} == '4' ) " ).append("\n"); 
		query.append("                       AND  TO_CHAR(A.TO_ETA_DT ,'YYYYMMDD') BETWEEN 	(	" ).append("\n"); 
		query.append("        																SELECT " ).append("\n"); 
		query.append("        																	WK_ST_DT  " ).append("\n"); 
		query.append("        																FROM " ).append("\n"); 
		query.append("        																	EQR_WK_PRD " ).append("\n"); 
		query.append("        																WHERE " ).append("\n"); 
		query.append("        																	PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("        																)   " ).append("\n"); 
		query.append("        															AND (" ).append("\n"); 
		query.append("        																SELECT " ).append("\n"); 
		query.append("        																	WK_END_DT  " ).append("\n"); 
		query.append("        																FROM " ).append("\n"); 
		query.append("        																	EQR_WK_PRD " ).append("\n"); 
		query.append("        																WHERE " ).append("\n"); 
		query.append("        																	PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("        				)    	  	" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        				#if(${fromStatus} != '') 	        " ).append("\n"); 
		query.append("        					AND SUBSTR(A.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        													SELECT " ).append("\n"); 
		query.append("        														SCC_CD " ).append("\n"); 
		query.append("        													FROM " ).append("\n"); 
		query.append("        														MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        													WHERE " ).append("\n"); 
		query.append("        														ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        					)" ).append("\n"); 
		query.append("        				#end         " ).append("\n"); 
		query.append("        				#if(${toStatus} != '')   	        " ).append("\n"); 
		query.append("        					AND SUBSTR(A.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        													SELECT " ).append("\n"); 
		query.append("        														SCC_CD " ).append("\n"); 
		query.append("        													FROM " ).append("\n"); 
		query.append("        														MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        													WHERE " ).append("\n"); 
		query.append("        														ECC_CD IN ( ${toLocStrArr} )" ).append("\n"); 
		query.append("        					)						" ).append("\n"); 
		query.append("        				#end" ).append("\n"); 
		query.append("        			## CSR No  N200906040080 끝   " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        			#else                     ## AT" ).append("\n"); 
		query.append("        				#if(${atStatus} != '') " ).append("\n"); 
		query.append("        	        		AND   " ).append("\n"); 
		query.append("        						(												      	" ).append("\n"); 
		query.append("        					    	(" ).append("\n"); 
		query.append("        								A.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        								AND SUBSTR(A.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																SELECT " ).append("\n"); 
		query.append("        																	SCC_CD " ).append("\n"); 
		query.append("        																FROM " ).append("\n"); 
		query.append("        																	MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																WHERE " ).append("\n"); 
		query.append("        																	ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        								)" ).append("\n"); 
		query.append("        							)   " ).append("\n"); 
		query.append("        						OR												 " ).append("\n"); 
		query.append("        	                        (" ).append("\n"); 
		query.append("        								(" ).append("\n"); 
		query.append("        									SELECT " ).append("\n"); 
		query.append("        										PLN_YR||PLN_WK " ).append("\n"); 
		query.append("        									FROM " ).append("\n"); 
		query.append("        										EQR_WK_PRD " ).append("\n"); 
		query.append("        									WHERE " ).append("\n"); 
		query.append("        										TO_CHAR(A.TO_ETA_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT" ).append("\n"); 
		query.append("        								) BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        								AND SUBSTR(A.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																SELECT " ).append("\n"); 
		query.append("        																	SCC_CD " ).append("\n"); 
		query.append("        																FROM " ).append("\n"); 
		query.append("        																	MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																WHERE " ).append("\n"); 
		query.append("        																	ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        								)" ).append("\n"); 
		query.append("        							)   " ).append("\n"); 
		query.append("        						)												" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        				#else " ).append("\n"); 
		query.append("        					AND   " ).append("\n"); 
		query.append("        						(														      	" ).append("\n"); 
		query.append("        							(" ).append("\n"); 
		query.append("        								A.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        							)   " ).append("\n"); 
		query.append("        						OR														 " ).append("\n"); 
		query.append("        							(" ).append("\n"); 
		query.append("        								(	" ).append("\n"); 
		query.append("        									SELECT " ).append("\n"); 
		query.append("        										PLN_YR||PLN_WK " ).append("\n"); 
		query.append("        									FROM " ).append("\n"); 
		query.append("        										EQR_WK_PRD " ).append("\n"); 
		query.append("        									WHERE " ).append("\n"); 
		query.append("        										TO_CHAR(A.TO_ETA_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT" ).append("\n"); 
		query.append("        								) BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        							)   " ).append("\n"); 
		query.append("        						)														 " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        				#end	       " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        			#end" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        			#if(${tpsz} != '' && ${tpsztype} != '') " ).append("\n"); 
		query.append("        				AND   A.CNTR_TPSZ_CD IN ( ${tpszStrArr} ) 	                " ).append("\n"); 
		query.append("        			## CSR NO  N200905180100 (ECC internal mode에서 'Rail' 추가) Modified by Lee Byoung Hun" ).append("\n"); 
		query.append("        			#end" ).append("\n"); 
		query.append("        			#if(${itemname} != '')         " ).append("\n"); 
		query.append("        				AND   DECODE(A.TRSP_MOD_CD, 'W', 'S', 'T', 'S', 'R', 'S') IN ( ${itemnameStrArr} )" ).append("\n"); 
		query.append("        			#end" ).append("\n"); 
		query.append("        			#if(${sosend} != '')	         " ).append("\n"); 
		query.append("        				AND   A.EXE_ISS_FLG = @[sosend]" ).append("\n"); 
		query.append("        			#end									" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        		GROUP BY " ).append("\n"); 
		query.append("        			A.PLN_YRWK                                                                   " ).append("\n"); 
		query.append("                    ,A.CO_CD                                                   " ).append("\n"); 
		query.append("                    ,A.TRSP_MOD_CD                                             " ).append("\n"); 
		query.append("                    ,A.FM_YD_CD                                                " ).append("\n"); 
		query.append("                    ,TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD')                          " ).append("\n"); 
		query.append("                    ,A.TO_YD_CD                                                " ).append("\n"); 
		query.append("                    ,TO_CHAR(A.TO_ETA_DT, 'YYYYMMDD')                          " ).append("\n"); 
		query.append("                    ,A.EQ_REPO_PURP_CD                                         " ).append("\n"); 
		query.append("                    ,CASE WHEN A.PLN_YRWK = C.PLN_YRWK AND A.REF_ID = C.REF_ID  " ).append("\n"); 
		query.append("                        THEN " ).append("\n"); 
		query.append("                            '0'  ## CNTR 존재       " ).append("\n"); 
		query.append("                        ELSE " ).append("\n"); 
		query.append("                            '1'  ## CNTR 존재안함  " ).append("\n"); 
		query.append("                        END                        " ).append("\n"); 
		query.append("                    ,A.EXE_ISS_FLG                                             " ).append("\n"); 
		query.append("                    ,A.REPO_PLN_ID 		                                     " ).append("\n"); 
		query.append("                    ,A.REF_ID                                                  " ).append("\n"); 
		query.append("                    ,A.CMB_REF_ID                                              " ).append("\n"); 
		query.append("                    ,CASE WHEN A.PLN_YRWK = E.PLN_YRWK AND A.REF_ID = E.REF_ID " ).append("\n"); 
		query.append("                        THEN " ).append("\n"); 
		query.append("                            E.TRSPCOUNT_P  ## TRSP 존재   " ).append("\n"); 
		query.append("                        ELSE " ).append("\n"); 
		query.append("                            0            ## TRSP 존재안함 " ).append("\n"); 
		query.append("                        END                               " ).append("\n"); 
		query.append("                    ,CASE WHEN A.PLN_YRWK = E.PLN_YRWK AND A.REF_ID = E.REF_ID    " ).append("\n"); 
		query.append("                        THEN " ).append("\n"); 
		query.append("                            E.TRSPCOUNT_D  ## TRSP 존재   " ).append("\n"); 
		query.append("                        ELSE " ).append("\n"); 
		query.append("                            0            ## TRSP 존재안함 " ).append("\n"); 
		query.append("                        END                               " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("                ## W/O Issue ##########################################	" ).append("\n"); 
		query.append("            UNION														" ).append("\n"); 
		query.append("                SELECT " ).append("\n"); 
		query.append("                    PLN_YRWK 		PLN_YRWK                            " ).append("\n"); 
		query.append("                    ,CO_CD 			COMPANY                             " ).append("\n"); 
		query.append("                    ,'W/O Issue' 		DIVISION                        " ).append("\n"); 
		query.append("                    ##	            	    ,'S'              ITEM                              " ).append("\n"); 
		query.append("                    ,TRSP_MOD_CD      ITEM                              " ).append("\n"); 
		query.append("                    ,FM_YD_CD 		FRLOC                               " ).append("\n"); 
		query.append("                    ,FM_DT 			ETD                                 " ).append("\n"); 
		query.append("                    ,TO_YD_CD 		TOLOC                               " ).append("\n"); 
		query.append("                    ,TO_DT 			ETA                                 " ).append("\n"); 
		query.append("                    ,'' PURPOSE                                         " ).append("\n"); 
		query.append("                    ,'' CNTRNO                                          " ).append("\n"); 
		query.append("                    ,'' SOSEND                                          " ).append("\n"); 
		query.append("                    " ).append("\n"); 
		query.append("                    ,COUNT(CNTR_TPSZ_CD) TOTALVOL	" ).append("\n"); 
		query.append("        			,                    " ).append("\n"); 
		query.append("                    #foreach(${key} in ${tpszArr}) " ).append("\n"); 
		query.append("                        NVL(SUM(DECODE(CNTR_TPSZ_CD, '${key}', REPO_COST_AMT)),0)" ).append("\n"); 
		query.append("        				#if($velocityCount < $tpszArr.size()) " ).append("\n"); 
		query.append("                            +" ).append("\n"); 
		query.append("                        #end " ).append("\n"); 
		query.append("                    #end	" ).append("\n"); 
		query.append("                    TOTALCOST                       									" ).append("\n"); 
		query.append("                    " ).append("\n"); 
		query.append("                    #foreach(${key} in ${tpszArr})         	  " ).append("\n"); 
		query.append("                        ,COUNT(DECODE(CNTR_TPSZ_CD, '${key}', CNTR_TPSZ_CD))  ${key}VOL  " ).append("\n"); 
		query.append("                        ,SUM(DECODE(CNTR_TPSZ_CD,   '${key}', REPO_COST_AMT)) ${key}COST " ).append("\n"); 
		query.append("                    #end  " ).append("\n"); 
		query.append("                    ## TPSZ별 CNTR 갯수" ).append("\n"); 
		query.append("                    #foreach(${key} in ${tpszArr}) " ).append("\n"); 
		query.append("                        ,0 ${key}CNTRVOL  						" ).append("\n"); 
		query.append("                    #end	" ).append("\n"); 
		query.append("                                                                 " ).append("\n"); 
		query.append("                    ,REF_ID REFNO											" ).append("\n"); 
		query.append("                    ,''     CMB_REF_ID    								" ).append("\n"); 
		query.append("                    ,REPO_PLN_ID 	## HIDDEN                           	" ).append("\n"); 
		query.append("                    ,3 SORTNUM	## HIDDEN                           	" ).append("\n"); 
		query.append("                    ,0 TRSPNO_P 	## HIDDEN                           	" ).append("\n"); 
		query.append("                    ,0 TRSPNO_D 	## HIDDEN                           	" ).append("\n"); 
		query.append("                FROM " ).append("\n"); 
		query.append("                    EQR_REPO_EXE_SO_IF OUTER                                                                                                                         " ).append("\n"); 
		query.append("                WHERE " ).append("\n"); 
		query.append("        			OUTER.WO_EXE_FLG = 'Y'                							                        									       										" ).append("\n"); 
		query.append("                	AND EXISTS                                               	 " ).append("\n"); 
		query.append("                		(                                              			         " ).append("\n"); 
		query.append("                    		SELECT " ).append("\n"); 
		query.append("        						REPO_PLN_ID" ).append("\n"); 
		query.append("        						, REF_ID" ).append("\n"); 
		query.append("        						, PLN_YRWK           		" ).append("\n"); 
		query.append("                    		FROM                                     				 " ).append("\n"); 
		query.append("                    			(                                    					         		        " ).append("\n"); 
		query.append("                    				SELECT " ).append("\n"); 
		query.append("                                        A.REPO_PLN_ID                                " ).append("\n"); 
		query.append("                                        ,A.PLN_YRWK                                 " ).append("\n"); 
		query.append("                                        ,A.REF_ID                                   " ).append("\n"); 
		query.append("                                        ,Q.CNTR_TPSZ_CD                             " ).append("\n"); 
		query.append("                                        ,A.CO_CD                                    " ).append("\n"); 
		query.append("                                        ,A.TRSP_MOD_CD                              " ).append("\n"); 
		query.append("                                        ,A.FM_YD_CD                                 " ).append("\n"); 
		query.append("                                        ,A.FM_ETD_DT                                " ).append("\n"); 
		query.append("                                        ,A.TO_YD_CD                                 " ).append("\n"); 
		query.append("                                        ,A.TO_ETA_DT                                " ).append("\n"); 
		query.append("                                        ,A.EQ_REPO_PURP_CD                          " ).append("\n"); 
		query.append("                                        ,Q.CNTR_QTY                                 " ).append("\n"); 
		query.append("                                        ,Q.TRSP_COST_AMT                            " ).append("\n"); 
		query.append("                                        ,Q.EXE_RQST_DT                              " ).append("\n"); 
		query.append("                                        ,A.EXE_ISS_FLG                                       " ).append("\n"); 
		query.append("        			                FROM " ).append("\n"); 
		query.append("        			                    EQR_ECC_INTER_EXE_PLN A " ).append("\n"); 
		query.append("        			                    , EQR_ECC_INTER_EXE_PLN_QTY Q                        " ).append("\n"); 
		query.append("                		            WHERE " ).append("\n"); 
		query.append("                		                A.REPO_PLN_ID = Q.REPO_PLN_ID" ).append("\n"); 
		query.append("                		                AND A.PLN_YRWK = Q.PLN_YRWK " ).append("\n"); 
		query.append("                		                AND A.REF_ID = Q.REF_ID " ).append("\n"); 
		query.append("                		                AND A.REPO_PLN_ID = @[repoPlanID]       			" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        								#if(${userECC} != ${userECC})      	        " ).append("\n"); 
		query.append("        									AND " ).append("\n"); 
		query.append("        										(" ).append("\n"); 
		query.append("        											SUBSTR(A.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			SCC_CD " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			ECC_CD IN ( ${userLocStrArr} )" ).append("\n"); 
		query.append("        											) " ).append("\n"); 
		query.append("        										OR " ).append("\n"); 
		query.append("        											SUBSTR(A.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			SCC_CD " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			ECC_CD IN ( ${userLocStrArr} )" ).append("\n"); 
		query.append("        											)	" ).append("\n"); 
		query.append("        										)                 	" ).append("\n"); 
		query.append("        								#end" ).append("\n"); 
		query.append("        								#if(${fmtoat} == '1')    ## FROM TO" ).append("\n"); 
		query.append("                							AND   A.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek]      			" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        									#if(${fromStatus} != '') 	        " ).append("\n"); 
		query.append("        										AND SUBSTR(A.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			SCC_CD " ).append("\n"); 
		query.append("        																		FROM 	" ).append("\n"); 
		query.append("        																			MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        										)" ).append("\n"); 
		query.append("        									#end         " ).append("\n"); 
		query.append("        									#if(${toStatus} != '') 	        " ).append("\n"); 
		query.append("        										AND SUBSTR(A.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			SCC_CD " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			ECC_CD IN ( ${toLocStrArr} )" ).append("\n"); 
		query.append("        										)" ).append("\n"); 
		query.append("        									#end " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        								##		      CSR No  N200906040080 의거 변경 " ).append("\n"); 
		query.append("        								## fmtoat 3   Fm ETD" ).append("\n"); 
		query.append("        								## fmtoat 4   To ETA" ).append("\n"); 
		query.append("        								#elseif(${fmtoat} == '3') " ).append("\n"); 
		query.append("                       						AND  TO_CHAR(A.FM_ETD_DT ,'YYYYMMDD') BETWEEN 	(" ).append("\n"); 
		query.append("        																					SELECT " ).append("\n"); 
		query.append("        																						WK_ST_DT  " ).append("\n"); 
		query.append("        																					FROM " ).append("\n"); 
		query.append("        																						EQR_WK_PRD " ).append("\n"); 
		query.append("        																					WHERE " ).append("\n"); 
		query.append("        																						PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("        																					)   " ).append("\n"); 
		query.append("        																				AND (" ).append("\n"); 
		query.append("        																					SELECT " ).append("\n"); 
		query.append("        																						WK_END_DT  " ).append("\n"); 
		query.append("        																					FROM " ).append("\n"); 
		query.append("        																						EQR_WK_PRD " ).append("\n"); 
		query.append("        																					WHERE " ).append("\n"); 
		query.append("        																						PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("        									)    	  	" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        									#if(${fromStatus} != '') 	        " ).append("\n"); 
		query.append("        										AND SUBSTR(A.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																			SELECT " ).append("\n"); 
		query.append("        																				SCC_CD " ).append("\n"); 
		query.append("        																			FROM " ).append("\n"); 
		query.append("        																				MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																			WHERE " ).append("\n"); 
		query.append("        																				ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        										)" ).append("\n"); 
		query.append("        									#end         " ).append("\n"); 
		query.append("        									#if(${toStatus} != '')   	        " ).append("\n"); 
		query.append("        										AND SUBSTR(A.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																			SELECT " ).append("\n"); 
		query.append("        																				SCC_CD " ).append("\n"); 
		query.append("        																			FROM " ).append("\n"); 
		query.append("        																				MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																			WHERE " ).append("\n"); 
		query.append("        																				ECC_CD IN ( ${toLocStrArr} )" ).append("\n"); 
		query.append("        										)" ).append("\n"); 
		query.append("        									#end						" ).append("\n"); 
		query.append("        								#elseif(${fmtoat} == '4') " ).append("\n"); 
		query.append("        									AND  TO_CHAR(A.TO_ETA_DT ,'YYYYMMDD') BETWEEN 	(" ).append("\n"); 
		query.append("        																					SELECT " ).append("\n"); 
		query.append("        																						WK_ST_DT  " ).append("\n"); 
		query.append("        																					FROM " ).append("\n"); 
		query.append("        																						EQR_WK_PRD " ).append("\n"); 
		query.append("        																					WHERE " ).append("\n"); 
		query.append("        																						PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("        																					)   " ).append("\n"); 
		query.append("        																				AND (" ).append("\n"); 
		query.append("        																					SELECT " ).append("\n"); 
		query.append("        																						WK_END_DT  " ).append("\n"); 
		query.append("        																					FROM " ).append("\n"); 
		query.append("        																						EQR_WK_PRD " ).append("\n"); 
		query.append("        																					WHERE " ).append("\n"); 
		query.append("        																						PLN_YR||PLN_WK = @[toWeek]	" ).append("\n"); 
		query.append("        									)    	  	" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        									#if(${fromStatus} != '') 	        " ).append("\n"); 
		query.append("        										AND SUBSTR(A.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			SCC_CD " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        										)" ).append("\n"); 
		query.append("        									#end         " ).append("\n"); 
		query.append("        									#if(${toStatus} != '')   	        " ).append("\n"); 
		query.append("        										AND SUBSTR(A.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																		SELECT " ).append("\n"); 
		query.append("        																			SCC_CD " ).append("\n"); 
		query.append("        																		FROM " ).append("\n"); 
		query.append("        																			MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																		WHERE " ).append("\n"); 
		query.append("        																			ECC_CD IN ( ${toLocStrArr} )" ).append("\n"); 
		query.append("        										)" ).append("\n"); 
		query.append("        									#end						" ).append("\n"); 
		query.append("        								## CSR No  N200906040080 끝   " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        								#else                     ## AT" ).append("\n"); 
		query.append("        									#if(${atStatus} != '') " ).append("\n"); 
		query.append("        	        		 					AND   " ).append("\n"); 
		query.append("        											(												      	" ).append("\n"); 
		query.append("        									        	(" ).append("\n"); 
		query.append("        													A.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        													AND SUBSTR(A.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																					SELECT " ).append("\n"); 
		query.append("        																						SCC_CD " ).append("\n"); 
		query.append("        																					FROM " ).append("\n"); 
		query.append("        																						MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																					WHERE " ).append("\n"); 
		query.append("        																						ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        													)" ).append("\n"); 
		query.append("        												)   " ).append("\n"); 
		query.append("        						    				OR												 " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        	                        					(" ).append("\n"); 
		query.append("        													(" ).append("\n"); 
		query.append("        														SELECT " ).append("\n"); 
		query.append("        															PLN_YR||PLN_WK " ).append("\n"); 
		query.append("        														FROM " ).append("\n"); 
		query.append("        															EQR_WK_PRD " ).append("\n"); 
		query.append("        														WHERE " ).append("\n"); 
		query.append("        															TO_CHAR(A.TO_ETA_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT" ).append("\n"); 
		query.append("        													) BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        													AND SUBSTR(A.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("        																					SELECT " ).append("\n"); 
		query.append("        																						SCC_CD " ).append("\n"); 
		query.append("        																					FROM " ).append("\n"); 
		query.append("        																						MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("        																					WHERE " ).append("\n"); 
		query.append("        																						ECC_CD IN ( ${fromLocStrArr} ) " ).append("\n"); 
		query.append("        													)" ).append("\n"); 
		query.append("        												)   " ).append("\n"); 
		query.append("        	                       					)												" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        									#else " ).append("\n"); 
		query.append("        	        		 					AND   " ).append("\n"); 
		query.append("        											(														      	" ).append("\n"); 
		query.append("        					        					(" ).append("\n"); 
		query.append("        													A.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        												)   " ).append("\n"); 
		query.append("        						    				OR														" ).append("\n"); 
		query.append("        	                        					(" ).append("\n"); 
		query.append("        													(" ).append("\n"); 
		query.append("        														SELECT " ).append("\n"); 
		query.append("        															PLN_YR||PLN_WK " ).append("\n"); 
		query.append("        														FROM " ).append("\n"); 
		query.append("        															EQR_WK_PRD " ).append("\n"); 
		query.append("        														WHERE " ).append("\n"); 
		query.append("        															TO_CHAR(A.TO_ETA_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT" ).append("\n"); 
		query.append("        													) BETWEEN @[fromWeek] AND @[toWeek] " ).append("\n"); 
		query.append("        												)   " ).append("\n"); 
		query.append("        	                       					)														 		" ).append("\n"); 
		query.append("        									#end	       	        " ).append("\n"); 
		query.append("        								#end" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        								#if(${tpsz} != '' && ${tpsztype} != '')         		" ).append("\n"); 
		query.append("        									AND Q.CNTR_TPSZ_CD IN ( ${tpszStrArr} )                     " ).append("\n"); 
		query.append("        								#end" ).append("\n"); 
		query.append("        								## CSR NO  N200905180100 (ECC internal mode에서 'Rail' 추가) Modified by Lee Byoung Hun                  " ).append("\n"); 
		query.append("        								#if(${itemname} != '')	        		" ).append("\n"); 
		query.append("        									AND DECODE(A.TRSP_MOD_CD, 'W', 'S', 'T', 'S', 'R', 'S') IN ( ${itemnameStrArr} )" ).append("\n"); 
		query.append("        								#end" ).append("\n"); 
		query.append("        								#if(${sosend} != '')		        		" ).append("\n"); 
		query.append("        									AND A.EXE_ISS_FLG = @[sosend]" ).append("\n"); 
		query.append("        								#end" ).append("\n"); 
		query.append("               					) INNER                         						" ).append("\n"); 
		query.append("        					WHERE " ).append("\n"); 
		query.append("        						INNER.REPO_PLN_ID = OUTER.REPO_PLN_ID             " ).append("\n"); 
		query.append("                     			AND   INNER.REF_ID      = OUTER.REF_ID   				" ).append("\n"); 
		query.append("                      			AND   INNER.PLN_YRWK    = OUTER.PLN_YRWK               	" ).append("\n"); 
		query.append("               			)                          														" ).append("\n"); 
		query.append("        		GROUP BY " ).append("\n"); 
		query.append("        			PLN_YRWK                                         	" ).append("\n"); 
		query.append("        			,CO_CD                                             	" ).append("\n"); 
		query.append("                	,TRSP_MOD_CD                                   		" ).append("\n"); 
		query.append("                	,FM_YD_CD                                          	" ).append("\n"); 
		query.append("                	,FM_DT                                         		" ).append("\n"); 
		query.append("                	,TO_YD_CD                                          	" ).append("\n"); 
		query.append("                	,TO_DT                                         		" ).append("\n"); 
		query.append("                	,REF_ID                                            	" ).append("\n"); 
		query.append("                	,REPO_PLN_ID                                       	       " ).append("\n"); 
		query.append("            ) A,																" ).append("\n"); 
		query.append("            (                                                                 " ).append("\n"); 
		query.append("                SELECT 1 NUM, '' NAME FROM DUAL                             " ).append("\n"); 
		query.append("                UNION                                                       " ).append("\n"); 
		query.append("                SELECT 2 NUM, 'TOTAL' NAME FROM DUAL                        " ).append("\n"); 
		query.append("                UNION                                                       " ).append("\n"); 
		query.append("                SELECT 3 NUM, 'GRAND TOTAL' NAME FROM DUAL                  " ).append("\n"); 
		query.append("            ) B                                                                       " ).append("\n"); 
		query.append("            	" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        GROUP BY " ).append("\n"); 
		query.append("            DECODE(B.NUM, 1, A.PLN_YRWK, 2, A.PLN_YRWK||' TTL', 3, 'TOTAL')                                         " ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.COMPANY,  2, '', 3, '')    			" ).append("\n"); 
		query.append("            ,A.DIVISION                                               " ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.ITEM ,  2, '', 3, '')              	" ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.FRLOC,  2, '', 3, '')             	" ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.ETD  ,  2, NULL, 3, NULL)         	" ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.TOLOC,  2, '', 3, '')              	" ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.ETA  ,  2, NULL, 3, NULL)          	" ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.PURPOSE,  2, '', 3, '')          		" ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.CNTRNO,  2, '', 3, '')            	" ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.SOSEND,  2, '', 3, '')   				     " ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.REF_ID,  2, '', 3, '')    			   " ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.CMB_REF_ID,  2, '', 3, '')			 " ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.REPO_PLN_ID,  2, '', 3, '')  			" ).append("\n"); 
		query.append("            ,A.SORTNUM    	    									  	  " ).append("\n"); 
		query.append("            ,B.NUM           														                                                                             " ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.TRSPNO_P,  2, '', 3, '')  	    				                 " ).append("\n"); 
		query.append("            ,DECODE(B.NUM, 1, A.TRSPNO_D,  2, '', 3, '') 							                 " ).append("\n"); 
		query.append("    )                                                                   	" ).append("\n"); 
		query.append("GROUP BY " ).append("\n"); 
		query.append("    PLN_YRWK                                                   	" ).append("\n"); 
		query.append("    ,COMPANY                                                    	" ).append("\n"); 
		query.append("    ,DIVISION                                                   	" ).append("\n"); 
		query.append("    ,ITEM                                                       	" ).append("\n"); 
		query.append("    ,FRLOC                                                      	" ).append("\n"); 
		query.append("    ,ETD  														" ).append("\n"); 
		query.append("    ,TOLOC                                                      	" ).append("\n"); 
		query.append("    ,ETA  														" ).append("\n"); 
		query.append("    ,PURPOSE                                                    	" ).append("\n"); 
		query.append("    ,CNTRNO                                                     	" ).append("\n"); 
		query.append("    ,SOSEND			                                           	" ).append("\n"); 
		query.append("    ,REF_ID       			                                   	" ).append("\n"); 
		query.append("    ,CMB_REF_ID   			                                    " ).append("\n"); 
		query.append("    ,REPO_PLN_ID ## HIDDEN                                        " ).append("\n"); 
		query.append("    ,SORTNUM     ## HIDDEN  PLAN(1), Execution(2), SO(3)를 구분    " ).append("\n"); 
		query.append("    ,NUM         ## HIDDEN  NORMAL(1), SUB TOTAL(2), GRAND TOTAL(3)" ).append("\n"); 
		query.append("    ,TRSPNO_P     ## TRSP CD COUNT    							          		" ).append("\n"); 
		query.append("    ,TRSPNO_D     ## TRSP CD COUNT    				                           " ).append("\n"); 
		query.append("ORDER BY " ).append("\n"); 
		query.append("    1" ).append("\n"); 
		query.append("    , ITEM" ).append("\n"); 
		query.append("    , SORT1" ).append("\n"); 
		query.append("    , REF_ID" ).append("\n"); 
		query.append("    , SORTNUM" ).append("\n"); 
		query.append(")" ).append("\n"); 

	}
}