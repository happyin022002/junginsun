<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PayableRentalCostDBDAOsearchPayablebyLessorMonthReportRSQL">
			<desc><![CDATA[Payable Invoice 한 결과에 대하여 Charge Type별로 실적을 조회]]></desc>
			<sql><![CDATA[
SELECT
       COST_YRMON,
       CHARGE_TYPE,
       VNDR_SEQ,
       ABBR_NM,
	   CURR_CD,
       LSTM_CD,
#foreach($key IN ${tysz})   
       $key,
#end 
       G_TTL ,
       AGMT_NO
  FROM ( 
        SELECT
               COST_YRMON,
               CHARGE_TYPE,
               VNDR_SEQ,
               ABBR_NM,
			   CURR_CD,
               LSTM_CD,
               #foreach($key IN ${tysz})   
               $key,
               #end 
               G_TTL ,
               AGMT_NO
        FROM (
            SELECT 
                SUBSTR( LTMP.CHG_COST_YRMON  , 0 , 4 ) || '-' || SUBSTR(LTMP.CHG_COST_YRMON  , 5 , 2 )  COST_YRMON,
                LSE_PAY_CHG_TP_CD CHARGE_TYPE,
                NVL(LTMP.PAY_VNDR_SEQ, LTMP.VNDR_SEQ) VNDR_SEQ,         
                SUBSTR(NVL(VNDR.VNDR_ABBR_NM, '   '), 1, 3) ABBR_NM,
				LTMP.CURR_CD,
                LSTM_CD LSTM_CD,
#foreach($key IN ${tysz})
                SUM(DECODE(CNTR_TPSZ_CD, '$key', DECODE(@[payable], 'S', LTC.DSCR_COST_AMT+LTC.CR_AMT, LTC.TTL_COST_AMT+LTC.CR_AMT), 0)) $key ,
#end
                (
#foreach($key IN ${tysz})
    #if($velocityCount < $tysz.size())
                 SUM(DECODE(CNTR_TPSZ_CD, '$key', DECODE(@[payable], 'S', LTC.DSCR_COST_AMT+LTC.CR_AMT, LTC.TTL_COST_AMT+LTC.CR_AMT), 0)) +
    #else
                 SUM(DECODE(CNTR_TPSZ_CD, '$key', DECODE(@[payable], 'S', LTC.DSCR_COST_AMT+LTC.CR_AMT, LTC.TTL_COST_AMT+LTC.CR_AMT), 0))
    #end
#end
                ) G_TTL , 
                LTC.AGMT_CTY_CD || LTRIM(TO_CHAR(LTC.AGMT_SEQ , '000000')) AGMT_NO   
           FROM LSE_PAY_RNTL_CHG_DTL LTC,
                LSE_PAY_RNTL_CHG LTMP,
                MDM_VENDOR VNDR 
          WHERE 1=1
#if(${search_tp} == 'Cost')
					AND LTMP.CHG_COST_YRMON BETWEEN  @[period_stdt] AND @[period_eddt]
#elseif(${search_tp} == 'Revenue')
			        AND  LTMP.INV_NO     IN (SELECT API.INV_NO FROM AP_PAY_INV API  WHERE 1=1
        			AND  API.INV_SUB_SYS_CD = 'LSE'
        			AND  LTMP.IF_RGST_NO  = DECODE(LTMP.IF_RGST_NO, NULL, NULL, API.INV_RGST_NO)
					AND TO_CHAR(API.INV_EFF_DT,'YYYYMM') BETWEEN @[period_stdt] AND @[period_eddt])
#elseif(${search_tp} == 'Payment')
					AND  LTMP.INV_NO     IN (SELECT   API.INV_NO FROM AP_PAY_INV  API WHERE 1=1 
        			AND  API.INV_SUB_SYS_CD = 'LSE'
        			AND  API.INV_STS_CD = 'D'
        			AND TO_CHAR(API.UPD_DT,'YYYYMM') BETWEEN @[period_stdt] AND @[period_eddt])
#end


            AND LTMP.LSE_PAY_RNTL_STS_CD = DECODE(@[payable], 'S', 'I', LTMP.LSE_PAY_RNTL_STS_CD)
#if (${vndr_seq} != '')
            AND LTMP.VNDR_SEQ = @[vndr_seq]
#end
            AND NVL(LTMP.PAY_VNDR_SEQ, LTMP.VNDR_SEQ)    = VNDR.VNDR_SEQ
#if (${lstm_cd_str} != '')
            AND LTMP.LSTM_CD IN (
       #foreach($key IN ${lstm_cd})
         #if($velocityCount < $lstm_cd.size())
           '$key',
         #else
           '$key'
         #end
      #end
)
#end
#if (${agmt_seq} != '' )
            AND LTMP.AGMT_CTY_CD  = @[agmt_cty_cd]
            AND LTMP.AGMT_SEQ     = @[agmt_seq]
#end
            AND LTMP.CHG_SEQ     = LTC.CHG_SEQ
            AND LTMP.AGMT_CTY_CD = LTC.AGMT_CTY_CD
            AND LTMP.AGMT_SEQ    = LTC.AGMT_SEQ
#if (${payable} == 'S')
            AND NVL(LTC.CNTR_AUD_STS_CD, 'A') = 'A' -- Invoice Amount ( P.PAYABLE = 'S' )
#end
#if (${cntr_tpsz_cd_str} != '')
            AND LTC.CNTR_TPSZ_CD IN (
	        #foreach($key IN ${cntr_tpsz_cd})
		        #if($velocityCount < $cntr_tpsz_cd.size())
			        '$key',
		        #else
			        '$key'
		        #end
	        #end
				)
#end
#if (${loc_cd} != '')
   #if (${loc_tp} == 'R')
            AND LTC.ONH_LOC_CD IN (SELECT RCC_CD FROM MDM_EQ_ORZ_CHT WHERE RCC_CD = @[loc_cd])
   #elseif (${loc_tp} == 'L')
            AND LTC.ONH_LOC_CD IN (SELECT LCC_CD FROM MDM_EQ_ORZ_CHT WHERE LCC_CD = @[loc_cd])
   #elseif (${loc_tp} == 'S')
            AND LTC.ONH_LOC_CD IN (SELECT SCC_CD FROM MDM_EQ_ORZ_CHT WHERE SCC_CD = @[loc_cd])
   #elseif (${loc_tp} == 'C')
            AND SUBSTR(LTC.ONH_LOC_CD, 0 , 2 ) = P.LOC_CD
   #end
#end
#if (${lse_pay_tp_cd} != 'ALL')
            AND EXISTS (SELECT 'X'
                          FROM LSE_AGREEMENT LA
                         WHERE LTMP.AGMT_CTY_CD = LA.AGMT_CTY_CD
                           AND LTMP.AGMT_SEQ    = LA.AGMT_SEQ
                           AND LA.LSE_PAY_TP_CD = @[lse_pay_tp_cd]
                           AND ROWNUM           = 1)
#end
          GROUP BY LTMP.CHG_COST_YRMON ,
                   LSE_PAY_CHG_TP_CD ,				   
                   NVL(LTMP.PAY_VNDR_SEQ, LTMP.VNDR_SEQ) ,         
                   SUBSTR(NVL(VNDR.VNDR_ABBR_NM, '   '), 1, 3) ,
				   LTMP.CURR_CD ,
                   LSTM_CD ,   
                   LTC.AGMT_CTY_CD || LTRIM(TO_CHAR(LTC.AGMT_SEQ , '000000'))
          UNION ALL
            SELECT 
                '20'||SUBSTR( LTC.SKD_VOY_NO  , 0 , 2 ) || '-' || SUBSTR(LTC.SKD_VOY_NO,  -2 )  COST_YRMON,
                'OPL' CHARGE_TYPE,
                LTC.VNDR_SEQ VNDR_SEQ,         
                SUBSTR(NVL(VNDR.VNDR_ABBR_NM, '   '), 1, 3) ABBR_NM,
				LTC.CURR_CD,
                LTMP.LSTM_CD LSTM_CD,
#foreach($key IN ${tysz})
                SUM(DECODE(CNTR_TPSZ_CD, '$key', LTC.PAY_AMT, 0)) $key ,
#end
                (
#foreach($key IN ${tysz})
    #if($velocityCount < $tysz.size())
                 SUM(DECODE(CNTR_TPSZ_CD, '$key', LTC.PAY_AMT, 0)) +
    #else
                 SUM(DECODE(CNTR_TPSZ_CD, '$key', LTC.PAY_AMT, 0))
    #end
#end
                ) G_TTL , 
                LTC.AGMT_CTY_CD || LTRIM(TO_CHAR(LTC.AGMT_SEQ , '000000')) AGMT_NO   
           FROM LSE_OP_LSE LTC,
                LSE_AGREEMENT LTMP,
                MDM_VENDOR VNDR 
          WHERE 1=1 
#if(${search_tp} == 'Cost')
					AND LTC.SKD_VOY_NO BETWEEN SUBSTR(@[period_stdt], -4) AND SUBSTR(@[period_eddt], -4)
#elseif(${search_tp} == 'Revenue')
					AND  LTC.INV_NO     IN (SELECT   API.INV_NO FROM AP_PAY_INV  API WHERE 1=1 
        			AND  API.INV_SUB_SYS_CD = 'LSE'
        			AND  LTC.IF_RGST_NO  = DECODE(LTC.IF_RGST_NO, NULL, NULL, API.INV_RGST_NO)
					AND TO_CHAR(API.INV_EFF_DT,'YYYYMM') BETWEEN @[period_stdt] AND @[period_eddt])
#elseif(${search_tp} == 'Payment')
					AND  LTC.INV_NO     IN (SELECT   API.INV_NO FROM AP_PAY_INV  API WHERE 1=1 
        			AND  API.INV_SUB_SYS_CD = 'LSE'
        			AND  API.INV_STS_CD = 'D'
        			AND TO_CHAR(API.UPD_DT,'YYYYMM') BETWEEN @[period_stdt] AND @[period_eddt])
#end

            AND @[payable]= 'S'
#if (${vndr_seq} != '')
            AND LTC.VNDR_SEQ = @[vndr_seq]
#end
            AND LTC.VNDR_SEQ    = VNDR.VNDR_SEQ
#if (${lstm_cd_str} != '')
            AND LTMP.LSTM_CD IN (
       #foreach($key IN ${lstm_cd})
         #if($velocityCount < $lstm_cd.size())
           '$key',
         #else
           '$key'
         #end
      #end
)
#end
#if (${agmt_seq} != '' )
            AND LTC.AGMT_CTY_CD  = @[agmt_cty_cd]
            AND LTC.AGMT_SEQ     = @[agmt_seq]
#end
            AND LTMP.AGMT_CTY_CD = LTC.AGMT_CTY_CD
            AND LTMP.AGMT_SEQ    = LTC.AGMT_SEQ
#if (${cntr_tpsz_cd_str} != '')
            AND LTC.CNTR_TPSZ_CD IN (
	        #foreach($key IN ${cntr_tpsz_cd})
		        #if($velocityCount < $cntr_tpsz_cd.size())
			        '$key',
		        #else
			        '$key'
		        #end
	        #end
				)
#end
#if (${loc_cd} != '')
          AND 'A' = 'B'
#end
#if (${lse_pay_tp_cd} != 'ALL')
            AND EXISTS (SELECT 'X'
                          FROM LSE_AGREEMENT LA
                         WHERE LTC.AGMT_CTY_CD = LA.AGMT_CTY_CD
                           AND LTC.AGMT_SEQ    = LA.AGMT_SEQ
                           AND LA.LSE_PAY_TP_CD = @[lse_pay_tp_cd]
                           AND ROWNUM           = 1)
#end
          GROUP BY LTC.SKD_VOY_NO ,	
                   LTC.VNDR_SEQ ,				            
                   SUBSTR(NVL(VNDR.VNDR_ABBR_NM, '   '), 1, 3) ,
				   LTC.CURR_CD ,
                   LTMP.LSTM_CD ,   
                   LTC.AGMT_CTY_CD || LTRIM(TO_CHAR(LTC.AGMT_SEQ , '000000'))
          )   
          ORDER BY COST_YRMON , CHARGE_TYPE , VNDR_SEQ
       )
UNION ALL
SELECT
       'G.TTL'   COST_YRMON,
       NULL CHARGE_TYPE,
       NULL VNDR_SEQ,         
       NULL ABBR_NM,
	   CURR_CD,
       NULL LSTM_CD,
#foreach($key IN ${tysz})
       SUM($key) $key ,
#end
       SUM(G_TTL) G_TTL , 
       NULL AGMT_NO   
FROM (
	SELECT 
	       'G.TTL'   COST_YRMON,
	       NULL CHARGE_TYPE,
	       NULL VNDR_SEQ,         
	       NULL ABBR_NM,
           LTMP.CURR_CD,
	       NULL LSTM_CD,
	#foreach($key IN ${tysz})
	       SUM(DECODE(CNTR_TPSZ_CD, '$key', DECODE(@[payable], 'S', LTC.DSCR_COST_AMT+LTC.CR_AMT, LTC.TTL_COST_AMT+LTC.CR_AMT), 0)) $key ,
	#end
	       (
	#foreach($key IN ${tysz})
	    #if($velocityCount < $tysz.size())
		SUM(DECODE(CNTR_TPSZ_CD, '$key', DECODE(@[payable], 'S', LTC.DSCR_COST_AMT+LTC.CR_AMT, LTC.TTL_COST_AMT+LTC.CR_AMT), 0)) +
	    #else
		SUM(DECODE(CNTR_TPSZ_CD, '$key', DECODE(@[payable], 'S', LTC.DSCR_COST_AMT+LTC.CR_AMT, LTC.TTL_COST_AMT+LTC.CR_AMT), 0))
	    #end
	 #end
	       ) G_TTL , 
	       NULL AGMT_NO   
	  FROM LSE_PAY_RNTL_CHG_DTL LTC,
	       LSE_PAY_RNTL_CHG LTMP,
	       MDM_VENDOR VNDR 
	 WHERE 1=1
#if(${search_tp} == 'Cost')
					AND LTMP.CHG_COST_YRMON BETWEEN  @[period_stdt] AND @[period_eddt]
#elseif(${search_tp} == 'Revenue')
			        AND  LTMP.INV_NO     IN (SELECT API.INV_NO FROM AP_PAY_INV API  WHERE 1=1
        			AND  API.INV_SUB_SYS_CD = 'LSE'
        			AND  LTMP.IF_RGST_NO  = DECODE(LTMP.IF_RGST_NO, NULL, NULL, API.INV_RGST_NO)
					AND TO_CHAR(API.INV_EFF_DT,'YYYYMM') BETWEEN @[period_stdt] AND @[period_eddt])
#elseif(${search_tp} == 'Payment')
					AND  LTMP.INV_NO     IN (SELECT   API.INV_NO FROM AP_PAY_INV  API WHERE 1=1 
        			AND  API.INV_SUB_SYS_CD = 'LSE'
        			AND  API.INV_STS_CD = 'D'
        			AND TO_CHAR(API.UPD_DT,'YYYYMM') BETWEEN @[period_stdt] AND @[period_eddt])
#end

	   AND LTMP.LSE_PAY_RNTL_STS_CD = DECODE(@[payable], 'S', 'I', LTMP.LSE_PAY_RNTL_STS_CD)
	#if (${vndr_seq} != '')
	   AND LTMP.VNDR_SEQ    = @[vndr_seq]
	#end
	   AND LTMP.VNDR_SEQ    = VNDR.VNDR_SEQ
	#if (${lstm_cd_str} != '')
	     AND LTMP.LSTM_CD IN (
	       #foreach($key IN ${lstm_cd})
		 #if($velocityCount < $lstm_cd.size())
		   '$key',
		 #else
		   '$key'
		 #end
	      #end
	)
	#end
	#if (${agmt_seq} != '' )
	   AND LTMP.AGMT_CTY_CD = @[agmt_cty_cd]
	   AND LTMP.AGMT_SEQ    = @[agmt_seq]
	#end
	   AND LTMP.CHG_SEQ     = LTC.CHG_SEQ
	   AND LTMP.AGMT_CTY_CD = LTC.AGMT_CTY_CD
	   AND LTMP.AGMT_SEQ    = LTC.AGMT_SEQ
	#if (${payable} == 'S')
	   AND NVL(LTC.CNTR_AUD_STS_CD, 'A') = 'A' -- Invoice Amount ( P.PAYABLE = 'S' )
	#end
	#if (${cntr_tpsz_cd_str} != '')
	   AND LTC.CNTR_TPSZ_CD IN (
			#foreach($key IN ${cntr_tpsz_cd})
				#if($velocityCount < $cntr_tpsz_cd.size())
					'$key',
				#else
					'$key'
				#end
			#end
					)
	#end
	#if (${loc_cd} != '')
	  #if (${loc_tp} == 'R')
	   AND LTC.ONH_LOC_CD IN (SELECT RCC_CD FROM MDM_EQ_ORZ_CHT WHERE RCC_CD = @[loc_cd])
	  #elseif (${loc_tp} == 'L')
	   AND LTC.ONH_LOC_CD IN (SELECT LCC_CD FROM MDM_EQ_ORZ_CHT WHERE LCC_CD = @[loc_cd])
	  #elseif (${loc_tp} == 'S')
	   AND LTC.ONH_LOC_CD IN (SELECT SCC_CD FROM MDM_EQ_ORZ_CHT WHERE SCC_CD = @[loc_cd])
	  #elseif (${loc_tp} == 'C')
	   AND SUBSTR(LTC.ONH_LOC_CD, 0 , 2 ) = P.LOC_CD
	  #end
	#end
#if (${lse_pay_tp_cd} != 'ALL')
       AND EXISTS (SELECT 'X'
                     FROM LSE_AGREEMENT LA
                    WHERE LTMP.AGMT_CTY_CD = LA.AGMT_CTY_CD
                      AND LTMP.AGMT_SEQ    = LA.AGMT_SEQ
                      AND LA.LSE_PAY_TP_CD = @[lse_pay_tp_cd]
                      AND ROWNUM           = 1)
#end
GROUP BY LTMP.CURR_CD
	UNION ALL
	SELECT 
	       'G.TTL'   COST_YRMON,
	       NULL CHARGE_TYPE,
	       NULL VNDR_SEQ,         
	       NULL ABBR_NM,
           LTC.CURR_CD,
	       NULL LSTM_CD,
	#foreach($key IN ${tysz})
	       SUM(DECODE(CNTR_TPSZ_CD, '$key', LTC.PAY_AMT, 0)) $key ,
	#end
	       (
	#foreach($key IN ${tysz})
	    #if($velocityCount < $tysz.size())
		SUM(DECODE(CNTR_TPSZ_CD, '$key', LTC.PAY_AMT, 0)) +
	    #else
		SUM(DECODE(CNTR_TPSZ_CD, '$key', LTC.PAY_AMT, 0))
	    #end
	 #end
	       ) G_TTL , 
	       NULL AGMT_NO   
	  FROM LSE_OP_LSE LTC,
	       LSE_AGREEMENT LTMP,
	       MDM_VENDOR VNDR 
	  WHERE 1=1
#if(${search_tp} == 'Cost')
					AND LTC.SKD_VOY_NO BETWEEN SUBSTR(@[period_stdt], -4) AND SUBSTR(@[period_eddt], -4)
#elseif(${search_tp} == 'Revenue')
					AND  LTC.INV_NO     IN (SELECT   API.INV_NO FROM AP_PAY_INV  API WHERE 1=1 
        			AND  API.INV_SUB_SYS_CD = 'LSE'
        			AND  LTC.IF_RGST_NO  = DECODE(LTC.IF_RGST_NO, NULL, NULL, API.INV_RGST_NO)
					AND TO_CHAR(API.INV_EFF_DT,'YYYYMM') BETWEEN @[period_stdt] AND @[period_eddt])
#elseif(${search_tp} == 'Payment')
					AND  LTC.INV_NO     IN (SELECT   API.INV_NO FROM AP_PAY_INV  API WHERE 1=1 
        			AND  API.INV_SUB_SYS_CD = 'LSE'
        			AND  API.INV_STS_CD = 'D'
        			AND TO_CHAR(API.UPD_DT,'YYYYMM') BETWEEN @[period_stdt] AND @[period_eddt])
#end

	    AND @[payable]= 'S'
	#if (${vndr_seq} != '')
	   AND LTC.VNDR_SEQ    = @[vndr_seq]
	#end
	   AND LTC.VNDR_SEQ    = VNDR.VNDR_SEQ
	#if (${lstm_cd_str} != '')
	     AND LTMP.LSTM_CD IN (
	       #foreach($key IN ${lstm_cd})
		 #if($velocityCount < $lstm_cd.size())
		   '$key',
		 #else
		   '$key'
		 #end
	      #end
	)
	#end
	#if (${agmt_seq} != '' )
	   AND LTC.AGMT_CTY_CD = @[agmt_cty_cd]
	   AND LTC.AGMT_SEQ    = @[agmt_seq]
	#end
	   AND LTMP.AGMT_CTY_CD = LTC.AGMT_CTY_CD
	   AND LTMP.AGMT_SEQ    = LTC.AGMT_SEQ
	#if (${cntr_tpsz_cd_str} != '')
	   AND LTC.CNTR_TPSZ_CD IN (
			#foreach($key IN ${cntr_tpsz_cd})
				#if($velocityCount < $cntr_tpsz_cd.size())
					'$key',
				#else
					'$key'
				#end
			#end
					)
	#end
	#if (${loc_cd} != '')
	   AND 'A' = 'B'
	#end
#if (${lse_pay_tp_cd} != 'ALL')
       AND LTMP.LSE_PAY_TP_CD = @[lse_pay_tp_cd]
#end
GROUP BY LTC.CURR_CD
)
GROUP BY CURR_CD			]]></sql>
			<params>
				<param name="payable" type="12" value="" out="N"/>
				<param name="period_stdt" type="12" value="" out="N"/>
				<param name="period_eddt" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
				<param name="agmt_cty_cd" type="12" value="" out="N"/>
				<param name="agmt_seq" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="lse_pay_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
