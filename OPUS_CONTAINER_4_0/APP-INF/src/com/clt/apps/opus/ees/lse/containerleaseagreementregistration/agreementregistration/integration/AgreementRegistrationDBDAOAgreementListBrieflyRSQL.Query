<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AgreementRegistrationDBDAOAgreementListBrieflyRSQL">
			<desc><![CDATA[Lease Agreement List Search]]></desc>
			<sql><![CDATA[
SELECT AA.AGMT_NO      
     , AA.AGMT_CTY_CD                               
     , AA.AGMT_SEQ                                  
     , AA.AGMT_LST_VER_SEQ                          
     , AA.VNDR_SEQ           
	 , AA.OLD_AGMT_NO                       
     , AA.LSTM_CD                                   
     , AA.OFC_CD                                    
     , AA.CURR_CD                                   
     , AA.REF_NO                                    
	 , AA.LSE_CTRT_NO
     , AA.VNDR_LGL_ENG_NM
     , AA.VNDR_ABBR_NM                           
     , AA.EFF_DT
     , AA.EXP_DT
     , AA.LSE_FREE_DYS
     , AA.CRE_USR_ID
     , AA.CRE_DT
     , AA.UPD_USR_ID
     , AA.UPD_DT
	 , AA.AGMT_ACT_FLG
FROM  (
		SELECT ROW_NUMBER() OVER (ORDER BY A.AGMT_SEQ DESC) AS NO
		     , A.AGMT_CTY_CD || LPAD(A.AGMT_SEQ, 6, '0') AS AGMT_NO
		     , A.AGMT_CTY_CD
		     , A.AGMT_SEQ
		     , A.AGMT_LST_VER_SEQ
		     , A.VNDR_SEQ
			 , A.OLD_AGMT_NO
		     , A.LSTM_CD
		     , A.OFC_CD
		     , A.CURR_CD
		     , A.REF_NO
			 , A.LSE_CTRT_NO
		     , C.VNDR_LGL_ENG_NM
             , C.VNDR_ABBR_NM
		     , TO_CHAR(A.LST_EFF_DT,'YYYY-MM-DD') AS EFF_DT
			 , TO_CHAR(A.LST_EXP_DT,'YYYY-MM-DD') AS EXP_DT
			 , A.LSE_FREE_DYS
             , A.CRE_USR_ID
             , TO_CHAR(A.CRE_DT, 'YYYY-MM-DD') AS CRE_DT
             , A.UPD_USR_ID
             , TO_CHAR(A.UPD_DT, 'YYYY-MM-DD') AS UPD_DT
			 , NVL(B.AGMT_ACT_FLG, 'I') AS AGMT_ACT_FLG 
		FROM   LSE_AGREEMENT A
		     , MDM_VENDOR C
			 ,(SELECT  A.AGMT_CTY_CD, A.AGMT_SEQ, 'A' AS AGMT_ACT_FLG                   
               FROM    LSE_AGREEMENT A,
                       MST_CONTAINER B
               WHERE   A.AGMT_CTY_CD = B.AGMT_CTY_CD(+)
               AND     A.AGMT_SEQ = B.AGMT_SEQ(+)        
               AND    (B.ACIAC_DIV_CD = 'A' OR  (B.ACIAC_DIV_CD = 'I' 
               AND     B.CNTR_STS_CD IN('SBO','MUO','LST','SRO'))) 
               GROUP BY A.AGMT_CTY_CD, A.AGMT_SEQ) B
		WHERE  A.VNDR_SEQ = C.VNDR_SEQ(+)
		AND    A.AGMT_CTY_CD = B.AGMT_CTY_CD(+)
        AND    A.AGMT_SEQ = B.AGMT_SEQ(+)
#if (${agmt_cty_cd} != '') 
		AND    A.AGMT_CTY_CD = @[agmt_cty_cd]
#end
#if (${agmt_seq} != '') 
		AND    A.AGMT_SEQ = @[agmt_seq]
#end
#if (${old_agmt_no} != '') 
		AND    UPPER(A.OLD_AGMT_NO) = UPPER(@[old_agmt_no])
#end
#if (${vndr_seq} != '') 
		AND    A.VNDR_SEQ = @[vndr_seq]
#end
#if (${lstm_cd} != '') 
		AND    A.LSTM_CD = @[lstm_cd]
#end
#if (${ofc_cd} != '') 
		AND    A.OFC_CD = @[ofc_cd]
#end
#if (${ref_no} != '') 
		AND    UPPER(A.LSE_CTRT_NO) LIKE UPPER('%'||@[ref_no]||'%') 
#end
#if (${vndr_lgl_eng_nm} != '') 
		AND    UPPER(C.VNDR_LGL_ENG_NM) LIKE UPPER('%'||@[vndr_lgl_eng_nm]||'%')
#end
#if (${vndr_abbr_nm} != '') 
        AND    UPPER(C.VNDR_ABBR_NM) LIKE UPPER('%'||@[vndr_abbr_nm]||'%')
#end
#if (${agmt_act_flg} == 'A') 
		AND    B.AGMT_ACT_FLG = @[agmt_act_flg]
#elseif (${agmt_act_flg} == 'I') 
        AND    B.AGMT_ACT_FLG IS NULL
#end
	) AA			]]></sql>
			<params>
				<param name="agmt_cty_cd" type="12" value="" out="N"/>
				<param name="agmt_seq" type="2" value="" out="N"/>
				<param name="old_agmt_no" type="12" value="" out="N"/>
				<param name="vndr_seq" type="2" value="" out="N"/>
				<param name="lstm_cd" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="ref_no" type="12" value="" out="N"/>
				<param name="vndr_lgl_eng_nm" type="12" value="" out="N"/>
				<param name="vndr_abbr_nm" type="12" value="" out="N"/>
				<param name="agmt_act_flg" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
