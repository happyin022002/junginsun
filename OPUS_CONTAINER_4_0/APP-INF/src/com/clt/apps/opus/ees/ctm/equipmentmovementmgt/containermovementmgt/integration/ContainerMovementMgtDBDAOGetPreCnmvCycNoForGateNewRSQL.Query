<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContainerMovementMgtDBDAOGetPreCnmvCycNoForGateNewRSQL">
			<desc><![CDATA[]]></desc>
			<sql><![CDATA[
SELECT BKG_NO, CNMV_CYC_NO
FROM (SELECT B.BKG_NO,
       A.CNMV_CYC_NO
  FROM BKG_CONTAINER A, BKG_BOOKING B
 WHERE A.CNTR_NO = @[cntr_no]
   AND A.CNMV_CYC_NO = (SELECT MAX (CNMV_CYC_NO)
                          FROM BKG_CONTAINER BC, BKG_BOOKING BO
                         WHERE BC.CNTR_NO = @[cntr_no]
                           AND BC.BKG_NO = BO.BKG_NO
                           AND NVL (BO.BKG_STS_CD, '') <> 'X'
                           AND NVL (BO.BKG_STS_CD, '') <> 'S'
                           AND NVL (BO.BKG_STS_CD, '') <> DECODE (@[gate_io_cd], 'AE', 'A', 'UV', 'A', 'X')    /* 2008.12.16 */
                           AND (BC.CNMV_CYC_NO <> 9999 OR (BC.CNMV_CYC_NO = 9999 AND SYSDATE - BC.CRE_DT < 30)))
   AND A.BKG_NO = B.BKG_NO
   AND NVL (B.BKG_STS_CD, '') <> 'X'
   AND NVL (B.BKG_STS_CD, '') <> 'S'
   AND NVL (B.BKG_STS_CD, '') <> DECODE (@[gate_io_cd], 'AE', 'A', 'UV', 'A', 'X')    /* 2008.12.16 */
   AND ROWNUM = 1
UNION
SELECT B.BKG_NO,
       A.CNMV_CYC_NO
  FROM CTM_BKG_CNTR A, CTM_BOOKING B
 WHERE A.CNTR_NO = @[cntr_no]
   AND A.CNMV_CYC_NO = (SELECT MAX (CNMV_CYC_NO)
                          FROM CTM_BKG_CNTR BC, CTM_BOOKING BO
                         WHERE BC.CNTR_NO = @[cntr_no]
                           AND BC.BKG_NO = BO.BKG_NO
                           AND NVL (BO.BKG_STS_CD, '') <> 'X'
                           AND NVL (BO.BKG_STS_CD, '') <> 'S'
                           AND NVL (BO.BKG_STS_CD, '') <> DECODE (@[gate_io_cd], 'AE', 'A', 'UV', 'A', 'X')    /* 2008.12.16 */
						   AND BC.CNMV_CYC_NO <> 9998
                           AND (BC.CNMV_CYC_NO <> 9999 OR (BC.CNMV_CYC_NO = 9999 AND SYSDATE - BC.CRE_DT < 30)))
   AND A.BKG_NO = B.BKG_NO
   AND NVL (B.BKG_STS_CD, '') <> 'X'
   AND NVL (B.BKG_STS_CD, '') <> 'S'
   AND NVL (B.BKG_STS_CD, '') <> DECODE (@[gate_io_cd], 'AE', 'A', 'UV', 'A', 'X')    /* 2008.12.16 */
   AND ROWNUM = 1
ORDER BY CNMV_CYC_NO DESC )
WHERE ROWNUM=1			]]></sql>
			<params>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="gate_io_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
