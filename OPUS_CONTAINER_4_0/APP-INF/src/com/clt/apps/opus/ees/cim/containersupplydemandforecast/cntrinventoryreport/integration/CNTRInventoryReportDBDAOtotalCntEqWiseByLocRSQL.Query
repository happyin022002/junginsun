<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CNTRInventoryReportDBDAOtotalCntEqWiseByLocRSQL">
			<desc><![CDATA[Container List by Location 갯수]]></desc>
			<sql><![CDATA[
SELECT      COUNT(*) TOTAL_CNT 
        FROM
        (    
            SELECT
                DECODE(@[loc_type_code],'1',LCC_CD,'2',SCC_CD,'3',SCC_CD,'4',SCC_CD,'5',SCC_CD) SUB_LOC_CD
                ,A.CRNT_YD_CD
                ,A.CNTR_NO
                ,A.CNTR_TPSZ_CD
                ,A.LSTM_CD
                ,A.CNMV_STS_CD
                ,DECODE(A.FULL_FLG,'Y','F','M') FULL_FLG
                ,TO_CHAR(A.CNMV_DT,'YYYY-MM-DD') CNMV_DT
                ,CEIL(TO_DATE(@[rcc_date],'yyyy-MM-dd HH24:mi:SS') - A.CNMV_DT) STAY_DAYS
                ,A.BKG_NO
                ,B.BL_NO
                ,A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD VVD
                ,A.DMG_FLG
                ,A.CNTR_HNGR_RCK_CD
                ,A.MNR_HNGR_BAR_TP_CD
                ,A.CNTR_HNGR_BAR_ATCH_KNT
                ,A.DISP_FLG
                ,A.IMDT_EXT_FLG
                ,DECODE(A.UCLM_LS_DIV_CD,'U','Y','N') UCLM_LS_FLG
                ,A.PLST_FLR_FLG
                ,B.RCV_TERM_CD||'/'||B.DE_TERM_CD DE_TERM_CD
                ,(SELECT CID.INTG_CD_VAL_DP_DESC ||' (' ||CID.INTG_CD_VAL_DESC || ')' AS RF_TP_CD 
                   FROM COM_INTG_CD_DTL CID 
                  WHERE 1=1 
                    AND CID.INTG_CD_VAL_CTNT = A.RF_TP_CD 
                    AND CID.INTG_CD_ID   = 'CD01085') AS RF_TP_CD
                ,B.OB_SLS_OFC_CD
				,TO_CHAR(A.MFT_DT,'YYYY-MM-DD') MFT_DT
                ,A.VNDR_SEQ
                ,B.CMDT_CD
                #if (${over_stay_days} != '' &&  ${over_stay_days} != '0')
                    ,(SELECT  MAX(NVL(TO_CHAR(FT_END_DT,'YYYY-MM-DD'),'1111-11-11')||LTRIM(TO_CHAR(FT_DYS,'0000')))
                    FROM DMT_CHG_CALC E,DMT_CHG_BKG_CNTR F
                    WHERE E.CNTR_NO = A.CNTR_NO
                    AND E.SYS_AREA_GRP_ID  =  A.SYS_AREA_GRP_ID
                    AND E.CNTR_CYC_NO = A. CNMV_CYC_NO
                    AND E.CHG_SEQ = 1
                    AND E.FM_MVMT_YD_CD = A.CRNT_YD_CD
                    AND E.DMDT_CHG_STS_CD <> 'E'
                    AND F.CNTR_NO = E.CNTR_NO
                    AND F.SYS_AREA_GRP_ID  = E.SYS_AREA_GRP_ID
                    AND F.CNTR_CYC_NO = E.CNTR_CYC_NO
                    AND F.BKG_NO = A.BKG_NO
                    AND A.CNMV_STS_CD NOT IN ('TS','MT')
                    ) FT_END_DYS  
                #end
				--,MST_COMMON_PKG.MST_RU_LBL_GET_FNC(A.CNTR_NO) AS RSTR_USG_LBL_NM
				,MST_COMMON_PKG.MST_RU_TP_GET_FNC(A.CNTR_NO) AS RSTR_USG_LBL_TP
                ,MST_COMMON_PKG.MST_RU_VAL_GET_FNC(A.CNTR_NO) AS RSTR_USG_LBL_DESC 
				,(SELECT NVL(VNDR_ABBR_NM, VNDR_LGL_ENG_NM) 
                    FROM MDM_VENDOR 
                   WHERE VNDR_SEQ = CASE WHEN A.LSTM_CD='LT' OR A.LSTM_CD = 'ST' THEN A.RF_MKR_SEQ ELSE C.RF_MKR_SEQ END
                  )AS RF_MKR_SEQ
                ,CASE WHEN A.LSTM_CD='LT' OR A.LSTM_CD = 'ST' THEN A.RF_MDL_NM ELSE C.RF_MDL_NM END AS RF_MDL_NM
                ,A.RF_HUMID_CTRL_VAL_CD
				,MST_COMMON_PKG.MST_AGMT_NO_CONV_FNC(A.AGMT_CTY_CD, A.AGMT_SEQ) AS AGMT_NO
        		,MST_COMMON_PKG.MST_VNDR_SEQ_CONV_FNC(A.VNDR_SEQ) AS LESSOR_CD       		
            FROM MST_CONTAINER A,BKG_BOOKING B,MST_CNTR_LOT C, CTM_MOVEMENT D
            WHERE A.ACIAC_DIV_CD='A'
			AND   A.LOT_PLN_YR   = C.LOT_PLN_YR(+)
            AND   A.LOT_LOC_CD   = C.LOT_LOC_CD(+)
            AND   A.LOT_SEQ      = C.LOT_SEQ(+)
            AND   A.CNTR_TPSZ_CD = C.CNTR_TPSZ_CD(+)
            AND   A.BKG_NO       = B.BKG_NO(+)
			AND	  'Y'			 = C.OWN_CNTR_FLG(+)
			AND   A.CNTR_NO    = D.CNTR_NO(+)
            AND   A.CNMV_YR    = D.CNMV_YR(+)
            AND   A.CNMV_ID_NO = D.CNMV_ID_NO(+)
            #if (${loc_type_code} == '1')
                AND A.RCC_CD =@[loc_cd]
            #elseif (${loc_type_code} == '2')
                AND A.LCC_CD =@[loc_cd]
            #elseif (${loc_type_code} == '3')
                AND A.ECC_CD =@[loc_cd]
            #elseif (${loc_type_code} == '4')
                AND A.SCC_CD =@[loc_cd]
            #elseif (${loc_type_code} == '5')
                AND A.CRNT_YD_CD =@[loc_cd]
			#elseif (${loc_type_code} == '7')
				AND A.BKG_NO IN (
						#foreach ($key IN ${loccd_list})
		                	#if($velocityCount < $loccd_list.size())
		                    	'$key',
		                    #else
		                        '$key'
		                    #end
		                #end			  
		           )
			#elseif (${loc_type_code} == '8')
				 AND NVL(D.MTY_PLN_NO, D.MTY_REPO_NO) IN (
						#foreach ($key IN ${loccd_list})
		                	#if($velocityCount < $loccd_list.size())
		                    	'$key',
		                    #else
		                        '$key'
		                    #end
		                #end			  
		           )
			#elseif (${loc_type_code} == '9')
				AND A.CNTR_NO IN (
						#foreach ($key IN ${loccd_list})
		                	#if($velocityCount < $loccd_list.size())
		                    	'$key',
		                    #else
		                        '$key'
		                    #end
		                #end			  
		           )
            #end 
            
            #if (${full_flg} != '')
                AND A.FULL_FLG = @[full_flg]
            #end

            #if (${cntr_tpsz_cd} != '')
                AND A.CNTR_TPSZ_CD IN ( 
                                     SELECT COLUMN_VALUE
                                     FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[cntr_tpsz_cd] ) AS listItemType ) 
                                     FROM dual )
                                    )
            #end
            
            #if (${imdt_ext_flg} != '')
                AND A.IMDT_EXT_FLG =@[imdt_ext_flg]
            #end
            
            #if (${plst_flr_flg} != '')
                AND A.PLST_FLR_FLG =@[plst_flr_flg]
            #end
            
            #if (${dmg_flg} != '')
                AND A.DMG_FLG = @[dmg_flg]
            #end      
            
            #if (${cntr_no} != '')
                AND SUBSTR(A.CNTR_NO,0,4) = @[cntr_no]
            #end  
            
            
            #if (${rf_tp_cd_c} != '' || ${rf_tp_cd_h} != '' || ${rf_cntr} != '' || ${rd_cgo_flg} != '')
                AND A.CNTR_TPSZ_CD LIKE 'R%'
            #end  
            
            #if (${rf_tp_cd_c} != '' || ${rf_tp_cd_h} != '' || ${rf_tp_cd_m} != '')
                AND A.RF_TP_CD IN(@[rf_tp_cd_c],@[rf_tp_cd_h],@[rf_tp_cd_m])
            #end  
            
            #if (${rd_cgo_flg} != '' || ${rf_cntr} != '')
                AND B.RD_CGO_FLG IN(@[rf_cntr],@[rd_cgo_flg])
            #end          
            
            #if (${soc_cd} != '')
                #if (${soc_cd} == '1')
                    AND A.LSTM_CD <> 'SH'
                #else
                    AND A.LSTM_CD = 'SH'
                #end
            #end

            #if (${uclm_ls_div_cd} == 'E')
                AND NVL(A.UCLM_LS_DIV_CD,'X') <> 'U'
            #elseif(${uclm_ls_div_cd} == 'O')
                AND A.UCLM_LS_DIV_CD = 'U'
            #end

            #if (${cnmv_sts_cd} != '')
                AND A.CNMV_STS_CD IN ( 
                                     SELECT COLUMN_VALUE
                                     FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[cnmv_sts_cd] ) AS listItemType ) 
                                     FROM dual )
                                    )
                AND A.CNMV_STS_CD NOT IN('VL','XX','VD')
            #else
                AND A.CNMV_STS_CD NOT IN('VL','XX','VD')
            #end

            #if (${over_stay_days} != '')
                AND  CEIL(TO_DATE(@[rcc_date],'yyyy-MM-dd HH24:mi:SS') - CNMV_DT) >= @[over_stay_days]
            #end

            #if (${lstm_cd} != '')
                AND A.LSTM_CD IN ( 
                                     SELECT COLUMN_VALUE
                                     FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[lstm_cd] ) AS listItemType ) 
                                     FROM dual )
                                    )
            #end
            
            #if (${cntr_hngr_rck_cd} != '')
                AND (A.CNTR_HNGR_RCK_CD IS NOT NULL  OR  A.CNTR_HNGR_BAR_ATCH_KNT > 0)
            #end


            #if (${disp_flg} != '')
                AND A.DISP_FLG = @[disp_flg]
            #end
            #if (${d2_payld_flg} != '')
                AND A.CNTR_TPSZ_CD='D2'
                AND A.D2_PAYLD_FLG = @[d2_payld_flg]
            #end	
            #if (${view_flg} == 'eq') 
                #if (${froms} != '') 
                    AND TO_CHAR(A.MFT_DT,'YYYY') BETWEEN @[froms] AND @[tos]
                #end
            #end
            
			#if (${rstr_usg_lbl} != '')
				AND	
				(
				A.RSTR_USG_TP_LBL_NM1 IN (
						#foreach ($key IN ${labelvalue_list})
		                	#if($velocityCount < $labelvalue_list.size())
		                    	'$key',
		                    #else
		                        '$key'
		                    #end
		                #end			  
		           )
				OR
				A.RSTR_USG_TP_LBL_NM2 IN (
						#foreach ($key IN ${labelvalue_list})
		                	#if($velocityCount < $labelvalue_list.size())
		                    	'$key',
		                    #else
		                        '$key'
		                    #end
		                #end			  
		           )
				OR
				A.RSTR_USG_TP_LBL_NM3 IN (
						#foreach ($key IN ${labelvalue_list})
		                	#if($velocityCount < $labelvalue_list.size())
		                    	'$key',
		                    #else
		                        '$key'
		                    #end
		                #end			  
		           )
				OR
				A.RSTR_USG_TP_LBL_NM4 IN (
						#foreach ($key IN ${labelvalue_list})
		                	#if($velocityCount < $labelvalue_list.size())
		                    	'$key',
		                    #else
		                        '$key'
		                    #end
		                #end			  
		           )
				OR
				A.RSTR_USG_TP_LBL_NM5 IN (
						#foreach ($key IN ${labelvalue_list})
		                	#if($velocityCount < $labelvalue_list.size())
		                    	'$key',
		                    #else
		                        '$key'
		                    #end
		                #end			  
		           )
				OR
				A.RSTR_USG_TP_LBL_NM6 IN (
						#foreach ($key IN ${labelvalue_list})
		                	#if($velocityCount < $labelvalue_list.size())
		                    	'$key',
		                    #else
		                        '$key'
		                    #end
		                #end			  
		           )
				OR
				A.RSTR_USG_TP_LBL_NM7 IN (
						#foreach ($key IN ${labelvalue_list})
		                	#if($velocityCount < $labelvalue_list.size())
		                    	'$key',
		                    #else
		                        '$key'
		                    #end
		                #end			  
		           )
				OR
				A.RSTR_USG_TP_LBL_NM8 IN (
						#foreach ($key IN ${labelvalue_list})
		                	#if($velocityCount < $labelvalue_list.size())
		                    	'$key',
		                    #else
		                        '$key'
		                    #end
		                #end			  
		           )
				OR
				A.RSTR_USG_TP_LBL_NM9 IN (
						#foreach ($key IN ${labelvalue_list})
		                	#if($velocityCount < $labelvalue_list.size())
		                    	'$key',
		                    #else
		                        '$key'
		                    #end
		                #end			  
		           )
				OR
				A.RSTR_USG_TP_LBL_NM10 IN (
						#foreach ($key IN ${labelvalue_list})
		                	#if($velocityCount < $labelvalue_list.size())
		                    	'$key',
		                    #else
		                        '$key'
		                    #end
		                #end			  
		           )
				OR
				A.RSTR_USG_TP_LBL_NM11 IN (
						#foreach ($key IN ${labelvalue_list})
		                	#if($velocityCount < $labelvalue_list.size())
		                    	'$key',
		                    #else
		                        '$key'
		                    #end
		                #end			  
		           )
				)
			#end
            
        ) A
        #if (${view_customer} == 'Y')
        ,BKG_CUSTOMER B, BKG_CUSTOMER C, BKG_CUSTOMER D
        WHERE A.BKG_NO =B.BKG_NO(+)
        AND  A.BKG_NO =C.BKG_NO(+)
        AND  A.BKG_NO =D.BKG_NO(+)
        AND B.BKG_CUST_TP_CD(+) ='S'
        AND C.BKG_CUST_TP_CD(+) ='C'
        AND D.BKG_CUST_TP_CD(+) ='N'
        #end			]]></sql>
			<params>
				<param name="loc_type_code" type="12" value="" out="N"/>
				<param name="rcc_date" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="full_flg" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="imdt_ext_flg" type="12" value="" out="N"/>
				<param name="plst_flr_flg" type="12" value="" out="N"/>
				<param name="dmg_flg" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="rf_tp_cd_c" type="12" value="" out="N"/>
				<param name="rf_tp_cd_h" type="12" value="" out="N"/>
				<param name="rf_tp_cd_m" type="12" value="" out="N"/>
				<param name="rf_cntr" type="12" value="" out="N"/>
				<param name="rd_cgo_flg" type="12" value="" out="N"/>
				<param name="cnmv_sts_cd" type="12" value="" out="N"/>
				<param name="over_stay_days" type="12" value="" out="N"/>
				<param name="lstm_cd" type="12" value="" out="N"/>
				<param name="disp_flg" type="12" value="" out="N"/>
				<param name="d2_payld_flg" type="12" value="" out="N"/>
				<param name="froms" type="12" value="" out="N"/>
				<param name="tos" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
