<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CntrRepoExecutionPlanEstablishDBDAOSearchUnitCostLCCRSQL">
			<desc><![CDATA[UNIT COST 정보를 취득합니다.]]></desc>
			<sql><![CDATA[
-- ---------------------- LCC LEVEL SEARCH(EQR_LCC_ADD_PLN_COST -------------------------
-- CntrRepoExecutionPlanEstablishDBDAOSearchUnitCostCheckRSQL = 0 인 경우 
SELECT 
    NVL(MAX(DECODE(SUB_MOD, 'F', PLN_UC_AMT)),0) FM_COST											
    ,NVL(MAX(DECODE(SUB_MOD, 'T', PLN_UC_AMT)),0) TO_COST												
    ,NVL(SUM(PLN_UC_AMT),0) UC_COST   																
FROM 												  													
    (  																									
    
    #if(${trsp_mod_cd} == 'V') 
		SELECT 
			PLN_UC_AMT
			, TRSP_SUB_MOD_CD SUB_MOD																
		FROM 
			EQR_LCC_ADD_PLN_COST																			
    
    	#if(${division} == 'P')  -- plan
			WHERE 
				FM_LCC_CD = (
								SELECT 
									DISTINCT LCC_CD 
								FROM 
									MDM_EQ_ORZ_CHT 
								WHERE 
									ECC_CD = @[fm_ecc]
				)              	
    	#else   -- execute 혹은 internal (E, I)
			WHERE 
				FM_LCC_CD = (
								SELECT 
									DISTINCT LCC_CD 
								FROM 
									MDM_EQ_ORZ_CHT 
								WHERE 
									SCC_CD = SUBSTR(@[fm_ecc], 0, 5)
				)  
    	#end
    	    AND   TRSP_MOD_CD = @[trsp_mod_cd]																				
    	    AND   CNTR_TPSZ_CD= @[cntr_tpsz_cd]																				
    	    AND   TRSP_SUB_MOD_CD = 'F'																		
    	
	UNION ALL																								
    	    
		SELECT 
			PLN_UC_AMT
			, TRSP_SUB_MOD_CD SUB_MOD																
		FROM 
			EQR_LCC_ADD_PLN_COST																			
    
    	#if(${division} == 'P')  -- plan
			WHERE 
				TO_LCC_CD = (
							SELECT 
								DISTINCT LCC_CD 
							FROM 
								MDM_EQ_ORZ_CHT 
							WHERE ECC_CD = @[to_ecc]
				)  				
    	#else   -- execute 혹은 internal (E, I)
			WHERE 
				TO_LCC_CD = (
							SELECT 
								DISTINCT LCC_CD 
							FROM 
								MDM_EQ_ORZ_CHT 
							WHERE 
								SCC_CD = SUBSTR( @[to_ecc] , 0, 5)
				) 	
    	#end
    	    AND   TRSP_MOD_CD = @[trsp_mod_cd]																				
    	    AND   CNTR_TPSZ_CD= @[cntr_tpsz_cd]																						
    	    AND   TRSP_SUB_MOD_CD = 'T'																		
    
    #else 
    	    SELECT 
				PLN_UC_AMT
				, TRSP_SUB_MOD_CD SUB_MOD																
    	    FROM 
				EQR_LCC_ADD_PLN_COST																			
    
    	#if(${division} == 'P')  -- plan
			WHERE 
				FM_LCC_CD = (
							SELECT 
								DISTINCT LCC_CD 
							FROM 
								MDM_EQ_ORZ_CHT 
							WHERE 
								ECC_CD = @[fm_ecc]
				)              	
    		    AND TO_LCC_CD = (
								SELECT 
									DISTINCT LCC_CD 
								FROM 
									MDM_EQ_ORZ_CHT 
								WHERE ECC_CD = @[to_ecc]
				)  				
    	#else   -- execute 혹은 internal (E, I)
			WHERE 
				FM_LCC_CD = (
							SELECT 
								DISTINCT LCC_CD 
							FROM 
								MDM_EQ_ORZ_CHT 
							WHERE 
								SCC_CD = SUBSTR( @[fm_ecc] , 0, 5)
				)  
    		    AND TO_LCC_CD = (
								SELECT 
									DISTINCT LCC_CD 
								FROM 
									MDM_EQ_ORZ_CHT 
								WHERE 
									SCC_CD = SUBSTR( @[to_ecc] , 0, 5)
				) 	
    	#end
    	    AND   TRSP_MOD_CD = @[trsp_mod_cd]																				
    	    AND   CNTR_TPSZ_CD= @[cntr_tpsz_cd]																				
    	-- ECC INTERNAL
    	#if(${division} == 'I')
			AND   TRSP_SUB_MOD_CD = 'I'
		#end												
    #end
    )			]]></sql>
			<params>
				<param name="fm_ecc" type="12" value="" out="N"/>
				<param name="trsp_mod_cd" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="to_ecc" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
