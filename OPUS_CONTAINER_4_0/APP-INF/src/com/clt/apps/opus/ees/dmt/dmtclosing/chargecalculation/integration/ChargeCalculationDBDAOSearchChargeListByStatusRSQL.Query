<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChargeCalculationDBDAOSearchChargeListByStatusRSQL">
			<desc><![CDATA[ChargeCalculationDBDAOChargeCalculationContainerVORSQL]]></desc>
			<sql><![CDATA[
SELECT
	 C.SYS_AREA_GRP_ID AS SVR_ID
    ,C.DMDT_CHG_STS_CD
    ,C.CNTR_NO    
    ,B.CNTR_TPSZ_CD
	,C.OFC_CD
    ,C.FM_MVMT_YD_CD
    ,C.TO_MVMT_YD_CD
    ,C.FM_MVMT_STS_CD
    ,C.TO_MVMT_STS_CD
    ,C.DMDT_TRF_CD
    ,C.FT_DYS
    ,C.FX_FT_OVR_DYS
    ,TO_CHAR(C.FM_MVMT_DT, 'yyyymmdd') FM_MVMT_DT
    ,TO_CHAR(C.TO_MVMT_DT, 'yyyymmdd') TO_MVMT_DT	
	,(
		SELECT TO_CHAR(CM.CNMV_EVNT_DT, 'YYYYMMDD')
		FROM CTM_MOVEMENT CM
		WHERE CM.CNTR_NO	= C.CNTR_NO
		AND CM.CNMV_CYC_NO	= C.CNTR_CYC_NO
		AND CM.MVMT_STS_CD	= 'MT'
		AND ROWNUM			= 1
	) AS MT_DT
    ,TO_CHAR(C.FT_CMNC_DT, 'yyyymmdd') FT_CMNC_DT
    ,TO_CHAR(C.FT_END_DT, 'yyyymmdd') FT_END_DT
    ,C.BZC_TRF_CURR_CD
    ,C.ORG_CHG_AMT
    ,C.SC_RFA_EXPT_AMT    
    ,C.AFT_EXPT_DC_AMT
    ,C.BIL_AMT
    ,B.BKG_NO
    ,B.BL_NO
    ,B.VSL_CD || B.SKD_VOY_NO || B.SKD_DIR_CD AS VVD_CD    
	,(	SELECT	V.VSL_SLAN_CD LANE
    	FROM	VSK_VSL_SKD V
    	WHERE	B.VSL_CD		=	V.VSL_CD 
    	AND		B.SKD_VOY_NO	=	V.SKD_VOY_NO 
    	AND		B.SKD_DIR_CD	=	V.SKD_DIR_CD 
 	) AS LANE
    ,B.POR_CD
    ,B.POL_CD
    ,B.POD_CD
    ,B.DEL_CD
    ,B.BKG_RCV_TERM_CD
    ,B.BKG_DE_TERM_CD
    ,B.SC_NO
    ,B.RFA_NO
    ,DECODE( BK.AGMT_ACT_CNT_CD||TRIM(TO_CHAR(BK.AGMT_ACT_CUST_SEQ, '000000')),'000000', NULL
        	,BK.AGMT_ACT_CNT_CD||TRIM(TO_CHAR(BK.AGMT_ACT_CUST_SEQ, '000000')) ) AS ACUST	
    ,DECODE(C.CHG_SEQ, 1, 'G', 'B') AS CHG_TYPE
	,C.CHG_SEQ
    ,NVL(B.SOC_FLG, 'N') AS SOC_FLG
    ,CASE
        WHEN C.DMDT_TRF_CD='DMIF' AND C.TO_MVMT_STS_CD='ID' THEN 'L'
        WHEN C.DMDT_TRF_CD='DMIF' AND C.TO_MVMT_STS_CD NOT IN ('ID','CS','DR') THEN 'I'
        WHEN C.DMDT_TRF_CD='DMOF' AND C.DMDT_CHG_LOC_DIV_CD<>'POL' THEN 'L'
        WHEN C.DMDT_TRF_CD='DMOF' AND C.DMDT_CHG_LOC_DIV_CD='POL' THEN 'I'
     END AS LI
	,(	SELECT NVL(HLG_TP_CD, 'N')
		FROM	BKG_EUR_TRO
		WHERE	BKG_NO				= B.BKG_NO
			AND	IO_BND_CD			= SUBSTR(C.DMDT_TRF_CD, 3, 1)
			AND	NVL(CXL_FLG, 'N')	= 'N'
			AND	CNTR_NO	= C.CNTR_NO
			AND ROWNUM = 1 ) AS CH
	,(	SELECT 'Y'
    	FROM DUAL      
    	WHERE EXISTS (
    		SELECT  BDD.RLSE_STS_CD
    		FROM    BKG_DO     BDO,
            		BKG_DO_DTL BDD
    		WHERE BDO.BKG_NO        = BDD.BKG_NO
   			AND   BDO.BKG_NO        = B.BKG_NO
    			AND   BDD.RLSE_STS_CD IN ('R', 'I')) ) AS D_O
	,(	SELECT  BDD.EVNT_OFC_CD
    	FROM    BKG_DO     BDO,
        	    BKG_DO_DTL BDD
    	WHERE	BDO.BKG_NO	= BDD.BKG_NO   
    		AND BDO.BKG_NO	= B.BKG_NO   
    		AND BDD.RLSE_STS_CD IN ('R', 'I')
			AND	ROWNUM=1 ) AS RLSE_OFC
	,BR.CLT_OFC_CD
	,NVL(C.OFC_TRNS_FLG, 'N') AS OFC_TRNS_FLG
	,(	SELECT 'S'
		FROM DUAL
    	WHERE EXISTS (
    		SELECT 1
    		FROM	BKG_ROLL_OVR R
    		WHERE	R.BKG_NO = B.BKG_NO    			
    			AND R.ROLL_OVR_RSN_CD = 'S') ) AS ROLL_OVR	
    ,C.WEB_IND_FLG
    ,C.CNTR_CYC_NO
    ,C.DMDT_CHG_LOC_DIV_CD
	,C.CORR_RMK
	,C.DMDT_INV_NO
	--,TO_CHAR(IM.CRE_DT, 'yyyymmdd') ISS_DT
	--,IM.INV_CURR_CD
	--,IM.INV_CHG_AMT
	--,IM.DMDT_AR_IF_CD
	,(	
		SELECT	TO_CHAR(IM.CRE_DT, 'YYYYMMDD')
		FROM	DMT_INV_MN  IM,
				DMT_INV_DTL ID
		WHERE   IM.BKG_NO       = B.BKG_NO
		AND	IM.DMDT_INV_NO      = ID.DMDT_INV_NO
		AND	IM.CRE_OFC_CD       = ID.CRE_OFC_CD
		AND IM.DMDT_INV_STS_CD  = 'I'
		AND C.SYS_AREA_GRP_ID = ID.SYS_AREA_GRP_ID
		AND C.CNTR_NO 		= ID.CNTR_NO
		AND C.CNTR_CYC_NO 	= ID.CNTR_CYC_NO
		AND C.DMDT_TRF_CD 	= ID.DMDT_TRF_CD
		AND C.DMDT_CHG_LOC_DIV_CD = ID.DMDT_CHG_LOC_DIV_CD
		AND C.CHG_SEQ = ID.CHG_SEQ 
		AND ROWNUM = 1
	) AS ISS_DT
	,(
		SELECT	IM.INV_CURR_CD
		FROM    DMT_INV_MN  IM,
				DMT_INV_DTL ID
		WHERE   IM.BKG_NO       = B.BKG_NO
		AND IM.DMDT_INV_NO      = ID.DMDT_INV_NO
		AND IM.CRE_OFC_CD       = ID.CRE_OFC_CD
		AND IM.DMDT_INV_STS_CD  = 'I'
		AND C.SYS_AREA_GRP_ID = ID.SYS_AREA_GRP_ID
		AND C.CNTR_NO 		= ID.CNTR_NO
		AND C.CNTR_CYC_NO 	= ID.CNTR_CYC_NO
		AND C.DMDT_TRF_CD 	= ID.DMDT_TRF_CD
		AND C.DMDT_CHG_LOC_DIV_CD = ID.DMDT_CHG_LOC_DIV_CD
		AND C.CHG_SEQ = ID.CHG_SEQ
		AND ROWNUM = 1
	) AS INV_CURR_CD
	,(
		SELECT	ID.CNTR_INV_AMT
		FROM    DMT_INV_MN  IM,
				DMT_INV_DTL ID
		WHERE   IM.BKG_NO       = B.BKG_NO
		AND IM.DMDT_INV_NO      = ID.DMDT_INV_NO
		AND IM.CRE_OFC_CD       = ID.CRE_OFC_CD
		AND IM.DMDT_INV_STS_CD  = 'I'
		AND C.SYS_AREA_GRP_ID = ID.SYS_AREA_GRP_ID
		AND C.CNTR_NO 		= ID.CNTR_NO
		AND C.CNTR_CYC_NO 	= ID.CNTR_CYC_NO
		AND C.DMDT_TRF_CD 	= ID.DMDT_TRF_CD
		AND C.DMDT_CHG_LOC_DIV_CD = ID.DMDT_CHG_LOC_DIV_CD
		AND C.CHG_SEQ = ID.CHG_SEQ
		AND ROWNUM = 1
    ) AS INV_CHG_AMT
	,(	
		SELECT	IM.DMDT_AR_IF_CD
		FROM	DMT_INV_MN  IM,
				DMT_INV_DTL ID
		WHERE   IM.BKG_NO       = B.BKG_NO
		AND	IM.DMDT_INV_NO      = ID.DMDT_INV_NO
		AND	IM.CRE_OFC_CD       = ID.CRE_OFC_CD
		AND IM.DMDT_INV_STS_CD  = 'I'
		AND C.SYS_AREA_GRP_ID = ID.SYS_AREA_GRP_ID
		AND C.CNTR_NO 		= ID.CNTR_NO
		AND C.CNTR_CYC_NO 	= ID.CNTR_CYC_NO
		AND C.DMDT_TRF_CD 	= ID.DMDT_TRF_CD
		AND C.DMDT_CHG_LOC_DIV_CD = ID.DMDT_CHG_LOC_DIV_CD
		AND C.CHG_SEQ = ID.CHG_SEQ 
		AND ROWNUM = 1
	) AS DMDT_AR_IF_CD

	,C.WEB_IND_FLG
	,DECODE(C.WEB_IND_FLG, 'Y', TO_CHAR(NVL(C.WEB_MTY_DT, C.TO_MVMT_DT), 'YYYY-MM-DD'), TO_CHAR(C.WEB_MTY_DT, 'YYYY-MM-DD')) AS WEB_CRE_DT
	,DECODE(C.WEB_IND_FLG, 'Y', TO_CHAR(NVL(C.WEB_MTY_DT, C.TO_MVMT_DT) + 7, 'YYYY-MM-DD'), TO_CHAR(C.WEB_MTY_DT + 7, 'YYYY-MM-DD')) AS WEB_MTY_DT
	,C.WEB_NTFY_PIC_NM
	,DECODE( DECODE(C.ACT_CNT_CD,'00','',C.ACT_CNT_CD) || TO_CHAR(C.ACT_CUST_SEQ, 'FM000000')
			,'000000' , NULL, DECODE(C.ACT_CNT_CD,'00','',C.ACT_CNT_CD) || TO_CHAR(C.ACT_CUST_SEQ, 'FM000000')) PAYER_CD
	,CASE		
		WHEN C.DMDT_TRF_CD='DTIC' 
			AND INSTR(NVL(B.POD_CD,'  '),'US')=1 THEN 
			(	SELECT MV.VNDR_LGL_ENG_NM
				FROM MDM_VENDOR MV
				WHERE MV.VNDR_SEQ = C.VNDR_SEQ	)		
		WHEN C.DMDT_TRF_CD='DTOC' 
			AND INSTR(NVL(B.POL_CD,'  '),'US')=1 THEN 
			(	SELECT MV.VNDR_LGL_ENG_NM
				FROM MDM_VENDOR MV
				WHERE MV.VNDR_SEQ = C.VNDR_SEQ	)
		WHEN C.DMDT_TRF_CD IN ('DMIF','CTIC') OR (C.DMDT_TRF_CD='DTIC' AND INSTR(NVL(B.POD_CD,'  '),'US')<>1) THEN
			(	SELECT MC.CUST_LGL_ENG_NM
				FROM MDM_CUSTOMER MC
				WHERE MC.CUST_CNT_CD = C.ACT_CNT_CD
				AND MC.CUST_SEQ = C.ACT_CUST_SEQ	)
		WHEN C.DMDT_TRF_CD IN ('DMOF','CTOC') OR (C.DMDT_TRF_CD='DTOC' AND INSTR(NVL(B.POL_CD,'  '),'US')<>1) THEN
			REPLACE(BS.CUST_NM, CHR(13)||CHR(10),' ')
	END AS PAYER_NM
    ,BS.CUST_CNT_CD || TRIM(TO_CHAR(BS.CUST_SEQ, '000000')) SHIPPER_CD 
    ,REPLACE(BS.CUST_NM, CHR(13) || CHR(10), ' ') SHIPPER_NM   
    ,DECODE(BC.CUST_CNT_CD || TRIM(TO_CHAR(BC.CUST_SEQ, '000000')), '000000', NULL, BC.CUST_CNT_CD || TRIM(TO_CHAR(BC.CUST_SEQ, '000000'))) CNEE_CD
    ,REPLACE(BC.CUST_NM, CHR(13) || CHR(10), ' ') CNEE_NM
    ,DECODE(BN.CUST_CNT_CD || TRIM(TO_CHAR(BN.CUST_SEQ, '000000')), '000000', NULL, BN.CUST_CNT_CD || TRIM(TO_CHAR(BN.CUST_SEQ, '000000'))) NTFY_CD
    ,NVL(RTRIM(REPLACE(REPLACE(BN.CUST_NM, CHR(34), ''), CHR(13)||CHR(10), ' ')), '-') NTFY_NM
	,(	SELECT  I.ACT_CUST_CNT_CD || TO_CHAR(I.ACT_CUST_SEQ, 'FM000000')
    	FROM    INV_AR_MN I
    	WHERE   I.BKG_NO = B.BKG_NO
    	AND     I.IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
		AND		AR_IF_NO	= (
                    SELECT	MAX(AR_IF_NO) 
                    FROM	INV_AR_MN
                    WHERE	BKG_NO = B.BKG_NO
                    AND		IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
    	            )
		AND     ROWNUM  = 1
	) AS AR_ACT_CD
	,(	SELECT	MC.CUST_LGL_ENG_NM
		FROM 	MDM_CUSTOMER MC, INV_AR_MN I
		WHERE	MC.CUST_CNT_CD = I.ACT_CUST_CNT_CD
		AND		MC.CUST_SEQ    = I.ACT_CUST_SEQ
		AND		I.BKG_NO = B.BKG_NO
		AND		I.IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
		AND		AR_IF_NO	= (
                    SELECT	MAX(AR_IF_NO) 
                    FROM	INV_AR_MN
                    WHERE	BKG_NO = B.BKG_NO
                    AND		IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
    	            )
		AND		ROWNUM  = 1
	) AS AR_ACT_NM
	,DECODE(TRIM(TO_CHAR(C.VNDR_SEQ, '000000')), '000000', NULL, TRIM(TO_CHAR(C.VNDR_SEQ, '000000'))) AS SVC_PROVDR_CD	
	,(	SELECT MV.VNDR_LGL_ENG_NM
		FROM MDM_VENDOR MV
		WHERE MV.VNDR_SEQ = C.VNDR_SEQ
	) AS SVC_PROVDR_NM
   ,(SELECT CUST_LGL_ENG_NM FROM MDM_CUSTOMER WHERE CUST_CNT_CD = BK.CTRT_CUST_CNT_CD AND CUST_SEQ = BK.CTRT_CUST_SEQ) CTRT_CUST_NM
   ,DECODE( DECODE(BK.CTRT_CUST_CNT_CD,'00','',BK.CTRT_CUST_CNT_CD) || TO_CHAR(BK.CTRT_CUST_SEQ, 'FM000000')
			,'000000' , NULL, DECODE(BK.CTRT_CUST_CNT_CD,'00','',BK.CTRT_CUST_CNT_CD) || TO_CHAR(BK.CTRT_CUST_SEQ, 'FM000000')) AS CTRT_CUST_CD
   ,(SELECT SREP_NM FROM MDM_SLS_REP WHERE  SREP_CD =  BK.CTRT_SREP_CD) AS CTRT_SREP_CD
   ,BK.CTRT_OFC_CD
   ,(SELECT SREP_NM FROM MDM_SLS_REP WHERE  SREP_CD =  BK.OB_SREP_CD) AS OB_SREP_CD
   ,BK.OB_SLS_OFC_CD
   ,(
        SELECT SREP_NM
        FROM SAM_CUST_SLS_REP_INFO  SCS, MDM_SLS_REP MS
        WHERE SCS.DELT_FLG='N' AND SREP_PRMRY_FLG = 'Y'
        AND SCS.CUST_CNT_CD = BC.CUST_CNT_CD
        AND SCS.CUST_SEQ = BC.CUST_SEQ
        AND SCS.SREP_CD = MS.SREP_CD
	) AS IB_SREP_CD
   ,(
		SELECT  OFC_CD
	    FROM    MDM_SLS_REP MS
    	WHERE   MS.SREP_CD = (
        				SELECT SREP_CD
				        FROM SAM_CUST_SLS_REP_INFO
				        WHERE DELT_FLG='N' AND SREP_PRMRY_FLG = 'Y'
				        AND CUST_CNT_CD = BC.CUST_CNT_CD
				        AND CUST_SEQ = BC.CUST_SEQ
			        )
    ) AS IB_SLS_OFC_CD
   ,BK.SVC_SCP_CD
FROM    DMT_CHG_BKG_CNTR    B
        ,DMT_CHG_CALC       C        
		,BKG_BOOKING        BK
		,BKG_RATE           BR	
        ,BKG_CUSTOMER       BS
        ,BKG_CUSTOMER       BC
        ,BKG_CUSTOMER       BN
WHERE  B.SYS_AREA_GRP_ID    =   C.SYS_AREA_GRP_ID
AND    B.CNTR_NO            =   C.CNTR_NO
AND    B.CNTR_CYC_NO        =   C.CNTR_CYC_NO
AND    B.BKG_NO             =   BK.BKG_NO
AND    B.BKG_NO				=	BR.BKG_NO(+)
AND    C.OFC_CD             IN (
			#foreach( $ofc_cd in ${ofc_cd_list} )
				#if($velocityCount < $ofc_cd_list.size()) '$ofc_cd', #else '$ofc_cd' #end
			#end
			)
AND    C.DMDT_TRF_CD        IN (
			#foreach( $trf_cd in ${trf_cd_list} )
				#if($velocityCount < $trf_cd_list.size()) '$trf_cd', #else '$trf_cd' #end
			#end
			)

AND NOT (C.DUL_TP_EXPT_FLG  = 'Y' AND SUBSTR(C.DMDT_TRF_CD, 1, 1) = 'D')
AND C.DMDT_CHG_LOC_DIV_CD	<> 'SZP'

#if (${cs} == 'Y' || ${web_mt} == 'Y')
AND		C.SYS_AREA_GRP_ID = 'USA'

	#if (${cs} == 'Y')
	AND		C.TO_MVMT_STS_CD = 'CS'
	#end

	#if (${web_mt} == 'Y') 
	AND		C.WEB_IND_FLG = 'Y'
	#end
#end

AND    B.BKG_NO				=	BS.BKG_NO(+)
AND    BS.BKG_CUST_TP_CD(+) =   'S'
AND    B.BKG_NO             =   BC.BKG_NO(+)
AND    BC.BKG_CUST_TP_CD(+) =   'C'
AND    B.BKG_NO            	=   BN.BKG_NO(+)
AND    BN.BKG_CUST_TP_CD(+) =   'N'


#if (${cond_type} != 'date')
AND		C.DMDT_CHG_STS_CD IN (
			#foreach( $chg_sts_cd in ${chg_sts_cd_list} )
				#if($velocityCount < $chg_sts_cd_list.size()) '$chg_sts_cd', #else '$chg_sts_cd' #end
			#end
		)
#else
	AND (1=0
		
		#if($chg_sts_cd_list1.size() > 0)
			OR (
				C.DMDT_CHG_STS_CD IN (
					#foreach( $chg_sts_cd in ${chg_sts_cd_list1} )
						#if($velocityCount < $chg_sts_cd_list1.size()) '$chg_sts_cd', #else '$chg_sts_cd' #end
					#end
				)
				AND ( C.TO_MVMT_DT BETWEEN TO_DATE(@[fm_mvmt_dt], 'YYYYMMDD') 
		            				   AND TO_DATE(@[to_mvmt_dt], 'YYYYMMDD') + 0.99999 )
			)
		#end
		
		#if($chg_sts_cd_list2.size() > 0)
			OR (
				C.DMDT_CHG_STS_CD IN (
					#foreach( $chg_sts_cd in ${chg_sts_cd_list2} )
						#if($velocityCount < $chg_sts_cd_list2.size()) '$chg_sts_cd', #else '$chg_sts_cd' #end
					#end
				)
				AND ( C.FM_MVMT_DT BETWEEN TO_DATE(@[fm_mvmt_dt], 'YYYYMMDD') 
		            				   AND TO_DATE(@[to_mvmt_dt], 'YYYYMMDD') + 0.99999 )
			)
		#end
		
		#if (${all_long_stay_flg} == 'Y')
			OR C.DMDT_CHG_STS_CD = 'L'
		#end
	)
#end


#if (${chg_type} == 'G') 
AND C.CHG_SEQ = 1
#elseif (${chg_type} == 'B') 
AND C.CHG_SEQ > 1
#end

#if (${fx_ft_ovr_dys} != '0') 
AND C.FX_FT_OVR_DYS >= TO_NUMBER(@[fx_ft_ovr_dys])
#end

#if (${cond_type} == 'date')
	#if (${fm_mvmt_yd_cd} != '')
		#if ($fm_mvmt_yd_cd.length() == 5)
			AND SUBSTR(C.FM_MVMT_YD_CD, 1, 5) = @[fm_mvmt_yd_cd]
		#else
			AND C.FM_MVMT_YD_CD = @[fm_mvmt_yd_cd]
		#end
	#elseif (${to_mvmt_yd_cd} != '')
		#if ($to_mvmt_yd_cd.length() == 5)
			AND SUBSTR(C.TO_MVMT_YD_CD,1, 5) = @[to_mvmt_yd_cd]
		#else
			AND C.TO_MVMT_YD_CD = @[to_mvmt_yd_cd]
		#end
	#end
#end

#if (${cond_type} == 'vvd_cd')
	#if (${vvd_cd} != '')
	AND (	B.VSL_CD = SUBSTR(@[vvd_cd],1,4) 
		AND B.SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4) 
		AND B.SKD_DIR_CD = SUBSTR(@[vvd_cd],9) 
		)
	#end
	
	#if (${pod_cd} != '' || ${pol_cd} != '')
	AND (1=0
		#if (${pod_cd} != '')
		OR B.POD_CD = @[pod_cd]
		#end
		#if (${pol_cd} != '')
		OR B.POL_CD = @[pol_cd]
		#end
	)
	#end

	#if (${dem_type} == 'I') 
	AND ((C.DMDT_TRF_CD='DMIF' AND C.TO_MVMT_STS_CD NOT IN ('ID','CS','DR'))
		OR (C.DMDT_TRF_CD='DMOF' AND C.DMDT_CHG_LOC_DIV_CD='POL')
		OR (C.DMDT_TRF_CD IN ('CTOC','CTIC','DTOC','DTIC'))
		)
	#elseif (${dem_type} == 'L') 
	AND ((C.DMDT_TRF_CD='DMIF' AND C.TO_MVMT_STS_CD='ID')
		OR (C.DMDT_TRF_CD='DMOF' AND C.DMDT_CHG_LOC_DIV_CD<>'POL')
		OR (C.DMDT_TRF_CD IN ('CTOC','CTIC','DTOC','DTIC'))
		)
	#end
#end

#if (${cond_type} == 'cntr')
	#if (${bkg_no} != '')	
	AND B.BKG_NO IN (
		#foreach( $bkg_cd in ${bkg_no_list} )
			#if($velocityCount < $bkg_no_list.size()) '$bkg_cd', #else '$bkg_cd' #end
		#end
		)
	#end

	#if (${bl_no} != '')
	AND B.BL_NO IN (
		#foreach( $bl_cd in ${bl_no_list} )
			#if($velocityCount < $bl_no_list.size()) '$bl_cd', #else '$bl_cd' #end
		#end
		)
	#end

	#if (${cntr_no} != '')
	AND C.CNTR_NO IN (
		#foreach( $cntr_cd in ${cntr_no_list} )
			#if($velocityCount < $cntr_no_list.size()) '$cntr_cd', #else '$cntr_cd' #end
		#end
		)
	#end
#end

#if (${cust_cd} != '')
	#if (${cust_type} == '')
	AND (
				C.ACT_CNT_CD	= SUBSTR(@[cust_cd],1,2)
			AND C.ACT_CUST_SEQ	= LTRIM(SUBSTR(@[cust_cd],3),'0')
		OR		BS.CUST_CNT_CD	= SUBSTR(@[cust_cd],1,2)
			AND BS.CUST_SEQ		= LTRIM(SUBSTR(@[cust_cd],3),'0')
		OR		BC.CUST_CNT_CD	= SUBSTR(@[cust_cd],1,2)
			AND BC.CUST_SEQ		= LTRIM(SUBSTR(@[cust_cd],3),'0')
		OR 		BN.CUST_CNT_CD	= SUBSTR(@[cust_cd],1,2)
			AND BN.CUST_SEQ		= LTRIM(SUBSTR(@[cust_cd],3),'0')
		OR(
			EXISTS (
    		SELECT  'X'
    		FROM    INV_AR_MN I
    		WHERE   I.BKG_NO	= B.BKG_NO
    		AND     I.IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
			AND		AR_IF_NO	= (
                    				SELECT	MAX(AR_IF_NO) 
                    				FROM	INV_AR_MN
                    				WHERE	BKG_NO = B.BKG_NO
                    				AND		IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
								  )
			AND     ROWNUM  = 1
			AND     I.ACT_CUST_CNT_CD   = SUBSTR(@[cust_cd],1,2)
			AND     I.ACT_CUST_SEQ      = LTRIM(SUBSTR(@[cust_cd],3),'0')
			)
		)
	)
	#elseif (${cust_type} == 'P')
		AND C.ACT_CNT_CD = SUBSTR(@[cust_cd],1,2)
		AND C.ACT_CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],3),'0')
	#elseif (${cust_type} == 'S') 
		AND BS.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
		AND BS.CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],3),'0')
	#elseif (${cust_type} == 'C') 
		AND BC.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
		AND BC.CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],3),'0')
	#elseif (${cust_type} == 'N') 
		AND BN.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
		AND BN.CUST_SEQ  = LTRIM(SUBSTR(@[cust_cd],3),'0')
	#elseif (${cust_type} == 'A')
		AND EXISTS (
    		SELECT  'X'
    		FROM    INV_AR_MN I
    		WHERE   I.BKG_NO	= B.BKG_NO
    		AND     I.IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
			AND		AR_IF_NO	= (
                    				SELECT	MAX(AR_IF_NO) 
                    				FROM	INV_AR_MN
                    				WHERE	BKG_NO = B.BKG_NO
                    				AND		IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
								  )
			AND     ROWNUM  = 1
			AND     I.ACT_CUST_CNT_CD   = SUBSTR(@[cust_cd],1,2)
			AND     I.ACT_CUST_SEQ      = LTRIM(SUBSTR(@[cust_cd],3),'0')
			)
	#end
#end

#if (${svc_provdr} != '') 
AND C.VNDR_SEQ = LTRIM(@[svc_provdr],'0')
#end

#if (${sc_no} != '') 
AND B.SC_NO = @[sc_no]
#end

#if (${rfa_no} != '') 
AND B.RFA_NO = @[rfa_no]
#end


ORDER BY B.CNTR_NO, C.FM_MVMT_DT			]]></sql>
			<params>
				<param name="fm_mvmt_dt" type="12" value="" out="N"/>
				<param name="to_mvmt_dt" type="12" value="" out="N"/>
				<param name="fx_ft_ovr_dys" type="12" value="" out="N"/>
				<param name="fm_mvmt_yd_cd" type="12" value="" out="N"/>
				<param name="to_mvmt_yd_cd" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="cust_cd" type="12" value="" out="N"/>
				<param name="svc_provdr" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
				<param name="rfa_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
