<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChassisMgsetInventoryDBDAOsearchCHSInventoryByAgmtDataRSQL">
			<desc><![CDATA[chungpa 20090729 1098 start]]></desc>
			<sql><![CDATA[
SELECT 
#if (${location} == 'SCC')
A.CRNT_YD_CD AS CRNT_LOC_CD 
#else
A.CRNT_LOC_CD AS CRNT_LOC_CD 
#end

, A.AGMT_OFC_CTY_CD || LPAD(A.AGMT_SEQ, 6, '0') AS AGMT_NO
, C.VNDR_ABBR_NM||' ('||B.VNDR_SEQ||')' AS VNDR_SEQ 
, COUNT(*) AS EQ_TPSZ_CD_TOTAL,
NVL(SUM(CASE WHEN G.DP_SEQ = '1' THEN 1 END),0) AS EQ_TPSZ_CD1,
NVL(SUM(CASE WHEN G.DP_SEQ = '2' THEN 1 END),0) AS EQ_TPSZ_CD2,
NVL(SUM(CASE WHEN G.DP_SEQ = '3' THEN 1 END),0) AS EQ_TPSZ_CD3,
NVL(SUM(CASE WHEN G.DP_SEQ = '4' THEN 1 END),0) AS EQ_TPSZ_CD4,
NVL(SUM(CASE WHEN G.DP_SEQ = '5' THEN 1 END),0) AS EQ_TPSZ_CD5,
NVL(SUM(CASE WHEN G.DP_SEQ = '6' THEN 1 END),0) AS EQ_TPSZ_CD6,
NVL(SUM(CASE WHEN G.DP_SEQ = '7' THEN 1 END),0) AS EQ_TPSZ_CD7,
NVL(SUM(CASE WHEN G.DP_SEQ = '8' THEN 1 END),0) AS EQ_TPSZ_CD8,
NVL(SUM(CASE WHEN G.DP_SEQ = '9' THEN 1 END),0) AS EQ_TPSZ_CD9,
NVL(SUM(CASE WHEN G.DP_SEQ = '10' THEN 1 END),0) AS EQ_TPSZ_CD10,
NVL(SUM(CASE WHEN G.DP_SEQ = '11' THEN 1 END),0) AS EQ_TPSZ_CD11,
NVL(SUM(CASE WHEN G.DP_SEQ = '12' THEN 1 END),0) AS EQ_TPSZ_CD12,
NVL(SUM(CASE WHEN G.DP_SEQ = '13' THEN 1 END),0) AS EQ_TPSZ_CD13,
NVL(SUM(CASE WHEN G.DP_SEQ = '14' THEN 1 END),0) AS EQ_TPSZ_CD14,
NVL(SUM(CASE WHEN G.DP_SEQ = '15' THEN 1 END),0) AS EQ_TPSZ_CD15,
NVL(SUM(CASE WHEN G.DP_SEQ = '16' THEN 1 END),0) AS EQ_TPSZ_CD16,
NVL(SUM(CASE WHEN G.DP_SEQ = '17' THEN 1 END),0) AS EQ_TPSZ_CD17,
NVL(SUM(CASE WHEN G.DP_SEQ = '18' THEN 1 END),0) AS EQ_TPSZ_CD18,
NVL(SUM(CASE WHEN G.DP_SEQ = '19' THEN 1 END),0) AS EQ_TPSZ_CD19,
NVL(SUM(CASE WHEN G.DP_SEQ = '20' THEN 1 END),0) AS EQ_TPSZ_CD20
FROM CGM_EQUIPMENT A, CGM_AGREEMENT B, MDM_VENDOR C , 
(SELECT EQ_TPSZ_CD,ROW_NUMBER() OVER (ORDER BY EQ_TPSZ_REP_CD,EQ_TPSZ_CD) DP_SEQ 
  FROM CGM_EQ_TP_SZ WHERE EQ_KND_CD = 'Z' GROUP BY EQ_TPSZ_REP_CD,EQ_TPSZ_CD) G
WHERE 
A.VNDR_SEQ = C.VNDR_SEQ(+)
AND A.AGMT_OFC_CTY_CD = B.AGMT_OFC_CTY_CD
AND A.AGMT_SEQ = B.AGMT_SEQ
AND A.AGMT_VER_NO =  B.AGMT_VER_NO
AND A.EQ_TPSZ_CD = G.EQ_TPSZ_CD
AND A.EQ_KND_CD = 'Z'
AND A.ACIAC_DIV_CD = 'A'
AND (A.AGMT_OFC_CTY_CD  || A.AGMT_SEQ ) = (B.AGMT_OFC_CTY_CD  || B.AGMT_SEQ )
AND A.CRNT_LOC_CD IN 
		( 	SELECT AA.LOC_CD 
         	FROM MDM_LOCATION AA, MDM_EQ_ORZ_CHT BB
	        WHERE 
				AA.SCC_CD = BB.SCC_CD
      			AND  AA.DELT_FLG = 'N'
            	AND  BB.DELT_FLG = 'N'
				#if ( ${location} == 'RCC' )
			   	AND  BB.RCC_CD = (@[crnt_loc_cd])
				#elseif ( ${location} == 'LCC' )
				AND  BB.LCC_CD = (@[crnt_loc_cd])
				#elseif ( ${location} == 'SCC' )
				AND  BB.SCC_CD = (@[crnt_loc_cd])
				#end
		)

#if (${crnt_yd_cd} != '')
	  AND A.CRNT_YD_CD IN ($crnt_yd_cd)
#end     
#if (${include_np} != 'Y')
	  AND A.AGMT_LSTM_CD <>'NP' 
#end 
#if (${agmt_no} != '')
	  AND (B.AGMT_OFC_CTY_CD,B.AGMT_SEQ ) IN ($agmt_no) 
#end
#if (${vndr_seq} != '')
	AND B.VNDR_SEQ IN ($vndr_seq) 
#end

#if (${location} == 'SCC')
GROUP BY A.CRNT_YD_CD, (A.AGMT_OFC_CTY_CD || LPAD(A.AGMT_SEQ, 6, '0')) , C.VNDR_ABBR_NM||' ('||B.VNDR_SEQ||')'
ORDER BY A.CRNT_YD_CD , (A.AGMT_OFC_CTY_CD || LPAD(A.AGMT_SEQ, 6, '0')) , C.VNDR_ABBR_NM||' ('||B.VNDR_SEQ||')' 
#else
GROUP BY A.CRNT_LOC_CD, (A.AGMT_OFC_CTY_CD || LPAD(A.AGMT_SEQ, 6, '0')) , C.VNDR_ABBR_NM||' ('||B.VNDR_SEQ||')'
ORDER BY A.CRNT_LOC_CD , (A.AGMT_OFC_CTY_CD || LPAD(A.AGMT_SEQ, 6, '0')) , C.VNDR_ABBR_NM||' ('||B.VNDR_SEQ||')'
#end
			]]></sql>
			<params>
				<param name="crnt_loc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
