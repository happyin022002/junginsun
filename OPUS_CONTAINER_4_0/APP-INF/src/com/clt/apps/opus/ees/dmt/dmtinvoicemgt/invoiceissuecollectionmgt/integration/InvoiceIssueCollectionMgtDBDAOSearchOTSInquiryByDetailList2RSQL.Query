<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceIssueCollectionMgtDBDAOSearchOTSInquiryByDetailList2RSQL">
			<desc><![CDATA[down to excel detail rate]]></desc>
			<sql><![CDATA[
SELECT
         MAIN.DMDT_INV_NO AS INVNOO
        ,MAIN.DMDT_TRF_CD AS CHARGE
        ,MAIN.VSL_CD||MAIN.SKD_VOY_NO||MAIN.SKD_DIR_CD AS VVDCDD
        ,MAIN.SC_NO AS SCNOOO
        ,MAIN.BL_NO AS BLNOOO
        ,DECODE ( MAIN.DMDT_TRF_CD , 'DMIF' , MAIN.POD_CD 
                                   , 'DMOF' , MAIN.POL_CD 
                                   , 'DTIC' , MAIN.DEL_CD 
                                   , 'CTIC' , MAIN.DEL_CD 
                                   , 'DTOC' , MAIN.POR_CD 
                                   , 'CTOC' , MAIN.POR_CD 
                                   , '' ) AS LOCCDD
        ,DTIL.CNTR_NO AS CNTRNO
        ,DTIL.CNTR_TPSZ_CD AS TYSZCD
        ,TO_CHAR ( DTIL.FM_MVMT_DT , 'DDMonYY' , 'NLS_DATE_LANGUAGE=ENGLISH' ) AS STPDFR
        ,TO_CHAR ( DTIL.TO_MVMT_DT , 'DDMonYY' , 'NLS_DATE_LANGUAGE=ENGLISH' ) AS STPDTO
        ,TO_CHAR ( DTIL.FT_CMNC_DT , 'DDMonYY' , 'NLS_DATE_LANGUAGE=ENGLISH' ) AS FTCMNC
        ,TO_CHAR ( DTIL.FT_END_DT  , 'DDMonYY' , 'NLS_DATE_LANGUAGE=ENGLISH' ) AS FTCMPL
        ,DTIL.FT_DYS AS FREEDY
        ,DTIL.FX_FT_OVR_DYS AS OVERDY
        ,MAIN.CHG_CURR_CD AS CURRCY
        ,CASE WHEN (SUBSTR(MAIN.DMDT_INV_NO, 3,1) = 'M' AND NVL(DTIL.CNTR_NO,'N') = 'N') THEN MAIN.INV_CHG_AMT
              WHEN (SUBSTR(MAIN.DMDT_INV_NO, 3,1) = 'M' AND NVL(DTIL.CNTR_INV_AMT,0) = 0) THEN (SELECT SUM(RT_OVR_CHG_AMT) FROM DMT_INV_RT RATE
                                                                                                 WHERE DTIL.DMDT_INV_NO = RATE.DMDT_INV_NO
                                                                                                   AND DTIL.CRE_OFC_CD = RATE.CRE_OFC_CD
                                                                                                   AND DTIL.INV_DTL_SEQ = RATE.INV_DTL_SEQ)
              ELSE DTIL.CNTR_INV_AMT
              END NETAMT
        ,CASE WHEN (SUBSTR(MAIN.DMDT_INV_NO, 3,1) = 'M' AND NVL(DTIL.CNTR_NO,'N') = 'N') THEN MAIN.TAX_AMT
              WHEN (SUBSTR(MAIN.DMDT_INV_NO, 3,1) = 'M' AND NVL(DTIL.CNTR_INV_AMT,0) = 0) THEN (SELECT SUM(RT_OVR_CHG_AMT * MAIN.TAX_RTO * 0.01) FROM DMT_INV_RT RATE
                                                                                                 WHERE DTIL.DMDT_INV_NO = RATE.DMDT_INV_NO
                                                                                                   AND DTIL.CRE_OFC_CD = RATE.CRE_OFC_CD
                                                                                                   AND DTIL.INV_DTL_SEQ = RATE.INV_DTL_SEQ)
              ELSE DTIL.TAX_AMT
              END TAXAMT
        ,CASE WHEN (SUBSTR(MAIN.DMDT_INV_NO, 3,1) = 'M' AND NVL(DTIL.CNTR_NO,'N') = 'N') THEN MAIN.INV_AMT
              WHEN (SUBSTR(MAIN.DMDT_INV_NO, 3,1) = 'M' AND NVL(DTIL.CNTR_INV_AMT,0) = 0) THEN (SELECT SUM((RT_OVR_CHG_AMT * MAIN.TAX_RTO * 0.01)+RT_OVR_CHG_AMT) FROM DMT_INV_RT RATE
                                                                                                 WHERE DTIL.DMDT_INV_NO = RATE.DMDT_INV_NO
                                                                                                   AND DTIL.CRE_OFC_CD = RATE.CRE_OFC_CD
                                                                                                   AND DTIL.INV_DTL_SEQ = RATE.INV_DTL_SEQ) 
             ELSE ( DTIL.CNTR_INV_AMT + DTIL.TAX_AMT )
             END TOTAMT
##        ,DTIL.CNTR_INV_AMT NETAMT
##        ,DTIL.TAX_AMT AS TAXAMT
##        ,( DTIL.CNTR_INV_AMT + DTIL.TAX_AMT ) AS TOTAMT
        ,TO_CHAR ( MAIN.CRE_DT , 'DDMonYY' , 'NLS_DATE_LANGUAGE=ENGLISH' ) AS ISSUDT
        ,TO_DATE (TO_CHAR ( SYSDATE     , 'YYYYMMDD' ) , 'YYYYMMDD' ) - 
         TO_DATE (TO_CHAR ( MAIN.CRE_DT , 'YYYYMMDD' ) , 'YYYYMMDD' ) AS OVEDAY
FROM
         DMT_INV_MN  MAIN
        ,DMT_INV_DTL DTIL
WHERE
        MAIN.DMDT_INV_NO = DTIL.DMDT_INV_NO(+)
AND     MAIN.CRE_OFC_CD  = DTIL.CRE_OFC_CD(+)
#if ( ${invno} != '' )
AND     MAIN.DMDT_INV_NO IN (
    #foreach( $dmdt_inv_no_p in ${tempINVNOList}) 
        #if($velocityCount < $tempINVNOList.size()) 
           '$dmdt_inv_no_p', 
        #else 
           '$dmdt_inv_no_p' 
        #end 
    #end
        )
#end

#if ( ${creof} != '' )
AND     MAIN.CRE_OFC_CD IN (
    #foreach( $cre_ofc_cd_p in ${tempCREOFList}) 
        #if($velocityCount < $tempCREOFList.size()) 
           '$cre_ofc_cd_p', 
        #else 
           '$cre_ofc_cd_p' 
        #end 
    #end
        )
#end			]]></sql>
			<params>
			</params>
		</query>
	</querys>
</sqls>
