<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ExpenseMgtDBDAOsearchPayableInvoiceListByWODataRSQL">
			<desc><![CDATA[ExpenseMgtDBDAOsearchPayableInvoiceListByWODataRSQL]]></desc>
			<sql><![CDATA[
SELECT 
A.MNR_ORD_OFC_CTY_CD || A.MNR_ORD_SEQ WO_NO
,A.MNR_WO_TP_CD  WO_TYPE_CODE
,D.MNR_CD_DESC WO_TYPE
,MNR_COMMON_PKG.MNR_CONV_PARTNER_CD_FNC(A.VNDR_SEQ) VNDR_SEQ
,B.VNDR_LGL_ENG_NM
,A.COST_OFC_CD
,TO_CHAR(A.MNR_INP_DT , 'yyyy-mm-dd') RCV_DT
,TO_CHAR(GLOBALDATE_PKG.TIME_CONV_OFC_FNC(MNR_COMMON_PKG.MNR_GET_HOOFC_FNC(), A.CRE_DT, @[user_ofc_cd]), 'yyyy-mm-dd') CRE_DT
,A.MNR_WRK_AMT
,0 AS SLS_TAX_AMT
,A.MNR_WRK_AMT TTL_AMT
,NVL(C.PAY_TERM_DYS, (SELECT GEN_PAY_TERM_CD 
                        FROM MDM_VENDOR 
                       WHERE VNDR_SEQ = A.VNDR_SEQ)) PAY_TERM_DYS
,A.CURR_CD 
,E.DP_PRCS_KNT
,(SELECT DECODE(MAX(MNR_INP_TP_CD), 'MI', '', MAX(MNR_INP_TP_CD)) 
   FROM MNR_ORD_DTL 
  WHERE MNR_ORD_OFC_CTY_CD = A.MNR_ORD_OFC_CTY_CD 
    AND MNR_ORD_SEQ = A.MNR_ORD_SEQ) AS MNR_INP_TP_CD
FROM MNR_ORD_HDR A, MDM_VENDOR B, MNR_AGMT_HDR C, MNR_GEN_CD D, MDM_CURRENCY E
WHERE A.VNDR_SEQ = B.VNDR_SEQ(+)
AND A.AGMT_OFC_CTY_CD = C.AGMT_OFC_CTY_CD(+)
AND A.AGMT_SEQ = C.AGMT_SEQ(+)
AND A.AGMT_VER_NO = C.AGMT_VER_NO(+) 
AND D.PRNT_CD_ID(+)='CD00020'
AND A.MNR_WO_TP_CD = D.MNR_CD_ID(+)
AND A.CURR_CD = E.CURR_CD
#if (${mnr_inv_sts_cd} != 'SS') 
#if (${user_ofc_cd} == 'NYCBB')
AND A.COST_OFC_CD IN ( SELECT M.OFC_CD
                         FROM MDM_ORGANIZATION M
                        WHERE SUBSTR(M.LOC_CD, 1,2) = 'US')
#else
AND   A.COST_OFC_CD IN (
                        SELECT D.OFC_CD
                        FROM MNR_OFC_GEN_INFO D
                        WHERE D.UPPR_OFC_CD = @[user_ofc_cd]
                            AND D.MNR_GRP_TP_CD = 'OFC'
                            AND D.COST_CD       = 'RPRINV'
	#if (${wo_ofc_cd} != 'ALL') 
							AND D.OFC_CD = @[wo_ofc_cd]
	#end
                        UNION ALL
                        SELECT @[user_ofc_cd]
                        FROM DUAL
                        )
#end
#end
AND EXISTS ( SELECT 'X'
             FROM MNR_ORD_DTL E             
             WHERE A.MNR_ORD_OFC_CTY_CD = E.MNR_ORD_OFC_CTY_CD
             AND A.MNR_ORD_SEQ          = E.MNR_ORD_SEQ
             AND E.INV_NO is null
			 AND E.ACCT_CD <> '511591'
             AND ROWNUM = 1
           )
#if (${woNos} != '')
	AND	A.MNR_ORD_SEQ IN (
		#foreach ($user_woNos IN ${woNos})
			#if($velocityCount < $woNos.size())
				$user_woNos,
			#else
				$user_woNos
			#end
		#end			  
	)
#else
	AND A.UPD_DT BETWEEN GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[user_ofc_cd], TO_DATE(@[from_dt], 'YYYY-MM-DD'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC()) AND GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[user_ofc_cd], TO_DATE(@[to_dt], 'YYYY-MM-DD'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC())+ 0.99999
#end
#if (${vndr_seq} != '') 
	AND A.VNDR_SEQ = @[vndr_seq]
#end 
#if (${mnr_inv_sts_cd} == 'SS') 
AND (A.MNR_ORD_OFC_CTY_CD,A.MNR_ORD_SEQ) NOT IN 
       (   
        SELECT B.MNR_ORD_OFC_CTY_CD,B.MNR_ORD_SEQ 
        FROM MNR_PAY_INV_WRK A, MNR_PAY_INV_TMP B 
        WHERE A.PAY_INV_SEQ = B.PAY_INV_SEQ 
           AND A.ORD_VNDR_SEQ = TO_NUMBER(@[vndr_seq])
           AND A.MNR_INV_STS_CD IN ('SS','SR','HJ')
       )
#end			]]></sql>
			<params>
				<param name="user_ofc_cd" type="12" value="" out="N"/>
				<param name="wo_ofc_cd" type="12" value="" out="N"/>
				<param name="from_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
