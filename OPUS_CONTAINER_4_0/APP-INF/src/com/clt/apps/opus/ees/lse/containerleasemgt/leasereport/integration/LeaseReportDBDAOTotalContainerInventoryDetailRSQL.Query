<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="LeaseReportDBDAOTotalContainerInventoryDetailRSQL">
			<desc><![CDATA[선사의 관리하는 자가 및 임차장비의 상세내역을 조회합니다.]]></desc>
			<sql><![CDATA[
SELECT  ROW_SEQ, LSTM_CD, AGMT_CTY_CD, AGMT_SEQ, REF_NO, 
        CNTR_TPSZ_CD, CNTR_NO, ONH_DT, ONH_YD_CD, ONH_FREE_DYS, 
        MIN_ONH_DYS, USED_DYS, CNMV_DT, CNTR_STS_CD, CNMV_STS_CD, CRNT_YD_CD, VNDR_SEQ, VNDR_ABBR_NM
FROM   (SELECT  ROW_NUMBER() OVER (ORDER BY A.CNTR_NO) AS ROW_SEQ
              , C.LSTM_CD
              , A.AGMT_CTY_CD
              , A.AGMT_SEQ
              , C.REF_NO
              , A.CNTR_TPSZ_CD
              , A.CNTR_NO 
              , TO_CHAR(A.ONH_DT,'YYYYMMDD') AS ONH_DT
              , A.ONH_YD_CD
              , A.ONH_FREE_DYS
              , A.MIN_ONH_DYS
        	  , CASE WHEN C.LSTM_CD IN('OW','LP','OL') THEN ROUND(TRUNC(SYSDATE) - A.ONH_DT) + 1
        			 ELSE ROUND(TRUNC(SYSDATE) - A.ONH_DT) + 1 END USED_DYS
        	  , TO_CHAR(A.CNMV_DT,'YYYYMMDD') AS CNMV_DT 
        	  , A.CNTR_STS_CD
              , A.CNMV_STS_CD
              , A.CRNT_YD_CD
              , C.VNDR_SEQ
              , (SELECT MV.VNDR_ABBR_NM
                   FROM MDM_VENDOR MV
                  WHERE MV.VNDR_SEQ = C.VNDR_SEQ
                    AND ROWNUM      = 1) AS VNDR_ABBR_NM 
        FROM    MST_CONTAINER A,
                LSE_AGREEMENT C            
        WHERE   A.CNTR_STS_CD NOT IN ('LSO','DIO','DON','SCR','TLL','SLD','SRO')
        AND     A.AGMT_CTY_CD = C.AGMT_CTY_CD        
        AND     A.AGMT_SEQ = C.AGMT_SEQ        
        AND     A.AGMT_SEQ <> 999990
    #if (${agmt_seq} != '')
        AND     A.AGMT_CTY_CD = @[agmt_cty_cd]
        AND     A.AGMT_SEQ = @[agmt_seq]
    #end
	#if (${vndr_seq} != '')
		AND     C.VNDR_SEQ = @[vndr_seq]
	#end						
    #if (${loc_tp} == 'RCC')
        AND     A.RCC_CD = @[loc_cd]
    #elseif (${loc_tp} == 'LCC')
        AND     A.LCC_CD = @[loc_cd]
    #elseif (${loc_tp} == 'SCC')
        AND     A.SCC_CD = @[loc_cd]
    #end						  
    #if (${cnmv_sts_cd} != '')
        AND     A.CNMV_STS_CD IN (
        #foreach($key IN ${cnmv_sts_cd_seq})
            #if($velocityCount < $cnmv_sts_cd_seq.size())
                '$key',
            #else
                '$key'
            #end
        #end
                )
    #end 
    #if (${lstm_cd} != '')
        AND     C.LSTM_CD IN (
        #foreach($key IN ${lstm_cd_seq})
            #if($velocityCount < $lstm_cd_seq.size())
                '$key',
            #else
                '$key'
            #end
        #end
                )
    #end 
    #if (${cntr_tpsz_cd} != '') 
        AND     A.CNTR_TPSZ_CD IN (
        #foreach($key IN ${cntr_tpsz_cd_seq})
            #if($velocityCount < $cntr_tpsz_cd_seq.size())
                '$key',
            #else
                '$key'
            #end
        #end
                )
    #end
)
#if (${startno} != '') 
 WHERE 	ROW_SEQ BETWEEN @[startno] AND @[endno]
#end			]]></sql>
			<params>
				<param name="agmt_cty_cd" type="12" value="" out="N"/>
				<param name="agmt_seq" type="2" value="" out="N"/>
				<param name="vndr_seq" type="2" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="startno" type="2" value="" out="N"/>
				<param name="endno" type="2" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
