<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceIssueCollectionMgtDBDAOSearchARInterfaceStatusByDMTRSQL">
			<desc><![CDATA[SearchARInterfaceStatusByDMT]]></desc>
			<sql><![CDATA[
SELECT DISTINCT 
#if (${ofc_tp} == 'ar_if_ofc') 
      I.AR_IF_OFC_CD AS OFC_CD
	  ,I.AR_IF_OFC_CD || TO_CHAR(I.AR_IF_DT ,'YYYYMMDD') || I.INV_CURR_CD AS SUBTOT
#elseif (${ofc_tp} == 'issue_ofc')   
      I.CRE_OFC_CD   AS OFC_CD
	  ,I.CRE_OFC_CD || TO_CHAR(I.AR_IF_DT ,'YYYYMMDD') || I.INV_CURR_CD AS SUBTOT
#end
      ,TO_CHAR(I.AR_IF_DT ,'YYYY-MM-DD') AS AR_IF_DT
      ,I.DMDT_TRF_CD
      ,I.DMDT_INV_NO
      ,I.BKG_NO
      ,I.BL_NO
      ,I.AR_IF_NO
      , I.VSL_CD
        || I.SKD_VOY_NO
        || I.SKD_DIR_CD AS VVD
      ,DECODE(SUBSTR(I.DMDT_TRF_CD, 3, 1),'I', I.POD_CD, I.POL_CD) AS PORT
      ,I.AR_IF_OFC_CD
	  ,(SELECT USR_NM FROM COM_USER WHERE USR_ID = I.AR_IF_USR_ID) AS AR_IF_USR_ID
      ,TO_CHAR(I.CRE_DT,'YYYY-MM-DD') AS CRE_DT
      ,I.CRE_OFC_CD
      ,(SELECT USR_NM FROM COM_USER WHERE USR_ID = I.CRE_USR_ID) AS CRE_USR_ID
      ,I.INV_CURR_CD
      ,I.INV_CHG_AMT
      ,I.TAX_AMT
      ,I.INV_AMT
 	  , (SELECT DELT_FLG
           FROM MDM_CUSTOMER
          WHERE CUST_CNT_CD = DECODE (I.ACT_PAYR_CNT_CD,'00', '',I.ACT_PAYR_CNT_CD)
            AND CUST_SEQ = TO_CHAR (I.ACT_PAYR_SEQ, 'FM000000')) AS PAYER_FLG
      , DECODE (I.ACT_PAYR_CNT_CD,'00', '',I.ACT_PAYR_CNT_CD)
        || TO_CHAR (I.ACT_PAYR_SEQ, 'FM000000') AS PAYER_CD
      ,CASE
           WHEN I.DMDT_TRF_CD = 'DTIC' AND INSTR (NVL (I.POD_CD, '  '), 'US') = 1  AND I.ACT_PAYR_CNT_CD = '00'
              THEN (SELECT MV.VNDR_LGL_ENG_NM
                      FROM MDM_VENDOR MV
                     WHERE MV.VNDR_SEQ = TO_CHAR (I.ACT_PAYR_SEQ, 'FM000000'))  
           WHEN I.DMDT_TRF_CD = 'DTOC' AND INSTR (NVL (I.POL_CD, '  '), 'US') = 1 AND I.ACT_PAYR_CNT_CD = '00'
              THEN (SELECT MV.VNDR_LGL_ENG_NM
                      FROM MDM_VENDOR MV
                     WHERE MV.VNDR_SEQ = TO_CHAR (I.ACT_PAYR_SEQ, 'FM000000'))
           WHEN I.DMDT_TRF_CD IN ('DMIF', 'CTIC') OR (I.DMDT_TRF_CD = 'DTIC' AND INSTR (NVL (I.POD_CD, '  '), 'US') <> 1) 
              THEN (SELECT MC.CUST_LGL_ENG_NM
                      FROM MDM_CUSTOMER MC
                     WHERE MC.CUST_CNT_CD = DECODE (I.ACT_PAYR_CNT_CD,'00', '',I.ACT_PAYR_CNT_CD)
                       AND MC.CUST_SEQ = TO_CHAR (I.ACT_PAYR_SEQ, 'FM000000'))
           WHEN I.DMDT_TRF_CD IN ('DMOF', 'CTOC') OR (    I.DMDT_TRF_CD = 'DTOC' AND INSTR (NVL (I.POL_CD, '  '), 'US') <> 1)
              THEN (SELECT MC.CUST_LGL_ENG_NM
                      FROM MDM_CUSTOMER MC
                     WHERE MC.CUST_CNT_CD = DECODE (I.ACT_PAYR_CNT_CD,'00', '',I.ACT_PAYR_CNT_CD)
                       AND MC.CUST_SEQ = TO_CHAR (I.ACT_PAYR_SEQ, 'FM000000'))
           ELSE    
                (SELECT MC.CUST_LGL_ENG_NM
                      FROM MDM_CUSTOMER MC
                     WHERE MC.CUST_CNT_CD = DECODE (I.ACT_PAYR_CNT_CD,'00', '',I.ACT_PAYR_CNT_CD)
                       AND MC.CUST_SEQ = TO_CHAR (I.ACT_PAYR_SEQ, 'FM000000'))                            
        END AS PAYER_NM  
      , BS.CUST_CNT_CD
        || TRIM (TO_CHAR (BS.CUST_SEQ, '000000')) AS SHIPPER_CD
      ,REPLACE (BS.CUST_NM
               , CHR (13)
                 || CHR (10)
               ,' '
               ) AS SHIPPER_NM
      ,DECODE (BC.CUST_CNT_CD
               || TRIM (TO_CHAR (BC.CUST_SEQ, '000000'))
              ,'000000', NULL
              , BC.CUST_CNT_CD
                || TRIM (TO_CHAR (BC.CUST_SEQ, '000000'))
              ) AS CONSIGNEE_CD
      ,REPLACE (BC.CUST_NM
               , CHR (13)
                 || CHR (10)
               ,' '
               ) AS CONSIGNEE_NM
      ,DECODE (BN.CUST_CNT_CD
               || TRIM (TO_CHAR (BN.CUST_SEQ, '000000'))
              ,'000000', NULL
              , BN.CUST_CNT_CD
                || TRIM (TO_CHAR (BN.CUST_SEQ, '000000'))
              ) AS NOTIFY_CD
      ,NVL (RTRIM (REPLACE (REPLACE (BN.CUST_NM
                                    ,CHR(34)
                                    ,''
                                    )
                           , CHR (13)
                             || CHR (10)
                           ,' '
                           ))
           ,'-') AS NOTIFY_NM	  
  FROM DMT_INV_MN I
      ,BKG_CUSTOMER BS
      ,BKG_CUSTOMER BC
      ,BKG_CUSTOMER BN
 WHERE BS.BKG_NO(+) = I.BKG_NO
   AND BS.BKG_CUST_TP_CD(+) = 'S'
   AND BC.BKG_NO(+) = I.BKG_NO
   AND BC.BKG_CUST_TP_CD(+) = 'C'
   AND BN.BKG_NO(+) = I.BKG_NO
   AND BN.BKG_CUST_TP_CD(+) = 'N'
#if (${ofc_tp} == 'ar_if_ofc') 
   AND I.AR_IF_OFC_CD IN (
        #foreach( $ofc_cd in ${ofc_cd_list} )
            #if($velocityCount < $ofc_cd_list.size()) '$ofc_cd', #else '$ofc_cd' #end
        #end
        )
#elseif (${ofc_tp} == 'issue_ofc')   
   AND I.CRE_OFC_CD IN (
        #foreach( $ofc_cd in ${ofc_cd_list} )
            #if($velocityCount < $ofc_cd_list.size()) '$ofc_cd', #else '$ofc_cd' #end
        #end
        )   
#end   
   
#if (${dmdt_trf_cd} != '') 
   AND I.DMDT_TRF_CD IN (
        #foreach( $trf_cd in ${trf_cd_list} )
            #if($velocityCount < $trf_cd_list.size()) '$trf_cd', #else '$trf_cd' #end
        #end
        ) 
#end   
        
   AND I.AR_IF_DT BETWEEN TO_DATE (@[fm_dt], 'yyyymmdd')
                      AND TO_DATE (@[to_dt], 'yyyymmdd')
                          + 0.99999                       
   AND I.DMDT_AR_IF_CD = 'Y'
#if (${cust_cd} != '')
 #if (${cust_type} == 'P')
  #if (${cust_len} == '8')
   AND I.ACT_PAYR_CNT_CD = SUBSTR(@[cust_cd],1,2)
   AND I.ACT_PAYR_SEQ = LTRIM(SUBSTR(@[cust_cd],3),'0')
  #else
   AND I.ACT_PAYR_SEQ = LTRIM(SUBSTR(@[cust_cd],1,6),'0')
  #end
 #elseif (${cust_type} == 'S') 
   AND BS.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
   AND BS.CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],3),'0')
 #elseif (${cust_type} == 'C') 
   AND BC.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
   AND BC.CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],3),'0')
 #elseif (${cust_type} == 'N') 
   AND BN.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
   AND BN.CUST_SEQ  = LTRIM(SUBSTR(@[cust_cd],3),'0')
 #end
#end

#if (${ofc_tp} == 'ar_if_ofc') 
   ORDER BY AR_IF_OFC_CD ASC, AR_IF_DT ASC, INV_CURR_CD ASC
#elseif (${ofc_tp} == 'issue_ofc')   
   ORDER BY CRE_OFC_CD, AR_IF_DT , INV_CURR_CD
#end			]]></sql>
			<params>
				<param name="fm_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="cust_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
