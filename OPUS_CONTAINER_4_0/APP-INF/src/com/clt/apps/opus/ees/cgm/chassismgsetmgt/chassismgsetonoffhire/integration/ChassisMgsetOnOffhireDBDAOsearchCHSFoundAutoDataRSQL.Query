<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChassisMgsetOnOffhireDBDAOsearchCHSFoundAutoDataRSQL">
			<desc><![CDATA[Status가 'LST' 나 'TLL' 즉 손실된 장비에 해당하는 CHASSIS, 정보 조회]]></desc>
			<sql><![CDATA[
SELECT 
        A.EQ_NO
      , MAX(A.EQ_TPSZ_CD) AS EQ_TPSZ_CD      
      , MAX(A.AGMT_LSTM_CD) as AGMT_LSTM_CD
      , MAX(B.EQ_ASET_STS_CD) as EQ_ASET_STS_CD
      , MAX((SELECT VNDR_LGL_ENG_NM FROM MDM_VENDOR WHERE VNDR_SEQ = C.VNDR_SEQ)) as VNDR_LGL_ENG_NM
      , MAX(TO_CHAR(B.STS_EVNT_DT,'YYYY-MM-DD HH24:MI')) as STS_EVNT_DT
      , MAX(B.CRE_USR_ID) as CRE_USR_ID

      , MIN(TO_CHAR(D.MVMT_DT,'YYYY-MM-DD HH24:MI:SS')) AS MVMT_DT
      , MIN(TO_CHAR(D.MVMT_DT,'YYYY-MM-DD HH24:MI')) as  MVMTS_DT
      , substr(MIN(TO_CHAR(D.MVMT_DT,'YYYY-MM-DD HH24:MI:SS')||D.MVMT_STS_CD  ),20,22)  as CHSS_MVMT_STS_CD
      , substr(MIN(TO_CHAR(D.MVMT_DT,'YYYY-MM-DD HH24:MI:SS')|| D.YD_CD),20,27) as STS_EVNT_YD_CD
      , substr(MIN(TO_CHAR(D.MVMT_DT,'YYYY-MM-DD HH24:MI:SS')||D.SYS_SEQ) ,20,27) as SYS_SEQ
 FROM CGM_EQUIPMENT A
    , CGM_EQ_STS_HIS B
    , CGM_AGREEMENT C
    , CGM_CHSS_MVMT_HIS D
 WHERE 1=1
  AND A.ACIAC_DIV_CD = 'I' 
  AND A.EQ_KND_CD ='Z'
  AND A.EQ_NO = B.EQ_NO
  AND B.EQ_STS_SEQ = A.EQ_STS_SEQ
  AND B.EQ_ASET_STS_CD IN ('LST', 'TLL')
  AND B.AGMT_OFC_CTY_CD = C.AGMT_OFC_CTY_CD
  AND B.AGMT_SEQ = C.AGMT_SEQ
  AND B.AGMT_VER_NO = C.AGMT_VER_NO
  AND D.CHSS_NO = A.EQ_NO
 AND  D.MVMT_STS_CD <> 'XX' 
 AND  D.MVMT_DT > B.STS_EVNT_DT
 AND substr(D.YD_CD,0,5)  IN 
     ( SELECT AA.LOC_CD 
         FROM MDM_LOCATION AA
            , MDM_EQ_ORZ_CHT BB
      WHERE AA.SCC_CD = BB.SCC_CD
       AND  AA.DELT_FLG = 'N'
       AND  BB.DELT_FLG = 'N'
#if ( ${location} == 'R' )
   AND  BB.RCC_CD = @[scc_cd]
#elseif ( ${location} == 'L' )
   AND  BB.LCC_CD = @[scc_cd] 
#elseif ( ${location} == 'S' )
  AND   BB.SCC_CD = @[scc_cd]
#end
   )
GROUP BY A.EQ_NO			]]></sql>
			<params>
				<param name="scc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
