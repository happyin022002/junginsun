<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TimeClockStopMgtDBDAODmtTimeClockStopListRSQL">
			<desc><![CDATA[DmtTimeClockStopList]]></desc>
			<sql><![CDATA[
WITH CLK AS (
SELECT ROWNUM AS num,
       clk_stop_no,
       DECODE (cxl_flg, 'N', 'Live', 'Y', 'Cancelled') AS cxl_flg,
       dmdt_trf_cd,
       (SELECT dmdt_trf_nm
          FROM dmt_trf_tp
         WHERE dmt_trf_tp.dmdt_trf_cd = dmt_tm_clk_stop.dmdt_trf_cd)
                                                               AS dmdt_trf_nm,
       clk_stop_ofc_cd,
       (SELECT ofc_eng_nm
          FROM mdm_organization
         WHERE mdm_organization.ofc_cd = dmt_tm_clk_stop.clk_stop_ofc_cd)
                                                           AS clk_stop_ofc_nm,
       TO_CHAR(clk_stop_fm_dt,'YYYY-MM-DD') AS clk_stop_fm_dt,
       TO_CHAR(clk_stop_to_dt,'YYYY-MM-DD') AS clk_stop_to_dt,
		CEIL((TO_DATE (TO_CHAR (clk_stop_to_dt, 'rrrrmmdd'),'rrrrmmdd')+ .99999) -
		(TO_DATE (TO_CHAR (clk_stop_fm_dt, 'rrrrmmdd'),'rrrrmmdd')+ .00001)) AS stop_days,
       clk_stop_rmk,
       cre_usr_id,
       TO_CHAR (cre_dt, 'yyyy-mm-dd') AS cre_dt,
       cre_ofc_cd,
       (SELECT usr_nm
          FROM com_user
         WHERE com_user.usr_id = dmt_tm_clk_stop.upd_usr_id) AS upd_usr_id,
       TO_CHAR (upd_dt, 'yyyy-mm-dd') AS upd_dt,
       upd_ofc_cd,
       ALL_YD_FLG
  FROM dmt_tm_clk_stop
 WHERE 
		#if (${date_period} == 'creation') 
            cre_dt BETWEEN TO_DATE (@[fm_dt], 'rrrrmmdd') + .00001 AND TO_DATE (@[to_dt], 'rrrrmmdd') + .99999
		#elseif (${date_period} == 'stop_date')
            clk_stop_fm_dt BETWEEN TO_DATE (@[fm_dt], 'rrrrmmdd') + .00001 AND TO_DATE (@[to_dt], 'rrrrmmdd') + .99999
        #end
       
        #if (${cxl_flg} != '') 
		and
            cxl_flg = @[cxl_flg]
        #end
      	

        #if (${office} == 'creation')
			#if (${clk_stop_ofc_cd} != '') 
		and
           	cre_ofc_cd in   (
                       #foreach($ofc_cd IN ${sch_ofc_cd})								
							#if($sch_ofc_cd.hasNext()) '$ofc_cd', #else '$ofc_cd' #end
		  			   #end
                            )
			#end
        #elseif (${office} == 'stop_office')
			#if (${clk_stop_ofc_cd} != '') 
		and
           	clk_stop_ofc_cd in  (
                       #foreach($ofc_cd IN ${sch_ofc_cd})								
							#if($sch_ofc_cd.hasNext()) '$ofc_cd', #else '$ofc_cd' #end
					   #end
                                )
			#end
        #end

   
        #if (${dmdt_trf_cd} != '') 
		and 
            dmdt_trf_cd in  (
                        #foreach($trf_cd IN ${sch_trf_cd})								
								#if($sch_trf_cd.hasNext()) '$trf_cd', #else '$trf_cd' #end
						#end
                            )
        #end
 
        #if (${date_period} == 'creation') 
			ORDER BY cre_dt DESC
        #elseif (${date_period} == 'stop_date')
			ORDER BY clk_stop_fm_dt DESC
        #end
)
SELECT ROWNUM AS num,
       T1.*
  FROM (
    SELECT CLK.*, B.YD_CD CLK_STOP_YD_CD FROM CLK, DMT_TM_CLK_STOP_YD B
    WHERE CLK.ALL_YD_FLG = 'N'
    AND CLK.CLK_STOP_NO = B.CLK_STOP_NO
    AND B.YD_CD != 'All'
    UNION ALL
    SELECT CLK.*, C.YD_CD CLK_STOP_YD_CD FROM CLK, MDM_YARD C
    WHERE CLK.ALL_YD_FLG = 'Y'
    AND C.DMDT_OFC_CD = CLK.CLK_STOP_OFC_CD
    AND (
    	C.DEM_IB_CLT_FLG = 'Y'
    	OR C.DEM_OB_CLT_FLG = 'Y'
    )
    AND C.DELT_FLG = 'N'
    ) T1			]]></sql>
			<params>
				<param name="fm_dt" type="12" value="20090501" out="N"/>
				<param name="to_dt" type="12" value="20090510" out="N"/>
				<param name="cxl_flg" type="12" value="s" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
