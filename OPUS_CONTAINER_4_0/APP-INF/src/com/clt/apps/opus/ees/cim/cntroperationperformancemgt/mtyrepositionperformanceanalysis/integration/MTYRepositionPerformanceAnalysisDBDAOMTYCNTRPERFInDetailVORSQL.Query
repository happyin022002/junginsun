<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MTYRepositionPerformanceAnalysisDBDAOMTYCNTRPERFInDetailVORSQL">
			<desc><![CDATA[Movement Premance by CY 조회 쿼리
- 2010.09.02 남궁진호 [CHM-201005671-01]- 두개의 MVMT STS를 조회하는 경우 이전 이후 MVMT EVENT DATE 를  모두 보여주도록 수정함, EVENTDATE -> PRE-EVENT_DATE,POST_EVENT_DATE추가
- 2010.09.15 이병훈 [CHM-201005995-01] - ''Movement Performance by CY''의 BKG 데이터 I/F 로직 변경
- 2011.04.07 나상보 [CHM-201109997-01] - [CIM] Movement Performance by CY 기능 보완. SC_RFA_NO_TAA, SHPR, CNEE 추가]]></desc>
			<sql><![CDATA[
#if (${mtymvmt} == 'MTIDMG' || ${mtymvmt} == 'MTVDVD-MT' || ${mtymvmt} == 'MTOPOP-MT' || ${mtymvmt} == 'VLMTMT-VL' || ${mtymvmt} == 'MTOCOC-MT' || ${mtymvmt} == 'OCIDID-OC')
  SELECT  /*+ index( m xie6ctm_movement ) */
        M.CNMV_CO_CD AS company,
        M.CNTR_NO AS cntrNo,
        M.CNTR_TPSZ_CD AS tpsz,
        SUBSTR(@[mtymvmt],5) AS mvmt, 
        M.ORG_YD_CD AS yard ,
#if (${mtymvmt} != 'MTIDMG')
      (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
              TO_CHAR(MM.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI')  /*  PRE_MVMT_EVNT_DT */
         FROM CTM_MOVEMENT MM
        WHERE MM.CNTR_NO = M.CNTR_NO
          AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
              M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
          AND MM.MVMT_STS_CD = SUBSTR(@[mtymvmt],3,2)
          AND ROWNUM = 1) AS PRE_EVENTDATE,
        TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS POST_EVENTDATE,
#else
        TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS PRE_EVENTDATE,
        '' AS POST_EVENTDATE,
#end
        M.MVMT_CRE_TP_CD AS autoFlag,
        
#if (${mtymvmt} != 'MTOPOP-MT')        
        B.SLAN_CD AS lane,
#else
     (SELECT   /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ BB.SLAN_CD
         FROM CTM_MOVEMENT MM, BKG_BOOKING   BB
        WHERE MM.CNTR_NO = M.CNTR_NO
          AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
              M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
          AND MM.MVMT_STS_CD = SUBSTR('MTOPOP-MT',3,2)
          AND MM.BKG_NO    = BB.BKG_NO
          AND ROWNUM = 1) AS lane,
#end
     
        M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS tVvd,

#if (${mtymvmt} != 'MTOPOP-MT')
        M.BKG_NO AS bkgNo,
        B.POR_CD as por,  /* POR CODE */
        B.POL_CD AS pol,
        B.POD_CD AS pod,
        B.DEL_CD AS del,  /* DEL CODE */
		B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		(SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,

#else
     (SELECT   /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ BB.BKG_NO
         FROM CTM_MOVEMENT MM, BKG_BOOKING   BB
        WHERE MM.CNTR_NO = M.CNTR_NO
          AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
              M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
          AND MM.MVMT_STS_CD = SUBSTR('MTOPOP-MT',3,2)
          AND MM.BKG_NO    = BB.BKG_NO
          AND ROWNUM = 1) AS bkgNo,

      (SELECT  /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ BB.POR_CD 
         FROM CTM_MOVEMENT MM, BKG_BOOKING   BB
        WHERE MM.CNTR_NO = M.CNTR_NO
          AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
              M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
          AND MM.MVMT_STS_CD = SUBSTR('MTOPOP-MT',3,2)
          AND MM.BKG_NO    = BB.BKG_NO
          AND ROWNUM = 1) AS por,
 
       (SELECT  /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ BB.POL_CD 
         FROM CTM_MOVEMENT MM, BKG_BOOKING   BB
        WHERE MM.CNTR_NO = M.CNTR_NO
          AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
              M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
          AND MM.MVMT_STS_CD = SUBSTR('MTOPOP-MT',3,2)
          AND MM.BKG_NO    = BB.BKG_NO
          AND ROWNUM = 1) AS pol,
 
         (SELECT  /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ BB.POD_CD 
         FROM CTM_MOVEMENT MM, BKG_BOOKING   BB
        WHERE MM.CNTR_NO = M.CNTR_NO
          AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
              M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
          AND MM.MVMT_STS_CD = SUBSTR('MTOPOP-MT',3,2)
          AND MM.BKG_NO    = BB.BKG_NO
          AND ROWNUM = 1) AS pod, 
          
        (SELECT  /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ BB.DEL_CD 
         FROM CTM_MOVEMENT MM, BKG_BOOKING   BB
        WHERE MM.CNTR_NO = M.CNTR_NO
          AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
              M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
          AND MM.MVMT_STS_CD = SUBSTR('MTOPOP-MT',3,2)
          AND MM.BKG_NO    = BB.BKG_NO
          AND ROWNUM = 1) AS del,
(SELECT   /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ 
          REPLACE(REPLACE(SUBSTR(CC.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')
         FROM CTM_MOVEMENT MM, BKG_BOOKING   BB, BKG_CUSTOMER CC
        WHERE MM.CNTR_NO = M.CNTR_NO
          AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
              M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
          AND MM.MVMT_STS_CD = SUBSTR('MTOPOP-MT',3,2)
          AND MM.BKG_NO    = BB.BKG_NO
          AND BB.BKG_NO    = CC.BKG_NO
          AND CC.BKG_CUST_TP_CD = 'S'
          AND ROWNUM = 1) AS SHPR,
(SELECT   /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ 
          REPLACE(REPLACE(SUBSTR(CC.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')
         FROM CTM_MOVEMENT MM, BKG_BOOKING   BB, BKG_CUSTOMER CC
        WHERE MM.CNTR_NO = M.CNTR_NO
          AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
              M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
          AND MM.MVMT_STS_CD = SUBSTR('MTOPOP-MT',3,2)
          AND MM.BKG_NO    = BB.BKG_NO
          AND BB.BKG_NO    = CC.BKG_NO
          AND CC.BKG_CUST_TP_CD = 'C'
          AND ROWNUM = 1) AS CNEE,
        MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'FLG') AS DMG_FLG_DT, 
        MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'UNFLG') AS DMG_UNFLG_DT,

#end

        M.CNTR_DMG_FLG AS damage,
        M.CNTR_DISP_FLG AS disposal,
        M.IMDT_EXT_FLG AS imdtExit ,
        M.CNTR_HNGR_RCK_FLG AS hngrRack
   FROM CTM_MOVEMENT    M,
        MST_CONTAINER   C

#if (${mtymvmt} != 'MTOPOP-MT')
        ,BKG_BOOKING     B
#end
        
#if(${period} == 'D' || ${period} == 'M')
  WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999 
#else
  WHERE M.CNMV_EVNT_DT	BETWEEN	( 
							SELECT TO_DATE(K.WK_ST_DT,'YYYYMMDD') + .0
							FROM   EQR_WK_PRD k
							WHERE  K.PLN_YR||K.PLN_WK = @[from]
							)	
			AND				( 
							 SELECT TO_DATE(K.WK_END_DT,'YYYYMMDD') + .99999
							 FROM   EQR_WK_PRD k
							 WHERE  K.PLN_YR||K.PLN_WK = @[to]
							) 
#end
#if (${mtymvmt} != '')
    AND M.MVMT_STS_CD = SUBSTR(@[mtymvmt],0,2)
#end
    AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
    AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${soc} == 'E')
    AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
    AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end

#if (${mtymvmt} == 'MTIDMG')
    AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
#end

#if (${mtymvmt} != 'MTOPOP-MT')
    AND M.BKG_NO    = B.BKG_NO(+)
#end

#if (${inquiryLevel} == 'Y')
    AND M.ORG_YD_CD = @[location]
#else
    AND M.ORG_YD_CD IN (
                        SELECT  /*+ ORDERED USE_NL( G L Y )  */
                               Y.YD_CD
                          FROM MDM_EQ_ORZ_CHT G,
                               MDM_LOCATION L,
                               MDM_YARD Y
                         WHERE Y.LOC_CD = L.LOC_CD
                           AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                           AND G.SCC_CD = @[location]     /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                           AND G.LCC_CD = @[location]   /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                           AND G.ECC_CD = @[location]   /* inquiryLevel = 'ECC'*/
#end
                        )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
    AND SUBSTR(@[mtymvmt],3,2)  = (
                                    SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                                           MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                                      FROM CTM_MOVEMENT MM
                                     WHERE MM.CNTR_NO = M.CNTR_NO
                                       AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                                           M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                                       AND ROWNUM = 1
                                  )
   /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */


#elseif(${mtymvmt} == 'MP')
  SELECT  /*+ INDEX( M XIE6CTM_MOVEMENT ) */
         COMPANY,
         CNTRNO,
         TPSZ,
         MVMT,
         YARD,
         TO_CHAR(EVENTDATE,'YYYY-MM-DD HH24:MI') AS PRE_EVENTDATE,
         ''  AS POST_EVENTDATE,
         AUTOFLAG,
         LANE,
         TVVD,
         BKGNO,
         POR,
         POL,
         POD,
         DEL,
         DAMAGE,
         DISPOSAL,
         IMDTEXIT,
         HNGRRACK,
		 SC_RFA_NO_TAA,
		 SHPR,
 		 CNEE,
         DMG_FLG_DT, 
         DMG_UNFLG_DT
  FROM
      (
        SELECT  /*+ INDEX( M XIE6CTM_MOVEMENT ) */
               M.CNMV_CO_CD AS COMPANY,
               M.CNTR_NO AS CNTRNO,
               M.CNTR_TPSZ_CD AS TPSZ,
               'MP' AS MVMT,
               M.ORG_YD_CD AS YARD ,
               M.CNMV_EVNT_DT AS EVENTDATE,
               M.MVMT_CRE_TP_CD AS AUTOFLAG,
               B.SLAN_CD AS LANE,
               M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS TVVD,
               M.BKG_NO AS BKGNO,
               B.POR_CD as POR, /* POR CODE */
               B.POL_CD AS POL,
               B.POD_CD AS POD,
               B.DEL_CD AS DEL, /* DEL CODE */
               M.CNTR_DMG_FLG AS DAMAGE,
               M.CNTR_DISP_FLG AS DISPOSAL,
               M.IMDT_EXT_FLG AS IMDTEXIT ,
               M.CNTR_HNGR_RCK_FLG AS HNGRRACK,
	  		   B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
			   (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  CNEE,
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
        MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'FLG') AS DMG_FLG_DT, 
        MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'UNFLG') AS DMG_UNFLG_DT
          FROM CTM_MOVEMENT    M,
               MST_CONTAINER   C,
               BKG_BOOKING     B
#if(${period} == 'D' || ${period} == 'M')
         WHERE M.CNMV_EVNT_DT BETWEEN   TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#else
  WHERE M.CNMV_EVNT_DT	BETWEEN	( 
							SELECT TO_DATE(K.WK_ST_DT,'YYYYMMDD') + .0
							FROM   EQR_WK_PRD k
							WHERE  K.PLN_YR||K.PLN_WK = @[from]
							)	
			AND				( 
							 SELECT TO_DATE(K.WK_END_DT,'YYYYMMDD') + .99999
							 FROM   EQR_WK_PRD k
							 WHERE  K.PLN_YR||K.PLN_WK = @[to]
							) 
#end
#if (${mtymvmt} != '')
           AND M.MVMT_STS_CD = 'MT'
#end
           AND M.CNTR_NO    = C.CNTR_NO
#if (${tpsz} != '')
           AND M.CNTR_TPSZ_CD  IN (
      #foreach($cntrtpszcd in ${vel_tpsz_cd})
        '$cntrtpszcd',
        #end
        '')
#end
#if (${soc} == 'E')
           AND NVL(C.LSTM_CD, '  ') <> 'SH'
#elseif(${soc} == 'O')
           AND NVL(C.LSTM_CD, '  ') = 'SH'
#end
           AND NVL(M.MVMT_CRE_TP_CD,' ') NOT IN ( 'C','L' )
           
#if (${mtymvmt} != 'MTOPOP-MT')
           AND M.BKG_NO = B.BKG_NO(+)
#end

#if (${inquiryLevel} == 'Y')
           AND M.ORG_YD_CD = @[location]
#else
           AND M.ORG_YD_CD IN (
                               SELECT /*+ ORDERED USE_NL( G L Y )  */
                                      Y.YD_CD
                                 FROM MDM_EQ_ORZ_CHT G,
                                      MDM_LOCATION L,
                                      MDM_YARD Y
                                WHERE Y.LOC_CD = L.LOC_CD
                                  AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                                  AND G.SCC_CD = @[location]    /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                                  AND G.LCC_CD = @[location]    /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                                  AND G.ECC_CD = @[location]    /* inquiryLevel = 'ECC'*/
#end
                               )
#end
      /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
          AND 'XX'  = (
                        SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                              MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                          FROM CTM_MOVEMENT MM
                         WHERE MM.CNTR_NO = M.CNTR_NO
                           AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                               M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                           AND ROWNUM = 1
                      )
      /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
UNION ALL
  SELECT /*+ INDEX( M XIE6CTM_MOVEMENT ) */
         M.CNMV_CO_CD AS COMPANY,
         M.CNTR_NO AS CNTRNO,
         M.CNTR_TPSZ_CD AS TPSZ,
         'MP' AS MVMT,
         M.ORG_YD_CD AS YARD ,
         M.CNMV_EVNT_DT AS EVENTDATE,
         M.MVMT_CRE_TP_CD AS AUTOFLAG,
         B.SLAN_CD AS LANE,
         M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS TVVD,
         M.BKG_NO AS BKGNO,
         B.POR_CD as POR, /* POR CODE */
         B.POL_CD AS POL,
         B.POD_CD AS POD,
         B.DEL_CD AS DEL, /* DEL CODE */
         M.CNTR_DMG_FLG AS DAMAGE,
         M.CNTR_DISP_FLG AS DISPOSAL,
         M.IMDT_EXT_FLG AS IMDTEXIT ,
         M.CNTR_HNGR_RCK_FLG AS HNGRRACK,
		 B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		 (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
        MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'FLG') AS DMG_FLG_DT, 
        MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'UNFLG') AS DMG_UNFLG_DT
    FROM CTM_MOVEMENT    M,
         MST_CONTAINER   C,
         BKG_BOOKING     B
#if(${period} == 'D' || ${period} == 'M')
   WHERE M.CNMV_EVNT_DT BETWEEN   TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#else
	  WHERE M.CNMV_EVNT_DT	BETWEEN	( 
							SELECT TO_DATE(K.WK_ST_DT,'YYYYMMDD') + .0
							FROM   EQR_WK_PRD k
							WHERE  K.PLN_YR||K.PLN_WK = @[from]
							)	
			AND				( 
							 SELECT TO_DATE(K.WK_END_DT,'YYYYMMDD') + .99999
							 FROM   EQR_WK_PRD k
							 WHERE  K.PLN_YR||K.PLN_WK = @[to]
							) 
#end
#if (${mtymvmt} != '')
     AND M.MVMT_STS_CD = 'MT'
#end
     AND M.CNTR_NO    = C.CNTR_NO
#if (${tpsz} != '')
     AND M.CNTR_TPSZ_CD  IN (
      #foreach($cntrtpszcd in ${vel_tpsz_cd})
        '$cntrtpszcd',
        #end
        '')
#end
#if (${soc} == 'E')
     AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc  */
#elseif(${soc} == 'O')
     AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc */
#end
     AND NVL(M.MVMT_CRE_TP_CD,' ') NOT IN ( 'C','L' )
     AND M.CNMV_CYC_NO    = 1
     AND M.BKG_NO = B.BKG_NO(+)
#if (${inquiryLevel} == 'Y')
     AND M.ORG_YD_CD = @[location]
#else
     AND M.ORG_YD_CD IN (
                         SELECT /*+ ORDERED USE_NL( G L Y )  */
                               Y.YD_CD
                          FROM MDM_EQ_ORZ_CHT G,
                               MDM_LOCATION L,
                               MDM_YARD Y
                         WHERE Y.LOC_CD = L.LOC_CD
                           AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                           AND G.SCC_CD = @[location]
#elseif(${inquiryLevel} == 'L')
                           AND G.LCC_CD = @[location]
#elseif(${inquiryLevel} == 'E')
                           AND G.ECC_CD = @[location]
#end
                        )
#end
      )

#elseif(${mtymvmt} == 'MR')
  SELECT  /*+ INDEX( M XIE6CTM_MOVEMENT ) */
         COMPANY,
         CNTRNO,
         TPSZ,
         MVMT,
         YARD,
         TO_CHAR(EVENTDATE,'YYYY-MM-DD HH24:MI') AS PRE_EVENTDATE,
         ''  AS POST_EVENTDATE,
         AUTOFLAG,
         LANE,
         TVVD,
         BKGNO,
         POR,
         POL,
         POD,
         DEL,
         DAMAGE,
         DISPOSAL,
         IMDTEXIT,
         HNGRRACK,
		 SC_RFA_NO_TAA,
		 SHPR,
 		 CNEE,
		 DMG_FLG_DT,
		 DMG_UNFLG_DT
   FROM (
         SELECT /*+ INDEX( M XIE6CTM_MOVEMENT ) */
                M.CNMV_CO_CD AS COMPANY,
                M.CNTR_NO AS CNTRNO,
                M.CNTR_TPSZ_CD AS TPSZ,
                'MR' AS MVMT,
                M.ORG_YD_CD AS YARD ,
                M.CNMV_EVNT_DT AS EVENTDATE,
                M.MVMT_CRE_TP_CD AS AUTOFLAG,
                B.SLAN_CD AS LANE,
                M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS TVVD,
                M.BKG_NO AS BKGNO,
                B.POR_CD as POR,  /* POR CODE */
                B.POL_CD AS POL,
                B.POD_CD AS POD,
                B.DEL_CD AS DEL,  /* DEL CODE */
                M.CNTR_DMG_FLG AS DAMAGE,
                M.CNTR_DISP_FLG AS DISPOSAL,
                M.IMDT_EXT_FLG AS IMDTEXIT ,
                M.CNTR_HNGR_RCK_FLG AS HNGRRACK,
		 		B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		  	 	(SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'FLG') AS DMG_FLG_DT, 
        MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'UNFLG') AS DMG_UNFLG_DT
           FROM CTM_MOVEMENT      M,
                CIM_TP_SZ_DP_SEQ_V  S,
                MST_CONTAINER     C,
                BKG_BOOKING       B
#if (${period} == 'D' || ${period} == 'M')
          WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#else
	  WHERE M.CNMV_EVNT_DT	BETWEEN	( 
							SELECT TO_DATE(K.WK_ST_DT,'YYYYMMDD') + .0
							FROM   EQR_WK_PRD k
							WHERE  K.PLN_YR||K.PLN_WK = @[from]
							)	
			AND				( 
							 SELECT TO_DATE(K.WK_END_DT,'YYYYMMDD') + .99999
							 FROM   EQR_WK_PRD k
							 WHERE  K.PLN_YR||K.PLN_WK = @[to]
							) 
#end
#if (${mtymvmt} != '')
            AND M.MVMT_STS_CD = 'MT'
#end
            AND M.CNTR_TPSZ_CD = S.CNTR_TPSZ_CD
            AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
            AND M.CNTR_TPSZ_CD  IN (
      #foreach($cntrtpszcd in ${vel_tpsz_cd})
        '$cntrtpszcd',
        #end
        '')
#end
#if (${soc} == 'E')
            AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
            AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end
            AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
            AND M.BKG_NO = B.BKG_NO(+)
#if (${inquiryLevel} == 'Y')
            AND M.ORG_YD_CD = @[location]
#else
            AND M.ORG_YD_CD IN (
                                SELECT  /*+ ORDERED USE_NL( G L Y )  */
                                       Y.YD_CD
                                  FROM MDM_EQ_ORZ_CHT G,
                                       MDM_LOCATION L,
                                       MDM_YARD Y
                                 WHERE Y.LOC_CD = L.LOC_CD
                                   AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                                   AND G.SCC_CD = @[location]     /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                                   AND G.LCC_CD = @[location]   /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                                   AND G.ECC_CD = @[location]   /* inquiryLevel = 'ECC'*/
#end
                                )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
            AND 'OK'  = (
                         SELECT /*+ ORDERED USE_NL(MM LL GG) INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
#if (${inquiryLevel} == 'S')
                                DECODE(GG.SCC_CD,@[location],'NO',
#elseif(${inquiryLevel} == 'L')
                                DECODE(GG.LCC_CD,@[location],'NO',
#elseif(${inquiryLevel} == 'E')
                                DECODE(GG.ECC_CD,@[location],'NO',
#elseif(${inquiryLevel} == 'Y')
                                DECODE(MM.ORG_YD_CD,@[location],'NO',
#end
                                DECODE(MM.MVMT_STS_CD,'EN','OK',
                                DECODE(MM.MVMT_STS_CD,'TN','OK','NO')))
                          --    MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                           FROM CTM_MOVEMENT  MM,
                                MDM_LOCATION  LL,
                                MDM_EQ_ORZ_CHT  GG
                          WHERE MM.CNTR_NO = M.CNTR_NO
                            AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                                M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                            AND SUBSTR(MM.ORG_YD_CD, 1, 5)  = LL.LOC_CD
                            AND LL.SCC_CD = GG.SCC_CD
                            AND ROWNUM    = 1
                         )
      /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
  )
#elseif(${mtymvmt} == 'MT')
  SELECT  /*+ index( m xie6ctm_movement ) */
         M.CNMV_CO_CD AS company,
         M.CNTR_NO AS cntrNo,
         M.CNTR_TPSZ_CD AS tpsz,
         'MG' AS mvmt,
         M.ORG_YD_CD AS yard ,
         TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS PRE_EVENTDATE,
         '' AS POST_EVENTDATE,
         M.MVMT_CRE_TP_CD AS autoFlag,
         B.SLAN_CD AS lane,
         M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS tVvd,
         M.BKG_NO AS bkgNo,
         B.POR_CD as por, /* POR CODE */
         B.POL_CD AS pol,
         B.POD_CD AS pod,
         B.DEL_CD AS del, /* DEL CODE */
         M.CNTR_DMG_FLG AS damage,
         M.CNTR_DISP_FLG AS disposal,
         M.IMDT_EXT_FLG AS imdtExit ,
         M.CNTR_HNGR_RCK_FLG AS hngrRack,
 		 B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		 (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'FLG') AS DMG_FLG_DT, 
        MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'UNFLG') AS DMG_UNFLG_DT
    FROM CTM_MOVEMENT     M,
         MST_CONTAINER    C,
         BKG_BOOKING      B
#if(${period} == 'D' || ${period} == 'M')
   WHERE M.CNMV_EVNT_DT BETWEEN   TO_DATE( @[from], 'YYYYMMDD') + .0
     AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#else
	  WHERE M.CNMV_EVNT_DT	BETWEEN	( 
							SELECT TO_DATE(K.WK_ST_DT,'YYYYMMDD') + .0
							FROM   EQR_WK_PRD k
							WHERE  K.PLN_YR||K.PLN_WK = @[from]
							)	
			AND				( 
							 SELECT TO_DATE(K.WK_END_DT,'YYYYMMDD') + .99999
							 FROM   EQR_WK_PRD k
							 WHERE  K.PLN_YR||K.PLN_WK = @[to]
							) 
#end
#if (${mtymvmt} != '')
     AND M.MVMT_STS_CD = 'MT'
#end
     AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
     AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${soc} == 'E')
     AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc  */
#elseif(${soc} == 'O')
     AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc */
#end
     AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
     AND M.BKG_NO   = B.BKG_NO(+)
#if (${inquiryLevel} == 'Y')
     AND M.ORG_YD_CD = @[location]
#else
     AND M.ORG_YD_CD IN (
                         SELECT /*+ ORDERED USE_NL( G L Y )  */
                                Y.YD_CD
                           FROM MDM_EQ_ORZ_CHT G,
                                MDM_LOCATION L,
                                MDM_YARD Y
                          WHERE Y.LOC_CD = L.LOC_CD
                            AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                            AND G.SCC_CD = @[location] /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                            AND G.LCC_CD = @[location]    /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                            AND G.ECC_CD = @[location]    /* inquiryLevel = 'ECC'*/
#end
                      )
    #end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
    AND   'ID'  = (
                   SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                           MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                     FROM CTM_MOVEMENT MM
                    WHERE MM.CNTR_NO = M.CNTR_NO
                      AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                          M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                      AND ROWNUM = 1
                  )
    /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
UNION ALL
  SELECT  /*+ INDEX( M XIE6CTM_MOVEMENT ) */
         M.CNMV_CO_CD AS COMPANY,
         M.CNTR_NO AS CNTRNO,
         M.CNTR_TPSZ_CD AS TPSZ,
         'MP' AS MVMT,
         M.ORG_YD_CD AS YARD ,
         TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS PRE_EVENTDATE,
         '' AS POST_EVENTDATE,
         M.MVMT_CRE_TP_CD AS AUTOFLAG,
         B.SLAN_CD AS LANE,
         M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS TVVD,
         M.BKG_NO AS BKGNO,
         B.POR_CD as POR, /* POR CODE */
         B.POL_CD AS POL,
         B.POD_CD AS POD,
         B.DEL_CD AS DEL, /* DEL CODE */
         M.CNTR_DMG_FLG AS DAMAGE,
         M.CNTR_DISP_FLG AS DISPOSAL,
         M.IMDT_EXT_FLG AS IMDTEXIT ,
         M.CNTR_HNGR_RCK_FLG AS HNGRRACK,
 		 B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		 (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'FLG') AS DMG_FLG_DT, 
        MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'UNFLG') AS DMG_UNFLG_DT
    FROM CTM_MOVEMENT    M,
         MST_CONTAINER   C,
         BKG_BOOKING     B
#if(${period} == 'D' || ${period} == 'M')
   WHERE M.CNMV_EVNT_DT BETWEEN   TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#else
	  WHERE M.CNMV_EVNT_DT	BETWEEN	( 
							SELECT TO_DATE(K.WK_ST_DT,'YYYYMMDD') + .0
							FROM   EQR_WK_PRD k
							WHERE  K.PLN_YR||K.PLN_WK = @[from]
							)	
			AND				( 
							 SELECT TO_DATE(K.WK_END_DT,'YYYYMMDD') + .99999
							 FROM   EQR_WK_PRD k
							 WHERE  K.PLN_YR||K.PLN_WK = @[to]
							) 
#end
#if (${mtymvmt} != '')
     AND M.MVMT_STS_CD = 'MT'
#end
     AND M.CNTR_NO    = C.CNTR_NO
#if (${tpsz} != '')
     AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${soc} == 'E')
     AND NVL(C.LSTM_CD, '  ') <> 'SH'
#elseif(${soc} == 'O')
     AND NVL(C.LSTM_CD, '  ') = 'SH'
#end
     AND NVL(M.MVMT_CRE_TP_CD,' ') NOT IN ( 'C','L' )
     AND M.BKG_NO = B.BKG_NO(+)
#if (${inquiryLevel} == 'Y')
     AND M.ORG_YD_CD = @[location]
#else
     AND M.ORG_YD_CD IN (
                         SELECT   /*+ ORDERED USE_NL( G L Y )  */
                                Y.YD_CD
                           FROM MDM_EQ_ORZ_CHT G,
                                MDM_LOCATION L,
                                MDM_YARD Y
                          WHERE Y.LOC_CD = L.LOC_CD
                            AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                            AND G.SCC_CD = @[location] /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                            AND G.LCC_CD = @[location] /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                            AND G.ECC_CD = @[location] /* inquiryLevel = 'ECC'*/
#end
                        )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
     AND 'XX' = (
                  SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                        MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                    FROM CTM_MOVEMENT MM
                   WHERE MM.CNTR_NO = M.CNTR_NO
                     AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                         M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                     AND ROWNUM = 1
                )
    /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
UNION ALL
  SELECT  /*+ INDEX( M XIE6CTM_MOVEMENT ) */
        M.CNMV_CO_CD AS COMPANY,
        M.CNTR_NO AS CNTRNO,
        M.CNTR_TPSZ_CD AS TPSZ,
        'MP' AS MVMT,
        M.ORG_YD_CD AS YARD ,
        TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS PRE_EVENTDATE,
        '' AS POST_EVENTDATE,
        M.MVMT_CRE_TP_CD AS AUTOFLAG,
        B.SLAN_CD AS LANE,
        M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS TVVD,
        M.BKG_NO AS BKGNO,
        B.POR_CD as POR,  /* POR CODE */
        B.POL_CD AS POL,
        B.POD_CD AS POD,
        B.DEL_CD AS DEL,  /* DEL CODE */
        M.CNTR_DMG_FLG AS DAMAGE,
        M.CNTR_DISP_FLG AS DISPOSAL,
        M.IMDT_EXT_FLG AS IMDTEXIT ,
        M.CNTR_HNGR_RCK_FLG AS HNGRRACK,
 		B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		(SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'FLG') AS DMG_FLG_DT, 
        MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'UNFLG') AS DMG_UNFLG_DT
   FROM CTM_MOVEMENT    M,
        MST_CONTAINER   C,
        BKG_BOOKING     B

#if(${period} == 'D' || ${period} == 'M')
  WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#else
	  WHERE M.CNMV_EVNT_DT	BETWEEN	( 
							SELECT TO_DATE(K.WK_ST_DT,'YYYYMMDD') + .0
							FROM   EQR_WK_PRD k
							WHERE  K.PLN_YR||K.PLN_WK = @[from]
							)	
			AND				( 
							 SELECT TO_DATE(K.WK_END_DT,'YYYYMMDD') + .99999
							 FROM   EQR_WK_PRD k
							 WHERE  K.PLN_YR||K.PLN_WK = @[to]
							) 
#end
#if (${mtymvmt} != '')
    AND M.MVMT_STS_CD = 'MT'
#end
    AND M.CNTR_NO   = C.CNTR_NO
#if (${tpsz} != '')
    AND  M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${soc} == 'E')
    AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
    AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end
    AND NVL(M.MVMT_CRE_TP_CD,' ') NOT IN ( 'C','L' )
    AND M.CNMV_CYC_NO   = 1
    AND M.BKG_NO = B.BKG_NO(+)
#if (${inquiryLevel} == 'Y')
    AND M.ORG_YD_CD = @[location]
#else
    AND M.ORG_YD_CD IN (
                        SELECT  /*+ ORDERED USE_NL( G L Y )  */
                               Y.YD_CD
                          FROM MDM_EQ_ORZ_CHT G,
                               MDM_LOCATION L,
                               MDM_YARD Y
                         WHERE Y.LOC_CD = L.LOC_CD
                           AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                           AND G.SCC_CD = @[location]
#elseif(${inquiryLevel} == 'L')
                           AND G.LCC_CD = @[location]
#elseif(${inquiryLevel} == 'E')
                           AND G.ECC_CD = @[location]
#end
                       )
#end
UNION ALL
  SELECT  /*+ INDEX( M XIE6CTM_MOVEMENT ) */
        M.CNMV_CO_CD AS COMPANY,
        M.CNTR_NO AS CNTRNO,
        M.CNTR_TPSZ_CD AS TPSZ,
        'MR' AS MVMT,
        M.ORG_YD_CD AS YARD ,
        TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS PRE_EVENTDATE,
        '' AS POST_EVENTDATE,
        M.MVMT_CRE_TP_CD AS AUTOFLAG,
        B.SLAN_CD AS LANE,
        M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS TVVD,
        M.BKG_NO AS BKGNO,
        B.POR_CD as POR,  /* POR CODE */
        B.POL_CD AS POL,
        B.POD_CD AS POD,
        B.DEL_CD AS DEL,  /* DEL CODE */
        M.CNTR_DMG_FLG AS DAMAGE,
        M.CNTR_DISP_FLG AS DISPOSAL,
        M.IMDT_EXT_FLG AS IMDTEXIT ,
        M.CNTR_HNGR_RCK_FLG AS HNGRRACK,
 		B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		(SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'FLG') AS DMG_FLG_DT, 
        MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'UNFLG') AS DMG_UNFLG_DT
   FROM CTM_MOVEMENT      M,
        CIM_TP_SZ_DP_SEQ_V  S,
        MST_CONTAINER     C,
        BKG_BOOKING       B
#if (${period} == 'D' || ${period} == 'M')
  WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#else
	  WHERE M.CNMV_EVNT_DT	BETWEEN	( 
							SELECT TO_DATE(K.WK_ST_DT,'YYYYMMDD') + .0
							FROM   EQR_WK_PRD k
							WHERE  K.PLN_YR||K.PLN_WK = @[from]
							)	
			AND				( 
							 SELECT TO_DATE(K.WK_END_DT,'YYYYMMDD') + .99999
							 FROM   EQR_WK_PRD k
							 WHERE  K.PLN_YR||K.PLN_WK = @[to]
							) 
#end
#if (${mtymvmt} != '')
    AND M.MVMT_STS_CD = 'MT'
#end
    AND M.CNTR_TPSZ_CD = S.CNTR_TPSZ_CD
    AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
    AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${soc} == 'E')
    AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
    AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end
    AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
    AND M.BKG_NO = B.BKG_NO(+)
#if (${inquiryLevel} == 'Y')
    AND M.ORG_YD_CD = @[location]
#else
    AND M.ORG_YD_CD IN (
                        SELECT  /*+ ORDERED USE_NL( G L Y )  */
                               Y.YD_CD
                          FROM MDM_EQ_ORZ_CHT G,
                               MDM_LOCATION L,
                               MDM_YARD Y
                         WHERE Y.LOC_CD = L.LOC_CD
                           AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
     AND G.SCC_CD = @[location]     /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
     AND G.LCC_CD = @[location]   /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
     AND G.ECC_CD = @[location]   /* inquiryLevel = 'ECC'*/
#end
                       )
#end
      /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
     AND 'OK' = (
                 SELECT /*+ ORDERED USE_NL(MM LL GG) INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
#if (${inquiryLevel} == 'S')
                        DECODE(GG.SCC_CD,@[location],'NO',
#elseif(${inquiryLevel} == 'L')
                        DECODE(GG.LCC_CD,@[location],'NO',
#elseif(${inquiryLevel} == 'E')
                        DECODE(GG.ECC_CD,@[location],'NO',
#elseif(${inquiryLevel} == 'Y')
                        DECODE(MM.ORG_YD_CD,@[location],'NO',
#end
                        DECODE(MM.MVMT_STS_CD,'EN','OK',
                        DECODE(MM.MVMT_STS_CD,'TN','OK','NO')))

                  --    MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                  FROM CTM_MOVEMENT MM,
                       MDM_LOCATION LL,
                       MDM_EQ_ORZ_CHT GG
                 WHERE MM.CNTR_NO = M.CNTR_NO
                   AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                       M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                   AND SUBSTR(MM.ORG_YD_CD, 1, 5) = LL.LOC_CD
                   AND LL.SCC_CD  = GG.SCC_CD
                   AND ROWNUM   = 1
                  )
    /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
UNION ALL
  SELECT  /*+ index( m xie6ctm_movement ) */
         M.CNMV_CO_CD AS company,
         M.CNTR_NO AS cntrNo,
         M.CNTR_TPSZ_CD AS tpsz,
         'VD-MT' AS mvmt,
         M.ORG_YD_CD AS yard ,
         (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                 TO_CHAR(MM.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI')  /*  PRE_MVMT_EVNT_DT */
            FROM CTM_MOVEMENT MM
           WHERE MM.CNTR_NO = M.CNTR_NO
             AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                 M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
             AND MM.MVMT_STS_CD = 'VD'
             AND ROWNUM = 1) AS PRE_EVENTDATE,
         TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS POST_EVENTDATE,
         M.MVMT_CRE_TP_CD AS autoFlag,
         B.SLAN_CD AS lane,
         M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS tVvd,
         M.BKG_NO AS bkgNo,
         B.POR_CD as por, /* POR CODE */
         B.POL_CD AS pol,
         B.POD_CD AS pod,
         B.DEL_CD AS del, /* DEL CODE */
         M.CNTR_DMG_FLG AS damage,
         M.CNTR_DISP_FLG AS disposal,
         M.IMDT_EXT_FLG AS imdtExit ,
         M.CNTR_HNGR_RCK_FLG AS hngrRack,
 		 B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		 (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'FLG') AS DMG_FLG_DT, 
        MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'UNFLG') AS DMG_UNFLG_DT
   FROM CTM_MOVEMENT    M,
        MST_CONTAINER   C,
        BKG_BOOKING     B
#if(${period} == 'D' || ${period} == 'M')
   WHERE M.CNMV_EVNT_DT BETWEEN   TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#else
	  WHERE M.CNMV_EVNT_DT	BETWEEN	( 
							SELECT TO_DATE(K.WK_ST_DT,'YYYYMMDD') + .0
							FROM   EQR_WK_PRD k
							WHERE  K.PLN_YR||K.PLN_WK = @[from]
							)	
			AND				( 
							 SELECT TO_DATE(K.WK_END_DT,'YYYYMMDD') + .99999
							 FROM   EQR_WK_PRD k
							 WHERE  K.PLN_YR||K.PLN_WK = @[to]
							) 
#end
#if (${mtymvmt} != '')
     AND M.MVMT_STS_CD = 'MT'
#end
     AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
     AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${soc} == 'E')
     AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc  */
#elseif(${soc} == 'O')
     AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc */
#end
  --AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
     AND M.BKG_NO   = B.BKG_NO(+)
#if (${inquiryLevel} == 'Y')
     AND M.ORG_YD_CD = @[location]
#else
     AND M.ORG_YD_CD IN (
                         SELECT /*+ ORDERED USE_NL( G L Y )  */
                                Y.YD_CD
                           FROM MDM_EQ_ORZ_CHT G,
                                MDM_LOCATION L,
                                MDM_YARD Y
                          WHERE Y.LOC_CD = L.LOC_CD
                            AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                            AND G.SCC_CD = @[location]    /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                            AND G.LCC_CD = @[location]    /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                            AND G.ECC_CD = @[location]    /* inquiryLevel = 'ECC'*/
#end
                         )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
     AND 'VD' = (
                  SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                        MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                    FROM CTM_MOVEMENT MM
                   WHERE MM.CNTR_NO = M.CNTR_NO
                     AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                         M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                     AND ROWNUM = 1
                )
    /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */

#elseif(${mtymvmt} == 'VL')

  SELECT  /*+ index( m xie6ctm_movement ) */
         M.CNMV_CO_CD AS company,
         M.CNTR_NO AS cntrNo,
         M.CNTR_TPSZ_CD AS tpsz,
         'OC-VL' AS mvmt,
         M.ORG_YD_CD AS yard ,
        (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                TO_CHAR(MM.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI')  /*  pre_mvmt_evnt_dt */
           FROM CTM_MOVEMENT MM
          WHERE MM.CNTR_NO = M.CNTR_NO
            AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
            AND MM.MVMT_STS_CD = 'OC'
            AND ROWNUM = 1) AS PRE_EVENTDATE,
         TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS POST_EVENTDATE,
         M.MVMT_CRE_TP_CD AS autoFlag,
         B.SLAN_CD AS lane,
         M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS tVvd,
         M.BKG_NO AS bkgNo,
         B.POR_CD as por, /* POR CODE */
         B.POL_CD AS pol,
         B.POD_CD AS pod,
         B.DEL_CD AS del, /* DEL CODE */
         M.CNTR_DMG_FLG AS damage,
         M.CNTR_DISP_FLG AS disposal,
         M.IMDT_EXT_FLG AS imdtExit ,
         M.CNTR_HNGR_RCK_FLG AS hngrRack,
 		 B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		(SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'FLG') AS DMG_FLG_DT, 
        MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'UNFLG') AS DMG_UNFLG_DT
   FROM CTM_MOVEMENT    M,
        MST_CONTAINER   C,
        BKG_BOOKING     B
#if(${period} == 'D' || ${period} == 'M')
  WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0
    AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#else
	  WHERE M.CNMV_EVNT_DT	BETWEEN	( 
							SELECT TO_DATE(K.WK_ST_DT,'YYYYMMDD') + .0
							FROM   EQR_WK_PRD k
							WHERE  K.PLN_YR||K.PLN_WK = @[from]
							)	
			AND				( 
							 SELECT TO_DATE(K.WK_END_DT,'YYYYMMDD') + .99999
							 FROM   EQR_WK_PRD k
							 WHERE  K.PLN_YR||K.PLN_WK = @[to]
							) 
#end
#if (${mtymvmt} != '')
    AND M.MVMT_STS_CD = 'VL'
#end
    AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
    AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${soc} == 'E')
    AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
    AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end

#if (${mtymvmt} == 'MTIDMG')
    AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
#end

    AND M.BKG_NO    = B.BKG_NO(+)
#if (${inquiryLevel} == 'Y')
    AND M.ORG_YD_CD = @[location]
#else
    AND M.ORG_YD_CD IN (
                        SELECT  /*+ ORDERED USE_NL( G L Y )  */
                              Y.YD_CD
                          FROM MDM_EQ_ORZ_CHT G,
                               MDM_LOCATION L,
                               MDM_YARD Y
                         WHERE Y.LOC_CD = L.LOC_CD
                           AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                           AND G.SCC_CD = @[location]   /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                           AND G.LCC_CD = @[location]   /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                           AND G.ECC_CD = @[location]   /* inquiryLevel = 'ECC'*/
#end
                        )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
    AND 'OC'  = (
                 SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                        MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                   FROM CTM_MOVEMENT MM
                  WHERE MM.CNTR_NO = M.CNTR_NO
                    AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                        M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                    AND ROWNUM = 1
                )
    /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */

#if (${bound} == 'N')
    AND M.OB_CNTR_FLG = 'N'   /* 'N':Inbound, 'Y':Outbound */
#elseif(${bound} == 'Y')
    AND M.OB_CNTR_FLG = 'Y'   /* 'N':Inbound, 'Y':Outbound */
#end

UNION ALL
  SELECT  /*+ index( m xie6ctm_movement ) */
         M.CNMV_CO_CD AS company,
         M.CNTR_NO AS cntrNo,
         M.CNTR_TPSZ_CD AS tpsz,
         'TS-VL' AS mvmt,
         M.ORG_YD_CD AS yard ,
         (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                 TO_CHAR(MM.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI')  /*  pre_mvmt_evnt_dt */
            FROM CTM_MOVEMENT MM
           WHERE MM.CNTR_NO = M.CNTR_NO
             AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                 M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
             AND MM.MVMT_STS_CD = 'TS'
             AND ROWNUM = 1) AS PRE_EVENTDATE,
         TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS POST_EVENTDATE,
         M.MVMT_CRE_TP_CD AS autoFlag,
         B.SLAN_CD AS lane,
         M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS tVvd,
         M.BKG_NO AS bkgNo,
         B.POR_CD as por, /* POR CODE */
         B.POL_CD AS pol,
         B.POD_CD AS pod,
         B.DEL_CD AS del, /* DEL CODE */
         M.CNTR_DMG_FLG AS damage,
         M.CNTR_DISP_FLG AS disposal,
         M.IMDT_EXT_FLG AS imdtExit ,
         M.CNTR_HNGR_RCK_FLG AS hngrRack,
 		 B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		 (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'FLG') AS DMG_FLG_DT, 
        MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'UNFLG') AS DMG_UNFLG_DT
   FROM CTM_MOVEMENT    M,
        MST_CONTAINER   C,
        BKG_BOOKING     B
#if(${period} == 'D' || ${period} == 'M')
  WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0
    AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#else
	  WHERE M.CNMV_EVNT_DT	BETWEEN	( 
							SELECT TO_DATE(K.WK_ST_DT,'YYYYMMDD') + .0
							FROM   EQR_WK_PRD k
							WHERE  K.PLN_YR||K.PLN_WK = @[from]
							)	
			AND				( 
							 SELECT TO_DATE(K.WK_END_DT,'YYYYMMDD') + .99999
							 FROM   EQR_WK_PRD k
							 WHERE  K.PLN_YR||K.PLN_WK = @[to]
							) 
#end
#if (${mtymvmt} != '')
    AND M.MVMT_STS_CD = 'VL'
#end
    AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
    AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${soc} == 'E')
    AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
    AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end

#if (${mtymvmt} == 'MTIDMG')
    AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
#end

    AND M.BKG_NO    = B.BKG_NO(+)
#if (${inquiryLevel} == 'Y')
    AND M.ORG_YD_CD = @[location]
#else
    AND M.ORG_YD_CD IN (
                        SELECT /*+ ORDERED USE_NL( G L Y )  */
                               Y.YD_CD
                          FROM MDM_EQ_ORZ_CHT G,
                               MDM_LOCATION L,
                               MDM_YARD Y
                         WHERE Y.LOC_CD = L.LOC_CD
                           AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                           AND G.SCC_CD = @[location]     /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                           AND G.LCC_CD = @[location]   /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                           AND G.ECC_CD = @[location]   /* inquiryLevel = 'ECC'*/
#end
                       )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
    AND 'TS'  = (
                 SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                        MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                  FROM CTM_MOVEMENT MM
                 WHERE MM.CNTR_NO = M.CNTR_NO
                   AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                       M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                   AND ROWNUM = 1
                )
    /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */

#if (${bound} == 'N')
    AND M.OB_CNTR_FLG = 'N'   /* 'N':Inbound, 'Y':Outbound */
#elseif(${bound} == 'Y')
    AND M.OB_CNTR_FLG = 'Y'   /* 'N':Inbound, 'Y':Outbound */
#end

#elseif(${mtymvmt} == 'VD')

  SELECT /*+ index( m xie6ctm_movement ) */
        M.CNMV_CO_CD AS company,
        M.CNTR_NO AS cntrNo,
        M.CNTR_TPSZ_CD AS tpsz,
        'VD-IC' AS mvmt,
        M.ORG_YD_CD AS yard ,
        (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                    TO_CHAR(MM.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI')  /*  pre_mvmt_evnt_dt */
             FROM CTM_MOVEMENT MM
             WHERE MM.CNTR_NO = M.CNTR_NO
               AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                     M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
               AND MM.MVMT_STS_CD = 'VD'
               AND ROWNUM = 1) AS PRE_EVENTDATE,
        TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS POST_EVENTDATE,
        M.MVMT_CRE_TP_CD AS autoFlag,
        B.SLAN_CD AS lane,
        M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS tVvd,
        M.BKG_NO AS bkgNo,
        B.POR_CD as por,  /* POR CODE */
        B.POL_CD AS pol,
        B.POD_CD AS pod,
        B.DEL_CD AS del,  /* DEL CODE */
        M.CNTR_DMG_FLG AS damage,
        M.CNTR_DISP_FLG AS disposal,
        M.IMDT_EXT_FLG AS imdtExit ,
        M.CNTR_HNGR_RCK_FLG AS hngrRack,
 		B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		(SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'FLG') AS DMG_FLG_DT, 
        MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'UNFLG') AS DMG_UNFLG_DT
   FROM CTM_MOVEMENT    M,
        MST_CONTAINER   C,
        BKG_BOOKING     B
#if(${period} == 'D' || ${period} == 'M')
  WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#else
	  WHERE M.CNMV_EVNT_DT	BETWEEN	( 
							SELECT TO_DATE(K.WK_ST_DT,'YYYYMMDD') + .0
							FROM   EQR_WK_PRD k
							WHERE  K.PLN_YR||K.PLN_WK = @[from]
							)	
			AND				( 
							 SELECT TO_DATE(K.WK_END_DT,'YYYYMMDD') + .99999
							 FROM   EQR_WK_PRD k
							 WHERE  K.PLN_YR||K.PLN_WK = @[to]
							) 
#end
#if (${mtymvmt} != '')
    AND M.MVMT_STS_CD = 'IC'
#end
    AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
    AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${soc} == 'E')
    AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
    AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end

#if (${mtymvmt} == 'MTIDMG')
    AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
#end

    AND M.BKG_NO    = B.BKG_NO(+)

#if (${inquiryLevel} == 'Y')
    AND M.ORG_YD_CD = @[location]
#else
    AND M.ORG_YD_CD IN (
                        SELECT /*+ ORDERED USE_NL( G L Y )  */
                               Y.YD_CD
                          FROM MDM_EQ_ORZ_CHT G,
                               MDM_LOCATION L,
                               MDM_YARD Y
                         WHERE Y.LOC_CD = L.LOC_CD
                           AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                           AND G.SCC_CD = @[location]     /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                           AND G.LCC_CD = @[location]   /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                           AND G.ECC_CD = @[location]   /* inquiryLevel = 'ECC'*/
#end
                      )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
    AND 'VD'  = (
                  SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                        MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                    FROM CTM_MOVEMENT MM
                   WHERE MM.CNTR_NO = M.CNTR_NO
                     AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                         M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                     AND ROWNUM = 1
                )
    /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */

#if (${bound} == 'N')
    AND M.OB_CNTR_FLG = 'N'   /* 'N':Inbound, 'Y':Outbound */
#elseif(${bound} == 'Y')
    AND M.OB_CNTR_FLG = 'Y'   /* 'N':Inbound, 'Y':Outbound */
#end

UNION ALL
  SELECT  /*+ index( m xie6ctm_movement ) */
        M.CNMV_CO_CD AS company,
        M.CNTR_NO AS cntrNo,
        M.CNTR_TPSZ_CD AS tpsz,
        'VD-TS' AS mvmt,
        M.ORG_YD_CD AS yard ,
        (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                TO_CHAR(MM.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI')  /*  pre_mvmt_evnt_dt */
           FROM CTM_MOVEMENT MM
          WHERE MM.CNTR_NO = M.CNTR_NO
            AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
            AND MM.MVMT_STS_CD = 'VD'
            AND ROWNUM = 1) AS PRE_EVENTDATE,
        TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS POST_EVENTDATE,
        M.MVMT_CRE_TP_CD AS autoFlag,
        B.SLAN_CD AS lane,
        M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS tVvd,
        M.BKG_NO AS bkgNo,
        B.POR_CD as por,  /* POR CODE */
        B.POL_CD AS pol,
        B.POD_CD AS pod,
        B.DEL_CD AS del,  /* DEL CODE */
        M.CNTR_DMG_FLG AS damage,
        M.CNTR_DISP_FLG AS disposal,
        M.IMDT_EXT_FLG AS imdtExit ,
        M.CNTR_HNGR_RCK_FLG AS hngrRack,
 		B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		(SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'FLG') AS DMG_FLG_DT, 
        MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'UNFLG') AS DMG_UNFLG_DT
   FROM CTM_MOVEMENT    M,
        MST_CONTAINER   C,
        BKG_BOOKING     B
#if(${period} == 'D' || ${period} == 'M')
  WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#else
	  WHERE M.CNMV_EVNT_DT	BETWEEN	( 
							SELECT TO_DATE(K.WK_ST_DT,'YYYYMMDD') + .0
							FROM   EQR_WK_PRD k
							WHERE  K.PLN_YR||K.PLN_WK = @[from]
							)	
			AND				( 
							 SELECT TO_DATE(K.WK_END_DT,'YYYYMMDD') + .99999
							 FROM   EQR_WK_PRD k
							 WHERE  K.PLN_YR||K.PLN_WK = @[to]
							) 
#end
#if (${mtymvmt} != '')
    AND M.MVMT_STS_CD = 'TS'
#end
    AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
    AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${soc} == 'E')
    AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
    AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end

#if (${mtymvmt} == 'MTIDMG')
    AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
#end

    AND M.BKG_NO    = B.BKG_NO(+)

#if (${inquiryLevel} == 'Y')
    AND M.ORG_YD_CD = @[location]
#else
    AND M.ORG_YD_CD IN (
                        SELECT /*+ ORDERED USE_NL( G L Y )  */
                               Y.YD_CD
                          FROM MDM_EQ_ORZ_CHT G,
                               MDM_LOCATION L,
                               MDM_YARD Y
                         WHERE Y.LOC_CD = L.LOC_CD
                           AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                           AND G.SCC_CD = @[location]     /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                           AND G.LCC_CD = @[location]   /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                           AND G.ECC_CD = @[location]   /* inquiryLevel = 'ECC'*/
#end
                        )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
    AND 'VD'  = (
                 SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                        MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                   FROM CTM_MOVEMENT MM
                  WHERE MM.CNTR_NO = M.CNTR_NO
                    AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                        M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                    AND ROWNUM = 1
                )
    /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */

  #if (${bound} == 'N')
    AND M.OB_CNTR_FLG = 'N'   /* 'N':Inbound, 'Y':Outbound */
  #elseif(${bound} == 'Y')
    AND M.OB_CNTR_FLG = 'Y'   /* 'N':Inbound, 'Y':Outbound */
  #end

#else
  SELECT  /*+ index( m xie6ctm_movement ) */
        M.CNMV_CO_CD AS company,
        M.CNTR_NO AS cntrNo,
        M.CNTR_TPSZ_CD AS tpsz,
        SUBSTR(@[mtymvmt],0,2) AS mvmt,
        M.ORG_YD_CD AS yard ,
        TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS PRE_EVENTDATE,
        '' AS POST_EVENTDATE,
        M.MVMT_CRE_TP_CD AS autoFlag,
        B.SLAN_CD AS lane,
        M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS tVvd,
        M.BKG_NO AS bkgNo,
        B.POR_CD AS por,  /* POR CODE */
        B.POL_CD AS pol,
        B.POD_CD AS pod,
        B.DEL_CD AS del,  /* DEL CODE */
        M.CNTR_DMG_FLG AS damage,
        M.CNTR_DISP_FLG AS disposal,
        M.IMDT_EXT_FLG AS imdtExit ,
        M.CNTR_HNGR_RCK_FLG AS hngrRack,
 		B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		(SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' '), CHR(10), ' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'FLG') AS DMG_FLG_DT, 
        MST_COMMON_PKG.MST_DMG_DT_GET_FNC(C.CNTR_NO, 'UNFLG') AS DMG_UNFLG_DT
   FROM CTM_MOVEMENT    M,
        MST_CONTAINER   C,
        BKG_BOOKING     B
#if(${period} == 'D' || ${period} == 'M')
  WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#else
	  WHERE M.CNMV_EVNT_DT	BETWEEN	( 
							SELECT TO_DATE(K.WK_ST_DT,'YYYYMMDD') + .0
							FROM   EQR_WK_PRD k
							WHERE  K.PLN_YR||K.PLN_WK = @[from]
							)	
			AND				( 
							 SELECT TO_DATE(K.WK_END_DT,'YYYYMMDD') + .99999
							 FROM   EQR_WK_PRD k
							 WHERE  K.PLN_YR||K.PLN_WK = @[to]
							) 
#end
#if (${mtymvmt} != '')
    AND M.MVMT_STS_CD = SUBSTR(@[mtymvmt],0,2)
#end

#if (${mtymvmt} == 'ENF' || ${mtymvmt} == 'TNF' || ${mtymvmt} == 'ENM' || ${mtymvmt} == 'TNM')
 #if (${mtymvmt} == 'ENF' || ${mtymvmt} == 'TNF')
    AND M.FCNTR_FLG = 'Y'
 #else
    AND M.FCNTR_FLG = 'N'
 #end
#end
    AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
    AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${soc} == 'E')
    AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
    AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end
  --AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
    AND M.BKG_NO    = B.BKG_NO(+)
#if (${inquiryLevel} == 'Y')
    AND M.ORG_YD_CD = @[location]
#else
    AND M.ORG_YD_CD IN (
                        SELECT /*+ ORDERED USE_NL( G L Y )  */
                               Y.YD_CD
                          FROM MDM_EQ_ORZ_CHT G,
                               MDM_LOCATION L,
                               MDM_YARD Y
                         WHERE Y.LOC_CD = L.LOC_CD
                           AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                           AND G.SCC_CD = @[location]    /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                           AND G.LCC_CD = @[location]    /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                           AND G.ECC_CD = @[location]    /* inquiryLevel = 'ECC'*/
#end
                       )
#end

#if (${bound} == 'N')
    AND M.OB_CNTR_FLG = 'N'   /* 'N':Inbound, 'Y':Outbound */
#elseif(${bound} == 'Y')
    AND M.OB_CNTR_FLG = 'Y'   /* 'N':Inbound, 'Y':Outbound */
#end
#end			]]></sql>
			<params>
				<param name="mtymvmt" type="12" value="MT" out="N"/>
				<param name="from" type="12" value="20091201" out="N"/>
				<param name="to" type="12" value="20091231" out="N"/>
				<param name="location" type="12" value="KRPUS" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
