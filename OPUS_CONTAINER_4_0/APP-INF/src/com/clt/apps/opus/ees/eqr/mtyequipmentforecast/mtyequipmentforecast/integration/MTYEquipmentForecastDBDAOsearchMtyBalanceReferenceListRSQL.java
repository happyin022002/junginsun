/*=========================================================
*Copyright(c) 2014 CyberLogitec
*@FileName : MTYEquipmentForecastDBDAOsearchMtyBalanceReferenceListRSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2014.07.29
*@LastModifier : 이주현
*@LastVersion : 1.0
* 2014.07.29 이주현
* 1.0 Creation
=========================================================*/
package com.clt.apps.opus.ees.eqr.mtyequipmentforecast.mtyequipmentforecast.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.clt.framework.support.db.ISQLTemplate;

/**
 *
 * @author LEE JU HYUN
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class MTYEquipmentForecastDBDAOsearchMtyBalanceReferenceListRSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * 지점별로 향후 2 weeks의 예상 MTY 장비 Supply & Demand를 항목별로 입력된 MTY Balance의 Referential Data를 조회한다.
	  * </pre>
	  */
	public MTYEquipmentForecastDBDAOsearchMtyBalanceReferenceListRSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("loc_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("fcast_yrwk",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.clt.apps.opus.ees.eqr.mtyequipmentforecast.mtyequipmentforecast.integration").append("\n"); 
		query.append("FileName : MTYEquipmentForecastDBDAOsearchMtyBalanceReferenceListRSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("#if (${search_flag} == '2' )" ).append("\n"); 
		query.append("WITH LV_REPO_IN_WEEK AS (" ).append("\n"); 
		query.append("     SELECT " ).append("\n"); 
		query.append("            TO_DATE(A.WK_ST_DT,'YYYYMMDD') WK_ST_DT," ).append("\n"); 
		query.append("            TO_DATE(A.WK_END_DT,'YYYYMMDD') WK_END_DT1," ).append("\n"); 
		query.append("            TO_DATE(A.WK_END_DT,'YYYYMMDD')+7 WK_END_DT2," ).append("\n"); 
		query.append("            (SELECT /*+ INDEX(A XPKEQR_WK_PRD) */ A.PLN_YR||A.PLN_WK" ).append("\n"); 
		query.append("             FROM EQR_WK_PRD A" ).append("\n"); 
		query.append("             WHERE A.PLN_YR||A.PLN_WK > @[fcast_yrwk]" ).append("\n"); 
		query.append("             AND   ROWNUM = 1) FCAST_YRWK2," ).append("\n"); 
		query.append("             @[fcast_yrwk] FCAST_YRWK1" ).append("\n"); 
		query.append("     FROM EQR_WK_PRD A" ).append("\n"); 
		query.append("     WHERE A.PLN_YR = SUBSTR(@[fcast_yrwk],1,4)" ).append("\n"); 
		query.append("     AND   A.PLN_WK = SUBSTR(@[fcast_yrwk],5,2)" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${search_flag} == '2' || ${search_flag} == '3' )" ).append("\n"); 
		query.append("	#if (${search_flag} == '3' )" ).append("\n"); 
		query.append("		WITH LV_DUMMY_WEEK AS" ).append("\n"); 
		query.append("	#else" ).append("\n"); 
		query.append("		,LV_DUMMY_WEEK AS" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("	(" ).append("\n"); 
		query.append("	    SELECT /*+ INDEX_DESC(A XPKEQR_WK_PRD) */ " ).append("\n"); 
		query.append("	           1 TP,ROWNUM WK_SEQ,A.PLN_YR||A.PLN_WK AS FCAST_YRWK, @[loc_cd] LOC_CD," ).append("\n"); 
		query.append("	           A.WK_ST_DT,A.WK_END_DT, NULL WK3_ST_DT, NULL WK3_END_DT" ).append("\n"); 
		query.append("	    FROM EQR_WK_PRD A" ).append("\n"); 
		query.append("	    WHERE PLN_YR||PLN_WK  < @[fcast_yrwk]" ).append("\n"); 
		query.append("	    AND   ROWNUM <=4" ).append("\n"); 
		query.append("	    UNION ALL" ).append("\n"); 
		query.append("	    SELECT TP,WK_SEQ,FCAST_YRWK,LOC_CD,WK_ST_DT,WK_END_DT," ).append("\n"); 
		query.append("	           MIN(WK_ST_DT) OVER(ORDER BY WK_ST_DT) AS WK3_ST_DT," ).append("\n"); 
		query.append("	           MAX(WK_END_DT) OVER(ORDER BY WK_END_DT DESC) AS WK3_END_DT" ).append("\n"); 
		query.append("	    FROM " ).append("\n"); 
		query.append("	        (SELECT /*+ INDEX(A XPKEQR_WK_PRD) */ " ).append("\n"); 
		query.append("	              2 TP,ROWNUM WK_SEQ,A.PLN_YR||A.PLN_WK AS FCAST_YRWK, @[loc_cd] LOC_CD," ).append("\n"); 
		query.append("	              A.WK_ST_DT,A.WK_END_DT" ).append("\n"); 
		query.append("	        FROM EQR_WK_PRD A" ).append("\n"); 
		query.append("	        WHERE PLN_YR||PLN_WK >= @[fcast_yrwk]" ).append("\n"); 
		query.append("	        AND   ROWNUM <=3)" ).append("\n"); 
		query.append("	)" ).append("\n"); 
		query.append("	,LV_YD_LIST AS" ).append("\n"); 
		query.append("	(" ).append("\n"); 
		query.append("	SELECT /*+ use_nl(a b c) */ C.YD_CD, A.SCC_CD" ).append("\n"); 
		query.append("	FROM MDM_EQ_ORZ_CHT A,MDM_LOCATION B,MDM_YARD C" ).append("\n"); 
		query.append("	WHERE A.ECC_CD = @[loc_cd]" ).append("\n"); 
		query.append("	AND   A.SCC_CD = B.SCC_CD" ).append("\n"); 
		query.append("	AND   B.LOC_CD = C.LOC_CD" ).append("\n"); 
		query.append("	)" ).append("\n"); 
		query.append("	" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("SELECT" ).append("\n"); 
		query.append("     A.DP_SEQ" ).append("\n"); 
		query.append("    ,A.TITLE" ).append("\n"); 
		query.append("    ,A.ITEM" ).append("\n"); 
		query.append("    ,TO_CHAR(A.D2_FCAST_QTY+A.D4_FCAST_QTY+A.D5_FCAST_QTY+A.D7_FCAST_QTY+A.R2_FCAST_QTY+A.R5_FCAST_QTY+A.O2_FCAST_QTY+A.S2_FCAST_QTY+A.O4_FCAST_QTY+A.S4_FCAST_QTY+A.F2_FCAST_QTY+A.A2_FCAST_QTY+A.F4_FCAST_QTY+A.A4_FCAST_QTY+A.F5_FCAST_QTY,'9,999,999')   G_TOTAL" ).append("\n"); 
		query.append("    ,TO_CHAR(A.D2_FCAST_QTY+A.D4_FCAST_QTY+A.D5_FCAST_QTY+A.D7_FCAST_QTY,'9,999,999')   D_TOTAL" ).append("\n"); 
		query.append("    ,TO_CHAR(A.D2_FCAST_QTY,'9,999,999') D2_FCAST_QTY" ).append("\n"); 
		query.append("    ,TO_CHAR(A.D4_FCAST_QTY,'9,999,999') D4_FCAST_QTY" ).append("\n"); 
		query.append("    ,TO_CHAR(A.D5_FCAST_QTY,'9,999,999') D5_FCAST_QTY" ).append("\n"); 
		query.append("    ,TO_CHAR(A.D7_FCAST_QTY,'9,999,999') D7_FCAST_QTY" ).append("\n"); 
		query.append("    ,TO_CHAR(A.R2_FCAST_QTY+A.R5_FCAST_QTY+A.O2_FCAST_QTY+A.S2_FCAST_QTY+A.O4_FCAST_QTY+A.S4_FCAST_QTY+A.F2_FCAST_QTY+A.A2_FCAST_QTY+A.F4_FCAST_QTY+A.A4_FCAST_QTY+A.F5_FCAST_QTY,'9,999,999') S_TOTAL" ).append("\n"); 
		query.append("    " ).append("\n"); 
		query.append("    ,TO_CHAR(A.R2_FCAST_QTY,'9,999,999') R2_FCAST_QTY   " ).append("\n"); 
		query.append("    ,TO_CHAR(A.R5_FCAST_QTY,'9,999,999') R5_FCAST_QTY  " ).append("\n"); 
		query.append("    ,TO_CHAR(A.O2_FCAST_QTY,'9,999,999') O2_FCAST_QTY  " ).append("\n"); 
		query.append("    ,TO_CHAR(A.S2_FCAST_QTY,'9,999,999') S2_FCAST_QTY  " ).append("\n"); 
		query.append("    ,TO_CHAR(A.O4_FCAST_QTY,'9,999,999') O4_FCAST_QTY  " ).append("\n"); 
		query.append("    ,TO_CHAR(A.S4_FCAST_QTY,'9,999,999') S4_FCAST_QTY  " ).append("\n"); 
		query.append("    ,TO_CHAR(A.F2_FCAST_QTY,'9,999,999') F2_FCAST_QTY  " ).append("\n"); 
		query.append("    ,TO_CHAR(A.A2_FCAST_QTY,'9,999,999') A2_FCAST_QTY  " ).append("\n"); 
		query.append("    ,TO_CHAR(A.F4_FCAST_QTY,'9,999,999') F4_FCAST_QTY  " ).append("\n"); 
		query.append("    ,TO_CHAR(A.A4_FCAST_QTY,'9,999,999') A4_FCAST_QTY  " ).append("\n"); 
		query.append("    ,TO_CHAR(A.F5_FCAST_QTY,'9,999,999') F5_FCAST_QTY  " ).append("\n"); 
		query.append("FROM" ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("    SELECT " ).append("\n"); 
		query.append("         A.DP_SEQ" ).append("\n"); 
		query.append("        ,A.TITLE" ).append("\n"); 
		query.append("        ,A.ITEM" ).append("\n"); 
		query.append("        ,A.D2_QTY   D2_FCAST_QTY" ).append("\n"); 
		query.append("        ,A.D4_QTY   D4_FCAST_QTY" ).append("\n"); 
		query.append("        ,A.D5_QTY   D5_FCAST_QTY" ).append("\n"); 
		query.append("        ,A.D7_QTY   D7_FCAST_QTY" ).append("\n"); 
		query.append("        ,A.R2_QTY   R2_FCAST_QTY" ).append("\n"); 
		query.append("        ,A.R5_QTY   R5_FCAST_QTY" ).append("\n"); 
		query.append("        ,A.O2_QTY   O2_FCAST_QTY" ).append("\n"); 
		query.append("        ,A.S2_QTY   S2_FCAST_QTY" ).append("\n"); 
		query.append("        ,A.O4_QTY   O4_FCAST_QTY" ).append("\n"); 
		query.append("        ,A.S4_QTY   S4_FCAST_QTY" ).append("\n"); 
		query.append("        ,A.F2_QTY   F2_FCAST_QTY" ).append("\n"); 
		query.append("        ,A.A2_QTY   A2_FCAST_QTY" ).append("\n"); 
		query.append("        ,A.F4_QTY   F4_FCAST_QTY" ).append("\n"); 
		query.append("        ,A.A4_QTY   A4_FCAST_QTY" ).append("\n"); 
		query.append("        ,A.F5_QTY   F5_FCAST_QTY" ).append("\n"); 
		query.append("    FROM" ).append("\n"); 
		query.append("    (   " ).append("\n"); 
		query.append("        #if (${search_flag} == '1')" ).append("\n"); 
		query.append("            ----Sound MT,Damage MT" ).append("\n"); 
		query.append("            SELECT " ).append("\n"); 
		query.append("                B.DP_SEQ," ).append("\n"); 
		query.append("                DECODE(B.DP_SEQ, 1,'Sound MT','Damage MT') TITLE," ).append("\n"); 
		query.append("                DECODE(B.DP_SEQ, 1,'Sound MT','Damage MT') ITEM," ).append("\n"); 
		query.append("                SUM(DECODE(A.CNTR_TPSZ_CD,'D2',A.CNTR_QTY,0)) D2_QTY," ).append("\n"); 
		query.append("                SUM(DECODE(A.CNTR_TPSZ_CD,'D4',A.CNTR_QTY,0)) D4_QTY," ).append("\n"); 
		query.append("                SUM(DECODE(A.CNTR_TPSZ_CD,'D5',A.CNTR_QTY,0)) D5_QTY," ).append("\n"); 
		query.append("                SUM(DECODE(A.CNTR_TPSZ_CD,'D7',A.CNTR_QTY,0)) D7_QTY," ).append("\n"); 
		query.append("                SUM(DECODE(A.CNTR_TPSZ_CD,'R2',A.CNTR_QTY,0)) R2_QTY," ).append("\n"); 
		query.append("                SUM(DECODE(A.CNTR_TPSZ_CD,'R5',A.CNTR_QTY,0)) R5_QTY," ).append("\n"); 
		query.append("                SUM(DECODE(A.CNTR_TPSZ_CD,'O2',A.CNTR_QTY,0)) O2_QTY," ).append("\n"); 
		query.append("                SUM(DECODE(A.CNTR_TPSZ_CD,'S2',A.CNTR_QTY,0)) S2_QTY," ).append("\n"); 
		query.append("                SUM(DECODE(A.CNTR_TPSZ_CD,'O4',A.CNTR_QTY,0)) O4_QTY," ).append("\n"); 
		query.append("                SUM(DECODE(A.CNTR_TPSZ_CD,'S4',A.CNTR_QTY,0)) S4_QTY," ).append("\n"); 
		query.append("                SUM(DECODE(A.CNTR_TPSZ_CD,'F2',A.CNTR_QTY,0)) F2_QTY," ).append("\n"); 
		query.append("                SUM(DECODE(A.CNTR_TPSZ_CD,'A2',A.CNTR_QTY,0)) A2_QTY," ).append("\n"); 
		query.append("                SUM(DECODE(A.CNTR_TPSZ_CD,'F4',A.CNTR_QTY,0)) F4_QTY," ).append("\n"); 
		query.append("                SUM(DECODE(A.CNTR_TPSZ_CD,'A4',A.CNTR_QTY,0)) A4_QTY," ).append("\n"); 
		query.append("                SUM(DECODE(A.CNTR_TPSZ_CD,'F5',A.CNTR_QTY,0)) F5_QTY" ).append("\n"); 
		query.append("            FROM " ).append("\n"); 
		query.append("            (SELECT DECODE(A.DMG_FLG, 'N', 1, 2) DP_SEQ, A.CNTR_TPSZ_CD, 1 CNTR_QTY" ).append("\n"); 
		query.append("             FROM MST_CONTAINER A" ).append("\n"); 
		query.append("             WHERE A.CRNT_YD_CD LIKE @[loc_cd]||'%'" ).append("\n"); 
		query.append("             AND    A.CNMV_STS_CD = 'MT') A, (SELECT LEVEL DP_SEQ," ).append("\n"); 
		query.append("                                                  'D2' CNTR_TPSZ_CD," ).append("\n"); 
		query.append("                                                  0 CNTR_QTY" ).append("\n"); 
		query.append("                                            FROM DUAL" ).append("\n"); 
		query.append("                                            CONNECT BY LEVEL<=2) B" ).append("\n"); 
		query.append("            WHERE A.DP_SEQ (+)= B.DP_SEQ" ).append("\n"); 
		query.append("            GROUP BY B.DP_SEQ" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("        --UNION ALL" ).append("\n"); 
		query.append("        #if (${search_flag} == '2' || ${search_flag} == '3' )" ).append("\n"); 
		query.append("            ---- I/B PFMC,O/B PFMC, I/B Remaining(F~S),O/B Remaining(F~S)" ).append("\n"); 
		query.append("            SELECT" ).append("\n"); 
		query.append("                 A.DP_SEQ" ).append("\n"); 
		query.append("                ,A.TITLE" ).append("\n"); 
		query.append("                ,A.ITEM" ).append("\n"); 
		query.append("                ,A.D2_QTY" ).append("\n"); 
		query.append("                ,A.D4_QTY" ).append("\n"); 
		query.append("                ,A.D5_QTY" ).append("\n"); 
		query.append("                ,A.D7_QTY" ).append("\n"); 
		query.append("                ,A.R2_QTY" ).append("\n"); 
		query.append("                ,A.R5_QTY" ).append("\n"); 
		query.append("                ,A.O2_QTY" ).append("\n"); 
		query.append("                ,A.S2_QTY" ).append("\n"); 
		query.append("                ,A.O4_QTY" ).append("\n"); 
		query.append("                ,A.S4_QTY" ).append("\n"); 
		query.append("                ,A.F2_QTY" ).append("\n"); 
		query.append("                ,A.A2_QTY" ).append("\n"); 
		query.append("                ,A.F4_QTY" ).append("\n"); 
		query.append("                ,A.A4_QTY" ).append("\n"); 
		query.append("                ,A.F5_QTY" ).append("\n"); 
		query.append("            FROM" ).append("\n"); 
		query.append("            (" ).append("\n"); 
		query.append("                SELECT  MAX(DECODE(B.DP_SEQ,1,3,2,4,3,10,4,11)) DP_SEQ," ).append("\n"); 
		query.append("                        MAX(DECODE(B.DP_SEQ,1,'I/B PFMC',2,'I/B Remaining(F~S)',3,'O/B PFMC',4,'O/B Remaining(F~S)')) TITLE," ).append("\n"); 
		query.append("                        MAX(DECODE(B.DP_SEQ,1,'I/B PFMC',2,'I/B Remaining(F~S)',3,'O/B PFMC',4,'O/B Remaining(F~S)')) ITEM," ).append("\n"); 
		query.append("                        SUM(DECODE(A.CNTR_TPSZ_CD,'D2',DECODE(B.DP_SEQ,1,IB_QTY,2,FS_IB_QTY,3,OB_QTY,4,FS_OB_QTY),0)) D2_QTY," ).append("\n"); 
		query.append("                        SUM(DECODE(A.CNTR_TPSZ_CD,'D4',DECODE(B.DP_SEQ,1,IB_QTY,2,FS_IB_QTY,3,OB_QTY,4,FS_OB_QTY),0)) D4_QTY," ).append("\n"); 
		query.append("                        SUM(DECODE(A.CNTR_TPSZ_CD,'D5',DECODE(B.DP_SEQ,1,IB_QTY,2,FS_IB_QTY,3,OB_QTY,4,FS_OB_QTY),0)) D5_QTY," ).append("\n"); 
		query.append("                        SUM(DECODE(A.CNTR_TPSZ_CD,'D7',DECODE(B.DP_SEQ,1,IB_QTY,2,FS_IB_QTY,3,OB_QTY,4,FS_OB_QTY),0)) D7_QTY," ).append("\n"); 
		query.append("                        SUM(DECODE(A.CNTR_TPSZ_CD,'R2',DECODE(B.DP_SEQ,1,IB_QTY,2,FS_IB_QTY,3,OB_QTY,4,FS_OB_QTY),0)) R2_QTY," ).append("\n"); 
		query.append("                        SUM(DECODE(A.CNTR_TPSZ_CD,'R5',DECODE(B.DP_SEQ,1,IB_QTY,2,FS_IB_QTY,3,OB_QTY,4,FS_OB_QTY),0)) R5_QTY," ).append("\n"); 
		query.append("                        SUM(DECODE(A.CNTR_TPSZ_CD,'O2',DECODE(B.DP_SEQ,1,IB_QTY,2,FS_IB_QTY,3,OB_QTY,4,FS_OB_QTY),0)) O2_QTY," ).append("\n"); 
		query.append("                        SUM(DECODE(A.CNTR_TPSZ_CD,'S2',DECODE(B.DP_SEQ,1,IB_QTY,2,FS_IB_QTY,3,OB_QTY,4,FS_OB_QTY),0)) S2_QTY," ).append("\n"); 
		query.append("                        SUM(DECODE(A.CNTR_TPSZ_CD,'O4',DECODE(B.DP_SEQ,1,IB_QTY,2,FS_IB_QTY,3,OB_QTY,4,FS_OB_QTY),0)) O4_QTY," ).append("\n"); 
		query.append("                        SUM(DECODE(A.CNTR_TPSZ_CD,'S4',DECODE(B.DP_SEQ,1,IB_QTY,2,FS_IB_QTY,3,OB_QTY,4,FS_OB_QTY),0)) S4_QTY," ).append("\n"); 
		query.append("                        SUM(DECODE(A.CNTR_TPSZ_CD,'F2',DECODE(B.DP_SEQ,1,IB_QTY,2,FS_IB_QTY,3,OB_QTY,4,FS_OB_QTY),0)) F2_QTY," ).append("\n"); 
		query.append("                        SUM(DECODE(A.CNTR_TPSZ_CD,'A2',DECODE(B.DP_SEQ,1,IB_QTY,2,FS_IB_QTY,3,OB_QTY,4,FS_OB_QTY),0)) A2_QTY," ).append("\n"); 
		query.append("                        SUM(DECODE(A.CNTR_TPSZ_CD,'F4',DECODE(B.DP_SEQ,1,IB_QTY,2,FS_IB_QTY,3,OB_QTY,4,FS_OB_QTY),0)) F4_QTY," ).append("\n"); 
		query.append("                        SUM(DECODE(A.CNTR_TPSZ_CD,'A4',DECODE(B.DP_SEQ,1,IB_QTY,2,FS_IB_QTY,3,OB_QTY,4,FS_OB_QTY),0)) A4_QTY," ).append("\n"); 
		query.append("                        SUM(DECODE(A.CNTR_TPSZ_CD,'F5',DECODE(B.DP_SEQ,1,IB_QTY,2,FS_IB_QTY,3,OB_QTY,4,FS_OB_QTY),0)) F5_QTY" ).append("\n"); 
		query.append("                FROM " ).append("\n"); 
		query.append("                " ).append("\n"); 
		query.append("                    (SELECT /*+ use_nl(a b c d) */  " ).append("\n"); 
		query.append("                    		A.CNTR_TPSZ_CD,ROUND(SUM(A.IB_QTY)/3) IB_QTY,ROUND(SUM(A.OB_QTY)/3) OB_QTY," ).append("\n"); 
		query.append("                           0 FS_IB_QTY, -- 임시" ).append("\n"); 
		query.append("                           0 FS_OB_QTY  -- 임시" ).append("\n"); 
		query.append("                    FROM CIM_LOC_MTCH_BAK_SMRY A, LV_DUMMY_WEEK B , MDM_LOCATION C, MDM_EQ_ORZ_CHT D" ).append("\n"); 
		query.append("                    WHERE A.FULL_MTY_CD = 'F'" ).append("\n"); 
		query.append("                    AND   A.SOC_FLG = 'N'" ).append("\n"); 
		query.append("                    AND   A.ENR_FLG = 'N'" ).append("\n"); 
		query.append("                    AND   A.TGT_YRWK = B.FCAST_YRWK" ).append("\n"); 
		query.append("                    AND   A.LOC_CD = C.LOC_CD" ).append("\n"); 
		query.append("                    AND   C.SCC_CD = D.SCC_CD" ).append("\n"); 
		query.append("                    AND   D.ECC_CD = B.LOC_CD" ).append("\n"); 
		query.append("                    AND   B.TP = 1" ).append("\n"); 
		query.append("                    AND   B.WK_SEQ > 1" ).append("\n"); 
		query.append("                    GROUP BY A.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                    UNION ALL" ).append("\n"); 
		query.append("                    SELECT 'D2' CNTR_TPSZ_CD, 0,0,0,0 FROM DUAL -- DUMMY" ).append("\n"); 
		query.append("                    ) A, (SELECT LEVEL DP_SEQ  FROM DUAL CONNECT BY LEVEL <=4) B                        " ).append("\n"); 
		query.append("                GROUP BY B.DP_SEQ" ).append("\n"); 
		query.append("            ) A" ).append("\n"); 
		query.append("            #if (${search_flag} == '2')" ).append("\n"); 
		query.append("                WHERE A.DP_SEQ IN ('3','4')" ).append("\n"); 
		query.append("            #elseif (${search_flag} == '3')" ).append("\n"); 
		query.append("                WHERE A.DP_SEQ IN ('10','11')" ).append("\n"); 
		query.append("            #end" ).append("\n"); 
		query.append("        --UNION ALL" ).append("\n"); 
		query.append("        -- + Others, - Others" ).append("\n"); 
		query.append("        UNION ALL" ).append("\n"); 
		query.append("            SELECT DECODE(TP_CD,'2', 9,14) DP_SEQ," ).append("\n"); 
		query.append("                   DECODE(TP_CD,'2', '+ Others','- Others') TITLE," ).append("\n"); 
		query.append("                   DECODE(TP_CD,'2', '+ Others','- Others') ITEM," ).append("\n"); 
		query.append("                   ROUND(SUM(D2_QTY)/3) D2_QTY," ).append("\n"); 
		query.append("                   ROUND(SUM(D4_QTY)/3) D4_QTY," ).append("\n"); 
		query.append("                   ROUND(SUM(D5_QTY)/3) D5_QTY," ).append("\n"); 
		query.append("                   ROUND(SUM(D7_QTY)/3) D7_QTY," ).append("\n"); 
		query.append("                   ROUND(SUM(R2_QTY)/3) R2_QTY," ).append("\n"); 
		query.append("                   ROUND(SUM(R5_QTY)/3) R5_QTY," ).append("\n"); 
		query.append("                   ROUND(SUM(O2_QTY)/3) O2_QTY," ).append("\n"); 
		query.append("                   ROUND(SUM(S2_QTY)/3) S2_QTY," ).append("\n"); 
		query.append("                   ROUND(SUM(O4_QTY)/3) O4_QTY," ).append("\n"); 
		query.append("                   ROUND(SUM(S4_QTY)/3) S4_QTY," ).append("\n"); 
		query.append("                   ROUND(SUM(F2_QTY)/3) F2_QTY," ).append("\n"); 
		query.append("                   ROUND(SUM(A2_QTY)/3) A2_QTY," ).append("\n"); 
		query.append("                   ROUND(SUM(F4_QTY)/3) F4_QTY," ).append("\n"); 
		query.append("                   ROUND(SUM(A4_QTY)/3) A4_QTY," ).append("\n"); 
		query.append("                   ROUND(SUM(F5_QTY)/3) F5_QTY" ).append("\n"); 
		query.append("            FROM" ).append("\n"); 
		query.append("                (SELECT A.MTY_BAL_OTR_TP_CD TP_CD," ).append("\n"); 
		query.append("                        SUM(A.D2_FCAST_QTY) D2_QTY," ).append("\n"); 
		query.append("                        SUM(A.D4_FCAST_QTY) D4_QTY," ).append("\n"); 
		query.append("                        SUM(A.D5_FCAST_QTY) D5_QTY," ).append("\n"); 
		query.append("                        SUM(A.D7_FCAST_QTY) D7_QTY," ).append("\n"); 
		query.append("                        SUM(A.R2_FCAST_QTY) R2_QTY," ).append("\n"); 
		query.append("                        SUM(A.R5_FCAST_QTY) R5_QTY," ).append("\n"); 
		query.append("                        SUM(A.O2_FCAST_QTY) O2_QTY," ).append("\n"); 
		query.append("                        SUM(A.S2_FCAST_QTY) S2_QTY," ).append("\n"); 
		query.append("                        SUM(A.O4_FCAST_QTY) O4_QTY," ).append("\n"); 
		query.append("                        SUM(A.S4_FCAST_QTY) S4_QTY," ).append("\n"); 
		query.append("                        SUM(A.F2_FCAST_QTY) F2_QTY," ).append("\n"); 
		query.append("                        SUM(A.A2_FCAST_QTY) A2_QTY," ).append("\n"); 
		query.append("                        SUM(A.F4_FCAST_QTY) F4_QTY," ).append("\n"); 
		query.append("                        SUM(A.A4_FCAST_QTY) A4_QTY," ).append("\n"); 
		query.append("                        SUM(A.F5_FCAST_QTY) F5_QTY" ).append("\n"); 
		query.append("                FROM EQR_MTY_BAL_RPT_OTR A, " ).append("\n"); 
		query.append("				(" ).append("\n"); 
		query.append("				    SELECT /*+ INDEX_DESC(A XPKEQR_WK_PRD) */ " ).append("\n"); 
		query.append("				           ROWNUM WK_SEQ," ).append("\n"); 
		query.append("				           A.PLN_YR||A.PLN_WK FCAST_YRWK," ).append("\n"); 
		query.append("				           LAG(A.PLN_YR||A.PLN_WK) OVER(ORDER BY A.PLN_YR||A.PLN_WK) AS INP_YRWK" ).append("\n"); 
		query.append("				    FROM  EQR_WK_PRD A" ).append("\n"); 
		query.append("				    WHERE A.PLN_YR||A.PLN_WK  < @[fcast_yrwk]" ).append("\n"); 
		query.append("				    AND   ROWNUM <=5" ).append("\n"); 
		query.append("				) B" ).append("\n"); 
		query.append("                WHERE A.CO_CD = 'O'" ).append("\n"); 
		query.append("                AND   A.LOC_CD = @[loc_cd]" ).append("\n"); 
		query.append("                AND   A.FCAST_YRWK = B.FCAST_YRWK" ).append("\n"); 
		query.append("                AND   A.INP_YRWK  = A.INP_YRWK " ).append("\n"); 
		query.append("                #if (${search_flag} == '2')" ).append("\n"); 
		query.append("                    AND   A.MTY_BAL_OTR_TP_CD ='2'" ).append("\n"); 
		query.append("                #else" ).append("\n"); 
		query.append("                    AND   A.MTY_BAL_OTR_TP_CD ='4'" ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("                GROUP BY A.MTY_BAL_OTR_TP_CD" ).append("\n"); 
		query.append("                #if (${search_flag} == '2')" ).append("\n"); 
		query.append("                    UNION ALL" ).append("\n"); 
		query.append("                    SELECT '2' DP_SEQ, " ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("					0 " ).append("\n"); 
		query.append("                    FROM DUAL" ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("                #if (${search_flag} == '3')" ).append("\n"); 
		query.append("                    UNION ALL" ).append("\n"); 
		query.append("                    SELECT '4' DP_SEQ, " ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("                    0," ).append("\n"); 
		query.append("					0 " ).append("\n"); 
		query.append("                    FROM DUAL" ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("            GROUP BY TP_CD" ).append("\n"); 
		query.append("        #end   " ).append("\n"); 
		query.append("        #if (${search_flag} == '2')" ).append("\n"); 
		query.append("            UNION ALL" ).append("\n"); 
		query.append("            ---- COP I/B" ).append("\n"); 
		query.append("            SELECT DP_SEQ," ).append("\n"); 
		query.append("            'COP I/B' TITLE," ).append("\n"); 
		query.append("            A.FCAST_YRWK  ITEM," ).append("\n"); 
		query.append("            NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'D2',QTY,0)),0) D2_QTY," ).append("\n"); 
		query.append("            NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'D4',QTY,0)),0) D4_QTY," ).append("\n"); 
		query.append("            NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'D5',QTY,0)),0) D5_QTY," ).append("\n"); 
		query.append("            NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'D7',QTY,0)),0) D7_QTY," ).append("\n"); 
		query.append("            NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'R2',QTY,0)),0) R2_QTY," ).append("\n"); 
		query.append("            NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'R5',QTY,0)),0) R5_QTY," ).append("\n"); 
		query.append("            NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'O2',QTY,0)),0) O2_QTY," ).append("\n"); 
		query.append("            NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'S2',QTY,0)),0) S2_QTY," ).append("\n"); 
		query.append("            NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'O4',QTY,0)),0) O4_QTY," ).append("\n"); 
		query.append("            NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'S4',QTY,0)),0) S4_QTY," ).append("\n"); 
		query.append("            NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'F2',QTY,0)),0) F2_QTY," ).append("\n"); 
		query.append("            NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'A2',QTY,0)),0) A2_QTY," ).append("\n"); 
		query.append("            NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'F4',QTY,0)),0) F4_QTY," ).append("\n"); 
		query.append("            NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'A4',QTY,0)),0) A4_QTY," ).append("\n"); 
		query.append("            NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'F5',QTY,0)),0) F5_QTY" ).append("\n"); 
		query.append("            FROM" ).append("\n"); 
		query.append("            (" ).append("\n"); 
		query.append("                SELECT   " ).append("\n"); 
		query.append("                    DECODE(SIGN(F.WK_END_DT1 - TRUNC(A.ESTM_DT)),-1,6,5) DP_SEQ," ).append("\n"); 
		query.append("                    DECODE(SIGN(F.WK_END_DT1 - TRUNC(A.ESTM_DT)),-1,F.FCAST_YRWK2,F.FCAST_YRWK1) FCAST_YRWK," ).append("\n"); 
		query.append("                    A.CNTR_TPSZ_CD," ).append("\n"); 
		query.append("                    SUM(NVL(D.CNTR_VOL_QTY,1)) QTY " ).append("\n"); 
		query.append("                FROM(" ).append("\n"); 
		query.append("                    SELECT /*+ ORDERED USE_HASH(A G1 G2) */	--변경" ).append("\n"); 
		query.append("                       A.NOD_CD," ).append("\n"); 
		query.append("                       TRUNC(TO_DATE(SUBSTR(A.ESTM_DT,6),'YYYYMMDD HH24MISS') + NVL(G1.AVG_TT_DYS,NVL(G2.AVG_TT_DYS,1))) ESTM_DT," ).append("\n"); 
		query.append("                       A.COP_NO," ).append("\n"); 
		query.append("                       A.CNTR_TPSZ_CD," ).append("\n"); 
		query.append("                       A.BKG_NO," ).append("\n"); 
		query.append("                       A.CNTR_NO" ).append("\n"); 
		query.append("                    FROM(    " ).append("\n"); 
		query.append("                        SELECT" ).append("\n"); 
		query.append("                           A.NOD_CD," ).append("\n"); 
		query.append("                           A.COP_NO," ).append("\n"); 
		query.append("                           B.CNTR_TPSZ_CD," ).append("\n"); 
		query.append("                           B.BKG_NO," ).append("\n"); 
		query.append("                           B.CNTR_NO," ).append("\n"); 
		query.append("                            (SELECT /*+ INDEX_DESC(A1 XPKSCE_COP_DTL) */" ).append("\n"); 
		query.append("                                   L.SCC_CD||TO_CHAR(DECODE(A1.ACT_STS_CD,'F',NVL(A1.ACT_DT,A1.ESTM_DT),A1.ESTM_DT),'YYYYMMDD HH24MISS')" ).append("\n"); 
		query.append("                            FROM SCE_COP_DTL A1, MDM_LOCATION L" ).append("\n"); 
		query.append("                            WHERE A.COP_NO = A1.COP_NO" ).append("\n"); 
		query.append("                            AND   A1.ACT_CD IN('FITMDO','FITYDO','FITRDO','FUVMUD')" ).append("\n"); 
		query.append("                            AND   SUBSTR(A1.NOD_CD,1,5) = L.LOC_CD" ).append("\n"); 
		query.append("                            AND   ROWNUM =1) ESTM_DT" ).append("\n"); 
		query.append("                        FROM  LV_YD_LIST Y,  LV_REPO_IN_WEEK F ,SCE_COP_DTL A, SCE_COP_HDR B " ).append("\n"); 
		query.append("                        WHERE A.COP_NO = B.COP_NO" ).append("\n"); 
		query.append("                          AND  A.ACT_CD = 'MITYAD'" ).append("\n"); 
		query.append("                          AND    A.ACT_STS_CD IN('N','C')" ).append("\n"); 
		query.append("                          AND    B.COP_STS_CD NOT IN ('X', 'O', 'F', 'M')" ).append("\n"); 
		query.append("                          AND A.ESTM_DT  BETWEEN  F.WK_ST_DT-30 AND F.WK_END_DT2 + 20.99999    --+,-30일" ).append("\n"); 
		query.append("                          AND    Y.YD_CD = A.NOD_CD" ).append("\n"); 
		query.append("                    ) A" ).append("\n"); 
		query.append("                   ,( SELECT Y.YD_CD," ).append("\n"); 
		query.append("                            F.WK_ST_DT," ).append("\n"); 
		query.append("                            F.WK_END_DT2," ).append("\n"); 
		query.append("                            ROWNUM" ).append("\n"); 
		query.append("                     FROM LV_YD_LIST Y," ).append("\n"); 
		query.append("                          LV_REPO_IN_WEEK F ) F" ).append("\n"); 
		query.append("                    , CIM_MTY_GEN_TURN_TM G1, CIM_MTY_GEN_TURN_TM G2" ).append("\n"); 
		query.append("                    WHERE 1=1" ).append("\n"); 
		query.append("                    AND   G1.LOC_CD(+) = SUBSTR(A.ESTM_DT,1,5)" ).append("\n"); 
		query.append("                    AND   G1.CNTR_TPSZ_CD(+) = A.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                    AND   G2.LOC_CD (+)=  SUBSTR(A.ESTM_DT,1,5)" ).append("\n"); 
		query.append("                    AND   G2.CNTR_TPSZ_CD(+) = DECODE(SUBSTR(A.CNTR_TPSZ_CD,2,1),'2','20','40')" ).append("\n"); 
		query.append("                    AND   TO_DATE(SUBSTR(A.ESTM_DT,6),'YYYYMMDD HH24MISS') + NVL(G1.AVG_TT_DYS,NVL(G2.AVG_TT_DYS,1)) BETWEEN F.WK_ST_DT AND F.WK_END_DT2 + 0.99999" ).append("\n"); 
		query.append("                    AND F.YD_CD = A.NOD_CD " ).append("\n"); 
		query.append("                    ) A, BKG_BOOKING C , BKG_CONTAINER D , MST_CONTAINER E, LV_REPO_IN_WEEK F" ).append("\n"); 
		query.append("                WHERE A.BKG_NO = C.BKG_NO" ).append("\n"); 
		query.append("                AND   C.BKG_STS_CD IN('A','W','F')" ).append("\n"); 
		query.append("                AND   C.SOC_FLG = 'N' " ).append("\n"); 
		query.append("                AND   D.BKG_NO(+) = A.BKG_NO" ).append("\n"); 
		query.append("                AND   D.CNTR_NO(+) = A.CNTR_NO " ).append("\n"); 
		query.append("                AND   D.CNTR_NO = E.CNTR_NO(+) " ).append("\n"); 
		query.append("                AND   NVL(E.IMDT_EXT_FLG,'N') ='N' " ).append("\n"); 
		query.append("                GROUP BY A.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                        ,DECODE(SIGN(F.WK_END_DT1 - TRUNC(A.ESTM_DT)),-1,6,5),DECODE(SIGN(F.WK_END_DT1 - TRUNC(A.ESTM_DT)),-1,F.FCAST_YRWK2,F.FCAST_YRWK1)" ).append("\n"); 
		query.append("                        " ).append("\n"); 
		query.append("            UNION ALL" ).append("\n"); 
		query.append("            SELECT (A.WK_SEQ + 4) DP_SEQ," ).append("\n"); 
		query.append("            A.FCAST_YRWK," ).append("\n"); 
		query.append("            'D2' CNTR_TPSZ_CD," ).append("\n"); 
		query.append("            0 QTY" ).append("\n"); 
		query.append("            FROM LV_DUMMY_WEEK A" ).append("\n"); 
		query.append("            WHERE A.TP = 2" ).append("\n"); 
		query.append("            GROUP BY (A.WK_SEQ + 4),A.FCAST_YRWK" ).append("\n"); 
		query.append("            ) A" ).append("\n"); 
		query.append("            GROUP BY A.DP_SEQ,A.FCAST_YRWK" ).append("\n"); 
		query.append("            UNION ALL" ).append("\n"); 
		query.append("            " ).append("\n"); 
		query.append("            SELECT 8 DP_SEQ," ).append("\n"); 
		query.append("                'Repo. In' TITLE," ).append("\n"); 
		query.append("                'Repo. In' ITEM," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'D2',QTY,0)),0) D2_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'D4',QTY,0)),0) D4_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'D5',QTY,0)),0) D5_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'D7',QTY,0)),0) D7_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'R2',QTY,0)),0) R2_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'R5',QTY,0)),0) R5_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'O2',QTY,0)),0) O2_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'S2',QTY,0)),0) S2_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'O4',QTY,0)),0) O4_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'S4',QTY,0)),0) S4_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'F2',QTY,0)),0) F2_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'A2',QTY,0)),0) A2_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'F4',QTY,0)),0) F4_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'A4',QTY,0)),0) A4_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'F5',QTY,0)),0) F5_QTY" ).append("\n"); 
		query.append("            FROM " ).append("\n"); 
		query.append("            (" ).append("\n"); 
		query.append("                SELECT" ).append("\n"); 
		query.append("                      B.CNTR_TPSZ_CD," ).append("\n"); 
		query.append("                      ROUND(SUM(B.CNTR_QTY)/3 ,0) QTY" ).append("\n"); 
		query.append("                FROM LV_YD_LIST Y, EQR_MTY_REPO_PERF_IB_V B , (SELECT TO_DATE(A.WK_ST_DT,'YYYYMMDD') -27 WK_ST_DT," ).append("\n"); 
		query.append("                                                                      TO_DATE(A.WK_END_DT,'YYYYMMDD')-13 WK_END_DT" ).append("\n"); 
		query.append("                                                               FROM EQR_WK_PRD A" ).append("\n"); 
		query.append("                                                               WHERE A.PLN_YR = SUBSTR(@[fcast_yrwk],1,4)" ).append("\n"); 
		query.append("                                                               AND   A.PLN_WK = SUBSTR(@[fcast_yrwk],5)) C" ).append("\n"); 
		query.append("                WHERE Y.YD_CD = B.TO_YD_CD" ).append("\n"); 
		query.append("                AND   B.TO_ETA_DT BETWEEN C.WK_ST_DT AND C.WK_END_DT+0.99999" ).append("\n"); 
		query.append("                GROUP BY B.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("            ) A" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("		#if (${search_flag} == '3')" ).append("\n"); 
		query.append("            UNION ALL" ).append("\n"); 
		query.append("                ---- Cumulative OP" ).append("\n"); 
		query.append("                SELECT 12 DP_SEQ," ).append("\n"); 
		query.append("                       'Cumulative OP' TITLE," ).append("\n"); 
		query.append("                       'Cumulative OP' ITEM," ).append("\n"); 
		query.append("                       NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'D2',QTY,0)),0) D2_QTY," ).append("\n"); 
		query.append("                       NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'D4',QTY,0)),0) D4_QTY," ).append("\n"); 
		query.append("                       NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'D5',QTY,0)),0) D5_QTY," ).append("\n"); 
		query.append("                       NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'D7',QTY,0)),0) D7_QTY," ).append("\n"); 
		query.append("                       NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'R2',QTY,0)),0) R2_QTY," ).append("\n"); 
		query.append("                       NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'R5',QTY,0)),0) R5_QTY," ).append("\n"); 
		query.append("                       NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'O2',QTY,0)),0) O2_QTY," ).append("\n"); 
		query.append("                       NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'S2',QTY,0)),0) S2_QTY," ).append("\n"); 
		query.append("                       NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'O4',QTY,0)),0) O4_QTY," ).append("\n"); 
		query.append("                       NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'S4',QTY,0)),0) S4_QTY," ).append("\n"); 
		query.append("                       NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'F2',QTY,0)),0) F2_QTY," ).append("\n"); 
		query.append("                       NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'A2',QTY,0)),0) A2_QTY," ).append("\n"); 
		query.append("                       NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'F4',QTY,0)),0) F4_QTY," ).append("\n"); 
		query.append("                       NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'A4',QTY,0)),0) A4_QTY," ).append("\n"); 
		query.append("                       NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'F5',QTY,0)),0) F5_QTY" ).append("\n"); 
		query.append("                FROM" ).append("\n"); 
		query.append("                    (SELECT /*+ INDEX(A XAK5CTM_MOVEMENT) */ A.CNTR_TPSZ_CD,COUNT(1) QTY" ).append("\n"); 
		query.append("                    FROM  CTM_MOVEMENT A, LV_DUMMY_WEEK B,LV_YD_LIST C" ).append("\n"); 
		query.append("                    WHERE A.MVMT_STS_CD = 'OP'" ).append("\n"); 
		query.append("                    AND   A.CNMV_EVNT_DT BETWEEN  TO_DATE(B.WK_ST_DT,'YYYYMMDD') AND TO_DATE(B.WK_END_DT,'YYYYMMDD') + 0.99999" ).append("\n"); 
		query.append("                    AND   B.FCAST_YRWK = @[fcast_yrwk]" ).append("\n"); 
		query.append("                    AND   B.TP=2" ).append("\n"); 
		query.append("                    AND   B.WK_SEQ = 1" ).append("\n"); 
		query.append("                    AND   A.ORG_YD_CD = C.YD_CD" ).append("\n"); 
		query.append("                    GROUP BY A.CNTR_TPSZ_CD) A" ).append("\n"); 
		query.append("            UNION ALL" ).append("\n"); 
		query.append("                SELECT 13 DP_SEQ," ).append("\n"); 
		query.append("                'Repo. Out' TITLE," ).append("\n"); 
		query.append("                'Repo. Out' ITEM," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'D2',QTY,0)),0) D2_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'D4',QTY,0)),0) D4_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'D5',QTY,0)),0) D5_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'D7',QTY,0)),0) D7_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'R2',QTY,0)),0) R2_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'R5',QTY,0)),0) R5_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'O2',QTY,0)),0) O2_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'S2',QTY,0)),0) S2_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'O4',QTY,0)),0) O4_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'S4',QTY,0)),0) S4_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'F2',QTY,0)),0) F2_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'A2',QTY,0)),0) A2_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'F4',QTY,0)),0) F4_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'A4',QTY,0)),0) A4_QTY," ).append("\n"); 
		query.append("                NVL(SUM(DECODE(A.CNTR_TPSZ_CD,'F5',QTY,0)),0) F5_QTY" ).append("\n"); 
		query.append("                FROM " ).append("\n"); 
		query.append("                (" ).append("\n"); 
		query.append("                    SELECT" ).append("\n"); 
		query.append("                          B.CNTR_TPSZ_CD," ).append("\n"); 
		query.append("                          ROUND(SUM(B.CNTR_QTY)/3 ,0) QTY" ).append("\n"); 
		query.append("                    FROM LV_YD_LIST Y, EQR_MTY_REPO_PERF_OB_V B , (SELECT TO_DATE(A.WK_ST_DT,'YYYYMMDD') -27 WK_ST_DT," ).append("\n"); 
		query.append("                                                                          TO_DATE(A.WK_END_DT,'YYYYMMDD')-13 WK_END_DT" ).append("\n"); 
		query.append("                                                                   FROM EQR_WK_PRD A" ).append("\n"); 
		query.append("                                                                   WHERE A.PLN_YR = SUBSTR(@[fcast_yrwk],1,4)" ).append("\n"); 
		query.append("                                                                   AND   A.PLN_WK = SUBSTR(@[fcast_yrwk],5)) C" ).append("\n"); 
		query.append("                    WHERE Y.YD_CD = B.FM_YD_CD" ).append("\n"); 
		query.append("                    AND   B.FM_ETD_DT BETWEEN C.WK_ST_DT AND C.WK_END_DT+0.99999" ).append("\n"); 
		query.append("                    GROUP BY B.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                ) A" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("        ORDER BY DP_SEQ" ).append("\n"); 
		query.append("    ) A    " ).append("\n"); 
		query.append(") A" ).append("\n"); 

	}
}