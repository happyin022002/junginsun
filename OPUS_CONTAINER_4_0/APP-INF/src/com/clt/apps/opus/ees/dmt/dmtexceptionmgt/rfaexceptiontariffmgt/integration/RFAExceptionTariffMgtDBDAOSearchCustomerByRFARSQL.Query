<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RFAExceptionTariffMgtDBDAOSearchCustomerByRFARSQL">
			<desc><![CDATA[DEM/DET Adjustment Request - Before Booking Request Detail 에 소속된 Actual Customer 정보를 조회하는 쿼리]]></desc>
			<sql><![CDATA[
SELECT	A.CUST_CNT_CD || LPAD(A.CUST_SEQ,  6, '0') AS CUST_CD
	,	B.CUST_LGL_ENG_NM AS CUST_NM

FROM	(
			SELECT	CUST_CNT_CD, CUST_SEQ
			FROM	PRI_RP_SCP_RT_ACT_CUST RP_ACT_CUST
			WHERE	RP_ACT_CUST.PROP_NO = @[prop_no]
				#if(${amdt_seq} != '')
				AND	RP_ACT_CUST.AMDT_SEQ = @[amdt_seq]
				#else
				AND RP_ACT_CUST.AMDT_SEQ = 
					(	
						SELECT 	MAX(AMDT_SEQ)
						FROM 	PRI_RP_SCP_RT_ACT_CUST
						WHERE 	PROP_NO = RP_ACT_CUST.PROP_NO
					)
				#end

			MINUS

			SELECT	CTRT_CUST_CNT_CD AS CUST_CNT_CD, CTRT_CUST_SEQ AS CUST_SEQ
			FROM	PRI_RP_MN RP_MN
			WHERE	RP_MN.PROP_NO = @[prop_no]
				#if(${amdt_seq} != '')
			    AND RP_MN.AMDT_SEQ = @[amdt_seq]
				#else
				AND RP_MN.AMDT_SEQ = 
					(
						SELECT 	MAX(AMDT_SEQ) 
						FROM 	PRI_RP_MN 
						WHERE 	PROP_NO = RP_MN.PROP_NO
					)
				#end
		) A
	,	MDM_CUSTOMER B

WHERE	A.CUST_CNT_CD 	= B.CUST_CNT_CD
	AND A.CUST_SEQ 		= B.CUST_SEQ			]]></sql>
			<params>
				<param name="prop_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
