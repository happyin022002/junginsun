<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContainerMovementMgtDBDAOgetBkgNoByCntrNoAndCrntVvdCdRSQL">
			<desc><![CDATA[.]]></desc>
			<sql><![CDATA[
SELECT BKG_NO, BB_CGO_FLG
FROM (SELECT A.BKG_NO, NVL (A.BB_CGO_FLG, '') AS BB_CGO_FLG, A.CNMV_CYC_NO
  FROM CTM_BKG_CNTR A,
       CTM_BOOKING B,
          (SELECT MAX(CNMV_CYC_NO) MAX_CNMV_CYC_NO, MAX(BO.OSCA_CRE_DT) MAX_OSCA_CRE_DT
             FROM CTM_BKG_CNTR BC,
                  CTM_BOOKING BO,
                  CTM_BKG_VVD BV
            WHERE BC.CNTR_NO = @[cntr_no]
              AND BC.BKG_NO = BO.BKG_NO
              AND NVL (BO.BKG_STS_CD, ' ') NOT IN ('X', 'S')
              AND BV.BKG_NO = BC.BKG_NO
			  AND BC.CNMV_CYC_NO <> 9998
              AND BV.VSL_CD = SUBSTR(@[crnt_vvd_cd], 1, 4)
              AND BV.SKD_VOY_NO = SUBSTR(@[crnt_vvd_cd], 5, 4)
              AND BV.SKD_DIR_CD = SUBSTR(@[crnt_vvd_cd], 9, 1))
 WHERE A.CNTR_NO = @[cntr_no]
   AND A.CNMV_CYC_NO = MAX_CNMV_CYC_NO
   AND A.BKG_NO = B.BKG_NO
   AND NVL (B.BKG_STS_CD, ' ') NOT IN ('X', 'S')
   AND ROWNUM = 1
UNION
SELECT /*+ ORDERED INDEX_DESC(A XAK1BKG_CONTAINER) INDEX(B XPKBKG_BOOKING) */
       A.BKG_NO, NVL (A.BB_CGO_FLG, '') AS BB_CGO_FLG, A.CNMV_CYC_NO
  FROM BKG_CONTAINER A,
       BKG_BOOKING B
 WHERE A.CNTR_NO = @[cntr_no]
   AND A.CNMV_CYC_NO =
          (SELECT /*+ ORDERED INDEX_DESC(BC XAK1BKG_CONTAINER) INDEX(BO XPKBKG_BOOKING) */
                  MAX (CNMV_CYC_NO)
             FROM BKG_CONTAINER BC,
                  BKG_BOOKING BO
            WHERE BC.CNTR_NO = @[cntr_no]
              AND BC.BKG_NO = BO.BKG_NO
              AND NVL (BO.BKG_STS_CD, ' ') NOT IN ('X', 'S'))
   AND A.BKG_NO = B.BKG_NO
   AND NVL (B.BKG_STS_CD, ' ') NOT IN ('X', 'S')
   AND ROWNUM = 1
ORDER BY CNMV_CYC_NO DESC )
WHERE ROWNUM=1			]]></sql>
			<params>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="crnt_vvd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
