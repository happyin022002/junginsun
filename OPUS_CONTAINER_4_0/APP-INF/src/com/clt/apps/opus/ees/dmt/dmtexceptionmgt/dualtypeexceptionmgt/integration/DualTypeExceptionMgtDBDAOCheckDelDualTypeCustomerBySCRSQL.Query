<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DualTypeExceptionMgtDBDAOCheckDelDualTypeCustomerBySCRSQL">
			<desc><![CDATA[Customer 의 'Requested', 'Accepted', 'Live' 인 S/C Exception Tariff 가 있는지 확인하는 쿼리]]></desc>
			<sql><![CDATA[
SELECT  SP_HDR.PROP_NO

FROM    PRI_SP_CTRT_PTY SP_PTY
	,	PRI_SP_HDR SP_HDR
	, 	DMT_SC_EXPT_VER SC_VER
	,	DMT_SC_EXPT_GRP SC_GRP
	,	DMT_SC_EXPT_CVRG SC_CVRG

WHERE   SP_PTY.CUST_CNT_CD = @[cust_cnt_cd] 
	AND SP_PTY.CUST_SEQ = TO_NUMBER(@[cust_seq])
	AND SP_PTY.AMDT_SEQ = 
    	(
        	SELECT  /*+ INDEX_DESC(PRI_SP_CTRT_PTY XPKPRI_SP_CTRT_PTY)*/ AMDT_SEQ
        	FROM    PRI_SP_CTRT_PTY
			WHERE   PROP_NO = SP_PTY.PROP_NO
				AND PRC_CTRT_PTY_TP_CD = 'C'
            	AND ROWNUM = 1
    	)
	AND SP_PTY.PRC_CTRT_PTY_TP_CD = 'C'
	AND SP_PTY.PROP_NO = SP_HDR.PROP_NO
	AND SP_HDR.PROP_NO = SC_VER.PROP_NO
    AND SC_VER.DMDT_EXPT_VER_STS_CD IN ('A', 'L', 'R')
    AND SC_VER.DELT_FLG = 'N'
	AND SC_VER.PROP_NO = SC_GRP.PROP_NO
	AND SC_VER.SC_EXPT_VER_SEQ = SC_GRP.SC_EXPT_VER_SEQ
	AND (
			(SC_GRP.EFF_DT >= TO_DATE(@[dul_expt_eff_dt], 'YYYYMMDD') AND SC_GRP.EFF_DT <= TO_DATE(NVL(@[dul_expt_exp_dt], '99991231'), 'YYYYMMDD'))
			OR
			(SC_GRP.EFF_DT <= TO_DATE(@[dul_expt_eff_dt], 'YYYYMMDD') AND SC_GRP.EXP_DT >= TO_DATE(@[dul_expt_eff_dt], 'YYYYMMDD'))
		)
	AND SC_GRP.DMDT_TRF_CD IN ('CTIC', 'CTOC')
	AND SC_GRP.PROP_NO = SC_CVRG.PROP_NO
	AND SC_GRP.SC_EXPT_VER_SEQ = SC_CVRG.SC_EXPT_VER_SEQ
	AND SC_GRP.SC_EXPT_GRP_SEQ = SC_CVRG.SC_EXPT_GRP_SEQ
#if(${cvrg_cnt_cd} != '')
	AND	(	SC_CVRG.CNT_CD = @[cvrg_cnt_cd]
	#if(${cvrg_rgn_cd} != '')
		AND SC_CVRG.RGN_CD = @[cvrg_rgn_cd]
		AND SC_CVRG.STE_CD = ' '
	#end

	#if(${cvrg_ste_cd} != '')
		AND SC_CVRG.RGN_CD = ' '
		AND SC_CVRG.STE_CD = @[cvrg_ste_cd]
	#end

	#if(${cvrg_loc_cd} != '')
		AND SC_CVRG.LOC_CD = @[cvrg_loc_cd]
	#end
   	)
#end			]]></sql>
			<params>
				<param name="cust_cnt_cd" type="12" value="" out="N"/>
				<param name="cust_seq" type="12" value="" out="N"/>
				<param name="dul_expt_eff_dt" type="12" value="" out="N"/>
				<param name="dul_expt_exp_dt" type="12" value="" out="N"/>
				<param name="cvrg_cnt_cd" type="12" value="" out="N"/>
				<param name="cvrg_rgn_cd" type="12" value="" out="N"/>
				<param name="cvrg_ste_cd" type="12" value="" out="N"/>
				<param name="cvrg_loc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
