<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RepairMgtDBDAOsearchEDIInvoiceParkingLotHDRDataRSQL">
			<desc><![CDATA[searchEDIInvoiceParkingLotHDRData]]></desc>
			<sql><![CDATA[
SELECT CURR_CD, VNDR_SEQ, INV_AMT, VAT_AMT, INV_WHLD_TAX_AMT, INV_NO
	, RCV_DT, INV_CFM_DT, COST_OFC_CD, ORD_HDR_RMK
    , CASE WHEN DD IS NOT NULL THEN AA||';'||BB||';'||CC||';'||DD
                     WHEN CC IS NOT NULL THEN AA||';'||BB||';'||CC
                     WHEN BB IS NOT NULL THEN AA||';'||BB
                     WHEN AA IS NOT NULL THEN AA
      END VRFY_RSLT_DESC
	, CRE_DT, UPD_USR_ID, UPD_DT, '' AS CRE_FR_DT, '' AS CRE_TO_DT, MNR_RCV_ORD_INV_TMP_SEQ, '' AS RQST_EQ_NO
    ,(SELECT B.VNDR_LGL_ENG_NM
        FROM MDM_VENDOR B
       WHERE B.VNDR_SEQ = A.VNDR_SEQ) VNDR_NM
FROM (SELECT CURR_CD, VNDR_SEQ, INV_AMT, VAT_AMT, INV_WHLD_TAX_AMT, INV_NO
	       , TO_CHAR(RCV_DT,'YYYY-MM-DD') AS RCV_DT, TO_CHAR(INV_CFM_DT,'YYYY-MM-DD') AS INV_CFM_DT
	       , COST_OFC_CD, ORD_HDR_RMK
	       , (SELECT MNR_CD_DP_DESC FROM MNR_GEN_CD WHERE PRNT_CD_ID = 'CD00004' AND MNR_CD_ID = SUBSTR(VRFY_RSLT_DESC, 1, 2))  AA
           , (SELECT MNR_CD_DP_DESC FROM MNR_GEN_CD WHERE PRNT_CD_ID = 'CD00004' AND MNR_CD_ID = SUBSTR(VRFY_RSLT_DESC, 4, 2))  BB
           , (SELECT MNR_CD_DP_DESC FROM MNR_GEN_CD WHERE PRNT_CD_ID = 'CD00004' AND MNR_CD_ID = SUBSTR(VRFY_RSLT_DESC, 7, 2))  CC
           , (SELECT MNR_CD_DP_DESC FROM MNR_GEN_CD WHERE PRNT_CD_ID = 'CD00004' AND MNR_CD_ID = SUBSTR(VRFY_RSLT_DESC, 10, 2)) DD
	       , CRE_DT, UPD_USR_ID, UPD_DT, '' AS CRE_FR_DT, '' AS CRE_TO_DT, MNR_RCV_ORD_INV_TMP_SEQ, '' AS RQST_EQ_NO  
  	FROM MNR_ORD_TMP_HDR
 	WHERE VRFY_RSLT_DESC <> 'SS' 
	UNION ALL
	SELECT CURR_CD, VNDR_SEQ, INV_AMT, VAT_AMT, INV_WHLD_TAX_AMT, INV_NO
	     , TO_CHAR(RCV_DT,'YYYY-MM-DD') AS RCV_DT, TO_CHAR(INV_CFM_DT,'YYYY-MM-DD') AS INV_CFM_DT
	     , COST_OFC_CD, ORD_HDR_RMK
	     , (SELECT MNR_CD_DP_DESC FROM MNR_GEN_CD WHERE PRNT_CD_ID = 'CD00004' AND MNR_CD_ID = SUBSTR(VRFY_RSLT_DESC, 1, 2))  AA
         , (SELECT MNR_CD_DP_DESC FROM MNR_GEN_CD WHERE PRNT_CD_ID = 'CD00004' AND MNR_CD_ID = SUBSTR(VRFY_RSLT_DESC, 4, 2))  BB
         , (SELECT MNR_CD_DP_DESC FROM MNR_GEN_CD WHERE PRNT_CD_ID = 'CD00004' AND MNR_CD_ID = SUBSTR(VRFY_RSLT_DESC, 7, 2))  CC
         , (SELECT MNR_CD_DP_DESC FROM MNR_GEN_CD WHERE PRNT_CD_ID = 'CD00004' AND MNR_CD_ID = SUBSTR(VRFY_RSLT_DESC, 10, 2)) DD
	, CRE_DT, UPD_USR_ID, UPD_DT, '' AS CRE_FR_DT, '' AS CRE_TO_DT, MNR_RCV_ORD_INV_TMP_SEQ, '' AS RQST_EQ_NO
  	FROM MNR_ORD_TMP_HDR A
 	WHERE A.VRFY_RSLT_DESC = 'SS'
   	AND EXISTS (SELECT 'X'
                 FROM MNR_ORD_TMP_DTL B
                WHERE A.MNR_RCV_ORD_INV_TMP_SEQ = B.MNR_RCV_ORD_INV_TMP_SEQ
                  AND B.VRFY_RSLT_DESC <> 'SS')
	) A
  WHERE 1=1
#if(${inv_no} != '')
	AND INV_NO like '%'||@[inv_no]||'%'
#end
#if(${cre_fr_dt} != '')
	AND CRE_DT >= to_date(@[cre_fr_dt],'YYYY-MM-DD')
#end
#if(${cre_to_dt} != '')
	AND CRE_DT < to_date(@[cre_to_dt],'YYYY-MM-DD')+0.99999
#end
#if (${rqst_eq_no} != '')
    AND MNR_RCV_ORD_INV_TMP_SEQ IN ( SELECT DISTINCT MNR_RCV_ORD_INV_TMP_SEQ 
                                       FROM MNR_ORD_TMP_DTL
                                      WHERE EQ_NO IN (
           						#foreach ($user_eq_no IN ${eqNos})
									#if($velocityCount < $eqNos.size())
										'$user_eq_no',
									#else
										'$user_eq_no'
									#end
              					#end
                    				)
)
#end
#if(${mnr_rcv_ord_inv_tmp_seq} != '')
AND MNR_RCV_ORD_INV_TMP_SEQ = @[mnr_rcv_ord_inv_tmp_seq]
#end
ORDER BY MNR_RCV_ORD_INV_TMP_SEQ			]]></sql>
			<params>
				<param name="inv_no" type="12" value="" out="N"/>
				<param name="cre_fr_dt" type="12" value="" out="N"/>
				<param name="cre_to_dt" type="12" value="" out="N"/>
				<param name="mnr_rcv_ord_inv_tmp_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
