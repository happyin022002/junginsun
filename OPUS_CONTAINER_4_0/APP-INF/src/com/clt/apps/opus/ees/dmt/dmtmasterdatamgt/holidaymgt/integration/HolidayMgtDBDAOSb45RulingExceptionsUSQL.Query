<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="HolidayMgtDBDAOSb45RulingExceptionsUSQL">
			<desc><![CDATA[MergeDmtOvrDyExclu]]></desc>
			<sql><![CDATA[
MERGE INTO DMT_OVR_DY_EXCLU
USING DUAL
 ON (
      CNT_CD        = @[cnt_cd] AND
      LOC_CD        = NVL(@[loc_cd], ' ') AND
      YD_CD         = NVL(@[yd_cd], ' ') AND
      IO_BND_CD     = @[io_bnd_cd] AND
      DEM_DET_TP_CD = @[dem_det_tp_cd] AND
      EXCLU_SEQ     = @[exclu_seq]
    )
WHEN MATCHED THEN
  UPDATE
     SET XCLD_SAT_FLG     = @[xcld_sat_flg],
         XCLD_SUN_FLG     = @[xcld_sun_flg],
         XCLD_HOL_FLG     = @[xcld_hol_flg],
         EFF_DT           = TO_DATE(@[eff_dt], 'YYYYMMDD'),
         EXP_DT           = TO_DATE(@[exp_dt], 'YYYYMMDD'),
         UPD_USR_ID       = @[upd_usr_id],
         UPD_DT           = SYSDATE
WHEN NOT MATCHED THEN
  INSERT
         (
	       CNT_CD
	      ,LOC_CD
	      ,YD_CD
	      ,IO_BND_CD
          ,DEM_DET_TP_CD
	      ,EXCLU_SEQ
	      ,XCLD_SAT_FLG
	      ,XCLD_SUN_FLG
	      ,XCLD_HOL_FLG
	      ,EFF_DT
	      ,EXP_DT
	      ,CRE_USR_ID
	      ,CRE_DT
	      ,UPD_USR_ID
	      ,UPD_DT
    	  ,EDW_UPD_DT 
         )
  VALUES
         (	   
		   @[cnt_cd]
	      ,NVL(@[loc_cd], ' ')
	      ,NVL(@[yd_cd], ' ')
	      ,@[io_bnd_cd]
          ,@[dem_det_tp_cd]
	      ,(
          		SELECT /*+ INDEX_DESC(DMT_OVR_DY_EXCLU XPKDMT_OVR_DY_EXCLU) */ 
				       NVL(MAX(EXCLU_SEQ)+1, 1) EXCLU_SEQ
				  FROM DMT_OVR_DY_EXCLU
				 WHERE 1=1
				   AND CNT_CD = @[cnt_cd]
				   AND LOC_CD = NVL(@[loc_cd], ' ')
				   AND YD_CD = NVL(@[yd_cd], ' ')
				   AND IO_BND_CD = @[io_bnd_cd]
                   AND DEM_DET_TP_CD = @[dem_det_tp_cd]
				   AND ROWNUM = 1
           )
	      ,@[xcld_sat_flg]
	      ,@[xcld_sun_flg]
	      ,@[xcld_hol_flg]
	      ,TO_DATE(@[eff_dt], 'YYYYMMDD')
	      ,TO_DATE(@[exp_dt], 'YYYYMMDD')
	      ,@[cre_usr_id]
	      ,SYSDATE
	      ,@[upd_usr_id]
	      ,SYSDATE
	      ,NULL
         )			]]></sql>
			<params>
				<param name="cnt_cd" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="dem_det_tp_cd" type="12" value="" out="N"/>
				<param name="exclu_seq" type="12" value="" out="N"/>
				<param name="xcld_sat_flg" type="12" value="" out="N"/>
				<param name="xcld_sun_flg" type="12" value="" out="N"/>
				<param name="xcld_hol_flg" type="12" value="" out="N"/>
				<param name="eff_dt" type="12" value="" out="N"/>
				<param name="exp_dt" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
