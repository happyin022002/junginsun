<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContainerMovementMgtDBDAOInsertEDIBkgEppCntrCSQL">
			<desc><![CDATA[EDI 배치 실행시 BKG_CONTAINER,EPP_CONTAINER 파일을 CTM_BKG_CNTR 테이블에 INSERT]]></desc>
			<sql><![CDATA[
INSERT INTO CTM_BKG_CNTR
			(BKG_NO			,
			CNTR_NO			,
			CNTR_TPSZ_CD	,
			CNMV_YR			,
			CNMV_ID_NO		,
			CNMV_CYC_NO		,
			CNMV_STS_CD		,
			RCV_TERM_CD		,
			DE_TERM_CD		,
			CNTR_VOL_QTY	,
			DCGO_FLG		,
			RC_FLG			,
			BB_CGO_FLG		,
			AWK_CGO_FLG		,
			RD_CGO_FLG		,
			HNGR_FLG		,
			SOC_FLG			,
			CNMV_EVNT_DT	,
			CNTR_CFM_FLG	,
			CRE_USR_ID		,
			CRE_DT			,
			UPD_USR_ID		,
			UPD_DT			,
            OSCA_CRE_DT     ,
            OSCA_UPD_DT
			)
     VALUES 
	(
			@[bkg_no]			,
			@[cntr_no]			,
			DECODE(@[cntr_tpsz_cd], '20GP','D2',
									'40GP','D4',
									'40HQ','D5',
									'45HQ','D7',
									'20FL','F2',
									'40FL','F4',
									'20OT','O2',
									'40OT','O4',
									'20RF','R2',
									'40RQ','R5',
									'20TK','T2',
									'40TK','T4',@[cntr_tpsz_cd]) ,
			@[cnmv_yr]	,
			@[cnmv_id_no]			,			
            (
                SELECT /*+ USE_NL(CB CM) */
                   CASE WHEN SUBSTR(CB.BKG_NO, 1, 9) = SUBSTR(CM.BKG_NO, 1, 9) AND BKG_CGO_TP_CD = 'F' THEN CM.CNMV_CYC_NO
                    	WHEN CB.BKG_NO = CM.BKG_NO AND BKG_CGO_TP_CD = 'P' THEN CM.CNMV_CYC_NO
                        WHEN CB.VSL_CD||CB.SKD_VOY_NO||CB.SKD_DIR_CD = CM.TRUNK THEN CM.CNMV_CYC_NO
                        ELSE 9999 END AS CNMV_CYC_NO
                            FROM    (
                                        SELECT  /*+ INDEX_DESC(CTM_MOVEMENT XUK1CTM_MOVEMENT) */
                                            --* 
                                                CNTR_NO
                                                , CASE WHEN SUBSTR(BKG_NO, 1, 1) = 'A' AND LENGTH(BKG_NO) = 8 THEN BKG_NO||'00'
                                                       WHEN SUBSTR(BKG_NO, 1, 1) = 'E' AND LENGTH(BKG_NO) = 8 THEN BKG_NO||'00'
                                                       WHEN SUBSTR(BKG_NO, 1, 1) = 'L' AND LENGTH(BKG_NO) = 8 THEN BKG_NO||'00'
                                                       WHEN SUBSTR(BKG_NO, 1, 1) = 'N' AND LENGTH(BKG_NO) = 8 THEN BKG_NO||'00'
                                                       ELSE BKG_NO END AS BKG_NO
                     							, CNMV_CYC_NO
                                                , TRNK_VSL_CD||TRNK_SKD_VOY_NO||TRNK_SKD_DIR_CD TRUNK
												, BKG_CGO_TP_CD
                                        FROM    CTM_MOVEMENT
                                        WHERE CNTR_NO = @[cntr_no] --변수
                                        AND ROWNUM = 1
                                    )   CM
                                  , (SELECT 
                                            CASE WHEN SUBSTR(BKG_NO, 1, 1) = 'A' AND LENGTH(BKG_NO) = 8 THEN BKG_NO||'00'
                                               WHEN SUBSTR(BKG_NO, 1, 1) = 'E' AND LENGTH(BKG_NO) = 8 THEN BKG_NO||'00'
                                               WHEN SUBSTR(BKG_NO, 1, 1) = 'L' AND LENGTH(BKG_NO) = 8 THEN BKG_NO||'00'
                                               WHEN SUBSTR(BKG_NO, 1, 1) = 'N' AND LENGTH(BKG_NO) = 8 THEN BKG_NO||'00'
                                               ELSE BKG_NO END AS BKG_NO,
                                     CB.VSL_CD, CB.SKD_VOY_NO, CB.SKD_DIR_CD, @[cntr_no] AS CNTR_NO 
                                     FROM   CTM_BOOKING   CB
                                     WHERE  CB.BKG_NO   = @[bkg_no] --변수
                                     AND    ROWNUM <= 1 ) CB
                            WHERE   CB.CNTR_NO = CM.CNTR_NO(+)
     
            ),
			@[cnmv_sts_cd]			,
			@[rcv_term_cd]		,
			@[de_term_cd]		,			
			@[cntr_vol_qty]		,
			@[dcgo_flg]				,
			@[rc_flg]				,
			@[bb_cgo_flg]			,
			@[awk_cgo_flg]			,
			@[rd_cgo_flg]			,
			@[hngr_flg]				,
			@[soc_flg]			,
			@[cnmv_evnt_dt]		,
			@[cntr_cfm_flg]		,
			@[cre_usr_id]		,
			sysdate				,
			@[upd_usr_id]		,
			sysdate				,
			TO_DATE(SUBSTR(@[cre_dt],0,19),'YYYY-MM-DD HH24:MI:SS')				, 
			TO_DATE(SUBSTR(@[upd_dt],0,19),'YYYY-MM-DD HH24:MI:SS')
     )			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="cnmv_yr" type="12" value="" out="N"/>
				<param name="cnmv_id_no" type="12" value="" out="N"/>
				<param name="cnmv_sts_cd" type="12" value="" out="N"/>
				<param name="rcv_term_cd" type="12" value="" out="N"/>
				<param name="de_term_cd" type="12" value="" out="N"/>
				<param name="cntr_vol_qty" type="12" value="" out="N"/>
				<param name="dcgo_flg" type="12" value="" out="N"/>
				<param name="rc_flg" type="12" value="" out="N"/>
				<param name="bb_cgo_flg" type="12" value="" out="N"/>
				<param name="awk_cgo_flg" type="12" value="" out="N"/>
				<param name="rd_cgo_flg" type="12" value="" out="N"/>
				<param name="hngr_flg" type="12" value="" out="N"/>
				<param name="soc_flg" type="12" value="" out="N"/>
				<param name="cnmv_evnt_dt" type="12" value="" out="N"/>
				<param name="cntr_cfm_flg" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="cre_dt" type="12" value="" out="N"/>
				<param name="upd_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
