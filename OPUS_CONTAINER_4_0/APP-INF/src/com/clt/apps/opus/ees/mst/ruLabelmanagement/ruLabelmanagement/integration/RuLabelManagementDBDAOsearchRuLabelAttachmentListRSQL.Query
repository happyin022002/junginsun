<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RuLabelManagementDBDAOsearchRuLabelAttachmentListRSQL">
			<desc><![CDATA[RU Label Attachment / Detachment 조회]]></desc>
			<sql><![CDATA[
SELECT SUB.ROW_SEQ
     , SUB.CNTR_NO
     , SUB.CNTR_TPSZ_CD
     , SUB.AGMT_NO
     , SUB.LESSOR
     , SUB.LESSOR_NM
     , SUB.CNTR_AUTH_NO
     , SUB.RU_LABEL_TYPE
     , SUB.RU_LABEL_VALUE
     , SUB.HIS_RU_LABEL_VALUE
     , SUB.REMARK
     , SUB.CNMV_YR
     , SUB.CNMV_ID_NO
     , SUB.CNMV_SEQ
     , SUB.CNMV_SPLIT_NO
     , SUB.CRE_DT
     , SUB.CRE_USR_ID
     , SUB.UPD_DT
     , SUB.UPD_USR_ID
     , (SELECT  LA.LSE_CTRT_NO
          FROM LSE_AGREEMENT LA
         WHERE LA.AGMT_CTY_CD = SUB.AGMT_CTY_CD
             AND LA.AGMT_SEQ    = SUB.AGMT_SEQ
             AND ROWNUM         = 1) AS LSE_CTRT_NO
      , SUB.CRNT_YD_CD
      , SUB.CNMV_STS_CD
      , SUB.CNMV_DT
      , SUB.FULL_FLG
      , SUB.CNTR_STS_CD
      , SUB.MFTR_VNDR_SEQ
      , (SELECT MV.VNDR_LGL_ENG_NM
          FROM MDM_VENDOR MV
        WHERE SUB.MFTR_VNDR_SEQ = MV.VNDR_SEQ
           AND ROWNUM               = 1) MFTR_VNDR_NM
      , SUB.MFT_DT
      , SUB.RF_MKR_SEQ
      , (SELECT MV.VNDR_LGL_ENG_NM
          FROM MDM_VENDOR MV
        WHERE SUB.RF_MKR_SEQ = MV.VNDR_SEQ
           AND ROWNUM               = 1) RF_MKR_NM     
      , SUB.RF_MDL_NM
      , SUB.LSTM_CD  
FROM (
SELECT  ROW_NUMBER() OVER (ORDER BY  MC.CNTR_NO, MH.RSTR_USG_TP_CD, MH.RSTR_USG_LBL_NM, MH.CRE_DT, MH.UPD_DT) AS ROW_SEQ
		, MC.CNTR_NO AS CNTR_NO
        , MC.CNTR_TPSZ_CD AS CNTR_TPSZ_CD
        , MC.AGMT_CTY_CD|| LTRIM(TO_CHAR(MC.AGMT_SEQ,'000000')) AS AGMT_NO
        , MC.VNDR_SEQ  AS LESSOR
        , (SELECT B.VNDR_LGL_ENG_NM FROM MDM_VENDOR B WHERE MC.VNDR_SEQ = B.VNDR_SEQ) AS LESSOR_NM
        , MC.CNTR_AUTH_NO AS CNTR_AUTH_NO
        , MH.RSTR_USG_TP_CD  AS RU_LABEL_TYPE
        , MH.RSTR_USG_LBL_NM AS RU_LABEL_VALUE 
        , MH.RSTR_USG_LBL_NM AS HIS_RU_LABEL_VALUE
        , MH.CNTR_RMK AS REMARK
        , MC.CNMV_YR   AS CNMV_YR              
        , MC.CNMV_ID_NO        AS CNMV_ID_NO    
        , MC.CNMV_SEQ           AS CNMV_SEQ     
        , MC.CNMV_SPLIT_NO    AS CNMV_SPLIT_NO        
        , TO_CHAR(MH.CRE_DT, 'YYYY-MM-DD HH24:MI:SS') AS CRE_DT
        , MH.CRE_USR_ID AS CRE_USR_ID
        , TO_CHAR(MH.UPD_DT, 'YYYY-MM-DD HH24:MI:SS') AS UPD_DT
        , MH.UPD_USR_ID AS UPD_USR_ID
        , MC.AGMT_CTY_CD
        , MC.AGMT_SEQ
        , MC.CRNT_YD_CD
        , MC.CNMV_STS_CD
        , TO_CHAR(MC.CNMV_DT, 'YYYY-MM-DD HH24:MI') AS CNMV_DT
        , DECODE(MC.FULL_FLG, 'Y', 'F', 'M') AS FULL_FLG
        , MC.CNTR_STS_CD
        , MC.MFTR_VNDR_SEQ
        , TO_CHAR(MC.MFT_DT, 'YYYY-MM-DD') AS MFT_DT
        , DECODE(MC.RF_MKR_SEQ, 0, NULL, MC.RF_MKR_SEQ) RF_MKR_SEQ
        , MC.RF_MDL_NM
        , MC.LSTM_CD
FROM (       
            SELECT HIS.CNTR_NO
                   ,  HIS.RSTR_USG_TP_CD AS RSTR_USG_TP_CD
                   ,  MAX(HIS.RSTR_USG_HIS_SEQ) AS RSTR_USG_HIS_SEQ
                   ,  SUBSTR(MAX(TO_CHAR(HIS.RSTR_USG_HIS_SEQ, '000000000')||TRIM(HIS.RSTR_USG_UPD_TP_CD)), 11, 1) CHK_FLG
            FROM MST_CNTR_RSTR_USG_HIS HIS
            GROUP BY HIS.CNTR_NO, HIS.RSTR_USG_TP_CD ) SUB
      , MST_CONTAINER MC
      , MST_CNTR_RSTR_USG_HIS MH
WHERE SUB.CNTR_NO  = MC.CNTR_NO
AND    SUB.CNTR_NO  = MH.CNTR_NO
AND    SUB.RSTR_USG_HIS_SEQ = MH.RSTR_USG_HIS_SEQ
AND    SUB.CHK_FLG    != 'D'
AND (RSTR_USG_TP_LBL_NM1 IS NOT NULL
     OR RSTR_USG_TP_LBL_NM2 IS NOT NULL
     OR RSTR_USG_TP_LBL_NM3 IS NOT NULL
     OR RSTR_USG_TP_LBL_NM4 IS NOT NULL
     OR RSTR_USG_TP_LBL_NM5 IS NOT NULL
     OR RSTR_USG_TP_LBL_NM6 IS NOT NULL
     OR RSTR_USG_TP_LBL_NM7 IS NOT NULL
     OR RSTR_USG_TP_LBL_NM8 IS NOT NULL
     OR RSTR_USG_TP_LBL_NM9 IS NOT NULL
     OR RSTR_USG_TP_LBL_NM10 IS NOT NULL
     OR RSTR_USG_TP_LBL_NM11 IS NOT NULL
     OR RSTR_USG_TP_LBL_NM12 IS NOT NULL
     OR RSTR_USG_TP_LBL_NM13 IS NOT NULL
     OR RSTR_USG_TP_LBL_NM14 IS NOT NULL
     OR RSTR_USG_TP_LBL_NM15 IS NOT NULL)
#if (${cntr_list} != '')
AND     MC.CNTR_NO IN (
    #foreach ($key IN ${cntr_list})
        #if($velocityCount < $cntr_list.size())
            '$key',
        #else
            '$key'
        #end
    #end                          
)
#end

#if (${s_tp_cd} != '') 
AND MC.CNTR_TPSZ_CD IN ( 
    SELECT COLUMN_VALUE
    FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[s_tp_cd] ) AS listItemType ) 
    FROM dual )
)
#end

#if (${s_agmt_seq} != '')
AND MC.AGMT_CTY_CD = @[s_agmt_cty_cd]
AND MC.AGMT_SEQ   = @[s_agmt_seq]
#end 

#if (${s_multi_agmt_seq} != '') 
AND     MC.AGMT_SEQ IN (
    #foreach ($key IN ${agmtseq_list})
        #if($velocityCount < $agmtseq_list.size())
            '$key',
        #else
            '$key'
        #end
    #end                          
)
#end

#if (${s_auth_no} != '')
AND MC.CNTR_AUTH_NO    Like '%' || @[s_auth_no] || '%'
#end 

                

#if (${s_ru_label_type} != '') 
AND MH.RSTR_USG_TP_CD = @[s_ru_label_type]
#end

#if (${s_ru_label_value} != '') 
AND     MH.RSTR_USG_LBL_NM IN (
    #foreach ($key IN ${labelvalue_list})
        #if($velocityCount < $labelvalue_list.size())
            '$key',
        #else
            '$key'
        #end
    #end                          
)
#end

#if (${cntr_spec_no} != '')
AND MC.CNTR_SPEC_NO    = @[cntr_spec_no]
#end 

#if (${s_cntr_sts_cd} != '') 
AND     MC.CNTR_STS_CD IN (
    SELECT COLUMN_VALUE
    FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[s_cntr_sts_cd] ) AS listItemType ) 
    FROM dual )                     
)
#end
#if (${lot_no} != '')
AND MC.CNTR_TPSZ_CD = @[cntr_lot_tpsz_cd]
AND MC.LOT_PLN_YR   = @[lot_pln_yr]
AND MC.LOT_LOC_CD   = @[lot_loc_cd]
AND MC.LOT_SEQ      = @[lot_seq]
#end
) SUB
#if (${startno} != '') 
  WHERE 	ROW_SEQ BETWEEN @[startno] AND @[endno]
#end			]]></sql>
			<params>
				<param name="s_tp_cd" type="12" value="" out="N"/>
				<param name="s_agmt_cty_cd" type="12" value="" out="N"/>
				<param name="s_agmt_seq" type="12" value="" out="N"/>
				<param name="s_auth_no" type="12" value="" out="N"/>
				<param name="s_ru_label_type" type="12" value="" out="N"/>
				<param name="cntr_spec_no" type="12" value="" out="N"/>
				<param name="s_cntr_sts_cd" type="12" value="" out="N"/>
				<param name="cntr_lot_tpsz_cd" type="12" value="" out="N"/>
				<param name="lot_pln_yr" type="12" value="" out="N"/>
				<param name="lot_loc_cd" type="12" value="" out="N"/>
				<param name="lot_seq" type="12" value="" out="N"/>
				<param name="startno" type="12" value="" out="N"/>
				<param name="endno" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
