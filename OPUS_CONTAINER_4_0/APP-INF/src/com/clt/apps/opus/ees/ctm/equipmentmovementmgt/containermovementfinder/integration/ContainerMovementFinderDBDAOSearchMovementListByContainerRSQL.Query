<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContainerMovementFinderDBDAOSearchMovementListByContainerRSQL">
			<desc><![CDATA[EES_CTM_0408 : 컨테이너 번호에 의한 Each Container LIST 조회]]></desc>
			<sql><![CDATA[
SELECT CNMV_CYC_NO,
       CNMV_CO_CD,
       MVMT_STS_CD,
       MVMT_CRE_TP_CD,
       ORG_YD_CD,
       DEST_YD_CD,
       CNMV_EVNT_DT,
       VVD_CD,
       BKG_KNT,
       BKG_NO,
       BL_NO, 
       MTY_PLN_NO,
       DECODE (FCNTR_FLG, 'Y', 'F', 'M') AS FCNTR_FLG,
       DECODE (OB_CNTR_FLG, 'Y', 'O', 'I') AS OB_CNTR_FLG,
       MVMT_EDI_MSG_TP_ID,
       BKG_CGO_TP_CD,
       CNTR_DMG_FLG,
       CNTR_HNGR_RCK_CD,
       CNTR_HNGR_BAR_ATCH_KNT,
       CNTR_DISP_FLG,
       IMDT_EXT_FLG,
       CNTR_XCH_CD,       
       CNTR_RFUB_FLG,
       SPCL_CGO_FLG,
       VNDR_SEQ,
       VNDR_ABBR_NM,
	   RSTR_USG_LBL_NM_DESC,
	   RSTR_USG_LBL_VAL_DESC,
       MVMT_TRSP_MOD_CD,
       CHSS_NO,
       MGST_NO,
       CNTR_SEAL_NO,
       WBL_NO,
       PKUP_NO,
       UPD_LOCL_DT,
       CRE_LOCL_DT,
       UPD_DT,
       CRE_DT,
       OFC_CD,
       USR_NM,
       CNMV_RMK,
       CNMV_YR,
       CNMV_SEQ,
       CNMV_SPLIT_NO,
	   DMG_FLG_DT,
	   DMG_UNFLG_DT,
       USA_EDI_CD
       , CNTR_STWG_PSN_CTNT
  FROM (SELECT /*+ INDEX CTM_MOVEMENT XAK2CTM_MOVEMENT */
               A.CNMV_CYC_NO,
               A.CNMV_CO_CD,
               A.MVMT_STS_CD,
               A.MVMT_CRE_TP_CD,
               A.ORG_YD_CD,
               A.DEST_YD_CD,
               TO_CHAR (A.CNMV_EVNT_DT, 'YYYY-MM-DD HH24:MI') AS CNMV_EVNT_DT,
               A.CRNT_VSL_CD||A.CRNT_SKD_VOY_NO||A.CRNT_SKD_DIR_CD AS VVD_CD,
               A.BKG_KNT,
               A.BKG_NO,
               A.BL_NO,
               NVL(A.MTY_PLN_NO, NVL(A.MTY_REPO_NO,'')) AS MTY_PLN_NO,
               A.FCNTR_FLG,
               A.OB_CNTR_FLG,
               A.MVMT_EDI_MSG_TP_ID,
               A.BKG_CGO_TP_CD,
               A.CNTR_DMG_FLG,
               DECODE (A.CNMV_YR||LPAD (A.CNMV_SEQ, 4, 0)||A.CNMV_SPLIT_NO, TEMP_CNMV_CD, CTM.CNTR_HNGR_RCK_CD, '') AS CNTR_HNGR_RCK_CD,
               DECODE (A.CNMV_YR||LPAD (A.CNMV_SEQ, 4, 0)||A.CNMV_SPLIT_NO, TEMP_CNMV_CD, CTM.CNTR_HNGR_BAR_ATCH_KNT, '') AS CNTR_HNGR_BAR_ATCH_KNT,
               A.CNTR_DISP_FLG,
               A.IMDT_EXT_FLG,
         	   A.CNTR_XCH_CD,               
               A.CNTR_RFUB_FLG,
               A.SPCL_CGO_FLG,
               C.VNDR_SEQ,
               C.VNDR_ABBR_NM,
			   CASE WHEN A.CNMV_YR=MST_CNTR.CNMV_YR AND A.CNMV_ID_NO=MST_CNTR.CNMV_ID_NO THEN
                        MST_COMMON_PKG.MST_RU_TP_GET_FNC(@[p_cntrno])
                    ELSE
                        A.RSTR_USG_LBL_NM_DESC
                END RSTR_USG_LBL_NM_DESC,
			   CASE WHEN A.CNMV_YR=MST_CNTR.CNMV_YR AND A.CNMV_ID_NO=MST_CNTR.CNMV_ID_NO THEN
                        MST_COMMON_PKG.MST_RU_VAL_GET_FNC(@[p_cntrno])
                    ELSE
                        A.RSTR_USG_LBL_VAL_DESC
                END RSTR_USG_LBL_VAL_DESC,
               A.MVMT_TRSP_MOD_CD,
               TRIM (A.CHSS_NO) AS CHSS_NO,
               TRIM (A.MGST_NO) AS MGST_NO,
               TRIM (A.CNTR_SEAL_NO) AS CNTR_SEAL_NO,
               TRIM (A.WBL_NO) AS WBL_NO,
               TRIM (A.PKUP_NO) AS PKUP_NO,
               TO_CHAR (A.UPD_LOCL_DT, 'YYYY-MM-DD HH24:MI') AS UPD_LOCL_DT,
               TO_CHAR (A.CRE_LOCL_DT, 'YYYY-MM-DD HH24:MI') AS CRE_LOCL_DT,
               TO_CHAR (A.UPD_DT, 'YYYY-MM-DD HH24:MI') AS UPD_DT,
               TO_CHAR (A.CRE_DT, 'YYYY-MM-DD HH24:MI') AS CRE_DT,
               A.OFC_CD,
               TRIM(A.USR_NM) AS USR_NM,
               TRIM(A.CNMV_RMK) AS CNMV_RMK,
               A.CNMV_YR,
               A.CNMV_SEQ,
               A.CNMV_SPLIT_NO,
               A.CNMV_ID_NO,
               A.CNTR_NO,
			   TO_CHAR (A.DMG_FLG_DT, 'YYYY-MM-DD HH24:MI') AS DMG_FLG_DT,
			   TO_CHAR (A.DMG_UNFLG_DT, 'YYYY-MM-DD HH24:MI') AS DMG_UNFLG_DT,
               A.USA_EDI_CD
               , MSG.CNTR_STWG_PSN_CTNT
          FROM CTM_MOVEMENT A,
               CTM_MVMT_EDI_MSG MSG,
               MDM_VENDOR C,
               (SELECT /*+ INDEX(CTM XAK2CTM_MOVEMENT) */
                       CTM.CNTR_NO,
                       MAX (CTM.CNMV_YR||LPAD (CTM.CNMV_SEQ, 4, 0)||CTM.CNMV_SPLIT_NO) AS TEMP_CNMV_CD,
                       NVL2 (MST.CNTR_HNGR_RCK_CD, 'Y', 'N') AS CNTR_HNGR_RCK_CD,
                       MST.CNTR_HNGR_BAR_ATCH_KNT
                  FROM CTM_MOVEMENT CTM, MST_CONTAINER MST
                 WHERE CTM.CNTR_NO = MST.CNTR_NO
                   AND CTM.CNTR_NO = @[p_cntrno]
                   AND CTM.CNMV_EVNT_DT BETWEEN TO_DATE (@[p_date1], 'YYYY-MM-DD') AND TO_DATE (@[p_date2], 'YYYY-MM-DD') + 0.99999
                 GROUP BY CTM.CNTR_NO, MST.CNTR_HNGR_RCK_CD, MST.CNTR_HNGR_BAR_ATCH_KNT
               ) CTM,
               MST_CONTAINER MST_CNTR
         WHERE A.CNTR_NO = @[p_cntrno]
           AND A.MVMT_EDI_TP_CD = MSG.MVMT_EDI_TP_CD(+)
           AND A.MVMT_EDI_MSG_TP_ID = MSG.MVMT_EDI_MSG_TP_ID(+)
           AND A.MVMT_EDI_MSG_AREA_CD = MSG.MVMT_EDI_MSG_AREA_CD(+)
           AND A.MVMT_EDI_MSG_YRMONDY = MSG.MVMT_EDI_MSG_YRMONDY(+)
           AND A.MVMT_EDI_MSG_SEQ = MSG.MVMT_EDI_MSG_SEQ(+)
           AND A.CNTR_NO = CTM.CNTR_NO
           AND A.CNMV_EVNT_DT BETWEEN TO_DATE (@[p_date1], 'YYYY-MM-DD') AND TO_DATE (@[p_date2], 'YYYY-MM-DD') + 0.99999
           AND A.VNDR_SEQ = C.VNDR_SEQ(+)
           AND A.CNTR_NO = MST_CNTR.CNTR_NO
       ) CM
 ORDER BY CNMV_YR, CNMV_SEQ, CNMV_SPLIT_NO			]]></sql>
			<params>
				<param name="p_cntrno" type="12" value="" out="N"/>
				<param name="p_date1" type="12" value="" out="N"/>
				<param name="p_date2" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
