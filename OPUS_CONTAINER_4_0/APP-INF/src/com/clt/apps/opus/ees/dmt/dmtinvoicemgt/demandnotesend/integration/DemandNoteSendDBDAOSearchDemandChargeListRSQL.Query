<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DemandNoteSendDBDAOSearchDemandChargeListRSQL">
			<desc><![CDATA[SearchDemandChargeList]]></desc>
			<sql><![CDATA[
#if (${grp_type} == '2')
SELECT
	 BKG_NO
	,BL_NO
	,CNTR_QTY                                           
	,CNTR_NO
	,DMDT_CHG_STS_CD
	,OFC_CD
	,FM_MVMT_YD_CD
	,PORT
	,DMDT_TRF_CD
	,DECODE(
		(CASE WHEN LENGTH(PAYER_CD) = 8 THEN  
           		CASE WHEN SUBSTR(PAYER_CD, 1, 2) = '00' 
                     THEN SUBSTR(PAYER_CD, 3) ELSE PAYER_CD END 
           ELSE PAYER_CD END) , '000000','',
		(CASE WHEN LENGTH(PAYER_CD) = 8 THEN  
           		CASE WHEN SUBSTR(PAYER_CD, 1, 2) = '00' 
                     THEN SUBSTR(PAYER_CD, 3) ELSE PAYER_CD END 
           ELSE PAYER_CD END)
			) AS PAYER_CD
	,PAYER_NM
	,SHIPPER_CD
	,SHIPPER_NM
	,CNEE_CD
	,CNEE_NM
	,NTFY_CD
	,NTFY_NM
	,AR_ACT_CD
	,AR_ACT_NM
	,SVC_PROVDR_CD
	,SVC_PROVDR_NM
	,SC_NO
	,RFA_NO
	,INV_CURR_CD
    ,BIL_AMT AS INV_CHG_AMT    
    ,ORG_CHG_AMT AS INV_ORG_AMT  ##RD용
 	,DC_AMT AS INV_DC_AMT ##RD용
	,ORG_CURR_CD
	,ORG_CHG_AMT
	,EXPT_AMT
	,DC_AMT
	,BIL_AMT
	,AR_XCH_RT AS INV_XCH_RT
	,SVR_ID
	,CNTR_CYC_NO
	,DMDT_CHG_LOC_DIV_CD
	,CHG_SEQ
    ,DMDT_INV_NO
 	,VSL_CD
	,SKD_VOY_NO
	,SKD_DIR_CD
	,POL_CD
	,POD_CD
FROM (	
	SELECT B.BKG_NO
	      ,B.BL_NO
	      ,'' AS CNTR_QTY                                           
	      ,C.CNTR_NO
	      ,C.DMDT_CHG_STS_CD
	      ,C.OFC_CD
	      ,C.FM_MVMT_YD_CD
	      ,DECODE (SUBSTR (C.DMDT_TRF_CD
	                      ,3
	                      ,1
	                      )
	              ,'O', B.POR_CD
	              ,B.DEL_CD
	              ) AS PORT
	      ,C.DMDT_TRF_CD
          ,DECODE (C.ACT_CNT_CD,'00', '',C.ACT_CNT_CD)
        			|| TO_CHAR (C.ACT_CUST_SEQ, 'FM000000') AS PAYER_CD
	      ,CASE
	          WHEN C.DMDT_TRF_CD = 'DTIC'
	          ##AND B.BKG_DE_TERM_CD = 'Y'
	          AND INSTR (NVL (B.POD_CD, '  '), 'US') = 1
	             THEN (SELECT MV.VNDR_LGL_ENG_NM
	                     FROM MDM_VENDOR MV
	                    WHERE MV.VNDR_SEQ = C.VNDR_SEQ)
	          WHEN C.DMDT_TRF_CD = 'DTOC'
	          ##AND B.BKG_RCV_TERM_CD = 'Y'
	          AND INSTR (NVL (B.POL_CD, '  '), 'US') = 1
	             THEN (SELECT MV.VNDR_LGL_ENG_NM
	                     FROM MDM_VENDOR MV
	                    WHERE MV.VNDR_SEQ = C.VNDR_SEQ)
	          WHEN C.DMDT_TRF_CD IN ('DMIF', 'CTIC')
	           OR (    C.DMDT_TRF_CD = 'DTIC'
	               AND INSTR (NVL (B.POD_CD, '  '), 'US') <> 1
	              )
	             THEN (SELECT MC.CUST_LGL_ENG_NM
	                     FROM MDM_CUSTOMER MC
	                    WHERE MC.CUST_CNT_CD = C.ACT_CNT_CD
	                      AND MC.CUST_SEQ = C.ACT_CUST_SEQ)
	          WHEN C.DMDT_TRF_CD IN ('DMOF', 'CTOC')
	           OR (    C.DMDT_TRF_CD = 'DTOC'
	               AND INSTR (NVL (B.POL_CD, '  '), 'US') <> 1
	              )
	             THEN REPLACE (BS.CUST_NM
	                          , CHR (13)
	                            || CHR (10)
	                          ,' '
	                          )
	       END AS PAYER_NM
	      , BS.CUST_CNT_CD
	        || TRIM (TO_CHAR (BS.CUST_SEQ, '000000')) SHIPPER_CD
	      ,REPLACE (BS.CUST_NM
	               , CHR (13)
	                 || CHR (10)
	               ,' '
	               ) SHIPPER_NM
	      ,DECODE (BC.CUST_CNT_CD
	               || TRIM (TO_CHAR (BC.CUST_SEQ, '000000'))
	              ,'000000', NULL
	              , BC.CUST_CNT_CD
	                || TRIM (TO_CHAR (BC.CUST_SEQ, '000000'))
	              ) CNEE_CD
	      ,REPLACE (BC.CUST_NM
	               , CHR (13)
	                 || CHR (10)
	               ,' '
	               ) CNEE_NM
	      ,DECODE (BN.CUST_CNT_CD
	               || TRIM (TO_CHAR (BN.CUST_SEQ, '000000'))
	              ,'000000', NULL
	              , BN.CUST_CNT_CD
	                || TRIM (TO_CHAR (BN.CUST_SEQ, '000000'))
	              ) NTFY_CD
	      ,NVL (RTRIM (REPLACE (REPLACE (BN.CUST_NM
	                                    ,'"'
	                                    ,''
	                                    )
	                           , CHR (13)
	                             || CHR (10)
	                           ,' '
	                           ))
	           ,'-') NTFY_NM
	      , (SELECT I.ACT_CUST_CNT_CD
	                || TRIM (TO_CHAR (ACT_CUST_SEQ, '000000'))
	           FROM INV_AR_MN I
	          WHERE I.BKG_NO = B.BKG_NO
	            AND I.IO_BND_CD = SUBSTR (C.DMDT_TRF_CD
	                                     ,3
	                                     ,1
	                                     )
	            AND AR_IF_NO =
	                   (SELECT MAX (AR_IF_NO)
	                      FROM INV_AR_MN
	                     WHERE BKG_NO = B.BKG_NO
	                       AND IO_BND_CD = SUBSTR (C.DMDT_TRF_CD
	                                              ,3
	                                              ,1
	                                              ))
	            AND ROWNUM = 1) AS AR_ACT_CD
	      , (SELECT MC.CUST_LGL_ENG_NM
	           FROM MDM_CUSTOMER MC
	               ,INV_AR_MN I
	          WHERE MC.CUST_CNT_CD = I.ACT_CUST_CNT_CD
	            AND MC.CUST_SEQ = I.ACT_CUST_SEQ
	            AND I.BKG_NO = B.BKG_NO
	            AND I.IO_BND_CD = SUBSTR (C.DMDT_TRF_CD
	                                     ,3
	                                     ,1
	                                     )
	            AND AR_IF_NO =
	                   (SELECT MAX (AR_IF_NO)
	                      FROM INV_AR_MN
	                     WHERE BKG_NO = B.BKG_NO
	                       AND IO_BND_CD = SUBSTR (C.DMDT_TRF_CD
	                                              ,3
	                                              ,1
	                                              ))
	            AND ROWNUM = 1) AS AR_ACT_NM
	      ,DECODE (TRIM (TO_CHAR (C.VNDR_SEQ, '000000'))
	              ,'000000', NULL
	              ,TRIM (TO_CHAR (C.VNDR_SEQ, '000000'))
	              ) AS SVC_PROVDR_CD
	      , (SELECT MV.VNDR_LGL_ENG_NM
	           FROM MDM_VENDOR MV
	          WHERE MV.VNDR_SEQ = C.VNDR_SEQ) AS SVC_PROVDR_NM
	      ,B.SC_NO
	      ,B.RFA_NO
	      ,CASE WHEN (SELECT AR_OFC_CD FROM MDM_ORGANIZATION WHERE OFC_CD = @[ofc_cd]) IN ('SGNBB', 'SAOBB', 'MTRBS', 'TORBB', 'VANBS', 'MEXBA') THEN 'USD'
          			  ELSE (SELECT AR_CURR_CD FROM MDM_ORGANIZATION WHERE OFC_CD = @[ofc_cd])
          			   END AS INV_CURR_CD   
	      ,C.BZC_TRF_CURR_CD AS ORG_CURR_CD
	      ,C.ORG_CHG_AMT AS ORG_CHG_AMT
		  ,C.SC_RFA_EXPT_AMT AS EXPT_AMT
	      ,C.AFT_EXPT_DC_AMT AS DC_AMT
	      ,C.BIL_AMT
	      ,C.SYS_AREA_GRP_ID AS SVR_ID
	      ,C.CNTR_CYC_NO
	      ,C.DMDT_CHG_LOC_DIV_CD
	      ,C.CHG_SEQ
          ,CASE WHEN (SELECT AR_OFC_CD FROM MDM_ORGANIZATION WHERE OFC_CD = @[ofc_cd]) IN ('SGNBB', 'SAOBB', 'MTRBS', 'TORBB', 'VANBS', 'MEXBA') THEN 'USD'
          			  ELSE (SELECT AR_CURR_CD FROM MDM_ORGANIZATION WHERE OFC_CD = @[ofc_cd])
          			   END  AS AR_CURR_CD
	      ,1 AS AR_XCH_RT
		  ,C.BZC_TRF_CURR_CD
 		  ,C.DMDT_INV_NO
 		  ,B.VSL_CD
		  ,B.SKD_VOY_NO
		  ,B.SKD_DIR_CD
		  ,B.POL_CD
		  ,B.POD_CD
	  FROM DMT_CHG_BKG_CNTR B
	      ,DMT_CHG_CALC C
	      ,BKG_CUSTOMER BS
	      ,BKG_CUSTOMER BC
	      ,BKG_CUSTOMER BN
	WHERE B.SYS_AREA_GRP_ID = C.SYS_AREA_GRP_ID
	  AND B.CNTR_NO = C.CNTR_NO
	  AND B.CNTR_CYC_NO = C.CNTR_CYC_NO
	  AND B.BKG_NO   = BS.BKG_NO(+)
	  AND BS.BKG_CUST_TP_CD(+) = 'S'
	  AND B.BKG_NO   = BC.BKG_NO (+)
	  AND BC.BKG_CUST_TP_CD(+) = 'C'
	  AND B.BKG_NO   = BN.BKG_NO(+)
	  AND BN.BKG_CUST_TP_CD(+) = 'N'
      AND C.DMDT_CHG_LOC_DIV_CD IN ('POD','POL','POR','DEL', 'TSP')	  

	##    -- 메인 조회 : Office        
	#if (${ofc_cd} != '')
	   AND C.OFC_CD            =   @[ofc_cd]   
	#end
		
	
	##  -- 메인 조회 : Tariff type 
	   AND    C.DMDT_TRF_CD        =	@[dmdt_trf_cd]
	
	##  -- 메인 조회 : Status + OVERDAY : F/T OVER DAY OR STAYING DAY(단, DMDT_CHG_STS_CD가 U일 경우는 over day 적용 제외)
	#if (${dmdt_chg_sts_cd} != '') 
		AND ( 1=0
		#foreach( $chg_sts_cd in ${chg_sts_cd_list} )	
			#if (${cond_type} != 'date')
	
				#if ($chg_sts_cd != 'U')
					OR (C.DMDT_CHG_STS_CD = '$chg_sts_cd'
						#if (${fx_ft_ovr_dys} != '')
							#if (${day_type} == '1')
								AND C.FX_FT_OVR_DYS >= TO_NUMBER(@[fx_ft_ovr_dys])
							#elseif (${day_type} == '2')
							AND	(   (    C.TO_MVMT_DT IS NOT NULL
						          	    AND (TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						        	  OR (    C.TO_MVMT_DT IS NULL
						           	   AND (TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						       	  )
							#end ## end of the day_type
						#end														
						) 
				#else
					OR (C.DMDT_CHG_STS_CD = '$chg_sts_cd'

						#if (${fx_ft_ovr_dys} != '')
							#if (${day_type} == '1')
							AND (   
									  ( C.TO_MVMT_DT IS NOT NULL 
									    AND 
									    TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'RRRRMMDD'),'YYYYMMDDHH24MISS') - TO_DATE (TO_CHAR (C.FT_END_DT, 'RRRRMMDD'), 'YYYYMMDDHH24MISS') >= TO_NUMBER (@[fx_ft_ovr_dys])
										)
										OR 
									  ( C.TO_MVMT_DT IS NULL 
									    AND 
									    TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'RRRRMMDD'),'YYYYMMDDHH24MISS') - TO_DATE (TO_CHAR (C.FT_END_DT, 'RRRRMMDD'), 'YYYYMMDDHH24MISS') >= TO_NUMBER (@[fx_ft_ovr_dys])						          	   
									  )					       	  
									)
							#elseif (${day_type} == '2')
							AND	(   (    C.TO_MVMT_DT IS NOT NULL
						          	    AND (TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						        	  OR (    C.TO_MVMT_DT IS NULL
						           	   AND (TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						       	  )
							#end ## end of the day_type
						#end														
						) 
				#end
			#else
				#if ($chg_sts_cd == 'F')
					OR (C.DMDT_CHG_STS_CD = 'F'
		            	AND C.TO_MVMT_DT BETWEEN TO_DATE(@[fm_dt], 'yyyymmdd') 
		            						AND TO_DATE(@[to_dt], 'yyyymmdd') + 0.99999 
		            		#if (${fx_ft_ovr_dys} != '')				
						#if (${day_type} == '1')
							AND C.FX_FT_OVR_DYS >= TO_NUMBER(@[fx_ft_ovr_dys])
						#elseif (${day_type} == '2')
							AND	(   (    C.TO_MVMT_DT IS NOT NULL
						          	    AND (TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						        	  OR (    C.TO_MVMT_DT IS NULL
						           	   AND (TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						       	  )
						#end ## end of the day_type
					#end						
					
					)
				#elseif ($chg_sts_cd == 'L')
					OR (C.DMDT_CHG_STS_CD = 'L'
		            	AND C.FM_MVMT_DT BETWEEN TO_DATE(@[fm_dt], 'yyyymmdd') 
		            						AND TO_DATE(@[to_dt], 'yyyymmdd') + 0.99999 
					#if (${fx_ft_ovr_dys} != '')		            						
						#if (${day_type} == '1')
							AND C.FX_FT_OVR_DYS >= TO_NUMBER(@[fx_ft_ovr_dys])
						#elseif (${day_type} == '2')
							AND	(   (    C.TO_MVMT_DT IS NOT NULL
						          	    AND (TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						        	  OR (    C.TO_MVMT_DT IS NULL
						           	   AND (TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						       	  )
						#end ## end of the day_type
					#end						
					)
				#elseif ($chg_sts_cd == 'U')
					OR (C.DMDT_CHG_STS_CD = 'U'
		            	AND C.FM_MVMT_DT BETWEEN TO_DATE(@[fm_dt], 'yyyymmdd') 
		                                	AND TO_DATE(@[to_dt], 'yyyymmdd') + 0.99999 
					#if (${fx_ft_ovr_dys} != '')		            						
						#if (${day_type} == '1')
							AND (   
									  ( C.TO_MVMT_DT IS NOT NULL 
									    AND 
									    TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'RRRRMMDD'),'YYYYMMDDHH24MISS') - TO_DATE (TO_CHAR (C.FT_END_DT, 'RRRRMMDD'), 'YYYYMMDDHH24MISS') >= TO_NUMBER (@[fx_ft_ovr_dys])
										)
										OR 
									  ( C.TO_MVMT_DT IS NULL 
									    AND 
									    TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'RRRRMMDD'),'YYYYMMDDHH24MISS') - TO_DATE (TO_CHAR (C.FT_END_DT, 'RRRRMMDD'), 'YYYYMMDDHH24MISS') >= TO_NUMBER (@[fx_ft_ovr_dys])						          	   
									  )					       	  
									)
						#elseif (${day_type} == '2')
							AND	(   (    C.TO_MVMT_DT IS NOT NULL
						          	    AND (TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						        	  OR (    C.TO_MVMT_DT IS NULL
						           	   AND (TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						       	  )
						#end ## end of the day_type
					#end						
					)
				#elseif ($chg_sts_cd == 'C')
					OR (C.DMDT_CHG_STS_CD = 'C'
		            	AND C.TO_MVMT_DT BETWEEN TO_DATE(@[fm_dt], 'yyyymmdd') 
		            						AND TO_DATE(@[to_dt], 'yyyymmdd') + 0.99999 
					#if (${fx_ft_ovr_dys} != '')		            						
						#if (${day_type} == '1')
							AND C.FX_FT_OVR_DYS >= TO_NUMBER(@[fx_ft_ovr_dys])
						#elseif (${day_type} == '2')
							AND	(   (    C.TO_MVMT_DT IS NOT NULL
						          	    AND (TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						        	  OR (    C.TO_MVMT_DT IS NULL
						           	   AND (TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						       	  )
						#end ## end of the day_type
					#end						
					)
				#elseif ($chg_sts_cd == 'I')
					OR (C.DMDT_CHG_STS_CD = 'I'
		            	AND C.TO_MVMT_DT BETWEEN TO_DATE(@[fm_dt], 'yyyymmdd') 
		            						AND TO_DATE(@[to_dt], 'yyyymmdd') + 0.99999 
					#if (${fx_ft_ovr_dys} != '')		            						
						#if (${day_type} == '1')
							AND C.FX_FT_OVR_DYS >= TO_NUMBER(@[fx_ft_ovr_dys])
						#elseif (${day_type} == '2')
							AND	(   (    C.TO_MVMT_DT IS NOT NULL
						          	    AND (TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						        	  OR (    C.TO_MVMT_DT IS NULL
						           	   AND (TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						       	  )
						#end ## end of the day_type
					#end						
					)
				#elseif ($chg_sts_cd == 'R')
					OR (C.DMDT_CHG_STS_CD = 'L'
						
					#if (${fx_ft_ovr_dys} != '')
						#if (${day_type} == '1')
							AND C.FX_FT_OVR_DYS >= TO_NUMBER(@[fx_ft_ovr_dys])
						#elseif (${day_type} == '2')
							AND	(   (    C.TO_MVMT_DT IS NOT NULL
						          	    AND (TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						        	  OR (    C.TO_MVMT_DT IS NULL
						           	   AND (TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						       	  )
						#end ## end of the day_type
					#end
					)
				#end
			#end
		#end
		)
	#end
	
	##  -- 메인 조회 : G/B CHARGE_TYPE
	#if (${chg_type} == 'G') 
	AND C.CHG_SEQ = 1
	#elseif (${chg_type} == 'B') 
	AND C.CHG_SEQ > 1
	#end
	
	##  --선택 조회 1: DATE 일 경우
	#if (${cond_type} == 'date')
	
		#if (${loc_cd} != '')
			#if (${loc_type} == '1')
				AND (( LENGTH(@[loc_cd]) = 5 AND C.FM_MVMT_YD_CD LIKE  @[loc_cd] || '%' )
					OR
					( LENGTH(@[loc_cd]) = 7 AND C.FM_MVMT_YD_CD =  @[loc_cd] ))
			#elseif (${loc_type} == '2') 
				AND DECODE(SUBSTR(@[dmdt_trf_cd], 3, 1),'O', B.POR_CD, B.DEL_CD) = SUBSTR(@[loc_cd], 1, 5)
			#end
		#end
	##else
	##	AND C.DMDT_CHG_STS_CD NOT IN ('D','N','U','I','C')
	#end
	
	##  --선택 조회 2: VVD CD 일 경우
	
	#if (${cond_type} == 'vvd_cd')
		#if (${vvd_cd} != '')
		AND (	B.VSL_CD = SUBSTR(@[vvd_cd],1,4) 
			AND B.SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4) 
			AND B.SKD_DIR_CD = SUBSTR(@[vvd_cd],9) 
			)
		#end
		
		#if (${port_cd} != '')
		AND	DECODE(SUBSTR(@[dmdt_trf_cd], 3, 1),'O', B.POL_CD, B.POD_CD) = @[port_cd]
		#end
		
	#end
	
	##  --선택 조회 3: CNTR 종류를 선택 했을 경우
	#if (${cond_type} == 'cntr')
		#if (${bkg_no} != '')	
		AND B.BKG_NO IN (
			#foreach( $bkg_cd in ${bkg_no_list} )
				#if($velocityCount < $bkg_no_list.size()) '$bkg_cd', #else '$bkg_cd' #end
			#end
			)
		#end
	
		#if (${bl_no} != '')
		AND B.BL_NO IN (
			#foreach( $bl_cd in ${bl_no_list} )
				#if($velocityCount < $bl_no_list.size()) '$bl_cd', #else '$bl_cd' #end
			#end
			)
		#end
	
		#if (${cntr_no} != '')
		AND C.CNTR_NO IN (
			#foreach( $cntr_cd in ${cntr_no_list} )
				#if($velocityCount < $cntr_no_list.size()) '$cntr_cd', #else '$cntr_cd' #end
			#end
			)
		#end
	#end
	

	##  --선택 조회 : CUSTOMER 종류
	#if (${cust_cd} != '')
		#if (${cust_type} == '')
		AND (
			#if (${cust_len} == '8')	
					C.ACT_CNT_CD	= SUBSTR(@[cust_cd],1,2)
				AND C.ACT_CUST_SEQ	= LTRIM(SUBSTR(@[cust_cd],3),'0')
			#else
					C.ACT_CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],1,6),'0')
			#end

			OR		BS.CUST_CNT_CD	= SUBSTR(@[cust_cd],1,2)
				AND BS.CUST_SEQ		= LTRIM(SUBSTR(@[cust_cd],3),'0')
			OR		BC.CUST_CNT_CD	= SUBSTR(@[cust_cd],1,2)
				AND BC.CUST_SEQ		= LTRIM(SUBSTR(@[cust_cd],3),'0')
			OR 		BN.CUST_CNT_CD	= SUBSTR(@[cust_cd],1,2)
				AND BN.CUST_SEQ		= LTRIM(SUBSTR(@[cust_cd],3),'0')
			OR(
				EXISTS (
	    		SELECT  'X'
	    		FROM    INV_AR_MN I
	    		WHERE   I.BKG_NO = B.BKG_NO
	    		AND     I.IO_BND_CD = 'I'
				AND     ROWNUM  = 1
				AND     I.ACT_CUST_CNT_CD   = SUBSTR(@[cust_cd],1,2)
				AND     I.ACT_CUST_SEQ      = LTRIM(SUBSTR(@[cust_cd],3),'0')
				)
			)
		)
		#elseif (${cust_type} == 'P')
			#if (${cust_len} == '8')	
				AND	C.ACT_CNT_CD	= SUBSTR(@[cust_cd],1,2)
				AND C.ACT_CUST_SEQ	= LTRIM(SUBSTR(@[cust_cd],3),'0')
			#else
				AND	C.ACT_CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],1,6),'0')
			#end
		#elseif (${cust_type} == 'S') 
			AND BS.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
			AND BS.CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],3),'0')
		#elseif (${cust_type} == 'C') 
			AND BC.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
			AND BC.CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],3),'0')
		#elseif (${cust_type} == 'N') 
			AND BN.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
			AND BN.CUST_SEQ  = LTRIM(SUBSTR(@[cust_cd],3),'0')
		#elseif (${cust_type} == 'A')		
			AND EXISTS (
	    		SELECT  'X'
	    		FROM    INV_AR_MN I
	    		WHERE   I.BKG_NO = B.BKG_NO
	    		AND     I.IO_BND_CD = 'I'
				AND     ROWNUM  = 1
				AND     I.ACT_CUST_CNT_CD   = SUBSTR(@[cust_cd],1,2)
				AND     I.ACT_CUST_SEQ      = LTRIM(SUBSTR(@[cust_cd],3),'0')
				)
		#end
	#end
	
	##  --선택 조회 : Service Provider 종류
	
	#if (${svc_provdr} != '') 
	AND C.VNDR_SEQ = LTRIM(@[svc_provdr],'0')
	#end
	
	##  --선택 조회 : S/C No 
	
	#if (${sc_no} != '') 
	AND B.SC_NO = @[sc_no]
	#end
	
	##  --선택 조회 : RFA No 
	#if (${rfa_no} != '') 
	AND B.RFA_NO = @[rfa_no]
	#end
) X	
ORDER BY X.BKG_NO, X.CNTR_NO


#elseif (${grp_type} == '1')

SELECT BKG_NO
      ,BL_NO
      ,CNTR_QTY
	  ,DMDT_CHG_STS_CD
      ,OFC_CD
      ,FM_MVMT_YD_CD
      ,PORT
      ,DMDT_TRF_CD
	  ,DECODE(
			(CASE WHEN LENGTH(PAYER_CD) = 8 THEN  
	           		CASE WHEN SUBSTR(PAYER_CD, 1, 2) = '00' 
	                     THEN SUBSTR(PAYER_CD, 3) ELSE PAYER_CD END 
	           ELSE PAYER_CD END) , '000000','',
			(CASE WHEN LENGTH(PAYER_CD) = 8 THEN  
	           		CASE WHEN SUBSTR(PAYER_CD, 1, 2) = '00' 
	                     THEN SUBSTR(PAYER_CD, 3) ELSE PAYER_CD END 
	           ELSE PAYER_CD END)
				) AS PAYER_CD
	  ,PAYER_NM
	  ,SHIPPER_CD
	  ,SHIPPER_NM
	  ,CNEE_CD
	  ,CNEE_NM
	  ,NTFY_CD
	  ,NTFY_NM
	  ,AR_ACT_CD
	  ,AR_ACT_NM
	  ,SVC_PROVDR_CD
	  ,SVC_PROVDR_NM
      ,SC_NO
      ,RFA_NO
      ,INV_CURR_CD
      ,INV_CHG_AMT
      ,ORG_CHG_AMT AS INV_ORG_AMT  ##RD용
 	  ,DC_AMT AS INV_DC_AMT ##RD용
      ,ORG_CURR_CD
      ,ORG_CHG_AMT
      ,EXPT_AMT
      ,DC_AMT
      ,BIL_AMT
      ,AR_XCH_RT AS INV_XCH_RT 
      ,SVR_ID
      ,CNTR_CYC_NO
      ,DMDT_CHG_LOC_DIV_CD
      ,CHG_SEQ
      ,DMDT_INV_NO
      , VSL_CD
      , SKD_VOY_NO
      , SKD_DIR_CD
      , POL_CD
      , POD_CD
  FROM (SELECT            
	      X.BKG_NO
	    , X.BL_NO
	    , COUNT(X.CNTR_NO) OVER (PARTITION by X.BKG_NO, X.OFC_CD, X.FM_MVMT_YD_CD) AS CNTR_QTY
		, X.DMDT_CHG_STS_CD
		, X.OFC_CD
		, X.FM_MVMT_YD_CD
	    , X.PORT
	    , X.DMDT_TRF_CD
	    , X.PAYER_CD
	    , X.PAYER_NM
	    , X.SHIPPER_CD
	    , X.SHIPPER_NM
	    , X.CNEE_CD
	    , X.CNEE_NM
	    , X.NTFY_CD
	    , X.NTFY_NM
	    , X.AR_ACT_CD
	    , X.AR_ACT_NM
	    , X.SVC_PROVDR_CD
	    , X.SVC_PROVDR_NM
	    , X.SC_NO
	    , X.RFA_NO
	    , X.INV_CURR_CD 
	    , SUM(X.BIL_AMT) OVER (PARTITION by X.BKG_NO, X.OFC_CD, X.FM_MVMT_YD_CD ORDER BY X.BKG_NO ASC) AS INV_CHG_AMT	
	    , X.ORG_CURR_CD
	    , SUM(X.ORG_CHG_AMT) OVER (PARTITION by X.BKG_NO, X.OFC_CD, X.FM_MVMT_YD_CD ORDER BY X.BKG_NO ASC) AS ORG_CHG_AMT	    
	    , SUM(X.EXPT_AMT) OVER (PARTITION by X.BKG_NO, X.OFC_CD, X.FM_MVMT_YD_CD ORDER BY X.BKG_NO ASC) AS EXPT_AMT
	    , SUM(X.DC_AMT) OVER (PARTITION by X.BKG_NO, X.OFC_CD, X.FM_MVMT_YD_CD ORDER BY X.BKG_NO ASC) AS DC_AMT
	    , SUM(X.BIL_AMT) OVER (PARTITION by X.BKG_NO, X.OFC_CD, X.FM_MVMT_YD_CD ORDER BY X.BKG_NO ASC) AS BIL_AMT
	    , X.SVR_ID
	    , X.CNTR_CYC_NO
	    , X.DMDT_CHG_LOC_DIV_CD
	    , X.CHG_SEQ
	    , AR_CURR_CD
	    , AR_XCH_RT	    
	    , ROW_NUMBER () OVER (PARTITION BY X.BKG_NO, X.OFC_CD, X.FM_MVMT_YD_CD ORDER BY X.BKG_NO ASC) AS RNUM
  	    , DMDT_INV_NO
 	    , VSL_CD
	    , SKD_VOY_NO
	    , SKD_DIR_CD
	    , POL_CD
	    , POD_CD
	FROM (
		SELECT B.BKG_NO
		      ,B.BL_NO
		      ,'' AS CNTR_QTY                                           
		      ,C.CNTR_NO
		      ,C.DMDT_CHG_STS_CD
		      ,C.OFC_CD
		      ,C.FM_MVMT_YD_CD
		      ,DECODE (SUBSTR (C.DMDT_TRF_CD
		                      ,3
		                      ,1
		                      )
		              ,'O', B.POR_CD
		              ,B.DEL_CD
		              ) AS PORT
		      ,C.DMDT_TRF_CD
          	  ,DECODE (C.ACT_CNT_CD,'00', '',C.ACT_CNT_CD)
        		       || TO_CHAR (C.ACT_CUST_SEQ, 'FM000000') AS PAYER_CD
		      ,CASE
		          WHEN C.DMDT_TRF_CD = 'DTIC'
		          AND INSTR (NVL (B.POD_CD, '  '), 'US') = 1
		             THEN (SELECT MV.VNDR_LGL_ENG_NM
		                     FROM MDM_VENDOR MV
		                    WHERE MV.VNDR_SEQ = C.VNDR_SEQ)
		          WHEN C.DMDT_TRF_CD = 'DTOC'
		          AND INSTR (NVL (B.POL_CD, '  '), 'US') = 1
		             THEN (SELECT MV.VNDR_LGL_ENG_NM
		                     FROM MDM_VENDOR MV
		                    WHERE MV.VNDR_SEQ = C.VNDR_SEQ)
		          WHEN C.DMDT_TRF_CD IN ('DMIF', 'CTIC')
		           OR (    C.DMDT_TRF_CD = 'DTIC'
		               AND INSTR (NVL (B.POD_CD, '  '), 'US') <> 1
		              )
		             THEN (SELECT MC.CUST_LGL_ENG_NM
		                     FROM MDM_CUSTOMER MC
		                    WHERE MC.CUST_CNT_CD = C.ACT_CNT_CD
		                      AND MC.CUST_SEQ = C.ACT_CUST_SEQ)
		          WHEN C.DMDT_TRF_CD IN ('DMOF', 'CTOC')
		           OR (    C.DMDT_TRF_CD = 'DTOC'
		               AND INSTR (NVL (B.POL_CD, '  '), 'US') <> 1
		              )
		             THEN REPLACE (BS.CUST_NM
		                          , CHR (13)
		                            || CHR (10)
		                          ,' '
		                          )
		       END AS PAYER_NM
		      , BS.CUST_CNT_CD
		        || TRIM (TO_CHAR (BS.CUST_SEQ, '000000')) SHIPPER_CD
		      ,REPLACE (BS.CUST_NM
		               , CHR (13)
		                 || CHR (10)
		               ,' '
		               ) SHIPPER_NM
		      ,DECODE (BC.CUST_CNT_CD
		               || TRIM (TO_CHAR (BC.CUST_SEQ, '000000'))
		              ,'000000', NULL
		              , BC.CUST_CNT_CD
		                || TRIM (TO_CHAR (BC.CUST_SEQ, '000000'))
		              ) CNEE_CD
		      ,REPLACE (BC.CUST_NM
		               , CHR (13)
		                 || CHR (10)
		               ,' '
		               ) CNEE_NM
		      ,DECODE (BN.CUST_CNT_CD
		               || TRIM (TO_CHAR (BN.CUST_SEQ, '000000'))
		              ,'000000', NULL
		              , BN.CUST_CNT_CD
		                || TRIM (TO_CHAR (BN.CUST_SEQ, '000000'))
		              ) NTFY_CD
		      ,NVL (RTRIM (REPLACE (REPLACE (BN.CUST_NM
		                                    ,'"'
		                                    ,''
		                                    )
		                           , CHR (13)
		                             || CHR (10)
		                           ,' '
		                           ))
		           ,'-') NTFY_NM
		      , (SELECT I.ACT_CUST_CNT_CD
		                || TRIM (TO_CHAR (ACT_CUST_SEQ, '000000'))
		           FROM INV_AR_MN I
		          WHERE I.BKG_NO = B.BKG_NO
		            AND I.IO_BND_CD = SUBSTR (C.DMDT_TRF_CD
		                                     ,3
		                                     ,1
		                                     )
		            AND AR_IF_NO =
		                   (SELECT MAX (AR_IF_NO)
		                      FROM INV_AR_MN
		                     WHERE BKG_NO = B.BKG_NO
		                       AND IO_BND_CD = SUBSTR (C.DMDT_TRF_CD
		                                              ,3
		                                              ,1
		                                              ))
		            AND ROWNUM = 1) AS AR_ACT_CD
		      , (SELECT MC.CUST_LGL_ENG_NM
		           FROM MDM_CUSTOMER MC
		               ,INV_AR_MN I
		          WHERE MC.CUST_CNT_CD = I.ACT_CUST_CNT_CD
		            AND MC.CUST_SEQ = I.ACT_CUST_SEQ
		            AND I.BKG_NO = B.BKG_NO
		            AND I.IO_BND_CD = SUBSTR (C.DMDT_TRF_CD
		                                     ,3
		                                     ,1
		                                     )
		            AND AR_IF_NO =
		                   (SELECT MAX (AR_IF_NO)
		                      FROM INV_AR_MN
		                     WHERE BKG_NO = B.BKG_NO
		                       AND IO_BND_CD = SUBSTR (C.DMDT_TRF_CD
		                                              ,3
		                                              ,1
		                                              ))
		            AND ROWNUM = 1) AS AR_ACT_NM
		      ,DECODE (TRIM (TO_CHAR (C.VNDR_SEQ, '000000'))
		              ,'000000', NULL
		              ,TRIM (TO_CHAR (C.VNDR_SEQ, '000000'))
		              ) AS SVC_PROVDR_CD
		      , (SELECT MV.VNDR_LGL_ENG_NM
		           FROM MDM_VENDOR MV
		          WHERE MV.VNDR_SEQ = C.VNDR_SEQ) AS SVC_PROVDR_NM
		      ,B.SC_NO
		      ,B.RFA_NO		 
              ,CASE WHEN (SELECT AR_OFC_CD FROM MDM_ORGANIZATION WHERE OFC_CD = @[ofc_cd]) IN ('SGNBB', 'SAOBB', 'MTRBS', 'TORBB', 'VANBS', 'MEXBA') THEN 'USD'
          			  ELSE (SELECT AR_CURR_CD FROM MDM_ORGANIZATION WHERE OFC_CD = @[ofc_cd])
          			   END  AS INV_CURR_CD
		      ,C.BZC_TRF_CURR_CD AS ORG_CURR_CD
		      ,C.ORG_CHG_AMT AS ORG_CHG_AMT
		      ,C.SC_RFA_EXPT_AMT AS EXPT_AMT
		      ,C.AFT_EXPT_DC_AMT AS DC_AMT
		      ,C.BIL_AMT
		      ,C.SYS_AREA_GRP_ID AS SVR_ID
		      ,C.CNTR_CYC_NO
		      ,C.DMDT_CHG_LOC_DIV_CD
		      ,C.CHG_SEQ
		      ,CASE WHEN (SELECT AR_OFC_CD FROM MDM_ORGANIZATION WHERE OFC_CD = @[ofc_cd]) IN ('SGNBB', 'SAOBB', 'MTRBS', 'TORBB', 'VANBS', 'MEXBA') THEN 'USD'
          			  ELSE (SELECT AR_CURR_CD FROM MDM_ORGANIZATION WHERE OFC_CD = @[ofc_cd])
          			   END  AS AR_CURR_CD
		      ,1 AS AR_XCH_RT
		     ,C.BZC_TRF_CURR_CD
			 ,C.DMDT_INV_NO
	 		 ,B.VSL_CD
			 ,B.SKD_VOY_NO
			 ,B.SKD_DIR_CD
			 ,B.POL_CD
			 ,B.POD_CD				 
		  FROM DMT_CHG_BKG_CNTR B
		      ,DMT_CHG_CALC C
		      ,BKG_CUSTOMER BS
		      ,BKG_CUSTOMER BC
		      ,BKG_CUSTOMER BN
		WHERE B.SYS_AREA_GRP_ID = C.SYS_AREA_GRP_ID
		  AND B.CNTR_NO = C.CNTR_NO
		  AND B.CNTR_CYC_NO = C.CNTR_CYC_NO
		  AND B.BKG_NO   = BS.BKG_NO(+)
          AND BS.BKG_CUST_TP_CD(+) = 'S'
		  AND B.BKG_NO   = BC.BKG_NO (+)
	  	  AND BC.BKG_CUST_TP_CD(+) = 'C'
		  AND B.BKG_NO   = BN.BKG_NO(+)
		  AND BN.BKG_CUST_TP_CD(+) = 'N'
		  AND C.DMDT_CHG_LOC_DIV_CD IN ('POD','POL','POR','DEL', 'TSP')	 

		##    -- 메인 조회 : Office        
		#if (${ofc_cd} != '')
		   AND C.OFC_CD            =   @[ofc_cd]   
		#end
			
		
		##  -- 메인 조회 : Tariff type 
		   AND    C.DMDT_TRF_CD        =	@[dmdt_trf_cd]
		
		##  -- 메인 조회 : Status + OVERDAY : F/T OVER DAY OR STAYING DAY(단, DMDT_CHG_STS_CD가 U일 경우는 over day 적용 제외)
		#if (${dmdt_chg_sts_cd} != '') 
			AND ( 1=0
			#foreach( $chg_sts_cd in ${chg_sts_cd_list} )	
				#if (${cond_type} != 'date')

					#if ($chg_sts_cd != 'U')
						OR (C.DMDT_CHG_STS_CD = '$chg_sts_cd'
							#if (${fx_ft_ovr_dys} != '')
								#if (${day_type} == '1')
									AND C.FX_FT_OVR_DYS >= TO_NUMBER(@[fx_ft_ovr_dys])
								#elseif (${day_type} == '2')
									AND	(   (    C.TO_MVMT_DT IS NOT NULL
						          	    AND (TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						        	  OR (    C.TO_MVMT_DT IS NULL
						           	   AND (TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						       	  )
								#end ## end of the day_type
							#end
							) 
					#else
						OR (C.DMDT_CHG_STS_CD = '$chg_sts_cd'
						#if (${fx_ft_ovr_dys} != '')
							#if (${day_type} == '1')
							AND (   
									  ( C.TO_MVMT_DT IS NOT NULL 
									    AND 
									    TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'RRRRMMDD'),'YYYYMMDDHH24MISS') - TO_DATE (TO_CHAR (C.FT_END_DT, 'RRRRMMDD'), 'YYYYMMDDHH24MISS') >= TO_NUMBER (@[fx_ft_ovr_dys])
										)
										OR 
									  ( C.TO_MVMT_DT IS NULL 
									    AND 
									    TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'RRRRMMDD'),'YYYYMMDDHH24MISS') - TO_DATE (TO_CHAR (C.FT_END_DT, 'RRRRMMDD'), 'YYYYMMDDHH24MISS') >= TO_NUMBER (@[fx_ft_ovr_dys])						          	   
									  )					       	  
									)
							#elseif (${day_type} == '2')
							AND	(   (    C.TO_MVMT_DT IS NOT NULL
						          	    AND (TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						        	  OR (    C.TO_MVMT_DT IS NULL
						           	   AND (TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						       	  )
							#end ## end of the day_type
						#end														
						) 
					#end
				#else
					#if ($chg_sts_cd == 'F')
						OR (C.DMDT_CHG_STS_CD = 'F'
			            	AND C.TO_MVMT_DT BETWEEN TO_DATE(@[fm_dt], 'yyyymmdd') 
			            						AND TO_DATE(@[to_dt], 'yyyymmdd') + 0.99999 
						#if (${fx_ft_ovr_dys} != '')			            						
							#if (${day_type} == '1')
								AND C.FX_FT_OVR_DYS >= TO_NUMBER(@[fx_ft_ovr_dys])
							#elseif (${day_type} == '2')
								AND	(   (    C.TO_MVMT_DT IS NOT NULL
						          	    AND (TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						        	  OR (    C.TO_MVMT_DT IS NULL
						           	   AND (TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						       	  )
							#end ## end of the day_type
						#end
						)
					#elseif ($chg_sts_cd == 'L')
						OR (C.DMDT_CHG_STS_CD = 'L'
			            	AND C.FM_MVMT_DT BETWEEN TO_DATE(@[fm_dt], 'yyyymmdd') 
		            						AND TO_DATE(@[to_dt], 'yyyymmdd') + 0.99999 
			            #if (${fx_ft_ovr_dys} != '')
							#if (${day_type} == '1')
								AND C.FX_FT_OVR_DYS >= TO_NUMBER(@[fx_ft_ovr_dys])
							#elseif (${day_type} == '2')
								AND	(   (    C.TO_MVMT_DT IS NOT NULL
						          	    AND (TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						        	  OR (    C.TO_MVMT_DT IS NULL
						           	   AND (TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						       	  )
							#end ## end of the day_type
						#end
						)
					#elseif ($chg_sts_cd == 'U')
						OR (C.DMDT_CHG_STS_CD = 'U'
							AND C.FM_MVMT_DT BETWEEN TO_DATE(@[fm_dt], 'yyyymmdd') 
			            						AND TO_DATE(@[to_dt], 'yyyymmdd') + 0.99999 
			            #if (${fx_ft_ovr_dys} != '')
							#if (${day_type} == '1')
							 AND (   
									  ( C.TO_MVMT_DT IS NOT NULL 
									    AND 
									    TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'RRRRMMDD'),'YYYYMMDDHH24MISS') - TO_DATE (TO_CHAR (C.FT_END_DT, 'RRRRMMDD'), 'YYYYMMDDHH24MISS') >= TO_NUMBER (@[fx_ft_ovr_dys])
										)
										OR 
									  ( C.TO_MVMT_DT IS NULL 
									    AND 
									    TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'RRRRMMDD'),'YYYYMMDDHH24MISS') - TO_DATE (TO_CHAR (C.FT_END_DT, 'RRRRMMDD'), 'YYYYMMDDHH24MISS') >= TO_NUMBER (@[fx_ft_ovr_dys])						          	   
									  )					       	  
									)
							#elseif (${day_type} == '2')
								AND	(   (    C.TO_MVMT_DT IS NOT NULL
						          	    AND (TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						        	  OR (    C.TO_MVMT_DT IS NULL
						           	   AND (TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						       	  )
							#end ## end of the day_type
						#end
						)
					#elseif ($chg_sts_cd == 'C')
						OR (C.DMDT_CHG_STS_CD = 'C'
			            	AND C.TO_MVMT_DT BETWEEN TO_DATE(@[fm_dt], 'yyyymmdd') 
			            						AND TO_DATE(@[to_dt], 'yyyymmdd') + 0.99999 
			            		#if (${fx_ft_ovr_dys} != '')
							#if (${day_type} == '1')
								AND C.FX_FT_OVR_DYS >= TO_NUMBER(@[fx_ft_ovr_dys])
							#elseif (${day_type} == '2')
								AND	(   (    C.TO_MVMT_DT IS NOT NULL
						          	    AND (TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						        	  OR (    C.TO_MVMT_DT IS NULL
						           	   AND (TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						       	  )
							#end ## end of the day_type
						#end
						)
					#elseif ($chg_sts_cd == 'I')
						OR (C.DMDT_CHG_STS_CD = 'I'
			            	AND C.TO_MVMT_DT BETWEEN TO_DATE(@[fm_dt], 'yyyymmdd') 
			            						AND TO_DATE(@[to_dt], 'yyyymmdd') + 0.99999
			            		#if (${fx_ft_ovr_dys} != '') 
							#if (${day_type} == '1')
								AND C.FX_FT_OVR_DYS >= TO_NUMBER(@[fx_ft_ovr_dys])
							#elseif (${day_type} == '2')
								AND	(   (    C.TO_MVMT_DT IS NOT NULL
						          	    AND (TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						        	  OR (    C.TO_MVMT_DT IS NULL
						           	   AND (TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						       	  )
							#end ## end of the day_type
						#end
						)
					#elseif ($chg_sts_cd == 'R')
						OR (C.DMDT_CHG_STS_CD = 'L'

						#if (${fx_ft_ovr_dys} != '')
							#if (${day_type} == '1')
								AND C.FX_FT_OVR_DYS >= TO_NUMBER(@[fx_ft_ovr_dys])
							#elseif (${day_type} == '2')
								AND	(   (    C.TO_MVMT_DT IS NOT NULL
						          	    AND (TO_DATE (TO_CHAR (C.TO_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						        	  OR (    C.TO_MVMT_DT IS NULL
						           	   AND (TO_DATE (TO_CHAR (NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[cre_ofc_cd]),SYSDATE), 'rrrrmmdd'), 'rrrrmmdd')
        									- TO_DATE (TO_CHAR (C.FM_MVMT_DT, 'rrrrmmdd'), 'rrrrmmdd'))
        									+ 1 >= TO_NUMBER (@[fx_ft_ovr_dys])
						          	   )
						       	  )
							#end ## end of the day_type
						#end
						)
					#end
				#end
			#end
			)
		#end
		
		##  -- 메인 조회 : G/B CHARGE_TYPE
		#if (${chg_type} == 'G') 
		AND C.CHG_SEQ = 1
		#elseif (${chg_type} == 'B') 
		AND C.CHG_SEQ > 1
		#end
		
		##  --선택 조회 1: DATE 일 경우
		#if (${cond_type} == 'date')
				
			#if (${loc_cd} != '')
				#if (${loc_type} == '1')
					AND (( LENGTH(@[loc_cd]) = 5 AND C.FM_MVMT_YD_CD LIKE  @[loc_cd] || '%' )
						OR
						( LENGTH(@[loc_cd]) = 7 AND C.FM_MVMT_YD_CD =  @[loc_cd] ))
				#elseif (${loc_type} == '2') 
					AND DECODE(SUBSTR(@[dmdt_trf_cd], 3, 1),'O', B.POR_CD, B.DEL_CD) = SUBSTR(@[loc_cd], 1, 5)
				#end
			#end
		##else
		##	AND C.DMDT_CHG_STS_CD NOT IN ('D','N','U','I','C')
		#end
		
		##  --선택 조회 2: VVD CD 일 경우
		
		#if (${cond_type} == 'vvd_cd')
			#if (${vvd_cd} != '')
			AND (	B.VSL_CD = SUBSTR(@[vvd_cd],1,4) 
				AND B.SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4) 
				AND B.SKD_DIR_CD = SUBSTR(@[vvd_cd],9) 
				)
			#end
			
			#if (${port_cd} != '')
			AND	DECODE(SUBSTR(@[dmdt_trf_cd], 3, 1),'O', B.POL_CD, B.POD_CD) = @[port_cd]
			#end
			
		#end
		
		##  --선택 조회 3: CNTR 종류를 선택 했을 경우
		#if (${cond_type} == 'cntr')
			#if (${bkg_no} != '')	
			AND B.BKG_NO IN (
				#foreach( $bkg_cd in ${bkg_no_list} )
					#if($velocityCount < $bkg_no_list.size()) '$bkg_cd', #else '$bkg_cd' #end
				#end
				)
			#end
		
			#if (${bl_no} != '')
			AND B.BL_NO IN (
				#foreach( $bl_cd in ${bl_no_list} )
					#if($velocityCount < $bl_no_list.size()) '$bl_cd', #else '$bl_cd' #end
				#end
				)
			#end
		
			#if (${cntr_no} != '')
			AND C.CNTR_NO IN (
				#foreach( $cntr_cd in ${cntr_no_list} )
					#if($velocityCount < $cntr_no_list.size()) '$cntr_cd', #else '$cntr_cd' #end
				#end
				)
			#end
		#end
		
		##  --선택 조회 : CUSTOMER 종류
		#if (${cust_cd} != '')
			#if (${cust_type} == '')
			AND (
				#if (${cust_len} == '8')	
						C.ACT_CNT_CD	= SUBSTR(@[cust_cd],1,2)
					AND C.ACT_CUST_SEQ	= LTRIM(SUBSTR(@[cust_cd],3),'0')
				#else
						C.ACT_CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],1,6),'0')
				#end
				OR		BS.CUST_CNT_CD	= SUBSTR(@[cust_cd],1,2)
					AND BS.CUST_SEQ		= LTRIM(SUBSTR(@[cust_cd],3),'0')
				OR		BC.CUST_CNT_CD	= SUBSTR(@[cust_cd],1,2)
					AND BC.CUST_SEQ		= LTRIM(SUBSTR(@[cust_cd],3),'0')
				OR 		BN.CUST_CNT_CD	= SUBSTR(@[cust_cd],1,2)
					AND BN.CUST_SEQ		= LTRIM(SUBSTR(@[cust_cd],3),'0')
				OR(
					EXISTS (
		    		SELECT  'X'
		    		FROM    INV_AR_MN I
		    		WHERE   I.BKG_NO = B.BKG_NO
		    		AND     I.IO_BND_CD = 'I'
					AND     ROWNUM  = 1
					AND     I.ACT_CUST_CNT_CD   = SUBSTR(@[cust_cd],1,2)
					AND     I.ACT_CUST_SEQ      = LTRIM(SUBSTR(@[cust_cd],3),'0')
					)
				)
			)
			#elseif (${cust_type} == 'P')
				#if (${cust_len} == '8')	
					AND	C.ACT_CNT_CD	= SUBSTR(@[cust_cd],1,2)
					AND C.ACT_CUST_SEQ	= LTRIM(SUBSTR(@[cust_cd],3),'0')
				#else
					AND	C.ACT_CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],1,6),'0')
				#end
			#elseif (${cust_type} == 'S') 
				AND BS.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
				AND BS.CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],3),'0')
			#elseif (${cust_type} == 'C') 
				AND BC.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
				AND BC.CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],3),'0')
			#elseif (${cust_type} == 'N') 
				AND BN.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
				AND BN.CUST_SEQ  = LTRIM(SUBSTR(@[cust_cd],3),'0')
			#elseif (${cust_type} == 'A')		
				AND EXISTS (
		    		SELECT  'X'
		    		FROM    INV_AR_MN I
		    		WHERE   I.BKG_NO = B.BKG_NO
		    		AND     I.IO_BND_CD = 'I'
					AND     ROWNUM  = 1
					AND     I.ACT_CUST_CNT_CD   = SUBSTR(@[cust_cd],1,2)
					AND     I.ACT_CUST_SEQ      = LTRIM(SUBSTR(@[cust_cd],3),'0')
					)
			#end
		#end
		
		##  --선택 조회 : Service Provider 종류
		
		#if (${svc_provdr} != '') 
		AND C.VNDR_SEQ = LTRIM(@[svc_provdr],'0')
		#end
		
		##  --선택 조회 : S/C No 
		
		#if (${sc_no} != '') 
		AND B.SC_NO = @[sc_no]
		#end	
		##  --선택 조회 : RFA No 
		#if (${rfa_no} != '') 
		AND B.RFA_NO = @[rfa_no]
		#end
	
	) X
 ) Y
 WHERE Y.RNUM < 2	
	
#end


##			]]></sql>
			<params>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="dmdt_trf_cd" type="12" value="" out="N"/>
				<param name="fx_ft_ovr_dys" type="12" value="" out="N"/>
				<param name="cre_ofc_cd" type="12" value="" out="N"/>
				<param name="fm_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="port_cd" type="12" value="" out="N"/>
				<param name="cust_cd" type="12" value="" out="N"/>
				<param name="svc_provdr" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
				<param name="rfa_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
