<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CNTRInventoryReportDBDAOsearchDefaultMonthWeekRSQL">
			<desc><![CDATA[기간조회]]></desc>
			<sql><![CDATA[
SELECT MIN(FM_PRD) FM_PRD, MAX(TO_PRD) TO_PRD
FROM
    (SELECT MIN(A.PLN_YR||A.PLN_WK) FM_PRD,
            MAX(A.PLN_YR||A.PLN_WK) TO_PRD
    FROM EQR_WK_PRD A
		,(
		SELECT SUBSTR(@[op_trnd_tp_cd],2,1) TP_CD,TO_CHAR(SYSDATE,'YYYY') PLN_YR,
		       TO_CHAR(TO_DATE(A.WK_ST_DT,'YYYYMMDD')-(7*@[fm_dur]),'YYYYMMDD') FM_DT, 
		       TO_CHAR(TO_DATE(A.WK_ST_DT,'YYYYMMDD')-(7*@[to_dur]),'YYYYMMDD') TO_DT
		FROM   EQR_WK_PRD A
		WHERE  A.PLN_YR BETWEEN TO_CHAR(TO_CHAR(SYSDATE,'YYYY') - 1) AND TO_CHAR(TO_CHAR(SYSDATE,'YYYY') + 1)
		AND    TO_CHAR(TRUNC(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[ofc_cd])),'YYYYMMDD')  BETWEEN A.WK_ST_DT AND A.WK_END_DT
		--AND    TRUNC(sysdate)  BETWEEN A.WK_ST_DT AND A.WK_END_DT
		AND    SUBSTR(@[op_trnd_tp_cd],2,1) = 'W'
		) B
    WHERE  1=1
--    AND A.PLN_YR = B.PLN_YR
    AND   A.WK_ST_DT IN(B.FM_DT,B.TO_DT)
    AND   B.TP_CD = 'W'
    UNION ALL
    SELECT TO_CHAR(ADD_MONTHS(sysdate,-1*@[fm_dur]),'YYYYMM') FM_PRD,
           TO_CHAR(ADD_MONTHS(sysdate,-1*@[to_dur]),'YYYYMM') TO_PRD
    FROM   DUAL
    WHERE  SUBSTR(@[op_trnd_tp_cd],2,1) = 'M'
    )			]]></sql>
			<params>
				<param name="op_trnd_tp_cd" type="12" value="" out="N"/>
				<param name="fm_dur" type="12" value="" out="N"/>
				<param name="to_dur" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
