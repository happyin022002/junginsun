<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CIMCommonDBDAOModifyMstContainerDataUSQL">
			<desc><![CDATA[Container 수정]]></desc>
			<sql><![CDATA[
UPDATE MST_CONTAINER MC
	SET  ( LOC_CD
	, SCC_CD
	, LCC_CD
	, ECC_CD
	, RCC_CD
	, SYS_AREA_GRP_ID
	, CNMV_YR
	, CNMV_ID_NO
	, CNMV_SEQ
	, CNMV_CYC_NO
	, CNMV_DT
	, CNMV_GDT
	, PRE_STS_FLG
	, BKG_NO
	, BKG_KNT
	, FULL_FLG
	, CRNT_YD_CD
	, DEST_YD_CD
	, VSL_CD
	, SKD_VOY_NO
	, SKD_DIR_CD
	, CNMV_STS_CD
	, IMDT_EXT_FLG
	, CO_CRE_FLG
	, UCLM_LS_DIV_CD
	, UCLM_DT
	, UCLM_FREE_DYS
	, UCLM_END_DT
	, UCLM_RSN
	, UCLM_PLN_RMK
	, UCLM_CNTC_PNT_NM
	, UPD_USR_ID
	,UPD_DT)
	 = (SELECT 
			ML.LOC_CD, 
			ME.SCC_CD, 
			ME.LCC_CD, 
			ME.ECC_CD,
			ME.RCC_CD, 
			(SELECT SYS_AREA_GRP_ID
				FROM   COM_SYS_AREA_GRP_ID B   
				WHERE SUBSTR(CM.ORG_YD_CD, 1, 2) = B.CNT_CD
				AND   B.CO_IND_CD                = 'H'
				AND   ROWNUM                     = 1)
		   , CM.CNMV_YR       
		  , CM.CNMV_ID_NO
		  , CM.CNMV_SEQ
		  , CM.CNMV_CYC_NO
		  , CM.CNMV_EVNT_DT
		  , GLOBALDATE_PKG.TIME_CONV_FNC ( SUBSTR(CM.ORG_YD_CD, 1, 5), CM.CNMV_EVNT_DT, 'GMT' )
		  , NVL(CM.PRE_STS_FLG, 'N')
		  , CM.BKG_NO
		  , CM.BKG_KNT
		  , NVL(CM.FCNTR_FLG, 'F')
		  , CM.ORG_YD_CD
		  , CM.DEST_YD_CD
		  , CM.TRNK_VSL_CD VSL_CD
		  , CM.TRNK_SKD_VOY_NO
		  , CM.TRNK_SKD_DIR_CD
		  , CM.MVMT_STS_CD
		  , DECODE(CM.MVMT_STS_CD||TRIM(MC.LSTM_CD),'VLOF','Y','VLMI','Y',MC.IMDT_EXT_FLG)
		  , 'N'
		  , CASE WHEN UCLM_LS_DIV_CD ='U' THEN
				CASE WHEN  CNMV_STS_CD || 'MT' IN ('IDMT') THEN
					 NULL
				ELSE
					UCLM_LS_DIV_CD
				END
			ELSE
				NULL
			END UCLM_LS_DIV_CD
		  , CASE WHEN UCLM_LS_DIV_CD ='U' THEN
				CASE WHEN  CNMV_STS_CD || 'MT' IN ('IDMT') THEN
					 NULL
				ELSE
					UCLM_DT
				END
			ELSE
				NULL
			END UCLM_DT
		  ,  CASE WHEN UCLM_LS_DIV_CD ='U' THEN
				CASE WHEN  CNMV_STS_CD || 'MT' IN ('IDMT') THEN
					 NULL
				ELSE
					UCLM_FREE_DYS
				END
			ELSE
				NULL
			END UCLM_FREE_DYS
		  , CASE WHEN UCLM_LS_DIV_CD ='U' THEN
				CASE WHEN  CNMV_STS_CD || 'MT' IN ('IDMT') THEN
					 NULL
				ELSE
					UCLM_END_DT
				END
			ELSE
				NULL
			END UCLM_END_DT
		  , CASE WHEN UCLM_LS_DIV_CD ='U' THEN
				CASE WHEN  CNMV_STS_CD || 'MT' IN ('IDMT') THEN
					 NULL
				ELSE
					UCLM_RSN
				END
			ELSE
				NULL
			END UCLM_RSN
		  , CASE WHEN UCLM_LS_DIV_CD ='U' THEN
				CASE WHEN  CNMV_STS_CD || 'MT' IN ('IDMT') THEN
					 NULL
				ELSE
					UCLM_PLN_RMK
				END
			ELSE
				NULL
			END UCLM_PLN_RMK
		  , CASE WHEN UCLM_LS_DIV_CD ='U' THEN
				CASE WHEN  CNMV_STS_CD || 'MT' IN ('IDMT') THEN
					 NULL
				ELSE
					UCLM_CNTC_PNT_NM
				END
			ELSE
				NULL
			END UCLM_CNTC_PNT_NM
		  , CM.UPD_USR_ID
		  , CM.UPD_DT             
		FROM  CTM_MOVEMENT CM, 
			  MDM_EQ_ORZ_CHT ME, 
			  MDM_LOCATION ML
			,  ( SELECT SB.CNTR_NO    AS CNTR_NO
					 , SB.CNMV_YR    AS CNMV_YR
					 , SB.CNMV_ID_NO AS CNMV_ID_NO
					 , SB.CNMV_SEQ   AS CNMV_SEQ
				 FROM CTM_MOVEMENT SB
				 WHERE SB.CNTR_NO = @[cntr_no]
				 AND   ROWNUM     = 1
				 ORDER BY CNMV_YR, CNMV_SEQ , CNMV_SPLIT_NO DESC) SB                            
		WHERE  MC.CNTR_NO         = SB.CNTR_NO
            AND  SB.CNTR_NO       = CM.CNTR_NO
			AND  SB.CNMV_YR       = CM.CNMV_YR
			AND  SB.CNMV_ID_NO    = CM.CNMV_ID_NO
			AND  SB.CNMV_SEQ      = CM.CNMV_SEQ
			AND  ME.SCC_CD(+)     = ML.SCC_CD
		    AND   ML.LOC_CD(+)    = SUBSTR(CM.ORG_YD_CD,0,5)   
		    AND  ROWNUM           = 1
   )                          
 WHERE MC.CNTR_NO = @[cntr_no]			]]></sql>
			<params>
				<param name="cntr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
