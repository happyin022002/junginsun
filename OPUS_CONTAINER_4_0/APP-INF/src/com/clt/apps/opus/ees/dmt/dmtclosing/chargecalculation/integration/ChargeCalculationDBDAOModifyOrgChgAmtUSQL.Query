<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChargeCalculationDBDAOModifyOrgChgAmtUSQL">
			<desc><![CDATA[ChargeCalculationDBDAOModifyOrgChgAmtUSQL]]></desc>
			<sql><![CDATA[
#if (${call_flag} == 'PRECAL') 
	UPDATE DMT_CHG_PRE_CALC C
#else 
	UPDATE DMT_CHG_CALC C
#end

   SET 
   (C.ORG_CHG_AMT ,C.SC_RFA_EXPT_AMT )
   =
		 (                
			SELECT SUM (NVL (B.ORG_CHG_AMT, 0)), SUM (NVL (B.ORG_CHG_AMT, 0)) - C.SC_RFA_AMT
			
			#if (${call_flag} == 'PRECAL') 
			FROM DMT_CHG_PRE_CALC B
			#else
			FROM DMT_CHG_CALC B
			#end

			WHERE B.SYS_AREA_GRP_ID = @[svr_id]
			  AND B.CNTR_NO 		= @[cntr_no] 
			  AND B.CNTR_CYC_NO 	= @[cntr_cyc_no]

			#if (${dmdt_trf_cd} == 'CTIC') 
			  AND B.DMDT_TRF_CD IN ('DMIF', 'DTIC')
			#elseif (${dmdt_trf_cd} == 'CTOC') 
			  AND B.DMDT_TRF_CD IN ('DTOC', 'DMOF')
			#end

			  AND B.CHG_SEQ 		= @[chg_seq]
		   )                                   
 WHERE C.SYS_AREA_GRP_ID	= @[svr_id]
   AND C.CNTR_NO			= @[cntr_no]
   AND C.CNTR_CYC_NO		= @[cntr_cyc_no]
   AND C.DMDT_TRF_CD		= @[dmdt_trf_cd]
   AND C.DMDT_CHG_LOC_DIV_CD = @[dmdt_chg_loc_div_cd]
   AND C.CHG_SEQ			= @[chg_seq]			]]></sql>
			<params>
				<param name="svr_id" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="cntr_cyc_no" type="12" value="" out="N"/>
				<param name="chg_seq" type="12" value="" out="N"/>
				<param name="dmdt_trf_cd" type="12" value="" out="N"/>
				<param name="dmdt_chg_loc_div_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
