<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MisUseApprovalDBDAOMisUseInOutInquiryListRSQL">
			<desc><![CDATA[자사 및 타사장비의 Miss Use된 장비의 현황을 조회한다.]]></desc>
			<sql><![CDATA[
SELECT  AA.RQST_NO, AA.APRO_NO, AA.RQST_OFC_CD, 
        TO_CHAR(AA.RQST_DT,'YYYYMMDD') AS RQST_DT, AA.MSS_RQST_IO_MOD_CD,
        REGEXP_REPLACE(AA.N1ST_REF_OFC_CD||','||AA.N2ND_REF_OFC_CD
            ||','||AA.N3RD_REF_OFC_CD||','||AA.N4TH_REF_OFC_CD, 
            '^,|(,){2}|,$','') AS REF_OFC_CD,
        AA.N1ST_REF_OFC_CD, AA.N2ND_REF_OFC_CD, AA.N3RD_REF_OFC_CD, AA.N4TH_REF_OFC_CD,
        AA.RQST_USR_ID, AA.DIFF_RMK, AA.CURR_CD, AA.APRO_OFC_CD, AA.APRO_USR_ID, AA.APRO_RMK,
        AA.CNTR_NO, AA.AGMT_CTY_CD, AA.AGMT_SEQ, AA.CNTR_TPSZ_CD, AA.LSTM_CD,
        TO_CHAR(AA.MSS_USD_DT,'YYYYMMDD') AS MSS_USD_DT, AA.MSS_USD_FM_NM, 
        AA.MSS_USE_PLC_NM, 
--		AA.PD_CHG_RT_AMT,
		DECODE(MST_COMMON_PKG.MST_HO_OFC_CHK_FNC(@[usr_ofc_cd])
 				,'Y',AA.PD_CHG_RT_AMT
 				,'N','') AS PD_CHG_RT_AMT,
		AA.LFT_CHG_RT_AMT, AA.LIBOR_PTY_NM, 
        DECODE(AA.MSS_USD_APRO_MOD_CD, 'A','APP','R','REJ','C','CNL','REQ') AS MSS_USD_APRO_MOD_CD,  
        AA.RQST_LOC_NM, AA.APRO_AGMT_CTY_CD, AA.APRO_AGMT_SEQ,
        AA.APRO_AGMT_CTY_CD||LPAD(AA.APRO_AGMT_SEQ, 6, '0') AS APRO_AGMT_NO,
		AA.RQST_FILE_SAV_ID, AA.RQST_RSN_DESC,
		DECODE(AA.RQST_DELT_FLG, 'N',AA.RQST_FILE_SAV_NM,NULL) AS RQST_FILE_SAV_NM, 
		AA.APRO_FILE_SAV_ID, AA.APRO_RSN_DESC,
		DECODE(AA.APRO_DELT_FLG, 'N',AA.APRO_FILE_SAV_NM,NULL) AS APRO_FILE_SAV_NM, 
		AA.CXL_FILE_SAV_ID,  AA.CXL_RSN_DESC,
		DECODE(AA.CXL_DELT_FLG, 'N',AA.CXL_FILE_SAV_NM,NULL) AS CXL_FILE_SAV_NM
FROM   (SELECT  A.RQST_NO, A.APRO_NO, A.RQST_OFC_CD, A.RQST_DT, A.MSS_RQST_IO_MOD_CD, 
                A.N1ST_REF_OFC_CD, A.N2ND_REF_OFC_CD, A.N3RD_REF_OFC_CD, A.N4TH_REF_OFC_CD,
                A.RQST_USR_ID, A.DIFF_RMK, A.CURR_CD, B.APRO_OFC_CD, B.APRO_USR_ID, B.APRO_RMK,
                C.CNTR_NO, C.AGMT_CTY_CD, C.AGMT_SEQ, C.CNTR_TPSZ_CD, C.LSTM_CD,
                C.MSS_USD_DT, C.MSS_USD_FM_NM, C.MSS_USE_PLC_NM, C.PD_CHG_RT_AMT,
                C.LFT_CHG_RT_AMT, C.LIBOR_PTY_NM, C.MSS_USD_APRO_MOD_CD, C.RQST_LOC_NM,
                C.APRO_AGMT_CTY_CD, C.APRO_AGMT_SEQ, C.MVMT_STS_CD, C.POD_CD, C.POL_CD,
    			D.FILE_SAV_ID AS RQST_FILE_SAV_ID, D.FILE_UPLD_NM AS RQST_FILE_SAV_NM, C.RQST_RSN_DESC,
    			E.FILE_SAV_ID AS APRO_FILE_SAV_ID, E.FILE_UPLD_NM AS APRO_FILE_SAV_NM, C.APRO_RSN_DESC,
    			F.FILE_SAV_ID AS CXL_FILE_SAV_ID, F.FILE_UPLD_NM AS CXL_FILE_SAV_NM, C.CXL_RSN_DESC,
    			D.DELT_FLG AS RQST_DELT_FLG, E.DELT_FLG AS APRO_DELT_FLG, F.DELT_FLG AS CXL_DELT_FLG
        FROM    LSE_MSS_USD_RQST A,
                LSE_MSS_USD_APRO B,
                LSE_MSS_USD_CNTR C,
    			COM_UPLD_FILE D,
    			COM_UPLD_FILE E,
    			COM_UPLD_FILE F
        WHERE   A.APRO_NO = B.APRO_NO(+)
        AND     A.RQST_NO = C.RQST_NO
    	AND     C.RQST_FILE_SAV_ID = D.FILE_SAV_ID(+)
    	AND     C.APRO_FILE_SAV_ID = E.FILE_SAV_ID(+)
    	AND     C.CXL_FILE_SAV_ID  = F.FILE_SAV_ID(+)
        ) AA    
WHERE   1 = 1
#if (${rqst_ofc_cd} != "")
AND     AA.RQST_OFC_CD = @[rqst_ofc_cd]
#end
#if (${mss_rqst_io_mod_cd} != "")
AND     AA.MSS_RQST_IO_MOD_CD = @[mss_rqst_io_mod_cd]
#end
#if (${str_rqst_dt} != "")
AND     AA.RQST_DT BETWEEN TO_DATE(@[str_rqst_dt], 'YYYYMMDD') 
AND 	TO_DATE(@[end_rqst_dt], 'YYYYMMDD')
#end
#if (${mss_usd_apro_flag} == "R")
AND     AA.MSS_USD_APRO_MOD_CD IS NULL    
#elseif (${mss_usd_apro_flag} == "A")
AND     AA.MSS_USD_APRO_MOD_CD IS NOT NULL    
#end
ORDER BY AA.RQST_NO, AA.APRO_NO, AA.CNTR_NO, DECODE(AA.MSS_USD_APRO_MOD_CD, 'A',1,'R',2,'C',4,3)			]]></sql>
			<params>
				<param name="usr_ofc_cd" type="12" value="" out="N"/>
				<param name="rqst_ofc_cd" type="12" value="" out="N"/>
				<param name="mss_rqst_io_mod_cd" type="12" value="" out="N"/>
				<param name="str_rqst_dt" type="12" value="" out="N"/>
				<param name="end_rqst_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
