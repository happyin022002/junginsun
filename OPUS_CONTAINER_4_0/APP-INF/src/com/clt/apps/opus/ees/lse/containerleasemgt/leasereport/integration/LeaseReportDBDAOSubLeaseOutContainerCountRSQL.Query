<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="LeaseReportDBDAOSubLeaseOutContainerCountRSQL">
			<desc><![CDATA[Sub Lease 자사장비 및 Mis Use 타사장비의 전체건수를 조회합니다.
REF_NO 항목 추가]]></desc>
			<sql><![CDATA[
SELECT  COUNT(*) AS TOTAL_CNT
        FROM    MST_CONTAINER    A,
                MST_CNTR_STS_HIS B,
                LSE_AGREEMENT    C,
                MDM_VENDOR       D,
                MST_CNTR_STS_HIS E,
                LSE_AGREEMENT    F
        WHERE   A.CNTR_NO      = B.CNTR_NO
        AND     B.AGMT_CTY_CD  = C.AGMT_CTY_CD
        AND     B.AGMT_SEQ     = C.AGMT_SEQ
        AND     C.VNDR_SEQ     = D.VNDR_SEQ
        AND     A.AGMT_CTY_CD  = F.AGMT_CTY_CD
        AND     A.AGMT_SEQ     = F.AGMT_SEQ
        AND     A.CO_CRE_FLG  = 'N'
#if (${cntr_sts_cd} == '(SB|MU)O' || ${cntr_sts_cd} == 'SBO' || ${cntr_sts_cd} == 'MUO')
        AND     B.CNTR_NO                = E.CNTR_NO		(+)
        AND     B.CNTR_STS_SEQ           = E.PRNR_STS_SEQ	(+)
        AND     E.CNTR_LSTM_CNG_FLG(+)   = 'N'
	#if (${lst_sts_flg} == '01')
        AND     B.CNTR_STS_SEQ = ( SELECT /*+ INDEX_DESC(SUB XAK1MST_CNTR_STS_HIS) */ 
                                                 SUB.CNTR_STS_SEQ
                                     FROM MST_CNTR_STS_HIS SUB
                                    WHERE SUB.CNTR_NO               = A.CNTR_NO
                                      AND SUB.CNTR_STS_CD           = A.CNTR_STS_CD                                                                                       
                                      AND SUB.CNTR_LSTM_CNG_FLG     = 'N'
                                      AND ROWNUM                    = 1)
	    #if (${cntr_sts_cd} == '(SB|MU)O' )
           AND		A.CNTR_STS_CD IN('SBO','MUO')
	    #else
           AND		A.CNTR_STS_CD = @[cntr_sts_cd]
	    #end
    #else
        AND     B.CNTR_LSTM_CNG_FLG  = 'N'
	#end
	#if (${cntr_sts_cd} == '(SB|MU)O' )
        AND		B.CNTR_STS_CD IN('SBO','MUO')
	#else
        AND		B.CNTR_STS_CD = @[cntr_sts_cd]
	#end
	#if (${total_flg} != 'Y')
		#if (${loc_tp} == '0' && ${loc_cd} != '')
	        AND     B.RCC_CD = @[loc_cd]
		#elseif (${loc_tp} == '1' && ${loc_cd} != '')
	        AND     SUBSTR(B.LOC_CD,1,2) = @[loc_cd]
		#elseif (${loc_tp} == '2' && ${loc_cd} != '')
	        AND     B.LCC_CD = @[loc_cd]
		#elseif (${loc_tp} == '3' && ${loc_cd} != '')
	        AND     B.SCC_CD = @[loc_cd]
		#elseif (${loc_tp} == '4' && ${loc_cd} != '')
	        AND     B.YD_CD LIKE @[loc_cd] || '%'
		#elseif (${loc_tp} == '5' && ${loc_cd} != '')
	        AND     SUBSTR(B.LOC_CD,1,2) = @[loc_cd]
		#end
	#else
	    #if     (${loc_tp} == '2' && ${loc_cd} != '')
	        AND     B.RCC_CD = @[loc_cd]
		#elseif (${loc_tp} == '3' && ${loc_cd} != '')
	        AND     B.LCC_CD = @[loc_cd]
		#elseif (${loc_tp} == '4' && ${loc_cd} != '')
	        AND     B.SCC_CD = @[loc_cd]
		#elseif (${loc_tp} == '5' && ${loc_cd} != '')
	        AND     SUBSTR(B.LOC_CD,1,2) = @[loc_cd]
		#end
	#end
	#if (${str_evnt_dt} != '')
        AND     B.CNTR_STS_EVNT_DT BETWEEN TO_DATE(@[str_evnt_dt],'YYYYMMDD')  
        AND 	TO_DATE(@[end_evnt_dt],'YYYYMMDD')
	#end
	#if (${agmt_seq} != '')
        AND     B.AGMT_CTY_CD = @[agmt_cty_cd]
        AND     B.AGMT_SEQ    = @[agmt_seq]
	#end
	#if (${cntr_full_flg} != '')
        AND     B.CNTR_FULL_FLG = @[cntr_full_flg]
	#end
#else
        AND     B.CNTR_NO             = E.CNTR_NO
        AND     B.CNTR_STS_SEQ        = ( SELECT /*+ INDEX_DESC(SUB XAK1MST_CNTR_STS_HIS) */ 
                                                 SUB.CNTR_STS_SEQ
                                            FROM MST_CNTR_STS_HIS SUB
                                           WHERE SUB.CNTR_NO               = A.CNTR_NO                                                                                          
                                             AND SUB.CNTR_STS_CD           = SUBSTR(E.CNTR_STS_CD, 1, 2)||'O'
                                             AND SUB.CNTR_LSTM_CNG_FLG     = 'N'
                                             AND ROWNUM                    = 1)
        AND     E.CNTR_LSTM_CNG_FLG   = 'N'
	#if (${lst_sts_flg} == '01')
        AND     A.LST_STS_SEQ = E.CNTR_STS_SEQ
	#end
	#if (${cntr_sts_cd} == '(SB|MU)I' )
		AND		E.CNTR_STS_CD IN('SBI','MUI')
	#else
		AND		E.CNTR_STS_CD = @[cntr_sts_cd]
	#end
	#if (${loc_tp} == '0' && ${loc_cd} != '')
        AND     E.RCC_CD = @[loc_cd]
	#elseif (${loc_tp} == '1' && ${loc_cd} != '')
        AND     SUBSTR(E.LOC_CD,1,2) = @[loc_cd]
	#elseif (${loc_tp} == '2' && ${loc_cd} != '')
        AND     E.LCC_CD = @[loc_cd]
	#elseif (${loc_tp} == '3' && ${loc_cd} != '')
        AND     E.SCC_CD = @[loc_cd]
	#elseif (${loc_tp} == '4' && ${loc_cd} != '')
        AND     E.YD_CD = @[loc_cd]
	#elseif (${loc_tp} == '5' && ${loc_cd} != '')
        AND     SUBSTR(E.LOC_CD,1,2) = @[loc_cd]
	#end
	#if (${str_evnt_dt} != '')
        AND     E.CNTR_STS_EVNT_DT BETWEEN TO_DATE(@[str_evnt_dt],'YYYYMMDD') AND 	TO_DATE(@[end_evnt_dt],'YYYYMMDD')
	#end
	#if (${agmt_seq} != '')
        AND     E.AGMT_CTY_CD 	= @[agmt_cty_cd]
        AND     E.AGMT_SEQ    	= @[agmt_seq]
	#end
	#if (${cntr_full_flg} != '')
        AND     E.CNTR_FULL_FLG = @[cntr_full_flg]
	#end
#end		
#if (${lstm_soc_tp} == '03')
        AND     A.LSTM_CD = 'SH'
#elseif (${lstm_soc_tp} == '02')
        AND     A.LSTM_CD 			<> 'SH'
#end  
#if (${vndr_seq} != '')
        AND     C.VNDR_SEQ 			= @[vndr_seq]
#end
#if (${onh_free_dys} != '')
        AND @[onh_free_dys] <= DECODE(MST_COMMON_PKG.MST_HO_OFC_CHK_FNC(@[usr_ofc_cd])
 				,'Y', 
		TRUNC(NVL((SELECT /*+ INDEX_ASC(SUB XAK1MST_CNTR_STS_HIS) */
                                            SUB.CNTR_STS_EVNT_DT
                                   FROM MST_CNTR_STS_HIS SUB
                                  WHERE B.CNTR_NO                   = SUB.CNTR_NO
                                     AND SUB.CNTR_STS_CD           = DECODE(B.CNTR_STS_CD, 'SBO', 'SBI', 'MUI')
                                     AND SUB.CNTR_LSTM_CNG_FLG = 'N'
                                     AND B.CNTR_STS_EVNT_DT     <= SUB.CNTR_STS_EVNT_DT
                                      AND ROWNUM          = 1
                                  ), TRUNC(SYSDATE)) - B.CNTR_STS_EVNT_DT)+1
 				,'N','')
#end
#if (${lstm_cd} != '')
        AND     A.LSTM_CD IN (
   	#foreach($key IN ${lstm_cd_seq})
   		#if($velocityCount < $lstm_cd_seq.size())
   			'$key',
   		#else
   			'$key'
   		#end
   	#end
                )
#end
#if (${cntr_tpsz_cd} != '')
        AND     A.CNTR_TPSZ_CD IN (
   	#foreach($key IN ${cntr_tpsz_cd_seq})
   		#if($velocityCount < $cntr_tpsz_cd_seq.size())
   			'$key',
   		#else
   			'$key'
   		#end
   	#end
                )
#end

#if (${cntr_onh_auth_no} != '')
    AND     (SELECT LQ.CNTR_ONH_AUTH_NO AS AA
                   FROM LSE_ONH_APRO_QTY LQ
                  WHERE LQ.AGMT_CTY_CD = C.AGMT_CTY_CD
                    AND LQ.AGMT_SEQ = C.AGMT_SEQ
                    AND ROWNUM = 1) = @[cntr_onh_auth_no]

#end  			]]></sql>
			<params>
				<param name="cntr_sts_cd" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="str_evnt_dt" type="12" value="" out="N"/>
				<param name="end_evnt_dt" type="12" value="" out="N"/>
				<param name="agmt_cty_cd" type="12" value="" out="N"/>
				<param name="agmt_seq" type="2" value="" out="N"/>
				<param name="cntr_full_flg" type="12" value="" out="N"/>
				<param name="vndr_seq" type="2" value="" out="N"/>
				<param name="onh_free_dys" type="2" value="" out="N"/>
				<param name="usr_ofc_cd" type="12" value="" out="N"/>
				<param name="cntr_onh_auth_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
