<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CntrMtyBkgCreateDBDAOSearchRobVVDHeaderInfoRSQL">
			<desc><![CDATA[ROB VVD 정보를 조회, (VL VVD ~ ROB SPLIT VVD)]]></desc>
			<sql><![CDATA[
SELECT VSL_CD
      ,SKD_VOY_NO
      ,SKD_DIR_CD
      ,ROWNUM NUM       -- 홀수, 짝수 의미 있음.
      ,ROWNUM-1 VSL_SEQ -- BKG_VVD 에 입력될 SEQ
      ,N1ST_PORT_BRTH_DT-- DATA 확인용(사용안함)
FROM       
(       
    SELECT A.VSL_CD
          ,A.SKD_VOY_NO
          ,A.SKD_DIR_CD 
          ,A.N1ST_PORT_BRTH_DT                                            
    FROM VSK_VSL_SKD A
        ,(
            -- 시작 VVD
            SELECT VSL_CD
                  ,SKD_VOY_NO
                  ,SKD_DIR_CD
                  ,N1ST_PORT_BRTH_DT 
            FROM VSK_VSL_SKD
            WHERE VSL_CD     = SUBSTR(@[vvd], 0, 4)
            AND   SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
            AND   SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
        
         ) B
        ,(
            -- 종료 VVD
            SELECT VSL_CD
                  ,SKD_VOY_NO
                  ,SKD_DIR_CD
                  ,N1ST_PORT_BRTH_DT 
            FROM VSK_VSL_SKD
            WHERE VSL_CD     = SUBSTR(@[vvd_rob], 0, 4)
            AND   SKD_VOY_NO = SUBSTR(@[vvd_rob], 5, 4)
            AND   SKD_DIR_CD = SUBSTR(@[vvd_rob], 9, 1)
        
         ) C   
    WHERE A.VSL_CD = B.VSL_CD
    AND   A.VSL_CD = C.VSL_CD
    AND   A.N1ST_PORT_BRTH_DT <= C.N1ST_PORT_BRTH_DT -- B와 C 사이의 시작 SKD
    AND   A.N1ST_PORT_BRTH_DT >= B.N1ST_PORT_BRTH_DT -- B와 C 사이의 시작 SKD
    ORDER BY A.N1ST_PORT_BRTH_DT
)			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="vvd_rob" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
