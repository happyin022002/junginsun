<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DisposalMgtDBDAOsearchDisposalCollectionInquiryListDataRSQL">
			<desc><![CDATA[DisposalMgtDBDAOsearchDisposalCollectionInquiryListDataRSQL]]></desc>
			<sql><![CDATA[
SELECT 
	BOD.OFC_CD 
	,BOD.BL_CURR_CD
	,BOD.INV_FRT_AMT
	,BOD.INV_TAX_AMT
	,BOD.CLT_FRT_AMT
	,BOD.CLT_TAX_AMT
	,BOD.BAL_FRT_AMT
	,BOD.BAL_TAX_AMT  
	,TO_CHAR(BOD.CLT_LST_UPD_DT, 'yyyy-mm-dd') AS CLT_LST_UPD_DT 
	,E.DP_PRCS_KNT 
FROM (SELECT BL_NO,
       MAX(OTS_OFC_CD) OFC_CD,
       MAX(BL_CURR_CD) BL_CURR_CD,
       SUM(INV_AMT) INV_FRT_AMT,
       SUM(INV_TAX_AMT) INV_TAX_AMT,
       SUM(CLT_AMT) CLT_FRT_AMT,
       SUM(CLT_TAX_AMT) CLT_TAX_AMT,
       SUM(BAL_AMT) BAL_FRT_AMT,
       SUM(BAL_TAX_AMT) BAL_TAX_AMT,
       MAX(RCT_UPD_DT) CLT_LST_UPD_DT
  FROM (SELECT BL_NO,
               OTS_OFC_CD,
               BL_CURR_CD,
               RCT_UPD_DT,
               CASE WHEN CHG_TP_CD <> 'TVA' THEN INV_AMT ELSE 0 END INV_AMT,
               CASE WHEN CHG_TP_CD = 'TVA' THEN INV_AMT ELSE 0 END INV_TAX_AMT,
               CASE WHEN CHG_TP_CD <> 'TVA' THEN RCT_AMT ELSE 0 END CLT_AMT,
               CASE WHEN CHG_TP_CD = 'TVA' THEN RCT_AMT ELSE 0 END CLT_TAX_AMT,
               CASE WHEN CHG_TP_CD <> 'TVA' THEN BAL_AMT ELSE 0 END BAL_AMT,
               CASE WHEN CHG_TP_CD = 'TVA' THEN BAL_AMT ELSE 0 END BAL_TAX_AMT
          FROM SAR_OTS_DTL)
      GROUP BY BL_NO) BOD, MDM_CURRENCY E
WHERE BOD.BL_NO = @[inv_no]
AND BOD.BL_CURR_CD = E.CURR_CD
ORDER BY CLT_LST_UPD_DT			]]></sql>
			<params>
				<param name="inv_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
