<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RestuffingContainerRegistrationDBDAOCtmMvmtXchVORSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
SELECT   XCH.CNTR_NO,
         XCH.CNTR_TPSZ_CD,
         XCH.CNMV_STS_CD,
         XCH.CNMV_CYC_NO,
         MOV.BKG_NO,
         '' AS BKG_NO_SPLIT,
         XCH.XCH_CNTR_NO,
         XCH.XCH_CNTR_TPSZ_CD,
         XCH.PRE_CNMV_STS_CD,
         XCH.XCH_CNTR_CYC_NO,
         TO_CHAR (XCH.UPD_DT, 'YYYY-MM-DD') AS DT,
         XCH.ORG_YD_CD||' '||YD_NM AS ORG_YD_CD,
         XCH_OFC_CD,
         XCH_RMK,
         XCH.CNMV_ID_NO,
         XCH.CNTR_XCH_REF_SEQ,
         XCH.CNTR_XCH_SEQ,
         MAX (DECODE (XCH_RSN_CD, 'BE', 'Y', '')) AS BE,
         MAX (DECODE (XCH_RSN_CD, 'CM', 'Y', '')) AS CM,
         MAX (DECODE (XCH_RSN_CD, 'CN', 'Y', '')) AS CN,
         MAX (DECODE (XCH_RSN_CD, 'DM', 'Y', '')) AS DM,
         MAX (DECODE (XCH_RSN_CD, 'DP', 'Y', '')) AS DP,
         MAX (DECODE (XCH_RSN_CD, 'ET', 'Y', '')) AS ET,
         MAX (DECODE (XCH_RSN_CD, 'OD', 'Y', '')) AS OD,
         MAX (DECODE (XCH_RSN_CD, 'OT', 'Y', '')) AS OT,
         MAX (DECODE (XCH_RSN_CD, 'OW', 'Y', '')) AS OW,
         MAX (DECODE (XCH_RSN_CD, 'OZ', 'Y', '')) AS OZ,
         MAX (DECODE (XCH_RSN_CD, 'RC', 'Y', '')) AS RC,
         MAX (DECODE (XCH_RSN_CD, 'RP', 'Y', '')) AS RP,
         MAX (DECODE (XCH_RSN_CD, 'SM', 'Y', '')) AS SM
    FROM CTM_MVMT_XCH XCH,
         CTM_MVMT_XCH_DTL DTL1,
         CTM_MOVEMENT MOV,
         MDM_YARD YARD
   WHERE 1 = 1
     AND XCH.CNTR_NO = DTL1.CNTR_NO
     AND XCH.CNMV_YR = DTL1.CNMV_YR
     AND XCH.CNMV_ID_NO = DTL1.CNMV_ID_NO
     AND XCH.CNTR_XCH_REF_SEQ = DTL1.CNTR_XCH_REF_SEQ
     AND XCH.CNTR_XCH_SEQ = DTL1.CNTR_XCH_SEQ
     AND XCH.CNTR_NO = MOV.CNTR_NO(+)
     AND XCH.CNMV_YR = MOV.CNMV_YR(+)
     AND XCH.CNMV_ID_NO = MOV.CNMV_ID_NO(+)
     AND XCH.ORG_YD_CD = YARD.YD_CD
#if (${p_office} != '')
     AND UPPER (XCH.XCH_OFC_CD) LIKE '%'||UPPER (@[p_office])||'%'
#end
#if (${p_yard1} != '')
     AND SUBSTR (UPPER (XCH.ORG_YD_CD), 0, 5) LIKE '%'||UPPER (@[p_yard1])||'%'
#end
#if (${p_yard2} != '')
     AND SUBSTR (UPPER (XCH.ORG_YD_CD), 6, 2) = UPPER (@[p_yard2])
#end
#if (${p_date1} != '')
     AND XCH.UPD_DT BETWEEN TO_DATE (@[p_date1], 'YYYY-MM-DD') AND TO_DATE (@[p_date2], 'YYYY-MM-DD') + 0.99999
#end
#if (${p_cntrno} != '')
     AND UPPER (XCH.CNTR_NO) = @[p_cntrno]
#end
#if (${p_split} != '')
     AND XCH.CNMV_YR = @[p_split]
#end
     AND EXISTS (
            SELECT 'a'
              FROM CTM_MVMT_XCH_DTL DTL2
             WHERE DTL1.CNMV_ID_NO = DTL2.CNMV_ID_NO
               AND DTL1.CNTR_XCH_REF_SEQ = DTL2.CNTR_XCH_REF_SEQ
               AND DTL1.CNTR_XCH_SEQ = DTL2.CNTR_XCH_SEQ
               AND DTL1.CNTR_NO = DTL2.CNTR_NO
#if (${p_reson} != '')
               AND DTL2.XCH_RSN_CD IN ($p_reson)
#end
         )
GROUP BY XCH.CNTR_NO,
         XCH.CNTR_TPSZ_CD,
         XCH.CNMV_STS_CD,
         XCH.CNMV_CYC_NO,
         MOV.BKG_NO,
         XCH.XCH_CNTR_NO,
         XCH.XCH_CNTR_TPSZ_CD,
         XCH.PRE_CNMV_STS_CD,
         XCH.XCH_CNTR_CYC_NO,
         XCH.UPD_DT,
         XCH.ORG_YD_CD||' '||YD_NM,
         XCH_OFC_CD,
         XCH_RMK,
         XCH.CNMV_ID_NO,
         XCH.CNTR_XCH_REF_SEQ,
         XCH.CNTR_XCH_SEQ
ORDER BY XCH.CNTR_NO,
         XCH.CNMV_ID_NO,
         XCH.CNTR_XCH_REF_SEQ,
         XCH.CNTR_XCH_SEQ			]]></sql>
			<params>
				<param name="p_office" type="12" value="" out="N"/>
				<param name="p_yard1" type="12" value="" out="N"/>
				<param name="p_yard2" type="12" value="" out="N"/>
				<param name="p_date1" type="12" value="" out="N"/>
				<param name="p_date2" type="12" value="" out="N"/>
				<param name="p_cntrno" type="12" value="" out="N"/>
				<param name="p_split" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
