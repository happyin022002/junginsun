<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContainerOnOffhireDBDAOAddRuLabelHistoryTermChangeDataCSQL">
			<desc><![CDATA[Term Change Creatiion ì‹œ Ru Label History Insert]]></desc>
			<sql><![CDATA[
INSERT INTO MST_CNTR_RSTR_USG_HIS (
        CNTR_NO 
        ,RSTR_USG_HIS_SEQ
        ,RSTR_USG_UPD_TP_CD 
        ,RSTR_USG_TP_CD 
        ,RSTR_USG_LBL_NM
        ,CNMV_YR
        ,CNMV_ID_NO
        ,CNMV_SEQ
        ,CNMV_SPLIT_NO
        ,CRE_USR_ID
        ,CRE_DT
        ,UPD_USR_ID
        ,UPD_DT
        ,CNTR_RMK
        ,EDW_UPD_DT
)
SELECT 
          HIS.CNTR_NO
        , RSTR_USG_HIS_SEQ.NEXTVAL
        , 'D' RSTR_USG_UPD_TP_CD
        , HIS.RSTR_USG_TP_CD
        , HIS.RSTR_USG_LBL_NM
        , MC.CNMV_YR
        , MC.CNMV_ID_NO
        , MC.CNMV_SEQ
        , MC.CNMV_SPLIT_NO
        , @[cre_usr_id] CRE_USR_ID
        , SYSDATE CRE_DT
        , @[upd_usr_id] UPD_USR_ID
        , SYSDATE UPD_DT
        , 'Deleted by TLC' CNTR_RMK
        , HIS.EDW_UPD_DT
FROM MST_CNTR_RSTR_USG_HIS HIS
      ,  MST_CONTAINER MC
WHERE HIS.CNTR_NO = MC.CNTR_NO
AND    (HIS.CNTR_NO, HIS.RSTR_USG_TP_CD, HIS.RSTR_USG_HIS_SEQ)
         IN (
               SELECT SUB.CNTR_NO
                       , SUB.RSTR_USG_TP_CD
                       , DECODE(SUBSTR(MAX(TO_CHAR(SUB.RSTR_USG_HIS_SEQ, '000000000')||TRIM(SUB.RSTR_USG_UPD_TP_CD)), -1), 'D', 9999999, '')
                        ||MAX(SUB.RSTR_USG_HIS_SEQ) RSTR_USG_HIS_SEQ
                FROM MST_CNTR_RSTR_USG_HIS SUB
               WHERE SUB.CNTR_NO = @[cntr_no]
                  AND SUB.RSTR_USG_TP_CD IN ('OFHR', 'ASST')
               GROUP BY SUB.CNTR_NO, SUB.RSTR_USG_TP_CD    
             )			]]></sql>
			<params>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
