<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContainerOnOffHireDBDAOModifyMvmtHistorybyUpdateDataUSQL">
			<desc><![CDATA[Movement Type Flag이 'E'인 경우에 대하여 Event Data를 Update 하도록 기능 변경]]></desc>
			<sql><![CDATA[
UPDATE CTM_MOVEMENT CM
SET CNMV_EVNT_DT = TO_DATE(@[cntr_sts_evnt_dt],'YYYY-MM-DD')
                       + CASE @[cntr_sts_cd] 
                              WHEN 'OWN' THEN 0
                              WHEN 'LSI' THEN 0
                              WHEN 'SBO' THEN 0.99999
                              WHEN 'MUO' THEN 0.99999
                              WHEN 'LSO' THEN 0.99999
                              WHEN 'MUI' THEN 0
                              WHEN 'SBI' THEN 0
                          ELSE
                              0
                          END
  , CTRT_OFC_CTY_CD      = @[agmt_cty_cd]
  , CTRT_SEQ         = @[agmt_seq]
  , UPD_DT           = SYSDATE
  , UPD_USR_ID       = @[upd_usr_id]
WHERE 1 = 1
AND CM.CNTR_NO      = (SELECT /*+ INDEX( A XPKMST_CONTAINER) */
                 CNTR_NO 
                 FROM MST_CONTAINER A
                 WHERE 1 = 1
                 ##${cntr_no}
                 #if ($cntr_no.length() == 10) 
                 AND   A.CNTR_NO LIKE @[cntr_no] || '%'
                 #end 
                 ##${cntr_no}
                 #if ($cntr_no.length() != 10) 
                 AND   A.CNTR_NO = @[cntr_no]
                 #end 
                 AND CNMV_DT = (
                               SELECT MAX(CNMV_DT) 
                               FROM MST_CONTAINER 
                               WHERE 1 = 1
                               ##${cntr_no}
                               #if ($cntr_no.length() == 10) 
                               AND   CNTR_NO LIKE @[cntr_no] || '%'
                               #end 
                               ##${cntr_no}
                               #if ($cntr_no.length() != 10) 
                               AND   CNTR_NO = @[cntr_no]
                               #end 
                               )
                 AND ROWNUM = 1 
)
AND CM.CNMV_YR    = @[cnmv_yr]
AND CM.CNMV_ID_NO = @[cnmv_id_no]
AND ROWNUM        = 1			]]></sql>
			<params>
				<param name="cntr_sts_evnt_dt" type="12" value="" out="N"/>
				<param name="cntr_sts_cd" type="12" value="" out="N"/>
				<param name="agmt_cty_cd" type="12" value="" out="N"/>
				<param name="agmt_seq" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="cnmv_yr" type="12" value="" out="N"/>
				<param name="cnmv_id_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
