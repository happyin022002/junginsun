<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TurnTimePerformanceMgtDBDAOsearchLocationTurnTimeSummaryRSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
SELECT  L.LOC_CD locCode,
L.TPSZ tpsz,
DECODE(MAX(Y.NO),'1','CNTR','2','Days','3','T/Time' ,1 ) AS division,
DECODE(MAX(Y.NO),'1',SUM(T_CNT),'2',SUM(T_TIME),'3',DECODE(SUM(T_CNT),0,0,ROUND(SUM(T_TIME) / SUM(T_CNT) ,1 ))) AS total,
SUM( DECODE( L.WK_SEQ, 1,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count01,
SUM( DECODE( L.WK_SEQ, 2,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count02,
SUM( DECODE( L.WK_SEQ, 3,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count03,
SUM( DECODE( L.WK_SEQ, 4,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count04,
SUM( DECODE( L.WK_SEQ, 5,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count05,
SUM( DECODE( L.WK_SEQ, 6,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count06,
SUM( DECODE( L.WK_SEQ, 7,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count07,
SUM( DECODE( L.WK_SEQ, 8,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count08,
SUM( DECODE( L.WK_SEQ, 9,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count09,
SUM( DECODE( L.WK_SEQ, 10,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count10,
SUM( DECODE( L.WK_SEQ, 11,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count11,
SUM( DECODE( L.WK_SEQ, 12,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count12,
SUM( DECODE( L.WK_SEQ, 13,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count13,
SUM( DECODE( L.WK_SEQ, 14,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count14,
SUM( DECODE( L.WK_SEQ, 15,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count15,
SUM( DECODE( L.WK_SEQ, 16,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count16,
SUM( DECODE( L.WK_SEQ, 17,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count17,
SUM( DECODE( L.WK_SEQ, 18,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count18,
SUM( DECODE( L.WK_SEQ, 19,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count19,
SUM( DECODE( L.WK_SEQ, 20,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count20,
SUM( DECODE( L.WK_SEQ, 21,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count21,
SUM( DECODE( L.WK_SEQ, 22,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count22,
SUM( DECODE( L.WK_SEQ, 23,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count23,
SUM( DECODE( L.WK_SEQ, 24,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count24,
SUM( DECODE( L.WK_SEQ, 25,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count25,
SUM( DECODE( L.WK_SEQ, 26,DECODE(Y.NO,'1',T_CNT,'2',T_TIME,'3',DECODE(T_CNT,0,0,ROUND(T_TIME / T_CNT ,1 ))),0)) AS count26
		FROM    ( 
		SELECT /*+ ORDERED USE_NL ( O L T ) */
		#if (${inquiryLevel} == 'AR' ) 
		O.RCC_CD LOC_CD, 
		#elseif (${inquiryLevel} == 'RL') 
		O.LCC_CD LOC_CD, 
		#elseif (${inquiryLevel} == 'LE' || ${inquiryLevel} == 'RE') 
		O.ECC_CD LOC_CD, 
		#elseif (${inquiryLevel} == 'LS' || ${inquiryLevel} == 'ES' || ${inquiryLevel} == 'SS') 
		O.SCC_CD LOC_CD,  
		#elseif (${inquiryLevel} == 'AC' || ${inquiryLevel} == 'RC' || ${inquiryLevel} == 'CC') 
		SUBSTR(O.SCC_CD,1,2)  LOC_CD, 
		#end 
		T.CNTR_TPSZ_CD          TPSZ, 
		W.WSEQ                  WK_SEQ, 
		S.DP_SEQ				DSP_SEQ, 
		/* ---------------------------------------------------------------- 2009.09.22 By SBKIM */
  		#if ( ${inquiryLevel} == 'AC' || ${inquiryLevel} == 'RC' || ${inquiryLevel} == 'CC') 
   		SUM  (T.TT_DYS + T.ENR_TT_DYS)  T_TIME, 
   		SUM(T.CNTR_KNT)    T_CNT 
  		#elseif( ${inquiryLevel} == 'AL' || ${inquiryLevel} == 'RL' ) 
   		SUM( DECODE( L.PORT_INLND_FLG, 'Y', DECODE( T.ENR_TT_DYS, 0, T.TT_DYS,0), T.TT_DYS + T.ENR_TT_DYS ) ) T_TIME,
   		--SUM( DECODE( L.PORT_INLND_FLG, 'Y', DECODE( T.ENR_TT_DYS, 0, T.CNTR_KNT, 0 ), T.CNTR_KNT ) )  T_CNT
		/*--- 계산오류로 인해 원본 쿼리로 변경 ---*/
   		SUM( DECODE( L.PORT_INLND_FLG, 'Y', DECODE( T.ENR_TT_DYS, 0, 1, 0 ), 1 ) )  T_CNT
  		#else
   			#if (${enRoute} == 'E' || ${enRoute} == '') 
   			SUM  (T.TT_DYS)      T_TIME, 
   			#elseif(${enRoute} == 'I') 
   			SUM  (T.TT_DYS + T.ENR_TT_DYS)  T_TIME, 
   			#elseif(${enRoute} == 'O') 
   			SUM( T.ENR_TT_DYS  )    T_TIME, 
   			#end 
   			SUM(T.CNTR_KNT) T_CNT
  		#end   
  		/* ---------------------------------------------------------------- 2009.09.22 By SBKIM */
		FROM	
		#if (${inquiryLevel} == 'AR')   
		MDM_EQ_ORZ_CHT		O, 
		MDM_LOCATION		L, 
		CIM_PORT_TURN_TM_SMRY	T, 
		CIM_TP_SZ_DP_SEQ_V	S, 
		#else /* if ( :Inquiry Level !='AR' ) CIM_LOC_TURN_TM */ 
		MDM_EQ_ORZ_CHT		O, 
		MDM_LOCATION		L, 
		#if( ${inquiryLevel} == 'AL' || ${inquiryLevel} == 'RL' ) 
		/*--- 계산오류로 인해 원본 쿼리로 변경 ---*/
		CIM_LOC_TURN_TM		T, 
		#else
		CIM_LOC_TURN_TM_SMRY		T, 
		#end
		CIM_TP_SZ_DP_SEQ_V	S, 
		#end 
		( 
		#if (${period} == 'W') 
		SELECT  /*+ INDEX ( XPKEQR_WK_PRD ) */ 
		PLN_YR||PLN_WK  DAY_UNIT, 
		ROWNUM				WSEQ 
		FROM    EQR_WK_PRD 
		WHERE   PLN_YR||PLN_WK >= @[from] 
		AND     PLN_YR||PLN_WK <= @[to] 
		#elseif (${period} == 'M') 
		SELECT	DAY_UNIT    DAY_UNIT, 
		ROWNUM      WSEQ 
		FROM	( 
		SELECT  DISTINCT PLN_YR||PLN_MON  DAY_UNIT 
		FROM    EQR_WK_PRD 
		WHERE   PLN_YR||PLN_MON >= SUBSTR(@[from],0,6)
		AND     PLN_YR||PLN_MON <= SUBSTR(@[to],0,6)
		ORDER BY PLN_YR||PLN_MON 
		) 
		#end 
		) W 
		#if (${period} == 'W') 
		WHERE   T.TGT_YRWK BETWEEN  @[from] AND @[to] 
		#elseif (${period} == 'M') 
		WHERE   SUBSTR(T.TGT_MVMT_DT, 1, 6) BETWEEN  @[from] AND @[to] 
		#end 
		/* ---------------------------------------------------------------- 2009.09.22 By SBKIM */
		#if ( ${inquiryLevel} == 'AR')

  		#elseif ( ${inquiryLevel} == 'AC' || ${inquiryLevel} == 'AL' || ${inquiryLevel} == 'RC' || ${inquiryLevel} == 'RL' || ${inquiryLevel} == 'CC')  
  		AND     T.TT_LOC_LVL_CD =   'LCC' 
		#else
		AND     T.TT_LOC_LVL_CD =   'SCC'		 
		#end 

		AND     T.CNTR_TPSZ_CD  =   S.CNTR_TPSZ_CD 

		#if (${inquiryLevel} == 'AR') 
		AND     T.VL_LOC_CD	    =   L.LOC_CD 
		#else  
		AND     T.LOC_CD	    =   L.LOC_CD 
		#end 
		AND     L.SCC_CD		=   O.SCC_CD 
		#if (${inquiryLevel} != 'AR' && ${inquiryLevel} != 'AC')
		AND     DECODE( SUBSTR(@[inquiryLevel],1,1),'A',@[location], 
		'R', O.RCC_CD, 
		'L', O.LCC_CD, 
		'E', O.ECC_CD, 
		'S', O.SCC_CD, 
		'C', SUBSTR(O.SCC_CD,1,2) ) =   @[location] /* inquiryLevel */ /* location */ 
		#end 
		#if (${flowpattern} != '' && ${flowpattern} != 'A' &&  ${flowpattern} != '5') 
		AND     T.TT_CGO_TP_CD	=	@[flowpattern] 
		#elseif (${flowpattern} != '' && ${flowpattern} == '5') 
		AND     T.TT_CGO_TP_CD	<>	'4'
		#end 
		#if (${tpsz} != '') 
			AND     T.CNTR_TPSZ_CD  IN ( 
		#foreach($cntrtpszcd in ${vel_tpsz_cd})  
			'$cntrtpszcd',  
			#end  
			'') 
		#end 
		#if (${tscntr} == 'E') 
		AND		T.TS_FLG		=	'N' 
		#end 
		#if (${tscntr} == 'O') 
		AND		T.TS_FLG		=	'Y' 
		#end 
		#if (${soc} == 'E') 
		AND		T.SOC_FLG		=	'N' 
		#end 
		#if (${soc} == 'O') 
		AND		T.SOC_FLG		=	'Y' 
		#end 
		#if (${period} == 'W') 
		AND     T.TGT_YRWK					=   W.DAY_UNIT 
		#elseif (${period} == 'M') 
		AND		SUBSTR(T.TGT_MVMT_DT,1,6)	=   W.DAY_UNIT 
		#end 
		GROUP BY 
		#if (${inquiryLevel} == 'AR' ) 
		O.RCC_CD, 
		#elseif (${inquiryLevel} == 'RL') 
		O.LCC_CD, 
		#elseif (${inquiryLevel} == 'LE' || ${inquiryLevel} == 'RE') 
		O.ECC_CD, 
		#elseif (${inquiryLevel} == 'LS' || ${inquiryLevel} == 'ES' || ${inquiryLevel} == 'SS') 
		O.SCC_CD, 
		#elseif (${inquiryLevel} == 'AC' || ${inquiryLevel} == 'RC' || ${inquiryLevel} == 'CC') 
		SUBSTR(O.SCC_CD,1,2), 
		#end 
		T.CNTR_TPSZ_CD  , 
		W.WSEQ          , 
		S.DP_SEQ 
		)   L ,
(
   SELECT '1' AS NO FROM DUAL UNION SELECT '2' AS NO FROM DUAL UNION SELECT '3' AS NO FROM DUAL
) Y
GROUP BY
ROLLUP(L.LOC_CD,L.TPSZ), DECODE(Y.NO, '1', 'XX', '2', 'YY')
ORDER BY
L.LOC_CD,MAX(L.DSP_SEQ), L.TPSZ, DECODE(Y.NO, '1', 'XX', '2', 'YY')			]]></sql>
			<params>
				<param name="from" type="12" value="" out="N"/>
				<param name="to" type="12" value="" out="N"/>
				<param name="inquiryLevel" type="12" value="" out="N"/>
				<param name="location" type="12" value="" out="N"/>
				<param name="flowpattern" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
