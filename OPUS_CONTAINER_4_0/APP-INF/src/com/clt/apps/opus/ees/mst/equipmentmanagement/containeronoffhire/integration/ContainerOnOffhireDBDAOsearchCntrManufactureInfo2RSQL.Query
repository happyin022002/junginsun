<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContainerOnOffhireDBDAOsearchCntrManufactureInfo2RSQL">
			<desc><![CDATA[Ticket ID : CHM-201005431-01
searchCntrManufactureInfo - EXCEL UPLOAD DATA 검증 Query]]></desc>
			<sql><![CDATA[
SELECT 
      A1.CNTR_NO
     ,A.CNTR_TPSZ_CD
     ,A.LSTM_CD
     ,TO_CHAR(A.ONH_DT, 'YYYY-MM-DD') ONH_DT
     ,A.ONH_YD_CD
     ,A1.MFT_DT
     ,A1.MFTR_VNDR_SEQ
     ,A.VNDR_SEQ
     ,CASE WHEN A1.BEFLAG IS NULL THEN
        (SELECT NVL(B.VNDR_ABBR_NM,VNDR_LGL_ENG_NM) CODE_NM
         FROM MDM_VENDOR B
         WHERE B.VNDR_SEQ = A1.MFTR_VNDR_SEQ
           AND NVL(B.DELT_FLG, 'N') = 'N')
      ELSE'' 
      END AS MFTR_VNDR_NM
     ,DECODE(A.LSTM_CD, 'ST', '' ,'LT', '', 'E') AS AEFLG
     ,CASE WHEN A1.BEFLAG IS NULL THEN
        DECODE((SELECT COUNT(1)
                FROM MDM_CNTR_VNDR_CLSS A,
                     MDM_VENDOR B
                WHERE A.CNTR_VNDR_SVC_CD ='MFR'
                AND A.VNDR_SEQ = A1.MFTR_VNDR_SEQ
                AND A.VNDR_SEQ = B.VNDR_SEQ
                AND NVL(A.DELT_FLG, 'N') = 'N'
                AND NVL(B.DELT_FLG, 'N') = 'N'),0,'E','') 
     ELSE
    	DECODE(A1.MFTR_VNDR_SEQ,NULL,'','E') -- mftr_vndr_seq가 null인경우는 처리한다.		 
     END AS BEFLG
    ,CASE WHEN A1.MFT_DT='' THEN '' ELSE DECODE(A1.CEFLAG,'E','E','') END AS CEFLG
    ,DECODE(A1.DEFLAG,'E','E','') DEFLG
    ,'' EEFLG
FROM MST_CONTAINER A,
    (SELECT  SUBSTR( CNTR_NO,INSTR(CNTR_NO, '|', 1, LEVEL) + 1,INSTR(CNTR_NO, '|', 1, LEVEL + 1) - INSTR(CNTR_NO, '|', 1, LEVEL) - 1) AS CNTR_NO,
             SUBSTR( MFTR_VNDR_SEQ,INSTR(MFTR_VNDR_SEQ, '|', 1, LEVEL) + 1 ,INSTR(MFTR_VNDR_SEQ, '|', 1, LEVEL + 1) - INSTR(MFTR_VNDR_SEQ, '|', 1, LEVEL) - 1) AS MFTR_VNDR_SEQ ,
             SUBSTR( MFT_DT,INSTR(MFT_DT, '|', 1, LEVEL) + 1,INSTR(MFT_DT, '|', 1, LEVEL + 1) - INSTR(MFT_DT, '|', 1, LEVEL) - 1) AS MFT_DT,
             SUBSTR( AEFLAG,INSTR(AEFLAG, '|', 1, LEVEL) + 1,INSTR(AEFLAG, '|', 1, LEVEL + 1) - INSTR(AEFLAG, '|', 1, LEVEL) - 1) AS AEFLAG,
             SUBSTR( BEFLAG,INSTR(BEFLAG, '|', 1, LEVEL) + 1,INSTR(BEFLAG, '|', 1, LEVEL + 1) - INSTR(BEFLAG, '|', 1, LEVEL) - 1) AS BEFLAG,
             SUBSTR( CEFLAG,INSTR(CEFLAG, '|', 1, LEVEL) + 1,INSTR(CEFLAG, '|', 1, LEVEL + 1) - INSTR(CEFLAG, '|', 1, LEVEL) - 1) AS CEFLAG,
             SUBSTR( DEFLAG,INSTR(DEFLAG, '|', 1, LEVEL) + 1,INSTR(DEFLAG, '|', 1, LEVEL + 1) - INSTR(DEFLAG, '|', 1, LEVEL) - 1) AS DEFLAG,
             SUBSTR( EEFLAG,INSTR(EEFLAG, '|', 1, LEVEL) + 1,INSTR(EEFLAG, '|', 1, LEVEL + 1) - INSTR(EEFLAG, '|', 1, LEVEL) - 1) AS EEFLAG
    FROM (SELECT  @[cntr_no] AS CNTR_NO,
                  @[mftr_vndr_seq] AS MFTR_VNDR_SEQ,
                  @[mft_dt] AS MFT_DT,
                  @[aeflg] AS AEFLAG,
                  @[beflg] AS BEFLAG,
                  @[ceflg] AS CEFLAG,
                  @[deflg] AS DEFLAG,
                  @[eeflg] AS EEFLAG
            FROM dual)
    CONNECT BY LEVEL <= LENGTH(CNTR_NO) - LENGTH(REPLACE(CNTR_NO, '|')) - 1
    )A1
WHERE 1 = 1
  AND A.CNTR_NO(+) = A1.CNTR_NO			]]></sql>
			<params>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="mftr_vndr_seq" type="12" value="" out="N"/>
				<param name="mft_dt" type="12" value="" out="N"/>
				<param name="aeflg" type="12" value="" out="N"/>
				<param name="beflg" type="12" value="" out="N"/>
				<param name="ceflg" type="12" value="" out="N"/>
				<param name="deflg" type="12" value="" out="N"/>
				<param name="eeflg" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
