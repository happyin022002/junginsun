<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DemandNoteSendDBDAOSearchDemandNoteIssueEtcPreviewRSQL">
			<desc><![CDATA[SearchDemandNoteIssueEtcPreview]]></desc>
			<sql><![CDATA[
SELECT B.VSL_CD
       || B.SKD_VOY_NO
       || B.SKD_DIR_CD AS VVD_CD
      , (SELECT VSL_ENG_NM
           FROM MDM_VSL_CNTR
          WHERE VSL_CD = B.VSL_CD) AS VVD_NM
      , (SELECT TO_CHAR (VPS_ETA_DT,'DDMonYY', 'NLS_DATE_LANGUAGE = American')
           FROM VSK_VSL_PORT_SKD
          WHERE VSL_CD = B.VSL_CD
            AND SKD_VOY_NO = B.SKD_VOY_NO
            AND SKD_DIR_CD = B.SKD_DIR_CD
            AND VPS_PORT_CD =
                   (CASE
                       WHEN SUBSTR (C.DMDT_TRF_CD
                                   ,3
                                   ,1
                                   ) = 'I'
                          THEN B.POD_CD
                       ELSE B.POR_CD
                    END
                   )
            AND CLPT_IND_SEQ = 1) AS ARR
      , (SELECT TO_CHAR (VPS_ETD_DT,'DDMonYY', 'NLS_DATE_LANGUAGE = American')
           FROM VSK_VSL_PORT_SKD
          WHERE VSL_CD = B.VSL_CD
            AND SKD_VOY_NO = B.SKD_VOY_NO
            AND SKD_DIR_CD = B.SKD_DIR_CD
            AND VPS_PORT_CD =
                   (CASE
                       WHEN SUBSTR (C.DMDT_TRF_CD
                                   ,3
                                   ,1
                                   ) = 'I'
                          THEN B.POD_CD
                       ELSE B.POR_CD
                    END
                   )
            AND CLPT_IND_SEQ = 1) AS DEP
      ,B.BL_NO AS BL_NO
      ,B.BKG_NO AS BKG_NO
      , (SELECT DISTINCT CMDT_CD
                    FROM DMT_CHG_BKG_CNTR
                   WHERE BKG_NO = B.BKG_NO
                     AND CUST_CNT_CD = B.CUST_CNT_CD
					 AND ROWNUM = 1) AS CMDT_CD
      , (SELECT CMDT_NM
           FROM MDM_COMMODITY
          WHERE CMDT_CD =
                      (SELECT DISTINCT CMDT_CD
                                  FROM DMT_CHG_BKG_CNTR
                                 WHERE BKG_NO = B.BKG_NO
                                   AND CUST_CNT_CD = B.CUST_CNT_CD
								   AND ROWNUM = 1)) AS CMDT_NM
      ,C.DMDT_TRF_CD AS DMDT_TRF_CD
      , (SELECT DMDT_TRF_NM
           FROM DMT_TRF_TP
          WHERE DMDT_TRF_CD = C.DMDT_TRF_CD) AS DMDT_TRF_NM
      , (SELECT DISTINCT BKG_RCV_TERM_CD
                    FROM BKG_CONTAINER
                   WHERE BKG_NO = B.BKG_NO
                   	AND CNTR_NO = C.CNTR_NO ) AS BKG_RCV_TERM_CD
      , (SELECT INTG_CD_VAL_DP_DESC
           FROM COM_INTG_CD_DTL
          WHERE INTG_CD_VAL_CTNT = (SELECT DISTINCT BKG_RCV_TERM_CD
                                               FROM BKG_CONTAINER
                                              WHERE BKG_NO	= B.BKG_NO
                                              	AND CNTR_NO = C.CNTR_NO )
            AND INTG_CD_ID = 'CD00764') AS BKG_RCV_TERM_NM
      , (SELECT DISTINCT BKG_DE_TERM_CD
                    FROM BKG_CONTAINER
                   WHERE BKG_NO	 = B.BKG_NO
                     AND CNTR_NO = C.CNTR_NO) AS BKG_DEL_TERM_CD
      , (SELECT INTG_CD_VAL_DP_DESC
           FROM COM_INTG_CD_DTL
          WHERE INTG_CD_VAL_CTNT = (SELECT DISTINCT BKG_DE_TERM_CD
                                               FROM BKG_CONTAINER
                                              WHERE BKG_NO	= B.BKG_NO
                                                AND CNTR_NO = C.CNTR_NO)
            AND INTG_CD_ID = 'CD00765') AS BKG_DEL_TERM_NM
      , (CASE
            WHEN SUBSTR (C.DMDT_TRF_CD
                        ,3
                        ,1
                        ) = 'I'
               THEN B.POD_CD
            ELSE B.POR_CD
         END) AS POD
      , (SELECT LOC_NM
           FROM MDM_LOCATION
          WHERE LOC_CD =
                   (CASE
                       WHEN SUBSTR (C.DMDT_TRF_CD
                                   ,3
                                   ,1
                                   ) = 'I'
                          THEN B.POD_CD
                       ELSE B.POR_CD
                    END
                   )) AS POD_NM
      , (CASE
            WHEN SUBSTR (C.DMDT_TRF_CD
                        ,3
                        ,1
                        ) = 'I'
               THEN B.DEL_CD
            ELSE B.POL_CD
         END) AS DEL
      , (SELECT LOC_NM
           FROM MDM_LOCATION
          WHERE LOC_CD =
                   (CASE
                       WHEN SUBSTR (C.DMDT_TRF_CD
                                   ,3
                                   ,1
                                   ) = 'I'
                          THEN B.DEL_CD
                       ELSE B.POL_CD
                    END
                   )) AS DEL_NM
      ,DECODE (C.VNDR_SEQ
              ,0, ''
              , (SELECT VNDR_LGL_ENG_NM
                   FROM MDM_VENDOR
                  WHERE VNDR_SEQ = C.VNDR_SEQ)
              ) AS TRUCKER
      ,C.VNDR_SEQ
  FROM DMT_CHG_BKG_CNTR B
      ,DMT_CHG_CALC C
 WHERE B.SYS_AREA_GRP_ID = C.SYS_AREA_GRP_ID
   AND B.CNTR_NO = C.CNTR_NO
   AND B.CNTR_CYC_NO = C.CNTR_CYC_NO
   AND C.DMDT_TRF_CD = @[dmdt_trf_cd]
   AND B.BKG_NO = @[bkg_no]
   AND ROWNUM = 1			]]></sql>
			<params>
				<param name="dmdt_trf_cd" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
