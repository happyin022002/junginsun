/*=========================================================
*Copyright(c) 2016 CyberLogitec
*@FileName : CntrRepoExecutionPlanEstablishDBDAOSearchOnOffHireCntrRepoPlanRSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2016.05.27
*@LastModifier : 이주현
*@LastVersion : 1.0
* 2016.05.27 이주현
* 1.0 Creation
=========================================================*/
package com.clt.apps.opus.ees.eqr.repoplanmanage.cntrrepoexecutionplanestablish.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.clt.framework.support.db.ISQLTemplate;

/**
 *
 * @author LEE JU HYUN
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class CntrRepoExecutionPlanEstablishDBDAOSearchOnOffHireCntrRepoPlanRSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * 컨테이너 이송 실행 계획 조회 Shuttle (EES_EQR_081) 정보 조회
	  * </pre>
	  */
	public CntrRepoExecutionPlanEstablishDBDAOSearchOnOffHireCntrRepoPlanRSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("repoPlanID",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("sosend",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("toWeek",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("off_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("fromWeek",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.clt.apps.opus.ees.eqr.repoplanmanage.cntrrepoexecutionplanestablish.integration").append("\n"); 
		query.append("FileName : CntrRepoExecutionPlanEstablishDBDAOSearchOnOffHireCntrRepoPlanRSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("SELECT " ).append("\n"); 
		query.append("	T3_PLN_YRWK PLN_YRWK" ).append("\n"); 
		query.append("    ,COMPANY" ).append("\n"); 
		query.append("    ,DIVISION" ).append("\n"); 
		query.append("    ,ITEM" ).append("\n"); 
		query.append("    ,LEASE      -- LEASE TERM" ).append("\n"); 
		query.append("    ,LSR 		-- VENDOR ABBR NM" ).append("\n"); 
		query.append("    ,T3_FRLOC FRLOC" ).append("\n"); 
		query.append("    ,ETD" ).append("\n"); 
		query.append("    ,T3_TOLOC TOLOC" ).append("\n"); 
		query.append("    ,ETA" ).append("\n"); 
		query.append("    ,CNTRNO" ).append("\n"); 
		query.append("    ,SOSEND" ).append("\n"); 
		query.append("    ,NOSOSEND" ).append("\n"); 
		query.append("    ,T3_REFNO REFNO" ).append("\n"); 
		query.append("    ,REASON" ).append("\n"); 
		query.append("    ,REASONREMARK" ).append("\n"); 
		query.append("    ,TOTALVOL" ).append("\n"); 
		query.append(" " ).append("\n"); 
		query.append("    #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("        ,${key}VOL" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    ,REPO_PLN_ID 	-- HIDDEN" ).append("\n"); 
		query.append("    ,T3_PLN_SEQ PLN_SEQ        -- HIDDEN" ).append("\n"); 
		query.append("    ,VNDR_ABBR_NM	-- HIDDEN" ).append("\n"); 
		query.append("    ,VNDR_CNT_CD	-- HIDDEN" ).append("\n"); 
		query.append("    ,VNDR_SEQ 	    -- HIDDEN" ).append("\n"); 
		query.append("    ,SORTNUM      -- HIDDEN,  PLAN(1), Execution(2), SO(3)를 구분" ).append("\n"); 
		query.append("    ,NUM          -- HIDDEN,  NORMAL ROW(1), SUB TOTAL(2), GRAND TOTAL(3) 구분" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    ,FM_RCC     -- From ecc's RCC" ).append("\n"); 
		query.append("    ,TO_RCC     -- To   ecc's RCC" ).append("\n"); 
		query.append("    ,FM_LCC     -- From ecc's LCC" ).append("\n"); 
		query.append("    ,TO_LCC     -- To   ecc's LCC" ).append("\n"); 
		query.append("    ,FM_ECC     -- FM ECC" ).append("\n"); 
		query.append("    ,TO_ECC     -- TO ECC" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    ,CNTRNOINPUT  -- HIDDEN" ).append("\n"); 
		query.append("    ,TPSZINPUT    -- HIDDEN" ).append("\n"); 
		query.append("    ,SORT1" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    -- TYPE SIZE별 수정된 VOL 정보를 확인하기 위한 FLAG" ).append("\n"); 
		query.append("    #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("     ,${key}FLAG" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("     ,SOCANCEL_FLAG -- HIDDEN(SOCANCEL 확인용)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    ,WK_ST_DT   -- week from date" ).append("\n"); 
		query.append("    ,WK_END_DT -- week to date" ).append("\n"); 
		query.append("    ,WK_MAX_DT -- WEEK MAX DATE +7" ).append("\n"); 
		query.append("    ,TRSPNO_P     -- TRSP P CD COUNT" ).append("\n"); 
		query.append("    ,TRSPNO_D     -- TRSP D CD COUNT" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    -- 특정 PLAN에 포함된 EXECUTE의 TYPESIZE별 VOL 전체" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    -- TYPESIZE VOL별 FEEDBACK 정보" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    -- TYPESIZE UNIT COST, FROM COST, TO COST" ).append("\n"); 
		query.append("    #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("    --	,${key}UNITCOST --HIDDEN" ).append("\n"); 
		query.append("    --	        	      ,NVL(SUM(${key}FROMCOST),0) ${key}FROMCOST --HIDDEN" ).append("\n"); 
		query.append("    --	        		  ,NVL(SUM(${key}TOCOST),0)   ${key}TOCOST   --HIDDEN" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("    ,NVL((SELECT 'Y' FROM MDM_EQ_ORZ_CHT EOC, MDM_LOCATION ML WHERE EOC.SCC_CD = ML.SCC_CD AND ML.LOC_CD = SUBSTR(T3_FRLOC,1,5) AND EOC.DELT_FLG = 'N'" ).append("\n"); 
		query.append("             AND EOC.RCC_CD = (SELECT SUB.RCC_CD FROM MDM_ORGANIZATION MO, MDM_EQ_ORZ_CHT SUB, MDM_LOCATION ML WHERE MO.OFC_CD = @[off_cd]" ).append("\n"); 
		query.append("			 					AND MO.LOC_CD = ML.LOC_CD" ).append("\n"); 
		query.append("			 					AND ML.SCC_CD = SUB.SCC_CD" ).append("\n"); 
		query.append("			 					AND SUB.DELT_FLG = 'N'" ).append("\n"); 
		query.append("								AND ROWNUM = 1)) , 'Y') AS T3_FM_CHK_FLG  " ).append("\n"); 
		query.append("	,NVL ((SELECT 'Y'FROM MDM_EQ_ORZ_CHT EOC, MDM_LOCATION ML WHERE EOC.SCC_CD = ML.SCC_CD AND ML.LOC_CD = SUBSTR(T3_TOLOC,1,5) AND EOC.DELT_FLG = 'N'" ).append("\n"); 
		query.append("             AND EOC.RCC_CD = (SELECT SUB.RCC_CD FROM MDM_ORGANIZATION MO, MDM_EQ_ORZ_CHT SUB, MDM_LOCATION ML WHERE MO.OFC_CD = @[off_cd]" ).append("\n"); 
		query.append("                                  AND MO.LOC_CD = ML.LOC_CD" ).append("\n"); 
		query.append("                                  AND ML.SCC_CD = SUB.SCC_CD" ).append("\n"); 
		query.append("                                  AND SUB.DELT_FLG = 'N'" ).append("\n"); 
		query.append("                                  AND ROWNUM = 1)) , 'Y') AS T3_TO_CHK_FLG  " ).append("\n"); 
		query.append("	,CASE WHEN DIVISION = 'Plan' THEN " ).append("\n"); 
		query.append("        (SELECT OFC_CD FROM COM_USER WHERE USR_ID = (SELECT UPD_USR_ID FROM EQR_ONF_HIR_PLN WHERE REPO_PLN_ID =  @[repoPlanID] AND PLN_YRWK = T3_PLN_YRWK AND PLN_SEQ = T3_PLN_SEQ  AND ROWNUM = 1))" ).append("\n"); 
		query.append("     ELSE " ).append("\n"); 
		query.append("        (SELECT OFC_CD FROM COM_USER WHERE USR_ID = (SELECT UPD_USR_ID FROM EQR_ONF_HIR_EXE_PLN WHERE REPO_PLN_ID =  @[repoPlanID] AND PLN_YRWK = T3_PLN_YRWK AND	PLN_SEQ = T3_PLN_SEQ AND REF_ID = T3_REFNO AND ROWNUM = 1))" ).append("\n"); 
		query.append("     END T3_OFC_CD  " ).append("\n"); 
		query.append("             " ).append("\n"); 
		query.append("     ,CASE WHEN DIVISION = 'Plan' THEN " ).append("\n"); 
		query.append("          (SELECT UPD_USR_ID FROM EQR_ONF_HIR_PLN WHERE REPO_PLN_ID =  @[repoPlanID] AND PLN_YRWK = T3_PLN_YRWK AND PLN_SEQ = T3_PLN_SEQ   AND ROWNUM = 1)" ).append("\n"); 
		query.append("     ELSE " ).append("\n"); 
		query.append("          (SELECT UPD_USR_ID FROM EQR_ONF_HIR_EXE_PLN WHERE REPO_PLN_ID =  @[repoPlanID] AND	PLN_YRWK = T3_PLN_YRWK AND PLN_SEQ = T3_PLN_SEQ AND REF_ID = T3_REFNO   AND ROWNUM = 1)" ).append("\n"); 
		query.append("     END T3_UPD_USR_ID " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	,CASE WHEN DIVISION = 'Plan' THEN " ).append("\n"); 
		query.append("         TO_CHAR((SELECT UPD_DT FROM EQR_ONF_HIR_PLN WHERE REPO_PLN_ID =  @[repoPlanID] AND PLN_YRWK = T3_PLN_YRWK AND PLN_SEQ = T3_PLN_SEQ   AND ROWNUM = 1),'YYYY-MM-DD HH24:MI:SS')" ).append("\n"); 
		query.append("     ELSE " ).append("\n"); 
		query.append("         TO_CHAR((SELECT UPD_DT FROM EQR_ONF_HIR_EXE_PLN WHERE REPO_PLN_ID =  @[repoPlanID] AND	PLN_YRWK = T3_PLN_YRWK AND	PLN_SEQ = T3_PLN_SEQ AND REF_ID = T3_REFNO  AND ROWNUM = 1),'YYYY-MM-DD HH24:MI:SS')" ).append("\n"); 
		query.append("     END T3_UPD_DT " ).append("\n"); 
		query.append("FROM " ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("SELECT" ).append("\n"); 
		query.append("    PLN_YRWK T3_PLN_YRWK" ).append("\n"); 
		query.append("    ,COMPANY" ).append("\n"); 
		query.append("    ,DIVISION" ).append("\n"); 
		query.append("    ,ITEM" ).append("\n"); 
		query.append("    ,LEASE      -- LEASE TERM" ).append("\n"); 
		query.append("    ,LSR 		-- VENDOR ABBR NM" ).append("\n"); 
		query.append("    ,FRLOC T3_FRLOC" ).append("\n"); 
		query.append("    ,ETD" ).append("\n"); 
		query.append("    ,TOLOC T3_TOLOC" ).append("\n"); 
		query.append("    ,ETA" ).append("\n"); 
		query.append("    ,CNTRNO" ).append("\n"); 
		query.append("    ,SOSEND" ).append("\n"); 
		query.append("    ,NOSOSEND" ).append("\n"); 
		query.append("    ,REFNO T3_REFNO" ).append("\n"); 
		query.append("    ,REASON" ).append("\n"); 
		query.append("    ,REASONREMARK" ).append("\n"); 
		query.append("    ,SUM(TOTALVOL)  TOTALVOL" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("        ,NVL(SUM(${key}VOL),0)     ${key}VOL" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    ,0    TOTALCOST" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("        ,0     ${key}COST" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("    ,REPO_PLN_ID 	-- HIDDEN" ).append("\n"); 
		query.append("    ,PLN_SEQ T3_PLN_SEQ        -- HIDDEN" ).append("\n"); 
		query.append("    ,VNDR_ABBR_NM	-- HIDDEN" ).append("\n"); 
		query.append("    ,VNDR_CNT_CD	-- HIDDEN" ).append("\n"); 
		query.append("    ,VNDR_SEQ 	    -- HIDDEN" ).append("\n"); 
		query.append("    ,SORTNUM      -- HIDDEN,  PLAN(1), Execution(2), SO(3)를 구분" ).append("\n"); 
		query.append("    ,NUM          -- HIDDEN,  NORMAL ROW(1), SUB TOTAL(2), GRAND TOTAL(3) 구분" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    ,(" ).append("\n"); 
		query.append("		SELECT" ).append("\n"); 
		query.append("			DISTINCT RCC_CD" ).append("\n"); 
		query.append("		FROM" ).append("\n"); 
		query.append("			EQR_ECC_MST" ).append("\n"); 
		query.append("		WHERE" ).append("\n"); 
		query.append("			ECC_CD = FM_ECC" ).append("\n"); 
		query.append("	) FM_RCC     -- From ecc's RCC" ).append("\n"); 
		query.append("    ,(" ).append("\n"); 
		query.append("		SELECT" ).append("\n"); 
		query.append("			DISTINCT RCC_CD" ).append("\n"); 
		query.append("		FROM" ).append("\n"); 
		query.append("			EQR_ECC_MST" ).append("\n"); 
		query.append("		WHERE" ).append("\n"); 
		query.append("			ECC_CD = TO_ECC" ).append("\n"); 
		query.append("	) TO_RCC     -- To   ecc's RCC" ).append("\n"); 
		query.append("    ,(" ).append("\n"); 
		query.append("		SELECT" ).append("\n"); 
		query.append("			DISTINCT LCC_CD" ).append("\n"); 
		query.append("		FROM" ).append("\n"); 
		query.append("			EQR_ECC_MST" ).append("\n"); 
		query.append("		WHERE" ).append("\n"); 
		query.append("			ECC_CD = FM_ECC" ).append("\n"); 
		query.append("	) FM_LCC     -- From ecc's LCC" ).append("\n"); 
		query.append("    ,(" ).append("\n"); 
		query.append("		SELECT" ).append("\n"); 
		query.append("			DISTINCT LCC_CD" ).append("\n"); 
		query.append("		FROM" ).append("\n"); 
		query.append("			EQR_ECC_MST" ).append("\n"); 
		query.append("		WHERE" ).append("\n"); 
		query.append("			ECC_CD = TO_ECC" ).append("\n"); 
		query.append("	) TO_LCC     -- To   ecc's LCC" ).append("\n"); 
		query.append("    ,FM_ECC     -- FM ECC" ).append("\n"); 
		query.append("    ,TO_ECC     -- TO ECC" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    ,'' CNTRNOINPUT  -- HIDDEN" ).append("\n"); 
		query.append("    ,'' TPSZINPUT    -- HIDDEN" ).append("\n"); 
		query.append("    ,SORT1" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    -- TYPE SIZE별 수정된 VOL 정보를 확인하기 위한 FLAG" ).append("\n"); 
		query.append("    #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("     ,'F' ${key}FLAG" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("     ,'F' SOCANCEL_FLAG -- HIDDEN(SOCANCEL 확인용)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    ,(" ).append("\n"); 
		query.append("		SELECT" ).append("\n"); 
		query.append("			WK_ST_DT" ).append("\n"); 
		query.append("		FROM" ).append("\n"); 
		query.append("			EQR_WK_PRD" ).append("\n"); 
		query.append("		WHERE" ).append("\n"); 
		query.append("			PLN_YR||PLN_WK = PLN_YRWK" ).append("\n"); 
		query.append("	) WK_ST_DT   -- week from date" ).append("\n"); 
		query.append("    ,(" ).append("\n"); 
		query.append("		SELECT" ).append("\n"); 
		query.append("			WK_END_DT" ).append("\n"); 
		query.append("		FROM" ).append("\n"); 
		query.append("			EQR_WK_PRD" ).append("\n"); 
		query.append("		WHERE" ).append("\n"); 
		query.append("			PLN_YR||PLN_WK = PLN_YRWK" ).append("\n"); 
		query.append("	) WK_END_DT -- week to date" ).append("\n"); 
		query.append("    ,(" ).append("\n"); 
		query.append("		SELECT" ).append("\n"); 
		query.append("			TO_CHAR(TO_DATE(WK_END_DT, 'YYYYMMDD')+49, 'YYYYMMDD') WK_MAX_DT" ).append("\n"); 
		query.append("		FROM" ).append("\n"); 
		query.append("			EQR_WK_PRD" ).append("\n"); 
		query.append("		WHERE" ).append("\n"); 
		query.append("			PLN_YR||PLN_WK = PLN_YRWK" ).append("\n"); 
		query.append("	) WK_MAX_DT -- WEEK MAX DATE +7" ).append("\n"); 
		query.append("    ,TRSPNO_P     -- TRSP P CD COUNT" ).append("\n"); 
		query.append("    ,TRSPNO_D     -- TRSP D CD COUNT" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    -- 특정 PLAN에 포함된 EXECUTE의 TYPESIZE별 VOL 전체" ).append("\n"); 
		query.append("    #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("    	,NVL(SUM(${key}MAXVOL),0) ${key}MAXVOL --HIDDEN" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    -- TYPESIZE VOL별 FEEDBACK 정보" ).append("\n"); 
		query.append("    #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("    	,0   ${key}BASICRATIO --HIDDEN" ).append("\n"); 
		query.append("    	,0   ${key}BASICVOL   --HIDDEN" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    -- TYPESIZE UNIT COST, FROM COST, TO COST" ).append("\n"); 
		query.append("    #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("    	,NVL(SUM(${key}UNITCOST),0) ${key}UNITCOST --HIDDEN" ).append("\n"); 
		query.append("    --	        	      ,NVL(SUM(${key}FROMCOST),0) ${key}FROMCOST --HIDDEN" ).append("\n"); 
		query.append("    --	        		  ,NVL(SUM(${key}TOCOST),0)   ${key}TOCOST   --HIDDEN" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("FROM" ).append("\n"); 
		query.append("    (" ).append("\n"); 
		query.append("    SELECT" ).append("\n"); 
		query.append("        DECODE(B.NUM, 1, A.PLN_YRWK, 2, A.PLN_YRWK||' TTL', 3, 'TOTAL') PLN_YRWK" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.COMPANY,  2, '', 3, '')  COMPANY" ).append("\n"); 
		query.append("        ,A.DIVISION" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.ITEM ,  2, '', 3, '') ITEM" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.LSR,  2, '', 3, '')   LSR -- VENDOR ABBR NM" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.LEASE,  2, '', 3, '')   LEASE -- LEASE TERM" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.FRLOC,  2, '', 3, '') FRLOC" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.ETD  ,  2, NULL, 3, NULL) ETD" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.TOLOC,  2, '', 3, '')     TOLOC" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.ETA  ,  2, NULL, 3, NULL) ETA" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.SOSEND  ,  2, NULL, 3, NULL) SOSEND" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.NOSOSEND  ,  2, NULL, 3, NULL) NOSOSEND" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.REASON,  2, '', 3, '') REASON" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.REASONREMARK,  2, '', 3, '') REASONREMARK" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.CNTRNO,  2, '', 3, '') CNTRNO" ).append("\n"); 
		query.append("        ,SUM(A.TOTALVOL)  TOTALVOL" ).append("\n"); 
		query.append("        ,SUM(A.TOTALCOST) TOTALCOST" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("            ,SUM(A.${key}VOL)     ${key}VOL" ).append("\n"); 
		query.append("            ,SUM(A.${key}COST)    ${key}COST" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.REFNO,  2, '', 3, '')         REFNO" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.REPO_PLN_ID,  2, '', 3, '')   REPO_PLN_ID   -- HIDDEN" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.PLN_SEQ,  2, '', 3, '')       PLN_SEQ       -- HIDDEN" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.VNDR_ABBR_NM,  2, '', 3, '')  VNDR_ABBR_NM	-- HIDDEN" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.VNDR_CNT_CD,  2, '', 3, '')   VNDR_CNT_CD	-- HIDDEN" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.VNDR_SEQ,  2, '', 3, '')      VNDR_SEQ 		-- HIDDEN" ).append("\n"); 
		query.append("        ,A.SORTNUM SORTNUM	-- HIDDEN" ).append("\n"); 
		query.append("        ,B.NUM           	-- HIDDEN" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, DECODE(A.ITEM, 'O', A.TO_ECC, A.FM_ECC),  2, '', 3, '')  SORT1 -- LOCATION SORTING" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.FM_ECC,  2, '', 3, '') FM_ECC" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.TO_ECC,  2, '', 3, '') TO_ECC" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.TRSPNO_P,  2, '', 3, '') TRSPNO_P" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.TRSPNO_D,  2, '', 3, '') TRSPNO_D" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        -- 특정 PLAN에 포함된 EXECUTE의 TYPESIZE별 VOL 전체" ).append("\n"); 
		query.append("        #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("            ,SUM(A.${key}MAXVOL) ${key}MAXVOL --HIDDEN" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        -- TYPESIZE UNIT COST, FROM COST, TO COST" ).append("\n"); 
		query.append("        #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("            ,SUM(A.${key}UNITCOST)   ${key}UNITCOST --HIDDEN" ).append("\n"); 
		query.append("--	        ,SUM(A.${key}FROMCOST)   ${key}FROMCOST --HIDDEN" ).append("\n"); 
		query.append("--	        ,SUM(A.${key}TOCOST)     ${key}TOCOST   --HIDDEN" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    FROM" ).append("\n"); 
		query.append("        (" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            -- PLAN -------------------------------------------" ).append("\n"); 
		query.append("            SELECT" ).append("\n"); 
		query.append("				A.PLN_YRWK" ).append("\n"); 
		query.append("				,A.PLN_SEQ" ).append("\n"); 
		query.append("            	,'' COMPANY  -- E.CO_CD" ).append("\n"); 
		query.append("            	,'Plan' DIVISION" ).append("\n"); 
		query.append("            	,A.ONF_HIR_DIV_CD ITEM" ).append("\n"); 
		query.append("            	,A.CNTR_LSTM_CD  LEASE" ).append("\n"); 
		query.append("            	,'' LSR" ).append("\n"); 
		query.append("                , A.ECC_CD FRLOC" ).append("\n"); 
		query.append("            	--,DECODE(A.ONF_HIR_DIV_CD, 'F', A.ECC_CD, ' ') FRLOC" ).append("\n"); 
		query.append("            	,'' ETD" ).append("\n"); 
		query.append("                , A.ECC_CD TOLOC" ).append("\n"); 
		query.append("            	--,DECODE(A.ONF_HIR_DIV_CD, 'O', A.ECC_CD, ' ') TOLOC" ).append("\n"); 
		query.append("            	,'' ETA" ).append("\n"); 
		query.append("            	,'' SOSEND" ).append("\n"); 
		query.append("            	,'' NOSOSEND" ).append("\n"); 
		query.append("            	,'' REASON" ).append("\n"); 
		query.append("            	,'' REASONREMARK" ).append("\n"); 
		query.append("            	,'' CNTRNO" ).append("\n"); 
		query.append("--        	  	,SUM(A.CNTR_QTY) TOTALVOL" ).append("\n"); 
		query.append("--        	  	,SUM(A.ONF_HIR_COST_AMT) TOTALCOST" ).append("\n"); 
		query.append("            	," ).append("\n"); 
		query.append("            	#foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("					NVL(MAX(DECODE(A.CNTR_TPSZ_CD, '${key}', A.CNTR_QTY)),0)" ).append("\n"); 
		query.append("					#if($velocityCount < $tpszArr.size())" ).append("\n"); 
		query.append("						+" ).append("\n"); 
		query.append("					#end" ).append("\n"); 
		query.append("            	#end" ).append("\n"); 
		query.append("            	TOTALVOL" ).append("\n"); 
		query.append("            	," ).append("\n"); 
		query.append("            	#foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("					NVL(MAX(DECODE(A.CNTR_TPSZ_CD, '${key}', A.ONF_HIR_COST_AMT)),0)" ).append("\n"); 
		query.append("					#if($velocityCount < $tpszArr.size())" ).append("\n"); 
		query.append("						+" ).append("\n"); 
		query.append("					#end" ).append("\n"); 
		query.append("            	#end" ).append("\n"); 
		query.append("            	TOTALCOST" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            	#foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("            		,NVL(MAX(DECODE(A.CNTR_TPSZ_CD, '${key}', A.CNTR_QTY)),0) 		 ${key}VOL" ).append("\n"); 
		query.append("            		,NVL(MAX(DECODE(A.CNTR_TPSZ_CD, '${key}', A.ONF_HIR_COST_AMT)),0) ${key}COST" ).append("\n"); 
		query.append("            	#end" ).append("\n"); 
		query.append("            	,'' REFNO" ).append("\n"); 
		query.append("            	,A.REPO_PLN_ID 		-- HIDDEN" ).append("\n"); 
		query.append("            	,'' VNDR_ABBR_NM 	-- HIDDEN" ).append("\n"); 
		query.append("            	,'' VNDR_CNT_CD 	-- HIDDEN" ).append("\n"); 
		query.append("            	,0 VNDR_SEQ  		-- HIDDEN" ).append("\n"); 
		query.append("            	,1 SORTNUM    	-- HIDDEN" ).append("\n"); 
		query.append("            	,DECODE(A.ONF_HIR_DIV_CD, 'F', A.ECC_CD, ' ') FM_ECC -- SORT에 사용될 SCC의 해당 FM ECC 정보" ).append("\n"); 
		query.append("            	,DECODE(A.ONF_HIR_DIV_CD, 'O', A.ECC_CD, ' ') TO_ECC -- SORT에 사용될 SCC의 해당 TO ECC 정보" ).append("\n"); 
		query.append("            	,0 TRSPNO_P" ).append("\n"); 
		query.append("            	,0 TRSPNO_D" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            	-- 특정 PLAN에 포함된 EXECUTE의 TYPESIZE별 VOL 전체" ).append("\n"); 
		query.append("            	#foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("            		,NVL(MAX(DECODE(E.CNTR_TPSZ_CD, '${key}', E.MAX_QTY)),0) ${key}MAXVOL --HIDDEN" ).append("\n"); 
		query.append("            	#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            	-- TYPESIZE VOL별 FEEDBACK 정보" ).append("\n"); 
		query.append("            	#foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("            		#if(${key} == 'S2')" ).append("\n"); 
		query.append("						#set($tranTpsz = 'O2')" ).append("\n"); 
		query.append("					#elseif(${key} == 'S4')" ).append("\n"); 
		query.append("						#set($tranTpsz = 'O4')" ).append("\n"); 
		query.append("        			#elseif(${key} == 'A2')" ).append("\n"); 
		query.append("						#set($tranTpsz = 'F2')" ).append("\n"); 
		query.append("        			#elseif(${key} == 'A4')" ).append("\n"); 
		query.append("						#set($tranTpsz = 'F4')" ).append("\n"); 
		query.append("--        	 		project_name : 신규 장비(F5-40ft H/C Flat rack) 발주에 따른  상에 F5 등록" ).append("\n"); 
		query.append("        			#elseif(${key} == 'F5')" ).append("\n"); 
		query.append("						#set($tranTpsz = 'F4')" ).append("\n"); 
		query.append("        			#else" ).append("\n"); 
		query.append("						#set($tranTpsz = ${key})" ).append("\n"); 
		query.append("					#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            		,NVL(MAX(DECODE(A.CNTR_TPSZ_CD, '$tranTpsz', A.PLN_UC_AMT)),0)   ${key}UNITCOST --HIDDEN" ).append("\n"); 
		query.append("            	#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            FROM" ).append("\n"); 
		query.append("				(" ).append("\n"); 
		query.append("				    SELECT" ).append("\n"); 
		query.append("				        A0.REPO_PLN_ID" ).append("\n"); 
		query.append("				        ,A0.PLN_YRWK" ).append("\n"); 
		query.append("				        ,A0.PLN_SEQ" ).append("\n"); 
		query.append("				        ,A0.ONF_HIR_DIV_CD" ).append("\n"); 
		query.append("				        ,A0.ECC_CD" ).append("\n"); 
		query.append("				        ,A0.CNTR_LSTM_CD" ).append("\n"); 
		query.append("				        ,Q.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("				        ,Q.PLN_UC_AMT" ).append("\n"); 
		query.append("				        ,Q.CNTR_QTY" ).append("\n"); 
		query.append("				        ,Q.ONF_HIR_COST_AMT" ).append("\n"); 
		query.append("				    FROM" ).append("\n"); 
		query.append("				        EQR_ONF_HIR_PLN A0," ).append("\n"); 
		query.append("				        EQR_ONF_HIR_PLN_QTY Q" ).append("\n"); 
		query.append("				    WHERE" ).append("\n"); 
		query.append("				        A0.REPO_PLN_ID = Q.REPO_PLN_ID" ).append("\n"); 
		query.append("            		    AND A0.PLN_YRWK = Q.PLN_YRWK" ).append("\n"); 
		query.append("            		    AND A0.PLN_SEQ  = Q.PLN_SEQ" ).append("\n"); 
		query.append("				) A ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            	-- reason, company, sosend 검색정보 사용시만 조인쿼리를 사용합니다." ).append("\n"); 
		query.append("            	#if(${reason} != '' ||  ${sosend} != '')" ).append("\n"); 
		query.append("            	(" ).append("\n"); 
		query.append("            		SELECT" ).append("\n"); 
		query.append("						DISTINCT A.REPO_PLN_ID" ).append("\n"); 
		query.append("            			,A.PLN_YRWK" ).append("\n"); 
		query.append("            			,A.PLN_SEQ" ).append("\n"); 
		query.append("            			,A.REF_ID" ).append("\n"); 
		query.append("            			,A.CO_CD" ).append("\n"); 
		query.append("            			,Q.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("            			,A.CO_CD" ).append("\n"); 
		query.append("            			,A.ONF_HIR_DIV_CD" ).append("\n"); 
		query.append("            			,A.FM_YD_CD" ).append("\n"); 
		query.append("            			,A.TO_YD_CD" ).append("\n"); 
		query.append("            			,A.REPO_PLN_FB_RSN_CD" ).append("\n"); 
		query.append("            			,A.SO_ISS_FLG" ).append("\n"); 
		query.append("            			,A.NON_SO_ISS_FLG" ).append("\n"); 
		query.append("            			,B.ECC_CD FM_ECC" ).append("\n"); 
		query.append("            			,C.ECC_CD TO_ECC" ).append("\n"); 
		query.append("            		FROM" ).append("\n"); 
		query.append("						EQR_ONF_HIR_EXE_PLN A," ).append("\n"); 
		query.append("						EQR_ONF_HIR_EXE_PLN_QTY Q," ).append("\n"); 
		query.append("            			MDM_EQ_ORZ_CHT B," ).append("\n"); 
		query.append("            			MDM_EQ_ORZ_CHT C," ).append("\n"); 
		query.append("            			MDM_LOCATION E," ).append("\n"); 
		query.append("            			MDM_LOCATION F" ).append("\n"); 
		query.append("            		WHERE" ).append("\n"); 
		query.append("            		    A.REPO_PLN_ID = Q.REPO_PLN_ID" ).append("\n"); 
		query.append("            		    AND A.PLN_YRWK = Q.PLN_YRWK" ).append("\n"); 
		query.append("            		    AND A.PLN_SEQ  = Q.PLN_SEQ" ).append("\n"); 
		query.append("            		    AND A.REF_ID = Q.REF_ID" ).append("\n"); 
		query.append("										AND SUBSTR(A.FM_YD_CD, 0, 5) = E.LOC_CD" ).append("\n"); 
		query.append("										AND E.SCC_CD = B.SCC_CD" ).append("\n"); 
		query.append("            			  AND SUBSTR(A.TO_YD_CD, 0, 5) = F.LOC_CD" ).append("\n"); 
		query.append("            			  AND F.SCC_CD = C.SCC_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            			#if(${reason} != '')" ).append("\n"); 
		query.append("							AND A.REPO_PLN_FB_RSN_CD IN ( ${reasonStrArr} )" ).append("\n"); 
		query.append("						#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            			#if(${sosend} != '')" ).append("\n"); 
		query.append("							AND (" ).append("\n"); 
		query.append("								A.SO_ISS_FLG = @[sosend]" ).append("\n"); 
		query.append("								OR" ).append("\n"); 
		query.append("								A.NON_SO_ISS_FLG= @[sosend]" ).append("\n"); 
		query.append("							)" ).append("\n"); 
		query.append("						#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            	) B," ).append("\n"); 
		query.append("            	#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            	(" ).append("\n"); 
		query.append("            		SELECT" ).append("\n"); 
		query.append("            			A.PLN_YRWK" ).append("\n"); 
		query.append("            			,A.PLN_SEQ" ).append("\n"); 
		query.append("            			,A.CO_CD" ).append("\n"); 
		query.append("                        ,A.ONF_HIR_DIV_CD" ).append("\n"); 
		query.append("                        ,DECODE(A.ONF_HIR_DIV_CD, 'F', B.ECC_CD, ' ') FM_ECC" ).append("\n"); 
		query.append("                        ,DECODE(A.ONF_HIR_DIV_CD, 'O', C.ECC_CD, ' ') TO_ECC" ).append("\n"); 
		query.append("                        ,Q.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                        ,SUM(Q.CNTR_QTY) MAX_QTY" ).append("\n"); 
		query.append("                    FROM" ).append("\n"); 
		query.append("                        EQR_ONF_HIR_EXE_PLN A," ).append("\n"); 
		query.append("                        EQR_ONF_HIR_EXE_PLN_QTY Q," ).append("\n"); 
		query.append("                        MDM_EQ_ORZ_CHT B," ).append("\n"); 
		query.append("                        MDM_EQ_ORZ_CHT C," ).append("\n"); 
		query.append("                        MDM_LOCATION   E," ).append("\n"); 
		query.append("                        MDM_LOCATION   F" ).append("\n"); 
		query.append("                    WHERE" ).append("\n"); 
		query.append("                        A.REPO_PLN_ID = Q.REPO_PLN_ID" ).append("\n"); 
		query.append("            		    AND A.PLN_YRWK = Q.PLN_YRWK" ).append("\n"); 
		query.append("            		    AND A.PLN_SEQ  = Q.PLN_SEQ" ).append("\n"); 
		query.append("            		    AND A.REF_ID = Q.REF_ID" ).append("\n"); 
		query.append("												AND SUBSTR(A.FM_YD_CD, 0, 5) = E.LOC_CD" ).append("\n"); 
		query.append("												AND E.SCC_CD = B.SCC_CD" ).append("\n"); 
		query.append("                        AND SUBSTR(A.TO_YD_CD, 0, 5) = F.LOC_CD" ).append("\n"); 
		query.append("                        AND F.SCC_CD = C.SCC_CD" ).append("\n"); 
		query.append("                        AND A.REPO_PLN_ID = @[repoPlanID]" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                        #if(${fmtoat} == '3' ) --Fm ETD" ).append("\n"); 
		query.append("                            AND  A.FM_LOC_DT  BETWEEN (" ).append("\n"); 
		query.append("                                                        SELECT" ).append("\n"); 
		query.append("                                                            WK_ST_DT" ).append("\n"); 
		query.append("                                                        FROM" ).append("\n"); 
		query.append("                                                            EQR_WK_PRD" ).append("\n"); 
		query.append("                                                        WHERE" ).append("\n"); 
		query.append("                                                            PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("                                                      )" ).append("\n"); 
		query.append("                                                      AND" ).append("\n"); 
		query.append("                                                      (" ).append("\n"); 
		query.append("                                                        SELECT" ).append("\n"); 
		query.append("                                                            WK_END_DT" ).append("\n"); 
		query.append("                                                        FROM" ).append("\n"); 
		query.append("                                                            EQR_WK_PRD" ).append("\n"); 
		query.append("                                                        WHERE" ).append("\n"); 
		query.append("                                                            PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("                                                      )" ).append("\n"); 
		query.append("                        #elseif(${fmtoat} == '4') --To ETA" ).append("\n"); 
		query.append("                            AND  A.TO_LOC_DT  BETWEEN (" ).append("\n"); 
		query.append("                                                        SELECT" ).append("\n"); 
		query.append("                                                            WK_ST_DT" ).append("\n"); 
		query.append("                                                        FROM" ).append("\n"); 
		query.append("                                                            EQR_WK_PRD" ).append("\n"); 
		query.append("                                                        WHERE" ).append("\n"); 
		query.append("                                                            PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("                                                      )" ).append("\n"); 
		query.append("                                                      AND" ).append("\n"); 
		query.append("                                                      (" ).append("\n"); 
		query.append("                                                        SELECT" ).append("\n"); 
		query.append("                                                            WK_END_DT" ).append("\n"); 
		query.append("                                                        FROM" ).append("\n"); 
		query.append("                                                            EQR_WK_PRD" ).append("\n"); 
		query.append("                                                        WHERE" ).append("\n"); 
		query.append("                                                            PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("                                                      )" ).append("\n"); 
		query.append("                        #else  -- Fm/To , At일경우" ).append("\n"); 
		query.append("                            AND   A.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                    GROUP BY" ).append("\n"); 
		query.append("                        A.PLN_YRWK" ).append("\n"); 
		query.append("                        ,A.PLN_SEQ" ).append("\n"); 
		query.append("                        ,A.CO_CD" ).append("\n"); 
		query.append("                        ,A.ONF_HIR_DIV_CD" ).append("\n"); 
		query.append("                        ,DECODE(A.ONF_HIR_DIV_CD, 'F', B.ECC_CD, ' ')" ).append("\n"); 
		query.append("                        ,DECODE(A.ONF_HIR_DIV_CD, 'O', C.ECC_CD, ' ')" ).append("\n"); 
		query.append("                        ,Q.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                ) E" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            WHERE" ).append("\n"); 
		query.append("                1=1" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                -- reason, company, sosend 검색정보 사용시만 조인쿼리를 사용합니다." ).append("\n"); 
		query.append("                #if(${reason} != '' || ${sosend} != '')" ).append("\n"); 
		query.append("                    AND   A.REPO_PLN_ID = B.REPO_PLN_ID" ).append("\n"); 
		query.append("                    AND   A.PLN_YRWK    = B.PLN_YRWK" ).append("\n"); 
		query.append("                    AND   A.PLN_SEQ     = B.PLN_SEQ" ).append("\n"); 
		query.append("                    AND   A.ONF_HIR_DIV_CD = B.ONF_HIR_DIV_CD" ).append("\n"); 
		query.append("                    AND   (" ).append("\n"); 
		query.append("							A.ECC_CD=B.FM_ECC" ).append("\n"); 
		query.append("							OR" ).append("\n"); 
		query.append("							A.ECC_CD=B.TO_ECC" ).append("\n"); 
		query.append("						  )" ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("                AND   A.ONF_HIR_DIV_CD IN ('O', 'F')" ).append("\n"); 
		query.append("                AND   A.REPO_PLN_ID = @[repoPlanID]" ).append("\n"); 
		query.append("                AND   A.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek]" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                AND   A.PLN_YRWK       = E.PLN_YRWK(+)" ).append("\n"); 
		query.append("                AND   A.PLN_SEQ        = E.PLN_SEQ(+)" ).append("\n"); 
		query.append("                AND   A.ONF_HIR_DIV_CD = E.ONF_HIR_DIV_CD(+)" ).append("\n"); 
		query.append("                AND   DECODE(A.ONF_HIR_DIV_CD, 'F', A.ECC_CD, ' ') = E.FM_ECC(+)" ).append("\n"); 
		query.append("                AND   DECODE(A.ONF_HIR_DIV_CD, 'O', A.ECC_CD, ' ') = E.TO_ECC(+)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                -- user location" ).append("\n"); 
		query.append("                #if(${userECC} != ${userECC})" ).append("\n"); 
		query.append("                    AND A.ECC_CD IN ( ${userLocWhere} )" ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                -- fmtoat 3 : Fm ETD , fmtoat 4 : To ETA" ).append("\n"); 
		query.append("                -- IF ( fmtoat 1   &&  fromStatus != '' )        AND A.ECC_CD IN  frLocWhere  --원본" ).append("\n"); 
		query.append("                #if( ( ${fmtoat} == '1' || ${fmtoat} =='3' || ${fmtoat} == '4' ) && ${fromStatus} != '')" ).append("\n"); 
		query.append("                    AND A.ECC_CD IN ( ${frLocWhere} )" ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("                #if(${tpsz} != '' && ${tpsztype} != '')" ).append("\n"); 
		query.append("                    AND A.CNTR_TPSZ_CD IN ( ${tpszWhere} )" ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("                #if(${itemname} != '')" ).append("\n"); 
		query.append("                    AND A.ONF_HIR_DIV_CD IN ( ${itemnameWhere} )" ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            GROUP BY" ).append("\n"); 
		query.append("                A.PLN_YRWK" ).append("\n"); 
		query.append("                ,A.PLN_SEQ" ).append("\n"); 
		query.append("                ,E.CO_CD" ).append("\n"); 
		query.append("                ,A.ONF_HIR_DIV_CD" ).append("\n"); 
		query.append("                ,A.CNTR_LSTM_CD" ).append("\n"); 
		query.append("                , A.ECC_CD" ).append("\n"); 
		query.append("                ,A.REPO_PLN_ID" ).append("\n"); 
		query.append("        -- Execution ---------------------------------------" ).append("\n"); 
		query.append("        UNION" ).append("\n"); 
		query.append("            SELECT" ).append("\n"); 
		query.append("                A.PLN_YRWK PLN_YRWK" ).append("\n"); 
		query.append("                ,A.PLN_SEQ" ).append("\n"); 
		query.append("                ,A.CO_CD COMPANY" ).append("\n"); 
		query.append("                ,'Execution' DIVISION" ).append("\n"); 
		query.append("                ,A.ONF_HIR_DIV_CD ITEM" ).append("\n"); 
		query.append("                ,'' LEASE" ).append("\n"); 
		query.append("                ,A.VNDR_ABBR_NM LSR" ).append("\n"); 
		query.append("                ,A.FM_YD_CD FRLOC" ).append("\n"); 
		query.append("                ,A.FM_LOC_DT ETD" ).append("\n"); 
		query.append("                ,A.TO_YD_CD TOLOC" ).append("\n"); 
		query.append("                ,A.TO_LOC_DT ETA" ).append("\n"); 
		query.append("                ,A.SO_ISS_FLG SOSEND" ).append("\n"); 
		query.append("                ,A.NON_SO_ISS_FLG SOSEND" ).append("\n"); 
		query.append("                ,A.REPO_PLN_FB_RSN_CD REASON" ).append("\n"); 
		query.append("                ,A.REPO_PLN_FB_RMK REASONREMARK" ).append("\n"); 
		query.append("                ,CASE WHEN A.PLN_YRWK = C.PLN_YRWK AND A.REF_ID = C.REF_ID THEN" ).append("\n"); 
		query.append("					'0'  -- CNTR 존재" ).append("\n"); 
		query.append("                ELSE" ).append("\n"); 
		query.append("					'1'  -- CNTR 존재안함" ).append("\n"); 
		query.append("                END CNTRNO" ).append("\n"); 
		query.append("                --        	  ,MAX(A.CNTR_QTY) TOTALVOL" ).append("\n"); 
		query.append("                --        	  ,MAX(A.ONF_HIR_COST_AMT) TOTALCOST" ).append("\n"); 
		query.append("				," ).append("\n"); 
		query.append("                #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("					NVL(MAX(DECODE(A.CNTR_TPSZ_CD, '${key}', A.CNTR_QTY)),0)" ).append("\n"); 
		query.append("					#if($velocityCount < $tpszArr.size())" ).append("\n"); 
		query.append("						+" ).append("\n"); 
		query.append("					#end" ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("                TOTALVOL" ).append("\n"); 
		query.append("                ," ).append("\n"); 
		query.append("                #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("                	NVL(MAX(DECODE(A.CNTR_TPSZ_CD, '${key}', A.ONF_HIR_COST_AMT)),0)" ).append("\n"); 
		query.append("					#if($velocityCount < $tpszArr.size())" ).append("\n"); 
		query.append("						+" ).append("\n"); 
		query.append("					#end" ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("                TOTALCOST" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("                	,NVL(MAX(DECODE(A.CNTR_TPSZ_CD, '${key}', A.CNTR_QTY)),0) 		 ${key}VOL" ).append("\n"); 
		query.append("                	,NVL(MAX(DECODE(A.CNTR_TPSZ_CD, '${key}', A.ONF_HIR_COST_AMT)),0) ${key}COST" ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                ,A.REF_ID REFNO" ).append("\n"); 
		query.append("                ,A.REPO_PLN_ID 				-- HIDDEN" ).append("\n"); 
		query.append("                ,A.VNDR_ABBR_NM VNDR_ABBR_NM 	-- HIDDEN" ).append("\n"); 
		query.append("                ,A.VNDR_CNT_CD  VNDR_CNT_CD 	-- HIDDEN" ).append("\n"); 
		query.append("                ,A.VNDR_SEQ     VNDR_SEQ  	-- HIDDEN" ).append("\n"); 
		query.append("                ,2 SORTNUM   					-- HIDDEN" ).append("\n"); 
		query.append("                ,A.FM_ECC  -- SORT에 사용될 SCC의 해당 FM ECC 정보" ).append("\n"); 
		query.append("                ,A.TO_ECC  -- SORT에 사용될 SCC의 해당 TO ECC 정보" ).append("\n"); 
		query.append("                ,CASE WHEN A.PLN_YRWK = D.PLN_YRWK AND A.REF_ID = D.REF_ID THEN" ).append("\n"); 
		query.append("					D.TRSPCOUNT_P  -- TRSP 존재" ).append("\n"); 
		query.append("                ELSE" ).append("\n"); 
		query.append("					0              -- TRSP 존재안함" ).append("\n"); 
		query.append("                END TRSPNO_P" ).append("\n"); 
		query.append("                ,CASE WHEN A.PLN_YRWK = D.PLN_YRWK AND A.REF_ID = D.REF_ID THEN" ).append("\n"); 
		query.append("					D.TRSPCOUNT_D  -- TRSP 존재" ).append("\n"); 
		query.append("                ELSE" ).append("\n"); 
		query.append("					0            -- TRSP 존재안함" ).append("\n"); 
		query.append("                END TRSPNO_D" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                -- 특정 PLAN에 포함된 EXECUTE의 TYPESIZE별 VOL 전체" ).append("\n"); 
		query.append("                #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("                	,0 ${key}MAXVOL --HIDDEN" ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                -- TYPESIZE VOL별 FEEDBACK 정보" ).append("\n"); 
		query.append("                #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("                	,NVL(MAX(DECODE(A.CNTR_TPSZ_CD, '${key}', A.PLN_UC_AMT)),0)      ${key}UNITCOST --HIDDEN" ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            FROM" ).append("\n"); 
		query.append("                (" ).append("\n"); 
		query.append("                    SELECT" ).append("\n"); 
		query.append("                        A.REPO_PLN_ID" ).append("\n"); 
		query.append("                        ,A.PLN_YRWK" ).append("\n"); 
		query.append("                        ,A.PLN_SEQ" ).append("\n"); 
		query.append("                        ,A.REF_ID" ).append("\n"); 
		query.append("                        ,Q.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                        ,A.CO_CD" ).append("\n"); 
		query.append("                        ,A.ONF_HIR_DIV_CD" ).append("\n"); 
		query.append("                        ,A.VNDR_CNT_CD" ).append("\n"); 
		query.append("                        ,A.VNDR_SEQ" ).append("\n"); 
		query.append("                        ,A.VNDR_ABBR_NM" ).append("\n"); 
		query.append("                        ,A.FM_YD_CD" ).append("\n"); 
		query.append("                        ,A.FM_LOC_DT" ).append("\n"); 
		query.append("                        ,A.TO_YD_CD" ).append("\n"); 
		query.append("                        ,A.TO_LOC_DT" ).append("\n"); 
		query.append("                        ,A.REPO_PLN_FB_RSN_CD" ).append("\n"); 
		query.append("                        ,A.REPO_PLN_FB_RMK" ).append("\n"); 
		query.append("                        ,Q.CNTR_QTY" ).append("\n"); 
		query.append("                        ,Q.ONF_HIR_COST_AMT" ).append("\n"); 
		query.append("                        ,A.SO_RQST_DT" ).append("\n"); 
		query.append("                        ,A.SO_ISS_FLG" ).append("\n"); 
		query.append("                        ,A.NON_SO_ISS_FLG" ).append("\n"); 
		query.append("                        ,B.ECC_CD FM_ECC" ).append("\n"); 
		query.append("                        ,C.ECC_CD TO_ECC" ).append("\n"); 
		query.append("                        ,Q.PLN_UC_AMT" ).append("\n"); 
		query.append("                        --	                               ,A.FM_ECC_COST_AMT" ).append("\n"); 
		query.append("                        --	                               ,A.TO_ECC_COST_AMT" ).append("\n"); 
		query.append("                    FROM" ).append("\n"); 
		query.append("                        EQR_ONF_HIR_EXE_PLN A," ).append("\n"); 
		query.append("                        EQR_ONF_HIR_EXE_PLN_QTY Q," ).append("\n"); 
		query.append("                        MDM_EQ_ORZ_CHT B," ).append("\n"); 
		query.append("                        MDM_EQ_ORZ_CHT C," ).append("\n"); 
		query.append("                        MDM_LOCATION E," ).append("\n"); 
		query.append("                        MDM_LOCATION F" ).append("\n"); 
		query.append("                    WHERE" ).append("\n"); 
		query.append("                        A.REPO_PLN_ID = Q.REPO_PLN_ID" ).append("\n"); 
		query.append("            		    AND A.PLN_YRWK = Q.PLN_YRWK" ).append("\n"); 
		query.append("            		    AND A.PLN_SEQ  = Q.PLN_SEQ" ).append("\n"); 
		query.append("            		    AND A.REF_ID = Q.REF_ID" ).append("\n"); 
		query.append("                        AND SUBSTR(A.FM_YD_CD, 0, 5) = E.LOC_CD" ).append("\n"); 
		query.append("                        AND E.SCC_CD = B.SCC_CD" ).append("\n"); 
		query.append("                        AND SUBSTR(A.TO_YD_CD, 0, 5) = F.LOC_CD" ).append("\n"); 
		query.append("                        AND F.SCC_CD =C.SCC_CD" ).append("\n"); 
		query.append("                ) A," ).append("\n"); 
		query.append("--              EQR_ONF_HIR_PLN B," ).append("\n"); 
		query.append("                (" ).append("\n"); 
		query.append("                    SELECT" ).append("\n"); 
		query.append("                        A.REPO_PLN_ID" ).append("\n"); 
		query.append("                        , A.PLN_YRWK" ).append("\n"); 
		query.append("                        , A.PLN_SEQ" ).append("\n"); 
		query.append("                        , A.REF_ID" ).append("\n"); 
		query.append("                        , NVL(COUNT(*), 0) REFCOUNT" ).append("\n"); 
		query.append("                    FROM" ).append("\n"); 
		query.append("                        EQR_EXE_PLN_CNTR A," ).append("\n"); 
		query.append("                        EQR_ONF_HIR_EXE_PLN B ," ).append("\n"); 
		query.append("                        EQR_ONF_HIR_EXE_PLN_QTY Q" ).append("\n"); 
		query.append("                    WHERE" ).append("\n"); 
		query.append("                        A.REPO_PLN_ID = B.REPO_PLN_ID" ).append("\n"); 
		query.append("                        AND   A.PLN_YRWK    = B.PLN_YRWK" ).append("\n"); 
		query.append("                        AND   A.PLN_SEQ     = B.PLN_SEQ" ).append("\n"); 
		query.append("                        AND   A.REF_ID      = B.REF_ID" ).append("\n"); 
		query.append("                        AND   B.REPO_PLN_ID = Q.REPO_PLN_ID" ).append("\n"); 
		query.append("                        AND   B.PLN_YRWK    = Q.PLN_YRWK" ).append("\n"); 
		query.append("                        AND   B.PLN_SEQ     = Q.PLN_SEQ" ).append("\n"); 
		query.append("                        AND   B.REF_ID      = Q.REF_ID" ).append("\n"); 
		query.append("                        AND   B.REPO_PLN_ID = @[repoPlanID]" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                        -- 추가 내용 : Fm/To 일 경우는 PLN_YRWK으로 조건을 걸고 Fm ETD 경우 FM_ETD_DT로, To ETA일경우 TO_ETA_DT로 조건을 건다." ).append("\n"); 
		query.append("                        #if(${fmtoat} == '3') --Fm ETD" ).append("\n"); 
		query.append("                            AND  B.FM_LOC_DT  BETWEEN 	(" ).append("\n"); 
		query.append("															SELECT" ).append("\n"); 
		query.append("																WK_ST_DT" ).append("\n"); 
		query.append("															FROM" ).append("\n"); 
		query.append("																EQR_WK_PRD" ).append("\n"); 
		query.append("															WHERE" ).append("\n"); 
		query.append("																PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("													  	)" ).append("\n"); 
		query.append("													  	AND" ).append("\n"); 
		query.append("													 	(" ).append("\n"); 
		query.append("															SELECT" ).append("\n"); 
		query.append("																WK_END_DT" ).append("\n"); 
		query.append("															FROM" ).append("\n"); 
		query.append("																EQR_WK_PRD" ).append("\n"); 
		query.append("															WHERE" ).append("\n"); 
		query.append("																PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("														)" ).append("\n"); 
		query.append("                        #elseif(${fmtoat} == '4') --To ETA" ).append("\n"); 
		query.append("                            AND  B.TO_LOC_DT  BETWEEN 	(" ).append("\n"); 
		query.append("															SELECT" ).append("\n"); 
		query.append("																WK_ST_DT" ).append("\n"); 
		query.append("															FROM" ).append("\n"); 
		query.append("																EQR_WK_PRD" ).append("\n"); 
		query.append("															WHERE" ).append("\n"); 
		query.append("																PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("														)" ).append("\n"); 
		query.append("														AND" ).append("\n"); 
		query.append("														(" ).append("\n"); 
		query.append("															SELECT" ).append("\n"); 
		query.append("																WK_END_DT" ).append("\n"); 
		query.append("															FROM" ).append("\n"); 
		query.append("																EQR_WK_PRD" ).append("\n"); 
		query.append("															WHERE" ).append("\n"); 
		query.append("																PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("														)" ).append("\n"); 
		query.append("                        #else  -- Fm/To" ).append("\n"); 
		query.append("                            AND  B.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                        -- user location" ).append("\n"); 
		query.append("                        #if(${userECC} != ${userECC})" ).append("\n"); 
		query.append("                        	AND (" ).append("\n"); 
		query.append("									SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("																SELECT" ).append("\n"); 
		query.append("																	SCC_CD" ).append("\n"); 
		query.append("																FROM" ).append("\n"); 
		query.append("																	MDM_EQ_ORZ_CHT" ).append("\n"); 
		query.append("																WHERE" ).append("\n"); 
		query.append("																	ECC_CD IN ( ${userLocWhere} )" ).append("\n"); 
		query.append("									)" ).append("\n"); 
		query.append("								OR" ).append("\n"); 
		query.append("									SUBSTR(B.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("																SELECT" ).append("\n"); 
		query.append("																	SCC_CD" ).append("\n"); 
		query.append("																FROM" ).append("\n"); 
		query.append("																	MDM_EQ_ORZ_CHT" ).append("\n"); 
		query.append("																WHERE" ).append("\n"); 
		query.append("																	ECC_CD IN ( ${userLocWhere} )" ).append("\n"); 
		query.append("									)" ).append("\n"); 
		query.append("								)" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                        #if(${fmtoat} == '1' && ${fromStatus} != '')" ).append("\n"); 
		query.append("                        	AND SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("																SELECT" ).append("\n"); 
		query.append("																	SCC_CD" ).append("\n"); 
		query.append("																FROM" ).append("\n"); 
		query.append("																	MDM_EQ_ORZ_CHT" ).append("\n"); 
		query.append("																WHERE" ).append("\n"); 
		query.append("																	ECC_CD IN ( ${frLocWhere} )" ).append("\n"); 
		query.append("							)" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        -- fmtoat.equals('3'): Fm ETD , fmtoat.equals('4'): To ETA" ).append("\n"); 
		query.append("                        #if(${fmtoat} == '3' && ${fromStatus} != '')" ).append("\n"); 
		query.append("                        	AND SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("																SELECT" ).append("\n"); 
		query.append("																	SCC_CD" ).append("\n"); 
		query.append("																FROM" ).append("\n"); 
		query.append("																	MDM_EQ_ORZ_CHT" ).append("\n"); 
		query.append("																WHERE" ).append("\n"); 
		query.append("																	ECC_CD IN ( ${frLocWhere} )" ).append("\n"); 
		query.append("							)" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                        #if(${fmtoat} == '4' && ${fromStatus} != '' )" ).append("\n"); 
		query.append("                        	AND SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("																SELECT" ).append("\n"); 
		query.append("																	SCC_CD" ).append("\n"); 
		query.append("																FROM" ).append("\n"); 
		query.append("																	MDM_EQ_ORZ_CHT" ).append("\n"); 
		query.append("																WHERE" ).append("\n"); 
		query.append("																	ECC_CD IN ( ${frLocWhere} )" ).append("\n"); 
		query.append("							)" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                        #if(${tpsz} != ''  && ${tpsztype} != '')" ).append("\n"); 
		query.append("                        	AND Q.CNTR_TPSZ_CD IN ( ${tpszWhere} )" ).append("\n"); 
		query.append("						#end" ).append("\n"); 
		query.append("                        #if(${reason} != '')" ).append("\n"); 
		query.append("							AND B.REPO_PLN_FB_RSN_CD IN ( ${reasonWhere} )" ).append("\n"); 
		query.append("						#end" ).append("\n"); 
		query.append("                        #if(${itemname} != '')" ).append("\n"); 
		query.append("							AND B.ONF_HIR_DIV_CD IN ( ${itemnameWhere} )" ).append("\n"); 
		query.append("						#end" ).append("\n"); 
		query.append("                        #if(${sosend} != '')" ).append("\n"); 
		query.append("							AND (" ).append("\n"); 
		query.append("									B.SO_ISS_FLG = @[sosend]" ).append("\n"); 
		query.append("								OR" ).append("\n"); 
		query.append("									B.NON_SO_ISS_FLG = @[sosend]" ).append("\n"); 
		query.append("								)" ).append("\n"); 
		query.append("        				#end" ).append("\n"); 
		query.append("                    GROUP BY" ).append("\n"); 
		query.append("                        A.REPO_PLN_ID" ).append("\n"); 
		query.append("                        , A.PLN_SEQ" ).append("\n"); 
		query.append("                        , A.PLN_YRWK" ).append("\n"); 
		query.append("                        , A.REF_ID" ).append("\n"); 
		query.append("                    HAVING" ).append("\n"); 
		query.append("                        NVL(COUNT(*), 0) > 0" ).append("\n"); 
		query.append("                ) C," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                (" ).append("\n"); 
		query.append("                    SELECT" ).append("\n"); 
		query.append("                        A.REPO_PLN_ID" ).append("\n"); 
		query.append("                        , A.PLN_YRWK" ).append("\n"); 
		query.append("                        , A.PLN_SEQ" ).append("\n"); 
		query.append("                        , A.REF_ID" ).append("\n"); 
		query.append("                        , NVL(SUM(DECODE(A.TRSP_SO_STS_CD, 'P', 1, 0)), 0) TRSPCOUNT_P" ).append("\n"); 
		query.append("                        , NVL(SUM(DECODE(A.TRSP_SO_STS_CD, 'D', 1, 0)), 0) TRSPCOUNT_D" ).append("\n"); 
		query.append("                    FROM" ).append("\n"); 
		query.append("                        (" ).append("\n"); 
		query.append("                            SELECT" ).append("\n"); 
		query.append("                                A.REPO_PLN_ID" ).append("\n"); 
		query.append("                                , A.PLN_YRWK" ).append("\n"); 
		query.append("                                , A.PLN_SEQ" ).append("\n"); 
		query.append("                                , A.REF_ID" ).append("\n"); 
		query.append("                                , A.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                                , A.TRSP_SO_STS_CD" ).append("\n"); 
		query.append("                            FROM" ).append("\n"); 
		query.append("                                EQR_REPO_EXE_SO_IF A," ).append("\n"); 
		query.append("                                EQR_ONF_HIR_EXE_PLN B," ).append("\n"); 
		query.append("                                EQR_ONF_HIR_EXE_PLN_QTY Q" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                            WHERE" ).append("\n"); 
		query.append("                                A.REPO_PLN_ID = B.REPO_PLN_ID" ).append("\n"); 
		query.append("                                AND   A.PLN_YRWK    = B.PLN_YRWK" ).append("\n"); 
		query.append("                                AND   A.PLN_SEQ     = B.PLN_SEQ" ).append("\n"); 
		query.append("                                AND   A.REF_ID      = B.REF_ID" ).append("\n"); 
		query.append("                                AND   B.REPO_PLN_ID = Q.REPO_PLN_ID" ).append("\n"); 
		query.append("                                AND   B.PLN_YRWK    = Q.PLN_YRWK" ).append("\n"); 
		query.append("                                AND   B.PLN_SEQ     = Q.PLN_SEQ" ).append("\n"); 
		query.append("                                AND   B.REF_ID      = Q.REF_ID" ).append("\n"); 
		query.append("                                AND   A.CNTR_TPSZ_CD= Q.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                                AND   B.REPO_PLN_ID = @[repoPlanID]" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                -- 추가 내용 : Fm/To 일 경우는 PLN_YRWK으로 조건을 걸고 Fm ETD 경우 FM_ETD_DT로, To ETA일경우 TO_ETA_DT로 조건을 건다." ).append("\n"); 
		query.append("                                #if(${fmtoat} == '3') --Fm ETD" ).append("\n"); 
		query.append("                               		AND  B.FM_LOC_DT  BETWEEN 	(" ).append("\n"); 
		query.append("																	SELECT" ).append("\n"); 
		query.append("																		WK_ST_DT" ).append("\n"); 
		query.append("																	FROM" ).append("\n"); 
		query.append("																		EQR_WK_PRD" ).append("\n"); 
		query.append("																	WHERE" ).append("\n"); 
		query.append("																		PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("																)" ).append("\n"); 
		query.append("																AND" ).append("\n"); 
		query.append("																(" ).append("\n"); 
		query.append("																	SELECT" ).append("\n"); 
		query.append("																		WK_END_DT" ).append("\n"); 
		query.append("																	FROM" ).append("\n"); 
		query.append("																		EQR_WK_PRD" ).append("\n"); 
		query.append("																	WHERE" ).append("\n"); 
		query.append("																		PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("																)" ).append("\n"); 
		query.append("                                #elseif(${fmtoat} == '4') --To ETA" ).append("\n"); 
		query.append("                                	AND  B.TO_LOC_DT  BETWEEN 	(" ).append("\n"); 
		query.append("																	SELECT" ).append("\n"); 
		query.append("																		WK_ST_DT" ).append("\n"); 
		query.append("																	FROM" ).append("\n"); 
		query.append("																		EQR_WK_PRD" ).append("\n"); 
		query.append("																	WHERE" ).append("\n"); 
		query.append("																		PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("																)" ).append("\n"); 
		query.append("																AND" ).append("\n"); 
		query.append("																(" ).append("\n"); 
		query.append("																	SELECT" ).append("\n"); 
		query.append("																		WK_END_DT" ).append("\n"); 
		query.append("																	FROM" ).append("\n"); 
		query.append("																		EQR_WK_PRD" ).append("\n"); 
		query.append("																	WHERE" ).append("\n"); 
		query.append("																		PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("																)" ).append("\n"); 
		query.append("                                #else  -- Fm/To" ).append("\n"); 
		query.append("                                	AND  B.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek]" ).append("\n"); 
		query.append("                                #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                -- 'P' - S/O Send 최초" ).append("\n"); 
		query.append("                                -- 'D' - TRS모듈에서 W/O 시도후 취소 상태" ).append("\n"); 
		query.append("                                -- P, D 모두 S/O Cancel 대상으로 포함" ).append("\n"); 
		query.append("                                --        		     AND   A.TRSP_SO_STS_CD = 'P'                -- 중요" ).append("\n"); 
		query.append("                                AND   A.TRSP_SO_STS_CD IN ('P', 'D')             -- 중요" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                -- user location" ).append("\n"); 
		query.append("                                #if(${userECC} != ${userECC})" ).append("\n"); 
		query.append("									AND (" ).append("\n"); 
		query.append("											SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("																		SELECT" ).append("\n"); 
		query.append("																			SCC_CD" ).append("\n"); 
		query.append("																		FROM" ).append("\n"); 
		query.append("																			MDM_EQ_ORZ_CHT" ).append("\n"); 
		query.append("																		WHERE" ).append("\n"); 
		query.append("																			ECC_CD IN ( ${userLocWhere} )" ).append("\n"); 
		query.append("																		)" ).append("\n"); 
		query.append("										OR" ).append("\n"); 
		query.append("											SUBSTR(B.TO_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("																		SELECT" ).append("\n"); 
		query.append("																			SCC_CD" ).append("\n"); 
		query.append("																		FROM" ).append("\n"); 
		query.append("																			MDM_EQ_ORZ_CHT" ).append("\n"); 
		query.append("																		WHERE" ).append("\n"); 
		query.append("																			ECC_CD IN ( ${userLocWhere} )" ).append("\n"); 
		query.append("																		)" ).append("\n"); 
		query.append("										)" ).append("\n"); 
		query.append("								#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                -- fmtoat.equals('3'): Fm ETD , fmtoat.equals('4'): To ETA" ).append("\n"); 
		query.append("                                -- IF( fmtoat 1  && fromStatus != '' )        		     AND SUBSTR(B.FM_YD_CD, 0, 5) IN (SELECT SCC_CD FROM MDM_EQ_ORZ_CHT WHERE ECC_CD IN  frLocWhere  )  --원본" ).append("\n"); 
		query.append("                                #if((${fmtoat} == '1' || ${fmtoat} == '3' || ${fmtoat} == '4') && ${fromStatus} != '')" ).append("\n"); 
		query.append("									AND SUBSTR(B.FM_YD_CD, 0, 5) IN (" ).append("\n"); 
		query.append("																		SELECT" ).append("\n"); 
		query.append("																			SCC_CD" ).append("\n"); 
		query.append("																		FROM" ).append("\n"); 
		query.append("																			MDM_EQ_ORZ_CHT" ).append("\n"); 
		query.append("																		WHERE" ).append("\n"); 
		query.append("																			ECC_CD IN ( ${frLocWhere} )" ).append("\n"); 
		query.append("									)" ).append("\n"); 
		query.append("								#end" ).append("\n"); 
		query.append("                                #if(${tpsz} != '' && ${tpsztype} != '')" ).append("\n"); 
		query.append("									AND Q.CNTR_TPSZ_CD IN ( ${tpszWhere} )" ).append("\n"); 
		query.append("								#end" ).append("\n"); 
		query.append("                                #if(${reason} != '')" ).append("\n"); 
		query.append("									AND B.REPO_PLN_FB_RSN_CD IN ( ${reasonWhere} )" ).append("\n"); 
		query.append("								#end" ).append("\n"); 
		query.append("                                #if(${itemname} != '')" ).append("\n"); 
		query.append("									AND B.ONF_HIR_DIV_CD IN ( ${itemnameWhere} )" ).append("\n"); 
		query.append("                                #end" ).append("\n"); 
		query.append("								#if(${sosend} != '')" ).append("\n"); 
		query.append("									AND (" ).append("\n"); 
		query.append("											B.SO_ISS_FLG = @[sosend]" ).append("\n"); 
		query.append("										OR" ).append("\n"); 
		query.append("											B.NON_SO_ISS_FLG = @[sosend]" ).append("\n"); 
		query.append("										)" ).append("\n"); 
		query.append("								#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                        ) A" ).append("\n"); 
		query.append("                    GROUP BY" ).append("\n"); 
		query.append("                        A.REPO_PLN_ID" ).append("\n"); 
		query.append("                        , A.PLN_YRWK" ).append("\n"); 
		query.append("                        , A.PLN_SEQ" ).append("\n"); 
		query.append("                        , A.REF_ID" ).append("\n"); 
		query.append("--        		        HAVING NVL(COUNT(*), 0) > 0" ).append("\n"); 
		query.append("                ) D" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            WHERE" ).append("\n"); 
		query.append("                A.REPO_PLN_ID = @[repoPlanID]" ).append("\n"); 
		query.append("--              AND   A.PLN_YRWK BETWEEN  fromWeek  AND toWeek" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                -- 추가 내용 : Fm/To 일 경우는 PLN_YRWK으로 조건을 걸고 Fm ETD 경우 FM_ETD_DT로, To ETA일경우 TO_ETA_DT로 조건을 건다." ).append("\n"); 
		query.append("                #if(${fmtoat} == '3') --Fm ETD" ).append("\n"); 
		query.append("                	AND  A.FM_LOC_DT  BETWEEN 	(" ).append("\n"); 
		query.append("													SELECT" ).append("\n"); 
		query.append("														WK_ST_DT" ).append("\n"); 
		query.append("													FROM" ).append("\n"); 
		query.append("														EQR_WK_PRD" ).append("\n"); 
		query.append("													WHERE" ).append("\n"); 
		query.append("														PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("												)" ).append("\n"); 
		query.append("												AND" ).append("\n"); 
		query.append("												(" ).append("\n"); 
		query.append("													SELECT" ).append("\n"); 
		query.append("														WK_END_DT" ).append("\n"); 
		query.append("													FROM" ).append("\n"); 
		query.append("														EQR_WK_PRD" ).append("\n"); 
		query.append("													WHERE" ).append("\n"); 
		query.append("														PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("												)" ).append("\n"); 
		query.append("                #elseif(${fmtoat} == '4') --To ETA" ).append("\n"); 
		query.append("                	AND  A.TO_LOC_DT  BETWEEN 	(" ).append("\n"); 
		query.append("													SELECT" ).append("\n"); 
		query.append("														WK_ST_DT" ).append("\n"); 
		query.append("													FROM" ).append("\n"); 
		query.append("														EQR_WK_PRD" ).append("\n"); 
		query.append("													WHERE" ).append("\n"); 
		query.append("														PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("												)" ).append("\n"); 
		query.append("												AND" ).append("\n"); 
		query.append("												(" ).append("\n"); 
		query.append("													SELECT" ).append("\n"); 
		query.append("														WK_END_DT" ).append("\n"); 
		query.append("													FROM" ).append("\n"); 
		query.append("														EQR_WK_PRD" ).append("\n"); 
		query.append("													WHERE" ).append("\n"); 
		query.append("														PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("												)" ).append("\n"); 
		query.append("                #else  -- Fm/To" ).append("\n"); 
		query.append("                	AND  A.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek]" ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                AND   A.PLN_YRWK = C.PLN_YRWK(+)" ).append("\n"); 
		query.append("                AND   A.PLN_SEQ  = C.PLN_SEQ(+)" ).append("\n"); 
		query.append("                AND   A.REF_ID   = C.REF_ID(+)" ).append("\n"); 
		query.append("                AND   A.PLN_YRWK = D.PLN_YRWK(+)" ).append("\n"); 
		query.append("                AND   A.REF_ID   = D.REF_ID(+)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                -- user location" ).append("\n"); 
		query.append("                #if(${userECC} != ${userECC})" ).append("\n"); 
		query.append("					AND (" ).append("\n"); 
		query.append("							A.FM_ECC IN ( ${userLocWhere} )" ).append("\n"); 
		query.append("						OR" ).append("\n"); 
		query.append("							A.TO_ECC IN ( ${userLocWhere} )" ).append("\n"); 
		query.append("						)" ).append("\n"); 
		query.append("				#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                -- fmtoat.equals('3'): Fm ETD , fmtoat.equals('4'): To ETA" ).append("\n"); 
		query.append("                -- IF(fmtoat 1  &&  fromStatus != '' )        AND (A.FM_ECC IN  frLocWhere  OR A.TO_ECC IN  frLocWhere )" ).append("\n"); 
		query.append("                #if( ( ${fmtoat} == '1' || ${fmtoat} == '3' || ${fmtoat} == '4' ) && ${fromStatus} != '')" ).append("\n"); 
		query.append("					AND (" ).append("\n"); 
		query.append("							A.FM_ECC IN ( ${frLocWhere} )" ).append("\n"); 
		query.append("						OR" ).append("\n"); 
		query.append("							A.TO_ECC IN ( ${frLocWhere} )" ).append("\n"); 
		query.append("						)" ).append("\n"); 
		query.append("				#end" ).append("\n"); 
		query.append("                #if(${tpsz} != '' && ${tpsztype} != '')" ).append("\n"); 
		query.append("					AND   A.CNTR_TPSZ_CD IN ( ${tpszWhere} )" ).append("\n"); 
		query.append("				#end" ).append("\n"); 
		query.append("                #if(${reason} != '')" ).append("\n"); 
		query.append("					AND   A.REPO_PLN_FB_RSN_CD IN ( ${reasonWhere} )" ).append("\n"); 
		query.append("				#end" ).append("\n"); 
		query.append("                #if(${itemname} != '')" ).append("\n"); 
		query.append("					AND   A.ONF_HIR_DIV_CD IN ( ${itemnameWhere} )" ).append("\n"); 
		query.append("				#end" ).append("\n"); 
		query.append("                #if(${sosend} != '')" ).append("\n"); 
		query.append("					AND (" ).append("\n"); 
		query.append("							A.SO_ISS_FLG = @[sosend]" ).append("\n"); 
		query.append("						OR" ).append("\n"); 
		query.append("							A.NON_SO_ISS_FLG = @[sosend]" ).append("\n"); 
		query.append("						)" ).append("\n"); 
		query.append("				#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            GROUP BY" ).append("\n"); 
		query.append("                A.PLN_YRWK" ).append("\n"); 
		query.append("                ,A.PLN_SEQ" ).append("\n"); 
		query.append("                ,A.CO_CD" ).append("\n"); 
		query.append("                ,A.ONF_HIR_DIV_CD" ).append("\n"); 
		query.append("                ,A.VNDR_ABBR_NM" ).append("\n"); 
		query.append("                ,A.FM_YD_CD" ).append("\n"); 
		query.append("                ,A.FM_LOC_DT" ).append("\n"); 
		query.append("                ,A.TO_YD_CD" ).append("\n"); 
		query.append("                ,A.TO_LOC_DT" ).append("\n"); 
		query.append("                ,A.SO_ISS_FLG" ).append("\n"); 
		query.append("                ,A.NON_SO_ISS_FLG" ).append("\n"); 
		query.append("                ,A.REPO_PLN_FB_RSN_CD" ).append("\n"); 
		query.append("                ,A.REPO_PLN_FB_RMK" ).append("\n"); 
		query.append("                ,A.REF_ID" ).append("\n"); 
		query.append("                ,A.VNDR_ABBR_NM" ).append("\n"); 
		query.append("                ,A.VNDR_CNT_CD" ).append("\n"); 
		query.append("                ,A.VNDR_SEQ" ).append("\n"); 
		query.append("                ,CASE WHEN A.PLN_YRWK = C.PLN_YRWK AND A.REF_ID = C.REF_ID THEN" ).append("\n"); 
		query.append("                    '0'" ).append("\n"); 
		query.append("                ELSE" ).append("\n"); 
		query.append("                    '1'" ).append("\n"); 
		query.append("                END" ).append("\n"); 
		query.append("                ,A.REPO_PLN_ID" ).append("\n"); 
		query.append("                ,A.FM_ECC  -- SORT에 사용될 SCC의 해당 FM ECC 정보" ).append("\n"); 
		query.append("                ,A.TO_ECC  -- SORT에 사용될 SCC의 해당 TO ECC 정보" ).append("\n"); 
		query.append("                ,CASE WHEN A.PLN_YRWK = D.PLN_YRWK AND A.REF_ID = D.REF_ID THEN" ).append("\n"); 
		query.append("                    D.TRSPCOUNT_P  -- TRSP 존재" ).append("\n"); 
		query.append("                ELSE" ).append("\n"); 
		query.append("                    0              -- TRSP 존재안함" ).append("\n"); 
		query.append("                END" ).append("\n"); 
		query.append("                ,CASE WHEN A.PLN_YRWK = D.PLN_YRWK AND A.REF_ID = D.REF_ID THEN" ).append("\n"); 
		query.append("                    D.TRSPCOUNT_D  -- TRSP 존재" ).append("\n"); 
		query.append("                ELSE" ).append("\n"); 
		query.append("                    0              -- TRSP 존재안함" ).append("\n"); 
		query.append("                END" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        -- W/O Issue ------------------------------------------" ).append("\n"); 
		query.append("        UNION" ).append("\n"); 
		query.append("            SELECT" ).append("\n"); 
		query.append("                PLN_YRWK 		PLN_YRWK" ).append("\n"); 
		query.append("                ,PLN_SEQ        PLN_SEQ" ).append("\n"); 
		query.append("                ,CO_CD 			COMPANY" ).append("\n"); 
		query.append("                ,'W/O Issue' 		DIVISION" ).append("\n"); 
		query.append("                ,SO_IF_DIV_CD     ITEM" ).append("\n"); 
		query.append("                ,''               LEASE" ).append("\n"); 
		query.append("                ,'' 	            LSR" ).append("\n"); 
		query.append("                ,FM_YD_CD 		FRLOC" ).append("\n"); 
		query.append("                ,FM_DT 			ETD" ).append("\n"); 
		query.append("                ,TO_YD_CD 		TOLOC" ).append("\n"); 
		query.append("                ,TO_DT 			ETA" ).append("\n"); 
		query.append("                ,'' SOSEND" ).append("\n"); 
		query.append("                ,'' NOSOSEND" ).append("\n"); 
		query.append("                ,'' REASON" ).append("\n"); 
		query.append("                ,'' REASONREMARK" ).append("\n"); 
		query.append("                ,'' CNTRNO" ).append("\n"); 
		query.append("                ,COUNT(CNTR_TPSZ_CD) TOTALVOL" ).append("\n"); 
		query.append("                --        	  ,SUM(A.REPO_COST_AMT) TOTALCOST" ).append("\n"); 
		query.append("				," ).append("\n"); 
		query.append("                #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("					NVL(SUM(DECODE(CNTR_TPSZ_CD, '${key}', REPO_COST_AMT)),0)" ).append("\n"); 
		query.append("					#if($velocityCount < $tpszArr.size())" ).append("\n"); 
		query.append("						+" ).append("\n"); 
		query.append("					#end" ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("                TOTALCOST" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("                	,COUNT(DECODE(CNTR_TPSZ_CD, '${key}', CNTR_TPSZ_CD))  ${key}VOL" ).append("\n"); 
		query.append("                	,SUM(DECODE(CNTR_TPSZ_CD,   '${key}', REPO_COST_AMT)) ${key}COST" ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("                ,REF_ID REFNO" ).append("\n"); 
		query.append("                ,REPO_PLN_ID 	-- HIDDEN" ).append("\n"); 
		query.append("                ,'' VNDR_ABBR_NM 	-- HIDDEN" ).append("\n"); 
		query.append("                ,'' VNDR_CNT_CD 	-- HIDDEN" ).append("\n"); 
		query.append("                ,0 VNDR_SEQ  		-- HIDDEN" ).append("\n"); 
		query.append("                ,3 SORTNUM	 	-- HIDDEN" ).append("\n"); 
		query.append("                ,B.ECC_CD FM_ECC  -- SORT에 사용될 SCC의 해당 FM ECC 정보" ).append("\n"); 
		query.append("                ,C.ECC_CD TO_ECC  -- SORT에 사용될 SCC의 해당 TO ECC 정보" ).append("\n"); 
		query.append("                ,0 TRSPNO_P" ).append("\n"); 
		query.append("                ,0 TRSPNO_D" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                -- 특정 PLAN에 포함된 EXECUTE의 TYPESIZE별 VOL 전체" ).append("\n"); 
		query.append("                #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("                	,0 ${key}MAXVOL --HIDDEN" ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                -- TYPESIZE VOL별 FEEDBACK 정보" ).append("\n"); 
		query.append("                #foreach(${key} in ${tpszArr})" ).append("\n"); 
		query.append("                	,0   ${key}UNITCOST --HIDDEN" ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            FROM" ).append("\n"); 
		query.append("                EQR_REPO_EXE_SO_IF OUTER," ).append("\n"); 
		query.append("                MDM_EQ_ORZ_CHT B," ).append("\n"); 
		query.append("                MDM_EQ_ORZ_CHT C," ).append("\n"); 
		query.append("		MDM_LOCATION E," ).append("\n"); 
		query.append("		MDM_LOCATION F" ).append("\n"); 
		query.append("            WHERE" ).append("\n"); 
		query.append("                OUTER.WO_EXE_FLG = 'Y'" ).append("\n"); 
		query.append("                AND EXISTS" ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                    SELECT" ).append("\n"); 
		query.append("                        INNER.REPO_PLN_ID" ).append("\n"); 
		query.append("                        ,INNER.REF_ID" ).append("\n"); 
		query.append("                        ,INNER.PLN_YRWK" ).append("\n"); 
		query.append("                    FROM" ).append("\n"); 
		query.append("                        (" ).append("\n"); 
		query.append("                        SELECT" ).append("\n"); 
		query.append("                            A.REPO_PLN_ID" ).append("\n"); 
		query.append("                            ,A.PLN_YRWK" ).append("\n"); 
		query.append("                            ,A.REF_ID" ).append("\n"); 
		query.append("                            ,A.ONF_HIR_DIV_CD" ).append("\n"); 
		query.append("                            ,A.FM_ECC" ).append("\n"); 
		query.append("                            ,A.TO_ECC" ).append("\n"); 
		query.append("                            ,A.CO_CD" ).append("\n"); 
		query.append("                            ,A.SO_ISS_FLG" ).append("\n"); 
		query.append("                            ,A.REPO_PLN_FB_RSN_CD" ).append("\n"); 
		query.append("                        FROM" ).append("\n"); 
		query.append("                            (" ).append("\n"); 
		query.append("                            SELECT" ).append("\n"); 
		query.append("                                A.REPO_PLN_ID" ).append("\n"); 
		query.append("                                ,A.PLN_YRWK" ).append("\n"); 
		query.append("                                ,A.PLN_SEQ" ).append("\n"); 
		query.append("                                ,A.REF_ID" ).append("\n"); 
		query.append("                                ,Q.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                                ,A.CO_CD" ).append("\n"); 
		query.append("                                ,A.ONF_HIR_DIV_CD" ).append("\n"); 
		query.append("                                ,A.VNDR_CNT_CD" ).append("\n"); 
		query.append("                                ,A.VNDR_SEQ" ).append("\n"); 
		query.append("                                ,A.VNDR_ABBR_NM" ).append("\n"); 
		query.append("                                ,A.FM_YD_CD" ).append("\n"); 
		query.append("                                ,A.FM_LOC_DT" ).append("\n"); 
		query.append("                                ,A.TO_YD_CD" ).append("\n"); 
		query.append("                                ,A.TO_LOC_DT" ).append("\n"); 
		query.append("                                ,A.REPO_PLN_FB_RSN_CD" ).append("\n"); 
		query.append("                                ,A.REPO_PLN_FB_RMK" ).append("\n"); 
		query.append("                                ,Q.CNTR_QTY" ).append("\n"); 
		query.append("                                ,Q.ONF_HIR_COST_AMT" ).append("\n"); 
		query.append("                                ,A.SO_RQST_DT" ).append("\n"); 
		query.append("                                ,A.SO_ISS_FLG" ).append("\n"); 
		query.append("                                ,A.NON_SO_ISS_FLG" ).append("\n"); 
		query.append("                                ,B.LCC_CD FM_ECC" ).append("\n"); 
		query.append("                                ,C.LCC_CD TO_ECC" ).append("\n"); 
		query.append("                            FROM" ).append("\n"); 
		query.append("                                EQR_ONF_HIR_EXE_PLN A," ).append("\n"); 
		query.append("                                EQR_ONF_HIR_EXE_PLN_QTY Q," ).append("\n"); 
		query.append("                                MDM_EQ_ORZ_CHT B," ).append("\n"); 
		query.append("                                MDM_EQ_ORZ_CHT C," ).append("\n"); 
		query.append("                                MDM_LOCATION E," ).append("\n"); 
		query.append("                                MDM_LOCATION F" ).append("\n"); 
		query.append("                            WHERE" ).append("\n"); 
		query.append("                                A.REPO_PLN_ID = Q.REPO_PLN_ID" ).append("\n"); 
		query.append("                                AND A.PLN_YRWK = Q.PLN_YRWK" ).append("\n"); 
		query.append("                                AND A.PLN_SEQ  = Q.PLN_SEQ" ).append("\n"); 
		query.append("                                AND A.REF_ID  = Q.REF_ID" ).append("\n"); 
		query.append("                                AND SUBSTR(A.FM_YD_CD, 0, 5) = E.LOC_CD" ).append("\n"); 
		query.append("                                AND E.SCC_CD = B.SCC_CD" ).append("\n"); 
		query.append("                                AND SUBSTR(A.TO_YD_CD, 0, 5) = F.LOC_CD" ).append("\n"); 
		query.append("                                AND F.SCC_CD = C.SCC_CD" ).append("\n"); 
		query.append("                            ) A," ).append("\n"); 
		query.append("                            EQR_ONF_HIR_PLN B," ).append("\n"); 
		query.append("                            EQR_ONF_HIR_PLN_QTY Q" ).append("\n"); 
		query.append("                        WHERE" ).append("\n"); 
		query.append("                            A.REPO_PLN_ID = B.REPO_PLN_ID" ).append("\n"); 
		query.append("                            AND A.PLN_YRWK    = B.PLN_YRWK" ).append("\n"); 
		query.append("                            AND A.PLN_SEQ     = B.PLN_SEQ" ).append("\n"); 
		query.append("                            AND B.REPO_PLN_ID = Q.REPO_PLN_ID" ).append("\n"); 
		query.append("                            AND B.PLN_YRWK    = Q.PLN_YRWK" ).append("\n"); 
		query.append("                            AND B.PLN_SEQ     = Q.PLN_SEQ" ).append("\n"); 
		query.append("                            AND A.ONF_HIR_DIV_CD = B.ONF_HIR_DIV_CD" ).append("\n"); 
		query.append("                            AND B.ONF_HIR_DIV_CD IN ('O', 'F')" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                            --AND   A.CNTR_TPSZ_CD  =  B.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                            AND   (A.FM_ECC = B.ECC_CD OR A.TO_ECC = B.ECC_CD)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                            AND   A.REPO_PLN_ID = @[repoPlanID]" ).append("\n"); 
		query.append("                            --          		AND   A.PLN_YRWK BETWEEN  fromWeek  AND toWeek" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                            -- 추가 내용 : Fm/To 일 경우는 PLN_YRWK으로 조건을 걸고 Fm ETD 경우 FM_ETD_DT로, To ETA일경우 TO_ETA_DT로 조건을 건다." ).append("\n"); 
		query.append("                            #if(${fmtoat} == '3') --Fm ETD" ).append("\n"); 
		query.append("                            	AND  A.FM_LOC_DT  BETWEEN 	(" ).append("\n"); 
		query.append("																SELECT" ).append("\n"); 
		query.append("																	WK_ST_DT" ).append("\n"); 
		query.append("																FROM" ).append("\n"); 
		query.append("																	EQR_WK_PRD" ).append("\n"); 
		query.append("																WHERE" ).append("\n"); 
		query.append("																	PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("															)" ).append("\n"); 
		query.append("															AND" ).append("\n"); 
		query.append("															(" ).append("\n"); 
		query.append("																SELECT" ).append("\n"); 
		query.append("																	WK_END_DT" ).append("\n"); 
		query.append("																FROM" ).append("\n"); 
		query.append("																	EQR_WK_PRD" ).append("\n"); 
		query.append("																WHERE" ).append("\n"); 
		query.append("																	PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("															)" ).append("\n"); 
		query.append("                            #elseif(${fmtoat} =='4') --To ETA" ).append("\n"); 
		query.append("                            	AND  A.TO_LOC_DT  BETWEEN 	(" ).append("\n"); 
		query.append("																SELECT" ).append("\n"); 
		query.append("																	WK_ST_DT" ).append("\n"); 
		query.append("																FROM" ).append("\n"); 
		query.append("																	EQR_WK_PRD" ).append("\n"); 
		query.append("																WHERE" ).append("\n"); 
		query.append("																	PLN_YR||PLN_WK = @[fromWeek]" ).append("\n"); 
		query.append("															)" ).append("\n"); 
		query.append("															AND" ).append("\n"); 
		query.append("															(" ).append("\n"); 
		query.append("																SELECT" ).append("\n"); 
		query.append("																	WK_END_DT" ).append("\n"); 
		query.append("																FROM" ).append("\n"); 
		query.append("																	EQR_WK_PRD" ).append("\n"); 
		query.append("																WHERE" ).append("\n"); 
		query.append("																	PLN_YR||PLN_WK = @[toWeek]" ).append("\n"); 
		query.append("															)" ).append("\n"); 
		query.append("                            #else  -- Fm/To" ).append("\n"); 
		query.append("                            	AND  A.PLN_YRWK BETWEEN @[fromWeek] AND @[toWeek]" ).append("\n"); 
		query.append("                            #end" ).append("\n"); 
		query.append("                            -- user location" ).append("\n"); 
		query.append("                            #if(${userECC} != ${userECC})" ).append("\n"); 
		query.append("								AND (" ).append("\n"); 
		query.append("										A.FM_ECC IN ( ${userLocWhere} )" ).append("\n"); 
		query.append("									OR" ).append("\n"); 
		query.append("										A.TO_ECC IN ( ${userLocWhere} )" ).append("\n"); 
		query.append("									)" ).append("\n"); 
		query.append("							#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                            -- fmtoat.equals('3'): Fm ETD , fmtoat.equals('4'): To ETA" ).append("\n"); 
		query.append("                            -- IF(fmtoat 1  &&  fromStatus != '' )        		 AND (A.FM_ECC IN  frLocWhere  OR A.TO_ECC IN  frLocWhere )" ).append("\n"); 
		query.append("                            #if((${fmtoat} == '1' || ${fmtoat} == '3' || ${fmtoat} == '4') && ${fromStatus} != '')" ).append("\n"); 
		query.append("								AND (" ).append("\n"); 
		query.append("										A.FM_ECC IN ( ${frLocWhere} )" ).append("\n"); 
		query.append("									OR" ).append("\n"); 
		query.append("										A.TO_ECC IN ( ${frLocWhere} )" ).append("\n"); 
		query.append("									)" ).append("\n"); 
		query.append("							#end" ).append("\n"); 
		query.append("                            #if(${tpsz} != '' && ${tpsztype} != '')" ).append("\n"); 
		query.append("								AND Q.CNTR_TPSZ_CD IN ( ${tpszWhere} )" ).append("\n"); 
		query.append("							#end" ).append("\n"); 
		query.append("                            #if(${itemname} != '')" ).append("\n"); 
		query.append("								AND B.ONF_HIR_DIV_CD IN ( ${itemnameWhere} )" ).append("\n"); 
		query.append("							#end" ).append("\n"); 
		query.append("                            #if(${sosend} != '')" ).append("\n"); 
		query.append("								AND (" ).append("\n"); 
		query.append("										A.SO_ISS_FLG = @[sosend]" ).append("\n"); 
		query.append("									OR" ).append("\n"); 
		query.append("										A.NON_SO_ISS_FLG = @[sosend]" ).append("\n"); 
		query.append("									)" ).append("\n"); 
		query.append("							#end" ).append("\n"); 
		query.append("                            #if(${reason} != '')" ).append("\n"); 
		query.append("								AND A.REPO_PLN_FB_RSN_CD IN ( ${reasonWhere} )" ).append("\n"); 
		query.append("							#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                        ) INNER" ).append("\n"); 
		query.append("                    WHERE" ).append("\n"); 
		query.append("                        INNER.REPO_PLN_ID = OUTER.REPO_PLN_ID" ).append("\n"); 
		query.append("                        AND   INNER.REF_ID		= OUTER.REF_ID" ).append("\n"); 
		query.append("                        AND   INNER.PLN_YRWK 	= OUTER.PLN_YRWK" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("                AND SUBSTR(OUTER.FM_YD_CD, 0, 5) = E.LOC_CD" ).append("\n"); 
		query.append("		AND E.SCC_CD                     = B.SCC_CD" ).append("\n"); 
		query.append("                AND SUBSTR(OUTER.TO_YD_CD, 0, 5) = F.LOC_CD" ).append("\n"); 
		query.append("                AND F.SCC_CD                     = C.SCC_CD" ).append("\n"); 
		query.append("            GROUP BY" ).append("\n"); 
		query.append("                OUTER.PLN_YRWK" ).append("\n"); 
		query.append("                ,OUTER.PLN_SEQ" ).append("\n"); 
		query.append("                ,OUTER.CO_CD" ).append("\n"); 
		query.append("                ,OUTER.SO_IF_DIV_CD" ).append("\n"); 
		query.append("                --        	    ,B.VNDR_ABBR_NM" ).append("\n"); 
		query.append("                ,OUTER.FM_YD_CD" ).append("\n"); 
		query.append("                ,OUTER.FM_DT" ).append("\n"); 
		query.append("                ,OUTER.TO_YD_CD" ).append("\n"); 
		query.append("                ,OUTER.TO_DT" ).append("\n"); 
		query.append("                ,OUTER.REF_ID" ).append("\n"); 
		query.append("                ,OUTER.REPO_PLN_ID" ).append("\n"); 
		query.append("                ,B.ECC_CD    -- SORT에 사용될 SCC의 해당 FM ECC 정보" ).append("\n"); 
		query.append("                ,C.ECC_CD    -- SORT에 사용될 SCC의 해당 TO ECC 정보" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        ) A," ).append("\n"); 
		query.append("        (" ).append("\n"); 
		query.append("            SELECT" ).append("\n"); 
		query.append("                1 NUM" ).append("\n"); 
		query.append("                , '' NAME" ).append("\n"); 
		query.append("            FROM" ).append("\n"); 
		query.append("                DUAL" ).append("\n"); 
		query.append("            UNION" ).append("\n"); 
		query.append("            SELECT" ).append("\n"); 
		query.append("                2 NUM" ).append("\n"); 
		query.append("                , 'TOTAL' NAME" ).append("\n"); 
		query.append("            FROM" ).append("\n"); 
		query.append("                DUAL" ).append("\n"); 
		query.append("            UNION" ).append("\n"); 
		query.append("            SELECT" ).append("\n"); 
		query.append("                3 NUM" ).append("\n"); 
		query.append("                , 'GRAND TOTAL' NAME" ).append("\n"); 
		query.append("            FROM" ).append("\n"); 
		query.append("                DUAL" ).append("\n"); 
		query.append("        ) B" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    GROUP BY" ).append("\n"); 
		query.append("        DECODE(B.NUM, 1, A.PLN_YRWK, 2, A.PLN_YRWK||' TTL', 3, 'TOTAL')" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.COMPANY,  2, '', 3, '')" ).append("\n"); 
		query.append("        ,A.DIVISION" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.ITEM ,  2, '', 3, '')" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.LEASE,  2, '', 3, '')" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.LSR,  2, '', 3, '')" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.FRLOC,  2, '', 3, '')" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.ETD  ,  2, NULL, 3, NULL)" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.TOLOC,  2, '', 3, '')" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.ETA  ,  2, NULL, 3, NULL)" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.SOSEND  ,  2, NULL, 3, NULL)" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.NOSOSEND  ,  2, NULL, 3, NULL)" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.REASON,  2, '', 3, '')" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.REASONREMARK,  2, '', 3, '')" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.CNTRNO,  2, '', 3, '')" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.REFNO,  2, '', 3, '')" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.REPO_PLN_ID,  2, '', 3, '')" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.PLN_SEQ,  2, '', 3, '')" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.VNDR_ABBR_NM,  2, '', 3, '')" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.VNDR_CNT_CD,  2, '', 3, '')" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.VNDR_SEQ,  2, '', 3, '')" ).append("\n"); 
		query.append("        ,A.SORTNUM    	-- HIDDEN" ).append("\n"); 
		query.append("        ,B.NUM           	-- HIDDEN" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, DECODE(A.ITEM, 'O', A.TO_ECC, A.FM_ECC),  2, '', 3, '')" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.FM_ECC,  2, '', 3, '')" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.TO_ECC,  2, '', 3, '')" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.TRSPNO_P,  2, '', 3, '')" ).append("\n"); 
		query.append("        ,DECODE(B.NUM, 1, A.TRSPNO_D,  2, '', 3, '')" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("GROUP BY" ).append("\n"); 
		query.append("    PLN_YRWK" ).append("\n"); 
		query.append("    ,COMPANY" ).append("\n"); 
		query.append("    ,DIVISION" ).append("\n"); 
		query.append("    ,ITEM" ).append("\n"); 
		query.append("    ,LEASE      -- LEASE TERM" ).append("\n"); 
		query.append("    ,LSR 		-- VENDOR ABBR NM" ).append("\n"); 
		query.append("    ,FRLOC" ).append("\n"); 
		query.append("    ,ETD" ).append("\n"); 
		query.append("    ,TOLOC" ).append("\n"); 
		query.append("    ,ETA" ).append("\n"); 
		query.append("    ,SOSEND" ).append("\n"); 
		query.append("    ,NOSOSEND" ).append("\n"); 
		query.append("    ,REASON" ).append("\n"); 
		query.append("    ,REASONREMARK" ).append("\n"); 
		query.append("    ,CNTRNO" ).append("\n"); 
		query.append("    ,REFNO" ).append("\n"); 
		query.append("    ,REPO_PLN_ID 	-- HIDDEN" ).append("\n"); 
		query.append("    ,PLN_SEQ        -- HIDDEN" ).append("\n"); 
		query.append("    ,VNDR_ABBR_NM	-- HIDDEN" ).append("\n"); 
		query.append("    ,VNDR_CNT_CD	-- HIDDEN" ).append("\n"); 
		query.append("    ,VNDR_SEQ 		-- HIDDEN" ).append("\n"); 
		query.append("    ,SORTNUM      	-- HIDDEN, PLAN(1), Execution(2), SO(3)를 구분" ).append("\n"); 
		query.append("    ,NUM          	-- HIDDEN, NORMAL ROW(1), SUB TOTAL(2), GRAND TOTAL(3) 구분" ).append("\n"); 
		query.append("    ,SORT1" ).append("\n"); 
		query.append("    ,FM_ECC" ).append("\n"); 
		query.append("    ,TO_ECC" ).append("\n"); 
		query.append("    ,TRSPNO_P     -- TRSP P CD COUNT" ).append("\n"); 
		query.append("    ,TRSPNO_D     -- TRSP D CD COUNT" ).append("\n"); 
		query.append("ORDER BY" ).append("\n"); 
		query.append("	  PLN_SEQ" ).append("\n"); 
		query.append("    , DECODE(LEASE, NULL, 'B', 'A')" ).append("\n"); 
		query.append("    , 1" ).append("\n"); 
		query.append("    , 4" ).append("\n"); 
		query.append("    , SORT1" ).append("\n"); 
		query.append("    , REFNO||SORTNUM" ).append("\n"); 
		query.append(")" ).append("\n"); 

	}
}