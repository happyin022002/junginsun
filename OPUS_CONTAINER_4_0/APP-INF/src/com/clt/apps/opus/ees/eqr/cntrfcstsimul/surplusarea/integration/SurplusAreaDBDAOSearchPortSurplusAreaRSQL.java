/*=========================================================
*Copyright(c) 2014 CyberLogitec
*@FileName : SurplusAreaDBDAOSearchPortSurplusAreaRSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2014.02.05
*@LastModifier : 
*@LastVersion : 1.0
* 2014.02.05 
* 1.0 Creation
=========================================================*/
package com.clt.apps.opus.ees.eqr.cntrfcstsimul.surplusarea.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.clt.framework.support.db.ISQLTemplate;

/**
 *
 * @author 
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class SurplusAreaDBDAOSearchPortSurplusAreaRSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * Surplus Area - Port 데이터를 조회함
	  * </pre>
	  */
	public SurplusAreaDBDAOSearchPortSurplusAreaRSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("to_yrwk",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("curr_yrwk",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("chk_im",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("fm_yrwk",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("subconti",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("chk_is",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("ofc_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("chk_id",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.clt.apps.opus.ees.eqr.cntrfcstsimul.surplusarea.integration").append("\n"); 
		query.append("FileName : SurplusAreaDBDAOSearchPortSurplusAreaRSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("WITH  " ).append("\n"); 
		query.append("VVD_PORT AS (" ).append("\n"); 
		query.append("    SELECT " ).append("\n"); 
		query.append("    --X.COST_YRWK, X.VPS_PORT_CD, X.YD_CD " ).append("\n"); 
		query.append("	X.COST_YRWK, X.SCC_CD" ).append("\n"); 
		query.append("    FROM (" ).append("\n"); 
		query.append("        SELECT " ).append("\n"); 
		query.append("        DISTINCT" ).append("\n"); 
		query.append("        R.REP_TRD_CD TRD_CD, D.SUB_TRD_CD, R.RLANE_CD, D.VSL_SLAN_DIR_CD, D.FM_CONTI_CD" ).append("\n"); 
		query.append("        , P.COST_YR||P.COST_WK AS COST_YRWK, P.SLS_FM_DT, P.SLS_TO_DT" ).append("\n"); 
		query.append("        , V.VSL_CD, V.SKD_VOY_NO, V.SKD_DIR_CD, V.SLAN_CD, V.CLPT_SEQ, V.VPS_PORT_CD, V.YD_CD, T.SCC_CD" ).append("\n"); 
		query.append("        , MAX(DECODE(V.TURN_PORT_FLG,'Y',V.VPS_ETD_DT,'')) OVER (PARTITION BY V.SLAN_CD,V.VSL_CD,V.SKD_VOY_NO,V.SKD_DIR_CD) MAX_VPS_ETD_DT" ).append("\n"); 
		query.append("        FROM MDM_REV_LANE R, MDM_DTL_REV_LANE D, MDM_LOCATION L, COA_MON_VVD C, COA_WK_PRD P, VSK_VSL_PORT_SKD V, MDM_VSL_SVC_LANE M, MDM_LOCATION T" ).append("\n"); 
		query.append("        WHERE  1=1" ).append("\n"); 
		query.append("        AND R.RLANE_CD = D.RLANE_CD" ).append("\n"); 
		query.append("        AND NVL(R.DELT_FLG,'N') <> 'Y' " ).append("\n"); 
		query.append("        AND NVL(D.DELT_FLG,'N') <> 'Y' " ).append("\n"); 
		query.append("        AND D.IOC_CD = CASE WHEN SUBSTR(R.REP_TRD_CD,1,1)='I' THEN 'I' ELSE 'O' END" ).append("\n"); 
		query.append("    #if(${lane} != '')        -- Lane 콤보 조건 일 경우" ).append("\n"); 
		query.append("        AND (" ).append("\n"); 
		query.append("        #foreach($key IN ${arr_lane})" ).append("\n"); 
		query.append("            #if($velocityCount > 1 )" ).append("\n"); 
		query.append("                OR" ).append("\n"); 
		query.append("            #end " ).append("\n"); 
		query.append("                (" ).append("\n"); 
		query.append("                        D.RLANE_CD LIKE SUBSTR('$key',6,3)||'%'  -- LANE" ).append("\n"); 
		query.append("                    AND D.SUB_TRD_CD = SUBSTR('$key',4,2)        -- SUB TRADE" ).append("\n"); 
		query.append("                    AND R.REP_TRD_CD = SUBSTR('$key',1,3)        -- TRADE" ).append("\n"); 
		query.append("                )" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("            " ).append("\n"); 
		query.append("    #elseif(${subtrade} != '') -- S.Trade 콤보 조건 일 경우" ).append("\n"); 
		query.append("        AND (" ).append("\n"); 
		query.append("        #foreach($key IN ${arr_subtrade})" ).append("\n"); 
		query.append("            #if($velocityCount > 1 )" ).append("\n"); 
		query.append("                OR" ).append("\n"); 
		query.append("            #end " ).append("\n"); 
		query.append("                (" ).append("\n"); 
		query.append("                        D.SUB_TRD_CD = SUBSTR('$key',4,2)    -- SUB TRADE" ).append("\n"); 
		query.append("                    AND R.REP_TRD_CD = SUBSTR('$key',1,3)    -- TRADE" ).append("\n"); 
		query.append("                )" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    #elseif(${trade} != '')   -- Trade 콤보 조건 일 경우" ).append("\n"); 
		query.append("        AND (" ).append("\n"); 
		query.append("              R.REP_TRD_CD IN (" ).append("\n"); 
		query.append("        #foreach($key IN ${arr_trade})" ).append("\n"); 
		query.append("            #if($velocityCount == 1 )" ).append("\n"); 
		query.append("                                '$key'" ).append("\n"); 
		query.append("            #else" ).append("\n"); 
		query.append("                               ,'$key'" ).append("\n"); 
		query.append("            #end                " ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                                      )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        AND D.FM_CONTI_CD  = L.CONTI_CD" ).append("\n"); 
		query.append("        AND NVL(L.DELT_FLG,'N') <> 'Y'" ).append("\n"); 
		query.append("        AND R.REP_TRD_CD = C.TRD_CD" ).append("\n"); 
		query.append("        AND D.SUB_TRD_CD = C.SUB_TRD_CD" ).append("\n"); 
		query.append("        AND C.RLANE_CD = R.RLANE_CD" ).append("\n"); 
		query.append("        AND SUBSTR(C.SLS_YRMON,1,4) = P.COST_YR" ).append("\n"); 
		query.append("        AND C.COST_WK = P.COST_WK" ).append("\n"); 
		query.append("        AND C.DIR_CD = D.VSL_SLAN_DIR_CD" ).append("\n"); 
		query.append("        AND P.COST_YR||P.COST_WK BETWEEN @[fm_yrwk] AND @[to_yrwk]" ).append("\n"); 
		query.append("        AND V.SLAN_CD =  M.VSL_SLAN_CD" ).append("\n"); 
		query.append("        AND V.SLAN_CD = C.SLAN_CD" ).append("\n"); 
		query.append("        AND V.VSL_CD				=  C.VSL_CD" ).append("\n"); 
		query.append("        AND V.SKD_VOY_NO			=  C.SKD_VOY_NO" ).append("\n"); 
		query.append("        AND V.SKD_DIR_CD			=  C.DIR_CD" ).append("\n"); 
		query.append("        AND V.TURN_PORT_IND_CD		!= 'D'" ).append("\n"); 
		query.append("        AND V.TURN_PORT_IND_CD		!= 'V'" ).append("\n"); 
		query.append("        AND M.VSL_TP_CD			    =  'C'" ).append("\n"); 
		query.append("        AND L.LOC_CD                = V.VPS_PORT_CD" ).append("\n"); 
		query.append("        AND V.VPS_PORT_CD           = T.LOC_CD" ).append("\n"); 
		query.append("		AND DECODE(SUBSTR(R.REP_TRD_CD,1,1),'I','X',T.CONTI_CD) <> 'A'" ).append("\n"); 
		query.append("        AND NVL(T.DELT_FLG,'N') <> 'Y'" ).append("\n"); 
		query.append("	#if(${subconti} != '')" ).append("\n"); 
		query.append("        AND DECODE(SUBSTR(R.REP_TRD_CD,1,1),'I',T.SCONTI_CD,'X') = DECODE(SUBSTR(R.REP_TRD_CD,1,1),'I',@[subconti],'X')" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("        GROUP BY R.REP_TRD_CD, D.SUB_TRD_CD, R.RLANE_CD, D.VSL_SLAN_DIR_CD, D.FM_CONTI_CD" ).append("\n"); 
		query.append("                 , P.COST_YR, P.COST_WK, P.SLS_FM_DT, P.SLS_TO_DT" ).append("\n"); 
		query.append("                 , V.VSL_CD, V.SKD_VOY_NO, V.SKD_DIR_CD, V.SLAN_CD, V.CLPT_SEQ, V.VPS_PORT_CD, V.YD_CD, T.SCC_CD" ).append("\n"); 
		query.append("                 , DECODE(V.TURN_PORT_FLG,'Y',V.VPS_ETD_DT,'')" ).append("\n"); 
		query.append("    ) X, MDM_LOCATION A" ).append("\n"); 
		query.append("	WHERE 1=1" ).append("\n"); 
		query.append("	AND A.LOC_CD = X.VPS_PORT_CD" ).append("\n"); 
		query.append("	AND NVL(A.DELT_FLG,'N') <> 'Y'" ).append("\n"); 
		query.append("    GROUP BY X.COST_YRWK, X.SCC_CD--, X.VPS_PORT_CD, X.YD_CD " ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("," ).append("\n"); 
		query.append("SIM_TP_CD_DATA AS (" ).append("\n"); 
		query.append("    SELECT 1 GRP_CD, TO_NUMBER('') SORT, 'INN' CODE, 'Initial Inventory' NAME   FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 1 GRP_CD, 1             SORT, 'IV'  CODE, 'Inventory' NAME           FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 1 GRP_CD, 2             SORT, 'IM'  CODE, 'Inventory Damage' NAME    FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 1 GRP_CD, 3             SORT, 'ID'  CODE, 'Inventory Disposal' NAME  FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 1 GRP_CD, 4             SORT, 'IS'  CODE, 'Inventory SOC' NAME       FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 2 GRP_CD, 0             SORT, 'INP' CODE, 'Inventory Plus (-)' NAME  FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 2 GRP_CD, 1             SORT, 'MG'  CODE, 'MG' NAME       	        FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 2 GRP_CD, 2             SORT, 'RD'  CODE, 'MT In via VD' NAME        FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 2 GRP_CD, 3             SORT, 'RI'  CODE, 'MT In via EN/TN' NAME     FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 2 GRP_CD, 4             SORT, 'OH'  CODE, 'On-hire' NAME             FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 2 GRP_CD, 5             SORT, 'DI'  CODE, 'Domestic In' NAME         FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 2 GRP_CD, 6             SORT, 'SI'  CODE, 'Sublease In' NAME         FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 3 GRP_CD, 0             SORT, 'INM' CODE, 'Inventory Minus (-)' NAME FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 3 GRP_CD, 1             SORT, 'OP'  CODE, 'OP' NAME                  FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 3 GRP_CD, 2             SORT, 'RL'  CODE, 'MT Out via VL' NAME       FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 3 GRP_CD, 3             SORT, 'RO'  CODE, 'MT Out via EN/TN' NAME    FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 3 GRP_CD, 4             SORT, 'PL'  CODE, 'MT Loading Plan' NAME     FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 3 GRP_CD, 5             SORT, 'OT'  CODE, 'Off-hire / Disposal' NAME FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 3 GRP_CD, 6             SORT, 'DO'  CODE, 'Domestic Out' NAME        FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 3 GRP_CD, 7             SORT, 'SO'  CODE, 'Sublease Out' NAME        FROM DUAL UNION ALL" ).append("\n"); 
		query.append("    SELECT 4 GRP_CD, 1             SORT, 'FBB' CODE, 'Final Balance' NAME       FROM DUAL" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("," ).append("\n"); 
		query.append("SIM_SS_DATA AS (" ).append("\n"); 
		query.append("    SELECT " ).append("\n"); 
		query.append("        S.GRP_CD, S.SORT, S.CODE, S.NAME, Q.LCC_CD, Q.SCC_CD" ).append("\n"); 
		query.append("        , Q.CNTR_TPSZ_CD, Q.FCAST_YRWK" ).append("\n"); 
		query.append("        , SUM(NVL(DECODE(Q.INVT_SIM_TP_CD,S.CODE,Q.QTY,0),0)) QTY" ).append("\n"); 
		query.append("        , MAX(NVL(DECODE(Q.INVT_SIM_TP_CD,S.CODE,Q.MNL_INP,''),'')) MNL_INP" ).append("\n"); 
		query.append("    FROM SIM_TP_CD_DATA S, (" ).append("\n"); 
		query.append("        SELECT" ).append("\n"); 
		query.append("            B.LCC_CD, B.SCC_CD" ).append("\n"); 
		query.append("            , Q.INVT_SIM_TP_CD" ).append("\n"); 
		query.append("            , Q.CNTR_TPSZ_CD, Q.FCAST_YRWK" ).append("\n"); 
		query.append("            , SUM(NVL(Q.CNTR_QTY,0)) QTY" ).append("\n"); 
		query.append("            , MAX(Q.MNL_INP) MNL_INP" ).append("\n"); 
		query.append("        FROM (" ).append("\n"); 
		query.append("            SELECT" ).append("\n"); 
		query.append("            Q.YD_CD, " ).append("\n"); 
		query.append("			CASE" ).append("\n"); 
		query.append("			WHEN Q.FCAST_YRWK >= @[curr_yrwk]" ).append("\n"); 
		query.append("			THEN " ).append("\n"); 
		query.append("		    	CASE" ).append("\n"); 
		query.append("			    WHEN SQ.FCAST_YRWK IS NOT NULL " ).append("\n"); 
		query.append("			    THEN Q.INVT_SIM_TP_CD" ).append("\n"); 
		query.append("			    ELSE DECODE(Q.INVT_SIM_TP_CD,'OF','OP','OP','XX','MF','MG','MG','XX',Q.INVT_SIM_TP_CD)" ).append("\n"); 
		query.append("			    END" ).append("\n"); 
		query.append("			ELSE Q.INVT_SIM_TP_CD" ).append("\n"); 
		query.append("			END INVT_SIM_TP_CD ,  " ).append("\n"); 
		query.append("			Q.CNTR_TPSZ_CD, Q.FCAST_YRWK, NVL(SQ.CNTR_QTY,Q.CNTR_QTY) CNTR_QTY" ).append("\n"); 
		query.append("            , CASE WHEN SQ.FCAST_YRWK IS NOT NULL THEN 'Y' ELSE '' END MNL_INP" ).append("\n"); 
		query.append("            FROM EQR_CTRL_INVT_SIM_DTL D, EQR_CTRL_INVT_SIM_DTL_QTY Q--, VVD_PORT V" ).append("\n"); 
		query.append("               , ( SELECT Q.FCAST_YRWK, Q.PORT_CD, Q.INVT_SIM_TP_CD, Q.CNTR_TPSZ_CD, Q.CNTR_QTY, Q.TMP_SAV_FLG, Q.CRE_DT, Q.UPD_DT  " ).append("\n"); 
		query.append("                   FROM EQR_CTRL_INVT_PORT_SIM S, EQR_CTRL_INVT_PORT_SIM_QTY Q" ).append("\n"); 
		query.append("                   WHERE 1=1" ).append("\n"); 
		query.append("                   AND S.FCAST_YRWK = Q.FCAST_YRWK" ).append("\n"); 
		query.append("                   AND S.PORT_CD = Q.PORT_CD" ).append("\n"); 
		query.append("                   AND S.INVT_SIM_TP_CD = Q.INVT_SIM_TP_CD " ).append("\n"); 
		query.append("                   AND Q.FCAST_YRWK >= @[curr_yrwk]" ).append("\n"); 
		query.append("                   AND Q.UPD_DT >= (SELECT TO_DATE(W.WK_ST_DT,'YYYYMMDD')+(1+5/24) BAT_MND FROM EQR_WK_PRD W WHERE W.PLN_YR = SUBSTR(@[curr_yrwk],1,4) AND W.PLN_WK = SUBSTR(@[curr_yrwk],5))" ).append("\n"); 
		query.append("                 ) SQ" ).append("\n"); 
		query.append("            WHERE 1=1" ).append("\n"); 
		query.append("            AND D.FCAST_YRWK = Q.FCAST_YRWK" ).append("\n"); 
		query.append("            AND D.YD_CD = Q.YD_CD" ).append("\n"); 
		query.append("            AND D.INVT_SIM_TP_CD = Q.INVT_SIM_TP_CD" ).append("\n"); 
		query.append("            AND D.FCAST_YRWK = Q.FCAST_YRWK" ).append("\n"); 
		query.append("            AND Q.FCAST_YRWK BETWEEN @[fm_yrwk] AND @[to_yrwk]" ).append("\n"); 
		query.append("            AND Q.FCAST_YRWK = SQ.FCAST_YRWK(+)" ).append("\n"); 
		query.append("            AND SUBSTR(Q.YD_CD,1,5) = SQ.PORT_CD(+)" ).append("\n"); 
		query.append("            AND Q.INVT_SIM_TP_CD = SQ.INVT_SIM_TP_CD(+)" ).append("\n"); 
		query.append("            AND Q.CNTR_TPSZ_CD = SQ.CNTR_TPSZ_CD(+)" ).append("\n"); 
		query.append("            --AND Q.FCAST_YRWK = V.COST_YRWK" ).append("\n"); 
		query.append("            --AND Q.YD_CD = V.YD_CD" ).append("\n"); 
		query.append("            GROUP BY Q.YD_CD, Q.INVT_SIM_TP_CD, Q.CNTR_TPSZ_CD, Q.FCAST_YRWK, NVL(SQ.CNTR_QTY,Q.CNTR_QTY), SQ.FCAST_YRWK" ).append("\n"); 
		query.append("            UNION ALL" ).append("\n"); 
		query.append("            SELECT " ).append("\n"); 
		query.append("            Q.PORT_CD, " ).append("\n"); 
		query.append("			Q.INVT_SIM_TP_CD INVT_SIM_TP_CD , " ).append("\n"); 
		query.append("			Q.CNTR_TPSZ_CD, Q.FCAST_YRWK, Q.CNTR_QTY" ).append("\n"); 
		query.append("            , 'Y' MNL_INP" ).append("\n"); 
		query.append("            FROM EQR_CTRL_INVT_PORT_SIM S, EQR_CTRL_INVT_PORT_SIM_QTY Q--, VVD_PORT V" ).append("\n"); 
		query.append("            WHERE 1=1" ).append("\n"); 
		query.append("            AND S.FCAST_YRWK = Q.FCAST_YRWK" ).append("\n"); 
		query.append("            AND S.PORT_CD = Q.PORT_CD" ).append("\n"); 
		query.append("            AND S.INVT_SIM_TP_CD = Q.INVT_SIM_TP_CD " ).append("\n"); 
		query.append("            AND S.FCAST_YRWK = Q.FCAST_YRWK" ).append("\n"); 
		query.append("            AND Q.FCAST_YRWK >= @[curr_yrwk]" ).append("\n"); 
		query.append("            AND Q.UPD_DT >= (SELECT TO_DATE(W.WK_ST_DT,'YYYYMMDD')+(1+5/24) BAT_MND FROM EQR_WK_PRD W WHERE TO_CHAR(SYSDATE,'YYYYMMDD') BETWEEN W.WK_ST_DT AND W.WK_END_DT)" ).append("\n"); 
		query.append("            AND NOT EXISTS (" ).append("\n"); 
		query.append("                SELECT 'X' " ).append("\n"); 
		query.append("                FROM EQR_CTRL_INVT_SIM_DTL_QTY X" ).append("\n"); 
		query.append("                WHERE 1=1" ).append("\n"); 
		query.append("                AND X.FCAST_YRWK = Q.FCAST_YRWK" ).append("\n"); 
		query.append("                AND SUBSTR(X.YD_CD,1,5) = Q.PORT_CD" ).append("\n"); 
		query.append("                AND X.INVT_SIM_TP_CD = Q.INVT_SIM_TP_CD" ).append("\n"); 
		query.append("                AND X.CNTR_TPSZ_CD = Q.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("            --AND Q.FCAST_YRWK = V.COST_YRWK" ).append("\n"); 
		query.append("            --AND Q.PORT_CD = V.VPS_PORT_CD" ).append("\n"); 
		query.append("            GROUP BY Q.PORT_CD, Q.INVT_SIM_TP_CD, Q.CNTR_TPSZ_CD, Q.FCAST_YRWK, Q.CNTR_QTY" ).append("\n"); 
		query.append("        ) Q, MDM_LOCATION A, MDM_EQ_ORZ_CHT B, VVD_PORT V" ).append("\n"); 
		query.append("        WHERE 1=1" ).append("\n"); 
		query.append("            AND A.LOC_CD = SUBSTR(Q.YD_CD,1,5)" ).append("\n"); 
		query.append("            AND A.SCC_CD = B.SCC_CD" ).append("\n"); 
		query.append("            AND NVL(A.DELT_FLG,'N') <> 'Y'" ).append("\n"); 
		query.append("            AND NVL(B.DELT_FLG,'N') <> 'Y'" ).append("\n"); 
		query.append("			AND Q.FCAST_YRWK = V.COST_YRWK" ).append("\n"); 
		query.append("			AND A.SCC_CD = V.SCC_CD" ).append("\n"); 
		query.append("        GROUP BY B.LCC_CD, B.SCC_CD, Q.INVT_SIM_TP_CD, Q.CNTR_TPSZ_CD, Q.FCAST_YRWK " ).append("\n"); 
		query.append("    ) Q" ).append("\n"); 
		query.append("    WHERE 1=1" ).append("\n"); 
		query.append("    #if( ${level_cd} == '2' ) --LEVEL_CD 2 RHQ" ).append("\n"); 
		query.append("        AND Q.LCC_CD IN (" ).append("\n"); 
		query.append("            SELECT LCC_CD" ).append("\n"); 
		query.append("            FROM MDM_EQ_ORZ_CHT                         " ).append("\n"); 
		query.append("            WHERE SCC_CD IN (" ).append("\n"); 
		query.append("                SELECT SCC_CD" ).append("\n"); 
		query.append("                FROM MDM_LOCATION" ).append("\n"); 
		query.append("                WHERE LOC_CD IN (SELECT DISTINCT LOC_CD" ).append("\n"); 
		query.append("                                 FROM MDM_ORGANIZATION" ).append("\n"); 
		query.append("                                 WHERE NVL(DELT_FLG,'N') <> 'Y'" ).append("\n"); 
		query.append("                                 CONNECT BY NOCYCLE PRIOR OFC_CD = PRNT_OFC_CD" ).append("\n"); 
		query.append("                                 START WITH OFC_CD = (SELECT DISTINCT AR_HD_QTR_OFC_CD FROM MDM_ORGANIZATION WHERE OFC_CD = @[ofc_cd]))" ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    #elseif( ${level_cd} == '5' ) --LEVEL_CD 5 ATLSC/PHXSC" ).append("\n"); 
		query.append("        AND Q.LCC_CD IN (" ).append("\n"); 
		query.append("            SELECT LCC_CD" ).append("\n"); 
		query.append("            FROM MDM_EQ_ORZ_CHT                         " ).append("\n"); 
		query.append("            WHERE SCC_CD IN (" ).append("\n"); 
		query.append("                SELECT SCC_CD" ).append("\n"); 
		query.append("                FROM MDM_LOCATION" ).append("\n"); 
		query.append("                WHERE LOC_CD IN (SELECT DISTINCT LOC_CD" ).append("\n"); 
		query.append("                                 FROM MDM_ORGANIZATION" ).append("\n"); 
		query.append("                                 WHERE NVL(DELT_FLG,'N') <> 'Y'" ).append("\n"); 
		query.append("                                 CONNECT BY NOCYCLE PRIOR OFC_CD = PRNT_OFC_CD" ).append("\n"); 
		query.append("                                 START WITH OFC_CD = (SELECT DISTINCT AR_HD_QTR_OFC_CD FROM MDM_ORGANIZATION WHERE OFC_CD = @[ofc_cd] AND OFC_CD IN ('ATLSC','PHXSC')))" ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    #elseif( ${level_cd} == '6' ) --LEVEL_CD 6 Office" ).append("\n"); 
		query.append("        AND Q.LCC_CD IN (" ).append("\n"); 
		query.append("            SELECT LCC_CD" ).append("\n"); 
		query.append("            FROM MDM_EQ_ORZ_CHT                         " ).append("\n"); 
		query.append("            WHERE SCC_CD IN (" ).append("\n"); 
		query.append("                SELECT SCC_CD" ).append("\n"); 
		query.append("                FROM MDM_LOCATION" ).append("\n"); 
		query.append("                WHERE LOC_CD IN (SELECT LOC_CD FROM MDM_ORGANIZATION WHERE NVL(DELT_FLG,'N') <> 'Y' AND OFC_CD = @[ofc_cd])" ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("	#elseif( ${level_cd} == '3' || ${level_cd} == '4' ) --LEVEL_CD 3,4 Office" ).append("\n"); 
		query.append("		AND 1=2 --조회안되야함" ).append("\n"); 
		query.append("    #end    " ).append("\n"); 
		query.append("    GROUP BY S.GRP_CD, S.SORT, S.CODE, S.NAME, Q.LCC_CD, Q.SCC_CD, Q.CNTR_TPSZ_CD, Q.FCAST_YRWK" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("SELECT " ).append("\n"); 
		query.append("A.LCC_CD, A.SCC_CD, A.CODE, A.NAME, A.GRP_CD, A.SORT" ).append("\n"); 
		query.append("#foreach( $key in ${arrweek1}) -- 과거 3주" ).append("\n"); 
		query.append(", DECODE(NVL(A.D2_MINUS_YN_$key,1),'Y',-1,1) * NVL(A.D2_$key,0) D2_$key" ).append("\n"); 
		query.append(", DECODE(NVL(A.D4_MINUS_YN_$key,1),'Y',-1,1) * NVL(A.D4_$key,0) D4_$key" ).append("\n"); 
		query.append(", DECODE(NVL(A.D5_MINUS_YN_$key,1),'Y',-1,1) * NVL(A.D5_$key,0) D5_$key" ).append("\n"); 
		query.append(", DECODE(NVL(A.D7_MINUS_YN_$key,1),'Y',-1,1) * NVL(A.D7_$key,0) D7_$key" ).append("\n"); 
		query.append(", DECODE(NVL(A.R2_MINUS_YN_$key,1),'Y',-1,1) * NVL(A.R2_$key,0) R2_$key" ).append("\n"); 
		query.append(", DECODE(NVL(A.R5_MINUS_YN_$key,1),'Y',-1,1) * NVL(A.R5_$key,0) R5_$key" ).append("\n"); 
		query.append(", DECODE(NVL(A.R9_MINUS_YN_$key,1),'Y',-1,1) * NVL(A.R9_$key,0) R9_$key" ).append("\n"); 
		query.append(", DECODE(NVL(A.O2_MINUS_YN_$key,1),'Y',-1,1) * NVL(A.O2_$key,0) O2_$key" ).append("\n"); 
		query.append(", DECODE(NVL(A.O4_MINUS_YN_$key,1),'Y',-1,1) * NVL(A.O4_$key,0) O4_$key" ).append("\n"); 
		query.append(", DECODE(NVL(A.S2_MINUS_YN_$key,1),'Y',-1,1) * NVL(A.S2_$key,0) S2_$key" ).append("\n"); 
		query.append(", DECODE(NVL(A.S4_MINUS_YN_$key,1),'Y',-1,1) * NVL(A.S4_$key,0) S4_$key" ).append("\n"); 
		query.append(", DECODE(NVL(A.F2_MINUS_YN_$key,1),'Y',-1,1) * NVL(A.F2_$key,0) F2_$key" ).append("\n"); 
		query.append(", DECODE(NVL(A.F4_MINUS_YN_$key,1),'Y',-1,1) * NVL(A.F4_$key,0) F4_$key" ).append("\n"); 
		query.append(", DECODE(NVL(A.F5_MINUS_YN_$key,1),'Y',-1,1) * NVL(A.F5_$key,0) F5_$key" ).append("\n"); 
		query.append(", DECODE(NVL(A.A2_MINUS_YN_$key,1),'Y',-1,1) * NVL(A.A2_$key,0) A2_$key" ).append("\n"); 
		query.append(", DECODE(NVL(A.A4_MINUS_YN_$key,1),'Y',-1,1) * NVL(A.A4_$key,0) A4_$key" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#foreach( $key in ${arrweek2}) -- 현재,미래3주 " ).append("\n"); 
		query.append(", CASE WHEN NVL(A.D2_B_$key,'N')<>'Y' AND A.CODE IN ('INP','RD','RI','OH','DI','SI','INM','OP','RL','RO','OT','DO','SO','FBB') " ).append("\n"); 
		query.append("       THEN CEIL((" ).append("\n"); 
		query.append("    #foreach( $key in ${arrweek1})" ).append("\n"); 
		query.append("        #if($velocityCount > 1 )" ).append("\n"); 
		query.append("                         +" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                     A.D2_$key" ).append("\n"); 
		query.append("    #end    " ).append("\n"); 
		query.append("                                 )/3) ELSE A.D2_$key END D2_$key" ).append("\n"); 
		query.append(", CASE WHEN NVL(A.D4_B_$key,'N')<>'Y' AND A.CODE IN ('INP','RD','RI','OH','DI','SI','INM','OP','RL','RO','OT','DO','SO','FBB')" ).append("\n"); 
		query.append("       THEN CEIL((" ).append("\n"); 
		query.append("    #foreach( $key in ${arrweek1})" ).append("\n"); 
		query.append("        #if($velocityCount > 1 )" ).append("\n"); 
		query.append("                         +" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                     A.D4_$key" ).append("\n"); 
		query.append("    #end    " ).append("\n"); 
		query.append("                                 )/3) ELSE A.D4_$key END D4_$key" ).append("\n"); 
		query.append(", CASE WHEN NVL(A.D5_B_$key,'N')<>'Y' AND A.CODE IN ('INP','RD','RI','OH','DI','SI','INM','OP','RL','RO','OT','DO','SO','FBB')" ).append("\n"); 
		query.append("       THEN CEIL((" ).append("\n"); 
		query.append("    #foreach( $key in ${arrweek1})" ).append("\n"); 
		query.append("        #if($velocityCount > 1 )" ).append("\n"); 
		query.append("                         +" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                     A.D5_$key" ).append("\n"); 
		query.append("    #end    " ).append("\n"); 
		query.append("                                 )/3) ELSE A.D5_$key END D5_$key" ).append("\n"); 
		query.append(", CASE WHEN NVL(A.D7_B_$key,'N')<>'Y' AND A.CODE IN ('INP','RD','RI','OH','DI','SI','INM','OP','RL','RO','OT','DO','SO','FBB')" ).append("\n"); 
		query.append("       THEN CEIL((" ).append("\n"); 
		query.append("    #foreach( $key in ${arrweek1})" ).append("\n"); 
		query.append("        #if($velocityCount > 1 )" ).append("\n"); 
		query.append("                         +" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                     A.D7_$key" ).append("\n"); 
		query.append("    #end    " ).append("\n"); 
		query.append("                                 )/3) ELSE A.D7_$key END D7_$key" ).append("\n"); 
		query.append(", CASE WHEN NVL(A.R2_B_$key,'N')<>'Y' AND A.CODE IN ('INP','RD','RI','OH','DI','SI','INM','OP','RL','RO','OT','DO','SO','FBB')" ).append("\n"); 
		query.append("       THEN CEIL((" ).append("\n"); 
		query.append("    #foreach( $key in ${arrweek1})" ).append("\n"); 
		query.append("        #if($velocityCount > 1 )" ).append("\n"); 
		query.append("                         +" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                     A.R2_$key" ).append("\n"); 
		query.append("    #end    " ).append("\n"); 
		query.append("                                 )/3) ELSE A.R2_$key END R2_$key" ).append("\n"); 
		query.append(", CASE WHEN NVL(A.R5_B_$key,'N')<>'Y' AND A.CODE IN ('INP','RD','RI','OH','DI','SI','INM','OP','RL','RO','OT','DO','SO','FBB')" ).append("\n"); 
		query.append("       THEN CEIL((" ).append("\n"); 
		query.append("    #foreach( $key in ${arrweek1})" ).append("\n"); 
		query.append("        #if($velocityCount > 1 )" ).append("\n"); 
		query.append("                         +" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                     A.R5_$key" ).append("\n"); 
		query.append("    #end    " ).append("\n"); 
		query.append("                                 )/3) ELSE A.R5_$key END R5_$key" ).append("\n"); 
		query.append(", CASE WHEN NVL(A.R9_B_$key,'N')<>'Y' AND A.CODE IN ('INP','RD','RI','OH','DI','SI','INM','OP','RL','RO','OT','DO','SO','FBB')" ).append("\n"); 
		query.append("       THEN CEIL((" ).append("\n"); 
		query.append("    #foreach( $key in ${arrweek1})" ).append("\n"); 
		query.append("        #if($velocityCount > 1 )" ).append("\n"); 
		query.append("                         +" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                     A.R9_$key" ).append("\n"); 
		query.append("    #end    " ).append("\n"); 
		query.append("                                 )/3) ELSE A.R9_$key END R9_$key" ).append("\n"); 
		query.append(", CASE WHEN NVL(A.O2_B_$key,'N')<>'Y' AND A.CODE IN ('INP','RD','RI','OH','DI','SI','INM','OP','RL','RO','OT','DO','SO','FBB')" ).append("\n"); 
		query.append("       THEN CEIL((" ).append("\n"); 
		query.append("    #foreach( $key in ${arrweek1})" ).append("\n"); 
		query.append("        #if($velocityCount > 1 )" ).append("\n"); 
		query.append("                         +" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                     A.O2_$key" ).append("\n"); 
		query.append("    #end    " ).append("\n"); 
		query.append("                                 )/3) ELSE A.O2_$key END O2_$key" ).append("\n"); 
		query.append(", CASE WHEN NVL(A.O4_B_$key,'N')<>'Y' AND A.CODE IN ('INP','RD','RI','OH','DI','SI','INM','OP','RL','RO','OT','DO','SO','FBB')" ).append("\n"); 
		query.append("       THEN CEIL((" ).append("\n"); 
		query.append("    #foreach( $key in ${arrweek1})" ).append("\n"); 
		query.append("        #if($velocityCount > 1 )" ).append("\n"); 
		query.append("                         +" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                     A.O4_$key" ).append("\n"); 
		query.append("    #end    " ).append("\n"); 
		query.append("                                 )/3) ELSE A.O4_$key END O4_$key" ).append("\n"); 
		query.append(", CASE WHEN NVL(A.S2_B_$key,'N')<>'Y' AND A.CODE IN ('INP','RD','RI','OH','DI','SI','INM','OP','RL','RO','OT','DO','SO','FBB')" ).append("\n"); 
		query.append("       THEN CEIL((" ).append("\n"); 
		query.append("    #foreach( $key in ${arrweek1})" ).append("\n"); 
		query.append("        #if($velocityCount > 1 )" ).append("\n"); 
		query.append("                         +" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                     A.S2_$key" ).append("\n"); 
		query.append("    #end    " ).append("\n"); 
		query.append("                                 )/3) ELSE A.S2_$key END S2_$key" ).append("\n"); 
		query.append(", CASE WHEN NVL(A.S4_B_$key,'N')<>'Y' AND A.CODE IN ('INP','RD','RI','OH','DI','SI','INM','OP','RL','RO','OT','DO','SO','FBB')" ).append("\n"); 
		query.append("       THEN CEIL((" ).append("\n"); 
		query.append("    #foreach( $key in ${arrweek1})" ).append("\n"); 
		query.append("        #if($velocityCount > 1 )" ).append("\n"); 
		query.append("                         +" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                     A.S4_$key" ).append("\n"); 
		query.append("    #end    " ).append("\n"); 
		query.append("                                 )/3) ELSE A.S4_$key END S4_$key" ).append("\n"); 
		query.append(", CASE WHEN NVL(A.F2_B_$key,'N')<>'Y' AND A.CODE IN ('INP','RD','RI','OH','DI','SI','INM','OP','RL','RO','OT','DO','SO','FBB')" ).append("\n"); 
		query.append("       THEN CEIL((" ).append("\n"); 
		query.append("    #foreach( $key in ${arrweek1})" ).append("\n"); 
		query.append("        #if($velocityCount > 1 )" ).append("\n"); 
		query.append("                         +" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                     A.F2_$key" ).append("\n"); 
		query.append("    #end    " ).append("\n"); 
		query.append("                                 )/3) ELSE A.F2_$key END F2_$key" ).append("\n"); 
		query.append(", CASE WHEN NVL(A.F4_B_$key,'N')<>'Y' AND A.CODE IN ('INP','RD','RI','OH','DI','SI','INM','OP','RL','RO','OT','DO','SO','FBB')" ).append("\n"); 
		query.append("       THEN CEIL((" ).append("\n"); 
		query.append("    #foreach( $key in ${arrweek1})" ).append("\n"); 
		query.append("        #if($velocityCount > 1 )" ).append("\n"); 
		query.append("                         +" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                     A.F4_$key" ).append("\n"); 
		query.append("    #end    " ).append("\n"); 
		query.append("                                 )/3) ELSE A.F4_$key END F4_$key" ).append("\n"); 
		query.append(", CASE WHEN NVL(A.F5_B_$key,'N')<>'Y' AND A.CODE IN ('INP','RD','RI','OH','DI','SI','INM','OP','RL','RO','OT','DO','SO','FBB')" ).append("\n"); 
		query.append("       THEN CEIL((" ).append("\n"); 
		query.append("    #foreach( $key in ${arrweek1})" ).append("\n"); 
		query.append("        #if($velocityCount > 1 )" ).append("\n"); 
		query.append("                         +" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                     A.F5_$key" ).append("\n"); 
		query.append("    #end    " ).append("\n"); 
		query.append("                                 )/3) ELSE A.F5_$key END F5_$key" ).append("\n"); 
		query.append(", CASE WHEN NVL(A.A2_B_$key,'N')<>'Y' AND A.CODE IN ('INP','RD','RI','OH','DI','SI','INM','OP','RL','RO','OT','DO','SO','FBB')" ).append("\n"); 
		query.append("       THEN CEIL((" ).append("\n"); 
		query.append("    #foreach( $key in ${arrweek1})" ).append("\n"); 
		query.append("        #if($velocityCount > 1 )" ).append("\n"); 
		query.append("                         +" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                     A.A2_$key" ).append("\n"); 
		query.append("    #end    " ).append("\n"); 
		query.append("                                 )/3) ELSE A.A2_$key END A2_$key" ).append("\n"); 
		query.append(", CASE WHEN NVL(A.A4_B_$key,'N')<>'Y' AND A.CODE IN ('INP','RD','RI','OH','DI','SI','INM','OP','RL','RO','OT','DO','SO','FBB')" ).append("\n"); 
		query.append("       THEN CEIL((" ).append("\n"); 
		query.append("    #foreach( $key in ${arrweek1})" ).append("\n"); 
		query.append("        #if($velocityCount > 1 )" ).append("\n"); 
		query.append("                         +" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                     A.A4_$key" ).append("\n"); 
		query.append("    #end    " ).append("\n"); 
		query.append("                                 )/3) ELSE A.A4_$key END A4_$key" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#foreach( $key in ${arrweek2}) -- 현재,미래3주 " ).append("\n"); 
		query.append(", A.D2_B_$key, A.D4_B_$key, A.D5_B_$key, A.D7_B_$key, A.R2_B_$key" ).append("\n"); 
		query.append(", A.R5_B_$key, A.R9_B_$key, A.O2_B_$key, A.O4_B_$key, A.S2_B_$key" ).append("\n"); 
		query.append(", A.S4_B_$key, A.F2_B_$key, A.F4_B_$key, A.F5_B_$key, A.A2_B_$key" ).append("\n"); 
		query.append(", A.A4_B_$key" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("FROM (" ).append("\n"); 
		query.append("SELECT" ).append("\n"); 
		query.append("A.LCC_CD, A.SCC_CD, A.CODE, A.NAME, A.GRP_CD, A.SORT" ).append("\n"); 
		query.append("#foreach( $key in ${arrweek}) -- 전체 7주" ).append("\n"); 
		query.append(", MAX(ABS(A.D2_$key)) D2_$key, MAX(ABS(A.D4_$key)) D4_$key, MAX(ABS(A.D5_$key)) D5_$key, MAX(ABS(A.D7_$key)) D7_$key, MAX(ABS(A.R2_$key)) R2_$key, MAX(ABS(A.R5_$key)) R5_$key, MAX(ABS(A.R9_$key)) R9_$key" ).append("\n"); 
		query.append(", MAX(ABS(A.O2_$key)) O2_$key, MAX(ABS(A.O4_$key)) O4_$key, MAX(ABS(A.S2_$key)) S2_$key, MAX(ABS(A.S4_$key)) S4_$key, MAX(ABS(A.F2_$key)) F2_$key, MAX(ABS(A.F4_$key)) F4_$key, MAX(ABS(A.F5_$key)) F5_$key" ).append("\n"); 
		query.append(", MAX(ABS(A.A2_$key)) A2_$key, MAX(ABS(A.A4_$key)) A4_$key" ).append("\n"); 
		query.append(", CASE WHEN A.CODE='FBB' AND MAX(ABS(A.D2_$key)) <> MAX(A.D2_$key) THEN 'Y' ELSE '' END D2_MINUS_YN_$key" ).append("\n"); 
		query.append(", CASE WHEN A.CODE='FBB' AND MAX(ABS(A.D4_$key)) <> MAX(A.D4_$key) THEN 'Y' ELSE '' END D4_MINUS_YN_$key" ).append("\n"); 
		query.append(", CASE WHEN A.CODE='FBB' AND MAX(ABS(A.D5_$key)) <> MAX(A.D5_$key) THEN 'Y' ELSE '' END D5_MINUS_YN_$key" ).append("\n"); 
		query.append(", CASE WHEN A.CODE='FBB' AND MAX(ABS(A.D7_$key)) <> MAX(A.D7_$key) THEN 'Y' ELSE '' END D7_MINUS_YN_$key" ).append("\n"); 
		query.append(", CASE WHEN A.CODE='FBB' AND MAX(ABS(A.R2_$key)) <> MAX(A.R2_$key) THEN 'Y' ELSE '' END R2_MINUS_YN_$key" ).append("\n"); 
		query.append(", CASE WHEN A.CODE='FBB' AND MAX(ABS(A.R5_$key)) <> MAX(A.R5_$key) THEN 'Y' ELSE '' END R5_MINUS_YN_$key" ).append("\n"); 
		query.append(", CASE WHEN A.CODE='FBB' AND MAX(ABS(A.R9_$key)) <> MAX(A.R9_$key) THEN 'Y' ELSE '' END R9_MINUS_YN_$key" ).append("\n"); 
		query.append(", CASE WHEN A.CODE='FBB' AND MAX(ABS(A.O2_$key)) <> MAX(A.O2_$key) THEN 'Y' ELSE '' END O2_MINUS_YN_$key" ).append("\n"); 
		query.append(", CASE WHEN A.CODE='FBB' AND MAX(ABS(A.O4_$key)) <> MAX(A.O4_$key) THEN 'Y' ELSE '' END O4_MINUS_YN_$key" ).append("\n"); 
		query.append(", CASE WHEN A.CODE='FBB' AND MAX(ABS(A.S2_$key)) <> MAX(A.S2_$key) THEN 'Y' ELSE '' END S2_MINUS_YN_$key" ).append("\n"); 
		query.append(", CASE WHEN A.CODE='FBB' AND MAX(ABS(A.S4_$key)) <> MAX(A.S4_$key) THEN 'Y' ELSE '' END S4_MINUS_YN_$key" ).append("\n"); 
		query.append(", CASE WHEN A.CODE='FBB' AND MAX(ABS(A.F2_$key)) <> MAX(A.F2_$key) THEN 'Y' ELSE '' END F2_MINUS_YN_$key" ).append("\n"); 
		query.append(", CASE WHEN A.CODE='FBB' AND MAX(ABS(A.F4_$key)) <> MAX(A.F4_$key) THEN 'Y' ELSE '' END F4_MINUS_YN_$key" ).append("\n"); 
		query.append(", CASE WHEN A.CODE='FBB' AND MAX(ABS(A.F5_$key)) <> MAX(A.F5_$key) THEN 'Y' ELSE '' END F5_MINUS_YN_$key" ).append("\n"); 
		query.append(", CASE WHEN A.CODE='FBB' AND MAX(ABS(A.A2_$key)) <> MAX(A.A2_$key) THEN 'Y' ELSE '' END A2_MINUS_YN_$key" ).append("\n"); 
		query.append(", CASE WHEN A.CODE='FBB' AND MAX(ABS(A.A4_$key)) <> MAX(A.A4_$key) THEN 'Y' ELSE '' END A4_MINUS_YN_$key" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#foreach( $key in ${arrweek2}) -- 현재,미래3주 " ).append("\n"); 
		query.append(", MAX(A.D2_B_$key) D2_B_$key, MAX(A.D4_B_$key) D4_B_$key, MAX(A.D5_B_$key) D5_B_$key, MAX(A.D7_B_$key) D7_B_$key, MAX(A.R2_B_$key) R2_B_$key" ).append("\n"); 
		query.append(", MAX(A.R5_B_$key) R5_B_$key, MAX(A.R9_B_$key) R9_B_$key, MAX(A.O2_B_$key) O2_B_$key, MAX(A.O4_B_$key) O4_B_$key, MAX(A.S2_B_$key) S2_B_$key" ).append("\n"); 
		query.append(", MAX(A.S4_B_$key) S4_B_$key, MAX(A.F2_B_$key) F2_B_$key, MAX(A.F4_B_$key) F4_B_$key, MAX(A.F5_B_$key) F5_B_$key, MAX(A.A2_B_$key) A2_B_$key" ).append("\n"); 
		query.append(", MAX(A.A4_B_$key) A4_B_$key" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("FROM (" ).append("\n"); 
		query.append("SELECT" ).append("\n"); 
		query.append("R.LCC_CD, R.SCC_CD" ).append("\n"); 
		query.append(", R.CODE, R.NAME, R.GRP_CD, R.SORT" ).append("\n"); 
		query.append("#foreach($key in ${arrweek2}) -- 현재,미래3주" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='D2$key' THEN MAX(NVL(R.MNL_INP,'')) ELSE '' END D2_B_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='D4$key' THEN MAX(NVL(R.MNL_INP,'')) ELSE '' END D4_B_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='D5$key' THEN MAX(NVL(R.MNL_INP,'')) ELSE '' END D5_B_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='D7$key' THEN MAX(NVL(R.MNL_INP,'')) ELSE '' END D7_B_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='R2$key' THEN MAX(NVL(R.MNL_INP,'')) ELSE '' END R2_B_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='R5$key' THEN MAX(NVL(R.MNL_INP,'')) ELSE '' END R5_B_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='R9$key' THEN MAX(NVL(R.MNL_INP,'')) ELSE '' END R9_B_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='O2$key' THEN MAX(NVL(R.MNL_INP,'')) ELSE '' END O2_B_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='O4$key' THEN MAX(NVL(R.MNL_INP,'')) ELSE '' END O4_B_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='S2$key' THEN MAX(NVL(R.MNL_INP,'')) ELSE '' END S2_B_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='S4$key' THEN MAX(NVL(R.MNL_INP,'')) ELSE '' END S4_B_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='F2$key' THEN MAX(NVL(R.MNL_INP,'')) ELSE '' END F2_B_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='F4$key' THEN MAX(NVL(R.MNL_INP,'')) ELSE '' END F4_B_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='F5$key' THEN MAX(NVL(R.MNL_INP,'')) ELSE '' END F5_B_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='A2$key' THEN MAX(NVL(R.MNL_INP,'')) ELSE '' END A2_B_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='A4$key' THEN MAX(NVL(R.MNL_INP,'')) ELSE '' END A4_B_$key" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#foreach($key in ${arrweek})-- 전체 7주" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='D2$key' THEN SUM(NVL(R.QTY,0)) ELSE 0 END D2_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='D4$key' THEN SUM(NVL(R.QTY,0)) ELSE 0 END D4_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='D5$key' THEN SUM(NVL(R.QTY,0)) ELSE 0 END D5_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='D7$key' THEN SUM(NVL(R.QTY,0)) ELSE 0 END D7_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='R2$key' THEN SUM(NVL(R.QTY,0)) ELSE 0 END R2_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='R5$key' THEN SUM(NVL(R.QTY,0)) ELSE 0 END R5_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='R9$key' THEN SUM(NVL(R.QTY,0)) ELSE 0 END R9_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='O2$key' THEN SUM(NVL(R.QTY,0)) ELSE 0 END O2_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='O4$key' THEN SUM(NVL(R.QTY,0)) ELSE 0 END O4_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='S2$key' THEN SUM(NVL(R.QTY,0)) ELSE 0 END S2_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='S4$key' THEN SUM(NVL(R.QTY,0)) ELSE 0 END S4_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='F2$key' THEN SUM(NVL(R.QTY,0)) ELSE 0 END F2_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='F4$key' THEN SUM(NVL(R.QTY,0)) ELSE 0 END F4_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='F5$key' THEN SUM(NVL(R.QTY,0)) ELSE 0 END F5_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='A2$key' THEN SUM(NVL(R.QTY,0)) ELSE 0 END A2_$key" ).append("\n"); 
		query.append(",CASE WHEN R.CNTR_TPSZ_CD||R.FCAST_YRWK='A4$key' THEN SUM(NVL(R.QTY,0)) ELSE 0 END A4_$key" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("FROM (" ).append("\n"); 
		query.append("    SELECT " ).append("\n"); 
		query.append("        X.LCC_CD, X.SCC_CD, X.CODE, X.NAME, X.GRP_CD, X.SORT, X.FCAST_YRWK, X.CNTR_TPSZ_CD, X.QTY, X.MNL_INP" ).append("\n"); 
		query.append("    FROM (" ).append("\n"); 
		query.append("            SELECT" ).append("\n"); 
		query.append("                A.LCC_CD, A.SCC_CD, " ).append("\n"); 
		query.append("                'INN' CODE, 'Initial Inventory' NAME, A.GRP_CD, TO_NUMBER('') SORT" ).append("\n"); 
		query.append("                , A.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                , A.FCAST_YRWK" ).append("\n"); 
		query.append("                , CASE " ).append("\n"); 
		query.append("                  WHEN A.FCAST_YRWK <= (SELECT MAX(W.PLN_YR||W.PLN_WK) CURR_WK FROM EQR_WK_PRD W WHERE TO_CHAR(SYSDATE,'YYYYMMDD') BETWEEN W.WK_ST_DT AND W.WK_END_DT) " ).append("\n"); 
		query.append("                  THEN SUM(NVL(DECODE(A.CODE,'IV',A.QTY,0),0)-(NVL(DECODE(A.CODE,'IM',DECODE(UPPER(@[chk_im]),'N',A.QTY,0),0),0) + NVL(DECODE(A.CODE,'ID',DECODE(UPPER(@[chk_id]),'N',A.QTY,0),0),0) + NVL(DECODE(A.CODE,'IS',DECODE(UPPER(@[chk_is]),'N',A.QTY,0),0),0)))" ).append("\n"); 
		query.append("                  ELSE TO_NUMBER('')" ).append("\n"); 
		query.append("                  END QTY" ).append("\n"); 
		query.append("                , '' MNL_INP" ).append("\n"); 
		query.append("            FROM SIM_SS_DATA A" ).append("\n"); 
		query.append("            WHERE 1=1" ).append("\n"); 
		query.append("            AND A.GRP_CD IN ('1')" ).append("\n"); 
		query.append("            GROUP BY A.LCC_CD, A.SCC_CD, A.GRP_CD, A.CNTR_TPSZ_CD, A.FCAST_YRWK" ).append("\n"); 
		query.append("            UNION ALL" ).append("\n"); 
		query.append("            SELECT" ).append("\n"); 
		query.append("                A.LCC_CD, A.SCC_CD," ).append("\n"); 
		query.append("                CASE" ).append("\n"); 
		query.append("                WHEN A.GRP_CD = '2' AND GROUPING(A.GRP_CD)='0' AND GROUPING(A.CODE)='1'" ).append("\n"); 
		query.append("                THEN 'INP'" ).append("\n"); 
		query.append("                WHEN A.GRP_CD = '3' AND GROUPING(A.GRP_CD)='0' AND GROUPING(A.CODE)='1'" ).append("\n"); 
		query.append("                THEN 'INM'" ).append("\n"); 
		query.append("                ELSE A.CODE" ).append("\n"); 
		query.append("                END CODE,        " ).append("\n"); 
		query.append("                CASE" ).append("\n"); 
		query.append("                WHEN A.GRP_CD = '2' AND GROUPING(A.GRP_CD)='0' AND GROUPING(A.CODE)='1'" ).append("\n"); 
		query.append("                THEN 'Inventory Plus (-)'" ).append("\n"); 
		query.append("                WHEN A.GRP_CD = '3' AND GROUPING(A.GRP_CD)='0' AND GROUPING(A.CODE)='1'" ).append("\n"); 
		query.append("                THEN 'Inventory Minus (-)'" ).append("\n"); 
		query.append("                ELSE A.NAME" ).append("\n"); 
		query.append("                END NAME," ).append("\n"); 
		query.append("                A.GRP_CD," ).append("\n"); 
		query.append("                CASE" ).append("\n"); 
		query.append("                WHEN A.GRP_CD = '2' AND GROUPING(A.GRP_CD)='0' AND GROUPING(A.CODE)='1'" ).append("\n"); 
		query.append("                THEN 0" ).append("\n"); 
		query.append("                WHEN A.GRP_CD = '3' AND GROUPING(A.GRP_CD)='0' AND GROUPING(A.CODE)='1'" ).append("\n"); 
		query.append("                THEN 0" ).append("\n"); 
		query.append("                ELSE A.SORT" ).append("\n"); 
		query.append("                END SORT" ).append("\n"); 
		query.append("                , A.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                , A.FCAST_YRWK" ).append("\n"); 
		query.append("                , SUM(NVL(A.QTY,0)) QTY" ).append("\n"); 
		query.append("                , CASE" ).append("\n"); 
		query.append("                WHEN A.GRP_CD IN ('2','3') AND A.SORT >= '0' AND A.CODE NOT IN ('PL')" ).append("\n"); 
		query.append("                THEN MAX(A.MNL_INP)" ).append("\n"); 
		query.append("                ELSE ''" ).append("\n"); 
		query.append("                END MNL_INP" ).append("\n"); 
		query.append("            FROM SIM_SS_DATA A" ).append("\n"); 
		query.append("            WHERE 1=1" ).append("\n"); 
		query.append("            AND A.GRP_CD IN ('2','3')" ).append("\n"); 
		query.append("            AND A.CODE NOT IN ('PL')" ).append("\n"); 
		query.append("            GROUP BY GROUPING SETS ((A.LCC_CD, A.SCC_CD, A.GRP_CD, A.SORT, A.CODE, A.NAME, A.CNTR_TPSZ_CD, A.FCAST_YRWK),(A.LCC_CD, A.SCC_CD, A.GRP_CD, A.CNTR_TPSZ_CD, A.FCAST_YRWK))" ).append("\n"); 
		query.append("            UNION ALL" ).append("\n"); 
		query.append("            SELECT" ).append("\n"); 
		query.append("                A.LCC_CD, A.SCC_CD," ).append("\n"); 
		query.append("                'FBB' CODE, 'Final Balance' NAME, 4 GRP_CD, TO_NUMBER('') SORT" ).append("\n"); 
		query.append("                , A.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                , A.FCAST_YRWK" ).append("\n"); 
		query.append("                , CASE " ).append("\n"); 
		query.append("                  WHEN A.FCAST_YRWK <= (SELECT MAX(W.PLN_YR||W.PLN_WK) CURR_WK FROM EQR_WK_PRD W WHERE TO_CHAR(SYSDATE,'YYYYMMDD') BETWEEN W.WK_ST_DT AND W.WK_END_DT) " ).append("\n"); 
		query.append("                  THEN SUM(NVL(DECODE(A.CODE,'IV',A.QTY,0),0)-(NVL(DECODE(A.CODE,'IM',DECODE(UPPER(@[chk_im]),'N',A.QTY,0),0),0) + NVL(DECODE(A.CODE,'ID',DECODE(UPPER(@[chk_id]),'N',A.QTY,0),0),0) + NVL(DECODE(A.CODE,'IS',DECODE(UPPER(@[chk_is]),'N',A.QTY,0),0),0)))" ).append("\n"); 
		query.append("                  ELSE 0" ).append("\n"); 
		query.append("                  END +" ).append("\n"); 
		query.append("				  SUM(NVL(DECODE(A.GRP_CD,'2',A.QTY,0),0)) - SUM(NVL(DECODE(A.GRP_CD,'3',A.QTY,0),0)) QTY" ).append("\n"); 
		query.append("                , '' MNL_INP" ).append("\n"); 
		query.append("            FROM SIM_SS_DATA A" ).append("\n"); 
		query.append("            WHERE 1=1" ).append("\n"); 
		query.append("            AND A.GRP_CD IN ('1','2','3')" ).append("\n"); 
		query.append("            AND A.CODE NOT IN ('PL')" ).append("\n"); 
		query.append("            GROUP BY A.LCC_CD, A.SCC_CD, A.CNTR_TPSZ_CD, A.FCAST_YRWK" ).append("\n"); 
		query.append("            UNION ALL" ).append("\n"); 
		query.append("            SELECT" ).append("\n"); 
		query.append("                A.LCC_CD, A.SCC_CD," ).append("\n"); 
		query.append("                'PL' CODE, 'MT Loading Plan' NAME, 3 GRP_CD, 4 SORT" ).append("\n"); 
		query.append("                , A.CNTR_TPSZ_CD, A.FCAST_YRWK" ).append("\n"); 
		query.append("                , SUM(B.QTY) QTY" ).append("\n"); 
		query.append("                , '' MNL_INP" ).append("\n"); 
		query.append("            FROM (SELECT DISTINCT A.LCC_CD, A.SCC_CD, A.CNTR_TPSZ_CD, A.FCAST_YRWK FROM SIM_SS_DATA A WHERE A.GRP_CD IN ('3')) A, " ).append("\n"); 
		query.append("            (" ).append("\n"); 
		query.append("                SELECT" ).append("\n"); 
		query.append("                    B.LCC_CD, B.SCC_CD" ).append("\n"); 
		query.append("                    , PLN.CNTR_TPSZ_CD, PLN.WK" ).append("\n"); 
		query.append("                    , SUM(NVL(PLN.CNTR_QTY,0)) QTY" ).append("\n"); 
		query.append("                FROM (" ).append("\n"); 
		query.append("                    SELECT " ).append("\n"); 
		query.append("                        LODG.POL_YD_CD" ).append("\n"); 
		query.append("                        ,LODG.VSL_CD" ).append("\n"); 
		query.append("                        ,LODG.SKD_VOY_NO" ).append("\n"); 
		query.append("                        ,LODG.SKD_DIR_CD" ).append("\n"); 
		query.append("                        ,W.PLN_YR||W.PLN_WK WK" ).append("\n"); 
		query.append("                        ,QTY.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                        ,QTY.CNTR_QTY" ).append("\n"); 
		query.append("                    FROM EQR_CTRL_MTY_LODG_PLN LODG, VSK_VSL_PORT_SKD V, EQR_WK_PRD W, EQR_CTRL_MTY_DCHG_PLN DCHG, EQR_CTRL_MTY_DCHG_PLN_QTY QTY" ).append("\n"); 
		query.append("                    WHERE 1=1" ).append("\n"); 
		query.append("                        AND LODG.VSL_CD = DCHG.VSL_CD" ).append("\n"); 
		query.append("                        AND LODG.SKD_VOY_NO = DCHG.SKD_VOY_NO" ).append("\n"); 
		query.append("                        AND LODG.SKD_DIR_CD = DCHG.SKD_DIR_CD" ).append("\n"); 
		query.append("                        AND LODG.POL_YD_CD = DCHG.POL_YD_CD" ).append("\n"); 
		query.append("                        AND LODG.VSL_CD = V.VSL_CD" ).append("\n"); 
		query.append("                        AND LODG.SKD_VOY_NO = V.SKD_VOY_NO" ).append("\n"); 
		query.append("                        AND LODG.SKD_DIR_CD = V.SKD_DIR_CD" ).append("\n"); 
		query.append("                        AND LODG.POL_YD_CD = V.YD_CD" ).append("\n"); 
		query.append("                        AND W.PLN_YR = TO_CHAR(V.VPS_ETA_DT,'YYYY')" ).append("\n"); 
		query.append("                        AND V.VPS_ETA_DT BETWEEN TO_DATE(W.WK_ST_DT,'YYYYMMDD') AND TO_DATE(W.WK_END_DT,'YYYYMMDD')" ).append("\n"); 
		query.append("                        AND DCHG.VSL_CD = QTY.VSL_CD" ).append("\n"); 
		query.append("                        AND DCHG.SKD_VOY_NO = QTY.SKD_VOY_NO" ).append("\n"); 
		query.append("                        AND DCHG.SKD_DIR_CD = QTY.SKD_DIR_CD" ).append("\n"); 
		query.append("                        AND DCHG.POL_YD_CD = QTY.POL_YD_CD" ).append("\n"); 
		query.append("                        AND DCHG.POD_YD_CD = QTY.POD_YD_CD" ).append("\n"); 
		query.append("                ) PLN, MDM_YARD Y, MDM_LOCATION A, MDM_EQ_ORZ_CHT B" ).append("\n"); 
		query.append("                WHERE 1=1" ).append("\n"); 
		query.append("                    AND PLN.POL_YD_CD = Y.YD_CD" ).append("\n"); 
		query.append("                    AND Y.LOC_CD = A.LOC_CD" ).append("\n"); 
		query.append("                    AND A.SCC_CD = B.SCC_CD" ).append("\n"); 
		query.append("                    AND NVL(Y.DELT_FLG,'N') <> 'Y'" ).append("\n"); 
		query.append("                    AND NVL(A.DELT_FLG,'N') <> 'Y'" ).append("\n"); 
		query.append("                    AND NVL(B.DELT_FLG,'N') <> 'Y'" ).append("\n"); 
		query.append("                    GROUP BY B.LCC_CD, B.SCC_CD, PLN.CNTR_TPSZ_CD, PLN.WK" ).append("\n"); 
		query.append("            ) B" ).append("\n"); 
		query.append("            WHERE 1=1" ).append("\n"); 
		query.append("                AND A.LCC_CD = B.LCC_CD(+)" ).append("\n"); 
		query.append("                AND A.SCC_CD = B.SCC_CD(+)" ).append("\n"); 
		query.append("                AND A.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD(+)" ).append("\n"); 
		query.append("                AND A.FCAST_YRWK = B.WK(+)" ).append("\n"); 
		query.append("                GROUP BY A.LCC_CD, A.SCC_CD, A.CNTR_TPSZ_CD, A.FCAST_YRWK" ).append("\n"); 
		query.append("        ) X" ).append("\n"); 
		query.append("    WHERE 1=1" ).append("\n"); 
		query.append(") R" ).append("\n"); 
		query.append("GROUP BY R.LCC_CD, R.SCC_CD, R.GRP_CD, R.SORT, R.CODE, R.NAME, R.CNTR_TPSZ_CD, R.FCAST_YRWK" ).append("\n"); 
		query.append(") A" ).append("\n"); 
		query.append("GROUP BY A.LCC_CD, A.SCC_CD, A.CODE, A.NAME, A.GRP_CD, A.SORT" ).append("\n"); 
		query.append(") A" ).append("\n"); 
		query.append("ORDER BY A.LCC_CD, A.SCC_CD, A.GRP_CD, A.SORT" ).append("\n"); 

	}
}