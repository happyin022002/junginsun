<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContainerMovementFinderDBDAOSearchOSCARCtmCycNoRSQL">
			<desc><![CDATA[SearchOSCARCtmCycNo]]></desc>
			<sql><![CDATA[
SELECT OSCAR_FLAG,
    BKG_NO,
    CNTR_NO,
    CNMV_CYC_NO,
    CNMV_STS_CD,
    CNMV_EVNT_DT,
    MAX_CNMV_CYC_NO,
    VPS_ETD_DT,
    TRUNK_VVD
FROM(
select 
        'N' OSCAR_FLAG, BKG_NO, CNTR_NO, CNMV_CYC_NO, CNMV_STS_CD, CNMV_EVNT_DT
        , nvl((
                select max(CNMV_CYC_NO) CNMV_CYC_NO
                from 
                (
                    select max(CNMV_CYC_NO) CNMV_CYC_NO from BKG_CONTAINER where 1=1  and CNTR_NO = @[cntr_no] and CNMV_CYC_NO <> 9999
                    union all
                    select max(CNMV_CYC_NO) CNMV_CYC_NO from CTM_BKG_CNTR where 1=1  and CNTR_NO = @[cntr_no] and CNMV_CYC_NO <> 9999
                )
               ),0) MAX_CNMV_CYC_NO
		, (SELECT POL_ETD_DT FROM BKG_BOOKING CB WHERE CB.BKG_NO=BC.BKG_NO ) VPS_ETD_DT
		, (SELECT CBV.VSL_CD||CBV.SKD_VOY_NO||CBV.SKD_DIR_CD AS TRUNK_VVD
           FROM BKG_VVD CBV
           WHERE CBV.BKG_NO=BC.BKG_NO
           AND CBV.VSL_PRE_PST_CD='T'
           AND ROWNUM = 1) TRUNK_VVD
from BKG_CONTAINER BC
where 1=1
and CNTR_NO = @[cntr_no]
UNION
select
        'Y' OSCAR_FLAG, BKG_NO, CNTR_NO, CNMV_CYC_NO, CNMV_STS_CD, CNMV_EVNT_DT
        , nvl((
                select max(CNMV_CYC_NO) CNMV_CYC_NO
                from 
                (
                    select max(CNMV_CYC_NO) CNMV_CYC_NO from BKG_CONTAINER where 1=1  and CNTR_NO = @[cntr_no] and CNMV_CYC_NO <> 9999
                    union all
                    select max(CNMV_CYC_NO) CNMV_CYC_NO from CTM_BKG_CNTR where 1=1  and CNTR_NO = @[cntr_no] and CNMV_CYC_NO <> 9999
                )
               ),0) MAX_CNMV_CYC_NO
		, (SELECT VPS_ETD_DT FROM CTM_BOOKING CB WHERE CB.BKG_NO=CBC.BKG_NO ) VPS_ETD_DT
		, (SELECT CBV.VSL_CD||CBV.SKD_VOY_NO||CBV.SKD_DIR_CD AS TRUNK_VVD
           FROM CTM_BKG_VVD CBV
           WHERE CBV.BKG_NO=CBC.BKG_NO
           AND CBV.VSL_PRE_PST_CD='T'
           AND ROWNUM = 1) TRUNK_VVD
from CTM_BKG_CNTR CBC
where 1=1
and CNTR_NO = @[cntr_no])
ORDER BY VPS_ETD_DT			]]></sql>
			<params>
				<param name="cntr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
