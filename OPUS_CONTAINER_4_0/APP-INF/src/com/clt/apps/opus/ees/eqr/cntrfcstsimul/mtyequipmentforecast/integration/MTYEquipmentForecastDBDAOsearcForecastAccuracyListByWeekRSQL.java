/*=========================================================
*Copyright(c) 2014 CyberLogitec
*@FileName : MTYEquipmentForecastDBDAOsearcForecastAccuracyListByWeekRSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2014.12.16
*@LastModifier : 
*@LastVersion : 1.0
* 2014.12.16 
* 1.0 Creation
=========================================================*/
package com.clt.apps.opus.ees.eqr.cntrfcstsimul.mtyequipmentforecast.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.clt.framework.support.db.ISQLTemplate;

/**
 *
 * @author 
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class MTYEquipmentForecastDBDAOsearcForecastAccuracyListByWeekRSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * MTY Balance Report의 In&Out Bound FCST Data의 정확도를 WEEK별로 조회
	  * 
	  * 2011.06.13 나상보 [CHM-201111555-01] [EQR] R9 코드 생성에 따른 EQR 모듈 보완 작업 
	  * 2013-01-21  CHM-201322369, Location 검색조건 추가,  수석
	  * </pre>
	  */
	public MTYEquipmentForecastDBDAOsearcForecastAccuracyListByWeekRSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("to_week",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("loc_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("fm_week",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("loc_cd_second",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("bound",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.clt.apps.opus.ees.eqr.cntrfcstsimul.mtyequipmentforecast.integration").append("\n"); 
		query.append("FileName : MTYEquipmentForecastDBDAOsearcForecastAccuracyListByWeekRSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("WITH LV_QTY_LIST AS" ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("SELECT A.BOUND" ).append("\n"); 
		query.append("      ,DECODE(GROUPING(A.YRWK),0,A.YRWK,'999999') YRWK" ).append("\n"); 
		query.append("      ,DECODE(GROUPING(A.LOC_CD),0,A.LOC_CD,'ZZZZ9') LOC_CD" ).append("\n"); 
		query.append("      ,A.DP_SEQ" ).append("\n"); 
		query.append("      ,SUM(DECODE(A.DP_SEQ,3,A.TOT_ABS_QTY,A.TOT_QTY)) TOT_QTY" ).append("\n"); 
		query.append("      ,SUM(A.TOT_ABS_QTY) TOT_ABS_QTY      " ).append("\n"); 
		query.append("	  ,DECODE(GROUPING(A.LOC_CD),1,SUM(ABS(A.D2_QTY)),DECODE(GROUPING(A.YRWK),1,SUM(ABS(A.D2_QTY)),SUM(A.D2_QTY))) D2_QTY" ).append("\n"); 
		query.append("	  ,DECODE(GROUPING(A.LOC_CD),1,SUM(ABS(A.D4_QTY)),DECODE(GROUPING(A.YRWK),1,SUM(ABS(A.D4_QTY)),SUM(A.D4_QTY))) D4_QTY" ).append("\n"); 
		query.append("	  ,DECODE(GROUPING(A.LOC_CD),1,SUM(ABS(A.D5_QTY)),DECODE(GROUPING(A.YRWK),1,SUM(ABS(A.D5_QTY)),SUM(A.D5_QTY))) D5_QTY" ).append("\n"); 
		query.append("	  ,DECODE(GROUPING(A.LOC_CD),1,SUM(ABS(A.D7_QTY)),DECODE(GROUPING(A.YRWK),1,SUM(ABS(A.D7_QTY)),SUM(A.D7_QTY))) D7_QTY" ).append("\n"); 
		query.append("	  ,DECODE(GROUPING(A.LOC_CD),1,SUM(ABS(A.R2_QTY)),DECODE(GROUPING(A.YRWK),1,SUM(ABS(A.R2_QTY)),SUM(A.R2_QTY))) R2_QTY" ).append("\n"); 
		query.append("	  ,DECODE(GROUPING(A.LOC_CD),1,SUM(ABS(A.R5_QTY)),DECODE(GROUPING(A.YRWK),1,SUM(ABS(A.R5_QTY)),SUM(A.R5_QTY))) R5_QTY" ).append("\n"); 
		query.append("	  ,DECODE(GROUPING(A.LOC_CD),1,SUM(ABS(A.R9_QTY)),DECODE(GROUPING(A.YRWK),1,SUM(ABS(A.R9_QTY)),SUM(A.R9_QTY))) R9_QTY" ).append("\n"); 
		query.append("	  ,DECODE(GROUPING(A.LOC_CD),1,SUM(ABS(A.O2_QTY)),DECODE(GROUPING(A.YRWK),1,SUM(ABS(A.O2_QTY)),SUM(A.O2_QTY))) O2_QTY" ).append("\n"); 
		query.append("	  ,DECODE(GROUPING(A.LOC_CD),1,SUM(ABS(A.O4_QTY)),DECODE(GROUPING(A.YRWK),1,SUM(ABS(A.O4_QTY)),SUM(A.O4_QTY))) O4_QTY" ).append("\n"); 
		query.append("	  ,DECODE(GROUPING(A.LOC_CD),1,SUM(ABS(A.O5_QTY)),DECODE(GROUPING(A.YRWK),1,SUM(ABS(A.O5_QTY)),SUM(A.O5_QTY))) O5_QTY" ).append("\n"); 
		query.append("	  ,DECODE(GROUPING(A.LOC_CD),1,SUM(ABS(A.S2_QTY)),DECODE(GROUPING(A.YRWK),1,SUM(ABS(A.S2_QTY)),SUM(A.S2_QTY))) S2_QTY" ).append("\n"); 
		query.append("	  ,DECODE(GROUPING(A.LOC_CD),1,SUM(ABS(A.S4_QTY)),DECODE(GROUPING(A.YRWK),1,SUM(ABS(A.S4_QTY)),SUM(A.S4_QTY))) S4_QTY" ).append("\n"); 
		query.append("	  ,DECODE(GROUPING(A.LOC_CD),1,SUM(ABS(A.F2_QTY)),DECODE(GROUPING(A.YRWK),1,SUM(ABS(A.F2_QTY)),SUM(A.F2_QTY))) F2_QTY" ).append("\n"); 
		query.append("	  ,DECODE(GROUPING(A.LOC_CD),1,SUM(ABS(A.F4_QTY)),DECODE(GROUPING(A.YRWK),1,SUM(ABS(A.F4_QTY)),SUM(A.F4_QTY))) F4_QTY" ).append("\n"); 
		query.append("	  ,DECODE(GROUPING(A.LOC_CD),1,SUM(ABS(A.F5_QTY)),DECODE(GROUPING(A.YRWK),1,SUM(ABS(A.F5_QTY)),SUM(A.F5_QTY))) F5_QTY" ).append("\n"); 
		query.append("	  ,DECODE(GROUPING(A.LOC_CD),1,SUM(ABS(A.A2_QTY)),DECODE(GROUPING(A.YRWK),1,SUM(ABS(A.A2_QTY)),SUM(A.A2_QTY))) A2_QTY" ).append("\n"); 
		query.append("	  ,DECODE(GROUPING(A.LOC_CD),1,SUM(ABS(A.A4_QTY)),DECODE(GROUPING(A.YRWK),1,SUM(ABS(A.A4_QTY)),SUM(A.A4_QTY))) A4_QTY" ).append("\n"); 
		query.append("      ,GROUPING(A.YRWK)||GROUPING(A.LOC_CD)      " ).append("\n"); 
		query.append("FROM" ).append("\n"); 
		query.append("    (" ).append("\n"); 
		query.append("    SELECT  " ).append("\n"); 
		query.append("              A.BOUND" ).append("\n"); 
		query.append("             ,A.YRWK" ).append("\n"); 
		query.append("             ,A.LOC_CD" ).append("\n"); 
		query.append("             ,A.DP_SEQ" ).append("\n"); 
		query.append("             ,SUM(A.CNTR_QTY) TOT_QTY" ).append("\n"); 
		query.append("             ,SUM(ABS(A.CNTR_QTY)) TOT_ABS_QTY" ).append("\n"); 
		query.append("             ,SUM(DECODE(A.CNTR_TPSZ_CD,'D2',A.CNTR_QTY,0)) D2_QTY" ).append("\n"); 
		query.append("             ,SUM(DECODE(A.CNTR_TPSZ_CD,'D4',A.CNTR_QTY,0)) D4_QTY" ).append("\n"); 
		query.append("             ,SUM(DECODE(A.CNTR_TPSZ_CD,'D5',A.CNTR_QTY,0)) D5_QTY" ).append("\n"); 
		query.append("             ,SUM(DECODE(A.CNTR_TPSZ_CD,'D7',A.CNTR_QTY,0)) D7_QTY" ).append("\n"); 
		query.append("             ,SUM(DECODE(A.CNTR_TPSZ_CD,'R2',A.CNTR_QTY,0)) R2_QTY" ).append("\n"); 
		query.append("             ,SUM(DECODE(A.CNTR_TPSZ_CD,'R5',A.CNTR_QTY,0)) R5_QTY" ).append("\n"); 
		query.append("             ,SUM(DECODE(A.CNTR_TPSZ_CD,'R9',A.CNTR_QTY,0)) R9_QTY" ).append("\n"); 
		query.append("             ,SUM(DECODE(A.CNTR_TPSZ_CD,'O2',A.CNTR_QTY,0)) O2_QTY" ).append("\n"); 
		query.append("             ,SUM(DECODE(A.CNTR_TPSZ_CD,'S2',A.CNTR_QTY,0)) S2_QTY" ).append("\n"); 
		query.append("             ,SUM(DECODE(A.CNTR_TPSZ_CD,'O4',A.CNTR_QTY,0)) O4_QTY" ).append("\n"); 
		query.append("             ,SUM(DECODE(A.CNTR_TPSZ_CD,'S4',A.CNTR_QTY,0)) S4_QTY" ).append("\n"); 
		query.append("             ,SUM(DECODE(A.CNTR_TPSZ_CD,'F2',A.CNTR_QTY,0)) F2_QTY" ).append("\n"); 
		query.append("             ,SUM(DECODE(A.CNTR_TPSZ_CD,'A2',A.CNTR_QTY,0)) A2_QTY" ).append("\n"); 
		query.append("             ,SUM(DECODE(A.CNTR_TPSZ_CD,'F4',A.CNTR_QTY,0)) F4_QTY" ).append("\n"); 
		query.append("             ,SUM(DECODE(A.CNTR_TPSZ_CD,'A4',A.CNTR_QTY,0)) A4_QTY" ).append("\n"); 
		query.append("             ,SUM(DECODE(A.CNTR_TPSZ_CD,'F5',A.CNTR_QTY,0)) F5_QTY" ).append("\n"); 
		query.append("             ,SUM(DECODE(A.CNTR_TPSZ_CD,'O5',A.CNTR_QTY,0)) O5_QTY" ).append("\n"); 
		query.append("    FROM" ).append("\n"); 
		query.append("        (" ).append("\n"); 
		query.append("        SELECT  " ).append("\n"); 
		query.append("                A.BOUND" ).append("\n"); 
		query.append("               ,A.YRWK" ).append("\n"); 
		query.append("               ,A.LOC_CD" ).append("\n"); 
		query.append("               ,A.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("               ,B.DP_SEQ" ).append("\n"); 
		query.append("               ,DECODE(B.DP_SEQ,1,A.FCAST_CNTR_QTY,2,A.PFMC_CNTR_QTY,3,A.DIFF_VOL,4,A.DIFF_RAT) CNTR_QTY" ).append("\n"); 
		query.append("        FROM" ).append("\n"); 
		query.append("            (" ).append("\n"); 
		query.append("            SELECT  " ).append("\n"); 
		query.append("                    A.BOUND" ).append("\n"); 
		query.append("                   ,A.YRWK" ).append("\n"); 
		query.append("                   ,A.LOC_CD" ).append("\n"); 
		query.append("                   ,A.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                   ,A.FCAST_CNTR_QTY" ).append("\n"); 
		query.append("                   ,A.PFMC_CNTR_QTY" ).append("\n"); 
		query.append("                   ,(A.FCAST_CNTR_QTY-A.PFMC_CNTR_QTY) DIFF_VOL" ).append("\n"); 
		query.append("                   ,DECODE(A.FCAST_CNTR_QTY,0,100,((A.FCAST_CNTR_QTY-A.PFMC_CNTR_QTY)/A.FCAST_CNTR_QTY)*100) DIFF_RAT" ).append("\n"); 
		query.append("            FROM " ).append("\n"); 
		query.append("                (" ).append("\n"); 
		query.append("                SELECT  " ).append("\n"); 
		query.append("                        A.BOUND" ).append("\n"); 
		query.append("                       ,A.YRWK" ).append("\n"); 
		query.append("                       ,A.LOC_CD" ).append("\n"); 
		query.append("                       ,A.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                       ,SUM(DECODE(A.SRC_CD,'F',A.CNTR_QTY,0)) FCAST_CNTR_QTY" ).append("\n"); 
		query.append("                       ,SUM(DECODE(A.SRC_CD,'P',A.CNTR_QTY,0)) PFMC_CNTR_QTY" ).append("\n"); 
		query.append("                FROM" ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                    SELECT  DECODE(A.MTY_BAL_TP_CD,'1','MG','OP') BOUND" ).append("\n"); 
		query.append("                            ,A.YRWK" ).append("\n"); 
		query.append("                            ,A.LOC_CD" ).append("\n"); 
		query.append("                            ,'F' SRC_CD" ).append("\n"); 
		query.append("                            ,A.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                            ,SUM(NVL(A.CNTR_QTY,0)) CNTR_QTY" ).append("\n"); 
		query.append("                    FROM" ).append("\n"); 
		query.append("                        (" ).append("\n"); 
		query.append("                         SELECT " ).append("\n"); 
		query.append("                               A.MTY_BAL_TP_CD" ).append("\n"); 
		query.append("                              ,A.FCAST_YRWK YRWK" ).append("\n"); 
		query.append("						 " ).append("\n"); 
		query.append("						 #if (${div_flag} == '1' )" ).append("\n"); 
		query.append("							#if (${loc_tp_cd} == 'R' )" ).append("\n"); 
		query.append("            		   		  ,B.LCC_CD LOC_CD" ).append("\n"); 
		query.append("							#elseif (${loc_tp_cd} == 'L')" ).append("\n"); 
		query.append("                              ,B.ECC_CD LOC_CD" ).append("\n"); 
		query.append("							#elseif (${loc_tp_cd} == 'E')" ).append("\n"); 
		query.append("                              ,B.SCC_CD LOC_CD" ).append("\n"); 
		query.append("							#elseif (${loc_tp_cd} == 'S')" ).append("\n"); 
		query.append("                              ,B.SCC_CD LOC_CD" ).append("\n"); 
		query.append("							#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("						 #else" ).append("\n"); 
		query.append("							#if (${loc_tp_cd_second} == 'L')" ).append("\n"); 
		query.append("                              ,B.LCC_CD LOC_CD" ).append("\n"); 
		query.append("							#elseif (${loc_tp_cd_second} == 'E')" ).append("\n"); 
		query.append("                              ,B.ECC_CD LOC_CD" ).append("\n"); 
		query.append("							#elseif (${loc_tp_cd_second} == 'S')" ).append("\n"); 
		query.append("                              ,B.SCC_CD LOC_CD" ).append("\n"); 
		query.append("							#end" ).append("\n"); 
		query.append("                         #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                              ,DECODE(C.DP_SEQ,1,'D2',2,'D4',3,'D5',4,'D7',5,'R2',6,'R5',7,'R9',8,'O2',9,'S2',10,'O4',11,'S4',12,'F2',13,'A2',14,'F4',15,'A4',16,'F5',17,'O5') CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                              ,SUM(DECODE(C.DP_SEQ, 1,D2_FCAST_QTY," ).append("\n"); 
		query.append("                                                2,D4_FCAST_QTY," ).append("\n"); 
		query.append("                                                3,D5_FCAST_QTY," ).append("\n"); 
		query.append("                                                4,D7_FCAST_QTY," ).append("\n"); 
		query.append("                                                5,R2_FCAST_QTY," ).append("\n"); 
		query.append("                                                6,R5_FCAST_QTY," ).append("\n"); 
		query.append("                                                7,R9_FCAST_QTY," ).append("\n"); 
		query.append("                                                8,O2_FCAST_QTY," ).append("\n"); 
		query.append("                                                9,S2_FCAST_QTY," ).append("\n"); 
		query.append("                                                10,O4_FCAST_QTY," ).append("\n"); 
		query.append("                                                11,S4_FCAST_QTY," ).append("\n"); 
		query.append("                                                12,F2_FCAST_QTY," ).append("\n"); 
		query.append("                                                13,A2_FCAST_QTY," ).append("\n"); 
		query.append("                                                14,F4_FCAST_QTY," ).append("\n"); 
		query.append("                                                15,A4_FCAST_QTY," ).append("\n"); 
		query.append("                                                16,F5_FCAST_QTY," ).append("\n"); 
		query.append("												17,O5_FCAST_QTY,0))  CNTR_QTY                   " ).append("\n"); 
		query.append("                        FROM " ).append("\n"); 
		query.append("							(" ).append("\n"); 
		query.append("							  SELECT" ).append("\n"); 
		query.append("							    ( SELECT /*+INDEX_DESC(W XPKEQR_WK_PRD) */" ).append("\n"); 
		query.append("							        W.PLN_YR||PLN_WK" ).append("\n"); 
		query.append("							      FROM EQR_WK_PRD W" ).append("\n"); 
		query.append("							      WHERE @[fm_week] > W.PLN_YR||PLN_WK" ).append("\n"); 
		query.append("							      AND   ROWNUM = 1" ).append("\n"); 
		query.append("							      ) FM_INP_WEEK" ).append("\n"); 
		query.append("							      ,(SELECT /*+INDEX_DESC(W XPKEQR_WK_PRD) */" ).append("\n"); 
		query.append("							          W.PLN_YR||PLN_WK" ).append("\n"); 
		query.append("							      FROM EQR_WK_PRD W" ).append("\n"); 
		query.append("							      WHERE @[to_week] > W.PLN_YR||PLN_WK" ).append("\n"); 
		query.append("							      AND   ROWNUM = 1" ).append("\n"); 
		query.append("							      ) TO_INP_WEEK" ).append("\n"); 
		query.append("							  FROM DUAL    " ).append("\n"); 
		query.append("							) W" ).append("\n"); 
		query.append("                           ,EQR_CTRL_MTY_BAL_RPT A" ).append("\n"); 
		query.append("                           ,(" ).append("\n"); 
		query.append("                          #if (${div_flag} == '1' )" ).append("\n"); 
		query.append("                            #if (${loc_tp_cd} == 'R' )" ).append("\n"); 
		query.append("                               SELECT DISTINCT LCC_CD, RCC_CD " ).append("\n"); 
		query.append("                            #elseif (${loc_tp_cd} == 'L')" ).append("\n"); 
		query.append("                               SELECT DISTINCT ECC_CD, LCC_CD " ).append("\n"); 
		query.append("                            #elseif (${loc_tp_cd} == 'E')" ).append("\n"); 
		query.append("                               SELECT DISTINCT SCC_CD, ECC_CD " ).append("\n"); 
		query.append("                            #else --S(LCC 조건으로 SCC 표현)" ).append("\n"); 
		query.append("                               SELECT DISTINCT SCC_CD, LCC_CD " ).append("\n"); 
		query.append("                            #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("						  #else" ).append("\n"); 
		query.append("                            #if (${loc_tp_cd_second} == 'L')" ).append("\n"); 
		query.append("                               SELECT DISTINCT LCC_CD " ).append("\n"); 
		query.append("                            #elseif (${loc_tp_cd_second} == 'E')" ).append("\n"); 
		query.append("                               SELECT DISTINCT ECC_CD " ).append("\n"); 
		query.append("                            #else --S(LCC 조건으로 SCC 표현)" ).append("\n"); 
		query.append("                               SELECT DISTINCT SCC_CD " ).append("\n"); 
		query.append("                            #end" ).append("\n"); 
		query.append("                          #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                               FROM MDM_EQ_ORZ_CHT " ).append("\n"); 
		query.append("                               WHERE NVL(DELT_FLG, 'N') = 'N'" ).append("\n"); 
		query.append("                            ) B " ).append("\n"); 
		query.append("                           ,(" ).append("\n"); 
		query.append("                               SELECT LEVEL DP_SEQ " ).append("\n"); 
		query.append("                               FROM DUAL CONNECT BY LEVEL <= 16" ).append("\n"); 
		query.append("                            ) C " ).append("\n"); 
		query.append("                        WHERE A.CO_CD ='H' " ).append("\n"); 
		query.append("                       " ).append("\n"); 
		query.append("                  #if (${div_flag} == '1' )" ).append("\n"); 
		query.append("					#if (${loc_tp_cd} == 'R' )" ).append("\n"); 
		query.append("						AND   A.LOC_GRP_CD = 'L' " ).append("\n"); 
		query.append("					#elseif (${loc_tp_cd} == 'L')" ).append("\n"); 
		query.append("						AND   A.LOC_GRP_CD = 'E' " ).append("\n"); 
		query.append("					#elseif (${loc_tp_cd} == 'E')" ).append("\n"); 
		query.append("						AND   A.LOC_GRP_CD = 'S' " ).append("\n"); 
		query.append("					#else --S(LCC 조건으로 SCC 표현)" ).append("\n"); 
		query.append("						AND   A.LOC_GRP_CD = 'S' " ).append("\n"); 
		query.append("					#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("				  #else" ).append("\n"); 
		query.append("					#if (${loc_tp_cd_second} == 'L')" ).append("\n"); 
		query.append("						AND   A.LOC_GRP_CD = 'L' " ).append("\n"); 
		query.append("					#elseif (${loc_tp_cd_second} == 'E')" ).append("\n"); 
		query.append("						AND   A.LOC_GRP_CD = 'E' " ).append("\n"); 
		query.append("					#else --S(LCC 조건으로 SCC 표현)" ).append("\n"); 
		query.append("						AND   A.LOC_GRP_CD = 'S' " ).append("\n"); 
		query.append("					#end" ).append("\n"); 
		query.append("                  #end" ).append("\n"); 
		query.append("                        AND   A.INP_YRWK  BETWEEN W.FM_INP_WEEK AND W.TO_INP_WEEK" ).append("\n"); 
		query.append("                        -- 각INP_YRWK당 첫번째 FCAST_YRWK 주차만 수집" ).append("\n"); 
		query.append("                        AND   A.FCAST_YRWK = (" ).append("\n"); 
		query.append("                                                SELECT W.PLN_YR||PLN_WK" ).append("\n"); 
		query.append("                                                FROM EQR_WK_PRD W" ).append("\n"); 
		query.append("                                                WHERE A.INP_YRWK <  W.PLN_YR||PLN_WK" ).append("\n"); 
		query.append("                                                AND   ROWNUM =1" ).append("\n"); 
		query.append("                                             )" ).append("\n"); 
		query.append("					#if (${bound} == 'A' )" ).append("\n"); 
		query.append("	                    AND   A.MTY_BAL_TP_CD IN('1','3')   " ).append("\n"); 
		query.append("					#else" ).append("\n"); 
		query.append("						AND   DECODE(@[bound],'I','1','O','3') =  A.MTY_BAL_TP_CD      " ).append("\n"); 
		query.append("					#end" ).append("\n"); 
		query.append("            " ).append("\n"); 
		query.append("                  #if (${div_flag} == '1' )" ).append("\n"); 
		query.append("                    #if (${loc_tp_cd} == 'E' )" ).append("\n"); 
		query.append("                    	AND   A.LOC_CD  = B.SCC_CD" ).append("\n"); 
		query.append("                        AND   @[loc_cd] = B.ECC_CD" ).append("\n"); 
		query.append("                   	#elseif (${loc_tp_cd} == 'L' )" ).append("\n"); 
		query.append("                    	AND   A.LOC_CD  = B.ECC_CD" ).append("\n"); 
		query.append("                       	AND   @[loc_cd] = B.LCC_CD" ).append("\n"); 
		query.append("                   	#elseif (${loc_tp_cd} == 'R' )" ).append("\n"); 
		query.append("                    	AND   A.LOC_CD  = B.LCC_CD" ).append("\n"); 
		query.append("                        AND   @[loc_cd] = B.RCC_CD" ).append("\n"); 
		query.append("                   	#elseif (${loc_tp_cd} == 'S' )  --S(LCC 조건으로 SCC 표현)" ).append("\n"); 
		query.append("                    	AND   A.LOC_CD  = B.SCC_CD" ).append("\n"); 
		query.append("                        AND   @[loc_cd] = B.LCC_CD" ).append("\n"); 
		query.append("                   	#end" ).append("\n"); 
		query.append("           " ).append("\n"); 
		query.append("					#if (${loc_tp_cd} == 'R' )" ).append("\n"); 
		query.append("	                        GROUP BY A.MTY_BAL_TP_CD,B.LCC_CD,C.DP_SEQ,A.FCAST_YRWK" ).append("\n"); 
		query.append("                   	#elseif (${loc_tp_cd} == 'L' )" ).append("\n"); 
		query.append("	                        GROUP BY A.MTY_BAL_TP_CD,B.ECC_CD,C.DP_SEQ,A.FCAST_YRWK" ).append("\n"); 
		query.append("					#elseif (${loc_tp_cd} == 'E' )" ).append("\n"); 
		query.append("	                        GROUP BY A.MTY_BAL_TP_CD,B.SCC_CD,C.DP_SEQ,A.FCAST_YRWK" ).append("\n"); 
		query.append("					#elseif (${loc_tp_cd} == 'S' ) --S(LCC 조건으로 SCC 표현)" ).append("\n"); 
		query.append("	                        GROUP BY A.MTY_BAL_TP_CD,B.SCC_CD,C.DP_SEQ,A.FCAST_YRWK" ).append("\n"); 
		query.append("					#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("				  #else" ).append("\n"); 
		query.append("                    #if (${loc_tp_cd_second} == 'L' )" ).append("\n"); 
		query.append("                    	AND   A.LOC_CD         = B.LCC_CD" ).append("\n"); 
		query.append("                       	AND   @[loc_cd_second] = B.LCC_CD" ).append("\n"); 
		query.append("                   	#elseif (${loc_tp_cd_second} == 'E' )" ).append("\n"); 
		query.append("                    	AND   A.LOC_CD         = B.ECC_CD" ).append("\n"); 
		query.append("                        AND   @[loc_cd_second] = B.ECC_CD" ).append("\n"); 
		query.append("                   	#elseif (${loc_tp_cd_second} == 'S' )  --S(LCC 조건으로 SCC 표현)" ).append("\n"); 
		query.append("                    	AND   A.LOC_CD         = B.SCC_CD" ).append("\n"); 
		query.append("                        AND   @[loc_cd_second] = B.SCC_CD" ).append("\n"); 
		query.append("                   	#end" ).append("\n"); 
		query.append("           " ).append("\n"); 
		query.append("					#if (${loc_tp_cd_second} == 'L' )" ).append("\n"); 
		query.append("	                        GROUP BY A.MTY_BAL_TP_CD,B.LCC_CD,C.DP_SEQ,A.FCAST_YRWK" ).append("\n"); 
		query.append("					#elseif (${loc_tp_cd_second} == 'E' )" ).append("\n"); 
		query.append("	                        GROUP BY A.MTY_BAL_TP_CD,B.ECC_CD,C.DP_SEQ,A.FCAST_YRWK" ).append("\n"); 
		query.append("					#elseif (${loc_tp_cd_second} == 'S' ) --S(LCC 조건으로 SCC 표현)" ).append("\n"); 
		query.append("	                        GROUP BY A.MTY_BAL_TP_CD,B.SCC_CD,C.DP_SEQ,A.FCAST_YRWK" ).append("\n"); 
		query.append("					#end" ).append("\n"); 
		query.append("                  #end" ).append("\n"); 
		query.append("                        ) A" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                    #if ( ${tpszText} != '' )" ).append("\n"); 
		query.append("					WHERE  A.CNTR_TPSZ_CD IN( ${tpszText} )" ).append("\n"); 
		query.append("					#else" ).append("\n"); 
		query.append("                    WHERE  A.CNTR_TPSZ_CD IN('D2','D4','D5','D7','R2','R5','R9','O2','S2','O4','S4','F2','A2','F4','A4','F5','O5')" ).append("\n"); 
		query.append("					#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                    GROUP BY DECODE(A.MTY_BAL_TP_CD,'1','MG','OP')" ).append("\n"); 
		query.append("                            ,A.YRWK" ).append("\n"); 
		query.append("                            ,A.LOC_CD" ).append("\n"); 
		query.append("                            ,A.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                    UNION ALL" ).append("\n"); 
		query.append("                    SELECT  A.BOUND" ).append("\n"); 
		query.append("                           ,A.YRWK" ).append("\n"); 
		query.append("                           ,A.LOC_CD" ).append("\n"); 
		query.append("                           ,'P' SRC_CD" ).append("\n"); 
		query.append("                           ,A.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                           ,A.CNTR_QTY" ).append("\n"); 
		query.append("                    FROM " ).append("\n"); 
		query.append("                        (" ).append("\n"); 
		query.append("                            SELECT   DECODE(B.DP_SEQ,1,'OP','MG') BOUND" ).append("\n"); 
		query.append("                                     ,A.YRWK" ).append("\n"); 
		query.append("                                     ,A.LOC_CD" ).append("\n"); 
		query.append("                                     ,A.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                                     ,DECODE(B.DP_SEQ,1,OB_QTY,IB_QTY) CNTR_QTY " ).append("\n"); 
		query.append("                            FROM" ).append("\n"); 
		query.append("                                (" ).append("\n"); 
		query.append("						#if (${bound} == 'A' || ${bound} == 'O')" ).append("\n"); 
		query.append("								        SELECT 	E.PLN_YR||E.PLN_WK YRWK," ).append("\n"); 
		query.append("                                        		M.CNTR_TPSZ_CD			CNTR_TPSZ_CD    ," ).append("\n"); 
		query.append("										#if (${div_flag} == '1' )" ).append("\n"); 
		query.append("											#if (${loc_tp_cd}=='R' )" ).append("\n"); 
		query.append("	                    						G.LCC_CD                LOC_CD," ).append("\n"); 
		query.append("                                            #elseif (${loc_tp_cd}=='L' )" ).append("\n"); 
		query.append("                                                G.ECC_CD                LOC_CD," ).append("\n"); 
		query.append("											#elseif (${loc_tp_cd}=='E' )" ).append("\n"); 
		query.append("                            	            	G.SCC_CD                LOC_CD," ).append("\n"); 
		query.append("											#elseif (${loc_tp_cd}=='S' ) --S(LCC 조건으로 SCC 표현)" ).append("\n"); 
		query.append("                            	            	G.SCC_CD                LOC_CD," ).append("\n"); 
		query.append("											#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("										#else" ).append("\n"); 
		query.append("											#if (${loc_tp_cd_second}=='L' )" ).append("\n"); 
		query.append("                                                G.LCC_CD                LOC_CD," ).append("\n"); 
		query.append("											#elseif (${loc_tp_cd_second}=='E' )" ).append("\n"); 
		query.append("                            	            	G.ECC_CD                LOC_CD," ).append("\n"); 
		query.append("											#elseif (${loc_tp_cd_second}=='S' ) --S(LCC 조건으로 SCC 표현)" ).append("\n"); 
		query.append("                            	            	G.SCC_CD                LOC_CD," ).append("\n"); 
		query.append("											#end" ).append("\n"); 
		query.append("										#end" ).append("\n"); 
		query.append("                                        		COUNT(*) OB_QTY         ," ).append("\n"); 
		query.append("												0 IB_QTY " ).append("\n"); 
		query.append("                                          FROM 	CTM_MOVEMENT	     M," ).append("\n"); 
		query.append("                                               	MST_CONTAINER        C," ).append("\n"); 
		query.append("                                               	MDM_EQ_ORZ_CHT G," ).append("\n"); 
		query.append("                                                MDM_LOCATION L," ).append("\n"); 
		query.append("                                                MDM_YARD Y," ).append("\n"); 
		query.append("												EQR_WK_PRD E" ).append("\n"); 
		query.append("                                         WHERE 	M.CNMV_EVNT_DT	BETWEEN	( " ).append("\n"); 
		query.append("                                        				SELECT TO_DATE(K.WK_ST_DT,'YYYYMMDD') + .0" ).append("\n"); 
		query.append("                                        				FROM   EQR_WK_PRD K" ).append("\n"); 
		query.append("                                        				WHERE  K.PLN_YR = SUBSTR(@[fm_week],1,4)" ).append("\n"); 
		query.append("                                        				AND    K.PLN_WK = SUBSTR(@[fm_week],5)" ).append("\n"); 
		query.append("                                        				)	" ).append("\n"); 
		query.append("                                           AND				( " ).append("\n"); 
		query.append("                                        				 SELECT TO_DATE(K.WK_END_DT,'YYYYMMDD') + .99999" ).append("\n"); 
		query.append("                                        				 FROM   EQR_WK_PRD K" ).append("\n"); 
		query.append("                                        				WHERE  K.PLN_YR = SUBSTR(@[to_week],1,4)" ).append("\n"); 
		query.append("                                        				AND    K.PLN_WK = SUBSTR(@[to_week],5)" ).append("\n"); 
		query.append("                                        				)                                     " ).append("\n"); 
		query.append("                                           AND 	M.MVMT_STS_CD = 'OP'" ).append("\n"); 
		query.append("                                           AND  Y.LOC_CD = L.LOC_CD" ).append("\n"); 
		query.append("                                           AND  L.SCC_CD = G.SCC_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                      #if (${div_flag} == '1' )" ).append("\n"); 
		query.append("                       					#if (${loc_tp_cd} == 'E' )" ).append("\n"); 
		query.append("                        				   AND   @[loc_cd] = G.ECC_CD" ).append("\n"); 
		query.append("                       					#elseif (${loc_tp_cd} == 'L' )" ).append("\n"); 
		query.append("                        				   AND   @[loc_cd] = G.LCC_CD" ).append("\n"); 
		query.append("                       					#elseif (${loc_tp_cd} == 'R' )" ).append("\n"); 
		query.append("                        				   AND   @[loc_cd] = G.RCC_CD" ).append("\n"); 
		query.append("                       					#elseif (${loc_tp_cd} == 'S' )" ).append("\n"); 
		query.append("                        				   AND   @[loc_cd] = G.LCC_CD" ).append("\n"); 
		query.append("                       					#end" ).append("\n"); 
		query.append("                                      #else" ).append("\n"); 
		query.append("                       					#if (${loc_tp_cd_second} == 'E' )" ).append("\n"); 
		query.append("                        				   AND   @[loc_cd_second] = G.ECC_CD" ).append("\n"); 
		query.append("                       					#elseif (${loc_tp_cd_second} == 'L' )" ).append("\n"); 
		query.append("                        				   AND   @[loc_cd_second] = G.LCC_CD" ).append("\n"); 
		query.append("                       					#elseif (${loc_tp_cd_second} == 'S' )" ).append("\n"); 
		query.append("                        				   AND   @[loc_cd_second] = G.SCC_CD" ).append("\n"); 
		query.append("                       					#end                                      " ).append("\n"); 
		query.append("                                      #end" ).append("\n"); 
		query.append("                                           AND  M.ORG_YD_CD = Y.YD_CD" ).append("\n"); 
		query.append("                                           AND 	M.CNTR_NO  	= C.CNTR_NO" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("										   #if ( ${tpszText} != '' )" ).append("\n"); 
		query.append("										   AND  C.CNTR_TPSZ_CD IN( ${tpszText} )" ).append("\n"); 
		query.append("					 					   #else" ).append("\n"); 
		query.append("										   AND  C.CNTR_TPSZ_CD IN('D2','D4','D5','D7','R2','R5','R9','O2','S2','O4','S4','F2','A2','F4','A4','F5','O5')" ).append("\n"); 
		query.append("										   #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                           AND 	NVL(C.LSTM_CD, '  ') <> 'SH' /* soc	*/ " ).append("\n"); 
		query.append("										   AND  TO_CHAR(M.CNMV_EVNT_DT,'YYYYMMDD') BETWEEN E.WK_ST_DT AND E.WK_END_DT" ).append("\n"); 
		query.append("										GROUP BY E.PLN_YR||E.PLN_WK," ).append("\n"); 
		query.append("												M.MVMT_STS_CD ," ).append("\n"); 
		query.append("												M.CNTR_TPSZ_CD," ).append("\n"); 
		query.append("										#if (${div_flag} == '1' )		" ).append("\n"); 
		query.append("											#if (${loc_tp_cd} == 'R' )" ).append("\n"); 
		query.append("            		   						    G.LCC_CD" ).append("\n"); 
		query.append("											#elseif (${loc_tp_cd} == 'L' )" ).append("\n"); 
		query.append("                                                G.ECC_CD" ).append("\n"); 
		query.append("											#elseif (${loc_tp_cd} == 'E' )" ).append("\n"); 
		query.append("												G.SCC_CD" ).append("\n"); 
		query.append("											#elseif (${loc_tp_cd} == 'S' )" ).append("\n"); 
		query.append("												G.SCC_CD" ).append("\n"); 
		query.append("											#end" ).append("\n"); 
		query.append("										#else" ).append("\n"); 
		query.append("											#if (${loc_tp_cd_second} == 'L' )" ).append("\n"); 
		query.append("                                                G.LCC_CD" ).append("\n"); 
		query.append("											#elseif (${loc_tp_cd_second} == 'E' )" ).append("\n"); 
		query.append("												G.ECC_CD" ).append("\n"); 
		query.append("											#elseif (${loc_tp_cd_second} == 'S' )" ).append("\n"); 
		query.append("												G.SCC_CD" ).append("\n"); 
		query.append("											#end										" ).append("\n"); 
		query.append("										#end	" ).append("\n"); 
		query.append("						#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("						#if (${bound} == 'A')" ).append("\n"); 
		query.append("									UNION ALL" ).append("\n"); 
		query.append("						#end" ).append("\n"); 
		query.append("						#if (${bound} == 'A' || ${bound} == 'I')" ).append("\n"); 
		query.append(" 									SELECT 	E.PLN_YR||E.PLN_WK  YRWK," ).append("\n"); 
		query.append("												M.CNTR_TPSZ_CD			CNTR_TPSZ_CD    ," ).append("\n"); 
		query.append("												" ).append("\n"); 
		query.append("											#if (${div_flag} == '1' )			" ).append("\n"); 
		query.append("												#if (${loc_tp_cd} == 'R' )" ).append("\n"); 
		query.append("	                    						    G.LCC_CD                LOC_CD," ).append("\n"); 
		query.append("												#elseif (${loc_tp_cd} == 'L' )" ).append("\n"); 
		query.append("													G.ECC_CD                LOC_CD," ).append("\n"); 
		query.append("												#elseif (${loc_tp_cd} == 'E' )" ).append("\n"); 
		query.append("                            	            		G.SCC_CD                LOC_CD," ).append("\n"); 
		query.append("												#elseif (${loc_tp_cd} == 'S' )" ).append("\n"); 
		query.append("                            	            		G.SCC_CD                LOC_CD," ).append("\n"); 
		query.append("												#end" ).append("\n"); 
		query.append("                                            #else" ).append("\n"); 
		query.append("												#if (${loc_tp_cd_second} == 'L' )" ).append("\n"); 
		query.append("													G.LCC_CD                LOC_CD," ).append("\n"); 
		query.append("												#elseif (${loc_tp_cd_second} == 'E' )" ).append("\n"); 
		query.append("                            	            		G.ECC_CD                LOC_CD," ).append("\n"); 
		query.append("												#elseif (${loc_tp_cd_second} == 'S' )" ).append("\n"); 
		query.append("                            	            		G.SCC_CD                LOC_CD," ).append("\n"); 
		query.append("												#end                                            " ).append("\n"); 
		query.append("                                            #end" ).append("\n"); 
		query.append("                                            " ).append("\n"); 
		query.append("                                        		0 OB_QTY         ," ).append("\n"); 
		query.append("                                        		COUNT(*) IB_QTY " ).append("\n"); 
		query.append("                                          FROM 	CTM_MOVEMENT	     M," ).append("\n"); 
		query.append("                                               	MST_CONTAINER        C," ).append("\n"); 
		query.append("                                               	MDM_EQ_ORZ_CHT G," ).append("\n"); 
		query.append("                                                MDM_LOCATION L," ).append("\n"); 
		query.append("                                                MDM_YARD Y," ).append("\n"); 
		query.append("												EQR_WK_PRD E" ).append("\n"); 
		query.append("                                         WHERE 	M.CNMV_EVNT_DT	BETWEEN	( " ).append("\n"); 
		query.append("                                        				SELECT TO_DATE(K.WK_ST_DT,'YYYYMMDD') + .0" ).append("\n"); 
		query.append("                                        				FROM   EQR_WK_PRD K" ).append("\n"); 
		query.append("                                        				WHERE  K.PLN_YR = SUBSTR(@[fm_week],1,4)" ).append("\n"); 
		query.append("                                        				AND    K.PLN_WK = SUBSTR(@[fm_week],5)" ).append("\n"); 
		query.append("                                        				)	" ).append("\n"); 
		query.append("                                           AND				( " ).append("\n"); 
		query.append("                                        				 SELECT TO_DATE(K.WK_END_DT,'YYYYMMDD') + .99999" ).append("\n"); 
		query.append("                                        				 FROM   EQR_WK_PRD K" ).append("\n"); 
		query.append("                                        				WHERE  K.PLN_YR = SUBSTR(@[to_week],1,4)" ).append("\n"); 
		query.append("                                        				AND    K.PLN_WK = SUBSTR(@[to_week],5)" ).append("\n"); 
		query.append("                                        				)       " ).append("\n"); 
		query.append("	                        			   AND 	M.MVMT_STS_CD = 'MT'       " ).append("\n"); 
		query.append("                                           AND  Y.LOC_CD = L.LOC_CD" ).append("\n"); 
		query.append("                                           AND  L.SCC_CD = G.SCC_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                    #if (${div_flag} == '1' )			" ).append("\n"); 
		query.append("                       					#if (${loc_tp_cd} == 'E' )" ).append("\n"); 
		query.append("                        					AND   @[loc_cd] = G.ECC_CD" ).append("\n"); 
		query.append("                       					#elseif (${loc_tp_cd} == 'L' )" ).append("\n"); 
		query.append("                        					AND   @[loc_cd] = G.LCC_CD" ).append("\n"); 
		query.append("                       					#elseif (${loc_tp_cd} == 'R' )" ).append("\n"); 
		query.append("                        					AND   @[loc_cd] = G.RCC_CD" ).append("\n"); 
		query.append("                       					#elseif (${loc_tp_cd} == 'S' )" ).append("\n"); 
		query.append("                        					AND   @[loc_cd] = G.LCC_CD" ).append("\n"); 
		query.append("                       					#end" ).append("\n"); 
		query.append("                                    #else" ).append("\n"); 
		query.append("                       					#if (${loc_tp_cd_second} == 'E' )" ).append("\n"); 
		query.append("                        					AND   @[loc_cd_second] = G.ECC_CD" ).append("\n"); 
		query.append("                       					#elseif (${loc_tp_cd_second} == 'L' )" ).append("\n"); 
		query.append("                        					AND   @[loc_cd_second] = G.LCC_CD" ).append("\n"); 
		query.append("                       					#elseif (${loc_tp_cd_second} == 'S' )" ).append("\n"); 
		query.append("                        					AND   @[loc_cd_second] = G.SCC_CD" ).append("\n"); 
		query.append("                       					#end                                    " ).append("\n"); 
		query.append("                                    #end" ).append("\n"); 
		query.append("                                    " ).append("\n"); 
		query.append("                                           AND  M.ORG_YD_CD = Y.YD_CD" ).append("\n"); 
		query.append("                                           AND 	M.CNTR_NO  	= C.CNTR_NO" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("										   #if ( ${tpszText} != '' )" ).append("\n"); 
		query.append("										   AND  C.CNTR_TPSZ_CD IN( ${tpszText} )" ).append("\n"); 
		query.append("					 					   #else" ).append("\n"); 
		query.append("										   AND  C.CNTR_TPSZ_CD IN('D2','D4','D5','D7','R2','R5','R9','O2','S2','O4','S4','F2','A2','F4','A4','F5','O5')" ).append("\n"); 
		query.append("										   #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                           AND 	NVL(C.LSTM_CD, '  ') <> 'SH' /* soc	*/" ).append("\n"); 
		query.append("										   AND  TO_CHAR(M.CNMV_EVNT_DT,'YYYYMMDD') BETWEEN E.WK_ST_DT AND E.WK_END_DT" ).append("\n"); 
		query.append("							               AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )" ).append("\n"); 
		query.append(" 							               AND 'ID' = ( " ).append("\n"); 
		query.append("                                                          SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */" ).append("\n"); 
		query.append("         										                 MM.MVMT_STS_CD /*  pre_mvmt_sts_cd   */" ).append("\n"); 
		query.append("									                      FROM CTM_MOVEMENT MM" ).append("\n"); 
		query.append("									                      WHERE MM.CNTR_NO = M.CNTR_NO" ).append("\n"); 
		query.append("									                      AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO < M.CNMV_YR||TO_CHAR(M.CNMV_SEQ, '0000')||M.CNMV_SPLIT_NO" ).append("\n"); 
		query.append("									                      AND ROWNUM = 1 " ).append("\n"); 
		query.append("                                                       )" ).append("\n"); 
		query.append("										GROUP BY E.PLN_YR||E.PLN_WK," ).append("\n"); 
		query.append("												M.CNTR_TPSZ_CD," ).append("\n"); 
		query.append("                                            #if (${div_flag} == '1' )														" ).append("\n"); 
		query.append("												#if (${loc_tp_cd} == 'R' )" ).append("\n"); 
		query.append("            		   							    G.LCC_CD" ).append("\n"); 
		query.append("                       					        #elseif (${loc_tp_cd} == 'L' )" ).append("\n"); 
		query.append("													G.ECC_CD" ).append("\n"); 
		query.append("												#elseif (${loc_tp_cd} == 'E' )" ).append("\n"); 
		query.append("													G.SCC_CD" ).append("\n"); 
		query.append("												#elseif (${loc_tp_cd} == 'S' )" ).append("\n"); 
		query.append("													G.SCC_CD" ).append("\n"); 
		query.append("												#end" ).append("\n"); 
		query.append("                                            #else" ).append("\n"); 
		query.append("												#if (${loc_tp_cd_second} == 'L' )" ).append("\n"); 
		query.append("													G.LCC_CD" ).append("\n"); 
		query.append("												#elseif (${loc_tp_cd_second} == 'E' )" ).append("\n"); 
		query.append("													G.ECC_CD" ).append("\n"); 
		query.append("												#elseif (${loc_tp_cd_second} == 'S' )" ).append("\n"); 
		query.append("													G.SCC_CD" ).append("\n"); 
		query.append("												#end                                            " ).append("\n"); 
		query.append("                                            #end												" ).append("\n"); 
		query.append("						#end                             " ).append("\n"); 
		query.append("                             ) A, (SELECT LEVEL DP_SEQ  FROM DUAL CONNECT BY LEVEL <=2) B" ).append("\n"); 
		query.append("                        ) A" ).append("\n"); 
		query.append("						#if (${bound} != 'A' )" ).append("\n"); 
		query.append("							#if (${bound} == 'O')" ).append("\n"); 
		query.append("                        	WHERE A.BOUND = 'OP'" ).append("\n"); 
		query.append("							#end" ).append("\n"); 
		query.append("							#if (${bound} == 'I')" ).append("\n"); 
		query.append("                        	WHERE A.BOUND = 'MG'" ).append("\n"); 
		query.append("							#end" ).append("\n"); 
		query.append("						#end" ).append("\n"); 
		query.append("                    ) A" ).append("\n"); 
		query.append("                GROUP BY A.BOUND,A.YRWK,A.LOC_CD,A.CNTR_TPSZ_CD                " ).append("\n"); 
		query.append("                )  A" ).append("\n"); 
		query.append("            WHERE A.FCAST_CNTR_QTY + A.PFMC_CNTR_QTY > 0" ).append("\n"); 
		query.append("            ) A , (SELECT LEVEL DP_SEQ  FROM DUAL CONNECT BY LEVEL <=4) B" ).append("\n"); 
		query.append("       ) A" ).append("\n"); 
		query.append("    GROUP BY  A.BOUND, A.YRWK,A.LOC_CD, A.DP_SEQ" ).append("\n"); 
		query.append("    ) A" ).append("\n"); 
		query.append("GROUP BY GROUPING SETS((A.BOUND,A.YRWK,A.LOC_CD,A.DP_SEQ),(A.BOUND,A.YRWK,A.DP_SEQ),(A.BOUND,A.YRWK),(A.BOUND,A.LOC_CD,A.DP_SEQ),(A.BOUND,A.DP_SEQ))" ).append("\n"); 
		query.append("ORDER BY DECODE(A.BOUND,'OP',1,2), A.YRWK,A.LOC_CD,A.DP_SEQ" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", LV_QTY_LIST2 AS" ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("SELECT " ).append("\n"); 
		query.append("        A.BOUND" ).append("\n"); 
		query.append("       ,A.YRWK" ).append("\n"); 
		query.append("       ,A.LOC_CD" ).append("\n"); 
		query.append("       ,A.DP_SEQ" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,4,DECODE(B.TOT_QTY,0,100,(C.TOT_QTY/B.TOT_QTY)*100),A.TOT_QTY) TOT_QTY" ).append("\n"); 
		query.append("       ,(CASE WHEN A.DP_SEQ||A.LOC_CD = '4ZZZZ9' OR  A.DP_SEQ||A.YRWK = '4999999' THEN DECODE(B.D2_QTY,0,100, (C.D2_QTY/B.D2_QTY)*100)       " ).append("\n"); 
		query.append("              ELSE (CASE WHEN A.DP_SEQ||B.D2_QTY+C.D2_QTY = '40' THEN NULL" ).append("\n"); 
		query.append("                                                                 ELSE A.D2_QTY" ).append("\n"); 
		query.append("                    END)              " ).append("\n"); 
		query.append("         END) AS D2_QTY        " ).append("\n"); 
		query.append("       ,(CASE WHEN A.DP_SEQ||A.LOC_CD = '4ZZZZ9' OR  A.DP_SEQ||A.YRWK = '4999999' THEN DECODE(B.D4_QTY,0,100, (C.D4_QTY/B.D4_QTY)*100)       " ).append("\n"); 
		query.append("              ELSE (CASE WHEN A.DP_SEQ||B.D4_QTY+C.D4_QTY = '40' THEN NULL" ).append("\n"); 
		query.append("                                                                 ELSE A.D4_QTY" ).append("\n"); 
		query.append("                    END)              " ).append("\n"); 
		query.append("         END) AS D4_QTY       " ).append("\n"); 
		query.append("       ,(CASE WHEN A.DP_SEQ||A.LOC_CD = '4ZZZZ9' OR  A.DP_SEQ||A.YRWK = '4999999' THEN DECODE(B.D5_QTY,0,100, (C.D5_QTY/B.D5_QTY)*100)       " ).append("\n"); 
		query.append("              ELSE (CASE WHEN A.DP_SEQ||B.D5_QTY+C.D5_QTY = '40' THEN NULL" ).append("\n"); 
		query.append("                                                                 ELSE A.D5_QTY" ).append("\n"); 
		query.append("                    END)              " ).append("\n"); 
		query.append("         END) AS D5_QTY        " ).append("\n"); 
		query.append("       ,(CASE WHEN A.DP_SEQ||A.LOC_CD = '4ZZZZ9' OR  A.DP_SEQ||A.YRWK = '4999999' THEN DECODE(B.D7_QTY,0,100, (C.D7_QTY/B.D7_QTY)*100)       " ).append("\n"); 
		query.append("              ELSE (CASE WHEN A.DP_SEQ||B.D7_QTY+C.D7_QTY = '40' THEN NULL" ).append("\n"); 
		query.append("                                                                 ELSE A.D7_QTY" ).append("\n"); 
		query.append("                    END)              " ).append("\n"); 
		query.append("         END) AS D7_QTY" ).append("\n"); 
		query.append("	   ,(CASE WHEN A.DP_SEQ||A.LOC_CD = '4ZZZZ9' OR  A.DP_SEQ||A.YRWK = '4999999' THEN DECODE(B.R2_QTY,0,100, (C.R2_QTY/B.R2_QTY)*100)" ).append("\n"); 
		query.append("			  ELSE (CASE WHEN A.DP_SEQ||B.R2_QTY+C.R2_QTY = '40' THEN NULL" ).append("\n"); 
		query.append("															     ELSE A.R2_QTY" ).append("\n"); 
		query.append("				    END)" ).append("\n"); 
		query.append("		 END) AS R2_QTY" ).append("\n"); 
		query.append("	   ,(CASE WHEN A.DP_SEQ||A.LOC_CD = '4ZZZZ9' OR  A.DP_SEQ||A.YRWK = '4999999' THEN DECODE(B.R5_QTY,0,100, (C.R5_QTY/B.R5_QTY)*100)" ).append("\n"); 
		query.append("			  ELSE (CASE WHEN A.DP_SEQ||B.R5_QTY+C.R5_QTY = '40' THEN NULL" ).append("\n"); 
		query.append("															     ELSE A.R5_QTY" ).append("\n"); 
		query.append("				    END)" ).append("\n"); 
		query.append("		 END) AS R5_QTY" ).append("\n"); 
		query.append("	   ,(CASE WHEN A.DP_SEQ||A.LOC_CD = '4ZZZZ9' OR  A.DP_SEQ||A.YRWK = '4999999' THEN DECODE(B.R9_QTY,0,100, (C.R9_QTY/B.R9_QTY)*100)" ).append("\n"); 
		query.append("			  ELSE (CASE WHEN A.DP_SEQ||B.R9_QTY+C.R9_QTY = '40' THEN NULL" ).append("\n"); 
		query.append("															     ELSE A.R9_QTY" ).append("\n"); 
		query.append("				    END)" ).append("\n"); 
		query.append("		 END) AS R9_QTY" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	   ,(CASE WHEN A.DP_SEQ||A.LOC_CD = '4ZZZZ9' OR  A.DP_SEQ||A.YRWK = '4999999' THEN DECODE(B.O2_QTY,0,100, (C.O2_QTY/B.O2_QTY)*100)" ).append("\n"); 
		query.append("			  ELSE (CASE WHEN A.DP_SEQ||B.O2_QTY+C.O2_QTY = '40' THEN NULL" ).append("\n"); 
		query.append("															     ELSE A.O2_QTY" ).append("\n"); 
		query.append("				    END)" ).append("\n"); 
		query.append("		 END) AS O2_QTY" ).append("\n"); 
		query.append("	   ,(CASE WHEN A.DP_SEQ||A.LOC_CD = '4ZZZZ9' OR  A.DP_SEQ||A.YRWK = '4999999' THEN DECODE(B.S2_QTY,0,100, (C.S2_QTY/B.S2_QTY)*100)" ).append("\n"); 
		query.append("			  ELSE (CASE WHEN A.DP_SEQ||B.S2_QTY+C.S2_QTY = '40' THEN NULL" ).append("\n"); 
		query.append("															     ELSE A.S2_QTY" ).append("\n"); 
		query.append("				    END)" ).append("\n"); 
		query.append("		 END) AS S2_QTY" ).append("\n"); 
		query.append("	   ,(CASE WHEN A.DP_SEQ||A.LOC_CD = '4ZZZZ9' OR  A.DP_SEQ||A.YRWK = '4999999' THEN DECODE(B.O4_QTY,0,100, (C.O4_QTY/B.O4_QTY)*100)" ).append("\n"); 
		query.append("			  ELSE (CASE WHEN A.DP_SEQ||B.O4_QTY+C.O4_QTY = '40' THEN NULL" ).append("\n"); 
		query.append("															     ELSE A.O4_QTY" ).append("\n"); 
		query.append("				    END)" ).append("\n"); 
		query.append("		 END) AS O4_QTY" ).append("\n"); 
		query.append("	   ,(CASE WHEN A.DP_SEQ||A.LOC_CD = '4ZZZZ9' OR  A.DP_SEQ||A.YRWK = '4999999' THEN DECODE(B.S4_QTY,0,100, (C.S4_QTY/B.S4_QTY)*100)" ).append("\n"); 
		query.append("			  ELSE (CASE WHEN A.DP_SEQ||B.S4_QTY+C.S4_QTY = '40' THEN NULL" ).append("\n"); 
		query.append("															     ELSE A.S4_QTY" ).append("\n"); 
		query.append("				    END)" ).append("\n"); 
		query.append("		 END) AS S4_QTY			 		 " ).append("\n"); 
		query.append("	   ,(CASE WHEN A.DP_SEQ||A.LOC_CD = '4ZZZZ9' OR  A.DP_SEQ||A.YRWK = '4999999' THEN DECODE(B.F2_QTY,0,100, (C.F2_QTY/B.F2_QTY)*100)" ).append("\n"); 
		query.append("			  ELSE (CASE WHEN A.DP_SEQ||B.F2_QTY+C.F2_QTY = '40' THEN NULL" ).append("\n"); 
		query.append("															     ELSE A.F2_QTY" ).append("\n"); 
		query.append("				    END)" ).append("\n"); 
		query.append("		 END) AS F2_QTY	" ).append("\n"); 
		query.append("	   ,(CASE WHEN A.DP_SEQ||A.LOC_CD = '4ZZZZ9' OR  A.DP_SEQ||A.YRWK = '4999999' THEN DECODE(B.A2_QTY,0,100, (C.A2_QTY/B.A2_QTY)*100)" ).append("\n"); 
		query.append("			  ELSE (CASE WHEN A.DP_SEQ||B.A2_QTY+C.A2_QTY = '40' THEN NULL" ).append("\n"); 
		query.append("															     ELSE A.A2_QTY" ).append("\n"); 
		query.append("				    END)" ).append("\n"); 
		query.append("		 END) AS A2_QTY	" ).append("\n"); 
		query.append("	   ,(CASE WHEN A.DP_SEQ||A.LOC_CD = '4ZZZZ9' OR  A.DP_SEQ||A.YRWK = '4999999' THEN DECODE(B.F4_QTY,0,100, (C.F4_QTY/B.F4_QTY)*100)" ).append("\n"); 
		query.append("			  ELSE (CASE WHEN A.DP_SEQ||B.F4_QTY+C.F4_QTY = '40' THEN NULL" ).append("\n"); 
		query.append("															     ELSE A.F4_QTY" ).append("\n"); 
		query.append("				    END)" ).append("\n"); 
		query.append("		 END) AS F4_QTY	" ).append("\n"); 
		query.append("	   ,(CASE WHEN A.DP_SEQ||A.LOC_CD = '4ZZZZ9' OR  A.DP_SEQ||A.YRWK = '4999999' THEN DECODE(B.A4_QTY,0,100, (C.A4_QTY/B.A4_QTY)*100)" ).append("\n"); 
		query.append("			  ELSE (CASE WHEN A.DP_SEQ||B.A4_QTY+C.A4_QTY = '40' THEN NULL" ).append("\n"); 
		query.append("															     ELSE A.A4_QTY" ).append("\n"); 
		query.append("				    END)" ).append("\n"); 
		query.append("		 END) AS A4_QTY	" ).append("\n"); 
		query.append(",(CASE WHEN A.DP_SEQ||A.LOC_CD = '4ZZZZ9' OR  A.DP_SEQ||A.YRWK = '4999999' THEN DECODE(B.F5_QTY,0,100, (C.F5_QTY/B.F5_QTY)*100)" ).append("\n"); 
		query.append("			  ELSE (CASE WHEN A.DP_SEQ||B.F5_QTY+C.F5_QTY = '40' THEN NULL" ).append("\n"); 
		query.append("															     ELSE A.F5_QTY" ).append("\n"); 
		query.append("				    END)" ).append("\n"); 
		query.append("		 END) AS F5_QTY" ).append("\n"); 
		query.append(",(CASE WHEN A.DP_SEQ||A.LOC_CD = '4ZZZZ9' OR  A.DP_SEQ||A.YRWK = '4999999' THEN DECODE(B.O5_QTY,0,100, (C.O5_QTY/B.O5_QTY)*100)" ).append("\n"); 
		query.append("			  ELSE (CASE WHEN A.DP_SEQ||B.O5_QTY+C.O5_QTY = '40' THEN NULL" ).append("\n"); 
		query.append("															     ELSE A.O5_QTY" ).append("\n"); 
		query.append("				    END)" ).append("\n"); 
		query.append("		 END) AS O5_QTY" ).append("\n"); 
		query.append("FROM LV_QTY_LIST A, LV_QTY_LIST B , LV_QTY_LIST C " ).append("\n"); 
		query.append("WHERE A.BOUND = B.BOUND" ).append("\n"); 
		query.append("AND   A.YRWK = B.YRWK" ).append("\n"); 
		query.append("AND   A.LOC_CD = B.LOC_CD" ).append("\n"); 
		query.append("AND   B.DP_SEQ = 1" ).append("\n"); 
		query.append("AND   A.BOUND = C.BOUND" ).append("\n"); 
		query.append("AND   A.YRWK = C.YRWK" ).append("\n"); 
		query.append("AND   A.LOC_CD = C.LOC_CD" ).append("\n"); 
		query.append("AND   C.DP_SEQ = 3" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(" " ).append("\n"); 
		query.append("SELECT  A.BOUND" ).append("\n"); 
		query.append("       ,DECODE(A.YRWK,'999999','Total',SUBSTR(A.YRWK,1,4)||'-'||SUBSTR(A.YRWK,5,6)) YRWK" ).append("\n"); 
		query.append("       ,DECODE(A.LOC_CD,'ZZZZ9','Total',A.LOC_CD) LOC_CD" ).append("\n"); 
		query.append("       ,(SELECT EQR_FCAST_EVAL_FNC(ABS(ROUND(B.TOT_QTY,1)))" ).append("\n"); 
		query.append("        FROM LV_QTY_LIST2 B" ).append("\n"); 
		query.append("        WHERE A.BOUND = B.BOUND" ).append("\n"); 
		query.append("        AND   A.YRWK =  B.YRWK" ).append("\n"); 
		query.append("        AND   A.LOC_CD = B.LOC_CD" ).append("\n"); 
		query.append("        AND   B.DP_SEQ = 4) EVAL" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,1,'FCST',2,'PFMC',3,'Diff. Vol',4,'Diff.(%)') FACTOR" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,2,LTRIM(TO_CHAR(A.TOT_QTY,'999,999,999,999')),3,LTRIM(TO_CHAR(A.TOT_QTY,'999,999,999,999')),4,LTRIM(TO_CHAR(ROUND(A.TOT_QTY,1),'999,999,990.9'))||'%',LTRIM(TO_CHAR(A.TOT_QTY,'999,999,999,999'))) TOT_QTY" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,2,LTRIM(TO_CHAR(A.D2_QTY,'999,999,999,999')),3,LTRIM(TO_CHAR(A.D2_QTY,'999,999,999,999')),4,DECODE(A.D2_QTY,NULL,'',LTRIM(TO_CHAR(ROUND(A.D2_QTY,1),'999,999,990.9'))||'%'),LTRIM(TO_CHAR(A.D2_QTY,'999,999,999,999'))) D2_QTY" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,2,LTRIM(TO_CHAR(A.D4_QTY,'999,999,999,999')),3,LTRIM(TO_CHAR(A.D4_QTY,'999,999,999,999')),4,DECODE(A.D4_QTY,NULL,'',LTRIM(TO_CHAR(ROUND(A.D4_QTY,1),'999,999,990.9'))||'%'),LTRIM(TO_CHAR(A.D4_QTY,'999,999,999,999'))) D4_QTY" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,2,LTRIM(TO_CHAR(A.D5_QTY,'999,999,999,999')),3,LTRIM(TO_CHAR(A.D5_QTY,'999,999,999,999')),4,DECODE(A.D5_QTY,NULL,'',LTRIM(TO_CHAR(ROUND(A.D5_QTY,1),'999,999,990.9'))||'%'),LTRIM(TO_CHAR(A.D5_QTY,'999,999,999,999'))) D5_QTY" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,2,LTRIM(TO_CHAR(A.D7_QTY,'999,999,999,999')),3,LTRIM(TO_CHAR(A.D7_QTY,'999,999,999,999')),4,DECODE(A.D7_QTY,NULL,'',LTRIM(TO_CHAR(ROUND(A.D7_QTY,1),'999,999,990.9'))||'%'),LTRIM(TO_CHAR(A.D7_QTY,'999,999,999,999'))) D7_QTY" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,2,LTRIM(TO_CHAR(A.R2_QTY,'999,999,999,999')),3,LTRIM(TO_CHAR(A.R2_QTY,'999,999,999,999')),4,DECODE(A.R2_QTY,NULL,'',LTRIM(TO_CHAR(ROUND(A.R2_QTY,1),'999,999,990.9'))||'%'),LTRIM(TO_CHAR(A.R2_QTY,'999,999,999,999'))) R2_QTY" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,2,LTRIM(TO_CHAR(A.R5_QTY,'999,999,999,999')),3,LTRIM(TO_CHAR(A.R5_QTY,'999,999,999,999')),4,DECODE(A.R5_QTY,NULL,'',LTRIM(TO_CHAR(ROUND(A.R5_QTY,1),'999,999,990.9'))||'%'),LTRIM(TO_CHAR(A.R5_QTY,'999,999,999,999'))) R5_QTY" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,2,LTRIM(TO_CHAR(A.R9_QTY,'999,999,999,999')),3,LTRIM(TO_CHAR(A.R9_QTY,'999,999,999,999')),4,DECODE(A.R9_QTY,NULL,'',LTRIM(TO_CHAR(ROUND(A.R9_QTY,1),'999,999,990.9'))||'%'),LTRIM(TO_CHAR(A.R9_QTY,'999,999,999,999'))) R9_QTY" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,2,LTRIM(TO_CHAR(A.O2_QTY,'999,999,999,999')),3,LTRIM(TO_CHAR(A.O2_QTY,'999,999,999,999')),4,DECODE(A.O2_QTY,NULL,'',LTRIM(TO_CHAR(ROUND(A.O2_QTY,1),'999,999,990.9'))||'%'),LTRIM(TO_CHAR(A.O2_QTY,'999,999,999,999'))) O2_QTY" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,2,LTRIM(TO_CHAR(A.S2_QTY,'999,999,999,999')),3,LTRIM(TO_CHAR(A.S2_QTY,'999,999,999,999')),4,DECODE(A.S2_QTY,NULL,'',LTRIM(TO_CHAR(ROUND(A.S2_QTY,1),'999,999,990.9'))||'%'),LTRIM(TO_CHAR(A.S2_QTY,'999,999,999,999'))) S2_QTY" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,2,LTRIM(TO_CHAR(A.O4_QTY,'999,999,999,999')),3,LTRIM(TO_CHAR(A.O4_QTY,'999,999,999,999')),4,DECODE(A.O4_QTY,NULL,'',LTRIM(TO_CHAR(ROUND(A.O4_QTY,1),'999,999,990.9'))||'%'),LTRIM(TO_CHAR(A.O4_QTY,'999,999,999,999'))) O4_QTY" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,2,LTRIM(TO_CHAR(A.S4_QTY,'999,999,999,999')),3,LTRIM(TO_CHAR(A.S4_QTY,'999,999,999,999')),4,DECODE(A.S4_QTY,NULL,'',LTRIM(TO_CHAR(ROUND(A.S4_QTY,1),'999,999,990.9'))||'%'),LTRIM(TO_CHAR(A.S4_QTY,'999,999,999,999'))) S4_QTY" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,2,LTRIM(TO_CHAR(A.F2_QTY,'999,999,999,999')),3,LTRIM(TO_CHAR(A.F2_QTY,'999,999,999,999')),4,DECODE(A.F2_QTY,NULL,'',LTRIM(TO_CHAR(ROUND(A.F2_QTY,1),'999,999,990.9'))||'%'),LTRIM(TO_CHAR(A.F2_QTY,'999,999,999,999'))) F2_QTY" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,2,LTRIM(TO_CHAR(A.A2_QTY,'999,999,999,999')),3,LTRIM(TO_CHAR(A.A2_QTY,'999,999,999,999')),4,DECODE(A.A2_QTY,NULL,'',LTRIM(TO_CHAR(ROUND(A.A2_QTY,1),'999,999,990.9'))||'%'),LTRIM(TO_CHAR(A.A2_QTY,'999,999,999,999'))) A2_QTY" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,2,LTRIM(TO_CHAR(A.F4_QTY,'999,999,999,999')),3,LTRIM(TO_CHAR(A.F4_QTY,'999,999,999,999')),4,DECODE(A.F4_QTY,NULL,'',LTRIM(TO_CHAR(ROUND(A.F4_QTY,1),'999,999,990.9'))||'%'),LTRIM(TO_CHAR(A.F4_QTY,'999,999,999,999'))) F4_QTY" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,2,LTRIM(TO_CHAR(A.A4_QTY,'999,999,999,999')),3,LTRIM(TO_CHAR(A.A4_QTY,'999,999,999,999')),4,DECODE(A.A4_QTY,NULL,'',LTRIM(TO_CHAR(ROUND(A.A4_QTY,1),'999,999,990.9'))||'%'),LTRIM(TO_CHAR(A.A4_QTY,'999,999,999,999'))) A4_QTY" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,2,LTRIM(TO_CHAR(A.F5_QTY,'999,999,999,999')),3,LTRIM(TO_CHAR(A.F5_QTY,'999,999,999,999')),4,DECODE(A.F5_QTY,NULL,'',LTRIM(TO_CHAR(ROUND(A.F5_QTY,1),'999,999,990.9'))||'%'),LTRIM(TO_CHAR(A.F5_QTY,'999,999,999,999'))) F5_QTY" ).append("\n"); 
		query.append("       ,DECODE(A.DP_SEQ,2,LTRIM(TO_CHAR(A.O5_QTY,'999,999,999,999')),3,LTRIM(TO_CHAR(A.O5_QTY,'999,999,999,999')),4,DECODE(A.O5_QTY,NULL,'',LTRIM(TO_CHAR(ROUND(A.O5_QTY,1),'999,999,990.9'))||'%'),LTRIM(TO_CHAR(A.O5_QTY,'999,999,999,999'))) O5_QTY" ).append("\n"); 
		query.append("FROM LV_QTY_LIST2 A" ).append("\n"); 
		query.append("WHERE A.DP_SEQ IS NOT NULL" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${div_flag} == '1' )		" ).append("\n"); 
		query.append("    #if (${loc_tp_cd} == 'E' )" ).append("\n"); 
		query.append("       --AND A.LOC_CD <> 'ZZZZ9' -- SUB TOTAL 제외" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("    #if (${loc_tp_cd} == 'L' && ${loc_cd} =='HKHKG' )" ).append("\n"); 
		query.append("       AND A.LOC_CD <> 'ZZZZ9' -- SUB TOTAL 제외" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("#elseif (${div_flag} == '2' )	" ).append("\n"); 
		query.append("       AND A.LOC_CD <> 'ZZZZ9' -- SUB TOTAL 제외" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if ( ${fm_week} == ${to_week} )" ).append("\n"); 
		query.append("	AND A.YRWK <> '999999' -- 검색주차가 1주이면 FINAL TOTAL 을 제외" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("-- 2번째 쉬트의 계산" ).append("\n"); 
		query.append("UNION ALL" ).append("\n"); 
		query.append("SELECT *" ).append("\n"); 
		query.append("FROM " ).append("\n"); 
		query.append("    (" ).append("\n"); 
		query.append("    SELECT A.BOUND" ).append("\n"); 
		query.append("          ,MAX(DECODE(A.ROWNUM_SEQ,1,A.LOC_CD||'('||LTRIM(TO_CHAR(ROUND(A.TOT_QTY,1),'999,999,990.9'))||'%)')) QTY1" ).append("\n"); 
		query.append("          ,MAX(DECODE(A.ROWNUM_SEQ,2,A.LOC_CD||'('||LTRIM(TO_CHAR(ROUND(A.TOT_QTY,1),'999,999,990.9'))||'%)')) QTY2" ).append("\n"); 
		query.append("          ,MAX(DECODE(A.ROWNUM_SEQ,3,A.LOC_CD||'('||LTRIM(TO_CHAR(ROUND(A.TOT_QTY,1),'999,999,990.9'))||'%)')) QTY3" ).append("\n"); 
		query.append("          ,MAX(DECODE(A.ROWNUM_SEQ,4,A.LOC_CD||'('||LTRIM(TO_CHAR(ROUND(A.TOT_QTY,1),'999,999,990.9'))||'%)')) QTY4" ).append("\n"); 
		query.append("          ,MAX(DECODE(A.ROWNUM_SEQ,5,A.LOC_CD||'('||LTRIM(TO_CHAR(ROUND(A.TOT_QTY,1),'999,999,990.9'))||'%)')) QTY5" ).append("\n"); 
		query.append("          ,MAX(DECODE(A.ROWNUM_SEQ,6,A.LOC_CD||'('||LTRIM(TO_CHAR(ROUND(A.TOT_QTY,1),'999,999,990.9'))||'%)')) QTY6" ).append("\n"); 
		query.append("          ,MAX(DECODE(A.ROWNUM_SEQ,7,A.LOC_CD||'('||LTRIM(TO_CHAR(ROUND(A.TOT_QTY,1),'999,999,990.9'))||'%)')) QTY7" ).append("\n"); 
		query.append("          ,MAX(DECODE(A.ROWNUM_SEQ,8,A.LOC_CD||'('||LTRIM(TO_CHAR(ROUND(A.TOT_QTY,1),'999,999,990.9'))||'%)')) QTY8" ).append("\n"); 
		query.append("          ,MAX(DECODE(A.ROWNUM_SEQ,9,A.LOC_CD||'('||LTRIM(TO_CHAR(ROUND(A.TOT_QTY,1),'999,999,990.9'))||'%)')) QTY9" ).append("\n"); 
		query.append("		  ,MAX(DECODE(A.ROWNUM_SEQ,10,A.LOC_CD||'('||LTRIM(TO_CHAR(ROUND(A.TOT_QTY,1),'999,999,990.9'))||'%)')) QTY10" ).append("\n"); 
		query.append("       	  ,'0' QTY11" ).append("\n"); 
		query.append("	      ,'0' QTY12" ).append("\n"); 
		query.append("       	  ,'0' QTY13" ).append("\n"); 
		query.append("       	  ,'0' QTY14" ).append("\n"); 
		query.append("       	  ,'0' QTY15" ).append("\n"); 
		query.append("       	  ,'0' QTY16" ).append("\n"); 
		query.append("       	  ,'0' QTY17" ).append("\n"); 
		query.append("       	  ,'0' QTY18" ).append("\n"); 
		query.append("       	  ,'0' QTY19" ).append("\n"); 
		query.append("       	  ,'0' QTY20" ).append("\n"); 
		query.append("       	  ,'0' QTY21" ).append("\n"); 
		query.append("       	  ,'HIDDEN' QTY22" ).append("\n"); 
		query.append("    FROM" ).append("\n"); 
		query.append("        (" ).append("\n"); 
		query.append("        SELECT A.BOUND" ).append("\n"); 
		query.append("              ,A.LOC_CD" ).append("\n"); 
		query.append("              ,TOT_QTY" ).append("\n"); 
		query.append("              ,RANK()       OVER(PARTITION BY A.BOUND ORDER BY A.TOT_QTY) RANK_SEQ" ).append("\n"); 
		query.append("              ,ROW_NUMBER() OVER(PARTITION BY A.BOUND ORDER BY A.TOT_QTY) ROWNUM_SEQ" ).append("\n"); 
		query.append("        FROM LV_QTY_LIST2 A" ).append("\n"); 
		query.append("        WHERE A.DP_SEQ = 4" ).append("\n"); 
		query.append("        AND   A.YRWK = '999999'" ).append("\n"); 
		query.append("        AND   A.LOC_CD <> 'ZZZZ9'" ).append("\n"); 
		query.append("        ) A" ).append("\n"); 
		query.append("    GROUP BY A.BOUND" ).append("\n"); 
		query.append("    ORDER BY A.BOUND DESC" ).append("\n"); 
		query.append(")" ).append("\n"); 

	}
}