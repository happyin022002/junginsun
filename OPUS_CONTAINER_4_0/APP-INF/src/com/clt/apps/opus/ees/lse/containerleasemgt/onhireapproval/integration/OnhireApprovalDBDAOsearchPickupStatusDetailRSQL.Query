<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OnhireApprovalDBDAOsearchPickupStatusDetailRSQL">
			<desc><![CDATA[장/단기 컨테이너 임차계약후 pick-up 승인에 대한 pick-up 수량을 상세조회]]></desc>
			<sql><![CDATA[
SELECT  V1.CNTR_NO
      , V1.CNTR_TPSZ_CD
      , V1.CNTR_AUTH_NO
      , V1.AGMT_CTY_CD || LTRIM(TO_CHAR( V1.AGMT_SEQ, '000000'))      AS AGMT_NO
      , SUBSTR(V1.YD_CD, 1, 5)                                        AS ON_HIRE_LOC
      ,(SELECT TO_CHAR(PKUP_FM_DT, 'YYYY-MM-DD') FROM LSE_ONH_APRO LA WHERE LA.CNTR_ONH_AUTH_NO = V1.CNTR_AUTH_NO) AS PKUP_FM_DT
      ,(SELECT TO_CHAR(PKUP_DUE_DT, 'YYYY-MM-DD') FROM LSE_ONH_APRO LA WHERE LA.CNTR_ONH_AUTH_NO = V1.CNTR_AUTH_NO) AS DUE_DT
      ,(SELECT MV.VNDR_ABBR_NM
          FROM MDM_VENDOR MV
         WHERE MV.VNDR_SEQ = V1.VNDR_SEQ
           AND ROWNUM      = 1
       )                                                              AS LESSOR
      , TO_CHAR(V1.CNTR_STS_EVNT_DT, 'YYYY-MM-DD')                    AS CNTR_EVNT_DT
	  , TO_CHAR(V1.ONH_DT, 'YYYY-MM-DD')                              AS ON_HIRE_DT
      , V1.CNMV_STS_CD                                                AS MVNT
      , TO_CHAR(V1.CNMV_DT, 'YYYY-MM-DD')                             AS MVMT_DT
      , V1.FRDAY                                                      AS F_DAYS
      , DECODE(V1.NEW_VAN_TP_CD, 'N' , 'NEW', 'OLD')                  AS DIV
      , SUBSTR(V3.YD_CD, 1, 5)                                        AS OFF_HIRE_LOC
      , TO_CHAR(V3.CNTR_STS_EVNT_DT, 'YYYY-MM-DD')                    AS OFF_HIRE_DT
      , DECODE(V1.CNTR_STS_EVNT_DT, NULL 
              , TRUNC(SYSDATE - V1.CNTR_STS_EVNT_DT)
              , TRUNC(V3.CNTR_STS_EVNT_DT - V1.CNTR_STS_EVNT_DT)) + 1 AS USING_DAY
      , NVL(V1.MINHR, 0)                                              AS MIN_DAYS
FROM  ( 
#if(${lstm_tp_cd} == 'O')
		SELECT  A.CNTR_STS_SEQ
              , A.YD_CD
              , A.CNTR_STS_EVNT_DT
			  #if(${lstm_tp_cd} == 'O') 
			  , B.ONH_DT
              #else
              , A.CNTR_STS_EVNT_DT AS ONH_DT
			  #end
              , A.RNTL_CHG_FREE_DYS FRDAY
              , A.CNTR_MIN_ONH_DYS MINHR
              , A.CNTR_STS_CD
              , B.SYS_AREA_GRP_ID
              , B.CNMV_STS_CD
              , B.CNMV_DT
              , A.CNTR_AUTH_NO
              , A.AGMT_CTY_CD
              , A.AGMT_SEQ
              , B.CNTR_TPSZ_CD
              , A.CNTR_NO
              , B.LSTM_CD
              , DECODE(A.CNTR_OLD_VAN_FLG, 'Y', 'O', 'N', 'N') NEW_VAN_TP_CD
              , B.VNDR_SEQ
        FROM    MST_CNTR_STS_HIS A
              , MST_CONTAINER    B 
        WHERE   A.CNTR_NO     = B.CNTR_NO
        AND     'SELLOE'     <> SUBSTR(NVL(A.CNTR_STS_RMK, ' '), 1, 6)
        AND     'N'           = A.CNTR_LSTM_CNG_FLG
        AND     A.CNTR_STS_CD IN ('LSI', 'OWN')
        AND     A.AGMT_SEQ    <> 999990
        AND     A.CNTR_AUTH_NO > ' '
#if (${auth_no} != '' )
   #if (${detail_auth_no} != '' )
        AND    A.CNTR_AUTH_NO = @[detail_auth_no]
   #else
        AND    A.CNTR_AUTH_NO = @[auth_no]
   #end
#else
   #if (${detail_auth_no} != '' )
        AND    A.CNTR_AUTH_NO = @[detail_auth_no]
   #end
#end
#if (${agmt_seq} != '' )
   #if (${detail_agmt_seq} != '' )
        AND    A.AGMT_CTY_CD  = @[detail_agmt_cty_cd]
        AND    A.AGMT_SEQ     = @[detail_agmt_seq]
   #else
        AND    A.AGMT_CTY_CD  = @[agmt_cty_cd]
        AND    A.AGMT_SEQ     = @[agmt_seq]
   #end
#else
   #if (${detail_agmt_seq} != '' )
        AND    A.AGMT_CTY_CD  = @[detail_agmt_cty_cd]
        AND    A.AGMT_SEQ     = @[detail_agmt_seq]
   #end
#end
#if (${cntr_tpsz_cd_str} != '' )
   #if (${detail_cntr_tpsz_cd} != '' )
        AND    B.CNTR_TPSZ_CD = @[detail_cntr_tpsz_cd]
   #else
        AND    B.CNTR_TPSZ_CD IN( #foreach($key IN ${cntr_tpsz_cd})
                                       #if($velocityCount < $cntr_tpsz_cd.size())
                                          '$key',
                                       #else
                                          '$key'
                                       #end
                                   #end )
   #end
#else
   #if (${detail_cntr_tpsz_cd} != '' )
        AND    B.CNTR_TPSZ_CD = @[detail_cntr_tpsz_cd]
   #end
#end
#if (${new_van_tp_cd} == 'N' )
        AND    A.CNTR_OLD_VAN_FLG = 'N' 
#elseif(${new_van_tp_cd} == 'O' ) 
        AND    A.CNTR_OLD_VAN_FLG = 'Y' 
#end
#if (${auth_no} != '' )
        AND    A.CNTR_AUTH_NO = @[auth_no]
#end
#if (${pkup_due_dt} != '' )
        AND    TO_DATE(SUBSTR(A.CNTR_AUTH_NO , 6,8), 'YYYYMMDD') <= TO_DATE(@[pkup_due_dt], 'YYYYMMDD')
#end
#if (${period_stdt} != '' )
    #if(${lstm_tp_cd} == 'Y') 
        AND    B.ONH_DT BETWEEN TO_DATE(@[period_stdt], 'YYYYMMDD') AND TO_DATE(@[period_eddt], 'YYYYMMDD')+ 0.99999
    #else
        AND    A.CNTR_STS_EVNT_DT BETWEEN TO_DATE(@[period_stdt], 'YYYYMMDD') AND TO_DATE(@[period_eddt], 'YYYYMMDD')+ 0.99999
    #end
#end
        AND    A.CNTR_AUTH_NO in (SELECT  A.CNTR_ONH_AUTH_NO
                                  FROM    LSE_ONH_APRO      A
                                        , LSE_ONH_APRO_QTY  B
                                  WHERE   A.CNTR_ONH_AUTH_NO = B.CNTR_ONH_AUTH_NO
                                  AND     A.AGMT_CTY_CD      = B.AGMT_CTY_CD
                                  AND     A.AGMT_SEQ         = B.AGMT_SEQ
                                  AND     A.DELT_FLG <>'Y'
#if (${loc_cd} != '' )
                                  AND     A.ONH_LOC_CD IN (SELECT DISTINCT SCC_CD
                                                      FROM   MDM_EQ_ORZ_CHT A
                                                      WHERE  DECODE(@[loc_tp], 'R', A.RCC_CD, 'L', A.LCC_CD, 'S', A.SCC_CD) = @[loc_cd] )
#end )
#end

#if(${lstm_tp_cd} == 'L')
SELECT  A.CNTR_STS_SEQ
              , A.YD_CD
              , A.CNTR_STS_EVNT_DT
              #if(${lstm_tp_cd} == 'O') 
			  , B.ONH_DT
              #else
              , A.CNTR_STS_EVNT_DT AS ONH_DT
			  #end
              , A.RNTL_CHG_FREE_DYS FRDAY
              , A.CNTR_MIN_ONH_DYS MINHR
              , A.CNTR_STS_CD
              , B.SYS_AREA_GRP_ID
              , B.CNMV_STS_CD
              , B.CNMV_DT
              , A.CNTR_OFFH_AUTH_NO AS CNTR_AUTH_NO
              , A.AGMT_CTY_CD
              , A.AGMT_SEQ
              , B.CNTR_TPSZ_CD
              , A.CNTR_NO
              , B.LSTM_CD
              , DECODE(A.CNTR_OLD_VAN_FLG, 'Y', 'O', 'N', 'N') NEW_VAN_TP_CD
              , B.VNDR_SEQ
        FROM    MST_CNTR_STS_HIS A
              , MST_CONTAINER    B 
        WHERE   A.CNTR_NO     = B.CNTR_NO
        AND     'SELLOE'     <> SUBSTR(NVL(A.CNTR_STS_RMK, ' '), 1, 6)
        AND     'N'           = A.CNTR_LSTM_CNG_FLG
        AND     A.CNTR_STS_CD IN ('SBO', 'MUO')
        AND     A.AGMT_SEQ    <> 999990
        AND     A.CNTR_OFFH_AUTH_NO > ' '
#if (${auth_no} != '' )
   #if (${detail_auth_no} != '' )
        AND    A.CNTR_OFFH_AUTH_NO = @[detail_auth_no]
   #else
        AND    A.CNTR_OFFH_AUTH_NO = @[auth_no]
   #end
#else
   #if (${detail_auth_no} != '' )
        AND    A.CNTR_OFFH_AUTH_NO = @[detail_auth_no]
   #end
#end
#if (${agmt_seq} != '' )
   #if (${detail_agmt_seq} != '' )
        AND    A.AGMT_CTY_CD  = @[detail_agmt_cty_cd]
        AND    A.AGMT_SEQ     = @[detail_agmt_seq]
   #else
        AND    A.AGMT_CTY_CD  = @[agmt_cty_cd]
        AND    A.AGMT_SEQ     = @[agmt_seq]
   #end
#else
   #if (${detail_agmt_seq} != '' )
        AND    A.AGMT_CTY_CD  = @[detail_agmt_cty_cd]
        AND    A.AGMT_SEQ     = @[detail_agmt_seq]
   #end
#end
#if (${cntr_tpsz_cd_str} != '' )
   #if (${detail_cntr_tpsz_cd} != '' )
        AND    B.CNTR_TPSZ_CD = @[detail_cntr_tpsz_cd]
   #else
        AND    B.CNTR_TPSZ_CD IN( #foreach($key IN ${cntr_tpsz_cd})
                                       #if($velocityCount < $cntr_tpsz_cd.size())
                                          '$key',
                                       #else
                                          '$key'
                                       #end
                                   #end )
   #end
#else
   #if (${detail_cntr_tpsz_cd} != '' )
        AND    B.CNTR_TPSZ_CD = @[detail_cntr_tpsz_cd]
   #end
#end
#if (${new_van_tp_cd} == 'N' )
        AND    A.CNTR_OLD_VAN_FLG = 'N' 
#elseif(${new_van_tp_cd} == 'O' ) 
        AND    A.CNTR_OLD_VAN_FLG = 'Y' 
#end
#if (${auth_no} != '' )
        AND    A.CNTR_OFFH_AUTH_NO = @[auth_no]
#end
#if (${pkup_due_dt} != '' )
        AND    TO_DATE(SUBSTR(A.CNTR_OFFH_AUTH_NO , 6,8), 'YYYYMMDD') <= TO_DATE(@[pkup_due_dt], 'YYYYMMDD')
#end
#if (${period_stdt} != '' )
    #if(${lstm_tp_cd} == 'Y') 
        AND    B.ONH_DT BETWEEN TO_DATE(@[period_stdt], 'YYYYMMDD') AND TO_DATE(@[period_eddt], 'YYYYMMDD')+ 0.99999
    #else
        AND    A.CNTR_STS_EVNT_DT BETWEEN TO_DATE(@[period_stdt], 'YYYYMMDD') AND TO_DATE(@[period_eddt], 'YYYYMMDD')+ 0.99999
    #end
#end
        AND    A.CNTR_OFFH_AUTH_NO in (SELECT  A.CNTR_ONH_AUTH_NO
                                  FROM    LSE_ONH_APRO      A
                                        , LSE_ONH_APRO_QTY  B
                                  WHERE   A.CNTR_ONH_AUTH_NO = B.CNTR_ONH_AUTH_NO
                                  AND     A.AGMT_CTY_CD      = B.AGMT_CTY_CD
                                  AND     A.AGMT_SEQ         = B.AGMT_SEQ
                                  AND     A.DELT_FLG <>'Y'
#if (${loc_cd} != '' )
                                  AND     A.ONH_LOC_CD IN (SELECT DISTINCT SCC_CD
                                                      FROM   MDM_EQ_ORZ_CHT A
                                                      WHERE  DECODE(@[loc_tp], 'R', A.RCC_CD, 'L', A.LCC_CD, 'S', A.SCC_CD) = @[loc_cd])
#end)
#end
 ) V1 ,
        ( SELECT  A.CNTR_ONH_AUTH_NO
                , A.AGMT_CTY_CD
                , A.AGMT_SEQ
                , B.CNTR_TPSZ_CD
                , B.ONH_QTY
                , A.LSTM_CD
                , B.NEW_VAN_TP_CD
				, A.PKUP_FM_DT
				, A.PKUP_DUE_DT
          FROM    LSE_ONH_APRO      A
                , LSE_ONH_APRO_QTY  B
          WHERE   A.CNTR_ONH_AUTH_NO = B.CNTR_ONH_AUTH_NO
          AND     A.AGMT_CTY_CD      = B.AGMT_CTY_CD
          AND     A.AGMT_SEQ         = B.AGMT_SEQ
          AND     B.ONH_QTY         <> 0
          AND     A.DELT_FLG         = 'N'
#if (${auth_no} != '' )
   #if (${detail_auth_no} != '' )
          AND     A.CNTR_ONH_AUTH_NO = @[detail_auth_no]
   #else
          AND     A.CNTR_ONH_AUTH_NO = @[auth_no]
   #end
#else
   #if (${detail_auth_no} != '' )
          AND A.CNTR_ONH_AUTH_NO = @[detail_auth_no]
   #end
#end  

#if (${agmt_seq} != '' )
   #if (${detail_agmt_seq} != '' )
          AND     A.AGMT_CTY_CD  = @[detail_agmt_cty_cd]
          AND     A.AGMT_SEQ     = @[detail_agmt_seq]
   #else
          AND     A.AGMT_CTY_CD  = @[agmt_cty_cd]
          AND     A.AGMT_SEQ     = @[agmt_seq]
   #end
#else
   #if (${detail_agmt_seq} != '' )
          AND     A.AGMT_CTY_CD  = @[detail_agmt_cty_cd]
          AND     A.AGMT_SEQ     = @[detail_agmt_seq]
   #end
#end
#if (${lstm_cd_str} != '' )
          AND     A.LSTM_CD IN ( #foreach($key IN ${lstm_cd})
                                   #if($velocityCount < $lstm_cd.size())
                                      '$key',
                                   #else
                                      '$key'
                                   #end
                               #end )
#end
#if (${cntr_tpsz_cd_str} != '' )
   #if (${detail_cntr_tpsz_cd} != '' )
          AND B.CNTR_TPSZ_CD = @[detail_cntr_tpsz_cd]
   #else
          AND B.CNTR_TPSZ_CD IN( #foreach($key IN ${cntr_tpsz_cd})
                                       #if($velocityCount < $cntr_tpsz_cd.size())
                                          '$key',
                                       #else
                                          '$key'
                                       #end
                                   #end )
   #end
#else
   #if (${detail_cntr_tpsz_cd} != '' )
          AND B.CNTR_TPSZ_CD = @[detail_cntr_tpsz_cd]
   #end
#end
#if (${new_van_tp_cd} != '' )
          AND B.NEW_VAN_TP_CD = @[new_van_tp_cd]
#else
          AND B.NEW_VAN_TP_CD IN('N','O')
#end
#if (${pkup_due_dt} != '' )
          AND A.PKUP_DUE_DT <= TO_DATE(@[pkup_due_dt], 'YYYYMMDD')
#end
#if (${loc_cd} != '' )
          AND A.ONH_LOC_CD IN (SELECT DISTINCT LCC_CD
                               FROM   MDM_EQ_ORZ_CHT A
                               WHERE  DECODE(@[loc_tp], 'R', A.RCC_CD, 'L', A.LCC_CD, 'S', A.SCC_CD) = @[loc_cd])
#end
          ) V2 , MST_CNTR_STS_HIS V3
WHERE    V1.CNTR_AUTH_NO  = V2.CNTR_ONH_AUTH_NO (+)
AND      V1.AGMT_CTY_CD   = V2.AGMT_CTY_CD      (+)
AND      V1.AGMT_SEQ      = V2.AGMT_SEQ         (+)
AND      V1.CNTR_TPSZ_CD  = V2.CNTR_TPSZ_CD     (+)
AND      V1.LSTM_CD       = V2.LSTM_CD          (+)
AND      V1.NEW_VAN_TP_CD = V2.NEW_VAN_TP_CD    (+)
AND      V1.CNTR_NO       = V3.CNTR_NO          (+)
AND      V1.CNTR_STS_SEQ  = V3.PRNR_STS_SEQ     (+)
#if (${lstm_cd_str} != '' )
AND      V2.LSTM_CD(+) IN ( #foreach($key IN ${lstm_cd})
                            #if($velocityCount < $lstm_cd.size())
                               '$key',
                            #else
                               '$key'
                            #end
                         #end )
#end			]]></sql>
			<params>
				<param name="detail_auth_no" type="12" value="" out="N"/>
				<param name="auth_no" type="12" value="" out="N"/>
				<param name="detail_agmt_cty_cd" type="12" value="" out="N"/>
				<param name="detail_agmt_seq" type="12" value="" out="N"/>
				<param name="agmt_cty_cd" type="12" value="" out="N"/>
				<param name="agmt_seq" type="12" value="" out="N"/>
				<param name="detail_cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="pkup_due_dt" type="12" value="" out="N"/>
				<param name="period_stdt" type="12" value="" out="N"/>
				<param name="period_eddt" type="12" value="" out="N"/>
				<param name="loc_tp" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="new_van_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
