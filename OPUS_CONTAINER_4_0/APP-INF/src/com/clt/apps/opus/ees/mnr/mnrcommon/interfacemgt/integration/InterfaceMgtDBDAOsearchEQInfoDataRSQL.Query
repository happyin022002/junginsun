<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InterfaceMgtDBDAOsearchEQInfoDataRSQL">
			<desc><![CDATA[DESC Enter..]]></desc>
			<sql><![CDATA[
SELECT ACT_IND,
       EQ_TYPE,
       EQ_TPSZ_CD,
       EQ_NO,
       (SELECT NVL(DECODE(FULL_FLG, 'Y', 'F', 'E'), '')
          FROM MST_CONTAINER
         WHERE CNTR_NO = @[eq_no]) CNTR_STS_CD
  FROM MNR_EQ_STS_V
 WHERE 1=1
   AND EQ_NO = @[eq_no]
#if(${knd_cd} == 'S')
   AND CASE WHEN    
            (SELECT LSTM_CD 
               FROM LSE_AGREEMENT
              WHERE (AGMT_CTY_CD, AGMT_SEQ) = ( SELECT /*+ INDEX_DESC (A XAK1MST_CNTR_STS_HIS) */ AGMT_CTY_CD, AGMT_SEQ
                                                  FROM MST_CNTR_STS_HIS A
                                                 WHERE A.CNTR_NO = @[eq_no]
                                                   AND A.CNTR_STS_EVNT_DT <= TO_DATE(@[total_loss_date], 'YYYYMMDD')
                                                   AND ROWNUM = 1)) = 'SH' THEN CASE WHEN 
                                                                                  EXISTS (SELECT 'X'
                                                                                            FROM MST_CNTR_STS_HIS A
                                                                                           WHERE A.CNTR_NO = @[eq_no]
                                                                                             AND A.CNTR_STS_EVNT_DT = TO_DATE(@[total_loss_date], 'YYYYMMDD')
                                                                                             AND A.CNTR_STS_CD = 'SBO' 
                                                                                          ) THEN 'HH' ELSE 'SH' END
                                                                    ELSE CASE WHEN 
                                                                         (SELECT /*+ INDEX_DESC (A XAK1MST_CNTR_STS_HIS) */ CNTR_STS_CD
                                                                            FROM MST_CNTR_STS_HIS A
                                                                           WHERE A.CNTR_NO = @[eq_no]
                                                                             AND A.CNTR_STS_EVNT_DT <= TO_DATE(@[total_loss_date], 'YYYYMMDD')
                                                                             AND ROWNUM = 1) IN ('LSO', 'SBO', 'MUO') THEN CASE WHEN 
                                                                                                                           (SELECT /*+ INDEX_DESC (A XAK1MST_CNTR_STS_HIS) */ CNTR_STS_CD
                                                                                                                              FROM MST_CNTR_STS_HIS A
                                                                                                                             WHERE A.CNTR_NO = @[eq_no]
                                                                                                                               AND A.CNTR_STS_EVNT_DT = TO_DATE(@[total_loss_date], 'YYYYMMDD')
                                                                                                                               AND ROWNUM = 1
                                                                                                                               ) IN ('LSO', 'SBO', 'MUO') THEN 'HH' ELSE 'SH' END ELSE 'HH' END END <> 'SH'
#else
AND 'XX' <> (CASE WHEN (SELECT /*+ INDEX_ASC (A XUK1CTM_MOVEMENT) */
                                MVMT_STS_CD
                            FROM CTM_MOVEMENT A
                           WHERE CNTR_NO = @[eq_no]
                             AND TO_CHAR(CNMV_EVNT_DT, 'YYYYMMDD') = @[total_loss_date]
                             AND ROWNUM = 1) = 'XX' THEN 'XX'
                    ELSE CASE WHEN (SELECT /*+ INDEX_DESC (A XUK1CTM_MOVEMENT) */
                                           MVMT_STS_CD
                                       FROM CTM_MOVEMENT A
                                      WHERE CNTR_NO = @[eq_no]
                                        AND TO_CHAR(CNMV_EVNT_DT, 'YYYYMMDD') <= @[total_loss_date]
                                        AND ROWNUM = 1) = 'XX' THEN 'XX' ELSE 'HH' END END)
#end			]]></sql>
			<params>
				<param name="eq_no" type="12" value="" out="N"/>
				<param name="total_loss_date" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
