<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChargeCalculationDBDAOSearchChargeBySZPBBRSQL">
			<desc><![CDATA[DESC Enter..]]></desc>
			<sql><![CDATA[
SELECT
	C.SYS_AREA_GRP_ID SVR_ID
    --,C.DMDT_CHG_STS_CD
	,'' AS DMDT_CHG_STS_CD
    ,C.CNTR_NO    
    ,B.CNTR_TPSZ_CD
    ,C.FM_MVMT_YD_CD
    ,C.TO_MVMT_YD_CD
    ,C.FM_MVMT_STS_CD
    ,C.TO_MVMT_STS_CD
    --,C.DMDT_TRF_CD
	,'' AS DMDT_TRF_CD
    ,C.FT_DYS
    ,C.FX_FT_OVR_DYS
    ,TO_CHAR(C.FM_MVMT_DT, 'YYYYMMDD') FM_MVMT_DT
    ,TO_CHAR(C.TO_MVMT_DT, 'YYYYMMDD') TO_MVMT_DT
    ,TO_CHAR(C.FT_CMNC_DT, 'YYYYMMDD') FT_CMNC_DT
    ,TO_CHAR(C.FT_END_DT, 'YYYYMMDD') FT_END_DT
    ,C.BZC_TRF_CURR_CD
    --,C.ORG_CHG_AMT
    --,C.SC_RFA_EXPT_AMT    
    --,C.AFT_EXPT_DC_AMT
    ,C.BIL_AMT
    ,B.BKG_NO
    ,B.BL_NO
    ,B.VSL_CD || B.SKD_VOY_NO || B.SKD_DIR_CD AS VVD_CD    
    ,( SELECT	V.VSL_SLAN_CD LANE   
       FROM		VSK_VSL_SKD V
       WHERE	B.VSL_CD		=	V.VSL_CD
       AND		B.SKD_VOY_NO	=	V.SKD_VOY_NO
       AND		B.SKD_DIR_CD	=	V.SKD_DIR_CD
    ) AS LANE
    ,B.POR_CD
    ,B.POL_CD
    ,B.POD_CD
    ,B.DEL_CD
    ,B.BKG_RCV_TERM_CD
    ,B.BKG_DE_TERM_CD
    ,B.SC_NO
    ,B.RFA_NO
    ,DECODE( BK.AGMT_ACT_CNT_CD||TRIM(TO_CHAR(BK.AGMT_ACT_CUST_SEQ, '000000')),'000000', NULL
        	,BK.AGMT_ACT_CNT_CD||TRIM(TO_CHAR(BK.AGMT_ACT_CUST_SEQ, '000000')) ) AS ACUST	
    --,DECODE(C.CHG_SEQ, 1, 'G', 'B') AS CHG_TYPE
	,C.CHG_SEQ
	,NVL(B.SOC_FLG, 'N') AS SOC_FLG    
	,(	SELECT 'Y'
    	FROM DUAL      
    	WHERE EXISTS (
    		SELECT  BDD.RLSE_STS_CD
    		FROM    BKG_DO     BDO,
            		BKG_DO_DTL BDD
    		WHERE BDO.BKG_NO        = BDD.BKG_NO
   			AND   BDO.BKG_NO        = B.BKG_NO
    			AND   BDD.RLSE_STS_CD IN ('R', 'I')) ) AS D_O
	,(	SELECT  BDD.EVNT_OFC_CD
    	FROM    BKG_DO     BDO,
        	    BKG_DO_DTL BDD
    	WHERE	BDO.BKG_NO	= BDD.BKG_NO   
    		AND BDO.BKG_NO	= B.BKG_NO   
    		AND BDD.RLSE_STS_CD IN ('R', 'I')
			AND	ROWNUM=1 ) AS RLSE_OFC
	--,NVL(C.OFC_TRNS_FLG, 'N') AS OFC_TRNS_FLG
	,(	SELECT 'S'
		FROM DUAL
    	WHERE EXISTS (
    		SELECT 1
    		FROM	BKG_ROLL_OVR R
    		WHERE	R.BKG_NO = B.BKG_NO    			
    			AND R.ROLL_OVR_RSN_CD = 'S') ) AS ROLL_OVR	
    ,C.WEB_IND_FLG
    ,C.CNTR_CYC_NO
    ,C.DMDT_CHG_LOC_DIV_CD	
	,C.OFC_CD
	,C.OFC_RHQ_CD

	,'' AS DMDT_INV_NO
	,'' AS ISS_DT
	,'' AS INV_CURR_CD
	,NULL AS INV_CHG_AMT
	
	,DECODE( C.ACT_CNT_CD || TO_CHAR(C.ACT_CUST_SEQ, 'FM000000')
			,'000000' , NULL, C.ACT_CNT_CD || TO_CHAR(C.ACT_CUST_SEQ, 'FM000000')) PAYER_CD
	,CASE
	WHEN C.DMDT_TRF_CD='DTIC' AND B.BKG_DE_TERM_CD='Y' AND INSTR(NVL(B.POD_CD,'  '),'US')=1 THEN
		(	SELECT MV.VNDR_LGL_ENG_NM
	   		FROM MDM_VENDOR MV
	   		WHERE MV.VNDR_SEQ = C.VNDR_SEQ	)
	WHEN C.DMDT_TRF_CD='DTOC' AND B.BKG_RCV_TERM_CD='Y' AND INSTR(NVL(B.POL_CD,'  '),'US')=1 THEN
		(	SELECT MV.VNDR_LGL_ENG_NM
			FROM MDM_VENDOR MV
	   		WHERE MV.VNDR_SEQ = C.VNDR_SEQ	)
	WHEN C.DMDT_TRF_CD IN ('DMIF','CTIC') OR (C.DMDT_TRF_CD='DTIC' AND INSTR(NVL(B.POD_CD,'  '),'US')<>1) THEN
		(	SELECT MC.CUST_LGL_ENG_NM
			FROM MDM_CUSTOMER MC
			WHERE MC.CUST_CNT_CD = C.ACT_CNT_CD
			AND MC.CUST_SEQ = C.ACT_CUST_SEQ	)
	WHEN C.DMDT_TRF_CD IN ('DMOF','CTOC') OR (C.DMDT_TRF_CD='DTOC' AND INSTR(NVL(B.POL_CD,'  '),'US')<>1) THEN
			REPLACE(BS.CUST_NM, CHR(13)||CHR(10),' ')
	END AS PAYER_NM
    ,BS.CUST_CNT_CD || TRIM(TO_CHAR(BS.CUST_SEQ, '000000')) SHIPPER_CD 
    ,REPLACE(BS.CUST_NM, CHR(13) || CHR(10), ' ') SHIPPER_NM   
    ,DECODE(BC.CUST_CNT_CD || TRIM(TO_CHAR(BC.CUST_SEQ, '000000')), '000000', NULL, BC.CUST_CNT_CD || TRIM(TO_CHAR(BC.CUST_SEQ, '000000'))) CNEE_CD
    ,REPLACE(BC.CUST_NM, CHR(13) || CHR(10), ' ') CNEE_NM
    ,DECODE(BN.CUST_CNT_CD || TRIM(TO_CHAR(BN.CUST_SEQ, '000000')), '000000', NULL, BN.CUST_CNT_CD || TRIM(TO_CHAR(BN.CUST_SEQ, '000000'))) NTFY_CD
    ,NVL(RTRIM(REPLACE(REPLACE(BN.CUST_NM, CHR(34), ''), CHR(13)||CHR(10), ' ')), '-') NTFY_NM
	,(	SELECT  I.ACT_CUST_CNT_CD || TRIM(TO_CHAR(ACT_CUST_SEQ, '000000'))
    	FROM    INV_AR_MN I
    	WHERE   I.BKG_NO = B.BKG_NO
    	AND     I.IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
		AND		AR_IF_NO	= (
                    SELECT	MAX(AR_IF_NO) 
                    FROM	INV_AR_MN
                    WHERE	BKG_NO = B.BKG_NO
                    AND		IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
    	            )
		AND     ROWNUM  = 1
	) AS AR_ACT_CD
	,(	SELECT	MC.CUST_LGL_ENG_NM
		FROM 	MDM_CUSTOMER MC, INV_AR_MN I
		WHERE	MC.CUST_CNT_CD = I.ACT_CUST_CNT_CD
		AND		MC.CUST_SEQ    = I.ACT_CUST_SEQ
		AND		I.BKG_NO = B.BKG_NO
		AND		I.IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
		AND		AR_IF_NO	= (
                    SELECT	MAX(AR_IF_NO) 
                    FROM	INV_AR_MN
                    WHERE	BKG_NO = B.BKG_NO
                    AND		IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
    	            )
		AND		ROWNUM  = 1
	) AS AR_ACT_NM
	,DECODE(TRIM(TO_CHAR(C.VNDR_SEQ, '000000')), '000000', NULL, TRIM(TO_CHAR(C.VNDR_SEQ, '000000'))) AS SVC_PROVDR_CD
	,(SELECT MV.VNDR_LGL_ENG_NM
	   FROM MDM_VENDOR MV
	   WHERE MV.VNDR_SEQ = C.VNDR_SEQ)   AS SVC_PROVDR_NM
	,B.CMDT_CD
    ,(
		SELECT  CMDT_NM
        FROM    MDM_COMMODITY
        WHERE   CMDT_CD = B.CMDT_CD
	) AS CMDT_NM
	,C.CORR_RMK

FROM    DMT_CHG_BKG_CNTR    B
        ,DMT_CHG_CALC       C
        ,BKG_BOOKING        BK
        ,BKG_CUSTOMER       BS
        ,BKG_CUSTOMER       BC
        ,BKG_CUSTOMER       BN

WHERE  B.SYS_AREA_GRP_ID	=   C.SYS_AREA_GRP_ID
AND    B.CNTR_NO            =   C.CNTR_NO
AND    B.CNTR_CYC_NO        =   C.CNTR_CYC_NO
AND    B.BKG_NO             =   BK.BKG_NO
AND    C.OFC_CD             =   'SZPBB'

#if (${dmdt_trf_cd} == 'DMOF') 
AND    C.DMDT_TRF_CD        =	'DMOF'
#else 
AND    C.DMDT_TRF_CD        =	'CTIC'
#end

AND    C.DMDT_CHG_LOC_DIV_CD <> 'SZP'
AND    C.SUTH_CHN_DEM_KEY_NO IS NULL

AND    B.BKG_NO				=	BS.BKG_NO(+)
AND    BS.BKG_CUST_TP_CD(+) =   'S'
AND    B.BKG_NO             =   BC.BKG_NO(+)
AND    BC.BKG_CUST_TP_CD(+) =   'C'
AND    B.BKG_NO            	=   BN.BKG_NO(+)
AND    BN.BKG_CUST_TP_CD(+) =   'N'

#if (${dmdt_trf_cd} == 'DMOF') 
AND    C.DMDT_CHG_STS_CD IN ('F', 'C', 'I', 'N', 'D', 'E')
#end

#if (${cond_type} == 'date')
	#if (${dmdt_trf_cd} == 'DMOF')
		AND	   C.TO_MVMT_DT BETWEEN TO_DATE(@[fm_mvmt_dt], 'YYYYMMDD') 
            					AND TO_DATE(@[to_mvmt_dt], 'YYYYMMDD') + 0.99999
	
	#else
		AND	   C.FM_MVMT_DT BETWEEN TO_DATE(@[fm_mvmt_dt], 'YYYYMMDD') 
        		    			AND TO_DATE(@[to_mvmt_dt], 'YYYYMMDD') + 0.99999
	#end

	#if (${fm_mvmt_yd_cd} != '')
		##${fm_mvmt_yd_cd}
		#if ($fm_mvmt_yd_cd.length() == 5)
			AND SUBSTR(C.FM_MVMT_YD_CD, 1, 5) = @[fm_mvmt_yd_cd]
		#else
			AND C.FM_MVMT_YD_CD = @[fm_mvmt_yd_cd]
		#end
	#elseif (${to_mvmt_yd_cd} != '')
		##${to_mvmt_yd_cd}
		#if ($to_mvmt_yd_cd.length() == 5)
			AND SUBSTR(C.TO_MVMT_YD_CD,1, 5) = @[to_mvmt_yd_cd]
		#else
			AND C.TO_MVMT_YD_CD = @[to_mvmt_yd_cd]
		#end
	#end
#else
	--AND C.DMDT_CHG_STS_CD NOT IN ('D','N','U','I','C')
#end

#if (${cond_type} == 'vvd_cd')
	#if (${vvd_cd} != '')
	AND (	B.VSL_CD = SUBSTR(@[vvd_cd],1,4) 
		AND B.SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4) 
		AND B.SKD_DIR_CD = SUBSTR(@[vvd_cd],9) 
		)
	#end
	
	#if (${pod_cd} != '' || ${pol_cd} != '')
	AND (1=0
		#if (${pod_cd} != '')
		OR B.POD_CD = @[pod_cd]
		#end
		#if (${pol_cd} != '')
		OR B.POL_CD = @[pol_cd]
		#end
	)
	#end
#end

#if (${cond_type} == 'cntr')
	#if (${bkg_no} != '')	
	AND B.BKG_NO IN (
		#foreach( $bkg_cd in ${bkg_no_list} )
			#if($velocityCount < $bkg_no_list.size()) '$bkg_cd', #else '$bkg_cd' #end
		#end
		)
	#end

	#if (${bl_no} != '')
	AND B.BL_NO IN (
		#foreach( $bl_cd in ${bl_no_list} )
			#if($velocityCount < $bl_no_list.size()) '$bl_cd', #else '$bl_cd' #end
		#end
		)
	#end

	#if (${cntr_no} != '')
	AND C.CNTR_NO IN (
		#foreach( $cntr_cd in ${cntr_no_list} )
			#if($velocityCount < $cntr_no_list.size()) '$cntr_cd', #else '$cntr_cd' #end
		#end
		)
	#end
#end

#if (${cust_cd} != '')
	#if (${cust_type} == '')
	AND (
				C.ACT_CNT_CD	= SUBSTR(@[cust_cd],1,2)
			AND C.ACT_CUST_SEQ	= LTRIM(SUBSTR(@[cust_cd],3),'0')
		OR		BS.CUST_CNT_CD	= SUBSTR(@[cust_cd],1,2)
			AND BS.CUST_SEQ		= LTRIM(SUBSTR(@[cust_cd],3),'0')
		OR		BC.CUST_CNT_CD	= SUBSTR(@[cust_cd],1,2)
			AND BC.CUST_SEQ		= LTRIM(SUBSTR(@[cust_cd],3),'0')
		OR 		BN.CUST_CNT_CD	= SUBSTR(@[cust_cd],1,2)
			AND BN.CUST_SEQ		= LTRIM(SUBSTR(@[cust_cd],3),'0')
		OR(
			EXISTS (
    		SELECT  'X'
    		FROM    INV_AR_MN I
    		WHERE   I.BKG_NO	= B.BKG_NO
    		AND     I.IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
			AND		AR_IF_NO	= (
                    				SELECT	MAX(AR_IF_NO) 
                    				FROM	INV_AR_MN
                    				WHERE	BKG_NO = B.BKG_NO
                    				AND		IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
								  )
			AND     ROWNUM  = 1
			AND     I.ACT_CUST_CNT_CD   = SUBSTR(@[cust_cd],1,2)
			AND     I.ACT_CUST_SEQ      = LTRIM(SUBSTR(@[cust_cd],3),'0')
			)
		)
	)
	#elseif (${cust_type} == 'P')
		AND C.ACT_CNT_CD = SUBSTR(@[cust_cd],1,2)
		AND C.ACT_CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],3),'0')
	#elseif (${cust_type} == 'S') 
		AND BS.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
		AND BS.CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],3),'0')
	#elseif (${cust_type} == 'C') 
		AND BC.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
		AND BC.CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],3),'0')
	#elseif (${cust_type} == 'N') 
		AND BN.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
		AND BN.CUST_SEQ  = LTRIM(SUBSTR(@[cust_cd],3),'0')
	#elseif (${cust_type} == 'A')		
		AND EXISTS (
    		SELECT  'X'
    		FROM    INV_AR_MN I
    		WHERE   I.BKG_NO	= B.BKG_NO
    		AND     I.IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
			AND		AR_IF_NO	= (
                    				SELECT	MAX(AR_IF_NO) 
                    				FROM	INV_AR_MN
                    				WHERE	BKG_NO = B.BKG_NO
                    				AND		IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
								  )
			AND     ROWNUM  = 1
			AND     I.ACT_CUST_CNT_CD   = SUBSTR(@[cust_cd],1,2)
			AND     I.ACT_CUST_SEQ      = LTRIM(SUBSTR(@[cust_cd],3),'0')
			)
	#end
#end

#if (${svc_provdr} != '') 
AND C.VNDR_SEQ = LTRIM(@[svc_provdr],'0')
#end

#if (${sc_no} != '') 
AND B.SC_NO = @[sc_no]
#end

#if (${rfa_no} != '') 
AND B.RFA_NO = @[rfa_no]
#end


UNION ALL

SELECT
	C.SYS_AREA_GRP_ID SVR_ID
    ,C.DMDT_CHG_STS_CD	
    ,C.CNTR_NO    
    ,B.CNTR_TPSZ_CD
    ,C.FM_MVMT_YD_CD
    ,C.TO_MVMT_YD_CD
    ,C.FM_MVMT_STS_CD
    ,C.TO_MVMT_STS_CD
    ,C.DMDT_TRF_CD
    ,C.FT_DYS
    ,C.FX_FT_OVR_DYS
    ,TO_CHAR(C.FM_MVMT_DT, 'YYYYMMDD') FM_MVMT_DT
    ,TO_CHAR(C.TO_MVMT_DT, 'YYYYMMDD') TO_MVMT_DT
    ,TO_CHAR(C.FT_CMNC_DT, 'YYYYMMDD') FT_CMNC_DT
    ,TO_CHAR(C.FT_END_DT, 'YYYYMMDD') FT_END_DT
    ,C.BZC_TRF_CURR_CD
    --,C.ORG_CHG_AMT
    --,C.SC_RFA_EXPT_AMT    
    --,C.AFT_EXPT_DC_AMT
    ,C.BIL_AMT
    ,B.BKG_NO
    ,B.BL_NO
    ,B.VSL_CD || B.SKD_VOY_NO || B.SKD_DIR_CD AS VVD_CD    
    ,( SELECT	V.VSL_SLAN_CD LANE   
       FROM		VSK_VSL_SKD V
       WHERE	B.VSL_CD		=	V.VSL_CD
       AND		B.SKD_VOY_NO	=	V.SKD_VOY_NO
       AND		B.SKD_DIR_CD	=	V.SKD_DIR_CD
    ) AS LANE
    ,B.POR_CD
    ,B.POL_CD
    ,B.POD_CD
    ,B.DEL_CD
    ,B.BKG_RCV_TERM_CD
    ,B.BKG_DE_TERM_CD
    ,B.SC_NO
    ,B.RFA_NO
    ,DECODE( BK.AGMT_ACT_CNT_CD||TRIM(TO_CHAR(BK.AGMT_ACT_CUST_SEQ, '000000')),'000000', NULL
        	,BK.AGMT_ACT_CNT_CD||TRIM(TO_CHAR(BK.AGMT_ACT_CUST_SEQ, '000000')) ) AS ACUST	
    --,DECODE(C.CHG_SEQ, 1, 'G', 'B') AS CHG_TYPE
	,C.CHG_SEQ
	,NVL(B.SOC_FLG, 'N') AS SOC_FLG    
	,(	SELECT 'Y'
    	FROM DUAL      
    	WHERE EXISTS (
    		SELECT  BDD.RLSE_STS_CD
    		FROM    BKG_DO     BDO,
            		BKG_DO_DTL BDD
    		WHERE BDO.BKG_NO        = BDD.BKG_NO
   			AND   BDO.BKG_NO        = B.BKG_NO
    			AND   BDD.RLSE_STS_CD IN ('R', 'I')) ) AS D_O
	,(	SELECT  BDD.EVNT_OFC_CD
    	FROM    BKG_DO     BDO,
        	    BKG_DO_DTL BDD
    	WHERE	BDO.BKG_NO	= BDD.BKG_NO   
    		AND BDO.BKG_NO	= B.BKG_NO   
    		AND BDD.RLSE_STS_CD IN ('R', 'I')
			AND	ROWNUM=1 ) AS RLSE_OFC
	--,NVL(C.OFC_TRNS_FLG, 'N') AS OFC_TRNS_FLG
	,(	SELECT 'S'
		FROM DUAL
    	WHERE EXISTS (
    		SELECT 1
    		FROM	BKG_ROLL_OVR R
    		WHERE	R.BKG_NO = B.BKG_NO    			
    			AND R.ROLL_OVR_RSN_CD = 'S') ) AS ROLL_OVR	
    ,C.WEB_IND_FLG
    ,C.CNTR_CYC_NO
    ,C.DMDT_CHG_LOC_DIV_CD	
	,C.OFC_CD
	,C.OFC_RHQ_CD
	
	,C.DMDT_INV_NO
	,(	
		SELECT	TO_CHAR(IM.CRE_DT, 'YYYYMMDD')
		FROM	DMT_INV_MN  IM,
				DMT_INV_DTL ID
		WHERE   IM.BKG_NO       = B.BKG_NO
		AND	IM.DMDT_INV_NO      = ID.DMDT_INV_NO
		AND	IM.CRE_OFC_CD       = ID.CRE_OFC_CD
		AND IM.DMDT_INV_STS_CD  = 'I'
		AND C.SYS_AREA_GRP_ID = ID.SYS_AREA_GRP_ID
		AND C.CNTR_NO 		= ID.CNTR_NO
		AND C.CNTR_CYC_NO 	= ID.CNTR_CYC_NO
		AND C.DMDT_TRF_CD 	= ID.DMDT_TRF_CD
		AND C.DMDT_CHG_LOC_DIV_CD = ID.DMDT_CHG_LOC_DIV_CD
		AND C.CHG_SEQ = ID.CHG_SEQ 
		AND ROWNUM = 1
	) AS ISS_DT
	,(
		SELECT	IM.INV_CURR_CD
		FROM    DMT_INV_MN  IM,
				DMT_INV_DTL ID
		WHERE   IM.BKG_NO       = B.BKG_NO
		AND IM.DMDT_INV_NO      = ID.DMDT_INV_NO
		AND IM.CRE_OFC_CD       = ID.CRE_OFC_CD
		AND IM.DMDT_INV_STS_CD  = 'I'
		AND C.SYS_AREA_GRP_ID = ID.SYS_AREA_GRP_ID
		AND C.CNTR_NO 		= ID.CNTR_NO
		AND C.CNTR_CYC_NO 	= ID.CNTR_CYC_NO
		AND C.DMDT_TRF_CD 	= ID.DMDT_TRF_CD
		AND C.DMDT_CHG_LOC_DIV_CD = ID.DMDT_CHG_LOC_DIV_CD
		AND C.CHG_SEQ = ID.CHG_SEQ
		AND ROWNUM = 1
	) AS INV_CURR_CD
	,(
		SELECT	ID.CNTR_INV_AMT
		FROM    DMT_INV_MN  IM,
				DMT_INV_DTL ID
		WHERE   IM.BKG_NO       = B.BKG_NO
		AND IM.DMDT_INV_NO      = ID.DMDT_INV_NO
		AND IM.CRE_OFC_CD       = ID.CRE_OFC_CD
		AND IM.DMDT_INV_STS_CD  = 'I'
		AND C.SYS_AREA_GRP_ID = ID.SYS_AREA_GRP_ID
		AND C.CNTR_NO 		= ID.CNTR_NO
		AND C.CNTR_CYC_NO 	= ID.CNTR_CYC_NO
		AND C.DMDT_TRF_CD 	= ID.DMDT_TRF_CD
		AND C.DMDT_CHG_LOC_DIV_CD = ID.DMDT_CHG_LOC_DIV_CD
		AND C.CHG_SEQ = ID.CHG_SEQ
		AND ROWNUM = 1
    ) AS INV_CHG_AMT
	
	,DECODE( C.ACT_CNT_CD || TO_CHAR(C.ACT_CUST_SEQ, 'FM000000')
			,'000000' , NULL, C.ACT_CNT_CD || TO_CHAR(C.ACT_CUST_SEQ, 'FM000000')) PAYER_CD
	,CASE	
	WHEN C.DMDT_TRF_CD='DTIC' AND B.BKG_DE_TERM_CD='Y' AND INSTR(NVL(B.POD_CD,'  '),'US')=1 THEN
		(	SELECT MV.VNDR_LGL_ENG_NM
	   		FROM MDM_VENDOR MV
	   		WHERE MV.VNDR_SEQ = C.VNDR_SEQ	)
	WHEN C.DMDT_TRF_CD='DTOC' AND B.BKG_RCV_TERM_CD='Y' AND INSTR(NVL(B.POL_CD,'  '),'US')=1 THEN
		(	SELECT MV.VNDR_LGL_ENG_NM
			FROM MDM_VENDOR MV
	   		WHERE MV.VNDR_SEQ = C.VNDR_SEQ	)
	WHEN C.DMDT_TRF_CD IN ('DMIF','CTIC') OR (C.DMDT_TRF_CD='DTIC' AND INSTR(NVL(B.POD_CD,'  '),'US')<>1) THEN
		(	SELECT MC.CUST_LGL_ENG_NM
			FROM MDM_CUSTOMER MC
			WHERE MC.CUST_CNT_CD = C.ACT_CNT_CD
			AND MC.CUST_SEQ = C.ACT_CUST_SEQ	)
	WHEN C.DMDT_TRF_CD IN ('DMOF','CTOC') OR (C.DMDT_TRF_CD='DTOC' AND INSTR(NVL(B.POL_CD,'  '),'US')<>1) THEN
			REPLACE(BS.CUST_NM, CHR(13)||CHR(10),' ')
	END AS PAYER_NM
    ,BS.CUST_CNT_CD || TRIM(TO_CHAR(BS.CUST_SEQ, '000000')) SHIPPER_CD 
    ,REPLACE(BS.CUST_NM, CHR(13) || CHR(10), ' ') SHIPPER_NM   
    ,DECODE(BC.CUST_CNT_CD || TRIM(TO_CHAR(BC.CUST_SEQ, '000000')), '000000', NULL, BC.CUST_CNT_CD || TRIM(TO_CHAR(BC.CUST_SEQ, '000000'))) CNEE_CD
    ,REPLACE(BC.CUST_NM, CHR(13) || CHR(10), ' ') CNEE_NM
    ,DECODE(BN.CUST_CNT_CD || TRIM(TO_CHAR(BN.CUST_SEQ, '000000')), '000000', NULL, BN.CUST_CNT_CD || TRIM(TO_CHAR(BN.CUST_SEQ, '000000'))) NTFY_CD
    ,NVL(RTRIM(REPLACE(REPLACE(BN.CUST_NM, CHR(34), ''), CHR(13)||CHR(10), ' ')), '-') NTFY_NM
	,(	SELECT  I.ACT_CUST_CNT_CD || TRIM(TO_CHAR(ACT_CUST_SEQ, '000000'))
    	FROM    INV_AR_MN I
    	WHERE   I.BKG_NO = B.BKG_NO
    	AND     I.IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
		AND		AR_IF_NO	= (
                    SELECT	MAX(AR_IF_NO) 
                    FROM	INV_AR_MN
                    WHERE	BKG_NO = B.BKG_NO
                    AND		IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
    	            )
		AND     ROWNUM  = 1
	) AS AR_ACT_CD
	,(	SELECT	MC.CUST_LGL_ENG_NM
		FROM 	MDM_CUSTOMER MC, INV_AR_MN I
		WHERE	MC.CUST_CNT_CD = I.ACT_CUST_CNT_CD
		AND		MC.CUST_SEQ    = I.ACT_CUST_SEQ
		AND		I.BKG_NO = B.BKG_NO
		AND		I.IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
		AND		AR_IF_NO	= (
                    SELECT	MAX(AR_IF_NO) 
                    FROM	INV_AR_MN
                    WHERE	BKG_NO = B.BKG_NO
                    AND		IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
    	            )
		AND		ROWNUM  = 1
	) AS AR_ACT_NM
	,DECODE(TRIM(TO_CHAR(C.VNDR_SEQ, '000000')), '000000', NULL, TRIM(TO_CHAR(C.VNDR_SEQ, '000000'))) AS SVC_PROVDR_CD
	,(SELECT MV.VNDR_LGL_ENG_NM
	   FROM MDM_VENDOR MV
	   WHERE MV.VNDR_SEQ = C.VNDR_SEQ)   AS SVC_PROVDR_NM
	,B.CMDT_CD
    ,(
		SELECT  CMDT_NM
        FROM    MDM_COMMODITY
        WHERE   CMDT_CD = B.CMDT_CD
	) AS CMDT_NM
	,C.CORR_RMK

FROM    DMT_CHG_BKG_CNTR    B
        ,DMT_CHG_CALC       C
        ,BKG_BOOKING        BK
        ,BKG_CUSTOMER       BS
        ,BKG_CUSTOMER       BC
        ,BKG_CUSTOMER       BN

WHERE  B.SYS_AREA_GRP_ID	=   C.SYS_AREA_GRP_ID
AND    B.CNTR_NO            =   C.CNTR_NO
AND    B.CNTR_CYC_NO        =   C.CNTR_CYC_NO
AND    B.BKG_NO             =   BK.BKG_NO
AND    C.OFC_CD             =   'SZPBB'
AND    C.DMDT_TRF_CD        =	@[dmdt_trf_cd]
AND    C.DMDT_CHG_LOC_DIV_CD =  'SZP'

AND    B.BKG_NO				=	BS.BKG_NO(+)
AND    BS.BKG_CUST_TP_CD(+) =   'S'
AND    B.BKG_NO             =   BC.BKG_NO(+)
AND    BC.BKG_CUST_TP_CD(+) =   'C'
AND    B.BKG_NO            	=   BN.BKG_NO(+)
AND    BN.BKG_CUST_TP_CD(+) =   'N'

#if (${dmdt_trf_cd} == 'DMOF') 
AND    C.DMDT_CHG_STS_CD IN ('F', 'C', 'I', 'N', 'D', 'E')
#end

#if (${cond_type} == 'date')
	#if (${dmdt_trf_cd} == 'DMOF')
		AND	   C.TO_MVMT_DT BETWEEN TO_DATE(@[fm_mvmt_dt], 'YYYYMMDD') 
            					AND TO_DATE(@[to_mvmt_dt], 'YYYYMMDD') + 0.99999
	
	#else
		AND	   C.FM_MVMT_DT BETWEEN TO_DATE(@[fm_mvmt_dt], 'YYYYMMDD') 
        		    			AND TO_DATE(@[to_mvmt_dt], 'YYYYMMDD') + 0.99999
	#end

	#if (${fm_mvmt_yd_cd} != '')
		##${fm_mvmt_yd_cd}
		#if ($fm_mvmt_yd_cd.length() == 5)
			AND SUBSTR(C.FM_MVMT_YD_CD, 1, 5) = @[fm_mvmt_yd_cd]
		#else
			AND C.FM_MVMT_YD_CD = @[fm_mvmt_yd_cd]
		#end
	#elseif (${to_mvmt_yd_cd} != '')
		##${to_mvmt_yd_cd}
		#if ($to_mvmt_yd_cd.length() == 5)
			AND SUBSTR(C.TO_MVMT_YD_CD,1, 5) = @[to_mvmt_yd_cd]
		#else
			AND C.TO_MVMT_YD_CD = @[to_mvmt_yd_cd]
		#end
	#end
#else
	--AND C.DMDT_CHG_STS_CD NOT IN ('D','N','U','I','C')
#end

#if (${incl_inv} != 'Y') 
	AND C.DMDT_CHG_STS_CD <> 'I'
#end

#if (${cond_type} == 'vvd_cd')
	#if (${vvd_cd} != '')
	AND (	B.VSL_CD = SUBSTR(@[vvd_cd],1,4) 
		AND B.SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4) 
		AND B.SKD_DIR_CD = SUBSTR(@[vvd_cd],9) 
		)
	#end
	
	#if (${pod_cd} != '' || ${pol_cd} != '')
	AND (1=0
		#if (${pod_cd} != '')
		OR B.POD_CD = @[pod_cd]
		#end
		#if (${pol_cd} != '')
		OR B.POL_CD = @[pol_cd]
		#end
	)
	#end
#end

#if (${cond_type} == 'cntr')
	#if (${bkg_no} != '')	
	AND B.BKG_NO IN (
		#foreach( $bkg_cd in ${bkg_no_list} )
			#if($velocityCount < $bkg_no_list.size()) '$bkg_cd', #else '$bkg_cd' #end
		#end
		)
	#end

	#if (${bl_no} != '')
	AND B.BL_NO IN (
		#foreach( $bl_cd in ${bl_no_list} )
			#if($velocityCount < $bl_no_list.size()) '$bl_cd', #else '$bl_cd' #end
		#end
		)
	#end

	#if (${cntr_no} != '')
	AND C.CNTR_NO IN (
		#foreach( $cntr_cd in ${cntr_no_list} )
			#if($velocityCount < $cntr_no_list.size()) '$cntr_cd', #else '$cntr_cd' #end
		#end
		)
	#end
#end

#if (${cust_cd} != '')
	#if (${cust_type} == '')
	AND (
				C.ACT_CNT_CD	= SUBSTR(@[cust_cd],1,2)
			AND C.ACT_CUST_SEQ	= LTRIM(SUBSTR(@[cust_cd],3),'0')
		OR		BS.CUST_CNT_CD	= SUBSTR(@[cust_cd],1,2)
			AND BS.CUST_SEQ		= LTRIM(SUBSTR(@[cust_cd],3),'0')
		OR		BC.CUST_CNT_CD	= SUBSTR(@[cust_cd],1,2)
			AND BC.CUST_SEQ		= LTRIM(SUBSTR(@[cust_cd],3),'0')
		OR 		BN.CUST_CNT_CD	= SUBSTR(@[cust_cd],1,2)
			AND BN.CUST_SEQ		= LTRIM(SUBSTR(@[cust_cd],3),'0')
		OR(
			EXISTS (
    		SELECT  'X'
    		FROM    INV_AR_MN I
    		WHERE   I.BKG_NO	= B.BKG_NO
    		AND     I.IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
			AND		AR_IF_NO	= (
                    				SELECT	MAX(AR_IF_NO) 
                    				FROM	INV_AR_MN
                    				WHERE	BKG_NO = B.BKG_NO
                    				AND		IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
								  )
			AND     ROWNUM  = 1
			AND     I.ACT_CUST_CNT_CD   = SUBSTR(@[cust_cd],1,2)
			AND     I.ACT_CUST_SEQ      = LTRIM(SUBSTR(@[cust_cd],3),'0')
			)
		)
	)
	#elseif (${cust_type} == 'P')
		AND C.ACT_CNT_CD = SUBSTR(@[cust_cd],1,2)
		AND C.ACT_CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],3),'0')
	#elseif (${cust_type} == 'S') 
		AND BS.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
		AND BS.CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],3),'0')
	#elseif (${cust_type} == 'C') 
		AND BC.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
		AND BC.CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],3),'0')
	#elseif (${cust_type} == 'N') 
		AND BN.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
		AND BN.CUST_SEQ  = LTRIM(SUBSTR(@[cust_cd],3),'0')
	#elseif (${cust_type} == 'A')		
		AND EXISTS (
    		SELECT  'X'
    		FROM    INV_AR_MN I
    		WHERE   I.BKG_NO	= B.BKG_NO
    		AND     I.IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
			AND		AR_IF_NO	= (
                    				SELECT	MAX(AR_IF_NO) 
                    				FROM	INV_AR_MN
                    				WHERE	BKG_NO = B.BKG_NO
                    				AND		IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
								  )
			AND     ROWNUM  = 1
			AND     I.ACT_CUST_CNT_CD   = SUBSTR(@[cust_cd],1,2)
			AND     I.ACT_CUST_SEQ      = LTRIM(SUBSTR(@[cust_cd],3),'0')
			)
	#end
#end

#if (${svc_provdr} != '') 
AND C.VNDR_SEQ = LTRIM(@[svc_provdr],'0')
#end

#if (${sc_no} != '') 
AND B.SC_NO = @[sc_no]
#end

#if (${rfa_no} != '') 
AND B.RFA_NO = @[rfa_no]
#end

ORDER BY CNTR_NO, FM_MVMT_DT			]]></sql>
			<params>
				<param name="fm_mvmt_dt" type="12" value="" out="N"/>
				<param name="to_mvmt_dt" type="12" value="" out="N"/>
				<param name="fm_mvmt_yd_cd" type="12" value="" out="N"/>
				<param name="to_mvmt_yd_cd" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="cust_cd" type="12" value="" out="N"/>
				<param name="svc_provdr" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
				<param name="rfa_no" type="12" value="" out="N"/>
				<param name="dmdt_trf_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
