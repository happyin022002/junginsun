<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EQMatchBackNLoadFactorMgtDBDAOSearchMBByVessel05RSQL">
			<desc><![CDATA[Match-back by Vessel]]></desc>
			<sql><![CDATA[
SELECT  
				'BKG' val01,																						/* dataSource */
				COUNT(DECODE(BKG_CGO_TP_CD, 'F', DECODE(SUBSTR(CNTR_TPSZ_CD,2,1), '2', CNTR_TPSZ_CD))) val02,		/* full20Qty */
				COUNT(DECODE(BKG_CGO_TP_CD, 'F', DECODE(SUBSTR(CNTR_TPSZ_CD,2,1), '4', CNTR_TPSZ_CD))) val03,		/* full40Qty */
				COUNT(DECODE(BKG_CGO_TP_CD, 'F', DECODE(SUBSTR(CNTR_TPSZ_CD,2,1), '5', CNTR_TPSZ_CD))) val04,		/* fullHcQty */
				COUNT(DECODE(BKG_CGO_TP_CD, 'F', DECODE(SUBSTR(CNTR_TPSZ_CD,2,1), '7', CNTR_TPSZ_CD))) val05,		/* full45Qty */
				COUNT(DECODE(BKG_CGO_TP_CD, 'P', DECODE(SUBSTR(CNTR_TPSZ_CD,2,1), '2', CNTR_TPSZ_CD))) val06,		/* mty20Qty  */
				COUNT(DECODE(BKG_CGO_TP_CD, 'P', DECODE(SUBSTR(CNTR_TPSZ_CD,2,1), '4', CNTR_TPSZ_CD))) val07,		/* mty40Qty  */
				COUNT(DECODE(BKG_CGO_TP_CD, 'P', DECODE(SUBSTR(CNTR_TPSZ_CD,2,1), '5', CNTR_TPSZ_CD))) val08,		/* mtyHcQty  */
				COUNT(DECODE(BKG_CGO_TP_CD, 'P', DECODE(SUBSTR(CNTR_TPSZ_CD,2,1), '7', CNTR_TPSZ_CD))) val09,		/* mty45Qty  */
				COUNT(DECODE(AWK_CGO_FLG, 'Y', CNTR_NO)) deadSlot
		FROM	(
					SELECT
							/*+ 
								ORDERED USE_NL ( BV SL SD BK BC )
										INDEX( BV XAK1BKG_VVD )
										INDEX( BC XPKBKG_CONTAINER )
										INDEX( BK XPKBKG_BOOKING )
										INDEX( SL XPKVSK_VSL_PORT_SKD )
										INDEX( SD XPKVSK_VSL_PORT_SKD ) 
							*/
							BK.BKG_CGO_TP_CD,	
							BC.CNTR_TPSZ_CD,	
							BC.CNTR_NO, 
							MAX(BC.AWK_CGO_FLG)		AWK_CGO_FLG,	
							1						TEMP
					FROM   
							BKG_VVD		        BV,
							VSK_VSL_PORT_SKD	SL,		
							VSK_VSL_PORT_SKD	SD,
							BKG_BOOKING			BK,		
							BKG_CONTAINER		BC	
					WHERE  	BK.BKG_NO			= BC.BKG_NO
--					AND    	BK.BKG_NO_SPLIT		= BC.BKG_NO_SPLIT
					AND    	BK.BKG_NO			= BV.BKG_NO
--					AND    	BK.BKG_NO_SPLIT		= BV.BKG_NO_SPLIT
					AND    	BV.VSL_CD 			= SUBSTR(@[trade],1,4) -- vvd
					AND    	BV.SKD_VOY_NO		= SUBSTR(@[trade],5,4) -- vvd
					AND    	BV.SKD_DIR_CD		= SUBSTR(@[trade],9,1) -- vvd
					AND    	SL.VSL_CD 			= BV.VSL_CD
					AND    	SL.SKD_VOY_NO		= BV.SKD_VOY_NO
					AND    	SL.SKD_DIR_CD		= BV.SKD_DIR_CD
					AND    	SL.VPS_PORT_CD		= BV.POL_CD
					AND    	SL.CLPT_SEQ			<= @[lane] -- call_seq
					AND    	SD.VSL_CD			= BV.VSL_CD
					AND    	SD.SKD_VOY_NO		= BV.SKD_VOY_NO
					AND    	SD.SKD_DIR_CD		= BV.SKD_DIR_CD
					AND    	SD.VPS_PORT_CD		= DECODE(BV.POD_CD, 'XXXXX', BV.POL_CD, BV.POD_CD)
					AND    	SD.CLPT_SEQ			> DECODE(BV.POD_CD, 'XXXXX', SD.CLPT_SEQ-1, @[lane]) -- call_seq
					GROUP BY 
							BK.BKG_CGO_TP_CD, 
							BC.CNTR_TPSZ_CD, 
							BC.CNTR_NO
				)
		GROUP BY TEMP			]]></sql>
			<params>
				<param name="trade" type="12" value="" out="N"/>
				<param name="lane" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
