<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ReceivableRentalCostDBDAOReceivableInvoiceSummaryListRSQL">
			<desc><![CDATA[Receivable Rental Invoice Summary 내역을 조회합니다.]]></desc>
			<sql><![CDATA[
SELECT  NVL2(AGMT_SEQ, AGMT_CTY_CD||LPAD(AGMT_SEQ, 6,'0'), 'G.TTL') AS AGMT_NO,
        AGMT_CTY_CD, AGMT_SEQ, RCV_RNTL_SEQ,  
        NVL(LSTM_CD, NVL2(AGMT_SEQ,'S.TTL',NULL)) AS LSTM_CD,
        CNTR_TPSZ_CD, LSE_RCV_CHG_TP_CD, 
        CNTR_CNT, COST_AMT, BIL_DYS, 
        NVL2(RCV_RNTL_SEQ, ROUND(CHG_RT_AMT/CNTR_CNT, 2), NULL) AS CHG_RT_AMT
FROM   (SELECT  AGMT_CTY_CD, AGMT_SEQ, RCV_RNTL_SEQ,  
                LSTM_CD, CNTR_TPSZ_CD, LSE_RCV_CHG_TP_CD, 
                COUNT(DISTINCT CNTR_NO) AS CNTR_CNT, 
                SUM(COST_AMT + NVL(CR_AMT,0)) AS COST_AMT,
                SUM(BIL_DYS) AS BIL_DYS,
                SUM(CHG_RT_AMT) AS CHG_RT_AMT
        FROM   (SELECT  AGMT_CTY_CD, AGMT_SEQ, RCV_RNTL_SEQ,                        
                        LSTM_CD, CNTR_TPSZ_CD, CNTR_NO, 
                        LSE_RCV_CHG_TP_CD, COST_AMT, CR_AMT,
						BIL_DYS, CHG_RT_AMT          
                FROM    LSE_RCV_RNTL_CHG_DTL
                WHERE   LSE_RCV_CHG_CRE_CD != 'D'				
				AND     COST_YRMON = @[cost_yrmon]
#if (${rcv_rntl_seq} != "")
				AND     RCV_RNTL_SEQ IN (
	#foreach($key IN ${rcv_rntl_no_seq})
		#if($velocityCount < $rcv_rntl_no_seq.size())
			'$key',
		#else
			'$key'
		#end
	#end
				)
#end                
#if (${inv_no} != "")
				AND     RCV_RNTL_SEQ IN (SELECT RCV_RNTL_SEQ
                                         FROM   LSE_RCV_RNTL_CHG
                                         WHERE  INV_NO = @[inv_no])
#end                
        )     
        GROUP BY ROLLUP(AGMT_CTY_CD, AGMT_SEQ, RCV_RNTL_SEQ, 
                 LSTM_CD, CNTR_TPSZ_CD, LSE_RCV_CHG_TP_CD)                                  
)
WHERE   LSE_RCV_CHG_TP_CD IS NOT NULL
OR     (RCV_RNTL_SEQ IS NULL
AND     AGMT_SEQ IS NOT NULL)
OR      AGMT_CTY_CD IS NULL
ORDER BY AGMT_CTY_CD, AGMT_NO, RCV_RNTL_SEQ			]]></sql>
			<params>
				<param name="cost_yrmon" type="12" value="" out="N"/>
				<param name="inv_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
