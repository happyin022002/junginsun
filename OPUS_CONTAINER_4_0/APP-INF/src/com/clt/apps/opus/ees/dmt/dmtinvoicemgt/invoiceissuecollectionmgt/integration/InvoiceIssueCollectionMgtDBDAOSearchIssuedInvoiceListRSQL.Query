<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceIssueCollectionMgtDBDAOSearchIssuedInvoiceListRSQL">
			<desc><![CDATA[Issued Invoice Inquiry - By Booking, By Container]]></desc>
			<sql><![CDATA[
#if(${s_group_by} == '1')
	SELECT DISTINCT A.DMDT_INV_NO
			,A.INV_PRT_FLG
			,A.DMDT_AR_IF_CD
			,A.DMDT_INV_STS_CD
			,A.DMDT_TRF_CD
			,A.BKG_NO
			,A.BL_NO
			,'' AS CNTR_NO
			,A.SC_NO
			,A.RFA_NO
			,A.CHG_CURR_CD
			,A.ORG_CHG_AMT
			,A.DMDT_EXPT_AMT
			,A.DC_AMT
			,A.BIL_AMT
			,A.INV_CURR_CD
			,A.INV_CHG_AMT
			,A.TAX_AMT
			,A.INV_AMT
			,DECODE(SUBSTR(A.DMDT_TRF_CD,3,1),'I',A.POD_CD,A.POL_CD) AS PORT
			,TO_CHAR(A.CRE_DT,'YYYY-MM-DD') AS CRE_DT
			,A.CRE_OFC_CD
			,A.CRE_USR_ID AS ISSUE_ID
			,(SELECT USR_NM FROM COM_USER WHERE USR_ID = A.CRE_USR_ID) AS ISSUE_NM
			,DECODE(A.DMDT_AR_IF_CD,'Y',A.AR_IF_NO,'') AS AR_IF_NO
			,TO_CHAR(A.AR_IF_DT, 'YYYY-MM-DD') AS AR_IF_DT
			,A.AR_IF_OFC_CD
			,A.AR_IF_USR_ID
			,(SELECT USR_NM FROM COM_USER WHERE USR_ID = A.AR_IF_USR_ID) AS AR_IF_USR_NM
			,DECODE(NVL(A.DMDT_AR_IF_CD,'N'), 'Y', (TO_DATE(TO_CHAR(A.AR_IF_DT,'YYYYMMDD'),'YYYYMMDD') - TO_DATE(TO_CHAR(A.CRE_DT,'YYYYMMDD'),'YYYYMMDD')), 
	                                              (TO_DATE(TO_CHAR(NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(A.CRE_OFC_CD),SYSDATE),'YYYYMMDD'),'YYYYMMDD') - TO_DATE(TO_CHAR(A.CRE_DT,'YYYYMMDD'),'YYYYMMDD'))) 
			 AS INV_OVER
			,DECODE(A.ACT_PAYR_CNT_CD, '00', NULL ,A.ACT_PAYR_CNT_CD)
			 ||DECODE(LPAD(A.ACT_PAYR_SEQ, 6,'0'), '000000', NULL, LPAD(A.ACT_PAYR_SEQ, 6,'0')) AS ACT_PAYR_CD
			,CASE WHEN A.ACT_PAYR_CNT_CD = '00' THEN (SELECT VNDR_LGL_ENG_NM FROM MDM_VENDOR WHERE VNDR_SEQ = A.ACT_PAYR_SEQ)
	              ELSE (SELECT CUST_LGL_ENG_NM FROM MDM_CUSTOMER WHERE CUST_CNT_CD = A.ACT_PAYR_CNT_CD AND CUST_SEQ = A.ACT_PAYR_SEQ)
	         END ACT_PAYR_NM
			,CASE WHEN A.ACT_PAYR_CNT_CD = '00' THEN (SELECT DELT_FLG FROM MDM_VENDOR WHERE VNDR_SEQ = A.ACT_PAYR_SEQ)
				  ELSE (SELECT DELT_FLG FROM MDM_CUSTOMER WHERE CUST_CNT_CD = A.ACT_PAYR_CNT_CD AND CUST_SEQ = A.ACT_PAYR_SEQ)
			 END ACT_DELT_FLG
			,A.CR_INV_NO
			,DECODE(A.RFA_NO, NULL,	(SELECT  PROP_OFC_CD
									 FROM    PRI_SP_MN,
											 PRI_SP_HDR
									 WHERE   PRI_SP_MN.PROP_NO   =   PRI_SP_HDR.PROP_NO
									 AND     PRI_SP_HDR.SC_NO    =   A.SC_NO
									 AND     ROWNUM              =   1)
								  , (SELECT  PROP_OFC_CD
									 FROM    PRI_RP_MN,
											 PRI_RP_HDR
									 WHERE   PRI_RP_MN.PROP_NO   =   PRI_RP_HDR.PROP_NO
									 AND     PRI_RP_HDR.RFA_NO   =   A.RFA_NO
									 AND     ROWNUM              =   1)  )
			 AS CTRT_OFC
	FROM DMT_INV_MN A, DMT_INV_DTL B
	WHERE A.DMDT_INV_NO = B.DMDT_INV_NO(+)
	AND A.CRE_OFC_CD = B.CRE_OFC_CD(+)
	-- Tariff Type
	#if (${s_dmdt_trf_cd} != '')
	AND A.DMDT_TRF_CD IN (
		#foreach( $dmdt_trf_no in ${dmdt_trf_cd_list}) 
			#if($velocityCount < $dmdt_trf_cd_list.size()) 
		           '$dmdt_trf_no', 
			#else 
		           '$dmdt_trf_no' 
			#end 
		#end
		)
	#end
	
	-- AR/IF = (N, Y, H, H and LIT)
	#if (${s_dmdt_ar_if_cd} != '')
	AND 
		#if(${ar_if_cnt} > 0)
	    (A.DMDT_AR_IF_CD IN (
			#foreach( $dmdt_ar_if_no in ${dmdt_ar_if_list}) 
				#if($velocityCount < $dmdt_ar_if_list.size()) 
		           '$dmdt_ar_if_no', 
				#else 
		           '$dmdt_ar_if_no' 
				#end 
			#end
			)
			-- AR/IF = L
			#if (${s_ar_if_l_yn} != '')	
				OR (A.DMDT_AR_IF_CD = 'H' AND A.INV_HLD_RSN_CD = 'LIT')
			#end
		)
		#else
			-- AR/IF = L
			#if (${s_ar_if_l_yn} != '')	
				(A.DMDT_AR_IF_CD = 'H' AND A.INV_HLD_RSN_CD = 'LIT')
			#end
		#end
	#end
	-- INVOICE STATUS
	#if (${s_dmdt_inv_sts_cd} != '')
	AND A.DMDT_INV_STS_CD IN (
		#foreach( $dmdt_inv_sts_no in ${dmdt_inv_sts_list}) 
			#if($velocityCount < $dmdt_inv_sts_list.size()) 
		           '$dmdt_inv_sts_no', 
			#else 
		           '$dmdt_inv_sts_no' 
			#end 
		#end
		)
	#end
	-- OFC radio box
	#if (${s_inv_check} == 'N')
	AND A.CRE_OFC_CD IN (
			#foreach( $s_issue_ofc in ${ofc_cd_list} )
				#if($velocityCount < $ofc_cd_list.size()) '$s_issue_ofc', #else '$s_issue_ofc' #end
			#end
	)
	AND TO_CHAR(A.CRE_DT,'YYYYMMDD') BETWEEN @[s_issue_fm] AND @[s_issue_to]
	#end
	-- INV radio box
	#if (${s_inv_check} == 'Y')
--2010.02.18 하드코딩 삭제 작업
		#if (${session_rhq_ofc_cd} != ${head_office})
		AND A.CRE_OFC_CD IN ( SELECT OFC_CD FROM MDM_ORGANIZATION WHERE AR_HD_QTR_OFC_CD = @[session_rhq_ofc_cd] )
		#end
		#if (${s_invoice_no} != '')	
			AND A.DMDT_INV_NO IN (
				#foreach( $invoice_cd in ${invoice_no_list} )
					#if($velocityCount < $invoice_no_list.size()) 
						'$invoice_cd', 
					#else 
						'$invoice_cd' 
					#end
				#end
				)
		#end
		#if (${s_bkg_no} != '')	
			AND A.BKG_NO IN (
				#foreach( $bkg_cd in ${bkg_no_list} )
					#if($velocityCount < $bkg_no_list.size()) 
						'$bkg_cd', 
					#else 
						'$bkg_cd' 
					#end
				#end
				)
		#end
		#if (${s_bl_no} != '')	
			AND A.BL_NO IN (
				#foreach( $bl_cd in ${bl_no_list} )
					#if($velocityCount < $bl_no_list.size()) 
						'$bl_cd', 
					#else 
						'$bl_cd' 
					#end
				#end
				)
		#end
	#end
	-- OVER DAYS
	#if(${s_inv_over} != '')
	AND (TO_DATE(TO_CHAR(NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(A.CRE_OFC_CD),SYSDATE), 'YYYYMMDD'), 'YYYYMMDD') - TO_DATE(TO_CHAR(A.CRE_DT, 'YYYYMMDD'), 'YYYYMMDD')) > = @[s_inv_over]
	#end
	-- ISSUE ID
	#if(${s_issue_usr_id} != '')
	AND A.CRE_USR_ID = @[s_issue_usr_id]
	#end
	-- PAYER
	#if(${s_payer_cd} != '')
		#if (${s_cust_gubun} == '1')
		AND LPAD(A.ACT_PAYR_SEQ,6,'0') = LPAD(@[s_cust_cd],6,'0')
		#elseif (${s_cust_gubun} == '2') 
		AND A.ACT_PAYR_CNT_CD = SUBSTR(@[s_cust_cd],1,2)
		AND LPAD(A.ACT_PAYR_SEQ,6,'0') = SUBSTR(@[s_cust_cd],3)
		#end
	#end
	-- SC NO
	#if(${s_sc_no} != '')
	AND A.SC_NO = @[s_sc_no]
	#end
	-- RFA NO
	#if(${s_rfa_no} != '')
	AND A.RFA_NO = @[s_rfa_no]
	#end
	ORDER BY A.DMDT_INV_NO

#elseif(${s_group_by} == '2')
	SELECT A.DMDT_INV_NO
			,A.INV_PRT_FLG
			,A.DMDT_AR_IF_CD
			,A.DMDT_INV_STS_CD
			,A.DMDT_TRF_CD
			,A.BKG_NO
			,A.BL_NO
			,B.CNTR_NO
			,A.SC_NO
			,A.RFA_NO
			,A.CHG_CURR_CD
			,B.ORG_CHG_AMT
			,B.SC_RFA_EXPT_AMT AS DMDT_EXPT_AMT
			,B.AFT_EXPT_DC_AMT AS DC_AMT
			,B.BIL_AMT
			,A.INV_CURR_CD
			,B.CNTR_INV_AMT AS INV_CHG_AMT
			,B.TAX_AMT
			,(B.CNTR_INV_AMT + B.TAX_AMT)  AS INV_AMT
			,DECODE(SUBSTR(A.DMDT_TRF_CD,3,1),'I',A.POD_CD,A.POL_CD) AS PORT
			,TO_CHAR(A.CRE_DT,'YYYY-MM-DD') AS CRE_DT
			,A.CRE_OFC_CD
			,A.CRE_USR_ID AS ISSUE_ID
			,(SELECT USR_NM FROM COM_USER WHERE USR_ID = A.CRE_USR_ID) AS ISSUE_NM
			,DECODE(A.DMDT_AR_IF_CD,'Y',A.AR_IF_NO,'') AS AR_IF_NO
			,TO_CHAR(A.AR_IF_DT, 'YYYY-MM-DD') AS AR_IF_DT
			,A.AR_IF_OFC_CD
			,A.AR_IF_USR_ID
			,(SELECT USR_NM FROM COM_USER WHERE USR_ID = A.AR_IF_USR_ID) AS AR_IF_USR_NM
			,DECODE(NVL(A.DMDT_AR_IF_CD,'N'), 'Y', (TO_DATE(TO_CHAR(A.AR_IF_DT,'YYYYMMDD'),'YYYYMMDD') - TO_DATE(TO_CHAR(A.CRE_DT,'YYYYMMDD'),'YYYYMMDD')), 
	                                              (TO_DATE(TO_CHAR(NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(A.CRE_OFC_CD),SYSDATE),'YYYYMMDD'),'YYYYMMDD') - TO_DATE(TO_CHAR(A.CRE_DT,'YYYYMMDD'),'YYYYMMDD'))) 
			 AS INV_OVER
			,DECODE(A.ACT_PAYR_CNT_CD, '00', NULL ,A.ACT_PAYR_CNT_CD)
			 ||DECODE(LPAD(A.ACT_PAYR_SEQ, 6,'0'), '000000', NULL, LPAD(A.ACT_PAYR_SEQ, 6,'0')) AS ACT_PAYR_CD
			,CASE WHEN A.ACT_PAYR_CNT_CD = '00' THEN (SELECT VNDR_LGL_ENG_NM FROM MDM_VENDOR WHERE VNDR_SEQ = A.ACT_PAYR_SEQ)
	              ELSE (SELECT CUST_LGL_ENG_NM FROM MDM_CUSTOMER WHERE CUST_CNT_CD = A.ACT_PAYR_CNT_CD AND CUST_SEQ = A.ACT_PAYR_SEQ)
	         END ACT_PAYR_NM
			,CASE WHEN A.ACT_PAYR_CNT_CD = '00' THEN (SELECT DELT_FLG FROM MDM_VENDOR WHERE VNDR_SEQ = A.ACT_PAYR_SEQ)
				  ELSE (SELECT DELT_FLG FROM MDM_CUSTOMER WHERE CUST_CNT_CD = A.ACT_PAYR_CNT_CD AND CUST_SEQ = A.ACT_PAYR_SEQ)
			 END ACT_DELT_FLG
			,A.CR_INV_NO
			,DECODE(A.RFA_NO, NULL,	(SELECT  PROP_OFC_CD
									 FROM    PRI_SP_MN,
											 PRI_SP_HDR
									 WHERE   PRI_SP_MN.PROP_NO   =   PRI_SP_HDR.PROP_NO
									 AND     PRI_SP_HDR.SC_NO    =   A.SC_NO
									 AND     ROWNUM              =   1)
								  , (SELECT  PROP_OFC_CD
									 FROM    PRI_RP_MN,
											 PRI_RP_HDR
									 WHERE   PRI_RP_MN.PROP_NO   =   PRI_RP_HDR.PROP_NO
									 AND     PRI_RP_HDR.RFA_NO   =   A.RFA_NO
									 AND     ROWNUM              =   1)  )
			 AS CTRT_OFC
	FROM DMT_INV_MN A, DMT_INV_DTL B
	WHERE A.DMDT_INV_NO = B.DMDT_INV_NO(+)
	AND A.CRE_OFC_CD = B.CRE_OFC_CD(+)
	-- Tariff Type
	#if (${s_dmdt_trf_cd} != '')
	AND A.DMDT_TRF_CD IN (
		#foreach( $dmdt_trf_no in ${dmdt_trf_cd_list}) 
			#if($velocityCount < $dmdt_trf_cd_list.size()) 
		           '$dmdt_trf_no', 
			#else 
		           '$dmdt_trf_no' 
			#end 
		#end
		)
	#end
	
	-- AR/IF = (N, Y, H, H and LIT)
	#if (${s_dmdt_ar_if_cd} != '')
	AND 
		#if(${ar_if_cnt} > 0)
	    (A.DMDT_AR_IF_CD IN (
			#foreach( $dmdt_ar_if_no in ${dmdt_ar_if_list}) 
				#if($velocityCount < $dmdt_ar_if_list.size()) 
		           '$dmdt_ar_if_no', 
				#else 
		           '$dmdt_ar_if_no' 
				#end 
			#end
			)
			-- AR/IF = L
			#if (${s_ar_if_l_yn} != '')	
				OR (A.DMDT_AR_IF_CD = 'H' AND A.INV_HLD_RSN_CD = 'LIT')
			#end
		)
		#else
			-- AR/IF = L
			#if (${s_ar_if_l_yn} != '')	
				(A.DMDT_AR_IF_CD = 'H' AND A.INV_HLD_RSN_CD = 'LIT')
			#end
		#end
	#end
	-- INVOICE STATUS
	#if (${s_dmdt_inv_sts_cd} != '')
	AND A.DMDT_INV_STS_CD IN (
		#foreach( $dmdt_inv_sts_no in ${dmdt_inv_sts_list}) 
			#if($velocityCount < $dmdt_inv_sts_list.size()) 
		           '$dmdt_inv_sts_no', 
			#else 
		           '$dmdt_inv_sts_no' 
			#end 
		#end
		)
	#end
	-- OFC radio box
	#if (${s_inv_check} == 'N')
	AND A.CRE_OFC_CD IN (
			#foreach( $s_issue_ofc in ${ofc_cd_list} )
				#if($velocityCount < $ofc_cd_list.size()) '$s_issue_ofc', #else '$s_issue_ofc' #end
			#end
	)
	AND TO_CHAR(A.CRE_DT,'YYYYMMDD') BETWEEN @[s_issue_fm] AND @[s_issue_to]
	#end
	-- INV radio box
	#if (${s_inv_check} == 'Y')
		#if (${session_rhq_ofc_cd} != 'SINHO')
		AND A.CRE_OFC_CD IN ( SELECT OFC_CD FROM MDM_ORGANIZATION WHERE AR_HD_QTR_OFC_CD = @[session_rhq_ofc_cd] )
		#end
		#if (${s_invoice_no} != '')	
			AND A.DMDT_INV_NO IN (
				#foreach( $invoice_cd in ${invoice_no_list} )
					#if($velocityCount < $invoice_no_list.size()) 
						'$invoice_cd', 
					#else 
						'$invoice_cd' 
					#end
				#end
				)
		#end
		#if (${s_bkg_no} != '')	
			AND A.BKG_NO IN (
				#foreach( $bkg_cd in ${bkg_no_list} )
					#if($velocityCount < $bkg_no_list.size()) 
						'$bkg_cd', 
					#else 
						'$bkg_cd' 
					#end
				#end
				)
		#end
		#if (${s_bl_no} != '')	
			AND A.BL_NO IN (
				#foreach( $bl_cd in ${bl_no_list} )
					#if($velocityCount < $bl_no_list.size()) 
						'$bl_cd', 
					#else 
						'$bl_cd' 
					#end
				#end
				)
		#end
	#end
	-- OVER DAYS
	#if(${s_inv_over} != '')
	AND (TO_DATE(TO_CHAR(NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(A.CRE_OFC_CD),SYSDATE), 'YYYYMMDD'), 'YYYYMMDD') - TO_DATE(TO_CHAR(A.CRE_DT, 'YYYYMMDD'), 'YYYYMMDD')) > = @[s_inv_over]
	#end
	-- ISSUE ID
	#if(${s_issue_usr_id} != '')
	AND A.CRE_USR_ID = @[s_issue_usr_id]
	#end
	-- PAYER
	#if(${s_payer_cd} != '')
		#if (${s_cust_gubun} == '1')
		AND LPAD(A.ACT_PAYR_SEQ,6,'0') = LPAD(@[s_cust_cd],6,'0')
		#elseif (${s_cust_gubun} == '2') 
		AND A.ACT_PAYR_CNT_CD = SUBSTR(@[s_cust_cd],1,2)
		AND LPAD(A.ACT_PAYR_SEQ,6,'0') = SUBSTR(@[s_cust_cd],3)
		#end
	#end
	-- SC NO
	#if(${s_sc_no} != '')
	AND A.SC_NO = @[s_sc_no]
	#end
	-- RFA NO
	#if(${s_rfa_no} != '')
	AND A.RFA_NO = @[s_rfa_no]
	#end
	ORDER BY A.DMDT_INV_NO
#end			]]></sql>
			<params>
				<param name="s_issue_fm" type="12" value="" out="N"/>
				<param name="s_issue_to" type="12" value="" out="N"/>
				<param name="session_rhq_ofc_cd" type="12" value="" out="N"/>
				<param name="s_inv_over" type="12" value="" out="N"/>
				<param name="s_issue_usr_id" type="12" value="" out="N"/>
				<param name="s_cust_cd" type="12" value="" out="N"/>
				<param name="s_sc_no" type="12" value="" out="N"/>
				<param name="s_rfa_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
