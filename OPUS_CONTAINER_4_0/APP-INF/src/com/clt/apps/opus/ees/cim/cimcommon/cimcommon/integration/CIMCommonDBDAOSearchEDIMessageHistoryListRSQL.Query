<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CIMCommonDBDAOSearchEDIMessageHistoryListRSQL">
			<desc><![CDATA[EDI Message History List]]></desc>
			<sql><![CDATA[
SELECT BKG_NO,
	BL_NO,
	CALL_SGN_LLOYD,
	CALL_SGN_NO,
	LLOYD_NO,
	CHSS_NO,
	CNTR_FULL_STS_CD,
	CNTR_NO,
	CNTR_SEAL_NO,
	CNTR_TPSZ_CD,
	CRE_LOCL_DT,
	VVD_CD,
	CRNT_VSL_CD, 
	CRNT_SKD_VOY_NO,
	CRNT_SKD_DIR_CD,
	DEST_YD_CD,
	POL_CD,
	POD_CD,
	EDI_BKG_NO,
	EDI_GATE_IO_CD,
	EDI_MVMT_STS_CD,
	EVNT_DT,
	EVNT_YD_CD,
	MVMT_EDI_MSG_AREA_CD,
	MVMT_EDI_MSG_SEQ,
	MVMT_EDI_MSG_TP_ID,
	MVMT_EDI_MSG_YRMONDY,
	MVMT_EDI_TP_CD,
	MVMT_EDI_RMK,
	CNMV_RMK,
	MVMT_EDI_RSLT_CD,
	MVMT_EDI_SGHT_CD,
	MVMT_TRSP_MOD_CD,
	RTY_KNT,
	VNDR_SEQ,
	MGST_NO,
	WBL_NO,
	PKUP_NO,
	LCC_CD,
	WO_NO,
	EDI_VVD_CD,
	TIR_NO,
	MTY_PLN_NO,
	MTY_REPO_NO,
	EDI_CRR_NO,
	TRSP_DOC_NO,
	FLT_FILE_REF_NO
	FROM (
		SELECT ROW_NUMBER() OVER (ORDER BY EVNT_DT) AS ROWNO,
			BKG_NO,
			BL_NO,
			CALL_SGN_LLOYD,
			CALL_SGN_NO,
			LLOYD_NO,
			CHSS_NO,
			CNTR_FULL_STS_CD,
			CNTR_NO,
			CNTR_SEAL_NO,
			CNTR_TPSZ_CD,
			CRE_LOCL_DT,
			VVD_CD,
			CRNT_VSL_CD,
			CRNT_SKD_VOY_NO,
			CRNT_SKD_DIR_CD,
			DEST_YD_CD,
			POL_CD,
			POD_CD,
			EDI_BKG_NO,
			EDI_GATE_IO_CD,
			EDI_MVMT_STS_CD,
			EVNT_DT,
			EVNT_YD_CD,
			MVMT_EDI_MSG_AREA_CD,
			MVMT_EDI_MSG_SEQ,
			MVMT_EDI_MSG_TP_ID,
			MVMT_EDI_MSG_YRMONDY,
			MVMT_EDI_TP_CD,
			MVMT_EDI_RMK,
			CNMV_RMK,
			MVMT_EDI_SGHT_CD,
			MVMT_TRSP_MOD_CD,
			MVMT_EDI_RSLT_CD,
			RTY_KNT,
			VNDR_SEQ,
			MGST_NO,
			WBL_NO,
			PKUP_NO,
			LCC_CD,
			WO_NO,
			EDI_VVD_CD,
			TIR_NO,
			MTY_PLN_NO,
			MTY_REPO_NO,
			EDI_CRR_NO,
			TRSP_DOC_NO,
			FLT_FILE_REF_NO
		FROM (
			SELECT /*+ USE_NL(D B A) */
				D.BKG_NO,
				D.EDI_BL_NO AS BL_NO,
				NVL(D.CALL_SGN_NO, D.LLOYD_NO) AS CALL_SGN_LLOYD,
				D.CALL_SGN_NO AS CALL_SGN_NO,
				D.LLOYD_NO AS LLOYD_NO,
				D.CHSS_NO,
				D.CNTR_FULL_STS_CD,
				D.CNTR_NO,
				D.CNTR_SEAL_NO,
				D.CNTR_TPSZ_CD,
				TO_CHAR(D.CRE_LOCL_DT, 'YYYYMMDDHH24MI') AS CRE_LOCL_DT,
				D.CRNT_VSL_CD||D.CRNT_SKD_VOY_NO||D.CRNT_SKD_DIR_CD AS VVD_CD,
				D.CRNT_VSL_CD,
				D.CRNT_SKD_VOY_NO,
				D.CRNT_SKD_DIR_CD,
				D.DEST_YD_CD,
				D.BKG_POL_CD AS POL_CD,
				D.BKG_POD_CD AS POD_CD,
				D.EDI_BKG_NO,
				D.EDI_GATE_IO_CD,
				D.EDI_MVMT_STS_CD,
				TO_CHAR(D.EVNT_DT, 'YYYYMMDDHH24MI') AS EVNT_DT,
				D.EVNT_YD_CD,
				D.MVMT_EDI_MSG_AREA_CD,
				D.MVMT_EDI_MSG_SEQ,
				D.MVMT_EDI_MSG_TP_ID,
				D.MVMT_EDI_MSG_YRMONDY,
				D.MVMT_EDI_TP_CD,
				D.MVMT_EDI_RMK,
				D.CNMV_RMK,
				D.MVMT_EDI_SGHT_CD,
				D.MVMT_TRSP_MOD_CD,
				D.MVMT_EDI_RSLT_CD,
				D.RTY_KNT,
				D.VNDR_SEQ,
				D.MGST_NO,
				D.WBL_NO,
				D.PKUP_NO,
				A.LCC_CD,
				D.WO_NO,
				D.EDI_VVD_CD,
				D.TIR_NO,
				D.MTY_PLN_NO,
				D.MTY_REPO_NO,
				D.EDI_CRR_NO,
				D.TRSP_DOC_NO,
				D.FLT_FILE_REF_NO
			FROM 
				CTM_MVMT_EDI_MSG D, 
				MDM_LOCATION B, 
				MDM_EQ_ORZ_CHT A, 
				COM_SYS_AREA_GRP_ID G, 
				MDM_YARD M
			WHERE 1 = 1
			AND   D.EVNT_YD_CD          = M.YD_CD(+)
			AND   SUBSTR(M.YD_CD, 1, 2) = G.CNT_CD(+)
			AND D.CNTR_NO = @[p_cntrno]||@[check_digit]             
			AND A.SCC_CD(+) = B.SCC_CD
			AND B.LOC_CD(+) = SUBSTR(D.EVNT_YD_CD, 0, 5)
		)
	)
ORDER BY ROWNO

			]]></sql>
			<params>
				<param name="p_cntrno" type="12" value="" out="N"/>
				<param name="check_digit" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
