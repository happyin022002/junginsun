<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AgreementRegistrationDBDAOAgreementRSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
SELECT LA.AGMT_CTY_CD
     , LA.AGMT_SEQ
     , LA.AGMT_LST_VER_SEQ	 
#if ( ${agmt_ver_seq} != '' )
     , NVL2(LV.LSTM_CD, LV.OLD_AGMT_NO, LA.OLD_AGMT_NO) AS OLD_AGMT_NO
     , LV.AGMT_VER_SEQ AS AGMT_VER_SEQ
     , TO_CHAR(NVL2(LV.LSTM_CD, LV.EFF_DT, LA.LST_EFF_DT),'YYYYMMDD') AS EFF_DT
     , TO_CHAR(NVL2(LV.LSTM_CD, LV.EXP_DT, LA.LST_EXP_DT),'YYYYMMDD') AS EXP_DT
     , LA.VNDR_SEQ AS VNDR_SEQ
     , MV.VNDR_LGL_ENG_NM AS VNDR_NM 
     , LA.LSTM_CD
     , NVL2(LV.LSTM_CD, LV.OFC_CD, LA.OFC_CD) AS OFC_CD
     , NVL2(LV.LSTM_CD, LV.CURR_CD, LA.CURR_CD) AS CURR_CD
     , NVL2(LV.LSTM_CD, LV.REF_NO, LA.REF_NO) AS REF_NO
     , NVL2(LV.LSTM_CD, LV.LSE_CTRT_NO, LA.LSE_CTRT_NO) AS LSE_CTRT_NO
     , NVL2(LV.LSTM_CD, LV.DPC_RTO, LA.DPC_RTO) AS DPC_RTO
     , NVL2(LV.LSTM_CD, LV.MAX_DPC_RTO, LA.MAX_DPC_RTO) AS MAX_DPC_RTO
     , NVL2(LV.LSTM_CD, LV.CNTR_DPC_LVL_CD, LA.CNTR_DPC_LVL_CD) AS CNTR_DPC_LVL_CD
     , NVL2(LV.LSTM_CD, LV.DPP_TP_CD, LA.DPP_TP_CD) AS DPP_TP_CD
     , TO_CHAR(NVL2(LV.LSTM_CD, LV.AGMT_DT, LA.AGMT_DT),'YYYYMMDD') AS AGMT_DT
     , NVL2(LV.LSTM_CD, LV.AGMT_RMK, LA.AGMT_RMK) AS AGMT_RMK
     , TO_CHAR(NVL2(LV.LSTM_CD, LV.BLD_UP_DT, LA.BLD_UP_DT),'YYYYMMDD') AS BLD_UP_DT
     , NVL2(LV.LSTM_CD, LV.LFT_ONF_CHG_CD, LA.LFT_ONF_CHG_CD) AS LFT_ONF_CHG_CD
     , NVL2(LV.LSTM_CD, LV.LSE_PAY_TERM_DYS, LA.LSE_PAY_TERM_DYS) AS LSE_PAY_TERM_DYS
     , NVL2(LV.LSTM_CD, LV.LSE_FREE_DYS, LA.LSE_FREE_DYS) AS LSE_FREE_DYS
     , NVL2(LV.LSTM_CD, LV.ITCHG_FEE_FLG, LA.ITCHG_FEE_FLG) AS ITCHG_FEE_FLG
     , NVL2(LV.LSTM_CD, LV.DIR_ITCHG_FEE_AMT, LA.DIR_ITCHG_FEE_AMT) AS DIR_ITCHG_FEE_AMT
     , NVL2(LV.LSTM_CD, LV.LSE_VNDR_URL, LA.LSE_VNDR_URL) AS LSE_VNDR_URL
     , NVL2(LV.LSTM_CD, LV.DPC_VAL_FLG, LA.DPC_VAL_FLG) AS DPC_VAL_FLG
 	 , LA.CRE_USR_ID||' / '||LA.UPD_USR_ID AS CRE_USR_ID
     , TO_CHAR(LA.CRE_DT, 'YYYY-MM-DD')||' / '||TO_CHAR(LA.UPD_DT, 'YYYY-MM-DD') AS CRE_DT
	 ,(SELECT   CASE WHEN COUNT(*) = 0 THEN 'Y' ELSE 'N' END
       FROM     MST_CONTAINER
       WHERE    AGMT_CTY_CD = LA.AGMT_CTY_CD
       AND      AGMT_SEQ = LA.AGMT_SEQ
       AND     (ACIAC_DIV_CD = 'A' OR (ACIAC_DIV_CD = 'I'
       AND      CNTR_STS_CD IN('SBO','MUO','LST','SRO'))) 
	   ) AS AGMT_ACT_FLG
     , NVL2(LV.LSTM_CD, LV.SLB_FLG, LA.SLB_FLG) AS SLB_FLG
	 , NVL2(LV.LSTM_CD, LV.LSE_PAY_TP_CD, LA.LSE_PAY_TP_CD) AS LSE_PAY_TP_CD
     , NVL(TO_CHAR( NVL2(LV.LSTM_CD, LV.BLD_DWN_END_DT, LA.BLD_DWN_END_DT),'YYYY-MM-DD'),'') AS BLD_DWN_END_DT
#else
     , LA.OLD_AGMT_NO
     , LA.AGMT_LST_VER_SEQ AS AGMT_VER_SEQ
     , TO_CHAR(LA.LST_EFF_DT,'YYYYMMDD') AS EFF_DT
     , TO_CHAR(LA.LST_EXP_DT,'YYYYMMDD') AS EXP_DT
     , LA.VNDR_SEQ
     , MV.VNDR_LGL_ENG_NM AS VNDR_NM
     , LA.LSTM_CD
     , LA.OFC_CD
     , LA.CURR_CD
     , LA.REF_NO
     , LA.LSE_CTRT_NO
     , LA.DPC_RTO
     , LA.MAX_DPC_RTO
     , LA.CNTR_DPC_LVL_CD
     , LA.DPP_TP_CD
     , TO_CHAR(LA.AGMT_DT,'YYYYMMDD') AS AGMT_DT
     , LA.AGMT_RMK
     , TO_CHAR(LA.BLD_UP_DT,'YYYYMMDD') AS BLD_UP_DT
     , LA.LFT_ONF_CHG_CD
     , LA.LSE_PAY_TERM_DYS
     , LA.LSE_FREE_DYS
     , LA.ITCHG_FEE_FLG
     , LA.DIR_ITCHG_FEE_AMT
     , LA.LSE_VNDR_URL
     , LA.DPC_VAL_FLG
     , LA.CRE_USR_ID||' / '||LA.UPD_USR_ID AS CRE_USR_ID
     , TO_CHAR(LA.CRE_DT, 'YYYY-MM-DD')||' / '||TO_CHAR(LA.UPD_DT, 'YYYY-MM-DD') AS CRE_DT
	 ,(SELECT   CASE WHEN COUNT(*) = 0 THEN 'Y' ELSE 'N' END
       FROM     MST_CONTAINER
       WHERE    AGMT_CTY_CD = LA.AGMT_CTY_CD
       AND      AGMT_SEQ = LA.AGMT_SEQ
       AND     (ACIAC_DIV_CD = 'A' OR (ACIAC_DIV_CD = 'I'
       AND      CNTR_STS_CD IN('SBO','MUO','LST','SRO'))) 
	   ) AS AGMT_ACT_FLG
     , LA.SLB_FLG
	 , LA.LSE_PAY_TP_CD
	 , NVL(TO_CHAR(LA.BLD_DWN_END_DT,'YYYY-MM-DD'),'') AS BLD_DWN_END_DT
#end
FROM   LSE_AGREEMENT LA
     , MDM_VENDOR    MV
     , LSE_AGMT_VER  LV
WHERE  MV.VNDR_SEQ = LA.VNDR_SEQ
AND    LA.AGMT_CTY_CD = LV.AGMT_CTY_CD(+)
AND    LA.AGMT_SEQ    = LV.AGMT_SEQ(+)
#if ( ${agmt_ver_seq} != '' )
AND    LV.AGMT_VER_SEQ = @[agmt_ver_seq]
#end
AND    LA.AGMT_SEQ = @[agmt_seq]
AND    LA.AGMT_CTY_CD = @[agmt_cty_cd]			]]></sql>
			<params>
				<param name="agmt_ver_seq" type="2" value="" out="N"/>
				<param name="agmt_seq" type="2" value="" out="N"/>
				<param name="agmt_cty_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
