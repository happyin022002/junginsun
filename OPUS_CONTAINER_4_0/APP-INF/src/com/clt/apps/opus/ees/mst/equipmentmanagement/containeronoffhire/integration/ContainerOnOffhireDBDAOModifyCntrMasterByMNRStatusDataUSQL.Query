<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContainerOnOffhireDBDAOModifyCntrMasterByMNRStatusDataUSQL">
			<desc><![CDATA[ModifyCntrMasterByMNRStatusData]]></desc>
			<sql><![CDATA[
UPDATE MST_CONTAINER A
SET ( 
     LOC_CD
   , SCC_CD
   , LCC_CD
   , ECC_CD
   , RCC_CD
   , SYS_AREA_GRP_ID
   , CNMV_YR
   , CNMV_ID_NO
   , CNMV_SEQ
   , CNMV_CYC_NO
   , CNMV_DT
   , CNMV_GDT
   , FULL_FLG
   , CRNT_YD_CD 
   , DEST_YD_CD
   , CNMV_STS_CD
   , ACIAC_DIV_CD)
 = (SELECT 
            SUBSTR(CM.ORG_YD_CD,0,5) 
          , MST_LOC_FNC(SUBSTR(CM.ORG_YD_CD, 1, 5),'SCC')
          , MST_LOC_FNC(SUBSTR(CM.ORG_YD_CD, 1, 5),'LCC')
          , MST_LOC_FNC(SUBSTR(CM.ORG_YD_CD, 1, 5),'ECC')
          , MST_LOC_FNC(SUBSTR(CM.ORG_YD_CD, 1, 5),'RCC')
          , (SELECT SYS_AREA_GRP_ID
               FROM   COM_SYS_AREA_GRP_ID B   
              WHERE SUBSTR(CM.ORG_YD_CD, 1, 2) = B.CNT_CD
                AND B.CO_IND_CD                = 'H'
                AND ROWNUM                     = 1)
          , CM.CNMV_YR       
          , CM.CNMV_ID_NO
          , CM.CNMV_SEQ
          , CM.CNMV_CYC_NO
          , CM.CNMV_EVNT_DT
          , GLOBALDATE_PKG.TIME_CONV_FNC ( SUBSTR(CM.ORG_YD_CD, 1, 5), CM.CNMV_EVNT_DT, 'GMT' )
          , NVL(CM.FCNTR_FLG, 'F')
          , CM.ORG_YD_CD
          , CM.DEST_YD_CD
	      , CM.MVMT_STS_CD
          , DECODE(CM.MVMT_STS_CD, 'XX', 'I', 'A')
        FROM  CTM_MOVEMENT CM 
           ,  ( SELECT SB.CNTR_NO AS CNTR_NO
                     , MAX(SB.CNMV_YR) AS CNMV_YR
                     , SUBSTR(MAX(SB.CNMV_YR||TO_CHAR(SB.CNMV_ID_NO, '00000')) , - 5) AS CNMV_ID_NO
                     , SUBSTR(MAX(SB.CNMV_YR||TO_CHAR(SB.CNMV_ID_NO, '00000')||TO_CHAR(SB.CNMV_SEQ, '0000')) , - 4) AS CNMV_SEQ
                  FROM CTM_MOVEMENT SB
                 WHERE SB.CNTR_NO = @[cntr_no]
                 GROUP BY SB.CNTR_NO) SB                            
        WHERE  A.CNTR_NO        = SB.CNTR_NO
          AND  SB.CNTR_NO       = CM.CNTR_NO
          AND  SB.CNMV_YR       = CM.CNMV_YR
          AND  SB.CNMV_ID_NO    = CM.CNMV_ID_NO
          AND  SB.CNMV_SEQ      = CM.CNMV_SEQ
          AND  ROWNUM           = 1
  )
   ,(CNTR_STS_CD,LST_STS_YD_CD,LST_STS_SEQ) 
        =(SELECT /*+ INDEX_DESC(B XAK1MST_CNTR_STS_HIS) */
            B.CNTR_STS_CD, B.YD_CD, B.CNTR_STS_SEQ
        FROM MST_CNTR_STS_HIS B
        WHERE A.CNTR_NO=B.CNTR_NO
        AND ROWNUM=1)
 ,(LSTM_CD,AGMT_CTY_CD,AGMT_SEQ,VNDR_SEQ,ONH_FREE_DYS,MIN_ONH_DYS, ONH_CNTR_STS_CD,ONH_DT,ONH_YD_CD,ONH_STS_SEQ) 
        = (SELECT LA.LSTM_CD, LA.AGMT_CTY_CD,LA.AGMT_SEQ,LA.VNDR_SEQ, B.RNTL_CHG_FREE_DYS,B.CNTR_MIN_ONH_DYS,
                     B.CNTR_STS_CD,B.CNTR_STS_EVNT_DT,B.YD_CD,B.CNTR_STS_SEQ
           FROM MST_CNTR_STS_HIS B
                  , LSE_AGREEMENT LA
           WHERE B.AGMT_CTY_CD  = LA.AGMT_CTY_CD
           AND   B.AGMT_SEQ     = LA.AGMT_SEQ
           AND   B.CNTR_NO      = A.CNTR_NO
           AND   B.CNTR_STS_SEQ = MST_ONH_STS_SEQ_FNC(A.CNTR_NO))           
#if (${p_type1} == 'N')
	,A.FA_IF_GRP_STS_CD = NULL
	,A.FA_IF_TP_CD = NULL
	,A.FA_IF_STS_CD = NULL
	,A.FA_IF_ERR_MSG = NULL
	,A.FA_IF_DT = NULL
#end
   ,A.UPD_DT		= SYSDATE
   ,A.UPD_USR_ID	= @[upd_usr_id]
WHERE A.CNTR_NO 	= @[cntr_no]			]]></sql>
			<params>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
