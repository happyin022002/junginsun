<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="LongstayingUnclaimEQFlaggingDBDAOsearchSDaysTotalCntRSQL">
			<desc><![CDATA[Container Staying Days Summary 총갯수]]></desc>
			<sql><![CDATA[
SELECT
         COUNT(*) AS TOTAL_CNT
FROM
(
    SELECT
        DECODE(@[loc_type_code],'1',LCC_CD,'2',SCC_CD,'3',SCC_CD,'4',SCC_CD,'5',SCC_CD) SUB_LOC_CD
        ,A.CRNT_YD_CD
        ,A.CNTR_NO
        ,A.CNTR_TPSZ_CD

		,A.VNDR_SEQ VNDR_CD
        ,(SELECT VNDR_LGL_ENG_NM FROM MDM_VENDOR WHERE VNDR_SEQ=A.VNDR_SEQ) VNDR_NM
        ,MST_COMMON_PKG.MST_AGMT_NO_CONV_FNC(A.AGMT_CTY_CD, A.AGMT_SEQ) AGMT_NO
		,B.SLAN_CD   SLN_CD
        ,B.SLAN_CD   SLN_LANE_CD
        ,B.SVC_SCP_CD SVC_SCP_CD

        ,A.LSTM_CD
        ,A.CNMV_STS_CD
    	,DECODE(A.FULL_FLG,'Y','F','M') FULL_FLG
        ,TO_CHAR(A.CNMV_DT,'YYYY-MM-DD') CNMV_DT
		#if (${sub_loc_cd} != '')
			,CEIL(TO_DATE(@[rcc_date],'yyyy-MM-dd HH24:mi:SS')- A.CNMV_DT ) STAY_DAYS
		#else
			#if (${loc_type_code} == '1')
    			,CEIL(TO_DATE((SELECT DISTINCT TO_CHAR(GLOBALDATE_PKG.TIME_LOCAL_FNC(A.RCC_CD),'YYYYMMDD HH24:mi:SS')  FROM MDM_EQ_ORZ_CHT MEQC WHERE MEQC.RCC_CD=A.RCC_CD AND ROWNUM =1),'yyyy-MM-dd HH24:mi:SS')- A.CNMV_DT ) STAY_DAYS
    		#elseif (${loc_type_code} == '2')
    			,CEIL(TO_DATE((SELECT DISTINCT TO_CHAR(GLOBALDATE_PKG.TIME_LOCAL_FNC(A.RCC_CD),'YYYYMMDD HH24:mi:SS')  FROM MDM_EQ_ORZ_CHT MEQC WHERE MEQC.LCC_CD=A.LCC_CD AND ROWNUM =1),'yyyy-MM-dd HH24:mi:SS')- A.CNMV_DT ) STAY_DAYS
    		#elseif (${loc_type_code} == '3')
    			,CEIL(TO_DATE((SELECT DISTINCT TO_CHAR(GLOBALDATE_PKG.TIME_LOCAL_FNC(A.RCC_CD),'YYYYMMDD HH24:mi:SS')  FROM MDM_EQ_ORZ_CHT MEQC WHERE MEQC.LCC_CD=A.LCC_CD AND ROWNUM =1),'yyyy-MM-dd HH24:mi:SS')- A.CNMV_DT ) STAY_DAYS
    		#elseif (${loc_type_code} == '4')
        		,CEIL(TO_DATE((SELECT DISTINCT TO_CHAR(GLOBALDATE_PKG.TIME_LOCAL_FNC(A.RCC_CD),'YYYYMMDD HH24:mi:SS')  FROM MDM_EQ_ORZ_CHT MEQC WHERE MEQC.ECC_CD=A.ECC_CD AND ROWNUM =1),'yyyy-MM-dd HH24:mi:SS')- A.CNMV_DT ) STAY_DAYS
    		#elseif (${loc_type_code} == '5')
        		,CEIL(TO_DATE((SELECT DISTINCT TO_CHAR(GLOBALDATE_PKG.TIME_LOCAL_FNC(A.RCC_CD),'YYYYMMDD HH24:mi:SS')  FROM MDM_EQ_ORZ_CHT MEQC WHERE MEQC.SCC_CD=A.SCC_CD AND ROWNUM =1),'yyyy-MM-dd HH24:mi:SS')- A.CNMV_DT ) STAY_DAYS
    		#elseif (${loc_type_code} == '6')
				,CEIL(TO_DATE((SELECT DISTINCT TO_CHAR(GLOBALDATE_PKG.TIME_LOCAL_FNC(A.RCC_CD),'YYYYMMDD HH24:mi:SS')  FROM MDM_EQ_ORZ_CHT MEQC WHERE MEQC.SCC_CD=(SELECT SCC_CD FROM MDM_LOCATION WHERE LOC_CD=SUBSTR(@[loc_cd],1,5)) AND ROWNUM =1),'yyyy-MM-dd HH24:mi:SS')- A.CNMV_DT ) STAY_DAYS
    		#end     
		#end
/*
        ,(
            SELECT  LTRIM(TO_CHAR(FT_DYS,'0000')) || TO_CHAR(FT_END_DT,'YYYY-MM-DD')
            FROM DMT_CHG_CALC E,DMT_CHG_BKG_CNTR F
            WHERE E.CNTR_NO = A.CNTR_NO
            AND E.SYS_AREA_GRP_ID  =  A.SYS_AREA_GRP_ID
            AND E.CNTR_CYC_NO = A. CNMV_CYC_NO
            AND E.CHG_SEQ = 1
            AND (DECODE(A.CNMV_STS_CD, 'IC','VD', A.CNMV_STS_CD) = E.FM_MVMT_STS_CD
                        OR  DECODE(A.CNMV_STS_CD,'IC','IC','') = E.FM_MVMT_STS_CD)
            AND E.DMDT_CHG_STS_CD <> 'E'
            AND F.CNTR_NO = E.CNTR_NO
            AND F.SYS_AREA_GRP_ID  =  E.SYS_AREA_GRP_ID
            AND F.CNTR_CYC_NO = E.CNTR_CYC_NO
            AND F.BKG_NO = A.BKG_NO    
       	 	AND ROWNUM =1
        ) FT_END_DYS
*/
		,(SELECT  MAX(NVL(TO_CHAR(FT_END_DT,'YYYY-MM-DD'),'1111-11-11')||LTRIM(TO_CHAR(FT_DYS,'0000')))
        FROM DMT_CHG_CALC E,DMT_CHG_BKG_CNTR F
        WHERE E.CNTR_NO = A.CNTR_NO
        AND E.SYS_AREA_GRP_ID  =  A.SYS_AREA_GRP_ID
        AND E.CNTR_CYC_NO = A. CNMV_CYC_NO
        AND E.CHG_SEQ = 1
        AND E.FM_MVMT_YD_CD = A.CRNT_YD_CD
        AND E.DMDT_CHG_STS_CD <> 'E'
        AND F.CNTR_NO = E.CNTR_NO
        AND F.SYS_AREA_GRP_ID  = E.SYS_AREA_GRP_ID
        AND F.CNTR_CYC_NO = E.CNTR_CYC_NO
        AND F.BKG_NO = A.BKG_NO
		AND A.CNMV_STS_CD NOT IN ('TS','MT')
		AND ROWNUM =1
		) FT_END_DYS 
        ,A.BKG_NO
        ,B.BL_NO
        ,(SELECT REPLACE(REPLACE(SUBSTR(W.CUST_NM,1,50),CHR(13)||chr(10),' '), CHR(10), ' ')
        FROM BKG_CUSTOMER W                                          
        WHERE A.BKG_NO = W.BKG_NO                                    
        AND W.BKG_CUST_TP_CD='S') SHPR                               
                                                                     
        ,(SELECT REPLACE(REPLACE(SUBSTR(W.CUST_NM,1,50),CHR(13)||chr(10),' '), CHR(10), ' ')
        FROM BKG_CUSTOMER W                                          
        WHERE A.BKG_NO = W.BKG_NO                                    
        AND W.BKG_CUST_TP_CD='C') CNEE                               
                                                                     
        ,(SELECT REPLACE(REPLACE(SUBSTR(W.CUST_NM,1,50),CHR(13)||chr(10),' '), CHR(10), ' ')
        FROM BKG_CUSTOMER W                                          
        WHERE A.BKG_NO = W.BKG_NO                                    
        AND W.BKG_CUST_TP_CD='N') NTFY     
    	,(SELECT D.REP_CMDT_NM FROM MDM_REP_CMDT D
    	   WHERE   B.REP_CMDT_CD = D.REP_CMDT_CD
    	) REP_CMDT_NM
        ,(SELECT REPLACE(REPLACE(X.MK_DESC,CHR(13)||chr(10),' '), CHR(10), ' ')
        FROM BKG_BL_MK_DESC X
        WHERE A.BKG_NO = X.BKG_NO) MK_DESC
    	,B.OB_SLS_OFC_CD
    	,A.DMG_FLG
		,A.CNTR_HNGR_RCK_CD 
		,A.MNR_HNGR_BAR_TP_CD
    	,A.CNTR_HNGR_BAR_ATCH_KNT
    	,A.DISP_FLG
    	,A.IMDT_EXT_FLG
    	,DECODE(A.UCLM_LS_DIV_CD,'U','Y','N') UCLM_LS_FLG
    	,A.PLST_FLR_FLG
    FROM MST_CONTAINER A,BKG_BOOKING B
    WHERE A.ACIAC_DIV_CD='A'
    AND   A.CNMV_STS_CD NOT IN ('XX','VL')
    AND   A.BKG_NO =B.BKG_NO(+)
    
	#if(${loc_cd} != '')
    	#if (${loc_type_code} == '1')
    		AND A.RCC_CD =@[loc_cd]
    	#elseif (${loc_type_code} == '2')
    		AND A.LCC_CD =@[loc_cd]
    	#elseif (${loc_type_code} == '3')
    		AND A.LCC_CD =@[loc_cd]
    	#elseif (${loc_type_code} == '4')
    	    AND A.ECC_CD =@[loc_cd]
   	 	#elseif (${loc_type_code} == '5')
       	 	AND A.SCC_CD =@[loc_cd]
    	#elseif (${loc_type_code} == '6')
        	AND A.CRNT_YD_CD =@[loc_cd]
    	#end 
	#end

    #if (${cntr_tpsz_cd} != '')
    	AND A.CNTR_TPSZ_CD IN ( 
    		  				 SELECT COLUMN_VALUE
        	                 FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[cntr_tpsz_cd] ) AS listItemType ) 
            	             FROM dual )
    				        )
    #end
    #if (${dmg_flg} != '')
    	AND A.DMG_FLG = @[dmg_flg]
    #end  
    
    #if (${cnmv_sts_cd} != '')
    	AND A.CNMV_STS_CD IN ( 
    		  				 SELECT COLUMN_VALUE
        	                 FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[cnmv_sts_cd] ) AS listItemType ) 
            	             FROM dual )
    				        )
    #end
    #if (${uclm_ls_div_cd} == 'E')
    	AND NVL(A.UCLM_LS_DIV_CD,'X') <> 'U'
    #elseif(${uclm_ls_div_cd} == 'O')
    	AND A.UCLM_LS_DIV_CD = 'U'
    #end
    
    #if (${full_flg} != '')
    	AND A.FULL_FLG = @[full_flg]
    #end        
    #if (${lstm_cd} != '')
    	AND A.LSTM_CD IN ( 
    		  				 SELECT COLUMN_VALUE
        	                 FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[lstm_cd] ) AS listItemType ) 
            	             FROM dual )
    				        )
    #end 
    #if (${soc_cd} != '')
    	#if (${soc_cd} == '1')
    		AND A.LSTM_CD <> 'SH'
    	#else
    		AND A.LSTM_CD = 'SH'
    	#end
    #end
    #if (${sub_loc_cd} != '')
    	AND DECODE(@[loc_type_code],NULL,RCC_CD,'1',LCC_CD,'2',ECC_CD,'3',SCC_CD,'4',SCC_CD,'5',CRNT_YD_CD,'6',CRNT_YD_CD) =@[sub_loc_cd]
    #end
    #if (${sub_cntr_tpsz_cd} != '')
    	AND A.CNTR_TPSZ_CD IN ( 
    		  				 SELECT COLUMN_VALUE
        	                 FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[sub_cntr_tpsz_cd] ) AS listItemType ) 
            	             FROM dual )
    				        )
    #end
    #if (${sub_cnmv_sts_cd} != '')
    	AND A.CNMV_STS_CD IN ( 
    		  				 SELECT COLUMN_VALUE
        	                 FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[sub_cnmv_sts_cd] ) AS listItemType ) 
            	             FROM dual )
    				        )
    #end
    
    ORDER BY A.LCC_CD,A.CRNT_YD_CD,A.CNTR_NO,A.CNTR_TPSZ_CD,A.LSTM_CD,A.CNMV_STS_CD
) A
#if ((${start_stay_days} != '' && ${end_stay_days} == '')  || (${start_stay_days} == '366'  && ${end_stay_days} == ''))
	WHERE A.STAY_DAYS >= NVL(@[start_stay_days],0) 
#elseif (${start_stay_days} == '0' || ${start_stay_days} == '0')
	WHERE 1=1
#else
	WHERE A.STAY_DAYS >= NVL(@[start_stay_days],0) AND A.STAY_DAYS <= NVL(${end_stay_days},0)
#end			]]></sql>
			<params>
				<param name="loc_type_code" type="12" value="" out="N"/>
				<param name="rcc_date" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="dmg_flg" type="12" value="" out="N"/>
				<param name="cnmv_sts_cd" type="12" value="" out="N"/>
				<param name="full_flg" type="12" value="" out="N"/>
				<param name="lstm_cd" type="12" value="" out="N"/>
				<param name="sub_loc_cd" type="12" value="" out="N"/>
				<param name="sub_cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="sub_cnmv_sts_cd" type="12" value="" out="N"/>
				<param name="start_stay_days" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
