<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChargeCalculationDBDAOAddManualBatchHistoryCSQL">
			<desc><![CDATA[ChargeCalculationDBDAOAddManualBatchHistoryCSQL]]></desc>
			<sql><![CDATA[
INSERT INTO DMT_MNL_BAT_HIS
            (BKG_NO            
            ,CNTR_NO       		
            ,DMDT_TRF_CD   	 
            ,BAT_RUN_TM_ID 	
            ,BAT_RSLT_FLG  
            ,CRE_USR_ID		
            ,CRE_DT		
            ,UPD_USR_ID
            ,UPD_DT
            )
SELECT DISTINCT BKG_NO            
            ,CNTR_NO       		
            ,DMDT_TRF_CD   	 
            ,BAT_RUN_TM_ID 	
            ,BAT_RSLT_FLG  
            ,CRE_USR_ID		
            ,CRE_DT		
            ,UPD_USR_ID
            ,UPD_DT
FROM (
SELECT 
	   @[bkg_no] BKG_NO
     , CNTR_NO CNTR_NO
     , @[dmdt_trf_cd] DMDT_TRF_CD
     , @[bat_run_tm_id] BAT_RUN_TM_ID
     , 'N' BAT_RSLT_FLG
     , @[user_id] CRE_USR_ID
     , SYSDATE CRE_DT
     , @[user_id] UPD_USR_ID
     , SYSDATE UPD_DT
FROM CTM_MOVEMENT
WHERE 1=1
AND BKG_NO			= @[bkg_no]
#if (${batch_cntr} != '')
AND CNTR_NO = @[batch_cntr]
#end
UNION ALL
SELECT @[bkg_no]
     , A.CNTR_NO
     , @[dmdt_trf_cd]
     , @[bat_run_tm_id]
     , 'N'
     , @[user_id]
     , SYSDATE
     , @[user_id]
     , SYSDATE
FROM DMT_CHG_BKG_CNTR A, DMT_CHG_CALC B
WHERE 1=1
AND A.SYS_AREA_GRP_ID = B.SYS_AREA_GRP_ID
AND A.CNTR_NO = B.CNTR_NO
AND A.CNTR_CYC_NO = B.CNTR_CYC_NO
AND A.BKG_NO = @[bkg_no]
AND B.DMDT_TRF_CD = @[dmdt_trf_cd]
#if (${batch_cntr} != '')
AND A.CNTR_NO = @[batch_cntr]
#end
)			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="dmdt_trf_cd" type="12" value="" out="N"/>
				<param name="bat_run_tm_id" type="12" value="" out="N"/>
				<param name="user_id" type="12" value="" out="N"/>
				<param name="batch_cntr" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
