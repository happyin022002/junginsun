<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PerformanceReportDBDAOSearchTireReplacementListDataRSQL">
			<desc><![CDATA[SearchTireReplacementListData]]></desc>
			<sql><![CDATA[
SELECT MNR_COMMON_PKG.MNR_GET_RHQ_OFC_FNC(OFC) RHQ,  
       OFC OFC_CD, 
       MAX(MV.VNDR_LGL_ENG_NM) VNDR_NM,
       SUM(P_QTY) P_QTY,
       SUM(U_QTY) U_QTY,
       SUM(P_QTY - U_QTY) DF_QTY,
       SUM(P_AMT) P_AMT
FROM (
        SELECT OH.COST_OFC_CD OFC,  OH.VNDR_SEQ V_SEQ,
               DECODE(OD.COST_CD, 'MRZSTP', OD.RPR_QTY, 0) P_QTY,
               DECODE(OD.COST_CD, 'MRZSTR', OD.RPR_QTY, 0) U_QTY,
               DECODE(OD.COST_CD, 'MRZSTP',
                         MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), OH.CURR_CD, 'USD', OD.COST_AMT), 0) P_AMT,
               DECODE(OD.COST_CD, 'MRZSTR',
                         MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), OH.CURR_CD, 'USD', OD.COST_AMT), 0) U_AMT                  
        FROM MNR_ORD_HDR OH, MNR_ORD_DTL OD
        WHERE OH.MNR_ORD_OFC_CTY_CD = OD.MNR_ORD_OFC_CTY_CD
        AND   OH.MNR_ORD_SEQ = OD.MNR_ORD_SEQ
		#if (${ofc_cd} != '') 
        AND   OH.COST_OFC_CD = @[ofc_cd]
		#end
        AND   OH.CRE_DT BETWEEN  TO_DATE(@[from_dt], 'YYYY-MM-DD') AND TO_DATE(@[to_dt], 'YYYY-MM-DD') + 0.99999
        AND   OH.EQ_KND_CD = 'Z'
        AND   OH.MNR_WO_TP_CD = 'EXT'
        AND   OD.COST_CD IN ( 'MRZSTP', 'MRZSTR')
        UNION ALL
        SELECT RH.COST_OFC_CD OFC, RH.VNDR_SEQ V_SEQ,
               0 P_QTY,
               RD.RPR_QTY U_QTY,
               0 P_AMT,
               MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), RH.CURR_CD, 'USD', RD.MNR_WRK_AMT) U_AMT                  
        FROM MNR_RPR_RQST_HDR RH, MNR_RPR_RQST_DTL RD
        WHERE RH.RQST_EQ_NO = RD.RQST_EQ_NO
        AND   RH.RPR_RQST_SEQ = RD.RPR_RQST_SEQ
        AND   RH.RPR_RQST_VER_NO = RD.RPR_RQST_VER_NO
        AND   RH.RPR_RQST_LST_VER_FLG = RD.RPR_RQST_LST_VER_FLG
        AND   RH.RPR_RQST_LST_VER_FLG = 'Y'
        AND   RH.EQ_KND_CD = 'Z'
        AND    RH.RPR_STS_CD = 'HA'
        AND   RD.EQ_CMPO_CD = 'KTA'
        AND   RD.EQ_RPR_CD = 'RP'       
		#if (${ofc_cd} != '')  
        AND   RH.COST_OFC_CD = @[ofc_cd]
		#end
        AND   RH.APRO_DT BETWEEN  GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[user_ofc_cd],TO_DATE(@[from_dt], 'YYYY-MM-DD'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC()) AND GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[user_ofc_cd],TO_DATE(@[to_dt], 'YYYY-MM-DD'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC()) + 0.99999 
       ), MDM_VENDOR MV
WHERE V_SEQ = MV.VNDR_SEQ       
GROUP BY OFC, V_SEQ			]]></sql>
			<params>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="from_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="user_ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
