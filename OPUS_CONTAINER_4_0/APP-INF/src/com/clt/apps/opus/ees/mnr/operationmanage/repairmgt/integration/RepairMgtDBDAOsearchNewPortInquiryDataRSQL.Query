<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RepairMgtDBDAOsearchNewPortInquiryDataRSQL">
			<desc><![CDATA[DESC Enter..]]></desc>
			<sql><![CDATA[
SELECT RST.VNDR_SEQ,
       RST.VNDR_NM,
       RST.MNR_WO_TP_CD,
       RST.WO_NO,
       TO_CHAR(GLOBALDATE_PKG.TIME_CONV_OFC_FNC(MNR_COMMON_PKG.MNR_GET_HOOFC_FNC(),RST.ISS_DT,@[cur_ofc_cd]),'YYYY-MM-DD') AS ISS_DT,
       TO_CHAR(GLOBALDATE_PKG.TIME_CONV_OFC_FNC(MNR_COMMON_PKG.MNR_GET_HOOFC_FNC(),RST.MNR_ORD_SND_DT,@[cur_ofc_cd]),'YYYY-MM-DD') AS MNR_ORD_SND_DT,
       RST.INV_NO,
       RST.INV_AMT,
       RST.ORD_HDR_RMK,
       RST.EQ_KND_CD,
       RST.TRSM_MOD_CD,
       RST.MNR_ORD_OFC_CTY_CD,
       RST.MNR_ORD_SEQ,
       RST.COST_CD,
       RST.MNR_WRK_AMT,
       RST.VVD,
       RST.SPR_PRT_SPL_YD_CD,
       TO_CHAR(GLOBALDATE_PKG.TIME_CONV_OFC_FNC(MNR_COMMON_PKG.MNR_GET_HOOFC_FNC(),RST.EST_DT,@[cur_ofc_cd]),'YYYY-MM-DD') AS EST_DT,
       RST.CURR_CD,
       RST.N3PTY_FLG,
       RST.TOTAL_AMT,
       RST.MNR_VRFY_TP_CD,
       RST.RQST_EQ_NO,
       RST.EQ_TPSZ_CD,
       RST.RQST_REF_NO,
       RST.COST_OFC_CD,
       RST.DMG_FLAG,
       (
          SELECT MNR_CD_DP_DESC 
            FROM MNR_GEN_CD
           WHERE PRNT_CD_ID = RST.EQ_KND_CD || 'G'
             AND MNR_CD_ID = RST.COST_CD
       ) AS COST_CD_NM, 
       DECODE(SIGN(LENGTH(RST.INV_NO)),
              1,
              'IP',
              DECODE(SIGN(LENGTH(RST.MNR_ORD_SND_DT)),
                     1,
                     'WS',
                     DECODE(SIGN(LENGTH(RST.ORD_INPUT_DT)), 1, 'WC'))) AS STATUS,
	   TO_CHAR(GLOBALDATE_PKG.TIME_CONV_OFC_FNC(MNR_COMMON_PKG.MNR_GET_HOOFC_FNC(),RST.CRE_DT,@[cur_ofc_cd]),'YYYY-MM-DD') AS CRE_DT,
       #if (${wo_type} == 'EST')
       MNR_COMMON_PKG.MNR_GET_USR_NM_FNC(RST.EST_CRE_USR_ID) AS CRE_USR_ID,
       DENSE_RANK() OVER (ORDER BY RST.RQST_REF_NO ASC) TMP_SEQ
       #else
       MNR_COMMON_PKG.MNR_GET_USR_NM_FNC(RST.ORD_CRE_USR_ID) AS CRE_USR_ID,
	   DENSE_RANK() OVER (ORDER BY RST.WO_NO ASC) TMP_SEQ
       #end
         FROM 
  (
 SELECT 
       #if (${wo_type} == 'EST') 
       NVL(MSV.DMG_FLAG, 'N') DMG_FLAG,
       #else 
	   'N' AS DMG_FLAG,
       #end
       MOH.EQ_KND_CD,
       MVR.VNDR_SEQ,
       MVR.VNDR_LGL_ENG_NM VNDR_NM,
       MOH.COST_OFC_CD,
       MOH.CURR_CD,
       MOD.COST_CD,
       MOH.MNR_WO_TP_CD,
       MOH.MNR_ORD_OFC_CTY_CD || MOH.MNR_ORD_SEQ AS WO_NO,
       MOH.MNR_INP_DT AS ISS_DT,
       MOH.MNR_ORD_SND_DT AS MNR_ORD_SND_DT,
       MOD.INV_NO,
       MOD.INV_AMT,
       MOH.ORD_HDR_RMK,
       MOH.TRSM_MOD_CD,
       MOH.CRE_DT AS ORD_INPUT_DT,
       MOH.MNR_ORD_OFC_CTY_CD,
       MOH.MNR_ORD_SEQ,
       MOH.MNR_WRK_AMT,
       (MOH.VSL_CD || MOH.SKD_VOY_NO || MOH.SKD_DIR_CD) VVD,
       MOH.SPR_PRT_SPL_YD_CD,
       MOH.CRE_USR_ID ORD_CRE_USR_ID,
       MOH.MNR_INP_DT AS EST_DT,
       MOD.N3PTY_FLG,
       MOH.MNR_WRK_AMT TOTAL_AMT,
       MOD.MNR_VRFY_TP_CD,
       MOD.EQ_NO RQST_EQ_NO,
       MOD.EQ_TPSZ_CD,
       MOD.RQST_REF_NO,
       MOH.CRE_DT,
       MOH.CRE_USR_ID EST_CRE_USR_ID
  FROM MNR_ORD_HDR MOH ,
       MNR_ORD_DTL MOD ,
       MDM_VENDOR MVR ,
       MNR_EQ_STS_V MSV
 WHERE 1 = 1
   AND MOH.MNR_ORD_OFC_CTY_CD = MOD.MNR_ORD_OFC_CTY_CD
   AND MOH.MNR_ORD_SEQ = MOD.MNR_ORD_SEQ
   AND MOD.EQ_NO = MSV.EQ_NO
   AND MOH.VNDR_SEQ = MVR.VNDR_SEQ
   AND RTRIM(MOH.COST_OFC_CD) = 'NYCBB'
   AND MOH.MNR_INP_DT BETWEEN GLOBALDATE_PKG.TIME_CONV_OFC_FNC('NYCBB', TO_DATE(REPLACE('2015-01-26', '-', ''), 'yyyymmdd'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC()) AND GLOBALDATE_PKG.TIME_CONV_OFC_FNC('NYCBB', TO_DATE(REPLACE('2015-02-02', '-', ''), 'yyyymmdd') + 0.99999, MNR_COMMON_PKG.MNR_GET_HOOFC_FNC())
   AND MOD.MNR_INP_TP_CD = 'N' 
   #if (${screen_flag} == 'DEL')
   AND RTRIM(MOH.COST_OFC_CD) = @[cost_ofc_cd]	
   #end            

   #if (${wo_no} == '' && ${rqst_eq_no} == '')  
		#if (${cost_ofc_cd} != '' && ${screen_flag} != 'DEL')
        AND RTRIM(MOH.COST_OFC_CD) = @[cost_ofc_cd]
        #end
        #if (${fm_est_dt} != '' && ${to_est_dt} != '')
        AND MOH.MNR_INP_DT BETWEEN GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[cur_ofc_cd],TO_DATE(REPLACE(@[fm_est_dt],'-',''), 'yyyymmdd'),MNR_COMMON_PKG.MNR_GET_HOOFC_FNC()) AND GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[cur_ofc_cd],TO_DATE(REPLACE(@[to_est_dt],'-',''), 'yyyymmdd') + 0.99999,MNR_COMMON_PKG.MNR_GET_HOOFC_FNC())
        #end
    #end

	#if (${vndr_seq} != '')
    AND RTRIM(MOH.VNDR_SEQ) = TO_NUMBER(@[vndr_seq])
    #end
    #if (${eq_knd_cd} != 'A')
    AND MOH.EQ_KND_CD = @[eq_knd_cd]
    #end
    #if (${rqst_eq_no} != '')
    AND MOD.EQ_NO IN (
       #foreach ($user_eq_no IN ${eqNos})
            #if($velocityCount < $eqNos.size())
                 '$user_eq_no',
            #else
                 '$user_eq_no'
            #end
        #end
    )
    #end
	#if (${wo_no} != '')
	AND (MOH.MNR_ORD_OFC_CTY_CD, MOH.MNR_ORD_SEQ) IN
		  ( 
				#foreach ($user_wo_no IN ${woNos})
					#if($velocityCount < $woNos.size())
						(SUBSTR('$user_wo_no', 1, 3), SUBSTR('$user_wo_no', 4)) ,
					#else
						(SUBSTR('$user_wo_no', 1, 3), SUBSTR('$user_wo_no', 4))
					#end
				#end	
		   )
	#end
    #if (${cost_cd} != 'A' && ${cost_cd} != '')
    AND MOH.COST_CD = @[cost_cd]
    #end
#if (${wo_type} != '')
	#if (${wo_type} == 'EST')
		AND MOH.MNR_WO_TP_CD = @[wo_type]
	#else
		AND RTRIM(MOH.MNR_WO_TP_CD) = @[wo_type]
	#end
#end
	  ) RST
WHERE 1 = 1
#if (${status_cd} == 'IP')
AND RST.INV_NO IS NOT NULL
#elseif (${status_cd} == 'WS')
AND RST.INV_NO IS NULL
AND RST.MNR_ORD_SND_DT IS NOT NULL
#elseif (${status_cd} == 'WC')
AND RST.INV_NO IS NULL
AND RST.MNR_ORD_SND_DT IS NULL
AND RST.ORD_INPUT_DT IS NOT NULL
#elseif (${status_cd} == 'HS' || ${status_cd} == 'HR' || ${status_cd} == 'HJ' || ${status_cd} == 'HC' || ${status_cd} == 'HA' || ${status_cd} == 'SS' || ${status_cd} == 'SR')
AND RST.INV_NO IS NULL
AND RST.MNR_ORD_SND_DT IS NULL
AND RST.ORD_INPUT_DT IS NULL
AND RST.MNR_ORD_OFC_CTY_CD IS NULL
#end
ORDER BY TMP_SEQ			]]></sql>
			<params>
				<param name="cur_ofc_cd" type="12" value="" out="N"/>
				<param name="cost_ofc_cd" type="12" value="" out="N"/>
				<param name="fm_est_dt" type="12" value="" out="N"/>
				<param name="to_est_dt" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
				<param name="eq_knd_cd" type="12" value="" out="N"/>
				<param name="cost_cd" type="12" value="" out="N"/>
				<param name="wo_type" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
