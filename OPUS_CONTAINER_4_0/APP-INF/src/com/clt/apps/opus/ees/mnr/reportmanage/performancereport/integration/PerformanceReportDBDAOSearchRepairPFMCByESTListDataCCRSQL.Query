<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PerformanceReportDBDAOSearchRepairPFMCByESTListDataCCRSQL">
			<desc><![CDATA[SearchRepairPFMCByESTListDataCC]]></desc>
			<sql><![CDATA[
SELECT 
	MAX(MNR_COMMON_PKG.MNR_GET_RHQ_OFC_FNC(RH.COST_OFC_CD)) RHQ,
	(SELECT MGC.MNR_CD_DESC FROM MNR_GEN_CD MGC WHERE MGC.PRNT_CD_ID = 'CD00019' AND MGC.MNR_CD_ID = RH.MNR_INP_TP_CD AND ROWNUM = 1) AS MNR_INP_TP_CD_NM,
	MAX(OD.ACCT_CD) ACCT_CD,
	RH.COST_OFC_CD OFC_CD,
	VD.VNDR_SEQ SP_CD,
	VD.VNDR_LGL_ENG_NM SP_NM,
	RH.EQ_TPSZ_CD TPSZ,
	SUM(DECODE(RH.RPR_STS_CD,'HJ',1,0)) HJ_CNT,
	SUM(DECODE(RH.RPR_STS_CD,'HJ',MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(RH.CRE_DT, 'YYYYMM'), RH.CURR_CD, DECODE(@[curr_cd], 'Y', 'USD', RH.CURR_CD), RD.MNR_WRK_AMT),0)) HJ_AMT,
	SUM(DECODE(RH.RPR_STS_CD,'HO',1,0)) HO_CNT,
	SUM(DECODE(RH.RPR_STS_CD,'HO',MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(RH.CRE_DT, 'YYYYMM'), RH.CURR_CD, DECODE(@[curr_cd], 'Y', 'USD', RH.CURR_CD), RD.MNR_WRK_AMT),0)) HO_AMT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'NS',1,0)) NS_CNT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'NS',MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(RH.CRE_DT, 'YYYYMM'), RH.CURR_CD, DECODE(@[curr_cd], 'Y', 'USD', RH.CURR_CD), RD.MNR_WRK_AMT),0)) NS_AMT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'NT',1,0)) NT_CNT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'NT',MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(RH.CRE_DT, 'YYYYMM'), RH.CURR_CD, DECODE(@[curr_cd], 'Y', 'USD', RH.CURR_CD), RD.MNR_WRK_AMT),0)) NT_AMT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'UH',1,0)) UH_CNT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'UH',MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(RH.CRE_DT, 'YYYYMM'), RH.CURR_CD, DECODE(@[curr_cd], 'Y', 'USD', RH.CURR_CD), RD.MNR_WRK_AMT),0)) UH_AMT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'UR',1,0)) UR_CNT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'UR',MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(RH.CRE_DT, 'YYYYMM'), RH.CURR_CD, DECODE(@[curr_cd], 'Y', 'USD', RH.CURR_CD), RD.MNR_WRK_AMT),0)) UR_AMT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'UM',1,0)) UM_CNT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'UM',MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(RH.CRE_DT, 'YYYYMM'), RH.CURR_CD, DECODE(@[curr_cd], 'Y', 'USD', RH.CURR_CD), RD.MNR_WRK_AMT),0)) UM_AMT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'SL',1,0)) SL_CNT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'SL',MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(RH.CRE_DT, 'YYYYMM'), RH.CURR_CD, DECODE(@[curr_cd], 'Y', 'USD', RH.CURR_CD), RD.MNR_WRK_AMT),0)) SL_AMT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'OF',1,0)) OF_CNT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'OF',MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(RH.CRE_DT, 'YYYYMM'), RH.CURR_CD, DECODE(@[curr_cd], 'Y', 'USD', RH.CURR_CD), RD.MNR_WRK_AMT),0)) OF_AMT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'RE',1,0)) RE_CNT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'RE',MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(RH.CRE_DT, 'YYYYMM'), RH.CURR_CD, DECODE(@[curr_cd], 'Y', 'USD', RH.CURR_CD), RD.MNR_WRK_AMT),0)) RE_AMT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'DE',1,0)) DE_CNT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'DE',MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(RH.CRE_DT, 'YYYYMM'), RH.CURR_CD, DECODE(@[curr_cd], 'Y', 'USD', RH.CURR_CD), RD.MNR_WRK_AMT),0)) DE_AMT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'LE',1,0)) LE_CNT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'LE',MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(RH.CRE_DT, 'YYYYMM'), RH.CURR_CD, DECODE(@[curr_cd], 'Y', 'USD', RH.CURR_CD), RD.MNR_WRK_AMT),0)) LE_AMT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'NA',1,0)) NA_CNT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'NA',MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(RH.CRE_DT, 'YYYYMM'), RH.CURR_CD, DECODE(@[curr_cd], 'Y', 'USD', RH.CURR_CD), RD.MNR_WRK_AMT),0)) NA_AMT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'SS',1,0)) SS_CNT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'SS',MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(RH.CRE_DT, 'YYYYMM'), RH.CURR_CD, DECODE(@[curr_cd], 'Y', 'USD', RH.CURR_CD), RD.MNR_WRK_AMT),0)) SS_AMT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'VT',1,0)) VT_CNT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'VT',MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(RH.CRE_DT, 'YYYYMM'), RH.CURR_CD, DECODE(@[curr_cd], 'Y', 'USD', RH.CURR_CD), RD.MNR_WRK_AMT),0)) VT_AMT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'CE',1,0)) CE_CNT,
	SUM(DECODE(RD.MNR_VRFY_TP_CD,'CE',MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(RH.CRE_DT, 'YYYYMM'), RH.CURR_CD, DECODE(@[curr_cd], 'Y', 'USD', RH.CURR_CD), RD.MNR_WRK_AMT),0)) CE_AMT,
	DECODE(@[curr_cd], 'Y', 'USD', MAX(RH.CURR_CD)) CURR,
	COUNT (DISTINCT (RH.RQST_EQ_NO || RH.RPR_RQST_SEQ || RH.RPR_RQST_VER_NO)) EST_QTY,
	COUNT(*) DTL_CNT,
	SUM(MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(RH.CRE_DT, 'YYYYMM'), RH.CURR_CD, DECODE(@[curr_cd], 'Y', 'USD', RH.CURR_CD), RD.MNR_WRK_AMT)) T_AMT,
	ROUND((SUM(MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(RH.CRE_DT, 'YYYYMM'), RH.CURR_CD, DECODE(@[curr_cd], 'Y', 'USD', RH.CURR_CD), RD.MNR_WRK_AMT)) / COUNT(*)),2) T_AVG,
#if (${report_period_type} == 'EI') 
	TO_CHAR(RH.RQST_DT,'YYYY-MM') AS MONTH
FROM MNR_RPR_RQST_HDR RH, MNR_RPR_RQST_DTL RD, MDM_VENDOR VD,MNR_ORD_DTL OD
WHERE RH.RPR_RQST_LST_VER_FLG = 'Y'
   AND   RH.RQST_EQ_NO      = RD.RQST_EQ_NO
   AND   RH.RPR_RQST_SEQ    = RD.RPR_RQST_SEQ
   AND   RH.RPR_RQST_VER_NO = RD.RPR_RQST_VER_NO
   AND   RH.RPR_RQST_LST_VER_FLG = RD.RPR_RQST_LST_VER_FLG
   AND   RH.VNDR_SEQ = VD.VNDR_SEQ(+)
   AND   RH.MNR_ORD_OFC_CTY_CD = OD.MNR_ORD_OFC_CTY_CD(+)
   AND   RH.MNR_ORD_SEQ        = OD.MNR_ORD_SEQ(+)	
   AND   RH.RQST_DT BETWEEN GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[user_ofc_cd], TO_DATE(@[fm_dt], 'YYYY-MM-DD'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC()) AND GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[user_ofc_cd], TO_DATE(@[to_dt], 'YYYY-MM-DD'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC())+ 0.99999
#end
#if (${report_period_type} == 'WI') 
	TO_CHAR(OH.CRE_DT,'YYYY-MM') AS MONTH
FROM MNR_RPR_RQST_HDR RH, MNR_RPR_RQST_DTL RD, MNR_ORD_HDR OH, MDM_VENDOR VD, MNR_ORD_DTL OD
WHERE RH.RPR_RQST_LST_VER_FLG = 'Y'
   AND   RH.RQST_EQ_NO      = RD.RQST_EQ_NO
   AND   RH.RPR_RQST_SEQ    = RD.RPR_RQST_SEQ
   AND   RH.RPR_RQST_VER_NO = RD.RPR_RQST_VER_NO
   AND   RH.RPR_RQST_LST_VER_FLG = RD.RPR_RQST_LST_VER_FLG
   AND   RH.MNR_ORD_OFC_CTY_CD = OH.MNR_ORD_OFC_CTY_CD
   AND   RH.MNR_ORD_SEQ        = OH.MNR_ORD_SEQ
   AND   OD.MNR_ORD_OFC_CTY_CD = OH.MNR_ORD_OFC_CTY_CD
   AND   OD.MNR_ORD_SEQ        = OH.MNR_ORD_SEQ	
   AND   RH.VNDR_SEQ = VD.VNDR_SEQ(+)
   AND   OH.CRE_DT BETWEEN GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[user_ofc_cd], TO_DATE(@[fm_dt], 'YYYY-MM-DD'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC()) AND GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[user_ofc_cd], TO_DATE(@[to_dt], 'YYYY-MM-DD'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC())+ 0.99999
#end
#if (${report_period_type} == 'II') 
   TO_CHAR(IW.ISS_DT,'YYYY-MM') AS MONTH	
FROM MNR_RPR_RQST_HDR RH, MNR_RPR_RQST_DTL RD, MNR_ORD_DTL OD, MNR_PAY_INV_WRK IW, MDM_VENDOR VD
WHERE RH.RPR_RQST_LST_VER_FLG = 'Y'
   AND   RH.RQST_EQ_NO      = RD.RQST_EQ_NO
   AND   RH.RPR_RQST_SEQ    = RD.RPR_RQST_SEQ
   AND   RH.RPR_RQST_VER_NO = RD.RPR_RQST_VER_NO
   AND   RH.RPR_RQST_LST_VER_FLG = RD.RPR_RQST_LST_VER_FLG
   AND   RD.RQST_EQ_NO = OD.EQ_NO
   AND   RH.MNR_ORD_OFC_CTY_CD = OD.MNR_ORD_OFC_CTY_CD
   AND   RH.MNR_ORD_SEQ        = OD.MNR_ORD_SEQ
   AND   OD.PAY_INV_SEQ        = IW.PAY_INV_SEQ
   AND   RH.VNDR_SEQ = VD.VNDR_SEQ(+)
   AND   IW.ISS_DT BETWEEN  TO_DATE(@[fm_dt], 'YYYY-MM-DD') AND TO_DATE(@[to_dt], 'YYYY-MM-DD') + 0.99999 
#end
#if (${eq_type} != 'A') 
AND RH.EQ_KND_CD  = @[eq_type]
#end
#if (${tp_sz_cd} != '') 
	AND	RH.EQ_TPSZ_CD IN (
		#foreach ($user_tpszCds IN ${tpszCds})
			#if($velocityCount < $tpszCds.size())
				'$user_tpszCds',
			#else
				'$user_tpszCds'
			#end	
		#end			  
	)
#end
#if (${rhq} != 'A') 
AND MNR_COMMON_PKG.MNR_GET_RHQ_OFC_FNC(RH.COST_OFC_CD)  = @[rhq]
#end
#if (${ofc_cd} != 'A') 
AND RH.COST_OFC_CD = @[ofc_cd]
#end
#if (${vndr_seq} != '') 
AND RH.VNDR_SEQ   = TO_NUMBER(@[vndr_seq])
#end
#if (${rpr_sts_cd} != 'A' && ${rpr_sts_cd} != '') 
AND RH.RPR_STS_CD = @[rpr_sts_cd]
#end
GROUP BY
RH.COST_OFC_CD,
RH.MNR_INP_TP_CD,
VD.VNDR_SEQ,
VD.VNDR_LGL_ENG_NM,
RH.EQ_TPSZ_CD
#if (${curr_cd} != 'Y')
,RH.CURR_CD
#end
#if (${report_period_type} == 'EI') 
,TO_CHAR(RH.RQST_DT,'YYYY-MM')
#end
#if (${report_period_type} == 'WI') 
,TO_CHAR(OH.CRE_DT,'YYYY-MM')
#end
#if (${report_period_type} == 'II') 
,TO_CHAR(IW.ISS_DT,'YYYY-MM')
#end
ORDER BY 
#if (${report_period_type} == 'EI') 
TO_CHAR(RH.RQST_DT,'YYYY-MM'),
#end
#if (${report_period_type} == 'WI') 
TO_CHAR(OH.CRE_DT,'YYYY-MM'),
#end
#if (${report_period_type} == 'II') 
TO_CHAR(IW.ISS_DT,'YYYY-MM'),
#end
RH.COST_OFC_CD,VD.VNDR_SEQ,RH.EQ_TPSZ_CD			]]></sql>
			<params>
				<param name="curr_cd" type="12" value="" out="N"/>
				<param name="user_ofc_cd" type="12" value="" out="N"/>
				<param name="fm_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="eq_type" type="12" value="" out="N"/>
				<param name="rhq" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
				<param name="rpr_sts_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
