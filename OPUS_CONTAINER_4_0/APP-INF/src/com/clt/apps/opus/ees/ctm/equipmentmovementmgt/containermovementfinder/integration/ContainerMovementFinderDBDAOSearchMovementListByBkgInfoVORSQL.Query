<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContainerMovementFinderDBDAOSearchMovementListByBkgInfoVORSQL">
			<desc><![CDATA[EES_CTM_0409
-- Booking Infomation (HTML INPUT)]]></desc>
			<sql><![CDATA[
SELECT BB.BKG_NO,
       BB.BL_NO,
       NVL (BB.BKG_STS_CD, '') AS BKG_STS_CD,
       NVL (BB.BKG_CGO_TP_CD, '') AS BKG_CGO_TP_CD,
       NVL (BB.DEL_CD, '') AS DEL_CD,
       NVL (BB.DE_TERM_CD, '') AS DE_TERM_CD,
       NVL (BB.POD_CD, '') AS POD_CD,
       NVL (BB.POL_CD, '') AS BKG_POL_CD,
       NVL (BB.POR_CD, '') AS POR_CD,
       NVL (BB.RCV_TERM_CD, '') AS RCV_TERM_CD,
       NVL (DECODE (FM_BKG_NO, NULL, SPLIT_RSN_CD, FM_BKG_NO), '') AS SPLIT_CD,
       NVL (BB_S2.SPLIT_COUNT, '') AS SPLIT_COUNT,
       NVL (BB_S3.BKG_NO, '') AS SPLIT_BKG_NO,
       NVL (BB_S3.BKG_NO_SPLIT, '') AS SPLIT_BKG_NO_SPLIT,
       BC.SHPR,
       BC.CNEE,
       BC.NTFY,
       BV.PRE_POL_CD,
       BV.T_VVD,
       BV.POL_CD AS T_POL_CD,
       BV.POST_POL_CD,
       MC.CMDT_NM AS REP_CMDT_NM,
      (SELECT V.REF_ID
        FROM EQR_PLAN_V V
        WHERE V.TP_CD IN ('T.VVD EXE','TRW EXE','ONH EXE','OFH EXE','LCC')
        AND V.MTY_BKG_NO = @[bkg_no]) AS MTY_PLN_NO
  FROM BKG_BOOKING BB,
       MDM_COMMODITY MC,
       (SELECT   BKG_NO,
                 CASE
                    WHEN COUNT (BKG_NO) > 1
                       THEN COUNT (BKG_NO)
                    ELSE 0
                 END AS SPLIT_COUNT
            FROM BKG_BOOKING
           WHERE BKG_NO = @[bkg_no]
        GROUP BY BKG_NO) BB_S2,
         (SELECT BKG_NO,
                 BKG_NO_SPLIT
            FROM (SELECT BKG_NO,
                         SUBSTR(BKG_NO, 12, 2) AS BKG_NO_SPLIT
                    FROM BKG_BOOKING
                   WHERE BKG_NO = @[bkg_no]
                   ORDER BY SUBSTR(BKG_NO, 12, 2) )
           WHERE ROWNUM = 1) BB_S3,
       (SELECT BKG_NO,
               PRE_POL_CD,
               T_VVD,
               POL_CD,
               POST_POL_CD
          FROM DUAL,
               (SELECT BKG_NO,
                       LAG (POL_CD, 1) OVER (PARTITION BY BKG_NO ORDER BY VSL_PRE_PST_CD) AS PRE_POL_CD,
                       LEAD (POL_CD, 1) OVER (PARTITION BY BKG_NO ORDER BY VSL_PRE_PST_CD) AS POST_POL_CD,
                       VSL_PRE_PST_CD,
                       VSL_CD||SKD_VOY_NO||SKD_DIR_CD AS T_VVD,
                       POL_CD
                  FROM BKG_VVD
                 WHERE BKG_NO = @[bkg_no])
         WHERE VSL_PRE_PST_CD = 'T') BV,
       (SELECT BKG_NO,
               MAX (DECODE (BKG_CUST_TP_CD, 'S', REPLACE (REPLACE (REPLACE (REPLACE (REPLACE (CUST_NM, CHR(92)||'r'||CHR(92)||'n', ' '), CHR(13)||CHR(10), ' '), CHR(34), ' '), CHR(9), ' '),  CHR(13),  ' '), '')) AS SHPR,
               MAX (DECODE (BKG_CUST_TP_CD, 'C', REPLACE (REPLACE (REPLACE (REPLACE (REPLACE (CUST_NM, CHR(92)||'r'||CHR(92)||'n', ' '), CHR(13)||CHR(10), ' '), CHR(34), ' '), CHR(9), ' '),  CHR(13),  ' '), '')) AS CNEE,
               MAX (DECODE (BKG_CUST_TP_CD, 'N', REPLACE (REPLACE (REPLACE (REPLACE (REPLACE (CUST_NM, CHR(92)||'r'||CHR(92)||'n', ' '), CHR(13)||CHR(10), ' '), CHR(34), ' '), CHR(9), ' '),  CHR(13),  ' '), '')) AS NTFY
          FROM BKG_CUSTOMER
         WHERE BKG_CUST_TP_CD IN ('S', 'C', 'N')
           AND BKG_NO = @[bkg_no]
      GROUP BY BKG_NO) BC
 WHERE BB.BKG_NO = @[bkg_no]
   AND BB.CMDT_CD = MC.CMDT_CD
   AND BV.BKG_NO = BB.BKG_NO
   AND BC.BKG_NO = BV.BKG_NO			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
