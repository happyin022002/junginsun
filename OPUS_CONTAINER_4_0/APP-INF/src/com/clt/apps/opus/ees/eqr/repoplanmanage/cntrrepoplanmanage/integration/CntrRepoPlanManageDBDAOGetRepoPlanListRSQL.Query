<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CntrRepoPlanManageDBDAOGetRepoPlanListRSQL">
			<desc><![CDATA[<EES_EQR_0045 컨테이너 이송 계획 목록 조회>
Repo Plan Id 정보 조회

<Change History>
1	2009.08.17	Lee ByoungHun	최초작성
2.	2014.10.15	Un Joeng                NYK GAP Develope Work
3.     2015.02.04     Un Joeng                NYK Assembly 관련 수정작업]]></desc>
			<sql><![CDATA[
SELECT    WEEK
        , REPO_PLN_ID
        , REPO_PLN_RMK
        , USR_ID
		, USR_ID AS USRID
        , UPD_DT
        , CRE_DT
        #if (${cbx_ep_tp_cd} == 'Y')
        , EP_TP_CD
        , DAT_TP_CD
        #end
	 	#if (${cbx_rcc_cd} == 'Y')
	 	, FM_RCC_CD
		, TO_RCC_CD
	 	#end
	 	#if (${cbx_lcc_cd} == 'Y')
	 	, FM_LCC_CD
		, TO_LCC_CD
	 	#end
	 	#if (${cbx_ecc_cd} == 'Y')
	 	, FM_ECC_CD
		, TO_ECC_CD
	 	#end
	 	#if (${cbx_loc_cd} == 'Y')
	 	, FM_LOC_CD
		, TO_LOC_CD
	 	#end
	 	#if (${cbx_yard_cd} == 'Y')
	 	, FM_YARD_CD
		, TO_YARD_CD
	 	#end
	 	#if (${cbx_vvd_cd} == 'Y')
	 	, VVD
	 	#end
	 	#if (${cbx_emt_bkg_no} == 'Y')
	 	, BKG_NO
	 	#end
	 	#if (${cbx_ref_id} == 'Y')
	 	, REF_ID
	 	#end
	 	#if (${cbx_so_no} == 'Y')
	 	, SO_NO
	 	#end
        , REPO_PLN_DTRB_FLG
        , AUTO
        , MANUAL
        , SCNR_ID
  FROM (
          SELECT  DISTINCT SUBSTR(ERP.REPO_PLN_ID,5,4)||'-'||SUBSTR(ERP.REPO_PLN_ID,9,2) WEEK
                , ERP.REPO_PLN_ID
                , ERPN.NO
                , DECODE(ERPN.EP_TP_CD, NULL, 'BlankData', ERPN.EP_TP_CD)   AS EP_TP_CD
                , DECODE(ERPN.DAT_TP_CD, NULL, 'BlankData', ERPN.DAT_TP_CD) AS DAT_TP_CD
                , ERP.REPO_PLN_RMK REPO_PLN_RMK
                , ERP.UPD_USR_ID USR_ID
                , TO_CHAR(ERP.UPD_DT,'yyyy-mm-dd')||' '||TO_CHAR(ERP.UPD_DT,'HH24:MI') UPD_DT
                , TO_CHAR(ERP.CRE_DT,'yyyy-mm-dd')||' '||TO_CHAR(ERP.CRE_DT,'HH24:MI') CRE_DT  
                , MST_LOC_FNC(NVL (SUBSTR (ERPN.FM_YD_CD, 1, 5), ERPN.FM_LOC_CD), 'RCC') AS FM_RCC_CD
                , MST_LOC_FNC(NVL (SUBSTR (ERPN.FM_YD_CD, 1, 5), ERPN.FM_LOC_CD), 'LCC') AS FM_LCC_CD  
                , MST_LOC_FNC(NVL (SUBSTR (ERPN.FM_YD_CD, 1, 5), ERPN.FM_LOC_CD), 'ECC') AS FM_ECC_CD 
                , NVL(SUBSTR(ERPN.FM_YD_CD, 1, 5), ERPN.FM_LOC_CD) AS FM_LOC_CD
                , ERPN.FM_YD_CD AS FM_YARD_CD
                , MST_LOC_FNC(NVL (SUBSTR (ERPN.TO_YD_CD, 1, 5), ERPN.TO_LOC_CD), 'RCC') AS TO_RCC_CD 
                , MST_LOC_FNC(NVL (SUBSTR (ERPN.TO_YD_CD, 1, 5), ERPN.TO_LOC_CD), 'LCC') AS TO_LCC_CD
                , MST_LOC_FNC(NVL (SUBSTR (ERPN.TO_YD_CD, 1, 5), ERPN.TO_LOC_CD), 'ECC') AS TO_ECC_CD  
                , NVL(SUBSTR(ERPN.TO_YD_CD, 1, 5), ERPN.TO_LOC_CD) AS TO_LOC_CD
                , ERPN.TO_YD_CD AS TO_YARD_CD
                , ERPN.VVD AS VVD
                , ERPN.BKG_NO AS BKG_NO
                , ERPN.REF_ID AS REF_ID
                , ESON.SO_NO AS SO_NO
                , DECODE (ERP.REPO_PLN_DTRB_FLG, 'Y', 0, 1) REPO_PLN_DTRB_FLG
                , DECODE (ERP.REPO_PLN_AUTO_GEN_FLG, 'Y', 0, 1) AUTO
                , DECODE (ERP.REPO_PLN_AUTO_GEN_FLG, 'N', 0, 1) MANUAL
                , ERP.SCNR_ID AS SCNR_ID
        FROM EQR_EQ_REPO_PLN ERP
             , (SELECT   'T.VVD PLN'       AS TYPE
                        , 'T.VVD' AS EP_TP_CD
                        , 'RepoPlan' AS DAT_TP_CD
                        , 1                AS NO
                        , VPLN.REPO_PLN_ID AS REPO_PLN_ID
                        , VPLN.PLN_YRWK    AS PLN_YRWK
                        , VPLN.PLN_SEQ     AS PLN_SEQ
                        , VPLN.VSL_LANE_CD AS VSL_LANE_CD
                        , VPLN.VSL_CD||VPLN.SKD_VOY_NO||VPLN.SKD_DIR_CD AS VVD
                        , VPLN.FM_ECC_CD   AS FM_LOC_CD
                        , VPLN.FM_YD_CD    AS FM_YD_CD
                        , VPLN.TO_ECC_CD   AS TO_LOC_CD
                        , VPLN.TO_YD_CD    AS TO_YD_CD
                        , ''               AS REF_ID
                        , ''               AS BKG_NO
                FROM EQR_VSL_LDIS_PLN_COD_TMP VPLN
                WHERE 1=1
                AND VPLN.PLN_YRWK BETWEEN @[repoSYearWeek] AND @[repoEYearWeek]
                UNION ALL
                SELECT   'T.VVD EXE'       AS TYPE
                        , 'T.VVD' AS EP_TP_CD
                        , 'ExecPlan' AS DAT_TP_CD
                        , 2                AS NO                
                        , VEXE.REPO_PLN_ID AS REPO_PLN_ID
                        , VEXE.PLN_YRWK    AS PLN_YRWK
                        , VEXE.PLN_SEQ     AS PLN_SEQ
                        , VEXE.VSL_LANE_CD AS VSL_LANE_CD
                        , VEXE.VSL_CD||VEXE.SKD_VOY_NO||VEXE.SKD_DIR_CD AS VVD
                        , ''               AS FM_LOC_CD
                        , VEXE.FM_YD_CD    AS FM_YD_CD
                        , ''               AS TO_LOC_CD
                        , VEXE.TO_YD_CD    AS TO_YD_CD
                        , VEXE.REF_ID      AS REF_ID
                        , VEXE.MTY_BKG_NO  AS BKG_NO
                FROM EQR_VSL_LODG_DCHG_EXE_PLN VEXE
                WHERE 1=1
                AND VEXE.PLN_YRWK BETWEEN @[repoSYearWeek] AND @[repoEYearWeek]
                UNION ALL
                SELECT   'TRS PLN'         AS TYPE
                        , DECODE (TPLN.TRSP_MOD_CD,  'R', 'Rail',  'W', 'Water',  'Truck') AS EP_TP_CD
                        , 'PlanRecord'     AS DAT_TP_CD
                        , 3                AS NO                
                        , TPLN.REPO_PLN_ID AS REPO_PLN_ID
                        , TPLN.PLN_YRWK    AS PLN_YRWK
                        , TPLN.PLN_SEQ     AS PLN_SEQ
                        , ''               AS VSL_LANE_CD
                        , ''               AS VVD
                        , TPLN.FM_ECC_CD   AS FM_LOC_CD
                        , ''               AS FM_YD_CD
                        , TPLN.TO_ECC_CD   AS TO_LOC_CD
                        , ''               AS TO_YD_CD
                        , ''               AS REF_ID
                        , ''               AS BKG_NO
                FROM EQR_INLND_TRSP_PLN TPLN
                WHERE 1=1
                AND TPLN.PLN_YRWK BETWEEN @[repoSYearWeek] AND @[repoEYearWeek]
                UNION ALL
                SELECT   'TRS EXE'         AS TYPE
                        , DECODE (TEXE.TRSP_MOD_CD,  'R', 'Rail',  'W', 'Water',  'Truck') AS EP_TP_CD
                        , 'ExecRecord'     AS DAT_TP_CD
                        , 4                AS NO                
                        , TEXE.REPO_PLN_ID AS REPO_PLN_ID
                        , TEXE.PLN_YRWK    AS PLN_YRWK
                        , TEXE.PLN_SEQ     AS PLN_SEQ
                        , TEXE.VSL_LANE_CD AS VSL_LANE_CD
                        , TEXE.VSL_CD||TEXE.SKD_VOY_NO||TEXE.SKD_DIR_CD AS VVD
                        , ''               AS FM_LOC_CD
                        , TEXE.FM_YD_CD    AS FM_YD_CD
                        , ''               AS TO_LOC_CD
                        , TEXE.TO_YD_CD    AS TO_YD_CD
                        , TEXE.REF_ID      AS REF_ID
                        , TEXE.MTY_BKG_NO  AS BKG_NO
                FROM EQR_INLND_TRSP_EXE_PLN TEXE
                WHERE 1=1
                AND TEXE.PLN_YRWK BETWEEN @[repoSYearWeek] AND @[repoEYearWeek]
                UNION ALL
                SELECT   'ONF PLN'         AS TYPE
                        , DECODE (OPLN.ONF_HIR_DIV_CD, 'O', 'Onhire', 'Offhire') AS EP_TP_CD
                        , 'PlanRecord'     AS DAT_TP_CD
                        , 5                AS NO                
                        , OPLN.REPO_PLN_ID AS REPO_PLN_ID
                        , OPLN.PLN_YRWK    AS PLN_YRWK
                        , OPLN.PLN_SEQ     AS PLN_SEQ
                        , ''               AS VSL_LANE_CD
                        , ''               AS VVD
                        , OPLN.ECC_CD      AS FM_LOC_CD
                        , ''               AS FM_YD_CD
                        , OPLN.ECC_CD      AS TO_LOC_CD
                        , ''               AS TO_YD_CD
                        , ''               AS REF_ID
                        , ''               AS BKG_NO
                FROM EQR_ONF_HIR_PLN OPLN
                WHERE 1=1
                AND OPLN.PLN_YRWK BETWEEN @[repoSYearWeek] AND @[repoEYearWeek]
                UNION ALL
                SELECT   'ONF EXE'         AS TYPE
                        , DECODE (OEXE.ONF_HIR_DIV_CD, 'O', 'Onhire', 'Offhire') AS EP_TP_CD
                        , 'ExecRecord'     AS DAT_TP_CD
                        , 6                AS NO                
                        , OEXE.REPO_PLN_ID AS REPO_PLN_ID
                        , OEXE.PLN_YRWK    AS PLN_YRWK
                        , OEXE.PLN_SEQ     AS PLN_SEQ
                        , ''               AS VSL_LANE_CD
                        , ''               AS VVD
                        , ''               AS FM_LOC_CD
                        , OEXE.FM_YD_CD    AS FM_YD_CD
                        , ''               AS TO_LOC_CD
                        , OEXE.TO_YD_CD    AS TO_YD_CD
                        , OEXE.REF_ID      AS REF_ID
                        , ''               AS BKG_NO
                FROM EQR_ONF_HIR_EXE_PLN OEXE
                WHERE 1=1
                AND OEXE.PLN_YRWK BETWEEN @[repoSYearWeek] AND @[repoEYearWeek]
                UNION ALL
                SELECT   'LCC EXE'         AS TYPE
                        , 'LCCInternal'    AS EP_TP_CD
                        , 'ExecRecord'     AS DAT_TP_CD
                        , 7                AS NO               
                        , LEXE.REPO_PLN_ID AS REPO_PLN_ID
                        , LEXE.PLN_YRWK    AS PLN_YRWK
                        , 0                AS PLN_SEQ
                        , ''               AS VSL_LANE_CD
                        , ''               AS VVD
                        , ''               AS FM_LOC_CD
                        , LEXE.FM_YD_CD    AS FM_YD_CD
                        , ''               AS TO_LOC_CD
                        , LEXE.TO_YD_CD    AS TO_YD_CD
                        , LEXE.REF_ID      AS REF_ID
                        , ''               AS BKG_NO
                FROM EQR_ECC_INTER_EXE_PLN LEXE
                WHERE 1=1
                AND LEXE.PLN_YRWK BETWEEN @[repoSYearWeek] AND @[repoEYearWeek]) ERPN
         , (SELECT   TRK.REPO_PLN_ID AS REPO_PLN_ID
                   , TRK.REF_ID      AS REF_ID
                   , TRK.REF_SEQ     AS REF_SEQ
                   , TRK.TRSP_SO_OFC_CTY_CD||TRIM(TO_CHAR(TRK.TRSP_SO_SEQ)) AS SO_NO
            FROM TRS_TRSP_SVC_ORD TRK
            WHERE 1=1
            AND TRK.REF_ID > ' '
            AND TRK.PLN_YRWK BETWEEN @[repoSYearWeek] AND @[repoEYearWeek]
            UNION ALL
            SELECT   TRL.REPO_PLN_ID AS REPO_PLN_ID
                   , TRL.REF_ID      AS REF_ID
                   , TRL.REF_SEQ     AS REF_SEQ           
                   , TRL.TRSP_SO_OFC_CTY_CD||TRIM(TO_CHAR(TRL.TRSP_SO_SEQ)) AS SO_NO
            FROM TRS_TRSP_RAIL_BIL_ORD TRL
            WHERE 1=1
            AND TRL.REF_ID > ' '
            AND TRL.PLN_YRWK BETWEEN @[repoSYearWeek] AND @[repoEYearWeek]) ESON
        WHERE 1=1
        AND ERP.DELT_FLG = 'N'
        AND SUBSTR (ERP.REPO_PLN_ID, 5, 6) BETWEEN @[repoSYearWeek] AND @[repoEYearWeek]
        AND ERP.REPO_PLN_ID  = ERPN.REPO_PLN_ID(+)
        AND ERPN.REPO_PLN_ID = ESON.REPO_PLN_ID(+)        
        AND ERPN.REF_ID      = ESON.REF_ID(+)
        
	 #if (${repo_pln} != '' && ${repo_pln_seq} != '')
	   AND ERP.REPO_PLN_ID = @[repo_pln]||'W'||@[repo_pln_seq]
	 #elseif (${repo_pln} != '' && ${repo_pln_seq} == '')
	   AND ERP.REPO_PLN_ID LIKE @[repo_pln]||'%'
	 #end
	 
	 #if ($arrLane.size() > 0)
	    AND ERPN.VSL_LANE_CD IN(
	    #foreach ($key in ${arrLane})
		#if($velocityCount < $arrLane.size())
		'$key',
		#else
		'$key'
		#end
	    #end
	    )
	 #end
	 
	 #if (${vvd_cd} != '')
	   AND ERPN.VVD = @[vvd_cd]
	 #end
	 
	 #if (${emt_bkg_no} != '')
	   AND ERPN.BKG_NO = @[emt_bkg_no]
	 #end

	 #if (${ref_id} != '')
	   AND ERPN.REF_ID = @[ref_id]
	 #end

	 #if (${so_no} != '')
	   AND ESON.SO_NO = @[so_no]
	 #end
	 
	 #if (${usr_id} != '')
	   AND ERP.UPD_USR_ID = @[usr_id]
	 #end

	 #if ($arrFmRcc.size() > 0)
        AND MST_LOC_FNC(NVL (SUBSTR (ERPN.FM_YD_CD, 1, 5), ERPN.FM_LOC_CD), 'RCC') IN(
	                                                                                   #foreach ($key in ${arrFmRcc})
		                                                                                    #if($velocityCount < $arrFmRcc.size())
		                                                                                       '$key',
		                                                                                    #else
		                                                                                       '$key'
		                                                                                    #end
	                                                                                     #end
	                                                                                )
	 #end	 
	 #if ($arrFmLcc.size() > 0)
        AND MST_LOC_FNC(NVL (SUBSTR (ERPN.FM_YD_CD, 1, 5), ERPN.FM_LOC_CD), 'LCC') IN(
	                                                                                   #foreach ($key in ${arrFmLcc})
		                                                                                    #if($velocityCount < $arrFmLcc.size())
		                                                                                       '$key',
		                                                                                    #else
		                                                                                       '$key'
		                                                                                    #end
	                                                                                     #end
	                                                                                )
	 #end
	 
	 #if ($arrFmEcc.size() > 0)
        AND MST_LOC_FNC(NVL (SUBSTR (ERPN.FM_YD_CD, 1, 5), ERPN.FM_LOC_CD), 'ECC') IN(
	                                                                                   #foreach ($key in ${arrFmEcc})
		                                                                                    #if($velocityCount < $arrFmEcc.size())
		                                                                                       '$key',
		                                                                                    #else
		                                                                                       '$key'
		                                                                                    #end
	                                                                                     #end
	                                                                                )
	 #end
	 
	 #if ($arrFmLoc.size() > 0)
	    AND NVL(SUBSTR(ERPN.FM_YD_CD, 1, 5), ERPN.FM_LOC_CD) IN (
								    #foreach ($key in ${arrFmLoc})
									#if($velocityCount < $arrFmLoc.size())
									'$key',
									#else
									'$key'
									#end
								    #end
								    )
	 #end
	 
	 #if (${fm_yard_cd} != '')
	   AND ERPN.FM_YD_CD= @[fm_yard_cd]
	 #end
	 
	 #if ($arrToRcc.size() > 0)
        AND MST_LOC_FNC(NVL (SUBSTR (ERPN.TO_YD_CD, 1, 5), ERPN.TO_LOC_CD), 'RCC') IN(
	                                                                                   #foreach ($key in ${arrToRcc})
		                                                                                    #if($velocityCount < $arrToRcc.size())
		                                                                                       '$key',
		                                                                                    #else
		                                                                                       '$key'
		                                                                                    #end
	                                                                                     #end
	                                                                                )
	 #end
	 
	 #if ($arrToLcc.size() > 0)
        AND MST_LOC_FNC(NVL (SUBSTR (ERPN.TO_YD_CD, 1, 5), ERPN.TO_LOC_CD), 'LCC') IN(
	                                                                                   #foreach ($key in ${arrToLcc})
		                                                                                    #if($velocityCount < $arrToLcc.size())
		                                                                                       '$key',
		                                                                                    #else
		                                                                                       '$key'
		                                                                                    #end
	                                                                                     #end
	                                                                                )
	 #end
	 
	 #if ($arrToEcc.size() > 0)
        AND MST_LOC_FNC(NVL (SUBSTR (ERPN.TO_YD_CD, 1, 5), ERPN.TO_LOC_CD), 'ECC') IN(
	                                                                                   #foreach ($key in ${arrToEcc})
		                                                                                    #if($velocityCount < $arrToEcc.size())
		                                                                                       '$key',
		                                                                                    #else
		                                                                                       '$key'
		                                                                                    #end
	                                                                                     #end
	                                                                                )
	 #end
	 
	 #if ($arrToLoc.size() > 0)
	    AND NVL(SUBSTR(ERPN.TO_YD_CD, 1, 5), ERPN.TO_LOC_CD) IN(
								    #foreach ($key in ${arrToLoc})
									#if($velocityCount < $arrToLoc.size())
									'$key',
									#else
									'$key'
									#end
								    #end
								    )
	 #end

	 #if (${to_yard_cd} != '')
	   AND ERPN.TO_YD_CD= @[to_yard_cd]
	 #end

	   ORDER BY WEEK, REPO_PLN_ID, NO
        )
 WHERE 1=1
 GROUP BY  WEEK, REPO_PLN_ID, REPO_PLN_RMK, USR_ID, UPD_DT, CRE_DT	 	
         , REPO_PLN_DTRB_FLG, AUTO, MANUAL, SCNR_ID
         #if (${cbx_ep_tp_cd} == 'Y')
         , NO
         , EP_TP_CD
         , DAT_TP_CD
         #end
		 #if (${cbx_rcc_cd} == 'Y')
	 	 , FM_RCC_CD
		 , TO_RCC_CD
	 	 #end
	 	 #if (${cbx_lcc_cd} == 'Y')
	 	 , FM_LCC_CD
		 , TO_LCC_CD
	 	 #end
	 	 #if (${cbx_ecc_cd} == 'Y')
	 	 , FM_ECC_CD
		 , TO_ECC_CD
	 	 #end
	 	 #if (${cbx_loc_cd} == 'Y')
	 	 , FM_LOC_CD
		 , TO_LOC_CD
	 	 #end
	 	 #if (${cbx_yard_cd} == 'Y')
         , NO
	 	 , FM_YARD_CD
		 , TO_YARD_CD
	 	 #end
	 	 #if (${cbx_vvd_cd} == 'Y')
	 	 , VVD
	 	 #end
	 	 #if (${cbx_emt_bkg_no} == 'Y')
	 	 , BKG_NO
	 	 #end
	 	 #if (${cbx_ref_id} == 'Y')
	 	 , REF_ID
	 	 #end
	 	 #if (${cbx_so_no} == 'Y')
	 	 , SO_NO
	 	 #end
 ORDER BY WEEK, REPO_PLN_ID
         #if (${cbx_ep_tp_cd} == 'Y')
         , NO
         #end			]]></sql>
			<params>
				<param name="repoSYearWeek" type="12" value="" out="N"/>
				<param name="repoEYearWeek" type="12" value="" out="N"/>
				<param name="repo_pln" type="12" value="" out="N"/>
				<param name="repo_pln_seq" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="emt_bkg_no" type="12" value="" out="N"/>
				<param name="ref_id" type="12" value="" out="N"/>
				<param name="so_no" type="12" value="" out="N"/>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="fm_yard_cd" type="12" value="" out="N"/>
				<param name="to_yard_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
