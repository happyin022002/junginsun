<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InterfaceMgtDBDAOsearchTotalLossApPayInvDtlDataRSQL">
			<desc><![CDATA[Total Loss 에서 ApPayInvDtl 을 구한다.]]></desc>
			<sql><![CDATA[
SELECT  '' INV_RGST_NO,
		'' INV_RGST_SEQ,
		'' LGS_COST_CD,
		DECODE(PW.TTL_LSS_DIV_CD, 'BBCOST', '510892', '510891') ACCT_CD,
		NVL(TD.VSL_CD, 'CNTC') VSL_CD,
		NVL(TD.SKD_VOY_NO, TO_CHAR(TH.TTL_LSS_CFM_DT, 'YYMM')) SKD_VOY_NO,
		NVL(TD.SKD_DIR_CD, 'M') SKD_DIR_CD,
		NVL(TD.REV_DIR_CD, 'M') REV_DIR_CD,
		NVL(TD.SLAN_CD, 'CNT') SLAN_CD,
		'' ACT_VVD_CD,
		'' PORT_CD,
		'' YD_CD,
		TD.EQ_TPSZ_CD CNTR_TPSZ_CD,
		SUM(TD.TTL_LSS_BIL_AMT) INV_AMT,
		0 SO_20FT_QTY,
		0 SO_40FT_QTY,
		0 SO_TEU_QTY,
		0 SO_UT_QTY,
		'' SO_OFC_CTY_CD,
		0 SO_SEQ,
		'N' DELT_FLG,
		CASE WHEN AI.ACT_DT_NM = 'TOTAL LOSS DATE' THEN TO_CHAR(TH.TTL_LSS_DT, 'YYYYMMDD') ELSE '' END ACT_DT,
		CASE WHEN AI.ACT_PLC_NM = 'ISSUE TEAM' THEN PW.ISS_OFC_CD ELSE '' END ACT_PLC
FROM MNR_TTL_LSS_RQST_DTL TD, MNR_TTL_LSS_RQST_HDR TH, MNR_PAY_INV_WRK PW, SCO_AP_COST_ACT_INFO AI
WHERE TH.TTL_LSS_NO      = TD.TTL_LSS_NO
AND   TD.PAY_INV_SEQ     = PW.PAY_INV_SEQ
AND   PW.TTL_LSS_DIV_CD  = AI.ACT_COST_CD
AND   AI.SRC_MDL_CD      = 'MNR'
AND   PW.PAY_INV_SEQ = @[pay_inv_seq]
GROUP BY DECODE(PW.TTL_LSS_DIV_CD, 'BBCOST', '510892', '510891'), 
    TD.EQ_TPSZ_CD, TH.TTL_LSS_CFM_DT, TH.TTL_LSS_DT, PW.ISS_OFC_CD, AI.ACT_DT_NM, AI.ACT_PLC_NM,
    TD.VSL_CD, TD.SKD_VOY_NO, TD.SKD_DIR_CD, TD.REV_DIR_CD, TD.SLAN_CD			]]></sql>
			<params>
				<param name="pay_inv_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
