<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SpecialManifestDBDAOserachVslAtCommonRSQL">
			<desc><![CDATA[Lloyd, vessel name등 Vessel 정보를 조회해옴(Booking 쪽 data)]]></desc>
			<sql><![CDATA[
SELECT @[d_type] AS D_TYPE
      ,@[vvd_cd] AS VVD_CD
      ,@[port_cd] AS PORT_CD
      ,B.VSL_CD
      ,B.VSL_ENG_NM
	  ,B.VSL_RGST_CNT_CD AS VSL_CNT_CD
      ,B.LLOYD_NO
      ,B.CALL_SGN_NO
      ,NVL(TO_CHAR(A.VPS_ETA_DT, 'YYYYMMDD'), '')   AS ETA_D  --Arrival DATE
      ,NVL(TO_CHAR(A.VPS_ETA_DT, 'HH24MM'), '')     AS ETA_T  --Arrival TIME
      ,NVL(TO_CHAR(A.VPS_ETD_DT,'YYYYMMDD'),' ')    AS ETD_D  --Departure DATE
      ,NVL(TO_CHAR(A.VPS_ETD_DT,'HH24MM'),' ')      AS ETD_T  --Departure TIME
      ,A.YD_CD AS BRTH_YD_CD                                  --Berth
      ,(SELECT YD_NM AS YD_NAME
          FROM MDM_YARD
         WHERE YD_CD = A.YD_CD
       ) YD_NM
      ,CASE WHEN SUBSTR(@[ofc_cd], 1, 3) = 'ANR'
            THEN (SELECT SVC_RQST_NO
                    FROM BKG_CSTMS_ANR_VVD
                   WHERE VSL_CD      = SUBSTR(@[vvd_cd], 1, 4)
                     AND SKD_VOY_NO  = SUBSTR(@[vvd_cd], 5, 4)
                     AND SKD_DIR_CD  = SUBSTR(@[vvd_cd], 9, 1)
                 )
            WHEN SUBSTR(@[ofc_cd], 1, 3) = 'FXT'
            THEN (SELECT UQ_VSL_ID_NO
                    FROM BKG_VSL_DCHG_YD
                   WHERE VSL_CD              =  SUBSTR(@[vvd_cd], 1, 4)
                     AND SKD_VOY_NO          =  SUBSTR(@[vvd_cd], 5, 4)
                     AND SKD_DIR_CD          =  SUBSTR(@[vvd_cd], 9, 1)
                     AND PORT_CD             =  @[port_cd]
                     AND CLPT_IND_SEQ        =  '1'
                 )
            WHEN NVL(@[port_cd],'X') = 'FRFOS'
            THEN (SELECT UQ_VSL_ID_NO
                    FROM BKG_VSL_DCHG_YD
                   WHERE VSL_CD              =  SUBSTR(@[vvd_cd], 1, 4)
                     AND SKD_VOY_NO          =  SUBSTR(@[vvd_cd], 5, 4)
                     AND SKD_DIR_CD          =  SUBSTR(@[vvd_cd], 9, 1)
                     AND PORT_CD             =  @[port_cd]
                     AND CLPT_IND_SEQ        =  '1'
                 )
            WHEN NVL(@[port_cd],'X') = 'NLRTM'
            THEN (SELECT MAX(NVL(VSL_CALL_REF_NO,''))
                    FROM BKG_CSTMS_RTM_VSL
                   WHERE VSL_CD = SUBSTR(@[vvd_cd], 1, 4)
                     AND SKD_VOY_NO = SUBSTR(@[vvd_cd], 5, 4)
                     AND SKD_DIR_CD = SUBSTR(@[vvd_cd], 9, 1)
                     AND VSL_CALL_REF_NO LIKE 'NLRTM%'
                 )
            ELSE ''
        END SVC_RQST_NO
      ,'N' AS LOCAL_DB_YN
  FROM VSK_VSL_PORT_SKD A
      ,MDM_VSL_CNTR B
 WHERE A.VSL_CD        =  SUBSTR(@[vvd_cd], 1, 4)
   AND A.SKD_VOY_NO    =  SUBSTR(@[vvd_cd], 5, 4)
   AND A.SKD_DIR_CD    =  SUBSTR(@[vvd_cd], 9, 1)
   AND A.VPS_PORT_CD   =  @[port_cd]
   AND NVL(A.SKD_CNG_STS_CD, ' ')    <> 'S'
   AND A.VSL_CD        =  B.VSL_CD
   AND ROWNUM = 1			]]></sql>
			<params>
				<param name="d_type" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="port_cd" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
