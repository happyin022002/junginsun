<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SpecialReportDBDAOSpecialCargoManifestInfoRSQL">
			<desc><![CDATA[SpecialCargoManifestInfo]]></desc>
			<sql><![CDATA[
SELECT DISTINCT
       @[pol_cd] AS POL_CD,
       @[pod_cd] AS POD_CD,
       @[vsl_cd] AS VSL_CD,
       @[skd_voy_no] AS SKD_VOY_NO,
       @[skd_dir_cd] AS SKD_DIR_CD,
       @[pol_yd_cd] AS POL_YD_CD,
       @[pod_yd_cd] AS POD_YD_CD,
       REPLACE(TRANSLATE(NVL(SP.VSL_ENG_NM,' '),CHR(10),' '),CHR(34),' ') AS VESSEL_NAME,
       NVL((SELECT REPLACE(SUBSTR(NVL(CNT.CNT_NM,' '),1,20),CHR(34),' ') FROM MDM_COUNTRY CNT WHERE CNT.CNT_CD = SP.VSL_FLG),'') AS NATIONALITY,
       NVL((SELECT NVL((SELECT REPLACE(SUBSTR(NVL(CNT_NM,' '),1,20),CHR(34),' ') FROM MDM_COUNTRY WHERE CNT_CD = VSL.VSL_RGST_CNT_CD),'') FROM MDM_VSL_CNTR VSL WHERE VSL_CD = SP.VSL_CD),'') AS VSL_RGST_CNT_NM,
       NVL((SELECT LLOYD_NO FROM MDM_VSL_CNTR VSL WHERE VSL_CD = SP.VSL_CD),'') AS LLOYD_NO,
       NVL(SP.VSL_OFFCL_NO,' ') AS OFFICIAL_NO,
       NVL(SP.VSL_CALL_SIGN,' ') AS CALL_SIGN,
#if ('OUT' == ${io_bnd_cd} )
	(SELECT VSK.OB_CSSM_VOY_NO FROM VSK_VSL_PORT_SKD VSK
								    WHERE 1=1
									  AND SP.VSL_CD = VSK.VSL_CD
									  AND SP.SKD_VOY_NO = VSK.SKD_VOY_NO
									  AND SP.SKD_DIR_CD = VSK.SKD_DIR_CD
									  AND SP.VVD_POL = VSK.VPS_PORT_CD
--									  AND VVD.POL_CLPT_IND_SEQ = VSK.CLPT_IND_SEQ
									  AND ROWNUM =1 ) AS VOYAGE_NO, 
#else
        (SELECT VSK.IB_CSSM_VOY_NO FROM VSK_VSL_PORT_SKD VSK
								    WHERE 1=1
									  AND SP.VSL_CD = VSK.VSL_CD
									  AND SP.SKD_VOY_NO = VSK.SKD_VOY_NO
									  AND SP.SKD_DIR_CD = VSK.SKD_DIR_CD
									  AND SP.VVD_POD = VSK.VPS_PORT_CD
--									  AND VVD.POL_CLPT_IND_SEQ = VSK.CLPT_IND_SEQ
									  AND ROWNUM =1 ) AS VOYAGE_NO,
#end
      
       'FULL CONTAINER SHIP' AS KIND_OF_SHIP,
       NVL2(@[pol_cd],REPLACE(TRANSLATE(NVL(SP.POL_DESC, ' '),CHR(10), ' '), CHR(34), ' ')||'   '||
       (SELECT NVL(YD.YD_NM, ' ') FROM MDM_YARD YD WHERE SP.VVD_POL || SUBSTR(SP.POL_YD_CD,6,2) = YD.YD_CD),NULL) AS POL_NAME,
       NVL2(@[pod_cd],REPLACE(TRANSLATE(NVL(SP.POD_DESC, ' '),CHR(10), ' '), CHR(34), ' ')||'   '||
       (SELECT NVL(YD.YD_NM, ' ') FROM MDM_YARD YD WHERE SP.VVD_POD || SUBSTR(SP.POD_YD_CD,6,2) = YD.YD_CD),NULL) AS POD_NAME,
	   SP.DEL_CD AS DEL_NAME
FROM   BKG_SP_V SP
WHERE  SP.VSL_CD = @[vsl_cd]
AND    SP.SKD_VOY_NO = @[skd_voy_no]
AND    SP.SKD_DIR_CD = @[skd_dir_cd]
#if (''!=${pol_cd})
AND    SP.VVD_POL LIKE @[pol_cd]||'%'
AND    NVL(SUBSTR(SP.POL_YD_CD,6,2),' ') LIKE @[pol_yd_cd]||'%'
#end
#if (''!=${pod_cd})
AND    SP.VVD_POD LIKE @[pod_cd]||'%'
AND    NVL(SUBSTR(SP.POD_YD_CD,6,2),' ') LIKE @[pod_yd_cd]||'%'
#end

UNION
SELECT 
       @[pol_cd] AS POL_CD
       , @[pod_cd] AS POD_CD
       , @[vsl_cd] AS VSL_CD
       , @[skd_voy_no] AS SKD_VOY_NO
       , @[skd_dir_cd] AS SKD_DIR_CD
       , @[pol_yd_cd] AS POL_YD_CD
       , @[pod_yd_cd] AS POD_YD_CD
       , REPLACE(TRANSLATE(NVL(VSL.VSL_ENG_NM,' '),CHR(10),' '),CHR(34),' ') AS VESSEL_NAME
       , NVL((SELECT REPLACE(SUBSTR(NVL(CNT.CNT_NM,' '),1,20),CHR(34),' ') FROM MDM_COUNTRY CNT WHERE CNT.CNT_CD = VSL.VSL_RGST_CNT_CD),'') AS NATIONALITY
       , NVL((SELECT REPLACE(SUBSTR(NVL(CNT.CNT_NM,' '),1,20),CHR(34),' ') FROM MDM_COUNTRY CNT WHERE CNT.CNT_CD = VSL.VSL_RGST_CNT_CD),'') AS VSL_RGST_CNT_NM
       , VSL.LLOYD_NO
       , VSL.RGST_NO AS OFFICAL_NO
       , VSL.CALL_SGN_NO AS CALL_SIGN
#if ('OUT' == ${io_bnd_cd} )
	   , (SELECT VSK.OB_CSSM_VOY_NO FROM VSK_VSL_PORT_SKD VSK
								    WHERE 1=1
									  AND RQST.VSL_CD = VSK.VSL_CD
									  AND RQST.SKD_VOY_NO = VSK.SKD_VOY_NO
									  AND RQST.SKD_DIR_CD = VSK.SKD_DIR_CD
									  AND RQST.POL_CD = VSK.VPS_PORT_CD
--									  AND VVD.POL_CLPT_IND_SEQ = VSK.CLPT_IND_SEQ
									  AND ROWNUM =1 ) AS VOYAGE_NO
#else
       , (SELECT VSK.IB_CSSM_VOY_NO FROM VSK_VSL_PORT_SKD VSK
								    WHERE 1=1
									  AND RQST.VSL_CD = VSK.VSL_CD
									  AND RQST.SKD_VOY_NO = VSK.SKD_VOY_NO
									  AND RQST.SKD_DIR_CD = VSK.SKD_DIR_CD
									  AND RQST.POD_CD = VSK.VPS_PORT_CD
--									  AND VVD.POL_CLPT_IND_SEQ = VSK.CLPT_IND_SEQ
									  AND ROWNUM =1 ) AS VOYAGE_NO
#end
       ,'FULL CONTAINER SHIP' AS KIND_OF_SHIP
       ,'' AS POL_NAME
       ,'' AS POD_NAME
	   ,'' AS DEL_NAME
FROM   SCG_IMDG_UN_NO SCG,
       MDM_CNTR_TP_SZ TPSZ,
       MDM_PCK_TP PCK,
       SCG_PRNR_APRO_RQST RQST, 
       SCG_PRNR_APRO_RQST_CGO CGO, 
       MDM_LOCATION POL, 
       MDM_LOCATION POD,
       MDM_VSL_CNTR VSL
WHERE  1=1
AND    CGO.IMDG_UN_NO = SCG.IMDG_UN_NO(+)
AND    CGO.IMDG_UN_NO_SEQ = SCG.IMDG_UN_NO_SEQ(+)
AND    CGO.OUT_N2ND_IMDG_PCK_QTY = PCK.PCK_CD(+)
AND    CGO.CNTR_TPSZ_CD = TPSZ.CNTR_TPSZ_CD(+)
AND    RQST.VSL_CD = @[vsl_cd]
AND    RQST.SKD_VOY_NO = @[skd_voy_no]
AND    RQST.SKD_DIR_CD = @[skd_dir_cd]
#if (''!=${pol_cd})
AND    RQST.POL_CD LIKE @[pol_cd]||'%'
#end
#if (''!=${pod_cd})
AND    RQST.POD_CD LIKE @[pod_cd]||'%'
#end
AND    RQST.CRR_CD = CGO.CRR_CD
AND    RQST.BKG_REF_NO = CGO.BKG_REF_NO
AND    RQST.SPCL_CGO_RQST_SEQ = CGO.SPCL_CGO_RQST_SEQ
AND    RQST.POL_CD = POL.LOC_CD
AND    RQST.POD_CD = POD.LOC_CD
AND    RQST.VSL_CD = VSL.VSL_CD			]]></sql>
			<params>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="pol_yd_cd" type="12" value="" out="N"/>
				<param name="pod_yd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
