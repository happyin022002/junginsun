<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="KorCustomsTransmissionDBDAOsearchAmdTransmitDataListRSQL">
			<desc><![CDATA[Amendment Transmission to Korean Customs 정정 내용 출력 화면을 위한 조회]]></desc>
			<sql><![CDATA[
SELECT -- SEQ MSN_NO, /** MSN **/
         BL BL_NO,  /** 선하증권 **/
         B1, B2,
         P1,  /** 정정전 **/
         C1,  /** 정정후 **/
         P2, C2, P3, C3, P4, C4, RN,
         DT SEND_DT /** 전송날짜 **/
   FROM  (SELECT   KB.BL_NO BL, ' ' B1,' ' B2,BLC.PRE_CTNT1 P1, BLC.CRNT_CTNT1 C1,
                   BLC.PRE_CTNT2 P2, BLC.CRNT_CTNT2 C2, BLC.PRE_CTNT3 P3, BLC.CRNT_CTNT3 C3, BLC.PRE_CTNT4 P4, BLC.CRNT_CTNT4 C4, BLC.CORR_RSN RN, MAX(TO_CHAR(KRC.AMDT_SND_DT,'YYYYMMDD')) DT
            FROM    BKG_CSTMS_KR_BL_CORR BLC, BKG_CSTMS_KR_CORR KRC, BKG_CSTMS_KR_BL KB
            WHERE   BLC.SMT_AMD_NO  = KRC.SMT_AMD_NO
            AND   BLC.PORT_CD  = KRC.PORT_CD
            AND   KRC.BKG_NO  = @[bkg_no]
            AND   BLC.PORT_CD = @[port_cd]
            AND   KRC.BKG_NO           =   KB.BKG_NO
            AND   KRC.CSTMS_DECL_TP_CD =   KB.CSTMS_DECL_TP_CD
            AND   KRC.PORT_CD          =   KB.DMST_PORT_CD
            AND   KRC.CSTMS_BL_NO      =   KB.CSTMS_BL_NO
            GROUP BY KB.BL_NO , ' ' ,' ' ,BLC.PRE_CTNT1 , BLC.CRNT_CTNT1 ,
                       BLC.PRE_CTNT2 , BLC.CRNT_CTNT2 , BLC.PRE_CTNT3 , BLC.CRNT_CTNT3 , BLC.PRE_CTNT4 , BLC.CRNT_CTNT4 , BLC.CORR_RSN
            UNION ALL
            SELECT   KB.BL_NO , ' ',' ',BLC.PRE_CTNT2, BLC.CRNT_CTNT2,  ' ', ' ', ' ',  ' ',  ' ',  ' ', ' ', MAX(TO_CHAR(KRC.AMDT_SND_DT,'YYYYMMDD'))
            FROM    BKG_CSTMS_KR_BL_CORR BLC, BKG_CSTMS_KR_CORR KRC, BKG_CSTMS_KR_BL KB
            WHERE   BLC.SMT_AMD_NO  = KRC.SMT_AMD_NO
            AND   BLC.PORT_CD  = KRC.PORT_CD
            AND   KRC.BKG_NO = @[bkg_no]
            AND   BLC.PORT_CD = @[port_cd]
            AND   KRC.BKG_NO           =   KB.BKG_NO
            AND   KRC.CSTMS_DECL_TP_CD =   KB.CSTMS_DECL_TP_CD
            AND   KRC.PORT_CD          =   KB.DMST_PORT_CD
            AND   KRC.CSTMS_BL_NO      =   KB.CSTMS_BL_NO
            GROUP BY KB.BL_NO , ' ',' ',BLC.PRE_CTNT2, BLC.CRNT_CTNT2
            HAVING  NVL(BLC.PRE_CTNT2,BLC.CRNT_CTNT2) IS NOT NULL
            UNION ALL
            SELECT  KB.BL_NO , ' ',' ',BLC.PRE_CTNT3, BLC.CRNT_CTNT3,  ' ', ' ', ' ',  ' ',  ' ',  ' ', ' ', MAX(TO_CHAR(KRC.AMDT_SND_DT,'YYYYMMDD'))
            FROM    BKG_CSTMS_KR_BL_CORR BLC, BKG_CSTMS_KR_CORR KRC, BKG_CSTMS_KR_BL KB
            WHERE   BLC.SMT_AMD_NO  = KRC.SMT_AMD_NO
            AND   BLC.PORT_CD  = KRC.PORT_CD
            AND   KRC.BKG_NO  = @[bkg_no]
            AND   BLC.PORT_CD = @[port_cd]
            AND   KRC.BKG_NO           =   KB.BKG_NO
            AND   KRC.CSTMS_DECL_TP_CD =   KB.CSTMS_DECL_TP_CD
            AND   KRC.PORT_CD          =   KB.DMST_PORT_CD
            AND   KRC.CSTMS_BL_NO      =   KB.CSTMS_BL_NO
            GROUP BY KB.MST_BL_SEQ_NO,  KB.BL_NO , ' ',' ',BLC.PRE_CTNT3, BLC.CRNT_CTNT3
            HAVING  NVL(BLC.PRE_CTNT3,BLC.CRNT_CTNT3) IS NOT NULL
            UNION ALL
            SELECT  KB.BL_NO , ' ',' ',BLC.PRE_CTNT4, BLC.CRNT_CTNT4,  ' ', ' ', ' ',  ' ',  ' ',  ' ', ' ', MAX(TO_CHAR(KRC.AMDT_SND_DT,'YYYYMMDD'))
            FROM    BKG_CSTMS_KR_BL_CORR BLC, BKG_CSTMS_KR_CORR KRC, BKG_CSTMS_KR_BL KB
            WHERE   BLC.SMT_AMD_NO  = KRC.SMT_AMD_NO
            AND   BLC.PORT_CD  = KRC.PORT_CD
            AND   KRC.BKG_NO  = @[bkg_no]
            AND   BLC.PORT_CD = @[port_cd]
            AND   KRC.BKG_NO           =   KB.BKG_NO
            AND   KRC.CSTMS_DECL_TP_CD =   KB.CSTMS_DECL_TP_CD
            AND   KRC.PORT_CD          =   KB.DMST_PORT_CD
            AND   KRC.CSTMS_BL_NO      =   KB.CSTMS_BL_NO
            GROUP BY KB.BL_NO , ' ',' ',BLC.PRE_CTNT4, BLC.CRNT_CTNT4
            HAVING  NVL(BLC.PRE_CTNT4,BLC.CRNT_CTNT4) IS NOT NULL
            UNION ALL
            SELECT  KB.BL_NO , ' ',' ', DECODE(KRC.KR_CSTMS_CORR_ID,'D','-','F','B/L삭제')
                    ,DECODE(KRC.KR_CSTMS_CORR_ID,'D','B/L추가','F','-'), ' ', ' ', ' ',  ' ',  ' ',  ' ',  ' ', MAX(TO_CHAR(KRC.AMDT_SND_DT,'YYYYMMDD'))
            FROM    BKG_CSTMS_KR_CORR KRC, BKG_CSTMS_KR_BL KB
            WHERE   KRC.BKG_NO  = @[bkg_no]
            AND   KRC.PORT_CD = @[port_cd]
            AND   KRC.BKG_NO           =   KB.BKG_NO
            AND   KRC.CSTMS_DECL_TP_CD =   KB.CSTMS_DECL_TP_CD
            AND   KRC.PORT_CD          =   KB.DMST_PORT_CD
            AND   KRC.CSTMS_BL_NO      =   KB.CSTMS_BL_NO
            GROUP BY KB.BL_NO , ' ',' ', DECODE(KRC.KR_CSTMS_CORR_ID,'D','-','F','B/L삭제'),DECODE(KRC.KR_CSTMS_CORR_ID,'D','B/L추가','F','-')
            HAVING DECODE(KRC.KR_CSTMS_CORR_ID,'D','-','F','B/L삭제') IS NOT NULL
            UNION ALL
                       SELECT  KB.BL_NO BL_NO
                             , KC.CNTR_NO CNTR_NO
                             , KCC.PRE_CNTR_NO PRE_CNTR_NO
                             , DECODE(KCC.CORR_RSN,'CNTR 추가','목록없음','CNTR 삭제',KCC.CNTR_NO,KCC.PRE_DAT_CTNT)
                             , DECODE(KCC.CORR_RSN,'CNTR 추가',KCC.CNTR_NO,'CNTR 삭제','목록없음',KCC.CRNT_DAT_CTNT)
                             , ' '
                             , ' '
                             , ' '
                             , ' '
                             , KCC.PRE_DAT_CTNT PRE_DAT_CTNT
                             , KCC.CRNT_DAT_CTNT CRNT_DAT_CTNT
                             , KCC.CORR_RSN CORR_RSN
                             , MAX(TO_CHAR(COR.AMDT_SND_DT,'YYYYMMDD'))
                          FROM BKG_CSTMS_KR_CNTR KC, BKG_CSTMS_KR_CNTR_CORR KCC, BKG_CSTMS_KR_BL KB, BKG_CSTMS_KR_CORR COR
                         WHERE KC.BKG_NO           =  @[bkg_no]
                           AND KC.CSTMS_DECL_TP_CD =  @[cstms_decl_tp_cd]
                           AND KC.DMST_PORT_CD     =  @[port_cd]
                           AND KC.TRNS_SEQ         =   (SELECT MAX(TRNS_SEQ)
                                                         FROM   BKG_CSTMS_KR_BL
                                                         WHERE  BKG_NO           = @[bkg_no]
                                                         AND    CSTMS_DECL_TP_CD = @[cstms_decl_tp_cd]
                                                         AND    DMST_PORT_CD     = @[port_cd]
										 				 AND    CSTMS_BL_NO      = @[bl_no]
                                                         AND    VSL_CD           = SUBSTR(@[vvd], 1, 4)
                                                         AND    SKD_VOY_NO       = SUBSTR(@[vvd], 5, 4)
                                                         AND    SKD_DIR_CD       = SUBSTR(@[vvd], 9, 1))
                           AND KC.CNTR_NO          =   KCC.CNTR_NO(+)
                           AND KC.BKG_NO           =   KB.BKG_NO
                           AND KC.CSTMS_DECL_TP_CD =   KB.CSTMS_DECL_TP_CD
                           AND KC.DMST_PORT_CD     =   KB.DMST_PORT_CD
                           AND KC.CSTMS_BL_NO      =   KB.CSTMS_BL_NO
                           AND KCC.SMT_AMD_NO(+)   =   @[smt_amd_no]
                           AND KCC.SMT_AMD_NO      =   COR.SMT_AMD_NO
                           AND KCC.PORT_CD         =   COR.PORT_CD
                           GROUP BY KB.BL_NO
                             , KC.CNTR_NO
                             , KCC.PRE_CNTR_NO
                             , DECODE(KCC.CORR_RSN,'CNTR 추가','목록없음','CNTR 삭제',KCC.CNTR_NO,KCC.PRE_DAT_CTNT)
                             , DECODE(KCC.CORR_RSN,'CNTR 추가',KCC.CNTR_NO,'CNTR 삭제','목록없음',KCC.CRNT_DAT_CTNT)
                             , ' '
                             , ' '
                             , ' '
                             , ' '
                             , KCC.PRE_DAT_CTNT
                             , KCC.CRNT_DAT_CTNT
                             , KCC.CORR_RSN
                           HAVING DECODE(KCC.CORR_RSN,'CNTR 추가','목록없음','CNTR 삭제',KCC.CNTR_NO,KCC.PRE_DAT_CTNT) IS NOT NULL
                 UNION ALL
                    SELECT       KB.BL_NO BL_NO
                                 , KE.XPT_LIC_NO XPT_LIC_NO
                                 , KEC.PRE_XPT_LIC_NO PRE_XPT_LIC_NO
                                 , DECODE(KEC.KR_CSTMS_CORR_ID,'A','목록없음','D',KEC.XPT_LIC_NO,'X',KEC.PRE_XPT_LIC_NO)
                                 , DECODE(KEC.KR_CSTMS_CORR_ID,'A',KEC.XPT_LIC_NO,'D','목록없음','X',KE.XPT_LIC_NO)
                                 , ' '
                                 , ' '
                                 , ' '
                                 , ' '
                                 , ' '
                                 , ' '
                                 , KEC.CORR_RSN CORR_RSN
                                 , MAX(TO_CHAR(COR.AMDT_SND_DT,'YYYYMMDD'))
                              FROM BKG_CSTMS_KR_XPT_LIC KE, BKG_CSTMS_KR_XPT_LIC_CORR KEC, BKG_CSTMS_KR_BL KB, BKG_CSTMS_KR_CORR COR
                             WHERE KE.BKG_NO           =   @[bkg_no]
                               AND KE.CSTMS_DECL_TP_CD =   @[cstms_decl_tp_cd]
                               AND KE.DMST_PORT_CD     =   @[port_cd]
                               AND KE.XPT_LIC_NO       =   KEC.XPT_LIC_NO(+)
                               AND KEC.SMT_AMD_NO(+)   =   @[smt_amd_no]
                               AND KE.TRNS_SEQ         = (SELECT MAX(TRNS_SEQ)
                                                           FROM  BKG_CSTMS_KR_XPT_LIC
                                                          WHERE  BKG_NO       = @[bkg_no]
                                                            AND  CSTMS_DECL_TP_CD  =  @[cstms_decl_tp_cd]
                                                            AND  DMST_PORT_CD      = @[port_cd]
															AND  CSTMS_BL_NO       = @[bl_no])
                               AND KE.BKG_NO           =   KB.BKG_NO
                               AND KE.CSTMS_DECL_TP_CD =   KB.CSTMS_DECL_TP_CD
                               AND KE.DMST_PORT_CD     =   KB.DMST_PORT_CD
 							   AND KE.CSTMS_BL_NO      =   KB.CSTMS_BL_NO
                               AND KEC.SMT_AMD_NO      =   COR.SMT_AMD_NO
                               AND KEC.PORT_CD         =   COR.PORT_CD
                               GROUP BY KB.BL_NO
                                 , KE.XPT_LIC_NO
                                 , KEC.PRE_XPT_LIC_NO
                                 , DECODE(KEC.KR_CSTMS_CORR_ID,'A','목록없음','D',KEC.XPT_LIC_NO,'X',KEC.PRE_XPT_LIC_NO)
                                 , DECODE(KEC.KR_CSTMS_CORR_ID,'A',KEC.XPT_LIC_NO,'D','목록없음','X',KE.XPT_LIC_NO)
                                 , ' '
                                 , ' '
                                 , ' '
                                 , ' '
                                 , ' '
                                 , ' '
                                 , KEC.CORR_RSN
                               HAVING DECODE(KEC.KR_CSTMS_CORR_ID,'A','목록없음','D',KEC.XPT_LIC_NO,'X',KEC.PRE_XPT_LIC_NO) IS NOT NULL  )			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="port_cd" type="12" value="" out="N"/>
				<param name="cstms_decl_tp_cd" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="smt_amd_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
