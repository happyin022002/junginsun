<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CLLCDLManifestDBDAOsearchCllCdlCheckListRSQL">
			<desc><![CDATA[searchCllCdlCheckList]]></desc>
			<sql><![CDATA[
#if (${in_list_type} == 'L' ) 	
#if (${in_check_gubun} == '5' ) 	
SELECT
	TML_MSG_MTCH_ID MTCH_FLG,
	TML_VVD_ID VVD_CD,
	CNTR_NO,	
	CNTR_TPSZ_CD, 	
	CNTR_SEAL_NO, 
	CNTR_SEAL_NO2,
	DECODE(CGO_STS_ID, '2','EXPORT', '3','IMPORT', '6','T/S', CGO_STS_ID) CGO_STS_ID,	
	EVNT_YD_CD,
	POL_CD, 
	POD_CD,
	N1ST_POD_CD, 	
	GRS_WGT,
	DECODE(CGO_TP_CD,
			'0','NORMAL', '1','REEFER', '2','RF/IMO', '3','IMO', '9','EMPTY',
			CGO_TP_CD
	) CGO_TP_CD,
	IMDG_CLSS_ID, 
	EUR_TML_DMG_ID,	
	DECODE(TRSP_MOD_ID, 'T','TRUCK', 'R','RAIL', 'F','FEEDER', TRSP_MOD_ID) TRSP_MOD_ID,
	DECODE(EXP_DT,
			NULL,TO_CHAR(TO_DATE(CNTR_LDIS_DT,'YYYY-MM-DD HH24:MI:SS'),'YYYY-MM-DD HH24:MI'),
			TO_CHAR(EXP_DT,'YYYY-MM-DD HH24:MI')
	) CNTR_LDIS_DT,	
	BKG_NO,	
	CALL_SGN_NO, 	
	VSL_NM, 	
	TO_CHAR(EDI_RPT_MSG_RCV_DT,'YYYY-MM-DD HH24:MI') EDI_RPT_MSG_RCV_DT,

	ORG_YD_CD,
	EDI_SNDR_ID, 
 	CO_RPT_ID, 
	CNTR_LDIS_DT CNTR_LDIS_DT2, 
	STWG_CELL_NO,
	TO_CHAR(UPD_DT,'YYYY-MM-DD HH24:MI') UPD_DT,
	'' TEMP1, 
	'' TEMP2,
	DECODE(CRR_CD, NULL,CO_RPT_ID, CRR_CD) CRR_CD, 
	CSTMS_DECL_NO, 
	CNTR_TARE_WGT
 FROM	BKG_CSTMS_TML_EUR
 WHERE	EVNT_YD_CD	LIKE @[in_cr_yard]||'%'
#if (${in_cr_indate_start} != '' && ${in_cr_indate_end} != '' ) 
 AND	EDI_RPT_MSG_RCV_DT BETWEEN TO_DATE(REPLACE(@[in_cr_indate_start], '-', '')|| '000000','YYYYMMDDHH24MISS')
					  AND TO_DATE(REPLACE(@[in_cr_indate_end], '-', '')|| '235959','YYYYMMDDHH24MISS')  
#end
#if (${in_cr_edate_start} != '' && ${in_cr_edate_end} != '' ) 
 AND	DECODE(EXP_DT,NULL,CNTR_LDIS_DT,EXP_DT) BETWEEN TO_DATE(REPLACE(@[in_cr_edate_start], '-', '')|| '000000','YYYYMMDDHH24MISS')
					  AND TO_DATE(REPLACE(@[in_cr_edate_end], '-', '')|| '235959','YYYYMMDDHH24MISS') 
#end 
 AND	TML_VVD_ID	LIKE @[in_vvd_cd]||'%'
 AND	POL_CD	LIKE @[in_pol_cd]||'%'
 AND	POD_CD	LIKE @[in_pod_cd]||'%'
 AND	CNTR_NO	LIKE @[in_cntr_no]||'%'
 AND	CALL_SGN_NO	LIKE @[in_cr_callsign]||'%'
 AND	VSL_NM	LIKE @[in_cr_vslname]||'%'
 AND	CNTR_LODG_DCHG_CD = 'L'
 ORDER BY EDI_RPT_MSG_RCV_DT
#elseif (${in_check_gubun} == '1' ) 	
SELECT	
	A.TML_VVD_ID VVD_CD, 
	A.POL_CD, 
	A.POD_CD, 
	A.CNTR_NO, 
	A.BKG_NO, 
	'M' MTCH_FLG
FROM	BKG_CSTMS_TML_EUR A, BKG_BOOKING BK, BKG_CONTAINER BC, BKG_VVD BV
WHERE	A.TML_VVD_ID	= @[in_vvd_cd]
AND	A.POL_CD	= @[in_pol_cd]
AND	BV.POL_CD	= A.POL_CD
AND	BK.BKG_STS_CD	<> 'X'
AND	BK.BKG_STS_CD	<> 'S'
AND	BK.BKG_NO	= BC.BKG_NO
AND	BK.BKG_NO	= BV.BKG_NO
AND	BV.VSL_CD	= SUBSTR(A.TML_VVD_ID, 1, 4)
AND	BV.SKD_VOY_NO	= SUBSTR(A.TML_VVD_ID, 5, 4)
AND	BV.SKD_DIR_CD	= SUBSTR(A.TML_VVD_ID, 9, 1)
AND	BC.CNTR_NO	= A.CNTR_NO
#elseif (${in_check_gubun} == '2' ) 	
SELECT	
	BV.VSL_CD||BV.SKD_VOY_NO||BV.SKD_DIR_CD VVD_CD, 
	BV.POL_CD, 
	BV.POD_CD, 
	BC.CNTR_NO, 
	BK.BKG_NO, 
	'B' MTCH_FLG
FROM BKG_BOOKING BK, BKG_CONTAINER BC, BKG_VVD BV, (
		SELECT	BC.CNTR_NO x, 'B' y
		FROM	BKG_BOOKING BK, BKG_CONTAINER BC, BKG_VVD BV
		WHERE	BK.BKG_STS_CD	<> 'X'
		AND	BK.BKG_STS_CD	<> 'S'
		AND	BK.BKG_NO	= BC.BKG_NO
		AND	BK.BKG_NO	= BV.BKG_NO
		AND	BV.VSL_CD	= SUBSTR(@[in_vvd_cd], 1, 4)
		AND	BV.SKD_VOY_NO	= SUBSTR(@[in_vvd_cd], 5, 4)
		AND	BV.SKD_DIR_CD	= SUBSTR(@[in_vvd_cd], 9, 1)
		AND	BV.POL_CD	= @[in_pol_cd]
		MINUS 
		SELECT	CNTR_NO, 'B'
		FROM	BKG_CSTMS_TML_EUR
		WHERE	TML_VVD_ID	= @[in_vvd_cd]
		AND	POL_CD		= @[in_pol_cd]
		AND	CNTR_LODG_DCHG_CD = 'L'
		)
WHERE	BK.BKG_STS_CD	<> 'X'
AND     BK.BKG_STS_CD	<> 'S'
AND     BK.BKG_NO	= BC.BKG_NO
AND     BK.BKG_NO	= BV.BKG_NO
AND     BV.VSL_CD	= SUBSTR(@[in_vvd_cd], 1, 4)
AND     BV.SKD_VOY_NO	= SUBSTR(@[in_vvd_cd], 5, 4)
AND     BV.SKD_DIR_CD	= SUBSTR(@[in_vvd_cd], 9, 1)
AND     BV.POL_CD	= @[in_pol_cd]
AND     BC.CNTR_NO	= x
UNION ALL
SELECT	
	A.TML_VVD_ID VVD_CD, 
	A.POL_CD, 
	A.POD_CD, 
	A.BKG_NO, 
	A.CNTR_NO, 
	'R' MTCH_FLG
FROM	BKG_CSTMS_TML_EUR A, (
			SELECT  CNTR_NO x, 'R'
			FROM  BKG_CSTMS_TML_EUR
			WHERE	TML_VVD_ID	= @[in_vvd_cd]
			AND	POL_CD		= @[in_pol_cd]
			AND	CNTR_LODG_DCHG_CD = 'L'
			MINUS
			SELECT BC.CNTR_NO, 'R'
			FROM    BKG_BOOKING BK, BKG_CONTAINER BC, BKG_VVD BV
			WHERE   BK.BKG_STS_CD	<> 'X'
			AND     BK.BKG_STS_CD	<> 'S'
			AND     BK.BKG_NO	= BC.BKG_NO
			AND     BK.BKG_NO	= BV.BKG_NO
			AND     BV.VSL_CD		= SUBSTR(@[in_vvd_cd], 1, 4)
			AND     BV.SKD_VOY_NO	= SUBSTR(@[in_vvd_cd], 5, 4)
			AND     BV.SKD_DIR_CD	= SUBSTR(@[in_vvd_cd], 9, 1)
			AND     BV.POL_CD		= @[in_pol_cd]
			)
WHERE	A.TML_VVD_ID	= @[in_vvd_cd]
AND	A.POL_CD	= @[in_pol_cd]
AND	A.CNTR_NO	= x 
AND	A.CNTR_LODG_DCHG_CD = 'L'
#elseif (${in_check_gubun} == '3' ) 
SELECT
	TML_MSG_MTCH_ID MTCH_FLG,
	TML_VVD_ID VVD_CD,
	CNTR_NO,	
	CNTR_TPSZ_CD, 	
	CNTR_SEAL_NO, 
	CNTR_SEAL_NO2,
	DECODE(CGO_STS_ID, '2','EXPORT', '3','IMPORT', '6','T/S', CGO_STS_ID) CGO_STS_ID,	
	EVNT_YD_CD,
	POL_CD, 
	POD_CD,
	N1ST_POD_CD, 
	GRS_WGT,
	DECODE(CGO_TP_CD,
			'0','NORMAL', '1','REEFER', '2','RF/IMO', '3','IMO', '9','EMPTY',
			CGO_TP_CD
	) CGO_TP_CD,
	IMDG_CLSS_ID, 
	EUR_TML_DMG_ID,	
	DECODE(TRSP_MOD_ID, 'T','TRUCK', 'R','RAIL', 'F','FEEDER', TRSP_MOD_ID) TRSP_MOD_ID,
	DECODE(EXP_DT,
			NULL,TO_CHAR(TO_DATE(CNTR_LDIS_DT,'YYYY-MM-DD HH24:MI:SS'),'YYYY-MM-DD HH24:MI:SS'),
			TO_CHAR(EXP_DT,'YYYY-MM-DD HH24:MI:SS')
	) CNTR_LDIS_DT,	
	BKG_NO,	
	CALL_SGN_NO, 	
	VSL_NM, 	
	TO_CHAR(EDI_RPT_MSG_RCV_DT,'YYYY-MM-DD HH24:MI:SS') EDI_RPT_MSG_RCV_DT,
	ORG_YD_CD,
	EDI_SNDR_ID, 
 	CO_RPT_ID, 
	CNTR_LDIS_DT CNTR_LDIS_DT2, 
	STWG_CELL_NO,
	TO_CHAR(UPD_DT,'YYYY-MM-DD HH24:MI:SS') UPD_DT,
	'' TEMP1, 
	'' TEMP2,
	DECODE(CRR_CD, NULL,CO_RPT_ID, CRR_CD) CRR_CD, 
	CSTMS_DECL_NO, 
	CNTR_TARE_WGT
 FROM	BKG_CSTMS_TML_EUR
 WHERE	EVNT_YD_CD	LIKE @[in_cr_yard]||'%'
#if (${in_cr_indate_start} != '' && ${in_cr_indate_end} != '' ) 
 AND	EDI_RPT_MSG_RCV_DT BETWEEN TO_DATE(REPLACE(@[in_cr_indate_start], '-', '')|| '000000','YYYYMMDDHH24MISS')
					  AND TO_DATE(REPLACE(@[in_cr_indate_end], '-', '')|| '235959','YYYYMMDDHH24MISS')  
#end
#if (${in_cr_edate_start} != '' && ${in_cr_edate_end} != '' ) 
 AND	DECODE(EXP_DT,NULL,CNTR_LDIS_DT,EXP_DT) BETWEEN TO_DATE(REPLACE(@[in_cr_edate_start], '-', '')|| '000000','YYYYMMDDHH24MISS')
					  AND TO_DATE(REPLACE(@[in_cr_edate_end], '-', '')|| '235959','YYYYMMDDHH24MISS') 
#end 
 AND	TML_VVD_ID	LIKE @[in_vvd_cd]||'%'
 AND	POL_CD	LIKE @[in_pol_cd]||'%'
 AND	POD_CD	LIKE @[in_pod_cd]||'%'
 AND	CNTR_NO	LIKE @[in_cntr_no]||'%'
 AND	CALL_SGN_NO	LIKE @[in_cr_callsign]||'%'
 AND	VSL_NM	LIKE @[in_cr_vslname]||'%'
 AND	TML_MSG_MTCH_ID	<>    'R'
 AND	CNTR_LODG_DCHG_CD = 'L'
 ORDER BY EDI_RPT_MSG_RCV_DT
#else
SELECT
	TML_MSG_MTCH_ID MTCH_FLG,
	TML_VVD_ID VVD_CD,
	POL_CD, 
	POD_CD,	
	CNTR_NO,
	BKG_NO,	
	CNTR_SEAL_NO, 	
	CNTR_TPSZ_CD, 
	CNTR_SEAL_NO2,
	DECODE(CGO_STS_ID, '2','EXPORT', '3','IMPORT', '6','T/S', CGO_STS_ID) CGO_STS_ID,	
	EVNT_YD_CD,
	N1ST_POD_CD, 
	GRS_WGT,
	DECODE(CGO_TP_CD,
			'0','NORMAL', '1','REEFER', '2','RF/IMO', '3','IMO', '9','EMPTY',
			CGO_TP_CD
	) CGO_TP_CD,
	IMDG_CLSS_ID, 
	EUR_TML_DMG_ID,	
	DECODE(TRSP_MOD_ID, 'T','TRUCK', 'R','RAIL', 'F','FEEDER', TRSP_MOD_ID) TRSP_MOD_ID,
	DECODE(EXP_DT,
			NULL,TO_CHAR(TO_DATE(CNTR_LDIS_DT,'YYYY-MM-DD HH24:MI:SS'),'YYYY-MM-DD HH24:MI:SS'),
			TO_CHAR(EXP_DT,'YYYY-MM-DD HH24:MI:SS')
	) CNTR_LDIS_DT,	
	CALL_SGN_NO, 	
	VSL_NM, 	
	TO_CHAR(EDI_RPT_MSG_RCV_DT,'YYYY-MM-DD HH24:MI:SS') EDI_RPT_MSG_RCV_DT,
	ORG_YD_CD,
	EDI_SNDR_ID, 
 	CO_RPT_ID, 
	TO_CHAR(CNTR_LDIS_DT,'YYYY-MM-DD HH24:MI:SS') CNTR_LDIS_DT2,
	STWG_CELL_NO,
	TO_CHAR(UPD_DT,'YYYY-MM-DD HH24:MI:SS') UPD_DT,
	'' TEMP1, 
	'' TEMP2,
	DECODE(CRR_CD, NULL,CO_RPT_ID, CRR_CD) CRR_CD, 
	CSTMS_DECL_NO, 
	TO_CHAR(CNTR_TARE_WGT,'9,999.999') CNTR_TARE_WGT
 FROM	BKG_CSTMS_TML_EUR
 WHERE	EVNT_YD_CD	LIKE @[in_cr_yard]||'%'
#if (${in_cr_indate_start} != '' && ${in_cr_indate_end} != '' ) 
 AND	EDI_RPT_MSG_RCV_DT BETWEEN TO_DATE(REPLACE(@[in_cr_indate_start], '-', '')|| '000000','YYYYMMDDHH24MISS')
					  AND TO_DATE(REPLACE(@[in_cr_indate_end], '-', '')|| '235959','YYYYMMDDHH24MISS')  
#end
#if (${in_cr_edate_start} != '' && ${in_cr_edate_end} != '' ) 
 AND	DECODE(EXP_DT,NULL,CNTR_LDIS_DT,EXP_DT) BETWEEN TO_DATE(REPLACE(@[in_cr_edate_start], '-', '')|| '000000','YYYYMMDDHH24MISS')
					  AND TO_DATE(REPLACE(@[in_cr_edate_end], '-', '')|| '235959','YYYYMMDDHH24MISS') 
#end 
 AND	TML_VVD_ID	LIKE @[in_vvd_cd]||'%'
 AND	POL_CD	LIKE @[in_pol_cd]||'%'
 AND	POD_CD	LIKE @[in_pod_cd]||'%'
 AND	CNTR_NO	LIKE @[in_cntr_no]||'%'
 AND	CALL_SGN_NO	LIKE @[in_cr_callsign]||'%'
 AND	VSL_NM	LIKE @[in_cr_vslname]||'%'
 AND	TML_MSG_MTCH_ID 	=    'R'
 --ORDER BY EDI_RPT_MSG_RCV_DT

UNION ALL

SELECT	
	DECODE(C.EDI_RCV_STS_CD,'W','I','I','I',C.EDI_RCV_STS_CD) MTCH_FLG,
	C.VSL_CD||C.SKD_VOY_NO||C.SKD_DIR_CD VVD_CD, 
	C.POL_CD, 
	C.POD_CD,
	C.CNTR_NO, 
	C.BKG_NO,
	C.CNTR_SEAL_NO, 
	C.CNTR_TPSZ_CD,
	'',	
	'',
	'',
	'',
	0,
	'',
	'',
	'',
	'',
	'',
	'',
	'',
	'',
	'',
	'',
	'',
	'',
	'',
	'',
	'',
	'',
	'',
	'',
	''
 FROM	BKG_CSTMS_TML_CLL C
 WHERE	VSL_CD		= SUBSTR(@[in_vvd_cd], 1, 4)
 AND	SKD_VOY_NO	= SUBSTR(@[in_vvd_cd], 5, 4)
 AND	SKD_DIR_CD	= SUBSTR(@[in_vvd_cd], 9, 1)
 AND	PORT_CD			= @[in_pol_cd]
 AND	C.EDI_RCV_STS_CD	= 'W'
 --ORDER BY C.CNTR_NO, C.BKG_NO
#end
#else
SELECT
	TML_MSG_MTCH_ID MTCH_FLG,
	TML_VVD_ID VVD_CD,
	
	CNTR_NO,	
	CNTR_TPSZ_CD, 	
	CNTR_SEAL_NO, 
	CNTR_SEAL_NO2,
	DECODE(CGO_STS_ID, '2','EXPORT', '3','IMPORT', '6','T/S', CGO_STS_ID) CGO_STS_ID,	
	EVNT_YD_CD,
	POL_CD, 
	POD_CD,
	N1ST_POD_CD, 	
	GRS_WGT,
	DECODE(CGO_TP_CD,
			'0','NORMAL', '1','REEFER', '2','RF/IMO', '3','IMO', '9','EMPTY',
			CGO_TP_CD
	) CGO_TP_CD,
	IMDG_CLSS_ID, 
	EUR_TML_DMG_ID,	
	DECODE(TRSP_MOD_ID, 'T','TRUCK', 'R','RAIL', 'F','FEEDER', TRSP_MOD_ID) TRSP_MOD_ID,
	DECODE(EXP_DT,
			NULL,TO_CHAR(TO_DATE(CNTR_LDIS_DT,'YYYY-MM-DD HH24:MI:SS'),'YYYY-MM-DD HH24:MI:SS'),
			TO_CHAR(EXP_DT,'YYYY-MM-DD HH24:MI:SS')
	) CNTR_LDIS_DT,		
	BKG_NO,	
	CALL_SGN_NO, 	
	VSL_NM, 	
	TO_CHAR(EDI_RPT_MSG_RCV_DT,'YYYY-MM-DD HH24:MI:SS') EDI_RPT_MSG_RCV_DT,
	ORG_YD_CD,
	EDI_SNDR_ID, 
 	CO_RPT_ID, 
	CNTR_LDIS_DT CNTR_LDIS_DT2, 
	STWG_CELL_NO,
	TO_CHAR(UPD_DT,'YYYY-MM-DD HH24:MI:SS') UPD_DT,
	'' TEMP1, 
	'' TEMP2,
	DECODE(CRR_CD, NULL,CO_RPT_ID, CRR_CD) CRR_CD, 
	CSTMS_DECL_NO, 
	CNTR_TARE_WGT
 FROM	BKG_CSTMS_TML_EUR 
 WHERE	EVNT_YD_CD	LIKE @[in_cr_yard]||'%'
#if (${in_cr_indate_start} != '' && ${in_cr_indate_end} != '' ) 
 AND	EDI_RPT_MSG_RCV_DT BETWEEN TO_DATE(REPLACE(@[in_cr_indate_start], '-', '')|| '000000','YYYYMMDDHH24MISS')
					  AND TO_DATE(REPLACE(@[in_cr_indate_end], '-', '')|| '235959','YYYYMMDDHH24MISS')  
#end
#if (${in_cr_edate_start} != '' && ${in_cr_edate_end} != '' ) 
 AND	DECODE(EXP_DT,NULL,CNTR_LDIS_DT,EXP_DT) BETWEEN TO_DATE(REPLACE(@[in_cr_edate_start], '-', '')|| '000000','YYYYMMDDHH24MISS')
					  AND TO_DATE(REPLACE(@[in_cr_edate_end], '-', '')|| '235959','YYYYMMDDHH24MISS') 
#end 
 AND	TML_VVD_ID	LIKE @[in_vvd_cd]||'%'
 AND	POL_CD	LIKE @[in_pol_cd]||'%'
 AND	POD_CD	LIKE @[in_pod_cd]||'%'
 AND	CNTR_NO	LIKE @[in_cntr_no]||'%'
 AND	CALL_SGN_NO	LIKE @[in_cr_callsign]||'%'
 AND	VSL_NM	LIKE @[in_cr_vslname]||'%'
 AND	CNTR_LODG_DCHG_CD = 'D'
 ORDER BY EDI_RPT_MSG_RCV_DT
#end			]]></sql>
			<params>
				<param name="in_cr_yard" type="12" value="" out="N"/>
				<param name="in_cr_indate_start" type="12" value="" out="N"/>
				<param name="in_cr_indate_end" type="12" value="" out="N"/>
				<param name="in_cr_edate_start" type="12" value="" out="N"/>
				<param name="in_cr_edate_end" type="12" value="" out="N"/>
				<param name="in_vvd_cd" type="12" value="" out="N"/>
				<param name="in_pol_cd" type="12" value="" out="N"/>
				<param name="in_pod_cd" type="12" value="" out="N"/>
				<param name="in_cntr_no" type="12" value="" out="N"/>
				<param name="in_cr_callsign" type="12" value="" out="N"/>
				<param name="in_cr_vslname" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
