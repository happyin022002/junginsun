<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="KrWharfageDecMgtDBDAOsearchKrWhfVvdDtlInitialListRSQL">
			<desc><![CDATA[s]]></desc>
			<sql><![CDATA[
SELECT ROWNUM AS PORT_SEQ,
CASE B.SORT_VALUE WHEN 'dd20' THEN '6'
WHEN 'dd40' THEN '8'
WHEN 'dd45' THEN '9'
ELSE '2'
END AS UNLD_TP_CD,
SUM ( CASE SUBSTR(B.SORT_KEY, 1, 1) WHEN 'B' THEN A.RTON
ELSE CASE B.SORT_VALUE WHEN A.DDD20 THEN A.D20
WHEN A.DDD40 THEN A.D40
WHEN A.DDD45 THEN A.D45
END END) AS TTL_TON_QTY,
CASE WHEN A.SORT_KEY IN ('I', 'J') THEN '4'
WHEN SUBSTR('OO', 1, 1) = 'I' THEN '0'
ELSE '1'
END AS KR_WHF_DC_CD,
CASE WHEN A.SORT_KEY IN ('BS', 'S') THEN '6'
WHEN A.SORT_KEY IN ('BD', 'D') THEN '3'
WHEN A.SORT_KEY IN ('BX', 'BI', 'X', 'I') THEN '9'
WHEN A.SORT_KEY IN ('BJ', 'J') THEN '2'
WHEN A.SORT_KEY IN ('BK', 'K') THEN '1'
END AS KR_WHF_DC_RSN_CD,
'I' AS UPD_FLG
FROM ( SELECT DECODE(NVL(TRIM(AA.WFG_EXPT_CD), 'Z'), 'Z', 'N', 'B', 'N', AA.WFG_EXPT_CD) AS SORT_KEY,
       SUM(BB.TAX_TEU_QTY + BB.EXPT_TEU_QTY) AS D20, 'dd20' AS DDD20,
       SUM(BB.TAX_FEU_QTY + BB.EXPT_FEU_QTY) AS D40, 'dd40' AS DDD40,
       SUM(BB.TAX_45FT_QTY + BB.EXPT_45FT_QTY) AS D45, 'dd45' AS DDD45,
       0 AS RTON
  FROM ( SELECT A.VSL_CD, A.SKD_VOY_NO, A.SKD_DIR_CD, A.BL_NO, A.WHF_BND_CD, A.WFG_EXPT_CD, MAX(CHG_RT_SEQ) CHG_RT_SEQ
  FROM BKG_KR_WHF_BL A, BKG_KR_WHF_RT B
 WHERE A.VSL_CD = SUBSTR(@[vvd], 1, 4)
   AND A.SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
   AND A.SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
   AND DECODE(@[whf_bnd_cd],'IN',SUBSTR(A.WHF_BND_CD,1,1),A.WHF_BND_CD) = DECODE(@[whf_bnd_cd],'IN','I',@[whf_bnd_cd])
   AND DECODE(SUBSTR(@[whf_bnd_cd], 1, 1), 'O', A.WHF_POL_cd, A.WHF_POD_CD) = @[port_cd]
   AND NVL(A.WHF_BL_STS_CD, ' ') != 'D'
   AND A.WHF_AMT >= 0
   AND B.VSL_CD = A.VSL_CD
   AND B.SKD_VOY_NO = A.SKD_VOY_NO
   AND B.SKD_DIR_CD = A.SKD_DIR_CD
   AND B.WHF_BND_CD = A.WHF_BND_CD
   AND B.BL_NO = A.BL_NO
   AND NVL( B.KR_WHF_EXPT_CD, ' ') != 'D'
 GROUP BY A.VSL_CD, A.SKD_VOY_NO, A.SKD_DIR_CD, A.BL_NO, A.WHF_BND_CD, A.WFG_EXPT_CD ) AA, BKG_KR_WHF_RT BB
 WHERE BB.VSL_CD(+) = AA.VSL_CD
   AND BB.SKD_VOY_NO(+) = AA.SKD_VOY_NO
   AND BB.SKD_DIR_CD(+) = AA.SKD_DIR_CD
   AND BB.WHF_BND_CD(+) = AA.WHF_BND_CD
   AND BB.BL_NO(+) = AA.BL_NO
   AND BB.CHG_RT_SEQ(+) = AA.CHG_RT_SEQ
 GROUP BY DECODE(NVL(TRIM(AA.WFG_EXPT_CD), 'Z'), 'Z', 'N', 'B', 'N', AA.WFG_EXPT_CD)
 UNION ALL
SELECT DECODE(NVL(TRIM(AA.WFG_EXPT_CD), 'Z'), 'Z', 'BN', 'B', 'BN', 'B' || AA.WFG_EXPT_CD),
       SUM(BB.BLK_TEU_QTY + BB.EXPT_TEU_QTY) AS D20, 'dd20' AS DDD20,
       SUM(BB.BLK_FEU_QTY + BB.EXPT_FEU_QTY) AS D40, 'dd40' AS DDD40,
       SUM(BB.BLK_45FT_QTY + BB.EXPT_45FT_QTY) AS D45, 'dd45' AS DDD45,
       SUM(BB.RTON_WGT)
  FROM ( SELECT A.VSL_CD, A.SKD_VOY_NO, A.SKD_DIR_CD, A.BL_NO, A.WHF_BND_CD, A.WFG_EXPT_CD, MAX(CHG_RT_SEQ) CHG_RT_SEQ
  FROM BKG_KR_WHF_BL A, BKG_KR_WHF_RT B
 WHERE A.VSL_CD = SUBSTR(@[vvd], 1, 4)
   AND A.SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
   AND A.SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
   AND DECODE(@[whf_bnd_cd],'IN',SUBSTR(A.WHF_BND_CD,1,1),A.WHF_BND_CD) = DECODE(@[whf_bnd_cd],'IN','I',@[whf_bnd_cd])
   AND DECODE(SUBSTR(@[whf_bnd_cd], 1, 1), 'O', A.WHF_POL_cd, A.WHF_POD_CD) = @[port_cd]
   AND NVL(A.WHF_BL_STS_CD, ' ') != 'D'
   AND A.WHF_AMT >= 0
   AND B.VSL_CD = A.VSL_CD
   AND B.SKD_VOY_NO = A.SKD_VOY_NO
   AND B.SKD_DIR_CD = A.SKD_DIR_CD
   AND B.WHF_BND_CD = A.WHF_BND_CD
   AND B.BL_NO = A.BL_NO
   AND NVL( B.KR_WHF_EXPT_CD, ' ') != 'D'
 GROUP BY A.VSL_CD, A.SKD_VOY_NO, A.SKD_DIR_CD, A.BL_NO, A.WHF_BND_CD, A.WFG_EXPT_CD ) AA, BKG_KR_WHF_RT BB
 WHERE BB.VSL_CD(+) = AA.VSL_CD
   AND BB.SKD_VOY_NO(+) = AA.SKD_VOY_NO
   AND BB.SKD_DIR_CD(+) = AA.SKD_DIR_CD
   AND BB.WHF_BND_CD(+) = AA.WHF_BND_CD
   AND BB.BL_NO(+) = AA.BL_NO
   AND BB.CHG_RT_SEQ(+) = AA.CHG_RT_SEQ
   AND BB.KR_CSTMS_FRT_TP_CD = 'BLK'
 GROUP BY DECODE(NVL(TRIM(AA.WFG_EXPT_CD), 'Z'), 'Z', 'BN', 'B', 'BN', 'B' || AA.WFG_EXPT_CD) ) A, 
( SELECT 'dd20' AS SORT_VALUE ,'N' AS SORT_KEY FROM DUAL UNION ALL
SELECT 'dd40'   ,'N'      FROM DUAL UNION ALL
SELECT 'dd45'   ,'N'      FROM DUAL UNION ALL
SELECT 'dd20'   ,'S'      FROM DUAL UNION ALL
SELECT 'dd40'   ,'S'      FROM DUAL UNION ALL
SELECT 'dd45'   ,'S'      FROM DUAL UNION ALL
SELECT 'dd20'   ,'D'      FROM DUAL UNION ALL
SELECT 'dd40'   ,'D'      FROM DUAL UNION ALL
SELECT 'dd45'   ,'D'      FROM DUAL UNION ALL
SELECT 'dd20'   ,'X'      FROM DUAL UNION ALL
SELECT 'dd40'   ,'X'      FROM DUAL UNION ALL
SELECT 'dd45'   ,'X'      FROM DUAL UNION ALL
SELECT 'dd20'   ,'I'      FROM DUAL UNION ALL
SELECT 'dd40'   ,'I'      FROM DUAL UNION ALL
SELECT 'dd45'   ,'I'      FROM DUAL UNION ALL
SELECT 'dd20'   ,'J'      FROM DUAL UNION ALL
SELECT 'dd40'   ,'J'      FROM DUAL UNION ALL
SELECT 'dd45'   ,'J'      FROM DUAL UNION ALL
SELECT 'dd20'   ,'K'      FROM DUAL UNION ALL
SELECT 'dd40'   ,'K'      FROM DUAL UNION ALL
SELECT 'dd45'   ,'K'      FROM DUAL UNION ALL
SELECT 'BLK'    ,'BS'     FROM DUAL UNION ALL
SELECT 'BLK'    ,'BD'     FROM DUAL UNION ALL
SELECT 'BLK'    ,'BX'     FROM DUAL UNION ALL
SELECT 'BLK'    ,'BI'     FROM DUAL UNION ALL
SELECT 'BLK'    ,'BJ'     FROM DUAL UNION ALL
SELECT 'BLK'    ,'BK'     FROM DUAL UNION ALL
SELECT 'BLK'    ,'BN'     FROM DUAL ) B
WHERE A.SORT_KEY = B.SORT_KEY
GROUP BY ROWNUM,
CASE B.SORT_VALUE WHEN 'dd20' THEN '6'
WHEN 'dd40' THEN '8'
WHEN 'dd45' THEN '9'
ELSE '2'
END ,
CASE WHEN A.SORT_KEY IN ('I', 'J') THEN '4'
WHEN SUBSTR('OO', 1, 1) = 'I' THEN '0'
ELSE '1'
END ,
CASE WHEN A.SORT_KEY IN ('BS', 'S') THEN '6'
WHEN A.SORT_KEY IN ('BD', 'D') THEN '3'
WHEN A.SORT_KEY IN ('BX', 'BI', 'X', 'I') THEN '9'
WHEN A.SORT_KEY IN ('BJ', 'J') THEN '2'
WHEN A.SORT_KEY IN ('BK', 'K') THEN '1'
END			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="whf_bnd_cd" type="12" value="" out="N"/>
				<param name="port_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
