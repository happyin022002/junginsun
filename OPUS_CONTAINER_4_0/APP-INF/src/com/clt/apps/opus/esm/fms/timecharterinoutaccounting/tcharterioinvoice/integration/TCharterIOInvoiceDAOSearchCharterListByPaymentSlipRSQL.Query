<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOInvoiceDAOSearchCharterListByPaymentSlipRSQL">
			<desc><![CDATA[TCharterIOInvoiceDAOSearchCharterListByPaymentSlipRSQL]]></desc>
			<sql><![CDATA[
SELECT (SELECT ACCT_ITM_NM 
          FROM FMS_ACCT_ITM 
         WHERE ACCT_CD = FD.ACCT_CD 
           AND ROWNUM = 1) ACCT_NM,
       FD.ACCT_CD,
       FD.CURR_CD,
       TO_CHAR(FD.INV_AMT,'FM999,999,999,999,999,990.00') INV_AMT,
       FD.INV_DESC,
       (SELECT AP_CTR_CD 
          FROM MDM_ORGANIZATION 
         WHERE OFC_CD = @[ofc_cd]
           AND ROWNUM = 1) CTR_CD,
       (SELECT LOC_CD 
          FROM MDM_ORGANIZATION 
         WHERE OFC_CD = @[ofc_cd]
           AND ROWNUM = 1) SLP_LOC_CD,
       FD.FLET_ISS_TP_CD,
       FD.INV_SEQ,
       FD.INV_DTL_SEQ,
       '03' FLET_SRC_TP_CD,
       FD.VSL_CD || SKD_VOY_NO || SKD_DIR_CD || REV_DIR_CD VVD_BUNKER,
       (SELECT DECODE(VSL_CD,NULL,'N','Y')
          FROM AR_MST_REV_VVD
         WHERE    VSL_CD 
               || SKD_VOY_NO 
               || SKD_DIR_CD 
               || RLANE_DIR_CD =    FD.VSL_CD 
                                 || FD.SKD_VOY_NO 
                                 || FD.SKD_DIR_CD 
                                 || FD.REV_DIR_CD
           AND DELT_FLG = 'N') VVD_YN,
	   DECODE(FD.CHTR_PAY_RCV_CD,'P','Charterer','Owner') CHTR_PAY_RCV_CD,
       FD.FLET_CTRT_NO
  FROM FMS_INVOICE FI, FMS_INV_DTL FD
 WHERE FI.FLET_CTRT_NO = FD.FLET_CTRT_NO
   AND FI.FLET_ISS_TP_CD = FD.FLET_ISS_TP_CD
   AND FI.INV_SEQ = FD.INV_SEQ
   AND FD.SLP_TP_CD IS NULL
   AND FD.FLET_ISS_TP_CD = 'CHT'
   AND FD.VSL_CD IN (SELECT VSL_CD 
                       FROM FMS_CONTRACT
                      WHERE FLET_CTRT_NO = @[flet_ctrt_no]
                     UNION ALL
                     SELECT VSL_CD
                       FROM FMS_ID_VSL
                      WHERE FLET_CTRT_NO = @[flet_ctrt_no]
         			    AND USE_FLG = 'Y')
   AND FD.CURR_CD = @[csr_curr_cd]
 ORDER BY FI.PPAY_HIR_NO, FD.ACCT_CD			]]></sql>
			<params>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="flet_ctrt_no" type="12" value="" out="N"/>
				<param name="csr_curr_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
