<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EBookingReceiptDBDAOsearchCargoSmartAckRSQL">
			<desc><![CDATA[]]></desc>
			<sql><![CDATA[
SELECT 
'{CNTR_INFO' || CHR(10)
	|| 'CNTR_NO:' || VGM.CNTR_NO  || CHR(10)
#if (${res_tp_cd} == '1') 
	||'VGM_C_DATE:' || TO_CHAR(VGM.CRE_DT,'YYYYMMDDHH24MI') || CHR(10)
#else
	||'VGM_C_DATE:' || CHR(10)
#end
#if (${res_tp_cd} == '1') 
	||'VGM_R_DATE:' || CHR(10)
#else
	||'VGM_R_DATE:' || TO_CHAR(VGM.CRE_DT,'YYYYMMDDHH24MI') || CHR(10)
#end
#if (${res_tp_cd} == '1') 
	||'RESPONSE:' || CHR(10)
#elseif (${res_tp_cd} == '2') 
	||'RESPONSE:invalid booking or container number' || CHR(10)
#elseif (${res_tp_cd} == '3') 
	||'RESPONSE:VGM verify date is greater than the edi send date' || CHR(10)
#elseif (${res_tp_cd} == '4') 
	||'RESPONSE:VGM is less or equal to container tare weight' || CHR(10)
#elseif (${res_tp_cd} == '5') 
	||'RESPONSE:VGM is greater than (Max Payload + Tare weight)' || CHR(10)
#end
	||'CUST_MSG_STS:' || VGM.XTER_MSG_FUNC_CD || CHR(10)
#if (${res_tp_cd} == '1') 
	||'RES_TP_CD:' || 'Approve' || CHR(10)
#else 
	||'RES_TP_CD:' || 'Reject' || CHR(10)
#end
	||'RES_CD:' || @[res_tp_cd] || CHR(10)
	||'ACK_C_DATE:' || TO_CHAR(VGM.CRE_DT,'YYYYMMDDHH24MI') || CHR(10)
	||(	SELECT LISTAGG(
		'{ACK_REF_INFO' || CHR(10)
	|| 		'REF_TP_CD:' || RF.XTER_REF_TP_CD || CHR(10)
	|| 		'REF_NO:'    || RF.REF_NO || CHR(10)
	|| 	'}ACK_REF_INFO' || CHR(10), '') WITHIN GROUP (ORDER BY RF.XTER_REF_SEQ)
		FROM BKG_XTER_VGM_REF_NO RF
		WHERE RF.XTER_SNDR_ID = VGM.XTER_SNDR_ID 
		AND RF.XTER_VGM_DOC_ID = VGM.XTER_VGM_DOC_ID
		AND RF.XTER_VGM_RQST_SEQ = VGM.XTER_VGM_RQST_SEQ
		)
	||(	SELECT LISTAGG (
		'{ACK_CUST_INFO' || CHR(10)
	|| 		'CUST_TP:'       ||  CUST.VGM_CUST_TP_CD || CHR(10)  
	|| 		'CUST_NM:'       ||  REPLACE(CUST.VGM_CUST_NM, CHR(10), ' ') || CHR(10)  
	|| 		'CUST_ADDR:'     ||  REPLACE(CUST.VGM_CUST_ADDR, CHR(10), ' ') || CHR(10)  
	|| 		'CUST_CTY_NM:'   ||  REPLACE(CUST.VGM_CUST_CTY_NM, CHR(10), ' ') || CHR(10)
	|| 		'CUST_STE:'      ||  CHR(10)
	|| 		'CUST_PST_CD:'   ||  CUST.VGM_PST_CD_CTNT || CHR(10)
	|| 		'CUST_CNT_CD:'   ||  CUST.VGM_CUST_CNT_CD || CHR(10)
	|| 		'CUST_CNTC_TP:'  ||  CUST.VGM_CUST_CNTC_TP_CD || CHR(10)
	|| 		'CUST_CNTC_NM:'  ||  REPLACE(CUST.VGM_CUST_CNTC_NM, CHR(10), ' ') || CHR(10)  
	|| 		'CUST_FAX:'      ||  REPLACE(CUST.VGM_CUST_FAX_NO, CHR(10), ' ') || CHR(10)  
	|| 		'CUST_EML:'      ||  REPLACE(CUST.VGM_CUST_EML, CHR(10), ' ') || CHR(10)  
	|| 		'CUST_PHN:'      ||  REPLACE(CUST.VGM_CUST_PHN_NO, CHR(10), ' ') || CHR(10)  
	|| 		'CUST_ML_ADDR:'  ||  REPLACE(CUST.VGM_CUST_PST_ADDR, CHR(10), ' ') || CHR(10)  
	|| '}ACK_CUST_INFO' || CHR(10), '') WITHIN GROUP (ORDER BY CUST.XTER_REF_SEQ)
  	|| '}CNTR_INFO' || CHR(10)  
		FROM BKG_XTER_VGM_CUST CUST
		WHERE CUST.XTER_SNDR_ID = VGM.XTER_SNDR_ID 
		AND CUST.XTER_VGM_DOC_ID = VGM.XTER_VGM_DOC_ID
		AND CUST.XTER_VGM_RQST_SEQ = VGM.XTER_VGM_RQST_SEQ
		) AS FLAT_FILE
FROM BKG_XTER_VGM_RQST VGM
WHERE VGM.EDI_MSG_PROC_ID = @[edi_no]
AND VGM.XTER_VGM_RQST_SEQ = @[rqst_seq]			]]></sql>
			<params>
				<param name="res_tp_cd" type="12" value="" out="N"/>
				<param name="edi_no" type="12" value="" out="N"/>
				<param name="rqst_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
