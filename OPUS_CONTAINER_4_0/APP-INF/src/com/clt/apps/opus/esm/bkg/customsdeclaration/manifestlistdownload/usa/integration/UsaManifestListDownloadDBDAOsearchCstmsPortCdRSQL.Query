<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UsaManifestListDownloadDBDAOsearchCstmsPortCdRSQL">
			<desc><![CDATA[searchCstmsPortCd]]></desc>
			<sql><![CDATA[
SELECT VPS_PORT_CD
  FROM (SELECT VPS_PORT_CD
             , ROW_NUMBER() OVER(ORDER BY CLPT_SEQ) AS RNUM
          FROM (SELECT DISTINCT SKD2.VPS_PORT_CD, SKD2.CLPT_SEQ
                  FROM BKG_VVD VVD
                     , VSK_VSL_PORT_SKD SKD1 -- POL
                     , VSK_VSL_PORT_SKD SKD2 -- CSTMS_PORT_CD
                     , VSK_VSL_PORT_SKD SKD3 -- POD
                 WHERE 1=1
                AND SKD1.VSL_CD = @[vsl_cd]
                AND SKD1.SKD_VOY_NO = @[skd_voy_no]
                AND SKD1.SKD_DIR_CD = @[skd_dir_cd]
                AND SKD1.VPS_PORT_CD = VVD.POL_CD
                AND SKD1.CLPT_IND_SEQ = VVD.POL_CLPT_IND_SEQ
                AND NVL(SKD1.SKD_CNG_STS_CD, 'X') <> 'S'
                AND SKD1.VSL_CD        = SKD2.VSL_CD
                AND SKD1.SKD_VOY_NO    = SKD2.SKD_VOY_NO
                AND SKD1.SKD_DIR_CD    = SKD2.SKD_DIR_CD
                AND SUBSTR(SKD2.VPS_PORT_CD, 1, 2) IN ('US', (SELECT ATTR_CTNT1 FROM BKG_CSTMS_CD_CONV_CTNT WHERE CNT_CD = 'US' AND CSTMS_DIV_ID = 'US_CNT_CD_LIST'))
                AND SKD1.CLPT_SEQ < SKD2.CLPT_SEQ
                AND NVL(SKD2.SKD_CNG_STS_CD, 'X') <> 'S'
                AND SKD1.VSL_CD         = SKD3.VSL_CD
                AND SKD1.SKD_VOY_NO     = SKD3.SKD_VOY_NO
                AND SKD1.SKD_DIR_CD     = SKD3.SKD_DIR_CD
                AND SKD3.VPS_PORT_CD    = VVD.POD_CD
                AND SKD3.CLPT_IND_SEQ   = VVD.POD_CLPT_IND_SEQ
                AND SKD2.CLPT_SEQ  <= SKD3.CLPT_SEQ
                AND NVL(SKD3.SKD_CNG_STS_CD, 'X') <> 'S'
                AND VVD.POL_CD = @[pol_cd]
                AND VVD.POD_CD = @[pod_cd]) SKD
       )
WHERE RNUM = 1			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
