<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="StatusReportDBDAOsearchVgmEdiSupRSQL">
			<desc><![CDATA[Search VGM EDI SUP]]></desc>
			<sql><![CDATA[
SELECT NTC_KND_NM ,
       KIND.NTC_KND_CD ,
       REF_CODE ,
       EDI_RECEIVE_ID ,
       EDI_SND_ID ,
       SENDER ,
       SENDER_NM ,
       SEND_DT ,
       BKG_NTC_SND_RSLT_CD ,
       (SELECT INTG_CD_VAL_DP_DESC
          FROM COM_INTG_CD_DTL
         WHERE 'CD02396' = INTG_CD_ID
           AND INTG_CD_VAL_CTNT = DECODE(MST.BKG_NTC_SND_RSLT_CD, 'A', 3, 'F', 4, 'N', 4, NULL)) AS RESULT
  FROM (SELECT 'VERMAS (A) - CY' NTC_KND_NM,
               'VC' NTC_KND_CD,
               1 ORD
          FROM DUAL
         UNION ALL
SELECT 'VERMAS (A) - POL' NTC_KND_NM,
               'VP' NTC_KND_CD,
               2 ORD
          FROM DUAL
         UNION ALL
SELECT 'VERMAS (A) - T/S' NTC_KND_NM,
               'VT' NTC_KND_CD,
               3 ORD
          FROM DUAL
         UNION ALL
SELECT 'VERMAS (M)' NTC_KND_NM,
               'VM' NTC_KND_CD,
               4 ORD
          FROM DUAL
         UNION ALL
SELECT '301 (A) - CY' NTC_KND_NM,
               '3C' NTC_KND_CD,
               5 ORD
          FROM DUAL
         UNION ALL
SELECT '301 (A) - POL' NTC_KND_NM,
               '3P' NTC_KND_CD,
               6 ORD
          FROM DUAL
         UNION ALL
SELECT '301 (M)' NTC_KND_NM,
               '3M' NTC_KND_CD,
               7 ORD
          FROM DUAL ) KIND ,
       (SELECT NTC_KND_CD ,
               REF_CODE ,
               EDI_RECEIVE_ID ,
               EDI_SND_ID , 
               SENDER ,
               SENDER_NM ,
               SEND_DT ,
               BKG_NTC_SND_RSLT_CD
          FROM (SELECT 'VC' NTC_KND_CD ,
                       NTC.YD_CD REF_CODE ,
                       NTC.EDI_ID EDI_RECEIVE_ID ,
                       NTC.EDI_SND_ID EDI_SND_ID,
                       NTC.SND_USR_ID SENDER ,
                       (SELECT USR.USR_NM
                          FROM COM_USER USR
                         WHERE USR.USR_ID = NTC.SND_USR_ID) SENDER_NM ,
                       TO_CHAR(NTC.SND_RQST_DT, 'YYYY-MM-DD HH24:MI') SEND_DT ,
                       NTC.BKG_NTC_SND_RSLT_CD
                  FROM BKG_BOOKING BK ,
                       (SELECT NTC.BKG_NO ,
                               NTC.SND_USR_ID,
                               NTC.SND_RQST_DT,
                               NTC.BKG_NTC_SND_RSLT_CD ,
                               EDI_YD.EDI_RCV_ID EDI_ID,
                               EDI_YD.YD_CD,
                               EDI_YD.EDI_SND_ID
                          FROM BKG_NTC_HIS NTC ,
                               (SELECT DISTINCT EY.SNDR_TRD_PRNR_ID AS EDI_SND_ID,
                                       EY.RCVR_TRD_PRNR_ID AS EDI_RCV_ID ,
                                       EY.PRNR_PORT_CD AS PORT_CD ,
                                       EY.PRNR_SUB_LNK_CD AS YD_CD ,
                                       BB.BKG_NO
                                  FROM BKG_EDI_TRD_PRNR_SUB_LNK EY,
                                       BKG_EDI_SUB_LNK_MSG MSG,
                                       BKG_BOOKING BB
                                 WHERE BB.BKG_NO = @[bkg_no]
                                   AND EY.TRD_PRNR_SUB_LNK_SEQ = MSG.TRD_PRNR_SUB_LNK_SEQ
                                   AND EY.PRNR_SUB_LNK_DIV_CD = '1'
                                   AND MSG.EDI_MSG_TP_ID = 'VGM'
                                   AND MSG.MSG_TP_DESC = '1'
								   AND MSG.EDI_MSG_IND_CD = 31
                                   AND (EY.PRNR_SUB_LNK_CD = BB.POR_NOD_CD
                                            OR EY.PRNR_SUB_LNK_CD = BB.FULL_RTN_YD_CD
                                            OR EY.PRNR_SUB_LNK_CD = BB.MTY_RTN_YD_CD ) ) EDI_YD
                         WHERE 'E' = NTC.NTC_VIA_CD(+)
                           AND 'VC' = NTC.NTC_KND_CD(+)
                           AND EDI_YD.BKG_NO = NTC.BKG_NO(+)
                           AND EDI_YD.EDI_RCV_ID = NTC.EDI_ID(+)
                           AND NVL(NTC.HIS_SEQ, 1) = NVL2(NTC.HIS_SEQ, (SELECT MAX(HIS_SEQ)
                                          FROM BKG_NTC_HIS
                                         WHERE BKG_NO = NTC.BKG_NO
                                           AND NTC_VIA_CD = NTC.NTC_VIA_CD
                                           AND NTC_KND_CD = NTC.NTC_KND_CD
                                           AND EDI_ID = NTC.EDI_ID
                                           AND NVL(ESVC_GRP_CD, 1) = NVL(NTC.ESVC_GRP_CD, 1) ), 1)) NTC
                 WHERE NTC.BKG_NO = BK.BKG_NO(+)
                 GROUP BY YD_CD ,
                       EDI_ID ,
                       SND_USR_ID ,
                       NTC.SND_RQST_DT ,
                       NTC.BKG_NTC_SND_RSLT_CD ,
                       NTC.EDI_SND_ID)
         UNION ALL
SELECT NTC_KND_CD ,
               REF_CODE ,
               EDI_RECEIVE_ID ,
               EDI_SND_ID,
               SENDER ,
               SENDER_NM ,
               SEND_DT ,
               BKG_NTC_SND_RSLT_CD
          FROM (SELECT 'VP' NTC_KND_CD ,
                       NTC.YD_CD REF_CODE ,
                       NTC.EDI_ID EDI_RECEIVE_ID ,
                       NTC.EDI_SND_ID EDI_SND_ID ,
                       NTC.SND_USR_ID SENDER ,
                       (SELECT USR.USR_NM
                          FROM COM_USER USR
                         WHERE USR.USR_ID = NTC.SND_USR_ID) SENDER_NM ,
                       TO_CHAR(NTC.SND_RQST_DT, 'YYYY-MM-DD HH24:MI') SEND_DT ,
                       NTC.BKG_NTC_SND_RSLT_CD
                  FROM BKG_BOOKING BK ,
                       (SELECT NTC.BKG_NO ,
                               NTC.SND_USR_ID,
                               NTC.SND_RQST_DT,
                               NTC.BKG_NTC_SND_RSLT_CD ,
                               EDI_YD.EDI_RCV_ID EDI_ID,
                               EDI_YD.YD_CD,
                               EDI_YD.EDI_SND_ID EDI_SND_ID
                          FROM BKG_NTC_HIS NTC ,
                               (SELECT DISTINCT EY.SNDR_TRD_PRNR_ID AS EDI_SND_ID,
                                       EY.RCVR_TRD_PRNR_ID AS EDI_RCV_ID ,
                                       EY.PRNR_PORT_CD AS PORT_CD ,
                                       EY.PRNR_SUB_LNK_CD AS YD_CD ,
                                       BB.BKG_NO
                                  FROM BKG_EDI_TRD_PRNR_SUB_LNK EY,
                                       BKG_EDI_SUB_LNK_MSG MSG,
                                       BKG_BOOKING BB
                                 WHERE BB.BKG_NO = @[bkg_no]
                                   AND EY.TRD_PRNR_SUB_LNK_SEQ = MSG.TRD_PRNR_SUB_LNK_SEQ
                                   AND EY.PRNR_SUB_LNK_DIV_CD = '1'
                                   AND MSG.EDI_MSG_TP_ID = 'VGM'
                                   AND MSG.MSG_TP_DESC = '1'
								   AND MSG.EDI_MSG_IND_CD = 32
                                   AND EY.PRNR_SUB_LNK_CD = BB.POL_NOD_CD ) EDI_YD
                         WHERE 'E' = NTC.NTC_VIA_CD(+)
                           AND 'VP' = NTC.NTC_KND_CD(+)
                           AND EDI_YD.BKG_NO = NTC.BKG_NO(+)
                           AND EDI_YD.EDI_RCV_ID = NTC.EDI_ID(+)
                           AND NVL(NTC.HIS_SEQ, 1) = NVL2(NTC.HIS_SEQ, (SELECT MAX(HIS_SEQ)
                                          FROM BKG_NTC_HIS
                                         WHERE BKG_NO = NTC.BKG_NO
                                           AND NTC_VIA_CD = NTC.NTC_VIA_CD
                                           AND NTC_KND_CD = NTC.NTC_KND_CD
                                           AND EDI_ID = NTC.EDI_ID
                                           AND NVL(ESVC_GRP_CD, 1) = NVL(NTC.ESVC_GRP_CD, 1) ), 1)) NTC
                 WHERE NTC.BKG_NO = BK.BKG_NO(+)
                 GROUP BY YD_CD ,
                       EDI_ID ,
                       SND_USR_ID ,
                       NTC.SND_RQST_DT ,
                       NTC.BKG_NTC_SND_RSLT_CD ,
                       NTC.EDI_SND_ID)
         UNION ALL
SELECT NTC_KND_CD ,
               REF_CODE ,
               EDI_RECEIVE_ID ,
               EDI_SND_ID , 
               SENDER ,
               SENDER_NM ,
               SEND_DT ,
               BKG_NTC_SND_RSLT_CD
          FROM (SELECT 'VT' NTC_KND_CD ,
                       NTC.YD_CD REF_CODE ,
                       NTC.EDI_ID EDI_RECEIVE_ID ,
                       NTC.EDI_SND_ID EDI_SND_ID ,
                       NTC.SND_USR_ID SENDER ,
                       (SELECT USR.USR_NM
                          FROM COM_USER USR
                         WHERE USR.USR_ID = NTC.SND_USR_ID) SENDER_NM ,
                       TO_CHAR(NTC.SND_RQST_DT, 'YYYY-MM-DD HH24:MI') SEND_DT ,
                       NTC.BKG_NTC_SND_RSLT_CD
                  FROM BKG_BOOKING BK ,
                       (SELECT NTC.BKG_NO ,
                               NTC.SND_USR_ID,
                               NTC.SND_RQST_DT,
                               NTC.BKG_NTC_SND_RSLT_CD ,
                               EDI_YD.EDI_RCV_ID EDI_ID,
                               EDI_YD.YD_CD,
                               EDI_YD.EDI_SND_ID EDI_SND_ID
                          FROM BKG_NTC_HIS NTC ,
                               (SELECT DISTINCT EY.SNDR_TRD_PRNR_ID AS EDI_SND_ID,
                                       EY.RCVR_TRD_PRNR_ID AS EDI_RCV_ID ,
                                       EY.PRNR_PORT_CD AS PORT_CD ,
                                       EY.PRNR_SUB_LNK_CD AS YD_CD ,
                                       BB.BKG_NO
                                  FROM BKG_EDI_TRD_PRNR_SUB_LNK EY,
                                       BKG_EDI_SUB_LNK_MSG MSG,
                                       BKG_BOOKING BB
                                 WHERE BB.BKG_NO = @[bkg_no]
                                   AND EY.TRD_PRNR_SUB_LNK_SEQ = MSG.TRD_PRNR_SUB_LNK_SEQ
                                   AND EY.PRNR_SUB_LNK_DIV_CD = '1'
                                   AND MSG.EDI_MSG_TP_ID = 'VGM'
                                   AND MSG.MSG_TP_DESC = '1'
								   AND MSG.EDI_MSG_IND_CD = 33
                                              AND EXISTS (SELECT 'Y' FROM BKG_VVD WHERE BB.BKG_NO = BKG_NO AND EY.PRNR_SUB_LNK_CD = POL_YD_CD AND BB.POL_NOD_CD <> POL_YD_CD)
                                              ) EDI_YD
                         WHERE 'E' = NTC.NTC_VIA_CD(+)
                           AND 'VT' = NTC.NTC_KND_CD(+)
                           AND EDI_YD.BKG_NO = NTC.BKG_NO(+)
                           AND EDI_YD.EDI_RCV_ID = NTC.EDI_ID(+)
                           AND NVL(NTC.HIS_SEQ, 1) = NVL2(NTC.HIS_SEQ, (SELECT MAX(HIS_SEQ)
                                          FROM BKG_NTC_HIS
                                         WHERE BKG_NO = NTC.BKG_NO
                                           AND NTC_VIA_CD = NTC.NTC_VIA_CD
                                           AND NTC_KND_CD = NTC.NTC_KND_CD
                                           AND EDI_ID = NTC.EDI_ID
                                           AND NVL(ESVC_GRP_CD, 1) = NVL(NTC.ESVC_GRP_CD, 1) ), 1)) NTC
                 WHERE NTC.BKG_NO = BK.BKG_NO(+)
                 GROUP BY YD_CD ,
                       EDI_ID ,
                       SND_USR_ID ,
                       NTC.SND_RQST_DT ,
                       NTC.BKG_NTC_SND_RSLT_CD ,
                       NTC.EDI_SND_ID)
         UNION ALL
SELECT NTC_KND_CD ,
               REF_CODE ,
               EDI_RECEIVE_ID ,
               EDI_SND_ID ,
               SENDER ,
               SENDER_NM ,
               SEND_DT ,
               BKG_NTC_SND_RSLT_CD
          FROM (SELECT 'VM' NTC_KND_CD ,
                       NTC.YD_CD REF_CODE ,
                       NTC.EDI_ID EDI_RECEIVE_ID ,
                       NTC.EDI_SND_ID EDI_SND_ID , 
                       NTC.SND_USR_ID SENDER ,
                       (SELECT USR.USR_NM
                          FROM COM_USER USR
                         WHERE USR.USR_ID = NTC.SND_USR_ID) SENDER_NM ,
                       TO_CHAR(NTC.SND_RQST_DT, 'YYYY-MM-DD HH24:MI') SEND_DT ,
                       NTC.BKG_NTC_SND_RSLT_CD
                  FROM BKG_BOOKING BK ,
                       (SELECT NTC.BKG_NO ,
                               NTC.SND_USR_ID,
                               NTC.SND_RQST_DT,
                               NTC.BKG_NTC_SND_RSLT_CD ,
                               EDI_YD.EDI_RCV_ID EDI_ID,
                               EDI_YD.YD_CD,
                               EDI_YD.EDI_SND_ID EDI_SND_ID
                          FROM BKG_NTC_HIS NTC ,
                               (SELECT DISTINCT EY.SNDR_TRD_PRNR_ID AS EDI_SND_ID,
                                       EY.RCVR_TRD_PRNR_ID AS EDI_RCV_ID ,
                                       EY.PRNR_PORT_CD AS PORT_CD ,
                                       EY.PRNR_SUB_LNK_CD AS YD_CD ,
                                       BB.BKG_NO
                                  FROM BKG_EDI_TRD_PRNR_SUB_LNK EY,
                                       BKG_EDI_SUB_LNK_MSG MSG,
                                       BKG_BOOKING BB
                                 WHERE BB.BKG_NO = @[bkg_no]
                                   AND EY.TRD_PRNR_SUB_LNK_SEQ = MSG.TRD_PRNR_SUB_LNK_SEQ
                                   AND EY.PRNR_SUB_LNK_DIV_CD = '1'
                                   AND MSG.EDI_MSG_TP_ID = 'VGM'
                                   AND MSG.MSG_TP_DESC = '1'
								   AND MSG.EDI_MSG_IND_CD = 34
                                       ) EDI_YD
                         WHERE 'E' = NTC.NTC_VIA_CD(+)
                           AND 'VM' = NTC.NTC_KND_CD(+)
                           AND EDI_YD.BKG_NO = NTC.BKG_NO(+)
                           AND EDI_YD.EDI_RCV_ID = NTC.EDI_ID(+)
                           AND NVL(NTC.HIS_SEQ, 1) = NVL2(NTC.HIS_SEQ, (SELECT MAX(HIS_SEQ)
                                          FROM BKG_NTC_HIS
                                         WHERE BKG_NO = NTC.BKG_NO
                                           AND NTC_VIA_CD = NTC.NTC_VIA_CD
                                           AND NTC_KND_CD = NTC.NTC_KND_CD
                                           AND EDI_ID = NTC.EDI_ID
                                           AND NVL(ESVC_GRP_CD, 1) = NVL(NTC.ESVC_GRP_CD, 1) ), 1)) NTC
                 WHERE NTC.BKG_NO = BK.BKG_NO(+)
                 GROUP BY YD_CD ,
                       EDI_ID ,
                       SND_USR_ID ,
                       NTC.SND_RQST_DT ,
                       NTC.BKG_NTC_SND_RSLT_CD ,
                       NTC.EDI_SND_ID)
         UNION ALL
SELECT NTC_KND_CD ,
               REF_CODE ,
               EDI_RECEIVE_ID ,
               EDI_SND_ID ,
               SENDER ,
               SENDER_NM ,
               SEND_DT ,
               BKG_NTC_SND_RSLT_CD
          FROM (SELECT '3C' NTC_KND_CD ,
                       NTC.YD_CD REF_CODE ,
                       NTC.EDI_ID EDI_RECEIVE_ID ,
                       NTC.EDI_SND_ID EDI_SND_ID , 
                       NTC.SND_USR_ID SENDER ,
                       (SELECT USR.USR_NM
                          FROM COM_USER USR
                         WHERE USR.USR_ID = NTC.SND_USR_ID) SENDER_NM ,
                       TO_CHAR(NTC.SND_RQST_DT, 'YYYY-MM-DD HH24:MI') SEND_DT ,
                       NTC.BKG_NTC_SND_RSLT_CD
                  FROM BKG_BOOKING BK ,
                       (SELECT NTC.BKG_NO ,
                               NTC.SND_USR_ID,
                               NTC.SND_RQST_DT,
                               NTC.BKG_NTC_SND_RSLT_CD ,
                               EDI_YD.EDI_RCV_ID EDI_ID,
                               EDI_YD.YD_CD,
                               EDI_YD.EDI_SND_ID
                          FROM BKG_NTC_HIS NTC ,
                               (SELECT DISTINCT EY.SNDR_TRD_PRNR_ID AS EDI_SND_ID,
                                       EY.RCVR_TRD_PRNR_ID AS EDI_RCV_ID ,
                                       EY.PRNR_PORT_CD AS PORT_CD ,
                                       EY.PRNR_SUB_LNK_CD AS YD_CD ,
                                       BB.BKG_NO
                                  FROM BKG_EDI_TRD_PRNR_SUB_LNK EY,
                                       BKG_EDI_SUB_LNK_MSG MSG,
                                       BKG_BOOKING BB
                                 WHERE BB.BKG_NO = @[bkg_no]
                                   AND EY.TRD_PRNR_SUB_LNK_SEQ = MSG.TRD_PRNR_SUB_LNK_SEQ
                                   AND EY.PRNR_SUB_LNK_DIV_CD = '1'
                                   AND MSG.EDI_MSG_TP_ID = 'VGM'
                                   AND MSG.MSG_TP_DESC = '1'
								   AND MSG.EDI_MSG_IND_CD = 35
                                   AND (EY.PRNR_SUB_LNK_CD = BB.POR_NOD_CD
                                            OR EY.PRNR_SUB_LNK_CD = BB.FULL_RTN_YD_CD
                                            OR EY.PRNR_SUB_LNK_CD = BB.MTY_RTN_YD_CD ) ) EDI_YD
                         WHERE 'E' = NTC.NTC_VIA_CD(+)
                           AND '3C' = NTC.NTC_KND_CD(+)
                           AND EDI_YD.BKG_NO = NTC.BKG_NO(+)
                           AND EDI_YD.EDI_RCV_ID = NTC.EDI_ID(+)
                           AND NVL(NTC.HIS_SEQ, 1) = NVL2(NTC.HIS_SEQ, (SELECT MAX(HIS_SEQ)
                                          FROM BKG_NTC_HIS
                                         WHERE BKG_NO = NTC.BKG_NO
                                           AND NTC_VIA_CD = NTC.NTC_VIA_CD
                                           AND NTC_KND_CD = NTC.NTC_KND_CD
                                           AND EDI_ID = NTC.EDI_ID
                                           AND NVL(ESVC_GRP_CD, 1) = NVL(NTC.ESVC_GRP_CD, 1) ), 1)) NTC
                 WHERE NTC.BKG_NO = BK.BKG_NO(+)
                 GROUP BY YD_CD ,
                       EDI_ID ,
                       SND_USR_ID ,
                       NTC.SND_RQST_DT ,
                       NTC.BKG_NTC_SND_RSLT_CD ,
                       NTC.EDI_SND_ID)
         UNION ALL
SELECT NTC_KND_CD ,
               REF_CODE ,
               EDI_RECEIVE_ID ,
               EDI_SND_ID ,
               SENDER ,
               SENDER_NM ,
               SEND_DT ,
               BKG_NTC_SND_RSLT_CD
          FROM (SELECT '3P' NTC_KND_CD ,
                       NTC.YD_CD REF_CODE ,
                       NTC.EDI_ID EDI_RECEIVE_ID ,
                       NTC.EDI_SND_ID EDI_SND_ID , 
                       NTC.SND_USR_ID SENDER ,
                       (SELECT USR.USR_NM
                          FROM COM_USER USR
                         WHERE USR.USR_ID = NTC.SND_USR_ID) SENDER_NM ,
                       TO_CHAR(NTC.SND_RQST_DT, 'YYYY-MM-DD HH24:MI') SEND_DT ,
                       NTC.BKG_NTC_SND_RSLT_CD
                  FROM BKG_BOOKING BK ,
                       (SELECT NTC.BKG_NO ,
                               NTC.SND_USR_ID,
                               NTC.SND_RQST_DT,
                               NTC.BKG_NTC_SND_RSLT_CD ,
                               EDI_YD.EDI_RCV_ID EDI_ID,
                               EDI_YD.YD_CD,
                               EDI_YD.EDI_SND_ID EDI_SND_ID
                          FROM BKG_NTC_HIS NTC ,
                               (SELECT DISTINCT EY.SNDR_TRD_PRNR_ID AS EDI_SND_ID,
                                       EY.RCVR_TRD_PRNR_ID AS EDI_RCV_ID ,
                                       EY.PRNR_PORT_CD AS PORT_CD ,
                                       EY.PRNR_SUB_LNK_CD AS YD_CD ,
                                       BB.BKG_NO
                                  FROM BKG_EDI_TRD_PRNR_SUB_LNK EY,
                                       BKG_EDI_SUB_LNK_MSG MSG,
                                       BKG_BOOKING BB
                                 WHERE BB.BKG_NO = @[bkg_no]
                                   AND EY.TRD_PRNR_SUB_LNK_SEQ = MSG.TRD_PRNR_SUB_LNK_SEQ
                                   AND EY.PRNR_SUB_LNK_DIV_CD = '1'
                                   AND MSG.EDI_MSG_TP_ID = 'VGM'
                                   AND MSG.MSG_TP_DESC = '1'
								   AND MSG.EDI_MSG_IND_CD = 36
                                   AND EY.PRNR_SUB_LNK_CD = BB.POL_NOD_CD ) EDI_YD
                         WHERE 'E' = NTC.NTC_VIA_CD(+)
                           AND '3P' = NTC.NTC_KND_CD(+)
                           AND EDI_YD.BKG_NO = NTC.BKG_NO(+)
                           AND EDI_YD.EDI_RCV_ID = NTC.EDI_ID(+)
                           AND NVL(NTC.HIS_SEQ, 1) = NVL2(NTC.HIS_SEQ, (SELECT MAX(HIS_SEQ)
                                          FROM BKG_NTC_HIS
                                         WHERE BKG_NO = NTC.BKG_NO
                                           AND NTC_VIA_CD = NTC.NTC_VIA_CD
                                           AND NTC_KND_CD = NTC.NTC_KND_CD
                                           AND EDI_ID = NTC.EDI_ID
                                           AND NVL(ESVC_GRP_CD, 1) = NVL(NTC.ESVC_GRP_CD, 1) ), 1)) NTC
                 WHERE NTC.BKG_NO = BK.BKG_NO(+)
                 GROUP BY YD_CD ,
                       EDI_ID ,
                       SND_USR_ID ,
                       NTC.SND_RQST_DT ,
                       NTC.BKG_NTC_SND_RSLT_CD ,
                       NTC.EDI_SND_ID)
         UNION ALL
SELECT NTC_KND_CD ,
               REF_CODE ,
               EDI_RECEIVE_ID ,
               EDI_SND_ID ,
               SENDER ,
               SENDER_NM ,
               SEND_DT ,
               BKG_NTC_SND_RSLT_CD
          FROM (SELECT '3M' NTC_KND_CD ,
                       NTC.YD_CD REF_CODE ,
                       NTC.EDI_ID EDI_RECEIVE_ID ,
                       NTC.EDI_SND_ID EDI_SND_ID ,
                       NTC.SND_USR_ID SENDER ,
                       (SELECT USR.USR_NM
                          FROM COM_USER USR
                         WHERE USR.USR_ID = NTC.SND_USR_ID) SENDER_NM ,
                       TO_CHAR(NTC.SND_RQST_DT, 'YYYY-MM-DD HH24:MI') SEND_DT ,
                       NTC.BKG_NTC_SND_RSLT_CD
                  FROM BKG_BOOKING BK ,
                       (SELECT NTC.BKG_NO ,
                               NTC.SND_USR_ID,
                               NTC.SND_RQST_DT,
                               NTC.BKG_NTC_SND_RSLT_CD ,
                               EDI_YD.EDI_RCV_ID EDI_ID,
                               EDI_YD.YD_CD,
                               EDI_YD.EDI_SND_ID EDI_SND_ID
                          FROM BKG_NTC_HIS NTC ,
                               (SELECT DISTINCT EY.SNDR_TRD_PRNR_ID AS EDI_SND_ID,
                                       EY.RCVR_TRD_PRNR_ID AS EDI_RCV_ID ,
                                       EY.PRNR_PORT_CD AS PORT_CD ,
                                       EY.PRNR_SUB_LNK_CD AS YD_CD ,
                                       BB.BKG_NO
                                  FROM BKG_EDI_TRD_PRNR_SUB_LNK EY,
                                       BKG_EDI_SUB_LNK_MSG MSG,
                                       BKG_BOOKING BB
                                 WHERE BB.BKG_NO = @[bkg_no]
                                   AND EY.TRD_PRNR_SUB_LNK_SEQ = MSG.TRD_PRNR_SUB_LNK_SEQ
                                   AND EY.PRNR_SUB_LNK_DIV_CD = '1'
                                   AND MSG.EDI_MSG_TP_ID = 'VGM'
                                   AND MSG.MSG_TP_DESC = '1'
								   AND MSG.EDI_MSG_IND_CD = 37
                                       ) EDI_YD
                         WHERE 'E' = NTC.NTC_VIA_CD(+)
                           AND '3M' = NTC.NTC_KND_CD(+)
                           AND EDI_YD.BKG_NO = NTC.BKG_NO(+)
                           AND EDI_YD.EDI_RCV_ID = NTC.EDI_ID(+)
                           AND NVL(NTC.HIS_SEQ, 1) = NVL2(NTC.HIS_SEQ, (SELECT MAX(HIS_SEQ)
                                          FROM BKG_NTC_HIS
                                         WHERE BKG_NO = NTC.BKG_NO
                                           AND NTC_VIA_CD = NTC.NTC_VIA_CD
                                           AND NTC_KND_CD = NTC.NTC_KND_CD
                                           AND EDI_ID = NTC.EDI_ID
                                           AND NVL(ESVC_GRP_CD, 1) = NVL(NTC.ESVC_GRP_CD, 1) ), 1)) NTC
                 WHERE NTC.BKG_NO = BK.BKG_NO(+)
                 GROUP BY YD_CD ,
                       EDI_ID ,
                       SND_USR_ID ,
                       NTC.SND_RQST_DT ,
                       NTC.BKG_NTC_SND_RSLT_CD ,
                       NTC.EDI_SND_ID) ) MST
 WHERE KIND.NTC_KND_CD = MST.NTC_KND_CD(+)
#if( ${in_yd_cd} != '')
   AND REF_CODE LIKE '%'||@[in_yd_cd]||'%'
#end
#if( ${in_rcvr_id} != '')
   AND EDI_RECEIVE_ID LIKE '%'||@[in_rcvr_id]||'%'
#end
#if( ${in_sndr_id} != '')
   AND EDI_SND_ID LIKE '%'||@[in_sndr_id]||'%'
#end
 ORDER BY ORD,
       DECODE(NTC_KND_CD, 'VC', 1, 'VP', 2, 'VT', 3, 'VM', 4, '3C', 5, '3P', 6, '3M', 7),
       EDI_RECEIVE_ID			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="in_yd_cd" type="12" value="" out="N"/>
				<param name="in_rcvr_id" type="12" value="" out="N"/>
				<param name="in_sndr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
