<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OPMasterDBDAOMultiHistoryLaneTpHisFlgUSQL">
			<desc><![CDATA[COA_LANE_RGST - LANE_TP_HIS_FLG update]]></desc>
			<sql><![CDATA[
MERGE INTO COA_LANE_RGST A
USING(
      SELECT TRD_CD, RLANE_CD, DIR_CD, IOC_CD, LANE_SEQ, VSL_LANE_TP_CD, STUP_FLG, 
             DECODE(COUNT(*) OVER (), 0, 'N', 'Y') AS LANE_TP_HIS_FLG
        FROM COA_LANE_TP_HIS
       WHERE TRD_CD   = @[trd_cd]
         AND RLANE_CD = @[rlane_cd]
         AND DIR_CD   = @[dir_cd]
         AND IOC_CD   = @[ioc_cd]
         AND LANE_APLY_FM_DT||LANE_SEQ = (SELECT MAX(LANE_APLY_FM_DT||LANE_SEQ) 	--SEQ가 최근이 아닐수도 있으나...기준상..
                                            FROM COA_LANE_TP_HIS
                                           WHERE TRD_CD   = @[trd_cd]
                                             AND RLANE_CD = @[rlane_cd]
                                             AND DIR_CD   = @[dir_cd]
                                             AND IOC_CD   = @[ioc_cd])
      ) B
ON (  A.TRD_CD = B.TRD_CD
  AND A.RLANE_CD = B.RLANE_CD
  AND A.DIR_CD = B.DIR_CD
  AND A.IOC_CD = B.IOC_CD)
 WHEN MATCHED THEN UPDATE 
  SET VSL_LANE_TP_CD  = B.VSL_LANE_TP_CD
     ,STUP_FLG        = B.STUP_FLG
     ,LANE_TP_HIS_FLG = B.LANE_TP_HIS_FLG
     ,UPD_USR_ID      = @[upd_usr_id]
     ,UPD_DT          = SYSDATE			]]></sql>
			<params>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
				<param name="ioc_cd" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
