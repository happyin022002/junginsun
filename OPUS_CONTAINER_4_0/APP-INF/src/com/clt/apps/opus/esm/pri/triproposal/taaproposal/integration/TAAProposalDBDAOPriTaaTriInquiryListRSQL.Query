<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TAAProposalDBDAOPriTaaTriInquiryListRSQL">
			<desc><![CDATA[TAA Inquiry List 조회]]></desc>
			<sql><![CDATA[
SELECT B1.TAA_NO
     , A1.TRI_PROP_NO
     , B1.SVC_SCP_CD
     , B1.RESPB_SLS_OFC_CD
     , B1.CTRT_CUST_SEQ
     , B1.CTRT_CUST_NM
     , B1.RESPB_SREP_CD
     , B1.RESPB_SREP_NM
     , B1.EFF_DT
     , B1.EXP_DT
  FROM (
        SELECT A.TRI_PROP_NO
             , B.EFF_DT
             , B.EXP_DT
             , B.AMDT_SEQ
          FROM (SELECT TRI_PROP_NO
                  FROM PRI_TRI_MN
                 WHERE TRI_NO = REPLACE(@[tri_no],'-','')
                   AND TRF_PFX_CD = @[trf_pfx_cd]
                   AND TRF_NO = @[trf_no]) A
             , (SELECT TRI_PROP_NO
                     , TO_CHAR(EFF_DT, 'YYYYMMDD') AS EFF_DT
                     , TO_CHAR(EXP_DT, 'YYYYMMDD') AS EXP_DT
                     , AMDT_SEQ
                  FROM PRI_TRI_RT A
                 WHERE PROP_STS_CD = 'F'
				 AND   AMDT_SEQ = (SELECT MAX(AMDT_SEQ) FROM PRI_TRI_RT 
								   WHERE A.TRI_PROP_NO = TRI_PROP_NO 
								   AND PROP_STS_CD='F')
				) B
         WHERE A.TRI_PROP_NO = B.TRI_PROP_NO
       ) A1
     , (
        SELECT D.TRI_PROP_NO
             , A.TAA_NO
             , B.SVC_SCP_CD
             , B.RESPB_SLS_OFC_CD
             , B.CTRT_CUST_CNT_CD || LPAD(B.CTRT_CUST_SEQ, 6, '0') AS CTRT_CUST_SEQ
             , (SELECT CUST_LGL_ENG_NM 
                  FROM MDM_CUSTOMER 
                 WHERE CUST_CNT_CD = CTRT_CUST_CNT_CD 
                   AND CUST_SEQ = CTRT_CUST_SEQ
                   AND DELT_FLG = 'N') AS CTRT_CUST_NM
             , B.RESPB_SREP_CD
             , (SELECT SREP_NM 
                  FROM MDM_SLS_REP 
                 WHERE SREP_CD = RESPB_SREP_CD) AS RESPB_SREP_NM
             , TO_CHAR(B.EFF_DT, 'YYYYMMDD') AS EFF_DT
             , TO_CHAR(B.EXP_DT, 'YYYYMMDD') AS EXP_DT    
             , B.AMDT_SEQ
          FROM PRI_TAA_HDR A
             , PRI_TAA_MN B
             , (SELECT TAA_PROP_NO
                     , MAX(AMDT_SEQ) AS AMDT_SEQ
                  FROM PRI_TAA_MN
                 WHERE CFM_FLG = 'Y'
                GROUP BY TAA_PROP_NO) C
             , PRI_TAA_TRI_LIST D
         WHERE A.TAA_PROP_NO = B.TAA_PROP_NO
           AND B.TAA_PROP_NO = C.TAA_PROP_NO
           AND B.AMDT_SEQ = C.AMDT_SEQ
           AND B.TAA_PROP_NO = D.TAA_PROP_NO
           AND B.AMDT_SEQ = D.AMDT_SEQ
        ORDER BY TRI_PROP_NO
      ) B1
 WHERE A1.TRI_PROP_NO = B1.TRI_PROP_NO
 AND (B1.EXP_DT >= A1.EFF_DT AND B1.EFF_DT <= A1.EXP_DT )
ORDER BY B1.TAA_NO			]]></sql>
			<params>
				<param name="tri_no" type="12" value="" out="N"/>
				<param name="trf_pfx_cd" type="12" value="" out="N"/>
				<param name="trf_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
