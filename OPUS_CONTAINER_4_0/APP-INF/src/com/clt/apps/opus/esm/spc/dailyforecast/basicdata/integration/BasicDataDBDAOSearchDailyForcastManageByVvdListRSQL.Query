<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BasicDataDBDAOSearchDailyForcastManageByVvdListRSQL">
			<desc><![CDATA[불규칙한 Lane-Ofc-POL 정보]]></desc>
			<sql><![CDATA[
  SELECT REP_TRD_CD    ,
         REP_SUB_TRD_CD,
         RLANE_CD      ,
         DIR_CD        ,
         DECODE(IOC_TS_CD, 'O', 'OCN', 'I', 'IPC', 'T', 'T/S') AS IOC_TS_CD,
         VSL_CD||SKD_VOY_NO||SKD_DIR_CD AS VVD      ,
         SUBSTR(SLS_YRMON, 1, 4)        AS SLS_YRMON,
         COST_WK   ,
         SLS_AQ_CD ,
         SLS_OFC_CD,
         MAX(DECODE(SEQ,  1, POL_CD)) AS POL_CD1 ,
         MAX(DECODE(SEQ,  2, POL_CD)) AS POL_CD2 ,
         MAX(DECODE(SEQ,  3, POL_CD)) AS POL_CD3 ,
         MAX(DECODE(SEQ,  4, POL_CD)) AS POL_CD4 ,
         MAX(DECODE(SEQ,  5, POL_CD)) AS POL_CD5 ,
         MAX(DECODE(SEQ,  6, POL_CD)) AS POL_CD6 ,
         MAX(DECODE(SEQ,  7, POL_CD)) AS POL_CD7 ,
         MAX(DECODE(SEQ,  8, POL_CD)) AS POL_CD8 ,
         MAX(DECODE(SEQ,  9, POL_CD)) AS POL_CD9 ,
         MAX(DECODE(SEQ, 10, POL_CD)) AS POL_CD10
    FROM (
            SELECT A.REP_TRD_CD     AS REP_TRD_CD    ,
                   A.REP_SUB_TRD_CD AS REP_SUB_TRD_CD,
                   A.RLANE_CD       AS RLANE_CD      ,
                   A.DIR_CD         AS DIR_CD        ,
                   A.IOC_TS_CD      AS IOC_TS_CD     ,
                   A.VSL_CD         AS VSL_CD        ,
                   A.SKD_VOY_NO     AS SKD_VOY_NO    ,
                   A.SKD_DIR_CD     AS SKD_DIR_CD    ,
                   A.SLS_OFC_CD     AS SLS_OFC_CD    ,
                   A.POL_CD         AS POL_CD        ,
                   A.SLS_AQ_CD      AS SLS_AQ_CD     ,
                   B.SLS_YRMON      AS SLS_YRMON     ,
                   B.COST_WK        AS COST_WK       ,
                   ROW_NUMBER() OVER ( PARTITION BY A.REP_TRD_CD, A.REP_SUB_TRD_CD, A.RLANE_CD, A.DIR_CD, A.IOC_TS_CD, A.VSL_CD, A.SKD_VOY_NO, A.SKD_DIR_CD, A.SLS_OFC_CD, B.COST_WK
                                           ORDER BY A.REP_TRD_CD, A.REP_SUB_TRD_CD, A.RLANE_CD, A.DIR_CD, IOC_TS_CD, A.VSL_CD, A.SKD_VOY_NO, A.SKD_DIR_CD, A.SLS_OFC_CD, A.CD_DP_SEQ, A.SLS_AQ_CD, B.SLS_YRMON, B.COST_WK ) AS SEQ
              FROM SPC_IRR_FCAST_OFC_POL_MAPG A,
                   COA_MON_VVD                B
#if (${vvd} != '')
             WHERE A.VSL_CD     = SUBSTR(@[vvd], 1, 4)
               AND A.SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
               AND A.SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
#else 
             WHERE A.REP_TRD_CD = @[trade]
               AND A.SLS_RHQ_CD = @[rhq]
      #if (${subtrade} != '') 
               AND A.REP_SUB_TRD_CD = @[subtrade]
      #end
      #if (${lane} != '') 
               AND A.RLANE_CD = @[lane]
      #end
      #if (${bound} != '') 
               AND A.DIR_CD = @[bound]
      #end
      #if (${ocnipc} != '') 
               AND A.IOC_TS_CD = SUBSTR(@[ocnipc], 1, 1)
      #end
#end
               AND A.RLANE_CD   = B.RLANE_CD   (+)
               AND A.TRD_CD     = B.TRD_CD     (+)
               AND A.SUB_TRD_CD = B.SUB_TRD_CD (+)
               AND A.VSL_CD     = B.VSL_CD     (+)
               AND A.SKD_VOY_NO = B.SKD_VOY_NO (+)
               AND A.SKD_DIR_CD = B.DIR_CD     (+)
         )
GROUP BY rep_trd_cd    ,
         rep_sub_trd_cd,
         rlane_cd      ,
         dir_cd        ,
         ioc_ts_cd     ,
         vsl_cd        ,
         skd_voy_no    ,
         skd_dir_cd    ,
         sls_ofc_cd    ,
         sls_aq_cd     ,
         sls_yrmon     ,
         cost_wk
ORDER BY rep_trd_cd    ,
         rep_sub_trd_cd,
         rlane_cd      ,
         dir_cd        ,
         ioc_ts_cd     ,
         vsl_cd        ,
         skd_voy_no    ,
         skd_dir_cd    ,
         sls_yrmon     ,
         cost_wk       ,
         sls_aq_cd     ,
         sls_ofc_cd			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="trade" type="12" value="" out="N"/>
				<param name="rhq" type="12" value="" out="N"/>
				<param name="subtrade" type="12" value="" out="N"/>
				<param name="lane" type="12" value="" out="N"/>
				<param name="bound" type="12" value="" out="N"/>
				<param name="ocnipc" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
