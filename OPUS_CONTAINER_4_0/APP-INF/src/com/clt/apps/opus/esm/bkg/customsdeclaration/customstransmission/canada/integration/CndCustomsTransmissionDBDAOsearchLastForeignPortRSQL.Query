<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CndCustomsTransmissionDBDAOsearchLastForeignPortRSQL">
			<desc><![CDATA[transmit. BayPlanCntrDetailVO]]></desc>
			<sql><![CDATA[
SELECT     XX.VPS_PORT_CD
          ,XX.CLPT_IND_SEQ
		  ,XX.LASTPOL
		  ,XX.LPOL_CLPT_IND_SEQ
          ,LASTPOL||' '||LPOL_CLPT_IND_SEQ AS TMP1
FROM      (
          ------------------------------------------------------------
          SELECT    PS.VSL_CD
                 ,  PS.SKD_VOY_NO
                 ,  PS.SKD_DIR_CD
                 ,  LAG(PS.VPS_PORT_CD     ,1) OVER (PARTITION BY PS.VSL_CD,PS.SKD_VOY_NO,PS.SKD_DIR_CD ORDER BY DECODE(PS.SKD_CNG_STS_CD,'S',9,1) ASC, DECODE(PS.VPS_PORT_CD,'EGSCA',9,'PAPCA',9,1) ASC, PS.CLPT_SEQ ASC) LASTPOL
                 ,  PS.VPS_PORT_CD
                 ,  LAG(PS.CLPT_IND_SEQ    ,1) OVER (PARTITION BY PS.VSL_CD,PS.SKD_VOY_NO,PS.SKD_DIR_CD ORDER BY DECODE(PS.SKD_CNG_STS_CD,'S',9,1) ASC, DECODE(PS.VPS_PORT_CD,'EGSCA',9,'PAPCA',9,1) ASC, PS.CLPT_SEQ ASC) LPOL_CLPT_IND_SEQ
                 ,  PS.CLPT_IND_SEQ
                 ,  LAG(PS.CLPT_SEQ        ,1) OVER (PARTITION BY PS.VSL_CD,PS.SKD_VOY_NO,PS.SKD_DIR_CD ORDER BY DECODE(PS.SKD_CNG_STS_CD,'S',9,1) ASC, DECODE(PS.VPS_PORT_CD,'EGSCA',9,'PAPCA',9,1) ASC, PS.CLPT_SEQ ASC) LPOL_CLPT_SEQ
                 ,  PS.CLPT_SEQ
                 ,  PS.TURN_PORT_FLG
                 ,  LAG(PS.TURN_PORT_IND_CD,1) OVER (PARTITION BY PS.VSL_CD,PS.SKD_VOY_NO,PS.SKD_DIR_CD ORDER BY DECODE(PS.SKD_CNG_STS_CD,'S',9,1) ASC, DECODE(PS.VPS_PORT_CD,'EGSCA',9,'PAPCA',9,1) ASC, PS.CLPT_SEQ ASC) LPOL_TURN_PORT_IND_CD
                 ,  PS.TURN_PORT_IND_CD
          FROM      VSK_VSL_PORT_SKD               PS
          WHERE     PS.VSL_CD                      = SUBSTR(@[vvd],1,4)  -- Need to bind Vessel Code    --
          AND       PS.SKD_VOY_NO                  = SUBSTR(@[vvd],5,4)  -- Need to bind Voyage Number  --
          AND       PS.SKD_DIR_CD                  = SUBSTR(@[vvd],9,1)     -- Need to bind Direction Code --
          AND       NVL(PS.VT_ADD_CALL_FLG,'N')    <> 'Y'
          AND       NVL(PS.SKD_CNG_STS_CD ,'*')    <> 'S'
          AND       PS.VPS_PORT_CD                 NOT IN ('EGSCA','PAPCA')
          ------------------------------------------------------------
          ) XX
WHERE     1 = 1
AND       XX.VPS_PORT_CD                 LIKE 'CA%'
AND       SUBSTR(XX.VPS_PORT_CD,1,2)     <> SUBSTR(XX.LASTPOL,1,2)  
AND       XX.LPOL_TURN_PORT_IND_CD       IN ('Y','N')
ORDER BY  XX.CLPT_IND_SEQ            ASC			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
