<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOConsultationDBDAOFmsReverseCsrForSubletListRSQL">
			<desc><![CDATA[Reverse CSR for Sublet Select]]></desc>
			<sql><![CDATA[
SELECT BB.ACCT_CD,
	   BB.CUST_CNT_CD,
	   BB.CUST_SEQ,
	   (SELECT MAX(AR_CTR_CD) FROM MDM_ORGANIZATION WHERE OFC_CD = @[slp_ofc_cd]) CTR_CD,
	   (SELECT MAX(LOC_CD) FROM MDM_ORGANIZATION WHERE OFC_CD = @[slp_ofc_cd]) SLP_LOC_CD,
	   @[eff_dt] EFF_DT,
	   '' CSR_AMT,
	  (SELECT SUM(B.CSR_AMT)
	     FROM FMS_CONSULTATION A,
  	          FMS_CSUL_SLP B
        WHERE A.SLP_TP_CD = B.SLP_TP_CD
          AND A.SLP_FUNC_CD = B.SLP_FUNC_CD
          AND A.SLP_OFC_CD = B.SLP_OFC_CD
          AND A.SLP_ISS_DT = B.SLP_ISS_DT
          AND A.SLP_SER_NO = B.SLP_SER_NO
          AND A.CXL_FLG = 'N'
          AND A.APRO_FLG = 'Y'
          AND B.ACCT_CD = @[debit_acct_cd]
          AND B.TO_INV_NO = BB.TO_INV_NO) REV_AMT,
	   ('Reverse Slip of ' || BB.CSR_DESC) CSR_DESC,
	   ('Reverse Slip of ' || BB.CSR_DESC) CSR_DESC1,
	   ('Reverse Slip of ' || BB.CSR_DESC) CSR_DESC2,
       ('Reverse Slip of ' || BB.CSR_DESC) CSR_DESC3,
       ('Reverse Slip of ' || BB.CSR_DESC) CSR_DESC4,
	   (BB.VSL_CD || BB.SKD_VOY_NO || BB.SKD_DIR_CD || BB.REV_DIR_CD) VVD_CD,
	   BB.TO_INV_NO,
	   BB.TO_INV_NO TO_INV_NO1,
	   AA.SLP_TP_CD,
       AA.SLP_FUNC_CD,
       AA.SLP_OFC_CD,
       AA.SLP_ISS_DT,
       AA.CSR_CURR_CD,
       BB.INV_SEQ,
       TO_CHAR(BB.VVD_EFF_DT,'YYYYMMDD') VVD_EFF_DT,
       TO_CHAR(BB.VVD_EXP_DT,'YYYYMMDD') VVD_EXP_DT,
       BB.FLET_SRC_TP_CD,
       AA.SLP_TP_CD ORG_SLP_TP_CD,
       AA.SLP_FUNC_CD ORG_SLP_FUNC_CD,
       AA.SLP_OFC_CD ORG_SLP_OFC_CD,
       AA.SLP_ISS_DT ORG_ISS_DT,
       AA.SLP_SER_NO ORG_SLP_SER_NO,
       AA.FLET_CTRT_NO,
       '' CSR_NO
  FROM FMS_CONSULTATION AA,
  	   FMS_CSUL_SLP BB
 WHERE AA.SLP_TP_CD = BB.SLP_TP_CD
   AND AA.SLP_FUNC_CD = BB.SLP_FUNC_CD
   AND AA.SLP_OFC_CD = BB.SLP_OFC_CD
   AND AA.SLP_ISS_DT = BB.SLP_ISS_DT
   AND AA.SLP_SER_NO = BB.SLP_SER_NO
   AND AA.CXL_FLG = 'N'
   AND AA.SLP_TP_CD = '20'
   AND AA.SLP_FUNC_CD = 'T'
   AND AA.APRO_FLG = 'Y'
   AND AA.CSR_CURR_CD = @[csr_curr_cd]
   AND AA.FLET_CTRT_NO IS NOT NULL
#if (${to_inv_no} != '')
   AND BB.TO_INV_NO = @[to_inv_no]
#end
#if (${vvd_cd} != '')
   AND BB.VSL_CD = SUBSTR(@[vvd_cd],1,4)
   AND BB.SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4)
   AND BB.SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)
   AND BB.REV_DIR_CD = SUBSTR(@[vvd_cd],10,1)
#end
   AND BB.ACCT_CD = @[debit_acct_cd]
   AND BB.ORG_SLP_TP_CD IS NULL
 ORDER BY BB.TO_INV_NO			]]></sql>
			<params>
				<param name="slp_ofc_cd" type="12" value="" out="N"/>
				<param name="eff_dt" type="12" value="" out="N"/>
				<param name="debit_acct_cd" type="12" value="" out="N"/>
				<param name="csr_curr_cd" type="12" value="" out="N"/>
				<param name="to_inv_no" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
