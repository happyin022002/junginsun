<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="JapanTerminalTransmissionDBDAOsearchPartialBkgInfoForScheduleRSQL">
			<desc><![CDATA[searchPartialBkgInfoForSchedule]]></desc>
			<sql><![CDATA[
SELECT T.VSL_CD||T.SKD_VOY_NO||T.SKD_DIR_CD VVD_CD,
       T.VSL_CD,
       T.SKD_VOY_NO,
       T.SKD_DIR_CD,
       T.POL_CD,
       T.POL_YD_CD,
       T.POR_CD,
       T.POR_YD_CD,
       T.CALL_SGN_NO,
       T.BKG_NO,
       DECODE(T.SNACCS_TML_EDI_STS_CNG_FLG, 'Y', T.SNACCS_TML_EDI_STS_CD, DECODE(B.BKG_STS_CD, 'X', 'D', NVL2(T.BKG_NO, 'Rv', 'R'))) BKRBKC,
       DECODE(T.SNACCS_TML_EDI_STS_CNG_FLG, 'Y', T.SNACCS_TML_EDI_STS_CD, DECODE(B.BKG_STS_CD, 'X', 'D', NVL2(T.BKG_NO, 'V', 'R'))) BE_BKRBKC,
       TO_CHAR(T.EDI_SND_DT, 'YYYY-MM-DD') EDI_SND_DT,
       TO_CHAR(T.EDI_SND_DT, 'HH:MM:SS') EDI_SND_TM,
       NVL(T.SNACCS_TML_EDI_STS_CNG_FLG, 'N') SNACCS_TML_EDI_STS_CNG_FLG,
       T.EDI_SND_OFC_CD,
       T.EDI_SND_USR_ID,
       T.OTR_NTFY_YD_CD,
       T.CNTR_TPSZ_CD1,
       T.CNTR_VOL_QTY1,
       T.CNTR_TPSZ_CD2,
       T.CNTR_VOL_QTY2,
       T.CNTR_TPSZ_CD3,
       T.CNTR_VOL_QTY3,
       T.CNTR_TPSZ_CD4,
       T.CNTR_VOL_QTY4,
       T.CNTR_TPSZ_CD5,
       T.CNTR_VOL_QTY5
  FROM BKG_TML_EDI_JP_BL T ,
       BKG_BOOKING B ,
       BKG_TML_EDI_JP_BAT_VVD_SKD S
 WHERE T.BKG_NO = B.BKG_NO
   AND T.BKG_SKD_SEQ = 0
   AND T.PRT_FLG = 'Y'
   AND T.VSL_CD = S.VSL_CD
   AND T.SKD_VOY_NO = S.SKD_VOY_NO
   AND T.SKD_DIR_CD = S.SKD_DIR_CD
   AND T.POL_CD = S.POL_CD
   AND T.POL_YD_CD = S.POL_YD_CD
   AND T.POR_CD = S.POR_CD
   AND T.POR_YD_CD = S.POR_YD_CD
   AND (NVL(T.OTR_NTFY_YD_CD, 'X') = NVL(S.OTR_NTFY_YD_CD, 'X') OR T.OTR_NTFY_YD_CD IS NOT NULL )
#if (${in_vvd_cd} != '')
AND S.VSL_CD = SUBSTR(@[in_vvd_cd],1,4)
AND S.SKD_VOY_NO = SUBSTR(@[in_vvd_cd],5,4)
AND S.SKD_DIR_CD = SUBSTR(@[in_vvd_cd],9,1)
#end

#if (${in_pol_cd} != '')
AND S.POL_CD = @[in_pol_cd]
#end

#if (${in_por_cd} != '')
AND S.POR_CD = @[in_por_cd]
#end

#if (${in_bat_skd_prd_fm_dt} != '' && ${in_bat_skd_prd_to_dt} != '')

AND ( (  BAT_SKD_PRD_FM_DT BETWEEN TO_DATE(@[in_bat_skd_prd_fm_dt], 'YYYY-MM-DD')
                         AND TO_DATE(@[in_bat_skd_prd_to_dt], 'YYYY-MM-DD') + 0.99999

OR  BAT_SKD_PRD_TO_DT BETWEEN TO_DATE(@[in_bat_skd_prd_fm_dt], 'YYYY-MM-DD')
                         AND TO_DATE(@[in_bat_skd_prd_to_dt], 'YYYY-MM-DD') + 0.99999
)
OR (BAT_SKD_PRD_FM_DT <= TO_DATE(@[in_bat_skd_prd_fm_dt], 'YYYY-MM-DD')

AND  BAT_SKD_PRD_TO_DT >= TO_DATE(@[in_bat_skd_prd_to_dt], 'YYYY-MM-DD') + 0.99999
)
)
#end

#if (${in_edi_snd_usr_id} != '')
AND S.EDI_SND_USR_ID = @[in_edi_snd_usr_id]
#end

--POL과 USER ID 둘중 하나로만 검색시에 스케줄 생성된지 일년된 것으로 데이터 검색
#if ((${in_pol_cd} != ''&&${in_vvd_cd} == ''&&${in_bat_skd_prd_fm_dt} == '' && ${in_bat_skd_prd_to_dt} == ''&&${in_edi_snd_usr_id} == ''&&${in_por_cd} == '')
     ||(${in_pol_cd} == ''&&${in_vvd_cd} == ''&&${in_bat_skd_prd_fm_dt} == '' && ${in_bat_skd_prd_to_dt} == ''&&${in_edi_snd_usr_id} != ''&&${in_por_cd} == ''))
AND S.CRE_DT >=  sysdate - 365
#end			]]></sql>
			<params>
				<param name="in_vvd_cd" type="12" value="" out="N"/>
				<param name="in_pol_cd" type="12" value="" out="N"/>
				<param name="in_por_cd" type="12" value="" out="N"/>
				<param name="in_bat_skd_prd_fm_dt" type="12" value="" out="N"/>
				<param name="in_bat_skd_prd_to_dt" type="12" value="" out="N"/>
				<param name="in_edi_snd_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
