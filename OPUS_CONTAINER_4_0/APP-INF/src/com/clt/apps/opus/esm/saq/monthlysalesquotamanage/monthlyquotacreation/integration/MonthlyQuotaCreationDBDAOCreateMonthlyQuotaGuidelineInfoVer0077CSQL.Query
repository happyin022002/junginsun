<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MonthlyQuotaCreationDBDAOCreateMonthlyQuotaGuidelineInfoVer0077CSQL">
			<desc><![CDATA[guideline data 생성 1. saq_mon_qta_gline_ver insert]]></desc>
			<sql><![CDATA[
--1. SAQ_MON_QTA_GLINE_VER INSERT

INSERT INTO SAQ_MON_QTA_GLINE_VER (                                           
  BSE_YR            ,                                                         
  BSE_QTR_CD        ,                                                         
  SAQ_TGT_GRP_CD    ,                                                         
  GLINE_VER_NO      ,                                                         
  QTA_MST_VER_NO    ,                                                         
  SAQ_STS_CD        ,                                                         
  MQTA_MDL_VER_NO   ,                                                         
  CRE_OFC_CD        ,                                                         
  CRE_USR_ID        ,                                                         
  CRE_DT            ,                                                         
  UPD_USR_ID        ,                                                         
  UPD_DT            )                                                         
SELECT                                                                        
  D.BSE_YR          ,                                                         
  D.BSE_QTR_CD         ,                                                         
  C.SAQ_TGT_GRP_CD  ,                                                         
  C.OFC_CD||SUBSTR(D.BSE_YR,3,2)                                              
      ||D.BSE_QTR_CD
      ||LPAD(NVL((SELECT SUBSTR(MAX(GLINE_VER_NO),                            
                            LENGTH(MAX(GLINE_VER_NO))-1, 2)+1                 
                  FROM  SAQ_MON_QTA_GLINE_VER                                 
                  WHERE BSE_YR = D.BSE_YR                                     
                  AND   BSE_QTR_CD = D.BSE_QTR_CD                                   
                  AND   SAQ_TGT_GRP_CD = C.SAQ_TGT_GRP_CD                     
                  AND   CRE_OFC_CD = C.OFC_CD),1),2,'0') AS GLINE_VER_NO,     
  SUBSTR(D.BSE_YR,3,2)                                                        
      ||D.BSE_QTR_CD
      ||LPAD(NVL((SELECT SUBSTR(MAX(GLINE_VER_NO),                            
                            LENGTH(MAX(GLINE_VER_NO))-1, 2)+1                 
                  FROM  SAQ_MON_QTA_GLINE_VER                                 
                  WHERE BSE_YR = D.BSE_YR                                     
                  AND   BSE_QTR_CD = D.BSE_QTR_CD                                   
                  AND   SAQ_TGT_GRP_CD = C.SAQ_TGT_GRP_CD                     
                  AND   CRE_OFC_CD = C.OFC_CD),1),2,'0') AS QTA_MST_VER_NO,    
  '00' AS SAQ_STS_CD,                                                         
  A.MQTA_MDL_VER_NO ,                                                         
  C.OFC_CD          ,                                                         
  @[userId]                 ,                                                         
  SYSDATE           ,                                                         
  @[userId]                 ,                                                         
  SYSDATE                                                                     
FROM SAQ_MON_MDL_CTRT_SMRY A,                                             
     SAQ_TGT_GRP_TRD_V B,                                                     
     SAQ_TGT_GRP C,                                                           
     SAQ_MON_QTA_MDL_EXE D                                                    
WHERE B.TRD_CD = A.TRD_CD                                                     
AND   C.SAQ_TGT_GRP_CD = B.SAQ_TGT_GRP_CD                                     
AND   D.MQTA_MDL_VER_NO = A.MQTA_MDL_VER_NO                                   
AND   A.MQTA_MDL_VER_NO = @[version]                                                   
GROUP  BY                                                                     
  D.BSE_YR          ,                                                         
  D.BSE_QTR_CD         ,                                                         
  C.SAQ_TGT_GRP_CD  ,                                                         
  A.MQTA_MDL_VER_NO ,                                                         
  C.OFC_CD			]]></sql>
			<params>
				<param name="userId" type="12" value="" out="N"/>
				<param name="version" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
