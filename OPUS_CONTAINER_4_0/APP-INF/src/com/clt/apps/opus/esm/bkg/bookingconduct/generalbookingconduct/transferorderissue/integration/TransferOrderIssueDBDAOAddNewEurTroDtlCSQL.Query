<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TransferOrderIssueDBDAOAddNewEurTroDtlCSQL">
			<desc><![CDATA[TransferOrderIssueDBDAOAddNewEurTroDtlCSQL]]></desc>
			<sql><![CDATA[
MERGE INTO BKG_EUR_TRO_DTL A
USING
(
    SELECT @[bkg_no] BKG_NO, @[io_bnd_cd] IO_BND_CD, @[tro_seq] TRO_SEQ, @[tro_sub_seq] TRO_SUB_SEQ FROM DUAL
) B     
ON (A.BKG_NO = B.BKG_NO AND A.IO_BND_CD = B.IO_BND_CD AND A.TRO_SEQ = B.TRO_SEQ AND A.TRO_SUB_SEQ = B.TRO_SUB_SEQ)

WHEN MATCHED THEN

UPDATE SET
DOR_ZIP_ID = @[dor_zip_id],
DOR_ADDR = @[dor_addr],
ARR_DT = TO_DATE(@[dor_arr_dt], 'YYYY-MM-DD HH24:MI'),
CNTC_PSON_NM = @[cntc_pson_nm],
CNTC_PHN_NO = @[cntc_phn_no],
CNTC_EML = @[cntc_eml],
XTER_TRO_SEQ = @[xter_tro_seq],
XTER_TRO_SUB_SEQ = @[xter_tro_sub_seq]
WHERE BKG_NO = @[bkg_no]
AND IO_BND_CD = @[io_bnd_cd]
AND TRO_SEQ = @[tro_seq]
AND TRO_SUB_SEQ = @[tro_sub_seq]

WHEN NOT MATCHED THEN

INSERT (
	BKG_NO
,	IO_BND_CD
,	TRO_SEQ
,	TRO_SUB_SEQ
,   DOR_ADDR
,   CNTC_PSON_NM
,   CNTC_PHN_NO
,   CNTC_EML
,   DOR_ZIP_ID
#if (${dor_arr_dt} != '') 
,	ARR_DT
#end
,	CRE_USR_ID
,	CRE_DT
,	UPD_USR_ID
,	UPD_DT
,	DOR_ADDR_TP_CD
,	XTER_TRO_SEQ 
,	XTER_TRO_SUB_SEQ
,	LOC_CD
,	ZN_CD
) VALUES( 
	@[bkg_no]
,	@[io_bnd_cd]
,	@[tro_seq]
,	@[tro_sub_seq]
,	@[dor_addr]
,	@[cntc_pson_nm]
,	@[cntc_phn_no]
,	@[cntc_eml]
,	@[dor_zip_id]
#if (${dor_arr_dt} != '') 
,	TO_DATE(@[dor_arr_dt], 'YYYY-MM-DD HH24:MI')
#end
,	@[cre_usr_id]
,	sysdate 
,	@[upd_usr_id]
,	sysdate 
,	'D'
, 	@[xter_tro_seq]
,	@[xter_tro_sub_seq]
,	(SELECT POR_CD FROM BKG_BOOKING BK WHERE BKG_NO = @[bkg_no])
,	(SELECT REP_ZN_CD FROM MDM_LOCATION MDM, BKG_BOOKING BK WHERE BK.BKG_NO = @[bkg_no] AND BK.POR_CD = MDM.LOC_CD ) 
)			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="tro_seq" type="12" value="" out="N"/>
				<param name="tro_sub_seq" type="12" value="" out="N"/>
				<param name="dor_zip_id" type="12" value="" out="N"/>
				<param name="dor_addr" type="12" value="" out="N"/>
				<param name="dor_arr_dt" type="12" value="" out="N"/>
				<param name="cntc_pson_nm" type="12" value="" out="N"/>
				<param name="cntc_phn_no" type="12" value="" out="N"/>
				<param name="cntc_eml" type="12" value="" out="N"/>
				<param name="xter_tro_seq" type="12" value="" out="N"/>
				<param name="xter_tro_sub_seq" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
