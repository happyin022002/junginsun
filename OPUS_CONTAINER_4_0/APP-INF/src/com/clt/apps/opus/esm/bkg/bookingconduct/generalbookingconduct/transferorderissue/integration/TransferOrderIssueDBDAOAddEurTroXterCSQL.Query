<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TransferOrderIssueDBDAOAddEurTroXterCSQL">
			<desc><![CDATA[TransferOrderIssueDBDAOAddEurTroXterCSQL]]></desc>
			<sql><![CDATA[
MERGE INTO BKG_EUR_TRO A
USING(
    SELECT @[bkg_no] BKG_NO, @[io_bnd_cd] IO_BND_CD, @[tro_seq] TRO_SEQ FROM DUAL
) B     
ON (A.BKG_NO = B.BKG_NO AND A.IO_BND_CD = B.IO_BND_CD AND A.TRO_SEQ = B.TRO_SEQ)
WHEN MATCHED THEN
UPDATE SET
CNTR_TPSZ_CD = @[cntr_tpsz_cd],
SPCL_INSTR_RMK = @[spcl_instr_rmk],
XTER_TRO_SEQ = @[xter_tro_seq]
WHERE BKG_NO = @[bkg_no]
AND IO_BND_CD = @[io_bnd_cd]
AND TRO_SEQ = @[tro_seq]
WHEN NOT MATCHED THEN
INSERT (
	BKG_NO
,	IO_BND_CD
,	TRO_SEQ
,   RQST_SUB_SEQ
,   CNTR_NO
,   CNTR_TPSZ_CD
,   RC_SEQ
,   AWK_CGO_SEQ
,   HLG_TP_CD
,   CGO_WGT
,   CNTR_PKUP_YD_CD
,   CNTR_PKUP_DT
,   CNTR_RTN_YD_CD
,   CNTR_RTN_DT
,   CMDT_CD
,   REP_CMDT_CD
,   REP_CMDT_DESC
,   BKG_TRSP_MZD_CD
,   SPCL_INSTR_RMK
,   T1_DOC_FLG
,   CSTMS_CLR_NO
,   ALL_IN_RT_CD
,   CURR_CD
,   TRNS_REV_AMT
,   NMF_TRNS_REV_AMT
,	ADD_REV_AMT
,	ADD_REV_CHG_CD
,   CXL_FLG
,   VAT_FLG
,   CORR_FLG
,   CFM_ALL_IN_RT_CD
,   CFM_VAT_FLG
,	CRE_USR_ID
,	CRE_DT
,	UPD_USR_ID
,	UPD_DT
,	CRE_OFC_CD
, 	SPLIT_RMK
,   COMM_OFC_CD
,	XTER_TRO_SEQ
) VALUES( 
	@[bkg_no]
,	@[io_bnd_cd]
,	@[tro_seq]
,	'1'
,	@[cntr_no]
,	@[cntr_tpsz_cd]
,	@[rc_seq]
,	@[awk_cgo_seq]
,	@[hlg_tp_cd]
,	( SELECT BL.ACT_WGT FROM BKG_BL_DOC BL WHERE BL.BKG_NO = @[bkg_no]) -- cgo_wgt
,	@[cntr_pkup_yd_cd]

#if (${cntr_pkup_dt} != '') 
,    TO_DATE(@[cntr_pkup_dt]||' '||@[cntr_pkup_dt_hhmi], 'YYYY-MM-DD HH24:MI')
#else
,    @[cntr_pkup_dt]
#end 

,	(select bk.FULL_RTN_YD_CD from bkg_booking bk where bk.bkg_no = @[bkg_no]) --cntr_rtn_yd_cd
,   (SELECT NVL(MAX(MNL_SET_DT), MAX(SYS_SET_DT)) RTN_DT
         FROM BKG_CLZ_TM CLZ, BKG_BOOKING BK 
        WHERE BK.BKG_NO     = CLZ.BKG_NO
                       AND BK.BKG_NO = @[bkg_no]
          AND CLZ.CLZ_TP_CD = 'R'
                     GROUP BY BK.BKG_NO) --cntr_rtn_dt
,	NVL(@[tro_cmdt_cd], (select cmdt_cd     from bkg_booking where bkg_no = @[bkg_no]))
,	NVL(@[rep_cmdt_cd], (select rep_cmdt_cd from bkg_booking where bkg_no = @[bkg_no]))
,	(SELECT REP.REP_CMDT_NM FROM MDM_REP_CMDT REP, bkg_booking bk WHERE BK.REP_CMDT_CD = REP.REP_CMDT_CD  and bk.bkg_no = @[bkg_no]) --rep_cmdt_nm
,	@[bkg_trsp_mzd_cd]
,	@[spcl_instr_rmk]
,	NVL(@[t1_doc_flg], 'N')
,	@[cstms_clr_no]
,	(select DECODE(RCV_TERM_CD, 'D','Y','N') from bkg_booking bk where bk.bkg_no = @[bkg_no]) --all_in_rt_cd
,	DECODE(@[hlg_tp_cd], 'C', @[curr_cd], NVL(@[curr_cd], 'EUR'))
,	@[trns_rev_amt]
,	DECODE(@[hlg_tp_cd], 'C', @[non_trns_rev_amt], NVL(@[non_trns_rev_amt], 0))
,	@[add_rev_amt]
,	@[add_rev_chg_cd]
,   'N'
,   NVL(@[vat_flg], 'N')
,   'N'
,   'N'
,   'N'
,	@[cre_usr_id]
,	sysdate
,	@[upd_usr_id]
,	sysdate
,	(SELECT OFC_CD FROM COM_USER WHERE USR_ID = @[cre_usr_id])
,	@[split_rmk]
,	@[comm_ofc_cd]
,	@[xter_tro_seq]
)			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="tro_seq" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="spcl_instr_rmk" type="12" value="" out="N"/>
				<param name="xter_tro_seq" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="rc_seq" type="12" value="" out="N"/>
				<param name="awk_cgo_seq" type="12" value="" out="N"/>
				<param name="hlg_tp_cd" type="12" value="" out="N"/>
				<param name="cntr_pkup_yd_cd" type="12" value="" out="N"/>
				<param name="cntr_pkup_dt" type="12" value="" out="N"/>
				<param name="cntr_pkup_dt_hhmi" type="12" value="" out="N"/>
				<param name="tro_cmdt_cd" type="12" value="" out="N"/>
				<param name="rep_cmdt_cd" type="12" value="" out="N"/>
				<param name="bkg_trsp_mzd_cd" type="12" value="" out="N"/>
				<param name="t1_doc_flg" type="12" value="" out="N"/>
				<param name="cstms_clr_no" type="12" value="" out="N"/>
				<param name="curr_cd" type="12" value="" out="N"/>
				<param name="trns_rev_amt" type="12" value="" out="N"/>
				<param name="non_trns_rev_amt" type="12" value="" out="N"/>
				<param name="add_rev_amt" type="12" value="" out="N"/>
				<param name="add_rev_chg_cd" type="12" value="" out="N"/>
				<param name="vat_flg" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="split_rmk" type="12" value="" out="N"/>
				<param name="comm_ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
