<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingReceiptDBDAOmodifyCARollOvrUSQL">
			<desc><![CDATA[Modify last CA status as like fisrt time.]]></desc>
			<sql><![CDATA[
UPDATE BKG_ROLL_OVR
   SET ( NEW_VSL_CD
       , NEW_SKD_VOY_NO
       , NEW_SKD_DIR_CD
       , NEW_ETD_DT
       , ROLL_OVR_RSN_CD
       , DIFF_RMK
       , EVNT_USR_ID
       , EVNT_DT
       , UPD_USR_ID
       , UPD_DT
       )
     = 
       (SELECT '' NEW_VSL_CD
             , '' NEW_SKD_VOY_NO
             , '' NEW_SKD_DIR_CD
             , '' NEW_ETD_DT
             , '' ROLL_OVR_RSN_CD
             , '' DIFF_RMK
             , CRE_USR_ID EVNT_USR_ID
             , GLOBALDATE_PKG.TIME_CONV_FNC(COM_ConstantMgr_PKG.COM_getBaseLocationCode_FNC(),CRE_DT,BKG_COM_USER_LOC_FNC(CRE_USR_ID))EVNT_DT
             , CRE_USR_ID UPD_USR_ID
             , CRE_DT UPD_DT
          FROM( SELECT CRE_USR_ID 
                     , CRE_DT
                     , RANK() OVER(ORDER BY UPD_DT DESC) RNK  
                 FROM BKG_ROLL_OVR 
                 WHERE BKG_NO = @[bkg_no]
				 AND ROLL_OVR_SEQ = (SELECT DECODE(MAX(ROLL_OVR_SEQ)-1,0,1,MAX(ROLL_OVR_SEQ)-1) FROM BKG_ROLL_OVR WHERE BKG_NO = @[bkg_no])
              )
       )
 WHERE bkg_no = @[bkg_no]
 AND ROLL_OVR_SEQ = (SELECT MAX(ROLL_OVR_SEQ) FROM BKG_ROLL_OVR WHERE BKG_NO = @[bkg_no])			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
