<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCProposalMainDBDAORsltPropCopyVORSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
SELECT @[prop_no] AS PROP_NO
      ,@[amdt_seq] AS AMDT_SEQ
      ,MN.SVC_SCP_CD AS SVC_SCP_CD
      ,SIGN(NVL(OG_CNT,0)+NVL(DE_CNT,0)+NVL(LO_CNT,0)
           +NVL(CO_CNT,0)+NVL(AO_CNT,0)+NVL(AD_CNT,0)
           +NVL(SN_CNT,0)+NVL(LD_CNT,0)
           +NVL(GO_CNT,0)+NVL(GRT_CNT,0)+NVL(SRT_CNT,0)) AS SCP_CHK
      ,SIGN(NVL(OG_CNT,0))  AS ORGN_CHK
      ,SIGN(NVL(DE_CNT,0))  AS DEST_CHK
      ,SIGN(NVL(LO_CNT,0))  AS LOCA_CHK
      ,SIGN(NVL(CO_CNT,0))  AS CMDT_CHK
      ,SIGN(NVL(AO_CNT,0))  AS AROR_CHK
      ,SIGN(NVL(AD_CNT,0))  AS ARDE_CHK
      ,SIGN(NVL(SN_CNT,0))  AS SPNT_CHK
      ,SIGN(NVL(LD_CNT,0))  AS LOAD_CHK
      ,SIGN(NVL(GO_CNT,0))  AS GOH_CHK
      /* General/Special Rate Copy 구분을 위한 값 추가 */
      ,SIGN(NVL(GRT_CNT,0)) AS GRATE_CHK 
      ,SIGN(NVL(SRT_CNT,0)) AS SRATE_CHK
      /* 추가 Column 유지를 위한 부분 시작 */
      ,'' AS SC_NO 
      ,'' AS NEW_PROP_NO
      ,'' AS BLPL_CHK
      ,'' AS AFIL_CHK
      ,'' AS CRE_USR_ID
      ,'' AS UPD_USR_ID
      ,'' AS OFC_CD
      ,'' AS SREP_CD
      ,'' AS ORG_DEST_TP_CD
      ,'' AS ADD_CHG_TP_CD
      ,'' AS NOTE_TP_CD
      ,'' AS PRC_PROP_CRE_TP_CD
      ,'' AS CUST_TP
      /* 추가 Column 유지를 위한 부분 끝 */
FROM (
    -- SCP_MAIN
    SELECT SVC_SCP_CD
         , CRE_DT
    FROM PRI_SP_SCP_MN
    WHERE PROP_NO = @[prop_no]
    AND   AMDT_SEQ = @[amdt_seq]
) MN
LEFT OUTER JOIN
(
    -- ORGIN
    SELECT SVC_SCP_CD
          ,COUNT(ROUT_PNT_SEQ) AS OG_CNT
    FROM PRI_SP_SCP_ROUT_PNT
    WHERE PROP_NO = @[prop_no]
    AND   AMDT_SEQ = @[amdt_seq]
    AND   ORG_DEST_TP_CD = 'O'
    GROUP BY SVC_SCP_CD
) OG
ON OG.SVC_SCP_CD = MN.SVC_SCP_CD
LEFT OUTER JOIN
(
    -- DEST
    SELECT SVC_SCP_CD
          ,COUNT(ROUT_PNT_SEQ) AS DE_CNT
    FROM PRI_SP_SCP_ROUT_PNT
    WHERE PROP_NO = @[prop_no]
    AND   AMDT_SEQ = @[amdt_seq]
    AND   ORG_DEST_TP_CD = 'D'
    GROUP BY SVC_SCP_CD
) DE
ON DE.SVC_SCP_CD = MN.SVC_SCP_CD
LEFT OUTER JOIN
(
    -- LOCATION
    SELECT SVC_SCP_CD
          ,COUNT(GRP_LOC_SEQ) AS LO_CNT
    FROM PRI_SP_SCP_GRP_LOC
    WHERE PROP_NO = @[prop_no]
    AND   AMDT_SEQ = @[amdt_seq]
    GROUP BY SVC_SCP_CD
) LO
ON LO.SVC_SCP_CD = MN.SVC_SCP_CD
LEFT OUTER JOIN
(
    -- COMMODITY
    SELECT SVC_SCP_CD
          ,COUNT(GRP_CMDT_SEQ) AS CO_CNT
    FROM PRI_SP_SCP_GRP_CMDT
    WHERE PROP_NO = @[prop_no]
    AND   AMDT_SEQ = @[amdt_seq]
    GROUP BY SVC_SCP_CD
) CO
ON CO.SVC_SCP_CD = MN.SVC_SCP_CD
LEFT OUTER JOIN
(
    -- ARBITRARY ORIGIN
    SELECT SVC_SCP_CD
          ,COUNT(ADD_CHG_SEQ) AS AO_CNT
    FROM PRI_SP_SCP_TRSP_ADD_CHG
    WHERE PROP_NO = @[prop_no]
    AND   AMDT_SEQ = @[amdt_seq]
    AND   ORG_DEST_TP_CD = 'O'
    GROUP BY SVC_SCP_CD
) AO
ON AO.SVC_SCP_CD = MN.SVC_SCP_CD
LEFT OUTER JOIN
(
    -- ARBITRARY DEST
    SELECT SVC_SCP_CD
          ,COUNT(ADD_CHG_SEQ) AS AD_CNT
    FROM PRI_SP_SCP_TRSP_ADD_CHG
    WHERE PROP_NO = @[prop_no]
    AND   AMDT_SEQ = @[amdt_seq]
    AND   ORG_DEST_TP_CD = 'D'
    GROUP BY SVC_SCP_CD
) AD
ON AD.SVC_SCP_CD = MN.SVC_SCP_CD
LEFT OUTER JOIN
(
    -- SPECIAL NOTE
    SELECT SVC_SCP_CD
          ,COUNT(NOTE_SEQ) AS SN_CNT
    FROM PRI_SP_SCP_NOTE
    WHERE PROP_NO = @[prop_no]
    AND   AMDT_SEQ = @[amdt_seq]
    AND   NOTE_TP_CD = 'P'
    GROUP BY SVC_SCP_CD
) SN
ON SN.SVC_SCP_CD = MN.SVC_SCP_CD
LEFT OUTER JOIN
(
    -- LOADING AGENT
    SELECT SVC_SCP_CD
          ,COUNT(LODG_AGN_SEQ) AS LD_CNT
    FROM PRI_SP_SCP_LODG_AGN
    WHERE PROP_NO = @[prop_no]
    AND   AMDT_SEQ = @[amdt_seq]
    GROUP BY SVC_SCP_CD
) LD
ON LD.SVC_SCP_CD = MN.SVC_SCP_CD
LEFT OUTER JOIN
(
    -- GOH
    SELECT SVC_SCP_CD
          ,COUNT(GOH_CHG_SEQ) AS GO_CNT
    FROM PRI_SP_SCP_GOH_CHG
    WHERE PROP_NO = @[prop_no]
    AND   AMDT_SEQ = @[amdt_seq]
    GROUP BY SVC_SCP_CD
) GO
ON GO.SVC_SCP_CD = MN.SVC_SCP_CD
LEFT OUTER JOIN
(
    -- GENERAL RATE
    SELECT SVC_SCP_CD
          ,COUNT(RT_SEQ) AS GRT_CNT
    FROM PRI_SP_SCP_RT
    WHERE PROP_NO = @[prop_no]
    AND   AMDT_SEQ = @[amdt_seq]
    AND   GEN_SPCL_RT_TP_CD = 'G'
    GROUP BY SVC_SCP_CD
) GRT
ON GRT.SVC_SCP_CD = MN.SVC_SCP_CD
LEFT OUTER JOIN
(
    -- SPECIAL RATE
    SELECT SVC_SCP_CD
          ,COUNT(RT_SEQ) AS SRT_CNT
    FROM PRI_SP_SCP_RT
    WHERE PROP_NO = @[prop_no]
    AND   AMDT_SEQ = @[amdt_seq]
    AND   GEN_SPCL_RT_TP_CD = 'S'
    GROUP BY SVC_SCP_CD
) SRT
ON SRT.SVC_SCP_CD = MN.SVC_SCP_CD
ORDER BY MN.CRE_DT, MN.SVC_SCP_CD			]]></sql>
			<params>
				<param name="prop_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
