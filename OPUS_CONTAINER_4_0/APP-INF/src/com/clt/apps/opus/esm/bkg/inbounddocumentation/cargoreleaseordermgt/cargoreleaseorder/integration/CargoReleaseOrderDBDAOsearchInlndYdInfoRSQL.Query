<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CargoReleaseOrderDBDAOsearchInlndYdInfoRSQL">
			<desc><![CDATA[...]]></desc>
			<sql><![CDATA[
SELECT MAX(A.BKG_FULL_RLSE_EDI_CD)  AS INLND_FULL_RLSE_EDI_CD,
        MAX(DECODE(A.PRNR_SUB_LNK_CD, B.PRNR_SUB_LNK_CD,'','Y')) AS INLND_CD
   FROM (
        SELECT C.BL_NO AS BKG_BL_NO,
               D.MSG_TP_DESC AS BKG_FULL_RLSE_EDI_CD,
               SUBSTR(B.RCVR_TRD_PRNR_ID, 1, 3) AS BKG_TERM_ID,
               B.PRNR_SUB_LNK_CD
            FROM BKG_CGO_RLSE A,
              BKG_EDI_TRD_PRNR_SUB_LNK B,
              BKG_BOOKING C,
              BKG_EDI_SUB_LNK_MSG D
            WHERE A.BL_NO = @[bl_no]
              AND A.BL_NO = C.BL_NO
              AND B.PRNR_SUB_LNK_CD = DECODE(C.DE_TERM_CD,'Y',C.DEL_NOD_CD, 
                                                          'D',(SELECT MAX (COPD.NOD_CD) NOD_CD
                                                                FROM SCE_COP_HDR COPM
                                                                    , SCE_COP_DTL COPD
                                                                    , MDM_ACTIVITY MDM
                                                                WHERE 1=1 
                                                                --AND SUBSTR(BKGM.DEL_CD, 1,2) = 'US'
                                                                  AND COPM.BKG_NO = (SELECT BKG_NO 
                                                                                       FROM BKG_BOOKING 
                                                                                      WHERE BL_NO = @[bl_no]
                                                                                        AND ROWNUM = 1)
                                                                  AND COPD.COP_NO = COPM.COP_NO
                                                                  AND COPM.COP_STS_CD <> 'X'
                                                                  AND COPD.ACT_CD IN ('FITRDO', 'FITYDO')  
                                                                  AND MDM.ACT_CD = COPD.ACT_CD)               ,C.DEL_NOD_CD) -- CY면 DEL_NOD_CD , DOOR면 [Truck Gate Out from I/B CY] or [Truck Gate Out from I/B Rail Ramp]
              AND B.TRD_PRNR_SUB_LNK_SEQ = D.TRD_PRNR_SUB_LNK_SEQ
              AND D.EDI_MSG_TP_ID = 'TDC315'
              AND D.EDI_MSG_IND_CD = 1 --inland
              AND ROWNUM = 1
      ) A, 
      (
        SELECT B.PRNR_SUB_LNK_CD
            FROM BKG_CGO_RLSE A,
              BKG_EDI_TRD_PRNR_SUB_LNK B,
              BKG_BOOKING C,
              BKG_EDI_SUB_LNK_MSG D
            WHERE A.BL_NO = @[bl_no]
              AND A.BL_NO = C.BL_NO
              AND B.PRNR_SUB_LNK_CD = C.POD_NOD_CD
              AND B.TRD_PRNR_SUB_LNK_SEQ = D.TRD_PRNR_SUB_LNK_SEQ
              AND D.EDI_MSG_TP_ID = 'TDC315'
              AND ROWNUM = 1
      ) B			]]></sql>
			<params>
				<param name="bl_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
