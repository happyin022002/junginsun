<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="IndiaCustomsTransmissionDBDAOsearchBlListByVvdPolPodRSQL">
			<desc><![CDATA[전송 대상 B/L을 가져옴]]></desc>
			<sql><![CDATA[
SELECT 
        SUBSTR(CALL_SGN_NO, 1, 7) CALL_SGN_NO
        ,BCIV.SKD_VOY_NO SKD_VOY_NO
        ,BCIV.IDA_DECL_VSL_NO 
        ,VSL_DECL_DT        
        ,BCIB.IDA_LINE_NO    
        ,'0' TMP0
        ,DECODE(BCIB.BL_NO, BCIB.NVOCC_REF_NO, COM_ConstantMgr_PKG.COM_getScacCode_FNC()||BCIB.BL_NO, BCIB.NVOCC_REF_NO) NEW_BL_NO
        ,TO_CHAR(BBD.BL_OBRD_DT, 'DDMMYYYY') BL_OBRD_DT
        ,BCIB.POL_CD
        ,SUBSTR(BCIB.IDA_DEST_CD, 1, 6) IDA_DEST_CD
        ,'' TMP1
        ,'' TMP2
        ,REPLACE( REPLACE( REPLACE(DECODE(BCIB.BL_NO, BCIB.NVOCC_REF_NO, DECODE(NVL(BB.CUST_TO_ORD_FLG,'N'), 'Y', SUBSTR(BC1.CUST_NM, 1, 35), SUBSTR(BC.CUST_NM, 1, 35)), C_BHC.CUST_NM ), CHR(10), ''), CHR(13), ''), CHR(10), '') C_CUST_NM

        ,REPLACE( REPLACE(REPLACE(DECODE(BCIB.BL_NO, BCIB.NVOCC_REF_NO, DECODE(NVL(BB.CUST_TO_ORD_FLG,'N'), 'Y', REPLACE(SUBSTR(BC1.CUST_ADDR, 1, 35), CHR(10), '')|| CHR(29)|| REPLACE(SUBSTR(BC1.CUST_ADDR, 36, 35), CHR(10), '')|| CHR(29)|| REPLACE(SUBSTR(BC1.CUST_ADDR, 71, 35), CHR(10), ''),
                  REPLACE(SUBSTR(BC.CUST_ADDR, 1, 35), CHR(10), '')|| CHR(29)|| REPLACE(SUBSTR(BC.CUST_ADDR, 36, 35), CHR(10), '')|| CHR(29)|| REPLACE(SUBSTR(BC.CUST_ADDR, 71, 35), CHR(10), '')),
                  REPLACE(SUBSTR(C_BHC.CUST_ADDR, 1, 35), CHR(10), '')|| CHR(29)|| REPLACE(SUBSTR(C_BHC.CUST_ADDR, 36, 35), CHR(10), '')|| CHR(29)|| REPLACE(SUBSTR(C_BHC.CUST_ADDR, 71, 35), CHR(10), '')), CHR(10), ''), CHR(13), ''), CHR(10), '') C_CUST_ADDR
        
        ,REPLACE( REPLACE( REPLACE(DECODE(BCIB.BL_NO, BCIB.NVOCC_REF_NO, DECODE(NVL(BB.CUST_TO_ORD_FLG,'N'), 'N', SUBSTR(BC1.CUST_NM, 1, 35), ''), N_BHC.CUST_NM ), CHR(10), ''), CHR(13), ''), CHR(10), '') N_CUST_NM
        

        ,REPLACE(  REPLACE(  REPLACE(DECODE(BCIB.BL_NO, BCIB.NVOCC_REF_NO, DECODE(NVL(BB.CUST_TO_ORD_FLG,'N'), 'N', REPLACE(SUBSTR(BC1.CUST_ADDR, 1, 35), CHR(10), '')|| CHR(29)|| REPLACE(SUBSTR(BC1.CUST_ADDR, 36, 35), CHR(10), '')|| CHR(29)|| REPLACE(SUBSTR(BC1.CUST_ADDR, 71, 35), CHR(10), ''),
                  ''||CHR(29)||''||CHR(29)||''),
                  REPLACE(SUBSTR(N_BHC.CUST_ADDR, 1, 35), CHR(10), '')|| CHR(29)|| REPLACE(SUBSTR(N_BHC.CUST_ADDR, 36, 35), CHR(10), '')|| CHR(29)|| REPLACE(SUBSTR(N_BHC.CUST_ADDR, 71, 35), CHR(10), '')), CHR(10), ''), CHR(13), ''), CHR(10), '') N_CUST_ADDR

        ,DECODE(BB.BKG_CGO_TP_CD, 'F', 'C', 'R', 'C', 'B', 'P') BKG_CGO_TP_CD

        ,DECODE(BCIB.IDA_CSTMS_ITM_TP_CD, 'O', 'OT', 'G', 'GC', 'U', 'UB', '') IDA_CSTMS_ITM_TP_CD

        ,BCIB.BL_DECL_TP_CD BL_DECL_TP_CD

        ,DECODE(BCIB.POD_CD,'INMAA',DECODE(BCIB.BL_DECL_TP_CD,BKG_GET_BKG_CTMS_CD_FNC('IN','ENTRY_TYPE_CD','2',1),BCIV.IDA_CFS_ID,BKG_GET_BKG_CTMS_CD_FNC('IN','ENTRY_TYPE_CD','3',1),BCIB.POD_CD, BCIV.IDA_CFS_ID),
                   'INNAH',DECODE(BCIB.BL_DECL_TP_CD,BKG_GET_BKG_CTMS_CD_FNC('IN','ENTRY_TYPE_CD','2',1),BCIV.IDA_CFS_ID,BKG_GET_BKG_CTMS_CD_FNC('IN','ENTRY_TYPE_CD','3',1),'',BCIV.IDA_CFS_ID),BCIV.IDA_CFS_ID) POD_CD_GUBUN

        ,DECODE(BCIB.BL_NO, BCIB.NVOCC_REF_NO, TO_CHAR(BBD.PCK_QTY), TO_CHAR(BH.PCK_QTY) ) PCK_QTY
        
        ,DECODE(BCIB.BL_NO, BCIB.NVOCC_REF_NO, DECODE(BBD.PCK_TP_CD,  'BG', 'BGS',
                                                                    'BL', 'PKG',
                                                                    'BA', 'PKG',
                                                                    'BR', 'BAR',
                                                                    'BK', 'PKG',
                                                                    'BX', 'BOX',
                                                                    'BE', 'PKG',
                                                                    'CI', 'PKG',
                                                                    'CT', 'CTN',
                                                                    'CS', 'CAS',
                                                                    'CL', 'PKG',
                                                                    'CN', 'CON',
                                                                    'CR', 'PKG',
                                                                    'DR', 'DRM',
                                                                    'LV', 'LFT',
                                                                    'LT', 'PKG',
                                                                    'NO', 'PKG',
                                                                    'PS', 'PKG',
                                                                    'RL', 'PKG',
                                                                    'RO', 'RLS',
                                                                    'SA', 'SAK',
                                                                    'ST', 'PKG',
                                                                    'SK', 'PKG',
                                                                    'TR', 'PKG',
                                                                    'CY', 'CYL',
                                                                    'PK', 'PKG',
                                                                    'PE', 'PLT',
                                                                    'LG', 'LOG',
                                                                    'SK', 'SKD',
                                                                    'WC', 'CSK',
                                                                    'LS', 'CON',
                                                                    'UN', 'PKG', ''),
                                            DECODE(BH.PCK_TP_CD,  'BG', 'BGS',
                                                                  'BL', 'PKG',
                                                                  'BA', 'PKG',
                                                                  'BR', 'BAR',
                                                                  'BK', 'PKG',
                                                                  'BX', 'BOX',
                                                                  'BE', 'PKG',
                                                                  'CI', 'PKG',
                                                                  'CT', 'CTN',
                                                                  'CS', 'CAS',
                                                                  'CL', 'PKG',
                                                                  'CN', 'CON',
                                                                  'CR', 'PKG',
                                                                  'DR', 'DRM',
                                                                  'LV', 'LFT',
                                                                  'LT', 'PKG',
                                                                  'NO', 'PKG',
                                                                  'PS', 'PKG',
                                                                  'RL', 'PKG',
                                                                  'RO', 'RLS',
                                                                  'SA', 'SAK',
                                                                  'ST', 'PKG',
                                                                  'SK', 'PKG',
                                                                  'TR', 'PKG',
                                                                  'CY',    'CYL',
                                                                  'PK',    'PKG',
                                                                  'PE',    'PLT',
                                                                  'LG',    'LOG',
                                                                  'SK',    'SKD',
                                                                  'WC',    'CSK',
                                                                  'LS', 'CON',
                                                                  'UN', 'PKG', '')
                ) PCK_TP_CD
                
                ,TRIM(DECODE(BCIB.BL_NO, BCIB.NVOCC_REF_NO, TO_CHAR(ROUND(BBD.ACT_WGT , 2), '99999999.000'), TO_CHAR(ROUND(BH.HBL_WGT, 2), '99999999.000'))) WGT
        
                ,DECODE(BCIB.BL_NO, BCIB.NVOCC_REF_NO, BBD.WGT_UT_CD, BH.WGT_UT_CD) WGT_UT_CD
                
                ,'' TMP3
                ,'' TMP4
                
                ,REPLACE(SUBSTR(BBMD.MK_DESC, 1, 300), CHR(10), '') MK_DESC

                ,REPLACE(REPLACE(DECODE(BCIB.BL_NO, BCIB.NVOCC_REF_NO, SUBSTR(BBD.CSTMS_DESC, 1, 250), SUBSTR(BBMD.CMDT_DESC, 1, 250)), CHR(10), ''), CHR(13), '') CMDT_DESC

                ,NVL(DG.IMDG_UN_NO, 'ZZZZZ') IMDG_UN_NO
        
                ,NVL(DG.IMDG_CLSS_CD, 'ZZZ') IMDG_CLSS_CD

                ,DECODE(BCIB.POD_CD,'INMAA',BCIV.IBD_NO,'INNAH',DECODE(BCIB.BL_DECL_TP_CD,BKG_GET_BKG_CTMS_CD_FNC('IN','ENTRY_TYPE_CD','3',1),BCIV.IBD_NO,''),BCIV.IBD_NO) IBD_NO

                ,DECODE(BCIB.POD_CD,'INMAA','','INNAH',DECODE(BCIB.BL_DECL_TP_CD, BKG_GET_BKG_CTMS_CD_FNC('IN','ENTRY_TYPE_CD','3',1),NVL(BCIB.TRNS_OPR_ID,BCIV.TRNS_OPR_ID),BKG_GET_BKG_CTMS_CD_FNC('IN','ENTRY_TYPE_CD','4',1),NVL(BCIB.TRNS_OPR_ID,BCIV.TRNS_OPR_ID),''),NVL(BCIB.TRNS_OPR_ID,BCIV.TRNS_OPR_ID)) CRR_AGN_CD

                ,DECODE(BCIB.BL_DECL_TP_CD, BKG_GET_BKG_CTMS_CD_FNC('IN','ENTRY_TYPE_CD','3',1), BCIB.IDA_TRSP_CD, '') IDA_TRSP_CD

                ,NVL(BCIV.IDA_MRN_LINE_OPR_ID, '') IDA_MRN_LINE_OPR_CD
        
                ,DECODE(BCIB.POD_CD,'INMAA',DECODE(BCIB.BL_DECL_TP_CD,BKG_GET_BKG_CTMS_CD_FNC('IN','ENTRY_TYPE_CD','2',1),BCIB.BD_AREA_CD,''),
                                     'INNAH', '') BD_AREA_CD

    
FROM    BKG_CSTMS_IDA_VSL BCIV        
        ,BKG_CSTMS_IDA_BL BCIB       
        ,BKG_BL_MK_DESC BBMD         
        ,BKG_BL_DOC BBD             
        ,MDM_CUSTOMER MC            
        ,BKG_CUSTOMER BC            
        ,MDM_CUSTOMER MC1           
        ,BKG_CUSTOMER BC1           
        ,(
            SELECT   DG.IMDG_UN_NO            
                     ,DG.IMDG_CLSS_CD         
                     ,DG.BKG_NO
            FROM     BKG_DG_CGO DG           
                     ,BKG_BOOKING BB         
                     ,BKG_CSTMS_IDA_BL BCIB  
            WHERE    BCIB.VSL_CD            =    SUBSTR(@[vvd_cd], 1, 4)
            AND     BCIB.SKD_VOY_NO    	 =   SUBSTR(@[vvd_cd], 5, 4)
            AND     BCIB.SKD_DIR_CD     =   SUBSTR(@[vvd_cd], 9, 1)
            AND    	BCIB.POD_CD            =    @[pod_cd]
            AND    	BCIB.POL_CD            LIKE    NVL(@[pol_cd], '') || '%'
            AND    	BCIB.BL_NO            =    BB.BL_NO
            AND    	DG.DCGO_SEQ            =    (    SELECT    DISTINCT MIN(A.DCGO_SEQ) 
                                            FROM    BKG_DG_CGO A
                                            WHERE    A.BKG_NO     =    BB.BKG_NO
                                            AND     BB.POD_CD    =  @[pod_cd]
                                            AND     BB.POL_CD    LIKE    NVL(@[pol_cd], '') || '%' )
            AND    BB.BKG_NO     =    DG.BKG_NO
        )  DG
        ,BKG_BOOKING   BB             --BOOKING             BK
        ,BKG_HBL       BH             -- HOUSE BL 추가
        ,(       
           SELECT 
                B.BKG_NO
                ,B.HBL_SEQ
                ,B.CUST_NM
                ,B.CUST_ADDR
            FROM BKG_HBL A
                 ,BKG_HBL_CUST B
            WHERE A.BKG_NO = B.BKG_NO
            AND   A.HBL_SEQ = B.HBL_SEQ
            AND   B.BKG_CUST_TP_CD = 'C'
            AND   (B.BKG_NO, B.HBL_SEQ, B.BKG_CUST_TP_CD) IN (
                                                                SELECT 	B.BKG_NO, MAX(B.HBL_SEQ), B.BKG_CUST_TP_CD
                                                                FROM 	BKG_CSTMS_IDA_BL BCIB,
                                                            			BKG_BOOKING BKG,
                                                            			BKG_HBL A,
                                                            			BKG_HBL_CUST B
                                                    			WHERE   BCIB.BL_NO      = BKG.BL_NO
                                                    			AND     BKG.BKG_NO      = A.BKG_NO
                                                    			AND     A.BKG_NO        = B.BKG_NO
                                                    			AND     A.HBL_SEQ       = B.HBL_SEQ
                                                    			AND     BCIB.VSL_CD     = SUBSTR(@[vvd_cd], 1, 4)
                                                    			AND     BCIB.SKD_VOY_NO = SUBSTR(@[vvd_cd], 5, 4)
                                                    			AND     BCIB.SKD_DIR_CD = SUBSTR(@[vvd_cd], 9, 1)
                                                    			AND     BCIB.POD_CD     = @[pod_cd]
                                                    			AND     BCIB.POL_CD     LIKE NVL(@[pol_cd], '') || '%'
                                                                GROUP BY 	B.BKG_NO, B.BKG_CUST_TP_CD
                                                                HAVING 		B.BKG_CUST_TP_CD = 'C'
                                                              )

        ) C_BHC
        ,(       
           SELECT 
                B.BKG_NO
                ,B.HBL_SEQ
                ,B.CUST_NM
                ,B.CUST_ADDR
            FROM BKG_HBL A
                 ,BKG_HBL_CUST B
            WHERE A.BKG_NO = B.BKG_NO
            AND   A.HBL_SEQ = B.HBL_SEQ
            AND   B.BKG_CUST_TP_CD = 'N'
            AND   (B.BKG_NO, B.HBL_SEQ, B.BKG_CUST_TP_CD) IN (
                                                                SELECT 	B.BKG_NO, MAX(B.HBL_SEQ), B.BKG_CUST_TP_CD
                                                                FROM 	BKG_CSTMS_IDA_BL BCIB,
                                                            			BKG_BOOKING BKG,
                                                            			BKG_HBL A,
                                                            			BKG_HBL_CUST B
                                                    			WHERE   BCIB.BL_NO      = BKG.BL_NO
                                                    			AND     BKG.BKG_NO      = A.BKG_NO
                                                    			AND     A.BKG_NO        = B.BKG_NO
                                                    			AND     A.HBL_SEQ       = B.HBL_SEQ
                                                    			AND     BCIB.VSL_CD     = SUBSTR(@[vvd_cd], 1, 4)
                                                    			AND     BCIB.SKD_VOY_NO = SUBSTR(@[vvd_cd], 5, 4)
                                                    			AND     BCIB.SKD_DIR_CD = SUBSTR(@[vvd_cd], 9, 1)
                                                    			AND     BCIB.POD_CD     = @[pod_cd]
                                                    			AND     BCIB.POL_CD     LIKE NVL(@[pol_cd], '') || '%'
                                                                GROUP BY 	B.BKG_NO, B.BKG_CUST_TP_CD
                                                                HAVING 		B.BKG_CUST_TP_CD = 'N'
                                                              )
        ) N_BHC
        
        
WHERE    1=1

AND BCIV.VSL_CD                   = BCIB.VSL_CD
AND BCIV.SKD_VOY_NO               = BCIB.SKD_VOY_NO
AND BCIV.SKD_DIR_CD               = BCIB.SKD_DIR_CD

AND    BCIV.POD_CD                   = BCIB.POD_CD
AND    BCIB.BL_NO                   = BB.BL_NO

AND    BB.BKG_NO                      = BC.BKG_NO
AND    BC.BKG_CUST_TP_CD            = 'C'
AND    MC.CUST_CNT_CD(+)           = BC.CUST_CNT_CD
AND    MC.CUST_SEQ(+)              = BC.CUST_SEQ
AND    BB.BKG_STS_CD                <> 'X'
    
#if (${empty_check} != 'on') 
AND     BB.BKG_CGO_TP_CD        <> 'P'
#end

    
AND    BB.BKG_NO            =    BC1.BKG_NO
AND    BC1.BKG_CUST_TP_CD    =    'N'
AND    MC1.CUST_CNT_CD(+)    =    BC1.CUST_CNT_CD
AND    MC1.CUST_SEQ(+)        =    BC1.CUST_SEQ  
AND    BB.BKG_NO            =    DG.BKG_NO(+)
AND    BB.BKG_NO            =    BBMD.BKG_NO(+)
AND    BBMD.BKG_NO            =    BBD.BKG_NO(+)

AND BB.BKG_NO           =   BH.BKG_NO(+)

AND BH.BKG_NO           =   C_BHC.BKG_NO(+)
AND BH.HBL_SEQ          =   C_BHC.HBL_SEQ(+)

AND BH.BKG_NO           =   N_BHC.BKG_NO(+)
AND BH.HBL_SEQ          =   N_BHC.HBL_SEQ(+)

AND    (    ( BCIB.BL_NO    =   BCIB.NVOCC_REF_NO )
      OR ( BCIB.BL_NO    <>  BCIB.NVOCC_REF_NO AND BCIB.NVOCC_REF_NO = TRIM(BH.HBL_NO)    )
    )

AND BCIB.VSL_CD          = SUBSTR(@[vvd_cd], 1, 4)
AND BCIB.SKD_VOY_NO      = SUBSTR(@[vvd_cd], 5, 4)
AND BCIB.SKD_DIR_CD      = SUBSTR(@[vvd_cd], 9, 1)

AND    BCIB.POD_CD            =    @[pod_cd]
AND    BCIB.POL_CD            LIKE    NVL(@[pol_cd], '') || '%'
ORDER BY TO_NUMBER(BCIB.IDA_LINE_NO)			]]></sql>
			<params>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
