<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SLTIntDBDAOSltIntPrcbatchUpUSQL">
			<desc><![CDATA[@20141224.SJH : COA_SLT_INTER_PRC_UT_COST의 EFF_TO_YRMON 일괄 업데이트
-- 데이타가 비었거나 FM_MONTH 가 변경된경우
@20150225.SJH. : 4003처럼 수정]]></desc>
			<sql><![CDATA[
MERGE INTO COA_SLT_INTER_PRC_UT_COST A
USING(
      SELECT SLAN_CD, TRD_CD, SUB_TRD_CD, FM_CNT_CD, TO_CNT_CD, FM_PORT_CD, TO_PORT_CD, CGO_TP_CD, EFF_FM_YRMON, TO_YRMON
      FROM (
              SELECT SLAN_CD, TRD_CD, SUB_TRD_CD, FM_CNT_CD, TO_CNT_CD, FM_PORT_CD, TO_PORT_CD, CGO_TP_CD, EFF_FM_YRMON, EFF_TO_YRMON
                   , TO_CHAR(ADD_MONTHS(TO_DATE(LEAD(EFF_FM_YRMON,1) OVER (PARTITION BY SLAN_CD, TRD_CD, SUB_TRD_CD, FM_CNT_CD, TO_CNT_CD, FM_PORT_CD, TO_PORT_CD, CGO_TP_CD ORDER BY EFF_FM_YRMON), 'YYYYMM'),-1), 'YYYYMM') TO_YRMON
              FROM COA_SLT_INTER_PRC_UT_COST
			  WHERE DELT_FLG = 'N'
              ORDER BY SLAN_CD, TRD_CD, SUB_TRD_CD, FM_CNT_CD, TO_CNT_CD, FM_PORT_CD, TO_PORT_CD, CGO_TP_CD, EFF_FM_YRMON )
      WHERE TO_YRMON IS NOT NULL
        AND EFF_TO_YRMON IS NULL
      ) B
ON (  A.SLAN_CD = B.SLAN_CD
  AND A.TRD_CD = B.TRD_CD
  AND A.SUB_TRD_CD = B.SUB_TRD_CD
  AND A.FM_CNT_CD = B.FM_CNT_CD
  AND A.TO_CNT_CD = B.TO_CNT_CD
  AND A.FM_PORT_CD = B.FM_PORT_CD
  AND A.TO_PORT_CD = B.TO_PORT_CD
  AND A.CGO_TP_CD = B.CGO_TP_CD
  AND A.EFF_FM_YRMON = B.EFF_FM_YRMON
  AND A.DELT_FLG = 'N')
WHEN MATCHED THEN UPDATE 
    SET EFF_TO_YRMON = B.TO_YRMON			]]></sql>
			<params>
			</params>
		</query>
	</querys>
</sqls>
