<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLDocumentationBLDBDAOCanadaFlagRSQL">
			<desc><![CDATA[select]]></desc>
			<sql><![CDATA[
#if (${ca_flg} == 'Y') 
SELECT 'Y'
FROM   BKG_VVD_HIS A
WHERE  A.BKG_NO = @[bkg_no]
AND    A.CORR_NO = 'TMP0000001'
AND    A.POD_CD IN(
           SELECT VPS_PORT_CD
           FROM   VSK_VSL_PORT_SKD
           WHERE  VSL_CD = A.VSL_CD
           AND    SKD_VOY_NO = A.SKD_VOY_NO
           AND    SKD_DIR_CD = A.SKD_DIR_CD
           AND    CLPT_IND_SEQ = '1'
           AND    CLPT_SEQ >=
                      (SELECT MIN(CLPT_SEQ)
                       FROM   VSK_VSL_PORT_SKD
                       WHERE  VSL_CD = A.VSL_CD
                       AND    SKD_VOY_NO = A.SKD_VOY_NO
                       AND    SKD_DIR_CD = A.SKD_DIR_CD
                       AND    VPS_PORT_CD LIKE 'CA%'
                       AND    NVL(SKD_CNG_STS_CD, ' ') <> 'S'
                       AND    CLPT_SEQ >=
                                  (SELECT MAX(CLPT_SEQ)
                                   FROM   VSK_VSL_PORT_SKD
                                   WHERE  VSL_CD = A.VSL_CD
                                   AND    SKD_VOY_NO = A.SKD_VOY_NO
                                   AND    SKD_DIR_CD = A.SKD_DIR_CD
                                   AND    VPS_PORT_CD = A.POL_CD)))
#else 
SELECT 'Y'
FROM   BKG_VVD A
WHERE  A.BKG_NO = @[bkg_no]
AND    A.POD_CD IN(
           SELECT VPS_PORT_CD
           FROM   VSK_VSL_PORT_SKD
           WHERE  VSL_CD = A.VSL_CD
           AND    SKD_VOY_NO = A.SKD_VOY_NO
           AND    SKD_DIR_CD = A.SKD_DIR_CD
           AND    CLPT_IND_SEQ = '1'
           AND    CLPT_SEQ >=
                      (SELECT MIN(CLPT_SEQ)
                       FROM   VSK_VSL_PORT_SKD
                       WHERE  VSL_CD = A.VSL_CD
                       AND    SKD_VOY_NO = A.SKD_VOY_NO
                       AND    SKD_DIR_CD = A.SKD_DIR_CD
                       AND    VPS_PORT_CD LIKE 'CA%'
                       AND    NVL(SKD_CNG_STS_CD, ' ') <> 'S'
                       AND    CLPT_SEQ >=
                                  (SELECT MAX(CLPT_SEQ)
                                   FROM   VSK_VSL_PORT_SKD
                                   WHERE  VSL_CD = A.VSL_CD
                                   AND    SKD_VOY_NO = A.SKD_VOY_NO
                                   AND    SKD_DIR_CD = A.SKD_DIR_CD
                                   AND    VPS_PORT_CD = A.POL_CD)))
#end			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="KORZC055229" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
