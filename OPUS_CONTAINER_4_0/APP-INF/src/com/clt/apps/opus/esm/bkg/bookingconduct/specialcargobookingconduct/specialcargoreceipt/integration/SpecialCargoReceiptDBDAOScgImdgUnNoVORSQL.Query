<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SpecialCargoReceiptDBDAOScgImdgUnNoVORSQL">
			<desc><![CDATA[ScgImdgUnNoVO]]></desc>
			<sql><![CDATA[
SELECT 
B1.IMDG_UN_NO
,	B1.IMDG_UN_NO_SEQ
,	B1.PRP_SHP_NM
,	B1.IMDG_CLSS_CD
,	B1.IMDG_COMP_GRP_CD
,	B1.IMDG_SUBS_RSK_LBL_RMK
,	B1.IMDG_MRN_POLUT_CD
,	B1.IMDG_PCK_GRP_CD
,	B1.IMDG_LMT_QTY
,	B1.IMDG_LMT_QTY_MEAS_UT_CD
,	B1.IMDG_EXPT_QTY_CD
,	B1.IMDG_EMER_NO
,	B1.IMDG_STWG_CATE_CD
,	B1.FLSH_PNT_TEMP_CTNT
,	B1.EMER_RSPN_GID_NO
,	B1.EMER_RSPN_GID_CHR_NO
,	B1.PSA_NO
,	B1.N1ST_BOM_PORT_TRST_NO
,	B1.N2ND_BOM_PORT_TRST_NO
,	B1.N3RD_BOM_PORT_TRST_NO
,	B1.N4TH_BOM_PORT_TRST_NO
,	B1.PKG_AUTH_NO
,	B1.LK_PORT_AUTH_NO
,	B1.IMDG_SBST_PPT_DESC
,	B1.CFR_RPT_QTY
,	B1.CFR_PSN_INH_ZN_CD
,	B1.CFR_TOXC_CD
,	B1.CFR_DG_WET_CD
,	B1.CFR_RSTR_PORT_NM
,	B1.CFR_RSTR_OPR_NM
,	B1.CFR_XTD_CLSS_CD
,	B1.HCDG_FLG
,	B1.HCDG_DPND_QTY_FLG
,	B1.HCDG_RMK
,	B1.N1ST_IMDG_PCK_INSTR_CD
,	B1.N2ND_IMDG_PCK_INSTR_CD
,	B1.N3RD_IMDG_PCK_INSTR_CD
,	B1.N1ST_IMDG_PCK_PROVI_CD
,	B1.N2ND_IMDG_PCK_PROVI_CD
,	B1.N3RD_IMDG_PCK_PROVI_CD
,	B1.N4TH_IMDG_PCK_PROVI_CD
,	B1.N5TH_IMDG_PCK_PROVI_CD
,	B1.N1ST_IMDG_IBC_INSTR_CD
,	B1.N2ND_IMDG_IBC_INSTR_CD
,	B1.N3RD_IMDG_IBC_INSTR_CD
,	B1.N4TH_IMDG_IBC_INSTR_CD
,	B1.N5TH_IMDG_IBC_INSTR_CD
,	B1.N1ST_IMDG_IBC_PROVI_CD
,	B1.N2ND_IMDG_IBC_PROVI_CD
,	B1.N3RD_IMDG_IBC_PROVI_CD
,	B1.N4TH_IMDG_IBC_PROVI_CD
,	B1.N5TH_IMDG_IBC_PROVI_CD
,	B1.N1ST_IMDG_UN_TNK_INSTR_CD
,	B1.N2ND_IMDG_UN_TNK_INSTR_CD
,	B1.N1ST_IMDG_TNK_INSTR_PROVI_CD
,	B1.N2ND_IMDG_TNK_INSTR_PROVI_CD
,	B1.N3RD_IMDG_TNK_INSTR_PROVI_CD
,	B1.N4TH_IMDG_TNK_INSTR_PROVI_CD
,	B1.N5TH_IMDG_TNK_INSTR_PROVI_CD
,	B1.HCDG_PCK_RSTR_DESC
,	B1.HCDG_INTMD_BC_RSTR_DESC
,	B1.HCDG_TNK_RSTR_DESC
,	B1.SEGR_DESC
,	B1.CLR_LIV_QTR_STWG_FLG
,	B1.IMDG_FD_STUF_STWG_CD
,	B1.IMDG_HT_SRC_STWG_CD
,	B1.SEGR_AS_FOR_IMDG_CLSS_FLG
,	B1.SEGR_AS_FOR_IMDG_CLSS_CD
,	B1.AWAY_FM_IMDG_CLSS_FLG
,	B1.SPRT_FM_IMDG_CLSS_FLG
,	B1.AWAY_FM_IMDG_SEGR_GRP_FLG
,	B1.SPRT_FM_IMDG_SEGR_GRP_FLG
,	B1.IMDG_TBL_NO
,	B1.IMDG_UN_NO_HLD_FLG
,	B1.CRE_USR_ID
,	B1.CRE_DT
,	B1.UPD_USR_ID
,	B1.UPD_DT
,	B1.IMDG_LMT_QTY_DESC
,	B1.IMDG_EXPT_QTY_DESC
,	B2.IMDG_SPCL_PROVI_NO
,   B4.IMDG_TEC_NM
,   B4.IMDG_CTRL_TEMP
,   B4.IMDG_EMER_TEMP
,	CONCAT(B1.IMDG_LMT_QTY, B1.IMDG_LMT_QTY_MEAS_UT_CD) LIMITED_QTY
,	(SELECT IMDG_SUBS_RSK_LBL_CD FROM (SELECT ROW_NUMBER() OVER (PARTITION BY IMDG_UN_NO, IMDG_UN_NO_SEQ ORDER BY IMDG_SUBS_RSK_LBL_CD) RNUM, IMDG_UN_NO, IMDG_UN_NO_SEQ, IMDG_SUBS_RSK_LBL_CD FROM SCG_IMDG_SUBS_RSK_LBL WHERE IMDG_SUBS_RSK_LBL_CD <> 0) WHERE IMDG_UN_NO = B1.IMDG_UN_NO AND IMDG_UN_NO_SEQ = B1.IMDG_UN_NO_SEQ AND rnum =1) SRL1
,	(SELECT IMDG_SUBS_RSK_LBL_CD FROM (SELECT ROW_NUMBER() OVER (PARTITION BY IMDG_UN_NO, IMDG_UN_NO_SEQ ORDER BY IMDG_SUBS_RSK_LBL_CD) RNUM, IMDG_UN_NO, IMDG_UN_NO_SEQ, IMDG_SUBS_RSK_LBL_CD FROM SCG_IMDG_SUBS_RSK_LBL WHERE IMDG_SUBS_RSK_LBL_CD <> 0) WHERE IMDG_UN_NO = B1.IMDG_UN_NO AND IMDG_UN_NO_SEQ = B1.IMDG_UN_NO_SEQ AND rnum =2) SRL2
,	(SELECT IMDG_SUBS_RSK_LBL_CD FROM (SELECT ROW_NUMBER() OVER (PARTITION BY IMDG_UN_NO, IMDG_UN_NO_SEQ ORDER BY IMDG_SUBS_RSK_LBL_CD) RNUM, IMDG_UN_NO, IMDG_UN_NO_SEQ, IMDG_SUBS_RSK_LBL_CD FROM SCG_IMDG_SUBS_RSK_LBL WHERE IMDG_SUBS_RSK_LBL_CD <> 0) WHERE IMDG_UN_NO = B1.IMDG_UN_NO AND IMDG_UN_NO_SEQ = B1.IMDG_UN_NO_SEQ AND rnum =3) SRL3
,	(SELECT IMDG_SUBS_RSK_LBL_CD FROM (SELECT ROW_NUMBER() OVER (PARTITION BY IMDG_UN_NO, IMDG_UN_NO_SEQ ORDER BY IMDG_SUBS_RSK_LBL_CD) RNUM, IMDG_UN_NO, IMDG_UN_NO_SEQ, IMDG_SUBS_RSK_LBL_CD FROM SCG_IMDG_SUBS_RSK_LBL WHERE IMDG_SUBS_RSK_LBL_CD <> 0) WHERE IMDG_UN_NO = B1.IMDG_UN_NO AND IMDG_UN_NO_SEQ = B1.IMDG_UN_NO_SEQ AND rnum =4) SRL4
,  (
    SELECT
      A2.CRR_CD
    FROM BKG_VVD A1 ,
      MDM_VSL_CNTR A2 ,
      SCG_IMDG_CRR_RSTR A3
    WHERE A1.VSL_CD = A2.VSL_CD
      AND A1.BKG_NO = @[bkg_no]
      AND A2.CRR_CD = A3.VSL_OPR_TP_CD
      AND A3.IMDG_CRR_RSTR_EXPT_CD = 'R'
      AND B1.IMDG_UN_NO = NVL(A3.IMDG_UN_NO, B1.IMDG_UN_NO)
      AND B1.IMDG_UN_NO_SEQ  = NVL(A3.IMDG_UN_NO_SEQ , B1.IMDG_UN_NO_SEQ)
      AND B1.IMDG_CLSS_CD = NVL(A3.IMDG_CLSS_CD,B1.IMDG_CLSS_CD)
      AND ROWNUM =1 ) CRR_CD
,	SEGR.IMDG_SEGR_GRP_NOS
,	B1.IMDG_AMDT_NO
,	B1.CFR_FLG
,   B1.PRP_SHP_NM_VAR_RMK
FROM SCG_IMDG_UN_NO B1
,SCG_IMDG_UN_NO_SPCL_PROVI B2
,SCG_IMDG_UN_NO_ORG_RACT B4
,(SELECT IMDG_UN_NO, LISTAGG(IMDG_SEGR_GRP_NO, ',') WITHIN GROUP (ORDER BY IMDG_SEGR_GRP_NO) AS IMDG_SEGR_GRP_NOS
FROM SCG_IMDG_SEGR_GRP_DTL
GROUP BY IMDG_UN_NO) SEGR
WHERE B1.IMDG_UN_NO = B2.IMDG_UN_NO (+)
AND B1.IMDG_UN_NO = B4.IMDG_UN_NO (+)
AND B1.IMDG_UN_NO_SEQ = B2.IMDG_UN_NO_SEQ (+)
AND B1.IMDG_UN_NO_SEQ = B4.IMDG_UN_NO_SEQ (+)   
AND B2.IMDG_SPCL_PROVI_NO(+) IN( 274,318)
AND	B1.IMDG_UN_NO LIKE @[imdg_un_no]||'%'
AND	UPPER(B1.PRP_SHP_NM) LIKE '%'||@[prp_shp_nm]||'%'
AND	B1.IMDG_CLSS_CD LIKE @[imdg_clss_cd]||'%'
#if(${imdg_amdt_no} != '')
AND DECODE(B1.CFR_FLG, 'Y', @[imdg_amdt_no], B1.IMDG_AMDT_NO) = @[imdg_amdt_no]
#end
AND B1.IMDG_UN_NO = SEGR.IMDG_UN_NO(+)
#if(${imdg_un_no_seq} != '')
AND B1.IMDG_UN_NO_SEQ = @[imdg_un_no_seq]
#end
ORDER BY B1.IMDG_UN_NO, B1.IMDG_UN_NO_SEQ			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="imdg_un_no" type="12" value="" out="N"/>
				<param name="prp_shp_nm" type="12" value="" out="N"/>
				<param name="imdg_clss_cd" type="12" value="" out="N"/>
				<param name="imdg_amdt_no" type="12" value="" out="N"/>
				<param name="imdg_un_no_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
