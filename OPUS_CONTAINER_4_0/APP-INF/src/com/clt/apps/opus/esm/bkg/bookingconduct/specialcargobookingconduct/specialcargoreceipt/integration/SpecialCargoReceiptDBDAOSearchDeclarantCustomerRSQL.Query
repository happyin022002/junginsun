<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SpecialCargoReceiptDBDAOSearchDeclarantCustomerRSQL">
			<desc><![CDATA[DG Declarant Customer 정보를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT DG.BKG_NO
    ,DG.DCGO_SEQ
    ,DG.DG_CNTR_SEQ
    ,DG.CNTR_CGO_SEQ
    ,DG.CNTR_NO
    ,NVL(S.DECL_NM,C.DECL_NM) AS DECL_NM
    ,S.DG_DECL_SEQ		AS SH_DG_DECL_SEQ
    ,S.CUST_CNT_CD      AS SH_CUST_CNT_CD
    ,S.CUST_SEQ         AS SH_CUST_SEQ
    ,S.CUST_NM          AS SH_CUST_NM
    ,S.CUST_ADDR        AS SH_CUST_ADDR
    ,S.CUST_CTY_NM      AS SH_CUST_CTY_NM
    ,S.CUST_ZIP_ID      AS SH_CUST_ZIP_ID
    ,S.CUST_STE_CD      AS SH_CUST_STE_CD
    ,S.CSTMS_DECL_CNT_CD    AS SH_CSTMS_DECL_CNT_CD
    ,S.PHN_NO           AS SH_PHN_NO
    ,S.CUST_FAX_NO      AS SH_CUST_FAX_NO
    ,S.CUST_EML         AS SH_CUST_EML
    ,C.DG_DECL_SEQ		AS CN_DG_DECL_SEQ    --
    ,C.CUST_CNT_CD      AS CN_CUST_CNT_CD
    ,C.CUST_SEQ         AS CN_CUST_SEQ
    ,C.CUST_NM          AS CN_CUST_NM
    ,C.CUST_ADDR        AS CN_CUST_ADDR
    ,C.CUST_CTY_NM      AS CN_CUST_CTY_NM
    ,C.CUST_ZIP_ID      AS CN_CUST_ZIP_ID
    ,C.CUST_STE_CD      AS CN_CUST_STE_CD
    ,C.CSTMS_DECL_CNT_CD    AS CN_CSTMS_DECL_CNT_CD
    ,C.PHN_NO           AS CN_PHN_NO
    ,C.CUST_FAX_NO      AS CN_CUST_FAX_NO
    ,C.CUST_EML         AS CN_CUST_EML
    ,(SELECT TEMP_DG.SEQ 
	  FROM (SELECT DG_CNTR_SEQ, RANK()OVER(ORDER BY DG_CNTR_SEQ) SEQ  
			FROM BKG_DG_CGO 
			WHERE BKG_NO = @[bkg_no] 
			GROUP BY DG_CNTR_SEQ
		   ) TEMP_DG 
	  WHERE TEMP_DG.DG_CNTR_SEQ = DG.DG_CNTR_SEQ) AS DG_CNTR_ORD_SEQ
FROM BKG_DG_CGO DG, BKG_DG_DECL S, BKG_DG_DECL C
WHERE DG.BKG_NO		= S.BKG_NO(+)
  AND DG.DG_CNTR_SEQ= S.DG_CNTR_SEQ(+)
  AND DG.BKG_NO		= C.BKG_NO(+)
  AND DG.DG_CNTR_SEQ= C.DG_CNTR_SEQ(+)
  AND DG.BKG_NO		= @[bkg_no]
  AND DG.DG_CNTR_SEQ	= @[dg_cntr_seq]
  AND S.BKG_CUST_TP_CD(+) = 'S'  --S:SHIPPER
  AND C.BKG_CUST_TP_CD(+) = 'C'  --C:CONSIGNEE
  AND ROWNUM = 1			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="dg_cntr_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
