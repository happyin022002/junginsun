<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PreCMSimulationDBDAOSearchBkgRmk4007ListRSQL">
			<desc><![CDATA[]]></desc>
			<sql><![CDATA[
SELECT NOD_CD 
      ,GRP 
      ,STND_COST_CD 
      ,STND_COST_NM 
      ,COA_COST_SRC_CD
      ,COA_COST_SRC_NM 
      ,CNTR_TPSZ_CD  
      ,AMT_A
      ,AMT_B
      ,CTRT_RTN_FLG 
      ,COST_CALC_RMK
	  ,MIS_AVG_FLG
FROM (
    SELECT A4.NOD_CD  NOD_CD
        ,A1.COST_ACT_GRP_SEQ  
        ,COA_GET_COM_NM_FNC('COST_ACT_GRP_CD', A1.COST_ACT_GRP_CD) GRP 
        ,A1.STND_COST_CD  
        ,A2.STND_COST_NM 
        ,A1.COA_COST_SRC_CD
        ,COA_GET_COM_NM_FNC('COA_COST_SRC_CD', A1.COA_COST_SRC_CD) COA_COST_SRC_NM -- 2011.01.11 이윤정 [CHM-201108216-01] TMFDFL 계정에 대해서 TMFDMT으로 변환하여 보여주는 부분을 제거.
        ,A1.CNTR_TPSZ_CD
        ,NVL(A1.ESTM_USD_TTL_AMT,0)																AMT_A
        ,NVL(DECODE(A1.STND_COST_CD,'51102001', A1.ESTM_USD_TTL_AMT2, A1.ESTM_USD_TTL_AMT),0)	AMT_B
        ,DECODE(CTRT_RTN_FLG, 'Y', 'Contract','L', 'Actual', 'Average') CTRT_RTN_FLG 
        ,CASE  
            WHEN REGEXP_LIKE(A1.COST_CALC_RMK, '^>T[RE]S AVG-') THEN 
                 SUBSTR(A1.COST_CALC_RMK, 2, 12) || ' -> ' || ROUND(ESTM_USD_UC_AMT, 2)
            WHEN A1.STND_COST_CD IN ('51102001') THEN 
                 DECODE('A' ,'B',SUBSTR(A1.COST_CALC_RMK2, 1),SUBSTR(A1.COST_CALC_RMK, 1))
            ELSE DECODE(A1.COA_COST_SRC_CD  
                  ,'51601011', SUBSTR(A1.COST_CALC_RMK, 2)
                  ,REPLACE(A1.COST_CALC_RMK, '>TP', 'TP')  )  
          END AS COST_CALC_RMK
        ,ACCT_DP_SEQ  
		,DECODE(A1.COST_ASS_BSE_CD||A1.CTRT_RTN_FLG,'CN',1,0) MIS_AVG_FLG
    FROM COA_COM_COST_PARA A1  
        ,COA_STND_ACCT_V A2  
        ,(SELECT  DISTINCT COST_ACT_GRP_SEQ
                          ,COST_ACT_GRP_CD
                          ,N1ST_NOD_CD ORG_NOD_CD
                          ,COALESCE(N4TH_NOD_CD, N3RD_NOD_CD, N2ND_NOD_CD) DEST_NOD_CD
                          ,DECODE(N1ST_NOD_CD ,N2ND_NOD_CD, N1ST_NOD_CD
                                              , DECODE(N1ST_NOD_CD, NULL, ' ', N1ST_NOD_CD)
                                             || DECODE(N2ND_NOD_CD, NULL, ' ', ' -> ' || N2ND_NOD_CD)
                                             || DECODE(N3RD_NOD_CD, NULL, ' ', ' -> ' || N3RD_NOD_CD)
                                             || DECODE(N4TH_NOD_CD, NULL, ' ', ' -> ' || N4TH_NOD_CD) ) NOD_CD
            FROM  COA_COM_COST_PARA
           WHERE  PCTL_NO = @[f_pctl_no]
		   AND STND_COST_CD <> '51102001'
        ) A4  
   WHERE  A1.PCTL_NO = @[f_pctl_no]
     AND  COA_COST_SRC_PRT_CD IN ('CO', 'PA')   
     AND  STND_COST_TP_CD = 'C' 
     AND  A1.STND_COST_CD = A2.STND_COST_CD
     AND  A2.PA_VW = 'BKG'
--   AND  A1.STND_COST_CD <> '51701011'
     AND  A1.COST_ACT_GRP_SEQ = A4.COST_ACT_GRP_SEQ
     AND  A1.ESTM_USD_TTL_AMT <> 0 
#if (${f_cntr_tpsz_cd} != '') 
     AND  A1.CNTR_TPSZ_CD = @[f_cntr_tpsz_cd]
#end
    ) 
ORDER BY COST_ACT_GRP_SEQ, ACCT_DP_SEQ, CNTR_TPSZ_CD, 5, 9			]]></sql>
			<params>
				<param name="f_pctl_no" type="12" value="" out="N"/>
				<param name="f_cntr_tpsz_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
