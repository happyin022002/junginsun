<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingReceiptDBDAOSearchBdrLogRSQL">
			<desc><![CDATA[해당 route의 bdr 여부를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT route.vsl_cd||route.skd_voy_no||route.skd_dir_cd BDR_VVD
  FROM BKG_VVD_BDR_LOG bdr
     , (select VSL_CD, SKD_VOY_NO, SKD_DIR_CD
                , substr(ORG_NOD_CD, 1, 5)  pol
                , substr(DEST_NOD_CD, 1, 5) pod
                , nvl((select 'Y'
                         from prd_prod_ctl_mst trunk
                        where trunk.pctl_no         = route.pctl_no
                          and trunk.trnk_VSL_CD     = route.vsl_cd
                          AND trunk.trnk_SKD_VOY_NO = route.skd_voy_no
                          AND trunk.trnk_SKD_DIR_CD = route.skd_dir_cd), 'N') trnk_flg
                , org_clpt_ind_seq
                , dest_clpt_ind_seq
          from prd_prod_ctl_rout_dtl route
         where PCTL_IO_BND_CD = 'T'
           and TRSP_MOD_CD in ('VD', 'WD')
           and pctl_no = @[pctl_no]
         order by pctl_seq) route
 WHERE bdr.VSL_CD     = route.vsl_cd
   AND bdr.SKD_VOY_NO = route.skd_voy_no
   AND bdr.SKD_DIR_CD = route.skd_dir_cd
   AND bdr.POL_CD     = route.pol
   AND bdr.POD_CD     = NVL(route.pod, POD_CD)
   and bdr.pol_clpt_ind_seq = route.org_clpt_ind_seq
   and bdr.pod_clpt_ind_seq = route.dest_clpt_ind_seq
   and ((trnk_flg = 'Y' and (TRNK_AUTO_BDR_FLG = 'Y' or TRNK_MNL_BDR_FLG = 'Y' or TRNK_BDR_FLG = 'Y'))
       or
        (trnk_flg = 'N' and (FDR_AUTO_BDR_FLG  = 'Y' or FDR_MNL_BDR_FLG  = 'Y' or FDR_BDR_FLG  = 'Y')))
   AND ROWNUM = 1			]]></sql>
			<params>
				<param name="pctl_no" type="12" value="B1001120000372570001" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
