<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ArrivalNoticeDBDAOmergeBkgCustCdValCSQL">
			<desc><![CDATA[BKG_CUST_CD_VAL table 에 MDM_CUSTOMER 정보 입수시 MDM_CUSTOMER 와 MDM_CUST_ADDR 의 정보를 조회하여 
데이터를 merge]]></desc>
			<sql><![CDATA[
MERGE INTO BKG_CUST_CD_VAL a
 USING ( select @[cust_cnt_cd] cust_cnt_cd, @[cust_seq] cust_seq from dual ) b
 ON (a.cust_cnt_cd = b.cust_cnt_cd and a.cust_seq = b.cust_seq )
 WHEN MATCHED THEN
 update
 set
    VAL_CUST_NM = BKG_IB_CUST_NM_VAL_FNC(@[cust_cnt_cd], @[cust_lgl_eng_nm]),
    VAL_CUST_ADDR = NVL((
							SELECT /*+ INDEX_DESC(ADDR XPKMDM_CUST_ADDR) */
                                       ADDR.BZET_ADDR
                                  FROM MDM_CUST_ADDR ADDR
                                 WHERE ADDR.PRMRY_CHK_FLG = 'Y'
                                   AND ADDR.DELT_FLG = 'N'
                                   AND ADDR.CUST_CNT_CD = @[cust_cnt_cd]
                                   AND ADDR.CUST_SEQ = @[cust_seq]
                                   AND ADDR.ADDR_TP_CD ='1'
                                   AND ROWNUM = 1
					), VAL_CUST_ADDR ),
    NMD_CUST_FLG = NVL(@[nmd_cust_flg], NMD_CUST_FLG),
    DELT_FLG = @[delt_flg],
    upd_usr_id  = NVL(@[upd_usr_id], 'SYSTEM'),
 	upd_dt      = sysdate
 WHEN NOT MATCHED THEN
 insert
 (
    CUST_CNT_CD,
    CUST_SEQ,
    VAL_CUST_NM,
    VAL_CUST_ADDR,
    NMD_CUST_FLG,
    DELT_FLG,
    CRE_USR_ID,
    CRE_DT,
    UPD_USR_ID,
    UPD_DT
 )
 values
 (
 	@[cust_cnt_cd],
 	@[cust_seq],
 	BKG_IB_CUST_NM_VAL_FNC(@[cust_cnt_cd], @[cust_lgl_eng_nm]),
    (
        	SELECT /*+ INDEX_DESC(ADDR XPKMDM_CUST_ADDR) */
			ADDR.BZET_ADDR
		      FROM MDM_CUST_ADDR ADDR
                 WHERE ADDR.PRMRY_CHK_FLG = 'Y'
                   AND ADDR.DELT_FLG = 'N'
                   AND ADDR.CUST_CNT_CD = @[cust_cnt_cd]
                   AND ADDR.CUST_SEQ = @[cust_seq]
                   AND ADDR.ADDR_TP_CD ='1'
                   AND ROWNUM = 1
	),
 	NVL(@[nmd_cust_flg], 'N'),
 	@[delt_flg],
 	NVL(@[cre_usr_id], 'SYSTEM'),
 	SYSDATE,
 	NVL(@[upd_usr_id], 'SYSTEM'),
 	SYSDATE
 )			]]></sql>
			<params>
				<param name="cust_cnt_cd" type="12" value="" out="N"/>
				<param name="cust_seq" type="12" value="" out="N"/>
				<param name="cust_lgl_eng_nm" type="12" value="" out="N"/>
				<param name="nmd_cust_flg" type="12" value="" out="N"/>
				<param name="delt_flg" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
