<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MonthlyTargetVVDDBDAOSearchMonthlyTargetVVD0040Tab01RSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
WITH BASE AS (
    SELECT 
        COUNT(1) CNT
    FROM SAQ_MON_TGT_VVD M
    WHERE
            M.BSE_YR = @[year]
        AND M.BSE_QTR_CD = @[quarter]
#if (${trade} != '') 
        AND M.TRD_CD = @[trade] 
#end
#if (${bound} != '') 
	   AND M.DIR_CD = @[bound] 
#end
)
SELECT 
    DECODE(M.BSE_YR||M.BSE_QTR_CD, @[year]||@[quarter], 'R', 'I') IBFLAG,
    @[year] BSE_YR, @[quarter] BSE_QTR_CD, 
    M.TRD_CD, M.RLANE_CD, M.DIR_CD, 
    M.VSL_CD, M.SKD_VOY_NO, M.SKD_DIR_CD, 
    M.SPRT_GRP_CD, M.BSA_GRP_CD, 
    M.BSE_MON, M.BSE_WK, 
    M.SUB_TRD_CD, M.IOC_CD, M.VVD_SEQ, 
    M.FNL_BSA_CAPA,
    TO_CHAR(M.FNL_BSA_CAPA,'FM099999999990') AS STR_FNL_BSA_CAPA,
    TO_CHAR(M.LST_LODG_PORT_ETD_DT, 'YYYY/MM/DD HH24:MI:SS') LST_LODG_PORT_ETD_DT, 
    M.UPD_RMK, 
    M.LST_LODG_PORT_CD, 
    M.DELT_FLG, 
    M.TGT_VVD_STS_CD 
FROM SAQ_MON_TGT_VVD M
WHERE
        M.BSE_YR = @[year]
    AND (M.BSE_QTR_CD = @[quarter] OR ((SELECT CNT FROM BASE) = 0 AND M.BSE_QTR_CD = @[quarter] AND M.BSE_MON <> M.BSE_QTR_CD))
#if (${trade} != '') 
        AND M.TRD_CD = @[trade] 
#end
#if (${bound} != '') 
	   AND M.DIR_CD = @[bound] 
#end
ORDER BY M.TRD_CD,M.DIR_CD,M.SUB_TRD_CD, M.RLANE_CD, M.BSE_MON, M.BSE_WK, M.LST_LODG_PORT_ETD_DT			]]></sql>
			<params>
				<param name="year" type="12" value="" out="N"/>
				<param name="quarter" type="12" value="" out="N"/>
				<param name="trade" type="12" value="" out="N"/>
				<param name="bound" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
