<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="FACAuditDBDAOSearchFACCommListRSQL">
			<desc><![CDATA[SearchFACCommList]]></desc>
			<sql><![CDATA[
SELECT
      A.FAC_SEQ,
      CASE
      WHEN A.FRT_FWRD_CNT_CD = ''
        OR A.FRT_FWRD_CNT_CD = '*'
      THEN ''
      ELSE CONCAT(A.FRT_FWRD_CNT_CD, TO_CHAR (A.FRT_FWRD_SEQ, 'FM000000'))
       END                                                           AS FRT_FWRD_CNT_SEQ,
         (     SELECT
                      MAX (NVL (LTRIM (C.CUST_LGL_ENG_NM), ' '))
                 FROM MDM_CUSTOMER          C
                WHERE C.CUST_CNT_CD(+)      = A.FRT_FWRD_CNT_CD
                  AND C.CUST_SEQ(+)         = A.FRT_FWRD_SEQ
                  AND C.CNTR_DIV_FLG(+)     = 'Y'
         )                                                           AS CUST_LGL_ENG_NM,
         (     SELECT
                      MAX (NVL (B.BL_NO, ' '))
                 FROM AGT_COMM_BKG_INFO     B
                WHERE B.BKG_NO              = A.BKG_NO
         )                                                           AS BL_NO,
           A.BKG_NO                                                  AS BKG_NO,
		(     SELECT
		MAX (NVL (B.BKG_STS_CD, ' '))
		FROM BKG_BOOKING     B
		WHERE B.BKG_NO              = A.BKG_NO
		)                                                           AS BKG_STS_CD,
           TO_CHAR (A.VSL_DEP_DT, 'YYYYMMDD')                        AS VSL_DEP_DT,
      CASE
      WHEN SUBSTR (A.FAC_DIV_CD, 1, 1) = 'B'
       AND A.FAC_DIV_CD = 'BL'
      THEN A.ACT_COMM_AMT
      ELSE 0
       END                                                           AS BL_COMM_AMT,
           A.CURR_CD,
      CASE
      WHEN SUBSTR (A.FAC_DIV_CD, 1, 1) = 'B'
       AND A.FAC_DIV_CD <> 'BL'
      THEN A.ACT_COMM_AMT
      WHEN A.FAC_DIV_CD = 'DR'
      THEN A.ACT_COMM_AMT
      ELSE 0
       END                                                           AS ACT_COMM_AMT,
           NVL (A.BKG_BX_QTY, 0)                                     AS BKG_BX_QTY,
           NVL (A.FAC_BX_RT, 0)                                      AS FAC_BX_RT,
           NVL (A.BKG_TEU_QTY, 0)                                    AS BKG_TEU_QTY,
           NVL (A.FAC_TEU_RT, 0)                                     AS FAC_TEU_RT,
           NVL (A.BKG_FEU_QTY, 0)                                    AS BKG_FEU_QTY,
           NVL (A.FAC_FEU_RT, 0)                                     AS FAC_FEU_RT,
           NVL (A.BKG_RF_TEU_QTY, 0)                                 AS BKG_RF_TEU_QTY,
           NVL (A.FAC_RF_TEU_RT, 0)                                  AS FAC_RF_TEU_RT,
           NVL (A.BKG_RF_FEU_QTY, 0)                                 AS BKG_RF_FEU_QTY,
           NVL (A.FAC_RF_FEU_RT, 0)                                  AS FAC_RF_FEU_RT,
           NVL (A.BKG_SPCL_TEU_QTY, 0)                               AS BKG_SPCL_TEU_QTY,
           NVL (A.FAC_SPCL_TEU_RT, 0)                                AS FAC_SPCL_TEU_RT,
           NVL (A.BKG_SPCL_FEU_QTY, 0)                               AS BKG_SPCL_FEU_QTY,
           NVL (A.FAC_SPCL_FEU_RT, 0)                                AS FAC_SPCL_FEU_RT,
      CASE SUBSTR (A.FAC_DIV_CD, 1, 1)
      WHEN 'C'
      THEN A.ACT_COMM_AMT
      ELSE 0
       END                                                           AS CNTR_COMM_AMT,
           NVL (A.ACT_PRE_COMM_AMT, 0)                               AS ACT_PRE_COMM_AMT,
           NVL (A.ACT_IF_COMM_AMT, 0)                                AS ACT_IF_COMM_AMT,
           A.FAC_RMK,
           NVL (A.COMM_PROC_STS_CD, ' ')                             AS COMM_PROC_STS_CD,
           A.COMM_PROC_RSLT_RSN,
           NVL (TO_CHAR (A.FAC_IF_DT, 'YYYYMMDD'), ' ')              AS FAC_IF_DT,
           A.SLS_OFC_CD,
         (     SELECT
                      D.BKG_STS_CD
                 FROM BKG_BOOKING D
                WHERE A.BKG_NO = D.BKG_NO
         )                                                           AS BKG_STS_CD,
           A.BKG_NO,
           FAC_OFC_CD,
           AGMT_CNT_CD,
           AGMT_CUST_SEQ,
           AGMT_RT_SEQ,
           A.FAC_DIV_CD,
           SUBSTR (A.FAC_DIV_CD, 1, 1)                              AS FAC_DIV_CD_1,
           A.ACT_COMM_AMT                                           AS OLD_ACT_COMM_AMT,
           A.FAC_IF_USR_ID,
           TO_CHAR (A.FAC_IF_DT, 'yyyyMMddHH24miss')                AS FAC_IF_DT_1
      FROM AGT_FAC_COMM         A,
         (     SELECT
                      A.BKG_NO,
                      MIN (A.FAC_SEQ)     AS FAC_SEQ
                 FROM AGT_FAC_COMM         A
                WHERE 1=1
#if(${date_option} == 'E')
                  AND A.VSL_DEP_DT
                         BETWEEN TO_DATE (NVL(REPLACE(@[search_dt_fr],'-',''), '19000101'), 'YYYYMMDD')
                             AND TO_DATE (NVL(REPLACE(@[search_dt_to],'-',''), '29990101'), 'YYYYMMDD')+0.999999
#end
#if(${ofc_option} == 'S')
                  AND A.SLS_OFC_CD = @[agn_cd]
#else
                  AND A.AR_OFC_CD  = @[ar_ofc_cd]
#end
#if(${ff_cnt_cd} != '')
                  AND A.FRT_FWRD_CNT_CD     = SUBSTR(@[ff_cnt_cd], 1, 2)
                  AND A.FRT_FWRD_SEQ        = SUBSTR(@[ff_cnt_cd], 3)

#end
#if(${s_curr_cd} != '')
                  AND A.CURR_CD             = @[s_curr_cd]
#end
#if(${vvd} != '')
                  AND
                    ( A.COMM_VSL_CD 
                   || A.COMM_SKD_VOY_NO
                   || A.COMM_SKD_DIR_CD
                   || A.COMM_REV_DIR_CD
                    )
                    =
                    ( NVL (SUBSTR (@[vvd],  1, 4), A.COMM_VSL_CD)
	               || NVL (SUBSTR (@[vvd],  5, 4), A.COMM_SKD_VOY_NO)
                   || NVL (SUBSTR (@[vvd],  9, 1), A.COMM_SKD_DIR_CD)
                   || NVL (SUBSTR (@[vvd], 10, 1), A.COMM_REV_DIr_cd)
                    )
#end
#if( ${bl_nos} != '' || ${date_option} == 'C')
                  AND A.BKG_NO
                   IN
                    (     SELECT
                                 BKG_NO
                            FROM AGT_COMM_BKG_INFO
                           WHERE 1=1
#if( ${bl_nos} != '')
                             AND BL_NO
                              IN
                               ( ${bl_nos}
                               )
#end
#if(${date_option} == 'C')
                             AND BKG_CRE_DT
                         BETWEEN TO_DATE (NVL(REPLACE(@[search_dt_fr],'-',''), '19000101'), 'YYYYMMDD')
                             AND TO_DATE (NVL(REPLACE(@[search_dt_to],'-',''), '29990101'), 'YYYYMMDD')+0.999999
#end
                   )
#end
             GROUP BY A.BKG_NO
         )                       B
     WHERE A.BKG_NO              = B.BKG_NO
       AND A.FAC_SEQ             = B.FAC_SEQ
  ORDER BY CONCAT (A.FRT_FWRD_CNT_CD, A.FRT_FWRD_SEQ),
           CUST_LGL_ENG_NM			]]></sql>
			<params>
				<param name="search_dt_fr" type="12" value="" out="Y"/>
				<param name="search_dt_to" type="12" value="" out="Y"/>
				<param name="agn_cd" type="12" value="" out="Y"/>
				<param name="ar_ofc_cd" type="12" value="" out="Y"/>
				<param name="ff_cnt_cd" type="12" value="" out="Y"/>
				<param name="s_curr_cd" type="12" value="" out="Y"/>
				<param name="vvd" type="12" value="" out="Y"/>
			</params>
		</query>
	</querys>
</sqls>
