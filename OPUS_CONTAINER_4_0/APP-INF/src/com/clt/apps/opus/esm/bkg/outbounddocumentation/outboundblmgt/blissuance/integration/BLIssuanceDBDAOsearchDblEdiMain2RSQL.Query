<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLIssuanceDBDAOsearchDblEdiMain2RSQL">
			<desc><![CDATA[select]]></desc>
			<sql><![CDATA[
SELECT 'FFWD1:' || CASE 
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'SDIXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PHIXML' THEN
                      BKG_TOKEN_NL_FNC(FW.CUST_NM, 1, '*:&<>"\\/''")
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'LEHXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PKEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'PKCXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'LGEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 8) = 'CNLGEXML' OR SUBSTR(@[edi_receive_id], 1, 5) = 'EIXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'EIXMLC' THEN
                      BKG_TOKEN_NL_FNC(FW.CUST_NM, 1, '')
                    ELSE 
                      BKG_TOKEN_NL_FNC(FW.CUST_NM, 1, '*:')
                   END ||CHR(10)|| 
			 'FFWD2:' || CASE 
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'SDIXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PHIXML' THEN
                      BKG_TOKEN_NL_FNC(FW.CUST_NM, 2, '*:&<>"\\/''")
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'LEHXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PKEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'PKCXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'LGEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 8) = 'CNLGEXML' OR SUBSTR(@[edi_receive_id], 1, 5) = 'EIXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'EIXMLC' THEN
                      BKG_TOKEN_NL_FNC(FW.CUST_NM, 2, '')
                    ELSE 
                      BKG_TOKEN_NL_FNC(FW.CUST_NM, 2, '*:')
                   END ||CHR(10)||
			 'FFWD3:' || CASE 
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'SDIXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PHIXML' THEN
                      BKG_TOKEN_NL_FNC(FW.CUST_NM, 3, '*:&<>"\\/''")
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'LEHXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PKEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'PKCXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'LGEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 8) = 'CNLGEXML' OR SUBSTR(@[edi_receive_id], 1, 5) = 'EIXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'EIXMLC' THEN
                      BKG_TOKEN_NL_FNC(FW.CUST_NM, 3, '')
                    ELSE 
                      BKG_TOKEN_NL_FNC(FW.CUST_NM, 3, '*:')
                   END ||CHR(10)||
			 'FFWD4:' || CASE 
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'SDIXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PHIXML' THEN
                      BKG_TOKEN_NL_FNC(FW.CUST_NM, 4, '*:&<>"\\/''")
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'LEHXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PKEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'PKCXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'LGEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 8) = 'CNLGEXML' OR SUBSTR(@[edi_receive_id], 1, 5) = 'EIXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'EIXMLC' THEN
                      BKG_TOKEN_NL_FNC(FW.CUST_NM, 4, '')
                    ELSE 
                      BKG_TOKEN_NL_FNC(FW.CUST_NM, 4, '*:')
                   END ||CHR(10)||
			 'FFWD5:' || CASE 
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'SDIXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PHIXML' THEN
                      BKG_TOKEN_NL_FNC(FW.CUST_NM, 5, '*:&<>"\\/''")
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'LEHXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PKEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'PKCXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'LGEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 8) = 'CNLGEXML' OR SUBSTR(@[edi_receive_id], 1, 5) = 'EIXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'EIXMLC' THEN
                      BKG_TOKEN_NL_FNC(FW.CUST_NM, 5, '')
                    ELSE 
                      BKG_TOKEN_NL_FNC(FW.CUST_NM, 5, '*:')
                   END ||CHR(10)||
			 'FFWD_CITY_NM:' || FW.CUST_CTY_NM || CHR(10) ||
			 'FFWD_STAT_CD:' || FW.CUST_STE_CD || CHR(10) ||
			 'FFWD_ZIP_CD:' || FW.CUST_ZIP_ID || CHR(10) ||
			 'FFWD_CNT_CD:' || FW.CUST_CNT_CD || CHR(10) ||
			 'FF_IND:' || CHR(10)||
			 'EXPO1:' || CASE 
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'SDIXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PHIXML' THEN
                      BKG_TOKEN_NL_FNC(EX.CUST_NM, 1, '*:&<>"\\/''")
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'LEHXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PKEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'PKCXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'LGEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 8) = 'CNLGEXML' OR SUBSTR(@[edi_receive_id], 1, 5) = 'EIXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'EIXMLC' THEN
                      BKG_TOKEN_NL_FNC(EX.CUST_NM, 1, '')
                    ELSE 
                      BKG_TOKEN_NL_FNC(EX.CUST_NM, 1, '*:')
                   END ||CHR(10)||
			 'EXPO2:' || CASE 
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'SDIXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PHIXML' THEN
                      BKG_TOKEN_NL_FNC(EX.CUST_NM, 2, '*:&<>"\\/''")
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'LEHXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PKEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'PKCXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'LGEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 8) = 'CNLGEXML' OR SUBSTR(@[edi_receive_id], 1, 5) = 'EIXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'EIXMLC' THEN
                      BKG_TOKEN_NL_FNC(EX.CUST_NM, 2, '')
                    ELSE 
                      BKG_TOKEN_NL_FNC(EX.CUST_NM, 2, '*:')
                   END ||CHR(10)||
			 'EXPO3:' || CASE 
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'SDIXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PHIXML' THEN
                      BKG_TOKEN_NL_FNC(EX.CUST_NM, 3, '*:&<>"\\/''")
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'LEHXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PKEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'PKCXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'LGEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 8) = 'CNLGEXML' OR SUBSTR(@[edi_receive_id], 1, 5) = 'EIXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'EIXMLC' THEN
                      BKG_TOKEN_NL_FNC(EX.CUST_NM, 3, '')
                    ELSE 
                      BKG_TOKEN_NL_FNC(EX.CUST_NM, 3, '*:')
                   END ||CHR(10)||
			 'EXPO4:' || CASE 
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'SDIXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PHIXML' THEN
                      BKG_TOKEN_NL_FNC(EX.CUST_NM, 4, '*:&<>"\\/''")
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'LEHXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PKEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'PKCXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'LGEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 8) = 'CNLGEXML' OR SUBSTR(@[edi_receive_id], 1, 5) = 'EIXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'EIXMLC' THEN
                      BKG_TOKEN_NL_FNC(EX.CUST_NM, 4, '')
                    ELSE 
                      BKG_TOKEN_NL_FNC(EX.CUST_NM, 4, '*:')
                   END ||CHR(10)||
			 'EXPO5:' || CASE 
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'SDIXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PHIXML' THEN
                      BKG_TOKEN_NL_FNC(EX.CUST_NM, 5, '*:&<>"\\/''")
                    WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'LEHXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PKEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'PKCXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'LGEXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 8) = 'CNLGEXML' OR SUBSTR(@[edi_receive_id], 1, 5) = 'EIXML' OR 
                         SUBSTR(@[edi_receive_id], 1, 6) = 'EIXMLC' THEN
                      BKG_TOKEN_NL_FNC(EX.CUST_NM, 5, '')
                    ELSE 
                      BKG_TOKEN_NL_FNC(EX.CUST_NM, 5, '*:')
                   END ||CHR(10)||
			 'EXPO_CITY_NM:' || EX.CUST_CTY_NM || CHR(10) ||
			 'EXPO_STAT_CD:' || EX.CUST_STE_CD || CHR(10) ||
			 'EXPO_ZIP_CD:' || EX.CUST_ZIP_ID || CHR(10) ||
			 'EXPO_CNT_CD:' || EX.CUST_CNT_CD || CHR(10) ||
			 'EX_IND:' || CHR(10)||
			 'BLCOPY:' || ISS.BL_CPY_KNT || CHR(10)||
			 'BL_F_COPY:' || ISS.BL_CPY_KNT || CHR(10)||
			 'BL_C_COPY:' || '' || CHR(10)||
			 'BL_P_COPY:' || '' || CHR(10)||
			 'BL_UF_COPY:' || '' || CHR(10)||
			 'BLORG_TP:' || (SELECT CASE WHEN FRT_TERM_CD = 'YY' THEN 'F'
							             WHEN FRT_TERM_CD = 'YN' THEN 'P'
							             WHEN FRT_TERM_CD = 'NY' THEN 'C'
						            ELSE 'U' END
				 			 FROM 
								(             
								SELECT 
									MAX(DECODE(FRT_TERM_CD,'P','Y', 0))|| MAX(DECODE(FRT_TERM_CD,'C','Y', 0))  FRT_TERM_CD
								FROM BKG_CHG_RT
								WHERE 1=1
								  AND FRT_INCL_XCLD_DIV_CD ='N'
								  AND BKG_NO = @[bkg_no]
								)
							) || CHR(10)||
			 'BLORG:1' || CHR(10)||
			 'BLPKG:' || BL.PCK_QTY						|| CHR(10)||
			 'BLPKGU:' || BL.PCK_TP_CD							|| CHR(10)||
			 'BLWGT:' || BL.ACT_WGT					|| CHR(10)||
			 'BL_WGT_UNIT:' || BL.WGT_UT_CD						|| CHR(10)||
			 'BLNWGT:' || BL.ACT_WGT						|| CHR(10)||
			 'BL_NWGT_UNIT:' || BL.WGT_UT_CD						|| CHR(10)||
			 'BLMEA:' || BL.MEAS_QTY						|| CHR(10)||
			 'BL_MEA_UNIT:' || BL.MEAS_UT_CD						|| CHR(10)||
			 'BL_RDTYPE:' || BK.RCV_TERM_CD || BK.DE_TERM_CD	|| CHR(10)||
			 'CARGOTYPE:' || BK.BKG_CGO_TP_CD						|| CHR(10)||
			 'BL_CGO_TP_IND:' || CASE WHEN INSTR(BK.RCV_TERM_CD||BK.DE_TERM_CD,'S') > 0 THEN 'L' ELSE 'F' END || CHR(10) ||
			 'CARGO_RCPT_DT:' || (SELECT TO_CHAR(MAX(CTM.CNMV_EVNT_DT),'RRRRMMDDHH24MI') FROM BKG_CONTAINER CNTR, CTM_MOVEMENT CTM
								  WHERE 1=1
									AND CNTR.BKG_NO = BK.BKG_NO
									AND CNTR.CNTR_NO = CTM.CNTR_NO
									AND CNTR.CNMV_CYC_NO = CTM.CNMV_CYC_NO
									AND CTM.MVMT_STS_CD ='OC'
								  ) || CHR(10) ||
			 'COMMODITY:' || BK.CMDT_CD	|| '/' || (SELECT CMDT_NM FROM MDM_COMMODITY CMDT WHERE CMDT.CMDT_CD = BK.CMDT_CD)	|| CHR(10)||
			 'CMDT_CD:' || BK.CMDT_CD	|| CHR(10)||
			 'REMARK:' || CASE 
                      WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'SDIXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PHIXML' THEN
                        TO_CLOB(BKG_TOKEN_NL_FNC(BK.XTER_RMK, 0, '*:&<>"\\/''"))
                      WHEN SUBSTR(@[edi_receive_id], 1, 6) = 'LEHXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'PKEXML' OR 
                           SUBSTR(@[edi_receive_id], 1, 6) = 'PKCXML' OR SUBSTR(@[edi_receive_id], 1, 6) = 'LGEXML' OR 
                           SUBSTR(@[edi_receive_id], 1, 8) = 'CNLGEXML' OR SUBSTR(@[edi_receive_id], 1, 5) = 'EIXML' OR 
                           SUBSTR(@[edi_receive_id], 1, 6) = 'EIXMLC' THEN
                        TO_CLOB(BKG_TOKEN_NL_FNC(BK.XTER_RMK, 0, ''))
                      ELSE
                        TO_CLOB(BKG_TOKEN_NL_FNC(BK.XTER_RMK, 0, '*:'))
                    END ||CHR(10)||
			 'AUS_QUAR:' || CHR(10)||
			 'SRNBR:' || CHR(10)||
			 'BKGNBR:' || BK.BKG_NO || CHR(10)||
			 'MST_BKG:' || (SELECT DECODE(BKG_CRE_TP_CD,'S', FM_BKG_NO,BKG_NO) FROM BKG_BOOKING WHERE BKG_NO = BK.BKG_NO) || CHR(10)||
			 'FMC_NO:' || REFNO.FMC_NO || CHR(10) ||
			 'WAYBILL_IND:' || DECODE(BK.BL_TP_CD, 'W', 'T', 'F')		|| CHR(10)||
			 'CUSTREF_NUM:' || REFNO.SI_NO || CHR(10)||
			 'FINAL_ETA:' || @[final_eta] || CHR(10)||
			 'FINAL_ATA:' || @[final_eta] || CHR(10)||
			 'POR_ETD:' || (SELECT TO_CHAR(MAX(ESTM_DT), 'RRRRMMDDHH24MI', 'NLS_DATE_LANGUAGE=ENGLISH') AS DEL_EST_ARRIVAL_DATE
  							FROM SCE_COP_HDR HDR
							     ,SCE_COP_DTL DTL
							     ,BKG_BOOKING BK
							WHERE BK.BKG_NO = HDR.BKG_NO 
   							AND HDR.COP_NO = DTL.COP_NO
   							AND DTL.NOD_CD LIKE BK.POR_CD||'%'
   							AND HDR.COP_STS_CD IN ('C','T','F')
  							AND DTL.ACT_CD ='MOTYDO'
   							AND BK.BKG_NO =  @[bkg_no] ) || CHR(10)||
			 'POR_ATD:' || (SELECT TO_CHAR(MAX(ACT_DT), 'RRRRMMDDHH24MI', 'NLS_DATE_LANGUAGE=ENGLISH') AS DEL_EST_ARRIVAL_DATE
  							FROM SCE_COP_HDR HDR
							     ,SCE_COP_DTL DTL
							     ,BKG_BOOKING BK
							WHERE BK.BKG_NO = HDR.BKG_NO 
   							AND HDR.COP_NO = DTL.COP_NO
   							AND DTL.NOD_CD LIKE BK.POR_CD||'%'
   							AND HDR.COP_STS_CD IN ('C','T','F')
  							AND DTL.ACT_CD ='MOTYDO'
   							AND BK.BKG_NO =  @[bkg_no] ) || CHR(10)||
			 'CCT:' || (SELECT TO_CHAR(SYS_SET_DT,'RRRRMMDDHH24MI') FROM BKG_CLZ_TM
						  WHERE BKG_NO = @[bkg_no]
							AND CLZ_TP_CD ='T') || CHR(10)||
			 'FUNC_CODE:' || @[func_code] || CHR(10)||
			 'ONBOARD:' || NVL(TO_CHAR(BL.BL_OBRD_DT, 'RRRRMMDD'), VL.VPS_ETD_DT)		|| CHR(10)||
			 'APPLICATION_DT:' || TO_CHAR(RT.RT_APLY_DT, 'RRRRMMDD')		|| CHR(10)||
			 'INV_NO:' || REFNO.INV_NO || CHR(10)||
			 'BLINFO_DOCNO:' || DECODE(BL.BDR_CNG_FLG, 'N', NULL, 'C/A') || '  ' ||NVL(REFNO.PSA_NO, REFNO.REF_NO) || CHR(10)||
			 'BLINFO_EXPDEC:' || BK.SI_FLG || CHR(10)||
			 'BLINFO_ORGIN_CD:' || BK.POL_CD || CHR(10)||
			 'BLINFO_ORGIN:' || BL.ORG_CNT_NM || CHR(10)||
			 'BLINFO_POINT:' || DECODE(RTRIM(REFNO.FMC_NO), '', NULL, 'FMC' || SUBSTR(REFNO.FMC_NO, 1, 6))	|| CHR(10)||
			 'BLINFO_POR:' || BL.POR_NM || CHR(10)||
			 'BLINFO_PREVSL:' || BL.PRE_VSL_NM || CHR(10)||
			 'BLINFO_VVD:' || BL.VSL_NM || CHR(10)||
			 'BLINFO_POL:' || BL.POL_NM || CHR(10)||
			 'BLINFO_MOVE:' || BL.BL_MV_TP_NM || CHR(10)||
			 'BLINFO_POD:' || BL.POD_NM || CHR(10)||
			 'BLINFO_DEL:' || BL.DEL_NM || CHR(10)||
			 'BLINFO_FDEST:'	|| BL.FNL_DEST_NM || CHR(10)||
			 'BLINFO_FRTIND:' || DECODE(RT.FRT_TERM_CD, 'P', '=FREIGHT PREPAID=', 'C', '=FREIGHT COLLECT=', NULL)  || CHR(10)||
			 'BLINFO_RCVTERM:' || DECODE(BK.RCV_TERM_CD, 'S', 'CFS'
			                                           , 'Y', 'CY'
			                                           , 'D', 'DOOR'
			                                           , 'T', 'TACKLE'
			                                           , 'I', 'FREE IN'
			                                           , 'O', 'FREE OUT'
			                                           , 'H', 'CY'
			                                           , 'M', '*'
			                                           ,BK.RCV_TERM_CD)	|| CHR(10)||
			 'BLINFO_DLVTERM:'|| DECODE(BK.DE_TERM_CD, 'S', 'CFS'
			                                         , 'Y', 'CY'
			                                         , 'D', 'DOOR'
			                                         , 'T', 'TACKLE'
			                                         , 'I', 'FREE IN'
			                                         , 'O', 'FREE OUT'
			                                         , 'H', 'CY'
			                                         , 'M', '*'
			                                         , BK.DE_TERM_CD)	|| CHR(10)||
			 'BLINFO_BKGSTS:'|| DECODE(BK.BKG_STS_CD, 'X', '** CANCELED **'
			                                        , DECODE(BK.BL_TP_CD, 'W', '** SEA WAYBILL **'
			                                        , DECODE(BK.BL_NO_TP, '0', ''
			                                                                                         , '** MEMO **')
			                                                                 , ''))	|| CHR(10)||
			 'BLINFO_PKG:' || BKG_TOKEN_NL_FNC(BL.TTL_PCK_DESC, 0, '')	|| CHR(10)||
			 'BLINFO_NOTP:'	|| DECODE(BL.BL_OBRD_TP_CD, 'L', 'LADEN ON BOARD THE VESSEL'
			                                          , 'R', 'RECEIVED FOR SHIPMENT'
			                                          , 'O', 'ON BOARD'
			                                          , 'A', 'ON BOARD THE RAIL'
			                                          , 'B', 'ON BOARD THE BARGE'
			                                          , 'T', 'ON BOARD THE TRUCK'
			                                          , 'S', 'SHIPPED ON BOARD'
			                                          ,NULL) || CHR(10)||
			 'BLINFO_ONDATE:' || TO_CHAR(BL.BL_OBRD_DT, 'DDMonYY', 'NLS_DATE_LANGUAGE = American') || CHR(10)||
			 'BLINFO_USER:' || SCR.USR_NM || CHR(10)||
			 'BLINFO_ISSUELOC_CD:' || OFC.LOC_CD || CHR(10)||
			 'BLINFO_ISSUELOC:' || CASE WHEN LOC.LOC_NM||CNT.CNT_CD IS NULL THEN ''
									    ELSE LOC.LOC_NM	||' , '||CNT.CNT_CD
                                   END ||CHR(10)||
			 'BLINFO_COPY:' || DECODE(ISS.OBL_ISS_KNT, 0, 'NONE'
			                                         , 1, 'ONE , (1)'
			                                         , 2, 'TWO , (2)'
			                                         , 3, 'THREE , (3)'
			                                         , 4, 'FOUR , (4)'
			                                         , 5, 'FIVE , (5)'
			                                         , 6, 'SIX , (6)'
			                                         , NULL) || CHR(10)||
			 'BLINFO_ISSUEDATE:' || TO_CHAR(ISS.OBL_ISS_DT, 'DDMonYY', 'NLS_DATE_LANGUAGE = American') || CHR(10)||
			 'BKG_STF:' || BK.DOC_USR_ID || CHR(10)||
			 'CONTACT_NAME:' || CP.CNTC_PSON_NM || CHR(10)||
			 'CONTACT_TEL:'		|| CP.CNTC_PSON_PHN_NO || CHR(10)||
			 'CONTACT_MOBILE:' || CP.CNTC_PSON_MPHN_NO || CHR(10)||
			 'BKG_LC_NO:' || REFNO.LC_NO || CHR(10)||
			 'OBLPRT:' || DECODE(ISS.OBL_PRN_FLG, 'N', '', ISS.OBL_PRN_FLG) || CHR(10)||
			 'TRAN_TP:' || DECODE(BK.RCV_TERM_CD, 'Y','CY','S','CFS','D','DOOR','')|| CHR(10)||
			 'EQPICKDT:' ||TO_CHAR(BK.MTY_PKUP_DT,'RRRRMMDDHH24MI') || CHR(10)|| 
			 'BKG_OFC:' || BK.BKG_OFC_CD || CHR(10)||
			 'BLKSTWG:' || BK.BLCK_STWG_CD || CHR(10)
  FROM BKG_BOOKING BK
      ,BKG_BL_DOC BL
      ,BKG_BL_ISS ISS
      ,BKG_RATE RT
      ,(SELECT BKG_NO
              ,MAX(DECODE(BKG_REF_TP_CD, 'EBRF', CUST_REF_NO_CTNT)) AS REF_NO
              ,MAX(DECODE(BKG_REF_TP_CD, 'ESRF', CUST_REF_NO_CTNT)) AS SI_NO
              ,MAX(DECODE(BKG_REF_TP_CD, 'HINV', CUST_REF_NO_CTNT)) AS INV_NO
              ,MAX(DECODE(BKG_REF_TP_CD, 'LCNO', CUST_REF_NO_CTNT)) AS LC_NO
              ,MAX(DECODE(BKG_REF_TP_CD, 'FMCN', CUST_REF_NO_CTNT)) AS FMC_NO
              ,MAX(DECODE(BKG_REF_TP_CD, 'PSAN', CUST_REF_NO_CTNT)) AS PSA_NO
          FROM BKG_REFERENCE   
         WHERE 1=1
           AND BKG_NO = @[bkg_no]
         GROUP BY BKG_NO) REFNO
      ,BKG_CUSTOMER FW
      ,BKG_CUSTOMER EX
      ,COM_USER SCR
      ,MDM_COUNTRY CNT
      ,MDM_ORGANIZATION OFC
      ,MDM_LOCATION LOC
      ,BKG_CNTC_PSON CP
      ,(SELECT BKG_NO
              ,TO_CHAR(VPS_ETD_DT, 'RRRRMMDD') AS VPS_ETD_DT
          FROM (SELECT VVD.BKG_NO
                      ,VSK.VPS_ETD_DT
                  FROM BKG_VVD VVD
                      ,VSK_VSL_PORT_SKD VSK
                 WHERE VVD.BKG_NO = @[bkg_no]
                   AND (VVD.VSL_PRE_PST_CD || VVD.VSL_SEQ) IN ('S1', 'T0')
                   AND VVD.VSL_CD = VSK.VSL_CD
                   AND VVD.SKD_VOY_NO = VSK.SKD_VOY_NO
                   AND VVD.SKD_DIR_CD = VSK.SKD_DIR_CD
                   AND VSK.AUTO_SKD_CNG_FLG <> 'S'
                   AND VVD.POL_CD = VSK.VPS_PORT_CD
                   AND VVD.POL_CLPT_IND_SEQ = CLPT_IND_SEQ
--                   AND NVL(VVD.POL_CLPT_IND_SEQ, 1) = VSK.CLPT_SEQ
                 ORDER BY VVD.VSL_PRE_PST_CD
                      ,VVD.VSL_SEQ
              )
         WHERE ROWNUM = 1) VL
 WHERE BK.BKG_NO = @[bkg_no]
   AND BK.BKG_NO = BL.BKG_NO
   AND BK.BKG_NO = RT.BKG_NO(+)
   AND BK.BKG_NO = CP.BKG_NO(+)
   AND CP.BKG_CNTC_PSON_TP_CD(+) = 'BK'
   AND BK.BKG_NO = REFNO.BKG_NO(+)
   AND BK.BKG_NO = ISS.BKG_NO(+)
   AND BK.BKG_NO = FW.BKG_NO(+)
   AND FW.BKG_CUST_TP_CD(+) = 'F'
   AND BK.BKG_NO = EX.BKG_NO(+)
   AND EX.BKG_CUST_TP_CD(+) = 'E'
   AND ISS.OBL_ISS_USR_ID = SCR.USR_ID(+)
   AND ISS.OBL_ISS_OFC_CD = OFC.OFC_CD(+)
   AND OFC.LOC_CD = LOC.LOC_CD(+)
   AND LOC.CNT_CD = CNT.CNT_CD(+)
   AND BK.BKG_NO = VL.BKG_NO(+)			]]></sql>
			<params>
				<param name="edi_receive_id" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="final_eta" type="12" value="" out="N"/>
				<param name="func_code" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
