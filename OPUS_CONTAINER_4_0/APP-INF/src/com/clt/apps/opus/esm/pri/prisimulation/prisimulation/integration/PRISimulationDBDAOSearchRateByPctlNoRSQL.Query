<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PRISimulationDBDAOSearchRateByPctlNoRSQL">
			<desc><![CDATA[retrieving summarized rate]]></desc>
			<sql><![CDATA[
SELECT X.*
  FROM (
        SELECT 
                 PCTL_NO
                 ,CNTR_SZ_CD AS ORG_CNTR_SZ_CD
                 ,(SELECT CNTR_SZ_CD ||'0' 
                     FROM MDM_CNTR_TP_SZ 
                    WHERE CNTR_TPSZ_CD = RT.CNTR_SZ_CD 
                      AND DELT_FLG = 'N'
                      AND ROWNUM =1 ) AS CNTR_SZ_CD
                ,CMDT_CD AS GRP_CMDT
                ,CMDT_CD
                ,CMDT_SEQ
                ,'' AS GRP_CMDT_NM
                ,(SELECT CMDT_NM FROM MDM_COMMODITY WHERE CMDT_CD = RT.CMDT_CD) CMDT_NM
                ,RT_SEQ
                ,FRT_TERM_CD
                ,CGO_CATE_CD
                ,IMDG_CLSS_CD
                ,CHG_CD
                ,CURR_CD
                ,RAT_UT_CD
                ,BKG_QTY
                ,RAT_AS_QTY
                ,CHG_UT_AMT
                ,CHG_AMT AS BASE_RT
                ,RCV_TERM_CD
                ,DE_TERM_CD
                ,FRT_INCL_XCLD_DIV_CD
                ,APLY_XCH_RTO
                ,NOTE_RT_SEQ
                ,PROP_NO
                ,AMDT_SEQ
                ,SVC_SCP_CD
                ,GEN_SPCL_RT_TP_CD
                ,CMDT_HDR_SEQ
                ,ROUT_SEQ
                ,CRE_USR_ID
                ,CRE_DT
                ,UPD_USR_ID
                ,UPD_DT
                ,(SELECT TO_CHAR(RT_APLY_DT,'YYYYMMDD') FROM PRI_SIM_RT WHERE PCTL_NO = RT.PCTL_NO AND ROWNUM = 1) RT_APLY_DT
           FROM PRI_SIM_CHG_RT RT
          WHERE PCTL_NO = @[pctl_no]
            AND CMDT_CD NOT LIKE 'G%'
            AND CHG_CD = 'OFT'
#if (${ctrt_tp} == 'S' || ${ctrt_tp} == 'R') 
          UNION ALL
          SELECT 
                 RT.PCTL_NO
                ,RT.CNTR_SZ_CD AS ORG_CNTR_SZ_CD
                ,(SELECT CNTR_SZ_CD ||'0' 
                     FROM MDM_CNTR_TP_SZ 
                    WHERE CNTR_TPSZ_CD = RT.CNTR_SZ_CD 
                      AND DELT_FLG = 'N'
                      AND ROWNUM =1 ) AS CNTR_SZ_CD
                ,PRC_GRP_CMDT_CD AS GRP_CMDT
                ,PRC_CMDT_DEF_CD AS CMDT_CD
                ,RT.CMDT_SEQ
                ,PRC_GRP_CMDT_DESC AS GRP_CMDT_NM
                ,(SELECT CMDT_NM FROM MDM_COMMODITY WHERE CMDT_CD = GRP_CMDT.PRC_CMDT_DEF_CD) CMDT_NM
                ,RT.RT_SEQ
                ,RT.FRT_TERM_CD
                ,RT.CGO_CATE_CD
                ,RT.IMDG_CLSS_CD
                ,RT.CHG_CD
                ,RT.CURR_CD
                ,RT.RAT_UT_CD
                ,RT.BKG_QTY
                ,RT.RAT_AS_QTY
                ,RT.CHG_UT_AMT
                ,RT.CHG_AMT  AS BASE_RT
                ,RT.RCV_TERM_CD
                ,RT.DE_TERM_CD
                ,RT.FRT_INCL_XCLD_DIV_CD
                ,RT.APLY_XCH_RTO
                ,RT.NOTE_RT_SEQ
                ,RT.PROP_NO
                ,RT.AMDT_SEQ
                ,RT.SVC_SCP_CD
                ,RT.GEN_SPCL_RT_TP_CD
                ,RT.CMDT_HDR_SEQ
                ,RT.ROUT_SEQ
                ,RT.CRE_USR_ID
                ,RT.CRE_DT
                ,RT.UPD_USR_ID
                ,RT.UPD_DT
                ,(SELECT TO_CHAR(RT_APLY_DT,'YYYYMMDD') FROM PRI_SIM_RT WHERE PCTL_NO = RT.PCTL_NO AND ROWNUM = 1 ) RT_APLY_DT
           FROM PRI_SIM_CHG_RT RT, 
                    (SELECT   G.PRC_GRP_CMDT_CD     ,
                              D.PRC_CMDT_TP_CD      ,
                              D.PRC_CMDT_DEF_CD     ,
                              G.PROP_NO             ,
                              G.AMDT_SEQ            ,
                              G.SVC_SCP_CD          ,
                              G.PRC_GRP_CMDT_DESC
#if (${ctrt_tp} == 'S') 
                      FROM    PRI_SP_SCP_GRP_CMDT     G ,
                              PRI_SP_SCP_GRP_CMDT_DTL D
#else
                      FROM    PRI_RP_SCP_GRP_CMDT     G ,
                              PRI_RP_SCP_GRP_CMDT_DTL D
#end
                      WHERE   D.PROP_NO         = G.PROP_NO
                      AND     D.AMDT_SEQ        = G.AMDT_SEQ
                      AND     D.SVC_SCP_CD      = G.SVC_SCP_CD
                      AND     D.GRP_CMDT_SEQ    = G.GRP_CMDT_SEQ
                      AND     D.SRC_INFO_CD     <> 'AD'
                     ) GRP_CMDT
           WHERE 1=1
           AND RT.PCTL_NO = @[pctl_no]
           AND RT.PROP_NO = GRP_CMDT.PROP_NO
           AND RT.AMDT_SEQ = GRP_CMDT.AMDT_SEQ
           AND RT.SVC_SCP_CD = GRP_CMDT.SVC_SCP_CD
           AND RT.CMDT_CD = GRP_CMDT.PRC_GRP_CMDT_CD
           AND CHG_CD = 'OFT'
#end
) X
 WHERE CNTR_SZ_CD IS NOT NULL
#if (${cmdt_cd} != '') 
   AND CMDT_CD = @[cmdt_cd]
#end
ORDER BY PCTL_NO, CMDT_NM, CMDT_CD, GRP_CMDT, ORG_CNTR_SZ_CD, CMDT_SEQ			]]></sql>
			<params>
				<param name="pctl_no" type="12" value="" out="N"/>
				<param name="cmdt_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
