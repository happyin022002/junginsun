<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UnmatchBLDBDAORsltSearchBkgCaFlgRSQL">
			<desc><![CDATA[bl no 로 bkg_no, caFlg , ctrt_tp_cd 조회]]></desc>
			<sql><![CDATA[
SELECT  BL_NO              ,
        BKG_NO             ,
	    SVC_SCP_CD         ,
        CTRT_TP_CD         ,
        MAX(CA_FLG) CA_FLG 
FROM    (
         SELECT  BL_NO  ,
                 BKG_NO ,
                 SVC_SCP_CD ,
                 CASE WHEN TAA_NO IS NOT NULL THEN 'T'
                      WHEN RFA_NO IS NOT NULL THEN 'R'
                      WHEN SC_NO  IS NOT NULL THEN 'S'
                      ELSE 'T'
                  END CTRT_TP_CD  ,
                 'N' CA_FLG       
         FROM    BKG_BOOKING
         WHERE   BL_NO = @[bl_no]
         UNION ALL
         SELECT  BL_NO  ,
                 BKG_NO ,
                 SVC_SCP_CD ,
                 CASE WHEN TAA_NO IS NOT NULL THEN 'T'
                      WHEN RFA_NO IS NOT NULL THEN 'R'
                      WHEN SC_NO  IS NOT NULL THEN 'S'
                      ELSE 'T'
                  END CTRT_TP_CD  ,
                 'Y' CA_FLG
         FROM    BKG_BKG_HIS
         WHERE   BL_NO   = @[bl_no]
         AND     CORR_NO = 'TMP0000001'  -- CORRECTION 중인 DATA 를 나타내는 고정된 상수값
        )
GROUP BY
        BL_NO      ,
        BKG_NO     ,
	    SVC_SCP_CD ,
        CTRT_TP_CD			]]></sql>
			<params>
				<param name="bl_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
