<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChinaCustomsReportDBDAOsearchChinaSendDetailListRSQL">
			<desc><![CDATA[중국세관 send list result view(detail)]]></desc>
			<sql><![CDATA[
SELECT  SUM(SLOG.SEQ) OVER (ORDER BY SLOG.BL_NO,
        SLOG.POL_CD,
        SLOG.POD_CD,
        SLOG.BL_ACK_TP_CD,
        SLOG.CNTR_NO,
        SLOG.CNTR_ACK_TP_CD) SEQ ,
        SLOG.BL_NO,
        SLOG.POL_CD,
        SLOG.POD_CD,
        SLOG.SENT_DT,
        SLOG.BL_ACK_TYPE,
        SLOG.BL_ACK_TEXT,
        SLOG.CNTR_NO,
        SLOG.CNTR_ACK_TYPE,
        SLOG.CNTR_ACK_TEXT,
        SLOG.ACK_RCV_DT,
		--SLOG.BL_ACK_TP_CD || ' - ' || SLOG.AGN_ACK_MSG AS AGN_ACK_MSG,
        --SLOG.BL_ACK_TP_CD || ' - ' || SLOG.CUST_ACK_MSG AS CUST_ACK_MSG,
		SLOG.AGN_ACK_MSG,
        SLOG.CUST_ACK_MSG,
        SLOG.AGN_ACK_DT,
        SLOG.CUST_ACK_DT,
		NVL(SLOG.RHQ,SLOG.MDM_RHQ) RHQ,
		1 CNT
FROM 
(
SELECT  DECODE(LAG(BL.BL_NO) OVER ( ORDER BY BL.BL_NO,
        BL.BKG_POL_CD,
        BL.BKG_POD_CD,
        BL.CHN_CSTMS_ACK_TP_CD,
        CNTR.CNTR_NO,
        CNTR.CHN_CSTMS_ACK_TP_CD) , BL.BL_NO, 0, 1) SEQ,
        BL.BL_NO,
        BL.BKG_POL_CD POL_CD,
        BL.BKG_POD_CD POD_CD,
        TO_CHAR(VVD.MF_SND_DT,'YYYY-MM-DD HH24:MI:SS') SENT_DT,
        CODE1.INTG_CD_VAL_DP_DESC BL_ACK_TYPE,
        BL.ACK_CTNT BL_ACK_TEXT,
        CNTR.CNTR_NO,
        CODE2.INTG_CD_VAL_DP_DESC CNTR_ACK_TYPE,
        BL.CHN_CSTMS_ACK_TP_CD BL_ACK_TP_CD,
        CNTR.ACK_CTNT CNTR_ACK_TEXT,
        TO_CHAR(VVD.ACK_RCV_DT,'YYYY-MM-DD HH24:MI:SS') ACK_RCV_DT,
        CNTR.CHN_CSTMS_ACK_TP_CD CNTR_ACK_TP_CD,
		
        BL.ACK_CTNT AGN_ACK_MSG,             
        BL.AGN_ACK_CTNT CUST_ACK_MSG,
        TO_CHAR(BL.ACK_UPD_DT,'YYYY-MM-DD HH24:MI:SS') AGN_ACK_DT,
        TO_CHAR(BL.AGN_ACK_UPD_DT,'YYYY-MM-DD HH24:MI:SS') CUST_ACK_DT, 

		(SELECT SLS_RHQ_CD
		FROM BKG_BOOKING
		WHERE BL_NO = BL.BL_NO) RHQ,
		(SELECT AR_HD_QTR_OFC_CD
		FROM MDM_ORGANIZATION
		WHERE OFC_CD = VVD.MF_SND_OFC_CD
		AND DELT_FLG = 'N'
		) MDM_RHQ 
FROM    BKG_CSTMS_CHN_SND_LOG VVD,
        BKG_CSTMS_CHN_SND_LOG_BL BL,
        BKG_CSTMS_CHN_SND_LOG_CNTR CNTR,
		COM_INTG_CD_DTL CODE1,
		COM_INTG_CD_DTL CODE2
WHERE   VVD.EDI_REF_ID  			= BL.EDI_REF_ID 
AND     BL.EDI_REF_ID   			= CNTR.EDI_REF_ID
AND     BL.BL_NO        			= CNTR.BL_NO
AND		BL.CHN_CSTMS_ACK_TP_CD 		= CODE1.INTG_CD_VAL_CTNT(+)
AND		CNTR.CHN_CSTMS_ACK_TP_CD 	= CODE2.INTG_CD_VAL_CTNT(+)
AND     VVD.EDI_REF_ID  			= @[edi_ref_id]
AND		BL.BKG_POD_CD				IN (SUBSTR(@[pod_cd],1,5),
										SUBSTR(@[pod_cd],7,5),
										SUBSTR(@[pod_cd],13,5),
										SUBSTR(@[pod_cd],19,5),
										SUBSTR(@[pod_cd],25,5),
										SUBSTR(@[pod_cd],31,5),
										SUBSTR(@[pod_cd],37,5))
AND		CODE1.INTG_CD_ID(+) 		= 'CD02300'
AND     CODE2.INTG_CD_ID(+) 		= 'CD02300') SLOG			]]></sql>
			<params>
				<param name="edi_ref_id" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
