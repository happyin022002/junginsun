<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLIssuanceDBDAOSearchDblEdiRcvBlClauseRSQL">
			<desc><![CDATA[BLIssuanceDBDAOSearchDblEdiRcvBlClause]]></desc>
			<sql><![CDATA[
SELECT 'BL_CLAUSE:' || D_MARKS AS BL_CLAUSE
                                  FROM 
                                  (
                                        SELECT BKG_NO, LV, ROW_LV, SUBSTR(MARKS, LV, 90) AS D_MARKS -- 1 라인에 90자씩 짜름 LEVEL 단위로 자른다.
                                        FROM 
                                        (
                                            SELECT DISTINCT BKG_NO, LEVEL AS ROW_LV, REGEXP_SUBSTR(MARKS, '[^♣$]+', 1, LEVEL ) AS MARKS -- ♣ 문자 기준으로 잘라 행을 분리시킨다.
                                            FROM 
                                            (
                                                SELECT BKG_NO,REGEXP_REPLACE(REPLACE(REPLACE(REPLACE(MARKS, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), '♣'), '[[:space:]]+$', '') AS MARKS
                                                FROM (
                                                    SELECT RTRIM(NVL(MARK.OBL_ISS_RMK,''), CHR(13)||CHR(10))  AS MARKS -- 맨 끝자리를 CARRIAGE RETURN
                                                            ,DOC.BKG_NO
                                                    FROM BKG_BL_ISS MARK
                                                        ,BKG_BL_DOC DOC
                                                    WHERE 1=1
                                                    AND DOC.BKG_NO = @[bkg_no]
                                                    AND DOC.BKG_NO = MARK.BKG_NO(+))
                                            )
                                            CONNECT BY REGEXP_SUBSTR(MARKS, '[^♣$]+', 1, LEVEL ) IS NOT NULL
                                            ORDER BY BKG_NO, LEVEL
                                        ) 
                                        ,(SELECT LEVEL LV FROM DUAL CONNECT BY LEVEL < = 4000)      -- 컬럼 사이즈가 4000 BYTE
                                  ) A
                                  WHERE LV = FLOOR(LV/90)*90 + 1  -- 1 라인에 90자씩 짜름
                                  AND D_MARKS IS NOT NULL			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
