<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChinaCustomsTransmissionDBDAOsearchCncusBlRSQL">
			<desc><![CDATA[ChinaCncusBlListVO]]></desc>
			<sql><![CDATA[
SELECT /*+ ORDERED */
               ST.BL_NO,
               MAX (  ST.BL_NO
                        ||CHR(9)||TO_CHAR((SELECT MAX(SKD.VPS_ETB_DT)
                                             FROM     BKG_VVD VVD, VSK_VSL_PORT_SKD SKD
                                             WHERE    VVD.BKG_NO   = ST.BKG_NO
                                             AND      VVD.POL_CD   = ST.PORT_CD
                                             AND      VVD.VSL_CD   = SKD.VSL_CD
                                             AND      VVD.SKD_VOY_NO  = SKD.SKD_VOY_NO
                                             AND      VVD.SKD_DIR_CD  = SKD.SKD_DIR_CD
                                             AND      VVD.POL_CD   = SKD.VPS_PORT_CD
                                             AND      VVD.POL_CLPT_IND_SEQ = SKD.CLPT_IND_SEQ), 'YYYYMMDD')
               ||CHR(9)||TO_CHAR(ST.BL_POD_ETA_DT, 'YYYYMMDD')
               ||CHR(9)||TO_CHAR(ST.BL_ISS_DT, 'YYYYMMDD')
               ||CHR(9)||ST.BL_ISS_OFC_CD
               ||CHR(9)||LOC5.LOC_NM
               ||CHR(9)||ST.POR_CD
               ||CHR(9)||LOC1.LOC_NM
               ||CHR(9)||ST.POL_CD
               ||CHR(9)||LOC2.LOC_NM
               ||CHR(9)||ST.POD_CD
               ||CHR(9)||LOC3.LOC_NM
               ||CHR(9)||ST.DEL_CD
               ||CHR(9)||LOC4.LOC_NM
               ||CHR(9)||ST.CHN_CSTMS_TRSP_MOD_CD
               ||CHR(9)||(SELECT BB_CGO_FLG FROM BKG_BOOKING BKG WHERE BKG.BKG_NO  = ST.BKG_NO)
               ||CHR(9)||ST.RCV_TERM_CD||ST.DE_TERM_CD
               ||CHR(9)||DECODE(ST.FRT_TERM_CD,'P','PP','C','CC')
               ||CHR(9)||BKG_SPCLCHAR_CONV_FNC(TRIM(S.CUST_NM), 'C')
               ||CHR(9)||BKG_SPCLCHAR_CONV_FNC(TRIM(S.CUST_ADDR), 'C')
               ||CHR(9)||(SELECT BS.CUST_CTY_NM FROM BKG_CUSTOMER BS WHERE ST.BKG_NO = BS.BKG_NO AND BS.BKG_CUST_TP_CD = 'S')
               ||CHR(9)||(SELECT BS.CUST_ZIP_ID FROM BKG_CUSTOMER BS WHERE ST.BKG_NO = BS.BKG_NO AND BS.BKG_CUST_TP_CD = 'S')
               ||CHR(9)||(SELECT BS.CSTMS_DECL_CNT_CD FROM BKG_CUSTOMER BS WHERE ST.BKG_NO = BS.BKG_NO AND BS.BKG_CUST_TP_CD = 'S')
               ||CHR(9)||(SELECT CP.INTL_PHN_NO||CP.PHN_NO
                   FROM MDM_CUST_CNTC_PNT CP
                   WHERE S.CNT_CD = CP.CUST_CNT_CD
                     AND S.CUST_SEQ = CP.CUST_SEQ
                     AND ROWNUM = 1)
               ||CHR(9)||(SELECT CP.INTL_FAX_NO||CP.FAX_NO
                   FROM MDM_CUST_CNTC_PNT CP
                   WHERE S.CNT_CD = CP.CUST_CNT_CD
                     AND S.CUST_SEQ = CP.CUST_SEQ
                     AND ROWNUM = 1)
               ||CHR(9)||BKG_SPCLCHAR_CONV_FNC(TRIM(C.CUST_NM), 'C')
               ||CHR(9)||BKG_SPCLCHAR_CONV_FNC(TRIM(C.CUST_ADDR), 'C')
               ||CHR(9)||(SELECT BS.CUST_CTY_NM FROM BKG_CUSTOMER BS WHERE ST.BKG_NO = BS.BKG_NO AND BS.BKG_CUST_TP_CD = 'C')
               ||CHR(9)||(SELECT BS.CUST_ZIP_ID FROM BKG_CUSTOMER BS WHERE ST.BKG_NO = BS.BKG_NO AND BS.BKG_CUST_TP_CD = 'C')
               ||CHR(9)||(SELECT BS.CSTMS_DECL_CNT_CD FROM BKG_CUSTOMER BS WHERE ST.BKG_NO = BS.BKG_NO AND BS.BKG_CUST_TP_CD = 'C')
               ||CHR(9)||(SELECT CP.INTL_PHN_NO||CP.PHN_NO
                   FROM MDM_CUST_CNTC_PNT CP
                   WHERE C.CNT_CD = CP.CUST_CNT_CD
                     AND C.CUST_SEQ = CP.CUST_SEQ
                     AND ROWNUM = 1)
               ||CHR(9)||(SELECT CP.INTL_FAX_NO||CP.FAX_NO
                   FROM MDM_CUST_CNTC_PNT CP
                   WHERE C.CNT_CD = CP.CUST_CNT_CD
                     AND C.CUST_SEQ = CP.CUST_SEQ
                     AND ROWNUM = 1)
               ||CHR(9)||BKG_SPCLCHAR_CONV_FNC(TRIM(N.CUST_NM), 'C')
               ||CHR(9)||BKG_SPCLCHAR_CONV_FNC(TRIM(N.CUST_ADDR), 'C')
               ||CHR(9)||(SELECT BS.CUST_CTY_NM FROM BKG_CUSTOMER BS WHERE ST.BKG_NO = BS.BKG_NO AND BS.BKG_CUST_TP_CD = 'N')
               ||CHR(9)||(SELECT BS.CUST_ZIP_ID FROM BKG_CUSTOMER BS WHERE ST.BKG_NO = BS.BKG_NO AND BS.BKG_CUST_TP_CD = 'N')
               ||CHR(9)||(SELECT BS.CSTMS_DECL_CNT_CD FROM BKG_CUSTOMER BS WHERE ST.BKG_NO = BS.BKG_NO AND BS.BKG_CUST_TP_CD = 'N')
               ||CHR(9)||(SELECT CP.INTL_PHN_NO||CP.PHN_NO
                   FROM MDM_CUST_CNTC_PNT CP
                   WHERE N.CNT_CD = CP.CUST_CNT_CD
                     AND N.CUST_SEQ = CP.CUST_SEQ
                     AND ROWNUM = 1)
               ||CHR(9)||(SELECT CP.INTL_FAX_NO||CP.FAX_NO
                   FROM MDM_CUST_CNTC_PNT CP
                   WHERE N.CNT_CD = CP.CUST_CNT_CD
                     AND N.CUST_SEQ = CP.CUST_SEQ
                     AND ROWNUM = 1)
               ||CHR(9)||(SELECT BKG_SPCLCHAR_CONV_FNC(TRIM(REPLACE(REPLACE(REPLACE(TRIM(CUST_NM||CUST_ADDR) ,CHR(34)),CHR(9),' '), CHR(10),' ')), 'C')
                            FROM BKG_CUSTOMER
                           WHERE BKG_NO = ST.BKG_NO
                             AND BKG_CUST_TP_CD = 'A')
               ||CHR(9)||ST.POD_ROUT_DESC
                --||CHR(9)||REPLACE(ST.POD_ROUT_DESC,';',CHR(9))
                ||CHR(9)||NVL(SUBSTR(TRIM(ST.CSTMS_DESC), 1, 512), 'N/M')
                ||CHR(9)||NVL(SUBSTR(SM.BL_MK_DESC, 1, 100), '')
            	||CHR(9)||NVL(SUBSTR(SM.BL_MK_DESC, 101, 100), '')           
            	||CHR(9)||NVL(SUBSTR(SM.BL_MK_DESC, 201, 100), '')           
            	||CHR(9)||NVL(SUBSTR(SM.BL_MK_DESC, 301, 100), '')           
            	||CHR(9)||NVL(SUBSTR(SM.BL_MK_DESC, 401, 100), '')              
                ||CHR(9)||ST.ACT_WGT'FM999999990.000')
                ||CHR(9)||ST.PCK_QTY
                ||CHR(9)||NVL(CNV.CSTMS_PCK_TP_CD, ST.PCK_TP_CD)
                ||CHR(9)||NVL2(RF.BL_NO,'Y','N')
                ||CHR(9)||DECODE(RF.FDO_TEMP, NULL, DECODE(RF.CDO_TEMP, NULL, 0, RF.CDO_TEMP), RF.FDO_TEMP)
                ||CHR(9)||DECODE(RF.FDO_TEMP, NULL, 'C', 'F')
                ||CHR(9)||TO_CHAR(ST.MEAS_QTY, 'FM999999990.000')
                ||CHR(9)||'1') BL_DATA

FROM BKG_CSTMS_CHN_BL ST,
     BKG_CSTMS_CHN_CUST C,
     BKG_CSTMS_CHN_CUST S,
     BKG_CSTMS_CHN_CUST N,
     MDM_LOCATION LOC1,
     MDM_LOCATION LOC2,
     MDM_LOCATION LOC3,
     MDM_LOCATION LOC4,
     MDM_LOCATION LOC5,
     BKG_CSTMS_CHN_RF RF,
       ( SELECT  BL_NO, DBMS_LOB.SUBSTR( BKG_SPCLCHAR_CONV_CLOB_FNC(BL_MK_DESC,'J'), 1000, 1) BL_MK_DESC
         FROM    BKG_CSTMS_CHN_MK
         WHERE	  1=1
       AND   ( #foreach($field_id in ${field_list})
                 #if($velocityCount > 1)
                 OR #end      BL_NO IN ( $field_id )
                #end
       )
         AND     CHN_MF_SND_IND_CD  =	@[trans_mode]) SM,
     BKG_CSTMS_PCK_TP_CONV CNV

WHERE 1=1
AND ( #foreach($field_id in ${field_list})
         #if($velocityCount > 1)
         OR #end      ST.BL_NO IN ( $field_id )
      #end
)
AND	    ST.CHN_MF_SND_IND_CD  =	@[trans_mode]   /*24hr*/
#if (${trans_mode} == 'P')
AND	    ST.BKG_POL_CD = @[loc_cd]
#else
AND	    ST.BKG_POD_CD = @[loc_cd]
#end
AND	    ST.BL_NO		      =	C.BL_NO(+)
AND	    ST.CHN_MF_SND_IND_CD  =	C.CHN_MF_SND_IND_CD(+)
AND	    C.BKG_CUST_TP_CD(+)	  =	'C'
AND	    ST.BL_NO		      =	S.BL_NO(+)
AND	    ST.CHN_MF_SND_IND_CD  =	S.CHN_MF_SND_IND_CD(+)
AND	    S.BKG_CUST_TP_CD(+)	  =	'S'
AND	    ST.BL_NO		      =	N.BL_NO(+)
AND	    ST.CHN_MF_SND_IND_CD  =	N.CHN_MF_SND_IND_CD(+)
AND	    N.BKG_CUST_TP_CD(+)	  =	'N'
AND	    ST.POR_CD		      =	LOC1.LOC_CD
ANd	    ST.POL_CD	          =	LOC2.LOC_CD
AND	    ST.POD_CD	          =	LOC3.LOC_CD
AND	    ST.DEL_CD	      	  =	LOC4.LOC_CD
AND	    ST.BL_ISS_OFC_CD      =	LOC5.LOC_CD(+)
AND	    ST.BL_NO		      =	SM.BL_NO(+)
AND	    ST.BL_NO		      =	RF.BL_NO(+)
AND	    ST.CHN_MF_SND_IND_CD  =	RF.CHN_MF_SND_IND_CD(+)
AND	    ST.PCK_TP_CD = CNV.PCK_TP_CD(+)
AND	    CNV.CNT_CD(+) = 'CN'

GROUP BY ST.BL_NO			]]></sql>
			<params>
				<param name="trans_mode" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
