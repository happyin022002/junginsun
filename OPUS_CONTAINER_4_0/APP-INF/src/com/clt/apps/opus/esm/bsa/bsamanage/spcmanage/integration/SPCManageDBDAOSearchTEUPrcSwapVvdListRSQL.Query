<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SPCManageDBDAOSearchTEUPrcSwapVvdListRSQL">
			<desc><![CDATA[SPCManageDBDAO SearchTEUPrcSwapVvdList]]></desc>
			<sql><![CDATA[
SELECT MIN(B1.FLAG) AS FLAG 
    ,B1.BSA_ZR_FLG 
    ,B1.BSA_FLG 
    ,B1.COST_YRWK 
    ,B1.TRD_CD 
    ,B1.SUB_TRD_CD 
    ,B1.SLAN_CD 
    ,B1.RLANE_CD 
    ,B1.VSL_LANE_TP_CD 
    ,B1.TYPE_FLG 
    ,B1.VSL_CD 
    ,B1.SKD_VOY_NO 
    ,B1.SKD_DIR_CD 
    ,B1.VOP_CD, 
     B1.CRR_CD2 
    ,B1.VOP_FLG 
    ,B1.VSL_CAPA 
    ,B1.VSL_CAPA 
    ,B1.BSA_CAPA 
    ,B1.FNL_CO_BSA_CAPA 
    ,B1.CO_BSA_CAPA 
    ,B1.CO_BSA_RTO 
    ,B1.CHTR_BSA_RTO 
    ,B1.CO_BSA_BFR_SUB_CAPA 
#foreach( ${keys} in ${keyList}) 
	,NVL(SUM(CASE WHEN B1.BSA_OP_JB_CD = SUBSTR('${keys}', 4, 6) AND B1.CRR_CD = SUBSTR('${keys}', 1, 3) THEN B1.CRR_BSA_CAPA ELSE 0 END), 0) AS CAPA_${keys}
    ,NVL(SUM(CASE WHEN B1.BSA_OP_JB_CD = SUBSTR('${keys}', 4, 6) AND B1.CRR_CD = SUBSTR('${keys}', 1, 3) AND B1.CRR_BSA_CAPA <> 0 THEN B1.CRR_PERF_AMT/B1.CRR_BSA_CAPA ELSE 0 END), 0) AS PRC_${keys}
    --20150513.ADD
    ,NVL(SUM(CASE WHEN B1.BSA_OP_JB_CD = SUBSTR('${keys}', 4, 6) AND B1.CRR_CD = SUBSTR('${keys}', 1, 3) AND B1.CRR_BSA_CAPA <> 0 THEN B1.OP_CRR_PERF_AMT/B1.CRR_BSA_CAPA ELSE 0 END), 0) AS PCO_${keys}
#end 
    ,B1.REV_PORT_CD 
    ,B1.REV_PORT_ETD_DT 
    ,B1.N1ST_PORT_ETD_DT 
    ,B1.IOC_RULE_DESC 
    ,B1.IOC_CD 
    ,B1.BSA_OP_CD 
    ,B1.FNL_CO_BSA_CAPA 
FROM ( 
      SELECT DECODE(A4.CRR_CD, '', 'I', 'R')   AS FLAG 
            ,NVL(A1.BSA_ZR_FLG,'N')            AS BSA_ZR_FLG 
            ,DECODE(A1.BSA_ZR_FLG,'Y','1','0') AS BSA_FLG 
		#if (${chkprd} == 'M')
		   ,SUBSTR(A1.COST_YRMON,0,4) ||'-'|| A1.COST_WK AS COST_YRWK   			
		#elseif (${chkprd} == 'W')
  		   ,SUBSTR(A1.SLS_YRMON, 0, 4) ||'-'|| A1.COST_WK AS COST_YRWK
		#end            
            ,A3.TRD_CD 
            ,A1.SUB_TRD_CD 
            ,A1.SLAN_CD 
            ,A3.RLANE_CD 
            ,DECODE(A3.BSA_OP_CD, 'J', 'JO', 'SC') AS VSL_LANE_TP_CD 
            ,DECODE(A3.BSA_OP_CD, 'J', '0', '1')   AS TYPE_FLG 
            ,A3.VSL_CD 
            ,A3.SKD_VOY_NO 
            ,A3.SKD_DIR_CD 
            ,A3.VOP_CD 
            ,A4.CRR_CD 
            ,A3.CRR_CD AS CRR_CD2 
            ,DECODE(A3.VOP_CD, COM_ConstantMgr_PKG.COM_getCompanyCode_FNC, '0', '1') AS VOP_FLG 
            ,A3.VSL_CAPA 
            ,A3.BSA_CAPA 
            ,NVL(A3.FNL_CO_BSA_CAPA,0)      AS FNL_CO_BSA_CAPA 
            ,NVL(A3.CO_BSA_CAPA,0)          AS CO_BSA_CAPA 
            ,NVL(A3.CO_BSA_RTO,0)*100       AS CO_BSA_RTO 
            ,NVL(A3.CHTR_BSA_RTO,0)*100     AS CHTR_BSA_RTO 
            ,NVL(A3.CO_BSA_BFR_SUB_CAPA,0)  AS CO_BSA_BFR_SUB_CAPA 
            ,A3.REV_PORT_CD 
            ,TO_CHAR(A3.REV_PORT_ETD_DT, 'YYYY-MM-DD HH24:MI:SS') AS REV_PORT_ETD_DT 
            ,TO_CHAR(A3.N1ST_PORT_ETD_DT, 'YYYY-MM-DD HH24:MI:SS') AS N1ST_PORT_ETD_DT 
            ,TO_CHAR(A3.N1ST_PORT_ETD_DT, 'YYYYMMDD') AS N1ST_PORT_ETD_DT2 
            ,A3.IOC_RULE_DESC 
            ,A3.IOC_CD 
            ,A3.BSA_OP_CD 
            ,A4.BSA_OP_JB_CD 
            ,A4.CRR_BSA_CAPA 
            ,A4.CRR_PERF_AMT 
            ,A4.OP_CRR_PERF_AMT          --20150513.ADD
        FROM 
            COA_MON_VVD A1,
            COA_LANE_RGST A2,
            BSA_VVD_MST A3,
            BSA_VVD_CRR_PERF A4,
            MDM_VSL_CNTR A5  
      WHERE A1.TRD_CD     = A3.TRD_CD  
        AND A1.RLANE_CD   = A3.RLANE_CD  
        AND A1.IOC_CD     = A3.IOC_CD  
        AND A1.VSL_CD     = A3.VSL_CD  
        AND A1.SKD_VOY_NO = A3.SKD_VOY_NO  
        AND A1.DIR_CD     = A3.SKD_DIR_CD  
        AND A1.TRD_CD     = A2.TRD_CD  
        AND A1.RLANE_CD   = A2.RLANE_CD  
        AND A1.DIR_CD     = A2.DIR_CD  
        AND A1.IOC_CD     = A2.IOC_CD  
        AND A1.DELT_FLG   = 'N' 
        AND NVL(A2.DELT_FLG, 'N')   = 'N'
        AND A3.TRD_CD     = A4.TRD_CD(+) 
        AND A3.RLANE_CD   = A4.RLANE_CD(+) 
        AND A3.VSL_CD     = A4.VSL_CD(+) 
        AND A3.SKD_VOY_NO = A4.SKD_VOY_NO(+) 
        AND A3.SKD_DIR_CD = A4.SKD_DIR_CD(+) 
        AND A1.VSL_CD     = A5.VSL_CD(+) 
        --        AND 'Y'           = A5.CRR_RGST_FLG(+)  COA_VSL_INFO TABLE 삭제에따른 제외    
        AND A4.CRR_CD(+)  != COM_ConstantMgr_PKG.COM_getCompanyCode_FNC 

#if (${chkprd} == 'M')
  AND A1.COST_YRMON BETWEEN @[txtyear]||@[txtfmmonth] AND @[txtyear]||@[txttomonth] 
#elseif (${chkprd} == 'W')
  AND A1.SLS_YRMON LIKE @[txtyear] || '%'
  AND A1.COST_WK BETWEEN @[txtfmweek] AND @[txttoweek] 
#end 	

#if (${cobtrade} != '')
  AND A3.TRD_CD = @[cobtrade] 
#end 
#if (${coblane} != '')
  AND A3.RLANE_CD = @[coblane] 
#end 
#if (${cobdir} != '')
  AND A3.SKD_DIR_CD = @[cobdir] 
#end 
#if (${cobioc} != '')
  AND A3.IOC_CD = @[cobioc] 
#end 
#if (${txtvsl_cd} != '')
  AND A3.VSL_CD = @[txtvsl_cd] 
#end 
#if (${txtskd_voy_no} != '')
  AND A3.SKD_VOY_NO = @[txtskd_voy_no] 
#end 
#if (${txtdir_cd} != '')
  AND A3.SKD_DIR_CD = @[txtdir_cd] 
#end
--	 and a4.crr_bsa_capa >0  -- 이것으로 인해 선사별로 금액이 없는 항차에 대해서 조회가 안되는 형상이 발생 따라서 제거 함 
    ) B1       

GROUP BY B1.BSA_ZR_FLG 
       ,B1.BSA_FLG 
       ,B1.COST_YRWK 
       ,B1.TRD_CD 
       ,B1.SUB_TRD_CD 
       ,B1.SLAN_CD 
       ,B1.RLANE_CD 
       ,B1.VSL_LANE_TP_CD 
       ,B1.TYPE_FLG 
       ,B1.VSL_CD 
       ,B1.SKD_VOY_NO 
       ,B1.SKD_DIR_CD 
       ,B1.VOP_CD, 
        B1.CRR_CD2 
       ,B1.VOP_FLG 
       ,B1.VSL_CAPA 
       ,B1.VSL_CAPA 
       ,B1.BSA_CAPA 
       ,B1.FNL_CO_BSA_CAPA 
       ,B1.CO_BSA_CAPA 
       ,B1.CO_BSA_RTO 
       ,B1.CHTR_BSA_RTO 
       ,B1.CO_BSA_BFR_SUB_CAPA 
       ,B1.REV_PORT_CD 
       ,B1.REV_PORT_ETD_DT 
       ,B1.N1ST_PORT_ETD_DT 
       ,B1.IOC_RULE_DESC 
       ,B1.IOC_CD 
       ,B1.BSA_OP_CD 
       ,B1.FNL_CO_BSA_CAPA 
ORDER BY B1.COST_YRWK 
       ,B1.TRD_CD 
       ,B1.SUB_TRD_CD 
       ,B1.SLAN_CD 
       ,B1.RLANE_CD 
       ,B1.BSA_OP_CD 
       ,B1.N1ST_PORT_ETD_DT			]]></sql>
			<params>
				<param name="txtyear" type="12" value="" out="N"/>
				<param name="txtfmmonth" type="12" value="" out="N"/>
				<param name="txttomonth" type="12" value="" out="N"/>
				<param name="txtfmweek" type="12" value="" out="N"/>
				<param name="txttoweek" type="12" value="" out="N"/>
				<param name="cobtrade" type="12" value="" out="N"/>
				<param name="coblane" type="12" value="" out="N"/>
				<param name="cobdir" type="12" value="" out="N"/>
				<param name="cobioc" type="12" value="" out="N"/>
				<param name="txtvsl_cd" type="12" value="" out="N"/>
				<param name="txtskd_voy_no" type="12" value="" out="N"/>
				<param name="txtdir_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
