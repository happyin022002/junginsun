<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SpeckalCargoReceiptDBDAOsearchChnProhibitRSQL">
			<desc><![CDATA[SpeckalCargoReceiptDBDAOsearchChnProhibitRSQL]]></desc>
			<sql><![CDATA[
SELECT MAX(ATTR_CTNT6) FLAG
FROM (
SELECT VVD.ATTR_CTNT6
FROM BKG_BOOKING BKG,
(SELECT VVD.BKG_NO, SKD3.YD_CD, ATTR_CTNT6
FROM BKG_VVD VVD, VSK_VSL_PORT_SKD SKD1, VSK_VSL_PORT_SKD SKD2, VSK_VSL_PORT_SKD SKD3,BKG_HRD_CDG_CTNT UNNO
WHERE VVD.BKG_NO = @[bkg_no]
AND VVD.VSL_CD = SKD1.VSL_CD
AND VVD.SKD_VOY_NO = SKD1.SKD_VOY_NO
AND VVD.SKD_DIR_CD = SKD1.SKD_DIR_CD
AND VVD.POL_CD = SKD1.VPS_PORT_CD
AND VVD.VSL_CD = SKD2.VSL_CD
AND VVD.SKD_VOY_NO = SKD2.SKD_VOY_NO
AND VVD.SKD_DIR_CD = SKD2.SKD_DIR_CD
AND VVD.POD_CD = SKD2.VPS_PORT_CD
AND VVD.VSL_CD = SKD3.VSL_CD
AND VVD.SKD_VOY_NO = SKD3.SKD_VOY_NO
AND VVD.SKD_DIR_CD = SKD3.SKD_DIR_CD
AND SKD3.CLPT_SEQ >= SKD1.CLPT_SEQ
AND SKD3.CLPT_SEQ <= SKD2.CLPT_SEQ
AND SKD3.YD_CD IN ( SELECT ATTR_CTNT3 FROM BKG_HRD_CDG_CTNT 
                                      WHERE HRD_CDG_ID ='DG_PRT' 
                                        AND ATTR_CTNT1 = 'YARD'      -- 포트별 
                                        AND ATTR_CTNT2 ='PORT'
                                        AND ATTR_CTNT10 ='Y'
	               )
AND SKD3.YD_CD = UNNO.ATTR_CTNT7
AND SKD3.VPS_ETA_DT >= TO_DATE(UNNO.ATTR_CTNT4,'YYYY/MM/DD HH24:MI:SS') -- ETA FROM, BKG_HRD_CDG_CTNT
AND SKD3.VPS_ETA_DT <= TO_DATE(UNNO.ATTR_CTNT5,'YYYY/MM/DD HH24:MI:SS') -- ETA TO, BKG_HRD_CDG_CTNT
AND NVL(SKD3.SKD_CNG_STS_CD,'N') <> 'S'
AND UNNO.HRD_CDG_ID ='DG_PRT' 
AND UNNO.ATTR_CTNT1 = 'UNNO'
AND UNNO.ATTR_CTNT10 ='Y'
AND @[imdg_un_no] = UNNO.ATTR_CTNT2
AND @[imdg_clss_cd] = UNNO.ATTR_CTNT3
) VVD
WHERE BKG.BKG_NO = @[bkg_no]
AND BKG.BKG_NO = VVD.BKG_NO

UNION ALL 
SELECT ATTR_CTNT6
FROM BKG_BOOKING BKG, 
    BKG_VVD VVD1,  
    VSK_VSL_PORT_SKD SKD1,
	BKG_HRD_CDG_CTNT DG
WHERE 1 = 1
AND VVD1.BKG_NO = @[bkg_no]
AND VVD1.BKG_NO = BKG.BKG_NO
AND VVD1.VSL_CD = SKD1.VSL_CD
AND VVD1.SKD_VOY_NO = SKD1.SKD_VOY_NO
AND VVD1.SKD_DIR_CD = SKD1.SKD_DIR_CD
AND BKG.POL_CD = VVD1.POL_CD
AND VVD1.POL_YD_CD = SKD1.YD_CD -- 출발 SKD
AND SKD1.YD_CD = DG.ATTR_CTNT3
AND SKD1.VPS_ETA_DT >= TO_DATE(DG.ATTR_CTNT4,'YYYY/MM/DD HH24:MI:SS')
AND SKD1.VPS_ETA_DT <=  TO_DATE(DG.ATTR_CTNT5,'YYYY/MM/DD HH24:MI:SS')
AND @[imdg_clss_cd]  = ATTR_CTNT2
AND 'DG_PRT' = DG.HRD_CDG_ID 
AND 'IMDG' = DG.ATTR_CTNT1
AND 'Y' = DG.ATTR_CTNT10 

UNION ALL
SELECT ATTR_CTNT6
FROM BKG_BOOKING BKG, 
    BKG_VVD VVD1,  
    VSK_VSL_PORT_SKD SKD1,
	BKG_HRD_CDG_CTNT DG
WHERE 1 = 1
AND VVD1.BKG_NO = @[bkg_no]
AND VVD1.BKG_NO = BKG.BKG_NO
AND VVD1.VSL_CD = SKD1.VSL_CD
AND VVD1.SKD_VOY_NO = SKD1.SKD_VOY_NO
AND VVD1.SKD_DIR_CD = SKD1.SKD_DIR_CD
AND BKG.POD_CD = VVD1.POD_CD
AND VVD1.POD_YD_CD = SKD1.YD_CD -- 출발 SKD
AND SKD1.YD_CD = DG.ATTR_CTNT3
AND SKD1.VPS_ETA_DT >= TO_DATE(DG.ATTR_CTNT4,'YYYY/MM/DD HH24:MI:SS')
AND SKD1.VPS_ETA_DT <=  TO_DATE(DG.ATTR_CTNT5,'YYYY/MM/DD HH24:MI:SS')
AND @[imdg_clss_cd]  = ATTR_CTNT2
AND 'DG_PRT' = DG.HRD_CDG_ID 
AND 'IMDG' = DG.ATTR_CTNT1
AND 'Y' = DG.ATTR_CTNT10 ) A			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="imdg_un_no" type="12" value="" out="N"/>
				<param name="imdg_clss_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
