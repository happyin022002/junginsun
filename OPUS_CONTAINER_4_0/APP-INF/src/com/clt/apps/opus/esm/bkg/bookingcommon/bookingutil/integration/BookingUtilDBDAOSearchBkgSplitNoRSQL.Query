<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingUtilDBDAOSearchBkgSplitNoRSQL">
			<desc><![CDATA[Booking Split 번호 조회]]></desc>
			<sql><![CDATA[
SELECT DISTINCT BKG_NO
  FROM 
    (
    SELECT FM_BKG_NO BKG_NO, 1 NO --입력 BKG이 SPLIT된 BKG일 때 상위 BKG
    FROM BKG_BOOKING
    WHERE BKG_NO = @[bkg_no]
    AND BKG_CRE_TP_CD = 'S'
    UNION 
    SELECT bkg_no, 2 NO --입력 BKG
    FROM bkg_booking
    WHERE bkg_no = @[bkg_no]
    UNION
    SELECT bkg_no, 3 NO --입력 BKG으로부터 SPLIT된 BKG
    FROM bkg_booking
    WHERE fm_bkg_no = @[bkg_no]
	AND BKG_CRE_TP_CD = 'S'
    UNION
    SELECT bkg_no, 4 no --입력 bkg과 같은 from bkg을 가지는 bkg
    FROM bkg_booking
    WHERE fm_bkg_no IN (SELECT fm_bkg_no
                          FROM bkg_booking
                         WHERE bkg_no = @[bkg_no]
                    	   AND BKG_CRE_TP_CD = 'S')
    AND BKG_CRE_TP_CD = 'S'
	UNION
	SELECT /*+ INDEX(BKG_BOOKING XPKBKG_BOOKING) */  
		 BKG_NO, 5 no --empty bkg을 위한 추가 처리
    FROM BKG_BOOKING
    WHERE BKG_CGO_TP_CD = 'P'
      AND BKG_NO LIKE @[bkg_no]||'%'
      AND BKG_NO <> @[bkg_no]	
	  AND LENGTH(@[bkg_no]) = 11
	UNION
	SELECT /*+ INDEX(BKG_BOOKING XPKBKG_BOOKING) */  
		 BKG_NO, 5 no --empty bkg을 위한 추가 처리
    FROM BKG_BOOKING
    WHERE BKG_CGO_TP_CD = 'P'
      AND BKG_NO LIKE substr(@[bkg_no], 1, 11)||'%'
      AND BKG_NO <> @[bkg_no]	
	  AND LENGTH(@[bkg_no]) = 13
    ORDER BY NO)
ORDER BY BKG_NO			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="AARY00227501" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
