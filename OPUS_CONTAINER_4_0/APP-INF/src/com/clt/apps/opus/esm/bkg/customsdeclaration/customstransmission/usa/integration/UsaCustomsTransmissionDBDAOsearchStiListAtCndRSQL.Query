<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UsaCustomsTransmissionDBDAOsearchStiListAtCndRSQL">
			<desc><![CDATA[dwkim, 1023화면 조회용. Exclude Canada Import 가 체크 되어 있을 경우, Canada를 제외하고 대상을 조회하는 쿼리.]]></desc>
			<sql><![CDATA[
SELECT 
    A.ID cntr_no ,
    A.OPR_CD,
    A.POL pol,
    A.POD_ISO pod,
    A.SZTP,
    DECODE(SUBSTR(A.SZTP,  1, 1), 	'R',	'REEFER',
				 					'O',	'OPEN TOP',
				 					'F',	'FLAT RACK',
				 					'P',	'PLATFFORM',
				 					'D',	'DRY',
				 					'T',	'TANK',
				 					'A',	'ADJUSTABLE',
				 					'S',	'OPEN TOP SLIDING',
				 					'Q',	'DEAD SPACE',
				 					'XX') fe,
    A.BAY||A.ROWW||A.TIER sti_pos,
    A.IMDG,
    A.UNNO,
    A.VSL_CD || A.VOY_NO || A.DIR_CD vvd,
    A.PORT_CD l_pol,
    TO_CHAR(L.SND_DT,'YYYY-MM-DD HH24:MI') sent_time,
    L.POD_CD o_pod,
	'' vsl_eng_nm, -- VO 필드추가용.
	'' vsl_voy, -- VO 필드추가용.
	'' crr_cd, -- VO 필드추가용.
	'' TMP1, -- 임시필드.
	'' TMP2, -- 임시필드.
	'' TMP3, -- 임시필드.
	'' TMP4, -- 임시필드.
	'' TMP5  -- 임시필드.
FROM BAY_PLAN A, BKG_CSTMS_ADV_STWG_CNTR L
WHERE A.VSL_CD 		= SUBSTR(@[vvd],1, 4)
    and A.VOY_NO 	= SUBSTR(@[vvd],5, 4)
    and A.DIR_CD 	= SUBSTR(@[vvd],9, 1)
#if (${lastpol} != '')
    and A.PORT_CD 	= @[lastpol]
#end
#if (${pol} != '')
    AND A.POL 		= @[pol]
#end
#if (${pod} != '')
    AND A.POD_ISO 	= @[pod]
#end
#if (${cntropr} != '')
    AND A.OPR_CD 	= @[cntropr]
#end
   
--------------------------------------------------------------------------
	AND A.POD_ISO 	NOT LIKE 'CA%' -- searchStiListAtUsa와 틀린 부분은 이 라인 뿐이다 .
	--------------------------------------------------------------------------
    AND A.VSL_CD = L.VSL_CD(+)
    AND A.VOY_NO = L.SKD_VOY_NO(+)
    AND A.DIR_CD = L.SKD_DIR_CD(+)
    AND A.ID     = L.CNTR_NO(+)
    AND A.PORT_CD = L.LODG_PORT_CD(+)

AND A.PLAN_TYPE= ( SELECT MIN(PLAN_TYPE) FROM BAY_PLAN BB
                 WHERE A.VSL_CD = BB.VSL_CD
                 AND A.VOY_NO = BB.VOY_NO
                 AND A.DIR_CD = BB.DIR_CD
                 AND A.PORT_CD = BB.PORT_CD
                 AND A.ID = BB.ID
                 AND A.CALL_IND = BB.CALL_IND
                 )

#if (${allerror} == 'ERR') 
	and A.POD_ISO <> L.POD_CD
#end
GROUP BY  
    A.ID
    ,A.OPR_CD
    ,A.POL
    ,A.POD_ISO
    ,A.SZTP
    ,SUBSTR(A.SZTP,  1, 1)
    ,A.BAY||A.ROWW||A.TIER
    ,A.IMDG
    ,A.UNNO
    ,A.VSL_CD || A.VOY_NO || A.DIR_CD
    ,A.PORT_CD
    ,TO_CHAR(L.SND_DT,'YYYY-MM-DD HH24:MI')
    ,L.POD_CD			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="lastpol" type="12" value="" out="N"/>
				<param name="pol" type="12" value="" out="N"/>
				<param name="pod" type="12" value="" out="N"/>
				<param name="cntropr" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
