<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AncsCustomsTransmissionDBDAOsearchAncsCstmsSndHisList2RSQL">
			<desc><![CDATA[SELECT]]></desc>
			<sql><![CDATA[
#if (${target} == 'bl_log')
SELECT
'B/L' AS DIV
,EDI_SND_STS.ATTR_CTNT2 EDI_SND_STS_CD
,HIS.EDI_SND_USR_ID
,HIS.SND_OFC_CD
,HIS.SND_DT
,HIS.RCV_DT
,HIS.ANR_DECL_NO
,HIS.REF_SEQ
,BLLOG.BL_NO AS BL_CNTR_NO
,BLLOG.EDI_MSG_ERR_ID
,BLLOG.ERR_DESC
,EDI_RCV_STS.ATTR_CTNT2 EDI_RCV_STS_CD
FROM BKG_CSTMS_ANR_EDI_HIS HIS
,BKG_CSTMS_ANR_BL_LOG BLLOG
,BKG_HRD_CDG_CTNT EDI_SND_STS
,BKG_HRD_CDG_CTNT EDI_RCV_STS
WHERE 1=1
AND BLLOG.BL_NO     = @[bl_no]
AND HIS.MSG_TP_CD   = 'C'
AND BLLOG.MSG_TP_CD(+)   = HIS.MSG_TP_CD
AND BLLOG.ANR_DECL_NO(+) = HIS.ANR_DECL_NO
AND BLLOG.REF_SEQ(+)     = HIS.REF_SEQ
AND EDI_SND_STS.HRD_CDG_ID(+) = 'ANR_CSTMS_ES_STS_CD'
AND EDI_SND_STS.ATTR_CTNT1(+) = HIS.EDI_SND_STS_CD
AND EDI_RCV_STS.HRD_CDG_ID(+) = 'ANR_CSTMS_ER_STS_CD'
AND EDI_RCV_STS.ATTR_CTNT1(+) = BLLOG.EDI_RCV_STS_CD
ORDER BY HIS.REF_SEQ

#elseif (${target} == 'cntr_log')
SELECT
'CNTR' AS DIV 
,EDI_SND_STS.ATTR_CTNT2 EDI_SND_STS_CD
,HIS.EDI_SND_USR_ID
,HIS.SND_OFC_CD
,HIS.SND_DT
,HIS.RCV_DT
,HIS.ANR_DECL_NO
,HIS.REF_SEQ
,CNTRLOG.CNTR_NO AS BL_CNTR_NO
,CNTRLOG.EDI_MSG_ERR_ID
,CNTRLOG.ERR_DESC
,EDI_RCV_STS.ATTR_CTNT2 EDI_RCV_STS_CD
FROM BKG_CSTMS_ANR_EDI_HIS HIS 
,BKG_CSTMS_ANR_CNTR_LOG CNTRLOG
,BKG_HRD_CDG_CTNT EDI_SND_STS
,BKG_HRD_CDG_CTNT EDI_RCV_STS
WHERE 1=1
AND CNTRLOG.CNTR_NO IN (SELECT B.CNTR_NO
					    FROM BKG_CSTMS_ANR_BL A, BKG_CSTMS_ANR_CNTR B
						WHERE 1=1
						AND A.BL_NO     = @[bl_no]
						AND B.VSL_CD = A.VSL_CD
						AND B.SKD_VOY_NO = A.SKD_VOY_NO
						AND B.SKD_DIR_CD = A.SKD_DIR_CD
						AND B.BKG_NO = A.BKG_NO
						)
#if (${cntr_no} != '')
AND CNTRLOG.CNTR_NO = @[cntr_no]
#end
AND HIS.MSG_TP_CD   = 'C'
AND CNTRLOG.MSG_TP_CD(+)   = HIS.MSG_TP_CD
AND CNTRLOG.ANR_DECL_NO(+) = HIS.ANR_DECL_NO
AND CNTRLOG.REF_SEQ(+)     = HIS.REF_SEQ
AND EDI_SND_STS.HRD_CDG_ID(+) = 'ANR_CSTMS_ES_STS_CD'
AND EDI_SND_STS.ATTR_CTNT1(+) = HIS.EDI_SND_STS_CD
AND EDI_RCV_STS.HRD_CDG_ID(+) = 'ANR_CSTMS_ER_STS_CD'
AND EDI_RCV_STS.ATTR_CTNT1(+) = CNTRLOG.EDI_RCV_STS_CD
ORDER BY HIS.REF_SEQ
 
#else
SELECT * 
FROM (
SELECT
'B/L' AS DIV  
,EDI_SND_STS.ATTR_CTNT2 EDI_SND_STS_CD
,HIS.EDI_SND_USR_ID
,HIS.SND_OFC_CD
,HIS.SND_DT
,HIS.RCV_DT
,HIS.ANR_DECL_NO
,HIS.REF_SEQ
,BLLOG.BL_NO AS BL_CNTR_NO
,BLLOG.EDI_MSG_ERR_ID
,BLLOG.ERR_DESC
,EDI_RCV_STS.ATTR_CTNT2 EDI_RCV_STS_CD
FROM BKG_CSTMS_ANR_EDI_HIS HIS 
,BKG_CSTMS_ANR_BL_LOG BLLOG
,BKG_HRD_CDG_CTNT EDI_SND_STS
,BKG_HRD_CDG_CTNT EDI_RCV_STS
WHERE 1=1
AND BLLOG.BL_NO     = @[bl_no]
AND HIS.MSG_TP_CD   = 'C'
AND BLLOG.MSG_TP_CD(+)   = HIS.MSG_TP_CD
AND BLLOG.ANR_DECL_NO(+) = HIS.ANR_DECL_NO
AND BLLOG.REF_SEQ(+)     = HIS.REF_SEQ
AND EDI_SND_STS.HRD_CDG_ID(+) = 'ANR_CSTMS_ES_STS_CD'
AND EDI_SND_STS.ATTR_CTNT1(+) = HIS.EDI_SND_STS_CD
AND EDI_RCV_STS.HRD_CDG_ID(+) = 'ANR_CSTMS_ER_STS_CD'
AND EDI_RCV_STS.ATTR_CTNT1(+) = BLLOG.EDI_RCV_STS_CD
UNION ALL
SELECT
'CNTR' AS DIV 
,EDI_SND_STS.ATTR_CTNT2 EDI_SND_STS_CD
,HIS.EDI_SND_USR_ID
,HIS.SND_OFC_CD
,HIS.SND_DT
,HIS.RCV_DT
,HIS.ANR_DECL_NO
,HIS.REF_SEQ
,CNTRLOG.CNTR_NO AS BL_CNTR_NO
,CNTRLOG.EDI_MSG_ERR_ID
,CNTRLOG.ERR_DESC
--,CNTRLOG.EDI_RCV_STS_CD
,EDI_RCV_STS.ATTR_CTNT2 EDI_RCV_STS_CD
FROM BKG_CSTMS_ANR_EDI_HIS HIS 
,BKG_CSTMS_ANR_CNTR_LOG CNTRLOG
,BKG_HRD_CDG_CTNT EDI_SND_STS
,BKG_HRD_CDG_CTNT EDI_RCV_STS
WHERE 1=1
AND CNTRLOG.ANR_DECL_NO IN (SELECT MAX(ANR_DECL_NO)
					    FROM BKG_CSTMS_ANR_BL_LOG
						WHERE 1=1
						AND BL_NO     = @[bl_no]
						)
AND CNTRLOG.CNTR_NO IN (SELECT B.CNTR_NO
					    FROM BKG_CSTMS_ANR_BL A, BKG_CSTMS_ANR_CNTR B
						WHERE 1=1
						AND A.BL_NO     = @[bl_no]
						AND B.VSL_CD = A.VSL_CD
						AND B.SKD_VOY_NO = A.SKD_VOY_NO
						AND B.SKD_DIR_CD = A.SKD_DIR_CD
						AND B.BKG_NO = A.BKG_NO
						)
#if (${cntr_no} != '')
AND CNTRLOG.CNTR_NO = @[cntr_no]
#end
AND HIS.MSG_TP_CD   = 'C'
AND CNTRLOG.MSG_TP_CD(+)   = HIS.MSG_TP_CD
AND CNTRLOG.ANR_DECL_NO(+) = HIS.ANR_DECL_NO
AND CNTRLOG.REF_SEQ(+)     = HIS.REF_SEQ
AND EDI_SND_STS.HRD_CDG_ID(+) = 'ANR_CSTMS_ES_STS_CD'
AND EDI_SND_STS.ATTR_CTNT1(+) = HIS.EDI_SND_STS_CD
AND EDI_RCV_STS.HRD_CDG_ID(+) = 'ANR_CSTMS_ER_STS_CD'
AND EDI_RCV_STS.ATTR_CTNT1(+) = CNTRLOG.EDI_RCV_STS_CD
)
ORDER BY REF_SEQ, DIV
#end			]]></sql>
			<params>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
