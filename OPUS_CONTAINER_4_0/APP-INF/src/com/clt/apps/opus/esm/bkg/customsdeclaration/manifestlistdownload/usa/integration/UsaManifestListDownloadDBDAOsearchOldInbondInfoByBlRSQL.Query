<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UsaManifestListDownloadDBDAOsearchOldInbondInfoByBlRSQL">
			<desc><![CDATA[UsaOldInbondModiVO]]></desc>
			<sql><![CDATA[
SELECT ABL.BL_NO,
       ABL.USA_LST_LOC_CD AS ABL_USA_LST_LOC_CD,
       ABL.HUB_LOC_CD AS ABL_HUB_LOC_CD,
       IBD.IBD_TRSP_TP_CD,
       IBD.IBD_TRSP_NO,
       IBD.CSTMS_CLR_TP_CD AS IBD_CLR_TP_CD,
       IBD.FREE_TRD_ZN_FLG AS IBD_FREE_TRD_ZN_FLG,
       SUBSTR(CNT.CNTR_TPSZ_CD, 0, 1) AS CNT_CNTR_TP_CD,
       CLR.CSTMS_CLR_TP_CD AS CLR_CLR_TP_CD,
       CLR.FREE_TRD_ZN_FLG AS CLR_FREE_TRD_ZN_FLG,
       CLR.CNTR_TP_CD AS CLR_CNTR_TP_CD,
       '' AS CRE_USR_ID,
       '' AS UPD_USR_ID,

       --WIPED OFF CODE 63/64/65 FOR ARRIVAL AND 66/67/68 FOR EXPORTS (S)
       DECODE(RSLT.A_IND, '0', TO_CHAR(IBD.IBD_TRSP_ARR_DT, 'YYYY-MM-DD HH24:MI'), '') AS IBD_TRSP_ARR_DT,
       DECODE(RSLT.A_IND, '0', TO_CHAR(IBD.IBD_TRSP_ARR_ACPT_DT, 'YYYY-MM-DD HH24:MI'), '') AS IBD_TRSP_ARR_ACPT_DT,
       DECODE(RSLT.X_IND, '0', TO_CHAR(IBD.IBD_TRSP_XPT_DT, 'YYYY-MM-DD HH24:MI'), '') AS IBD_TRSP_XPT_DT,
       DECODE(RSLT.X_IND, '0', TO_CHAR(IBD.IBD_TRSP_XPT_ACPT_DT, 'YYYY-MM-DD HH24:MI'), '') AS IBD_TRSP_XPT_ACPT_DT,
       DECODE(RSLT.A_IND, '0', IBD.IBD_TRSP_ARR_SND_FLG, 'N') AS IBD_TRSP_ARR_SND_FLG,
       DECODE(RSLT.X_IND, '0', IBD.IBD_TRSP_XPT_SND_FLG, 'N') AS IBD_TRSP_XPT_SND_FLG
       --WIPED OFF CODE 63/64/65 FOR ARRIVAL AND 66/67/68 FOR EXPORTS (E)

  FROM BKG_CSTMS_ADV_IBD IBD,
       BKG_CSTMS_ADV_BL ABL,
       BKG_CSTMS_ADV_CNTR CNT,
       (SELECT POD_CD,
               DEL_CD,
               CSTMS_CLR_TP_CD,
               FREE_TRD_ZN_FLG,
               CNTR_TP_CD,
               RNUM
          FROM (SELECT B.POD_CD,
                       B.DEL_CD,
                       CLR.CSTMS_CLR_TP_CD,
                       CLR.FREE_TRD_ZN_FLG,
                       CLR.CNTR_TP_CD,
                       ROW_NUMBER() OVER(ORDER BY CLR.DEL_CD DESC) AS RNUM
                  FROM BKG_CSTMS_ADV_CLR_TP CLR,
                       BKG_BOOKING B,
#if (${bl_type} == 'H')
                       BKG_HBL H,
                       BKG_HBL_CUST C
                 WHERE H.BKG_NO = C.BKG_NO
                   AND H.HBL_SEQ = C.HBL_SEQ
                   AND H.BKG_NO > ' '
                   AND H.CNTR_MF_NO = @[bl_no] 
#else
                       BKG_CUSTOMER C
                 WHERE B.BL_NO = @[bl_no]
#end
                   AND B.BKG_NO = C.BKG_NO
                   AND C.BKG_CUST_TP_CD = DECODE(B.CUST_TO_ORD_FLG, 'Y', 'N', 'C')
                   AND C.CUST_CNT_CD = CLR.CUST_CNT_CD
                   AND C.CUST_SEQ = CLR.CUST_SEQ
                   AND B.POD_CD = CLR.POD_CD
                   AND CLR.DELT_FLG ='N'
                   AND B.DEL_CD = DECODE(CLR.DEL_CD, 'ALL', B.DEL_CD, CLR.DEL_CD)
                   AND B.CMDT_CD = DECODE(CLR.CMDT_CD, NULL, B.CMDT_CD, CLR.CMDT_CD)
                   AND B.SC_NO = DECODE(CLR.SC_NO, NULL, B.SC_NO, CLR.SC_NO))
         WHERE RNUM = 1) CLR,
       (SELECT NVL(MAX(CASE WHEN DSPO_CD IN ('63', '64', '65') THEN '1' ELSE '0' END), '0') AS A_IND,
               NVL(MAX(CASE WHEN DSPO_CD IN ('66', '67', '68') THEN '1' ELSE '0' END), '0') AS X_IND
          FROM BKG_CSTMS_ADV_RSLT
         WHERE CNT_CD = @[cnt_cd]
           AND BL_NO = @[bl_no]) RSLT
 WHERE ABL.CNT_CD = @[cnt_cd]
   AND ABL.BL_NO = @[bl_no]
   AND ABL.CNT_CD = IBD.CNT_CD(+)
   AND ABL.BL_NO = IBD.BL_NO(+)
   AND ABL.CNT_CD = CNT.CNT_CD(+)
   AND ABL.BL_NO = CNT.BL_NO(+)
   AND ABL.CSTMS_POD_CD = CLR.POD_CD(+)
   AND ABL.DEL_CD = CLR.DEL_CD(+)
   AND ROWNUM = 1			]]></sql>
			<params>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="cnt_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
