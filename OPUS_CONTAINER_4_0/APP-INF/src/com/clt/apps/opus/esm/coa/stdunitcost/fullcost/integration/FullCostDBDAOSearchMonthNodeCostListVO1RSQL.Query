<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="FullCostDBDAOSearchMonthNodeCostListVO1RSQL">
			<desc><![CDATA[COA_NOD_AVG_STND_COST 테이블의 데이터 조회 (Full)]]></desc>
			<sql><![CDATA[
SELECT  M.COST_ACT_GRP_CD
       ,M.STND_COST_CD
       ,K.COA_COST_SRC_CD
       ,COA_GET_COM_NM_FNC('COST_ACT_GRP_CD', M.COST_ACT_GRP_CD) GRP
       ,COA_GET_COM_NM_FNC('STND_COST_CD', M.STND_COST_CD) STND_COST_NM
       ,COA_GET_COM_NM_FNC('COA_COST_SRC_CD', K.COA_COST_SRC_CD) COA_COST_SRC_CD_NM
       ,K.LOCL_CURR_CD
       ,SUM(K.STND_COST_USD_AMT) COST
       ,DECODE(MAX(M.DG), 'Y', 'DG ', '') || DECODE(MAX(M.BB), 'Y', 'BB ', '') || DECODE(MAX(M.AK), 'Y', 'AK ', '') || DECODE(MAX(M.RF), 'Y', 'RF', '') SPCL
       ,DECODE(GROUPING(K.COA_COST_SRC_CD), 1, 1, 2) LVL
       ,'AVERAGE' COST_ASS_BSE_CD
     --,'USD' LOCL_CURR_CD
       ,DECODE(@[f_cost_loc_grp_cd], 'L','LCC', 'C','LOC', 'S','SCC', 'E','ECC', 'R','RCC', 'NOD') LOC_TYPE		--20160303.ADD
	     ,DECODE(GROUPING(K.COA_COST_SRC_CD), 1,  COA_GET_COM_NM_FNC('STND_COST_CD', M.STND_COST_CD), COA_GET_COM_NM_FNC('COA_COST_SRC_CD', K.COA_COST_SRC_CD)) COST_NM
  FROM (SELECT DISTINCT D.COST_ACT_GRP_CD
              ,B.STND_COST_CD
              ,B.COA_COST_SRC_CD
              ,B.SPCL_CGO_DG_FLG DG
              ,B.SPCL_CGO_BB_FLG BB
              ,B.SPCL_CGO_AWK_FLG AK
              ,B.SPCL_CGO_RF_FLG RF
          FROM COA_COST_SRC_ACCT B, COA_STND_ACCT C, COA_ACT_GRP_COST_MAPG D
         WHERE 1 = 1
           AND B.COST_SRC_SYS_CD = 'TES'
           
           #if (${f_spcl_cgo_dg_flg} == '') 
           AND B.SPCL_CGO_DG_FLG <> 'Y'
          #end    
                   
           #if (${f_spcl_cgo_bb_flg} == '') 
           AND B.SPCL_CGO_BB_FLG <> 'Y'
          #end 
           
           #if (${f_spcl_cgo_awk_flg} == '') 
           AND B.SPCL_CGO_AWK_FLG <> 'Y'
          #end 
           
           #if (${f_spcl_cgo_rf_flg} == '') 
           AND B.SPCL_CGO_RF_FLG <> 'Y'
          #end           

		   AND D.COST_APLY_FLG = 'Y'					--PCM.20141229.ADD
           AND B.STND_COST_CD = C.STND_COST_CD
           AND B.COA_COST_SRC_CD = D.COA_COST_SRC_CD
      
        GROUP BY D.COST_ACT_GRP_CD
              ,B.STND_COST_CD
              ,B.COA_COST_SRC_CD
              ,B.SPCL_CGO_DG_FLG
              ,B.SPCL_CGO_BB_FLG
              ,B.SPCL_CGO_AWK_FLG
              ,B.SPCL_CGO_RF_FLG) M
       ,(SELECT   D.COA_COST_SRC_CD
                 ,D.LOCL_CURR_CD
                 ,SUM(D.STND_COST_USD_AMT) STND_COST_USD_AMT
            FROM COA_NOD_AVG_STND_COST D
           WHERE 1 = 1

             AND D.NOD_CD IN (
	               NVL(COA_LOC_FNC(@[nod_cd], DECODE(@[f_cost_loc_grp_cd], 'L','LCC', 'C','LOC', 'S','SCC', 'E','ECC', 'R','RCC', 'NOD')), @[nod_cd])	--20160303.ADD
                 )

             #if (${f_cost_yrmon} != '') 
             AND D.COST_YRMON = @[f_cost_yrmon]
            #end
            
             #if (${f_full_mty_cd} != '') 
             AND D.FULL_MTY_CD = @[f_full_mty_cd]
            #end
            
             #if (${f_cntr_tpsz_cd} != '') 
             AND D.CNTR_TPSZ_CD = COA_UT_TPSZ_FNC((SELECT COST_UT_AMT_CD FROM COA_COST_SRC_ACCT WHERE COA_COST_SRC_CD = D.COA_COST_SRC_CD), REPLACE(@[f_cntr_tpsz_cd], 'RD', 'R'))
            #end
             					
             AND D.COST_LOC_GRP_CD = @[f_cost_loc_grp_cd]
        GROUP BY COA_COST_SRC_CD, LOCL_CURR_CD) K
       
  WHERE 1=1
   #if (${f_act_grp_cd} != '') 
   AND M.COST_ACT_GRP_CD = @[f_act_grp_cd]
 #else 
   AND M.COST_ACT_GRP_CD LIKE 'N%'
  #end
   AND M.COA_COST_SRC_CD = K.COA_COST_SRC_CD
GROUP BY M.COST_ACT_GRP_CD, M.STND_COST_CD, CUBE(K.COA_COST_SRC_CD), K.LOCL_CURR_CD			]]></sql>
			<params>
				<param name="f_cost_loc_grp_cd" type="12" value="" out="N"/>
				<param name="nod_cd" type="12" value="" out="N"/>
				<param name="f_cost_yrmon" type="12" value="" out="N"/>
				<param name="f_full_mty_cd" type="12" value="" out="N"/>
				<param name="f_cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="f_act_grp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
