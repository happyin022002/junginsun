<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingListSearchDBDAOsearchBkgCoffTmRSQL">
			<desc><![CDATA[Booking close / reopen하기 위한 list를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT BKG.VSL_CD||BKG.SKD_VOY_NO||BKG.SKD_DIR_CD VVD
        , BKG.POL_CD
        , BKG.YD_CD
        , BKG.BKG_OFC_CD 
        , nvl(COFF.BKG_CLZ_STS_CD, 'O') BKG_CLZ_STS_CD
        , decode(COFF.BKG_CLZ_STS_CD,null, 'Open','C','Closed','R','Re-open') BKG_CLZ_STS_NM
        , USR.OFC_CD
        , COFF.UPD_USR_ID
        , (SELECT USR_NM FROM COM_USER WHERE USR_ID =COFF.UPD_USR_ID) USR_NM
        , TO_CHAR(COFF.UPD_DT, 'YYYY-MM-DD') UPD_DT
        , BKG.VSL_CD
        , BKG.SKD_VOY_NO
        , BKG.SKD_DIR_CD
        , BKG.POL_CLPT_IND_SEQ AS CLPT_IND_SEQ
  FROM        
    (SELECT DISTINCT VVD.VSL_CD
            , VVD.SKD_VOY_NO
            , VVD.SKD_DIR_CD
            , VVD.POL_CD
            , SUBSTR(VVD.POL_YD_CD, 6, 2) YD_CD
            , VVD.POL_CLPT_IND_SEQ
            , BK.BKG_OFC_CD
      FROM BKG_BOOKING BK, BKG_VVD VVD
     WHERE BK.BKG_NO        = VVD.BKG_NO 
       AND BK.BKG_CGO_TP_CD <> 'P'
       AND BK.POL_CD        = VVD.POL_CD
#if (${vsl_cd}!='')
       AND VVD.VSL_CD       = SUBSTR(@[vsl_cd], 1, 4) 
       AND VVD.SKD_VOY_NO   = SUBSTR(@[vsl_cd], 5, 4) 
       AND VVD.SKD_DIR_CD   = SUBSTR(@[vsl_cd], 9, 1) 
#end

#if (${pol_cd} != '' && ${yd_cd} != '')
       AND VVD.POL_YD_CD    = @[pol_cd]||@[yd_cd]
#elseif (${pol_cd} != '')
       AND VVD.POL_CD       = @[pol_cd]
#end
  
#if (${ofc_cd} != '' && ${ofc_cd} !='All' )       
       AND BK.BKG_OFC_CD    = @[ofc_cd] 
#end
       ) BKG 
        , BKG_COFF_TM COFF, COM_USER USR
WHERE BKG.VSL_CD = COFF.VSL_CD(+)
  AND BKG.SKD_VOY_NO = COFF.SKD_VOY_NO(+)
  AND BKG.SKD_DIR_CD = COFF.SKD_DIR_CD(+)
  AND BKG.POL_CD = COFF.POL_CD(+)        
  AND BKG.BKG_OFC_CD = COFF.BKG_OFC_CD(+) 
  AND BKG.POL_CLPT_IND_SEQ = COFF.CLPT_IND_SEQ(+)
#if (${bkg_clz_sts_cd} != '' && ${bkg_clz_sts_cd} !='All' && ${bkg_clz_sts_cd} !='M') 
  AND nvl(COFF.BKG_CLZ_STS_CD, 'O') = @[bkg_clz_sts_cd]
#elseif (${bkg_clz_sts_cd} != '' && ${bkg_clz_sts_cd} =='M') 
  AND nvl(COFF.BKG_CLZ_STS_CD, 'O') in ('O','R')
#end

  AND COFF.UPD_USR_ID = USR.USR_ID(+)			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="bkg_clz_sts_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
