<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BlRatingDBDDAOSearchRatingApplyDateRSQL">
			<desc><![CDATA[BlRatingDBDSearchRatingApplyDate]]></desc>
			<sql><![CDATA[
/* 강제로 SearchRatingApplyDateVO 만듬 */
#if(${vo_create} =='VO')
SELECT 
	'' BKG_NO,
	'' FIRST_VVD,
	'' POL_CD,
	'' ETB,
	'' ETD,
	'' CNTR_NO,
	'' OC_DATE,
	'' OC_CY,
	'' OC_DATE,
	'' APPLY_DT,
	'' CA_FLG
FROM DUAL
#else
	#if(${ca_flg} =='Y')
		SELECT 
		A.BKG_NO,
		A.FIRST_VVD,
		A.POR_CD,
		A.POL_CD,
		A.POD_CD,
		A.DEL_CD,
		A.ETB,
		A.ETD,
		A.CNTR_NO,
		A.VSL_CD,
		A.SKD_VOY_NO,
		A.SKD_DIR_CD,
		A.CBKG_NO,
		A.CNMV_YR,
		A.CNMV_CYC_NO,
		TO_CHAR(BKG_REV_APLY_DT_PKG.BKG_GET_REV_APLY_DT_FNC (@[bkg_no],@[ca_flg]),'YYYY-MM-DD')  APPLY_DT,
		(SELECT ORG_YD_CD
		 FROM CTM_MOVEMENT K
		 WHERE 1=1
		 AND K.CNTR_NO = A.CNTR_NO
--		 AND K.CNMV_YR = A.CNMV_YR
		 AND K.MVMT_STS_CD ='OC'
		 AND K.CNMV_CYC_NO = A.CNMV_CYC_NO
		 AND K.CNMV_EVNT_DT = ( SELECT MIN(CNMV_EVNT_DT)
								FROM CTM_MOVEMENT Y
								 WHERE 1=1
								 AND Y.CNTR_NO = A.CNTR_NO
--								 AND Y.CNMV_YR = A.CNMV_YR
								 AND Y.MVMT_STS_CD ='OC'
								 AND Y.CNMV_CYC_NO = A.CNMV_CYC_NO)
								 AND ROWNUM = 1 ) OC_CY,
		(SELECT TO_CHAR(K.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI:SS')
		 FROM CTM_MOVEMENT K
		 WHERE 1=1
		 AND K.CNTR_NO = A.CNTR_NO
--		 AND K.CNMV_YR = A.CNMV_YR
		 AND K.MVMT_STS_CD ='OC'
		 AND K.CNMV_CYC_NO = A.CNMV_CYC_NO
		 AND K.CNMV_EVNT_DT = ( SELECT MIN(CNMV_EVNT_DT)
								FROM CTM_MOVEMENT Y
								 WHERE 1=1
								 AND Y.CNTR_NO = A.CNTR_NO
--								 AND Y.CNMV_YR = A.CNMV_YR
								 AND Y.MVMT_STS_CD ='OC'
								 AND Y.CNMV_CYC_NO = A.CNMV_CYC_NO)
								 AND ROWNUM = 1 ) OC_DATE
		FROM 
		(
		SELECT 
		    BK.BKG_NO BKG_NO,
		    VVD1.VSL_CD||VVD1.SKD_VOY_NO||VVD1.SKD_DIR_CD FIRST_VVD,
		    BK.POR_CD POR_CD,
			BK.POL_CD POL_CD,
			BK.POD_CD POD_CD,
			BK.DEL_CD DEL_CD,
		    (SELECT TO_CHAR(VPS_ETB_DT,'YYYY-MM-DD HH24:MI:SS') ETB
		     FROM VSK_VSL_PORT_SKD
		     WHERE VSL_CD = VVD1.VSL_CD
		       AND SKD_VOY_NO = VVD1.SKD_VOY_NO
		       AND SKD_DIR_CD = VVD1.SKD_DIR_CD
		       AND VPS_PORT_CD = VVD1.POL_CD
			   AND CLPT_IND_SEQ = VVD1.POL_CLPT_IND_SEQ) ETB,
		    (SELECT TO_CHAR(VPS_ETD_DT,'YYYY-MM-DD HH24:MI:SS') ETD
		     FROM VSK_VSL_PORT_SKD
		     WHERE VSL_CD = VVD1.VSL_CD
		       AND SKD_VOY_NO = VVD1.SKD_VOY_NO
		       AND SKD_DIR_CD = VVD1.SKD_DIR_CD
		       AND VPS_PORT_CD = VVD1.POL_CD
			   AND CLPT_IND_SEQ = VVD1.POL_CLPT_IND_SEQ) ETD,
		    CNTR.CNTR_NO CNTR_NO ,
		    VVD.VSL_CD VSL_CD,
		    VVD.SKD_VOY_NO SKD_VOY_NO,
		    VVD.SKD_DIR_CD SKD_DIR_CD,
		    CNTR.BKG_NO CBKG_NO,
		    CNTR.CNMV_YR,
		    CNTR.CNMV_CYC_NO,
			L.CONTI_CD CONTI_CD,
			TO_CHAR(CNTR.CGO_RCV_DT,'YYYY-MM-DD HH24:MI:SS') AS CGO_RCV_DT    
		    FROM BKG_BKG_HIS BK, BKG_VVD_HIS VVD, BKG_VVD_HIS VVD1, BKG_CNTR_HIS CNTR, MDM_LOCATION L
		    WHERE 1=1
		    AND BK.BKG_NO = @[bkg_no]
		    AND BK.BKG_NO = VVD.BKG_NO
		    AND BK.POD_CD = VVD.POD_CD
			AND BK.BKG_NO = VVD1.BKG_NO
			AND BK.POL_CD = VVD1.POL_CD
		    AND BK.BKG_NO = CNTR.BKG_NO(+)
			AND BK.CORR_NO = 'TMP0000001'
			AND VVD.CORR_NO ='TMP0000001'
			AND VVD1.CORR_NO ='TMP0000001'
			AND CNTR.CORR_NO ='TMP0000001'
			AND BK.POR_CD = L.LOC_CD
			AND L.DELT_FLG ='N'
		) A
	#else
			SELECT 
		A.BKG_NO,
		A.FIRST_VVD,
		A.POR_CD,
		A.POL_CD,
		A.POD_CD,
		A.DEL_CD,
		A.ETB,
		A.ETD,
		A.CNTR_NO,
		A.VSL_CD,
		A.SKD_VOY_NO,
		A.SKD_DIR_CD,
		A.CBKG_NO,
		A.CNMV_YR,
		A.CNMV_CYC_NO,
		TO_CHAR(BKG_REV_APLY_DT_PKG.BKG_GET_REV_APLY_DT_FNC (@[bkg_no],@[ca_flg]),'YYYY-MM-DD')  APPLY_DT,
		(SELECT ORG_YD_CD
		 FROM CTM_MOVEMENT K
		 WHERE 1=1
		 AND K.CNTR_NO = A.CNTR_NO
--		 AND K.CNMV_YR = A.CNMV_YR
		 AND K.MVMT_STS_CD ='OC'
		 AND K.CNMV_CYC_NO = A.CNMV_CYC_NO
		 AND K.CNMV_EVNT_DT = ( SELECT MIN(CNMV_EVNT_DT)
								FROM CTM_MOVEMENT Y
								 WHERE 1=1
								 AND Y.CNTR_NO = A.CNTR_NO
--								 AND Y.CNMV_YR = A.CNMV_YR
								 AND Y.MVMT_STS_CD ='OC'
								 AND Y.CNMV_CYC_NO = A.CNMV_CYC_NO) 
			AND ROWNUM = 1) OC_CY,
		(SELECT TO_CHAR(K.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI:SS')
		 FROM CTM_MOVEMENT K
		 WHERE 1=1
		 AND K.CNTR_NO = A.CNTR_NO
--		 AND K.CNMV_YR = A.CNMV_YR
		 AND K.MVMT_STS_CD ='OC'
		 AND K.CNMV_CYC_NO = A.CNMV_CYC_NO
		 AND K.CNMV_EVNT_DT = ( SELECT MIN(CNMV_EVNT_DT)
								FROM CTM_MOVEMENT Y
								 WHERE 1=1
								 AND Y.CNTR_NO = A.CNTR_NO
--								 AND Y.CNMV_YR = A.CNMV_YR
								 AND Y.MVMT_STS_CD ='OC'
								 AND Y.CNMV_CYC_NO = A.CNMV_CYC_NO) 
			AND ROWNUM = 1) OC_DATE
		FROM 
		(
		SELECT 
		    BK.BKG_NO BKG_NO,
		    VVD1.VSL_CD||VVD1.SKD_VOY_NO||VVD1.SKD_DIR_CD FIRST_VVD,
		    BK.POR_CD POR_CD,
			BK.POL_CD POL_CD,
			BK.POD_CD POD_CD,
			BK.DEL_CD DEL_CD,
		    (SELECT TO_CHAR(VPS_ETB_DT,'YYYY-MM-DD HH24:MI:SS') ETB
		     FROM VSK_VSL_PORT_SKD
		     WHERE VSL_CD = VVD1.VSL_CD
		       AND SKD_VOY_NO = VVD1.SKD_VOY_NO
		       AND SKD_DIR_CD = VVD1.SKD_DIR_CD
		       AND VPS_PORT_CD = VVD1.POL_CD
			   AND CLPT_IND_SEQ = VVD1.POL_CLPT_IND_SEQ) ETB,
		    (SELECT TO_CHAR(VPS_ETD_DT,'YYYY-MM-DD HH24:MI:SS') ETD
		     FROM VSK_VSL_PORT_SKD
		     WHERE VSL_CD = VVD1.VSL_CD
		       AND SKD_VOY_NO = VVD1.SKD_VOY_NO
		       AND SKD_DIR_CD = VVD1.SKD_DIR_CD
		       AND VPS_PORT_CD = VVD1.POL_CD
			   AND CLPT_IND_SEQ = VVD1.POL_CLPT_IND_SEQ) ETD,
		    CNTR.CNTR_NO CNTR_NO ,
		    VVD.VSL_CD VSL_CD,
		    VVD.SKD_VOY_NO SKD_VOY_NO,
		    VVD.SKD_DIR_CD SKD_DIR_CD,
		    CNTR.BKG_NO CBKG_NO,
		    CNTR.CNMV_YR,
		    CNTR.CNMV_CYC_NO,
			L.CONTI_CD,
			TO_CHAR(CNTR.CGO_RCV_DT,'YYYY-MM-DD HH24:MI:SS') AS CGO_RCV_DT    
		    FROM BKG_BOOKING BK, BKG_VVD VVD, BKG_VVD VVD1, BKG_CONTAINER CNTR, MDM_LOCATION L
		    WHERE 1=1
		    AND BK.BKG_NO = @[bkg_no]
		    AND BK.BKG_NO = VVD.BKG_NO
		    AND BK.POD_CD = VVD.POD_CD
			AND BK.BKG_NO = VVD1.BKG_NO
			AND BK.POL_CD = VVD1.POL_CD
		    AND BK.BKG_NO = CNTR.BKG_NO(+)
			AND BK.POR_CD = L.LOC_CD
			AND L.DELT_FLG = 'N'
		) A
	#end
#end			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="ca_flg" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
