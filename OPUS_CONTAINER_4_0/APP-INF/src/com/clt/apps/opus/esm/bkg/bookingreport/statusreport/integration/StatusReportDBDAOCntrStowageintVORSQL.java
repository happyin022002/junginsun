/*=========================================================
*Copyright(c) 2015 CyberLogitec
*@FileName : StatusReportDBDAOCntrStowageintVORSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2015.04.13
*@LastModifier : 
*@LastVersion : 1.0
* 2015.04.13 
* 1.0 Creation
=========================================================*/
package com.clt.apps.opus.esm.bkg.bookingreport.statusreport.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.clt.framework.support.db.ISQLTemplate;

/**
 *
 * @author 
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class StatusReportDBDAOCntrStowageintVORSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  *    
	  * </pre>
	  */
	public StatusReportDBDAOCntrStowageintVORSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("vvd_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("sp_cntr_ty_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("pol_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("bkg_ofc_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("cgo_tp",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("bound_type",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.clt.apps.opus.esm.bkg.bookingreport.statusreport.integration").append("\n"); 
		query.append("FileName : StatusReportDBDAOCntrStowageintVORSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("------------------------------------------------------------------------------                                                         " ).append("\n"); 
		query.append("--****************************************************************************                                                         " ).append("\n"); 
		query.append("------------------------------------------------------------------------------                                                         " ).append("\n"); 
		query.append("WITH TEMP_T AS (                                                                                                                       " ).append("\n"); 
		query.append("#if (${bkg_cgo_ty_cd} == 'U')                                                                                                          " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("#if (${bkg_ofc_cd} != '')                                                                                                              " ).append("\n"); 
		query.append("-------------------------------------------------------------------------------------                                                  " ).append("\n"); 
		query.append("--1.UNMATCH	                                                                                                                       " ).append("\n"); 
		query.append("  --1-1.OFFICE에 값 존재시                                                                                                             " ).append("\n"); 
		query.append("-------------------------------------------------------------------------------------                                                  " ).append("\n"); 
		query.append("	                                                                                                                               " ).append("\n"); 
		query.append("	SELECT /*+ USE_MERGE (BAY, ST) INDEX(BAY XPKBAY_PLAN_LDS) */  DISTINCT                                                                 " ).append("\n"); 
		query.append("              NVL(ST.CNTR_NO,'') CNTR_NO				--Container No                                                 " ).append("\n"); 
		query.append("         ,    NVL(ST.CNTR_TPSZ_CD,'') CNTRTS_CD		--T/P                                                                          " ).append("\n"); 
		query.append("         ,    'No' FLG								--Load                                                 " ).append("\n"); 
		query.append("         ,    NVL(BKG_NO,'') BKG_NO					--BKG No                                                       " ).append("\n"); 
		query.append("         ,    NVL(BL_NO,'') BL_NO					--B/L No                                                       " ).append("\n"); 
		query.append("         ,    NVL(ST.POL_CD,'') BK_POL				--B/L POL                                                              " ).append("\n"); 
		query.append("         ,    NVL(ST.POD_CD,'') BK_POD				--B/L POD                                                              " ).append("\n"); 
		query.append("         ,    NVL(BAY.POL_CD,'') BAY_POL			--STWG POL                                                             " ).append("\n"); 
		query.append("         ,    NVL(BAY.POD_CD,'') BAY_POD			--STWG POD                                                             " ).append("\n"); 
		query.append("         ,    '' STWG								--Stowage                                              " ).append("\n"); 
		query.append("--         ,    DECODE(NVL(CGO_TP,'M'),'M',NVL(LODG_DCHG_IND_CD,''),NVL(CGO_TP,'')) CGO_TP  --Stowage                                    " ).append("\n"); 
		query.append("		 ,    NVL(CGO_TP,FULL_MTY_CD) CGO_TP" ).append("\n"); 
		query.append("         ,    DG	--Special Container                                                                                            " ).append("\n"); 
		query.append("         ,    BB                                                                                                                       " ).append("\n"); 
		query.append("         ,    AK                                                                                                                       " ).append("\n"); 
		query.append("         ,    RF                                                                                                                       " ).append("\n"); 
		query.append("         ,    PC                                                                                                                       " ).append("\n"); 
		query.append("		 ,	  '' VVD_CD			--VVD                                                                          " ).append("\n"); 
		query.append("		 ,    '' POL_CD			--POL                                                                                  " ).append("\n"); 
		query.append("	     ,	  '' BOUND_TYPE		--공통 code(Inbound인경우는 POD_CD,OutBound인경우는 POL_CD가 입력된 Port Code임)               " ).append("\n"); 
		query.append("		 ,    '' STWG_STATUS	--Current,Previous                                                                             " ).append("\n"); 
		query.append("         ,    '' BKG_OFC_CD     --B/OFC                                                                                                " ).append("\n"); 
		query.append("         ,    '' BKG_CGO_TY_CD  --STWG & Doc (UNMATCH,MATCH)                                                                           " ).append("\n"); 
		query.append("		 ,	  '' SP_CNTR_TY_CD  --Special CNTR(DG,AK,BB...)	                                                               " ).append("\n"); 
		query.append("		 ,     decode((select  count(*) from bkg_container c,bkg_booking b                                                     " ).append("\n"); 
		query.append("                where c.bkg_no      = b.bkg_no                                                                                         " ).append("\n"); 
		query.append("                and   c.cntr_no     = st.cntr_no                                                                                       " ).append("\n"); 
		query.append("                and   b.vsl_cd      = st.bt_vsl_cd                                                                                     " ).append("\n"); 
		query.append("                and   b.skd_voy_no  = st.bt_skd_voy_no                                                                                 " ).append("\n"); 
		query.append("                and   b.skd_dir_cd  = st.bt_skd_dir_cd                                                                                 " ).append("\n"); 
		query.append("                and   b.pol_cd      = st.pol_cd                                                                                        " ).append("\n"); 
		query.append("                and   b.pod_cd      = st.pod_cd                                                                                        " ).append("\n"); 
		query.append("                AND   BKG_STS_CD IN ('F','A','W','S')                                                                                  " ).append("\n"); 
		query.append("                ),1,'N','Y') HBL                                                                                                       " ).append("\n"); 
		query.append("       FROM   (SELECT /*+ INDEX(BB XPKBAY_PLAN_LDS ) */                                                                                " ).append("\n"); 
		query.append("                      POL_CD                                                                                                           " ).append("\n"); 
		query.append("               ,      POD_CD                                                                                                           " ).append("\n"); 
		query.append("               ,      CNTR_REF_NO   --BPS_CNTR_NO                                                                                      " ).append("\n"); 
		query.append("               ,      VSL_CD                                                                                                           " ).append("\n"); 
		query.append("               ,      SKD_VOY_NO                                                                                                       " ).append("\n"); 
		query.append("               ,      SKD_DIR_CD                                                                                                       " ).append("\n"); 
		query.append("               ,      COD_PORT_CD  --VPS_LOC_CD                                                                                        " ).append("\n"); 
		query.append("               ,      LODG_DCHG_IND_CD                                                                                                 " ).append("\n"); 
		query.append("               ,      FULL_MTY_CD" ).append("\n"); 
		query.append("               FROM   OPF_BAY_PLN_LDIS                                                                                                 " ).append("\n"); 
		query.append("               WHERE  1=1                                                                                                              " ).append("\n"); 
		query.append("#if (${vvd_cd} != '')                                                                                                                  " ).append("\n"); 
		query.append("		  		AND ((VSL_CD, SKD_VOY_NO, SKD_DIR_CD) IN (                          " ).append("\n"); 
		query.append("          		                                                                                                               " ).append("\n"); 
		query.append("                         SELECT SKD.VSL_CD,SKD.SKD_VOY_NO,SKD.SKD_DIR_CD                    " ).append("\n"); 
		query.append("                         FROM   VSK_VSL_PORT_SKD SKD                                                                                   " ).append("\n"); 
		query.append("                         WHERE  VSL_CD =SUBSTR(@[vvd_cd],1,4)                                                                          " ).append("\n"); 
		query.append("                         AND    SKD_VOY_NO =SUBSTR(@[vvd_cd],5,4)                                                                      " ).append("\n"); 
		query.append("                         AND    SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)                                                                     " ).append("\n"); 
		query.append("                         AND    VPS_PORT_CD =@[pol_cd])	                                                                               " ).append("\n"); 
		query.append("                  OR (LODG_VSL_CD, LODG_VOY_NO, LODG_DIR_CD) IN (                          " ).append("\n"); 
		query.append("          		                                                                                                               " ).append("\n"); 
		query.append("                         SELECT SKD.VSL_CD,SKD.SKD_VOY_NO,SKD.SKD_DIR_CD                    " ).append("\n"); 
		query.append("                         FROM   VSK_VSL_PORT_SKD SKD                                                                                   " ).append("\n"); 
		query.append("                         WHERE  VSL_CD =SUBSTR(@[vvd_cd],1,4)                                                                          " ).append("\n"); 
		query.append("                         AND    SKD_VOY_NO =SUBSTR(@[vvd_cd],5,4)                                                                      " ).append("\n"); 
		query.append("                         AND    SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)                                                                     " ).append("\n"); 
		query.append("                         AND    VPS_PORT_CD =@[pol_cd])	" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("#end	                                                                                                                               " ).append("\n"); 
		query.append("#if (${bound_type} == 'I')                                                                                                             " ).append("\n"); 
		query.append("	AND    POD_CD LIKE '%' || @[pol_cd] || '%'                                                                                     " ).append("\n"); 
		query.append("#else                                                                                                                                  " ).append("\n"); 
		query.append("	AND    POL_CD LIKE '%' || @[pol_cd] || '%'                                                                                     " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("#if (${stwg_status} != 'C')                                                                                                            " ).append("\n"); 
		query.append("	                                                                                                                               " ).append("\n"); 
		query.append("				AND LODG_DCHG_IND_CD  = DECODE(@[bound_type],'I','D','L')  --IN ('L','D')                              " ).append("\n"); 
		query.append("#else                                                                                                                                  " ).append("\n"); 
		query.append("				AND LODG_DCHG_IND_CD = 'C'                                                                             " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("				                                                                                   " ).append("\n"); 
		query.append("               ) BAY,                                                                                                                  " ).append("\n"); 
		query.append("               (SELECT /*+ USE_NL(BKG_VVD,B,BKG_CNTR) */                                                                               " ).append("\n"); 
		query.append("                      B.BKG_NO                                                                                                         " ).append("\n"); 
		query.append("                ,     BKG_VVD.VSL_CD                                                                                                   " ).append("\n"); 
		query.append("                ,     B.POL_CD                                                                                                         " ).append("\n"); 
		query.append("                ,     B.POD_CD                                                                                                         " ).append("\n"); 
		query.append("                ,     BKG_CNTR.CNTR_NO                                                                                                 " ).append("\n"); 
		query.append("                ,     BKG_CNTR.CNTR_TPSZ_CD                                                                                            " ).append("\n"); 
		query.append("                ,     B.BL_NO --||B.BL_NO_TP||B.BL_NO_CHK|| B.BL_NO_TP BL_NO                                                           " ).append("\n"); 
		query.append("                ,     DECODE(B.BKG_CGO_TP_CD,'F','F','M') CGO_TP                                                                                          " ).append("\n"); 
		query.append("				,     DECODE(BKG_CNTR.DCGO_FLG,'Y','DG','') DG                                                         " ).append("\n"); 
		query.append("                ,     DECODE(BKG_CNTR.BB_CGO_FLG,'Y','BB','') BB                                                                       " ).append("\n"); 
		query.append("                ,     DECODE(BKG_CNTR.AWK_CGO_FLG,'Y','AK','') AK                                                                      " ).append("\n"); 
		query.append("                ,     DECODE(BKG_CNTR.RC_FLG,'Y','RF','') RF                                                                       " ).append("\n"); 
		query.append("                ,     DECODE(B.PRCT_FLG,'Y','PC','') PC                                                                                  " ).append("\n"); 
		query.append("				,     B.VSL_CD bt_vsl_cd                                                                               " ).append("\n"); 
		query.append("				,     B.SKD_VOY_NO bt_skd_voy_no                                                                       " ).append("\n"); 
		query.append("				,     B.SKD_DIR_CD bt_skd_dir_cd                                                                       " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("                FROM   BKG_CONTAINER BKG_CNTR, BKG_BOOKING B,BKG_VVD                                                                   " ).append("\n"); 
		query.append("                WHERE  BKG_VVD.BKG_NO   = B.BKG_NO                                                                                     " ).append("\n"); 
		query.append("                AND    B.BKG_NO             = BKG_CNTR.BKG_NO                                                                          " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("#if (${vvd_cd} != '')                                                                                                                  " ).append("\n"); 
		query.append("		  		AND (BKG_VVD.VSL_CD, BKG_VVD.SKD_VOY_NO, BKG_VVD.SKD_DIR_CD) IN (                                      " ).append("\n"); 
		query.append("          		                                                                                                               " ).append("\n"); 
		query.append("                         SELECT SKD.VSL_CD,SKD.SKD_VOY_NO,SKD.SKD_DIR_CD                                                               " ).append("\n"); 
		query.append("                         FROM   VSK_VSL_PORT_SKD SKD                                                                                   " ).append("\n"); 
		query.append("                         WHERE  VSL_CD =SUBSTR(@[vvd_cd],1,4)                                                                          " ).append("\n"); 
		query.append("                         AND    SKD_VOY_NO =SUBSTR(@[vvd_cd],5,4)                                                                      " ).append("\n"); 
		query.append("                         AND    SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)                                                                     " ).append("\n"); 
		query.append("                         AND    VPS_PORT_CD =@[pol_cd])	                                                                               " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("#if (${sp_cntr_ty_cd} != '')                                                                                                           " ).append("\n"); 
		query.append("				AND    CASE WHEN @[sp_cntr_ty_cd]= 'DG' THEN BKG_CNTR.DCGO_FLG                                         " ).append("\n"); 
		query.append("            				WHEN @[sp_cntr_ty_cd]= 'BB' THEN BKG_CNTR.BB_CGO_FLG                                           " ).append("\n"); 
		query.append("           	 				WHEN @[sp_cntr_ty_cd]= 'AK' THEN BKG_CNTR.AWK_CGO_FLG                                  " ).append("\n"); 
		query.append("							WHEN @[sp_cntr_ty_cd]= 'RF' THEN BKG_CNTR.RC_FLG                           " ).append("\n"); 
		query.append("            				WHEN @[sp_cntr_ty_cd]= 'PC' THEN B.PRCT_FLG ELSE 'Y' END = 'Y'                                 " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("#if (${bound_type} == 'I')                                                                                                             " ).append("\n"); 
		query.append("	     		AND    BKG_VVD.POD_CD LIKE '%' || @[pol_cd] || '%'                                                             " ).append("\n"); 
		query.append("#else                                                                                                                                  " ).append("\n"); 
		query.append("	     		AND    BKG_VVD.POL_CD LIKE '%' || @[pol_cd] || '%'                                                             " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("#if (${bkg_ofc_cd} != '')                                                                                                              " ).append("\n"); 
		query.append("                AND    B.BKG_OFC_CD  LIKE '%' || @[bkg_ofc_cd] || '%'                                                                  " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("                AND    B.BKG_STS_CD IN ('A','F','W','S') ) ST                                                                          " ).append("\n"); 
		query.append("         WHERE CNTR_NO = CNTR_REF_NO(+)                                                                                                " ).append("\n"); 
		query.append("         AND   CNTR_REF_NO IS NULL                                                                                                     " ).append("\n"); 
		query.append("#if (${cgo_tp} != '' && ${cgo_tp} != 'ALL')                                                                                                        " ).append("\n"); 
		query.append("		 AND   NVL(CGO_TP,FULL_MTY_CD) = @[cgo_tp]" ).append("\n"); 
		query.append("#end                                                                                                                  " ).append("\n"); 
		query.append("#else                                                                                                                                  " ).append("\n"); 
		query.append("-----------------------------------------------------------------------------------                                                    " ).append("\n"); 
		query.append("--1.UNMATCH	                                                                                                                       " ).append("\n"); 
		query.append("  --1-2.OFFICE에 값 없을시                                                                                                             " ).append("\n"); 
		query.append("-------------------------------------------------------------------------------------                                                  " ).append("\n"); 
		query.append("	SELECT /*+ USE_MERGE (BAY_PLAN_LDS, ST) INDEX(BAY_PLAN_LDS XPKBAY_PLAN_LDS ) */   DISTINCT                                             " ).append("\n"); 
		query.append("              NVL(BAY.CNTR_REF_NO,'') CNTR_NO                                                                                          " ).append("\n"); 
		query.append("      ,       NVL(ST.CNTR_TPSZ_CD,'') CNTRTS_CD                                                                                        " ).append("\n"); 
		query.append("      ,       'Yes' FLG                                                                                                                  " ).append("\n"); 
		query.append("      ,       '' BKG_NO                                                                                                                " ).append("\n"); 
		query.append("      ,       NVL(BL_NO,'') BL_NO                                                                                                      " ).append("\n"); 
		query.append("      ,       NVL(ST.POL_CD,'') BK_POL                                                                                                 " ).append("\n"); 
		query.append("      ,       NVL(ST.POD_CD,'') BK_POD                                                                                                 " ).append("\n"); 
		query.append("      ,       NVL(BAY.POL_CD,'') BAY_POL                                                                                               " ).append("\n"); 
		query.append("      ,       NVL(BAY.POD_CD,'') BAY_POD                                                                                               " ).append("\n"); 
		query.append("      ,       NVL(BAY.VSL_BAY_NO||BAY.VSL_ROW_NO||BAY.VSL_TR_NO,'') STWG                                                               " ).append("\n"); 
		query.append("--      ,       DECODE(NVL(CGO_TP,'M'),'M',NVL(BAY.LODG_DCHG_IND_CD,''),NVL(CGO_TP,'')) CGO_TP                                           " ).append("\n"); 
		query.append("	  ,		  NVL(CGO_TP,FULL_MTY_CD) CGO_TP" ).append("\n"); 
		query.append("      ,       DG                                                                                                                       " ).append("\n"); 
		query.append("      ,       BB                                                                                                                       " ).append("\n"); 
		query.append("      ,       AK                                                                                                                       " ).append("\n"); 
		query.append("      ,       RF                                                                                                                       " ).append("\n"); 
		query.append("      ,       PC                                                                                                                       " ).append("\n"); 
		query.append("      ,	  	  '' VVD_CD			--VVD                                                                                  " ).append("\n"); 
		query.append("	  ,       '' POL_CD			--POL                                                                                  " ).append("\n"); 
		query.append("	  ,	      '' BOUND_TYPE		--공통 code(Inbound인경우는 POD_CD,OutBound인경우는 POL_CD가 입력된 Port Code임)       " ).append("\n"); 
		query.append("	  ,       '' STWG_STATUS	--Current,Previous                                                                             " ).append("\n"); 
		query.append("      ,       '' BKG_OFC_CD     --B/OFC                                                                                                " ).append("\n"); 
		query.append("      ,       '' BKG_CGO_TY_CD  --STWG & Doc (UNMATCH,MATCH)                                                                           " ).append("\n"); 
		query.append("	  ,	      '' SP_CNTR_TY_CD  --Special CNTR(DG,AK,BB...)                                                                    " ).append("\n"); 
		query.append("	  ,     decode((select  count(*) from bkg_container c,bkg_booking b                                                            " ).append("\n"); 
		query.append("                where c.bkg_no      = b.bkg_no                                                                                         " ).append("\n"); 
		query.append("                and   c.cntr_no     = st.cntr_no                                                                                       " ).append("\n"); 
		query.append("                and   b.vsl_cd      = st.bt_vsl_cd                                                                                     " ).append("\n"); 
		query.append("                and   b.skd_voy_no  = st.bt_skd_voy_no                                                                                 " ).append("\n"); 
		query.append("                and   b.skd_dir_cd  = st.bt_skd_dir_cd                                                                                 " ).append("\n"); 
		query.append("                and   b.pol_cd      = st.pol_cd                                                                                        " ).append("\n"); 
		query.append("                and   b.pod_cd      = st.pod_cd                                                                                        " ).append("\n"); 
		query.append("                AND   BKG_STS_CD IN ('F','A','W','S')                                                                                  " ).append("\n"); 
		query.append("                ),1,'N','Y') HBL                                                                                                       " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("         FROM OPF_BAY_PLN_LDIS BAY                                                                                                     " ).append("\n"); 
		query.append("         ,    (SELECT /*+ USE_NL(BKG_VVD,B,BKG_CNTR) */                                                                                " ).append("\n"); 
		query.append("                      B.POL_CD                                                                                                         " ).append("\n"); 
		query.append("               ,      B.POD_CD                                                                                                         " ).append("\n"); 
		query.append("			   ,	  BKG_VVD.VSL_CD                                                                                       " ).append("\n"); 
		query.append("			   , 	  BKG_VVD.SKD_VOY_NO                                                                                   " ).append("\n"); 
		query.append("               , 	  BKG_VVD.SKD_DIR_CD	                                                                                       " ).append("\n"); 
		query.append("               ,      BKG_CNTR.CNTR_NO                                                                                                 " ).append("\n"); 
		query.append("               ,      BKG_CNTR.CNTR_TPSZ_CD                                                                                            " ).append("\n"); 
		query.append("               ,      B.BL_NO  --||B.BL_NO_TP||B.BL_NO_CHK|| B.BL_NO_TP BL_NO                                                          " ).append("\n"); 
		query.append("               ,      DECODE(B.BKG_CGO_TP_CD,'F','F','M') CGO_TP                                                                                          " ).append("\n"); 
		query.append("               ,      DECODE(BKG_CNTR.DCGO_FLG,'Y','DG','') DG                                                                         " ).append("\n"); 
		query.append("               ,      DECODE(BKG_CNTR.BB_CGO_FLG,'Y','BB','') BB                                                                       " ).append("\n"); 
		query.append("               ,      DECODE(BKG_CNTR.AWK_CGO_FLG,'Y','AK','') AK                                                                      " ).append("\n"); 
		query.append("               ,      DECODE(BKG_CNTR.RC_FLG,'Y','RF','') RF                                                                       " ).append("\n"); 
		query.append("               ,      DECODE(B.PRCT_FLG,'Y','PC','') PC                                                                                   " ).append("\n"); 
		query.append("			   ,     B.VSL_CD bt_vsl_cd                                                                                    " ).append("\n"); 
		query.append(" 			   ,     B.SKD_VOY_NO bt_skd_voy_no                                                                            " ).append("\n"); 
		query.append("			   ,     B.SKD_DIR_CD bt_skd_dir_cd                                                                            " ).append("\n"); 
		query.append("              	                                                                                                                       " ).append("\n"); 
		query.append("               FROM   BKG_CONTAINER BKG_CNTR, BKG_BOOKING B,BKG_VVD                                                                    " ).append("\n"); 
		query.append("               WHERE  BKG_VVD.BKG_NO = B.BKG_NO                                                                                        " ).append("\n"); 
		query.append("               AND    B.BKG_NO = BKG_CNTR.BKG_NO                                                                                       " ).append("\n"); 
		query.append("#if (${vvd_cd} != '')                                                                                                                  " ).append("\n"); 
		query.append("		  		AND (BKG_VVD.VSL_CD, BKG_VVD.SKD_VOY_NO, BKG_VVD.SKD_DIR_CD) IN (                                      " ).append("\n"); 
		query.append("          		                                                                                                               " ).append("\n"); 
		query.append("                         SELECT SKD.VSL_CD,SKD.SKD_VOY_NO,SKD.SKD_DIR_CD                                                               " ).append("\n"); 
		query.append("                         FROM   VSK_VSL_PORT_SKD SKD                                                                                   " ).append("\n"); 
		query.append("                         WHERE  VSL_CD =SUBSTR(@[vvd_cd],1,4)                                                                          " ).append("\n"); 
		query.append("                         AND    SKD_VOY_NO =SUBSTR(@[vvd_cd],5,4)                                                                      " ).append("\n"); 
		query.append("                         AND    SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)                                                                     " ).append("\n"); 
		query.append("                         AND    VPS_PORT_CD =@[pol_cd] " ).append("\n"); 
		query.append("						 AND    NVL(SKD_CNG_STS_CD,'X') <> 'S'" ).append("\n"); 
		query.append("                         UNION ALL" ).append("\n"); 
		query.append("                         SELECT SKD.VSL_CD,SKD.SKD_VOY_NO,SKD.SKD_DIR_CD                     " ).append("\n"); 
		query.append("                         FROM   VSK_VSL_PORT_SKD SKD   " ).append("\n"); 
		query.append("                         WHERE  VSL_CD =SUBSTR(@[vvd_cd],1,4)                                                                          " ).append("\n"); 
		query.append("                         AND    TURN_SKD_VOY_NO =SUBSTR(@[vvd_cd],5,4)                                                                      " ).append("\n"); 
		query.append("                         AND    TURN_SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)                                                                     " ).append("\n"); 
		query.append("                         AND    VPS_PORT_CD =@[pol_cd] " ).append("\n"); 
		query.append("                         AND    NVL(SKD_CNG_STS_CD,'X') <> 'S' " ).append("\n"); 
		query.append("						)	                                                                              " ).append("\n"); 
		query.append("#end			   	                                                                                                       " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("#if (${bound_type} == 'I')                                                                                                             " ).append("\n"); 
		query.append("	     		AND BKG_VVD.POD_CD LIKE '%' || @[pol_cd] || '%'                                                                " ).append("\n"); 
		query.append("#else                                                                                                                                  " ).append("\n"); 
		query.append("	     		AND BKG_VVD.POL_CD LIKE '%' || @[pol_cd] || '%'                                                                " ).append("\n"); 
		query.append("#end	                                                                                                                               " ).append("\n"); 
		query.append("                AND    B.BKG_STS_CD IN ('F','W','A','S')                                                                               " ).append("\n"); 
		query.append("               /*AND    (NVL(B.BKG_NO_GEN_IND,'M') = 'M') */ ) ST                                                                      " ).append("\n"); 
		query.append("         WHERE BAY.CNTR_REF_NO   = CNTR_NO(+)                                                                                          " ).append("\n"); 
		query.append("#if (${vvd_cd} != '')                                                                                                                  " ).append("\n"); 
		query.append("		 AND   BAY.VSL_CD = ST.VSL_CD(+)                                                                                          " ).append("\n"); 
		query.append("         AND   BAY.SKD_VOY_NO = ST.SKD_VOY_NO(+)                                                                                          " ).append("\n"); 
		query.append("         AND   BAY.SKD_DIR_CD = ST.SKD_DIR_CD(+)                                                                                          " ).append("\n"); 
		query.append("         AND   ((BAY.VSL_CD, BAY.SKD_VOY_NO, BAY.SKD_DIR_CD) IN (                       " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("			SELECT SKD.VSL_CD,SKD.SKD_VOY_NO,SKD.SKD_DIR_CD" ).append("\n"); 
		query.append("			FROM   VSK_VSL_PORT_SKD SKD                                                                                    " ).append("\n"); 
		query.append("            WHERE  VSL_CD =SUBSTR(@[vvd_cd],1,4)                                                                                       " ).append("\n"); 
		query.append("            AND    SKD_VOY_NO =SUBSTR(@[vvd_cd],5,4)                                                                                   " ).append("\n"); 
		query.append("            AND    SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)                                                                                  " ).append("\n"); 
		query.append("            AND    VPS_PORT_CD =@[pol_cd]" ).append("\n"); 
		query.append("			UNION ALL" ).append("\n"); 
		query.append("            SELECT SKD.VSL_CD,SKD.SKD_VOY_NO,SKD.SKD_DIR_CD                 " ).append("\n"); 
		query.append("            FROM   VSK_VSL_PORT_SKD SKD   " ).append("\n"); 
		query.append("            WHERE  VSL_CD =SUBSTR(@[vvd_cd],1,4)                                                                          " ).append("\n"); 
		query.append("            AND    TURN_SKD_VOY_NO =SUBSTR(@[vvd_cd],5,4)                                                                      " ).append("\n"); 
		query.append("            AND    TURN_SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)                                                                     " ).append("\n"); 
		query.append("            AND    VPS_PORT_CD =@[pol_cd]" ).append("\n"); 
		query.append("            AND    NVL(SKD_CNG_STS_CD,'X') <> 'S'  " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("			)   " ).append("\n"); 
		query.append("			OR    " ).append("\n"); 
		query.append("			(BAY.LODG_VSL_CD,BAY.LODG_VOY_NO,BAY.LODG_DIR_CD) IN (                       " ).append("\n"); 
		query.append("            SELECT SKD.VSL_CD,SKD.SKD_VOY_NO,SKD.SKD_DIR_CD                       " ).append("\n"); 
		query.append("			FROM   VSK_VSL_PORT_SKD SKD                                                                                    " ).append("\n"); 
		query.append("            WHERE  VSL_CD =SUBSTR(@[vvd_cd],1,4)                                                                                       " ).append("\n"); 
		query.append("            AND    SKD_VOY_NO =SUBSTR(@[vvd_cd],5,4)                                                                                   " ).append("\n"); 
		query.append("            AND    SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)                                                                                  " ).append("\n"); 
		query.append("            AND    VPS_PORT_CD =@[pol_cd]" ).append("\n"); 
		query.append("			UNION ALL" ).append("\n"); 
		query.append("            SELECT SKD.VSL_CD,SKD.SKD_VOY_NO,SKD.SKD_DIR_CD                 " ).append("\n"); 
		query.append("            FROM   VSK_VSL_PORT_SKD SKD   " ).append("\n"); 
		query.append("            WHERE  VSL_CD =SUBSTR(@[vvd_cd],1,4)                                                                          " ).append("\n"); 
		query.append("            AND    TURN_SKD_VOY_NO =SUBSTR(@[vvd_cd],5,4)                                                                      " ).append("\n"); 
		query.append("            AND    TURN_SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)                                                                     " ).append("\n"); 
		query.append("            AND    VPS_PORT_CD =@[pol_cd]" ).append("\n"); 
		query.append("            AND    NVL(SKD_CNG_STS_CD,'X') <> 'S'  " ).append("\n"); 
		query.append("            ))                                                                  " ).append("\n"); 
		query.append("#end		                                                                                                                       " ).append("\n"); 
		query.append("#if (${bound_type} == 'I')                                                                                                             " ).append("\n"); 
		query.append("	     AND    BAY.POD_CD LIKE '%' || @[pol_cd] || '%'                                                                            " ).append("\n"); 
		query.append("#else                                                                                                                                  " ).append("\n"); 
		query.append("	     AND    BAY.POL_CD LIKE '%' || @[pol_cd] || '%'                                                                            " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("#if (${sp_cntr_ty_cd} != '')                                                                                                           " ).append("\n"); 
		query.append("		 AND    CASE WHEN @[sp_cntr_ty_cd]= 'DG' THEN ST.DG                                                                    " ).append("\n"); 
		query.append("            		 WHEN @[sp_cntr_ty_cd]= 'BB' THEN ST.BB                                                                        " ).append("\n"); 
		query.append("           	 		 WHEN @[sp_cntr_ty_cd]= 'AK' THEN ST.AK                                                                " ).append("\n"); 
		query.append("					 WHEN @[sp_cntr_ty_cd]= 'RF' THEN ST.RF                                                        " ).append("\n"); 
		query.append("            		 WHEN @[sp_cntr_ty_cd]= 'PC' THEN ST.PC ELSE 'Y' END = 'Y'                                                     " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("         AND   CNTR_NO IS  NULL                                                                                                        " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("#if (${cgo_tp} != '' && ${cgo_tp} != 'ALL')" ).append("\n"); 
		query.append("--		 AND   DECODE(NVL(CGO_TP,'M'),'M',NVL(BAY.LODG_DCHG_IND_CD,''),NVL(CGO_TP,'')) = [lodg_dchg_ind_cd]                   " ).append("\n"); 
		query.append("		 AND   NVL(CGO_TP,FULL_MTY_CD) = @[cgo_tp]" ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("#if (${stwg_status} != 'C')                                                                  " ).append("\n"); 
		query.append("		AND BAY.LODG_DCHG_IND_CD  = DECODE(@[bound_type],'I','D','L')  --IN ('L','D')                                                                             " ).append("\n"); 
		query.append("#else                                                                                                                                  " ).append("\n"); 
		query.append("		AND BAY.LODG_DCHG_IND_CD = 'C'                                                                                         " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("		                                                                                                " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("       UNION ALL                                                                                                                       " ).append("\n"); 
		query.append("       SELECT /*+ USE_MERGE (BAY, ST) INDEX(BAY XPKBAY_PLAN_LDS ) */                                                                   " ).append("\n"); 
		query.append("              NVL(CNTR_NO,'') CNTR_NO                                                                                                  " ).append("\n"); 
		query.append("       ,      NVL(ST.CNTR_TPSZ_CD,'') CNTRTS_CD                                                                                        " ).append("\n"); 
		query.append("       ,      'No' FLG                                                                                                                  " ).append("\n"); 
		query.append("       ,      NVL(BKG_NO,'') BKG_NO                                                                                                    " ).append("\n"); 
		query.append("       ,      NVL(BL_NO,'') BL_NO                                                                                                      " ).append("\n"); 
		query.append("       ,      NVL(ST.POL_CD,'') BK_POL                                                                                                 " ).append("\n"); 
		query.append("       ,      NVL(ST.POD_CD,'') BK_POD                                                                                                 " ).append("\n"); 
		query.append("       ,      NVL(BAY.POL_CD,'') BAY_POL                                                                                               " ).append("\n"); 
		query.append("       ,      NVL(BAY.POD_CD,'') BAY_POD                                                                                               " ).append("\n"); 
		query.append("       ,      '' STWG                                                                                                                  " ).append("\n"); 
		query.append("--       ,      DECODE(NVL(CGO_TP,'M'),'M',NVL(LODG_DCHG_IND_CD,' '),NVL(CGO_TP,' ')) CGO_TP                                           " ).append("\n"); 
		query.append("       ,      NVL(CGO_TP,FULL_MTY_CD) CGO_TP  " ).append("\n"); 
		query.append("       ,      DG                                                                                                                       " ).append("\n"); 
		query.append("       ,      BB                                                                                                                       " ).append("\n"); 
		query.append("       ,      AK                                                                                                                       " ).append("\n"); 
		query.append("       ,      RF                                                                                                                       " ).append("\n"); 
		query.append("       ,      PC                                                                                                                       " ).append("\n"); 
		query.append("	  ,	  	  '' VVD_CD			--VVD                                                                          " ).append("\n"); 
		query.append("	  ,       '' POL_CD			--POL                                                                                  " ).append("\n"); 
		query.append("	  ,	      '' BOUND_TYPE		--공통 code(Inbound인경우는 POD_CD,OutBound인경우는 POL_CD가 입력된 Port Code임)       " ).append("\n"); 
		query.append("      ,    	  '' STWG_STATUS	--Current,Previous                                                                             " ).append("\n"); 
		query.append("      ,       '' BKG_OFC_CD     --B/OFC                                                                                                " ).append("\n"); 
		query.append("      ,       '' BKG_CGO_TY_CD  --STWG & Doc (UNMATCH,MATCH)                                                                           " ).append("\n"); 
		query.append("	  ,	      '' SP_CNTR_TY_CD  --Special CNTR(DG,AK,BB...)                                                                    " ).append("\n"); 
		query.append("	  ,     decode((select  count(*) from bkg_container c,bkg_booking b                                                            " ).append("\n"); 
		query.append("                where c.bkg_no      = b.bkg_no                                                                                         " ).append("\n"); 
		query.append("                and   c.cntr_no     = st.cntr_no                                                                                       " ).append("\n"); 
		query.append("                and   b.vsl_cd      = st.bt_vsl_cd                                                                                     " ).append("\n"); 
		query.append("                and   b.skd_voy_no  = st.bt_skd_voy_no                                                                                 " ).append("\n"); 
		query.append("                and   b.skd_dir_cd  = st.bt_skd_dir_cd                                                                                 " ).append("\n"); 
		query.append("                and   b.pol_cd      = st.pol_cd                                                                                        " ).append("\n"); 
		query.append("                and   b.pod_cd      = st.pod_cd                                                                                        " ).append("\n"); 
		query.append("                AND   BKG_STS_CD IN ('F','A','W','S')                                                                                  " ).append("\n"); 
		query.append("                ),1,'N','Y') HBL                                                                                                       " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("       FROM   (SELECT /*+ INDEX(BB XPKBAY_PLAN_LDS ) */                                                                                " ).append("\n"); 
		query.append("                      POL_CD                                                                                                           " ).append("\n"); 
		query.append("               ,      POD_CD                                                                                                           " ).append("\n"); 
		query.append("               ,      CNTR_REF_NO   --BPS_CNTR_NO                                                                                      " ).append("\n"); 
		query.append("               ,      VSL_CD                                                                                                           " ).append("\n"); 
		query.append("               ,      SKD_VOY_NO                                                                                                       " ).append("\n"); 
		query.append("               ,      SKD_DIR_CD                                                                                                       " ).append("\n"); 
		query.append("               ,      COD_PORT_CD  --VPS_LOC_CD                                                                                        " ).append("\n"); 
		query.append("               ,      LODG_DCHG_IND_CD                                                                                                 " ).append("\n"); 
		query.append("               ,      FULL_MTY_CD" ).append("\n"); 
		query.append("               FROM   OPF_BAY_PLN_LDIS                                                                                                 " ).append("\n"); 
		query.append("               WHERE  1=1                                                                                                              " ).append("\n"); 
		query.append("#if (${vvd_cd} != '')                                                                                                                  " ).append("\n"); 
		query.append("			   #if (${vvd_cd} != '')                                                                                       " ).append("\n"); 
		query.append("		  		AND ((VSL_CD, SKD_VOY_NO, SKD_DIR_CD) IN (                          " ).append("\n"); 
		query.append("          		                                                                                                               " ).append("\n"); 
		query.append("                         SELECT SKD.VSL_CD,SKD.SKD_VOY_NO,SKD.SKD_DIR_CD                    " ).append("\n"); 
		query.append("                         FROM   VSK_VSL_PORT_SKD SKD                                                                                   " ).append("\n"); 
		query.append("                         WHERE  VSL_CD =SUBSTR(@[vvd_cd],1,4)                                                                          " ).append("\n"); 
		query.append("                         AND    SKD_VOY_NO =SUBSTR(@[vvd_cd],5,4)                                                                      " ).append("\n"); 
		query.append("                         AND    SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)                                                                     " ).append("\n"); 
		query.append("                         AND    VPS_PORT_CD =@[pol_cd]" ).append("\n"); 
		query.append("						 AND    NVL(SKD_CNG_STS_CD,'X') <> 'S'" ).append("\n"); 
		query.append("                         UNION ALL" ).append("\n"); 
		query.append("                         SELECT SKD.VSL_CD,SKD.SKD_VOY_NO,SKD.SKD_DIR_CD                     " ).append("\n"); 
		query.append("                         FROM   VSK_VSL_PORT_SKD SKD   " ).append("\n"); 
		query.append("                         WHERE  VSL_CD =SUBSTR(@[vvd_cd],1,4)                                                                          " ).append("\n"); 
		query.append("                         AND    TURN_SKD_VOY_NO =SUBSTR(@[vvd_cd],5,4)                                                                      " ).append("\n"); 
		query.append("                         AND    TURN_SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)                                                                     " ).append("\n"); 
		query.append("                         AND    VPS_PORT_CD =@[pol_cd]" ).append("\n"); 
		query.append("                         AND    NVL(SKD_CNG_STS_CD,'X') <> 'S'" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("						)	" ).append("\n"); 
		query.append("			 	OR (LODG_VSL_CD,LODG_VOY_NO,LODG_DIR_CD) IN (                          " ).append("\n"); 
		query.append("          		                                                                                                               " ).append("\n"); 
		query.append("                         SELECT SKD.VSL_CD,SKD.SKD_VOY_NO,SKD.SKD_DIR_CD                     " ).append("\n"); 
		query.append("                         FROM   VSK_VSL_PORT_SKD SKD                                                                                   " ).append("\n"); 
		query.append("                         WHERE  VSL_CD =SUBSTR(@[vvd_cd],1,4)                                                                          " ).append("\n"); 
		query.append("                         AND    SKD_VOY_NO =SUBSTR(@[vvd_cd],5,4)                                                                      " ).append("\n"); 
		query.append("                         AND    SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)                                                                     " ).append("\n"); 
		query.append("                         AND    VPS_PORT_CD =@[pol_cd]" ).append("\n"); 
		query.append("						 AND    NVL(SKD_CNG_STS_CD,'X') <> 'S'" ).append("\n"); 
		query.append("                         UNION ALL" ).append("\n"); 
		query.append("                         SELECT SKD.VSL_CD,SKD.SKD_VOY_NO,SKD.SKD_DIR_CD                     " ).append("\n"); 
		query.append("                         FROM   VSK_VSL_PORT_SKD SKD   " ).append("\n"); 
		query.append("                         WHERE  VSL_CD =SUBSTR(@[vvd_cd],1,4)                                                                          " ).append("\n"); 
		query.append("                         AND    TURN_SKD_VOY_NO =SUBSTR(@[vvd_cd],5,4)                                                                      " ).append("\n"); 
		query.append("                         AND    TURN_SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)                                                                     " ).append("\n"); 
		query.append("                         AND    VPS_PORT_CD =@[pol_cd]" ).append("\n"); 
		query.append("                         AND    NVL(SKD_CNG_STS_CD,'X') <> 'S'" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("						))                                                                               " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("#if (${bound_type} == 'I')                                                                                                             " ).append("\n"); 
		query.append("	     		AND POD_CD LIKE '%' || @[pol_cd] || '%'                                                                        " ).append("\n"); 
		query.append("#else                                                                                                                                  " ).append("\n"); 
		query.append("	     		AND POL_CD LIKE '%' || @[pol_cd] || '%'                                                                        " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("#if (${stwg_status} != 'C')                                                                                                            " ).append("\n"); 
		query.append("				AND LODG_DCHG_IND_CD  = DECODE(@[bound_type],'I','D','L')  --IN ('L','D')      " ).append("\n"); 
		query.append("#else                                                                                                                                  " ).append("\n"); 
		query.append("				AND LODG_DCHG_IND_CD = 'C'                                                                             " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("				                                                                                     " ).append("\n"); 
		query.append("               ) BAY ,                                                                                                                 " ).append("\n"); 
		query.append("               (SELECT /*+ USE_NL(BKG_VVD,B,BKG_CNTR) */                                                                               " ).append("\n"); 
		query.append("                      B.BKG_NO                                                                                                         " ).append("\n"); 
		query.append("                ,     BKG_VVD.VSL_CD                                                                                                   " ).append("\n"); 
		query.append("                ,     B.POL_CD                                                                                                         " ).append("\n"); 
		query.append("                ,     B.POD_CD                                                                                                         " ).append("\n"); 
		query.append("                ,     BKG_CNTR.CNTR_NO                                                                                                 " ).append("\n"); 
		query.append("                ,     BKG_CNTR.CNTR_TPSZ_CD                                                                                            " ).append("\n"); 
		query.append("                ,     B.BL_NO  --||B.BL_NO_TP||B.BL_NO_CHK|| B.BL_NO_TP BL_NO                                                          " ).append("\n"); 
		query.append("                ,     DECODE(B.BKG_CGO_TP_CD,'F','F','M') CGO_TP                                                                                          " ).append("\n"); 
		query.append("                ,     DECODE(BKG_CNTR.DCGO_FLG,'Y','DG','') DG                                                                         " ).append("\n"); 
		query.append("                ,     DECODE(BKG_CNTR.BB_CGO_FLG,'Y','BB','') BB                                                                       " ).append("\n"); 
		query.append("                ,     DECODE(BKG_CNTR.AWK_CGO_FLG,'Y','AK','') AK                                                                      " ).append("\n"); 
		query.append("                ,     DECODE(BKG_CNTR.RC_FLG,'Y','RF','') RF                                                                       " ).append("\n"); 
		query.append("                ,     DECODE(B.PRCT_FLG,'Y','PC','') PC                                                                                                       " ).append("\n"); 
		query.append("				,     B.VSL_CD bt_vsl_cd                                                                               " ).append("\n"); 
		query.append("				,     B.SKD_VOY_NO bt_skd_voy_no                                                                       " ).append("\n"); 
		query.append("				,     B.SKD_DIR_CD bt_skd_dir_cd                                                                       " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("                FROM   BKG_CONTAINER BKG_CNTR                                                                                          " ).append("\n"); 
		query.append("                ,      BKG_BOOKING B                                                                                                   " ).append("\n"); 
		query.append("                ,      BKG_VVD                                                                                                         " ).append("\n"); 
		query.append("                WHERE  BKG_VVD.BKG_NO = B.BKG_NO                                                                                       " ).append("\n"); 
		query.append("                AND    B.BKG_NO = BKG_CNTR.BKG_NO                                                                                      " ).append("\n"); 
		query.append("#if (${vvd_cd} != '')                                                                                                                  " ).append("\n"); 
		query.append("		  		AND (BKG_VVD.VSL_CD, BKG_VVD.SKD_VOY_NO, BKG_VVD.SKD_DIR_CD) IN (                                      " ).append("\n"); 
		query.append("          		                                                                                                               " ).append("\n"); 
		query.append("                         SELECT SKD.VSL_CD,SKD.SKD_VOY_NO,SKD.SKD_DIR_CD                                                               " ).append("\n"); 
		query.append("                         FROM   VSK_VSL_PORT_SKD SKD                                                                                   " ).append("\n"); 
		query.append("                         WHERE  VSL_CD =SUBSTR(@[vvd_cd],1,4)                                                                          " ).append("\n"); 
		query.append("                         AND    SKD_VOY_NO =SUBSTR(@[vvd_cd],5,4)                                                                      " ).append("\n"); 
		query.append("                         AND    SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)                                                                     " ).append("\n"); 
		query.append("                         AND    VPS_PORT_CD =@[pol_cd]" ).append("\n"); 
		query.append("						 AND    NVL(SKD_CNG_STS_CD,'X') <> 'S'" ).append("\n"); 
		query.append("						 UNION ALL" ).append("\n"); 
		query.append("                         SELECT SKD.VSL_CD,SKD.SKD_VOY_NO,SKD.SKD_DIR_CD                     " ).append("\n"); 
		query.append("                         FROM   VSK_VSL_PORT_SKD SKD   " ).append("\n"); 
		query.append("                         WHERE  VSL_CD =SUBSTR(@[vvd_cd],1,4)                                                                          " ).append("\n"); 
		query.append("                         AND    TURN_SKD_VOY_NO =SUBSTR(@[vvd_cd],5,4)                                                                      " ).append("\n"); 
		query.append("                         AND    TURN_SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)                                                                     " ).append("\n"); 
		query.append("                         AND    VPS_PORT_CD =@[pol_cd]" ).append("\n"); 
		query.append("                         AND    NVL(SKD_CNG_STS_CD,'X') <> 'S'" ).append("\n"); 
		query.append("						)	                                                                               " ).append("\n"); 
		query.append("#end  	                                                                                                                               " ).append("\n"); 
		query.append("#if (${sp_cntr_ty_cd} != '')                                                                                                           " ).append("\n"); 
		query.append("				AND    CASE WHEN @[sp_cntr_ty_cd]= 'DG' THEN BKG_CNTR.DCGO_FLG                                         " ).append("\n"); 
		query.append("            				WHEN @[sp_cntr_ty_cd]= 'BB' THEN BKG_CNTR.BB_CGO_FLG                                           " ).append("\n"); 
		query.append("           	 				WHEN @[sp_cntr_ty_cd]= 'AK' THEN BKG_CNTR.AWK_CGO_FLG                                  " ).append("\n"); 
		query.append("							WHEN @[sp_cntr_ty_cd]= 'RF' THEN BKG_CNTR.RC_FLG                           " ).append("\n"); 
		query.append("            				WHEN @[sp_cntr_ty_cd]= 'PC' THEN B.PRCT_FLG ELSE 'Y' END = 'Y'                                 " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("#if (${bound_type} == 'I')                                                                                                             " ).append("\n"); 
		query.append("	     		AND BKG_VVD.POD_CD LIKE '%' || @[pol_cd] || '%'                                                                " ).append("\n"); 
		query.append("#else                                                                                                                                  " ).append("\n"); 
		query.append("	     		AND BKG_VVD.POL_CD LIKE '%' || @[pol_cd] || '%'                                                                " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("                AND B.BKG_STS_CD IN ( 'A','F','W','S')) ST                                                                             " ).append("\n"); 
		query.append("       WHERE    CNTR_NO    = CNTR_REF_NO(+)                                                                                            " ).append("\n"); 
		query.append("       AND      CNTR_REF_NO IS  NULL                                                                                                   " ).append("\n"); 
		query.append("#if (${cgo_tp} != '' && ${cgo_tp} != 'ALL')                                                                                            " ).append("\n"); 
		query.append("       AND      NVL(CGO_TP,FULL_MTY_CD) = @[cgo_tp]                                 " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("#else                                                                                                                                  " ).append("\n"); 
		query.append("-----------------------------------------------------------------------------------                                                    " ).append("\n"); 
		query.append("--2.MATCH                                                                                                                              " ).append("\n"); 
		query.append("-------------------------------------------------------------------------------------                                                  " ).append("\n"); 
		query.append("   SELECT /*+ USE_MERGE (BAY_PLAN_LDS, ST)INDEX(BAY_PLAN_LDS XPKBAY_PLAN_LDS ) */   DISTINCT                                                   " ).append("\n"); 
		query.append("           NVL(BAY.CNTR_REF_NO,'') CNTR_NO                                                                                             " ).append("\n"); 
		query.append("   ,       NVL(ST.CNTR_TPSZ_CD,'') CNTRTS_CD                                                                                           " ).append("\n"); 
		query.append("   ,       'Yes' FLG                                                                                                                     " ).append("\n"); 
		query.append("   ,       BKG_NO                                                                                                                      " ).append("\n"); 
		query.append("   ,       NVL(BL_NO,'') BL_NO                                                                                                         " ).append("\n"); 
		query.append("   ,       NVL(ST.POL_CD,'') BK_POL                                                                                                    " ).append("\n"); 
		query.append("   ,       NVL(ST.POD_CD,'') BK_POD                                                                                                    " ).append("\n"); 
		query.append("   ,       NVL(BAY.POL_CD,'') BAY_POL                                                                                                  " ).append("\n"); 
		query.append("   ,       NVL(BAY.POD_CD,'') BAY_POD                                                                                                  " ).append("\n"); 
		query.append("   ,       NVL(BAY.VSL_BAY_NO||BAY.VSL_ROW_NO||BAY.VSL_TR_NO,'') STWG                                                                  " ).append("\n"); 
		query.append("--   ,       DECODE(NVL(CGO_TP,'M'),'M',NVL(LODG_DCHG_IND_CD,''),NVL(CGO_TP,'')) CGO_TP                                                  " ).append("\n"); 
		query.append("   ,       NVL(CGO_TP,FULL_MTY_CD) CGO_TP" ).append("\n"); 
		query.append("   ,       DG                                                                                                                          " ).append("\n"); 
		query.append("   ,       BB                                                                                                                          " ).append("\n"); 
		query.append("   ,       AK                                                                                                                          " ).append("\n"); 
		query.append("   ,       RF " ).append("\n"); 
		query.append("   ,       PC                                                                                                                         " ).append("\n"); 
		query.append("   ,	   '' VVD_CD			--VVD                                                                                          " ).append("\n"); 
		query.append("   ,       '' POL_CD			--POL                                                                                          " ).append("\n"); 
		query.append("   ,	   '' BOUND_TYPE		--공통 code(Inbound인경우는 POD_CD,OutBound인경우는 POL_CD가 입력된 Port Code임)               " ).append("\n"); 
		query.append("   ,       '' STWG_STATUS	--Current,Previous                                                                                     " ).append("\n"); 
		query.append("   ,       '' BKG_OFC_CD     	--B/OFC                                                                                                " ).append("\n"); 
		query.append("   ,       '' BKG_CGO_TY_CD  	--STWG & Doc (UNMATCH,MATCH)                                                                           " ).append("\n"); 
		query.append("   ,	   '' SP_CNTR_TY_CD 	--Special CNTR(DG,AK,BB...)                                                                            " ).append("\n"); 
		query.append("   ,     decode((select  count(*) from bkg_container c,bkg_booking b                                                                   " ).append("\n"); 
		query.append("                where c.bkg_no      = b.bkg_no                                                                                         " ).append("\n"); 
		query.append("                and   c.cntr_no     = st.cntr_no                                                                                       " ).append("\n"); 
		query.append("                and   b.vsl_cd      = st.bt_vsl_cd                                                                                     " ).append("\n"); 
		query.append("                and   b.skd_voy_no  = st.bt_skd_voy_no                                                                                 " ).append("\n"); 
		query.append("                and   b.skd_dir_cd  = st.bt_skd_dir_cd                                                                                 " ).append("\n"); 
		query.append("                and   b.pol_cd      = st.pol_cd                                                                                        " ).append("\n"); 
		query.append("                and   b.pod_cd      = st.pod_cd                                                                                        " ).append("\n"); 
		query.append("                AND   BKG_STS_CD IN ('F','A','W','S')                                                                                  " ).append("\n"); 
		query.append("                ),1,'N','Y') HBL	                                                                                               " ).append("\n"); 
		query.append("    FROM OPF_BAY_PLN_LDIS BAY ,                                                                                                        " ).append("\n"); 
		query.append("         (SELECT /*+ USE_NL(BKG_VVD,B,BKG_CNTR) */                                                                                     " ).append("\n"); 
		query.append("                      B.BKG_NO                                                                                                         " ).append("\n"); 
		query.append("          ,           BKG_VVD.VSL_CD                                                                                                   " ).append("\n"); 
		query.append("		  ,			  BKG_VVD.SKD_VOY_NO                                                                           " ).append("\n"); 
		query.append("          ,			  BKG_VVD.SKD_DIR_CD                                                                                   " ).append("\n"); 
		query.append("          ,           B.POL_CD                                                                                                         " ).append("\n"); 
		query.append("          ,           B.POD_CD                                                                                                         " ).append("\n"); 
		query.append("          ,           BKG_CNTR.CNTR_NO                                                                                                 " ).append("\n"); 
		query.append("          ,           BKG_CNTR.CNTR_TPSZ_CD                                                                                            " ).append("\n"); 
		query.append("          ,           B.BL_NO            --||B.BL_NO_TP||B.BL_NO_CHK|| B.BL_NO_TP BL_NO                                                " ).append("\n"); 
		query.append("          ,           DECODE(B.BKG_CGO_TP_CD,'F','F','M') CGO_TP                                                                                          " ).append("\n"); 
		query.append("          ,     	  DECODE(BKG_CNTR.DCGO_FLG,'Y','DG','') DG                                                                     " ).append("\n"); 
		query.append("          ,     	  DECODE(BKG_CNTR.BB_CGO_FLG,'Y','BB','') BB                                                                   " ).append("\n"); 
		query.append("          ,           DECODE(BKG_CNTR.AWK_CGO_FLG,'Y','AK','') AK                                                                      " ).append("\n"); 
		query.append("          ,           DECODE(BKG_CNTR.RC_FLG,'Y','RF','') RF  " ).append("\n"); 
		query.append("		  ,      	  DECODE(B.PRCT_FLG,'Y','PC','') PC                                                                        " ).append("\n"); 
		query.append("		  ,     	  B.VSL_CD bt_vsl_cd                                                                                   " ).append("\n"); 
		query.append("		  ,     	  B.SKD_VOY_NO bt_skd_voy_no                                                                           " ).append("\n"); 
		query.append("		  ,     	  B.SKD_DIR_CD bt_skd_dir_cd   	                                                                       " ).append("\n"); 
		query.append("          FROM   BKG_CONTAINER BKG_CNTR                                                                                                " ).append("\n"); 
		query.append("          ,      BKG_BOOKING B                                                                                                         " ).append("\n"); 
		query.append("          ,      BKG_VVD                                                                                                               " ).append("\n"); 
		query.append("          WHERE  BKG_VVD.BKG_NO = B.BKG_NO                                                                                             " ).append("\n"); 
		query.append("          AND    B.BKG_NO = BKG_CNTR.BKG_NO                                                                                            " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("#if (${vvd_cd} != '')                                                                                                                  " ).append("\n"); 
		query.append("		  AND (BKG_VVD.VSL_CD, BKG_VVD.SKD_VOY_NO, BKG_VVD.SKD_DIR_CD) IN (                                                    " ).append("\n"); 
		query.append("				                                                                                                       " ).append("\n"); 
		query.append("                 SELECT SKD.VSL_CD,SKD.SKD_VOY_NO,SKD.SKD_DIR_CD                                                                       " ).append("\n"); 
		query.append("                 FROM   VSK_VSL_PORT_SKD SKD                                                                                           " ).append("\n"); 
		query.append("                 WHERE  VSL_CD =SUBSTR(@[vvd_cd],1,4)                                                                                  " ).append("\n"); 
		query.append("                 AND    SKD_VOY_NO =SUBSTR(@[vvd_cd],5,4)                                                                              " ).append("\n"); 
		query.append("                 AND    SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)                                                                             " ).append("\n"); 
		query.append("                 AND    VPS_PORT_CD =@[pol_cd])	                                                                                       " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("#if (${sp_cntr_ty_cd} != '')                                                                                                           " ).append("\n"); 
		query.append("		  AND    CASE WHEN @[sp_cntr_ty_cd]= 'DG' THEN BKG_CNTR.DCGO_FLG                                                       " ).append("\n"); 
		query.append("            		  WHEN @[sp_cntr_ty_cd]= 'BB' THEN BKG_CNTR.BB_CGO_FLG                                                         " ).append("\n"); 
		query.append("           	 		  WHEN @[sp_cntr_ty_cd]= 'AK' THEN BKG_CNTR.AWK_CGO_FLG                                                " ).append("\n"); 
		query.append("					  WHEN @[sp_cntr_ty_cd]= 'RF' THEN BKG_CNTR.RC_FLG                                         " ).append("\n"); 
		query.append("            		  WHEN @[sp_cntr_ty_cd]= 'PC' THEN B.PRCT_FLG ELSE 'Y' END = 'Y'                                               " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("	                                                                                                                               " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("#if (${bound_type} == 'I')                                                                                                             " ).append("\n"); 
		query.append("	     		AND BKG_VVD.POD_CD LIKE '%' || @[pol_cd] || '%'                                                                " ).append("\n"); 
		query.append("#else                                                                                                                                  " ).append("\n"); 
		query.append("	     		AND BKG_VVD.POL_CD LIKE '%' || @[pol_cd] || '%'                                                                " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("#if (${bkg_ofc_cd} != '')                                                                                                              " ).append("\n"); 
		query.append("          AND    B.BKG_OFC_CD  LIKE '%' || @[bkg_ofc_cd] || '%'                                                                        " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("          AND    B.BKG_STS_CD IN ('F','A','W','S')) ST                                                                                 " ).append("\n"); 
		query.append("    WHERE BAY.CNTR_REF_NO   = CNTR_NO                                                                                                  " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("#if (${vvd_cd} != '')                                                                                                                  " ).append("\n"); 
		query.append("    AND   BAY.VSL_CD = ST.VSL_CD                                                                                                       " ).append("\n"); 
		query.append("    AND   BAY.SKD_VOY_NO = ST.SKD_VOY_NO                                                                                               " ).append("\n"); 
		query.append("    AND   BAY.SKD_DIR_CD = ST.SKD_DIR_CD                                                                                               " ).append("\n"); 
		query.append("	AND   ((BAY.VSL_CD, BAY.SKD_VOY_NO, BAY.SKD_DIR_CD) IN (                        " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("			SELECT SKD.VSL_CD,SKD.SKD_VOY_NO,SKD.SKD_DIR_CD                       " ).append("\n"); 
		query.append("			FROM   VSK_VSL_PORT_SKD SKD                                                                                    " ).append("\n"); 
		query.append("            WHERE  VSL_CD =SUBSTR(@[vvd_cd],1,4)                                                                                       " ).append("\n"); 
		query.append("            AND    SKD_VOY_NO =SUBSTR(@[vvd_cd],5,4)                                                                                   " ).append("\n"); 
		query.append("            AND    SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)                                                                                  " ).append("\n"); 
		query.append("            AND    VPS_PORT_CD =@[pol_cd])	  " ).append("\n"); 
		query.append("	OR   (BAY.LODG_VSL_CD,BAY.LODG_VOY_NO,BAY.LODG_DIR_CD) IN (                        " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("			SELECT SKD.VSL_CD,SKD.SKD_VOY_NO,SKD.SKD_DIR_CD" ).append("\n"); 
		query.append("			FROM   VSK_VSL_PORT_SKD SKD                                                                                    " ).append("\n"); 
		query.append("            WHERE  VSL_CD =SUBSTR(@[vvd_cd],1,4)                                                                                       " ).append("\n"); 
		query.append("            AND    SKD_VOY_NO =SUBSTR(@[vvd_cd],5,4)                                                                                   " ).append("\n"); 
		query.append("            AND    SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)                                                                                  " ).append("\n"); 
		query.append("            AND    VPS_PORT_CD =@[pol_cd]" ).append("\n"); 
		query.append("		))                                                                                     " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("#if (${bound_type} == 'I')                                                                                                             " ).append("\n"); 
		query.append("	 AND    BAY.POD_CD LIKE '%' || @[pol_cd] || '%'                                                                                " ).append("\n"); 
		query.append("#else                                                                                                                                  " ).append("\n"); 
		query.append("	 AND    BAY.POL_CD LIKE '%' || @[pol_cd] || '%'                                                                                " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("#if (${cgo_tp} != '' && ${cgo_tp} != 'ALL')                                                                                            " ).append("\n"); 
		query.append("	 AND	NVL(CGO_TP,FULL_MTY_CD) = @[cgo_tp]                                 " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("	                                                                                                          " ).append("\n"); 
		query.append("#if (${stwg_status} != 'C')                                                                                                          " ).append("\n"); 
		query.append("	AND BAY.LODG_DCHG_IND_CD  = DECODE(@[bound_type],'I','D','L')  --IN ('L','D')      " ).append("\n"); 
		query.append("#else                                                                                                                                  " ).append("\n"); 
		query.append("	AND BAY.LODG_DCHG_IND_CD = 'C'                                                                                                 " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("#end                                                                                                                                   " ).append("\n"); 
		query.append("                                                                                                                                       " ).append("\n"); 
		query.append("------------------------------------------------------------------------------                                                         " ).append("\n"); 
		query.append("--****************************************************************************                                                         " ).append("\n"); 
		query.append("------------------------------------------------------------------------------                                                         " ).append("\n"); 
		query.append(")                                                                                                                                      " ).append("\n"); 
		query.append("SELECT 	 DENSE_RANK() OVER ( ORDER BY  CNTR_NO) SEQ                                                                                   " ).append("\n"); 
		query.append(", CNTR_NO                                                                                                                              " ).append("\n"); 
		query.append(",	CNTRTS_CD                                                                                                                      " ).append("\n"); 
		query.append(",	FLG                                                                                                                            " ).append("\n"); 
		query.append(",	BKG_NO                                                                                                                         " ).append("\n"); 
		query.append(",	BL_NO                                                                                                                          " ).append("\n"); 
		query.append(",	BK_POL                                                                                                                         " ).append("\n"); 
		query.append(",	BK_POD                                                                                                                         " ).append("\n"); 
		query.append(",	BAY_POL                                                                                                                        " ).append("\n"); 
		query.append(",	BAY_POD                                                                                                                        " ).append("\n"); 
		query.append(",	STWG                                                                                                                           " ).append("\n"); 
		query.append(",	CGO_TP                                                                                                                         " ).append("\n"); 
		query.append(",	DG                                                                                                                             " ).append("\n"); 
		query.append(",	BB                                                                                                                             " ).append("\n"); 
		query.append(",	AK                                                                                                                             " ).append("\n"); 
		query.append(",	RF                                                                                                                             " ).append("\n"); 
		query.append(",	PC                                                                                                                             " ).append("\n"); 
		query.append(",	VVD_CD                                                                                                                         " ).append("\n"); 
		query.append(",	POL_CD                                                                                                                         " ).append("\n"); 
		query.append(",	BOUND_TYPE                                                                                                                     " ).append("\n"); 
		query.append(",	STWG_STATUS                                                                                                                    " ).append("\n"); 
		query.append(",	BKG_OFC_CD                                                                                                                     " ).append("\n"); 
		query.append(",	BKG_CGO_TY_CD                                                                                                                  " ).append("\n"); 
		query.append(",	SP_CNTR_TY_CD                                                                                                                  " ).append("\n"); 
		query.append(",	HBL                                                                                                                            " ).append("\n"); 
		query.append("FROM   TEMP_T                                                                                                                          " ).append("\n"); 
		query.append("ORDER  BY CNTR_NO,BKG_NO" ).append("\n"); 

	}
}