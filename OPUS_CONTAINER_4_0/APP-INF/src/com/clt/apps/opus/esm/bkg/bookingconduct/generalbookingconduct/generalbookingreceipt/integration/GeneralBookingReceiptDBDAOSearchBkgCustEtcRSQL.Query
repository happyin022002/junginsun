<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingReceiptDBDAOSearchBkgCustEtcRSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
select bk.bkg_no
    , BK.BL_NO||NVL(BK.BL_TP_CD, DECODE(ISS.OBL_SRND_FLG, 'Y', 'S', null)) BL_NO
    , bk.bl_tp_cd 
    , bk.bl_no_tp
    , bk.vsl_cd||bk.skd_voy_no||skd_dir_cd bkg_vvd
    , bk.por_cd 
    , bk.pol_cd 
    , bk.pod_cd 
    , bk.del_cd 
    , bk.sc_no
	, bk.rfa_no
    , bk.svc_scp_cd
    , bk.sam_cnee_ntfy_flg
    , bk.agmt_act_cnt_cd  
    , DECODE(bk.agmt_act_cust_seq,0,'',bk.agmt_act_cust_seq) agmt_act_cust_seq
    , bk.kr_cstms_Cust_tp_cd kr_cstms_cust_tp_cd
    , bk.cust_to_ord_flg cust_to_ord_flg
    , bk.sam_cnee_ntfy_flg
    , bl.org_cnt_nm
    , ff.cust_ref_no_ctnt ff_ref_no
    , fmc.cust_ref_no_ctnt fmc_cd
    , '' frob_flag
	, '' NL_FLAG
    , bk.bkg_sts_cd
    , DECODE(NVL(BL.CORR_NO, 'N'), 'N', 'N', 'Y') CA_FLG

    ,(SELECT TO_CHAR(
             NVL((
                  SELECT RT_APLY_DT
#if (${ca_flg}== 'Y')
                    FROM BKG_RT_HIS R
#else
                    FROM BKG_RATE R
#end
                   WHERE BKG_NO = @[bkg_no]
                     AND RT_APLY_DT IS NOT NULL
#if (${ca_flg}== 'Y')
					 AND   CORR_NO = 'TMP0000001'
#end
                 ),
             NVL((
                  SELECT SKD.VPS_ETD_DT
                    FROM VSK_VSL_PORT_SKD SKD
#if (${ca_flg}== 'Y')
                       , BKG_BKG_HIS BK, BKG_VVD_HIS VVD
#else
                       , BKG_BOOKING BK, BKG_VVD VVD
#end
                   WHERE BK.BKG_NO          = @[bkg_no]   
                     AND BK.BKG_NO          = VVD.BKG_NO
                     AND VVD.VSL_PRE_PST_CD IN ('S', 'T')
                     AND VVD.POL_CD         = BK.POL_CD
                     AND VVD.VSL_CD         = SKD.VSL_CD
                     AND VVD.SKD_VOY_NO     = SKD.SKD_VOY_NO
                     AND VVD.SKD_DIR_CD     = SKD.SKD_DIR_CD
                     AND VVD.POL_CD         = SKD.VPS_PORT_CD
                     AND VVD.POL_CLPT_IND_SEQ = SKD.CLPT_IND_SEQ
#if (${ca_flg}== 'Y')
					 AND BK.CORR_NO = 'TMP0000001'
					 AND BK.CORR_NO = VVD.CORR_NO
#end
					 AND ROWNUM = 1
                 ),SYSDATE
             )),'yyyy-mm-dd')
        FROM DUAL)  AS APPL_DT

#if (${ca_flg}== 'Y')
  from BKG_BKG_HIS bk
      , BKG_BL_DOC_HIS bl
	  , BKG_BL_ISS iss
      , BKG_REF_HIS ff
      , BKG_REF_HIS fmc
#else
  from bkg_booking bk
      , bkg_bl_doc bl
	  , BKG_BL_ISS iss
      , bkg_reference ff
      , bkg_reference fmc
#end
 where bk.bkg_no = bl.bkg_no
   and bk.bkg_no = iss.bkg_no(+)
   and bk.bkg_no = ff.bkg_no(+)
   and 'FFNO'    = ff.bkg_Ref_tp_cd(+)
   and bk.bkg_no = fmc.bkg_no(+)
   and 'FMCN'    = fmc.bkg_Ref_tp_cd(+)
   and bk.bkg_no = @[bkg_no]
#if (${ca_flg}== 'Y')
AND   bk.CORR_NO = 'TMP0000001'
AND   bl.CORR_NO = 'TMP0000001'
#end			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
