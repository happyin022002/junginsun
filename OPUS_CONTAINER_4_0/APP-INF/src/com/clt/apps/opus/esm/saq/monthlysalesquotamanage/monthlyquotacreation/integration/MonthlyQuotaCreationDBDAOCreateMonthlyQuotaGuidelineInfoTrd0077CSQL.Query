<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MonthlyQuotaCreationDBDAOCreateMonthlyQuotaGuidelineInfoTrd0077CSQL">
			<desc><![CDATA[guideline data 생성 2. saq_mon_qta_gline_trd insert]]></desc>
			<sql><![CDATA[
-- 2. SAQ_MON_QTA_GLINE_TRD INSERT                                                 

INSERT INTO SAQ_MON_QTA_GLINE_TRD (                           
  BSE_YR          ,                                           
  BSE_QTR_CD         ,                                           
  SAQ_TGT_GRP_CD  ,                                           
  GLINE_VER_NO    ,                                           
  TRD_CD          ,                                           
  DIR_CD          ,                                           
  BSE_MON         ,                                           
  LOD_QTY         ,                                           
  GRS_REV         ,                                           
  CM_AMT          ,                                           
  OPFIT_AMT       ,                                           
  CRE_USR_ID      ,                                           
  CRE_DT          ,                                           
  UPD_USR_ID      ,                                           
  UPD_DT          )                                           
SELECT                                                        
  D.BSE_YR          ,                                         
  D.BSE_QTR_CD         ,                                         
  C.SAQ_TGT_GRP_CD  ,                                         
  (SELECT MAX(GLINE_VER_NO)                                   
     FROM SAQ_MON_QTA_GLINE_VER                               
     WHERE BSE_YR = D.BSE_YR                                  
     AND BSE_QTR_CD = D.BSE_QTR_CD                                  
     AND SAQ_TGT_GRP_CD = C.SAQ_TGT_GRP_CD                    
     AND CRE_OFC_CD = C.OFC_CD),                              
  A.TRD_CD          ,                                         
  A.DIR_CD          ,                                         
  A.BSE_MON         ,                                         
  SUM(LOD_QTY)      ,                                         
  SUM(GRS_RPB_REV * LOD_QTY) ,                                
  SUM(GRS_RPB_REV * LOD_QTY) - SUM(CM_UC_AMT * LOD_QTY) ,     
  SUM(GRS_RPB_REV * LOD_QTY) - SUM(OPFIT_UC_AMT * LOD_QTY) ,  
  @[userId] ,                                         
  SYSDATE ,                                         
  @[userId] ,                                         
  SYSDATE                                                     
FROM SAQ_MON_MDL_CTRT_SMRY A,                             
     SAQ_TGT_GRP_TRD_V B,                                     
     SAQ_TGT_GRP C,                                           
     SAQ_MON_QTA_MDL_EXE D                                    
WHERE B.TRD_CD = A.TRD_CD                                     
AND   C.SAQ_TGT_GRP_CD = B.SAQ_TGT_GRP_CD                     
AND   D.MQTA_MDL_VER_NO = A.MQTA_MDL_VER_NO                   
AND   A.MQTA_MDL_VER_NO = @[version]                                   
GROUP BY                                                      
  D.BSE_YR          ,                                         
  D.BSE_QTR_CD         ,                                         
  C.SAQ_TGT_GRP_CD  ,                                         
  C.OFC_CD          ,                                         
  A.TRD_CD          ,                                         
  A.DIR_CD          ,                                         
  A.BSE_MON			]]></sql>
			<params>
				<param name="userId" type="12" value="" out="N"/>
				<param name="version" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
