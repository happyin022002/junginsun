<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLIssuanceDBDAOSearchBlCompleteRcvEmlVORSQL">
			<desc><![CDATA[BLIssueanceDBDAOSearchBlCompleteRcvEml]]></desc>
			<sql><![CDATA[
SELECT LISTAGG(USR_EML, ';') WITHIN GROUP (ORDER BY USR_EML) AS USR_EML
FROM (
    SELECT DISTINCT GRP.BL_GRP_SEQ, GRP.BL_VW_RT_TP_CD, UI.USR_EML
    FROM  BKG_BL_ISS BI
          ,BKG_INET_BL_CTRL_PTY CP
          ,BKG_CTRL_PTY_BL_GRP GRP
          ,BKG_CTRL_BL_GRP_CUST BL
          ,BKG_XTER_USR_INFO UI
    WHERE BI.INET_CTRL_PTY_NM = CP.CUST_CNT_CD
    AND   BI.INET_CTRL_PTY_NO = CP.CUST_SEQ
    AND   CP.CTRL_PTY_SEQ = GRP.CTRL_PTY_SEQ
    AND   GRP.BL_GRP_SEQ = BL.BL_GRP_SEQ
    AND   UI.BL_GRP_SEQ = GRP.BL_GRP_SEQ
    AND   BI.BKG_NO = @[bkg_no]
  	AND   UI.USR_STS_CD IN ('CF','CR','RU') 
    AND   UI.RDY_FO_PRF_FLG = 'Y'
    AND   EXISTS (SELECT 'X' FROM BKG_CTRL_BL_GRP_CUST BCBG 
                  WHERE BCBG.BL_GRP_SEQ = BL.BL_GRP_SEQ 
                     AND BCBG.CUST_CNT_CD||BCBG.CUST_SEQ IN (SELECT BC.CUST_CNT_CD||BC.CUST_SEQ FROM BKG_CUSTOMER BC WHERE BC.BKG_NO = @[bkg_no] AND BC.BKG_CUST_TP_CD IN ('S','C','N','F')
															 UNION ALL SELECT BB.BKG_PTY_CUST_CNT_CD||BB.BKG_PTY_CUST_SEQ FROM BKG_BOOKING BB WHERE BB.BKG_NO = @[bkg_no] AND BKG_PTY_CUST_CNT_CD > ' '
											 				 )
                  )
)			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
