<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UserSetupMgtDBDAOSearchUserPrintSetup3RSQL">
			<desc><![CDATA[UserSetupMgtDBDAOSearchUserPrintSetup3RSQL]]></desc>
			<sql><![CDATA[
SELECT X.BKG_NO,
       X.BL_NO,
       BL_TP_CD ,
       (SELECT CONTI_CD FROM MDM_LOCATION
        WHERE LOC_CD = BKG_COM_USER_LOC_FNC(@[usr_id]) ) AS CONTI_CD,
       NVL(BB_CGO_FLG,'N') AS BB_CGO_FLG,/* BL_TP_CD >> NULL - Original Bill/ W - Waybill*/
       NVL(OBL_ISS_FLG,'N') AS OBL_ISS_FLG,
       NVL(OBL_PRN_FLG,'N') AS OBL_PRN_FLG,
       NVL(OBL_RLSE_FLG,'N') AS OBL_RLSE_FLG,
       NVL(BL_CPY_KNT,0) AS BL_CPY_KNT,
	   BKG_RIDER_YN_FNC(X.BKG_NO, NULL, '1', '1', NULL) AS OBL_RIDER_FLG,
       (SELECT     DECODE(COUNT(B.BKG_NO), 0, 'Y', DECODE(NVL(C.ORG_PPD_RCV_CD, 'Y'), 'N', 'N', 'Y'))  
         FROM       BKG_BOOKING A,    
                    BKG_CHG_RT B,
                    BKG_BL_ISS C   
         WHERE      A.BKG_NO = X.BKG_NO
         AND        A.BKG_NO = B.BKG_NO(+)
         AND        A.BKG_NO = C.BKG_NO   
         AND        B.FRT_TERM_CD (+) = 'P'   
         AND        B.N3PTY_RCV_OFC_CD(+) IS NULL   
         GROUP BY   A.BKG_NO, C.ORG_PPD_RCV_CD
        ) AS ORG_PPD_RCV_CD ,
        (  SELECT     DECODE(COUNT(B.BKG_NO), 0, 'Y', DECODE(NVL(C.ORG_N3PTY_PPD_CD, 'Y'), 'N', 'N', 'Y'))    
             FROM       BKG_BOOKING A,    
                        BKG_CHG_RT B,
                        BKG_BL_ISS C   
             WHERE      A.BKG_NO = X.BKG_NO
             AND        A.BKG_NO = B.BKG_NO(+)
             AND        A.BKG_NO = C.BKG_NO   
             AND        B.FRT_TERM_CD (+) = 'P'   
             AND        B.N3PTY_RCV_OFC_CD(+) IS NOT NULL   
             GROUP BY   A.BKG_NO , C.ORG_N3PTY_PPD_CD
        ) AS ORG_N3PTY_PPD_CD ,
       NVL(WBL_PRN_FLG,'N') AS WBL_PRN_FLG,
       (
           SELECT A.BL_KNT_FLG
           FROM BKG_BL_ESIG_OFC_ASGN A
                ,BKG_BL_ESIG B
           WHERE 1=1
           AND A.BL_ESIG_SEQ = B.BL_ESIG_SEQ
           AND A.BL_ISS_OFC_CD = DECODE( Y.OBL_ISS_OFC_CD, NULL, X.BKG_OFC_CD, Y.OBL_ISS_OFC_CD )
           AND ROWNUM = 1        
       ) AS BL_KNT_FLG

FROM   BKG_BOOKING X, BKG_BL_ISS Y,
     ( SELECT TRIM(COLUMN_VALUE) AS BKG_NO ,rownum as seq
        FROM table(BKG_SPLIT_CLOB_FNC(${bkg_no}))
       ) Z
WHERE  X.BKG_NO = Y.BKG_NO(+)
AND   Z.BKG_NO = X.BKG_NO
ORDER BY Z.SEQ			]]></sql>
			<params>
				<param name="usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
