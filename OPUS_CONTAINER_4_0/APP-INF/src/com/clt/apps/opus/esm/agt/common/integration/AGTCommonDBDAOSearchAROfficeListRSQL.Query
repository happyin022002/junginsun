<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AGTCommonDBDAOSearchAROfficeListRSQL">
			<desc><![CDATA[searchVendorCode]]></desc>
			<sql><![CDATA[
    SELECT
           LST.AR_OFC AS CODE, 
           LST.AR_OFC AS NAME 
      FROM
         (
             SELECT
                    '1', 
                    A.OFC_CD USRIDOFC, 
                    A.AR_OFC AR_OFC, 
                    C.OFC_CD SUB_OFC 
               FROM
                  (
                        SELECT
                               A.OFC_CD OFC_CD, 
                               B.AR_OFC_CD AR_OFC 
                          FROM MDM_ORGANIZATION A, 
                               MDM_ORGANIZATION B 
                         WHERE A.OFC_CD = @[code]     --ofc_cd
                           AND A.OFC_CD = DECODE (A.OFC_KND_CD, '2', NVL(B.AR_HD_QTR_OFC_CD, B.PRNT_OFC_CD), '3', B.AR_OFC_CD, B.OFC_CD )
                  ) A, 
                    MDM_ORGANIZATION C 
              WHERE A.AR_OFC = NVL(C.AR_OFC_CD, C.OFC_CD) 
                AND C.VNDR_CNT_CD IS NOT NULL 
          UNION ALL 
             SELECT
                    '2', 
                    B.AR_HD_QTR_OFC_CD, 
                    A.FINC_OFC_CD,  
                    SUBSTR (A.OFC_CD, 1, 3) || A.CHN_AGN_CD 
               FROM BKG_CHN_AGN A, 
                    MDM_ORGANIZATION B 
              WHERE A.FINC_OFC_CD = B.OFC_CD 
                AND B.OFC_CD
                 IN 
                  (
                        SELECT
                               B.AR_OFC_CD 
                          FROM MDM_ORGANIZATION A, 
                               MDM_ORGANIZATION B 
                         WHERE A.OFC_CD = @[code]     --ofc_cd    
                           AND A.OFC_CD = DECODE(A.OFC_KND_CD, '2', NVL(B.AR_HD_QTR_OFC_CD, B.PRNT_OFC_CD), '3', B.AR_OFC_CD, B.OFC_CD) 
                  ) 
                AND A.VNDR_CNT_CD IS NOT NULL 
          UNION ALL 
             SELECT
                    '3', 
                    B.AR_HD_QTR_OFC_CD, 
                    A.FINC_OFC_CD, 
                    A.OFC_CD 
               FROM BKG_CHN_AGN A, 
                    MDM_ORGANIZATION B 
              WHERE A.FINC_OFC_CD = B.OFC_CD 
                AND B.OFC_CD
                 IN 
                  (
                        SELECT
                               B.AR_OFC_CD 
                          FROM MDM_ORGANIZATION A, 
                               MDM_ORGANIZATION B
                         WHERE A.OFC_CD = @[code]     --ofc_cd    
                           AND A.OFC_CD = DECODE(A.OFC_KND_CD, '2', NVL(B.AR_HD_QTR_OFC_CD, B.PRNT_OFC_CD), '3', B.AR_OFC_CD, B.OFC_CD)
                  ) 
                AND A.VNDR_CNT_CD IS NOT NULL  
         ) LST,  
           AGT_FINC_OFC_INFO Y  
     WHERE LST.AR_OFC = Y.AR_OFC_CD  
       AND LST.SUB_OFC = Y.AGN_CD
       AND NVL(Y.DELT_FLG,'N') = 'N'  
       AND Y.OFC_GRP_LVL
        IN
         (
               SELECT
                      B.OFC_GRP_LVL  
                 FROM
                    (
                          SELECT
                                 A.OFC_CD OFC_CD,
                                 B.AR_OFC_CD AR_OFC  
                            FROM MDM_ORGANIZATION A,
                                 MDM_ORGANIZATION B  
                           WHERE A.OFC_CD = @[code]     --ofc_cd    
                             AND A.OFC_CD = DECODE (A.OFC_KND_CD, '2', NVL(B.AR_HD_QTR_OFC_CD, B.PRNT_OFC_CD), '3', B.AR_OFC_CD, B.OFC_CD)
                    ) A,  
                      AGT_FINC_OFC_INFO B  
                WHERE A.AR_OFC = B.AGN_CD  
            UNION ALL
               SELECT
                      B.OFC_GRP_LVL
                FROM
                   (
                         SELECT
                                A.OFC_CD OFC_CD,
                                B.AR_OFC_CD AR_OFC  
                           FROM MDM_ORGANIZATION A,
                                MDM_ORGANIZATION B  
                          WHERE A.OFC_CD = @[code]     --ofc_cd    
                            AND A.OFC_CD = DECODE(A.OFC_KND_CD, '2', NVL(B.AR_HD_QTR_OFC_CD, B.PRNT_OFC_CD), '3', B.AR_OFC_CD, B.OFC_CD)
                   ) A,  
                     AGT_FINC_OFC_INFO B  
               WHERE A.AR_OFC = B.AR_OFC_CD  
                  )
   GROUP BY LST.AR_OFC, 
            LST.AR_OFC
   ORDER BY 1
			]]></sql>
			<params>
				<param name="code" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
