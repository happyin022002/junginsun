<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AustraliaManifestListDownloadDBDAOsearchAusSeacrBlRSQL">
			<desc><![CDATA[]]></desc>
			<sql><![CDATA[
SELECT BB.BL_NO,
       BB.BKG_NO,
       BV.POL_CD AS VVD_POL,
       BV.POD_CD AS VVD_POD,
       BB.POD_CD AS BKG_POD,
       BB.DEL_CD AS BKG_DEL,
       (SELECT /*+ INDEX_DESC(SND XAK1BKG_CSTMS_AUS_SND_LOG) */
          TO_CHAR(SND.SND_DT, 'YYYY-MM-DD HH24:MI:SS')
          FROM BKG_CSTMS_AUS_SND_LOG SND
         WHERE SND.BL_NO = BB.BL_NO
           AND SND.AUS_SND_LOG_ID = @[search_div]
           AND ROWNUM = 1) AS SND_DT,
       (SELECT /*+ INDEX_DESC(SND XAK1BKG_CSTMS_AUS_SND_LOG) */
               CASE
                  WHEN LOG_FLG = 'N' THEN 'SENDING'
                  WHEN CSTMS_RQST_FLG = 'Y' THEN 'ERROR'
                  ELSE 'SUCCESS'
               END
          FROM BKG_CSTMS_AUS_SND_LOG SND
         WHERE SND.BL_NO = BB.BL_NO
           AND SND.AUS_SND_LOG_ID = @[search_div]
           AND ROWNUM = 1) AS RCV_RSLT,
       (SELECT /*+ INDEX_DESC(SND XAK1BKG_CSTMS_AUS_SND_LOG) */
               SND.EDI_REF_ID
          FROM BKG_CSTMS_AUS_SND_LOG SND
         WHERE SND.BL_NO = BB.BL_NO
           AND SND.AUS_SND_LOG_ID = @[search_div]
           AND ROWNUM = 1) AS EDI_REF_ID

  FROM BKG_VVD BV,
       BKG_BOOKING BB

 WHERE BV.VSL_CD = SUBSTR(@[vvd], 1, 4)
   AND BV.SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
   AND BV.SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
   AND BV.BKG_NO = BB.BKG_NO
   AND BB.BKG_STS_CD NOT IN ('S', 'X')
   AND BB.BKG_CGO_TP_CD = 'F'
#if (${bl_no} != '')
   AND BB.BL_NO = @[bl_no]
#end
#if (${in_transit} == 'Y')
   AND ((BV.POD_CD = @[pod_cd] AND
         BV.POD_CD <> BB.POD_CD AND
         SUBSTR(BB.POD_CD, 1, 2) <> 'AU') OR
        (BV.POD_CD IN (SELECT VPS_PORT_CD
                         FROM VSK_VSL_PORT_SKD
                        WHERE VSL_CD = SUBSTR(@[vvd], 1, 4)
                          AND SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
                          AND SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
                          AND CLPT_SEQ > (SELECT CLPT_SEQ
                                            FROM VSK_VSL_PORT_SKD
                                           WHERE VSL_CD = SUBSTR(@[vvd], 1, 4)
                                             AND SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
                                             AND SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
                                             AND VPS_PORT_CD = @[pod_cd]
                                             AND CLPT_IND_SEQ = '1'))
         AND BV.POL_cd <> @[pod_cd]
         AND SUBSTR(BB.POD_CD, 1, 2) <> 'AU')
       )
#else
   AND BV.POD_CD = @[pod_cd]
#end
#if (${del_cd} != '')
   AND BB.DEL_CD = @[del_cd]
#end			]]></sql>
			<params>
				<param name="search_div" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
