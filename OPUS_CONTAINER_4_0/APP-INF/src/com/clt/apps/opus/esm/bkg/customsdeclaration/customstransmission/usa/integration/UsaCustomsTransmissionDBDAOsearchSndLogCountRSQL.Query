<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UsaCustomsTransmissionDBDAOsearchSndLogCountRSQL">
			<desc><![CDATA[조회]]></desc>
			<sql><![CDATA[
SELECT COUNT(*)
  FROM BKG_CSTMS_ADV_SND_LOG A
 WHERE VSL_CD      = SUBSTR(@[vvd],1,4)
   AND SKD_VOY_NO  = SUBSTR(@[vvd],5,4)
   AND SKD_DIR_CD  = SUBSTR(@[vvd],9,1)
   AND POD_CD      = @[pod]
   AND POL_CD      = NVL(@[pol], POL_CD)
   AND TRSM_MSG_TP_ID = @[trsm_tp]
   AND IO_BND_CD      = 'I'
   AND DELT_FLG       = 'N'
   AND CNT_CD         = 'US'
   AND NVL(CGO_TP_CD, 'X') = DECODE(NVL(CGO_TP_CD,'X'), 'X', 'X', NVL(@[cgo_tp_cd], CGO_TP_CD))
#if (${trsm_tp} == 'MI') 
   --RCV_LOG에 데이타가 없거나, ACCECPT 받은 BL이 한건이라도 있는 경우
   AND (SELECT (SELECT COUNT(B.BL_NO)
                  FROM BKG_CSTMS_ADV_EDI_BL_RSPN B
                 WHERE B.CNT_CD     = A.CNT_CD
                   AND B.CRR_BAT_NO = A.CRR_BAT_NO
               )
               -
               (SELECT COUNT(DISTINCT D.BL_NO)
                  FROM BKG_CSTMS_ADV_RCV_LOG     B
                      ,BKG_CSTMS_ADV_RCV_LOG_DTL C
                      ,BKG_CSTMS_ADV_EDI_BL_RSPN D
                 WHERE B.CNT_CD     = A.CNT_CD
                   AND B.CRR_BAT_NO = A.CRR_BAT_NO
                   AND B.CNT_CD     = C.CNT_CD
                   AND B.IO_BND_CD  = C.IO_BND_CD
                   AND B.RCV_DT     = C.RCV_DT
                   AND B.RCV_SEQ    = C.RCV_SEQ
                   AND D.CNT_CD     = A.CNT_CD
                   AND D.CRR_BAT_NO = A.CRR_BAT_NO
                   AND C.MSG_DESC LIKE 'W01' || D.BL_NO || '%'
               )
          FROM DUAL
        ) > 0
#end			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="pod" type="12" value="" out="N"/>
				<param name="pol" type="12" value="" out="N"/>
				<param name="trsm_tp" type="12" value="" out="N"/>
				<param name="cgo_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
