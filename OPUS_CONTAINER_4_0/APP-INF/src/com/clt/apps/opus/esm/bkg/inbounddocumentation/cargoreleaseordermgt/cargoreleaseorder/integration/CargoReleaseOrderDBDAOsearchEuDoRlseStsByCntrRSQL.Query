<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CargoReleaseOrderDBDAOsearchEuDoRlseStsByCntrRSQL">
			<desc><![CDATA[Container별 D/O의 STATUS(ASSIGN, RELEASE, ISSUE)별 상세 정보를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT SUBQ.BKG_NO                               AS BKG_NO
     , SUBQ.RLSE_SEQ                             AS RLSE_SEQ
     , SUBQ.CNTR_HLD_FLG                         AS CNTR_HLD_FLG
     , DECODE(SUBQ.CNTR_HLD_FLG,'Y','HOLD','')   AS CNTR_HLD_NM
     , SUBQ.RLSE_STS_SEQ                         AS RLSE_STS_SEQ
     , SUBQ.CNTR_NO                              AS CNTR_NO
     , DOTL.RLSE_STS_CD                          AS RLSE_STS_CD
     ,(SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD02152' AND INTG_CD_VAL_CTNT = DOTL.RLSE_STS_CD) AS RLSE_STS_NM
     , DECODE(BKDO.DO_NO_SPLIT, '00', BKDO.DO_NO, BKDO.DO_NO || BKDO.DO_NO_SPLIT) AS DO_NO
      ,DCNTR.TRKR_MVMT_REF_NO                    AS MVMT_REF_NO
      ,DCNTR.TRKR_MTY_RTN_YD_CD                  AS RTN_YD_CD  
     , TO_CHAR(DOTL.EVNT_DT,'YYYY-MM-DD HH24:MI', 'NLS_DATE_LANGUAGE=ENGLISH') EVNT_DT
     , DOTL.EVNT_USR_ID                          AS EVNT_USR_ID
     , TO_CHAR(SUBQ.CNTR_HLD_DT,'YYYY-MM-DD HH24:MI', 'NLS_DATE_LANGUAGE=ENGLISH') AS CNTR_HLD_DT
     , SUBQ.CNTR_HLD_USR_ID                      AS CNTR_HLD_USR_ID

FROM (
        SELECT BCNT.BKG_NO       AS BKG_NO
             , BCNT.CNTR_NO      AS CNTR_NO
             , DCNT.RLSE_SEQ     AS RLSE_SEQ
             , ROW_NUMBER() OVER (PARTITION BY BCNT.BKG_NO,BCNT.CNTR_NO ORDER BY DCNT.RLSE_SEQ DESC) RLSE_RNUM
             , (SELECT /*+ INDEX_DESC (DOTL XPKBKG_DO_DTL) */ 
                       IDTL.RLSE_STS_SEQ 
                  FROM BKG_DO_DTL IDTL 
                 WHERE IDTL.BKG_NO = DCNT.BKG_NO 
                   AND IDTL.RLSE_SEQ = DCNT.RLSE_SEQ 
                   AND ROWNUM = 1 ) RLSE_STS_SEQ
              , DECODE(HCNTR.CNTR_NO,'','N','Y') AS CNTR_HLD_FLG
              , HCNTR.CRE_DT                     AS CNTR_HLD_DT
              , HCNTR.CRE_USR_ID                 AS CNTR_HLD_USR_ID
          FROM BKG_CONTAINER BCNT
             , BKG_DO_CNTR   DCNT
             , BKG_IB_CGO_RLSE_HLD_CNTR HCNTR
         WHERE BCNT.BKG_NO   = @[bkg_no]
           AND BCNT.BKG_NO   = DCNT.BKG_NO(+)
           AND BCNT.CNTR_NO  = DCNT.CNTR_NO(+)
           AND BCNT.BKG_NO   = HCNTR.BKG_NO(+)
           AND BCNT.CNTR_NO   = HCNTR.CNTR_NO(+)
       ) SUBQ
     , BKG_DO BKDO
     , BKG_DO_DTL DOTL
     , BKG_DO_CNTR DCNTR

 WHERE SUBQ.RLSE_RNUM = 1
   AND BKDO.BKG_NO(+)       = SUBQ.BKG_NO
   AND BKDO.RLSE_SEQ(+)     = SUBQ.RLSE_SEQ   
   AND DCNTR.BKG_NO(+)      = SUBQ.BKG_NO
   AND DCNTR.RLSE_SEQ(+)    = SUBQ.RLSE_SEQ
   AND DCNTR.CNTR_NO(+)     = SUBQ.CNTR_NO 
   AND DOTL.BKG_NO(+)       = SUBQ.BKG_NO 
   AND DOTL.RLSE_SEQ(+)     = SUBQ.RLSE_SEQ 
   AND DOTL.RLSE_STS_SEQ(+) = SUBQ.RLSE_STS_SEQ

 ORDER BY CNTR_HLD_FLG DESC, RLSE_STS_CD 			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
