<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CargoReleaseOrderDBDAOcheckScndOtsLstUptValidRSQL">
			<desc><![CDATA[.]]></desc>
			<sql><![CDATA[
SELECT MAX(US_BAT_CHK) AS US_BAT_CHK
  FROM (
        SELECT DECODE(COUNT(*),0,'N','Y') US_BAT_CHK
          FROM (
                SELECT C.BL_NO
                  FROM BKG_VVD          A,
                       VSK_VSL_PORT_SKD B,
                       BKG_BOOKING      C,
                       BKG_OUTSTANDING  D
                 WHERE C.BL_NO      = @[clt_bl_no]
                   AND A.BKG_NO     = C.BKG_NO
                   AND A.VSL_CD     = B.VSL_CD
                   AND A.SKD_VOY_NO = B.SKD_VOY_NO
                   AND A.SKD_DIR_CD = B.SKD_DIR_CD
                   AND B.VPS_PORT_CD LIKE 'US%'
                   AND SUBSTR(C.POL_CD,1,2) <> 'US'
                   AND C.BL_NO = D.CLT_BL_NO
                   AND D.OFC_CD =@[ofc_cd]
                   AND D.INV_NO = @[inv_no]
                   AND CNG_IND_FLG ='Y' --SAR에서 미수금 관련건이 신규 OR 갱신되면 CNG_IND_FLG를 Y로 박아줌 Y 인 대상만 배치 돌게함
                UNION
                SELECT BL_NO
                  FROM BKG_BOOKING A,
                       BKG_OUTSTANDING B
                 WHERE BL_NO = @[clt_bl_no]
                   AND (
                         POD_CD LIKE 'US%' OR 
                         (POD_CD LIKE 'CA%') OR
                        (POD_CD LIKE 'CA%' AND DEL_CD LIKE 'US%') OR
                         DEL_CD LIKE 'MX%'
                       )
                   AND A.BL_NO = B.CLT_BL_NO
                   AND B.OFC_CD =@[ofc_cd]
                   AND B.INV_NO = @[inv_no]
                   AND CNG_IND_FLG ='Y' --SAR에서 미수금 관련건이 신규 OR 갱신되면 CNG_IND_FLG를 Y로 박아줌 Y 인 대상만 배치 돌게함
               )
       ) US_CHK			]]></sql>
			<params>
				<param name="clt_bl_no" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="inv_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
