<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CODCorrectionDBDAOsearchCodNewRouteRSQL">
			<desc><![CDATA[bkg_cod_vvd을 조회한다.]]></desc>
			<sql><![CDATA[
#if(${pctl_no}=='')
select vsl_pre_pst_cd
        , vsl_seq
        , vsl_cd
        , skd_voy_no
        , skd_dir_cd
        , slan_cd
        , pol_yd_cd 
        , pod_yd_cd 
        ,pol_clpt_ind_seq
        ,pod_clpt_ind_seq
  from bkg_cod_vvd
 where bkg_no       = @[bkg_no]
   and cod_rqst_seq = @[cod_rqst_seq]
   and vvd_op_cd    = 'N'
 ORDER BY vsl_pre_pst_cd, vsl_seq
#else
select 'S' vsl_pre_pst_cd
        , rownum vsl_seq
        , VSL_CD                    vsl_cd
        , SKD_VOY_NO                skd_voy_no
        , SKD_DIR_CD                skd_dir_cd
        , VSL_SLAN_CD               slan_cd
        , org_nod_cd                pol_yd_cd
        , DEST_NOD_CD               pod_yd_cd
        , ORG_CLPT_IND_SEQ          pol_clpt_ind_seq
        , DEST_CLPT_IND_SEQ         pod_clpt_ind_seq
  from prd_prod_ctl_rout_dtl dtl
 where TRSP_MOD_CD in ('VD', 'WD')
   AND SUBSTR(ORG_NOD_CD, 1, 5) <> SUBSTR(DEST_NOD_CD, 1, 5)
   and pctl_no = @[pctl_no]
   and pctl_seq < ( select dtl.pctl_seq
				      from prd_prod_ctl_rout_dtl dtl
						, prd_prod_ctl_mst mst
				     where mst.pctl_no = @[pctl_no]
				       and mst.pctl_no = dtl.pctl_no
				       and dtl.vsl_cd     = mst.trnk_vsl_cd
				       and dtl.skd_voy_no = mst.trnk_skd_voy_no
				       and dtl.skd_dir_cd = mst.trnk_skd_dir_cd)      
 union ALL
select 'T' vsl_pre_pst_cd
        , 0 vsl_seq
        , VSL_CD                    vsl_cd
        , SKD_VOY_NO                skd_voy_no
        , SKD_DIR_CD                skd_dir_cd
        , VSL_SLAN_CD               slan_cd
        , org_nod_cd                pol_yd_cd
        , DEST_NOD_CD               pod_yd_cd
        , ORG_CLPT_IND_SEQ          pol_clpt_ind_seq
        , DEST_CLPT_IND_SEQ         pod_clpt_ind_seq
  from prd_prod_ctl_rout_dtl dtl
 where TRSP_MOD_CD in ('VD', 'WD')
   AND SUBSTR(ORG_NOD_CD, 1, 5) <> SUBSTR(DEST_NOD_CD, 1, 5)
   and pctl_no  = @[pctl_no]
   and pctl_seq = ( select dtl.pctl_seq
				      from prd_prod_ctl_rout_dtl dtl
						, prd_prod_ctl_mst mst
				     where mst.pctl_no = @[pctl_no]
				       and mst.pctl_no = dtl.pctl_no
				       and dtl.vsl_cd     = mst.trnk_vsl_cd
				       and dtl.skd_voy_no = mst.trnk_skd_voy_no
				       and dtl.skd_dir_cd = mst.trnk_skd_dir_cd)   
 union ALL
select 'U' vsl_pre_pst_cd
        , rownum vsl_seq
        , VSL_CD                    vsl_cd
        , SKD_VOY_NO                skd_voy_no
        , SKD_DIR_CD                skd_dir_cd
        , VSL_SLAN_CD               slan_cd
        , org_nod_cd                pol_yd_cd
        , DEST_NOD_CD               pod_yd_cd
        , ORG_CLPT_IND_SEQ          pol_clpt_ind_seq
        , DEST_CLPT_IND_SEQ         pod_clpt_ind_seq
  from prd_prod_ctl_rout_dtl dtl
 where TRSP_MOD_CD in ('VD', 'WD') 
   AND SUBSTR(ORG_NOD_CD, 1, 5) <> SUBSTR(DEST_NOD_CD, 1, 5)
   and pctl_no = @[pctl_no]
   and pctl_seq > ( select dtl.pctl_seq
				      from prd_prod_ctl_rout_dtl dtl
						, prd_prod_ctl_mst mst
				     where mst.pctl_no = @[pctl_no]
				       and mst.pctl_no = dtl.pctl_no
				       and dtl.vsl_cd     = mst.trnk_vsl_cd
				       and dtl.skd_voy_no = mst.trnk_skd_voy_no
				       and dtl.skd_dir_cd = mst.trnk_skd_dir_cd) 
 ORDER BY vsl_pre_pst_cd, vsl_seq
#end			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="cod_rqst_seq" type="12" value="" out="N"/>
				<param name="pctl_no" type="12" value="N2010000000000372468" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
