<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AGTAuditDBDAOModifyAGTCommExRateForRequestUSQL">
			<desc><![CDATA[ModifyAGTCommExRateForRequest]]></desc>
			<sql><![CDATA[
UPDATE AGT_AGN_COMM U
       SET
         ( U.DLY_XCH_RT,
           U.VVD_XCH_RT,
           U.ACT_LOCL_COMM_AMT,
           U.ACT_IF_LOCL_COMM_AMT,
           U.UPD_USR_ID,
           U.UPD_DT
         )
         =
         (     SELECT
                 CASE A.XCH_RT_APLY_LVL
                 WHEN '3'
                 THEN TO_NUMBER(@[dly_xch_rt])
                 ELSE A.DLY_XCH_RT
                  END                                           AS DLY_XCH_RT,
                 CASE A.XCH_RT_APLY_LVL
                 WHEN '1'
                 THEN TO_NUMBER(@[vvd_xch_rt])
                 ELSE A.VVD_XCH_RT
                  END                                           AS VVD_XCH_RT,
                 CASE A.XCH_RT_APLY_LVL
                 WHEN '3'
                 THEN
                 CASE A.CURR_CD
                 WHEN 'JPY'
                 THEN ROUND (A.ACT_COMM_AMT * TO_NUMBER(@[dly_xch_rt]), 0)
                 WHEN 'TWD'
                 THEN ROUND (A.ACT_COMM_AMT * TO_NUMBER(@[dly_xch_rt]), 0)
                 ELSE ROUND (A.ACT_COMM_AMT * TO_NUMBER(@[dly_xch_rt]), 2)
                  END
                 WHEN '1'
                 THEN
                 CASE A.CURR_CD
                 WHEN 'JPY'
                 THEN ROUND (A.ACT_COMM_AMT * TO_NUMBER(@[vvd_xch_rt]), 0)
                 WHEN 'TWD'
                 THEN ROUND (A.ACT_COMM_AMT * TO_NUMBER(@[vvd_xch_rt]), 0)
                 ELSE ROUND (A.ACT_COMM_AMT * TO_NUMBER(@[vvd_xch_rt]), 2)
                  END
                 ELSE A.ACT_LOCL_COMM_AMT
                  END                                           AS ACT_LOCL_COMM_AMT,
                 CASE A.XCH_RT_APLY_LVL
                 WHEN '3'
                 THEN
                 CASE A.CURR_CD
                 WHEN 'JPY'
                 THEN ROUND (A.ACT_IF_COMM_AMT * TO_NUMBER(@[dly_xch_rt]), 0)
                 WHEN 'TWD'
                 THEN ROUND (A.ACT_IF_COMM_AMT * TO_NUMBER(@[dly_xch_rt]), 0)
                 ELSE ROUND (A.ACT_IF_COMM_AMT * TO_NUMBER(@[dly_xch_rt]), 2)
                  END
                 WHEN '1'
                 THEN
                 CASE A.CURR_CD
                 WHEN 'JPY'
                 THEN ROUND (A.ACT_IF_COMM_AMT * TO_NUMBER(@[vvd_xch_rt]), 0)
                 WHEN 'TWD'
                 THEN ROUND (A.ACT_IF_COMM_AMT * TO_NUMBER(@[vvd_xch_rt]), 0)
                 ELSE ROUND (A.ACT_IF_COMM_AMT * TO_NUMBER(@[vvd_xch_rt]), 2)
                  END
                 ELSE A.ACT_IF_LOCL_COMM_AMT
                  END                                           AS ACT_IF_LOCL_COMM_AMT,
                      @[upd_usr_id]                             AS UPD_USR_ID,
                      SYSDATE                                   AS UPD_DT
                 FROM AGT_AGN_COMM A
                WHERE A.BKG_NO       = U.BKG_NO
                  AND A.AGN_CD       = U.AGN_CD
                  AND A.IO_BND_CD    = U.IO_BND_CD
                  AND A.AC_TP_CD    <> 'T'
                  AND A.AC_SEQ       = U.AC_SEQ
                  AND A.AC_TP_CD     = U.AC_TP_CD
          )
      WHERE U.BKG_NO       = @[bkg_no]
        AND U.AGN_CD       = @[agn_cd]
        AND U.IO_BND_CD    = @[io_bnd_cd]
        AND U.AC_TP_CD    <> 'T'
        AND U.AC_SEQ       = @[ac_seq]			]]></sql>
			<params>
				<param name="dly_xch_rt" type="12" value="" out="Y"/>
				<param name="vvd_xch_rt" type="12" value="" out="Y"/>
				<param name="upd_usr_id" type="12" value="" out="Y"/>
				<param name="bkg_no" type="12" value="" out="Y"/>
				<param name="agn_cd" type="12" value="" out="Y"/>
				<param name="io_bnd_cd" type="12" value="" out="Y"/>
				<param name="ac_seq" type="12" value="" out="Y"/>
			</params>
		</query>
	</querys>
</sqls>
