<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLDocumentationCMDBDAOMaxCycleBkgByDiffEccRSQL">
			<desc><![CDATA[select]]></desc>
			<sql><![CDATA[
SELECT B4.MAX_BCNTR_CYCLE CNMV_CYC_NO
,	   B4.OLD_BKG_NO BKG_NO
,	   B4.OLD_BKG_CGO_TP BKG_CGO_TP_CD
,	   B4.OLD_TRUNK_VVD VVD
FROM   MST_CONTAINER B1, (SELECT CNTR_NO, X_CNMS_CD
						  FROM	 (SELECT /*+INDEX_DESC(CTM_MOVEMENT XUK1CTM_MOVEMENT) */
										MVMT_STS_CD X_CNMS_CD
,										 ROWNUM X_ROWNUM
,										 CNTR_NO
								  FROM	 CTM_MOVEMENT
								  WHERE  CNTR_NO = @[cntr_no]
									 AND ROWNUM <= 2)
						  WHERE  X_ROWNUM = 2) B2, (SELECT /*+INDEX_DESC(CTM_MOVEMENT XUK1CTM_MOVEMENT) */
														  CNTR_NO
,														   CNMV_YR
,														   CNMV_ID_NO
													FROM   CTM_MOVEMENT
													WHERE  CNTR_NO = @[cntr_no]
													   AND ROWNUM = 1) B3
,	   (SELECT *
		FROM   (SELECT A.CNTR_NO
,					   A.CNMV_CYC_NO AS MAX_BCNTR_CYCLE
,					   B.BKG_NO AS OLD_BKG_NO
,					   B.BKG_CGO_TP_CD AS OLD_BKG_CGO_TP
,					   B.VSL_CD || B.SKD_VOY_NO || B.SKD_DIR_CD AS OLD_TRUNK_VVD
				FROM   BKG_CONTAINER A, BKG_BOOKING B
				WHERE  A.CNTR_NO = @[cntr_no]
				   AND B.BKG_NO = A.BKG_NO
				   AND (B.BKG_NO || B.VSL_CD || B.SKD_VOY_NO || B.SKD_DIR_CD <> 'PSEUDO00001PSDO9999W')
				   AND NVL (B.BKG_STS_CD, ' ') NOT IN ('S', 'X')
				ORDER BY A.CNTR_NO DESC, A.CNMV_CYC_NO DESC, B.BKG_NO DESC)
		WHERE  ROWNUM = 1) B4
WHERE  B1.CNTR_NO = B2.CNTR_NO
   AND B1.CNTR_NO = B3.CNTR_NO
   AND B1.CNTR_NO = B4.CNTR_NO
   AND B1.CNTR_NO = @[cntr_no]			]]></sql>
			<params>
				<param name="cntr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
