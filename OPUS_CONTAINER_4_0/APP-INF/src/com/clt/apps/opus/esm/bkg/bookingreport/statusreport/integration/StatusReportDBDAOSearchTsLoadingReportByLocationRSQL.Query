<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="StatusReportDBDAOSearchTsLoadingReportByLocationRSQL">
			<desc><![CDATA[StatusReportDBDAOSearchTsLoadingReportByLocationRSQL]]></desc>
			<sql><![CDATA[
/* For Select */
SELECT 
ROWNUM SEQ_NO
, TRIM(TO_CHAR(SUM(TEU) OVER(),'99990.99')) TOTAL_40T
, TRIM(TO_CHAR(SUM(FEU) OVER(),'99990.99')) TOTAL_20T
, ${order_by_title} AS ORDER_BY_TITLE
, Y.*
FROM ( SELECT   /*+ ORDERED */
            SUM(DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),'2',CNTR_VOL_QTY,0)) AS TEU,
            SUM(DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),'2',0,CNTR_VOL_QTY)) AS FEU,
            BKG_NO,       SHIPPER_CD,  POL_CD,  POD_CD,   IN_VVD,  OUT_VVD,
            BL_NO,        SHIPPER_NM,  IN_LANE, OUT_LANE, IN_TMNL, OUT_TMNL, IN_ZONE, OUT_ZONE
        FROM (  SELECT 
                    BK.BKG_NO,
                    CUST.CUST_CNT_CD||CUST.CUST_SEQ AS SHIPPER_CD,
                    VVD.POL_CD,
                    VVD.POD_CD,
                    IN_VVD.VSL_CD||IN_VVD.SKD_VOY_NO||IN_VVD.SKD_DIR_CD           AS IN_VVD,
                    VVD.VSL_CD||VVD.SKD_VOY_NO||VVD.SKD_DIR_CD        AS OUT_VVD,
                    CNTR.CNTR_TPSZ_CD,
                    CNTR_VOL_QTY,
                    BK.BL_NO,
                    REPLACE(CUST.CUST_NM,CHR(10),' ') AS SHIPPER_NM,
                    IN_VVD.SLAN_CD     AS IN_LANE,
                    VVD.SLAN_CD    AS OUT_LANE,
                    IN_VVD.POL_YD_CD   AS IN_TMNL,
                    VVD.POD_YD_CD  AS OUT_TMNL,
                    DECODE(SUBSTR(IN_VVD.POL_CD,1,2), 'JP','JPN',DECODE(IN_POL.CONTI_CD,'M','USA','E','EUR',DECODE(SUBSTR(IN_POL.SCONTI_CD,1,1),SUBSTR(IN_POL.SCONTI_CD,1,1),'IPC','PRC'))) IN_ZONE,
                    DECODE(SUBSTR(VVD.POD_CD,1,2),'JP','JPN',DECODE(OUT_POD.CONTI_CD,'M','USA','E','EUR',DECODE(SUBSTR(OUT_POL.SCONTI_CD,1,1),SUBSTR(OUT_POD.SCONTI_CD,1,1),'IPC','PRC')))  OUT_ZONE
                FROM   (SELECT  
									S.VSL_CD, S.SKD_VOY_NO, S.SKD_DIR_CD, S.VPS_PORT_CD, S.VPS_ETD_DT ,CLPT_SEQ ,CLPT_IND_SEQ
                                FROM   VSK_VSL_PORT_SKD S  ,VSK_VSL_SKD V
                                WHERE  1 = 1 
                                AND    S.VPS_ETD_DT >= TO_DATE(@[dura_from_dt], 'YYYY-MM-DD') 
                                AND    S.VPS_ETD_DT <= TO_DATE(@[dura_to_dt], 'YYYY-MM-DD') + 0.99999 
                                AND    NVL(SKD_CNG_STS_CD, ' ') <> 'S'
                                AND    S.VSL_CD  = V.VSL_CD
                                AND    S.SKD_VOY_NO = V.SKD_VOY_NO
                                AND    S.SKD_DIR_CD  = V.SKD_DIR_CD
                                AND    S.SLAN_CD  = V.VSL_SLAN_CD 
                                AND    V.SKD_STS_CD <> 'RDY'
                                AND    S.VPS_PORT_CD = @[location_cd]
								
								/* location_yd_cd */
								#if (${location_yd_cd} != '') 
								AND    S.YD_CD = @[location_cd]||@[location_yd_cd]
								#end
                                
                           ) VSP, 
                BKG_VVD VVD, BKG_BOOKING BK, 
                BKG_CONTAINER CNTR, BKG_CUSTOMER CUST, 
                BKG_VVD IN_VVD,
                MDM_LOCATION IN_POL,MDM_LOCATION IN_POD,
                MDM_LOCATION OUT_POL,MDM_LOCATION OUT_POD
                WHERE 1=1
                AND VSP.VSL_CD = VVD.VSL_CD
                AND VSP.SKD_VOY_NO = VVD.SKD_VOY_NO
                AND VSP.SKD_DIR_CD = VVD.SKD_DIR_CD
                AND VSP.CLPT_IND_SEQ  = VVD.POL_CLPT_IND_SEQ
                AND VPS_PORT_CD = VVD.POL_CD
                AND VVD.BKG_NO = BK.BKG_NO
                AND BK.BKG_STS_CD <> 'X'
                AND VVD.BKG_NO = IN_VVD.BKG_NO(+)
                AND VVD.POL_CD = IN_VVD.POD_CD(+)
               
                AND VVD.BKG_NO = CUST.BKG_NO
                AND CUST.BKG_CUST_TP_CD ='S'
                AND BK.BKG_NO = CNTR.BKG_NO
                AND  IN_VVD.POL_CD = IN_POL.LOC_CD(+)
                AND  IN_VVD.POD_CD = IN_POD.LOC_CD(+)
                AND  VVD.POL_CD = OUT_POL.LOC_CD(+)
                AND  VVD.POD_CD = OUT_POD.LOC_CD(+)

  
                /* bl_type_ob */
				#if (${bl_type_ob} != '' && ${bl_type_ts} == '') 
				AND    BK.POL_CD = VVD.POL_CD
				#end

                /* bl_type_ts */
				#if (${bl_type_ts} != '' && ${bl_type_ob} == '') 
				AND    BK.POL_CD <> VVD.POL_CD
				#end

				/* POL */
				#if (${pol_cd} != '') 
				AND    BK.POL_CD = @[pol_cd]
				#end

				/* POD */
				#if (${pod_cd} != '') 
				AND    BK.POD_CD = @[pod_cd]
				#end

				/* OUT LANE */
				#if (${out_lane} != '') 
				AND    VVD.SLAN_CD = @[out_lane]
				#end

                /* OUT TMNL */
				#if (${out_tmnl} != '') 
				AND    VVD.POD_YD_CD = @[out_tmnl]
				#end


        ) X
		WHERE 1 = 1
        /* TRADE ZONE */
		#if (${trade_zone} != '') 
		AND    OUT_ZONE = @[trade_zone]
		#end

		/* SHIPPER CD*/
		#if (${shipper_cd} != '') 
		AND    SHIPPER_CD = @[shipper_cd]
		#end

        GROUP BY BKG_NO,       SHIPPER_CD,  POL_CD,  POD_CD,   IN_VVD,  OUT_VVD,
                 BL_NO,        SHIPPER_NM,  IN_LANE, OUT_LANE, IN_TMNL, OUT_TMNL, IN_ZONE, OUT_ZONE
        ORDER BY ${order_by}
) Y			]]></sql>
			<params>
				<param name="dura_from_dt" type="12" value="" out="N"/>
				<param name="dura_to_dt" type="12" value="" out="N"/>
				<param name="location_cd" type="12" value="" out="N"/>
				<param name="location_yd_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="out_lane" type="12" value="" out="N"/>
				<param name="out_tmnl" type="12" value="" out="N"/>
				<param name="trade_zone" type="12" value="" out="N"/>
				<param name="shipper_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
