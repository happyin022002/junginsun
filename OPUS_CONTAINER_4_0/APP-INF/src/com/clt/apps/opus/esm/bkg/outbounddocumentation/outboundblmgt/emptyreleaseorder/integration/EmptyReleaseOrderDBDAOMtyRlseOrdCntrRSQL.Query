<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EmptyReleaseOrderDBDAOMtyRlseOrdCntrRSQL">
			<desc><![CDATA[EmptyReleaseOrderDBDAOMtyRlseOrdCntrRSQL]]></desc>
			<sql><![CDATA[
SELECT BB.BKG_NO
       ,BC.CNTR_NO
       ,BC.CNTR_TPSZ_CD
       ,REPLACE(bkg_join_fnc(CURSOR(SELECT SEAL.CNTR_SEAL_NO FROM BKG_CNTR_SEAL_NO SEAL WHERE SEAL.BKG_NO = BC.BKG_NO AND SEAL.CNTR_NO = BC.CNTR_NO ORDER BY SEAL.CNTR_SEAL_SEQ DESC)),',',' ') SEAL_NO
       ,BC.RC_FLG
       ,BC.DCGO_FLG
       ,BC.AWK_CGO_FLG
       ,BC.BB_CGO_FLG
       ,BC.SOC_FLG
       ,BC.CNTR_WGT
       ,BC.WGT_UT_CD
       ,RF.CMDT_CD
       ,REPLACE(RF.CMDT_DESC,',',' ') CMDT_DESC
       ,RF.NET_WGT
       ,RF.GRS_WGT
       ,RF.WGT_UT_CD AS WGT_UT_CD1
       ,'F' TEMP_UF
       ,RF.FDO_TEMP
       ,'C' TEMP_UC
       ,RF.CDO_TEMP
       ,RF.VLTG_NO
       ,RF.CNTR_VENT_TP_CD
       ,DECODE(RF.CNTR_VENT_TP_CD,'P',RF.VENT_RTO,NULL) AS VENT_RTO
       ,DECODE(RF.CNTR_VENT_TP_CD,'C',CBM_PER_HR_QTY,NULL) AS VENT_CMH
       ,RF.HUMID_NO
       ,RF.PWR_SPL_CBL_FLG
       ,REPLACE(REPLACE(REPLACE(RF.DIFF_RMK, CHR(10), ' '), CHR(13), ' '),',',' ') AS DIFF_RMK
       ,DECODE(SUBSTR(BC.CNTR_TPSZ_CD,1,1)||BC.RC_FLG,'RN','Y','N') AS RF_DRY
       ,RF.CNTR_DRN_CD AS RF_DRAIN
       ,AWK.OVR_FWRD_LEN
       ,AWK.OVR_BKWD_LEN
       ,AWK.OVR_HGT
       ,AWK.OVR_LF_LEN
       ,AWK.OVR_RT_LEN
	   ,BC.CNMV_STS_CD AS MOVE_STS
       ,(SELECT CM.ORG_YD_CD FROM CTM_MOVEMENT CM WHERE CM.CNTR_NO = BC.CNTR_NO AND CM.CNMV_YR = BC.CNMV_YR AND CM.CNMV_ID_NO = BC.CNMV_ID_NO AND CM.CNMV_CYC_NO = BC.CNMV_CYC_NO) AS EVENT_YARD
       ,TO_CHAR(BC.CNMV_EVNT_DT,'YYYYMMDDHH24MISS') AS EVENT_TIME
	   ,BC.VGM_WGT
 	   ,NVL(BC.VGM_WGT_UT_CD, ' ') AS VGM_WGT_UT_CD
FROM BKG_BOOKING BB
     ,BKG_CONTAINER BC
     ,BKG_RF_CGO RF
     ,BKG_AWK_CGO AWK
WHERE BB.BKG_NO = BC.BKG_NO
AND NVL(BB.EDI_HLD_FLG,'N') = 'N'
--AND BB.BKG_CGO_TP_CD IN ('F', 'R')
AND BC.BKG_NO = RF.BKG_NO(+)
AND BC.BKG_NO = AWK.BKG_NO(+)
AND BC.CNTR_NO = RF.CNTR_NO(+)
AND BC.CNTR_NO = AWK.CNTR_NO(+)
#if (${datetype} == 'FTP')
    AND BB.BKG_CRE_DT > SYSDATE -61
    AND BB.BKG_OFC_CD = UPPER(@[bkg_ofc_cd])
    AND (EXISTS (SELECT 'X' 
    			FROM BKG_HIS_MST BHM
                WHERE BHM.CRE_DT BETWEEN to_date(@[from_dt] ,'yyyy-mm-dd hh24:mi:ss') AND to_date(@[end_dt] ,'yyyy-mm-dd hh24:mi:ss')
    			AND BHM.BKG_HIS_ISS_UI_ID IN (SELECT ATTR_CTNT1 FROM BKG_HRD_CDG_CTNT WHERE HRD_CDG_ID = 'BKG_LDF_UI')
                AND BB.BKG_NO = BHM.BKG_NO)
      		OR EXISTS (SELECT 'X' FROM SCG_AUTHORIZATION SA WHERE SA.BKG_NO = BB.BKG_NO
                AND SA.SPCL_CGO_AUTH_CD = 'Y' 
                AND   SA.UPD_DT BETWEEN to_date(@[from_dt] ,'yyyy-mm-dd hh24:mi:ss') AND to_date(@[end_dt] ,'yyyy-mm-dd hh24:mi:ss')) 
    )
#else
--	AND   BB.BKG_STS_CD <> 'X'
    #if (${from_dt} != '')
      #if (${datetype} == 'BKG')
         AND BB.BKG_CRE_DT  BETWEEN to_date(@[from_dt] ,'yyyy-mm-dd hh24:mi') AND to_date(@[end_dt] ,'yyyy-mm-dd hh24:mi')
      #elseif(${datetype} == 'PUP')
         AND BB.MTY_PKUP_DT BETWEEN to_date(@[from_dt] ,'yyyy-mm-dd hh24:mi') AND to_date(@[end_dt] ,'yyyy-mm-dd hh24:mi')
      #end
    #end
    #if (${bkg_ofc_cd}!='')
       AND BB.BKG_OFC_CD = UPPER(@[bkg_ofc_cd])
    #end
    #if (${doc_usr_id}!='')
       AND UPPER(BB.DOC_USR_ID)  = UPPER(@[doc_usr_id])
    #end
    #if (${eq_ctrl_ofc_cd}!='')
       AND BB.EQ_CTRL_OFC_CD = UPPER(@[eq_ctrl_ofc_cd])
    #end
    #if (${vvd} !='')
       AND EXISTS (SELECT 'X' 
                   FROM BKG_VVD VVD 
                   WHERE BB.BKG_NO = VVD.BKG_NO
                   AND   VVD.VSL_PRE_PST_CD IN ('S','T')
                   AND VVD.VSL_CD = UPPER(substr(@[vvd],0,4))
                   AND VVD.SKD_VOY_NO = UPPER(substr(@[vvd],5,4))
                   AND VVD.SKD_DIR_CD = UPPER(substr(@[vvd],9,1))
                  )
    #end
    #if (${por_cd} !='')
       AND BB.POR_CD   = UPPER(@[por_cd])
    #end
    #if (${pol_cd} !='')
       AND BB.POL_CD   = UPPER(@[pol_cd])
    #end
    #if (${pod_cd}!='')
       AND BB.POD_CD   = UPPER(@[pod_cd])
    #end
    #if (${mty_pkup_yd_cd}!='')
       AND BB.MTY_PKUP_YD_CD = UPPER(@[mty_pkup_yd_cd])
    #end
    #if (${full_rtn_yd_cd}!='')
       AND BB.FULL_RTN_YD_CD = UPPER(@[full_rtn_yd_cd])
    #end
    #if (${bkg_no}!='')
       AND BB.BKG_NO   = UPPER(@[bkg_no])
    #end
    #if (${eq_confirm}=='Y')
       AND EXISTS (SELECT 1 FROM BKG_DOC_PROC_SKD WHERE BKG_NO = BB.BKG_NO AND BKG_DOC_PROC_TP_CD = 'CNTCFM' AND DOC_PERF_DELT_FLG = 'N')
    #end
    #if (${eq_confirm}=='N')
       AND NOT EXISTS (SELECT 1 FROM BKG_DOC_PROC_SKD WHERE BKG_NO = BB.BKG_NO AND BKG_DOC_PROC_TP_CD = 'CNTCFM' AND DOC_PERF_DELT_FLG = 'N')
    #end
#end
UNION ALL
SELECT BB.BKG_NO
       ,'' CNTR_NO
       ,'' CNTR_TPSZ_CD
       ,'' SEAL_NO
       ,'Y' RC_FLG
       ,'' DCGO_FLG
       ,'' AWK_CGO_FLG
       ,'' BB_CGO_FLG
       ,'' SOC_FLG
       ,RF.GRS_WGT CNTR_WGT
       ,RF.WGT_UT_CD WGT_UT_CD
       ,RF.CMDT_CD
       ,REPLACE(RF.CMDT_DESC,',',' ') CMDT_DESC
       ,RF.NET_WGT
       ,RF.GRS_WGT
       ,RF.WGT_UT_CD AS WGT_UT_CD1
       ,'F' TEMP_UF
       ,RF.FDO_TEMP
       ,'C' TEMP_UC
       ,RF.CDO_TEMP
       ,RF.VLTG_NO
       ,RF.CNTR_VENT_TP_CD
       ,DECODE(RF.CNTR_VENT_TP_CD,'P',RF.VENT_RTO,NULL) AS VENT_RTO
       ,DECODE(RF.CNTR_VENT_TP_CD,'C',CBM_PER_HR_QTY,NULL) AS VENT_CMH
       ,RF.HUMID_NO
       ,RF.PWR_SPL_CBL_FLG
       ,REPLACE(REPLACE(REPLACE(RF.DIFF_RMK, CHR(10), ' '), CHR(13), ' '),',',' ') AS DIFF_RMK
       ,'N' AS RF_DRY
       ,RF.CNTR_DRN_CD AS RF_DRAIN
       ,null OVR_FWRD_LEN
       ,null OVR_BKWD_LEN
       ,null OVR_HGT
       ,null OVR_LF_LEN
       ,null OVR_RT_LEN
	   ,'' AS MOVE_STS
       ,'' AS EVENT_YARD
       ,'' AS EVENT_TIME
	   ,null AS VGM_WGT
 	   ,' ' AS VGM_WGT_UT_CD
FROM BKG_BOOKING BB
     ,BKG_RF_CGO RF
WHERE BB.BKG_NO = RF.BKG_NO
AND NVL(BB.EDI_HLD_FLG,'N') = 'N'
--AND BB.BKG_CGO_TP_CD IN ('F', 'R')
AND RF.CNTR_NO IS NULL
#if (${datetype} == 'FTP')
    AND BB.BKG_CRE_DT > SYSDATE -61
    AND BB.BKG_OFC_CD = UPPER(@[bkg_ofc_cd])
    AND (EXISTS (SELECT 'X' 
    			FROM BKG_HIS_MST BHM
                WHERE BHM.CRE_DT BETWEEN to_date(@[from_dt] ,'yyyy-mm-dd hh24:mi:ss') AND to_date(@[end_dt] ,'yyyy-mm-dd hh24:mi:ss')
    			AND BHM.BKG_HIS_ISS_UI_ID IN (SELECT ATTR_CTNT1 FROM BKG_HRD_CDG_CTNT WHERE HRD_CDG_ID = 'BKG_LDF_UI')
                AND BB.BKG_NO = BHM.BKG_NO)
      OR EXISTS (SELECT 'X' FROM SCG_AUTHORIZATION SA WHERE SA.BKG_NO = BB.BKG_NO
                AND   SA.CRE_DT BETWEEN to_date(@[from_dt] ,'yyyy-mm-dd hh24:mi:ss') AND to_date(@[end_dt] ,'yyyy-mm-dd hh24:mi:ss'))
    )
#else
--	AND   BB.BKG_STS_CD <> 'X'
    #if (${from_dt} != '')
      #if (${datetype} == 'BKG')
         AND BB.BKG_CRE_DT  BETWEEN to_date(@[from_dt] ,'yyyy-mm-dd hh24:mi') AND to_date(@[end_dt] ,'yyyy-mm-dd hh24:mi')
      #elseif(${datetype} == 'PUP')
         AND BB.MTY_PKUP_DT BETWEEN to_date(@[from_dt] ,'yyyy-mm-dd hh24:mi') AND to_date(@[end_dt] ,'yyyy-mm-dd hh24:mi')
      #end
    #end
    #if (${bkg_ofc_cd}!='')
       AND BB.BKG_OFC_CD = UPPER(@[bkg_ofc_cd])
    #end
    #if (${doc_usr_id}!='')
       AND UPPER(BB.DOC_USR_ID)  = UPPER(@[doc_usr_id])
    #end
    #if (${eq_ctrl_ofc_cd}!='')
       AND BB.EQ_CTRL_OFC_CD = UPPER(@[eq_ctrl_ofc_cd])
    #end
    #if (${vvd} !='')
       AND EXISTS (SELECT 'X' 
                   FROM BKG_VVD VVD 
                   WHERE BB.BKG_NO = VVD.BKG_NO
                   AND   VVD.VSL_PRE_PST_CD IN ('S','T')
                   AND VVD.VSL_CD = UPPER(substr(@[vvd],0,4))
                   AND VVD.SKD_VOY_NO = UPPER(substr(@[vvd],5,4))
                   AND VVD.SKD_DIR_CD = UPPER(substr(@[vvd],9,1))
                  )
    #end
    #if (${por_cd} !='')
       AND BB.POR_CD   = UPPER(@[por_cd])
    #end
    #if (${pol_cd} !='')
       AND BB.POL_CD   = UPPER(@[pol_cd])
    #end
    #if (${pod_cd}!='')
       AND BB.POD_CD   = UPPER(@[pod_cd])
    #end
    #if (${mty_pkup_yd_cd}!='')
       AND BB.MTY_PKUP_YD_CD = UPPER(@[mty_pkup_yd_cd])
    #end
    #if (${full_rtn_yd_cd}!='')
       AND BB.FULL_RTN_YD_CD = UPPER(@[full_rtn_yd_cd])
    #end
    #if (${bkg_no}!='')
       AND BB.BKG_NO   = UPPER(@[bkg_no])
    #end
    #if (${eq_confirm}=='Y')
       AND EXISTS (SELECT 1 FROM BKG_DOC_PROC_SKD WHERE BKG_NO = BB.BKG_NO AND BKG_DOC_PROC_TP_CD = 'CNTCFM' AND DOC_PERF_DELT_FLG = 'N')
    #end
    #if (${eq_confirm}=='N')
       AND NOT EXISTS (SELECT 1 FROM BKG_DOC_PROC_SKD WHERE BKG_NO = BB.BKG_NO AND BKG_DOC_PROC_TP_CD = 'CNTCFM' AND DOC_PERF_DELT_FLG = 'N')
    #end
#end
ORDER BY BKG_NO			]]></sql>
			<params>
				<param name="bkg_ofc_cd" type="12" value="" out="N"/>
				<param name="from_dt" type="12" value="" out="N"/>
				<param name="end_dt" type="12" value="" out="N"/>
				<param name="doc_usr_id" type="12" value="" out="N"/>
				<param name="eq_ctrl_ofc_cd" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="por_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="mty_pkup_yd_cd" type="12" value="" out="N"/>
				<param name="full_rtn_yd_cd" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
