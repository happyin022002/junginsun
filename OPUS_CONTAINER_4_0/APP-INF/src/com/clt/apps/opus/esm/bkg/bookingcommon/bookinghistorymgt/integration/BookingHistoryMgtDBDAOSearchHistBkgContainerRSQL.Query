<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingHistoryMgtDBDAOSearchHistBkgContainerRSQL">
			<desc><![CDATA[BookingHistoryMgtDBDAOSearchHistBkgContainerRSQL]]></desc>
			<sql><![CDATA[
WITH OLD AS
(SELECT @[bkg_no] BKG_NO
, @[cntr_no] CNTR_NO
, @[cntr_tpsz_cd] CNTR_TPSZ_CD
, @[cnmv_yr] CNMV_YR
, @[cnmv_id_no] CNMV_ID_NO
, @[cnmv_cyc_no] CNMV_CYC_NO
, @[cnmv_sts_cd] CNMV_STS_CD
, @[cntr_dp_seq] CNTR_DP_SEQ
, @[pck_tp_cd] PCK_TP_CD
, @[pck_qty] PCK_QTY
, @[cntr_wgt] CNTR_WGT
, @[wgt_ut_cd] WGT_UT_CD
, @[meas_qty] MEAS_QTY
, @[meas_ut_cd] MEAS_UT_CD
, @[rcv_term_cd] RCV_TERM_CD
, @[de_term_cd] DE_TERM_CD
, @[org_fm_loc_cd] ORG_FM_LOC_CD
, @[org_to_loc_cd] ORG_TO_LOC_CD
, @[org_yd_cd] ORG_YD_CD
, @[dest_fm_loc_cd] DEST_FM_LOC_CD
, @[dest_to_yd_cd] DEST_TO_YD_CD
, @[dest_yd_cd] DEST_YD_CD
, @[por_nod_cd] POR_NOD_CD
, @[pol_yd_cd] POL_YD_CD
, @[cntr_prt_flg] CNTR_PRT_FLG
, @[cntr_prt_seq] CNTR_PRT_SEQ
, @[cntr_vol_qty] CNTR_VOL_QTY
, @[adv_shtg_cd] ADV_SHTG_CD
, @[cntr_tax_expt_flg] CNTR_TAX_EXPT_FLG
, @[cstms_prn_flg] CSTMS_PRN_FLG
, @[cstms_exp_dt] CSTMS_EXP_DT
, @[cntr_hlg_flg] CNTR_HLG_FLG
, @[dcgo_flg] DCGO_FLG
, @[rc_flg] RC_FLG
, @[bb_cgo_flg] BB_CGO_FLG
, @[awk_cgo_flg] AWK_CGO_FLG
, @[rd_cgo_flg] RD_CGO_FLG
, @[hngr_flg] HNGR_FLG
, @[soc_flg] SOC_FLG
, @[eq_subst_flg] EQ_SUBST_FLG
, @[eq_subst_tpsz_cd] EQ_SUBST_TPSZ_CD
, @[cgo_rcv_dt] CGO_RCV_DT
, @[cgo_rcv_yd_cd] CGO_RCV_YD_CD
, @[ob_cy_gen_dt] OB_CY_GEN_DT
, @[ob_cy_auto_gen_flg] OB_CY_AUTO_GEN_FLG
, @[cnmv_flg] CNMV_FLG
, @[cnmv_evnt_dt] CNMV_EVNT_DT
, @[po_no] PO_NO
, @[do_no] DO_NO
, @[do_no_split] DO_NO_SPLIT
, @[diff_rmk] DIFF_RMK
, @[rmk_bl_dp_flg] RMK_BL_DP_FLG
, @[cntr_cfm_flg] CNTR_CFM_FLG
, @[mcntr_bdl_no] MCNTR_BDL_NO
, @[mf_cfm_flg] MF_CFM_FLG
, @[cntr_delt_flg] CNTR_DELT_FLG
, DECODE((SELECT COUNT(1) 
#if (${ca_flg} == 'Y')
		               FROM BKG_CNTR_HIS DEL
			          WHERE DEL.BKG_NO  = @[bkg_no]
			 	        AND DEL.CORR_NO = 'TMP0000001' 
#else 
			           FROM BKG_CONTAINER DEL
			          WHERE DEL.BKG_NO  = @[bkg_no]
#end
           				AND DEL.CNTR_NO = @[cntr_no]
						AND ROWNUM 		= 1), 0, 'Y', 'N') DEL_YN
FROM DUAL)
SELECT HIS_CATE_NM
     , REPLACE(REPLACE(REPLACE(REPLACE(PRE_CTNT,  '()/()/()/()', null), '/0()', null), '/()', null), '()', null) PRE_CTNT
     , decode(CRNT_CTNT, '()/()/()/()', null, '()/', null, '()', null, '/', null, CRNT_CTNT) CRNT_CTNT
  FROM 
    (
        SELECT 'Container No.' HIS_CATE_NM
                , OLD.CNTR_NO||'('||OLD.CNTR_TPSZ_CD||')' PRE_CTNT
                , NOW.CNTR_NO||'('||NOW.CNTR_TPSZ_CD||')' CRNT_CTNT
          FROM OLD
#if (${ca_flg} == 'Y')
             , BKG_CNTR_HIS NOW
         WHERE NOW.BKG_NO (+) = OLD.BKG_NO
	       AND NOW.CORR_NO(+) = 'TMP0000001' 
#else
             , BKG_CONTAINER NOW
         WHERE NOW.BKG_NO (+) = OLD.BKG_NO
#end

           AND NOW.CNTR_NO(+) = OLD.CNTR_NO
		UNION
        SELECT DECODE(@[ui_id],'ESM_BKG_0079_07','[CNTR] PKG/Weight/Measure','PKG/Weight/Measure') HIS_CATE_NM
                , OLD.CNTR_NO||'('||OLD.CNTR_TPSZ_CD||')/'||OLD.PCK_QTY||'('||OLD.PCK_TP_CD||')/'||OLD.CNTR_WGT||'('||OLD.WGT_UT_CD||')/'||OLD.MEAS_QTY||'('||OLD.MEAS_UT_CD||')' PRE_CTNT
                , NOW.CNTR_NO||'('||NOW.CNTR_TPSZ_CD||')/'||NOW.PCK_QTY||'('||NOW.PCK_TP_CD||')/'||NOW.CNTR_WGT||'('||NOW.WGT_UT_CD||')/'||NOW.MEAS_QTY||'('||NOW.MEAS_UT_CD||')' CRNT_CTNT
          FROM OLD
#if (${ca_flg} == 'Y')
             , BKG_CNTR_HIS NOW
         WHERE NOW.BKG_NO (+) = OLD.BKG_NO
	       AND NOW.CORR_NO(+) = 'TMP0000001' 
#else
             , BKG_CONTAINER NOW
         WHERE NOW.BKG_NO (+) = OLD.BKG_NO
#end
		   AND ((OLD.DEL_YN = 'Y' AND (OLD.PCK_QTY <> 0 OR OLD.CNTR_WGT <> 0 OR OLD.MEAS_QTY <> 0)) OR OLD.DEL_YN = 'N')
           AND NOW.CNTR_NO(+) = OLD.CNTR_NO
		UNION
        SELECT 'CNTR VOL' HIS_CATE_NM
                , OLD.CNTR_NO||'('||OLD.CNTR_TPSZ_CD||')/'||trim(to_char(OLD.CNTR_VOL_QTY, '999,999,990.000'))||'/P:'||OLD.CNTR_PRT_FLG PRE_CTNT
                , NOW.CNTR_NO||'('||NOW.CNTR_TPSZ_CD||')/'||trim(to_char(NOW.CNTR_VOL_QTY, '999,999,990.000'))||'/P:'||NOW.CNTR_PRT_FLG CRNT_CTNT
          FROM OLD
#if (${ca_flg} == 'Y')
             , BKG_CNTR_HIS NOW
         WHERE NOW.BKG_NO (+) = OLD.BKG_NO
	       AND NOW.CORR_NO(+) = 'TMP0000001' 
#else
             , BKG_CONTAINER NOW
         WHERE NOW.BKG_NO (+) = OLD.BKG_NO
#end
		   AND ((OLD.DEL_YN = 'Y' AND OLD.CNTR_VOL_QTY <> 1) OR OLD.DEL_YN = 'N')

           AND NOW.CNTR_NO(+) = OLD.CNTR_NO		
		UNION
        SELECT 'AS' HIS_CATE_NM
                , OLD.CNTR_NO||'('||OLD.CNTR_TPSZ_CD||')/'||OLD.ADV_SHTG_CD PRE_CTNT
                , NOW.CNTR_NO||'('||NOW.CNTR_TPSZ_CD||')/'||NOW.ADV_SHTG_CD CRNT_CTNT
          FROM OLD
#if (${ca_flg} == 'Y')
             , BKG_CNTR_HIS NOW
         WHERE NOW.BKG_NO (+) = OLD.BKG_NO
	       AND NOW.CORR_NO(+) = 'TMP0000001' 
#else
             , BKG_CONTAINER NOW
         WHERE NOW.BKG_NO (+) = OLD.BKG_NO
#end
		   AND ((OLD.DEL_YN = 'Y' AND OLD.ADV_SHTG_CD IS NOT NULL) OR OLD.DEL_YN = 'N')
           AND NOW.CNTR_NO(+) = OLD.CNTR_NO		
		UNION
        SELECT 'HG' HIS_CATE_NM
                , OLD.CNTR_NO||'('||OLD.CNTR_TPSZ_CD||')/'||OLD.HNGR_FLG
                   ||'/D:'||OLD.DCGO_FLG||'/R:'||OLD.RC_FLG ||'/'|| OLD.RD_CGO_FLG ||'/B:'||OLD.BB_CGO_FLG
                   ||'/A:'||OLD.AWK_CGO_FLG ||'/S:'|| OLD.SOC_FLG PRE_CTNT
                , NOW.CNTR_NO||'('||NOW.CNTR_TPSZ_CD||')/'||NOW.HNGR_FLG
                   ||'/D:'||NOW.DCGO_FLG||'/R:'||NOW.RC_FLG ||'/'|| NOW.RD_CGO_FLG ||'/B:'||NOW.BB_CGO_FLG
                   ||'/A:'||NOW.AWK_CGO_FLG ||'/S:'|| NOW.SOC_FLG CRNT_CTNT
          FROM OLD
#if (${ca_flg} == 'Y')
             , BKG_CNTR_HIS NOW
         WHERE NOW.BKG_NO (+) = OLD.BKG_NO
	       AND NOW.CORR_NO(+) = 'TMP0000001' 
#else
             , BKG_CONTAINER NOW
         WHERE NOW.BKG_NO (+) = OLD.BKG_NO
#end
		   AND ((OLD.DEL_YN = 'Y' AND OLD.HNGR_FLG <> 'N') OR OLD.DEL_YN = 'N')
           AND NOW.CNTR_NO(+) = OLD.CNTR_NO		
		UNION
        SELECT 'CNTR Remark' HIS_CATE_NM
                , OLD.CNTR_NO||'('||OLD.CNTR_TPSZ_CD||')/'||OLD.DIFF_RMK PRE_CTNT
                , NOW.CNTR_NO||'('||NOW.CNTR_TPSZ_CD||')/'||NOW.DIFF_RMK CRNT_CTNT
          FROM OLD
#if (${ca_flg} == 'Y')
             , BKG_CNTR_HIS NOW
         WHERE NOW.BKG_NO (+) = OLD.BKG_NO
	       AND NOW.CORR_NO(+) = 'TMP0000001' 
#else
             , BKG_CONTAINER NOW
         WHERE NOW.BKG_NO (+) = OLD.BKG_NO
#end
		   AND ((OLD.DEL_YN = 'Y' AND OLD.DIFF_RMK IS NOT NULL) OR OLD.DEL_YN = 'N')
           AND NOW.CNTR_NO(+) = OLD.CNTR_NO
    )    
 WHERE NVL(TRIM(PRE_CTNT), ' ') <> NVL(TRIM(CRNT_CTNT), ' ')			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="cnmv_yr" type="12" value="" out="N"/>
				<param name="cnmv_id_no" type="12" value="" out="N"/>
				<param name="cnmv_cyc_no" type="12" value="" out="N"/>
				<param name="cnmv_sts_cd" type="12" value="" out="N"/>
				<param name="cntr_dp_seq" type="12" value="" out="N"/>
				<param name="pck_tp_cd" type="12" value="" out="N"/>
				<param name="pck_qty" type="12" value="" out="N"/>
				<param name="cntr_wgt" type="12" value="" out="N"/>
				<param name="wgt_ut_cd" type="12" value="" out="N"/>
				<param name="meas_qty" type="12" value="" out="N"/>
				<param name="meas_ut_cd" type="12" value="" out="N"/>
				<param name="rcv_term_cd" type="12" value="" out="N"/>
				<param name="de_term_cd" type="12" value="" out="N"/>
				<param name="org_fm_loc_cd" type="12" value="" out="N"/>
				<param name="org_to_loc_cd" type="12" value="" out="N"/>
				<param name="org_yd_cd" type="12" value="" out="N"/>
				<param name="dest_fm_loc_cd" type="12" value="" out="N"/>
				<param name="dest_to_yd_cd" type="12" value="" out="N"/>
				<param name="dest_yd_cd" type="12" value="" out="N"/>
				<param name="por_nod_cd" type="12" value="" out="N"/>
				<param name="pol_yd_cd" type="12" value="" out="N"/>
				<param name="cntr_prt_flg" type="12" value="" out="N"/>
				<param name="cntr_prt_seq" type="12" value="" out="N"/>
				<param name="cntr_vol_qty" type="12" value="" out="N"/>
				<param name="adv_shtg_cd" type="12" value="" out="N"/>
				<param name="cntr_tax_expt_flg" type="12" value="" out="N"/>
				<param name="cstms_prn_flg" type="12" value="" out="N"/>
				<param name="cstms_exp_dt" type="12" value="" out="N"/>
				<param name="cntr_hlg_flg" type="12" value="" out="N"/>
				<param name="dcgo_flg" type="12" value="" out="N"/>
				<param name="rc_flg" type="12" value="" out="N"/>
				<param name="bb_cgo_flg" type="12" value="" out="N"/>
				<param name="awk_cgo_flg" type="12" value="" out="N"/>
				<param name="rd_cgo_flg" type="12" value="" out="N"/>
				<param name="hngr_flg" type="12" value="" out="N"/>
				<param name="soc_flg" type="12" value="" out="N"/>
				<param name="eq_subst_flg" type="12" value="" out="N"/>
				<param name="eq_subst_tpsz_cd" type="12" value="" out="N"/>
				<param name="cgo_rcv_dt" type="12" value="" out="N"/>
				<param name="cgo_rcv_yd_cd" type="12" value="" out="N"/>
				<param name="ob_cy_gen_dt" type="12" value="" out="N"/>
				<param name="ob_cy_auto_gen_flg" type="12" value="" out="N"/>
				<param name="cnmv_flg" type="12" value="" out="N"/>
				<param name="cnmv_evnt_dt" type="12" value="" out="N"/>
				<param name="po_no" type="12" value="" out="N"/>
				<param name="do_no" type="12" value="" out="N"/>
				<param name="do_no_split" type="12" value="" out="N"/>
				<param name="diff_rmk" type="12" value="" out="N"/>
				<param name="rmk_bl_dp_flg" type="12" value="" out="N"/>
				<param name="cntr_cfm_flg" type="12" value="" out="N"/>
				<param name="mcntr_bdl_no" type="12" value="" out="N"/>
				<param name="mf_cfm_flg" type="12" value="" out="N"/>
				<param name="cntr_delt_flg" type="12" value="" out="N"/>
				<param name="ui_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
