<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingHistoryMgtDBDAOSearchHistBkgQtyDtlRSQL">
			<desc><![CDATA[BookingHistoryMgtDBDAOSearchHistBkgQtyDtlRSQL]]></desc>
			<sql><![CDATA[
WITH OLD AS
(SELECT @[bkg_no] BKG_NO
, @[cntr_tpsz_cd] CNTR_TPSZ_CD
, @[subst_seq] SUBST_SEQ
, @[rcv_term_cd] RCV_TERM_CD
, @[de_term_cd] DE_TERM_CD
, @[op_cntr_qty] OP_CNTR_QTY
, @[awk_cgo_flg] AWK_CGO_FLG
, @[dcgo_flg] DCGO_FLG
, @[rc_flg] RC_FLG
, @[bb_cgo_flg] BB_CGO_FLG
, @[soc_flg] SOC_FLG
, @[crr_hngr_flg] CRR_HNGR_FLG
, @[mer_hngr_flg] MER_HNGR_FLG
, @[crr_hngr_sgl_bar_use_flg] CRR_HNGR_SGL_BAR_USE_FLG
, @[crr_hngr_dbl_bar_use_flg] CRR_HNGR_DBL_BAR_USE_FLG
, @[crr_hngr_tpl_bar_use_flg] CRR_HNGR_TPL_BAR_USE_FLG
, @[eq_subst_cntr_tpsz_cd] EQ_SUBST_CNTR_TPSZ_CD
FROM DUAL)
SELECT HIS_CATE_NM
     , PRE_CTNT
     , CRNT_CTNT
  FROM 
    (
        SELECT 'Volume Detail' HIS_CATE_NM
                , OLD.CNTR_TPSZ_CD||
                  '/'||OLD.OP_CNTR_QTY||
                  decode(OLD.RCV_TERM_CD,  NOW.RCV_TERM_CD, '', '/'||OLD.RCV_TERM_CD)||
                  decode(OLD.DE_TERM_CD,   NOW.DE_TERM_CD,  '', '/'||OLD.DE_TERM_CD)||
                  decode(OLD.DCGO_FLG,     NOW.DCGO_FLG,    '', '/D:'||OLD.DCGO_FLG)||
                  decode(OLD.RC_FLG,       NOW.RC_FLG,      '', '/R:'||OLD.RC_FLG)||
                  decode(OLD.AWK_CGO_FLG,  NOW.AWK_CGO_FLG, '', '/A:'||OLD.AWK_CGO_FLG)||
                  decode(OLD.BB_CGO_FLG,   NOW.BB_CGO_FLG,  '', '/B:'||OLD.BB_CGO_FLG)||
                  decode(OLD.EQ_SUBST_CNTR_TPSZ_CD, NOW.EQ_SUBST_CNTR_TPSZ_CD, '', '/SUB:'||OLD.EQ_SUBST_CNTR_TPSZ_CD)
                  ||'/SOC:'||OLD.SOC_FLG PRE_CTNT
                , NOW.CNTR_TPSZ_CD||
                  '/'||NOW.OP_CNTR_QTY||
                  decode(OLD.RCV_TERM_CD,  NOW.RCV_TERM_CD, '', '/'||NOW.RCV_TERM_CD)||
                  decode(OLD.DE_TERM_CD,   NOW.DE_TERM_CD,  '', '/'||NOW.DE_TERM_CD)||
                  decode(OLD.DCGO_FLG,     NOW.DCGO_FLG,    '', '/D:'||NOW.DCGO_FLG)||
                  decode(OLD.RC_FLG,       NOW.RC_FLG,      '', '/R:'||NOW.RC_FLG)||
                  decode(OLD.AWK_CGO_FLG,  NOW.AWK_CGO_FLG, '', '/A:'||NOW.AWK_CGO_FLG)||
                  decode(OLD.BB_CGO_FLG,   NOW.BB_CGO_FLG,  '', '/B:'||NOW.BB_CGO_FLG)||
                  decode(OLD.EQ_SUBST_CNTR_TPSZ_CD, NOW.EQ_SUBST_CNTR_TPSZ_CD, '', '/SUB:'||NOW.EQ_SUBST_CNTR_TPSZ_CD)
                  ||'/SOC:'||NOW.SOC_FLG CRNT_CTNT
          FROM OLD
#if (${ca_flg} == 'Y')
             , BKG_QTY_DTL_HIS NOW
         WHERE NOW.BKG_NO      (+) = OLD.BKG_NO 
	       AND NOW.CORR_NO     (+) = 'TMP0000001' 
#else
             , BKG_QTY_DTL NOW
         WHERE NOW.BKG_NO      (+) = OLD.BKG_NO 
#end
 
           AND NOW.CNTR_TPSZ_CD(+) = OLD.CNTR_TPSZ_CD
           AND NOW.SUBST_SEQ   (+) = OLD.SUBST_SEQ
 		UNION ALL
        SELECT 'Hanger Vol' HIS_CATE_NM
                , OLD.CNTR_TPSZ_CD||
                  '/'||OLD.OP_CNTR_QTY||
                  '/Merchant:'||OLD.MER_HNGR_FLG||
                  '/Carrier:'||
                  '(s:'||OLD.CRR_HNGR_SGL_BAR_USE_FLG||
                  '/d:'||OLD.CRR_HNGR_DBL_BAR_USE_FLG||
                  '/t:'||OLD.CRR_HNGR_TPL_BAR_USE_FLG||')' PRE_CTNT
                , NOW.CNTR_TPSZ_CD||
                  '/'||NOW.OP_CNTR_QTY||
                  '/Merchant:'||NOW.MER_HNGR_FLG||
                  '/Carrier:'||
                  '(s:'||NOW.CRR_HNGR_SGL_BAR_USE_FLG||
                  '/d:'||NOW.CRR_HNGR_DBL_BAR_USE_FLG||
                  '/t:'||NOW.CRR_HNGR_TPL_BAR_USE_FLG||')' CRNT_CTNT
          FROM OLD
#if (${ca_flg} == 'Y')
             , BKG_QTY_DTL_HIS NOW
         WHERE NOW.BKG_NO      (+) = OLD.BKG_NO 
	       AND NOW.CORR_NO     (+) = 'TMP0000001' 
#else
             , BKG_QTY_DTL NOW
         WHERE NOW.BKG_NO      (+) = OLD.BKG_NO
#end
           AND NOW.CNTR_TPSZ_CD(+) = OLD.CNTR_TPSZ_CD
           AND NOW.SUBST_SEQ   (+) = OLD.SUBST_SEQ
		   AND (NOW.CRR_HNGR_FLG = 'Y' OR NOW.MER_HNGR_FLG = 'Y' OR NOW.CRR_HNGR_SGL_BAR_USE_FLG = 'Y' OR NOW.CRR_HNGR_DBL_BAR_USE_FLG = 'Y' OR NOW.CRR_HNGR_TPL_BAR_USE_FLG = 'Y'
		    OR  OLD.CRR_HNGR_FLG = 'Y' OR OLD.MER_HNGR_FLG = 'Y' OR OLD.CRR_HNGR_SGL_BAR_USE_FLG = 'Y' OR OLD.CRR_HNGR_DBL_BAR_USE_FLG = 'Y' OR OLD.CRR_HNGR_TPL_BAR_USE_FLG = 'Y')
		 ORDER BY PRE_CTNT, CRNT_CTNT
    )    
 WHERE NVL(TRIM(PRE_CTNT), ' ') <> NVL(TRIM(CRNT_CTNT), ' ')			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="subst_seq" type="12" value="" out="N"/>
				<param name="rcv_term_cd" type="12" value="" out="N"/>
				<param name="de_term_cd" type="12" value="" out="N"/>
				<param name="op_cntr_qty" type="12" value="" out="N"/>
				<param name="awk_cgo_flg" type="12" value="" out="N"/>
				<param name="dcgo_flg" type="12" value="" out="N"/>
				<param name="rc_flg" type="12" value="" out="N"/>
				<param name="bb_cgo_flg" type="12" value="" out="N"/>
				<param name="soc_flg" type="12" value="" out="N"/>
				<param name="crr_hngr_flg" type="12" value="" out="N"/>
				<param name="mer_hngr_flg" type="12" value="" out="N"/>
				<param name="crr_hngr_sgl_bar_use_flg" type="12" value="" out="N"/>
				<param name="crr_hngr_dbl_bar_use_flg" type="12" value="" out="N"/>
				<param name="crr_hngr_tpl_bar_use_flg" type="12" value="" out="N"/>
				<param name="eq_subst_cntr_tpsz_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
