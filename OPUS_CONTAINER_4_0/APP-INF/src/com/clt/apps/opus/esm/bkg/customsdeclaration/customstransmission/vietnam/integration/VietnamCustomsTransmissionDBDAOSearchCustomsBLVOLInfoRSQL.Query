<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="VietnamCustomsTransmissionDBDAOSearchCustomsBLVOLInfoRSQL">
			<desc><![CDATA[SearchCustomsBLVOLInfo]]></desc>
			<sql><![CDATA[
SELECT COM_ConstantMgr_PKG.COM_getScacCode_FNC()||B.BL_NO AS BL_NO, 
       B.BKG_NO BKG_NO,
#if (${pol_gubun}=='1')
       '22' AS BL_IND,     --Mode=Outbound 조건    --22-Export
#else
       '23' AS BL_IND,    --Mode=Inbound 조건    --23-Import
#end
       BD.PCK_QTY AS BL_PKG,
       NVL(CNV.CSTMS_PCK_TP_CD, BD.PCK_TP_CD) AS BLPKG_UNIT,
       BD.ACT_WGT AS BL_WGT,
       BD.WGT_UT_CD AS BLWGT_UNIT,
       SUM(BQ.OP_CNTR_QTY) AS BL_VOL,
       'MTQ' AS BLVOL_UNIT,
       BD.MEAS_QTY AS BL_MEA,
       BD.MEAS_UT_CD AS BLMEA_UNIT,
       B.CMDT_CD AS COMMODITY_CD

  FROM BKG_VVD V,
       BKG_BOOKING B,
       BKG_BL_DOC BD,
       BKG_CONTAINER BC,
       BKG_QUANTITY BQ,
       BKG_CSTMS_PCK_TP_CONV CNV

 WHERE 1 = 1
   AND V.VSL_CD = SUBSTR(@[vvd],1,4)    --[vvd]
   AND V.SKD_VOY_NO = SUBSTR(@[vvd],5,4)    --[vvd]
   AND V.SKD_DIR_CD = SUBSTR(@[vvd],9,1)    --[vvd]
   AND B.BKG_NO = @[bkg_no]
#if (${pol_gubun}=='1')
   AND V.POL_CD = @[v_pol]    --Mode=Outbound 조건
#else
   AND V.POD_CD = @[v_pod]    --Mode=Inbound 조건
#end
   AND B.BKG_NO = V.BKG_NO
   AND B.BKG_STS_CD <> 'X'
   AND BD.BKG_NO = B.BKG_NO
   AND BC.BKG_NO = B.BKG_NO
   AND BQ.BKG_NO(+) = BC.BKG_NO
   AND BQ.CNTR_TPSZ_CD(+) = BC.CNTR_TPSZ_CD
   AND BD.PCK_TP_CD = CNV.PCK_TP_CD(+)
   AND CNV.CNT_CD(+) = 'VN'

 GROUP BY B.BL_NO,
          B.BKG_NO,
          BD.ACT_WGT,
          BD.WGT_UT_CD,
          BD.MEAS_QTY,
          BD.MEAS_UT_CD,
          B.CMDT_CD,
          BD.PCK_QTY,
          NVL(CNV.CSTMS_PCK_TP_CD, BD.PCK_TP_CD)			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="v_pol" type="12" value="" out="N"/>
				<param name="v_pod" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
