<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLDocumentationCMDBDAOAddBkgBlDocCSQL">
			<desc><![CDATA[BKG_BL_DOC 저장]]></desc>
			<sql><![CDATA[
INSERT INTO bkg_bl_doc
        (bkg_no
		, act_wgt
		, act_wgt_prn_flg
		, wgt_ut_cd
        , MEAS_QTY
        , MEAS_UT_CD
        , bl_mv_tp_NM
        , vsl_nm
        , pre_vsl_nm
        , por_cd
        , por_nm
        , pol_cd
        , pol_nm
        , pod_cd
        , pod_nm
        , del_cd
        , del_nm
        , fnl_dest_nm
        , cre_usr_id
        , cre_dt
        , upd_usr_id
        , upd_dt)
select bk.bkg_no
		, @[act_wgt]
		, 'Y'
		, @[wgt_ut_cd]
        , 0
        , NVL((SELECT MEAS_UT_CD FROM BKG_USR_DFLT_SET WHERE USR_ID = @[cre_usr_id]),'CBM') AS MEAS_UT_CD
		, DECODE(BK.RCV_TERM_CD||BK.DE_TERM_CD,'YY',1 ,'YD',1 ,'YS',3 ,'YT',10,'YO',11,'YM',2 
										      ,'DY',1 ,'DD',1 ,'DS',3 ,'DT',10,'DO',11,'DM',2 
											  ,'SY',7 ,'SD',7 ,'SS',9 ,'ST',14,'SO',15,'SM',8 
										      ,'TY',16,'TD',16,'TS',18,'TT',19,'TO',20,'TM',17
											  ,'IY',21,'ID',21,'IS',23,'IT',24,'IO',25,'IM',22
											  ,'MY',4 ,'MD',4 ,'MS',6 ,'MT',12,'MO',13,'MM',5 )
        , (SELECT VSL_ENG_NM||' '||VSK.OB_CSSM_VOY_NO 
           FROM MDM_VSL_CNTR MDM, VSK_VSL_PORT_SKD VSK, BKG_VVD VVD
           WHERE 1=1
             AND BK.BKG_NO = VVD.BKG_NO
             AND VVD.VSL_PRE_PST_CD ='T'
             AND VVD.VSL_CD = VSK.VSL_CD
             AND VVD.SKD_VOY_NO = VSK.SKD_VOY_NO
             AND VVD.SKD_DIR_CD = VSK.SKD_DIR_CD
             AND VVD.POL_CD = VSK.VPS_PORT_CD
             AND VVD.POL_YD_CD = VSK.YD_CD
             AND VVD.VSL_CD = MDM.VSL_CD
             AND ROWNUM =1
           ) AS VSL_NM
		, (select vsl_eng_nm||' '||VSK.OB_CSSM_VOY_NO 
		     from mdm_vsl_cntr vsl, bkg_vvd vvd, VSK_VSL_PORT_SKD VSK 
		    where vsl.vsl_cd         = vvd.vsl_cd
		      and vvd.vsl_pre_pst_cd = 'S'
		      and vvd.vsl_seq        = '1'
		      and vvd.bkg_no         = bk.bkg_no
			  AND VVD.VSL_CD = VSK.VSL_CD
              AND VVD.SKD_VOY_NO = VSK.SKD_VOY_NO
              AND VVD.SKD_DIR_CD = VSK.SKD_DIR_CD
              AND VVD.POL_CD = VSK.VPS_PORT_CD
              AND VVD.POL_YD_CD = VSK.YD_CD
              AND ROWNUM =1 
			) pre_vsl_nm      
		, bk.por_cd
		, SUBSTR((select LOC_NM from mdm_location where loc_cd = bk.por_cd),0,25) por_nm
		, bk.pol_cd
		, SUBSTR((select LOC_NM from mdm_location where loc_cd = bk.pol_cd),0,25) pol_nm
		, bk.pod_cd
		, SUBSTR((select LOC_NM from mdm_location where loc_cd = bk.pod_cd),0,25) pod_nm
		, bk.del_cd
		, SUBSTR(decode(bk.rcv_term_cd, 'Y', nvl(del_nm.attr_ctnt2, del.loc_nm), del.loc_nm),0,25) del_nm
-- NEW DELHI set 추가 Y term인 경우에 한해서	
--		, decode(bk.rcv_term_cd, 'Y', decode(NVL(bk.del_nod_cd, ' '), 
--										'INDELY1', 'ICD TUGHLAKABAD,NEW DELHI',
--										'INDELY2', 'ICD PATPARGANJ, NEW DELHI',
--		  								(select LOC_NM from mdm_location where loc_cd = bk.del_cd)),
--									(select LOC_NM from mdm_location where loc_cd = bk.del_cd))
		, nvl(@[fnl_dest_nm],
          (select final_nm.attr_ctnt2
		     from bkg_hrd_cdg_ctnt final_nm
		    where bk.pod_cd         = final_nm.attr_ctnt1(+)
		      and 'BL_FINAL_NAME'   = final_nm.hrd_cdg_id(+))) final_nm
		, @[cre_usr_id]
		, sysdate
		, @[upd_usr_id]
		, sysdate
  from bkg_booking bk
		, mdm_location del
		, bkg_hrd_cdg_ctnt del_nm
 where bk.bkg_no        = @[bkg_no]
   and bk.del_cd        = del.loc_cd	
   and bk.del_cd||SUBSTR(bk.del_nod_cd, 6, 2) = del_nm.attr_ctnt1(+)
   and 'BL_DEL_NAME'            = del_nm.hrd_cdg_id(+)			]]></sql>
			<params>
				<param name="act_wgt" type="12" value="" out="N"/>
				<param name="wgt_ut_cd" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="fnl_dest_nm" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
