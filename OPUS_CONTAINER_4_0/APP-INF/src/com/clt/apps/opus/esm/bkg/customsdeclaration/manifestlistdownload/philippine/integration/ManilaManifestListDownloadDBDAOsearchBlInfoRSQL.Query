<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ManilaManifestListDownloadDBDAOsearchBlInfoRSQL">
			<desc><![CDATA[]]></desc>
			<sql><![CDATA[
SELECT REG_NUMBER2,
       YEAR,
       BL_NO,
       CARGO_TYPE,
       CARGO_TYPE AS ETL_CARGO_TYPE,
       SHIPPER_NAME1,
       SHIPPER_NAME2,
       SHIPPER_ADDRESS1,
       SHIPPER_ADDRESS2,
       SHIPPER_ADDRESS3,
       SHIPPER_ADDRESS4,
       CONSIGNEE_NAME1,
       CONSIGNEE_NAME2,
       CONSIGNEE_ADDRESS1,
       CONSIGNEE_ADDRESS2,
       CONSIGNEE_ADDRESS3,
       CONSIGNEE_ADDRESS4,
       NOTIFY_NAME1,
       NOTIFY_NAME2,
       NOTIFY_ADDRESS1,
       NOTIFY_ADDRESS2,
       NOTIFY_ADDRESS3,
       NOTIFY_ADDRESS4,
       WEIGHT,
       VOLUME,
       COUNTRY_ORIGIN,
       POD,
       TOTAL_CNTR,
       ROWNUM AS SEQ


  FROM (

        SELECT @[reg_no] AS REG_NUMBER2,
               TO_NUMBER(TO_CHAR(SYSDATE, 'RR')) AS YEAR,
               COM_CONSTANTMGR_PKG.COM_GETSCACCODE_FNC()||NVL(BKG.BL_NO, ' ') AS BL_NO,
               CASE
                  WHEN BKG.BKG_CGO_TP_CD IN ('P', 'R') THEN 'EMT' --EMT
                  WHEN BKG.BB_CGO_FLG = 'Y' THEN 'BULK'
                  WHEN NVL(BKG.RCV_TERM_CD, 'Y') = 'S' THEN 'LCL' --PARTIAL
                  ELSE 'FCL'
               END AS CARGO_TYPE,
--             NVL(TO_NUMBER(DECODE(NVL(BKG.BKG_CGO_TP_CD, 'F'), 'F', '1', 'B', '3', DECODE(NVL(BKG.RCV_TERM_CD, 'Y'), 'S', '2', '0'))), 0) AS CARGO_TYPE,
               NVL(SUBSTR(REPLACE(SHP.CUST_NM, CHR(10), '  '), 1, 35), ' ') AS SHIPPER_NAME1,
               NVL(SUBSTR(REPLACE(SHP.CUST_NM, CHR(10), '  '), 36, 35), ' ') AS SHIPPER_NAME2,
               NVL(SUBSTR(REPLACE(SHP.CUST_ADDR, CHR(10), '  '), 1, 35), ' ') AS SHIPPER_ADDRESS1,
               NVL(SUBSTR(REPLACE(SHP.CUST_ADDR, CHR(10), '  '), 36, 35), ' ') AS SHIPPER_ADDRESS2,
               NVL(SUBSTR(REPLACE(SHP.CUST_ADDR, CHR(10), '  '), 71, 35), ' ') AS SHIPPER_ADDRESS3,
               NVL(SUBSTR(REPLACE(SHP.CUST_ADDR, CHR(10), '  '), 106, 36), ' ') AS SHIPPER_ADDRESS4,
               NVL(SUBSTR(REPLACE(CSN.CUST_NM, CHR(10), '  '), 1, 35), ' ') AS CONSIGNEE_NAME1,
               NVL(SUBSTR(REPLACE(CSN.CUST_NM, CHR(10), '  '), 36, 35), ' ') AS CONSIGNEE_NAME2,
               NVL(SUBSTR(REPLACE(CSN.CUST_ADDR, CHR(10), '  '), 1, 35), ' ') AS CONSIGNEE_ADDRESS1,
               NVL(SUBSTR(REPLACE(CSN.CUST_ADDR, CHR(10), '  '), 36, 35), ' ') AS CONSIGNEE_ADDRESS2,
               NVL(SUBSTR(REPLACE(CSN.CUST_ADDR, CHR(10), '  '), 71, 35), ' ') AS CONSIGNEE_ADDRESS3,
               NVL(SUBSTR(REPLACE(CSN.CUST_ADDR, CHR(10), '  '), 106, 35), ' ') AS CONSIGNEE_ADDRESS4,
               NVL(SUBSTR(REPLACE(NTF.CUST_NM, CHR(10), '  '), 1, 35), ' ') AS NOTIFY_NAME1,
               NVL(SUBSTR(REPLACE(NTF.CUST_NM, CHR(10), '  '), 36, 35), ' ') AS NOTIFY_NAME2,
               NVL(SUBSTR(REPLACE(NTF.CUST_ADDR, CHR(10), '  '), 1, 35), ' ') AS NOTIFY_ADDRESS1,
               NVL(SUBSTR(REPLACE(NTF.CUST_ADDR, CHR(10), '  '), 36, 35), ' ') AS NOTIFY_ADDRESS2,
               NVL(SUBSTR(REPLACE(NTF.CUST_ADDR, CHR(10), '  '), 71, 35), ' ') AS NOTIFY_ADDRESS3,
               NVL(SUBSTR(REPLACE(NTF.CUST_ADDR, CHR(10), '  '), 106, 35), ' ') AS NOTIFY_ADDRESS4,
               ROUND(NVL(DECODE(NVL(DOC.WGT_UT_CD, 'KGS'), 'KGS', NVL(DOC.ACT_WGT, 0), 'LBS', NVL(DOC.ACT_WGT, 0)*0.45359), 0), 2) AS WEIGHT,
               ROUND(NVL(TO_CHAR(DECODE(NVL(DOC.MEAS_UT_CD, 'CBM'), 'CBM', NVL(DOC.MEAS_QTY, 0), 'CBF', NVL(DOC.MEAS_QTY, 0)*0.02831)), 0), 3) AS VOLUME,
               (SELECT MDM.UN_LOC_CD
                  FROM MDM_LOCATION MDM
                 WHERE MDM.LOC_CD = BKG.POR_CD) AS COUNTRY_ORIGIN,
               (SELECT MDM.UN_LOC_CD
                  FROM MDM_LOCATION MDM
                 WHERE MDM.LOC_CD = BKG.POD_CD) AS POD,
               (SELECT COUNT(CNTR_NO)
                  FROM BKG_CONTAINER
                 WHERE BKG_CONTAINER.BKG_NO = NVL(BKG.BKG_NO, ' ')) AS TOTAL_CNTR

          FROM BKG_CUSTOMER SHP,
               BKG_CUSTOMER CSN,
               BKG_CUSTOMER NTF,
               BKG_BOOKING BKG,
               BKG_VVD BV,
               BKG_BL_DOC DOC

         WHERE SHP.BKG_NO(+) = BKG.BKG_NO
           AND SHP.BKG_CUST_TP_CD = 'S'
           AND CSN.BKG_NO(+) = BKG.BKG_NO
           AND CSN.BKG_CUST_TP_CD = 'C'
           AND NTF.BKG_NO(+) = BKG.BKG_NO
           AND NTF.BKG_CUST_TP_CD = 'N'
           AND BKG.BKG_NO = BV.BKG_NO
           AND BKG.BKG_NO = DOC.BKG_NO
           AND BV.VSL_CD = @[vsl_cd]
           AND BV.SKD_VOY_NO = @[skd_voy_no]
           AND BV.SKD_DIR_CD = @[skd_dir_cd] 
#if (${pol_cd} != '')
           AND BV.POL_CD LIKE @[pol_cd] 
#end #if (${pod_cd} != '')
           AND BV.POD_CD LIKE @[pod_cd] 
#end
           AND BKG.BKG_STS_CD IN ('F', 'W')
           AND BKG.BL_NO > ' '
       )
			]]></sql>
			<params>
				<param name="reg_no" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
