<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="StatusReportDBDAOSearchVgmEdiSupMltRSQL">
			<desc><![CDATA[Search VGM EDI SUP for MULTI]]></desc>
			<sql><![CDATA[
SELECT DISTINCT NTC_KND_NM,
                NTC_KND_CD,
                EDI_SND_ID,
                EDI_RECEIVE_ID,
                REF_CODE,
			    ORD
FROM ( SELECT 'VERMAS (A) - CY' NTC_KND_NM,
              'VC' NTC_KND_CD ,
              EY.SNDR_TRD_PRNR_ID AS EDI_SND_ID,
              EY.RCVR_TRD_PRNR_ID AS EDI_RECEIVE_ID,
              EY.PRNR_SUB_LNK_CD AS REF_CODE,
			  1 ORD
         FROM BKG_EDI_TRD_PRNR_SUB_LNK EY,
              BKG_EDI_SUB_LNK_MSG MSG,
              BKG_BOOKING BB
        WHERE BB.BKG_NO IN (${bkg_nos})
          AND EY.TRD_PRNR_SUB_LNK_SEQ = MSG.TRD_PRNR_SUB_LNK_SEQ
          AND EY.PRNR_SUB_LNK_DIV_CD = '1'
          AND MSG.EDI_MSG_TP_ID = 'VGM'
          AND MSG.MSG_TP_DESC = '1'
		  AND MSG.EDI_MSG_IND_CD = 31
          AND (EY.PRNR_SUB_LNK_CD = BB.POR_NOD_CD
              OR EY.PRNR_SUB_LNK_CD = BB.FULL_RTN_YD_CD
              OR EY.PRNR_SUB_LNK_CD = BB.MTY_RTN_YD_CD )
       UNION ALL
       SELECT 'VERMAS (A) - POL' NTC_KND_NM,
              'VP' NTC_KND_CD ,
              EY.SNDR_TRD_PRNR_ID AS EDI_SND_ID,
              EY.RCVR_TRD_PRNR_ID AS EDI_RECEIVE_ID,
              EY.PRNR_SUB_LNK_CD AS REF_CODE,
			  2 ORD
         FROM BKG_EDI_TRD_PRNR_SUB_LNK EY,
              BKG_EDI_SUB_LNK_MSG MSG,
              BKG_BOOKING BB
        WHERE BB.BKG_NO IN (${bkg_nos})
          AND EY.TRD_PRNR_SUB_LNK_SEQ = MSG.TRD_PRNR_SUB_LNK_SEQ
          AND EY.PRNR_SUB_LNK_DIV_CD = '1'
          AND MSG.EDI_MSG_TP_ID = 'VGM'
          AND MSG.MSG_TP_DESC = '1'
		  AND MSG.EDI_MSG_IND_CD = 32
          AND EY.PRNR_SUB_LNK_CD = BB.POL_NOD_CD
       UNION ALL
       SELECT 'VERMAS (A) - T/S' NTC_KND_NM,
              'VT' NTC_KND_CD ,
              EY.SNDR_TRD_PRNR_ID AS EDI_SND_ID,
              EY.RCVR_TRD_PRNR_ID AS EDI_RECEIVE_ID,
              EY.PRNR_SUB_LNK_CD AS REF_CODE,
			  3 ORD
         FROM BKG_EDI_TRD_PRNR_SUB_LNK EY,
              BKG_EDI_SUB_LNK_MSG MSG,
              BKG_BOOKING BB
        WHERE BB.BKG_NO IN (${bkg_nos})
          AND EY.TRD_PRNR_SUB_LNK_SEQ = MSG.TRD_PRNR_SUB_LNK_SEQ
          AND EY.PRNR_SUB_LNK_DIV_CD = '1'
          AND MSG.EDI_MSG_TP_ID = 'VGM'
          AND MSG.MSG_TP_DESC = '1'
		  AND MSG.EDI_MSG_IND_CD = 33
          AND EXISTS (SELECT 'Y' FROM BKG_VVD WHERE BB.BKG_NO = BKG_NO AND EY.PRNR_SUB_LNK_CD = POL_YD_CD AND BB.POL_NOD_CD <> POL_YD_CD)
       UNION ALL
       SELECT 'VERMAS (M)' NTC_KND_NM,
              'VM' NTC_KND_CD ,
              EY.SNDR_TRD_PRNR_ID AS EDI_SND_ID,
              EY.RCVR_TRD_PRNR_ID AS EDI_RECEIVE_ID,
              EY.PRNR_SUB_LNK_CD AS REF_CODE,
			  6 ORD
         FROM BKG_EDI_TRD_PRNR_SUB_LNK EY,
              BKG_EDI_SUB_LNK_MSG MSG,
              BKG_BOOKING BB
        WHERE BB.BKG_NO IN (${bkg_nos})
          AND EY.TRD_PRNR_SUB_LNK_SEQ = MSG.TRD_PRNR_SUB_LNK_SEQ
          AND EY.PRNR_SUB_LNK_DIV_CD = '1'
          AND MSG.EDI_MSG_TP_ID = 'VGM'
          AND MSG.MSG_TP_DESC = '1'
		  AND MSG.EDI_MSG_IND_CD = 34
       UNION ALL
       SELECT '301 (A) - CY' NTC_KND_NM,
              '3C' NTC_KND_CD ,
              EY.SNDR_TRD_PRNR_ID AS EDI_SND_ID,
              EY.RCVR_TRD_PRNR_ID AS EDI_RECEIVE_ID,
              EY.PRNR_SUB_LNK_CD AS REF_CODE,
			  4 ORD
         FROM BKG_EDI_TRD_PRNR_SUB_LNK EY,
              BKG_EDI_SUB_LNK_MSG MSG,
              BKG_BOOKING BB
        WHERE BB.BKG_NO IN (${bkg_nos})
          AND EY.TRD_PRNR_SUB_LNK_SEQ = MSG.TRD_PRNR_SUB_LNK_SEQ
          AND EY.PRNR_SUB_LNK_DIV_CD = '1'
          AND MSG.EDI_MSG_TP_ID = 'VGM'
          AND MSG.MSG_TP_DESC = '1'
		  AND MSG.EDI_MSG_IND_CD = 35
          AND (EY.PRNR_SUB_LNK_CD = BB.POR_NOD_CD
              OR EY.PRNR_SUB_LNK_CD = BB.FULL_RTN_YD_CD
              OR EY.PRNR_SUB_LNK_CD = BB.MTY_RTN_YD_CD )
       UNION ALL
       SELECT '301 (A) - POL' NTC_KND_NM,
              '3P' NTC_KND_CD ,
              EY.SNDR_TRD_PRNR_ID AS EDI_SND_ID,
              EY.RCVR_TRD_PRNR_ID AS EDI_RECEIVE_ID,
              EY.PRNR_SUB_LNK_CD AS REF_CODE,
			  5 ORD
         FROM BKG_EDI_TRD_PRNR_SUB_LNK EY,
              BKG_EDI_SUB_LNK_MSG MSG,
              BKG_BOOKING BB
        WHERE BB.BKG_NO IN (${bkg_nos})
          AND EY.TRD_PRNR_SUB_LNK_SEQ = MSG.TRD_PRNR_SUB_LNK_SEQ
          AND EY.PRNR_SUB_LNK_DIV_CD = '1'
          AND MSG.EDI_MSG_TP_ID = 'VGM'
          AND MSG.MSG_TP_DESC = '1'
		  AND MSG.EDI_MSG_IND_CD = 36
          AND EY.PRNR_SUB_LNK_CD = BB.POL_NOD_CD
       UNION ALL
       SELECT '301 (M)' NTC_KND_NM,
              '3M' NTC_KND_CD ,
              EY.SNDR_TRD_PRNR_ID AS EDI_SND_ID,
              EY.RCVR_TRD_PRNR_ID AS EDI_RECEIVE_ID,
              EY.PRNR_SUB_LNK_CD AS REF_CODE,
			  7 ORD
         FROM BKG_EDI_TRD_PRNR_SUB_LNK EY,
              BKG_EDI_SUB_LNK_MSG MSG,
              BKG_BOOKING BB
        WHERE BB.BKG_NO IN (${bkg_nos})
          AND EY.TRD_PRNR_SUB_LNK_SEQ = MSG.TRD_PRNR_SUB_LNK_SEQ
          AND EY.PRNR_SUB_LNK_DIV_CD = '1'
          AND MSG.EDI_MSG_TP_ID = 'VGM'
          AND MSG.MSG_TP_DESC = '1'
		  AND MSG.EDI_MSG_IND_CD = 37
          )
WHERE 1=1
#if( ${in_yd_cd} != '')
   AND REF_CODE LIKE '%'||@[in_yd_cd]||'%'
#end
#if( ${in_rcvr_id} != '')
   AND EDI_RECEIVE_ID LIKE '%'||@[in_rcvr_id]||'%'
#end
#if( ${in_sndr_id} != '')
   AND EDI_SND_ID LIKE '%'||@[in_sndr_id]||'%'
#end
ORDER BY ORD			]]></sql>
			<params>
				<param name="in_yd_cd" type="12" value="" out="N"/>
				<param name="in_rcvr_id" type="12" value="" out="N"/>
				<param name="in_sndr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
