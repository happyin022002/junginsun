<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="StatusReportDBDAOcheckBkgForVgmClzRSQL">
			<desc><![CDATA[Check Booking for VGM CLZ]]></desc>
			<sql><![CDATA[
SELECT CASE WHEN CNTR_CNT = COP_CNT THEN 'Y'
            ELSE 'N' 
            END VGM_CLZ_YN
FROM 
(SELECT COUNT(1) CNTR_CNT
   FROM BKG_CONTAINER BC
  WHERE BC.BKG_NO = @[bkg_no]
    AND EXISTS (SELECT 'Y' 
                  FROM BKG_XTER_VGM VGM
                 WHERE BC.BKG_NO = VGM.BKG_NO
                   AND BC.CNTR_NO = VGM.CNTR_NO
                   AND VGM.VGM_CRE_GDT = (SELECT MAX(VGM_CRE_GDT)
                                            FROM BKG_XTER_VGM
                                           WHERE BKG_NO = VGM.BKG_NO
                                             AND CNTR_NO = VGM.CNTR_NO
                                             AND ACT_TP_CD = 'I')
                   AND VGM.VGM_WGT IS NOT NULL
                UNION ALL
                SELECT 'Y'
                  FROM BKG_XTER_VGM_REF_NO REFNO
                 WHERE BC.BKG_NO = REFNO.REF_NO
                   AND BC.CNTR_NO = REFNO.CNTR_NO
                   AND NVL(REFNO.XTER_REF_SEQ, 0) = NVL((SELECT MAX(XTER_REF_SEQ)
                                                           FROM BKG_XTER_VGM_REF_NO
                                                          WHERE REFNO.XTER_SNDR_ID = XTER_SNDR_ID
                                                            AND REFNO.XTER_VGM_DOC_ID = XTER_VGM_DOC_ID
                                                            AND REFNO.XTER_VGM_RQST_SEQ = XTER_VGM_RQST_SEQ
                                                            AND REFNO.CNTR_NO = CNTR_NO), 0)
                   AND EXISTS (SELECT 'Y'
                                 FROM BKG_XTER_VGM_RQST
                                WHERE REFNO.XTER_SNDR_ID = XTER_SNDR_ID
                                  AND REFNO.XTER_VGM_DOC_ID = XTER_VGM_DOC_ID
                                  AND REFNO.XTER_VGM_RQST_SEQ = XTER_VGM_RQST_SEQ
                                  AND REFNO.CNTR_NO = CNTR_NO
                                  AND VGM_WGT IS NOT NULL)
                   )) CNTR_CNT,
(SELECT COUNT(1) COP_CNT
   FROM SCE_COP_HDR
  WHERE BKG_NO = @[bkg_no]
    AND COP_STS_CD <> 'X') COP_CNT			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
