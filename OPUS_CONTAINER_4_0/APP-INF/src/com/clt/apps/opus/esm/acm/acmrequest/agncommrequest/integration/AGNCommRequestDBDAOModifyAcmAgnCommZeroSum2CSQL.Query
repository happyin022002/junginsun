<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AGNCommRequestDBDAOModifyAcmAgnCommZeroSum2CSQL">
			<desc><![CDATA[ACM_AGN_COMM 테이블에서 Agreement 대상이 아닌 데이터를 업데이트한다.]]></desc>
			<sql><![CDATA[
INSERT INTO ACM_AGN_COMM
(
  BKG_NO
, AGN_CD
, IO_BND_CD
, AC_TP_CD
, AC_SEQ
, BDR_FLG
, AC_STS_CD
, PPD_AMT
, CRNT_AMT
, IF_AMT
, CRNT_REV_AMT
, DDCT_CHG_AMT
, DDCT_TRSP_AMT
, DDCT_SPCL_CMPN_AMT
, COMM_FX_AMT
, REV_DIV_CD
, COMM_RT
, AGN_AGMT_NO
, AGN_AGMT_SEQ
, LOC_DIV_CD
, LOC_CD
, AR_OFC_CD
, AP_OFC_CD
, AP_CTR_CD
, COMM_STND_COST_CD
, SAIL_ARR_DT
, AC_OCCR_INFO_CD
, AC_SLAN_CD
, AC_RLANE_CD
, AC_VSL_CD
, AC_SKD_VOY_NO
, AC_SKD_DIR_CD
, AC_REV_DIR_CD
, CURR_CD
, XCH_RT_APLY_LVL
, PAY_XCH_RT
, PAY_PPD_AMT
, PAY_CRNT_AMT
, PAY_IF_AMT
, OFC_CHR_CD
, VNDR_CNT_CD
, VNDR_SEQ
, ACCL_FLG
, AC_PROC_DESC
, PPD_OFRT_AMT
, PPD_CHG_AMT
, CLT_OFRT_AMT
, CLT_CHG_AMT
, AGN_INFO_SEQ
, CRE_USR_ID
, CRE_DT
, UPD_USR_ID
, UPD_DT
)
SELECT 
 CRNT.BKG_NO
,CRNT.AGN_CD
,CRNT.IO_BND_CD
,CRNT.AC_TP_CD
,NEXT_AC_SEQ    AS AC_SEQ
,CRNT.BDR_FLG
,'CS'           AS AC_STS_CD
,CANCEL_AMT     AS PPD_AMT
,0              AS CRNT_AMT
,0 - CANCEL_AMT AS IF_AMT
,CRNT.CRNT_REV_AMT
,CRNT.DDCT_CHG_AMT
,CRNT.DDCT_TRSP_AMT
,CRNT.DDCT_SPCL_CMPN_AMT
,CRNT.COMM_FX_AMT
,CRNT.REV_DIV_CD
,CRNT.COMM_RT
,CRNT.AGN_AGMT_NO
,CRNT.AGN_AGMT_SEQ
,CRNT.LOC_DIV_CD
,CRNT.LOC_CD
,CRNT.AR_OFC_CD
,CRNT.AP_OFC_CD
,CRNT.AP_CTR_CD
,CRNT.COMM_STND_COST_CD
,CRNT.SAIL_ARR_DT
,CRNT.AC_OCCR_INFO_CD
,CRNT.AC_SLAN_CD
,CRNT.AC_RLANE_CD
,CRNT.AC_VSL_CD
,CRNT.AC_SKD_VOY_NO
,CRNT.AC_SKD_DIR_CD
,CRNT.AC_REV_DIR_CD
,CRNT.CURR_CD
,CRNT.XCH_RT_APLY_LVL
,CRNT.PAY_XCH_RT
,CANCEL_PAY_AMT       AS PAY_PPD_AMT
,0                    AS PAY_CRNT_AMT
,0 - CANCEL_PAY_AMT   AS PAY_IF_AMT
,CRNT.OFC_CHR_CD
,CRNT.VNDR_CNT_CD
,CRNT.VNDR_SEQ
,CRNT.ACCL_FLG
,CRNT.AC_PROC_DESC
,CRNT.PPD_OFRT_AMT
,CRNT.PPD_CHG_AMT
,CRNT.CLT_OFRT_AMT
,CRNT.CLT_CHG_AMT
,CRNT.AGN_INFO_SEQ
,@[usr_id] AS CRE_USR_ID
,SYSDATE AS CRE_DT
,@[usr_id] AS UPD_USR_ID
,SYSDATE AS UPD_DT
FROM ACM_AGN_COMM CRNT,(
    SELECT
        BKG_NO,AGN_CD,IO_BND_CD,AC_TP_CD,
        NVL (MAX (C.AC_SEQ), 0) + 1  AS NEXT_AC_SEQ ,
        SUM (C.IF_AMT) AS CANCEL_AMT, SUM (C.PAY_IF_AMT) AS CANCEL_PAY_AMT
    FROM ACM_AGN_COMM C
    WHERE C.BKG_NO = @[bkg_no]
	  AND C.AGN_CD = @[agn_cd]
	  AND C.IO_BND_CD = @[io_bnd_cd]
	  AND C.AC_TP_CD = @[ac_tp_cd]
      AND C.AC_STS_CD IN ( 'RS','AS','PS','IF' ) 
    GROUP BY C.BKG_NO, C.AGN_CD, C.IO_BND_CD, C.AC_TP_CD 
    HAVING 0 <> SUM (C.IF_AMT) 
)PPD
WHERE 1=1
AND CRNT.BKG_NO    = PPD.BKG_NO 
AND CRNT.AGN_CD    = PPD.AGN_CD 
AND CRNT.IO_BND_CD = PPD.IO_BND_CD 
AND CRNT.AC_TP_CD  = PPD.AC_TP_CD 
AND CRNT.AC_SEQ    = PPD.NEXT_AC_SEQ - 1 
AND CRNT.AC_STS_CD IN ( 'RS','AS','PS','IF' )			]]></sql>
			<params>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="agn_cd" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="ac_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
