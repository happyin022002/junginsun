<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ACMReportDBDAOSearchReportListByCntrNoRSQL">
			<desc><![CDATA[SearchReportListByCntrNo]]></desc>
			<sql><![CDATA[
SELECT 
        CNTR_NO
        , CNTR_TPSZ_CD
        , A.BKG_NO
        , A.BKG_NO AS BL_NO
        , AGN_CD
        , IO_BND_CD
        , MAX (A.AC_VSL_CD||A.AC_SKD_VOY_NO||A.AC_SKD_DIR_CD) AS COMM_VVD
        , MAX (TO_CHAR (TO_DATE (SAIL_ARR_DT, 'YYYYMMDD'), 'YYYY-MM-DD')) AS SAIL_ARR_DT
        , INF.POR_CD AS POR_CD
        , INF.POL_CD AS POL_CD
        , INF.POD_CD AS POD_CD
        , INF.DEL_CD AS DEL_CD
        , NVL (SUM (DECODE (A.AC_TP_CD, 'H', A.IF_QTY_AMT, 0 )), 0) AS CHF_AMT
        , NVL (SUM (DECODE (A.AC_TP_CD, 'N', A.IF_QTY_AMT, 0 )), 0) AS CSF_AMT
        , NVL (SUM (DECODE (A.AC_TP_CD, 'R', A.IF_QTY_AMT, 0 )), 0) AS RCSF_AMT    
        , MAX (A.CURR_CD) AS CURR_CD
        , MAX (TO_CHAR (A.CRE_DT, 'YYYY-MM-DD')) AS CALC_DT
        , MAX (TO_CHAR (A.RQST_DT, 'YYYY-MM-DD')) AS RQST_DT
        , MAX (TO_CHAR (A.APRO_DT, 'YYYY-MM-DD')) AS APRO_DT
        , MAX (TO_CHAR (A.IF_DT, 'YYYY-MM-DD')) AS IF_DT 
        
         , (MAX (INF.FRT_FWRD_CNT_CD) || TO_CHAR (MAX (INF.FRT_FWRD_SEQ), 'FM000000')) AS FF_CD
         , MAX (
                 CASE 'BOMBB'
                 WHEN A.AR_OFC_CD THEN NVL ( (SELECT E.CUST_NM
                                  				FROM BKG_CUSTOMER E
                                 			   WHERE INF.BKG_NO = E.BKG_NO
                                   				 AND E.BKG_CUST_TP_CD = 'B' ) 
										   , (SELECT E.CUST_NM
                                  				FROM BKG_CUSTOMER E
                                 			   WHERE INF.BKG_NO = E.BKG_NO
                                   				 AND E.BKG_CUST_TP_CD = 'F' ) )
                  ELSE (SELECT NVL(D.CUST_LOCL_LANG_NM, D.CUST_LGL_ENG_NM)
                          FROM MDM_CUSTOMER D,
                               BKG_CUSTOMER E
                         WHERE E.CUST_CNT_CD = D.CUST_CNT_CD(+)
                           AND E.CUST_SEQ = D.CUST_SEQ(+)
                           AND INF.BKG_NO = E.BKG_NO(+)
                           AND E.BKG_CUST_TP_CD(+) = 'F' )
                                       END ) AS FF_NAME
         , MAX ( (SELECT E.CUST_ADDR
                    FROM BKG_CUSTOMER E
                   WHERE INF.BKG_NO = E.BKG_NO
                     AND E.BKG_CUST_TP_CD = 'F' ) ) AS FF_ADDR

         , MAX (INF.TRD_CD) AS TRD_CD
         , MAX (INF.RLANE_CD) AS RLANE_CD
         , MAX (A.AC_SKD_DIR_CD) AS DIR_CD
         , MAX (A.AUD_NO) AS AUD_NO
  
  FROM (
        SELECT
               CNTR_NO
             , AMT.*     
          FROM
                (SELECT BKG_NO
                     , CNTR_NO
                     , DECODE(SUBSTR(CNTR_TPSZ_CD,1,1), 'R', DECODE (RC_FLG, 'Y', CNTR_TPSZ_CD, SUBSTR(CNTR_TPSZ_CD,1,1)||'D'||SUBSTR(CNTR_TPSZ_CD,2,1)), CNTR_TPSZ_CD) AS CNTR_TPSZ_CD
                     , RC_FLG 
                  FROM BKG_CONTAINER
                 ) CNTR
                ,
                (SELECT CNTR_TPSZ_CD
                      , (IF_DTRB_AMT/BKG_VOL_QTY) AS IF_QTY_AMT
                      , AGN.* 
                   FROM ACM_AGN_COMM_DTL DTL
                       ,ACM_AGN_COMM  AGN
                  WHERE 1=1
                    AND AGN.BKG_NO = DTL.BKG_NO
                    AND AGN.AGN_CD = DTL.AGN_CD
                    AND AGN.IO_BND_CD = DTL.IO_BND_CD
                    AND AGN.AC_TP_CD = DTL.AC_TP_CD
                    AND AGN.AC_SEQ = DTL.AC_SEQ
                 UNION
                 SELECT CNTR_TPSZ_CD
                      , (IF_DTRB_AMT/BKG_VOL_QTY) AS IF_QTY_AMT
                      , AGN.* 
                   FROM ACM_AGN_COMM_DTL DTL
                       ,ACM_AGN_COMM  AGN
                  WHERE 1=1
                    AND AGN.BKG_NO = DTL.BKG_NO
                    AND AGN.AGN_CD = DTL.AGN_CD
                    AND AGN.IO_BND_CD = DTL.IO_BND_CD
                    AND AGN.AC_TP_CD = DTL.AC_TP_CD
                    AND AGN.AC_SEQ + 1000 = DTL.AC_SEQ
                  ) AMT
         WHERE 1=1
           AND AMT.BKG_NO = CNTR.BKG_NO
           AND AMT.CNTR_TPSZ_CD = CNTR.CNTR_TPSZ_CD
		) A
        , ACM_AGN_BKG_INFO INF
WHERE 1=1
  AND INF.BKG_NO = A.BKG_NO
#if (${agn_cd} != '')
                  AND A.AGN_CD             = @[agn_cd]
#end
#if (${ar_ofc_cd} != '')
                  AND A.AR_OFC_CD          = @[ar_ofc_cd]
#end
#if (${s_trd_cd} != '')
                  AND INF.TRD_CD             = @[s_trd_cd]
#end
#if (${s_rlane_cd} != '')
                  AND INF.RLANE_CD           = @[s_rlane_cd]
#end
#if (${s_dir_cd} != '')
                  AND A.AC_SKD_DIR_CD    = @[s_dir_cd]
#end
                  AND A.AC_TP_CD
                   IN
                    (
                      'H', 'N', 'R'
                    )
                  AND A.IO_BND_CD
                   IN
                    (
                 CASE @[io_bnd_cd]
                 WHEN 'O'
                 THEN 'O'
                 WHEN 'I'
                 THEN 'I'
                 ELSE A.IO_BND_CD
                  END
                    )
#if (${comm_vvd} != '')
                  AND A.AC_VSL_CD||A.AC_SKD_VOY_NO||A.AC_SKD_DIR_CD = @[comm_vvd]
#end
#if (${bkg_ofc_cd} != '')
                  AND INF.BKG_OFC_CD = @[bkg_ofc_cd]
#end
#if (${ob_sls_ofc_cd} != '')
                  AND (SELECT B.OB_SLS_OFC_CD FROM BKG_BOOKING B WHERE B.BKG_NO = A.BKG_NO) IN (@[ob_sls_ofc_cd])
#end
#if (${por_cd} != '')
                  AND INF.POR_CD = @[por_cd]
#end
#if (${pol_cd} != '')
                  AND INF.POL_CD = @[pol_cd]
#end
#if (${pod_cd} != '')
                  AND INF.POD_CD = @[pod_cd]
#end
#if (${del_cd} != '')
                  AND INF.DEL_CD = @[del_cd]
#end
#if (${bl_no} != '')
                  AND INF.BL_NO IN ( ${bl_no} )
#end
#if (${aud_no} != '')
                  AND A.AUD_NO = @[aud_no]
#end
#if (${sts_option} == 'CS')
                  AND A.AC_STS_CD
                   IN
                    (
                      'CS', 'CE', 'IC', 'CA'
                    )
                  AND A.CRE_DT
              BETWEEN TO_DATE (REPLACE(@[fm_dt],'-',''), 'YYYYMMDD')
                  AND TO_DATE (REPLACE(@[to_dt],'-',''), 'YYYYMMDD')+0.999999
#elseif (${sts_option} == 'RS')
                  AND A.AC_STS_CD IN ( 'RS','RM' )
                  AND A.RQST_DT
              BETWEEN TO_DATE (REPLACE(@[fm_dt],'-',''), 'YYYYMMDD')
                  AND TO_DATE (REPLACE(@[to_dt],'-',''), 'YYYYMMDD')+0.999999
#elseif (${sts_option} == 'AS')
                  AND A.AC_STS_CD IN ( 'AS' )
                  AND A.AUD_DT
              BETWEEN TO_DATE (REPLACE(@[fm_dt],'-',''), 'YYYYMMDD')
                  AND TO_DATE (REPLACE(@[to_dt],'-',''), 'YYYYMMDD')+0.999999
#elseif (${sts_option} == 'PS')
                  AND A.AC_STS_CD IN ( 'PS' )
                  AND A.APRO_DT
              BETWEEN TO_DATE (REPLACE(@[fm_dt],'-',''), 'YYYYMMDD')
                  AND TO_DATE (REPLACE(@[to_dt],'-',''), 'YYYYMMDD')+0.999999
#elseif (${sts_option} == 'IS')
                  AND A.AC_STS_CD IN ( 'IF' )
                  AND A.IF_DT
              BETWEEN TO_DATE (REPLACE(@[fm_dt],'-',''), 'YYYYMMDD')
                  AND TO_DATE (REPLACE(@[to_dt],'-',''), 'YYYYMMDD')+0.999999
#elseif (${sts_option} == 'RR')
                  AND A.AC_STS_CD IN ('RR', 'AR', 'PR', 'IC')
                  AND A.UPD_DT
              BETWEEN TO_DATE (REPLACE(@[fm_dt],'-',''), 'YYYYMMDD')
                  AND TO_DATE (REPLACE(@[to_dt],'-',''), 'YYYYMMDD')+0.999999
#else
                  AND A.CRE_DT
              BETWEEN TO_DATE (REPLACE(@[fm_dt],'-',''), 'YYYYMMDD')
                  AND TO_DATE (REPLACE(@[to_dt],'-',''), 'YYYYMMDD')+0.999999
#end       

GROUP BY CNTR_NO, CNTR_TPSZ_CD, A.BKG_NO, AGN_CD, IO_BND_CD
           , INF.POR_CD, INF.POL_CD, INF.POD_CD, INF.DEL_CD
ORDER BY A.BKG_NO			]]></sql>
			<params>
				<param name="agn_cd" type="12" value="" out="N"/>
				<param name="ar_ofc_cd" type="12" value="" out="N"/>
				<param name="s_trd_cd" type="12" value="" out="N"/>
				<param name="s_rlane_cd" type="12" value="" out="N"/>
				<param name="s_dir_cd" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="comm_vvd" type="12" value="" out="N"/>
				<param name="bkg_ofc_cd" type="12" value="" out="N"/>
				<param name="ob_sls_ofc_cd" type="12" value="" out="N"/>
				<param name="por_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
				<param name="aud_no" type="12" value="" out="N"/>
				<param name="fm_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
