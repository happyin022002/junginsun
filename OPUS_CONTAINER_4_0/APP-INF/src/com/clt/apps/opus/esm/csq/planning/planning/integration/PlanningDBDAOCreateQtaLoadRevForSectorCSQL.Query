<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PlanningDBDAOCreateQtaLoadRevForSectorCSQL">
			<desc><![CDATA[[QTA Set up for IAS Sector by Head Office] 의 데이터를 [생성]한다]]></desc>
			<sql><![CDATA[
INSERT INTO CSQ_SCTR_LOD_REV(BSE_TP_CD, BSE_YR, BSE_QTR_CD, OFC_VW_CD, RLANE_CD, DIR_CD, FNL_BSA_CAPA, PF_GRP_CD, RGN_OFC_CD, POL_CD, POD_CD, TRD_CD, SUB_TRD_CD, RHQ_CD, GID_LOD_QTY, GID_GRS_RPB_REV, LOD_QTY, GRS_RPB_REV, CRE_USR_ID, CRE_DT, UPD_USR_ID, UPD_DT )
SELECT C1.BSE_TP_CD
      ,C1.BSE_YR
      ,C1.BSE_QTR_CD
      ,C1.OFC_VW_CD
      ,C1.RLANE_CD
      ,C1.DIR_CD
      ,C3.BSA_CAPA
      ,C1.PF_GRP_CD
      ,C1.RGN_OFC_CD
      ,C1.POL_CD
      ,C1.POD_CD
      ,C1.TRD_CD
      ,C1.SUB_TRD_CD
      ,C1.RHQ_CD
      ,NVL(C2.LOD_QTY,0) AS LOD_QTY
      ,ROUND(DECODE(NVL(C2.LOD_QTY,0), 0, 0, C2.GRS_TTL_REV/C2.LOD_QTY)) AS GRS_RPB_REV
      ,NVL(C2.LOD_QTY,0) AS LOD_QTY
      ,ROUND(DECODE(NVL(C2.LOD_QTY,0), 0, 0, C2.GRS_TTL_REV/C2.LOD_QTY)) AS GRS_RPB_REV
      ,@[f_usr_id] AS CRE_USR_ID
      ,SYSDATE    AS CRE_DT
      ,@[f_usr_id] AS UPD_USR_ID
      ,SYSDATE    AS UPD_DT
  FROM CSQ_SCTR_LANE_OFC C1
      ,CSQ_SCTR_PERF_IF C2
      ,(
        SELECT DISTINCT
               B1.DIR_CD
              ,B1.RLANE_CD
              ,B1.BSA_CAPA
              ,B1.PF_GRP_CD
          FROM (
                SELECT A1.DIR_CD
                      ,A1.RLANE_CD
                      ,A1.FNL_BSA_CAPA
                      ,A1.PF_GRP_CD
                      ,MAX(A2.RANGE_BSA)+9 AS BSA_CAPA
                  FROM (
                        SELECT DISTINCT S1.RLANE_CD,S1.DIR_CD,S1.FNL_BSA_CAPA, S2.PF_GRP_CD
                          FROM CSQ_QTA_TGT_VVD S1
                              ,CSQ_SCTR_PF_GRP S2
                         WHERE 1=1
                           AND S1.BSE_TP_CD    = S2.BSE_TP_CD
                           AND S1.BSE_YR       = S2.BSE_YR
                           AND S1.BSE_QTR_CD   = S2.BSE_QTR_CD
                           AND S1.TRD_CD       = S2.TRD_CD
                           AND S1.RLANE_CD     = S2.RLANE_CD
                           AND S1.PF_SVC_TP_CD = S2.PF_SVC_TP_CD
                           AND S1.BSE_TP_CD    = @[f_bse_tp_cd]
                           AND S1.BSE_YR       = @[f_bse_yr]
                           AND S1.BSE_QTR_CD   = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])
                           AND S1.TRD_CD       = @[f_trd_cd]
                         ORDER BY DIR_CD, RLANE_CD,FNL_BSA_CAPA DESC
                       ) A1
                      ,(
                        SELECT DISTINCT RLANE_CD, DIR_CD, FNL_BSA_CAPA, FNL_BSA_CAPA - 9 AS RANGE_BSA
                          FROM CSQ_QTA_TGT_VVD
                         WHERE BSE_TP_CD  = @[f_bse_tp_cd]
                           AND BSE_YR     = @[f_bse_yr]
                           AND BSE_QTR_CD = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])
                           AND TRD_CD     = @[f_trd_cd]
                         ORDER BY DIR_CD, RLANE_CD, FNL_BSA_CAPA DESC
                       ) A2
                 WHERE 1=1
                   AND A1.DIR_CD        = A2.DIR_CD
                   AND A1.RLANE_CD      = A2.RLANE_CD
                   AND A1.FNL_BSA_CAPA >= A2.RANGE_BSA
                 GROUP BY A1.DIR_CD
                      ,A1.RLANE_CD
                      ,A1.FNL_BSA_CAPA
                      ,A1.PF_GRP_CD
                 ORDER BY A1.DIR_CD, A1.RLANE_CD,A1.FNL_BSA_CAPA DESC
               ) B1
       ) C3
 WHERE 1=1
   AND C1.BSE_TP_CD  = C2.BSE_TP_CD(+)
   AND C1.BSE_YR     = C2.BSE_YR(+)
   AND C1.BSE_QTR_CD = C2.BSE_QTR_CD(+)
   AND C1.OFC_VW_CD  = C2.OFC_VW_CD(+)
   AND C1.RLANE_CD   = C2.RLANE_CD(+)
   AND C1.DIR_CD     = C2.DIR_CD(+)
   AND C1.RGN_OFC_CD = C2.RGN_OFC_CD(+)
   AND C1.POL_CD     = C2.POL_CD(+)
   AND C1.POD_CD     = C2.POD_CD(+)
   AND C1.RLANE_CD   = C3.RLANE_CD
   AND C1.DIR_CD     = C3.DIR_CD
   AND C1.PF_GRP_CD  = C3.PF_GRP_CD
   AND C1.BSE_TP_CD  = @[f_bse_tp_cd]
   AND C1.BSE_YR     = @[f_bse_yr]
   AND C1.BSE_QTR_CD = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])			]]></sql>
			<params>
				<param name="f_usr_id" type="12" value="" out="N"/>
				<param name="f_bse_tp_cd" type="12" value="" out="N"/>
				<param name="f_bse_yr" type="12" value="" out="N"/>
				<param name="f_bse_qtr_cd" type="12" value="" out="N"/>
				<param name="f_trd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
