<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CsScreenDBDAOsearchBlInfoRSQL">
			<desc><![CDATA[고객 응대를 위한 조회 화면 BL 정보를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT VVD.VSL_CD || VVD.SKD_VOY_NO || VVD.SKD_DIR_CD                             AS ARRIVAL_VVD       -- VVD
       ,VSL.VSL_ENG_NM                                                            AS ARRIVAL_VVD_NM    -- Vessel Name
       ,(SELECT DECODE(COUNT(1), 1, 'Y', 'N')
          FROM BKG_CONTAINER CNTR
         WHERE CNTR.BKG_NO = BKG.BKG_NO
           AND CNTR.CNTR_PRT_FLG = 'Y'
           AND ROWNUM = 1)                                                        AS PARTIAL       -- Partial B/L 여부('Y','N')
       ,TO_CHAR(SKD.VPS_ETA_DT,'YYYY/MM/DD HH24:MI')                              AS VPS_ETA_DT    -- POD ETA
       ,TO_CHAR(ASKD.ACT_ARR_DT,'YYYY/MM/DD HH24:MI')                             AS VPS_ETB_DT    -- POD ATA
       ,VVD.SLAN_CD                                                               AS SLAN_CD       -- 마지막 VVD의 LANE
       ,BKG.RCV_TERM_CD                                                           AS RCV_TERM_CD   -- por에서 Receive Term
       ,BKG.DE_TERM_CD                                                            AS DE_TERM_CD    -- POD에서 Delivery Term
       ,BKG.POR_CD                                                                AS POR_CD           
       ,BKG.POL_CD                                                                AS POL_CD
       ,BKG.POD_CD                                                                AS POD_CD
       ,SUBSTR(BKG.POD_NOD_CD, 6, 2)                                              AS POD_YD_CD     
       ,POD.YD_NM                                                                AS POD_NM
       ,BKG.DEL_CD                                                                AS DEL_CD
       ,SUBSTR(BKG.DEL_NOD_CD, 6, 2)                                              AS DEL_YD_CD
       ,DECODE(SUBSTR(BKG.DEL_NOD_CD, 6, 1),'Z',ZNE.ZN_NM,DEL.YD_NM)              AS DEL_NM
       ,BKG.BKG_STS_CD                                                            AS BKG_STS_CD    -- 조회된 시점의 STS(W, A, F, X)
       ,DOC.BDR_FLG                                                               AS BDR_FLG
       ,DOC.CORR_USR_ID                                                           AS CORR_USR_ID
       ,(SELECT DECODE(COUNT(1), 1, 'Y', 'N')
          FROM BKG_CORRECTION CORR
         WHERE CORR.BKG_NO = BKG.BKG_NO
           AND ROWNUM = 1)                                                        AS CORR_USR_ID
       ,DOC.PCK_QTY                                                               AS PCK_QTY
       ,DOC.PCK_TP_CD                                                             AS PCK_TP_CD
       ,DOC.ACT_WGT                                                               AS ACT_WGT
       ,DOC.WGT_UT_CD                                                             AS WGT_UT_CD
       ,BKG.SC_NO                                                                 AS SC_NO
       ,BKG.RFA_NO                                                                AS RFA_NO
       ,DOC.CSTMS_DESC                                                            AS CSTMS_DESC     
       ,CASE WHEN  BKG.BL_TP_CD     ='W' 
                OR ISS.OBL_SRND_FLG ='Y'           
                OR ISS.OBL_RDEM_FLG ='Y' THEN 'Y'
             ELSE 'N' END                                                         AS OBL_RDEM_FLG             
       ,NVL(CGO.OBL_RDEM_FLG,'N')                                                 AS US_OBL_RDEM_FLG      
       , CASE WHEN  SUBSTR(BKG.POD_CD,1,2) = 'US' OR SUBSTR(BKG.POD_CD,1,2) = 'CA'
              THEN TO_CHAR(CGO.OBL_RDEM_LST_DT,'YYYY-MM-DD HH24:MI') 
              ELSE TO_CHAR(DECODE( BKG.BL_TP_CD,'W',ISS.OBL_ISS_DT
                                         ,ISS.OBL_RDEM_DT ),'YYYY-MM-DD HH24:MI') 
              END AS OBL_RDEM_DT       
       ,DECODE(BKG.BL_TP_CD,'W',ISS.OBL_ISS_OFC_CD,ISS.OBL_RDEM_OFC_CD )          AS OBL_RDEM_OFC_CD     
       ,SHP.CUST_CNT_CD || DECODE(SHP.CUST_SEQ,'0','',SHP.CUST_SEQ)               AS SHP_CUST_CD
       ,SHP.CUST_NM                                                               AS SHP_CUST_NM
       ,CSG.CUST_CNT_CD || DECODE(CSG.CUST_SEQ,'0','',CSG.CUST_SEQ)               AS CSG_CUST_CD
       ,CSG.CUST_NM                                                               AS CSG_CUST_NM
       ,NOY.CUST_CNT_CD || DECODE(NOY.CUST_SEQ,'0','',NOY.CUST_SEQ)               AS NOY_CUST_CD
       ,NOY.CUST_NM                                            AS NOY_CUST_NM
       ,AOY.CUST_CNT_CD || DECODE(AOY.CUST_SEQ,'0','',AOY.CUST_SEQ)               AS AOY_CUST_CD
       ,AOY.CUST_NM                                                               AS AOY_CUST_NM
       ,BKG.BL_NO                                                                 AS BL_NO
       ,BKG.BKG_NO                                                                AS BKG_NO
       --,DECODE(BKG.BKG_CRE_TP_CD,'S','Y',DECODE( NVL(BKG.FM_BKG_NO,'N'),'N','N','Y')) AS SPLIT_FLG
       ,CASE WHEN (BKG.BKG_CRE_TP_CD = 'S' AND RTRIM(BKG.FM_BKG_NO) > ' ') THEN 'Y' ELSE 'N' END AS SPLIT_FLG
       ,BKG.BKG_CRE_DT                                                            AS BKG_CRE_DT
       ,BKG.BKG_OFC_CD                                                            AS BKG_OFC_CD
       ,DECODE(ISS.OBL_SRND_FLG,'Y','S', BKG.BL_TP_CD)                            AS BL_TP_CD
       ,DECODE(BKG.BB_CGO_FLG, 'Y', 'M','R','F', BKG.BKG_CGO_TP_CD)               AS BKG_CGO_TP_CD
       ,BKG.BB_CGO_FLG                                                            AS BB_CGO_FLG 
       ,(SELECT DECODE(COUNT(1), 1, 'Y', 'N')
          FROM BKG_USA_CUST_SVC_INSTR SVC_INSTR
         WHERE SVC_INSTR.BKG_NO = BKG.BKG_NO
           AND SVC_INSTR.DELT_FLG = 'N'
           AND ROWNUM = 1)                                                        AS INSTRUCTION       -- Instruction 존재 여부('Y','N')
  FROM BKG_BOOKING               BKG 
       JOIN BKG_VVD              VVD
       ON ( VVD.BKG_NO             = BKG.BKG_NO         
            AND VVD.POD_CD         = BKG.POD_CD         
            AND VVD.VSL_PRE_PST_CD IN ( 'T','U' )
       )
       LEFT OUTER JOIN VSK_VSL_PORT_SKD SKD
       ON ( SKD.VSL_CD           =  VVD.VSL_CD          
            AND SKD.SKD_VOY_NO   = VVD.SKD_VOY_NO      
            AND SKD.SKD_DIR_CD   = VVD.SKD_DIR_CD      
            AND SKD.VPS_PORT_CD  = VVD.POD_CD            
            AND SKD.CLPT_IND_SEQ = VVD.POD_CLPT_IND_SEQ 
       )
       LEFT OUTER JOIN VSK_ACT_PORT_SKD ASKD
         ON ( ASKD.VSL_CD          =  VVD.VSL_CD          
            AND ASKD.SKD_VOY_NO   = VVD.SKD_VOY_NO      
            AND ASKD.SKD_DIR_CD   = VVD.SKD_DIR_CD      
            AND ASKD.VPS_PORT_CD  = VVD.POD_CD            
            AND ASKD.CLPT_IND_SEQ = VVD.POD_CLPT_IND_SEQ 
       )         
       LEFT OUTER JOIN  MDM_VSL_CNTR VSL
       ON ( VVD.VSL_CD = VSL.VSL_CD )
       
       JOIN BKG_BL_DOC DOC
       ON ( DOC.BKG_NO  = BKG.BKG_NO )
       
       LEFT OUTER JOIN MDM_YARD POD
       ON ( POD.YD_CD = BKG.POD_NOD_CD )
       
       LEFT OUTER JOIN MDM_YARD DEL
       ON ( DEL.YD_CD = BKG.DEL_NOD_CD  )

       LEFT OUTER JOIN MDM_ZONE ZNE
       ON ( ZNE.ZN_CD = BKG.DEL_NOD_CD  )
       
       LEFT OUTER JOIN BKG_BL_ISS ISS
       ON ( ISS.BKG_NO = BKG.BKG_NO )
       
       LEFT OUTER JOIN BKG_CUSTOMER SHP
       ON ( SHP.BKG_NO = BKG.BKG_NO 
       AND SHP.BKG_CUST_TP_CD = 'S' )
       
       LEFT OUTER JOIN BKG_CUSTOMER CSG
       ON ( CSG.BKG_NO = BKG.BKG_NO 
            AND CSG.BKG_CUST_TP_CD = 'C')
       
       LEFT OUTER JOIN BKG_CUSTOMER NOY
       ON ( NOY.BKG_NO = BKG.BKG_NO 
            AND NOY.BKG_CUST_TP_CD = 'N')
       
       LEFT OUTER JOIN BKG_CUSTOMER  AOY
       ON ( AOY.BKG_NO  = BKG.BKG_NO
            AND AOY.BKG_CUST_TP_CD = 'A' )
       LEFT OUTER JOIN BKG_CGO_RLSE CGO
       ON ( CGO.BL_NO   = BKG.BL_NO)
 WHERE BKG.BKG_NO =  @[bkg_no]			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
