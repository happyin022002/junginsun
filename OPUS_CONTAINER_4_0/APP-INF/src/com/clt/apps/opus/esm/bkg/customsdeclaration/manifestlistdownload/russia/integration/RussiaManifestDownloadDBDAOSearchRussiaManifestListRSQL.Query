<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RussiaManifestDownloadDBDAOSearchRussiaManifestListRSQL">
			<desc><![CDATA[SearchRussiaManifestList]]></desc>
			<sql><![CDATA[
SELECT
  ROWNUM SEQ_NO
, '               '||DECODE(@[mode_type] ,'I', 'POL: '|| GROUP_POL_POD ||'    ETD:'|| GROUP_ETD_ETA
                                             , 'POD: '|| GROUP_POL_POD ||'    ETA:'|| GROUP_ETD_ETA ) GROUP_TITLE
, '        '||'Total Package: '|| TRIM(TO_CHAR(TOTAL_PKG,'9,999,990'))||'    Total Weight:'|| TRIM(TO_CHAR(TOTAL_KGS,'9,999,990.999'))||' KGS('|| TRIM(TO_CHAR(TOTAL_LBS,'9,999,990.999'))||' LBS)' AS GROUP_TOTAL
, Z.*        
FROM ( SELECT  SUM(PKG3) OVER( PARTITION BY GROUP_POL_POD, GROUP_ETD_ETA) TOTAL_PKG 
             , SUM(KGS) OVER( PARTITION BY GROUP_POL_POD, GROUP_ETD_ETA ) TOTAL_KGS 
             , SUM(LBS) OVER( PARTITION BY GROUP_POL_POD, GROUP_ETD_ETA ) TOTAL_LBS
             , Y.*
             , TO_CHAR(Y.WGT1 + Y.TARE_WGT, 'FM99999990.000') AS TOTAL_WGT
        FROM ( SELECT  BKG_GET_TOKEN_FNC(X.HEADER,1) HD_VVD_CD
                     , BKG_GET_TOKEN_FNC(X.HEADER,2) HD_POL_POD
                     , BKG_GET_TOKEN_FNC(X.HEADER,3) HD_POL_POD_CD
                     , BKG_GET_TOKEN_FNC(X.HEADER,4) HD_ETA_ETD
                     , BKG_GET_TOKEN_FNC(X.HEADER,5) HD_ETA_ETD_CD
                     , DECODE(@[mode_type] ,'I','Inbound','Outbound') HD_MODE_TYPE
                     , X.*
                     , TO_CHAR(DECODE(NVL(X.WGT2,' '),'LBS',ROUND(NVL(X.CGO_WGT,0)*0.4536,2),NVL(X.CGO_WGT,0)), 'FM99999990.000') AS WGT1
                     , DECODE(NVL(X.WGT2,' '),'LBS', ROUND(NVL(X.CGO_WGT,0)*0.4536,3),NVL(X.CGO_WGT,0))   AS KGS
                     , DECODE(NVL(X.WGT2,' '),'KGS', ROUND(NVL(X.CGO_WGT,0)*2.2046,3),NVL(X.CGO_WGT,0))   AS LBS
                FROM ( SELECT B.BKG_NO,B.BKG_CGO_TP_CD
                            , B.BL_NO
                            , B.POR_CD
                            , B.POL_CD
                            , SUBSTR(B.POL_NOD_CD,6) AS POL_YD_CD
                            , B.POD_CD
                            , SUBSTR(B.POD_NOD_CD,6) AS POD_YD_CD
                            , B.DEL_CD
                            , SUBSTR(B.DEL_NOD_CD,6) AS DEL_YD_CD
                            
                            , B.RCV_TERM_CD      AS  RD_CD1
                            , B.DE_TERM_CD       AS  RD_CD2

                            , CASE WHEN B.BKG_CGO_TP_CD = 'P'
                                   THEN 'NLS SHIPPING 34,ROZENSHTEINA STR.,' ||CHR(10)||
                                        'LITER A,POM.3H,198095,RUSSIA,' ||CHR(10)||
                                        'ST. PETERSBURG RUSSIA'
                                   ELSE NVL((SELECT CUST.CUST_NM FROM BKG_CSTMS_RU_CUST CUST WHERE 1=1 
                                             AND CUST.BKG_CUST_TP_CD = 'S' AND CUST.BL_NO = B.BL_NO)
                                           ,(SELECT CUST.CUST_NM FROM BKG_CUSTOMER CUST WHERE 1=1 
                                             AND CUST.BKG_CUST_TP_CD = 'S' AND CUST.BKG_NO = B.BKG_NO))
                              END AS SH_NM
                            
                            
                            , CASE WHEN B.BKG_CGO_TP_CD = 'P'
                                   THEN 'HANJIN SHIPPING, EUROPE AM'||CHR(10)||
                                        'SANDTORPARK,'||CHR(10)||
                                        '6 D-20457 HAMBURG, GERMANY'
                                   ELSE NVL((SELECT CUST.CUST_NM FROM BKG_CSTMS_RU_CUST CUST WHERE 1=1 
                                             AND CUST.BKG_CUST_TP_CD = 'C' AND CUST.BL_NO = B.BL_NO)
                                           ,(SELECT CUST.CUST_NM FROM BKG_CUSTOMER CUST WHERE 1=1 
                                             AND CUST.BKG_CUST_TP_CD = 'C' AND CUST.BKG_NO = B.BKG_NO))
                              END AS CNEE_NM

                              
                            , D.CNTR_NO
                            , E.CNTR_SEAL_NO
                            
                            , TRIM(TO_CHAR(NVL(D.PCK_QTY, 0),'9,999,990'))  AS PKG1
                            , D.PCK_TP_CD                                   AS PKG2
                            , NVL(D.PCK_QTY, 0)                             AS PKG3

                            , NVL(NVL((SELECT RC.CGO_WGT FROM BKG_CSTMS_RU_CNTR RC WHERE 1=1 
                                        AND RC.BKG_NO = B.BKG_NO AND RC.CNTR_NO = D.CNTR_NO)
                                      , D.CNTR_WGT), 0) AS CGO_WGT

                            , NVL((SELECT RC.WGT_UT_CD FROM BKG_CSTMS_RU_CNTR RC WHERE 1=1 
                                  AND RC.BKG_NO = B.BKG_NO AND RC.CNTR_NO = D.CNTR_NO), D.WGT_UT_CD) AS WGT2
                                  
                                                        
                            , TO_CHAR(NVL(NVL((SELECT RC.TARE_WGT FROM BKG_CSTMS_RU_CNTR RC WHERE 1=1 
                                                  AND RC.BKG_NO = B.BKG_NO AND RC.CNTR_NO = D.CNTR_NO)
                                             ,(SELECT DECODE(NVL(S.TARE_WGT, 0), 0
                                                    , DECODE(NVL(MDM.CNTR_TPSZ_TARE_WGT, 0), 0
                                                    , DECODE(M.CNTR_TPSZ_CD, 'T2', 3600, 'T4', 5200, 0) 
                                                    , MDM.CNTR_TPSZ_TARE_WGT)
                                                    , S.TARE_WGT) 
                                                 FROM MST_CONTAINER M, MST_CNTR_SPEC S, MDM_CNTR_TP_SZ MDM
                                                WHERE M.CNTR_NO      = D.CNTR_NO
                                                  AND M.CNTR_SPEC_NO = S.CNTR_SPEC_NO(+)
                                                  AND M.CNTR_TPSZ_CD = MDM.CNTR_TPSZ_CD)), 0), 'FM99999990.000') AS TARE_WGT
                            
                            , NVL(D.MEAS_QTY, 0) AS MEAS_QTY
                            , D.MEAS_UT_CD
                            
                            , DECODE(NVL(D.MEAS_UT_CD,' '),'CBF', ROUND(NVL(D.MEAS_QTY,0)*0.0283,3),NVL(D.MEAS_QTY,0))  AS CBF
                            , DECODE(NVL(D.MEAS_UT_CD,' '),'CBM', ROUND(NVL(D.MEAS_QTY,0)*35.315,3),NVL(D.MEAS_QTY,0))  AS CBM
                            
                            /* result Header */
                            , DECODE(@[mode_type],'I', ( SELECT VSL_CD||SKD_VOY_NO||SKD_DIR_CD||',POD,'||VPS_PORT_CD||',ETA,'||TO_CHAR(VPS_ETA_DT,'YYYY-MM-DD')
                                                           FROM VSK_VSL_PORT_SKD
                                                          WHERE VSL_CD = A.VSL_CD 
                                                            AND SKD_VOY_NO = A.SKD_VOY_NO 
                                                            AND SKD_DIR_CD  =  A.SKD_DIR_CD
                                                            AND VPS_PORT_CD =  A.POD_CD 
                                                            AND YD_CD = A.POD_YD_CD
                                                            AND NVL(SKD_CNG_STS_CD, ' ') <> 'S'
                                                            AND CLPT_IND_SEQ = A.POD_CLPT_IND_SEQ)
                                                  , ( SELECT VSL_CD||SKD_VOY_NO||SKD_DIR_CD||',POL,'||VPS_PORT_CD||',ETD,'||TO_CHAR(VPS_ETD_DT,'YYYY-MM-DD')
                                                        FROM VSK_VSL_PORT_SKD
                                                       WHERE VSL_CD = A.VSL_CD
                                                         AND SKD_VOY_NO = A.SKD_VOY_NO
                                                         AND SKD_DIR_CD = A.SKD_DIR_CD
                                                         AND VPS_PORT_CD = A.POL_CD
                                                         AND YD_CD = A.POL_YD_CD
                                                         AND NVL(SKD_CNG_STS_CD, ' ') <> 'S'
                                                         AND CLPT_IND_SEQ = A.POL_CLPT_IND_SEQ)
                                    ) AS HEADER 
                            
                            /* GROUP TITLE ETD,ETA*/
                            , DECODE(@[mode_type], 'I', (SELECT TO_CHAR(VPS_ETD_DT,'YYYY-MM-DD HH24:MI')
                                                           FROM VSK_VSL_PORT_SKD
                                                          WHERE VSL_CD = A.VSL_CD
                                                            AND SKD_VOY_NO = A.SKD_VOY_NO
                                                            AND SKD_DIR_CD = A.SKD_DIR_CD
                                                            AND VPS_PORT_CD = A.POL_CD
                                                            AND CLPT_IND_SEQ = A.POL_CLPT_IND_SEQ)
                                                 , (SELECT TO_CHAR(VPS_ETA_DT,'YYYY-MM-DD HH24:MI')
                                                      FROM VSK_VSL_PORT_SKD
                                                     WHERE VSL_CD = A.VSL_CD
                                                       AND SKD_VOY_NO = A.SKD_VOY_NO
                                                       AND SKD_DIR_CD = A.SKD_DIR_CD
                                                       AND VPS_PORT_CD = A.POD_CD
                                                       AND CLPT_IND_SEQ = A.POD_CLPT_IND_SEQ)
                                    ) AS GROUP_ETD_ETA
                                    
                            /* Group Title POL & POD */
                            , DECODE(@[mode_type],'I',A.POL_YD_CD,A.POD_YD_CD)  AS GROUP_POL_POD
                            
                         FROM BKG_VVD A, BKG_BOOKING B, BKG_CONTAINER D, BKG_CNTR_SEAL_NO E
                        WHERE A.BKG_NO = B.BKG_NO
                          AND B.BKG_NO = D.BKG_NO(+)
                          AND D.BKG_NO = E.BKG_NO(+)
                          AND D.CNTR_NO = E.CNTR_NO(+)
                          AND B.BKG_STS_CD NOT IN ('X','S')

                        /* vvd_cd */
                        #if(${vvd_cd} != '' ) 
                          AND A.VSL_CD     = SUBSTR(@[vvd_cd], 1, 4)
                          AND A.SKD_VOY_NO = SUBSTR(@[vvd_cd], 5, 4)
                          AND A.SKD_DIR_CD = SUBSTR(@[vvd_cd], 9, 1) 
                        #end
                      
                        /* pol_cd */
		                #if(${pol_cd} != '' )                       
                          AND A.POL_CD = @[pol_cd]
                        #end
                      
                        /* pol_yd_cd */
		                #if(${pol_yd_cd} != '' )                       
                          AND SUBSTR(A.POL_YD_CD,6) = @[pol_yd_cd]
                        #end
                    
                   	    /* pod_cd */
                        #if(${pod_cd} != '' ) 
                          AND A.POD_CD = @[pod_cd] 
                        #end

                        /* pod_yd_cd */
                        #if(${pod_yd_cd} != '' ) 
                          AND SUBSTR(A.POD_YD_CD,6) = @[pod_yd_cd]
                        #end
                      
                        /* CARGO TYPE */
                        #if(${cargo_type} != 'ALL' ) 
                          AND B.BKG_CGO_TP_CD = @[cargo_type] 
                        #end

                        /* CARGO_ROUTE */
                        #if(${cargo_route} != 'ALL' ) 
                          AND DECODE(B.POL_CD,A.POL_CD,'L','T') = @[cargo_route] 
                        #end
                        
                        /* br_por_cd */
                        #if(${br_por_cd} != '' ) 
                          AND B.POR_CD LIKE @[br_por_cd] ||'%'
                        #end
                        
                        /* br_pol_cd */
                        #if(${br_pol_cd} != '' )
                          AND B.POL_CD LIKE  @[br_pol_cd] ||'%'
                        #end
                        
                        /* br_pod_cd */
                        #if(${br_pod_cd} != '' )
                          AND B.POD_CD LIKE  @[br_pod_cd] ||'%'
                        #end
                        
                        /* br_del_cd */
                        #if(${br_del_cd} != '' ) 
                          AND B.DEL_CD LIKE  @[br_del_cd] ||'%'
                        #end
                      
                     ) X
               WHERE 1 = 1 
                 
             ) Y
       WHERE 1 = 1
       
       ORDER BY GROUP_POL_POD, GROUP_ETD_ETA , ${order_by}, BL_NO
    ) Z			]]></sql>
			<params>
				<param name="mode_type" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pol_yd_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="pod_yd_cd" type="12" value="" out="N"/>
				<param name="cargo_type" type="12" value="" out="N"/>
				<param name="cargo_route" type="12" value="" out="N"/>
				<param name="br_por_cd" type="12" value="" out="N"/>
				<param name="br_pol_cd" type="12" value="" out="N"/>
				<param name="br_pod_cd" type="12" value="" out="N"/>
				<param name="br_del_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
