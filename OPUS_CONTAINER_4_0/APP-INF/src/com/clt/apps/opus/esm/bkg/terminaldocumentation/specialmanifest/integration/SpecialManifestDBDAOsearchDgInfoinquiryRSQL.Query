<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SpecialManifestDBDAOsearchDgInfoinquiryRSQL">
			<desc><![CDATA[구주위험물 테이블들에서 데이타를 가져온다.]]></desc>
			<sql><![CDATA[
SELECT A.EUR_DG_DECL_TP_CD
      ,A.VSL_CD
      ,A.SKD_VOY_NO
      ,A.SKD_DIR_CD
      ,A.PORT_CD
      ,A.BL_NO
      ,A.CNTR_NO
      ,A.CNTR_CGO_SEQ
      ,A.POL_CD
      ,A.POD_CD
      ,A.CNTR_TPSZ_CD
      ,A.CELL_PSN_NO
      ,A.ANR_ROLE_DIV_CD
      ,A.ANR_FWRD_ID
      ,A.ANR_FWRD_NM
      ,A.ANR_CRR_TP_CD
      ,TO_CHAR(A.CRR_DT, 'YYYY-MM-DD') AS CRR_DT
      ,A.SVC_RQST_NO
      ,A.FDR_SVC_RQST_NO
      ,A.IMDG_PCK_GRP_CD
      ,A.IMDG_CLSS_CD
      ,A.IMDG_UN_NO
      ,A.IMDG_UN_NO_SEQ
      ,A.ANR_SPCL_TP_ID
      ,A.FLSH_PNT_CDO_TEMP
      ,A.NET_WGT
      ,A.GRS_WGT
      ,A.MFAG_NO
      ,A.PRP_SHP_NM
      ,A.HZD_DESC
      ,A.BRTH_YD_CD
      ,A.BRTH_YD_NM
      ,A.IMDG_LMT_QTY_FLG
      ,A.PCK_QTY
      ,A.PCK_TP_CD
      ,A.EUR_PCK_DESC
      ,A.OUT_IMDG_PCK_QTY1
      ,A.OUT_IMDG_PCK_CD1
      ,A.EUR_OUTR_PCK_DESC
      ,A.IN_IMDG_PCK_QTY1
      ,A.IN_IMDG_PCK_CD1
      ,A.EUR_INR_PCK_DESC
      ,A.EMS_NO
      ,A.DCGO_PCK_GRP_CD1
      ,A.EUR_DCGO_MRN_POLUT_CD
      ,A.DIFF_RMK
      ,A.HCDG_FLG
      ,A.EMER_RSPN_GID_NO
      ,A.NET_EXPLO_WGT
      ,A.FDR_VVD_ID
      ,A.FDR_VSL_NM
      ,A.FDR_VSL_LLOYD_NO
      ,A.VSL_LODG_DT
      ,A.XTD_STAY_PRMT_NO
      ,A.CRE_USR_ID
      ,A.CRE_DT
      ,A.UPD_USR_ID
      ,A.UPD_DT
      ,A.IMDG_SUBS_RSK_LBL_CD1
      ,A.IMDG_SUBS_RSK_LBL_CD2
      ,A.IMDG_SUBS_RSK_LBL_CD3
      ,A.IMDG_SUBS_RSK_LBL_CD4
      ,A.CGO_OPR_CD
      ,A.APLY_NO
      ,A.CRR_CD
      ,A.EDW_UPD_DT
      ,A.CNTR_REF_NO
      ,A.DCGO_REF_NO
      ,A.EMER_CNTC_PHN_NO
      ,A.EMER_CNTC_PSON_NM
      ,(SELECT BB.BKG_NO
          FROM BKG_BOOKING BB
         WHERE BB.BL_NO = A.BL_NO
       ) AS BKG_NO
      ,(SELECT CNTR_TPSZ_ISO_CD 
          FROM MDM_CNTR_TP_SZ 
         WHERE CNTR_TPSZ_CD = A.CNTR_TPSZ_CD
      ) CNTR_TPSZ_ISO_CD
      ,(SELECT SIUN.IMDG_COMP_GRP_CD
          FROM SCG_IMDG_UN_NO SIUN
         WHERE A.IMDG_UN_NO       = SIUN.IMDG_UN_NO
           AND A.IMDG_UN_NO_SEQ   = SIUN.IMDG_UN_NO_SEQ
       ) AS IMDG_COMP_GRP_CD
      ,(SELECT D.FWRD_NM
          FROM BKG_CSTMS_EUR_DG_FWRD D
         WHERE A.ANR_FWRD_ID = D.ANR_FWRD_ID
       ) AS FWRD_NM
      ,A.CNTR_NO AS CNTR_NO_OLD
      ,'' AS SAVE_TYPE
      ,(SELECT DD.CSTMS_ERR_MSG
          FROM BKG_CSTMS_EUR_DG_SND     AA
              ,BKG_CSTMS_EUR_DG_RCV     CC
              ,BKG_CSTMS_EUR_DG_RCV_ERR DD
        WHERE 1=1
          AND AA.EUR_EDI_MSG_TP_ID   = CC.EUR_EDI_MSG_TP_ID
          AND AA.MSG_SND_NO          = CC.MSG_RCV_NO
          AND CC.EUR_EDI_MSG_TP_ID   = DD.EUR_EDI_MSG_TP_ID
          AND CC.MSG_RCV_NO          = DD.MSG_RCV_NO
          AND CC.RCV_LOG_SEQ         = DD.RCV_LOG_SEQ
          AND AA.EUR_DG_DECL_TP_CD   = A.EUR_DG_DECL_TP_CD
          AND AA.VSL_CD              = A.VSL_CD    
          AND AA.SKD_VOY_NO          = A.SKD_VOY_NO
          AND AA.SKD_DIR_CD          = A.SKD_DIR_CD
          AND AA.PORT_CD             = A.PORT_CD
          AND AA.EUR_EDI_MSG_TP_ID   = 'IFD'
          AND AA.MSG_SND_NO          = (SELECT MAX(AA.MSG_SND_NO)
                                          FROM BKG_CSTMS_EUR_DG_SND AA
								         WHERE 1=1
								           AND AA.EUR_EDI_MSG_TP_ID   = A.EUR_DG_DECL_TP_CD
                                           AND AA.VSL_CD              = A.VSL_CD    
                                           AND AA.SKD_VOY_NO          = A.SKD_VOY_NO
                                           AND AA.SKD_DIR_CD          = A.SKD_DIR_CD
                                           AND AA.PORT_CD             = A.PORT_CD
                                           AND AA.EUR_EDI_MSG_TP_ID   ='IFD'
                                       )
       ) AS CSTMS_ERR_MSG
      ,'' AS D_TYPE
      ,'' AS VVD_CD
  FROM BKG_CSTMS_EUR_DG A
 WHERE 1=1
   AND A.EUR_DG_DECL_TP_CD = @[d_type]
   AND A.VSL_CD            = SUBSTR(@[vvd_cd], 1, 4)
   AND A.SKD_VOY_NO        = SUBSTR(@[vvd_cd], 5, 4)
   AND A.SKD_DIR_CD        = SUBSTR(@[vvd_cd], 9, 1)
   AND A.PORT_CD           = @[port_cd]
   AND A.BL_NO             = @[bl_no]
   AND A.CNTR_NO           = @[cntr_no]
   AND A.CNTR_CGO_SEQ      = @[cntr_cgo_seq]			]]></sql>
			<params>
				<param name="d_type" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="port_cd" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="cntr_cgo_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
