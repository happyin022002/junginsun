<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="StatusManageDBDAOCreateQtaStepVerCSQL">
			<desc><![CDATA[HO_L_F & G.RPB 관련 Setp Ver Data 생성
[CHM-201328244] IAS Sector Sales 판매시스템 개발
]]></desc>
			<sql><![CDATA[
INSERT INTO CSQ_QTA_STEP_VER (
         BSE_TP_CD
        ,BSE_YR
        ,BSE_QTR_CD
        ,OFC_VW_CD
        ,QTA_STEP_CD
        ,QTA_VER_NO
        ,TRD_CD
        ,CONV_DIR_CD
        ,CSQ_VER_STS_CD
        ,CFM_GDT
        ,CRE_OFC_CD
        ,CRE_USR_ID
        ,CRE_DT
        ,UPD_USR_ID
        ,UPD_DT
)
  SELECT DISTINCT 
         B1.BSE_TP_CD
        ,B1.BSE_YR
        ,B1.BSE_QTR_CD
        ,DECODE(@[f_qta_step_cd], '01', 'C', B1.OFC_VW_CD) AS OFC_VW_CD
        ,DECODE(@[f_qta_step_cd], '01', '01'
                                , '02', '02'
                                , DECODE(B1.OFC_VW_CD, 'L', '03', DECODE(B1.OB_DIV_CD, 'N', '04', 'O', '05'))) AS QTA_STEP_CD
        ,SUBSTR(B1.TEAM_CD, -3) || DECODE(@[f_qta_step_cd], '01', B1.TEAM_CD
                                                          , '02', B1.TEAM_CD
                                                          , B1.RHQ_CD) || SUBSTR(B1.BSE_YR, -2) || B1.BSE_QTR_CD || '01' AS QTA_VER_NO
        ,B1.TRD_CD
        ,B2.CONV_DIR_CD
        ,'I' AS CSQ_VER_STS_CD
        ,NULL AS CFM_GDT
        ,DECODE(@[f_qta_step_cd], '01', B1.TEAM_CD
                                , '02', B1.TEAM_CD
                                , B1.RHQ_CD) AS CRE_OFC_CD
        ,@[f_usr_id] AS CRE_USR_ID
        ,SYSDATE     AS CRE_DT
        ,@[f_usr_id] AS UPD_USR_ID
        ,SYSDATE     AS UPD_DT
    FROM CSQ_DAT_RLT B1
        ,(
           SELECT DISTINCT
                  A1.BSE_TP_CD
                 ,A1.BSE_YR
                 ,A1.BSE_QTR_CD
                 ,A1.OFC_VW_CD
                 ,A1.RHQ_CD
                 ,A1.TRD_CD
                 ,A1.DIR_CD
                 ,NVL(A2.CONV_DIR_CD, A1.DIR_CD) AS CONV_DIR_CD
             FROM CSQ_QTA_LANE_OFC A1
                 ,CSQ_DIR_CONV     A2
            WHERE A1.BSE_TP_CD   = A2.BSE_TP_CD  (+)
              AND A1.BSE_YR      = A2.BSE_YR     (+)
              AND A1.BSE_QTR_CD  = A2.BSE_QTR_CD (+)
              AND A1.TRD_CD      = A2.TRD_CD     (+)
              AND A1.RLANE_CD    = A2.RLANE_CD   (+)
              AND A1.DIR_CD      = A2.DIR_CD     (+)
              AND A1.BSE_TP_CD   = @[f_bse_tp_cd]
              AND A1.BSE_YR      = @[f_bse_yr]
              AND A1.BSE_QTR_CD  = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])
    	      AND 1 = (
                        SELECT DISTINCT 1
                          FROM CSQ_QTA_LANE_MGMT S1
                        WHERE S1.TRD_CD     = A1.TRD_CD
                   		  AND S1.BSE_TP_CD  = A1.BSE_TP_CD
                   		  AND S1.BSE_YR     = A1.BSE_YR
                   		  AND S1.BSE_QTR_CD = A1.BSE_QTR_CD
                          AND S1.RLANE_CD   = A1.RLANE_CD
                          AND S1.IAS_SCTR_FLG = 'N'
                        )

         ) B2
   WHERE B1.BSE_TP_CD   = @[f_bse_tp_cd]
     AND B1.BSE_YR      = @[f_bse_yr]
     AND B1.BSE_QTR_CD  = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])
     AND B1.BSE_TP_CD   = B2.BSE_TP_CD
     AND B1.BSE_YR      = B2.BSE_YR
     AND B1.BSE_QTR_CD  = B2.BSE_QTR_CD
     AND B1.OFC_VW_CD   = B2.OFC_VW_CD
     AND B1.RHQ_CD      = B2.RHQ_CD
     AND B1.TRD_CD      = B2.TRD_CD
     AND B1.CONV_DIR_CD = B2.CONV_DIR_CD
ORDER BY B1.TRD_CD
        ,B2.CONV_DIR_CD			]]></sql>
			<params>
				<param name="f_qta_step_cd" type="12" value="" out="N"/>
				<param name="f_usr_id" type="12" value="" out="N"/>
				<param name="f_bse_tp_cd" type="12" value="" out="N"/>
				<param name="f_bse_yr" type="12" value="" out="N"/>
				<param name="f_bse_qtr_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
