<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UsaCustomsTransmissionDBDAOsearchDelAmsRSQL">
			<desc><![CDATA[]]></desc>
			<sql><![CDATA[
SELECT CASE 
          WHEN @[it_ittype] IN ('62', '63') THEN
             CASE
                WHEN @[booking_pod_cd] = 'USNYC' THEN
                   (NVL((SELECT ATTR_CTNT2
                           FROM BKG_CSTMS_CD_CONV_CTNT
                          WHERE CNT_CD = 'US'
                            AND CSTMS_DIV_ID = 'AMS_TML_CD_MAP'
                            AND ATTR_CTNT1 = (SELECT V.POD_YD_CD
                                               FROM BKG_VVD V,
                                                    BKG_BOOKING B
                                              WHERE V.VSL_CD = SUBSTR(@[vvd], 1, 4)
                                                AND V.SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
                                                AND V.SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
                                                AND B.BL_NO = @[bl_no]
                                                AND V.BKG_NO = B.BKG_NO
                                                AND V.POD_CD = B.POD_CD
                                                AND ROWNUM = 1)), NVL((SELECT NVL(NVL(C.LOC_AMS_PORT_CD, D.LOC_AMS_PORT_CD), DECODE(SUBSTR(B.DEL_CD, 1, 2), 'MX', '20195', 'CA', '13400'))
                                                                        FROM BKG_CSTMS_ADV_BL A,
                                                                             BKG_BOOKING B,
                                                                             MDM_LOCATION C,
                                                                             MDM_LOCATION D
                                                                       WHERE A.CNT_CD = 'US'
                                                                         AND A.BL_NO = @[bl_no]
                                                                         AND B.BKG_NO = A.BKG_NO
                                                                         AND C.LOC_CD = B.POD_CD
                                                                         AND C.DELT_FLG = 'N'
                                                                         AND D.LOC_CD(+) = C.SCC_CD
                                                                         AND D.DELT_FLG(+) = 'N'
                                                                         AND ROWNUM = 1), RPAD(' ', 5, ' '))))

                ELSE
                   NVL((SELECT NVL(NVL(C.LOC_AMS_PORT_CD, D.LOC_AMS_PORT_CD), DECODE(SUBSTR(B.DEL_CD, 1, 2), 'MX', '20195', 'CA', '13400'))
                          FROM BKG_CSTMS_ADV_BL A,
                               BKG_BOOKING B,
                               MDM_LOCATION C,
                               MDM_LOCATION D
                         WHERE A.CNT_CD = 'US'
                           AND A.BL_NO = @[bl_no]
                           AND B.BKG_NO = A.BKG_NO
                           AND C.LOC_CD = B.POD_CD
                           AND C.DELT_FLG = 'N'
                           AND D.LOC_CD(+) = C.SCC_CD
                           AND D.DELT_FLG(+) = 'N'
                           AND ROWNUM = 1), RPAD(' ', 5, ' '))

             END

          ELSE
             RPAD(' ', 5, ' ')
       END
  FROM DUAL			]]></sql>
			<params>
				<param name="it_ittype" type="12" value="" out="N"/>
				<param name="booking_pod_cd" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
