<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCReportDBDAORsltSearchSCRateSearchListRSQL">
			<desc><![CDATA[rate search]]></desc>
			<sql><![CDATA[
WITH
RT AS 
(
    SELECT  SH.PROP_NO          ,
            SS.PROP_SCP_OFC_CD  , -- 추가
            SS.PROP_SCP_SREP_CD , -- 추가
            RT.AMDT_SEQ         ,
            RT.SVC_SCP_CD       ,
            SH.SC_NO            ,
            CH.GEN_SPCL_RT_TP_CD ,
            CH.CMDT_HDR_SEQ      ,
            CH.BLET_DP_SEQ       ,
            CR.ROUT_SEQ          ,
            RT.RT_SEQ            ,
            'OFT'   CHG_CD       ,
            RT.RAT_UT_CD         ,
            RT.PRC_CGO_TP_CD     ,
            RT.CURR_CD           ,
            RT.FNL_FRT_RT_AMT 
    FROM    PRI_SP_HDR              SH  ,
            PRI_SP_MN               SM  ,
            PRI_SP_CTRT_PTY         CP  ,
            PRI_SP_CTRT_CUST_TP     CT  ,
            PRI_SP_SCP_MN           SS  ,
            PRI_SP_SCP_MQC          SQ  ,
            PRI_SP_SCP_RT_CMDT_HDR  CH  ,
            PRI_SP_SCP_RT_CMDT_ROUT CR  ,
            PRI_SP_SCP_RT_ROUT_PNT  OP  ,
            PRI_SP_SCP_RT_ROUT_PNT  DP  ,
            PRI_SP_SCP_RT           RT
    WHERE   SM.PROP_NO            = SH.PROP_NO
    AND     SM.PROP_STS_CD        = 'F'
    AND     CP.PROP_NO            = SM.PROP_NO
    AND     CP.AMDT_SEQ           = SM.AMDT_SEQ
    AND     CP.PRC_CTRT_PTY_TP_CD = 'C'
    AND     CT.PROP_NO            = CP.PROP_NO
    AND     CT.AMDT_SEQ           = CP.AMDT_SEQ
    AND     CT.PRC_CTRT_PTY_TP_CD = CP.PRC_CTRT_PTY_TP_CD
    AND     SS.PROP_NO            = SM.PROP_NO
    AND     SS.AMDT_SEQ           = SM.AMDT_SEQ
    AND     SQ.PROP_NO            = SS.PROP_NO
    AND     SQ.AMDT_SEQ           = SS.AMDT_SEQ
    AND     SQ.SVC_SCP_CD         = SS.SVC_SCP_CD
    AND     CH.PROP_NO            = SS.PROP_NO
    AND     CH.AMDT_SEQ           = SS.AMDT_SEQ
    AND     CH.SVC_SCP_CD         = SS.SVC_SCP_CD
    AND     CR.PROP_NO            = CH.PROP_NO
    AND     CR.AMDT_SEQ           = CH.AMDT_SEQ
    AND     CR.SVC_SCP_CD         = CH.SVC_SCP_CD
    AND     CR.GEN_SPCL_RT_TP_CD  = CH.GEN_SPCL_RT_TP_CD
    AND     CR.CMDT_HDR_SEQ       = CH.CMDT_HDR_SEQ
    AND     OP.PROP_NO            = CR.PROP_NO
    AND     OP.AMDT_SEQ           = CR.AMDT_SEQ
    AND     OP.SVC_SCP_CD         = CR.SVC_SCP_CD
    AND     OP.CMDT_HDR_SEQ       = CR.CMDT_HDR_SEQ
    AND     OP.GEN_SPCL_RT_TP_CD  = CR.GEN_SPCL_RT_TP_CD
    AND     OP.ROUT_SEQ           = CR.ROUT_SEQ
    AND     OP.ORG_DEST_TP_CD     = 'O'
    AND     OP.SRC_INFO_CD        <> 'AD'
    AND     DP.PROP_NO            = CR.PROP_NO
    AND     DP.AMDT_SEQ           = CR.AMDT_SEQ
    AND     DP.SVC_SCP_CD         = CR.SVC_SCP_CD
    AND     DP.GEN_SPCL_RT_TP_CD  = DP.GEN_SPCL_RT_TP_CD
    AND     DP.CMDT_HDR_SEQ       = CR.CMDT_HDR_SEQ
    AND     DP.ROUT_SEQ           = CR.ROUT_SEQ
    AND     DP.ORG_DEST_TP_CD     = 'D'
    AND     DP.SRC_INFO_CD        <> 'AD'
    AND     RT.PROP_NO            = CR.PROP_NO
    AND     RT.AMDT_SEQ           = CR.AMDT_SEQ
    AND     RT.SVC_SCP_CD         = CR.SVC_SCP_CD
    AND     RT.GEN_SPCL_RT_TP_CD  = CR.GEN_SPCL_RT_TP_CD
    AND     RT.CMDT_HDR_SEQ       = CR.CMDT_HDR_SEQ
    AND     RT.ROUT_SEQ           = CR.ROUT_SEQ
    AND     RT.SRC_INFO_CD        <> 'AD'
    #if (${exp_dt} != '')
    AND         SS.EFF_DT         <= TO_DATE(@[exp_dt], 'YYYY-MM-DD') -- Effective Date(To)
    #end
    #if (${eff_dt} != '')
    AND         SS.EXP_DT         >= TO_DATE(@[eff_dt], 'YYYY-MM-DD') -- Effective Date(From)
    #end

    #if (${rout_pnt_loc_def_cd_ori} != '')
    AND (    
            OP.ROUT_PNT_LOC_DEF_CD IN
			(
			SELECT	    GL.PRC_GRP_LOC_CD
			FROM		PRI_SP_SCP_GRP_LOC		GL	,
						PRI_SP_SCP_GRP_LOC_DTL	GD
			WHERE		GD.PROP_NO			= GL.PROP_NO
			AND			GD.AMDT_SEQ			= GL.AMDT_SEQ
			AND			GD.SVC_SCP_CD		= GL.SVC_SCP_CD
			AND			GD.GRP_LOC_SEQ		= GL.GRP_LOC_SEQ
			AND			GL.PROP_NO			= SS.PROP_NO
			AND			GL.AMDT_SEQ			= SS.AMDT_SEQ
			AND			GL.SVC_SCP_CD		= SS.SVC_SCP_CD
			AND			GD.SRC_INFO_CD		<> 'AD'
			AND			GD.LOC_CD			LIKE @[rout_pnt_loc_def_cd_ori] || '%' -- Origin
	        )
	        OR
		    OP.ROUT_PNT_LOC_DEF_CD LIKE @[rout_pnt_loc_def_cd_ori] || '%' -- Origin
		)
    #end

    #if (${rout_pnt_loc_def_cd_dest} != '')
    AND  (
            DP.ROUT_PNT_LOC_DEF_CD IN
			(
			SELECT	GL.PRC_GRP_LOC_CD
			FROM		PRI_SP_SCP_GRP_LOC		GL	,
						PRI_SP_SCP_GRP_LOC_DTL	GD
			WHERE		GD.PROP_NO			= GL.PROP_NO
			AND			GD.AMDT_SEQ			= GL.AMDT_SEQ
			AND			GD.SVC_SCP_CD		= GL.SVC_SCP_CD
			AND			GD.GRP_LOC_SEQ		= GL.GRP_LOC_SEQ
			AND			GL.PROP_NO			= SS.PROP_NO
			AND			GL.AMDT_SEQ			= SS.AMDT_SEQ
			AND			GL.SVC_SCP_CD		= SS.SVC_SCP_CD
			AND			GD.SRC_INFO_CD		<> 'AD'
			AND			GD.LOC_CD			LIKE @[rout_pnt_loc_def_cd_dest] || '%' -- Destination
			)
	        OR
	        DP.ROUT_PNT_LOC_DEF_CD LIKE @[rout_pnt_loc_def_cd_dest] || '%' -- Destination
          )
    #end

    #if (${rout_via_port_def_cd_ori} != '')
    AND     EXISTS  (
                    SELECT  'X'
                    FROM    PRI_SP_SCP_RT_ROUT_VIA  OV
                    WHERE   OV.PROP_NO              = CR.PROP_NO
                    AND     OV.AMDT_SEQ             = CR.AMDT_SEQ
                    AND     OV.SVC_SCP_CD           = CR.SVC_SCP_CD
                    AND     OV.GEN_SPCL_RT_TP_CD    = CR.GEN_SPCL_RT_TP_CD
                    AND     OV.CMDT_HDR_SEQ         = CR.CMDT_HDR_SEQ
                    AND     OV.ROUT_SEQ             = CR.ROUT_SEQ
                    AND     OV.ORG_DEST_TP_CD       = 'O'
                    AND     OV.SRC_INFO_CD          <> 'AD'
                    AND     OV.ROUT_VIA_PORT_DEF_CD LIKE @[rout_via_port_def_cd_ori] || '%'	-- Origin Via
					UNION ALL
					SELECT	'X'
					FROM	PRI_SP_SCP_RT_ROUT_VIA  OV	,
							PRI_SP_SCP_GRP_LOC		GL	,
							PRI_SP_SCP_GRP_LOC_DTL	GD
                    WHERE   OV.PROP_NO              = CR.PROP_NO
                    AND     OV.AMDT_SEQ             = CR.AMDT_SEQ
                    AND     OV.SVC_SCP_CD           = CR.SVC_SCP_CD
                    AND     OV.GEN_SPCL_RT_TP_CD    = CR.GEN_SPCL_RT_TP_CD
                    AND     OV.CMDT_HDR_SEQ         = CR.CMDT_HDR_SEQ
                    AND     OV.ROUT_SEQ             = CR.ROUT_SEQ
                    AND     OV.ORG_DEST_TP_CD       = 'O'
                    AND     OV.SRC_INFO_CD          <> 'AD'
					AND		OV.ROUT_VIA_PORT_DEF_CD	= GL.PRC_GRP_LOC_CD
					AND		GD.PROP_NO				= GL.PROP_NO
					AND		GD.AMDT_SEQ				= GL.AMDT_SEQ
					AND		GD.SVC_SCP_CD			= GL.SVC_SCP_CD
					AND		GD.GRP_LOC_SEQ			= GL.GRP_LOC_SEQ
					AND		GL.PROP_NO				= CR.PROP_NO
					AND		GL.AMDT_SEQ				= CR.AMDT_SEQ
					AND		GL.SVC_SCP_CD			= CR.SVC_SCP_CD
					AND		GD.SRC_INFO_CD			<> 'AD'
					AND		GD.LOC_CD				LIKE @[rout_via_port_def_cd_ori] || '%'	-- Origin Via
                    )
    #end

    #if (${rout_via_port_def_cd_dest} != '')
    AND     EXISTS  (
                    SELECT  'X'
                    FROM    PRI_SP_SCP_RT_ROUT_VIA  DV
                    WHERE   DV.PROP_NO              = CR.PROP_NO
                    AND     DV.AMDT_SEQ             = CR.AMDT_SEQ
                    AND     DV.SVC_SCP_CD           = CR.SVC_SCP_CD
                    AND     DV.GEN_SPCL_RT_TP_CD    = CR.GEN_SPCL_RT_TP_CD
                    AND     DV.CMDT_HDR_SEQ         = CR.CMDT_HDR_SEQ
                    AND     DV.ROUT_SEQ             = CR.ROUT_SEQ
                    AND     DV.ORG_DEST_TP_CD       = 'D'
                    AND     DV.SRC_INFO_CD          <> 'AD'
                    AND     DV.ROUT_VIA_PORT_DEF_CD LIKE @[rout_via_port_def_cd_dest] || '%' -- Dest Via
					UNION ALL
					SELECT	'X'
					FROM	PRI_SP_SCP_RT_ROUT_VIA  DV	,
							PRI_SP_SCP_GRP_LOC		GL	,
							PRI_SP_SCP_GRP_LOC_DTL	GD
                    WHERE   DV.PROP_NO              = CR.PROP_NO
                    AND     DV.AMDT_SEQ             = CR.AMDT_SEQ
                    AND     DV.SVC_SCP_CD           = CR.SVC_SCP_CD
                    AND     DV.GEN_SPCL_RT_TP_CD    = CR.GEN_SPCL_RT_TP_CD
                    AND     DV.CMDT_HDR_SEQ         = CR.CMDT_HDR_SEQ
                    AND     DV.ROUT_SEQ             = CR.ROUT_SEQ
                    AND     DV.ORG_DEST_TP_CD       = 'O'
                    AND     DV.SRC_INFO_CD          <> 'AD'
					AND		DV.ROUT_VIA_PORT_DEF_CD	= GL.PRC_GRP_LOC_CD
					AND		GD.PROP_NO				= GL.PROP_NO
					AND		GD.AMDT_SEQ				= GL.AMDT_SEQ
					AND		GD.SVC_SCP_CD			= GL.SVC_SCP_CD
					AND		GD.GRP_LOC_SEQ			= GL.GRP_LOC_SEQ
					AND		GL.PROP_NO				= CR.PROP_NO
					AND		GL.AMDT_SEQ				= CR.AMDT_SEQ
					AND		GL.SVC_SCP_CD			= CR.SVC_SCP_CD
					AND		GD.SRC_INFO_CD			<> 'AD'
					AND		GD.LOC_CD				LIKE @[rout_via_port_def_cd_dest] || '%' -- Dest Via
                    )
    #end

    #if (${prc_ctrt_cust_tp_cd} != '')
    AND         CT.PRC_CTRT_CUST_TP_CD  = NVL(@[prc_ctrt_cust_tp_cd], CT.PRC_CTRT_CUST_TP_CD)   -- Customer Type
    #end

    #if (${prc_cmdt_def_cd} != '')
    AND    EXISTS  (
                     SELECT  'X'
                     FROM        PRI_SP_SCP_RT_CMDT  RC
                     WHERE       RC.PROP_NO           = CH.PROP_NO
                     AND         RC.AMDT_SEQ          = CH.AMDT_SEQ
                     AND         RC.SVC_SCP_CD        = CH.SVC_SCP_CD
                     AND         RC.GEN_SPCL_RT_TP_CD = CH.GEN_SPCL_RT_TP_CD
                     AND         RC.CMDT_HDR_SEQ      = CH.CMDT_HDR_SEQ
                     AND         RC.PRC_CMDT_TP_CD    = 'C'
                     AND         RC.SRC_INFO_CD       <> 'AD'
                     AND         RC.PRC_CMDT_DEF_CD   LIKE @[prc_cmdt_def_cd] || '%'   -- Commodity
                     UNION ALL
                     SELECT  'X'
                     FROM        PRI_SP_SCP_RT_CMDT  RC
                     WHERE       RC.PROP_NO           = CH.PROP_NO
                     AND         RC.AMDT_SEQ          = CH.AMDT_SEQ
                     AND         RC.SVC_SCP_CD        = CH.SVC_SCP_CD
                     AND         RC.GEN_SPCL_RT_TP_CD = CH.GEN_SPCL_RT_TP_CD
                     AND         RC.CMDT_HDR_SEQ      = CH.CMDT_HDR_SEQ
                     AND         RC.PRC_CMDT_TP_CD    = 'G'
                     AND         RC.SRC_INFO_CD       <> 'AD'
                     AND         EXISTS  (
                                           SELECT  'X'
                                           FROM        PRI_SP_SCP_GRP_CMDT     G ,
                                                       PRI_SP_SCP_GRP_CMDT_DTL D
                                           WHERE       D.PROP_NO         = G.PROP_NO
                                           AND         D.AMDT_SEQ        = G.AMDT_SEQ
                                           AND         D.SVC_SCP_CD      = G.SVC_SCP_CD
                                           AND         D.GRP_CMDT_SEQ    = G.GRP_CMDT_SEQ
                                           AND         D.PRC_CMDT_TP_CD  = 'C'
                                           AND         D.SRC_INFO_CD     <> 'AD'
                                           AND         D.PRC_CMDT_DEF_CD LIKE @[prc_cmdt_def_cd] || '%' -- Commodity
                                           AND         G.PROP_NO         = RC.PROP_NO
                                           AND         G.AMDT_SEQ        = RC.AMDT_SEQ
                                           AND         G.SVC_SCP_CD      = RC.SVC_SCP_CD
                                           AND         G.PRC_GRP_CMDT_CD = RC.PRC_CMDT_DEF_CD
                                          )
                 )
    #end

    #if (${rat_ut_cd} != '')
    AND    RT.RAT_UT_CD         = @[rat_ut_cd]                   -- RATING UNIT
    #end
    
    #if (${prc_cgo_tp_cd} != '')
    AND    RT.PRC_CGO_TP_CD     = @[prc_cgo_tp_cd]               -- CARGO TYPE
    #end

    #if (${chg_cd} == 'OFT' && ${fnl_frt_rt} != '')
    
    #if (${fnl_frt_rt} == '<' && ${fnl_frt_rt_amt} != '')
    AND    RT.FNL_FRT_RT_AMT < TO_NUMBER(REPLACE(@[fnl_frt_rt_amt],',','')) -- RATE
    #elseif (${fnl_frt_rt} == '>' && ${fnl_frt_rt_amt} != '')
    AND    RT.FNL_FRT_RT_AMT > TO_NUMBER(REPLACE(@[fnl_frt_rt_amt],',','')) -- RATE
    #elseif (${fnl_frt_rt} == '<=' && ${fnl_frt_rt_amt} != '')
    AND    RT.FNL_FRT_RT_AMT <= TO_NUMBER(REPLACE(@[fnl_frt_rt_amt],',','')) -- RATE
    #elseif (${fnl_frt_rt} == '>=' && ${fnl_frt_rt_amt} != '')
    AND    RT.FNL_FRT_RT_AMT >= TO_NUMBER(REPLACE(@[fnl_frt_rt_amt],',','')) -- RATE
    #elseif (${fnl_frt_rt} == '=' && ${fnl_frt_rt_amt} != '')
    AND    RT.FNL_FRT_RT_AMT = TO_NUMBER(REPLACE(@[fnl_frt_rt_amt],',','')) -- RATE
    #end

    #end
    
    #if (${fnl_mqc} != '')
    
    #if (${fnl_mqc} == '<' && ${fnl_mqc_qty} != '')
    AND    SQ.FNL_MQC_QTY < TO_NUMBER(REPLACE(@[fnl_mqc_qty],',','')) -- MQC
    #elseif (${fnl_mqc} == '>' && ${fnl_mqc_qty} != '')
    AND    SQ.FNL_MQC_QTY > TO_NUMBER(REPLACE(@[fnl_mqc_qty],',','')) -- MQC
    #elseif (${fnl_mqc} == '<=' && ${fnl_mqc_qty} != '')
    AND    SQ.FNL_MQC_QTY <= TO_NUMBER(REPLACE(@[fnl_mqc_qty],',','')) -- MQC
    #elseif (${fnl_mqc} == '>=' && ${fnl_mqc_qty} != '')
    AND    SQ.FNL_MQC_QTY >= TO_NUMBER(REPLACE(@[fnl_mqc_qty],',','')) -- MQC
    #elseif (${fnl_mqc} == '=' && ${fnl_mqc_qty} != '')
    AND    SQ.FNL_MQC_QTY = TO_NUMBER(REPLACE(@[fnl_mqc_qty],',','')) -- MQC
    #end

    #end

    #if (${prop_scp_ofc_cd} != '')
    AND    SS.PROP_SCP_OFC_CD   = @[prop_scp_ofc_cd]    -- REQUEST OFFICE
    #end
    
    #if (${prop_scp_srep_cd} != '')
    AND    SS.PROP_SCP_SREP_CD  = @[prop_scp_srep_cd]   -- SALES REP
    #end
    
    #if (${sc_no} != '')
    AND    SH.SC_NO LIKE @[sc_no] || '%'    -- S/C NO
    #end
    
    #if (${svc_scp_cd} != '')
    AND    SS.SVC_SCP_CD        = @[svc_scp_cd]         -- SVC SCOPE CODE
    #end
    
    #if (${gen_spcl_rt_tp_cd} != '')
    AND    CH.GEN_SPCL_RT_TP_CD = @[gen_spcl_rt_tp_cd]  -- RATE TYPE
    #end

)   ,

CG AS
(
   
    
    SELECT  RT.PROP_NO          ,
            RT.PROP_SCP_OFC_CD  , -- 추가
            RT.PROP_SCP_SREP_CD , -- 추가
            RT.AMDT_SEQ          ,
            RT.SVC_SCP_CD        ,
            RT.SC_NO             ,
            RT.GEN_SPCL_RT_TP_CD ,
            RT.CMDT_HDR_SEQ      ,
            RT.BLET_DP_SEQ       ,
            RT.ROUT_SEQ          ,
            RT.RT_SEQ            ,
            RT.CHG_CD            ,
            RT.RAT_UT_CD         ,
            RT.PRC_CGO_TP_CD     ,
            RT.CURR_CD           ,
            RT.FNL_FRT_RT_AMT
    FROM    RT

)   ,

SC AS
(

    SELECT  CG.SC_NO                    ,
            CG.PROP_NO                  ,
            CP.CTRT_PTY_NM              ,
            DECODE(SQ.CNTR_LOD_UT_CD, 'T', SQ.FNL_MQC_QTY / 2, SQ.FNL_MQC_QTY)  FNL_MQC_QTY ,
            CG.PROP_SCP_OFC_CD          , -- 추가
            CG.PROP_SCP_SREP_CD         , -- 추가
            CG.AMDT_SEQ                 ,
            CG.SVC_SCP_CD               ,
            CG.GEN_SPCL_RT_TP_CD        ,
            CG.BLET_DP_SEQ              ,
            CG.CMDT_HDR_SEQ             , -- 추가
            CG.ROUT_SEQ                 , -- 추가
            CG.RT_SEQ                   , -- 추가
            RC.CMDT_NM                  ,
            NVL(REPLACE(AC.ACT_CUST_NM, '^|^', ' / '), 'N/A')  ACT_CUST_NM ,
            --OP.ORG_NM                   ,
            OP.ORG_CD                   ,
            --OV.ORG_VIA_NM               ,
			OV.ORG_VIA_CD               ,
            --DV.DEST_VIA_NM              ,
			DV.DEST_VIA_CD              ,
            --DP.DEST_NM                  ,
			DP.DEST_CD                  ,
            CG.CHG_CD                   ,
            CG.RAT_UT_CD                ,
            CG.PRC_CGO_TP_CD            ,
            CG.CURR_CD                  ,
            CG.FNL_FRT_RT_AMT 
    FROM    CG  ,
            PRI_SP_CTRT_PTY         CP  ,
            PRI_SP_SCP_MQC          SQ  ,
            (
             SELECT  PROP_NO           ,
                     AMDT_SEQ          ,
                     SVC_SCP_CD        ,
                     GEN_SPCL_RT_TP_CD ,
                     CMDT_HDR_SEQ      ,
                     LTRIM(SYS_CONNECT_BY_PATH(CMDT_NM,' / '),' / ') CMDT_NM
              FROM   (
                       SELECT  /*+ ORDERED */
                               CG.PROP_NO           ,
                               CG.AMDT_SEQ          ,
                               CG.SVC_SCP_CD        ,
                               CG.GEN_SPCL_RT_TP_CD ,
                               CG.CMDT_HDR_SEQ      ,
                               ROW_NUMBER() OVER ( PARTITION BY CG.PROP_NO, CG.AMDT_SEQ, CG.SVC_SCP_CD, CG.GEN_SPCL_RT_TP_CD, CG.CMDT_HDR_SEQ ORDER BY RC.CMDT_SEQ ) ROW_NUMBER    ,
                               COUNT(1) OVER ( PARTITION BY CG.PROP_NO, CG.AMDT_SEQ, CG.SVC_SCP_CD, CG.GEN_SPCL_RT_TP_CD, CG.CMDT_HDR_SEQ ) CNT    ,
                               DECODE(RC.PRC_CMDT_TP_CD, 'C', MC.CMDT_NM, 'G', GC.PRC_GRP_CMDT_DESC) CMDT_NM
                       FROM    (
                                 SELECT  DISTINCT
                                         PROP_NO             ,
                                         AMDT_SEQ            ,
                                         SVC_SCP_CD          ,
                                         GEN_SPCL_RT_TP_CD   ,
                                         CMDT_HDR_SEQ
                                 FROM    CG
                                )   CG                ,
                               PRI_SP_SCP_RT_CMDT  RC ,
                               MDM_COMMODITY       MC ,
                               PRI_SP_SCP_GRP_CMDT GC
                       WHERE   MC.CMDT_CD(+)         = RC.PRC_CMDT_DEF_CD
                       AND     GC.PROP_NO(+)         = RC.PROP_NO
                       AND     GC.AMDT_SEQ(+)        = RC.AMDT_SEQ
                       AND     GC.SVC_SCP_CD(+)      = RC.SVC_SCP_CD
                       AND     GC.PRC_GRP_CMDT_CD(+) = RC.PRC_CMDT_DEF_CD
                       AND     RC.SRC_INFO_CD        <> 'AD'
                       AND     RC.PROP_NO            = CG.PROP_NO
                       AND     RC.AMDT_SEQ           = CG.AMDT_SEQ
                       AND     RC.SVC_SCP_CD         = CG.SVC_SCP_CD
                       AND     RC.GEN_SPCL_RT_TP_CD  = CG.GEN_SPCL_RT_TP_CD
                       AND     RC.CMDT_HDR_SEQ       = CG.CMDT_HDR_SEQ
                     )
                WHERE       LEVEL       = CNT
                START WITH ROW_NUMBER = 1
                CONNECT BY
                            PROP_NO           = PRIOR PROP_NO
                AND         AMDT_SEQ          = PRIOR AMDT_SEQ
                AND         SVC_SCP_CD        = PRIOR SVC_SCP_CD
                AND         GEN_SPCL_RT_TP_CD = PRIOR GEN_SPCL_RT_TP_CD
                AND         CMDT_HDR_SEQ      = PRIOR CMDT_HDR_SEQ
                AND         ROW_NUMBER        = PRIOR ROW_NUMBER + 1
               )   RC  ,
               (
                SELECT  PROP_NO            ,
                        AMDT_SEQ           ,
                        SVC_SCP_CD         ,
                        GEN_SPCL_RT_TP_CD  ,
                        CMDT_HDR_SEQ       ,
                        LTRIM(SYS_CONNECT_BY_PATH(ACT_CUST_NM,'^|^'),'^|^') ACT_CUST_NM
                FROM    (
                          SELECT  /*+ ORDERED */
                                  CG.PROP_NO           ,
                                  CG.AMDT_SEQ          ,
                                  CG.SVC_SCP_CD        ,
                                  CG.GEN_SPCL_RT_TP_CD ,
                                  CG.CMDT_HDR_SEQ      ,
                                  ROW_NUMBER() OVER ( PARTITION BY CG.PROP_NO, CG.AMDT_SEQ, CG.SVC_SCP_CD, CG.GEN_SPCL_RT_TP_CD, CG.CMDT_HDR_SEQ ORDER BY AC.ACT_CUST_SEQ ) ROW_NUMBER    ,
                                  COUNT(1) OVER ( PARTITION BY CG.PROP_NO, CG.AMDT_SEQ, CG.SVC_SCP_CD, CG.GEN_SPCL_RT_TP_CD, CG.CMDT_HDR_SEQ ) CNT    ,
                                  MC.CUST_LGL_ENG_NM  ACT_CUST_NM
                          FROM    (
                                    SELECT  DISTINCT
                                            PROP_NO           ,
                                            AMDT_SEQ          ,
                                            SVC_SCP_CD        ,
                                            GEN_SPCL_RT_TP_CD ,
                                            CMDT_HDR_SEQ
                                    FROM    CG
                                  )   CG                      ,
                                  PRI_SP_SCP_RT_ACT_CUST  AC  ,
                                  MDM_CUSTOMER            MC
                          WHERE   MC.CUST_CNT_CD(+)    = AC.CUST_CNT_CD
                          AND     MC.CUST_SEQ(+)       = AC.CUST_SEQ
                          AND     MC.CNTR_DIV_FLG      = 'Y'
                          AND     AC.PROP_NO           = CG.PROP_NO
                          AND     AC.AMDT_SEQ          = CG.AMDT_SEQ
                          AND     AC.SVC_SCP_CD        = CG.SVC_SCP_CD
                          AND     AC.GEN_SPCL_RT_TP_CD = CG.GEN_SPCL_RT_TP_CD
                          AND     AC.CMDT_HDR_SEQ      = CG.CMDT_HDR_SEQ
                          AND     AC.SRC_INFO_CD       <> 'AD'
                        )
                WHERE       LEVEL       = CNT
                START WITH ROW_NUMBER = 1
                CONNECT BY
                           PROP_NO             = PRIOR PROP_NO
                AND        AMDT_SEQ            = PRIOR AMDT_SEQ
                AND        SVC_SCP_CD          = PRIOR SVC_SCP_CD
                AND        GEN_SPCL_RT_TP_CD   = PRIOR GEN_SPCL_RT_TP_CD
                AND        CMDT_HDR_SEQ        = PRIOR CMDT_HDR_SEQ
                AND        ROW_NUMBER          = PRIOR ROW_NUMBER + 1
               )   AC  ,
               (
                SELECT  PROP_NO           ,
                        AMDT_SEQ          ,
                        SVC_SCP_CD        ,
                        GEN_SPCL_RT_TP_CD ,
                        CMDT_HDR_SEQ      ,
                        ROUT_SEQ          ,
                        --LTRIM(SYS_CONNECT_BY_PATH(ORG_NM,'^|^ '),'^|^ ') ORG_NM
                        --LTRIM(SYS_CONNECT_BY_PATH(ORG_CD,'^|^ '),'^|^ ') ORG_CD
                        LTRIM(SYS_CONNECT_BY_PATH(ORG_CD || NVL2(RCV_DE_TERM_NM, '(' || RCV_DE_TERM_NM || ')', ''),'^|^ '),'^|^ ') ORG_CD
                FROM    (
                          SELECT  /*+ ORDERED */
                                  CG.PROP_NO           ,
                                  CG.AMDT_SEQ          ,
                                  CG.SVC_SCP_CD        ,
                                  CG.GEN_SPCL_RT_TP_CD ,
                                  CG.CMDT_HDR_SEQ      ,
                                  CG.ROUT_SEQ          ,
                                  ROW_NUMBER() OVER ( PARTITION BY CG.PROP_NO, CG.AMDT_SEQ, CG.SVC_SCP_CD, CG.GEN_SPCL_RT_TP_CD, CG.CMDT_HDR_SEQ, CG.ROUT_SEQ ORDER BY OP.ROUT_PNT_SEQ ) ROW_NUMBER   ,
                                  COUNT(1) OVER ( PARTITION BY CG.PROP_NO, CG.AMDT_SEQ, CG.SVC_SCP_CD, CG.GEN_SPCL_RT_TP_CD, CG.CMDT_HDR_SEQ, CG.ROUT_SEQ ) CNT   ,
                                  --DECODE(OP.ROUT_PNT_LOC_TP_CD, 'L', ML.LOC_NM, 'G', GL.PRC_GRP_LOC_DESC) ORG_NM
                                  OP.ROUT_PNT_LOC_DEF_CD ORG_CD
                                 --,OP.RCV_DE_TERM_CD
                                 ,(SELECT INTG_CD_VAL_DP_DESC
                                     FROM COM_INTG_CD_DTL
                                    WHERE INTG_CD_ID = 'CD02138'
                                      AND INTG_CD_VAL_CTNT = OP.RCV_DE_TERM_CD
                                      AND ROWNUM = 1) AS RCV_DE_TERM_NM                                                                    
                          FROM    (
                                    SELECT  DISTINCT
                                            PROP_NO            ,
                                            AMDT_SEQ           ,
                                            SVC_SCP_CD         ,
                                            GEN_SPCL_RT_TP_CD  ,
                                            CMDT_HDR_SEQ       ,
                                            ROUT_SEQ
                                    FROM    CG
                                  )   CG                      ,
                                  PRI_SP_SCP_RT_ROUT_PNT  OP  --,
                                  --MDM_LOCATION            ML  ,
                                  --PRI_SP_SCP_GRP_LOC      GL
                          WHERE   --ML.LOC_CD(+)         = OP.ROUT_PNT_LOC_DEF_CD
                          --AND     GL.PROP_NO(+)        = OP.PROP_NO
                          --AND     GL.AMDT_SEQ(+)       = OP.AMDT_SEQ
                          --AND     GL.SVC_SCP_CD(+)     = OP.SVC_SCP_CD
                          --AND     GL.PRC_GRP_LOC_CD(+) = OP.ROUT_PNT_LOC_DEF_CD
                                    OP.PROP_NO           = CG.PROP_NO
                          AND     OP.AMDT_SEQ          = CG.AMDT_SEQ
                          AND     OP.SVC_SCP_CD        = CG.SVC_SCP_CD
                          AND     OP.GEN_SPCL_RT_TP_CD = CG.GEN_SPCL_RT_TP_CD
                          AND     OP.CMDT_HDR_SEQ      = CG.CMDT_HDR_SEQ
                          AND     OP.ROUT_SEQ          = CG.ROUT_SEQ
                          AND     OP.ORG_DEST_TP_CD    = 'O'
                          AND     OP.SRC_INFO_CD       <> 'AD'
                        )
                WHERE       LEVEL       = CNT
                START WITH ROW_NUMBER = 1
                CONNECT BY
                            PROP_NO           = PRIOR PROP_NO
                AND         AMDT_SEQ          = PRIOR AMDT_SEQ
                AND         SVC_SCP_CD        = PRIOR SVC_SCP_CD
                AND         GEN_SPCL_RT_TP_CD = PRIOR GEN_SPCL_RT_TP_CD
                AND         CMDT_HDR_SEQ      = PRIOR CMDT_HDR_SEQ
                AND         ROUT_SEQ          = PRIOR ROUT_SEQ
                AND         ROW_NUMBER        = PRIOR ROW_NUMBER + 1
               )   OP  ,
               (
                SELECT  PROP_NO           ,
                        AMDT_SEQ          ,
                        SVC_SCP_CD        ,
                        GEN_SPCL_RT_TP_CD ,
                        CMDT_HDR_SEQ      ,
                        ROUT_SEQ          ,
                        --LTRIM(SYS_CONNECT_BY_PATH(ORG_VIA_NM,'^|^ '),'^|^ ') ORG_VIA_NM
						LTRIM(SYS_CONNECT_BY_PATH(ORG_VIA_CD,'^|^ '),'^|^ ') ORG_VIA_CD
                FROM    (
                          SELECT  /*+ ORDERED */
                                  CG.PROP_NO           ,
                                  CG.AMDT_SEQ          ,
                                  CG.SVC_SCP_CD        ,
                                  CG.GEN_SPCL_RT_TP_CD ,
                                  CG.CMDT_HDR_SEQ      ,
                                  CG.ROUT_SEQ          ,
                                  ROW_NUMBER() OVER ( PARTITION BY CG.PROP_NO, CG.AMDT_SEQ, CG.SVC_SCP_CD, CG.GEN_SPCL_RT_TP_CD, CG.CMDT_HDR_SEQ, CG.ROUT_SEQ ORDER BY OV.ROUT_VIA_SEQ ) ROW_NUMBER   ,
                                  COUNT(1) OVER ( PARTITION BY CG.PROP_NO, CG.AMDT_SEQ, CG.SVC_SCP_CD, CG.GEN_SPCL_RT_TP_CD, CG.CMDT_HDR_SEQ, CG.ROUT_SEQ ) CNT   ,
                                  --DECODE(OV.ROUT_VIA_PORT_TP_CD, 'L', ML.LOC_NM, 'G', GL.PRC_GRP_LOC_DESC) ORG_VIA_NM
								  OV.ROUT_VIA_PORT_DEF_CD AS ORG_VIA_CD
                          FROM    (
                                    SELECT  DISTINCT
                                            PROP_NO           ,
                                            AMDT_SEQ          ,
                                            SVC_SCP_CD        ,
                                            GEN_SPCL_RT_TP_CD ,
                                            CMDT_HDR_SEQ      ,
                                            ROUT_SEQ
                                    FROM    CG
                                  )   CG                      ,
                                  PRI_SP_SCP_RT_ROUT_VIA  OV  --,
                                  --MDM_LOCATION            ML  ,
                                  --PRI_SP_SCP_GRP_LOC      GL
                          WHERE   --ML.LOC_CD(+)         = OV.ROUT_VIA_PORT_DEF_CD
                          --AND     GL.PROP_NO(+)        = OV.PROP_NO
                          --AND     GL.AMDT_SEQ(+)       = OV.AMDT_SEQ
                          --AND     GL.SVC_SCP_CD(+)     = OV.SVC_SCP_CD
                          --AND     GL.PRC_GRP_LOC_CD(+) = OV.ROUT_VIA_PORT_DEF_CD
                                  OV.PROP_NO           = CG.PROP_NO
                          AND     OV.AMDT_SEQ          = CG.AMDT_SEQ
                          AND     OV.SVC_SCP_CD        = CG.SVC_SCP_CD
                          AND     OV.GEN_SPCL_RT_TP_CD = CG.GEN_SPCL_RT_TP_CD
                          AND     OV.CMDT_HDR_SEQ      = CG.CMDT_HDR_SEQ
                          AND     OV.ROUT_SEQ          = CG.ROUT_SEQ
                          AND     OV.ORG_DEST_TP_CD    = 'O'
                          AND     OV.SRC_INFO_CD       <> 'AD'
                        )
                WHERE       LEVEL       = CNT
                START WITH ROW_NUMBER = 1
                CONNECT BY
                           PROP_NO           = PRIOR PROP_NO
                AND        AMDT_SEQ          = PRIOR AMDT_SEQ
                AND        SVC_SCP_CD        = PRIOR SVC_SCP_CD
                AND        GEN_SPCL_RT_TP_CD = PRIOR GEN_SPCL_RT_TP_CD
                AND        CMDT_HDR_SEQ      = PRIOR CMDT_HDR_SEQ
                AND        ROUT_SEQ          = PRIOR ROUT_SEQ
                AND        ROW_NUMBER        = PRIOR ROW_NUMBER + 1
               )   OV  ,
               (
                SELECT  PROP_NO           ,
                        AMDT_SEQ          ,
                        SVC_SCP_CD        ,
                        GEN_SPCL_RT_TP_CD ,
                        CMDT_HDR_SEQ      ,
                        ROUT_SEQ          ,
                        --LTRIM(SYS_CONNECT_BY_PATH(DEST_VIA_NM,'^|^ '),'^|^ ') DEST_VIA_NM
					    LTRIM(SYS_CONNECT_BY_PATH(DEST_VIA_CD,'^|^ '),'^|^ ') DEST_VIA_CD
                FROM    (
                          SELECT  /*+ ORDERED */
                                  CG.PROP_NO           ,
                                  CG.AMDT_SEQ          ,
                                  CG.SVC_SCP_CD        ,
                                  CG.GEN_SPCL_RT_TP_CD ,
                                  CG.CMDT_HDR_SEQ      ,
                                  CG.ROUT_SEQ          ,
                                  ROW_NUMBER() OVER ( PARTITION BY CG.PROP_NO, CG.AMDT_SEQ, CG.SVC_SCP_CD, CG.GEN_SPCL_RT_TP_CD, CG.CMDT_HDR_SEQ, CG.ROUT_SEQ ORDER BY DV.ROUT_VIA_SEQ ) ROW_NUMBER   ,
                                  COUNT(1) OVER ( PARTITION BY CG.PROP_NO, CG.AMDT_SEQ, CG.SVC_SCP_CD, CG.GEN_SPCL_RT_TP_CD, CG.CMDT_HDR_SEQ, CG.ROUT_SEQ ) CNT   ,
                                  --DECODE(DV.ROUT_VIA_PORT_TP_CD, 'L', ML.LOC_NM, 'G', GL.PRC_GRP_LOC_DESC) DEST_VIA_NM
								  DV.ROUT_VIA_PORT_DEF_CD AS DEST_VIA_CD
                          FROM    (
                                    SELECT  DISTINCT
                                            PROP_NO           ,
                                            AMDT_SEQ          ,
                                            SVC_SCP_CD        ,
                                            GEN_SPCL_RT_TP_CD ,
                                            CMDT_HDR_SEQ      ,
                                            ROUT_SEQ
                                    FROM    CG
                                  )   CG                      ,
                                  PRI_SP_SCP_RT_ROUT_VIA  DV  --,
                                  --MDM_LOCATION            ML  ,
                                  --PRI_SP_SCP_GRP_LOC      GL
                          WHERE   --ML.LOC_CD(+)         = DV.ROUT_VIA_PORT_DEF_CD
                          --AND     GL.PROP_NO(+)        = DV.PROP_NO
                          --AND     GL.AMDT_SEQ(+)       = DV.AMDT_SEQ
                          --AND     GL.SVC_SCP_CD(+)     = DV.SVC_SCP_CD
                          --AND     GL.PRC_GRP_LOC_CD(+) = DV.ROUT_VIA_PORT_DEF_CD
                                  DV.PROP_NO           = CG.PROP_NO
                          AND     DV.AMDT_SEQ          = CG.AMDT_SEQ
                          AND     DV.SVC_SCP_CD        = CG.SVC_SCP_CD
                          AND     DV.GEN_SPCL_RT_TP_CD = CG.GEN_SPCL_RT_TP_CD
                          AND     DV.CMDT_HDR_SEQ      = CG.CMDT_HDR_SEQ
                          AND     DV.ROUT_SEQ          = CG.ROUT_SEQ
                          AND     DV.ORG_DEST_TP_CD    = 'D'
                          AND     DV.SRC_INFO_CD       <> 'AD'
                        )
                WHERE       LEVEL       = CNT
                START WITH ROW_NUMBER = 1
                CONNECT BY
                            PROP_NO                     = PRIOR PROP_NO
                AND         AMDT_SEQ                    = PRIOR AMDT_SEQ
                AND         SVC_SCP_CD              = PRIOR SVC_SCP_CD
                AND         GEN_SPCL_RT_TP_CD   = PRIOR GEN_SPCL_RT_TP_CD
                AND         CMDT_HDR_SEQ            = PRIOR CMDT_HDR_SEQ
                AND         ROUT_SEQ                    = PRIOR ROUT_SEQ
                AND         ROW_NUMBER              = PRIOR ROW_NUMBER + 1
               )   DV  ,
               (
                SELECT  PROP_NO           ,
                        AMDT_SEQ          ,
                        SVC_SCP_CD        ,
                        GEN_SPCL_RT_TP_CD ,
                        CMDT_HDR_SEQ      ,
                        ROUT_SEQ          ,
                        --LTRIM(SYS_CONNECT_BY_PATH(DEST_NM,'^|^ '),'^|^ ') DEST_NM
                        --LTRIM(SYS_CONNECT_BY_PATH(DEST_CD,'^|^ '),'^|^ ') DEST_CD
                        LTRIM(SYS_CONNECT_BY_PATH(DEST_CD || NVL2(RCV_DE_TERM_NM, '(' || RCV_DE_TERM_NM || ')', ''),'^|^ '),'^|^ ') DEST_CD
                FROM    (
                          SELECT  /*+ ORDERED */
                                  CG.PROP_NO           ,
                                  CG.AMDT_SEQ          ,
                                  CG.SVC_SCP_CD        ,
                                  CG.GEN_SPCL_RT_TP_CD ,
                                  CG.CMDT_HDR_SEQ      ,
                                  CG.ROUT_SEQ          ,
                                  ROW_NUMBER() OVER ( PARTITION BY CG.PROP_NO, CG.AMDT_SEQ, CG.SVC_SCP_CD, CG.GEN_SPCL_RT_TP_CD, CG.CMDT_HDR_SEQ, CG.ROUT_SEQ ORDER BY DP.ROUT_PNT_SEQ ) ROW_NUMBER   ,
                                  COUNT(1) OVER ( PARTITION BY CG.PROP_NO, CG.AMDT_SEQ, CG.SVC_SCP_CD, CG.GEN_SPCL_RT_TP_CD, CG.CMDT_HDR_SEQ, CG.ROUT_SEQ ) CNT   ,
                                  --DECODE(DP.ROUT_PNT_LOC_TP_CD, 'L', ML.LOC_NM, 'G', GL.PRC_GRP_LOC_DESC) DEST_NM
								  DP.ROUT_PNT_LOC_DEF_CD AS DEST_CD
                                 --,DP.RCV_DE_TERM_CD
                                 ,(SELECT INTG_CD_VAL_DP_DESC
                                     FROM COM_INTG_CD_DTL
                                    WHERE INTG_CD_ID = 'CD02139'
                                      AND INTG_CD_VAL_CTNT = DP.RCV_DE_TERM_CD
                                      AND ROWNUM = 1) AS RCV_DE_TERM_NM
                          FROM    (
                                    SELECT  DISTINCT
                                            PROP_NO           ,
                                            AMDT_SEQ          ,
                                            SVC_SCP_CD        ,
                                            GEN_SPCL_RT_TP_CD ,
                                            CMDT_HDR_SEQ      ,
                                            ROUT_SEQ
                                    FROM    CG
                                   )   CG                      ,
                                   PRI_SP_SCP_RT_ROUT_PNT  DP  --,
                                   --MDM_LOCATION            ML  ,
                                   --PRI_SP_SCP_GRP_LOC      GL
                          WHERE    --ML.LOC_CD(+)         = DP.ROUT_PNT_LOC_DEF_CD
                          --AND      GL.PROP_NO(+)        = DP.PROP_NO
                          --AND      GL.AMDT_SEQ(+)       = DP.AMDT_SEQ
                          --AND      GL.SVC_SCP_CD(+)     = DP.SVC_SCP_CD
                          --AND      GL.PRC_GRP_LOC_CD(+) = DP.ROUT_PNT_LOC_DEF_CD
                                   DP.PROP_NO           = CG.PROP_NO
                          AND      DP.AMDT_SEQ          = CG.AMDT_SEQ
                          AND      DP.SVC_SCP_CD        = CG.SVC_SCP_CD
                          AND      DP.GEN_SPCL_RT_TP_CD = CG.GEN_SPCL_RT_TP_CD
                          AND      DP.CMDT_HDR_SEQ      = CG.CMDT_HDR_SEQ
                          AND      DP.ROUT_SEQ          = CG.ROUT_SEQ
                          AND      DP.ORG_DEST_TP_CD    = 'D'
                          AND      DP.SRC_INFO_CD       <> 'AD'
                        )
                WHERE       LEVEL       = CNT
                START WITH ROW_NUMBER = 1
                CONNECT BY
                            PROP_NO           = PRIOR PROP_NO
                AND         AMDT_SEQ          = PRIOR AMDT_SEQ
                AND         SVC_SCP_CD        = PRIOR SVC_SCP_CD
                AND         GEN_SPCL_RT_TP_CD = PRIOR GEN_SPCL_RT_TP_CD
                AND         CMDT_HDR_SEQ      = PRIOR CMDT_HDR_SEQ
                AND         ROUT_SEQ          = PRIOR ROUT_SEQ
                AND         ROW_NUMBER        = PRIOR ROW_NUMBER + 1
              )   DP
    WHERE    CP.PROP_NO              = CG.PROP_NO
    AND      CP.AMDT_SEQ             = CG.AMDT_SEQ
    AND      CP.PRC_CTRT_PTY_TP_CD   = 'C'
    AND      SQ.PROP_NO              = CG.PROP_NO
    AND      SQ.AMDT_SEQ             = CG.AMDT_SEQ
    AND      SQ.SVC_SCP_CD           = CG.SVC_SCP_CD
    AND      RC.PROP_NO(+)           = CG.PROP_NO
    AND      RC.AMDT_SEQ(+)          = CG.AMDT_SEQ
    AND      RC.SVC_SCP_CD(+)        = CG.SVC_SCP_CD
    AND      RC.GEN_SPCL_RT_TP_CD(+) = CG.GEN_SPCL_RT_TP_CD
    AND      RC.CMDT_HDR_SEQ(+)      = CG.CMDT_HDR_SEQ
    AND      AC.PROP_NO(+)           = CG.PROP_NO
    AND      AC.AMDT_SEQ(+)          = CG.AMDT_SEQ
    AND      AC.SVC_SCP_CD(+)        = CG.SVC_SCP_CD
    AND      AC.GEN_SPCL_RT_TP_CD(+) = CG.GEN_SPCL_RT_TP_CD
    AND      AC.CMDT_HDR_SEQ(+)      = CG.CMDT_HDR_SEQ
    AND      OP.PROP_NO(+)           = CG.PROP_NO
    AND      OP.AMDT_SEQ(+)          = CG.AMDT_SEQ
    AND      OP.SVC_SCP_CD(+)        = CG.SVC_SCP_CD
    AND      OP.GEN_SPCL_RT_TP_CD(+) = CG.GEN_SPCL_RT_TP_CD
    AND      OP.CMDT_HDR_SEQ(+)      = CG.CMDT_HDR_SEQ
    AND      OP.ROUT_SEQ(+)          = CG.ROUT_SEQ
    AND      OV.PROP_NO(+)           = CG.PROP_NO
    AND      OV.AMDT_SEQ(+)          = CG.AMDT_SEQ
    AND      OV.SVC_SCP_CD(+)        = CG.SVC_SCP_CD
    AND      OV.GEN_SPCL_RT_TP_CD(+) = CG.GEN_SPCL_RT_TP_CD
    AND      OV.CMDT_HDR_SEQ(+)      = CG.CMDT_HDR_SEQ
    AND      OV.ROUT_SEQ(+)          = CG.ROUT_SEQ
    AND      DV.PROP_NO(+)           = CG.PROP_NO
    AND      DV.AMDT_SEQ(+)          = CG.AMDT_SEQ
    AND      DV.SVC_SCP_CD(+)        = CG.SVC_SCP_CD
    AND      DV.GEN_SPCL_RT_TP_CD(+) = CG.GEN_SPCL_RT_TP_CD
    AND      DV.CMDT_HDR_SEQ(+)      = CG.CMDT_HDR_SEQ
    AND      DV.ROUT_SEQ(+)          = CG.ROUT_SEQ
    AND      DP.PROP_NO(+)           = CG.PROP_NO
    AND      DP.AMDT_SEQ(+)          = CG.AMDT_SEQ
    AND      DP.SVC_SCP_CD(+)        = CG.SVC_SCP_CD
    AND      DP.GEN_SPCL_RT_TP_CD(+) = CG.GEN_SPCL_RT_TP_CD
    AND      DP.CMDT_HDR_SEQ(+)      = CG.CMDT_HDR_SEQ
    AND      DP.ROUT_SEQ(+)          = CG.ROUT_SEQ

)

SELECT  T_SC.SC_NO               ,
        T_SC.PROP_NO             ,
        T_SC.CTRT_PTY_NM         ,
        T_SC.FNL_MQC_QTY         ,
        T_SC.PROP_SCP_OFC_CD     , -- 추가
        T_SC.PROP_SCP_SREP_CD    , -- 추가
        T_SC.AMDT_SEQ            ,
        T_SC.SVC_SCP_CD          ,
        T_SC.GEN_SPCL_RT_TP_CD   ,
        T_SC.CMDT_HDR_SEQ        , -- 추가
        T_SC.ROUT_SEQ            , -- 추가
        T_SC.RT_SEQ              , -- 추가
        T_SC.CMDT_NM             ,
        T_SC.ACT_CUST_NM         ,
        --REPLACE(ORG_NM     , '^|^', ';') AS ORG_NM      ,
        REPLACE(T_SC.ORG_CD     , '^|^', ';') AS ORG_CD      ,
        --REPLACE(ORG_VIA_NM , '^|^', ';') AS ORG_VIA_NM  ,
		REPLACE(T_SC.ORG_VIA_CD , '^|^', ';') AS ORG_VIA_CD  ,
        --REPLACE(DEST_VIA_NM, '^|^', ';') AS DEST_VIA_NM ,
		REPLACE(T_SC.DEST_VIA_CD, '^|^', ';') AS DEST_VIA_CD ,
        --REPLACE(DEST_NM    , '^|^', ';') AS DEST_NM     ,
		REPLACE(T_SC.DEST_CD    , '^|^', ';') AS DEST_CD     ,
        T_SC.CHG_CD              ,
        T_SC.RAT_UT_CD           ,
        T_SC.PRC_CGO_TP_CD       ,
        T_SC.CURR_CD             ,
        T_SC.FNL_FRT_RT_AMT      ,

		(SELECT  CASE WHEN COUNT(T.NOTE_CTNT) > 0 THEN 'Y' ELSE 'N' END
                FROM    PRI_SP_SCP_RT_CNOTE T
                WHERE   T.PROP_NO            = T_SC.PROP_NO
                AND     T.AMDT_SEQ           = T_SC.AMDT_SEQ
                AND     T.SVC_SCP_CD         = T_SC.SVC_SCP_CD
                AND     T.GEN_SPCL_RT_TP_CD  = T_SC.GEN_SPCL_RT_TP_CD
                AND     T.CMDT_HDR_SEQ       = T_SC.CMDT_HDR_SEQ
                AND     T.SRC_INFO_CD        <> 'AD'
                AND     T.NOTE_CTNT IS NOT NULL
        ) AS CNOTE_FLAG,

        (SELECT  CASE WHEN COUNT(T.NOTE_CTNT) > 0 THEN 'Y' ELSE 'N' END
                FROM    PRI_SP_SCP_RT_CMDT_RNOTE T
                WHERE   T.PROP_NO            = T_SC.PROP_NO
                AND     T.AMDT_SEQ           = T_SC.AMDT_SEQ
                AND     T.SVC_SCP_CD         = T_SC.SVC_SCP_CD
                AND     T.GEN_SPCL_RT_TP_CD  = T_SC.GEN_SPCL_RT_TP_CD
                AND     T.CMDT_HDR_SEQ       = T_SC.CMDT_HDR_SEQ
                AND     T.ROUT_SEQ           = T_SC.ROUT_SEQ
                AND     T.SRC_INFO_CD        <> 'AD'
        ) AS RNOTE_FLAG,
        
        (SELECT CASE WHEN COUNT(SNDO.NOTE_CTNT) > 0 THEN 'Y' ELSE 'N' END
                FROM PRI_SP_SCP_NOTE SNO, PRI_SP_SCP_NOTE_CTNT SNDO
                WHERE SNO.PROP_NO = SNDO.PROP_NO
                AND SNO.AMDT_SEQ = SNDO.AMDT_SEQ
                AND SNO.SVC_SCP_CD = SNDO.SVC_SCP_CD
                AND SNO.NOTE_TP_CD = SNDO.NOTE_TP_CD
                AND SNO.NOTE_SEQ = SNDO.NOTE_SEQ
                AND SNO.NOTE_TP_CD = 'P' --Special Note
                AND SNO.NOTE_CLSS_CD <> 'D' --O:Surcharge Exceptions S:Fixed Surcharge D:DEM/DET
                AND SNDO.SRC_INFO_CD <> 'AD' --DELETE
                AND SNO.PROP_NO = T_SC.PROP_NO
                AND SNO.AMDT_SEQ = T_SC.AMDT_SEQ
                AND SNO.SVC_SCP_CD = T_SC.SVC_SCP_CD
        ) AS SNOTE_FLAG,

        '' AS EFF_DT                    , -- param
        '' AS EXP_DT                    , -- param
        '' AS ROUT_PNT_LOC_DEF_CD_ORI   , -- param
        '' AS ROUT_PNT_LOC_DEF_CD_DEST  , -- param
        '' AS ROUT_VIA_PORT_DEF_CD_ORI  , -- param
        '' AS ROUT_VIA_PORT_DEF_CD_DEST , -- param
        '' AS PRC_CTRT_CUST_TP_CD       , -- param
        '' AS PRC_CMDT_DEF_CD           , -- param
        '' AS FNL_FRT_RT                , -- param
        '' AS FNL_MQC                     -- param
FROM        SC T_SC
WHERE   1 = 1

#if (${cmdt_nm} != '')
AND      CMDT_NM         = @[cmdt_nm] -- Commodity Group
#end

#if (${act_cust_nm} != '')
AND      ACT_CUST_NM     = @[act_cust_nm] -- Actual Customer
#end

ORDER BY
         SC_NO,
         AMDT_SEQ DESC,
         SVC_SCP_CD,
         GEN_SPCL_RT_TP_CD,
         BLET_DP_SEQ,
         --ORG_NM,
         --ORG_VIA_NM,
         --DEST_VIA_NM,
         --DEST_NM,
         RAT_UT_CD,
         PRC_CGO_TP_CD			]]></sql>
			<params>
				<param name="exp_dt" type="12" value="" out="N"/>
				<param name="eff_dt" type="12" value="" out="N"/>
				<param name="rout_pnt_loc_def_cd_ori" type="12" value="" out="N"/>
				<param name="rout_pnt_loc_def_cd_dest" type="12" value="" out="N"/>
				<param name="rout_via_port_def_cd_ori" type="12" value="" out="N"/>
				<param name="rout_via_port_def_cd_dest" type="12" value="" out="N"/>
				<param name="prc_ctrt_cust_tp_cd" type="12" value="" out="N"/>
				<param name="prc_cmdt_def_cd" type="12" value="" out="N"/>
				<param name="rat_ut_cd" type="12" value="" out="N"/>
				<param name="prc_cgo_tp_cd" type="12" value="" out="N"/>
				<param name="fnl_frt_rt_amt" type="12" value="" out="N"/>
				<param name="fnl_mqc_qty" type="12" value="" out="N"/>
				<param name="prop_scp_ofc_cd" type="12" value="" out="N"/>
				<param name="prop_scp_srep_cd" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="gen_spcl_rt_tp_cd" type="12" value="" out="N"/>
				<param name="cmdt_nm" type="12" value="" out="N"/>
				<param name="act_cust_nm" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
