<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AncsManifestListDownloadDBDAOaddSelectBkgCstmsAnrNtfyCSQL">
			<desc><![CDATA[INSERT]]></desc>
			<sql><![CDATA[
INSERT INTO BKG_CSTMS_ANR_NTFY (
BKG_NO, NTFY_SEQ,
BL_NO, NTFY_NM, NTFY_ADDR, FAX_NO, 
NTFY_EML, CHG_DP_FLG, DIFF_RMK,
CRE_OFC_CD, UPD_OFC_CD, CRE_USR_ID, 
CRE_DT, UPD_USR_ID, UPD_DT)
SELECT B.BKG_NO, 1
, A.BL_NO,SUBSTR(B.CUST_NM,1,100), B.CUST_ADDR, CUST_FAX_NO, 
CUST_EML, 'N', NULL
, @[cre_ofc_cd]
, @[upd_ofc_cd] 
, @[cre_usr_id]
, SYSDATE
, @[upd_usr_id]
, SYSDATE
FROM BKG_CSTMS_ANR_BL A, BKG_CUSTOMER B, BKG_VVD V
WHERE A.VSL_CD = substr(@[vvd],1,4)
AND A.SKD_VOY_NO = substr(@[vvd],5,4)
AND A.SKD_DIR_CD = substr(@[vvd],9,1)
AND B.BKG_NO = A.BKG_NO
AND B.BKG_CUST_TP_CD = 'N'

AND A.BKG_NO = V.BKG_NO
AND A.VSL_CD = V.VSL_CD
AND A.SKD_VOY_NO = V.SKD_VOY_NO
AND A.SKD_DIR_CD = V.SKD_DIR_CD
AND V.POL_CLPT_IND_SEQ = @[pol_clpt_ind_seq]
AND V.POD_CLPT_IND_SEQ = @[pod_clpt_ind_seq]

#if (${chk_down} == 'Y' || ${chk_down} == 'C') 
AND NOT EXISTS (SELECT '*' FROM BKG_CSTMS_ANR_NTFY C WHERE C.BKG_NO = A.BKG_NO AND C.NTFY_SEQ = 1)
#else 
AND NOT EXISTS (SELECT '*' FROM BKG_CSTMS_ANR_NTFY C WHERE C.BKG_NO = A.BKG_NO)
#end			]]></sql>
			<params>
				<param name="cre_ofc_cd" type="12" value="" out="N"/>
				<param name="upd_ofc_cd" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="pol_clpt_ind_seq" type="12" value="" out="N"/>
				<param name="pod_clpt_ind_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
