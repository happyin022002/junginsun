/*=========================================================
*Copyright(c) 2016 CyberLogitec
*@FileName : SCReportDBDAORsltMOTFilingLogRSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2016.04.21
*@LastModifier : 
*@LastVersion : 1.0
* 2016.04.21 
* 1.0 Creation
=========================================================*/
package com.clt.apps.opus.esm.pri.screport.screport.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.clt.framework.support.db.ISQLTemplate;

/**
 *
 * @author 
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class SCReportDBDAORsltMOTFilingLogRSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * retrieve filing log
	  * </pre>
	  */
	public SCReportDBDAORsltMOTFilingLogRSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("to_file_dt",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("fr_file_dt",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.clt.apps.opus.esm.pri.screport.screport.integration").append("\n"); 
		query.append("FileName : SCReportDBDAORsltMOTFilingLogRSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("WITH CHG_INFO AS" ).append("\n"); 
		query.append(" (  SELECT" ).append("\n"); 
		query.append("           CHG_CD, CHG_NM, CHG_CD AS CHG_CD1, CURR_FLG, XCH_RT_FLG, RMK_FLG, ORG_DEST_TP_CD" ).append("\n"); 
		query.append("      FROM PRI_MOT_CHG" ).append("\n"); 
		query.append(" ), " ).append("\n"); 
		query.append(" CHG_LST AS" ).append("\n"); 
		query.append(" (  SELECT" ).append("\n"); 
		query.append("           Y.IND, Y.CHG_CD, Y.CHG_NM, Y.RMK_FLG, Y.CHG_TY, ROW_NUMBER() OVER(PARTITION BY Y.CHG_CD ORDER BY Y.CHG_TY ) AS IND_SEQ" ).append("\n"); 
		query.append("      FROM (SELECT " ).append("\n"); 
		query.append("                   ROWNUM AS IND" ).append("\n"); 
		query.append("                 , X.CHG_CD" ).append("\n"); 
		query.append("                 , X.CHG_NM" ).append("\n"); 
		query.append("                 , X.RMK_FLG" ).append("\n"); 
		query.append("                 , CASE WHEN X.CHG_GB = 'CURR_FLG' AND X.CHG_TP = 'Y' THEN X.CHG_CD||'_CUR'" ).append("\n"); 
		query.append("                        WHEN X.CHG_GB = 'XCH_RT_FLG' AND X.CHG_TP = 'Y' THEN X.CHG_CD||'_EXE'" ).append("\n"); 
		query.append("                        ELSE X.CHG_TP" ).append("\n"); 
		query.append("                    END CHG_TY" ).append("\n"); 
		query.append("              FROM CHG_INFO" ).append("\n"); 
		query.append("              UNPIVOT " ).append("\n"); 
		query.append("              ( " ).append("\n"); 
		query.append("                CHG_TP FOR CHG_GB IN ( CHG_CD1, CURR_FLG, XCH_RT_FLG  ) " ).append("\n"); 
		query.append("              ) X" ).append("\n"); 
		query.append("             WHERE X.CHG_TP <> 'N') Y" ).append("\n"); 
		query.append("    ORDER BY Y.IND),      " ).append("\n"); 
		query.append("CHG_RST AS      " ).append("\n"); 
		query.append("(  " ).append("\n"); 
		query.append("  SELECT DISTINCT" ).append("\n"); 
		query.append("         A.BAT_EXE_DT" ).append("\n"); 
		query.append("       , ( SELECT B.INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL B WHERE B.INTG_CD_ID = 'CD03281' AND B.INTG_CD_VAL_CTNT = A.BKG_SRC_TP_CD ) AS BKG_SRC_TP_CD" ).append("\n"); 
		query.append("       , A.BKG_NO" ).append("\n"); 
		query.append("       , A.CTRT_NO" ).append("\n"); 
		query.append("       , A.CTRT_HLD_NM                " ).append("\n"); 
		query.append("       , A.ACT_CUST_NM" ).append("\n"); 
		query.append("       , A.CNEE_NM" ).append("\n"); 
		query.append("       , A.OP_AGN_NM" ).append("\n"); 
		query.append("       , A.MOT_FILE_LANE_CD" ).append("\n"); 
		query.append("       , A.MOT_FILE_ORG_CD" ).append("\n"); 
		query.append("       , A.MOT_FILE_DEST_CD" ).append("\n"); 
		query.append("       , A.MOT_FILE_CNTR_TP_CD" ).append("\n"); 
		query.append("       , A.MOT_FILE_CMDT_TP_CD" ).append("\n"); 
		query.append("       , A.MOT_FILE_CNTR_SZ_CD" ).append("\n"); 
		query.append("       , A.MOT_FILE_RT_AMT" ).append("\n"); 
		query.append("	   , CASE WHEN (B.CHG_CD = 'DOC' AND B.CURR_CD <> 'CNY') THEN TRUNC(" ).append("\n"); 
		query.append("            CASE WHEN DECODE( NVL((SELECT DISTINCT V_EX_RATE FROM TABLE( BKG_EXCH_RATE_PKG.GET_EXCH_RATE_FNC(A.BKG_NO, 'P', '') ) WHERE V_AR_CURR_CD = 'CNY' AND V_CURR_CD = B.CURR_CD), ''), '', -1,0,-1, 1) = 1 " ).append("\n"); 
		query.append("                      THEN (SELECT DISTINCT V_EX_RATE FROM TABLE( BKG_EXCH_RATE_PKG.GET_EXCH_RATE_FNC(A.BKG_NO, 'P', '') ) WHERE V_AR_CURR_CD = 'CNY' AND V_CURR_CD = B.CURR_CD) * B.MOT_FILE_CHG_AMT" ).append("\n"); 
		query.append("                 WHEN DECODE( NVL((SELECT ROUND(SAR_GET_GL_XCH_RT_FNC('1', (SELECT TO_CHAR(BT.RT_APLY_DT,'YYYYMMDD') FROM BKG_RATE WHERE BKG_NO = A.BKG_NO),B.CURR_CD,'CNY'),2) FROM DUAL), ''), '', -1,0,-1, 1) = 1 " ).append("\n"); 
		query.append("                      THEN (SELECT ROUND(SAR_GET_GL_XCH_RT_FNC('1', (SELECT TO_CHAR(RT_APLY_DT,'YYYYMMDD') FROM BKG_RATE WHERE BKG_NO = A.BKG_NO),B.CURR_CD,'CNY'),2) FROM DUAL) * B.MOT_FILE_CHG_AMT" ).append("\n"); 
		query.append("                 WHEN DECODE( NVL((SELECT ROUND(SAR_GET_GL_XCH_RT_FNC('1', (SELECT TO_CHAR(TO_DATE(SUBSTR(TO_CHAR(BT.RT_APLY_DT,'YYYYMMDD'),1,6)||'01','YYYYMMDD')-1,'YYYYMMDD') FROM BKG_RATE WHERE BKG_NO = A.BKG_NO),B.CURR_CD,'CNY'),2) FROM DUAL), ''), '', -1, 1) = 1 " ).append("\n"); 
		query.append("                      THEN (SELECT ROUND(SAR_GET_GL_XCH_RT_FNC('1', (SELECT TO_CHAR(TO_DATE(SUBSTR(TO_CHAR(BT.RT_APLY_DT,'YYYYMMDD'),1,6)||'01','YYYYMMDD')-1,'YYYYMMDD') FROM BKG_RATE WHERE BKG_NO = A.BKG_NO),B.CURR_CD,'CNY'),2) FROM DUAL) * B.MOT_FILE_CHG_AMT" ).append("\n"); 
		query.append("            ELSE B.MOT_FILE_CHG_AMT END) ELSE B.MOT_FILE_CHG_AMT" ).append("\n"); 
		query.append("          END MOT_FILE_CHG_AMT" ).append("\n"); 
		query.append("       , A.CTRT_EFF_DT" ).append("\n"); 
		query.append("       , A.CTRT_EXP_DT" ).append("\n"); 
		query.append("       , B.CHG_CD" ).append("\n"); 
		query.append("       , B.CURR_CD" ).append("\n"); 
		query.append("       --, B.MOT_FILE_CHG_AMT" ).append("\n"); 
		query.append("       , CHG.RMK_FLG" ).append("\n"); 
		query.append("       , CHG.CHG_TY" ).append("\n"); 
		query.append("       , CHG.IND_SEQ" ).append("\n"); 
		query.append("       , CHG.CHG_NM" ).append("\n"); 
		query.append("       , GCUR.USD_LOCL_XCH_RT" ).append("\n"); 
		query.append("       , A.SHPR_CNT_CD " ).append("\n"); 
		query.append("       , A.SHPR_SEQ" ).append("\n"); 
		query.append("       , BD.SOC_FLG" ).append("\n"); 
		query.append("       , BT.FRT_TERM_CD" ).append("\n"); 
		query.append("       , A.FWRD_CNT_CD" ).append("\n"); 
		query.append("       , A.FWRD_CUST_SEQ" ).append("\n"); 
		query.append("       , CASE WHEN BD.DCGO_FLG    = 'Y' THEN 'DG'" ).append("\n"); 
		query.append("              WHEN BD.AWK_CGO_FLG = 'Y' THEN 'AK'" ).append("\n"); 
		query.append("              WHEN BD.RC_FLG      = 'Y' THEN 'RF'" ).append("\n"); 
		query.append("              WHEN BD.BB_CGO_FLG  = 'Y' THEN 'BB'" ).append("\n"); 
		query.append("              ELSE 'DR'" ).append("\n"); 
		query.append("         END CGO_TP_CD" ).append("\n"); 
		query.append("       , (SELECT VVD1.SLAN_CD AS VSL_SLAN_CD " ).append("\n"); 
		query.append("            FROM BKG_VVD VVD1" ).append("\n"); 
		query.append("           WHERE 1=1" ).append("\n"); 
		query.append("             AND VVD1.BKG_NO = A.BKG_NO" ).append("\n"); 
		query.append("             AND VVD1.POL_CD = A.MOT_FILE_ORG_CD" ).append("\n"); 
		query.append("             AND VVD1.VSL_PRE_PST_CD||VVD1.VSL_SEQ = ( SELECT MIN(VSL_PRE_PST_CD||VSL_SEQ) FROM BKG_VVD VVD2 WHERE VVD2.BKG_NO = VVD1.BKG_NO)" ).append("\n"); 
		query.append("             AND ROWNUM =1) AS VSL_SLAN_CD" ).append("\n"); 
		query.append("    FROM PRI_MOT_FILE_RT_LOG A" ).append("\n"); 
		query.append("       , PRI_MOT_FILE_RT_LOG_DTL B" ).append("\n"); 
		query.append("       , GL_MON_XCH_RT GCUR" ).append("\n"); 
		query.append("       , CHG_LST CHG" ).append("\n"); 
		query.append("       , BKG_QTY_DTL BD" ).append("\n"); 
		query.append("       , BKG_CHG_RT  BR" ).append("\n"); 
		query.append("       , BKG_RATE BT" ).append("\n"); 
		query.append("   WHERE A.BAT_EXE_DT = B.BAT_EXE_DT" ).append("\n"); 
		query.append("     AND A.MOT_FILE_RT_LOG_SEQ = B.MOT_FILE_RT_LOG_SEQ" ).append("\n"); 
		query.append("     AND A.BAT_EXE_DT BETWEEN TO_DATE (@[fr_file_dt], 'YYYY-MM-DD' ) AND TO_DATE (@[to_file_dt], 'YYYY-MM-DD' )" ).append("\n"); 
		query.append("     AND B.CURR_CD = GCUR.CURR_CD" ).append("\n"); 
		query.append("     AND GCUR.ACCT_XCH_RT_YRMON BETWEEN SUBSTR(REPLACE(@[fr_file_dt],'-',''),1,6) AND SUBSTR(REPLACE(@[to_file_dt],'-',''),1,6)" ).append("\n"); 
		query.append("     AND GCUR.ACCT_XCH_RT_LVL = 1" ).append("\n"); 
		query.append("     AND GCUR.DELT_FLG = 'N'" ).append("\n"); 
		query.append("     AND B.CHG_CD = CHG.CHG_CD " ).append("\n"); 
		query.append("     AND A.BKG_NO = BD.BKG_NO" ).append("\n"); 
		query.append("     AND A.BKG_NO = BR.BKG_NO " ).append("\n"); 
		query.append("     AND B.CHG_CD = BR.CHG_CD" ).append("\n"); 
		query.append("     AND A.BKG_NO = BT.BKG_NO" ).append("\n"); 
		query.append("     AND BR.FRT_INCL_XCLD_DIV_CD <> 'I')" ).append("\n"); 
		query.append(", CHG_RST_RMK AS (" ).append("\n"); 
		query.append("SELECT DISTINCT" ).append("\n"); 
		query.append("       A.BAT_EXE_DT" ).append("\n"); 
		query.append("     , A.BKG_NO" ).append("\n"); 
		query.append("     , A.CTRT_NO" ).append("\n"); 
		query.append("     , A.CTRT_HLD_NM" ).append("\n"); 
		query.append("     , A.ACT_CUST_NM" ).append("\n"); 
		query.append("     , A.CNEE_NM" ).append("\n"); 
		query.append("     , A.MOT_FILE_LANE_CD" ).append("\n"); 
		query.append("     , A.MOT_FILE_ORG_CD" ).append("\n"); 
		query.append("     , A.MOT_FILE_DEST_CD" ).append("\n"); 
		query.append("     , A.MOT_FILE_CNTR_TP_CD" ).append("\n"); 
		query.append("     , A.MOT_FILE_CMDT_TP_CD" ).append("\n"); 
		query.append("     , A.MOT_FILE_CNTR_SZ_CD" ).append("\n"); 
		query.append("     , A.MOT_FILE_RT_AMT" ).append("\n"); 
		query.append("     , LISTAGG( CASE WHEN A.CHG_NM IS NOT NULL THEN ' '||A.CHG_NM||' in '||A.CURR_CD END , ',' ) WITHIN GROUP (ORDER BY A.CHG_NM) OVER (PARTITION BY A.BAT_EXE_DT" ).append("\n"); 
		query.append("                           , A.BKG_NO" ).append("\n"); 
		query.append("                           , A.CTRT_NO" ).append("\n"); 
		query.append("                           , A.CTRT_HLD_NM" ).append("\n"); 
		query.append("                           , A.ACT_CUST_NM" ).append("\n"); 
		query.append("                           , A.CNEE_NM" ).append("\n"); 
		query.append("                           , A.MOT_FILE_LANE_CD" ).append("\n"); 
		query.append("                           , A.MOT_FILE_ORG_CD" ).append("\n"); 
		query.append("                           , A.MOT_FILE_DEST_CD" ).append("\n"); 
		query.append("                           , A.MOT_FILE_CNTR_TP_CD" ).append("\n"); 
		query.append("                           , A.MOT_FILE_CMDT_TP_CD" ).append("\n"); 
		query.append("                           , A.MOT_FILE_CNTR_SZ_CD" ).append("\n"); 
		query.append("                           , A.MOT_FILE_RT_AMT) AS RMK" ).append("\n"); 
		query.append("FROM ( SELECT" ).append("\n"); 
		query.append("               A.BAT_EXE_DT" ).append("\n"); 
		query.append("             , A.BKG_NO" ).append("\n"); 
		query.append("             , A.CTRT_NO" ).append("\n"); 
		query.append("             , A.CTRT_HLD_NM" ).append("\n"); 
		query.append("             , A.ACT_CUST_NM" ).append("\n"); 
		query.append("             , A.CNEE_NM" ).append("\n"); 
		query.append("             , A.MOT_FILE_LANE_CD" ).append("\n"); 
		query.append("             , A.MOT_FILE_ORG_CD" ).append("\n"); 
		query.append("             , A.MOT_FILE_DEST_CD" ).append("\n"); 
		query.append("             , A.MOT_FILE_CNTR_TP_CD" ).append("\n"); 
		query.append("             , A.MOT_FILE_CMDT_TP_CD" ).append("\n"); 
		query.append("             , A.MOT_FILE_CNTR_SZ_CD" ).append("\n"); 
		query.append("             , A.MOT_FILE_RT_AMT" ).append("\n"); 
		query.append("             , CASE WHEN A.ORG_DEST_TP_CD = 'O' AND A.CURR_CD <> ORG_CURR_CD THEN A.CHG_NM" ).append("\n"); 
		query.append("                    WHEN A.ORG_DEST_TP_CD = 'D' AND A.CURR_CD <> DES_CURR_CD THEN A.CHG_NM" ).append("\n"); 
		query.append("                END CHG_NM" ).append("\n"); 
		query.append("             , CASE WHEN A.ORG_DEST_TP_CD = 'O' AND A.CURR_CD <> ORG_CURR_CD THEN A.CURR_CD" ).append("\n"); 
		query.append("                    WHEN A.ORG_DEST_TP_CD = 'D' AND A.CURR_CD <> DES_CURR_CD THEN A.CURR_CD" ).append("\n"); 
		query.append("                END CURR_CD" ).append("\n"); 
		query.append("          FROM (SELECT DISTINCT" ).append("\n"); 
		query.append("                      A.BAT_EXE_DT" ).append("\n"); 
		query.append("                    , A.BKG_NO" ).append("\n"); 
		query.append("                    , A.CTRT_NO" ).append("\n"); 
		query.append("                    , A.CTRT_HLD_NM" ).append("\n"); 
		query.append("                    , A.ACT_CUST_NM" ).append("\n"); 
		query.append("                    , A.CNEE_NM" ).append("\n"); 
		query.append("                    , A.MOT_FILE_LANE_CD" ).append("\n"); 
		query.append("                    , A.MOT_FILE_ORG_CD" ).append("\n"); 
		query.append("                    , A.MOT_FILE_DEST_CD" ).append("\n"); 
		query.append("                    , A.MOT_FILE_CNTR_TP_CD" ).append("\n"); 
		query.append("                    , A.MOT_FILE_CMDT_TP_CD" ).append("\n"); 
		query.append("                    , A.MOT_FILE_CNTR_SZ_CD" ).append("\n"); 
		query.append("                    , A.MOT_FILE_RT_AMT" ).append("\n"); 
		query.append("                    , A.CHG_NM" ).append("\n"); 
		query.append("                    , A.CURR_CD" ).append("\n"); 
		query.append("                    , B.ORG_DEST_TP_CD" ).append("\n"); 
		query.append("                    , ( SELECT CURR_CD FROM MDM_COUNTRY WHERE CNT_CD = SUBSTR(A.MOT_FILE_ORG_CD,1,2) ) AS ORG_CURR_CD" ).append("\n"); 
		query.append("                    , ( SELECT CURR_CD FROM MDM_COUNTRY WHERE CNT_CD = SUBSTR(A.MOT_FILE_DEST_CD,1,2) ) AS DES_CURR_CD" ).append("\n"); 
		query.append("                 FROM CHG_RST A" ).append("\n"); 
		query.append("                    , PRI_MOT_CHG B" ).append("\n"); 
		query.append("                WHERE A.CHG_CD = B.CHG_CD" ).append("\n"); 
		query.append("                  AND A.RMK_FLG = 'Y' " ).append("\n"); 
		query.append("                  AND A.IND_SEQ = 1 " ).append("\n"); 
		query.append("                  AND 'CUR' <> SUBSTR(A.CHG_TY, -3, LENGTH(A.CHG_TY))" ).append("\n"); 
		query.append("                  AND 'EXE' <> SUBSTR(A.CHG_TY, -3, LENGTH(A.CHG_TY)) ) A ) A" ).append("\n"); 
		query.append("  " ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("SELECT" ).append("\n"); 
		query.append("        DISTINCT ROW_NUMBER () OVER ( PARTITION BY T.BAT_EXE_DT ORDER BY T.CTRT_NO) AS SEQ, T.*" ).append("\n"); 
		query.append("  FROM (" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("SELECT A.NID " ).append("\n"); 
		query.append("     , TO_CHAR (A.BAT_EXE_DT, 'YYYY-MM-DD' ) AS BAT_EXE_DT" ).append("\n"); 
		query.append("     , A.CARRIER" ).append("\n"); 
		query.append("     , A.CTRT_NO" ).append("\n"); 
		query.append("     , A.SHPR_CNT_CD " ).append("\n"); 
		query.append("     , A.SHPR_SEQ " ).append("\n"); 
		query.append("     , A.CTRT_HLD_NM" ).append("\n"); 
		query.append("     , A.BKG_SHPR_NM" ).append("\n"); 
		query.append("     , A.BKG_CNEE_NM" ).append("\n"); 
		query.append("     , A.FORE_TRA_COMP" ).append("\n"); 
		query.append("     , A.OPER_AGT" ).append("\n"); 
		query.append("     , A.LANE" ).append("\n"); 
		query.append("     , A.WAY_PORT " ).append("\n"); 
		query.append("     , A.POL_CD" ).append("\n"); 
		query.append("     , A.DEPT_TSIT_PORT" ).append("\n"); 
		query.append("     , A.DEST_TSIT_PORT" ).append("\n"); 
		query.append("     , A.POD_CD" ).append("\n"); 
		query.append("     , A.TRANS_TERM" ).append("\n"); 
		query.append("     , A.CNTR_TP" ).append("\n"); 
		query.append("     , A.CMDT_TP" ).append("\n"); 
		query.append("     , A.CNTR_SZ" ).append("\n"); 
		query.append("     , A.CNTR_VOL1" ).append("\n"); 
		query.append("     , A.CNTR_VOL2" ).append("\n"); 
		query.append("     , A.OFT_RT" ).append("\n"); 
		query.append("     , A.EFF_DT" ).append("\n"); 
		query.append("     , A.EXP_DT" ).append("\n"); 
		query.append("     , A.REMARK" ).append("\n"); 
		query.append("     , A.CHG_TY" ).append("\n"); 
		query.append("     , A.CHG_VAL" ).append("\n"); 
		query.append("  FROM ( " ).append("\n"); 
		query.append("SELECT" ).append("\n"); 
		query.append("       DENSE_RANK() OVER(PARTITION BY A.BAT_EXE_DT ORDER BY A.BAT_EXE_DT,A.CTRT_NO, A.BKG_NO) AS NID," ).append("\n"); 
		query.append("       A.*" ).append("\n"); 
		query.append("  FROM (SELECT " ).append("\n"); 
		query.append("               A.BAT_EXE_DT" ).append("\n"); 
		query.append("             , A.BKG_SRC_TP_CD" ).append("\n"); 
		query.append("             , COM_ConstantMgr_PKG.COM_getCompanyCode_FNC() AS CARRIER" ).append("\n"); 
		query.append("             , A.BKG_NO" ).append("\n"); 
		query.append("             , A.CTRT_NO" ).append("\n"); 
		query.append("             , A.SHPR_CNT_CD " ).append("\n"); 
		query.append("             , A.SHPR_SEQ " ).append("\n"); 
		query.append("             , A.CTRT_HLD_NM                               --Contractor" ).append("\n"); 
		query.append("             , A.ACT_CUST_NM           AS BKG_SHPR_NM      --Shipper" ).append("\n"); 
		query.append("             , A.CNEE_NM               AS BKG_CNEE_NM      --Consingnee" ).append("\n"); 
		query.append("             , NULL                    AS FORE_TRA_COMP" ).append("\n"); 
		query.append("             , A.OP_AGN_NM             AS OPER_AGT         --Operation Agent" ).append("\n"); 
		query.append("             , A.MOT_FILE_LANE_CD      AS LANE" ).append("\n"); 
		query.append("             , NULL                    AS WAY_PORT " ).append("\n"); 
		query.append("             , A.MOT_FILE_ORG_CD       AS POL_CD" ).append("\n"); 
		query.append("             , NULL                    AS DEPT_TSIT_PORT" ).append("\n"); 
		query.append("             , NULL                    AS DEST_TSIT_PORT" ).append("\n"); 
		query.append("             , A.MOT_FILE_DEST_CD      AS POD_CD" ).append("\n"); 
		query.append("             , NULL                    AS TRANS_TERM" ).append("\n"); 
		query.append("             , A.MOT_FILE_CNTR_TP_CD   AS CNTR_TP" ).append("\n"); 
		query.append("             , A.MOT_FILE_CMDT_TP_CD   AS CMDT_TP" ).append("\n"); 
		query.append("             , A.MOT_FILE_CNTR_SZ_CD   AS CNTR_SZ" ).append("\n"); 
		query.append("             , NULL                    AS CNTR_VOL1" ).append("\n"); 
		query.append("             , NULL                    AS CNTR_VOL2" ).append("\n"); 
		query.append("             , A.MOT_FILE_RT_AMT       AS OFT_RT" ).append("\n"); 
		query.append("             , TO_CHAR (A.CTRT_EFF_DT, 'YYYY-MM-DD' ) AS EFF_DT" ).append("\n"); 
		query.append("             , TO_CHAR (A.CTRT_EXP_DT, 'YYYY-MM-DD' ) AS EXP_DT" ).append("\n"); 
		query.append("             , ('Subject to special surcharges and other surcharges if any'||X.RMK) AS REMARK" ).append("\n"); 
		query.append("             , A.CHG_TY" ).append("\n"); 
		query.append("             --, A.SOC_FLG" ).append("\n"); 
		query.append("             --, A.FRT_TERM_CD" ).append("\n"); 
		query.append("             --, A.CURR_CD" ).append("\n"); 
		query.append("             , CASE WHEN SUBSTR(A.CHG_TY, -3, LENGTH(A.CHG_TY)) = 'CUR' THEN A.CURR_CD" ).append("\n"); 
		query.append("                    WHEN SUBSTR(A.CHG_TY, -3, LENGTH(A.CHG_TY)) = 'EXE' THEN TO_CHAR( A.USD_LOCL_XCH_RT )" ).append("\n"); 
		query.append("                    ELSE TO_CHAR( A.MOT_FILE_CHG_AMT )" ).append("\n"); 
		query.append("                END CHG_VAL" ).append("\n"); 
		query.append("          FROM CHG_RST A" ).append("\n"); 
		query.append("             , CHG_RST_RMK X" ).append("\n"); 
		query.append("         WHERE X.BAT_EXE_DT = A.BAT_EXE_DT" ).append("\n"); 
		query.append("        AND X.BKG_NO = A.BKG_NO" ).append("\n"); 
		query.append("        AND X.CTRT_NO = A.CTRT_NO" ).append("\n"); 
		query.append("        AND NVL(X.CTRT_HLD_NM,'1') = NVL(A.CTRT_HLD_NM,'1')" ).append("\n"); 
		query.append("        AND NVL(X.ACT_CUST_NM,'1') = NVL(A.ACT_CUST_NM,'1')" ).append("\n"); 
		query.append("        AND NVL(X.CNEE_NM,'1') = NVL(A.CNEE_NM,'1')" ).append("\n"); 
		query.append("        AND X.MOT_FILE_LANE_CD = A.MOT_FILE_LANE_CD" ).append("\n"); 
		query.append("        AND X.MOT_FILE_ORG_CD = A.MOT_FILE_ORG_CD" ).append("\n"); 
		query.append("        AND X.MOT_FILE_DEST_CD = A.MOT_FILE_DEST_CD" ).append("\n"); 
		query.append("        AND X.MOT_FILE_CNTR_TP_CD = A.MOT_FILE_CNTR_TP_CD" ).append("\n"); 
		query.append("        AND X.MOT_FILE_CNTR_SZ_CD = A.MOT_FILE_CNTR_SZ_CD" ).append("\n"); 
		query.append("        AND X.MOT_FILE_RT_AMT  = A.MOT_FILE_RT_AMT" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("         UNION ALL" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        SELECT" ).append("\n"); 
		query.append("               A.BAT_EXE_DT" ).append("\n"); 
		query.append("             , A.BKG_SRC_TP_CD" ).append("\n"); 
		query.append("             , COM_ConstantMgr_PKG.COM_getCompanyCode_FNC() AS CARRIER" ).append("\n"); 
		query.append("             , A.BKG_NO" ).append("\n"); 
		query.append("             , A.CTRT_NO" ).append("\n"); 
		query.append("             , A.SHPR_CNT_CD " ).append("\n"); 
		query.append("             , A.SHPR_SEQ " ).append("\n"); 
		query.append("             , A.CTRT_HLD_NM                               --Contractor" ).append("\n"); 
		query.append("             , A.ACT_CUST_NM           AS BKG_SHPR_NM      --Shipper" ).append("\n"); 
		query.append("             , A.CNEE_NM               AS BKG_CNEE_NM      --Consingnee" ).append("\n"); 
		query.append("             , NULL                    AS FORE_TRA_COMP" ).append("\n"); 
		query.append("             , A.OP_AGN_NM             AS OPER_AGT         --Operation Agent" ).append("\n"); 
		query.append("             , A.LANE" ).append("\n"); 
		query.append("             , NULL                    AS WAY_PORT " ).append("\n"); 
		query.append("             , A.POL_CD" ).append("\n"); 
		query.append("             , NULL                    AS DEPT_TSIT_PORT" ).append("\n"); 
		query.append("             , NULL                    AS DEST_TSIT_PORT" ).append("\n"); 
		query.append("             , A.POD_CD" ).append("\n"); 
		query.append("             , NULL                    AS TRANS_TERM" ).append("\n"); 
		query.append("             , A.CNTR_TP" ).append("\n"); 
		query.append("             , A.CMDT_TP" ).append("\n"); 
		query.append("             , A.CNTR_SZ" ).append("\n"); 
		query.append("             , NULL                    AS CNTR_VOL1" ).append("\n"); 
		query.append("             , NULL                    AS CNTR_VOL2" ).append("\n"); 
		query.append("             , A.MOT_FILE_RT_AMT       AS OFT_RT" ).append("\n"); 
		query.append("             , TO_CHAR (A.CTRT_EFF_DT, 'YYYY-MM-DD' ) AS EFF_DT" ).append("\n"); 
		query.append("             , TO_CHAR (A.CTRT_EXP_DT, 'YYYY-MM-DD' ) AS EXP_DT" ).append("\n"); 
		query.append("             , ('Subject to special surcharges and other surcharges if any'||X.RMK) AS REMARK" ).append("\n"); 
		query.append("             , A.CHG_TY" ).append("\n"); 
		query.append("             --, A.SOC_FLG" ).append("\n"); 
		query.append("             --, A.FRT_TERM_CD" ).append("\n"); 
		query.append("             --, A.CURR_CD" ).append("\n"); 
		query.append("             , CASE WHEN A.CHG_TY = 'BKF' " ).append("\n"); 
		query.append("                         THEN  " ).append("\n"); 
		query.append("                               CASE WHEN A.POL_CD = 'CNSHA' AND B.POR_CD <> 'CNTCN' AND B.BKG_OFC_CD <> 'NKGBB' THEN TO_CHAR(A.COMM_AMT)" ).append("\n"); 
		query.append("                                    WHEN A.POL_CD <> 'CNSHA' THEN TO_CHAR(A.COMM_AMT)" ).append("\n"); 
		query.append("                                    ELSE NULL" ).append("\n"); 
		query.append("                                END                      " ).append("\n"); 
		query.append("                    ELSE TO_CHAR(A.COMM_AMT)" ).append("\n"); 
		query.append("                END CHG_VAL" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("          FROM (SELECT " ).append("\n"); 
		query.append("                       X.BAT_EXE_DT" ).append("\n"); 
		query.append("                     , X.BKG_SRC_TP_CD" ).append("\n"); 
		query.append("                     , X.BKG_NO" ).append("\n"); 
		query.append("                     , X.CTRT_NO" ).append("\n"); 
		query.append("                     , X.CTRT_HLD_NM                " ).append("\n"); 
		query.append("                     , X.ACT_CUST_NM" ).append("\n"); 
		query.append("                     , X.CNEE_NM" ).append("\n"); 
		query.append("                     , X.OP_AGN_NM" ).append("\n"); 
		query.append("                     , X.LANE" ).append("\n"); 
		query.append("                     , X.POL_CD" ).append("\n"); 
		query.append("                     , X.POD_CD" ).append("\n"); 
		query.append("                     , X.CNTR_TP" ).append("\n"); 
		query.append("                     , X.CMDT_TP" ).append("\n"); 
		query.append("                     , X.CNTR_SZ" ).append("\n"); 
		query.append("                     , X.MOT_FILE_RT_AMT" ).append("\n"); 
		query.append("                     , X.CTRT_EFF_DT" ).append("\n"); 
		query.append("                     , X.CTRT_EXP_DT" ).append("\n"); 
		query.append("                     , X.CHG_CD" ).append("\n"); 
		query.append("                     , X.CURR_CD" ).append("\n"); 
		query.append("                     , X.MOT_FILE_CHG_AMT" ).append("\n"); 
		query.append("                     , X.RMK_FLG" ).append("\n"); 
		query.append("                     , X.CHG_TY" ).append("\n"); 
		query.append("                     , X.IND_SEQ" ).append("\n"); 
		query.append("                     , X.CHG_NM" ).append("\n"); 
		query.append("                     , X.USD_LOCL_XCH_RT" ).append("\n"); 
		query.append("                     , X.SHPR_CNT_CD " ).append("\n"); 
		query.append("                     , X.SHPR_SEQ " ).append("\n"); 
		query.append("                     --, X.SOC_FLG" ).append("\n"); 
		query.append("                     --, X.FRT_TERM_CD" ).append("\n"); 
		query.append("                     , CASE WHEN X.CHG_TY = 'BKF' AND X.PNT < 6001 THEN 0" ).append("\n"); 
		query.append("                            WHEN X.CHG_TY = 'COM' AND X.PNT < 4001 THEN 0" ).append("\n"); 
		query.append("                            ELSE X.COMM_AMT" ).append("\n"); 
		query.append("                        END COMM_AMT" ).append("\n"); 
		query.append("                     , X.PNT" ).append("\n"); 
		query.append("                     , RANK() OVER (PARTITION BY X.BKG_NO, X.CHG_CD, X.LANE ORDER BY X.BKG_NO, X.CHG_CD, X.LANE, X.PNT DESC) AS RNK" ).append("\n"); 
		query.append("                  FROM (SELECT " ).append("\n"); 
		query.append("                               X.BAT_EXE_DT" ).append("\n"); 
		query.append("                             , X.BKG_SRC_TP_CD" ).append("\n"); 
		query.append("                             , X.BKG_NO" ).append("\n"); 
		query.append("                             , X.CTRT_NO" ).append("\n"); 
		query.append("                             , X.CTRT_HLD_NM                " ).append("\n"); 
		query.append("                             , X.ACT_CUST_NM" ).append("\n"); 
		query.append("                             , X.CNEE_NM" ).append("\n"); 
		query.append("                             , X.OP_AGN_NM" ).append("\n"); 
		query.append("                             , X.LANE" ).append("\n"); 
		query.append("                             , X.POL_CD" ).append("\n"); 
		query.append("                             , X.POD_CD" ).append("\n"); 
		query.append("                             , X.CNTR_TP" ).append("\n"); 
		query.append("                             , X.CMDT_TP" ).append("\n"); 
		query.append("                             , X.CNTR_SZ" ).append("\n"); 
		query.append("                             , X.MOT_FILE_RT_AMT" ).append("\n"); 
		query.append("                             , X.CTRT_EFF_DT" ).append("\n"); 
		query.append("                             , X.CTRT_EXP_DT" ).append("\n"); 
		query.append("                             , X.CHG_CD" ).append("\n"); 
		query.append("                             , X.CURR_CD" ).append("\n"); 
		query.append("                             , X.MOT_FILE_CHG_AMT" ).append("\n"); 
		query.append("                             , X.RMK_FLG" ).append("\n"); 
		query.append("                             , X.CHG_TY" ).append("\n"); 
		query.append("                             , X.IND_SEQ" ).append("\n"); 
		query.append("                             , X.CHG_NM" ).append("\n"); 
		query.append("                             , X.USD_LOCL_XCH_RT" ).append("\n"); 
		query.append("                             , X.SHPR_CNT_CD " ).append("\n"); 
		query.append("                             , X.SHPR_SEQ " ).append("\n"); 
		query.append("                             --, X.SOC_FLG" ).append("\n"); 
		query.append("                             --, X.FRT_TERM_CD" ).append("\n"); 
		query.append("                             , Y.COMM_AMT" ).append("\n"); 
		query.append("                             , CASE WHEN X.CHG_CD = 'BKF' THEN" ).append("\n"); 
		query.append("                                        DECODE(X.POL_CD             , Y.POL_CD, 6001, 0)" ).append("\n"); 
		query.append("                                       +DECODE(X.FWRD_CNT_CD||TO_CHAR(X.FWRD_CUST_SEQ), Y.CUST_CNT_CD||TO_CHAR(Y.CUST_SEQ), 249, DECODE(Y.CUST_CNT_CD||TO_CHAR(Y.CUST_SEQ), NULL, 0, -1000))" ).append("\n"); 
		query.append("                                       +DECODE(X.SOC_FLG            , Y.SOC_FLG, 236, DECODE(Y.SOC_FLG, NULL, 0, -1000))" ).append("\n"); 
		query.append("                                       +DECODE(X.CGO_TP_CD          , Y.PRC_CGO_TP_CD, 225, DECODE(Y.PRC_CGO_TP_CD, NULL, 0, -1000))" ).append("\n"); 
		query.append("                                       +DECODE(X.CNTR_TP            , Y.MOT_FILE_CNTR_TP_CD, 216, DECODE(Y.MOT_FILE_CNTR_TP_CD, NULL, 0, -1000))" ).append("\n"); 
		query.append("                                       +DECODE(X.LANE               , Y.MOT_FILE_LANE_CD, 209, DECODE(Y.MOT_FILE_LANE_CD, NULL, 0, -1000))" ).append("\n"); 
		query.append("                                       +DECODE(X.FRT_TERM_CD        , Y.PAY_TERM_CD, 204, DECODE(Y.PAY_TERM_CD, NULL, 0, -1000))" ).append("\n"); 
		query.append("                                       +DECODE(X.VSL_SLAN_CD        , Y.VSL_SLAN_CD, 202, DECODE(Y.VSL_SLAN_CD, NULL, 0, -1000))" ).append("\n"); 
		query.append("                                    WHEN X.CHG_CD = 'COM' THEN" ).append("\n"); 
		query.append("                                        DECODE(X.POL_CD             , Y.POL_CD, 4001, 0)" ).append("\n"); 
		query.append("                                       +DECODE(X.FWRD_CNT_CD||TO_CHAR(X.FWRD_CUST_SEQ), Y.CUST_CNT_CD||TO_CHAR(Y.CUST_SEQ), 249, DECODE(Y.CUST_CNT_CD||TO_CHAR(Y.CUST_SEQ), NULL, 0, -1000))" ).append("\n"); 
		query.append("                                       +DECODE(X.CGO_TP_CD          , Y.PRC_CGO_TP_CD, 225, DECODE(Y.PRC_CGO_TP_CD, NULL, 0, -1000))" ).append("\n"); 
		query.append("                                       +DECODE(X.LANE               , Y.MOT_FILE_LANE_CD, 209, DECODE(Y.MOT_FILE_LANE_CD, NULL, 0, -1000))" ).append("\n"); 
		query.append("                                       +DECODE(X.FRT_TERM_CD        , Y.PAY_TERM_CD, 204, DECODE(Y.PAY_TERM_CD, NULL, 0, -1000))" ).append("\n"); 
		query.append("                                          " ).append("\n"); 
		query.append("                               END PNT" ).append("\n"); 
		query.append("                          FROM (SELECT " ).append("\n"); 
		query.append("                                         A.BAT_EXE_DT" ).append("\n"); 
		query.append("                                       , A.BKG_SRC_TP_CD" ).append("\n"); 
		query.append("                                       , A.BKG_NO" ).append("\n"); 
		query.append("                                       , A.CTRT_NO" ).append("\n"); 
		query.append("                                       , A.CTRT_HLD_NM                " ).append("\n"); 
		query.append("                                       , A.ACT_CUST_NM" ).append("\n"); 
		query.append("                                       , A.CNEE_NM" ).append("\n"); 
		query.append("                                       , A.OP_AGN_NM" ).append("\n"); 
		query.append("                                       , A.MOT_FILE_LANE_CD AS LANE" ).append("\n"); 
		query.append("                                       , A.MOT_FILE_ORG_CD AS POL_CD" ).append("\n"); 
		query.append("                                       , A.MOT_FILE_DEST_CD AS POD_CD" ).append("\n"); 
		query.append("                                       , A.MOT_FILE_CNTR_TP_CD AS CNTR_TP" ).append("\n"); 
		query.append("                                       , A.MOT_FILE_CMDT_TP_CD AS CMDT_TP" ).append("\n"); 
		query.append("                                       , A.MOT_FILE_CNTR_SZ_CD AS CNTR_SZ" ).append("\n"); 
		query.append("                                       , A.MOT_FILE_RT_AMT" ).append("\n"); 
		query.append("                                       , A.CTRT_EFF_DT" ).append("\n"); 
		query.append("                                       , A.CTRT_EXP_DT" ).append("\n"); 
		query.append("                                       , B.CHG_CD" ).append("\n"); 
		query.append("                                       , A.CURR_CD" ).append("\n"); 
		query.append("                                       , NULL AS MOT_FILE_CHG_AMT" ).append("\n"); 
		query.append("                                       , NULL AS RMK_FLG" ).append("\n"); 
		query.append("                                       , B.CHG_CD AS CHG_TY" ).append("\n"); 
		query.append("                                       , NULL AS IND_SEQ" ).append("\n"); 
		query.append("                                       , NULL AS CHG_NM" ).append("\n"); 
		query.append("                                       , NULL AS USD_LOCL_XCH_RT" ).append("\n"); 
		query.append("                                       , A.SHPR_CNT_CD " ).append("\n"); 
		query.append("                                       , A.SHPR_SEQ " ).append("\n"); 
		query.append("                                       , A.SOC_FLG" ).append("\n"); 
		query.append("                                       , A.FRT_TERM_CD" ).append("\n"); 
		query.append("                                       , A.FWRD_CNT_CD" ).append("\n"); 
		query.append("                                       , A.FWRD_CUST_SEQ" ).append("\n"); 
		query.append("                                       , A.CGO_TP_CD" ).append("\n"); 
		query.append("                                       , A.VSL_SLAN_CD" ).append("\n"); 
		query.append("                                    FROM (SELECT DISTINCT" ).append("\n"); 
		query.append("                                                 A.BAT_EXE_DT" ).append("\n"); 
		query.append("                                               , A.BKG_SRC_TP_CD" ).append("\n"); 
		query.append("                                               , A.BKG_NO" ).append("\n"); 
		query.append("                                               , A.CTRT_NO" ).append("\n"); 
		query.append("                                               , A.CTRT_HLD_NM                " ).append("\n"); 
		query.append("                                               , A.ACT_CUST_NM" ).append("\n"); 
		query.append("                                               , A.CNEE_NM" ).append("\n"); 
		query.append("                                               , A.OP_AGN_NM" ).append("\n"); 
		query.append("                                               , A.MOT_FILE_LANE_CD" ).append("\n"); 
		query.append("                                               , A.MOT_FILE_ORG_CD" ).append("\n"); 
		query.append("                                               , A.MOT_FILE_DEST_CD" ).append("\n"); 
		query.append("                                               , A.MOT_FILE_CNTR_TP_CD" ).append("\n"); 
		query.append("                                               , A.MOT_FILE_CMDT_TP_CD" ).append("\n"); 
		query.append("                                               , A.MOT_FILE_CNTR_SZ_CD" ).append("\n"); 
		query.append("                                               , A.MOT_FILE_RT_AMT" ).append("\n"); 
		query.append("                                               , A.CTRT_EFF_DT" ).append("\n"); 
		query.append("                                               , A.CTRT_EXP_DT" ).append("\n"); 
		query.append("                                               , NULL AS CHG_CD" ).append("\n"); 
		query.append("                                       		   , NULL AS CURR_CD" ).append("\n"); 
		query.append("                                       		   , NULL AS MOT_FILE_CHG_AMT" ).append("\n"); 
		query.append("                                       		   , NULL AS RMK_FLG" ).append("\n"); 
		query.append("                                       		   , NULL AS CHG_TY" ).append("\n"); 
		query.append("                                       		   , NULL AS IND_SEQ" ).append("\n"); 
		query.append("                                       		   , NULL AS CHG_NM" ).append("\n"); 
		query.append("                                       		   , NULL AS USD_LOCL_XCH_RT" ).append("\n"); 
		query.append("                                               , A.SHPR_CNT_CD " ).append("\n"); 
		query.append("                                               , A.SHPR_SEQ " ).append("\n"); 
		query.append("                                               , A.SOC_FLG" ).append("\n"); 
		query.append("                                               , A.FRT_TERM_CD" ).append("\n"); 
		query.append("                                               , A.FWRD_CNT_CD" ).append("\n"); 
		query.append("                                               , A.FWRD_CUST_SEQ" ).append("\n"); 
		query.append("                                               , A.CGO_TP_CD" ).append("\n"); 
		query.append("                                               , A.VSL_SLAN_CD" ).append("\n"); 
		query.append("                                            FROM CHG_RST A ) A" ).append("\n"); 
		query.append("                                       , (SELECT CHG_CD FROM MDM_CHARGE WHERE REP_CHG_CD = 'MOT') B" ).append("\n"); 
		query.append("                                   WHERE A.BAT_EXE_DT BETWEEN TO_DATE (@[fr_file_dt], 'YYYY-MM-DD' ) AND TO_DATE (@[to_file_dt], 'YYYY-MM-DD' ) ) X" ).append("\n"); 
		query.append("                         " ).append("\n"); 
		query.append("                             , (SELECT" ).append("\n"); 
		query.append("                                       A.CHG_CD" ).append("\n"); 
		query.append("                                     , A.POL_CD" ).append("\n"); 
		query.append("                                     , A.CHG_RT_SEQ" ).append("\n"); 
		query.append("                                     , A.CUST_CNT_CD" ).append("\n"); 
		query.append("                                     , A.CUST_SEQ" ).append("\n"); 
		query.append("                                     , A.CUST_NM" ).append("\n"); 
		query.append("                                     , A.CUST_NM" ).append("\n"); 
		query.append("                                     , A.SOC_FLG AS SOC_FLG" ).append("\n"); 
		query.append("                                     , A.PRC_CGO_TP_CD AS PRC_CGO_TP_CD" ).append("\n"); 
		query.append("                                     , A.MOT_FILE_CNTR_TP_CD AS MOT_FILE_CNTR_TP_CD" ).append("\n"); 
		query.append("                                     , A.MOT_FILE_LANE_CD AS MOT_FILE_LANE_CD" ).append("\n"); 
		query.append("                                     , A.PAY_TERM_CD AS PAY_TERM_CD" ).append("\n"); 
		query.append("                                     , A.AGN_CD" ).append("\n"); 
		query.append("                                     , A.EFF_DT" ).append("\n"); 
		query.append("                                     , A.EXP_DT" ).append("\n"); 
		query.append("                                     , A.CURR_CD" ).append("\n"); 
		query.append("                                     , A.VSL_SLAN_CD" ).append("\n"); 
		query.append("                                     , CASE WHEN B.GB = 1 THEN 20 " ).append("\n"); 
		query.append("                                            WHEN B.GB = 2 THEN 40" ).append("\n"); 
		query.append("                                            WHEN B.GB = 3 THEN 45" ).append("\n"); 
		query.append("                                       END CNTR_SZ" ).append("\n"); 
		query.append("                                     , CASE WHEN B.GB = 1 THEN A.CNTR_20FT_RT_AMT" ).append("\n"); 
		query.append("                                            WHEN B.GB = 2 THEN A.CNTR_40FT_RT_AMT" ).append("\n"); 
		query.append("                                            WHEN B.GB = 3 THEN A.CNTR_45FT_RT_AMT" ).append("\n"); 
		query.append("                                       END COMM_AMT  " ).append("\n"); 
		query.append("                                  FROM PRI_MOT_CHG_RT A" ).append("\n"); 
		query.append("                                     , (SELECT 1 AS GB FROM DUAL UNION ALL" ).append("\n"); 
		query.append("                                        SELECT 2 AS GB FROM DUAL UNION ALL" ).append("\n"); 
		query.append("                                        SELECT 3 AS GB FROM DUAL) B ) Y" ).append("\n"); 
		query.append("                         WHERE X.BAT_EXE_DT          BETWEEN Y.EFF_DT AND Y.EXP_DT" ).append("\n"); 
		query.append("                           AND X.POL_CD              = Y.POL_CD(+)" ).append("\n"); 
		query.append("                           AND X.CNTR_SZ             = Y.CNTR_SZ(+)" ).append("\n"); 
		query.append("                           AND X.CHG_CD              = Y.CHG_CD(+) ) X ) A   " ).append("\n"); 
		query.append("         , BKG_BOOKING B" ).append("\n"); 
		query.append("         , CHG_RST_RMK X" ).append("\n"); 
		query.append("     WHERE A.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("       AND A.RNK = 1" ).append("\n"); 
		query.append("    AND X.BAT_EXE_DT = A.BAT_EXE_DT" ).append("\n"); 
		query.append("    AND X.BKG_NO = A.BKG_NO" ).append("\n"); 
		query.append("    AND X.CTRT_NO = A.CTRT_NO" ).append("\n"); 
		query.append("    AND NVL(X.CTRT_HLD_NM,'1') = NVL(A.CTRT_HLD_NM,'1')" ).append("\n"); 
		query.append("    AND NVL(X.ACT_CUST_NM,'1') = NVL(A.ACT_CUST_NM,'1')" ).append("\n"); 
		query.append("    AND NVL(X.CNEE_NM,'1') = NVL(A.CNEE_NM,'1')" ).append("\n"); 
		query.append("    AND X.MOT_FILE_LANE_CD = A.LANE" ).append("\n"); 
		query.append("    AND X.MOT_FILE_ORG_CD = A.POL_CD" ).append("\n"); 
		query.append("    AND X.MOT_FILE_DEST_CD = A.POD_CD" ).append("\n"); 
		query.append("    AND X.MOT_FILE_CNTR_TP_CD = A.CNTR_TP" ).append("\n"); 
		query.append("    AND X.MOT_FILE_CNTR_SZ_CD = A.CNTR_SZ" ).append("\n"); 
		query.append("    AND X.MOT_FILE_RT_AMT  = A.MOT_FILE_RT_AMT" ).append("\n"); 
		query.append("		) A" ).append("\n"); 
		query.append(" ) A           " ).append("\n"); 
		query.append("           " ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("PIVOT" ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("   MAX(CHG_VAL)" ).append("\n"); 
		query.append("   --이 부분은 특수문자를 할당 한후 JAVA소스에서 해당 부분을 쿼리 날리기 전에 바꾸어 날리는 방식으로 할 것" ).append("\n"); 
		query.append("   FOR  CHG_TY IN ('AAA' )" ).append("\n"); 
		query.append(") T" ).append("\n"); 
		query.append("ORDER BY T.BAT_EXE_DT, T.CTRT_NO, T.BKG_SHPR_NM, T.BKG_CNEE_NM" ).append("\n"); 

	}
}