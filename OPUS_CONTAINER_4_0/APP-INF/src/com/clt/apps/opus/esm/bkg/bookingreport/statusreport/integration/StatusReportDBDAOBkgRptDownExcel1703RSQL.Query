<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="StatusReportDBDAOBkgRptDownExcel1703RSQL">
			<desc><![CDATA[BkgRptDownExcel1703]]></desc>
			<sql><![CDATA[
#if (${sel_cols} != '')  
SELECT ${sel_cols}
#else 
SELECT *
#end
FROM (
    SELECT
     '1' AS TEMP
    ,'Cargo & Commodity' AS	GRS_WGT
    ,'Cargo & Commodity' AS	GRS_WGT_UT
    ,'BKG & B/L Info' AS	BKG_NO
    ,'BKG & B/L Info' AS	BKG_CRE_DT
    ,'BKG & B/L Info' AS	BKG_OFC_CD
    ,'BKG & B/L Info' AS	BKG_STS_CD
    ,'BKG & B/L Info' AS	SLS_OFC
    ,'BKG & B/L Info' AS	CTRT_SREP_CD
    ,'BKG & B/L Info' AS	OB_SREP_CD
    ,'BKG & B/L Info' AS	CUST_RMK
    ,'BKG & B/L Info' AS	VNDR_RMK
    ,'BKG & B/L Info' AS	INT_RMK
    ,'BKG & B/L Info' AS	SCC_CD
    ,'BKG & B/L Info' AS	SCC_NM
    ,'BKG & B/L Info' AS	STWG_CD
    ,'BKG & B/L Info' AS	STWG_DESC
    ,'Cargo & Commodity' AS	CGO_N
    ,'Cargo & Commodity' AS	CGO_TP
    ,'Cargo & Commodity' AS	CGO_WGT
    ,'Cargo & Commodity' AS	CGO_WGT_UT
    ,'Cargo & Commodity' AS	TARE_WGT
    ,'Cargo & Commodity' AS	TARE_WGT_UT
    ,'Cargo & Commodity' AS	MEAS_QTY
    ,'Cargo & Commodity' AS	MEAS_UT_CD
    ,'Cargo & Commodity' AS	PCK_QTY
    ,'Cargo & Commodity' AS	PCK_TP_CD
    ,'Cargo & Commodity' AS	CMDT_CD
    ,'Cargo & Commodity' AS	CMDT_NM
    ,'Container' AS	CNTR_NO
    ,'Container' AS	CNTR_TPSZ_CD
    ,'Container' AS	CNMV_STS_CD
    ,'Container' AS	CNMV_STS_NMK
    ,'Container' AS	CNTR_SEAL_NO
    ,'Customer' AS	S_CUST_NM
    ,'Customer' AS	F_CUST_NM
    ,'Customer' AS	C_CUST_NM
    ,'Customer' AS	CTRT_PTY_CD
    ,'Customer' AS	CTRT_PTY_NM
    ,'Reference No.' AS	BKG_REF
    ,'Reference No' AS	BKSH_REF
    ,'Reference No.' AS	ENS_MRN
    ,'Reference No.' AS	CMRN_REF_NO
    ,'Reference No.' AS	EXS_MRN
    ,'Reference No' AS	INV_REF
    ,'Reference No.' AS	REG_REF
    ,'Reference No.' AS	FF_REF
    ,'Reference No.' AS	SI_REF
    ,'Reference No.' AS	SISH_REF
    ,'Route & Schedule' AS	BLCK_STWG
    ,'Route & Schedule' AS	RCV_TERM_CD
    ,'Route & Schedule' AS	DE_TERM_CD
    ,'Route & Schedule' AS	TRAF_MOD_OB
    ,'Route & Schedule' AS	TRAF_MOD_IB
    ,'Route & Schedule' AS	POR_CD
    ,'Route & Schedule' AS	POR_NM
    ,'Route & Schedule' AS	POL_CD
    ,'Route & Schedule' AS	POL_NM
    ,'Route & Schedule' AS	POD_CD
    ,'Route & Schedule' AS	POD_NM
    ,'Route & Schedule' AS	DEL_CD
    ,'Route & Schedule' AS	DEL_NM
    ,'Route & Schedule' AS	MTY_PKUP_YD_CD
    ,'Route & Schedule' AS	TRD_CD
    ,'Route & Schedule' AS	SLAN_CD
    ,'Route & Schedule' AS	TVVD
    ,'Route & Schedule' AS	TVSL
    ,'Route & Schedule' AS	PRE_VVD
    ,'Route & Schedule' AS	PRE_VSL
    ,'Route & Schedule' AS	POST_VVD
    ,'Route & Schedule' AS	PST_VSL
    ,'Route & Schedule' AS	N1ST_ETD_DT
    ,'Route & Schedule' AS	LAST_ETA_DT
    ,'Route & Schedule' AS	OC_DT
    ,'Route & Schedule' AS	OP_DT
    ,'Route & Schedule' AS	VL_DT
    ,'Rate & Invoice' AS	RT_STS
    ,'Rate & Invoice' AS	RFA_NO
    ,'Rate & Invoice' AS	SC_NO
    ,'Rate & Invoice' AS	TAA_NO
    ,'DG Info' AS	DG_APRL_CD
    ,'Reefer Info' AS	RF_CA
    ,'Reefer Info' AS	RF_MA
    ,'Reefer Info' AS	RF_TEMP
    ,'Reefer Info' AS	VENT
    FROM DUAL
UNION ALL
    SELECT
     '2' AS TEMP
    ,'Gross Weight' AS	GRS_WGT
    ,'Gross Weight Unit' AS	GRS_WGT_UT
    ,'Booking Number' AS	BKG_NO
    ,'Booking Date' AS	BKG_CRE_DT
    ,'Booking Office' AS	BKG_OFC_CD
    ,'Booking Status' AS	BKG_STS_CD
    ,'Sales Office' AS	SLS_OFC
    ,'C.SREP' AS	CTRT_SREP_CD
    ,'L.SREP' AS	OB_SREP_CD
    ,'Cust. Remark' AS	CUST_RMK
    ,'Vndr. Remark' AS	VNDR_RMK
    ,'Internal Remark' AS	INT_RMK
    ,'SCC Code' AS	SCC_CD
    ,'SCC Name' AS	SCC_NM
    ,'Special Handling Instructions Type' AS	STWG_CD
    ,'Special Handling Instructions Detail' AS	STWG_DESC
    ,'Cargo Nature' AS	CGO_N
    ,'Cargo Type' AS	CGO_TP
    ,'Cargo Weight' AS	CGO_WGT
    ,'Cargo Weight Unit' AS	CGO_WGT_UT
    ,'Tare Weight' AS	TARE_WGT
    ,'Tare Weight Unit' AS	TARE_WGT_UT
    ,'Measure' AS	MEAS_QTY
    ,'Measure Unit' AS	MEAS_UT_CD
    ,'No. of Package' AS	PCK_QTY
    ,'Package Unit' AS	PCK_TP_CD
    ,'Commodity Code' AS	CMDT_CD
    ,'Commodity Name' AS	CMDT_NM
    ,'Container Number' AS	CNTR_NO
    ,'Container Size Type' AS	CNTR_TPSZ_CD
    ,'Container Movement Status' AS	CNMV_STS_CD
    ,'Container Movement Status Description' AS	CNMV_STS_NMK
    ,'Seal Number' AS	CNTR_SEAL_NO
    ,'Shipper' AS	S_CUST_NM
    ,'Forwarder' AS	F_CUST_NM
    ,'Consignee' AS	C_CUST_NM
    ,'Contract Party Code' AS	CTRT_PTY_CD
    ,'Contract Party Name' AS	CTRT_PTY_NM
    ,'BKG Ref. No.' AS	BKG_REF
    ,'BKG SH Ref. No.' AS	BKSH_REF
    ,'ENS MRN' AS	ENS_MRN
    ,'Export MRN No.' AS	CMRN_REF_NO
    ,'EXS MRN' AS	EXS_MRN
    ,'Invoice Ref. No.' AS	INV_REF
    ,'Regional BKG No.' AS	REG_REF
    ,'SI FF Ref. No.' AS	FF_REF
    ,'SI Ref. No.' AS	SI_REF
    ,'SI SH Ref. No.' AS	SISH_REF
    ,'Block Stowage' AS	BLCK_STWG
    ,'Receiving Term' AS	RCV_TERM_CD
    ,'Delivery Term' AS	DE_TERM_CD
    ,'Traffic Mode OB' AS	TRAF_MOD_OB
    ,'Traffic Mode IB' AS	TRAF_MOD_IB
    ,'POR Code' AS	POR_CD
    ,'POR Name' AS	POR_NM
    ,'POL Code' AS	POL_CD
    ,'POL Name' AS	POL_NM
    ,'POD Code' AS	POD_CD
    ,'POD Name' AS	POD_NM
    ,'DEL Code' AS	DEL_CD
    ,'DEL Name' AS	DEL_NM
    ,'MTY CNTR Pick Up CY' AS	MTY_PKUP_YD_CD
    ,'Trade Code' AS	TRD_CD
    ,'Trunk Lane' AS	SLAN_CD
    ,'Trunk VVD' AS	TVVD
    ,'Trunk Vessel' AS	TVSL
    ,'Pre VVD' AS	PRE_VVD
    ,'Pre Vessel' AS	PRE_VSL
    ,'Post VVD' AS	POST_VVD
    ,'Post Vessel' AS	PST_VSL
    ,'ETD from First POL' AS	N1ST_ETD_DT
    ,'ETA at Last POD' AS	LAST_ETA_DT
    ,'OC Date/Time' AS	OC_DT
    ,'OP Date/Time' AS	OP_DT
    ,'VL Date/Time' AS	VL_DT
    ,'Rating Status' AS	RT_STS
    ,'RFA No.' AS	RFA_NO
    ,'S/C No.' AS	SC_NO
    ,'Tariff No.' AS	TAA_NO
    ,'DG Approval Code' AS	DG_APRL_CD
    ,'CA' AS	RF_CA
    ,'MA' AS	RF_MA
    ,'RF Temperature' AS	RF_TEMP
    ,'RF Ventilation' AS	VENT
    FROM DUAL
UNION ALL
SELECT 
     '3' AS TEMP
     ,DECODE(CGO_WGT_UT,'KGS',
                           TRIM(TO_CHAR(TO_NUMBER(NVL(CGO_WGT,0),'999,999,999,990.99')+TO_NUMBER(NVL(TARE_WGT,0),'999,999,999,990.99'),'999,999,999,990.99')),
                         'LBS',
                           TRIM(TO_CHAR(TO_NUMBER(NVL(CGO_WGT,0),'999,999,999,990.99')+ROUND(TO_NUMBER(NVL(TARE_WGT,0),'999,999,999,990.99') / 0.453592,2),'999,999,999,990.99'))
             ) AS GRS_WGT
     ,CGO_WGT_UT AS GRS_WGT_UT
     ,BKG_Z.*
  FROM (
    SELECT 
--Cargo & Commodity
         BK.BKG_NO AS BKG_NO
        ,TO_CHAR(BK.BKG_CRE_DT,'YYYY-MM-DD HH24:MI') AS BKG_CRE_DT
        ,BK.BKG_OFC_CD AS BKG_OFC_CD
        ,BK.BKG_STS_CD AS BKG_STS_CD
        ,BK.OB_SLS_OFC_CD AS SLS_OFC
        ,BK.CTRT_SREP_CD AS CTRT_SREP_CD
        ,BK.OB_SREP_CD
        ,REPLACE(REPLACE(REPLACE(BK.XTER_RMK,CHR(10),' '),CHR(9),' '),CHR(34),'') AS CUST_RMK
        ,REPLACE(REPLACE(REPLACE(BK.VNDR_RMK,CHR(10),' '),CHR(9),' '),CHR(34),'') AS VNDR_RMK
        ,REPLACE(REPLACE(REPLACE(BK.INTER_RMK,CHR(10),' '),CHR(9),' '),CHR(34),'') AS INT_RMK
        ,(SELECT OFC_CD FROM MDM_YARD M WHERE M.YD_CD = BK.MTY_PKUP_YD_CD) AS SCC_CD
        ,(SELECT O.OFC_ENG_NM FROM MDM_YARD M, MDM_ORGANIZATION O WHERE M.YD_CD = BK.MTY_PKUP_YD_CD AND M.OFC_CD = O.OFC_CD) AS SCC_NM
        ,BK.STWG_CD AS STWG_CD
        ,(SELECT INTG_CD_VAL_DESC FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD02146' AND INTG_CD_VAL_CTNT = BK.STWG_CD) AS STWG_DESC
        ,NVL(DECODE(BK.DCGO_FLG,'Y','DG',NULL)||DECODE(BK.RC_FLG,'Y','RF',NULL)||DECODE(BK.AWK_CGO_FLG,'Y','AW',NULL)||DECODE(BK.RD_CGO_FLG,'Y','RAD',NULL),'GC') AS CGO_N
        ,DECODE(BK.BKG_CGO_TP_CD, 'P', 'M', 'F') AS CGO_TP
        ,TRIM(TO_CHAR(BC.CNTR_WGT,'999,999,999,990.99')) AS CGO_WGT
        ,BC.WGT_UT_CD AS CGO_WGT_UT
        ,NVL((SELECT TRIM(TO_CHAR(ROUND(B.TARE_WGT,1),'999,999,999,990.99'))
                FROM MST_CONTAINER A
                    ,MST_CNTR_SPEC B
               WHERE A.CNTR_SPEC_NO = B.CNTR_SPEC_NO
                 AND A.CNTR_NO = BC.CNTR_NO)
           , (SELECT TRIM(TO_CHAR(ROUND(CNTR_TPSZ_TARE_WGT,1),'999,999,999,990.99'))
                FROM MDM_CNTR_TP_SZ MDM
               WHERE MDM.CNTR_TPSZ_CD = BC.CNTR_TPSZ_CD)
         ) AS TARE_WGT
        ,'KGS' AS TARE_WGT_UT
        ,TO_CHAR(BC.MEAS_QTY) AS MEAS_QTY
        ,BC.MEAS_UT_CD AS MEAS_UT_CD
        ,TO_CHAR(BC.PCK_QTY) AS PCK_QTY
        ,BC.PCK_TP_CD AS PCK_TP_CD
        ,DECODE(SUBSTR(BK.CMDT_CD,1,1),0,'''','')||BK.CMDT_CD AS CMDT_CD
        ,(SELECT CMDT_NM FROM MDM_COMMODITY WHERE CMDT_CD = BK.CMDT_CD) AS CMDT_NM
--Container
        ,BC.CNTR_NO AS CNTR_NO
        ,BC.CNTR_TPSZ_CD
	    ,DECODE(BK.BKG_STS_CD,'X','',
				DECODE((SELECT COP.COP_STS_CD FROM SCE_COP_HDR COP WHERE COP.BKG_NO = BC.BKG_NO AND COP.CNTR_NO = BC.CNTR_NO AND COP.COP_STS_CD <> 'X'),'F','MT',
						(SELECT B.CNMV_STS_CD FROM MST_CONTAINER B WHERE B.CNTR_NO = BC.CNTR_NO))) CNMV_STS_CD
		,(SELECT INTG_CD_VAL_DESC FROM COM_INTG_CD_DTL CD_DTL WHERE CD_DTL.INTG_CD_ID = 'CD00252' 
                                                                AND CD_DTL.INTG_CD_VAL_CTNT=(DECODE(BK.BKG_STS_CD,'X','',
				                                                                                DECODE((SELECT COP.COP_STS_CD FROM SCE_COP_HDR COP WHERE COP.BKG_NO = BC.BKG_NO AND COP.CNTR_NO = BC.CNTR_NO AND COP.COP_STS_CD <> 'X'),'F','MT',
						                                                                            (SELECT B.CNMV_STS_CD FROM MST_CONTAINER B WHERE B.CNTR_NO = BC.CNTR_NO))))) AS CNMV_STS_NMK
        ,BKG_JOIN_FNC(CURSOR(SELECT CNTR_SEAL_NO 
                             FROM BKG_CNTR_SEAL_NO 
                             WHERE BKG_NO = BC.BKG_NO
                               AND CNTR_NO = BC.CNTR_NO 
                             )
                      ) AS CNTR_SEAL_NO
--Customer
        ,REPLACE(REPLACE(REPLACE(S.CUST_NM,CHR(10), ' '),CHR(9),' '),CHR(34),'') AS S_CUST_NM
        ,REPLACE(REPLACE(REPLACE(F.CUST_NM,CHR(10), ' '),CHR(9),' '),CHR(34),'') AS F_CUST_NM
        ,REPLACE(REPLACE(REPLACE(C.CUST_NM,CHR(10), ' '),CHR(9),' '),CHR(34),'') AS C_CUST_NM
        ,BKG_CTRL_PTY_CUST_CNT_CD||LPAD(BK.BKG_CTRL_PTY_CUST_SEQ,6,'0') AS CTRT_PTY_CD
        ,(SELECT CUST_LGL_ENG_NM FROM MDM_CUSTOMER WHERE CUST_CNT_CD = BK.BKG_CTRL_PTY_CUST_CNT_CD AND CUST_SEQ = BK.BKG_CTRL_PTY_CUST_SEQ) AS CTRT_PTY_NM
--Reference No.
        ,RF1.CUST_REF_NO_CTNT  AS BKG_REF
        ,RF2.CUST_REF_NO_CTNT  AS BKSH_REF
        ,BKG_JOIN_FNC(CURSOR(SELECT EUR_BL.MVMT_REF_NO
		 					   FROM BKG_CSTMS_EUR_BL EUR_BL
							  WHERE BK.BL_NO = EUR_BL.BL_NO),';') AS ENS_MRN
        ,DECODE(BC.CNTR_NO, NULL, 
                              BKG_JOIN_FNC(CURSOR(SELECT CUST_REF_NO_CTNT
                                                    FROM BKG_REFERENCE CUCR
                                                   WHERE CUCR.BKG_NO = BK.BKG_NO
                                                     AND CUCR.BKG_REF_TP_CD = 'CMRN'
                                                   ORDER BY CUCR.REF_SEQ
                                                  ),','),
                              (SELECT CUST_REF_NO_CTNT
                                 FROM BKG_REFERENCE CUCR
                                WHERE CUCR.BKG_NO = BK.BKG_NO
                                  AND CUCR.CNTR_NO = BC.CNTR_NO
                                  AND CUCR.BKG_REF_TP_CD = 'CMRN')) AS CMRN_REF_NO
        ,BKG_JOIN_FNC(CURSOR(SELECT EX_EUR_BL.MVMT_REF_NO
							 FROM BKG_CSTMS_EUR_IO_BL EX_EUR_BL
							WHERE BK.BL_NO = EX_EUR_BL.BL_NO),';') AS EXS_MRN
        ,RF4.CUST_REF_NO_CTNT  AS INV_REF
        ,RF5.CUST_REF_NO_CTNT  AS REG_REF
        ,RF6.CUST_REF_NO_CTNT  AS FF_REF
        ,RF7.CUST_REF_NO_CTNT  AS SI_REF
        ,RF8.CUST_REF_NO_CTNT  AS SISH_REF
--Route & Schedule
        ,BLCK_STWG_CD AS BLCK_STWG
        ,BK.RCV_TERM_CD AS RCV_TERM_CD
        ,BK.DE_TERM_CD AS DE_TERM_CD
        ,DECODE(BK.RCV_TERM_CD,'S','LCL','FCL') AS TRAF_MOD_OB
        ,DECODE(BK.DE_TERM_CD,'S','LCL','FCL') AS TRAF_MOD_IB
        ,BK.POR_CD
        ,(SELECT LOC_NM FROM MDM_LOCATION WHERE LOC_CD = BK.POR_CD) AS POR_NM
        ,BK.POL_CD
        ,(SELECT LOC_NM FROM MDM_LOCATION WHERE LOC_CD = BK.POL_CD) AS POL_NM
        ,BK.POD_CD
        ,(SELECT LOC_NM FROM MDM_LOCATION WHERE LOC_CD = BK.POD_CD) AS POD_NM
        ,BK.DEL_CD
        ,(SELECT LOC_NM FROM MDM_LOCATION WHERE LOC_CD = BK.DEL_CD) AS DEL_NM
--        ,BK.MTY_PKUP_YD_CD AS MTY_PKUP_YD_CD
        ,(SELECT /*+ INDEX_ASC(D XPKSCE_COP_DTL)*/D.NOD_CD
              FROM SCE_COP_HDR H,
                   SCE_COP_DTL D,
                   SCE_ACT_ACT_MAPG MPG
             WHERE H.COP_NO = D.COP_NO
               AND H.BKG_NO = BC.BKG_NO
               AND H.CNTR_NO = BC.CNTR_NO
               AND H.COP_STS_CD <> 'X'
               AND D.ACT_CD = MPG.ACT_CD
               AND MPG.ACT_STS_MAPG_CD = 'OP'
               AND ROWNUM=1
         ) MTY_PKUP_YD_CD
        ,COA.TRD_CD
        ,BK.SLAN_CD AS SLAN_CD
        ,BK.VSL_CD||BK.SKD_VOY_NO||BK.SKD_DIR_CD AS TVVD
        ,(SELECT M.VSL_ENG_NM FROM MDM_VSL_CNTR M WHERE M.VSL_CD = BK.VSL_CD ) AS TVSL
        ,PRE.VSL_CD||PRE.SKD_VOY_NO||PRE.SKD_DIR_CD AS PRE_VVD
        ,(SELECT M.VSL_ENG_NM FROM MDM_VSL_CNTR M WHERE M.VSL_CD = PRE.VSL_CD ) AS PRE_VSL
        ,PST.VSL_CD||PST.SKD_VOY_NO||PST.SKD_DIR_CD AS POST_VVD
        ,(SELECT M.VSL_ENG_NM FROM MDM_VSL_CNTR M WHERE M.VSL_CD = PST.VSL_CD ) AS PST_VSL
        ,TO_CHAR(N1ST_SKD.VPS_ETD_DT,'YYYY-MM-DD HH24:MI') AS N1ST_ETD_DT
        ,TO_CHAR(LAST_SKD.VPS_ETA_DT,'YYYY-MM-DD HH24:MI') AS LAST_ETA_DT
        ,(SELECT /*+ INDEX_ASC(D XPKSCE_COP_DTL)*/NVL(TO_CHAR(D.ACT_DT,'YYYY-MM-DD HH24:MI'),TO_CHAR(D.ESTM_DT,'YYYY-MM-DD HH24:MI'))
              FROM SCE_COP_HDR H,
                   SCE_COP_DTL D,
                   SCE_ACT_ACT_MAPG MPG
             WHERE H.COP_NO = D.COP_NO
               AND H.BKG_NO = BC.BKG_NO
               AND H.CNTR_NO = BC.CNTR_NO
               AND H.COP_STS_CD <> 'X'
               AND D.ACT_CD = MPG.ACT_CD
               AND MPG.ACT_STS_MAPG_CD = 'OC'
               AND ROWNUM=1
         ) OC_DT
        ,(SELECT /*+ INDEX_ASC(D XPKSCE_COP_DTL)*/NVL(TO_CHAR(D.ACT_DT,'YYYY-MM-DD HH24:MI'),TO_CHAR(D.ESTM_DT,'YYYY-MM-DD HH24:MI'))
              FROM SCE_COP_HDR H,
                   SCE_COP_DTL D,
                   SCE_ACT_ACT_MAPG MPG
             WHERE H.COP_NO = D.COP_NO
               AND H.BKG_NO = BC.BKG_NO
               AND H.CNTR_NO = BC.CNTR_NO
               AND H.COP_STS_CD <> 'X'
               AND D.ACT_CD = MPG.ACT_CD
               AND MPG.ACT_STS_MAPG_CD = 'OP'
               AND ROWNUM=1
         ) OP_DT
        ,(SELECT /*+ INDEX_ASC(D XPKSCE_COP_DTL)*/NVL(TO_CHAR(D.ACT_DT,'YYYY-MM-DD HH24:MI'),TO_CHAR(D.ESTM_DT,'YYYY-MM-DD HH24:MI'))
              FROM SCE_COP_HDR H,
                   SCE_COP_DTL D,
                   SCE_ACT_ACT_MAPG MPG
             WHERE H.COP_NO = D.COP_NO
               AND H.BKG_NO = BC.BKG_NO
               AND H.CNTR_NO = BC.CNTR_NO
               AND H.COP_STS_CD <> 'X'
               AND D.ACT_CD = MPG.ACT_CD
               AND MPG.ACT_STS_MAPG_CD = 'VL'
               AND ROWNUM=1
         ) VL_DT
--Rate & Invoice
        ,NVL((SELECT 'Y' FROM BKG_CHG_RT WHERE BKG_NO = BK.BKG_NO AND ROWNUM =1 ),'N') AS RT_STS
        ,BK.RFA_NO
        ,BK.SC_NO
        ,BK.TAA_NO
--DG Info
        ,(SELECT SPCL_CGO_APRO_CD FROM BKG_DG_CGO WHERE BKG_NO = BK.BKG_NO AND ROWNUM =1 ) AS DG_APRL_CD
--Reefer Info
        ,RF.CTRL_ATMS_FLG AS RF_CA
        ,RF.MODI_ATMS_FLG AS RF_MA
        ,TO_CHAR(RF.CDO_TEMP) AS RF_TEMP
        ,DECODE(RF.CNTR_VENT_TP_CD,'P',RF.VENT_RTO||'%',RF.CBM_PER_HR_QTY||'CMH') AS VENT
      FROM BKG_BOOKING BK,
           BKG_VVD VVD,--KEY
           BKG_BL_DOC BL,
           BKG_CONTAINER BC,
           BKG_CUSTOMER S,
           BKG_CUSTOMER C,
           BKG_CUSTOMER F,
           BKG_RF_CGO RF,
           BKG_REFERENCE RF1,
           BKG_REFERENCE RF2,
           BKG_REFERENCE RF4,
           BKG_REFERENCE RF5,
           BKG_REFERENCE RF6,
           BKG_REFERENCE RF7,
           BKG_REFERENCE RF8,
           BKG_VVD PRE,
           BKG_VVD PST,
           BKG_VVD N1ST_VVD,
           BKG_VVD LAST_VVD,
           VSK_VSL_PORT_SKD N1ST_SKD,
           VSK_VSL_PORT_SKD LAST_SKD,
           COA_RGST_BKG COA
    WHERE 1=1
    AND BK.BKG_NO = BL.BKG_NO
    AND BK.BKG_NO = VVD.BKG_NO
    AND BK.BKG_NO = BC.BKG_NO
    AND BC.BKG_NO = RF.BKG_NO(+)
    AND BC.CNTR_NO = RF.CNTR_NO(+)
    AND BK.BKG_NO = COA.BKG_NO(+)
    AND BK.BKG_NO = S.BKG_NO
    AND S.BKG_CUST_TP_CD ='S'
    AND BK.BKG_NO = C.BKG_NO
    AND C.BKG_CUST_TP_CD ='C'
    AND BK.BKG_NO = F.BKG_NO
    AND F.BKG_CUST_TP_CD ='F'
    AND BK.BKG_NO = RF1.BKG_NO(+)
    AND 'EBRF' = RF1.BKG_REF_TP_CD(+)
    AND BK.BKG_NO = RF2.BKG_NO(+)
    AND 'EBSH' = RF2.BKG_REF_TP_CD(+)
    AND BK.BKG_NO = RF4.BKG_NO(+)
    AND 'FINV' = RF4.BKG_REF_TP_CD(+)
    AND BK.BKG_NO = RF5.BKG_NO(+)
    AND 'RGBK' = RF5.BKG_REF_TP_CD(+)
    AND BK.BKG_NO = RF6.BKG_NO(+)
    AND 'ESFF' = RF6.BKG_REF_TP_CD(+)
    AND BK.BKG_NO = RF7.BKG_NO(+)
    AND 'ESRF' = RF7.BKG_REF_TP_CD(+)
    AND BK.BKG_NO = RF8.BKG_NO(+)
    AND 'ESSH' = RF8.BKG_REF_TP_CD(+)
    AND BK.BKG_NO         = PRE.BKG_NO(+)					
    AND 'S'               = PRE.VSL_PRE_PST_CD(+)					
    AND BK.PRE_RLY_PORT_CD= PRE.POD_CD(+)					
    AND BK.BKG_NO         = PST.BKG_NO(+)					
    AND 'U'               = PST.VSL_PRE_PST_CD(+)	
    AND BK.PST_RLY_PORT_CD= PST.POL_CD(+)					
    AND (N1ST_VVD.BKG_NO, N1ST_VVD.VSL_PRE_PST_CD, N1ST_VVD.VSL_SEQ) 
                     = (SELECT /*+ index(v2 xpkbkg_vvd) */ 
                                V2.BKG_NO, V2.VSL_PRE_PST_CD, V2.VSL_SEQ
                          FROM BKG_VVD V2
                         WHERE V2.BKG_NO = BK.BKG_NO
                           AND ROWNUM = 1)
    AND (LAST_VVD.BKG_NO, LAST_VVD.VSL_PRE_PST_CD, LAST_VVD.VSL_SEQ) 
                     = (SELECT /*+ index_desc(v2 xpkbkg_vvd) */ 
                                V2.BKG_NO, V2.VSL_PRE_PST_CD, V2.VSL_SEQ
                          FROM BKG_VVD V2
                         WHERE V2.BKG_NO = BK.BKG_NO
                           AND ROWNUM = 1)
    AND N1ST_VVD.VSL_CD     = N1ST_SKD.VSL_CD(+)
    AND N1ST_VVD.SKD_VOY_NO = N1ST_SKD.SKD_VOY_NO(+)
    AND N1ST_VVD.SKD_DIR_CD = N1ST_SKD.SKD_DIR_CD(+)
    AND N1ST_VVD.POL_CD     = N1ST_SKD.VPS_PORT_CD(+)
    AND N1ST_VVD.POL_CLPT_IND_SEQ = N1ST_SKD.CLPT_IND_SEQ(+)
    AND LAST_VVD.VSL_CD     = LAST_SKD.VSL_CD(+)
    AND LAST_VVD.SKD_VOY_NO = LAST_SKD.SKD_VOY_NO(+)
    AND LAST_VVD.SKD_DIR_CD = LAST_SKD.SKD_DIR_CD(+)
    AND LAST_VVD.POD_CD     = LAST_SKD.VPS_PORT_CD(+)
    AND LAST_VVD.POD_CLPT_IND_SEQ = LAST_SKD.CLPT_IND_SEQ(+)
	--===================================================================== 화면 조건절 start
#if (${vvd_cd} != '')
    AND VVD.VSL_CD = SUBSTR(@[vvd_cd], 1, 4)
    AND VVD.SKD_VOY_NO = SUBSTR(@[vvd_cd], 5, 4)
    AND VVD.SKD_DIR_CD = SUBSTR(@[vvd_cd], 9, 1)
#if (${trunk_flag} != '')
    AND VVD.VSL_PRE_PST_CD = 'T'
#end
#end
#if (${lane_cd} != '') 
    AND VVD.SLAN_CD = @[lane_cd]
#end
#if (${dir_cd} != '') 
    AND VVD.SKD_DIR_CD IN (@[dir_cd])
#end
#if (${pol_cd} != '')
    AND VVD.POL_CD = @[pol_cd]
#if (${pol_local} != '')
    AND BK.POL_CD = VVD.POL_CD
#end
#if (${pol_ts} != '')
    AND BK.POL_CD <> VVD.POL_CD
#end
#end
#if (${pol_yard_cd} != '') 
    AND SUBSTR(VVD.POL_YD_CD,-2) = @[pol_yard_cd]
#if (${pol_local} != '')
    AND BK.POL_NOD_CD = VVD.POL_YD_CD
#end
#if (${pol_ts} != '')
    AND BK.POL_NOD_CD <> VVD.POL_YD_CD
#end
#end
#if (${pod_cd} != '')
    AND VVD.POD_CD = @[pod_cd]
#if (${pod_local} != '')
    AND BK.POD_CD = VVD.POD_CD
#end
#if (${pod_ts} != '')
    AND BK.POD_CD <> VVD.POD_CD
#end
#end
#if (${pod_yard_cd} != '') 
    AND SUBSTR(VVD.POD_YD_CD,-2) = @[pod_yard_cd]
#if (${pod_local} != '')
    AND BK.POD_NOD_CD = VVD.POD_YD_CD
#end
#if (${pod_ts} != '')
    AND BK.POD_NOD_CD <> VVD.POD_YD_CD
#end
#end
#if (${por_cd} != '') 
    AND BK.POR_CD LIKE @[por_cd]||'%' 
#end
#if (${del_cd} != '') 
    AND BK.DEL_CD LIKE @[del_cd]||'%' 
#end
#if (${r_term} != '') 
    AND BK.RCV_TERM_CD IN (${r_term})
#end
#if (${d_term} != '') 
    AND BK.DE_TERM_CD IN (${d_term})
#end  
#if (${bkg_cgo_tp_cd} != '') 
    AND BK.BKG_CGO_TP_CD = @[bkg_cgo_tp_cd]
#end
#if (${eq_type} != '') 
    AND EXISTS  ( SELECT 'Y'
                    FROM BKG_QUANTITY
                   WHERE BKG_NO = BK.BKG_NO
                     AND CNTR_TPSZ_CD IN (${eq_type})
                )
#end
#if (${bkg_ofc_cd} != '') 
    AND BK.BKG_OFC_CD = @[bkg_ofc_cd]
#end
#if (${bkg_sts_cd} != '')
    AND BK.BKG_STS_CD IN (${bkg_sts_cd})
#else
    AND BK.BKG_STS_CD <> 'X'
#end
	--===================================================================== 화면 조건절 end
       ) BKG_Z
WHERE 1=1
#if (${ecc_cd} != '')
AND SCC_CD = @[ecc_cd]
#end
)
#if (${orderby} == '') 
ORDER BY TEMP, BKG_NO, CNTR_NO
#else
ORDER BY TEMP, ${orderby}
#end			]]></sql>
			<params>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="lane_cd" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pol_yard_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="pod_yard_cd" type="12" value="" out="N"/>
				<param name="por_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
				<param name="bkg_cgo_tp_cd" type="12" value="" out="N"/>
				<param name="bkg_ofc_cd" type="12" value="" out="N"/>
				<param name="ecc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
