<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SpacecontrolinquiryDBDAOSearchSpaceControlTsVolumnListVORSQL">
			<desc><![CDATA[- Lee Sang-Yong : [프로젝트] Ticket ID : CHM-201004171 53ft 추가
2010.11.16 남궁진호 [CHM-201007114-01]  DRL.TO_CONTI_CD <> ‘F’ 조건 제거
2011.01.04 최윤성 [CHM-201008093-01] Office Level Table 생성
 - SPC_ORGANIZATION_V 대신 SPC_OFC_LVL 로 대체
-2011.06.01 [ CHM-201111305-01] 김종준 R5와 동일하게 R9이 적용될 수 있도록 쿼리수정
-2012.01.10 [SRM-201222989] SFX 노선 소속 trade 변경에 따른 inquiry by T/S port 화면 보완
-2012.01.11 [SRM-201222989] SFX 노선 소속 trade 변경에 따른 inquiry by T/S port 화면 보완
2012.12.03 [CHM-201221639] 김시몬 R9와 동일하게 R8이 적용될 수 있도록 쿼리수정]]></desc>
			<sql><![CDATA[
WITH PARAMS1 AS (
    SELECT @[vvd]      AS VVD           ,
           @[sDate]    AS FM_DT         ,
           @[eDate]    AS TO_DT         ,
           @[port]     AS PORT_CD       ,
           @[trade]    AS REP_TRD_CD    ,
           @[subtrade] AS REP_SUB_TRD_CD,
           @[lane]     AS RLANE_CD      ,
           @[bound]    AS BOUND         ,
           @[ioc]      AS IOC_CD        ,
           @[org]      AS ORG
      FROM DUAL
)
, PARAMS AS (
    SELECT VVD,
           LEAST(FM_DT, TO_DT)    AS FM_SDT,
           GREATEST(FM_DT, TO_DT) AS TO_SDT,
           TO_DATE(LEAST(REPLACE(FM_DT,'-',''), REPLACE(TO_DT,'-','')), 'YYYYMMDD')    AS FM_DT,
           TO_DATE(GREATEST(REPLACE(FM_DT,'-',''), REPLACE(TO_DT,'-','')), 'YYYYMMDD') AS TO_DT,
           PORT_CD       ,
           REP_TRD_CD    ,
           REP_SUB_TRD_CD,
           RLANE_CD      ,
           BOUND         ,
           IOC_CD        ,
           ORG           ,
           SUBSTR(VVD, 1, 4) AS VSL_CD    ,
           SUBSTR(VVD, 5, 4) AS SKD_VOY_NO,
           SUBSTR(VVD, 9)    AS SKD_DIR_CD,
           (
             SELECT L.CONTI_CD
               FROM MDM_LOCATION L
              WHERE L.LOC_CD = PORT_CD
           ) AS PORT_CONTI
      FROM PARAMS1
)
, VVDS AS (
    SELECT DISTINCT PRD.COST_YR,
           LPAD(CEIL((TO_CHAR(PS.VPS_ETB_DT, 'DDD') + 7 - TO_CHAR(TO_DATE(PRD.SLS_TO_DT, 'YYYYMMDD'), 'DDD')) / 7), 2, '0') AS COST_WK,
           PS.SLAN_CD   ,
           RL.REP_TRD_CD,
           DRL.SUB_TRD_CD AS REP_SUB_TRD_CD,
           RL.RLANE_CD  ,
           PS.VSL_CD    ,
           PS.SKD_VOY_NO,
           PS.SKD_DIR_CD,
           NVL(PS.YD_CD, PS.VPS_PORT_CD) AS POL_CD,
           PS.CLPT_SEQ   AS POL_SEQ   ,
           PS.VPS_ETB_DT AS POL_ETB_DT,
           P.PORT_CONTI  AS POL_CONTI ,
           P.IOC_CD,
           P.ORG
      FROM COA_WK_PRD       PRD,
           VSK_VSL_PORT_SKD PS ,
           MDM_REV_LANE     RL ,
           MDM_DTL_REV_LANE DRL,
           PARAMS           P
     WHERE PRD.COST_YR         = TO_CHAR(PS.VPS_ETB_DT, 'YYYY')
       AND PRD.COST_WK         = '01'
       AND RL.VSL_SLAN_CD      = PS.SLAN_CD
       AND RL.RLANE_CD         = DRL.RLANE_CD
       AND RL.REP_TRD_CD       = DRL.TRD_CD
       AND DRL.VSL_SLAN_DIR_CD = PS.SKD_DIR_CD
       AND RL.DELT_FLG         = 'N'
       AND DRL.DELT_FLG        = 'N'
       /**  CHM-201007114-01 처리
       AND DRL.TO_CONTI_CD    <> 'F' 
       **/
       AND RL.REP_TRD_CD       = P.REP_TRD_CD
       AND (P.REP_SUB_TRD_CD IS NULL OR P.REP_SUB_TRD_CD = DRL.SUB_TRD_CD)
       AND (P.RLANE_CD IS NULL OR P.RLANE_CD = RL.RLANE_CD)
       AND (P.BOUND IS NULL OR P.BOUND = PS.SKD_DIR_CD)
       AND RL.VSL_TP_CD   = 'C'
       AND RL.RLANE_CD   <> 'RBCCO'
       AND PS.VPS_PORT_CD = P.PORT_CD
       AND PS.SKD_DIR_CD  > ' '
       AND PS.VPS_ETB_DT >= P.FM_DT
       AND PS.VPS_ETB_DT  < P.TO_DT + 1
       AND (PS.SKD_CNG_STS_CD IS NULL OR PS.SKD_CNG_STS_CD <> 'S')
       AND PS.TURN_PORT_IND_CD IN ('Y', 'N')
       AND P.VVD IS NULL
    UNION ALL
    SELECT PRD.COST_YR,
           LPAD(CEIL((TO_CHAR(PS.VPS_ETB_DT, 'DDD') + 7 - TO_CHAR(TO_DATE(PRD.SLS_TO_DT, 'YYYYMMDD'), 'DDD')) / 7), 2, '0') AS COST_WK,
           PS.SLAN_CD   ,
           RL.REP_TRD_CD,
           (
             SELECT DRL.SUB_TRD_CD
               FROM MDM_DTL_REV_LANE DRL
              WHERE RL.RLANE_CD         = DRL.RLANE_CD
                AND RL.REP_TRD_CD       = DRL.TRD_CD
                AND DRL.VSL_SLAN_DIR_CD = PS.SKD_DIR_CD
                AND DRL.DELT_FLG        = 'N'
                /**  CHM-201007114-01 처리 
                AND DRL.TO_CONTI_CD    <> 'F' 
                **/
                AND ROWNUM = 1
           ) AS REP_SUB_TRD_CD,
           RL.RLANE_CD  ,
           PS.VSL_CD    ,
           PS.SKD_VOY_NO,
           PS.SKD_DIR_CD,
           NVL(PS.YD_CD, PS.VPS_PORT_CD) AS POL_CD,
           PS.CLPT_SEQ    AS POL_SEQ   ,
           PS.VPS_ETB_DT  AS POL_ETB_DT,
           P.PORT_CONTI   AS POL_CONTI ,
           P.IOC_CD,
           P.ORG
      FROM COA_WK_PRD       PRD,
           VSK_VSL_PORT_SKD PS ,
           MDM_REV_LANE     RL ,
           PARAMS           P
     WHERE PRD.COST_YR    = TO_CHAR(PS.VPS_ETB_DT, 'YYYY')
       AND PRD.COST_WK    = '01'
       AND RL.VSL_SLAN_CD = PS.SLAN_CD
       AND RL.DELT_FLG    = 'N'
       AND RL.VSL_TP_CD   = 'C'
       AND RL.RLANE_CD   <> 'RBCCO'
       AND PS.VPS_PORT_CD = P.PORT_CD
       AND PS.SKD_DIR_CD  > ' '
       AND PS.VSL_CD      = P.VSL_CD
       AND PS.SKD_VOY_NO  = P.SKD_VOY_NO
       AND PS.SKD_DIR_CD  = P.SKD_DIR_CD
       AND (PS.SKD_CNG_STS_CD IS NULL OR PS.SKD_CNG_STS_CD <> 'S')
       AND PS.TURN_PORT_IND_CD IN ('Y', 'N')
       AND RL.RLANE_CD    IN (SELECT RLANE_CD 
                                FROM COA_MON_VVD
                               WHERE VSL_CD = P.VSL_CD
                                 AND SKD_VOY_NO = P.SKD_VOY_NO
                                 AND DIR_CD = P.SKD_DIR_CD
                                 AND DELT_FLG = 'N')
       AND P.VVD IS NOT NULL
)
, PORT_SKD AS (
    SELECT PS.COST_YR       ,
           PS.COST_WK       ,
           PS.SLAN_CD       ,
           PS.REP_TRD_CD    ,
           PS.REP_SUB_TRD_CD,
           DRL.TRD_CD       ,
           DRL.SUB_TRD_CD   ,
           PS.RLANE_CD      ,
           PS.VSL_CD        ,
           PS.SKD_VOY_NO    ,
           PS.SKD_DIR_CD    ,
           PS.POL_CD        ,
           PS.POL_SEQ       ,
           PS.POL_ETB_DT    ,
           SPC_CONTI_CONV_FNC(PS.POL_CONTI, PS.RLANE_CD,PS.SKD_DIR_CD) as pol_conti     ,
           NVL(VPS.YD_CD, VPS.VPS_PORT_CD) AS POD_CD,
           VPS.CLPT_SEQ   AS POD_SEQ   ,
           VPS.VPS_ETB_DT AS POD_ETB_DT,
           SPC_CONTI_CONV_FNC(L.CONTI_CD, PS.RLANE_CD,PS.SKD_DIR_CD)     AS POD_CONTI ,
           NVL(CO.CTRL_PORT_FLG   , 'N') AS CTRL_PORT,
           NVL(CO.CTRL_40FT_HC_FLG, 'N') AS CTRL_HC  ,
           NVL(CO.CTRL_45FT_HC_FLG, 'N') AS CTRL_45  ,
           NVL(CO.CTRL_53FT_FLG,    'N') AS CTRL_53  ,
           NVL(CO.CTRL_RF_FLG     , 'N') AS CTRL_RF  ,
           NVL(CO.CTRL_WGT_FLG    , 'N') AS CTRL_WGT ,
           PS.IOC_CD,
           PS.ORG
      FROM MDM_DTL_REV_LANE  DRL,
           MDM_LOCATION      L  ,
           VSK_VSL_PORT_SKD  VPS,
           SPC_ALOC_CTRL_OPT CO ,
           VVDS              PS
     WHERE DRL.RLANE_CD        = PS.RLANE_CD
       AND DRL.VSL_SLAN_DIR_CD = PS.SKD_DIR_CD
       AND DRL.IOC_CD          = DECODE(PS.POL_CONTI,SPC_CONTI_CONV_FNC(L.CONTI_CD, PS.RLANE_CD,PS.SKD_DIR_CD), 'I', 'O')
       AND DRL.FM_CONTI_CD     = SPC_CONTI_CONV_FNC(PS.POL_CONTI, PS.RLANE_CD,PS.SKD_DIR_CD)
       AND DRL.TO_CONTI_CD     = SPC_CONTI_CONV_FNC(L.CONTI_CD, PS.RLANE_CD,PS.SKD_DIR_CD)
       AND DRL.DELT_FLG        = 'N'
       AND L.LOC_CD            = VPS.VPS_PORT_CD
       AND VPS.VSL_CD          = PS.VSL_CD
       AND VPS.SKD_VOY_NO      = PS.SKD_VOY_NO
       AND VPS.SKD_DIR_CD      = PS.SKD_DIR_CD
       AND VPS.SLAN_CD         = PS.SLAN_CD
       AND VPS.CLPT_SEQ        > PS.POL_SEQ
       AND CO.RLANE_CD  (+)    = PS.RLANE_CD
       AND CO.DIR_CD    (+)    = PS.SKD_DIR_CD
       AND CO.VSL_CD    (+)    = PS.VSL_CD
       AND CO.SKD_VOY_NO(+)    = PS.SKD_VOY_NO
       AND CO.SKD_DIR_CD(+)    = PS.SKD_DIR_CD
)
, BOOKING AS (
    SELECT --BV.BKG_NO        ,
           --BV.BKG_NO_SPLIT  ,
           --BV.VSL_PRE_PST_CD,
           BV.BKG_NO        ,
           BV.VSL_PRE_PST_CD,
           V.POL_ETB_DT     ,
           V.REP_TRD_CD     ,
           V.REP_SUB_TRD_CD ,
           V.TRD_CD         ,
           V.SUB_TRD_CD     ,
           V.RLANE_CD       ,
           V.COST_YR        ,
           V.COST_WK        ,
           V.VSL_CD         ,
           V.SKD_VOY_NO     ,
           V.SKD_DIR_CD     ,
           DECODE(BV.VSL_PRE_PST_CD, 'T', DECODE(V.POL_CONTI, V.POD_CONTI, 'IPC', 'OCN'), 'T/S') AS IOC_CD,
           SPC_SCR_OFC_CONV_FNC(B.OB_SLS_OFC_CD) AS SLS_OFC_CD,
           V.POL_CD ,
           V.POD_CD ,
           V.POD_SEQ,
           V.SLAN_CD,
           (
              SELECT    TO_CHAR(SUM(DECODE(SAQ_GET_CNTR_SZ_FNC(Q.CNTR_TPSZ_CD), '2', 1, 2)*Q.OP_CNTR_QTY), 'FM0000000000.000')
                     || TO_CHAR(SUM(DECODE(SAQ_GET_CNTR_SZ_FNC(Q.CNTR_TPSZ_CD), '2', Q.OP_CNTR_QTY, 0)), 'FM0000000000.000')
                     || TO_CHAR(SUM(DECODE(SAQ_GET_CNTR_SZ_FNC(Q.CNTR_TPSZ_CD), '4', Q.OP_CNTR_QTY, 0)), 'FM0000000000.000')
                     || TO_CHAR(SUM(DECODE(SAQ_GET_CNTR_SZ_FNC(Q.CNTR_TPSZ_CD), '5', Q.OP_CNTR_QTY, '9', Q.OP_CNTR_QTY, '8', Q.OP_CNTR_QTY, 0)), 'FM0000000000.000')	--R9,R8에 대해서 R5과 동일하게 HC으로 처리되도록 추가
                     || TO_CHAR(SUM(DECODE(SAQ_GET_CNTR_SZ_FNC(Q.CNTR_TPSZ_CD), '7', Q.OP_CNTR_QTY, 0)), 'FM0000000000.000')
                     || TO_CHAR(SUM(DECODE(Q.CNTR_TPSZ_CD, 'DW', Q.OP_CNTR_QTY, 'DX', Q.OP_CNTR_QTY, 0)), 'FM0000000000.000') 
                     || TO_CHAR(SUM(DECODE(Q.CNTR_TPSZ_CD, 'R2', Q.OP_CNTR_QTY - Q.EQ_SUBST_CGO_QTY, 0)), 'FM0000000000.000')
                     || TO_CHAR(SUM(CASE WHEN SUBSTR(Q.CNTR_TPSZ_CD, 1, 1) = 'R' AND Q.CNTR_TPSZ_CD <> 'R2' THEN Q.OP_CNTR_QTY - Q.EQ_SUBST_CGO_QTY ELSE 0 END), 'FM0000000000.000')
                     || TO_CHAR((MAX(D.ACT_WGT) * DECODE(MAX(D.WGT_UT_CD), 'LBS', 0.00045, 0.001)) + SUM(Q.OP_CNTR_QTY * ( SELECT TS.CNTR_TPSZ_TARE_WGT
                                                                                                                             FROM MDM_CNTR_TP_SZ TS
                                                                                                                            WHERE TS.CNTR_TPSZ_CD = Q.CNTR_TPSZ_CD)) * 0.001, 'FM0000000000.000')
                FROM BKG_QUANTITY Q
               WHERE B.BKG_NO = Q.BKG_NO 
           ) AS VAL,
           V.CTRL_PORT,
           V.CTRL_HC  ,
           V.CTRL_45  ,
           V.CTRL_53  ,
           V.CTRL_RF  ,
           V.CTRL_WGT ,
           V.ORG
      FROM BKG_BOOKING B ,
           BKG_VVD     BV,
           PORT_SKD    V ,
           BKG_BL_DOC  D
     WHERE B.BKG_NO         = BV.BKG_NO
       AND B.BKG_STS_CD    IN('W','F')
       AND B.BKG_CGO_TP_CD <> 'P'
       AND BV.VSL_CD        = V.VSL_CD
       AND BV.SKD_VOY_NO    = V.SKD_VOY_NO
       AND BV.SKD_DIR_CD    = V.SKD_DIR_CD
       --AND SUBSTR(NVL(BV.POL_YD_CD, BV.POL_CD), 1, LENGTH(V.POL_CD)) = SUBSTR(V.POL_CD, 1, LENGTH(NVL(BV.POL_YD_CD, BV.POL_CD)))
       --AND SUBSTR(NVL(BV.POD_YD_CD, BV.POD_CD), 1, LENGTH(V.POD_CD)) = SUBSTR(V.POD_CD, 1, LENGTH(NVL(BV.POD_YD_CD, BV.POD_CD)))
       --AND BV.POL_CD        = SUBSTR(V.POL_CD, 1, 5)
       --AND BV.POD_CD        = SUBSTR(V.POD_CD, 1, 5)
       AND (    (V.COST_YR||V.COST_WK  < '201023' AND BV.POL_CD    = SUBSTR(V.POL_CD, 1, 5))
             OR (V.COST_YR||V.COST_WK >= '201023' AND BV.POL_YD_CD = V.POL_CD))
       AND (    (V.COST_YR||V.COST_WK  < '201023' AND BV.POD_CD    = SUBSTR(V.POD_CD, 1, 5))
             OR (V.COST_YR||V.COST_WK >= '201023' AND BV.POD_YD_CD = V.POD_CD))
       AND BV.SLAN_CD       = V.SLAN_CD
       AND (V.ORG IS NULL OR SPC_SCR_OFC_CONV_FNC(B.OB_SLS_OFC_CD) = V.ORG)
       AND (V.IOC_CD IS NULL OR DECODE(BV.VSL_PRE_PST_CD, 'T', DECODE(V.POL_CONTI, V.POD_CONTI, 'IPC', 'OCN'), 'T/S') = V.IOC_CD)
       AND B.BKG_NO         = D.BKG_NO
)
  SELECT TO_CHAR(Z7.ETB_DT, 'YYYY.MM.DD') AS ETB_DT,
         Z7.REP_TRD_CD    ,
         Z7.REP_SUB_TRD_CD,
         Z7.TRD_CD        ,
         Z7.SUB_TRD_CD    ,
         Z7.RLANE_CD      ,
         Z7.COST_WK       ,
         Z7.VVD           ,
         Z7.IOC_CD        ,
         Z7.SLS_RHQ_CD    ,
         '' AS SLS_AQ_CD  ,
         Z7.SLS_RGN_OFC_CD,
         MAX(Z7.SLS_OFC_CD)         AS SLS_OFC_CD        ,
         MAX(Z7.POD_CD)             AS POD_CD            ,
         MAX(Z7.FCAST_TTL)          AS FCAST_TTL         ,
         MAX(Z7.FCAST_HC)           AS FCAST_HC          ,
         MAX(Z7.FCAST_45)           AS FCAST_45          ,
         MAX(Z7.FCAST_53)           AS FCAST_53          ,
         MAX(Z7.FCAST_RF)           AS FCAST_RF          ,
         MAX(Z7.FCAST_WGT)          AS FCAST_WGT         ,
         MAX(Z7.ASGN_TTL)           AS ASGN_TTL          ,
         MAX(Z7.ASGN_HC)            AS ASGN_HC           ,
         MAX(Z7.ASGN_45)            AS ASGN_45           ,
         MAX(Z7.ASGN_53)            AS ASGN_53           ,
         MAX(Z7.ASGN_RF)            AS ASGN_RF           ,
         MAX(Z7.ASGN_WGT)           AS ASGN_WGT          ,
         MAX(Z7.DIF_TTL)            AS DIF_TTL           ,
         MAX(Z7.DIF_HC)             AS DIF_HC            ,
         MAX(Z7.DIF_45)             AS DIF_45            ,
         MAX(Z7.DIF_53)             AS DIF_53            ,
         MAX(Z7.DIF_RF)             AS DIF_RF            ,
         MAX(Z7.DIF_WGT)            AS DIF_WGT           ,
         MAX(Z7.BKG_TTL)            AS BKG_TTL           ,
         MAX(Z7.BKG_S20)            AS BKG_S20           ,
         MAX(Z7.BKG_S40)            AS BKG_S40           ,
         MAX(Z7.BKG_20)             AS BKG_20            ,
         MAX(Z7.BKG_40)             AS BKG_40            ,
         MAX(Z7.BKG_HC)             AS BKG_HC            ,
         MAX(Z7.BKG_45)             AS BKG_45            ,
         MAX(Z7.BKG_53)             AS BKG_53            ,
         MAX(Z7.BKG_RF20)           AS BKG_RF20          ,
         MAX(Z7.BKG_RF40)           AS BKG_RF40          ,
         MAX(Z7.BKG_WGT)            AS BKG_WGT           ,
         MAX(Z7.PRE_REP_TRD_CD)     AS PRE_REP_TRD_CD    ,
         MAX(Z7.PRE_REP_SUB_TRD_CD) AS PRE_REP_SUB_TRD_CD,
         MAX(Z7.PRE_RLANE_CD)       AS PRE_RLANE_CD      ,
         MAX(Z7.PRE_VVD)            AS PRE_VVD           ,
         MAX(Z7.PRE_ETB_DT)         AS PRE_ETB_DT        ,
         MAX(Z7.DIS_TTL)            AS DIS_TTL           ,
         MAX(Z7.DIS_S20)            AS DIS_S20           ,
         MAX(Z7.DIS_S40)            AS DIS_S40           ,
         MAX(Z7.DIS_20)             AS DIS_20            ,
         MAX(Z7.DIS_40)             AS DIS_40            ,
         MAX(Z7.DIS_HC)             AS DIS_HC            ,
         MAX(Z7.DIS_45)             AS DIS_45            ,
         MAX(Z7.DIS_53)             AS DIS_53            ,
         MAX(Z7.DIS_RF20)           AS DIS_RF20          ,
         MAX(Z7.DIS_RF40)           AS DIS_RF40          ,
         MAX(Z7.DIS_WGT)            AS DIS_WGT
    FROM (
            SELECT Z6.ETB_DT        ,
                   Z6.REP_TRD_CD    ,
                   Z6.REP_SUB_TRD_CD,
                   Z6.TRD_CD        ,
                   Z6.SUB_TRD_CD    ,
                   Z6.RLANE_CD      ,
                   Z6.COST_WK       ,
                   Z6.VVD           ,
                   Z6.IOC_CD        ,
                   Z6.SLS_RHQ_CD    ,
                   Z6.SLS_AQ_CD     ,
                   Z6.SLS_RGN_OFC_CD,
                   RANK() OVER ( PARTITION BY Z6.ETB_DT, Z6.REP_TRD_CD, Z6.REP_SUB_TRD_CD, Z6.TRD_CD, Z6.SUB_TRD_CD, Z6.RLANE_CD, Z6.COST_WK, Z6.VVD, Z6.IOC_CD, Z6.SLS_RHQ_CD, Z6.SLS_AQ_CD, Z6.SLS_RGN_OFC_CD ORDER BY ROWNUM) AS RK,
                   Z6.SLS_OFC_CD    ,
                   Z6.POD_CD        ,
                   Z6.FCAST_TTL     ,
                   Z6.FCAST_HC      ,
                   Z6.FCAST_45      ,
                   Z6.FCAST_53      ,
                   Z6.FCAST_RF      ,
                   Z6.FCAST_WGT     ,
                   Z6.ASGN_TTL      ,
                   Z6.ASGN_HC       ,
                   Z6.ASGN_45       ,
                   Z6.ASGN_53       ,
                   Z6.ASGN_RF       ,
                   Z6.ASGN_WGT      ,
                   Z6.DIF_TTL       ,
                   Z6.DIF_HC        ,
                   Z6.DIF_45        ,
                   Z6.DIF_53        ,
                   Z6.DIF_RF        ,
                   Z6.DIF_WGT       ,
                   Z6.BKG_TTL       ,
                   Z6.BKG_S20       ,
                   Z6.BKG_S40       ,
                   Z6.BKG_20        ,
                   Z6.BKG_40        ,
                   Z6.BKG_HC        ,
                   Z6.BKG_45        ,
                   Z6.BKG_53        ,
                   Z6.BKG_RF20      ,
                   Z6.BKG_RF40      ,
                   Z6.BKG_WGT       ,
                   ''   AS PRE_REP_TRD_CD    ,
                   ''   AS PRE_REP_SUB_TRD_CD,
                   ''   AS PRE_RLANE_CD      ,
                   ''   AS PRE_VVD           ,
                   ''   AS PRE_ETB_DT        ,
                   NULL AS DIS_TTL           ,
                   NULL AS DIS_S20           ,
                   NULL AS DIS_S40           ,
                   NULL AS DIS_20            ,
                   NULL AS DIS_40            ,
                   NULL AS DIS_HC            ,
                   NULL AS DIS_45            ,
                   NULL AS DIS_53            ,
                   NULL AS DIS_RF20          ,
                   NULL AS DIS_RF40          ,
                   NULL AS DIS_WGT
              FROM (
                      SELECT Z5.ETB_DT        ,
                             Z5.REP_TRD_CD    ,
                             Z5.REP_SUB_TRD_CD,
                             Z5.TRD_CD        ,
                             Z5.SUB_TRD_CD    ,
                             Z5.RLANE_CD      ,
                             Z5.COST_WK       ,
                             Z5.VVD           ,
                             Z5.IOC_CD        ,
                             Z5.SLS_RHQ_CD    ,
                             Z5.SLS_AQ_CD     ,
                             Z5.SLS_RGN_OFC_CD,
                             Z5.SLS_OFC_CD    ,
                             Z5.POD_CD        ,
                             SUM(Z5.FCAST_TTL) AS FCAST_TTL,
                             SUM(Z5.FCAST_HC)  AS FCAST_HC ,
                             SUM(Z5.FCAST_45)  AS FCAST_45 ,
                             SUM(Z5.FCAST_53)  AS FCAST_53 ,
                             SUM(Z5.FCAST_RF)  AS FCAST_RF ,
                             SUM(Z5.FCAST_WGT) AS FCAST_WGT,
                             SUM(Z5.ASGN_TTL)  AS ASGN_TTL ,
                             SUM(Z5.ASGN_HC)   AS ASGN_HC  ,
                             SUM(Z5.ASGN_45)   AS ASGN_45  ,
                             SUM(Z5.ASGN_53)   AS ASGN_53  ,
                             SUM(Z5.ASGN_RF)   AS ASGN_RF  ,
                             SUM(Z5.ASGN_WGT)  AS ASGN_WGT ,
                             -- Alloc 정보가 입력되지 않은 경우에는 0으로 인식되어 BKG과의 Diff가 보여지도록 보완
                             SUM(NVL(Z5.ASGN_TTL, 0)) - SUM(Z5.BKG_TTL) AS DIF_TTL,		
                             SUM(NVL(Z5.ASGN_HC, 0))  - SUM(Z5.BKG_HC)  AS DIF_HC ,
                             SUM(NVL(Z5.ASGN_45, 0))  - SUM(Z5.BKG_45)  AS DIF_45 ,
                             SUM(NVL(Z5.ASGN_53, 0))  - SUM(Z5.BKG_53)  AS DIF_53 ,
                             SUM(NVL(Z5.ASGN_RF, 0))  - SUM(Z5.BKG_RF20) - SUM(Z5.BKG_RF40) AS DIF_RF,
                             SUM(NVL(Z5.ASGN_WGT, 0)) - SUM(Z5.BKG_WGT) AS DIF_WGT,
                             SUM(Z5.BKG_TTL)   AS BKG_TTL ,
                             SUM(Z5.BKG_20)    AS BKG_S20 , --20에 R2가 포함되어 있음:뒤자리 2만 취하므로\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\N ');
                             SUM(Z5.BKG_40) + SUM(Z5.BKG_HC) + SUM(Z5.BKG_45) + SUM(Z5.BKG_53) AS BKG_S40, --40/HC/45에 R4,R7,R5가 포함되어 있음
                             SUM(Z5.BKG_20)    AS BKG_20  ,
                             SUM(Z5.BKG_40)    AS BKG_40  ,
                             SUM(Z5.BKG_HC)    AS BKG_HC  ,
                             SUM(Z5.BKG_45)    AS BKG_45  ,
                             SUM(Z5.BKG_53)    AS BKG_53  ,
                             SUM(Z5.BKG_RF20)  AS BKG_RF20,
                             SUM(Z5.BKG_RF40)  AS BKG_RF40,
                             SUM(Z5.BKG_WGT)   AS BKG_WGT
                        FROM (
                                -- 2009-04-23 서관영/최윤성 CSR:N200904130110, N200904150051 -- DAILY FORECAST 데이터 추가
                                -- DAILY FORECAST
                                SELECT Z3.POL_ETB_DT AS ETB_DT,
                                       Z3.REP_TRD_CD    ,
                                       Z3.REP_SUB_TRD_CD,
                                       Z3.TRD_CD        ,
                                       Z3.SUB_TRD_CD    ,
                                       Z3.RLANE_CD      ,
                                       Z3.COST_WK       ,
                                       Z3.VSL_CD||Z3.SKD_VOY_NO||Z3.SKD_DIR_CD AS VVD,
                                       Z3.IOC_CD    ,
                                       Z3.SLS_RHQ_CD,
                                       NVL(Z3.SLS_AQ_CD     , ' ') AS SLS_AQ_CD     ,
                                       NVL(Z3.SLS_RGN_OFC_CD, ' ') AS SLS_RGN_OFC_CD,
                                       NVL(Z3.SLS_OFC_CD    , ' ') AS SLS_OFC_CD    ,
                                       NVL(Z3.POD_CD        , ' ') AS POD_CD        ,
                                       Z3.POD_SEQ      ,
                                       Z3.FCAST_TTL    ,
                                       Z3.FCAST_HC     ,
                                       Z3.FCAST_45     ,
                                       Z3.FCAST_53     ,
                                       Z3.FCAST_RF     ,
                                       Z3.FCAST_WGT    ,
                                       NULL AS ASGN_TTL,
                                       NULL AS ASGN_HC ,
                                       NULL AS ASGN_45 ,
                                       NULL AS ASGN_53 ,
                                       NULL AS ASGN_RF ,
                                       NULL AS ASGN_WGT,
                                       0    AS BKG_TTL ,
                                       0    AS BKG_20  ,
                                       0    AS BKG_40  ,
                                       0    AS BKG_HC  ,
                                       0    AS BKG_45  ,
                                       0    AS BKG_53  ,
                                       0    AS BKG_RF20,
                                       0    AS BKG_RF40,
                                       0    AS BKG_WGT
                                  FROM (
                                          SELECT Z2.POL_ETB_DT    ,
                                                 Z2.REP_TRD_CD    ,
                                                 Z2.REP_SUB_TRD_CD,
                                                 Z2.TRD_CD        ,
                                                 Z2.SUB_TRD_CD    ,
                                                 Z2.RLANE_CD      ,
                                                 Z2.COST_WK       ,
                                                 Z2.VSL_CD        ,
                                                 Z2.SKD_VOY_NO    ,
                                                 Z2.SKD_DIR_CD    ,
                                                 Z2.IOC_CD        ,
                                                 Z2.SLS_RHQ_CD    ,
                                                 Z2.SLS_AQ_CD     ,
                                                 ( CASE WHEN Z2.FLG + Q.SEQ >= 3 THEN Z2.SLS_RGN_OFC_CD END) AS SLS_RGN_OFC_CD,
                                                 DECODE(Z2.FLG + Q.SEQ, 4, Z2.SLS_OFC_CD) AS SLS_OFC_CD,
                                                 Z2.POD_CD,
                                                 MIN(Z2.POD_SEQ) AS POD_SEQ,
                                                 Z2.FLG + Q.SEQ  AS TT,
                                                 DECODE(Z2.FLG + Q.SEQ, 4, SUM(Z2.FCAST_TTL), SUM(Z2.FCAST_TTL)) AS FCAST_TTL,
                                                 DECODE(Z2.CTRL_HC , 'Y', DECODE(Z2.FLG + Q.SEQ, 4, SUM(Z2.FCAST_HC) , SUM(Z2.FCAST_HC)))  AS FCAST_HC ,
                                                 DECODE(Z2.CTRL_45 , 'Y', DECODE(Z2.FLG + Q.SEQ, 4, SUM(Z2.FCAST_45) , SUM(Z2.FCAST_45)))  AS FCAST_45 ,
                                                 DECODE(Z2.CTRL_53 , 'Y', DECODE(Z2.FLG + Q.SEQ, 4, SUM(Z2.FCAST_53) , SUM(Z2.FCAST_53)))  AS FCAST_53 ,
                                                 DECODE(Z2.CTRL_RF , 'Y', DECODE(Z2.FLG + Q.SEQ, 4, SUM(Z2.FCAST_RF) , SUM(Z2.FCAST_RF)))  AS FCAST_RF ,
                                                 DECODE(Z2.CTRL_WGT, 'Y', DECODE(Z2.FLG + Q.SEQ, 4, SUM(Z2.FCAST_WGT), SUM(Z2.FCAST_WGT))) AS FCAST_WGT,
                                                 Z2.CTRL_PORT,
                                                 Z2.CTRL_HC  ,
                                                 Z2.CTRL_45  ,
                                                 Z2.CTRL_53  ,
                                                 Z2.CTRL_RF  ,
                                                 Z2.CTRL_WGT ,
                                                 '' AS T
                                            FROM (
                                                    SELECT V.POL_ETB_DT     ,
                                                           DF.REP_TRD_CD    ,
                                                           DF.REP_SUB_TRD_CD,
                                                           DF.TRD_CD        ,
                                                           DF.SUB_TRD_CD    ,
                                                           DF.RLANE_CD      ,
                                                           V.COST_WK        ,
                                                           DF.VSL_CD        ,
                                                           DF.SKD_VOY_NO    ,
                                                           DF.SKD_DIR_CD    ,
                                                           DECODE(DF.IOC_TS_CD, 'T', 'T/S','O', 'OCN', 'I', 'IPC') AS IOC_CD,
                                                           DECODE(DF.SLS_OFC_CD, DF.SLS_RHQ_CD, 1, DF.SLS_RGN_OFC_CD, 2, 3) AS FLG,
                                                           DF.SLS_RHQ_CD    ,
                                                           DF.SLS_AQ_CD     ,
                                                           DF.SLS_RGN_OFC_CD,
                                                           DF.SLS_OFC_CD    ,
                                                           SUBSTR(DF.POD_YD_CD, 1, 5) AS POD_CD,
                                                           V.POD_SEQ,
                                                           DF.FCAST_TTL_QTY     AS FCAST_TTL,
                                                           DF.FCAST_40FT_HC_QTY AS FCAST_HC ,
                                                           DF.FCAST_45FT_HC_QTY AS FCAST_45 ,
                                                           DF.FCAST_53FT_QTY    AS FCAST_53 ,
                                                           DF.FCAST_RF_QTY      AS FCAST_RF ,
                                                           DF.FCAST_TTL_WGT     AS FCAST_WGT,
                                                           NULL AS AVAL_TTL,
                                                           NULL AS AVAL_HC ,
                                                           NULL AS AVAL_45 ,
                                                           NULL AS AVAL_53 ,
                                                           NULL AS AVAL_RF ,
                                                           NULL AS AVAL_WGT,
                                                           V.CTRL_PORT     ,
                                                           V.CTRL_HC       ,
                                                           V.CTRL_45       ,
                                                           V.CTRL_53       ,
                                                           V.CTRL_RF       ,
                                                           V.CTRL_WGT
                                                      FROM SPC_DLY_FCAST_CUST DF,
                                                           PORT_SKD           V
                                                     WHERE DF.REP_TRD_CD              = V.REP_TRD_CD
                                                       AND DF.REP_SUB_TRD_CD          = V.REP_SUB_TRD_CD
                                                       AND DF.RLANE_CD                = V.RLANE_CD
                                                       AND DF.DIR_CD                  = V.SKD_DIR_CD
                                                       AND DF.VSL_CD                  = V.VSL_CD
                                                       AND DF.SKD_VOY_NO              = V.SKD_VOY_NO
                                                       AND DF.SKD_DIR_CD              = V.SKD_DIR_CD
                                                       AND SUBSTR(DF.POL_YD_CD, 1, LENGTH(V.POL_CD)) = V.POL_CD
                                                       AND SUBSTR(DF.POD_YD_CD, 1, LENGTH(V.POD_CD)) = V.POD_CD
                                                       AND (V.IOC_CD IS NULL OR DECODE(DF.IOC_TS_CD, 'T', 'T/S','O', 'OCN', 'I', 'IPC') = V.IOC_CD)
                                                       AND (V.ORG IS NULL OR V.ORG = DF.SLS_OFC_CD)
                                                 ) Z2,
                                                 ( SELECT LEVEL SEQ
                                                     FROM DUAL
                                                  CONNECT BY LEVEL <= 2 ) Q
                                           WHERE Q.SEQ = DECODE(Z2.FLG, 3, 1, Q.SEQ)
                                             AND Z2.FLG + Q.SEQ > 2
                                        GROUP BY Z2.POL_ETB_DT    ,
                                                 Z2.REP_TRD_CD    ,
                                                 Z2.REP_SUB_TRD_CD,
                                                 Z2.TRD_CD        ,
                                                 Z2.SUB_TRD_CD    ,
                                                 Z2.RLANE_CD      ,
                                                 Z2.COST_WK       ,
                                                 Z2.VSL_CD        ,
                                                 Z2.SKD_VOY_NO    ,
                                                 Z2.SKD_DIR_CD    ,
                                                 Z2.IOC_CD        ,
                                                 Z2.SLS_RHQ_CD    ,
                                                 Z2.SLS_AQ_CD     ,
                                                 CASE WHEN Z2.FLG + Q.SEQ >= 3 THEN Z2.SLS_RGN_OFC_CD END,
                                                 Z2.FLG + Q.SEQ   ,
                                                 Z2.CTRL_PORT     ,
                                                 Z2.CTRL_HC       ,
                                                 Z2.CTRL_45       ,
                                                 Z2.CTRL_53       ,
                                                 Z2.CTRL_RF       ,
                                                 Z2.CTRL_WGT      ,
                                                 -- TOTAL SUM 값이 필요하여 SLS_OFC_CD 값도 ROLLUP에 추가한뒤 하위부분에서 TT = 4 해당하는것만 취함.
                                                 ROLLUP(DECODE(Z2.FLG + Q.SEQ, 4, Z2.SLS_OFC_CD), Z2.POD_CD)
                                          -- POD 별 TOTAL SUM 값이 필요하여 UNION ALL사용.
                                          UNION ALL
                                          SELECT Z2.POL_ETB_DT    ,
                                                 Z2.REP_TRD_CD    ,
                                                 Z2.REP_SUB_TRD_CD,
                                                 Z2.TRD_CD        ,
                                                 Z2.SUB_TRD_CD    ,
                                                 Z2.RLANE_CD      ,
                                                 Z2.COST_WK       ,
                                                 Z2.VSL_CD        ,
                                                 Z2.SKD_VOY_NO    ,
                                                 Z2.SKD_DIR_CD    ,
                                                 Z2.IOC_CD        ,
                                                 Z2.SLS_RHQ_CD    ,
                                                 Z2.SLS_AQ_CD     ,
                                                 Z2.SLS_RGN_OFC_CD,
                                                 '' AS SLS_OFC_CD ,
                                                 Z2.POD_CD        ,
                                                 Z2.POD_SEQ       ,
                                                 Z2.TT            ,
                                                 SUM(Z2.FCAST_TTL) AS FCAST_TTL,
                                                 DECODE(Z2.CTRL_HC , 'Y', SUM(Z2.FCAST_HC))  AS FCAST_HC ,
                                                 DECODE(Z2.CTRL_45 , 'Y', SUM(Z2.FCAST_45))  AS FCAST_45 ,
                                                 DECODE(Z2.CTRL_53 , 'Y', SUM(Z2.FCAST_53))  AS FCAST_53 ,
                                                 DECODE(Z2.CTRL_RF , 'Y', SUM(Z2.FCAST_RF))  AS FCAST_RF ,
                                                 DECODE(Z2.CTRL_WGT, 'Y', SUM(Z2.FCAST_WGT)) AS FCAST_WGT,
                                                 Z2.CTRL_PORT,
                                                 Z2.CTRL_HC  ,
                                                 Z2.CTRL_45  ,
                                                 Z2.CTRL_53  ,
                                                 Z2.CTRL_RF  ,
                                                 Z2.CTRL_WGT ,
                                                 '' AS T
                                            FROM (
                                                    SELECT Z2.POL_ETB_DT    ,
                                                           Z2.REP_TRD_CD    ,
                                                           Z2.REP_SUB_TRD_CD,
                                                           Z2.TRD_CD        ,
                                                           Z2.SUB_TRD_CD    ,
                                                           Z2.RLANE_CD      ,
                                                           Z2.COST_WK       ,
                                                           Z2.VSL_CD        ,
                                                           Z2.SKD_VOY_NO    ,
                                                           Z2.SKD_DIR_CD    ,
                                                           Z2.IOC_CD        ,
                                                           Z2.SLS_RHQ_CD    ,
                                                           Z2.SLS_AQ_CD     ,
                                                           Z2.SLS_RGN_OFC_CD,
                                                           Z2.SLS_OFC_CD    ,
                                                           Z2.POD_CD        ,
                                                           MIN(Z2.POD_SEQ)   AS POD_SEQ,
                                                           (Z2.FLG + Q.SEQ)  AS TT     ,
                                                           SUM(Z2.FCAST_TTL) AS FCAST_TTL,
                                                           DECODE(Z2.CTRL_HC , 'Y', SUM(Z2.FCAST_HC))  AS FCAST_HC ,
                                                           DECODE(Z2.CTRL_45 , 'Y', SUM(Z2.FCAST_45))  AS FCAST_45 ,
                                                           DECODE(Z2.CTRL_53 , 'Y', SUM(Z2.FCAST_53))  AS FCAST_53 ,
                                                           DECODE(Z2.CTRL_RF , 'Y', SUM(Z2.FCAST_RF))  AS FCAST_RF ,
                                                           DECODE(Z2.CTRL_WGT, 'Y', SUM(Z2.FCAST_WGT)) AS FCAST_WGT,
                                                           Z2.CTRL_PORT,
                                                           Z2.CTRL_HC  ,
                                                           Z2.CTRL_45  ,
                                                           Z2.CTRL_53  ,
                                                           Z2.CTRL_RF  ,
                                                           Z2.CTRL_WGT
                                                      FROM (
                                                              SELECT V.POL_ETB_DT     ,
                                                                     DF.REP_TRD_CD    ,
                                                                     DF.REP_SUB_TRD_CD,
                                                                     DF.TRD_CD        ,
                                                                     DF.SUB_TRD_CD    ,
                                                                     DF.RLANE_CD      ,
                                                                     V.COST_WK        ,
                                                                     DF.VSL_CD        ,
                                                                     DF.SKD_VOY_NO    ,
                                                                     DF.SKD_DIR_CD    ,
                                                                     DECODE(DF.IOC_TS_CD, 'T', 'T/S','O', 'OCN', 'I', 'IPC')          AS IOC_CD,
                                                                     DECODE(DF.SLS_OFC_CD, DF.SLS_RHQ_CD, 1, DF.SLS_RGN_OFC_CD, 2, 3) AS FLG   ,
                                                                     DF.SLS_RHQ_CD    ,
                                                                     DF.SLS_AQ_CD     ,
                                                                     DF.SLS_RGN_OFC_CD,
                                                                     DF.SLS_OFC_CD    ,
                                                                     SUBSTR(DF.POD_YD_CD, 1, 5) AS POD_CD,
                                                                     V.POD_SEQ,
                                                                     DF.FCAST_TTL_QTY     AS FCAST_TTL,
                                                                     DF.FCAST_40FT_HC_QTY AS FCAST_HC ,
                                                                     DF.FCAST_45FT_HC_QTY AS FCAST_45 ,
                                                                     DF.FCAST_53FT_QTY    AS FCAST_53 ,
                                                                     DF.FCAST_RF_QTY      AS FCAST_RF ,
                                                                     DF.FCAST_TTL_WGT     AS FCAST_WGT,
                                                                     V.CTRL_PORT,
                                                                     V.CTRL_HC  ,
                                                                     V.CTRL_45  ,
                                                                     V.CTRL_53  ,
                                                                     V.CTRL_RF  ,
                                                                     V.CTRL_WGT
                                                                FROM SPC_DLY_FCAST_CUST DF,
                                                                     PORT_SKD           V
                                                               WHERE DF.REP_TRD_CD              = V.REP_TRD_CD
                                                                 AND DF.REP_SUB_TRD_CD          = V.REP_SUB_TRD_CD
                                                                 AND DF.RLANE_CD                = V.RLANE_CD
                                                                 AND DF.DIR_CD                  = V.SKD_DIR_CD
                                                                 AND DF.VSL_CD                  = V.VSL_CD
                                                                 AND DF.SKD_VOY_NO              = V.SKD_VOY_NO
                                                                 AND DF.SKD_DIR_CD              = V.SKD_DIR_CD
                                                                 AND SUBSTR(DF.POL_YD_CD, 1, LENGTH(V.POL_CD)) = V.POL_CD
                                                                 AND SUBSTR(DF.POD_YD_CD, 1, LENGTH(V.POL_CD)) = V.POD_CD
                                                                 AND (V.IOC_CD IS NULL OR DECODE(DF.IOC_TS_CD, 'T', 'T/S','O', 'OCN', 'I', 'IPC') = V.IOC_CD)
                                                                 AND (V.ORG IS NULL OR V.ORG = DF.SLS_OFC_CD)
                                                           ) Z2,
                                                           ( SELECT LEVEL AS SEQ
                                                               FROM DUAL
                                                            CONNECT BY LEVEL <= 2 ) Q
                                                      WHERE Q.SEQ = DECODE(Z2.FLG, 3, 1, Q.SEQ)
                                                        AND Z2.FLG + Q.SEQ > 2
                                                        AND Z2.FLG + Q.SEQ = 4
                                                   GROUP BY Z2.POL_ETB_DT    ,
                                                            Z2.REP_TRD_CD    ,
                                                            Z2.REP_SUB_TRD_CD,
                                                            Z2.TRD_CD        ,
                                                            Z2.SUB_TRD_CD    ,
                                                            Z2.RLANE_CD      ,
                                                            Z2.COST_WK       ,
                                                            Z2.VSL_CD        ,
                                                            Z2.SKD_VOY_NO    ,
                                                            Z2.SKD_DIR_CD    ,
                                                            Z2.IOC_CD        ,
                                                            Z2.SLS_RHQ_CD    ,
                                                            Z2.SLS_AQ_CD     ,
                                                            Z2.SLS_RGN_OFC_CD,
                                                            Z2.SLS_OFC_CD    ,
                                                            Z2.FLG + Q.SEQ   ,
                                                            Z2.CTRL_PORT     ,
                                                            Z2.CTRL_HC       ,
                                                            Z2.CTRL_45       ,
                                                            Z2.CTRL_53       ,
                                                            Z2.CTRL_RF       ,
                                                            Z2.CTRL_WGT      ,
                                                            Z2.POD_CD
                                                 ) Z2
                                           WHERE NVL(Z2.FCAST_TTL, 0) + NVL(Z2.FCAST_HC, 0) + NVL(Z2.FCAST_45, 0) + NVL(Z2.FCAST_53, 0) + NVL(Z2.FCAST_RF, 0) + NVL(Z2.FCAST_WGT, 0) <> 0
                                        GROUP BY Z2.POL_ETB_DT    ,
                                                 Z2.REP_TRD_CD    ,
                                                 Z2.REP_SUB_TRD_CD,
                                                 Z2.TRD_CD        ,
                                                 Z2.SUB_TRD_CD    ,
                                                 Z2.RLANE_CD      ,
                                                 Z2.COST_WK       ,
                                                 Z2.VSL_CD        ,
                                                 Z2.SKD_VOY_NO    ,
                                                 Z2.SKD_DIR_CD    ,
                                                 Z2.IOC_CD        ,
                                                 Z2.SLS_RHQ_CD    ,
                                                 Z2.SLS_AQ_CD     ,
                                                 Z2.SLS_RGN_OFC_CD,
                                                 Z2.POD_CD        ,
                                                 Z2.POD_SEQ       ,
                                                 Z2.TT            ,
                                                 Z2.CTRL_PORT     ,
                                                 Z2.CTRL_HC       ,
                                                 Z2.CTRL_45       ,
                                                 Z2.CTRL_53       ,
                                                 Z2.CTRL_RF       ,
                                                 Z2.CTRL_WGT
                                       ) Z3
                                 WHERE (Z3.CTRL_PORT = 'Y' OR Z3.POD_CD IS NULL)
                                   AND Z3.TT = 4
                                UNION ALL
                                --ALLOCATION
                                SELECT Z3.POL_ETB_DT AS ETB_DT,
                                       Z3.REP_TRD_CD    ,
                                       Z3.REP_SUB_TRD_CD,
                                       Z3.TRD_CD        ,
                                       Z3.SUB_TRD_CD    ,
                                       Z3.RLANE_CD      ,
                                       Z3.COST_WK       ,
                                       Z3.VSL_CD||Z3.SKD_VOY_NO||Z3.SKD_DIR_CD AS VVD,
                                       Z3.IOC_CD        ,
                                       Z3.SLS_RHQ_CD    ,
                                       NVL(Z3.SLS_AQ_CD     , ' ') AS SLS_AQ_CD     ,
                                       NVL(Z3.SLS_RGN_OFC_CD, ' ') AS SLS_RGN_OFC_CD,
                                       NVL(Z3.SLS_OFC_CD    , ' ') AS SLS_OFC_CD    ,
                                       NVL(Z3.POD_CD        , ' ') AS POD_CD        ,
                                       Z3.POD_SEQ       ,
                                       NULL AS FCAST_TTL,
                                       NULL AS FCAST_HC ,
                                       NULL AS FCAST_45 ,
                                       NULL AS FCAST_53 ,
                                       NULL AS FCAST_RF ,
                                       NULL AS FCAST_WGT,
                                       Z3.ASGN_TTL      ,
                                       Z3.ASGN_HC       ,
                                       Z3.ASGN_45       ,
                                       Z3.ASGN_53       ,
                                       Z3.ASGN_RF       ,
                                       Z3.ASGN_WGT      ,
                                       0 AS BKG_TTL     ,
                                       0 AS BKG_20      ,
                                       0 AS BKG_40      ,
                                       0 AS BKG_HC      ,
                                       0 AS BKG_45      ,
                                       0 AS BKG_53      ,
                                       0 AS BKG_RF20    ,
                                       0 AS BKG_RF40    ,
                                       0 AS BKG_WGT
                                  FROM (
                                          SELECT Z2.POL_ETB_DT    ,
                                                 Z2.REP_TRD_CD    ,
                                                 Z2.REP_SUB_TRD_CD,
                                                 Z2.TRD_CD        ,
                                                 Z2.SUB_TRD_CD    ,
                                                 Z2.RLANE_CD      ,
                                                 Z2.COST_WK       ,
                                                 Z2.VSL_CD        ,
                                                 Z2.SKD_VOY_NO    ,
                                                 Z2.SKD_DIR_CD    ,
                                                 Z2.IOC_CD        ,
                                                 Z2.SLS_RHQ_CD    ,
                                                 Z2.SLS_AQ_CD     ,
                                                 (CASE WHEN Z2.FLG + Q.SEQ >= 3 THEN Z2.SLS_RGN_OFC_CD END) AS SLS_RGN_OFC_CD,
                                                 DECODE(Z2.FLG + Q.SEQ, 4, Z2.SLS_OFC_CD) AS SLS_OFC_CD,
                                                 Z2.POD_CD,
                                                 MIN(Z2.POD_SEQ)  AS POD_SEQ,
                                                 (Z2.FLG + Q.SEQ) AS TT,
                                                 -- ALLOCATION TTL값과 하위 DATA의 합이 다른 이유는 하위 DATA는 ALLOCATION 당시의 BKG 값을 취하기 때문.
                                                 DECODE(Z2.FLG + Q.SEQ, 4, SUM(Z2.AVAL_TTL), SUM(Z2.ASGN_TTL)) AS ASGN_TTL,
                                                 DECODE(Z2.CTRL_HC , 'Y', DECODE(Z2.FLG + Q.SEQ, 4, SUM(Z2.AVAL_HC) , SUM(Z2.ASGN_HC)))  AS ASGN_HC ,
                                                 DECODE(Z2.CTRL_45 , 'Y', DECODE(Z2.FLG + Q.SEQ, 4, SUM(Z2.AVAL_45) , SUM(Z2.ASGN_45)))  AS ASGN_45 ,
                                                 DECODE(Z2.CTRL_53 , 'Y', DECODE(Z2.FLG + Q.SEQ, 4, SUM(Z2.AVAL_53) , SUM(Z2.ASGN_53)))  AS ASGN_53 ,
                                                 DECODE(Z2.CTRL_RF , 'Y', DECODE(Z2.FLG + Q.SEQ, 4, SUM(Z2.AVAL_RF) , SUM(Z2.ASGN_RF)))  AS ASGN_RF ,
                                                 DECODE(Z2.CTRL_WGT, 'Y', DECODE(Z2.FLG + Q.SEQ, 4, SUM(Z2.AVAL_WGT), SUM(Z2.ASGN_WGT))) AS ASGN_WGT,
                                                 Z2.CTRL_PORT,
                                                 Z2.CTRL_HC  ,
                                                 Z2.CTRL_45  ,
                                                 Z2.CTRL_53  ,
                                                 Z2.CTRL_RF  ,
                                                 Z2.CTRL_WGT ,
                                                 '' AS T
                                            FROM (
                                                    SELECT V.POL_ETB_DT     ,
                                                           AL.REP_TRD_CD    ,
                                                           AL.REP_SUB_TRD_CD,
                                                           AL.TRD_CD        ,
                                                           AL.SUB_TRD_CD    ,
                                                           AL.RLANE_CD      ,
                                                           V.COST_WK        ,
                                                           AL.VSL_CD        ,
                                                           AL.SKD_VOY_NO    ,
                                                           AL.SKD_DIR_CD    ,
                                                           DECODE(AL.TS_FLG, 'Y', 'T/S', DECODE(AL.IOC_CD, 'O', 'OCN', 'I', 'IPC')) AS IOC_CD,
                                                           DECODE(AL.SLS_OFC_CD, AL.SLS_RHQ_CD, 1, AL.SLS_RGN_OFC_CD, 2, 3) AS FLG,
                                                           AL.SLS_RHQ_CD    ,
                                                           AL.SLS_AQ_CD     ,
                                                           AL.SLS_RGN_OFC_CD,
                                                           AL.SLS_OFC_CD    ,
                                                           SUBSTR(AL.POD_YD_CD, 1, 5) AS POD_CD,
                                                           V.POD_SEQ,
                                                           AL.ASGN_TTL_QTY         AS ASGN_TTL,
                                                           AL.ASGN_40FT_HC_QTY     AS ASGN_HC ,
                                                           AL.ASGN_45FT_HC_QTY     AS ASGN_45 ,
                                                           AL.ASGN_53FT_QTY        AS ASGN_53 ,
                                                           AL.ASGN_RF_QTY          AS ASGN_RF ,
                                                           AL.ASGN_TTL_WGT         AS ASGN_WGT,
                                                           AL.BKG_AVAL_TTL_QTY     AS AVAL_TTL,
                                                           AL.BKG_AVAL_40FT_HC_QTY AS AVAL_HC ,
                                                           AL.BKG_AVAL_45FT_HC_QTY AS AVAL_45 ,
                                                           AL.BKG_AVAL_53FT_QTY    AS AVAL_53 ,
                                                           AL.BKG_AVAL_RF_QTY      AS AVAL_RF ,
                                                           AL.BKG_AVAL_TTL_WGT     AS AVAL_WGT,
                                                           V.CTRL_PORT,
                                                           V.CTRL_HC  ,
                                                           V.CTRL_45  ,
                                                           V.CTRL_53  ,
                                                           V.CTRL_RF  ,
                                                           V.CTRL_WGT
                                                      FROM SPC_ALOC_POL_POD AL,
                                                           PORT_SKD         V
                                                     WHERE AL.REP_TRD_CD              = V.REP_TRD_CD
                                                       AND AL.REP_SUB_TRD_CD          = V.REP_SUB_TRD_CD
                                                       AND AL.RLANE_CD                = V.RLANE_CD
                                                       AND AL.DIR_CD                  = V.SKD_DIR_CD
                                                       AND AL.VSL_CD                  = V.VSL_CD
                                                       AND AL.SKD_VOY_NO              = V.SKD_VOY_NO
                                                       AND AL.SKD_DIR_CD              = V.SKD_DIR_CD
                                                       AND SUBSTR(AL.POL_YD_CD, 1, LENGTH(V.POL_CD)) = V.POL_CD
                                                       AND SUBSTR(AL.POD_YD_CD, 1, LENGTH(V.POD_CD)) = V.POD_CD
                                                       AND (V.IOC_CD IS NULL OR DECODE(AL.TS_FLG, 'Y', 'T/S', DECODE(AL.IOC_CD, 'O', 'OCN', 'I', 'IPC')) = V.IOC_CD)
                                                       AND (V.ORG IS NULL OR V.ORG = AL.SLS_OFC_CD)
                                                 ) Z2,
                                                 ( SELECT LEVEL AS SEQ
                                                     FROM DUAL
                                                  CONNECT BY LEVEL <= 2 ) Q
                                           WHERE Q.SEQ = DECODE(Z2.FLG, 3, 1, Q.SEQ)
                                             AND Z2.FLG + Q.SEQ > 2
                                        GROUP BY Z2.POL_ETB_DT    ,
                                                 Z2.REP_TRD_CD    ,
                                                 Z2.REP_SUB_TRD_CD,
                                                 Z2.TRD_CD        ,
                                                 Z2.SUB_TRD_CD    ,
                                                 Z2.RLANE_CD      ,
                                                 Z2.COST_WK       ,
                                                 Z2.VSL_CD        ,
                                                 Z2.SKD_VOY_NO    ,
                                                 Z2.SKD_DIR_CD    ,
                                                 Z2.IOC_CD        ,
                                                 Z2.SLS_RHQ_CD    ,
                                                 Z2.SLS_AQ_CD     ,
                                                 CASE WHEN Z2.FLG + Q.SEQ >= 3 THEN Z2.SLS_RGN_OFC_CD END,
                                                 DECODE(Z2.FLG + Q.SEQ, 4, Z2.SLS_OFC_CD),
                                                 Z2.FLG + Q.SEQ   ,
                                                 Z2.CTRL_PORT     ,
                                                 Z2.CTRL_HC       ,
                                                 Z2.CTRL_45       ,
                                                 Z2.CTRL_53       ,
                                                 Z2.CTRL_RF       ,
                                                 Z2.CTRL_WGT      ,
                                                 ROLLUP(Z2.POD_CD)
                                       ) Z3
                                 WHERE Z3.CTRL_PORT = 'Y' OR Z3.POD_CD IS NULL
                                UNION ALL
                                --BOOKING
                                SELECT Z4.ETB_DT        ,
                                       Z4.REP_TRD_CD    ,
                                       Z4.REP_SUB_TRD_CD,
                                       Z4.TRD_CD        ,
                                       Z4.SUB_TRD_CD    ,
                                       Z4.RLANE_CD      ,
                                       Z4.COST_WK       ,
                                       Z4.VVD           ,
                                       Z4.IOC_CD        ,
                                       Z4.SLS_RHQ_CD    ,
                                       Z4.SLS_AQ_CD     ,
                                       Z4.SLS_RGN_OFC_CD,
                                       Z4.SLS_OFC_CD    ,
                                       Z4.POD_CD        ,
                                       Z4.POD_SEQ       ,
                                       NULL AS FCAST_TTL,
                                       NULL AS FCAST_HC ,
                                       NULL AS FCAST_45 ,
                                       NULL AS FCAST_53 ,
                                       NULL AS FCAST_RF ,
                                       NULL AS FCAST_WGT,
                                       NULL AS ASGN_TTL ,
                                       NULL AS ASGN_HC  ,
                                       NULL AS ASGN_45  ,
                                       NULL AS ASGN_53  ,
                                       NULL AS ASGN_RF  ,
                                       NULL AS ASGN_WGT ,
                                       Z4.BKG_TTL       ,
                                       Z4.BKG_20        ,
                                       Z4.BKG_40        ,
                                       Z4.BKG_HC        ,
                                       Z4.BKG_45        ,
                                       Z4.BKG_53        ,
                                       Z4.BKG_RF20      ,
                                       Z4.BKG_RF40      ,
                                       Z4.BKG_WGT
                                  FROM (
                                          SELECT Z2.POL_ETB_DT AS ETB_DT,
                                                 Z2.REP_TRD_CD,
                                                 Z2.REP_SUB_TRD_CD,
                                                 Z2.TRD_CD,
                                                 Z2.SUB_TRD_CD,
                                                 Z2.RLANE_CD,
                                                 Z2.COST_WK,
                                                 Z2.VSL_CD||Z2.SKD_VOY_NO||Z2.SKD_DIR_CD AS VVD,
                                                 Z2.IOC_CD,
                                                 O.N2ND_PRNT_OFC_CD                AS SLS_RHQ_CD    ,
                                                 NVL(MAX(O.N3RD_PRNT_OFC_CD), ' ') AS SLS_AQ_CD     ,
                                                 NVL(O.N4TH_PRNT_OFC_CD, ' ')      AS SLS_RGN_OFC_CD,
                                                 NVL(DECODE(O.OFC_KND_CD, '6', DECODE(Z2.SLS_OFC_CD, O.N4TH_PRNT_OFC_CD, O.N4TH_PRNT_OFC_CD, O.N5TH_PRNT_OFC_CD), Z2.SLS_OFC_CD), ' ') AS SLS_OFC_CD,
                                                 NVL(Z2.POD_CD, ' ')     AS POD_CD ,
                                                 NVL(MIN(Z2.POD_SEQ), 0) AS POD_SEQ,
                                                 SUM(TO_NUMBER(NVL(SUBSTR(Z2.VAL,  1, 14), 0))) AS BKG_TTL ,
                                                 SUM(TO_NUMBER(NVL(SUBSTR(Z2.VAL, 15, 14), 0))) AS BKG_20  ,
                                                 SUM(TO_NUMBER(NVL(SUBSTR(Z2.VAL, 29, 14), 0))) AS BKG_40  ,
                                                 SUM(TO_NUMBER(NVL(SUBSTR(Z2.VAL, 43, 14), 0))) AS BKG_HC  ,
                                                 SUM(TO_NUMBER(NVL(SUBSTR(Z2.VAL, 57, 14), 0))) AS BKG_45  ,
                                                 SUM(TO_NUMBER(NVL(SUBSTR(Z2.VAL, 71, 14), 0))) AS BKG_53  ,
                                                 SUM(TO_NUMBER(NVL(SUBSTR(Z2.VAL, 85, 14), 0))) AS BKG_RF20,
                                                 SUM(TO_NUMBER(NVL(SUBSTR(Z2.VAL, 99, 14), 0))) AS BKG_RF40,
                                                 SUM(TO_NUMBER(NVL(SUBSTR(Z2.VAL, 113, 14), 0))) AS BKG_WGT ,
                                                 Z2.CTRL_PORT,
                                                 Z2.CTRL_HC  ,
                                                 Z2.CTRL_45  ,
                                                 Z2.CTRL_53  ,
                                                 Z2.CTRL_RF  ,
                                                 Z2.CTRL_WGT
                                            FROM BOOKING     Z2,
                                                 SPC_OFC_LVL O
                                           WHERE Z2.SLS_OFC_CD = O.OFC_CD
                                             AND Z2.COST_YR || Z2.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK
                                        GROUP BY Z2.POL_ETB_DT     ,
                                                 Z2.REP_TRD_CD     ,
                                                 Z2.REP_SUB_TRD_CD ,
                                                 Z2.TRD_CD         ,
                                                 Z2.SUB_TRD_CD     ,
                                                 Z2.RLANE_CD       ,
                                                 Z2.COST_WK        ,
                                                 Z2.VSL_CD         ,
                                                 Z2.SKD_VOY_NO     ,
                                                 Z2.SKD_DIR_CD     ,
                                                 Z2.IOC_CD         ,
                                                 Z2.CTRL_PORT      ,
                                                 Z2.CTRL_HC        ,
                                                 Z2.CTRL_45        ,
                                                 Z2.CTRL_53        ,
                                                 Z2.CTRL_RF        ,
                                                 Z2.CTRL_WGT       ,
                                                 O.N2ND_PRNT_OFC_CD,
                                                 CUBE(/*O.N3RD_PRNT_OFC_CD, */ O.N4TH_PRNT_OFC_CD, DECODE(O.OFC_KND_CD, '6', DECODE(Z2.SLS_OFC_CD, O.N4TH_PRNT_OFC_CD, O.N4TH_PRNT_OFC_CD, O.N5TH_PRNT_OFC_CD), Z2.SLS_OFC_CD), Z2.POD_CD)
                                          HAVING Z2.CTRL_PORT = 'Y' OR Z2.POD_CD IS NULL
                                       ) Z4
                                 WHERE NOT (
                                                (Z4.SLS_RHQ_CD = 'SHAAS' AND Z4.SLS_RGN_OFC_CD = ' ')
                                             OR (Z4.SLS_RHQ_CD IN ('HAMUR', 'NYCNA') AND (DECODE(Z4.SLS_RGN_OFC_CD, ' ', 0, 2) + DECODE(Z4.SLS_OFC_CD, ' ', 0, 1)) = 1)
                                             OR (Z4.IOC_CD <> 'T/S' AND Z4.SLS_RGN_OFC_CD = ' ')
                                           )
                             ) Z5
                    GROUP BY Z5.ETB_DT        ,
                             Z5.REP_TRD_CD    ,
                             Z5.REP_SUB_TRD_CD,
                             Z5.TRD_CD        ,
                             Z5.SUB_TRD_CD    ,
                             Z5.RLANE_CD      ,
                             Z5.COST_WK       ,
                             Z5.VVD           ,
                             Z5.IOC_CD        ,
                             Z5.SLS_RHQ_CD    ,
                             Z5.SLS_AQ_CD     ,
                             Z5.SLS_RGN_OFC_CD,
                             Z5.SLS_OFC_CD    ,
                             Z5.POD_CD
                      HAVING NOT (
                                      (Z5.SLS_RHQ_CD = 'SHAAS' AND Z5.SLS_RGN_OFC_CD = ' ')
                                   OR (Z5.SLS_RHQ_CD IN ('HAMUR') AND ((DECODE(Z5.SLS_RGN_OFC_CD, ' ', 0, 2) + DECODE(Z5.SLS_OFC_CD, ' ', 0, 1)) = 1))
                                   OR (Z5.SLS_RHQ_CD IN ('NYCNA') AND (DECODE(Z5.SLS_RGN_OFC_CD, ' ', 0, 2) + DECODE(Z5.SLS_OFC_CD, ' ', 0, 1)) = 1)
                                 )
                    ORDER BY Z5.ETB_DT        ,
                             Z5.REP_TRD_CD    ,
                             Z5.REP_SUB_TRD_CD,
                             Z5.TRD_CD        ,
                             Z5.SUB_TRD_CD    ,
                             Z5.RLANE_CD      ,
                             Z5.COST_WK       ,
                             Z5.VVD           ,
                             Z5.IOC_CD        ,
                             Z5.SLS_RHQ_CD    ,
                             Z5.SLS_RGN_OFC_CD,
                             DECODE(Z5.SLS_OFC_CD, ' ', 1, Z5.SLS_RGN_OFC_CD, 2, 3),
                             Z5.SLS_OFC_CD    ,
                             MIN(Z5.POD_SEQ)  ,
                             Z5.POD_CD
                   ) Z6
            UNION ALL
            --DISCHARGE BOOKING
            SELECT Z3.POL_ETB_DT AS ETB_DT,
                   Z3.REP_TRD_CD    ,
                   Z3.REP_SUB_TRD_CD,
                   Z3.TRD_CD        ,
                   Z3.SUB_TRD_CD    ,
                   Z3.RLANE_CD      ,
                   Z3.COST_WK       ,
                   Z3.VSL_CD||Z3.SKD_VOY_NO||Z3.SKD_DIR_CD AS VVD,
                   Z3.IOC_CD        ,
                   Z3.SLS_RHQ_CD    ,
                   Z3.SLS_AQ_CD     ,
                   Z3.SLS_RGN_OFC_CD,
                   RANK() OVER ( PARTITION BY Z3.POL_ETB_DT, Z3.REP_TRD_CD, Z3.REP_SUB_TRD_CD, Z3.TRD_CD, Z3.SUB_TRD_CD, Z3.RLANE_CD, Z3.COST_WK, Z3.VSL_CD, Z3.SKD_VOY_NO, Z3.SKD_DIR_CD, Z3.IOC_CD, Z3.SLS_RHQ_CD, Z3.SLS_AQ_CD, Z3.SLS_RGN_OFC_CD ORDER BY ROWNUM) AS RK,
                   ''   AS SLS_OFC_CD   ,
                   ''   AS POD_CD       ,
                   NULL AS FCAST_TTL    ,
                   NULL AS FCAST_HC     ,
                   NULL AS FCAST_45     ,
                   NULL AS FCAST_53     ,
                   NULL AS FCAST_RF     ,
                   NULL AS FCAST_WGT    ,
                   NULL AS ASGN_TTL     ,
                   NULL AS ASGN_HC      ,
                   NULL AS ASGN_45      ,
                   NULL AS ASGN_53      ,
                   NULL AS ASGN_RF      ,
                   NULL AS ASGN_WGT     ,
                   NULL AS DIF_TTL      ,
                   NULL AS DIF_HC       ,
                   NULL AS DIF_45       ,
                   NULL AS DIF_53       ,
                   NULL AS DIF_RF       ,
                   NULL AS DIF_WGT      ,
                   NULL AS BKG_TTL      ,
                   NULL AS BKG_S20      ,
                   NULL AS BKG_S40      ,
                   NULL AS BKG_20       ,
                   NULL AS BKG_40       ,
                   NULL AS BKG_HC       ,
                   NULL AS BKG_45       ,
                   NULL AS BKG_53       ,
                   NULL AS BKG_RF20     ,
                   NULL AS BKG_RF40     ,
                   NULL AS BKG_WGT      ,
                   Z3.PRE_REP_TRD_CD    ,
                   Z3.PRE_REP_SUB_TRD_CD,
                   Z3.PRE_RLANE_CD      ,
                   Z3.PRE_VSL_CD||Z3.PRE_SKD_VOY_NO||Z3.PRE_SKD_DIR_CD AS PRE_VVD,
                   TO_CHAR(SAQ_GET_PORT_ETB_FNC(Z3.PRE_VSL_CD, Z3.PRE_SKD_VOY_NO, Z3.PRE_SKD_DIR_CD, SUBSTR(Z3.POD_CD, 1, 5)), 'YYYY.MM.DD') AS PRE_ETB_DT,
                   Z3.BKG_TTL_QTY     AS DIS_TTL ,
                   Z3.BKG_20FT_QTY    AS DIS_S20 , -- R2는 20에 포함됨
                   Z3.BKG_40FT_QTY + Z3.BKG_40FT_HC_QTY + Z3.BKG_45FT_HC_QTY + Z3.BKG_53FT_QTY AS DIS_S40, --40/HC/45에 R4,R7,R5가 포함되어 있음
                   Z3.BKG_20FT_QTY    AS DIS_20  ,
                   Z3.BKG_40FT_QTY    AS DIS_40  ,
                   Z3.BKG_40FT_HC_QTY AS DIS_HC  ,
                   Z3.BKG_45FT_HC_QTY AS DIS_45  ,
                   Z3.BKG_53FT_QTY    AS DIS_53  ,
                   Z3.BKG_RF20_QTY    AS DIS_RF20,
                   Z3.BKG_RF40_QTY    AS DIS_RF40,
                   Z3.BKG_TTL_WGT     AS DIS_WGT
              FROM (
                      SELECT Z2.POL_ETB_DT    ,
                             Z2.REP_TRD_CD    ,
                             Z2.REP_SUB_TRD_CD,
                             Z2.TRD_CD        ,
                             Z2.SUB_TRD_CD    ,
                             Z2.RLANE_CD      ,
                             Z2.COST_WK       ,
                             Z2.VSL_CD        ,
                             Z2.SKD_VOY_NO    ,
                             Z2.SKD_DIR_CD    ,
                             Z2.IOC_CD        ,
                             NVL(O.N2ND_PRNT_OFC_CD, ' ') AS SLS_RHQ_CD    ,
                             NVL(O.N3RD_PRNT_OFC_CD, ' ') AS SLS_AQ_CD     ,
                             NVL(O.N4TH_PRNT_OFC_CD, ' ') AS SLS_RGN_OFC_CD,
                             NVL(RL.RLANE_CD  , 'RBCCO')  AS PRE_RLANE_CD  ,
                             NVL(RL.REP_TRD_CD, 'IAS')    AS PRE_REP_TRD_CD,
                             SAQ_GET_REP_SUB_TRD_FNC(NVL(RL.RLANE_CD, 'RBCCO')) AS PRE_REP_SUB_TRD_CD,
                             Z2.PRE_VSL_CD    ,
                             Z2.PRE_SKD_VOY_NO,
                             Z2.PRE_SKD_DIR_CD,
                             Z2.POD_CD        ,
                             SUM(TO_NUMBER(NVL(SUBSTR(Z2.VAL,  1, 14), 0))) AS BKG_TTL_QTY    ,
                             SUM(TO_NUMBER(NVL(SUBSTR(Z2.VAL, 15, 14), 0))) AS BKG_20FT_QTY   ,
                             SUM(TO_NUMBER(NVL(SUBSTR(Z2.VAL, 29, 14), 0))) AS BKG_40FT_QTY   ,
                             SUM(TO_NUMBER(NVL(SUBSTR(Z2.VAL, 43, 14), 0))) AS BKG_40FT_HC_QTY,
                             SUM(TO_NUMBER(NVL(SUBSTR(Z2.VAL, 57, 14), 0))) AS BKG_45FT_HC_QTY,
                             SUM(TO_NUMBER(NVL(SUBSTR(Z2.VAL, 71, 14), 0))) AS BKG_53FT_QTY,
                             SUM(TO_NUMBER(NVL(SUBSTR(Z2.VAL, 85, 14), 0))) AS BKG_RF20_QTY   ,
                             SUM(TO_NUMBER(NVL(SUBSTR(Z2.VAL, 99, 14), 0))) AS BKG_RF40_QTY   ,
                             SUM(TO_NUMBER(NVL(SUBSTR(Z2.VAL, 113, 14), 0))) AS BKG_TTL_WGT
                        FROM (
                                SELECT V.POL_ETB_DT    ,
                                       V.REP_TRD_CD    ,
                                       V.REP_SUB_TRD_CD,
                                       V.TRD_CD        ,
                                       V.SUB_TRD_CD    ,
                                       V.RLANE_CD      ,
                                       V.COST_YR       ,
                                       V.COST_WK       ,
                                       V.VSL_CD        ,
                                       V.SKD_VOY_NO    ,
                                       V.SKD_DIR_CD    ,
                                       V.IOC_CD        ,
                                       NVL(BV.VSL_CD    , ' ') AS PRE_VSL_CD    ,
                                       NVL(BV.SKD_VOY_NO, ' ') AS PRE_SKD_VOY_NO,
                                       NVL(BV.SKD_DIR_CD, ' ') AS PRE_SKD_DIR_CD,
                                       NVL(BV.SLAN_CD   , ' ') AS SLAN_CD       ,
                                       SPC_SCR_OFC_CONV_FNC(B.OB_SLS_OFC_CD) AS SLS_OFC_CD,
                                       V.POL_CD AS POD_CD,
                                       (
                                          SELECT    TO_CHAR(SUM(DECODE(SAQ_GET_CNTR_SZ_FNC(Q.CNTR_TPSZ_CD), '2', 1, 2)*Q.OP_CNTR_QTY), 'FM0000000000.000')
                                                 || TO_CHAR(SUM(DECODE(SAQ_GET_CNTR_SZ_FNC(Q.CNTR_TPSZ_CD), '2', Q.OP_CNTR_QTY, 0)), 'FM0000000000.000')
                                                 || TO_CHAR(SUM(DECODE(SAQ_GET_CNTR_SZ_FNC(Q.CNTR_TPSZ_CD), '4', Q.OP_CNTR_QTY, 0)), 'FM0000000000.000')
                                                 || TO_CHAR(SUM(DECODE(SAQ_GET_CNTR_SZ_FNC(Q.CNTR_TPSZ_CD), '5', Q.OP_CNTR_QTY, '9', Q.OP_CNTR_QTY, '8', Q.OP_CNTR_QTY, 0)), 'FM0000000000.000')	--R9,R8에 대해서 R5과 동일하게 HC으로 처리되도록 추가
                                                 || TO_CHAR(SUM(DECODE(SAQ_GET_CNTR_SZ_FNC(Q.CNTR_TPSZ_CD), '7', Q.OP_CNTR_QTY, 0)), 'FM0000000000.000')
                                                 || TO_CHAR(SUM(DECODE(Q.CNTR_TPSZ_CD, 'DW', Q.OP_CNTR_QTY, 'DX', Q.OP_CNTR_QTY, 0)), 'FM0000000000.000')
                                                 || TO_CHAR(SUM(DECODE(Q.CNTR_TPSZ_CD, 'R2', Q.OP_CNTR_QTY - Q.EQ_SUBST_CGO_QTY, 0)), 'FM0000000000.000')
                                                 || TO_CHAR(SUM(CASE WHEN SUBSTR(Q.CNTR_TPSZ_CD, 1, 1) = 'R' AND Q.CNTR_TPSZ_CD <> 'R2' THEN Q.OP_CNTR_QTY - Q.EQ_SUBST_CGO_QTY ELSE 0 END), 'FM0000000000.000')
                                                 || TO_CHAR((MAX(D.ACT_WGT) * DECODE(MAX(D.WGT_UT_CD), 'LBS', 0.00045, 0.001)) + SUM(Q.OP_CNTR_QTY * ( SELECT TS.CNTR_TPSZ_TARE_WGT
                                                                                                                                                         FROM MDM_CNTR_TP_SZ TS
                                                                                                                                                        WHERE TS.CNTR_TPSZ_CD = Q.CNTR_TPSZ_CD)) * 0.001, 'FM0000000000.000')
                                            FROM BKG_QUANTITY Q
                                           WHERE B.BKG_NO = Q.BKG_NO
                                       ) AS VAL
                                  FROM BKG_BOOKING B ,
                                       BKG_VVD     BV,
                                       BOOKING     V ,
                                       BKG_BL_DOC  D
                                 WHERE V.BKG_NO = BV.BKG_NO
                                   AND DECODE(V.VSL_PRE_PST_CD, 'T', 'S', 'U', 'T') = BV.VSL_PRE_PST_CD -- 대상 항차 직전 항차만 조회되도록 수정
                                   AND (V.ORG IS NULL OR SPC_SCR_OFC_CONV_FNC(B.OB_SLS_OFC_CD) = V.ORG)
                                   AND B.BKG_NO         = BV.BKG_NO
                                   AND B.BKG_STS_CD    IN('W','F')
                                   AND B.BKG_CGO_TP_CD <> 'P'
                                   AND B.BKG_NO         = D.BKG_NO
                              ) Z2,
                              SPC_OFC_LVL  O ,
                              MDM_REV_LANE RL
                        WHERE Z2.SLS_OFC_CD     = O.OFC_CD
                          AND Z2.COST_YR || Z2.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK
                          AND RL.DELT_FLG   (+) = 'N'
                          AND RL.VSL_TP_CD  (+) = 'C'
                          AND RL.VSL_SLAN_CD(+) = Z2.SLAN_CD
                     GROUP BY Z2.POL_ETB_DT     ,
                              Z2.REP_TRD_CD     ,
                              Z2.REP_SUB_TRD_CD ,
                              Z2.TRD_CD         ,
                              Z2.SUB_TRD_CD     ,
                              Z2.RLANE_CD       ,
                              Z2.COST_WK        ,
                              Z2.VSL_CD         ,
                              Z2.SKD_VOY_NO     ,
                              Z2.SKD_DIR_CD     ,
                              Z2.IOC_CD         ,
                              O.N2ND_PRNT_OFC_CD,
                              O.N3RD_PRNT_OFC_CD,
                              O.N4TH_PRNT_OFC_CD,
                              Z2.PRE_VSL_CD     ,
                              Z2.PRE_SKD_VOY_NO ,
                              Z2.PRE_SKD_DIR_CD ,
                              NVL(RL.RLANE_CD, 'RBCCO'),
                              NVL(RL.REP_TRD_CD, 'IAS'),
                              Z2.POD_CD
                     ORDER BY Z2.POL_ETB_DT     ,
                              Z2.REP_TRD_CD     ,
                              Z2.REP_SUB_TRD_CD ,
                              Z2.TRD_CD         ,
                              Z2.SUB_TRD_CD     ,
                              Z2.RLANE_CD       ,
                              Z2.COST_WK        ,
                              Z2.VSL_CD         ,
                              Z2.SKD_VOY_NO     ,
                              Z2.SKD_DIR_CD     ,
                              Z2.IOC_CD         ,
                              O.N4TH_PRNT_OFC_CD,
                              PRE_RLANE_CD      ,
                              PRE_REP_TRD_CD    ,
                              PRE_REP_SUB_TRD_CD,
                              NVL(Z2.PRE_VSL_CD , '0'),
                              Z2.PRE_SKD_VOY_NO ,
                              Z2.PRE_SKD_DIR_CD
                   ) Z3
         ) Z7
GROUP BY Z7.ETB_DT        ,
         Z7.REP_TRD_CD    ,
         Z7.REP_SUB_TRD_CD,
         Z7.TRD_CD        ,
         Z7.SUB_TRD_CD    ,
         Z7.RLANE_CD      ,
         Z7.COST_WK       ,
         Z7.VVD           ,
         Z7.IOC_CD        ,
         Z7.SLS_RHQ_CD    ,
         Z7.SLS_RGN_OFC_CD,
         Z7.RK
ORDER BY Z7.ETB_DT        ,
         Z7.REP_TRD_CD    ,
         Z7.REP_SUB_TRD_CD,
         Z7.TRD_CD        ,
         Z7.SUB_TRD_CD    ,
         Z7.RLANE_CD      ,
         Z7.COST_WK       ,
         Z7.VVD           ,
         Z7.IOC_CD        ,
         Z7.SLS_RHQ_CD    ,
         Z7.SLS_RGN_OFC_CD,
         Z7.RK			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="sDate" type="12" value="" out="N"/>
				<param name="eDate" type="12" value="" out="N"/>
				<param name="port" type="12" value="" out="N"/>
				<param name="trade" type="12" value="" out="N"/>
				<param name="subtrade" type="12" value="" out="N"/>
				<param name="lane" type="12" value="" out="N"/>
				<param name="bound" type="12" value="" out="N"/>
				<param name="ioc" type="12" value="" out="N"/>
				<param name="org" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
