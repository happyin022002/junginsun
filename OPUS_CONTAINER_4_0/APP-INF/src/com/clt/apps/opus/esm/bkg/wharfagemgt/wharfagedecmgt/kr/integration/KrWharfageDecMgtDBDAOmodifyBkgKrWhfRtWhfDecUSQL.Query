<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="KrWharfageDecMgtDBDAOmodifyBkgKrWhfRtWhfDecUSQL">
			<desc><![CDATA[m]]></desc>
			<sql><![CDATA[
UPDATE BKG_KR_WHF_RT
SET 
WHF_NTC_NO = @[whf_ntc_no]
WHERE (BL_NO, VSL_CD, SKD_VOY_NO, SKD_DIR_CD, WHF_BND_CD, CHG_RT_SEQ) IN
  (
   SELECT B.BL_NO,      B.VSL_CD,          
          B.SKD_VOY_NO, B.SKD_DIR_CD, 
          B.WHF_BND_CD, MAX(CHG_RT_SEQ) SEQ
     FROM BKG_KR_WHF_BL A, BKG_KR_WHF_RT B
    WHERE 1=1
	  AND B.VSL_CD      = SUBSTR( @[vvd],1,4 )
	  AND B.SKD_VOY_NO  = SUBSTR( @[vvd],5,4 )
	  AND B.SKD_DIR_CD  = SUBSTR( @[vvd],9,1 )
      AND A.WHF_BND_CD  in (DECODE(@[whf_bnd_cd],'IN','II', @[whf_bnd_cd]), DECODE(@[whf_bnd_cd], 'IN', 'IT',@[whf_bnd_cd]))
      AND DECODE(SUBSTR(@[whf_bnd_cd],1,1),'I',A.WHF_POD_CD,'O',A.WHF_POL_CD) = @[port_cd]
      AND B.VSL_CD      = A.VSL_CD
      AND B.SKD_VOY_NO  = A.SKD_VOY_NO
      AND B.SKD_DIR_CD  = A.SKD_DIR_CD
      AND B.WHF_BND_CD  = A.WHF_BND_CD
      AND B.BL_NO       = A.BL_NO
      AND NVL(A.WHF_BL_STS_CD, ' ') != 'D'
      AND NVL(A.WHF_BL_THRU_TS_FLG, 'N') != 'T'
    GROUP BY B.BL_NO, B.VSL_CD, B.SKD_VOY_NO, B.SKD_DIR_CD, B.WHF_BND_CD
  )			]]></sql>
			<params>
				<param name="whf_ntc_no" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="whf_bnd_cd" type="12" value="" out="N"/>
				<param name="port_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
