<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCReportDBDAORsltSearchSCRateSearchDARListRSQL">
			<desc><![CDATA[US Rpute Cost Inquiry List]]></desc>
			<sql><![CDATA[
WITH
AR AS   (
SELECT  @[prop_no] PROP_NO                     ,
        TO_NUMBER(@[amdt_seq])                       AMDT_SEQ                    ,
        @[svc_scp_cd]               SVC_SCP_CD              ,
        @[gen_spcl_rt_tp_cd]                GEN_SPCL_RT_TP_CD   ,
        TO_NUMBER(@[cmdt_hdr_seq])                      CMDT_HDR_SEQ            ,
        TO_NUMBER(@[rout_seq])                      ROUT_SEQ                    ,
        TO_NUMBER(@[rt_seq])                      RT_SEQ
FROM        DUAL
)   ,
GC AS (
SELECT  G.PRC_GRP_CMDT_CD           ,
                D.PRC_CMDT_TP_CD            ,
                D.PRC_CMDT_DEF_CD
FROM        AR  ,
                PRI_SP_SCP_GRP_CMDT         G   ,
                PRI_SP_SCP_GRP_CMDT_DTL D
WHERE       D.PROP_NO                   = G.PROP_NO
AND         D.AMDT_SEQ              = G.AMDT_SEQ
AND         D.SVC_SCP_CD            = G.SVC_SCP_CD
AND         D.GRP_CMDT_SEQ      = G.GRP_CMDT_SEQ
AND         G.PROP_NO                   = AR.PROP_NO
AND         G.AMDT_SEQ              = AR.AMDT_SEQ
AND         G.SVC_SCP_CD            = AR.SVC_SCP_CD
)   ,
GL AS (
SELECT  G.PRC_GRP_LOC_CD    ,
        D.LOC_CD
FROM        AR  ,
                PRI_SP_SCP_GRP_LOC          G   ,
                PRI_SP_SCP_GRP_LOC_DTL  D
WHERE       D.PROP_NO                   = G.PROP_NO
AND         D.AMDT_SEQ              = G.AMDT_SEQ
AND         D.SVC_SCP_CD            = G.SVC_SCP_CD
AND         D.GRP_LOC_SEQ           = G.GRP_LOC_SEQ
AND         G.PROP_NO                   = AR.PROP_NO
AND         G.AMDT_SEQ              = AR.AMDT_SEQ
AND         G.SVC_SCP_CD            = AR.SVC_SCP_CD
)
SELECT  DE.FM_LOC_CD                ,
                DE.HUB_LOC_CD               ,
                DA.PRC_TRSP_MOD_CD  ,
                DA.RCV_DE_TERM_CD       ,
                DA.RAT_UT_CD                ,
                DA.CURR_CD                  ,
                DA.FNL_FRT_RT_AMT ,
				'' AS PROP_NO           , -- param
				'' AS AMDT_SEQ          , -- param
				'' AS SVC_SCP_CD        , -- param
				'' AS GEN_SPCL_RT_TP_CD , -- param
				'' AS CMDT_HDR_SEQ      , -- param
				'' AS ROUT_SEQ          , -- param
				'' AS RT_SEQ              -- param
FROM        AR                                  ,
                (
                SELECT  DISTINCT
                                RT.FM_LOC_CD        ,
                                SUBSTR(IR.HUB_NOD_CD, 1, 5)     HUB_LOC_CD  ,
                                RT.RAT_UT_CD        ,
                                ( SELECT A.CNTR_SZ_CD FROM PRI_RAT_UT A WHERE A.RAT_UT_CD = RT.RAT_UT_CD ) CNTR_SZ_CD   ,
                                RT.PRC_CGO_TP_CD
                FROM        (
                                SELECT  DECODE(DV.ROUT_VIA_PORT_TP_CD, 'L', DV.ROUT_VIA_PORT_DEF_CD, D1.LOC_CD) FM_LOC_CD   ,
                                                DECODE(DP.ROUT_PNT_LOC_TP_CD, 'L', DP.ROUT_PNT_LOC_DEF_CD, D2.LOC_CD)       TO_LOC_CD   ,
                                                RT.RAT_UT_CD    ,
                                                RT.PRC_CGO_TP_CD
                                FROM        AR                                                  ,
                                                PRI_SP_SCP_RT_CMDT_ROUT CR  ,
                                                PRI_SP_SCP_RT_ROUT_VIA  DV  ,
                                                PRI_SP_SCP_RT_ROUT_PNT  DP  ,
                                                PRI_SP_SCP_GRP_LOC          G1  ,
                                                PRI_SP_SCP_GRP_LOC_DTL  D1  ,
                                                PRI_SP_SCP_GRP_LOC          G2  ,
                                                PRI_SP_SCP_GRP_LOC_DTL  D2  ,
                                                PRI_SP_SCP_RT                       RT
                                WHERE       DV.PROP_NO                      =   CR.PROP_NO
                                AND         DV.AMDT_SEQ                     = CR.AMDT_SEQ
                                AND         DV.SVC_SCP_CD                   = CR.SVC_SCP_CD
                                AND         DV.GEN_SPCL_RT_TP_CD    = CR.GEN_SPCL_RT_TP_CD
                                AND         DV.CMDT_HDR_SEQ             = CR.CMDT_HDR_SEQ
                                AND         DV.ROUT_SEQ                     = CR.ROUT_SEQ
                                AND         DV.ORG_DEST_TP_CD           = 'D'
                                AND         DP.PROP_NO                      =   CR.PROP_NO
                                AND         DP.AMDT_SEQ                     = CR.AMDT_SEQ
                                AND         DP.SVC_SCP_CD                   = CR.SVC_SCP_CD
                                AND         DP.GEN_SPCL_RT_TP_CD    = CR.GEN_SPCL_RT_TP_CD
                                AND         DP.CMDT_HDR_SEQ             = CR.CMDT_HDR_SEQ
                                AND         DP.ROUT_SEQ                     = CR.ROUT_SEQ
                                AND         DP.ORG_DEST_TP_CD           = 'D'
                                AND         G1.PROP_NO(+)                   = DV.PROP_NO
                                AND         G1.AMDT_SEQ(+)              = DV.AMDT_SEQ
                                AND         G1.SVC_SCP_CD(+)            = DV.SVC_SCP_CD
                                AND         G1.PRC_GRP_LOC_CD(+)    = DV.ROUT_VIA_PORT_DEF_CD
                                AND         D1.PROP_NO(+)                   = G1.PROP_NO
                                AND         D1.AMDT_SEQ(+)              = G1.AMDT_SEQ
                                AND         D1.SVC_SCP_CD(+)            = G1.SVC_SCP_CD
                                AND         D1.GRP_LOC_SEQ(+)           = G1.GRP_LOC_SEQ
                                AND         G2.PROP_NO(+)                   = DP.PROP_NO
                                AND         G2.AMDT_SEQ(+)              = DP.AMDT_SEQ
                                AND         G2.SVC_SCP_CD(+)            = DP.SVC_SCP_CD
                                AND         G2.PRC_GRP_LOC_CD(+)    = DP.ROUT_PNT_LOC_DEF_CD
                                AND         D2.PROP_NO(+)                   = G2.PROP_NO
                                AND         D2.AMDT_SEQ(+)              = G2.AMDT_SEQ
                                AND         D2.SVC_SCP_CD(+)            = G2.SVC_SCP_CD
                                AND         D2.GRP_LOC_SEQ(+)           = G2.GRP_LOC_SEQ
                                AND         RT.PROP_NO                      =   CR.PROP_NO
                                AND         RT.AMDT_SEQ                     = CR.AMDT_SEQ
                                AND         RT.SVC_SCP_CD                   = CR.SVC_SCP_CD
                                AND         RT.GEN_SPCL_RT_TP_CD    = CR.GEN_SPCL_RT_TP_CD
                                AND         RT.CMDT_HDR_SEQ             = CR.CMDT_HDR_SEQ
                                AND         RT.ROUT_SEQ                     = CR.ROUT_SEQ
                                /* 조회 조건 */
                                AND         CR.PROP_NO                      = AR.PROP_NO
                                AND         CR.AMDT_SEQ                     = AR.AMDT_SEQ
                                AND         CR.SVC_SCP_CD                   = AR.SVC_SCP_CD
                                AND         CR.GEN_SPCL_RT_TP_CD    = AR.GEN_SPCL_RT_TP_CD
                                AND         CR.CMDT_HDR_SEQ             = AR.CMDT_HDR_SEQ
                                AND         CR.ROUT_SEQ                     = AR.ROUT_SEQ
                                AND         RT.RT_SEQ                           = AR.RT_SEQ
                                ) RT    ,
                                PRD_INLND_ROUT_MST          IR
                WHERE       IR.ROUT_ORG_NOD_CD  LIKE RT.FM_LOC_CD||'%'
                AND         IR.ROUT_DEST_NOD_CD LIKE RT.TO_LOC_CD||'%'
                AND         IR.PRIO_SEQ                     = '1'
                AND         IR.PCTL_IO_BND_CD           = 'I'
                AND         NVL(IR.DELT_FLG, 'N')   = 'N'
                )   DE  ,
                PRI_SP_SCP_TRSP_ADD_CHG DA
WHERE       DA.PROP_NO                      =   AR.PROP_NO
AND         DA.AMDT_SEQ                     = AR.AMDT_SEQ
AND         DA.SVC_SCP_CD                   = AR.SVC_SCP_CD
AND         DA.ADD_CHG_TP_CD            = 'A'
AND         DA.ORG_DEST_TP_CD           = 'D'
/* DEST ARB COMMODITY */
AND         (
                                DA.PRC_CMDT_DEF_CD  IS NULL
                        OR
                                EXISTS  (
                                                (
                                                SELECT  DA.PRC_CMDT_DEF_CD
                                                FROM        DUAL
                                                WHERE       DA.PRC_CMDT_TP_CD   = 'C'
                                                UNION ALL
                                                SELECT  GC.PRC_CMDT_DEF_CD
                                                FROM        GC
                                                WHERE       GC.PRC_GRP_CMDT_CD  = DA.PRC_CMDT_DEF_CD
                                                AND         GC.PRC_CMDT_TP_CD       = 'C'
                                                AND         DA.PRC_CMDT_TP_CD       = 'G'
                                                )
                                                INTERSECT
                                                SELECT  DECODE(RC.PRC_CMDT_TP_CD, 'C', RC.PRC_CMDT_DEF_CD, 'G', GC.PRC_CMDT_DEF_CD)
                                                FROM        PRI_SP_SCP_RT_CMDT  RC  ,
                                                                GC
                                                WHERE       RC.PROP_NO                      =   AR.PROP_NO
                                                AND         RC.AMDT_SEQ                     = AR.AMDT_SEQ
                                                AND         RC.SVC_SCP_CD                   = AR.SVC_SCP_CD
                                                AND         RC.GEN_SPCL_RT_TP_CD    = AR.GEN_SPCL_RT_TP_CD
                                                AND         RC.CMDT_HDR_SEQ             = AR.CMDT_HDR_SEQ
                                                AND         GC.PRC_GRP_CMDT_CD(+)   = RC.PRC_CMDT_DEF_CD
                                                AND         GC.PRC_CMDT_TP_CD           = 'C'
                                                )
                )
/* ROUTE ( FM LOC ) */
AND         (
                        (
                                DA.BSE_PORT_TP_CD = 'L'
                        AND DE.FM_LOC_CD            = DA.BSE_PORT_DEF_CD
                        )
                        OR
                        (
                                DA.BSE_PORT_TP_CD = 'G'
                        AND EXISTS  (
                                                SELECT  'X'
                                                FROM        GL
                                                WHERE       GL.PRC_GRP_LOC_CD   = DA.BSE_PORT_DEF_CD
                                                AND         GL.LOC_CD                   = DE.FM_LOC_CD
                                                )
                        )
                )
/* ROUTE ( HUB LOC ) */
AND         (
                        (
                                DA.ROUT_PNT_LOC_TP_CD = 'L'
                        AND DE.HUB_LOC_CD                   = DA.ROUT_PNT_LOC_DEF_CD
                        )
                        OR
                        (
                                DA.ROUT_PNT_LOC_TP_CD = 'G'
                        AND EXISTS  (
                                                SELECT  'X'
                                                FROM        GL
                                                WHERE       GL.PRC_GRP_LOC_CD   = DA.ROUT_PNT_LOC_DEF_CD
                                                AND         GL.LOC_CD                   = DE.HUB_LOC_CD
                                                )
                        )
                )
/* DEST ARB RATING UNIT */
AND         (
                                DA.RAT_UT_CD    = DE.RAT_UT_CD
                OR  DA.RAT_UT_CD    = 'BX'
                        OR
                        (
                        DA.RAT_UT_CD    IN ( '20', '40', 'HC', '45', '53' )
                AND ( SELECT A.CNTR_SZ_CD FROM PRI_RAT_UT A WHERE A.RAT_UT_CD = DA.RAT_UT_CD )  = DE.CNTR_SZ_CD
                        )
                )
/* DEST ARB CARGO TYPE */
AND         DA.PRC_CGO_TP_CD    = DE.PRC_CGO_TP_CD
ORDER BY
                DE.FM_LOC_CD                ,
                DE.HUB_LOC_CD               ,
                DA.PRC_TRSP_MOD_CD  ,
                DA.RCV_DE_TERM_CD       ,
                DA.RAT_UT_CD			]]></sql>
			<params>
				<param name="prop_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="12" value="" out="N"/>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="gen_spcl_rt_tp_cd" type="12" value="" out="N"/>
				<param name="cmdt_hdr_seq" type="12" value="" out="N"/>
				<param name="rout_seq" type="12" value="" out="N"/>
				<param name="rt_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
