<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TransshipmentMgtDBDAOsearchNextVvdForAssignRSQL">
			<desc><![CDATA[조회 조건에 맞는 출항 vvd들을 조회한다.]]></desc>
			<sql><![CDATA[
select next_skd_to.vsl_cd||next_skd_to.skd_voy_no||next_skd_to.skd_dir_cd next_vvd
		, next_skd_to.slan_cd
        , oop.op_cd 
        , to_char(next_skd_from.vps_etd_dt, 'yyyy-mm-dd hh24') etd 
        , to_char(next_skd_to.vps_eta_dt,   'yyyy-mm-dd hh24') eta 
        , rly_skd.vps_port_cd    ||substr(next_skd_from.yd_cd, 6, 2) relay_tmnl 
        , next_skd_to.vps_port_cd||substr(next_skd_to.yd_cd, 6, 2) next_tmnl
        , next_skd_to.CLPT_IND_SEQ next_seq
from      vsk_vsl_port_skd rly_skd 
        , vsk_vsl_port_skd next_skd_from 
        , vsk_vsl_port_skd next_skd_to 
        , bkg_vsl_oop oop
where next_skd_from.vsl_cd = oop.vsl_cd(+)
  and rly_skd.vps_eta_dt   < next_skd_from.vps_etd_dt
  and rly_skd.vsl_cd       = substr(@[former_vvd], 1, 4)  
  and rly_skd.skd_voy_no   = substr(@[former_vvd], 5, 4) 
  and rly_skd.skd_dir_cd   = substr(@[former_vvd], 9, 1)  
  and rly_skd.vps_port_cd  = @[relay_port] 
  and rly_skd.CLPT_IND_SEQ = @[former_clpt_ind_seq]
  and rly_skd.vps_port_cd  = next_skd_from.vps_port_cd
	--and rly_skd.CLPT_IND_SEQ = next_skd_from.CLPT_IND_SEQ 
  and next_skd_to.vps_port_cd = @[next_port] 
  and next_skd_from.vsl_cd      = next_skd_to.vsl_cd
  and next_skd_from.skd_voy_no  = next_skd_to.skd_voy_no
  and next_skd_from.skd_dir_cd  = next_skd_to.skd_dir_cd
  and next_skd_from.CLPT_SEQ < next_skd_to.CLPT_SEQ
  and nvl(next_skd_from.skd_cng_sts_cd, ' ') <> 'S'
  and nvl(next_skd_to.skd_cng_sts_cd,   ' ') <> 'S'
  and next_skd_from.vps_etd_dt > nvl(greatest(to_date(@[etb_to], 'yyyymmdd'), sysdate), sysdate)
  and next_skd_from.vps_etd_dt < nvl(greatest(to_date(@[etb_to], 'yyyymmdd'), sysdate), sysdate)+ 16
  order by etd,next_vvd,relay_tmnl			]]></sql>
			<params>
				<param name="former_vvd" type="12" value="ASAC0908E" out="N"/>
				<param name="relay_port" type="12" value="KRPUS" out="N"/>
				<param name="former_clpt_ind_seq" type="12" value="" out="N"/>
				<param name="next_port" type="12" value="JPTYO" out="N"/>
				<param name="etb_to" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
