<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MonthlyQuotaCreationDBDAOSearchCOfcVerifyRSQL">
			<desc><![CDATA[해당 버전의 Contract Office중 유효하지 않은 Office를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT MQTA_MDL_VER_NO     
     , CTRT_RHQ_CD 
     , CTRT_OFC_CD 
     , SLS_RHQ_CD 
     , SLS_OFC_CD 
     , MAX(CTRT_FLG) AS CTRT_FLG 
     , MAX(SLS_FLG) AS SLS_FLG 
	 , DECODE(MAX(CTRT_FLG), 'Y', '', CTRT_OFC_CD) AS CHNG_CTRT_OFC_CD 
	 , DECODE(MAX(SLS_FLG), 'Y', '', SLS_OFC_CD) AS CHNG_SLS_OFC_CD
  FROM 
       (SELECT T1.MQTA_MDL_VER_NO           
            , T1.CTRT_RHQ_CD 
            , T1.CTRT_OFC_CD 
            , T1.SLS_RHQ_CD 
            , T1.SLS_OFC_CD 
            , 'Y' AS CTRT_FLG 
            , '' AS SLS_FLG 
         FROM SAQ_MON_FCAST_TRNS T1 
            , SAQ_ORGANIZATION_V T2 
        WHERE 1=1 
              AND T1.MQTA_MDL_VER_NO = @[mqta_mdl_ver_no] 
              AND T1.CTRT_OFC_CD = T2.OFC_CD (+) 
              AND 'N' = T2.DELT_FLG (+) 
              AND T2.OFC_CD IS NULL 
              AND 
              ( 
                  T1.FCAST_TRNS_STS_CD = '0' 
                  OR T1.FCAST_TRNS_STS_CD IS NULL 
              ) 
              #if(${trd_cd} != '') 
              AND T1.TRD_CD = @[trd_cd] 
              #end 
              #if(${bound} != '') 
              AND T1.DIR_CD = @[bound] 
              #end 
           UNION ALL 
       SELECT T1.MQTA_MDL_VER_NO            
            , T1.CTRT_RHQ_CD 
            , T1.CTRT_OFC_CD 
            , T1.SLS_RHQ_CD 
            , T1.SLS_OFC_CD 
            , '' AS CTRT_FLG 
            , 'Y' AS SLS_FLG 
         FROM SAQ_MON_FCAST_TRNS T1 
            , SAQ_ORGANIZATION_V T2 
        WHERE 1=1 
              AND T1.MQTA_MDL_VER_NO = @[mqta_mdl_ver_no] 
              AND T1.SLS_OFC_CD = T2.OFC_CD (+) 
              AND 'N' = T2.DELT_FLG (+) 
              AND T2.OFC_CD IS NULL 
              AND 
              ( 
                  T1.FCAST_TRNS_STS_CD = '0' 
                  OR T1.FCAST_TRNS_STS_CD IS NULL 
              ) 
              #if(${trd_cd} != '') 
              AND T1.TRD_CD = @[trd_cd] 
              #end 
              #if(${bound} != '') 
              AND T1.DIR_CD = @[bound] 
              #end 
       ) 
 GROUP BY MQTA_MDL_VER_NO      
     , CTRT_RHQ_CD 
     , CTRT_OFC_CD 
     , SLS_RHQ_CD 
     , SLS_OFC_CD			]]></sql>
			<params>
				<param name="mqta_mdl_ver_no" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="bound" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
