<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="FFCommCalculationDBDAOAddFFCommMasterCancelIFCSQL">
			<desc><![CDATA[FFCommCalculationDBDAOAddFFCommMasterCancelIFCSQL]]></desc>
			<sql><![CDATA[
INSERT INTO ACM_FF_CMPN
(BKG_NO, BKG_FF_CNT_CD, BKG_FF_SEQ, FF_CMPN_SEQ, FF_CNT_CD, FF_SEQ, FF_AGMT_SEQ, FF_CHG_AMT, PPD_AMT, CRNT_AMT, IF_AMT, FF_CMPN_STS_CD, LOC_CD, AR_OFC_CD, AP_OFC_CD, COMM_STND_COST_CD, VSL_DEP_DT, FF_DIV_CD, FF_BKG_RT, BKG_BX_QTY, FF_BX_AMT, BKG_TEU_QTY, FF_TEU_AMT, BKG_FEU_QTY, FF_FEU_AMT, BKG_RF_QTY, FF_RF_AMT, FF_CHG_CTNT, FMC_NO, VNDR_CNT_CD, VNDR_SEQ
, FF_OCCR_INFO_CD, FF_SLAN_CD, FF_RLANE_CD, FF_VSL_CD, FF_SKD_VOY_NO, FF_SKD_DIR_CD, FF_REV_DIR_CD, OFC_CHR_CD, FF_REF_NO, CSR_NO, APRO_USR_ID, APRO_DT, APRO_GDT, GL_DT, INV_TAX_RT, IF_USR_ID, IF_DT, IF_GDT, SC_NO, RFA_NO, SHPR_CNT_CD, SHPR_SEQ, CMDT_TP_CD, CMDT_CD, FF_CMPN_RMK, ACCL_FLG, CRE_USR_ID, CRE_DT, UPD_USR_ID, UPD_DT)
SELECT
BRO.BKG_NO
, BRO.BKG_FF_CNT_CD
, BRO.BKG_FF_SEQ
, BRO.FF_CMPN_SEQ + 1 AS FF_CMPN_SEQ
, BRO.FF_CNT_CD
, BRO.FF_SEQ 
, BRO.FF_AGMT_SEQ
, CCD.CANCELED_AMT AS PPD_AMT
, 0 AS CRNT_AMT
, 0 - CCD.CANCELED_AMT AS IF_AMT
, 'CS' FF_CMPN_STS_CD
, BRO.LOC_CD
, BRO.AR_OFC_CD
, BRO.AP_OFC_CD
, BRO.COMM_STND_COST_CD
, BRO.VSL_DEP_DT
, BRO.FF_DIV_CD
, BRO.FF_BKG_RT
, BRO.BKG_BX_QTY
, BRO.FF_BX_AMT
, BRO.BKG_TEU_QTY
, BRO.FF_TEU_AMT
, BRO.BKG_FEU_QTY
, BRO.FF_FEU_AMT
, BRO.BKG_RF_QTY
, BRO.FF_RF_AMT
, BRO.FF_CHG_CTNT
, BRO.FMC_NO
, BRO.VNDR_CNT_CD
, BRO.VNDR_SEQ
, BRO.FF_OCCR_INFO_CD
, BRO.FF_SLAN_CD
, BRO.FF_RLANE_CD
, BRO.FF_VSL_CD
, BRO.FF_SKD_VOY_NO
, BRO.FF_SKD_DIR_CD
, BRO.FF_REV_DIR_CD
, BRO.OFC_CHR_CD
, BRO.FF_REF_NO
, NULL CSR_NO
, NULL APRO_USR_ID
, NULL APRO_DT
, NULL APRO_GDT
, NULL GL_DT
, BRO.INV_TAX_RT
, NULL IF_USR_ID
, NULL IF_DT
, NULL IF_GDT
, NULL SC_NO
, BRO.RFA_NO
, BRO.SHPR_CNT_CD
, BRO.SHPR_SEQ
, BRO.CMDT_TP_CD
, BRO.CMDT_CD
, CCD.CANCELED_RSN AS FF_CMPN_RMK
, ACCL_FLG
, CCD.CANCELED_USR_ID AS CRE_USR_ID
, SYSDATE CRE_DT
, CCD.CANCELED_USR_ID AS UPD_USR_ID
, SYSDATE UPD_DT
FROM ACM_FF_CMPN BRO
(
               SELECT
                      MAX (BR2.BKG_NO)                             AS BKG_NO,
                      ROUND (NVL (SUM (BR2.IF_AMT),0), 2)          AS CANCELED_AMT,
                      @[comm_proc_rslt_rsn]                        AS CANCELED_RSN,
                      'COMMISSION'                                 AS CANCELED_USR_ID
			     FROM ACM_FF_CMPN BR2
                WHERE BR2.BKG_NO           = @[bkg_no]
                  AND BR2.FF_CMPN_STS_CD = 'IF'
             GROUP BY BKG_NO
               HAVING 0 < ROUND (NVL (SUM (BR2.IF_AMT),0), 2)
         ) CCD
     WHERE BRO.BKG_NO           = CCD.BKG_NO
       AND BRO.FF_CMPN_SEQ      = @[ff_cmpn_seq]
       AND BRO.FF_CMPN_STS_CD = 'IF'			]]></sql>
			<params>
				<param name="comm_proc_rslt_rsn" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="ff_cmpn_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
