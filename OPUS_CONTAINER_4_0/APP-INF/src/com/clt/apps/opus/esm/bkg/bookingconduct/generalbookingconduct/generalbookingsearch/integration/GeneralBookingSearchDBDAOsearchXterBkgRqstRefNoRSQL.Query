<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingSearchDBDAOsearchXterBkgRqstRefNoRSQL">
			<desc><![CDATA[searchXterBkgRqstRefNo]]></desc>
			<sql><![CDATA[
SELECT 
  (SELECT CASE WHEN MST.XTER_SNDR_ID = 'INTTRANG2' OR MST.PGSS_EDI_ID = 'IT' THEN '301' ELSE '' END
   FROM BKG_XTER_RQST_MST MST
   WHERE MST.BKG_NO = BB.BKG_NO
   AND MST.BKG_UPLD_STS_CD = 'F'
   AND MST.DOC_TP_CD = 'B'
   AND MST.XTER_RQST_VIA_CD <> 'WEB'
   AND MST.XTER_RQST_SEQ = (SELECT MAX(MST1.XTER_RQST_SEQ) FROM BKG_XTER_RQST_MST MST1 
                                                           WHERE MST.XTER_SNDR_ID = MST1.XTER_SNDR_ID 
                                                           AND MST.BKG_NO = MST1.BKG_NO
                                                           AND MST1.DOC_TP_CD = 'B'
                                                           AND MST1.BKG_UPLD_STS_CD = 'F'
                                                           AND MST1.XTER_RQST_VIA_CD <> 'WEB')
   AND ROWNUM = 1
   ) AS XTER_BKG_RQST_REF_NO,
	(SELECT BDC.ATTR_CTNT1 
   FROM BKG_HRD_CDG_CTNT BDC 
   WHERE BDC.HRD_CDG_ID = 'CUSTOMER_301U' 
   AND BDC.ATTR_CTNT1 = @[rcv_id]
   AND EXISTS (SELECT 'X' FROM BKG_CUSTOMER BC WHERE BC.BKG_NO = BB.BKG_NO AND BDC.ATTR_CTNT2 = BC.CUST_CNT_CD||BC.CUST_SEQ)
   AND ROWNUM = 1) AS FLAG
FROM BKG_BOOKING BB
WHERE BB.BKG_NO = @[bkg_no]			]]></sql>
			<params>
				<param name="rcv_id" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
