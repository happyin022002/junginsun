<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingMasterMgtDBDAOVskVslPortSkdConditionRSQL">
			<desc><![CDATA[Vessel code 및 SKD 조회 화면(UI_BKG-0019) Vessel SKD & Code Inquiry]]></desc>
			<sql><![CDATA[
#if (${vsl_cd} != '')
------------------------------------------------------------------------
--1.VVD 입력시
------------------------------------------------------------------------
		SELECT SKD1.VSL_CD || SKD1.SKD_VOY_NO || SKD1.SKD_DIR_CD VVD
                ,VS.VSL_SLAN_CD LANE
                ,SKD1.VPS_PORT_CD POL
				,SKD1.CLPT_IND_SEQ 
				,SKD1.CLPT_SEQ
                ,SKD1.YD_CD TERMINAL
                ,NVL(PRD_COMMON_PKG.PRD_GET_CCT_BY_BKG_INFO_FNC(SKD1.VSL_CD, SKD1.SKD_VOY_NO, SKD1.SKD_DIR_CD, SUBSTR(SKD1.YD_Cd,1,5), SKD1.CLPT_IND_SEQ, SKD1.YD_Cd, 'NNNNY') , SKD1.VPS_ETB_DT -10/24)  CCT
				,TO_CHAR(NVL(PRD_COMMON_PKG.PRD_GET_CCT_BY_BKG_INFO_FNC(SKD1.VSL_CD, SKD1.SKD_VOY_NO, SKD1.SKD_DIR_CD, SUBSTR(SKD1.YD_Cd,1,5), SKD1.CLPT_IND_SEQ, SKD1.YD_Cd, 'NNNNY') , SKD1.VPS_ETB_DT -10/24), 'YYYY-MM-DD HH24:MI')  CCT_DT
				,TO_CHAR(NVL(PRD_COMMON_PKG.PRD_GET_CCT_BY_BKG_INFO_FNC(SKD1.VSL_CD, SKD1.SKD_VOY_NO, SKD1.SKD_DIR_CD, SUBSTR(SKD1.YD_Cd,1,5), SKD1.CLPT_IND_SEQ, SKD1.YD_Cd, 'NNNNY') , SKD1.VPS_ETB_DT -10/24), 'HH24:MI')  CCT_TM
				,TO_CHAR(SKD1.VPS_ETB_DT, 'YYYY-MM-DD HH24:MI') ETB  
                ,TO_CHAR(SKD1.VPS_ETB_DT, 'YYYY-MM-DD') ETB_DT  
                ,TO_CHAR(SKD1.VPS_ETB_DT, 'HH24:MI') ETB_TM  

                ,TO_CHAR(SKD1.VPS_ETD_DT, 'YYYY-MM-DD HH24:MI') ETD  
                ,TO_CHAR(SKD1.VPS_ETD_DT, 'YYYY-MM-DD') ETD_DT  
                ,TO_CHAR(SKD1.VPS_ETD_DT, 'HH24:MI') ETD_TM  
                

                ,SKD2.VPS_PORT_CD POD
				,SKD2.CLPT_IND_SEQ AS POD_CLPT_IND_SEQ
				,SKD2.CLPT_SEQ AS POD_CLPT_SEQ
				,SKD2.YD_CD TERMINAL2
                ,TO_CHAR(SKD2.VPS_ETB_DT, 'YYYY-MM-DD HH24:MI') ETB2
                ,TO_CHAR(SKD2.VPS_ETB_DT, 'YYYY-MM-DD HH24:MI') ETB2_DT
                ,TO_CHAR(SKD2.VPS_ETB_DT, 'HH24:MI') ETB2_TM
                
                ,replace(SKD1.VPS_RMK, chr(10), ' ')  VPS_RMK
                ,TO_CHAR(SKD1.UPD_DT, 'YYYY-MM-DD') UPD_DT
                ,TO_CHAR(SKD1.UPD_DT, 'HH24:MI') UPD_TM

                ,SKD1.SLAN_CD
                ,SKD1.VSL_CD
                ,SKD1.SKD_VOY_NO
                ,SKD1.SKD_DIR_CD
                ,'' VPS_PORT_POL
                ,'' PF_ETD_FROM_DT
                ,'' PF_ETD_TO_DT
                ,'' PF_ETB_FROM_DT
                ,'' PF_ETB_TO_DT
                ,'' VPS_PORT_POD
				,SKD1.OB_CSSM_VOY_NO
				,SKD1.IB_CSSM_VOY_NO
				,TO_CHAR(SKD2.VPS_ETB_DT+(MY.DRY_AVG_DWLL_HRS/24), 'YYYY-MM-DD HH24:MI') AS LAST_CY_AVAIL
          FROM   VSK_VSL_PORT_SKD SKD1, VSK_VSL_PORT_SKD SKD2, VSK_VSL_SKD VS
			  , MDM_VSL_CNTR MVC
			  , MDM_YARD MY
          WHERE  1=1
	   --   AND    VS.SKD_STS_CD !='CLO'  
#if (${vsl_cd} != '')
          AND    VS.VSL_CD      LIKE SUBSTR(@[vsl_cd],1,4) || '%'
          AND    VS.SKD_VOY_NO  LIKE SUBSTR(@[vsl_cd],5,4) || '%'
          AND    VS.SKD_DIR_CD  LIKE SUBSTR(@[vsl_cd],9,1) || '%'
          
#end

#if (${pf_etd_from_dt} != '') 
AND  SKD1.VPS_ETD_DT >= TO_DATE(@[pf_etd_from_dt], 'YYYY-MM-DD')
#end

#if (${pf_etd_to_dt} != '') 
AND  SKD1.VPS_ETD_DT <= TO_DATE(@[pf_etd_to_dt], 'YYYY-MM-DD') + 0.99999
#end

#if (${pf_etb_from_dt} != '') 
AND  SKD2.VPS_ETB_DT >= TO_DATE(@[pf_etb_from_dt], 'YYYY-MM-DD')
#end

#if (${pf_etb_to_dt} != '') 
AND  SKD2.VPS_ETB_DT <= TO_DATE(@[pf_etb_to_dt], 'YYYY-MM-DD') + 0.99999
#end

#if (${slan_cd} != '') 
  		  AND    VS.VSL_SLAN_CD IN( ${slan_cd} )
#end
	      AND    VS.VSL_CD = SKD1.VSL_CD 
          AND    VS.SKD_VOY_NO = SKD1.SKD_VOY_NO 
          AND    VS.SKD_DIR_CD = SKD1.SKD_DIR_CD 
          AND    NVL(SKD1.SKD_CNG_STS_CD, ' ') <> 'S' 
          AND    SKD1.TURN_PORT_IND_CD IN ('Y','N')
		  AND 	 NVL(SKD1.VT_ADD_CALL_FLG,'N') <> 'Y' 
#if (${vps_port_pol} != '') 
 		  AND   SKD1.VPS_PORT_CD = @[vps_port_pol]
#end
          AND    SKD1.VSL_CD = SKD2.VSL_CD 
          AND    SKD1.SKD_VOY_NO = SKD2.SKD_VOY_NO 
          AND    SKD1.SKD_DIR_CD = SKD2.SKD_DIR_CD 
          AND    SKD1.CLPT_SEQ < SKD2.CLPT_SEQ 
          AND    NVL(SKD2.SKD_CNG_STS_CD, ' ') <> 'S'
#if (${vps_port_pod} != '') 
   		  AND   SKD2.VPS_PORT_CD = @[vps_port_pod]
#end 
		  AND    MY.YD_CD = SKD2.YD_CD
		  AND    MVC.VSL_CD = VS.VSL_CD
#if (${vsl_eng_nm} != '') 
   		  AND   MVC.VSL_ENG_NM LIKE '%' || RTRIM(@[vsl_eng_nm]) || '%'
#end 
          ORDER  BY SKD1.VSL_CD, SKD1.SKD_VOY_NO, SKD1.SKD_DIR_CD, SKD1.CLPT_SEQ, SKD2.CLPT_SEQ

#elseif (${vps_port_pol} != '' && ${vps_port_pod} != ''  ) 
------------------------------------------------------------------------
--2.POL,POD입력시
------------------------------------------------------------------------
		  SELECT SKD1.VSL_CD || SKD1.SKD_VOY_NO || SKD1.SKD_DIR_CD VVD
                ,VS.VSL_SLAN_CD LANE
                ,SKD1.VPS_PORT_CD POL
				,SKD1.CLPT_IND_SEQ
				,SKD1.CLPT_SEQ
  				,SKD1.YD_CD TERMINAL
                ,NVL(PRD_COMMON_PKG.PRD_GET_CCT_BY_BKG_INFO_FNC(SKD1.VSL_CD, SKD1.SKD_VOY_NO, SKD1.SKD_DIR_CD, SUBSTR(SKD1.YD_Cd,1,5), SKD1.CLPT_IND_SEQ, SKD1.YD_Cd, 'NNNNY'), SKD1.VPS_ETB_DT -10/24)  CCT
				,TO_CHAR(NVL(PRD_COMMON_PKG.PRD_GET_CCT_BY_BKG_INFO_FNC(SKD1.VSL_CD, SKD1.SKD_VOY_NO, SKD1.SKD_DIR_CD, SUBSTR(SKD1.YD_Cd,1,5), SKD1.CLPT_IND_SEQ, SKD1.YD_Cd, 'NNNNY'), SKD1.VPS_ETB_DT -10/24), 'YYYY-MM-DD HH24:MI')  CCT_DT
				,TO_CHAR(NVL(PRD_COMMON_PKG.PRD_GET_CCT_BY_BKG_INFO_FNC(SKD1.VSL_CD, SKD1.SKD_VOY_NO, SKD1.SKD_DIR_CD, SUBSTR(SKD1.YD_Cd,1,5), SKD1.CLPT_IND_SEQ, SKD1.YD_Cd, 'NNNNY'), SKD1.VPS_ETB_DT -10/24), 'HH24:MI')  CCT_TM
                ,TO_CHAR(SKD1.VPS_ETB_DT, 'YYYY-MM-DD HH24:MI') ETB  
                ,TO_CHAR(SKD1.VPS_ETB_DT, 'YYYY-MM-DD') ETB_DT  
                ,TO_CHAR(SKD1.VPS_ETB_DT, 'HH24:MI') ETB_TM  

                ,TO_CHAR(SKD1.VPS_ETD_DT, 'YYYY-MM-DD HH24:MI') ETD  
                ,TO_CHAR(SKD1.VPS_ETD_DT, 'YYYY-MM-DD') ETD_DT  
                ,TO_CHAR(SKD1.VPS_ETD_DT, 'HH24:MI') ETD_TM  
                
                ,SKD2.VPS_PORT_CD POD
			    ,SKD2.CLPT_IND_SEQ AS POD_CLPT_IND_SEQ
				,SKD2.CLPT_SEQ AS POD_CLPT_SEQ
				,SKD2.YD_CD TERMINAL2
                ,TO_CHAR(SKD2.VPS_ETB_DT, 'YYYY-MM-DD HH24:MI') ETB2
                ,TO_CHAR(SKD2.VPS_ETB_DT, 'YYYY-MM-DD HH24:MI') ETB2_DT
                ,TO_CHAR(SKD2.VPS_ETB_DT, 'HH24:MI') ETB2_TM
                
                ,replace(SKD1.VPS_RMK, chr(13)||chr(10), ' ')  VPS_RMK
                ,TO_CHAR(SKD1.UPD_DT, 'YYYY-MM-DD') UPD_DT
                ,TO_CHAR(SKD1.UPD_DT, 'HH24:MI') UPD_TM

                ,SKD1.SLAN_CD
                ,SKD1.VSL_CD
                ,SKD1.SKD_VOY_NO
                ,SKD1.SKD_DIR_CD
                ,'' VPS_PORT_POL
                ,'' PF_ETD_FROM_DT
                ,'' PF_ETD_TO_DT
                ,'' PF_ETB_FROM_DT
                ,'' PF_ETB_TO_DT
                ,'' VPS_PORT_POD
				,SKD1.OB_CSSM_VOY_NO
				,SKD1.IB_CSSM_VOY_NO
				,TO_CHAR(SKD2.VPS_ETB_DT+(MY.DRY_AVG_DWLL_HRS/24), 'YYYY-MM-DD HH24:MI') AS LAST_CY_AVAIL
	
		  FROM   VSK_VSL_PORT_SKD SKD1, VSK_VSL_PORT_SKD SKD2, VSK_VSL_SKD VS
			  , MDM_VSL_CNTR MVC
			  , MDM_YARD MY
          WHERE  1=1
		--  AND    VS.SKD_STS_CD !='CLO'  	
		  AND	 SKD1.VSL_CD = SKD2.VSL_CD(+) 
          AND    SKD1.SKD_VOY_NO = SKD2.SKD_VOY_NO(+) 
          AND    SKD1.SKD_DIR_CD = SKD2.SKD_DIR_CD(+) 
          AND    SKD1.VSL_CD = VS.VSL_CD 
          AND    SKD1.SKD_VOY_NO = VS.SKD_VOY_NO 
          AND    SKD1.SKD_DIR_CD = VS.SKD_DIR_CD 
          AND    SKD1.TURN_PORT_IND_CD IN ('Y','N')
          AND    NVL(SKD1.VT_ADD_CALL_FLG,'N') <> 'Y' 

#if (${vsl_cd} != '')
          AND    VS.VSL_CD || VS.SKD_VOY_NO || VS.SKD_DIR_CD LIKE RTRIM(@[vsl_cd]) || '%'
#end
#if (${slan_cd} != '') 
  		  AND    VS.VSL_SLAN_CD IN( ${slan_cd} )
#end
#if (${vps_port_pol} != '') 
 		  AND   SKD1.VPS_PORT_CD = @[vps_port_pol]
#end
#if (${vps_port_pod} != '') 
   		  AND   SKD2.VPS_PORT_CD = @[vps_port_pod]
#end          
	      AND    SKD1.CLPT_SEQ < SKD2.CLPT_SEQ 
          AND    NVL(SKD1.SKD_CNG_STS_CD, ' ') <> 'S' 
          AND    NVL(SKD2.SKD_CNG_STS_CD, ' ') <> 'S' 

#if (${pf_etd_from_dt} != '') 
AND  SKD1.VPS_ETD_DT >= TO_DATE(@[pf_etd_from_dt], 'YYYY-MM-DD')
#end

#if (${pf_etd_to_dt} != '') 
AND  SKD1.VPS_ETD_DT <= TO_DATE(@[pf_etd_to_dt], 'YYYY-MM-DD') + 0.99999
#end

#if (${pf_etb_from_dt} != '') 
AND  SKD2.VPS_ETB_DT >= TO_DATE(@[pf_etb_from_dt], 'YYYY-MM-DD')
#end

#if (${pf_etb_to_dt} != '') 
AND  SKD2.VPS_ETB_DT <= TO_DATE(@[pf_etb_to_dt], 'YYYY-MM-DD') + 0.99999
#end

		  AND    MY.YD_CD = SKD2.YD_CD
		  AND    MVC.VSL_CD = VS.VSL_CD
#if (${vsl_eng_nm} != '') 
   		  AND   MVC.VSL_ENG_NM LIKE '%' || RTRIM(@[vsl_eng_nm]) || '%'
#end 

         ORDER  BY SKD1.VPS_ETD_DT, VS.VSL_SLAN_CD, SKD1.VSL_CD, SKD1.SKD_VOY_NO, SKD1.SKD_DIR_CD

#elseif (${vps_port_pol} != '' ) 
------------------------------------------------------------------------
--3.POL만 입력시
------------------------------------------------------------------------
		SELECT SKD1.VSL_CD || SKD1.SKD_VOY_NO || SKD1.SKD_DIR_CD VVD
                ,VS.VSL_SLAN_CD LANE
                ,SKD1.VPS_PORT_CD POL
				,SKD1.CLPT_IND_SEQ
				,SKD1.CLPT_SEQ
				,SKD1.YD_CD TERMINAL
                ,NVL(PRD_COMMON_PKG.PRD_GET_CCT_BY_BKG_INFO_FNC(SKD1.VSL_CD, SKD1.SKD_VOY_NO, SKD1.SKD_DIR_CD, SUBSTR(SKD1.YD_Cd,1,5), SKD1.CLPT_IND_SEQ, SKD1.YD_Cd, 'NNNNY') , SKD1.VPS_ETB_DT -10/24)  CCT
				,TO_CHAR(NVL(PRD_COMMON_PKG.PRD_GET_CCT_BY_BKG_INFO_FNC(SKD1.VSL_CD, SKD1.SKD_VOY_NO, SKD1.SKD_DIR_CD, SUBSTR(SKD1.YD_Cd,1,5), SKD1.CLPT_IND_SEQ, SKD1.YD_Cd, 'NNNNY') , SKD1.VPS_ETB_DT -10/24), 'YYYY-MM-DD HH24:MI')  CCT_DT
				,TO_CHAR(NVL(PRD_COMMON_PKG.PRD_GET_CCT_BY_BKG_INFO_FNC(SKD1.VSL_CD, SKD1.SKD_VOY_NO, SKD1.SKD_DIR_CD, SUBSTR(SKD1.YD_Cd,1,5), SKD1.CLPT_IND_SEQ, SKD1.YD_Cd, 'NNNNY') , SKD1.VPS_ETB_DT -10/24), 'HH24:MI')  CCT_TM
				,TO_CHAR(SKD1.VPS_ETB_DT, 'YYYY-MM-DD HH24:MI') ETB  
                ,TO_CHAR(SKD1.VPS_ETB_DT, 'YYYY-MM-DD') ETB_DT  
                ,TO_CHAR(SKD1.VPS_ETB_DT, 'HH24:MI') ETB_TM  

                ,TO_CHAR(SKD1.VPS_ETD_DT, 'YYYY-MM-DD HH24:MI') ETD  
                ,TO_CHAR(SKD1.VPS_ETD_DT, 'YYYY-MM-DD') ETD_DT  
                ,TO_CHAR(SKD1.VPS_ETD_DT, 'HH24:MI') ETD_TM  
                
                ,'' POD
				,'' AS POD_CLPT_IND_SEQ
				,'' AS POD_CLPT_SEQ
				,'' TERMINAL2
                ,'' ETB2
                ,'' ETB2_DT
                ,'' ETB2_TM
                
                ,replace(SKD1.VPS_RMK, chr(13)||chr(10), ' ')  VPS_RMK
                ,TO_CHAR(SKD1.UPD_DT, 'YYYY-MM-DD') UPD_DT
                ,TO_CHAR(SKD1.UPD_DT, 'HH24:MI') UPD_TM

                ,SKD1.SLAN_CD
                ,SKD1.VSL_CD
                ,SKD1.SKD_VOY_NO
                ,SKD1.SKD_DIR_CD
                ,'' VPS_PORT_POL
                ,'' PF_ETD_FROM_DT
                ,'' PF_ETD_TO_DT
                ,'' PF_ETB_FROM_DT
                ,'' PF_ETB_TO_DT
                ,'' VPS_PORT_POD
				,SKD1.OB_CSSM_VOY_NO
				,SKD1.IB_CSSM_VOY_NO
				,TO_CHAR(SKD1.VPS_ETB_DT+(MY.DRY_AVG_DWLL_HRS/24), 'YYYY-MM-DD HH24:MI') AS LAST_CY_AVAIL
		FROM   VSK_VSL_PORT_SKD SKD1, VSK_VSL_SKD VS
			  , MDM_VSL_CNTR MVC
			  , MDM_YARD MY
          WHERE  1=1
		--  AND    VS.SKD_STS_CD !='CLO'  
#if (${vps_port_pol} != '') 
 		  AND   SKD1.VPS_PORT_CD = @[vps_port_pol]
#end
          AND    NVL(SKD1.SKD_CNG_STS_CD, ' ') <> 'S' 
          AND    SKD1.TURN_PORT_IND_CD IN ('Y','N')
          AND    NVL(SKD1.VT_ADD_CALL_FLG,'N') <> 'Y' 

#if (${pf_etd_from_dt} != '') 
AND  SKD1.VPS_ETD_DT >= TO_DATE(@[pf_etd_from_dt], 'YYYY-MM-DD')
#end

#if (${pf_etd_to_dt} != '') 
AND  SKD1.VPS_ETD_DT <= TO_DATE(@[pf_etd_to_dt], 'YYYY-MM-DD') + 0.99999
#end

#if (${pf_etb_from_dt} != '') 
AND  SKD1.VPS_ETB_DT >= TO_DATE(@[pf_etb_from_dt], 'YYYY-MM-DD')
#end

#if (${pf_etb_to_dt} != '') 
AND  SKD1.VPS_ETB_DT <= TO_DATE(@[pf_etb_to_dt], 'YYYY-MM-DD') + 0.99999
#end


#if (${vsl_cd} != '')
		  AND    SKD1.VSL_CD || SKD1.SKD_VOY_NO || SKD1.SKD_DIR_CD LIKE RTRIM(@[vsl_cd]) || '%'
          
#end         
          AND    SKD1.VSL_CD = VS.VSL_CD 
          AND    SKD1.SKD_VOY_NO = VS.SKD_VOY_NO 
          AND    SKD1.SKD_DIR_CD = VS.SKD_DIR_CD 
#if (${slan_cd} != '') 
  		  AND    VS.VSL_SLAN_CD IN( ${slan_cd} )
#end
		  AND    MY.YD_CD = SKD1.YD_CD
		  AND    MVC.VSL_CD = VS.VSL_CD
#if (${vsl_eng_nm} != '') 
   		  AND   MVC.VSL_ENG_NM LIKE '%' || RTRIM(@[vsl_eng_nm]) || '%'
#end 
          AND    EXISTS         (SELECT 'X'
                                FROM    VSK_VSL_PORT_SKD SKD2
                                WHERE   SKD2.VSL_CD = SKD1.VSL_CD 
                                AND     SKD2.SKD_VOY_NO = SKD1.SKD_VOY_NO 
                                AND     SKD2.SKD_DIR_CD = SKD1.SKD_DIR_CD 
                                AND     SKD2.CLPT_SEQ > SKD1.CLPT_SEQ 
                                AND     NVL(SKD2.SKD_CNG_STS_CD, ' ') <> 'S' 
                                AND ROWNUM = 1)
          ORDER  BY SKD1.VPS_ETD_DT, VS.VSL_SLAN_CD, SKD1.VSL_CD, SKD1.SKD_VOY_NO, SKD1.SKD_DIR_CD

#elseif (${vps_port_pod} != ''  ) 
------------------------------------------------------------------------
--4.POD만 입력시
------------------------------------------------------------------------
		SELECT SKD2.VSL_CD || SKD2.SKD_VOY_NO || SKD2.SKD_DIR_CD VVD
                ,VS.VSL_SLAN_CD LANE
                ,'' POL
				,'' CLPT_IND_SEQ
				,'' CLPT_SEQ
				,'' TERMINAL
                ,'' CCT
				,'' CCT_DT
				,'' CCT_TM
                ,'' ETB  
                ,'' ETB_DT  
                ,'' ETB_TM  
                ,'' ETD  
                ,'' ETD_DT  
                ,'' ETD_TM  

                ,SKD2.VPS_PORT_CD POD
				,SKD2.CLPT_IND_SEQ AS POD_CLPT_IND_SEQ
				,SKD2.CLPT_SEQ AS POD_CLPT_SEQ
				,SKD2.YD_CD TERMINAL2
                ,TO_CHAR(SKD2.VPS_ETB_DT, 'YYYY-MM-DD HH24:MI') ETB2
                ,TO_CHAR(SKD2.VPS_ETB_DT, 'YYYY-MM-DD HH24:MI') ETB2_DT
                ,TO_CHAR(SKD2.VPS_ETB_DT, 'YYYY-MM-DD HH24:MI') ETB2_TM
                
                ,replace(SKD2.VPS_RMK, chr(13)||chr(10), ' ')  VPS_RMK
                ,TO_CHAR(SKD2.UPD_DT, 'YYYY-MM-DD') UPD_DT
                ,TO_CHAR(SKD2.UPD_DT, 'HH24:MI') UPD_TM

                ,SKD2.SLAN_CD
                ,SKD2.VSL_CD
                ,SKD2.SKD_VOY_NO
                ,SKD2.SKD_DIR_CD
                ,'' VPS_PORT_POL
                ,'' PF_ETD_FROM_DT
                ,'' PF_ETD_TO_DT
                ,'' PF_ETB_FROM_DT
                ,'' PF_ETB_TO_DT
                ,'' VPS_PORT_POD  
				,SKD2.OB_CSSM_VOY_NO
				,SKD2.IB_CSSM_VOY_NO
				,TO_CHAR(SKD2.VPS_ETB_DT+(MY.DRY_AVG_DWLL_HRS/24), 'YYYY-MM-DD HH24:MI') AS LAST_CY_AVAIL

		FROM   VSK_VSL_PORT_SKD SKD2, VSK_VSL_SKD VS
			  , MDM_VSL_CNTR MVC
			  , MDM_YARD MY
        WHERE  1=1
	  --  AND    VS.SKD_STS_CD !='CLO'  
#if (${vps_port_pod} != '') 
   		AND    SKD2.VPS_PORT_CD = @[vps_port_pod]
#end  
		AND    NVL(SKD2.SKD_CNG_STS_CD, ' ') <> 'S' 

#if (${pf_etb_from_dt} != '') 
AND  SKD2.VPS_ETB_DT >= TO_DATE(@[pf_etb_from_dt], 'YYYY-MM-DD')
#end

#if (${pf_etb_to_dt} != '') 
AND  SKD2.VPS_ETB_DT <= TO_DATE(@[pf_etb_to_dt], 'YYYY-MM-DD') + 0.99999
#end

#if (${pf_etd_from_dt} != '') 
AND  SKD2.VPS_ETD_DT >= TO_DATE(@[pf_etd_from_dt], 'YYYY-MM-DD')
#end

#if (${pf_etd_to_dt} != '') 
AND  SKD2.VPS_ETD_DT <= TO_DATE(@[pf_etd_to_dt], 'YYYY-MM-DD') + 0.99999
#end

#if (${vsl_cd} != '')
		AND    SKD2.VSL_CD || SKD2.SKD_VOY_NO || SKD2.SKD_DIR_CD LIKE RTRIM(@[vsl_cd]) || '%'
        
#end  
        AND    SKD2.VSL_CD = VS.VSL_CD 
        AND    SKD2.SKD_VOY_NO = VS.SKD_VOY_NO 
        AND    SKD2.SKD_DIR_CD = VS.SKD_DIR_CD 
#if (${slan_cd} != '') 
  		AND    VS.VSL_SLAN_CD IN( ${slan_cd} )
#end
		  AND    MY.YD_CD = SKD2.YD_CD
		  AND    MVC.VSL_CD = VS.VSL_CD
#if (${vsl_eng_nm} != '') 
   		  AND   MVC.VSL_ENG_NM LIKE '%' || RTRIM(@[vsl_eng_nm]) || '%'
#end 
        AND    EXISTS         (SELECT 'X'
                              FROM   VSK_VSL_PORT_SKD SKD1
                              WHERE  SKD1.VSL_CD = SKD2.VSL_CD 
                              AND    SKD1.SKD_VOY_NO = SKD2.SKD_VOY_NO 
                              AND    SKD1.SKD_DIR_CD = SKD2.SKD_DIR_CD 
                              AND    SKD1.CLPT_SEQ < SKD2.CLPT_SEQ 
                              AND    NVL(SKD1.SKD_CNG_STS_CD, ' ') <> 'S' 
                              AND    SKD1.TURN_PORT_IND_CD IN ('Y','N')
                              AND    NVL(SKD1.VT_ADD_CALL_FLG,'N') <> 'Y' 
                              AND ROWNUM = 1)
        ORDER  BY SKD2.VPS_ETB_DT, VS.VSL_SLAN_CD, SKD2.VSL_CD, SKD2.SKD_VOY_NO, SKD2.SKD_DIR_CD
#end			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="pf_etd_from_dt" type="12" value="" out="N"/>
				<param name="pf_etd_to_dt" type="12" value="" out="N"/>
				<param name="pf_etb_from_dt" type="12" value="" out="N"/>
				<param name="pf_etb_to_dt" type="12" value="" out="N"/>
				<param name="vps_port_pol" type="12" value="" out="N"/>
				<param name="vps_port_pod" type="12" value="" out="N"/>
				<param name="vsl_eng_nm" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
