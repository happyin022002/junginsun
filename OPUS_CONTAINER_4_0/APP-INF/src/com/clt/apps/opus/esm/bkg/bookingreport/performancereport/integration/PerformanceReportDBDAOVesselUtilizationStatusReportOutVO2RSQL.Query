<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PerformanceReportDBDAOVesselUtilizationStatusReportOutVO2RSQL">
			<desc><![CDATA[search]]></desc>
			<sql><![CDATA[
WITH TMP AS
(   SELECT VVD.VSL_CD
          ,VVD.SKD_VOY_NO
          ,VVD.SKD_DIR_CD
          ,VVD.POL_CD
          ,VVD.POD_CD
          ,BKG.BKG_CGO_TP_CD
          ,ORG.CONTI_CD    ORG_CONTI_CD
          ,DES.CONTI_CD    DES_CONTI_CD
          ,QUA.CNTR_TPSZ_CD
          ,QUA.OP_CNTR_QTY
          ,DECODE(VVD.POL_CD,'KRPUS',DECODE(VVD.POL_YD_CD,'KRPUSHN',VVD.POL_YD_CD,' '),' ') POL_YD_CD
          ,DECODE(VVD.POD_CD,'KRPUS',DECODE(VVD.POD_YD_CD,'KRPUSHN',VVD.POD_YD_CD,' '),' ') POD_YD_CD 
          ,DECODE(BKG_CGO_TP_CD,'F',-- FULL CARGO
               DECODE(ORG.CONTI_CD, DES.CONTI_CD, -- INTER
                   DECODE(SUBSTR(CNTR_TPSZ_CD,-1),'2',OP_CNTR_QTY,OP_CNTR_QTY * 2),0))  IPC
          ,DECODE(BKG_CGO_TP_CD,'F',-- FULL CARGO
               DECODE(ORG.CONTI_CD, DES.CONTI_CD, 0, -- OCEAN
                   DECODE(SUBSTR(CNTR_TPSZ_CD,-1),'2',OP_CNTR_QTY,OP_CNTR_QTY * 2)))    OCN       
          ,DECODE(BKG_CGO_TP_CD,'P',-- EMPTY CARGO
               DECODE(SUBSTR(CNTR_TPSZ_CD,-1),'2',OP_CNTR_QTY,OP_CNTR_QTY * 2))         MTY                               
      FROM BKG_BOOKING      BKG
          ,BKG_VVD          VVD
          ,BKG_QUANTITY     QUA
          ,MDM_LOCATION     ORG
          ,MDM_LOCATION     DES
     WHERE BKG.BKG_NO = VVD.BKG_NO
       AND BKG.BKG_NO = QUA.BKG_NO
       AND BKG.BKG_STS_CD <> 'X'
       AND BKG.POL_CD = ORG.LOC_CD
       AND BKG.POD_CD = DES.LOC_CD
       AND VVD.VSL_CD = SUBSTR(@[vvd], 0, 4)
       AND VVD.SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
       AND VVD.SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
)
SELECT DECODE(SKD.VPS_PORT_CD,'KRPUS',DECODE(SKD.YD_CD,'KRPUSHN',SKD.YD_CD,'KRPUS'),SKD.VPS_PORT_CD) AS VPS_PORT_CD
      ,SKD.SLAN_CD
      ,SKD.VSL_CD
      ,SKD.SKD_VOY_NO
      ,SKD.SKD_DIR_CD
      ,LOD.POL_YD_CD
      ,TO_CHAR(SKD.VPS_ETA_DT,'MM-DD')  AS ETA_DT
      ,TO_CHAR(SKD.VPS_ETD_DT,'MM-DD')  AS ETD_DT
      ,NVL(SUM(LOD.LOD_IPC),0)          AS LOAD_IPC
      ,NVL(SUM(LOD.LOD_OCN),0)          AS LOAD_OCN
      ,NVL(SUM(LOD.LOD_MTY),0)          AS LOAD_MTY
      ,NVL(SUM(DIS.DIS_IPC),0)          AS DIS_IPC
      ,NVL(SUM(DIS.DIS_OCN),0)          AS DIS_OCN
      ,NVL(SUM(DIS.DIS_MTY),0)          AS DIS_MTY
  FROM  VSK_VSL_PORT_SKD SKD,
      ( SELECT VSL_CD
              ,SKD_VOY_NO
              ,SKD_DIR_CD
              ,POL_CD
              ,POL_YD_CD
              ,SUM(IPC)   LOD_IPC
              ,SUM(OCN)   LOD_OCN
              ,SUM(MTY)   LOD_MTY
          FROM TMP
         GROUP BY VSL_CD, SKD_VOY_NO, SKD_DIR_CD, POL_CD, POL_YD_CD 
      ) LOD, 
      ( SELECT VSL_CD
              ,SKD_VOY_NO
              ,SKD_DIR_CD
              ,POD_CD
              ,POD_YD_CD 
              ,SUM(IPC)   DIS_IPC
              ,SUM(OCN)   DIS_OCN
              ,SUM(MTY)   DIS_MTY
          FROM TMP
         GROUP BY VSL_CD, SKD_VOY_NO, SKD_DIR_CD, POD_CD, POD_YD_CD      
      ) DIS
 WHERE SKD.VSL_CD = LOD.VSL_CD(+)
   AND SKD.SKD_VOY_NO = LOD.SKD_VOY_NO(+)
   AND SKD.SKD_DIR_CD = LOD.SKD_DIR_CD(+)
   AND SKD.VPS_PORT_CD = LOD.POL_CD(+)
   AND DECODE(SKD.VPS_PORT_CD,'KRPUS',DECODE(SKD.YD_CD,'KRPUSHN',SKD.YD_CD,' '),' ')  = LOD.POL_YD_CD(+)
   AND SKD.VSL_CD = DIS.VSL_CD(+)
   AND SKD.SKD_VOY_NO = DIS.SKD_VOY_NO(+)
   AND SKD.SKD_DIR_CD = DIS.SKD_DIR_CD(+) 
   AND SKD.VPS_PORT_CD = DIS.POD_CD(+)
   AND SKD.VSL_CD = SUBSTR(@[vvd], 0, 4)
   AND SKD.SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
   AND SKD.SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
 GROUP BY SKD.SLAN_CD
         ,SKD.VSL_CD
         ,SKD.SKD_VOY_NO
         ,SKD.SKD_DIR_CD
         ,DECODE(SKD.VPS_PORT_CD,'KRPUS',DECODE(SKD.YD_CD,'KRPUSHN',SKD.YD_CD,'KRPUS'),SKD.VPS_PORT_CD)
         ,SKD.VPS_ETA_DT
         ,SKD.VPS_ETD_DT
         ,LOD.POL_YD_CD
 ORDER BY SKD.VSL_CD, SKD.SKD_VOY_NO, SKD.SKD_DIR_CD, SKD.VPS_ETA_DT
			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
