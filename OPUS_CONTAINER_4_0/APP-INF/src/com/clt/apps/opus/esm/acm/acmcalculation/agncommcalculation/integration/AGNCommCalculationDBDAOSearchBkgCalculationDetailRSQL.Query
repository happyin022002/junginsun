<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AGNCommCalculationDBDAOSearchBkgCalculationDetailRSQL">
			<desc><![CDATA[SearchBkgCalculationDetail]]></desc>
			<sql><![CDATA[
SELECT B.BKG_NO,IO_BND_CD,GENERAL_AMT,BROG_AMT,CHF_AMT,TS_AMT,CROSS_AMT,CSF_AMT,RCSF_AMT,
    ( 
    SELECT SUM(IF_AMT) FROM ACM_FAC_COMM  WHERE BKG_NO = B.BKG_NO AND SLS_OFC_CD = @[agn_cd] 
    )FAC_AMT,(
    SELECT SUM(IF_AMT) FROM ACM_FF_CMPN   WHERE BKG_NO = B.BKG_NO AND AR_OFC_CD = @[agn_cd]
    )FF_AMT,(
    SELECT SUM(IF_AMT) FROM ACM_SPCL_CMPN WHERE BKG_NO = B.BKG_NO AND SPCL_OFC_CD = @[agn_cd]
    )SPCL_AMT
FROM BKG_BOOKING B, (
    SELECT BKG_NO,
    	IO_BND_CD,
        NVL(SUM(DECODE(A.AC_TP_CD, 'G', A.IF_AMT, 0)),0) AS GENERAL_AMT,
        NVL(SUM(DECODE(A.AC_TP_CD, 'K', A.IF_AMT, 0)),0) AS BROG_AMT,
        NVL(SUM(DECODE(A.AC_TP_CD, 'H', A.IF_AMT, 0)),0) AS CHF_AMT,
        NVL(SUM(DECODE(A.AC_TP_CD, 'S', A.IF_AMT, 0)),0) AS TS_AMT,
        NVL(SUM(DECODE(A.AC_TP_CD, 'C', A.IF_AMT, 0)),0) AS CROSS_AMT,
        NVL(SUM(DECODE(A.AC_TP_CD, 'N', A.IF_AMT, 0)),0) AS CSF_AMT,
        NVL(SUM(DECODE(A.AC_TP_CD, 'R', A.IF_AMT, 0)),0) AS RCSF_AMT
    FROM ACM_AGN_COMM A 
    WHERE A.AGN_CD = @[agn_cd]
    AND   A.BKG_NO IN (${bkg_no})
    GROUP BY BKG_NO, IO_BND_CD
)AGN
WHERE 1=1
AND B.BKG_NO IN (${bkg_no})
AND AGN.BKG_NO(+) = B.BKG_NO			]]></sql>
			<params>
				<param name="agn_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
