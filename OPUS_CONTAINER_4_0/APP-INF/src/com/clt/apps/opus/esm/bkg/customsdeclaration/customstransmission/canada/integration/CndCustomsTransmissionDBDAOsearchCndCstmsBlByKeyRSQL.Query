<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CndCustomsTransmissionDBDAOsearchCndCstmsBlByKeyRSQL">
			<desc><![CDATA[searchCndCstmsBlByKey]]></desc>
			<sql><![CDATA[
SELECT BL_NO
      ,VSL_CD
      ,SKD_VOY_NO
      ,SKD_DIR_CD
      ,VSL_CD || SKD_VOY_NO || SKD_DIR_CD AS VVD
      ,CSTMS_POL_CD
      ,CSTMS_POD_CD
      ,(SELECT OFC_ENG_NM
          FROM MDM_ORGANIZATION M
         WHERE A.OBL_ISS_OFC_CD = M.OFC_CD
       ) AS OFC_ENG_NM
      ,(SELECT S.CUST_NM
          FROM BKG_CSTMS_ADV_CUST S
         WHERE S.CNT_CD = B.CNT_CD
           AND S.BL_NO  = B.BL_NO
           AND S.BKG_CUST_TP_CD = 'S'
       ) AS SHIPPER
      ,(SELECT S.CUST_NM
          FROM BKG_CSTMS_ADV_CUST S
         WHERE S.CNT_CD = B.CNT_CD
           AND S.BL_NO  = B.BL_NO
           AND S.BKG_CUST_TP_CD = 'C'
       ) AS CONSIGNEE
      ,B.CSTMS_ACK_PROC_RSLT_CD
      ,(SELECT DISTINCT FIRST_VALUE(RCV.CND_ACK_SUB_CD) OVER(ORDER BY RCV.RCV_DT DESC)
          FROM BKG_CSTMS_ADV_RCV_LOG RCV  
         WHERE RCV.CNT_CD(+) = 'CA'
           AND RCV.CND_ACK_SUB_CD IN ('21','37')
           AND RCV.BL_NO(+) = B.BL_NO) AS LAST_ACK
      ,'' AS REASON
      ,'' AS CNTR_NO
  FROM BKG_BL_ISS       A
      ,BKG_CSTMS_ADV_BL B
 WHERE A.BKG_NO(+) = B.BKG_NO
   AND B.CSTMS_ACK_KEY_NO = @[cstms_bat_no]
   AND B.CNT_CD = 'CA'			]]></sql>
			<params>
				<param name="cstms_bat_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
