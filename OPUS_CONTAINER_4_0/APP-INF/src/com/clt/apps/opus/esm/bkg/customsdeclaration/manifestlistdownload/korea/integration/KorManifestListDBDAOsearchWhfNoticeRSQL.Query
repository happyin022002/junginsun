<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="KorManifestListDBDAOsearchWhfNoticeRSQL">
			<desc><![CDATA[Wharfage Notice정보를 조회함]]></desc>
			<sql><![CDATA[
SELECT  NVL(SUBSTR(WHF_NTC_NO,1,4),TO_CHAR(SYSDATE,'YYYY'))||'-'||
            SUBSTR(WHF_NTC_NO,5,2)||'-'||
            SUBSTR(WHF_NTC_NO,7,6) NOTICE
FROM    BKG_KR_WHF_RT
WHERE   (BL_NO, VSL_CD,SKD_VOY_NO,SKD_DIR_CD,WHF_BND_CD,CHG_RT_SEQ) IN  
    (
        SELECT  B.BL_NO, B.VSL_CD, B.SKD_VOY_NO,B.SKD_DIR_CD, B.WHF_BND_CD, MAX(B.CHG_RT_SEQ) SEQ  
        FROM    BKG_KR_WHF_BL A, BKG_KR_WHF_RT B, BKG_BOOKING C
        WHERE   A.VSL_CD    = SUBSTR(@[in_vvd],1,4)    
        AND A.SKD_VOY_NO    = SUBSTR(@[in_vvd],5,4)
        AND A.SKD_DIR_CD    = SUBSTR(@[in_vvd],9,1)
        AND A.WHF_POD_CD   = 'KRPUS'
        AND A.WHF_BL_STS_CD    <> 'D'
        AND NVL(A.WHF_BL_STS_CD,'N')   <> 'D'  
        AND B.WHF_BND_CD  = 'II'        
        AND A.BL_NO         = B.BL_NO
        AND A.VSL_CD        = B.VSL_CD
        AND A.SKD_VOY_NO    = B.SKD_VOY_NO
        AND A.SKD_DIR_CD    = B.SKD_DIR_CD
        AND A.WHF_BND_CD    = DECODE(B.WHF_BND_CD,'II','I','IT','T','OO','E','OT','R')  
        AND A.BKG_NO        = C.BKG_NO
        --AND NVL(C.BKG_CGO_TP_CD,' ') != 'P'
        GROUP BY B.BL_NO, B.VSL_CD,B.SKD_VOY_NO,B.SKD_DIR_CD, B.WHF_BND_CD
    )
AND WHF_BND_CD    = 'II' 
AND WHF_NTC_NO  IS NOT NULL
AND ROWNUM      = 1			]]></sql>
			<params>
				<param name="in_vvd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
