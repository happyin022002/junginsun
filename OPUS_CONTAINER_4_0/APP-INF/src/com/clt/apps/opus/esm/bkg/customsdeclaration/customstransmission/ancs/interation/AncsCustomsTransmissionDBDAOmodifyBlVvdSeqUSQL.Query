<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AncsCustomsTransmissionDBDAOmodifyBlVvdSeqUSQL">
			<desc><![CDATA[U]]></desc>
			<sql><![CDATA[
#if (${dup_ssr_no}!='YY') -- 중복 ssr_no가 없을 때의 저장
	UPDATE BKG_CSTMS_ANR_BL
	SET
	VVD_SEQ =NVL((SELECT VVD_SEQ
              	  FROM BKG_CSTMS_ANR_BL 
              	  WHERE 1=1
	              AND VSL_CD = SUBSTR(@[vvd],1,4)
	              AND SKD_VOY_NO = SUBSTR(@[vvd],5,4)
	              AND SKD_DIR_CD = SUBSTR(@[vvd],9,1)
				  AND BKG_NO = @[bkg_no]), NVL((SELECT MAX(VVD_SEQ)+1 
	              						  FROM BKG_CSTMS_ANR_BL 
	             					      WHERE 1=1
	             						  AND VSL_CD = SUBSTR(@[vvd],1,4)
	              						  AND SKD_VOY_NO = SUBSTR(@[vvd],5,4)
	             						  AND SKD_DIR_CD = SUBSTR(@[vvd],9,1)),1))
	WHERE 1=1
	AND BKG_NO = @[bkg_no]
	AND VSL_CD = SUBSTR(@[vvd],1,4)
	AND SKD_VOY_NO = SUBSTR(@[vvd],5,4)
	AND SKD_DIR_CD = SUBSTR(@[vvd],9,1)
#else -- 중복 ssr_no가 존재하면 vvd는 달라도 사실상 같은 배라는 의미로 vvd_seq가 2개의 vvd에서 연속적이여야 한다.
	UPDATE BKG_CSTMS_ANR_BL
	SET
	VVD_SEQ =NVL((SELECT VVD_SEQ
              	  FROM BKG_CSTMS_ANR_BL 
              	  WHERE 1=1
	              AND VSL_CD = SUBSTR(@[vvd],1,4)
	              AND SKD_VOY_NO = SUBSTR(@[vvd],5,4)
	              AND SKD_DIR_CD = SUBSTR(@[vvd],9,1)
				  AND BKG_NO = @[bkg_no]), NVL((SELECT MAX(VVD_SEQ)+1
                                                FROM BKG_CSTMS_ANR_BL
                                                WHERE 1=1
                                                AND VSL_CD = SUBSTR(@[vvd],1,4)
                                                AND SKD_VOY_NO = (SELECT SKD_VOY_NO FROM BKG_CSTMS_ANR_VVD WHERE 1=1
																  AND SVC_RQST_NO = (SELECT SVC_RQST_NO FROM BKG_CSTMS_ANR_VVD WHERE 1=1 AND VSL_CD = SUBSTR(@[vvd],1,4) AND SKD_VOY_NO = SUBSTR(@[vvd],5,4) AND SKD_DIR_CD = SUBSTR(@[vvd],9,1))
                                                				  AND LLOYD_NO = (SELECT LLOYD_NO FROM BKG_CSTMS_ANR_VVD WHERE 1=1 AND VSL_CD = SUBSTR(@[vvd],1,4) AND SKD_VOY_NO = SUBSTR(@[vvd],5,4) AND SKD_DIR_CD = SUBSTR(@[vvd],9,1))
																  AND SKD_DIR_CD != SUBSTR(@[vvd],9,1)
																  AND VSL_CD = SUBSTR(@[vvd],1,4)
																  )
                                                AND SKD_DIR_CD != SUBSTR(@[vvd],9,1)),1))
    WHERE 1=1
	AND BKG_NO = @[bkg_no]
	AND VSL_CD = SUBSTR(@[vvd],1,4)
	AND SKD_VOY_NO = SUBSTR(@[vvd],5,4)
	AND SKD_DIR_CD = SUBSTR(@[vvd],9,1)
#end			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
