<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="QtaAdjustmentDBDAOAddCfmTgtVvdAdjCSQL">
			<desc><![CDATA[QTA Adjustment by VVD 화면의 정보를 추가 한다.]]></desc>
			<sql><![CDATA[
INSERT INTO CSQ_CFM_TGT_VVD_ADJ (
       QTA_RLSE_VER_NO
      ,BSE_TP_CD
      ,BSE_YR
      ,BSE_QTR_CD
      ,TRD_CD
      ,RLANE_CD
      ,DIR_CD
      ,VSL_CD
      ,SKD_VOY_NO
      ,SKD_DIR_CD
      ,HIS_SEQ
      ,BSE_MON
      ,BSE_WK
      ,BFR_VSL_CD
      ,BFR_SKD_VOY_NO
      ,BFR_SKD_DIR_CD
      ,BFR_BSE_MON
      ,BFR_BSE_WK
      ,IOC_CD
      ,FNL_BSA_CAPA
      ,LOD_QTY
      ,GRS_REV
      ,CRE_USR_ID
      ,CRE_DT
      ,UPD_USR_ID
      ,UPD_DT
      ,HIS_TP_CD
)
SELECT @[qta_rlse_ver_no]       AS QTA_RLSE_VER_NO
      ,@[bse_tp_cd]             AS BSE_TP_CD
      ,@[bse_yr]                AS BSE_YR
      ,@[bse_qtr_cd]            AS BSE_QTR_CD
      ,@[trd_cd]                AS TRD_CD
      ,@[rlane_cd]              AS RLANE_CD
      ,@[dir_cd]                AS DIR_CD
      ,SUBSTR(DECODE(@[ibflag], 'D', @[vvd], @[coa_vvd]), 1, 4) AS VSL_CD
      ,SUBSTR(DECODE(@[ibflag], 'D', @[vvd], @[coa_vvd]), 5, 4) AS SKD_VOY_NO
      ,SUBSTR(DECODE(@[ibflag], 'D', @[vvd], @[coa_vvd]), 9, 1) AS SKD_DIR_CD
      ,(
         SELECT NVL(MAX(HIS_SEQ), 0) + 1
           FROM CSQ_CFM_TGT_VVD_ADJ
          WHERE QTA_RLSE_VER_NO = @[qta_rlse_ver_no]
            AND BSE_TP_CD       = @[bse_tp_cd]
            AND BSE_YR          = @[bse_yr]
            AND BSE_QTR_CD      = @[bse_qtr_cd]
            AND TRD_CD          = @[trd_cd]
            AND RLANE_CD        = @[rlane_cd]
            AND DIR_CD          = @[dir_cd]
            AND VSL_CD          = SUBSTR(DECODE(@[ibflag], 'D', @[vvd], @[coa_vvd]), 1, 4)
            AND SKD_VOY_NO      = SUBSTR(DECODE(@[ibflag], 'D', @[vvd], @[coa_vvd]), 5, 4)
            AND SKD_DIR_CD      = SUBSTR(DECODE(@[ibflag], 'D', @[vvd], @[coa_vvd]), 9, 1)
       ) AS HIS_SEQ
      ,DECODE(@[ibflag], 'D', @[bse_mon], @[coa_bse_mon]) AS BSE_MON
      ,DECODE(@[ibflag], 'D', @[bse_wk] , @[coa_bse_wk])  AS BSE_WK
      ,DECODE(@[ibflag], 'I', '', SUBSTR(@[vvd], 1, 4)) AS BFR_VSL_CD
      ,DECODE(@[ibflag], 'I', '', SUBSTR(@[vvd], 5, 4)) AS BFR_SKD_VOY_NO
      ,DECODE(@[ibflag], 'I', '', SUBSTR(@[vvd], 9, 1)) AS BFR_SKD_DIR_CD
      ,DECODE(@[ibflag], 'I', '', @[bse_mon]) AS BFR_BSE_MON
      ,DECODE(@[ibflag], 'I', '', @[bse_wk])  AS BFR_BSE_WK
      ,@[ioc_cd] AS IOC_CD
      ,NVL(DECODE(@[ibflag], 'I', '0', @[fnl_bsa_capa]),0) AS FNL_BSA_CAPA
      ,NVL(DECODE(@[ibflag], 'I', '0', @[lod_qty]),0) AS LOD_QTY
      ,NVL(DECODE(@[ibflag], 'I', '0', @[grs_rev]),0) AS GRS_REV
      ,@[usr_id] AS CRE_USR_ID
      ,SYSDATE       AS CRE_DT
      ,@[usr_id] AS UPD_USR_ID
      ,SYSDATE       AS UPD_DT
      ,@[ibflag]     AS HIS_TP_CD
  FROM DUAL			]]></sql>
			<params>
				<param name="qta_rlse_ver_no" type="12" value="" out="N"/>
				<param name="bse_tp_cd" type="12" value="" out="N"/>
				<param name="bse_yr" type="12" value="" out="N"/>
				<param name="bse_qtr_cd" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
				<param name="ibflag" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="coa_vvd" type="12" value="" out="N"/>
				<param name="bse_mon" type="12" value="" out="N"/>
				<param name="coa_bse_mon" type="12" value="" out="N"/>
				<param name="bse_wk" type="12" value="" out="N"/>
				<param name="coa_bse_wk" type="12" value="" out="N"/>
				<param name="ioc_cd" type="12" value="" out="N"/>
				<param name="fnl_bsa_capa" type="12" value="" out="N"/>
				<param name="lod_qty" type="12" value="" out="N"/>
				<param name="grs_rev" type="12" value="" out="N"/>
				<param name="usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
