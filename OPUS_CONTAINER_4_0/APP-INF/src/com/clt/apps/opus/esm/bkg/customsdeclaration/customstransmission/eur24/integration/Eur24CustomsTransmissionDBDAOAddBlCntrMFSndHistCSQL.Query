<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="Eur24CustomsTransmissionDBDAOAddBlCntrMFSndHistCSQL">
			<desc><![CDATA[Eur24CustomsTransmissionDBDAOAddBlCntrMFSndHistCSQL]]></desc>
			<sql><![CDATA[
INSERT INTO BKG_CSTMS_EUR_CNTR_MF_SND
(
VSL_CD, SKD_VOY_NO, SKD_DIR_CD, BL_NO, CSTMS_PORT_CD, CNTR_NO, CNTR_CGO_SEQ, 
EDI_SND_SEQ, 
CNTR_MF_MK_DESC, CNTR_MF_GDS_DESC, PCK_QTY, PCK_TP_CD, CNTR_MF_WGT, WGT_UT_CD, MEAS_QTY, MEAS_UT_CD, CMDT_HS_CD, CRE_USR_ID, CRE_DT, UPD_USR_ID, UPD_DT, MF_ITM_NO
)
SELECT 
VSL_CD, SKD_VOY_NO, SKD_DIR_CD, BL_NO, CSTMS_PORT_CD, CNTR_NO, CNTR_CGO_SEQ,
(
SELECT NVL(MAX(EDI_SND_SEQ),0)+1
    FROM BKG_CSTMS_EUR_CNTR_MF_SND 
    WHERE BL_NO      = @[bl_no]
    AND CSTMS_PORT_CD = @[cstms_port_cd]
),
CNTR_MF_MK_DESC, CNTR_MF_GDS_DESC, PCK_QTY, PCK_TP_CD, CNTR_MF_WGT, WGT_UT_CD, MEAS_QTY, MEAS_UT_CD, CMDT_HS_CD, @[cre_usr_id], SYSDATE, @[cre_usr_id], SYSDATE
, ROW_NUMBER() OVER (ORDER BY CNTR_NO,CNTR_CGO_SEQ)
FROM BKG_CSTMS_EUR_CNTR_MF X
WHERE VSL_CD   = @[vsl_cd]
  AND SKD_VOY_NO = @[skd_voy_no]
  AND SKD_DIR_CD = @[skd_dir_cd]
  AND BL_NO      = @[bl_no]
  AND CSTMS_PORT_CD = @[cstms_port_cd]

AND EXISTS ( SELECT 'X' FROM BKG_CSTMS_EUR_CNTR C
             WHERE C.VSL_cD = X.VSL_CD
             AND C.SKD_VOY_NO = X.SKD_VOY_NO
             AND C.SKD_DIR_CD = X.SKD_dIR_CD
             AND C.CSTMS_PORT_CD = X.CSTMS_PORT_CD
             AND C.BL_NO = X.BL_NO
             AND C.CNTR_NO = X.CNTR_NO)			]]></sql>
			<params>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="cstms_port_cd" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
