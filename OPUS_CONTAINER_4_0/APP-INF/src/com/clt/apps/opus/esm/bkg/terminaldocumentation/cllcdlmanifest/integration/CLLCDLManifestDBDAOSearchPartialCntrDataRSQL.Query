<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CLLCDLManifestDBDAOSearchPartialCntrDataRSQL">
			<desc><![CDATA[Retrieve the summarized data for save the partial container as one row]]></desc>
			<sql><![CDATA[
WITH BKG_LIST AS (
SELECT BKG_NO
FROM (
    SELECT BKG_NO, COUNT(BKG_NO) OVER (ORDER BY 1) CNT
    FROM BKG_BOOKING B
    WHERE EXISTS (SELECT 'X' FROM BKG_CONTAINER C WHERE C.BKG_NO = B.BKG_NO AND C.CNTR_NO = @[cntr_no])
    AND B.BKG_STS_CD<>'X'
    AND (B.VSL_CD, B.SKD_VOY_NO, B.SKD_DIR_CD) IN (SELECT VSL_CD, SKD_VOY_NO, SKD_DIR_CD FROM BKG_BOOKING T WHERE T.BKG_NO = @[bkg_no])
)
WHERE CNT>1
)
SELECT 
	(SELECT	SUM(NVL(OP_CNTR_QTY,0)) 
	FROM	BKG_QUANTITY
	WHERE	BKG_NO IN (SELECT BKG_NO FROM BKG_LIST)
	AND	SUBSTR(CNTR_TPSZ_CD,2,1) = '2'
	AND	CNTR_TPSZ_CD != 'Q2'
	AND	CNTR_TPSZ_CD != 'Q4') PRT_IN_TEU,
	(SELECT	SUM(NVL(OP_CNTR_QTY,0)) 
	FROM	BKG_QUANTITY
	WHERE	BKG_NO IN (SELECT BKG_NO FROM BKG_LIST)
	AND	SUBSTR(CNTR_TPSZ_CD,2,1) != '2'
	AND	CNTR_TPSZ_CD != 'Q2'
	AND	CNTR_TPSZ_CD != 'Q4') PRT_IN_FEU,
#if (${in_cntr_match} == 'Y') 
	(SELECT	SUM(DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),'2',1,2)/DECODE(SUBSTR(@[cntr_tpsz_cd],2,1),'2',1,2))--전체 대비 내 비중을 위한 분모값
	FROM	BKG_CONTAINER
	WHERE	BKG_NO IN (SELECT BKG_NO FROM BKG_LIST)
	AND	CNTR_TPSZ_CD != 'Q2'
	AND	CNTR_TPSZ_CD != 'Q4') PRT_IN_QTY,
#else 
	(SELECT	SUM(DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),'2',1,2)*NVL(OP_CNTR_QTY,0)/DECODE(SUBSTR(@[cntr_tpsz_cd],2,1),'2',1,2))--전체 대비 내 비중을 위한 분모값
	FROM	BKG_QUANTITY
	WHERE	BKG_NO IN (SELECT BKG_NO FROM BKG_LIST)
	AND	CNTR_TPSZ_CD != 'Q2'
	AND	CNTR_TPSZ_CD != 'Q4') PRT_IN_QTY,
#end
	(SELECT	SUM(NVL(PCK_QTY,0))
	FROM	BKG_CONTAINER
	WHERE	BKG_NO IN (SELECT BKG_NO FROM BKG_LIST)
	AND CNTR_NO = @[cntr_no]) PRT_PCK_QTY,
	(SELECT	MAX(PCK_TP_CD)
	FROM	BKG_CONTAINER
	WHERE	BKG_NO IN (SELECT BKG_NO FROM BKG_LIST)
	AND CNTR_NO = @[cntr_no]) PRT_PCK_TP_CD,
	(SELECT	SUM(NVL(CNTR_WGT,0))
	FROM	BKG_CONTAINER
	WHERE	BKG_NO IN (SELECT BKG_NO FROM BKG_LIST)
	AND CNTR_NO = @[cntr_no]) PRT_CNTR_WGT,
	(SELECT	MAX(WGT_UT_CD)
	FROM	BKG_CONTAINER
	WHERE	BKG_NO IN (SELECT BKG_NO FROM BKG_LIST)
	AND CNTR_NO = @[cntr_no]) PRT_CNTR_WGT_UT_CD,
    (SELECT	MAX(NVL(DECODE(VGM_WGT_UT_CD,'KGS',VGM_WGT,'LBS',VGM_WGT * 0.453592),0))
	FROM	BKG_CONTAINER
	WHERE	BKG_NO IN (SELECT BKG_NO FROM BKG_LIST)
	AND CNTR_NO = @[cntr_no]) PRT_VGM_WGT,
	(SELECT	MAX(DECODE(VGM_WGT_UT_CD,NULL,NULL,'KGS'))
	FROM	BKG_CONTAINER
	WHERE	BKG_NO IN (SELECT BKG_NO FROM BKG_LIST)
	AND CNTR_NO = @[cntr_no]) PRT_VGM_WGT_UT_CD,
	(SELECT	SUM(NVL(ACT_WGT,0))
	FROM	BKG_BL_DOC
	WHERE	BKG_NO IN (SELECT BKG_NO FROM BKG_LIST)) PRT_DOC_ACT_WGT,
	(SELECT	MAX(WGT_UT_CD)
	FROM	BKG_BL_DOC
	WHERE	BKG_NO IN (SELECT BKG_NO FROM BKG_LIST)) PRT_DOC_WGT_UT_CD,
	(SELECT	SUM(NVL(MEAS_QTY,0))
	FROM	BKG_CONTAINER
	WHERE	BKG_NO IN (SELECT BKG_NO FROM BKG_LIST)
	AND CNTR_NO = @[cntr_no]) PRT_MEAS_QTY,
	(SELECT	MAX(MEAS_UT_CD)
	FROM	BKG_CONTAINER
	WHERE	BKG_NO IN (SELECT BKG_NO FROM BKG_LIST)
	AND CNTR_NO = @[cntr_no]) PRT_MEAS_QTY_UT_CD,
	(SELECT	SUM(NVL(MEAS_QTY,0))
	FROM	BKG_BL_DOC
	WHERE	BKG_NO IN (SELECT BKG_NO FROM BKG_LIST)
	) PRT_DOC_MEAS_QTY,
	(SELECT	MAX(MEAS_UT_CD)
	FROM	BKG_BL_DOC
	WHERE	BKG_NO IN (SELECT BKG_NO FROM BKG_LIST)
	) PRT_DOC_MEAS_UT_CD
FROM DUAL			]]></sql>
			<params>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
