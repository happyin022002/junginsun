<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="KrWharfageDecMgtDBDAOsearchKrWhfDfltVslInfoRSQL">
			<desc><![CDATA[searchKrWhfDfltVslInfo]]></desc>
			<sql><![CDATA[
SELECT 
    A.MRN_NO || A.MRN_CHK_NO AS MRN_NO,
    SUBSTR(A.KR_VSL_CALL_SGN_CD,1,6) AS VSL_CALL_SGN_CD,
    A.DCHG_MZD_CD AS UNLD_TP_CD,
    TRIM(TO_CHAR(A.CALL_KNT,'000')) AS ARR_TMS_NO,
    TO_NUMBER(TO_CHAR(SYSDATE,'YYYY'),'9999') AS ARR_YR,
    A.IO_TML_LOC_CD AS IO_PORT_CD,
    C.BRTH_KR_NM AS PORT_NM,A.VSL_NM
    ,SUBSTR(D.ATTR_CTNT2,1,2) UNLD_AGN_CD1
    ,SUBSTR(D.ATTR_CTNT2,3,1) UNLD_AGN_CD2
    ,SUBSTR(D.ATTR_CTNT2,4,4) UNLD_AGN_CD3
    ,DECODE(SUBSTR(@[io_bnd_cd], 1, 1), 'O', ATTR_CTNT4, ATTR_CTNT3) AS WHF_RT
    ,ATTR_CTNT5 AS TML_CD
FROM BKG_CSTMS_KR_VVD_SMRY A, ( SELECT 
  MRN_NO, 
  MRN_CHK_NO,  
  VSL_CD,   
  SKD_VOY_NO, 
  SKD_DIR_CD, 
  IO_BND_CD, 
  PORT_CD, 
  OB_DECL_TP_CD,
  MAX(VVD_SEQ) AS SEQ
  FROM BKG_CSTMS_KR_VVD_SMRY
  WHERE 1=1
  AND VSL_CD     = SUBSTR( @[vvd],1,4 )
  AND SKD_VOY_NO = SUBSTR( @[vvd],5,4 )
  AND SKD_DIR_CD  = SUBSTR( @[vvd],9,1 )
  AND IO_BND_CD  = SUBSTR( @[io_bnd_cd], 1, 1)
  AND PORT_CD    = @[vps_port_cd]
  GROUP BY MRN_NO, MRN_CHK_NO, VSL_CD,SKD_VOY_NO,
         SKD_DIR_CD, IO_BND_CD, PORT_CD, OB_DECL_TP_CD )B, BKG_KR_WHF_BRTH C, BKG_HRD_CDG_CTNT D
WHERE A.VSL_CD      = SUBSTR( @[vvd],1,4 )
AND A.SKD_VOY_NO    = SUBSTR( @[vvd],5,4 )
AND A.SKD_DIR_CD    = SUBSTR( @[vvd],9,1 )
AND A.IO_BND_CD     = SUBSTR( @[io_bnd_cd], 1, 1)

#if (${vps_port_cd} != '')  
AND A.PORT_CD       = @[vps_port_cd]
#end

AND A.PORT_CD       = B.PORT_CD 
AND A.MRN_CHK_NO    = B.MRN_CHK_NO
AND A.VSL_CD        = B.VSL_CD
AND A.SKD_VOY_NO    = B.SKD_VOY_NO
AND A.SKD_DIR_CD    = B.SKD_DIR_CD
AND A.IO_BND_CD     = B.IO_BND_CD
AND A.OB_DECL_TP_CD = B.OB_DECL_TP_CD
AND A.VVD_SEQ       = B.SEQ
AND A.PORT_CD       = C.PORT_CD(+)
AND A.IO_TML_LOC_CD = C.BRTH_CD(+)
AND D.HRD_CDG_ID(+)    = 'KR_WHF_VSL_INFO'
AND D.ATTR_CTNT1(+)    = A.PORT_CD			]]></sql>
			<params>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="vps_port_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
