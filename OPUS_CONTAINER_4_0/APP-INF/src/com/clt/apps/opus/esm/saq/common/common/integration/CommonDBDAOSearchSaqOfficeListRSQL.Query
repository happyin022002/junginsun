<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CommonDBDAOSearchSaqOfficeListRSQL">
			<desc><![CDATA[Office Add 에 사용할 Office List 조회 ]]></desc>
			<sql><![CDATA[
SELECT OFC_CD AS TEXT, OFC_CD AS CODE
FROM SAQ_ORGANIZATION_V
WHERE N2ND_PRNT_OFC_CD = @[rhq_cd]
#if (${aq_cd} != '' )
	      AND N3RD_PRNT_OFC_CD = @[aq_cd]
#else
	      AND N3RD_PRNT_OFC_CD IS NULL
#end
      AND LVL              = 4
      AND DELT_FLG         = 'N'
#if (${app_tp_cd} == 'L' )
	  AND OFC_CD IN (
	                          SELECT RGN_OFC_CD
	                            FROM SAQ_MON_CFM_QTA
	                           WHERE MQTA_RLSE_VER_NO = @[rlse_ver_no]
	                             AND BSE_YR           = @[bse_year]
	                             AND BSE_QTR_CD       = @[bse_qtr_cd]
	                             AND QTA_TGT_CD       = @[qta_tgt_cd]
	                             AND TRD_CD           = @[trd_cd]
	                             AND RLANE_CD         = @[rlane_cd]
	                             AND DIR_CD           = @[dir_cd]
	                             AND RHQ_CD           = @[rhq_cd]
                         )



#end

#if (${app_tp_cd} == 'O' )
	      AND OFC_CD NOT IN (
	                          SELECT RGN_OFC_CD
	                            FROM SAQ_MON_CFM_QTA
	                           WHERE MQTA_RLSE_VER_NO = @[rlse_ver_no]
	                             AND BSE_YR           = @[bse_year]
	                             AND BSE_QTR_CD       = @[bse_qtr_cd]
	                             AND QTA_TGT_CD       = @[qta_tgt_cd]
	                             AND TRD_CD           = @[trd_cd]
	                             AND RLANE_CD         = @[rlane_cd]
	                             AND DIR_CD           = @[dir_cd]
	                             AND RHQ_CD           = @[rhq_cd]
	#if (${aq_cd} != '' )
		                             AND AQ_CD            = @[aq_cd]
	#else
		                             AND AQ_CD IS NULL
	#end
	                        GROUP BY RGN_OFC_CD
	                          HAVING COUNT(DISTINCT BSE_MON) = ( SELECT COUNT(DISTINCT BSE_MON)
	                                                               FROM SAQ_MON_CFM_QTA
	                                                              WHERE MQTA_RLSE_VER_NO = @[rlse_ver_no]
	                                                                AND BSE_YR           = @[bse_year]
	                                                                AND BSE_QTR_CD       = @[bse_qtr_cd]
	                                                                AND QTA_TGT_CD       = @[qta_tgt_cd]
	                                                                AND TRD_CD           = @[trd_cd]
	                                                                AND RLANE_CD         = @[rlane_cd]
	                                                                AND DIR_CD           = @[dir_cd]
	                                                                AND RHQ_CD           = @[rhq_cd]
	#if (${aq_cd} != '' )
		                                                                AND AQ_CD            = @[aq_cd]  )
	#else
		                                                                AND AQ_CD IS NULL         )
	#end
	                           UNION
	                          SELECT RGN_OFC_CD
	                            FROM SAQ_MON_CFM_QTA_OFC_ADD
	                           WHERE MQTA_RLSE_VER_NO = @[rlse_ver_no]
	                             AND BSE_YR           = @[bse_year]
	                             AND BSE_QTR_CD       = @[bse_qtr_cd]
	                             AND QTA_TGT_CD       = @[qta_tgt_cd]
	                             AND TRD_CD           = @[trd_cd]
	                             AND RLANE_CD         = @[rlane_cd]
	                             AND DIR_CD           = @[dir_cd]
	                             AND RHQ_CD           = @[rhq_cd]
	#if (${aq_cd} != '' )
		                             AND AQ_CD            = @[aq_cd]    )
	#else
		                             AND AQ_CD IS NULL           )
	#end
#end
ORDER BY OFC_CD			]]></sql>
			<params>
				<param name="rhq_cd" type="12" value="" out="N"/>
				<param name="aq_cd" type="12" value="" out="N"/>
				<param name="rlse_ver_no" type="12" value="" out="N"/>
				<param name="bse_year" type="12" value="" out="N"/>
				<param name="bse_qtr_cd" type="12" value="" out="N"/>
				<param name="qta_tgt_cd" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
