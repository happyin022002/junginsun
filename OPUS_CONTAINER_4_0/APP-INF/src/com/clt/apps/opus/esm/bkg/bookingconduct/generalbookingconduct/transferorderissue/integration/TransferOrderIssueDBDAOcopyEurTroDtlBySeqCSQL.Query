<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TransferOrderIssueDBDAOcopyEurTroDtlBySeqCSQL">
			<desc><![CDATA[eur tro를 copy한다.]]></desc>
			<sql><![CDATA[
insert into bkg_eur_tro_dtl(BKG_NO 
,IO_BND_CD 
,TRO_SEQ 
,TRO_SUB_SEQ 
,DOR_ADDR_TP_CD 
,LOC_CD 
,ZN_CD 
,LOD_REF_NO 
,DOR_ZIP_ID 
,DOR_ADDR 
,ARR_DT 
,CNTC_PSON_NM 
,CNTC_PHN_NO 
,CNTC_EML 
,CRE_USR_ID 
,CRE_DT 
,UPD_USR_ID 
,UPD_DT
)
select @[targetBkg] BKG_NO 
,dtl.IO_BND_CD 
,mst.TRO_SEQ 

#if(${tro_seq}!='')
--tro split
	,nvl((select max(tro_sub_seq)
			from bkg_eur_tro_dtl 
		   where bkg_no 		= @[targetBkg]
        	 and io_bnd_cd 		= @[io_bnd_cd]
			 and cxl_flg 		= 'N'
  			 and tro_seq 		= @[tro_seq]), 0) + 1
#else
--tro copy
	,dtl.TRO_SUB_SEQ 
#end

,dtl.DOR_ADDR_TP_CD 
,dtl.LOC_CD 
,dtl.ZN_CD 
,dtl.LOD_REF_NO 
,dtl.DOR_ZIP_ID 
,dtl.DOR_ADDR 
,dtl.ARR_DT 
,dtl.CNTC_PSON_NM 
,dtl.CNTC_PHN_NO 
,dtl.CNTC_EML 
,@[usr_id] CRE_USR_ID 
,sysdate CRE_DT 
,@[usr_id] UPD_USR_ID 
,sysdate UPD_DT
  from  bkg_eur_tro_dtl DTL, bkg_eur_tro mst
 where mst.bkg_no    = @[targetBkg] 
   and mst.io_bnd_cd = @[io_bnd_cd]
   and mst.io_bnd_cd = dtl.io_bnd_cd
   and dtl.bkg_no    = @[bkg_no]
#if(${tro_seq}==''&&${tro_sub_seq} == '')
--tro copy
   and mst.pctl_no = dtl.tro_seq
   and dtl.tro_seq in (select tro_seq
                         from bkg_eur_tro
                        where bkg_no 		= @[bkg_no]
                          and io_bnd_cd 	= @[io_bnd_cd]
                          and cxl_flg		= 'N')
 order by mst.bkg_no, mst.tro_seq
#else
   and dtl.tro_seq 		= @[tro_seq]
   and mst.pctl_no      = dtl.tro_seq
   and dtl.tro_sub_seq 	= @[tro_sub_seq]
#end			]]></sql>
			<params>
				<param name="targetBkg" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="tro_seq" type="2" value="" out="N"/>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="tro_sub_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
