/*=========================================================
*Copyright(c) 2017 CyberLogitec
*@FileName : AGNCommApprovalDBDAOAddCsrHeaderApInvDtrbInfoCSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2017.01.03
*@LastModifier : 
*@LastVersion : 1.0
* 2017.01.03 
* 1.0 Creation
=========================================================*/
package com.clt.apps.opus.esm.acm.acmapproval.agncommapproval.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.clt.framework.support.db.ISQLTemplate;

/**
 *
 * @author 
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class AGNCommApprovalDBDAOAddCsrHeaderApInvDtrbInfoCSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * AP_INV_DTRB에 데이터를 생성한다.
	  * 
	  * 2016.01.15 박다은 ASA Clearing(965113) CSR 생성시 Activity Date 보완
	  * 2016.03.31 박다은 DTRB_COA_VVD_CD 의 SERVICE LANE 정보를 ATTR_CTNT14 에 입력.(null 항차의 경우 COM 처리) 
	  * 2016.05.30 박다은 INV_AMT 생성 시 MDM_CURRENCY 의 DP_PRCS_KNT 에 따라 round 처리하여 interface.
	  * 2016.06.22 박다은 SQL 튜닝
	  * 2016.09.19 박다은 [CSR-#18799] Activity Date 변경 - Agent Comm. 은 Sail arrival date 기준, Other Comm. 은 VVD 의 첫번째 loading port 의 ETD 기준
	  * </pre>
	  */
	public AGNCommApprovalDBDAOAddCsrHeaderApInvDtrbInfoCSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("asa_no",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("gl_dt",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("ar_ofc_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("finc_rgn_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("ap_ctr_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("cre_usr_id",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("agn_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("csr_no",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.clt.apps.opus.esm.acm.acmapproval.agncommapproval.integration").append("\n"); 
		query.append("FileName : AGNCommApprovalDBDAOAddCsrHeaderApInvDtrbInfoCSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("INSERT" ).append("\n"); 
		query.append("      INTO AP_INV_DTRB" ).append("\n"); 
		query.append("         (" ).append("\n"); 
		query.append("           CSR_NO," ).append("\n"); 
		query.append("           LINE_SEQ," ).append("\n"); 
		query.append("           LINE_NO," ).append("\n"); 
		query.append("           LINE_TP_LU_CD," ).append("\n"); 
		query.append("           INV_AMT," ).append("\n"); 
		query.append("           INV_DESC," ).append("\n"); 
		query.append("           INV_TAX_CD," ).append("\n"); 
		query.append("           DTRB_COA_CO_CD," ).append("\n"); 
		query.append("           DTRB_COA_RGN_CD," ).append("\n"); 
		query.append("           DTRB_COA_CTR_CD," ).append("\n"); 
		query.append("           DTRB_COA_ACCT_CD," ).append("\n"); 
		query.append("           DTRB_COA_VVD_CD," ).append("\n"); 
		query.append("           DTRB_COA_INTER_CO_CD," ).append("\n"); 
		query.append("           DTRB_COA_FTU_N1ST_CD," ).append("\n"); 
		query.append("           DTRB_COA_FTU_N2ND_CD," ).append("\n"); 
		query.append("           ATTR_CATE_NM," ).append("\n"); 
		query.append("           ATTR_CTNT1," ).append("\n"); 
		query.append("           ATTR_CTNT2," ).append("\n"); 
		query.append("           ATTR_CTNT3," ).append("\n"); 
		query.append("           ATTR_CTNT4," ).append("\n"); 
		query.append("           ATTR_CTNT5," ).append("\n"); 
		query.append("           ATTR_CTNT6," ).append("\n"); 
		query.append("           ATTR_CTNT7," ).append("\n"); 
		query.append("           ATTR_CTNT8," ).append("\n"); 
		query.append("           ATTR_CTNT9," ).append("\n"); 
		query.append("           ATTR_CTNT10," ).append("\n"); 
		query.append("           ATTR_CTNT11," ).append("\n"); 
		query.append("           ATTR_CTNT12," ).append("\n"); 
		query.append("           ATTR_CTNT13," ).append("\n"); 
		query.append("           ATTR_CTNT14," ).append("\n"); 
		query.append("           ATTR_CTNT15," ).append("\n"); 
		query.append("           BKG_NO," ).append("\n"); 
		query.append("           CNTR_TPSZ_CD," ).append("\n"); 
		query.append("           ACT_VVD_CD," ).append("\n"); 
		query.append("           PLN_SCTR_DIV_CD," ).append("\n"); 
		query.append("           SO_CRR_CD," ).append("\n"); 
		query.append("           YD_CD," ).append("\n"); 
		query.append("           FTU_USE_CTNT1," ).append("\n"); 
		query.append("           FTU_USE_CTNT2," ).append("\n"); 
		query.append("           FTU_USE_CTNT3," ).append("\n"); 
		query.append("           FTU_USE_CTNT4," ).append("\n"); 
		query.append("           FTU_USE_CTNT5," ).append("\n"); 
		query.append("           EAI_EVNT_DT," ).append("\n"); 
		query.append("           CRE_USR_ID," ).append("\n"); 
		query.append("           CRE_DT" ).append("\n"); 
		query.append("         )" ).append("\n"); 
		query.append("    SELECT" ).append("\n"); 
		query.append("           Y.CSR_NO," ).append("\n"); 
		query.append("           ROW_NUMBER() OVER (ORDER BY X.ATT1, X.CMPY, X.REGION, X.CENTER, X.ACCT, X.VVD) AS LINE_SEQ," ).append("\n"); 
		query.append("           DENSE_RANK() OVER (ORDER BY X.ATT1, X.CMPY, X.REGION, X.CENTER, X.ACCT, X.VVD, X.ATT7) AS LINE_NUMBER," ).append("\n"); 
		query.append("           X.LOOKUP," ).append("\n"); 
		query.append("           X.INV_AMT," ).append("\n"); 
		query.append("           X.INV_DESC," ).append("\n"); 
		query.append("           X.TAX_CD," ).append("\n"); 
		query.append("           X.CMPY," ).append("\n"); 
		query.append("           X.REGION," ).append("\n"); 
		query.append("           X.CENTER," ).append("\n"); 
		query.append("           X.ACCT," ).append("\n"); 
		query.append("           X.VVD," ).append("\n"); 
		query.append("           X.INTR_CMPY," ).append("\n"); 
		query.append("           X.FUTR1," ).append("\n"); 
		query.append("           X.FUTR2," ).append("\n"); 
		query.append("           X.ATT_CTLG," ).append("\n"); 
		query.append("           X.ATT1," ).append("\n"); 
		query.append("           X.ATT2," ).append("\n"); 
		query.append("           X.ATT3," ).append("\n"); 
		query.append("           X.ATT4," ).append("\n"); 
		query.append("           X.ATT5," ).append("\n"); 
		query.append("           X.ATT6," ).append("\n"); 
		query.append("           X.ATT7," ).append("\n"); 
		query.append("           X.ATT8," ).append("\n"); 
		query.append("           X.ATT9," ).append("\n"); 
		query.append("           X.ATT10," ).append("\n"); 
		query.append("           X.ATT11," ).append("\n"); 
		query.append("           X.ATT12," ).append("\n"); 
		query.append("           X.ATT13," ).append("\n"); 
		query.append("           X.ATT14," ).append("\n"); 
		query.append("           X.ATT15," ).append("\n"); 
		query.append("           X.BKG_NO," ).append("\n"); 
		query.append("           X.TPSZ," ).append("\n"); 
		query.append("           X.REV_VVD," ).append("\n"); 
		query.append("           X.DIV_CD," ).append("\n"); 
		query.append("           X.CARRIER," ).append("\n"); 
		query.append("           X.YARD," ).append("\n"); 
		query.append("           X.COST_CODE," ).append("\n"); 
		query.append("           X.QTY," ).append("\n"); 
		query.append("           X.TMNL_CD," ).append("\n"); 
		query.append("           X.AGNT," ).append("\n"); 
		query.append("           X.SUB_FLG," ).append("\n"); 
		query.append("           SYSDATE                                                                       AS EAI_EVNT_DT," ).append("\n"); 
		query.append("           @[cre_usr_id]                                                                 AS CRE_USR_ID," ).append("\n"); 
		query.append("           SYSDATE                                                                       AS CRE_DT" ).append("\n"); 
		query.append("      FROM" ).append("\n"); 
		query.append("         ( /* General */" ).append("\n"); 
		query.append("               " ).append("\n"); 
		query.append("               " ).append("\n"); 
		query.append("               SELECT" ).append("\n"); 
		query.append("                      A.VNDR_SEQ AS VNDR," ).append("\n"); 
		query.append("                      'ITEM' AS LOOKUP," ).append("\n"); 
		query.append("                    ROUND(NVL(B.PAY_IF_DTRB_AMT, A.PAY_IF_AMT), M.DP_PRCS_KNT)             AS INV_AMT," ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                                 SUBSTR (ACCT_ENG_NM, 1, 39)" ).append("\n"); 
		query.append("                            FROM MDM_ACCOUNT" ).append("\n"); 
		query.append("                           WHERE ACCT_CD = A.COMM_STND_COST_CD" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("                   || ' '" ).append("\n"); 
		query.append("                   /*|| SUBSTR (TRIM (A.OTR_COMM_ACCT_CTNT), 1, 200)*/                   AS INV_DESC," ).append("\n"); 
		query.append("                      ''                                                                 AS TAX_CD," ).append("\n"); 
		query.append("                      '01'  AS CMPY," ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                                 NVL(MAX(FINC_RGN_CD), '00')" ).append("\n"); 
		query.append("                            FROM MDM_ORGANIZATION" ).append("\n"); 
		query.append("                           WHERE OFC_CD = A.AP_OFC_CD" ).append("\n"); 
		query.append("                    )                                                                    AS REGION," ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                                 AP_CTR_CD" ).append("\n"); 
		query.append("                            FROM MDM_ORGANIZATION" ).append("\n"); 
		query.append("                           WHERE OFC_CD = A.AP_OFC_CD" ).append("\n"); 
		query.append("                    )                                                                    AS CENTER," ).append("\n"); 
		query.append("                      A.COMM_STND_COST_CD ACCT," ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                            CASE SUBSTR(REV_VVD_CD, 0, 2)" ).append("\n"); 
		query.append("                            WHEN 'FD'" ).append("\n"); 
		query.append("                            THEN 'CFDR'||SUBSTR(REV_VVD_CD, 3, 4)||'EE'" ).append("\n"); 
		query.append("                            ELSE REV_VVD_CD" ).append("\n"); 
		query.append("                             END" ).append("\n"); 
		query.append("                            FROM ACM_AGN_BKG_INFO" ).append("\n"); 
		query.append("                           WHERE BKG_NO = A.BKG_NO" ).append("\n"); 
		query.append("                    )                                                                    AS VVD," ).append("\n"); 
		query.append("                    (     SELECT NVL(LTRIM(SUBS_CO_CD), '00')" ).append("\n"); 
		query.append("                            FROM MDM_VENDOR" ).append("\n"); 
		query.append("                           WHERE VNDR_SEQ = A.VNDR_SEQ" ).append("\n"); 
		query.append("                    )                                                                    AS INTR_CMPY," ).append("\n"); 
		query.append("                      '000000'                                                           AS FUTR1," ).append("\n"); 
		query.append("                      '000000'                                                           AS FUTR2," ).append("\n"); 
		query.append("                      A.COMM_STND_COST_CD                                                AS ATT_CTLG," ).append("\n"); 
		query.append("                      A.AUD_NO                                                           AS ATT1,--NVL(A.INV_NO, A.AUD_NO)" ).append("\n"); 
		query.append("                      SUBSTR(@[gl_dt], 0, 4)" ).append("\n"); 
		query.append("                   || '/'" ).append("\n"); 
		query.append("                   || SUBSTR(@[gl_dt], 5, 2)" ).append("\n"); 
		query.append("                   || '/'" ).append("\n"); 
		query.append("                   || SUBSTR(@[gl_dt], 7, 2)" ).append("\n"); 
		query.append("                   || ' 00:00:00'                                                        AS ATT2," ).append("\n"); 
		query.append("                      A.AC_OCCR_INFO_CD                                                	 AS ATT3," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT4," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT5," ).append("\n"); 
		query.append("                      SAC_TRUNK_VVD_RLANE_FNC(A.BKG_NO)                                  AS ATT6, -- Revenue Lane" ).append("\n"); 
		query.append("                      SAC_TRUNK_VVD_TRD_FNC(A.BKG_NO)                                    AS ATT7, -- Trade Code" ).append("\n"); 
		query.append("                      ''                                                                 AS ATT8," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT9," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT10," ).append("\n"); 
		query.append("                      A.SAIL_ARR_DT                                                      AS ATT11, --Activity Date" ).append("\n"); 
		query.append("                      A.AR_OFC_CD                                                        AS ATT12, --Activity Place " ).append("\n"); 
		query.append("                      ''                                                                 AS ATT13," ).append("\n"); 
		query.append("                      (SELECT MAX(SLAN_CD) " ).append("\n"); 
		query.append("                                FROM AR_MST_REV_VVD" ).append("\n"); 
		query.append("                               WHERE 1=1" ).append("\n"); 
		query.append("                                 --AND VSL_CD||SKD_VOY_NO||SKD_DIR_CD||RLANE_DIR_CD  " ).append("\n"); 
		query.append("                                 AND (VSL_CD,SKD_VOY_NO,SKD_DIR_CD,RLANE_DIR_CD)" ).append("\n"); 
		query.append("                                         IN  " ).append("\n"); 
		query.append("                                 (     SELECT" ).append("\n"); 
		query.append("                                    --CASE SUBSTR(REV_VVD_CD, 0, 2)" ).append("\n"); 
		query.append("                                    --WHEN 'FD'" ).append("\n"); 
		query.append("                                    --THEN 'CFDR'||SUBSTR(REV_VVD_CD, 3, 4)||'EE'" ).append("\n"); 
		query.append("                                    --ELSE REV_VVD_CD" ).append("\n"); 
		query.append("                                    -- END" ).append("\n"); 
		query.append("                                 CASE WHEN SUBSTR(REV_VVD_CD, 1, 2) = 'FD' THEN 'CFDR' ELSE SUBSTR(REV_VVD_CD, 1, 4) END AS VSL_CD" ).append("\n"); 
		query.append("                               , CASE WHEN SUBSTR(REV_VVD_CD, 1, 2) = 'FD' THEN SUBSTR(REV_VVD_CD, 3, 4) ELSE SUBSTR(REV_VVD_CD, 5, 4) END AS SKD_VOY_NO" ).append("\n"); 
		query.append("                               , CASE WHEN SUBSTR(REV_VVD_CD, 1, 2) = 'FD' THEN 'E' ELSE SUBSTR(REV_VVD_CD, 9, 1) END AS SKD_DIR_CD" ).append("\n"); 
		query.append("                               , CASE WHEN SUBSTR(REV_VVD_CD, 1, 2) = 'FD' THEN 'E' ELSE SUBSTR(REV_VVD_CD, 10, 1) END AS RLANE_DIR_CD" ).append("\n"); 
		query.append("                            FROM ACM_AGN_BKG_INFO" ).append("\n"); 
		query.append("                           WHERE BKG_NO = A.BKG_NO" ).append("\n"); 
		query.append("                    )                              " ).append("\n"); 
		query.append("                                                                                                                                          )  AS ATT14, --Service Lane" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                      ''                                                                 AS ATT15," ).append("\n"); 
		query.append("                      A.BKG_NO," ).append("\n"); 
		query.append("                      B.CNTR_TPSZ_CD                                                     AS TPSZ," ).append("\n"); 
		query.append("                 CASE A.AC_SLAN_CD||SUBSTR(A.AC_VSL_CD, 0, 2)" ).append("\n"); 
		query.append("                 WHEN 'RBCFD'" ).append("\n"); 
		query.append("                 THEN 'CFDR'" ).append("\n"); 
		query.append("                   || SUBSTR (A.AC_VSL_CD, 3, 2)" ).append("\n"); 
		query.append("                   || SUBSTR (AC_SKD_VOY_NO, 0, 2)" ).append("\n"); 
		query.append("                   || 'EE'" ).append("\n"); 
		query.append("                 ELSE A.AC_VSL_CD" ).append("\n"); 
		query.append("                   || A.AC_SKD_VOY_NO" ).append("\n"); 
		query.append("                   || A.AC_SKD_DIR_CD" ).append("\n"); 
		query.append("                   || NVL(A.AC_REV_DIR_CD, A.AC_SKD_DIR_CD)" ).append("\n"); 
		query.append("                  END                                                                    AS REV_VVD," ).append("\n"); 
		query.append("                      'C'                                                                AS DIV_CD," ).append("\n"); 
		query.append("                      ''                                                                 AS CARRIER," ).append("\n"); 
		query.append("                      ''                                                                 AS YARD," ).append("\n"); 
		query.append("                      ''                                                                 AS COST_CODE," ).append("\n"); 
		query.append("                      B.BKG_VOL_QTY QTY," ).append("\n"); 
		query.append("                      ''                                                                 AS TMNL_CD," ).append("\n"); 
		query.append("                      A.AGN_CD AGNT," ).append("\n"); 
		query.append("                      A.OFC_CHR_CD                                                       AS SUB_FLG," ).append("\n"); 
		query.append("                      A.CSR_NO                                                           AS CSR_NO" ).append("\n"); 
		query.append("                 FROM ACM_AGN_COMM     A," ).append("\n"); 
		query.append("                      ACM_AGN_COMM_DTL B," ).append("\n"); 
		query.append("                      MDM_CURRENCY     M" ).append("\n"); 
		query.append("                WHERE A.AR_OFC_CD         = @[ar_ofc_cd]" ).append("\n"); 
		query.append("                  AND A.AGN_CD            = @[agn_cd]" ).append("\n"); 
		query.append("                  AND A.IF_DT         IS NULL" ).append("\n"); 
		query.append("                  AND A.AC_STS_CD  = 'AS'" ).append("\n"); 
		query.append("				#if(${aud_no} != '')" ).append("\n"); 
		query.append("                  AND A.AUD_NO" ).append("\n"); 
		query.append("                   IN" ).append("\n"); 
		query.append("                   (" ).append("\n"); 
		query.append("                      ${aud_no}" ).append("\n"); 
		query.append("                   )" ).append("\n"); 
		query.append("				#end" ).append("\n"); 
		query.append("                  AND A.AUD_NO     IS NOT NULL" ).append("\n"); 
		query.append("                  AND A.BKG_NO            = B.BKG_NO(+)" ).append("\n"); 
		query.append("                  AND A.AGN_CD            = B.AGN_CD(+)" ).append("\n"); 
		query.append("                  AND A.IO_BND_CD         = B.IO_BND_CD(+)" ).append("\n"); 
		query.append("                  AND A.AC_TP_CD          = B.AC_TP_CD(+)" ).append("\n"); 
		query.append("                  --AND A.AC_SEQ            = B.AC_SEQ(+)" ).append("\n"); 
		query.append("                  AND B.AC_SEQ  IN (A.AC_SEQ, A.AC_SEQ+1000)" ).append("\n"); 
		query.append("                  AND M.CURR_CD           = A.CURR_CD" ).append("\n"); 
		query.append("                  AND M.DELT_FLG          = 'N' " ).append("\n"); 
		query.append("            UNION ALL /* 상계정산 대리점 */" ).append("\n"); 
		query.append("               SELECT" ).append("\n"); 
		query.append("                      A.VNDR_SEQ AS VNDR," ).append("\n"); 
		query.append("                      'ITEM' AS LOOKUP," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                    SUM (-ROUND(NVL(B.PAY_IF_DTRB_AMT, A.PAY_IF_AMT), M.DP_PRCS_KNT))     AS INV_AMT," ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                                 SUBSTR (ACCT_ENG_NM, 1, 39)" ).append("\n"); 
		query.append("                            FROM MDM_ACCOUNT" ).append("\n"); 
		query.append("                           WHERE ACCT_CD = '954113'" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("                   || ' '" ).append("\n"); 
		query.append("                   /*|| SUBSTR (TRIM (A.OTR_COMM_ACCT_CTNT), 1, 200)*/                   AS INV_DESC," ).append("\n"); 
		query.append("                      ''                                                                 AS TAX_CD," ).append("\n"); 
		query.append("                      '01'                                                               AS CMPY," ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                                 NVL(MAX(FINC_RGN_CD), '00')" ).append("\n"); 
		query.append("                            FROM MDM_ORGANIZATION" ).append("\n"); 
		query.append("                           WHERE OFC_CD = A.AP_OFC_CD" ).append("\n"); 
		query.append("                    )                                                                    AS REGION," ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                                 AP_CTR_CD" ).append("\n"); 
		query.append("                            FROM MDM_ORGANIZATION" ).append("\n"); 
		query.append("                           WHERE OFC_CD = A.AP_OFC_CD" ).append("\n"); 
		query.append("                    )                                                                    AS CENTER," ).append("\n"); 
		query.append("                      '954113'                                                           AS ACCT," ).append("\n"); 
		query.append("                      '0000000000'                                                       AS VVD," ).append("\n"); 
		query.append("                    (     SELECT NVL(LTRIM(SUBS_CO_CD), '00')" ).append("\n"); 
		query.append("                            FROM MDM_VENDOR" ).append("\n"); 
		query.append("                           WHERE VNDR_SEQ = A.VNDR_SEQ" ).append("\n"); 
		query.append("                    )                                                                    AS INTR_CMPY," ).append("\n"); 
		query.append("                      '000000'                                                           AS FUTR1," ).append("\n"); 
		query.append("                      '000000'                                                           AS FUTR2," ).append("\n"); 
		query.append("                      '954113' AS ATT_CTLG," ).append("\n"); 
		query.append("                      A.AUD_NO                                                           AS ATT1," ).append("\n"); 
		query.append("                      SUBSTR(@[gl_dt], 0, 4)" ).append("\n"); 
		query.append("                   || '/'" ).append("\n"); 
		query.append("                   || SUBSTR(@[gl_dt], 5, 2)" ).append("\n"); 
		query.append("                   || '/'" ).append("\n"); 
		query.append("                   || SUBSTR(@[gl_dt], 7, 2)" ).append("\n"); 
		query.append("                   || ' 00:00:00'                                                        AS ATT2," ).append("\n"); 
		query.append("                      A.AC_OCCR_INFO_CD                                                  AS ATT3," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT4," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT5," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT6," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT7," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT8," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT9," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT10," ).append("\n"); 
		query.append("					(SELECT ASA_PRD_TO_DT " ).append("\n"); 
		query.append("   					   FROM SAR_ASA_MST" ).append("\n"); 
		query.append("					  WHERE ASA_NO = @[asa_no])                                          AS ATT11, --Activity Date" ).append("\n"); 
		query.append("                      A.AR_OFC_CD                                                        AS ATT12, --Activity Place " ).append("\n"); 
		query.append("                      ''                                                                 AS ATT13," ).append("\n"); 
		query.append("                      'COM'                                                       		 AS ATT14, --Service Lane" ).append("\n"); 
		query.append("                      ''                                                                 AS ATT15," ).append("\n"); 
		query.append("                      ''                                                                 AS BKG_NO," ).append("\n"); 
		query.append("                      ''                                                                 AS TPSZ," ).append("\n"); 
		query.append("                      ''                                                                 AS REV_VVD," ).append("\n"); 
		query.append("                      ''                                                                 AS DIV_CD," ).append("\n"); 
		query.append("                      ''                                                                 AS CARRIER," ).append("\n"); 
		query.append("                      ''                                                                 AS YARD," ).append("\n"); 
		query.append("                      ''                                                                 AS COST_CODE," ).append("\n"); 
		query.append("                      0                                                                  AS QTY," ).append("\n"); 
		query.append("                      ''                                                                 AS TMNL_CD," ).append("\n"); 
		query.append("                      A.AGN_CD                                                           AS AGNT," ).append("\n"); 
		query.append("                      A.OFC_CHR_CD                                                       AS SUB_FLG," ).append("\n"); 
		query.append("                      A.CSR_NO                                                           AS CSR_NO" ).append("\n"); 
		query.append("                 FROM ACM_AGN_COMM     A," ).append("\n"); 
		query.append("                      ACM_AGN_COMM_DTL B," ).append("\n"); 
		query.append("                      MDM_CURRENCY     M" ).append("\n"); 
		query.append("                WHERE A.AR_OFC_CD         = @[ar_ofc_cd]" ).append("\n"); 
		query.append("                  AND A.AGN_CD            = @[agn_cd]" ).append("\n"); 
		query.append("                  AND A.IF_DT         IS NULL" ).append("\n"); 
		query.append("                  AND A.AC_STS_CD  = 'AS'" ).append("\n"); 
		query.append("				#if(${aud_no} != '')" ).append("\n"); 
		query.append("                  AND A.AUD_NO" ).append("\n"); 
		query.append("                   IN" ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                      ${aud_no}" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("				#end" ).append("\n"); 
		query.append("                  AND A.AUD_NO     IS NOT NULL" ).append("\n"); 
		query.append("                  AND 'O'" ).append("\n"); 
		query.append("                   IN" ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                                 SO_IF_CD" ).append("\n"); 
		query.append("                            FROM MDM_ORGANIZATION" ).append("\n"); 
		query.append("                           WHERE OFC_CD = A.AGN_CD" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("                  AND A.BKG_NO            = B.BKG_NO(+)" ).append("\n"); 
		query.append("                  AND A.AGN_CD            = B.AGN_CD(+)" ).append("\n"); 
		query.append("                  AND A.IO_BND_CD         = B.IO_BND_CD(+)" ).append("\n"); 
		query.append("                  AND A.AC_TP_CD          = B.AC_TP_CD(+)" ).append("\n"); 
		query.append("                  AND B.AC_SEQ  IN (A.AC_SEQ, A.AC_SEQ+1000)" ).append("\n"); 
		query.append("                  AND M.CURR_CD           = A.CURR_CD" ).append("\n"); 
		query.append("                  AND M.DELT_FLG          = 'N' " ).append("\n"); 
		query.append("             GROUP BY A.VNDR_SEQ," ).append("\n"); 
		query.append("                      A.AP_OFC_CD," ).append("\n"); 
		query.append("                      A.AUD_NO," ).append("\n"); 
		query.append("                      A.AC_OCCR_INFO_CD," ).append("\n"); 
		query.append("                      A.AGN_CD," ).append("\n"); 
		query.append("                      A.OFC_CHR_CD," ).append("\n"); 
		query.append("                      A.CSR_NO," ).append("\n"); 
		query.append("                      A.AR_OFC_CD," ).append("\n"); 
		query.append("                      A.AC_SLAN_CD" ).append("\n"); 
		query.append("                      --,A.OTR_COMM_ACCT_CTNT" ).append("\n"); 
		query.append("            UNION ALL /* VAT */" ).append("\n"); 
		query.append("               SELECT" ).append("\n"); 
		query.append("                      A.VNDR_SEQ                                                         AS VNDR," ).append("\n"); 
		query.append("                      'ITEM'                                                             AS LOOKUP," ).append("\n"); 
		query.append("                      ROUND (SUM (NVL (B.PAY_IF_DTRB_AMT*NVL(A.INV_TAX_RT, 0)/100, A.PAY_IF_AMT*NVL (A.INV_TAX_RT, 0)/100)), M.DP_PRCS_KNT) AS INV_AMT," ).append("\n"); 
		query.append("                      A.AUD_NO" ).append("\n"); 
		query.append("                   || ' '" ).append("\n"); 
		query.append("                   /*|| A.OTR_COMM_ACCT_CTNT*/                                           AS INV_DESC," ).append("\n"); 
		query.append("                      ''                                                           		 AS TAX_CD," ).append("\n"); 
		query.append("                      '01'                                                               AS company," ).append("\n"); 
		query.append("                      @[finc_rgn_cd]                                                     AS REGION," ).append("\n"); 
		query.append("                      @[ap_ctr_cd]                                                       AS CENTER," ).append("\n"); 
		query.append("                      '111821'                                                           AS ACCT," ).append("\n"); 
		query.append("                      '0000000000'                                                       AS VVD," ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                                 NVL(LTRIM(SUBS_CO_CD), '00')" ).append("\n"); 
		query.append("                            FROM MDM_VENDOR" ).append("\n"); 
		query.append("                           WHERE VNDR_SEQ = A.VNDR_SEQ" ).append("\n"); 
		query.append("                    )                                                                    AS INTR_CMPY," ).append("\n"); 
		query.append("                      '000000'                                                           AS FUTURE1," ).append("\n"); 
		query.append("                      '000000'                                                           AS FUTURE2," ).append("\n"); 
		query.append("                      '111821'                                                           AS ATT_CTLG," ).append("\n"); 
		query.append("                      A.AUD_NO                                        		             AS ATT1,--NVL (A.INV_NO, A.AUD_NO)" ).append("\n"); 
		query.append("                      SUBSTR (@[gl_dt], 0, 4)" ).append("\n"); 
		query.append("                   || '/'" ).append("\n"); 
		query.append("                   || SUBSTR (@[gl_dt], 5, 2)" ).append("\n"); 
		query.append("                   || '/'" ).append("\n"); 
		query.append("                   || SUBSTR (@[gl_dt], 7, 2)" ).append("\n"); 
		query.append("                   || ' 00:00:00'                                                        AS ATT2," ).append("\n"); 
		query.append("                      A.AC_OCCR_INFO_CD                                                  AS ATT3," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT4," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT5," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT6," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT7," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT8," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT9," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT10," ).append("\n"); 
		query.append("                      NVL(@[gl_dt], A.SAIL_ARR_DT)                                       AS ATT11, --Activity Date" ).append("\n"); 
		query.append("                      A.AR_OFC_CD                                                        AS ATT12, --Activity Place " ).append("\n"); 
		query.append("                      ''                                                                 AS ATT13," ).append("\n"); 
		query.append("                      'COM'                                                       		 AS ATT14, --Service Lane" ).append("\n"); 
		query.append("                      ''                                                                 AS ATT15," ).append("\n"); 
		query.append("                      ''                                                                 AS BKG_NO," ).append("\n"); 
		query.append("                      ''                                                                 AS TPSZ," ).append("\n"); 
		query.append("                      '0000000000'                                                       AS REV_VVD," ).append("\n"); 
		query.append("                      'C'                                                                AS DIV_CD," ).append("\n"); 
		query.append("                      ''                                                                 AS CARRIER," ).append("\n"); 
		query.append("                      ''                                                                 AS YARD," ).append("\n"); 
		query.append("                      ''                                                                 AS COST_CODE," ).append("\n"); 
		query.append("                      0                                                                  AS QTY," ).append("\n"); 
		query.append("                      ''                                                                 AS TMNL_CD," ).append("\n"); 
		query.append("                      A.AGN_CD AGNT," ).append("\n"); 
		query.append("                      A.OFC_CHR_CD SUB_FLG," ).append("\n"); 
		query.append("                      A.CSR_NO CSR_NO" ).append("\n"); 
		query.append("                 FROM ACM_AGN_COMM A," ).append("\n"); 
		query.append("                      ACM_AGN_COMM_DTL B," ).append("\n"); 
		query.append("                      MDM_CURRENCY M" ).append("\n"); 
		query.append("                WHERE A.AR_OFC_CD         = @[ar_ofc_cd]" ).append("\n"); 
		query.append("                  AND A.AGN_CD            = @[agn_cd]" ).append("\n"); 
		query.append("                  AND (SELECT SUBSTR(LOC_CD, 1, 2)  " ).append("\n"); 
		query.append("  						 FROM MDM_ORGANIZATION M " ).append("\n"); 
		query.append("						WHERE M.OFC_CD = A.AR_OFC_CD) <> 'JP' " ).append("\n"); 
		query.append("                  AND A.IF_DT         IS NULL" ).append("\n"); 
		query.append("                  AND A.AC_STS_CD  = 'AS'" ).append("\n"); 
		query.append("				#if(${aud_no} != '')" ).append("\n"); 
		query.append("                  AND A.AUD_NO" ).append("\n"); 
		query.append("                   IN" ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                      ${aud_no}" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("				#end" ).append("\n"); 
		query.append("                  AND A.AUD_NO     IS NOT NULL" ).append("\n"); 
		query.append("                  AND A.INV_TAX_RT       >  0" ).append("\n"); 
		query.append("                  AND A.BKG_NO            = B.BKG_NO(+)" ).append("\n"); 
		query.append("                  AND A.AGN_CD            = B.AGN_CD(+)" ).append("\n"); 
		query.append("                  AND A.IO_BND_CD         = B.IO_BND_CD(+)" ).append("\n"); 
		query.append("                  AND A.AC_TP_CD          = B.AC_TP_CD(+)" ).append("\n"); 
		query.append("                  AND B.AC_SEQ  IN (A.AC_SEQ, A.AC_SEQ+1000)" ).append("\n"); 
		query.append("                  AND A.CURR_CD           = M.CURR_CD" ).append("\n"); 
		query.append("                  AND M.DELT_FLG          = 'N'      " ).append("\n"); 
		query.append("             GROUP BY A.CURR_CD," ).append("\n"); 
		query.append("                      M.DP_PRCS_KNT," ).append("\n"); 
		query.append("                      VNDR_SEQ," ).append("\n"); 
		query.append("                      A.AUD_NO,--NVL (A.INV_NO, A.AUD_NO)," ).append("\n"); 
		query.append("                      --A.OTR_COMM_ACCT_CTNT," ).append("\n"); 
		query.append("                      TO_CHAR(GLOBALDATE_PKG.TIME_CONV_FNC('KRPUS', SYSDATE, A.AC_OCCR_INFO_CD), 'YYYYMMDD')," ).append("\n"); 
		query.append("                      A.AC_OCCR_INFO_CD," ).append("\n"); 
		query.append("                      A.AGN_CD," ).append("\n"); 
		query.append("                      A.OFC_CHR_CD," ).append("\n"); 
		query.append("                      A.CSR_NO," ).append("\n"); 
		query.append("                      A.AR_OFC_CD," ).append("\n"); 
		query.append("                      A.AC_SLAN_CD," ).append("\n"); 
		query.append("                      A.SAIL_ARR_DT" ).append("\n"); 
		query.append("               HAVING SUM (NVL (B.PAY_IF_DTRB_AMT*A.INV_TAX_RT, A.IF_AMT*A.INV_TAX_RT)) <> 0" ).append("\n"); 
		query.append("            UNION ALL /* VAT JP*/" ).append("\n"); 
		query.append("               SELECT" ).append("\n"); 
		query.append("                      A.VNDR_SEQ                                                         AS VNDR," ).append("\n"); 
		query.append("                      'TAX'                                                             AS LOOKUP," ).append("\n"); 
		query.append("                      ROUND (SUM (NVL (B.PAY_IF_DTRB_AMT*NVL(A.INV_TAX_RT, 0)/100, A.PAY_IF_AMT*NVL (A.INV_TAX_RT, 0)/100)), M.DP_PRCS_KNT) AS INV_AMT,  " ).append("\n"); 
		query.append("                      A.AUD_NO" ).append("\n"); 
		query.append("                   || ' '" ).append("\n"); 
		query.append("                   /*|| A.OTR_COMM_ACCT_CTNT*/                                           AS INV_DESC," ).append("\n"); 
		query.append("                      'E3'                                                           	 AS TAX_CD," ).append("\n"); 
		query.append("                      '01'                                                               AS company," ).append("\n"); 
		query.append("                      @[finc_rgn_cd]                                                     AS REGION," ).append("\n"); 
		query.append("                      @[ap_ctr_cd]                                                       AS CENTER," ).append("\n"); 
		query.append("                      '111811'                                                           AS ACCT," ).append("\n"); 
		query.append("                      '0000000000'                                                       AS VVD," ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                                 NVL(LTRIM(SUBS_CO_CD), '00')" ).append("\n"); 
		query.append("                            FROM MDM_VENDOR" ).append("\n"); 
		query.append("                           WHERE VNDR_SEQ = A.VNDR_SEQ" ).append("\n"); 
		query.append("                    )                                                                    AS INTR_CMPY," ).append("\n"); 
		query.append("                      '000000'                                                           AS FUTURE1," ).append("\n"); 
		query.append("                      '000000'                                                           AS FUTURE2," ).append("\n"); 
		query.append("                      '111811'                                                           AS ATT_CTLG," ).append("\n"); 
		query.append("                      A.AUD_NO                                        		             AS ATT1,--NVL (A.INV_NO, A.AUD_NO)" ).append("\n"); 
		query.append("                      SUBSTR (@[gl_dt], 0, 4)" ).append("\n"); 
		query.append("                   || '/'" ).append("\n"); 
		query.append("                   || SUBSTR (@[gl_dt], 5, 2)" ).append("\n"); 
		query.append("                   || '/'" ).append("\n"); 
		query.append("                   || SUBSTR (@[gl_dt], 7, 2)" ).append("\n"); 
		query.append("                   || ' 00:00:00'                                                        AS ATT2," ).append("\n"); 
		query.append("                      A.AC_OCCR_INFO_CD                                                  AS ATT3," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT4," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT5," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT6," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT7," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT8," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT9," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT10," ).append("\n"); 
		query.append("                      NVL(@[gl_dt], A.SAIL_ARR_DT)                                       AS ATT11, --Activity Date" ).append("\n"); 
		query.append("                      A.AR_OFC_CD                                                        AS ATT12, --Activity Place " ).append("\n"); 
		query.append("                      ''                                                                 AS ATT13," ).append("\n"); 
		query.append("                      'COM'                                                       		 AS ATT14, --Service Lane" ).append("\n"); 
		query.append("                      ''                                                                 AS ATT15," ).append("\n"); 
		query.append("                      ''                                                                 AS BKG_NO," ).append("\n"); 
		query.append("                      ''                                                                 AS TPSZ," ).append("\n"); 
		query.append("                      '0000000000'                                                       AS REV_VVD," ).append("\n"); 
		query.append("                      'C'                                                                AS DIV_CD," ).append("\n"); 
		query.append("                      ''                                                                 AS CARRIER," ).append("\n"); 
		query.append("                      ''                                                                 AS YARD," ).append("\n"); 
		query.append("                      ''                                                                 AS COST_CODE," ).append("\n"); 
		query.append("                      0                                                                  AS QTY," ).append("\n"); 
		query.append("                      ''                                                                 AS TMNL_CD," ).append("\n"); 
		query.append("                      A.AGN_CD AGNT," ).append("\n"); 
		query.append("                      A.OFC_CHR_CD SUB_FLG," ).append("\n"); 
		query.append("                      A.CSR_NO CSR_NO" ).append("\n"); 
		query.append("                 FROM ACM_AGN_COMM A," ).append("\n"); 
		query.append("                      ACM_AGN_COMM_DTL B," ).append("\n"); 
		query.append("                      MDM_CURRENCY  M" ).append("\n"); 
		query.append("                WHERE A.AR_OFC_CD         = @[ar_ofc_cd]" ).append("\n"); 
		query.append("                  AND A.AGN_CD            = @[agn_cd]" ).append("\n"); 
		query.append("                  AND (SELECT SUBSTR(LOC_CD, 1, 2)  " ).append("\n"); 
		query.append("  						 FROM MDM_ORGANIZATION M " ).append("\n"); 
		query.append("						WHERE M.OFC_CD = A.AR_OFC_CD) = 'JP' " ).append("\n"); 
		query.append("                  AND A.IF_DT         IS NULL" ).append("\n"); 
		query.append("                  AND A.AC_STS_CD  = 'AS'" ).append("\n"); 
		query.append("				#if(${aud_no} != '')" ).append("\n"); 
		query.append("                  AND A.AUD_NO" ).append("\n"); 
		query.append("                   IN" ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                      ${aud_no}" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("				#end" ).append("\n"); 
		query.append("                  AND A.AUD_NO     IS NOT NULL" ).append("\n"); 
		query.append("                  AND A.INV_TAX_RT       >  0" ).append("\n"); 
		query.append("                  AND A.BKG_NO            = B.BKG_NO(+)" ).append("\n"); 
		query.append("                  AND A.AGN_CD            = B.AGN_CD(+)" ).append("\n"); 
		query.append("                  AND A.IO_BND_CD         = B.IO_BND_CD(+)" ).append("\n"); 
		query.append("                  AND A.AC_TP_CD          = B.AC_TP_CD(+)" ).append("\n"); 
		query.append("                  AND B.AC_SEQ  IN (A.AC_SEQ, A.AC_SEQ+1000)" ).append("\n"); 
		query.append("                  AND A.CURR_CD           = M.CURR_CD" ).append("\n"); 
		query.append("                  AND M.DELT_FLG          = 'N'   " ).append("\n"); 
		query.append("             GROUP BY A.CURR_CD," ).append("\n"); 
		query.append("                      M.DP_PRCS_KNT," ).append("\n"); 
		query.append("                      VNDR_SEQ," ).append("\n"); 
		query.append("                      A.AUD_NO,--NVL (A.INV_NO, A.AUD_NO)," ).append("\n"); 
		query.append("                      --A.OTR_COMM_ACCT_CTNT," ).append("\n"); 
		query.append("                      TO_CHAR(GLOBALDATE_PKG.TIME_CONV_FNC('KRPUS', SYSDATE, A.AC_OCCR_INFO_CD), 'YYYYMMDD')," ).append("\n"); 
		query.append("                      A.AC_OCCR_INFO_CD," ).append("\n"); 
		query.append("                      A.AGN_CD," ).append("\n"); 
		query.append("                      A.OFC_CHR_CD," ).append("\n"); 
		query.append("                      A.CSR_NO," ).append("\n"); 
		query.append("                      A.AR_OFC_CD," ).append("\n"); 
		query.append("                      A.AC_SLAN_CD," ).append("\n"); 
		query.append("                      A.SAIL_ARR_DT" ).append("\n"); 
		query.append("               HAVING SUM (NVL (B.PAY_IF_DTRB_AMT*A.INV_TAX_RT, A.IF_AMT*A.INV_TAX_RT)) <> 0         " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("         UNION ALL" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("          /* OTHER COMM */" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("               SELECT" ).append("\n"); 
		query.append("                      A.VNDR_SEQ AS VNDR," ).append("\n"); 
		query.append("                      'ITEM' AS LOOKUP," ).append("\n"); 
		query.append("                    ROUND(NVL(A.PAY_IF_AMT, A.IF_AMT), M.DP_PRCS_KNT)                      AS INV_AMT," ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                                 SUBSTR (ACCT_ENG_NM, 1, 39)" ).append("\n"); 
		query.append("                            FROM MDM_ACCOUNT" ).append("\n"); 
		query.append("                           WHERE ACCT_CD = A.COMM_STND_COST_CD" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("                   || ' '" ).append("\n"); 
		query.append("                   || SUBSTR (TRIM (A.OTR_COMM_RMK), 1, 200)                   			 AS INV_DESC," ).append("\n"); 
		query.append("                      ''                                                                 AS TAX_CD," ).append("\n"); 
		query.append("                      '01'  AS CMPY," ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                                 NVL(MAX(FINC_RGN_CD), '00')" ).append("\n"); 
		query.append("                            FROM MDM_ORGANIZATION" ).append("\n"); 
		query.append("                           WHERE OFC_CD = A.AP_OFC_CD" ).append("\n"); 
		query.append("                    )                                                                    AS REGION," ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                                 AP_CTR_CD" ).append("\n"); 
		query.append("                            FROM MDM_ORGANIZATION" ).append("\n"); 
		query.append("                           WHERE OFC_CD = A.AP_OFC_CD" ).append("\n"); 
		query.append("                    )                                                                    AS CENTER," ).append("\n"); 
		query.append("                      A.COMM_STND_COST_CD ACCT," ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                            CASE SUBSTR(C.AC_VSL_CD, 0, 2)" ).append("\n"); 
		query.append("                            WHEN 'FD'" ).append("\n"); 
		query.append("                            THEN 'CFDR'||SUBSTR(C.AC_VSL_CD, 3, 4)||'EE'" ).append("\n"); 
		query.append("                            ELSE C.AC_VSL_CD||C.AC_SKD_VOY_NO||C.AC_SKD_DIR_CD||NVL(C.AC_REV_DIR_CD, C.AC_SKD_DIR_CD)" ).append("\n"); 
		query.append("                             END" ).append("\n"); 
		query.append("                            FROM ACM_AGN_OTR_COMM C" ).append("\n"); 
		query.append("                           WHERE C.OTR_COMM_NO = A.OTR_COMM_NO" ).append("\n"); 
		query.append("                    )                                                                    AS VVD," ).append("\n"); 
		query.append("                    (     SELECT NVL(LTRIM(SUBS_CO_CD), '00')" ).append("\n"); 
		query.append("                            FROM MDM_VENDOR" ).append("\n"); 
		query.append("                           WHERE VNDR_SEQ = A.VNDR_SEQ" ).append("\n"); 
		query.append("                    )                                                                    AS INTR_CMPY," ).append("\n"); 
		query.append("                      '000000'                                                           AS FUTR1," ).append("\n"); 
		query.append("                      '000000'                                                           AS FUTR2," ).append("\n"); 
		query.append("                      A.COMM_STND_COST_CD                                                AS ATT_CTLG," ).append("\n"); 
		query.append("                      A.AUD_NO                                                           AS ATT1,--NVL(A.INV_NO, A.AUD_NO)" ).append("\n"); 
		query.append("                      SUBSTR(@[gl_dt], 0, 4)" ).append("\n"); 
		query.append("                   || '/'" ).append("\n"); 
		query.append("                   || SUBSTR(@[gl_dt], 5, 2)" ).append("\n"); 
		query.append("                   || '/'" ).append("\n"); 
		query.append("                   || SUBSTR(@[gl_dt], 7, 2)" ).append("\n"); 
		query.append("                   || ' 00:00:00'                                                        AS ATT2," ).append("\n"); 
		query.append("                      A.AC_OCCR_INFO_CD                                                AS ATT3," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT4," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT5," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT6," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT7," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT8," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT9," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT10," ).append("\n"); 
		query.append("                      ( SELECT TO_CHAR(MIN(VPS_ETD_DT), 'YYYYMMDD')" ).append("\n"); 
		query.append("                          FROM ACM_AGN_OTR_COMM AOC" ).append("\n"); 
		query.append("                             , VSK_VSL_PORT_SKD SKD" ).append("\n"); 
		query.append("                         WHERE 1=1" ).append("\n"); 
		query.append("                           and AOC.AGN_CD = A.AGN_CD" ).append("\n"); 
		query.append("                           AND AOC.OTR_COMM_NO = A.OTR_COMM_NO" ).append("\n"); 
		query.append("                           AND AOC.AC_VSL_CD      = SKD.VSL_CD" ).append("\n"); 
		query.append("                           AND AOC.AC_SKD_VOY_NO  = SKD.SKD_VOY_NO" ).append("\n"); 
		query.append("                           AND AOC.AC_SKD_DIR_CD  = SKD.SKD_DIR_CD" ).append("\n"); 
		query.append("                           AND NVL(SKD.SKD_CNG_STS_CD,'*') <> 'S'   " ).append("\n"); 
		query.append("                           AND SKD.TURN_PORT_IND_CD IN ('Y','N')" ).append("\n"); 
		query.append("                         GROUP BY VSL_CD, SKD_VOY_NO, SKD_DIR_CD  )                      AS ATT11, --Activity Date" ).append("\n"); 
		query.append("                      A.AR_OFC_CD                                                        AS ATT12, --Activity Place " ).append("\n"); 
		query.append("                      ''                                                                 AS ATT13," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("					  (SELECT MAX(SLAN_CD) " ).append("\n"); 
		query.append("                         FROM AR_MST_REV_VVD" ).append("\n"); 
		query.append("                        WHERE 1=1" ).append("\n"); 
		query.append("                          --AND VSL_CD||SKD_VOY_NO||SKD_DIR_CD||RLANE_DIR_CD IN" ).append("\n"); 
		query.append("                          AND (VSL_CD,SKD_VOY_NO,SKD_DIR_CD,RLANE_DIR_CD) IN" ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                            --CASE SUBSTR(C.AC_VSL_CD, 0, 2)" ).append("\n"); 
		query.append("                            --WHEN 'FD'" ).append("\n"); 
		query.append("                            --THEN 'CFDR'||SUBSTR(C.AC_VSL_CD, 3, 4)||'EE'" ).append("\n"); 
		query.append("                            --ELSE C.AC_VSL_CD||C.AC_SKD_VOY_NO||C.AC_SKD_DIR_CD||NVL(C.AC_REV_DIR_CD, C.AC_SKD_DIR_CD)" ).append("\n"); 
		query.append("                            -- END" ).append("\n"); 
		query.append("                                 CASE WHEN SUBSTR(C.AC_VSL_CD, 1, 2) = 'FD' THEN 'CFDR' ELSE C.AC_VSL_CD END AS VSL_CD" ).append("\n"); 
		query.append("                               , CASE WHEN SUBSTR(C.AC_VSL_CD, 1, 2) = 'FD' THEN SUBSTR(C.AC_VSL_CD, 3, 4) ELSE C.AC_SKD_VOY_NO END AS SKD_VOY_NO" ).append("\n"); 
		query.append("                               , CASE WHEN SUBSTR(C.AC_VSL_CD, 1, 2) = 'FD' THEN 'E' ELSE C.AC_SKD_DIR_CD END AS SKD_DIR_CD" ).append("\n"); 
		query.append("                               , CASE WHEN SUBSTR(C.AC_VSL_CD, 1, 2) = 'FD' THEN 'E' ELSE NVL(C.AC_REV_DIR_CD, C.AC_SKD_DIR_CD) END AS RLANE_DIR_CD" ).append("\n"); 
		query.append("                            FROM ACM_AGN_OTR_COMM C" ).append("\n"); 
		query.append("                           WHERE C.OTR_COMM_NO = A.OTR_COMM_NO" ).append("\n"); 
		query.append("                    )  " ).append("\n"); 
		query.append("                                                                                                                                          )   AS ATT14, --Service Lane" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                      ''                                                                 AS ATT15," ).append("\n"); 
		query.append("                      A.OTR_COMM_NO," ).append("\n"); 
		query.append("                      'BX'                                                     AS TPSZ," ).append("\n"); 
		query.append("                 CASE A.AC_SLAN_CD||SUBSTR(A.AC_VSL_CD, 0, 2)" ).append("\n"); 
		query.append("                 WHEN 'RBCFD'" ).append("\n"); 
		query.append("                 THEN 'CFDR'" ).append("\n"); 
		query.append("                   || SUBSTR (A.AC_VSL_CD, 3, 2)" ).append("\n"); 
		query.append("                   || SUBSTR (AC_SKD_VOY_NO, 0, 2)" ).append("\n"); 
		query.append("                   || 'EE'" ).append("\n"); 
		query.append("                 ELSE A.AC_VSL_CD" ).append("\n"); 
		query.append("                   || A.AC_SKD_VOY_NO" ).append("\n"); 
		query.append("                   || A.AC_SKD_DIR_CD" ).append("\n"); 
		query.append("                   || NVL(A.AC_REV_DIR_CD, A.AC_SKD_DIR_CD)" ).append("\n"); 
		query.append("                  END                                                                    AS REV_VVD," ).append("\n"); 
		query.append("                      'C'                                                                AS DIV_CD," ).append("\n"); 
		query.append("                      ''                                                                 AS CARRIER," ).append("\n"); 
		query.append("                      ''                                                                 AS YARD," ).append("\n"); 
		query.append("                      ''                                                                 AS COST_CODE," ).append("\n"); 
		query.append("                      1 QTY," ).append("\n"); 
		query.append("                      ''                                                                 AS TMNL_CD," ).append("\n"); 
		query.append("                      A.AGN_CD AGNT," ).append("\n"); 
		query.append("                      A.OFC_CHR_CD                                                       AS SUB_FLG," ).append("\n"); 
		query.append("                      A.CSR_NO                                                           AS CSR_NO" ).append("\n"); 
		query.append("                 FROM ACM_AGN_OTR_COMM     A," ).append("\n"); 
		query.append("                      MDM_CURRENCY         M" ).append("\n"); 
		query.append("                WHERE A.AR_OFC_CD         = @[ar_ofc_cd]" ).append("\n"); 
		query.append("                  AND A.AGN_CD            = @[agn_cd]" ).append("\n"); 
		query.append("                  AND A.IF_DT         IS NULL" ).append("\n"); 
		query.append("                  AND A.AC_STS_CD  = 'AS'" ).append("\n"); 
		query.append("				#if(${aud_no} != '')" ).append("\n"); 
		query.append("                  AND A.AUD_NO " ).append("\n"); 
		query.append("                   IN" ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                      ${aud_no}" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("				#end" ).append("\n"); 
		query.append("                  AND A.AUD_NO     IS NOT NULL" ).append("\n"); 
		query.append("				  AND A.CURR_CD     = M.CURR_CD" ).append("\n"); 
		query.append("				  AND M.DELT_FLG    = 'N'    " ).append("\n"); 
		query.append("            UNION ALL /* 상계정산 대리점 */" ).append("\n"); 
		query.append("               SELECT" ).append("\n"); 
		query.append("                      A.VNDR_SEQ AS VNDR," ).append("\n"); 
		query.append("                      'ITEM' AS LOOKUP," ).append("\n"); 
		query.append("                    SUM (-ROUND(NVL(A.PAY_IF_AMT, A.IF_AMT), M.DP_PRCS_KNT))               AS INV_AMT," ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                                 SUBSTR (ACCT_ENG_NM, 1, 39)" ).append("\n"); 
		query.append("                            FROM MDM_ACCOUNT" ).append("\n"); 
		query.append("                           WHERE ACCT_CD = '954113'" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("                   || ' '" ).append("\n"); 
		query.append("                   || SUBSTR (TRIM (A.OTR_COMM_RMK), 1, 200)                   AS INV_DESC," ).append("\n"); 
		query.append("                      ''                                                                 AS TAX_CD," ).append("\n"); 
		query.append("                      '01'                                                               AS CMPY," ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                                 NVL(MAX(FINC_RGN_CD), '00')" ).append("\n"); 
		query.append("                            FROM MDM_ORGANIZATION" ).append("\n"); 
		query.append("                           WHERE OFC_CD = A.AP_OFC_CD" ).append("\n"); 
		query.append("                    )                                                                    AS REGION," ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                                 AP_CTR_CD" ).append("\n"); 
		query.append("                            FROM MDM_ORGANIZATION" ).append("\n"); 
		query.append("                           WHERE OFC_CD = A.AP_OFC_CD" ).append("\n"); 
		query.append("                    )                                                                    AS CENTER," ).append("\n"); 
		query.append("                      '954113'                                                           AS ACCT," ).append("\n"); 
		query.append("                      '0000000000'                                                       AS VVD," ).append("\n"); 
		query.append("                    (     SELECT NVL(LTRIM(SUBS_CO_CD), '00')" ).append("\n"); 
		query.append("                            FROM MDM_VENDOR" ).append("\n"); 
		query.append("                           WHERE VNDR_SEQ = A.VNDR_SEQ" ).append("\n"); 
		query.append("                    )                                                                    AS INTR_CMPY," ).append("\n"); 
		query.append("                      '000000'                                                           AS FUTR1," ).append("\n"); 
		query.append("                      '000000'                                                           AS FUTR2," ).append("\n"); 
		query.append("                      '954113' AS ATT_CTLG," ).append("\n"); 
		query.append("                      A.AUD_NO                                                           AS ATT1," ).append("\n"); 
		query.append("                      SUBSTR(@[gl_dt], 0, 4)" ).append("\n"); 
		query.append("                   || '/'" ).append("\n"); 
		query.append("                   || SUBSTR(@[gl_dt], 5, 2)" ).append("\n"); 
		query.append("                   || '/'" ).append("\n"); 
		query.append("                   || SUBSTR(@[gl_dt], 7, 2)" ).append("\n"); 
		query.append("                   || ' 00:00:00'                                                        AS ATT2," ).append("\n"); 
		query.append("                      A.AC_OCCR_INFO_CD                                                  AS ATT3," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT4," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT5," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT6," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT7," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT8," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT9," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT10," ).append("\n"); 
		query.append("					(SELECT ASA_PRD_TO_DT " ).append("\n"); 
		query.append("   					   FROM SAR_ASA_MST" ).append("\n"); 
		query.append("					  WHERE ASA_NO = @[asa_no])                                          AS ATT11, --Activity Date" ).append("\n"); 
		query.append("                      A.AR_OFC_CD                                                        AS ATT12, --Activity Place " ).append("\n"); 
		query.append("                      ''                                                                 AS ATT13," ).append("\n"); 
		query.append("                      'COM'                                                       		 AS ATT14, --Service Lane" ).append("\n"); 
		query.append("                      ''                                                                 AS ATT15," ).append("\n"); 
		query.append("                      ''                                                                 AS BKG_NO," ).append("\n"); 
		query.append("                      ''                                                                 AS TPSZ," ).append("\n"); 
		query.append("                      ''                                                                 AS REV_VVD," ).append("\n"); 
		query.append("                      ''                                                                 AS DIV_CD," ).append("\n"); 
		query.append("                      ''                                                                 AS CARRIER," ).append("\n"); 
		query.append("                      ''                                                                 AS YARD," ).append("\n"); 
		query.append("                      ''                                                                 AS COST_CODE," ).append("\n"); 
		query.append("                      0                                                                  AS QTY," ).append("\n"); 
		query.append("                      ''                                                                 AS TMNL_CD," ).append("\n"); 
		query.append("                      A.AGN_CD                                                           AS AGNT," ).append("\n"); 
		query.append("                      A.OFC_CHR_CD                                                      AS SUB_FLG," ).append("\n"); 
		query.append("                      A.CSR_NO                                                           AS CSR_NO" ).append("\n"); 
		query.append("                 FROM ACM_AGN_OTR_COMM     A," ).append("\n"); 
		query.append("                      MDM_CURRENCY         M" ).append("\n"); 
		query.append("                WHERE A.AR_OFC_CD         = @[ar_ofc_cd]" ).append("\n"); 
		query.append("                  AND A.AGN_CD            = @[agn_cd]" ).append("\n"); 
		query.append("                  AND A.IF_DT         IS NULL" ).append("\n"); 
		query.append("                  AND A.AC_STS_CD  = 'AS'" ).append("\n"); 
		query.append("				#if(${aud_no} != '')" ).append("\n"); 
		query.append("                  AND A.AUD_NO " ).append("\n"); 
		query.append("                   IN" ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                      ${aud_no}" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("				#end" ).append("\n"); 
		query.append("                  AND A.AUD_NO     IS NOT NULL" ).append("\n"); 
		query.append("                  AND 'O'" ).append("\n"); 
		query.append("                   IN" ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                                 SO_IF_CD" ).append("\n"); 
		query.append("                            FROM MDM_ORGANIZATION" ).append("\n"); 
		query.append("                           WHERE OFC_CD = A.AGN_CD" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("                  AND A.CURR_CD = M.CURR_CD" ).append("\n"); 
		query.append("                  AND M.DELT_FLG = 'N'  " ).append("\n"); 
		query.append("             GROUP BY A.VNDR_SEQ," ).append("\n"); 
		query.append("                      A.AP_OFC_CD," ).append("\n"); 
		query.append("                      A.AUD_NO," ).append("\n"); 
		query.append("                      A.AC_OCCR_INFO_CD," ).append("\n"); 
		query.append("                      A.AGN_CD," ).append("\n"); 
		query.append("                      A.OFC_CHR_CD," ).append("\n"); 
		query.append("                      A.CSR_NO," ).append("\n"); 
		query.append("                      A.OTR_COMM_RMK," ).append("\n"); 
		query.append("                      A.AR_OFC_CD," ).append("\n"); 
		query.append("                      A.AC_SLAN_CD" ).append("\n"); 
		query.append("            UNION ALL /* VAT */" ).append("\n"); 
		query.append("               SELECT" ).append("\n"); 
		query.append("                      A.VNDR_SEQ                                                         AS VNDR," ).append("\n"); 
		query.append("                      'ITEM'                                                             AS LOOKUP," ).append("\n"); 
		query.append("                      ROUND (SUM (NVL (A.PAY_IF_AMT*NVL(A.INV_TAX_RT, 0)/100, A.PAY_IF_AMT*NVL (A.INV_TAX_RT, 0)/100)), M.DP_PRCS_KNT) AS INV_AMT, " ).append("\n"); 
		query.append("                      A.AUD_NO" ).append("\n"); 
		query.append("                   || ' '" ).append("\n"); 
		query.append("                   || A.OTR_COMM_RMK                                           AS INV_DESC," ).append("\n"); 
		query.append("                      ''                                                           AS TAX_CD," ).append("\n"); 
		query.append("                      '01'                                                               AS company," ).append("\n"); 
		query.append("                      @[finc_rgn_cd]                                                       AS REGION," ).append("\n"); 
		query.append("                      @[ap_ctr_cd]                                                       AS CENTER," ).append("\n"); 
		query.append("                      '111821'                                                           AS ACCT," ).append("\n"); 
		query.append("                      '0000000000'                                                       AS VVD," ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                                 NVL(LTRIM(SUBS_CO_CD), '00')" ).append("\n"); 
		query.append("                            FROM MDM_VENDOR" ).append("\n"); 
		query.append("                           WHERE VNDR_SEQ = A.VNDR_SEQ" ).append("\n"); 
		query.append("                    )                                                                    AS INTR_CMPY," ).append("\n"); 
		query.append("                      '000000'                                                           AS FUTURE1," ).append("\n"); 
		query.append("                      '000000'                                                           AS FUTURE2," ).append("\n"); 
		query.append("                      '111821'                                                           AS ATT_CTLG," ).append("\n"); 
		query.append("                      A.AUD_NO                                        		             AS ATT1,--NVL (A.INV_NO, A.AUD_NO)" ).append("\n"); 
		query.append("                      SUBSTR (@[gl_dt], 0, 4)" ).append("\n"); 
		query.append("                   || '/'" ).append("\n"); 
		query.append("                   || SUBSTR (@[gl_dt], 5, 2)" ).append("\n"); 
		query.append("                   || '/'" ).append("\n"); 
		query.append("                   || SUBSTR (@[gl_dt], 7, 2)" ).append("\n"); 
		query.append("                   || ' 00:00:00'                                                        AS ATT2," ).append("\n"); 
		query.append("                      A.AC_OCCR_INFO_CD                                                  AS ATT3," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT4," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT5," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT6," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT7," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT8," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT9," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT10," ).append("\n"); 
		query.append("                      @[gl_dt]                      									 AS ATT11, --Activity Date" ).append("\n"); 
		query.append("                      A.AR_OFC_CD                                                        AS ATT12, --Activity Place " ).append("\n"); 
		query.append("                      ''                                                                 AS ATT13," ).append("\n"); 
		query.append("                      'COM'                                                       		 AS ATT14, --Service Lane" ).append("\n"); 
		query.append("                      ''                                                                 AS ATT15," ).append("\n"); 
		query.append("                      ''                                                                 AS BKG_NO," ).append("\n"); 
		query.append("                      ''                                                                 AS TPSZ," ).append("\n"); 
		query.append("                      '0000000000'                                                       AS REV_VVD," ).append("\n"); 
		query.append("                      'C'                                                                AS DIV_CD," ).append("\n"); 
		query.append("                      ''                                                                 AS CARRIER," ).append("\n"); 
		query.append("                      ''                                                                 AS YARD," ).append("\n"); 
		query.append("                      ''                                                                 AS COST_CODE," ).append("\n"); 
		query.append("                      0                                                                  AS QTY," ).append("\n"); 
		query.append("                      ''                                                                 AS TMNL_CD," ).append("\n"); 
		query.append("                      A.AGN_CD AGNT," ).append("\n"); 
		query.append("                      A.OFC_CHR_CD SUB_FLG," ).append("\n"); 
		query.append("                      A.CSR_NO CSR_NO" ).append("\n"); 
		query.append("                 FROM ACM_AGN_OTR_COMM A," ).append("\n"); 
		query.append("                      MDM_CURRENCY     M" ).append("\n"); 
		query.append("                WHERE A.AR_OFC_CD         = @[ar_ofc_cd]" ).append("\n"); 
		query.append("                  AND A.AGN_CD            = @[agn_cd]" ).append("\n"); 
		query.append("                  AND (SELECT SUBSTR(LOC_CD, 1, 2)  " ).append("\n"); 
		query.append("  						 FROM MDM_ORGANIZATION M " ).append("\n"); 
		query.append("						WHERE M.OFC_CD = A.AR_OFC_CD) <> 'JP'               " ).append("\n"); 
		query.append("                  AND A.IF_DT         IS NULL" ).append("\n"); 
		query.append("                  AND A.AC_STS_CD  = 'AS'" ).append("\n"); 
		query.append("				#if(${aud_no} != '')" ).append("\n"); 
		query.append("                  AND A.AUD_NO " ).append("\n"); 
		query.append("                   IN" ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                      ${aud_no}" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("				#end" ).append("\n"); 
		query.append("                  AND A.AUD_NO     IS NOT NULL" ).append("\n"); 
		query.append("                  AND A.INV_TAX_RT       >  0" ).append("\n"); 
		query.append("                  AND A.CURR_CD = M.CURR_CD" ).append("\n"); 
		query.append("                  AND M.DELT_FLG = 'N'" ).append("\n"); 
		query.append("             GROUP BY A.CURR_CD," ).append("\n"); 
		query.append("                      M.DP_PRCS_KNT," ).append("\n"); 
		query.append("                      VNDR_SEQ," ).append("\n"); 
		query.append("                      A.AUD_NO,--NVL (A.INV_NO, A.AUD_NO)," ).append("\n"); 
		query.append("                      A.OTR_COMM_RMK," ).append("\n"); 
		query.append("                      TO_CHAR(GLOBALDATE_PKG.TIME_CONV_FNC('KRPUS', SYSDATE, A.AC_OCCR_INFO_CD), 'YYYYMMDD')," ).append("\n"); 
		query.append("                      A.AC_OCCR_INFO_CD," ).append("\n"); 
		query.append("                      A.AGN_CD," ).append("\n"); 
		query.append("                      A.OFC_CHR_CD," ).append("\n"); 
		query.append("                      A.CSR_NO," ).append("\n"); 
		query.append("                      A.AR_OFC_CD," ).append("\n"); 
		query.append("                      A.AC_SLAN_CD" ).append("\n"); 
		query.append("               HAVING SUM (NVL (A.PAY_IF_AMT*A.INV_TAX_RT, A.IF_AMT*A.INV_TAX_RT)) <> 0" ).append("\n"); 
		query.append("            UNION ALL /* VAT JP*/" ).append("\n"); 
		query.append("               SELECT" ).append("\n"); 
		query.append("                      A.VNDR_SEQ                                                         AS VNDR," ).append("\n"); 
		query.append("                      'TAX'                                                             AS LOOKUP," ).append("\n"); 
		query.append("                      ROUND (SUM (NVL (A.PAY_IF_AMT*NVL(A.INV_TAX_RT, 0)/100, A.PAY_IF_AMT*NVL (A.INV_TAX_RT, 0)/100)), M.DP_PRCS_KNT) AS INV_AMT,  " ).append("\n"); 
		query.append("                      A.AUD_NO" ).append("\n"); 
		query.append("                   || ' '" ).append("\n"); 
		query.append("                   || A.OTR_COMM_RMK                                          			 AS INV_DESC," ).append("\n"); 
		query.append("                      'E3'                                                           	 AS TAX_CD," ).append("\n"); 
		query.append("                      '01'                                                               AS company," ).append("\n"); 
		query.append("                      @[finc_rgn_cd]                                                     AS REGION," ).append("\n"); 
		query.append("                      @[ap_ctr_cd]                                                       AS CENTER," ).append("\n"); 
		query.append("                      '111811'                                                           AS ACCT," ).append("\n"); 
		query.append("                      '0000000000'                                                       AS VVD," ).append("\n"); 
		query.append("                    (     SELECT" ).append("\n"); 
		query.append("                                 NVL(LTRIM(SUBS_CO_CD), '00')" ).append("\n"); 
		query.append("                            FROM MDM_VENDOR" ).append("\n"); 
		query.append("                           WHERE VNDR_SEQ = A.VNDR_SEQ" ).append("\n"); 
		query.append("                    )                                                                    AS INTR_CMPY," ).append("\n"); 
		query.append("                      '000000'                                                           AS FUTURE1," ).append("\n"); 
		query.append("                      '000000'                                                           AS FUTURE2," ).append("\n"); 
		query.append("                      '111811'                                                           AS ATT_CTLG," ).append("\n"); 
		query.append("                      A.AUD_NO                                        		             AS ATT1,--NVL (A.INV_NO, A.AUD_NO)" ).append("\n"); 
		query.append("                      SUBSTR (@[gl_dt], 0, 4)" ).append("\n"); 
		query.append("                   || '/'" ).append("\n"); 
		query.append("                   || SUBSTR (@[gl_dt], 5, 2)" ).append("\n"); 
		query.append("                   || '/'" ).append("\n"); 
		query.append("                   || SUBSTR (@[gl_dt], 7, 2)" ).append("\n"); 
		query.append("                   || ' 00:00:00'                                                        AS ATT2," ).append("\n"); 
		query.append("                      A.AC_OCCR_INFO_CD                                                  AS ATT3," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT4," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT5," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT6," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT7," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT8," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT9," ).append("\n"); 
		query.append("                      ''                                                                 AS ATT10," ).append("\n"); 
		query.append("                      @[gl_dt]                      									 AS ATT11, --Activity Date" ).append("\n"); 
		query.append("                      A.AR_OFC_CD                                                        AS ATT12, --Activity Place " ).append("\n"); 
		query.append("                      ''                                                                 AS ATT13," ).append("\n"); 
		query.append("                      'COM'                                                       		 AS ATT14, --Service Lane" ).append("\n"); 
		query.append("                      ''                                                                 AS ATT15," ).append("\n"); 
		query.append("                      ''                                                                 AS BKG_NO," ).append("\n"); 
		query.append("                      ''                                                                 AS TPSZ," ).append("\n"); 
		query.append("                      '0000000000'                                                       AS REV_VVD," ).append("\n"); 
		query.append("                      'C'                                                                AS DIV_CD," ).append("\n"); 
		query.append("                      ''                                                                 AS CARRIER," ).append("\n"); 
		query.append("                      ''                                                                 AS YARD," ).append("\n"); 
		query.append("                      ''                                                                 AS COST_CODE," ).append("\n"); 
		query.append("                      0                                                                  AS QTY," ).append("\n"); 
		query.append("                      ''                                                                 AS TMNL_CD," ).append("\n"); 
		query.append("                      A.AGN_CD AGNT," ).append("\n"); 
		query.append("                      A.OFC_CHR_CD SUB_FLG," ).append("\n"); 
		query.append("                      A.CSR_NO CSR_NO" ).append("\n"); 
		query.append("                 FROM ACM_AGN_OTR_COMM A," ).append("\n"); 
		query.append("                      MDM_CURRENCY     M" ).append("\n"); 
		query.append("                WHERE A.AR_OFC_CD         = @[ar_ofc_cd]" ).append("\n"); 
		query.append("                  AND A.AGN_CD            = @[agn_cd]" ).append("\n"); 
		query.append("                  AND (SELECT SUBSTR(LOC_CD, 1, 2)  " ).append("\n"); 
		query.append("  						 FROM MDM_ORGANIZATION M " ).append("\n"); 
		query.append("						WHERE M.OFC_CD = A.AR_OFC_CD) = 'JP'                " ).append("\n"); 
		query.append("                  AND A.IF_DT         IS NULL" ).append("\n"); 
		query.append("                  AND A.AC_STS_CD  = 'AS'" ).append("\n"); 
		query.append("				#if(${aud_no} != '')" ).append("\n"); 
		query.append("                  AND A.AUD_NO " ).append("\n"); 
		query.append("                   IN" ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                      ${aud_no}" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("				#end" ).append("\n"); 
		query.append("                  AND A.AUD_NO     IS NOT NULL" ).append("\n"); 
		query.append("                  AND A.INV_TAX_RT       >  0" ).append("\n"); 
		query.append("                  AND A.CURR_CD = M.CURR_CD" ).append("\n"); 
		query.append("                  AND M.DELT_FLG = 'N'" ).append("\n"); 
		query.append("             GROUP BY A.CURR_CD," ).append("\n"); 
		query.append("                      M.DP_PRCS_KNT," ).append("\n"); 
		query.append("                      VNDR_SEQ," ).append("\n"); 
		query.append("                      A.AUD_NO,--NVL (A.INV_NO, A.AUD_NO)," ).append("\n"); 
		query.append("                      A.OTR_COMM_RMK," ).append("\n"); 
		query.append("                      TO_CHAR(GLOBALDATE_PKG.TIME_CONV_FNC('KRPUS', SYSDATE, A.AC_OCCR_INFO_CD), 'YYYYMMDD')," ).append("\n"); 
		query.append("                      A.AC_OCCR_INFO_CD," ).append("\n"); 
		query.append("                      A.AGN_CD," ).append("\n"); 
		query.append("                      A.OFC_CHR_CD," ).append("\n"); 
		query.append("                      A.CSR_NO," ).append("\n"); 
		query.append("                      A.AR_OFC_CD," ).append("\n"); 
		query.append("                      A.AC_SLAN_CD" ).append("\n"); 
		query.append("               HAVING SUM (NVL (A.PAY_IF_AMT*A.INV_TAX_RT, A.IF_AMT*A.INV_TAX_RT)) <> 0               " ).append("\n"); 
		query.append("         ) X," ).append("\n"); 
		query.append("         (" ).append("\n"); 
		query.append("               SELECT" ).append("\n"); 
		query.append("                      CSR_NO," ).append("\n"); 
		query.append("                      VNDR_NO " ).append("\n"); 
		query.append("                 FROM AP_INV_HDR" ).append("\n"); 
		query.append("                WHERE CSR_NO = @[csr_no]" ).append("\n"); 
		query.append("         ) Y" ).append("\n"); 
		query.append("     WHERE X.CSR_NO = Y.CSR_NO" ).append("\n"); 
		query.append("       AND X.VNDR   = Y.VNDR_NO " ).append("\n"); 

	}
}