<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AGTCommDBDAODeductionTotalVORSQL">
			<desc><![CDATA[ESM_AGT_0012 화면의 Total 조회]]></desc>
			<sql><![CDATA[
SELECT 
	CURR_CD,
	CHG_AMT
FROM(
	SELECT 
		'1' SEQ,
		CURR_CD,
		SUM(ROUND(CHG_AMT,2)) AS CHG_AMT
	FROM BKG_CHG_RT
	WHERE BKG_NO = @[bkg_no]
	AND FRT_INCL_XCLD_DIV_CD =	'N'
	GROUP BY CURR_CD
	UNION
	SELECT 
		'2' SEQ,
		'Gross Rev(USD)' AS CURR,
  	    ROUND(SUM(A.CHG_AMT/DECODE(A.CURR_CD,'USD',1,NVL(B.USD_LOCL_XCH_RT,0))),2)  AS CHG_AMT_RT
	FROM 	BKG_CHG_RT A, 
			GL_MON_XCH_RT B,
			(
				SELECT 
					DECODE(SIGN(TO_NUMBER(NVL(MAX(SUBSTR(SAIL_ARR_DT,1,6)),TO_CHAR(SYSDATE,'YYYYMM')))-TO_NUMBER(TO_CHAR(SYSDATE,'YYYYMM'))),1,TO_CHAR(ADD_MONTHS(TO_DATE(MAX(SAIL_ARR_DT),'YYYYMMDD'),-1),'YYYYMM'), NVL(MAX(SUBSTR(SAIL_ARR_DT,1,6)),TO_CHAR(SYSDATE,'YYYYMM'))) AS SA_DT
				FROM AGT_AGN_COMM
				WHERE BKG_NO = @[bkg_no]
				AND AGN_CD = @[agn_cd]
				AND IO_BND_CD = @[io_bnd_cd]
				AND AC_SEQ = @[ac_seq]
			) C
	WHERE A.BKG_NO			= @[bkg_no]
	AND A.FRT_INCL_XCLD_DIV_CD	= 'N'
	AND A.CURR_CD		= B.CURR_CD
	AND B.ACCT_XCH_RT_YRMON = C.SA_DT
	AND B.ACCT_XCH_RT_LVL = '1'
	ORDER BY SEQ ASC
	)			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="Y"/>
				<param name="agn_cd" type="12" value="" out="Y"/>
				<param name="io_bnd_cd" type="12" value="" out="Y"/>
				<param name="ac_seq" type="12" value="" out="Y"/>
			</params>
		</query>
	</querys>
</sqls>
