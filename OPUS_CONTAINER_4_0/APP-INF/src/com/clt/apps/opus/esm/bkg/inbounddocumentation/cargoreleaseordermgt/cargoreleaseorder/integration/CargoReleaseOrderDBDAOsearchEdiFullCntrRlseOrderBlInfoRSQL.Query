<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CargoReleaseOrderDBDAOsearchEdiFullCntrRlseOrderBlInfoRSQL">
			<desc><![CDATA[searchEdiFullCntrRlseOrderBlInfo]]></desc>
			<sql><![CDATA[
SELECT  CHR(10) ||
       'BKGNBR:'          || BKGM.BKG_NO                                  || CHR(10) || 
       'RELREF:'          || @[cntr_no]                                             || CHR(10) ||
       'BRAC:'            || @[cxl_flg]                                             || CHR(10) ||
       'BL_NO:'           || BKGM.BL_NO                                             || CHR(10) ||
       'HAULAGE_IND:'     || NVL(BET.HLG_TP_CD,DECODE(BKGM.DE_TERM_CD,'D','C','M')) || CHR(10) ||
       'TOVSL:'           || BVVD.VSL_CD                                            || CHR(10) ||  
       'LOYD:'            || VSL.LLOYD_NO                                           || CHR(10) ||      
       'VSLNAME:'         || VSL.VSL_ENG_NM                                         || CHR(10) || 
       'VSL_CALL_SIGN:'   || VSL.CALL_SGN_NO                                        || CHR(10) ||    
       'TOVOY:'           || BVVD.SKD_VOY_NO                                        || CHR(10) ||
       'TODIR:'           || BVVD.SKD_DIR_CD                                        || CHR(10) ||
       'CONSORT_VOY:'     || NVL(VSK.IB_CSSM_VOY_NO, ' ')                           || CHR(10) ||
       'POR_NAME:'        || NVL(POR.LOC_NM,' ')                                    || CHR(10) ||
       'POR_PORT:'        || BKGM.POR_CD                                            || CHR(10) ||
       'POR_UNLC:'        || NVL(POR.UN_LOC_CD,' ')                                 || CHR(10) ||
       'POL_NAME:'        || NVL(POL.LOC_NM,' ')                                    || CHR(10) ||
       'POL_PORT:'        || BKGM.POL_CD                                            || CHR(10) ||
       'POL_UNLC:'        || NVL(POL.UN_LOC_CD,' ')                                 || CHR(10) ||
	   'POL_ETA:'	   	  || TO_CHAR(n1st_skd.vps_eta_dt, 'RRRRMMDDHH24MI')			|| CHR(10) ||
	   'POL_ETD:'         || TO_CHAR(n1st_skd.vps_etd_dt, 'RRRRMMDDHH24MI')			|| CHR(10) ||
       'POD_NAME:'        || NVL(POD.LOC_NM,' ')                                    || CHR(10) ||
       'POD_PORT:'        || BKGM.POD_CD                                            || CHR(10) ||
       'POD_UNLC:'        || NVL(POD.UN_LOC_CD,' ')                                 || CHR(10) ||
	   'POD_ETA:'	      || TO_CHAR(last_skd.vps_eta_dt,     'RRRRMMDDHH24MI')     || CHR(10) ||
	   'POD_ETD:'         || TO_CHAR(last_skd.vps_etd_dt,     'RRRRMMDDHH24MI')     || CHR(10) ||
       'DEL_NAME:'        || NVL(DEL.LOC_NM,' ')                                    || CHR(10) ||
       'DEL_PORT:'        || BKGM.DEL_CD                                            || CHR(10) ||
       'DEL_UNLC:'        || NVL(DEL.UN_LOC_CD,' ')                                 || CHR(10) ||
       'DEL_ETA:'         || (SELECT to_char(MAX(ESTM_DT), 'RRRRMMDDHH24MI', 'NLS_DATE_LANGUAGE=ENGLISH') as DEL_EST_ARRIVAL_DATE
							  FROM SCE_COP_HDR HDR, SCE_COP_DTL DTL
							 WHERE BKGM.BKG_NO = HDR.BKG_NO
							   AND HDR.COP_NO  = DTL.COP_NO
							   AND DTL.NOD_CD  = BKGM.DEL_NOD_CD
							   AND HDR.COP_STS_CD IN ('C', 'T', 'F')
							   AND (DTL.ACT_CD LIKE 'FI__A_' OR DTL.ACT_CD LIKE 'FU__U_')) || CHR(10) ||
       'CFS_YARD:'        ||   DECODE(YD.YD_FCTY_TP_CFS_FLG, 'Y', BKGM.POD_NOD_CD, BKGM.DEL_NOD_CD)     || CHR(10) ||
	   'PARTY_ADD1:'	  || BKG_TOKEN_NL_FNC(replace(replace(BXC.CUST_NM, chr(13), ' '), chr(10), ' ' ), 1, '')  || CHR(10) ||
	   'PARTY_ADD2:'      || BKG_TOKEN_NL_FNC(replace(replace(BXC.CUST_NM, chr(13), ' '), chr(10), ' ' ), 2, '')  || CHR(10) ||
	   'PARTY_ADD3:'      || BKG_TOKEN_NL_FNC(replace(replace(BXC.CUST_ADDR, chr(13), ' '), chr(10), ' ' ), 1, '')  || CHR(10) ||
	   'PARTY_ADD4:'      || BKG_TOKEN_NL_FNC(replace(replace(BXC.CUST_ADDR, chr(13), ' '), chr(10), ' ' ), 2, '')  || CHR(10) ||
	   'PARTY_ADD5:'      || BKG_TOKEN_NL_FNC(replace(replace(BXC.CUST_ADDR, chr(13), ' '), chr(10), ' ' ), 3, '')  || CHR(10) ||

       'PUNIT:'           || BDOC.PCK_TP_CD                                         || CHR(10) ||
       'PKG:'             || NVL(PCK_QTY,0)                                         || CHR(10) ||
       'WUNIT:'           || SUBSTR(BDOC.WGT_UT_CD, 1, 1)                           || CHR(10) ||
       'WGT:'             || NVL(BDOC.ACT_WGT,0)                                    || CHR(10) ||
       'MUNIT:'           || SUBSTR(BDOC.MEAS_UT_CD, 3, 1)                          || CHR(10) ||
       'MEAS:'            || NVL(BDOC.MEAS_QTY,0)                                   || CHR(10) ||
       'RDTYP:'           || BKGM.RCV_TERM_CD ||BKGM.DE_TERM_CD                     || CHR(10) ||
       'SMOD:'            || BKGM.DEST_TRNS_SVC_MOD_CD                              || CHR(10) ||
       'TRUCK:'           || (select SYS_AREA_GRP_ID from bkg_pfx_rout where ofc_pfx_cd = substr(BKGM.BKG_OFC_CD, 1, 3)) || CHR(10) ||
       'REMARK:'          || REPLACE(@[diff_rmk], CHR(10), ' ')                     || CHR(10) ||
       'INSTRUCTION:'     || REPLACE(NULL, CHR(10), ' ')                            || CHR(10) ||
       'CMD:'             || NVL(CMDT.CMDT_CD, RCMDT.REP_CMDT_CD)                   || CHR(10) ||
       'CMDD:'            || NVL(CMDT.CMDT_NM, RCMDT.REP_CMDT_NM)                   || CHR(10) ||
       'EQREL:'           || @[yd_cd]                                               || CHR(10) ||
       'SHN1:'            || NVL(REPLACE(BSH.CUST_NM, CHR(10), ' '),' ')            || CHR(10) ||
       'FFN1:'            || NVL(REPLACE(BFW.CUST_NM, CHR(10), ' '),' ')            || CHR(10) ||
       'CNE1:'            || NVL(REPLACE(REPLACE(@[cust_nm], CHR(13), ''),CHR(10),''),'')             || CHR(10) ||
       'CANCEL_BIT:'      || BKGM.BKG_STS_CD                                        || CHR(10) ||
       'CARGOTYPE:'       || BKGM.BKG_CGO_TP_CD                                     || CHR(10) ||
       'DR_IND:'          || DECODE(BKGM.DCGO_FLG,'Y','1','0')                      || CHR(10) ||
       'RF_IND:'          || DECODE(BKGM.RC_FLG,'Y','1','0')                        || CHR(10) ||
       'AK_IND:'          || DECODE(BKGM.AWK_CGO_FLG,'Y','1','0')                   || CHR(10) ||
       'BB_IND:'          || DECODE(BKGM.BB_CGO_FLG,'Y','1','0')                    || CHR(10) ||
       'SOC_IND:'         || DECODE(BKGM.soc_flg,'Y','1','0')                       || CHR(10) ||
       'SALES_OFFICE:'    || BKGM.OB_SLS_OFC_CD                                     || CHR(10) ||
       'SALES_NAME:'      || SREP.SREP_NM                                           || CHR(10) ||
       'CONTACT_NAME:'    || BPSN.CNTC_PSON_NM                                      || CHR(10) ||
       'BOUND_IND:'       || 'I'                                                    || CHR(10) ||
       'REGIONAL_BKGNBR:' || NVL(BREF2.CUST_REF_NO_CTNT,'')                         || CHR(10) ||
       'CUST_REF_NO:'     || NVL(BREF1.CUST_REF_NO_CTNT,'')                         || CHR(10) ||
       'SO_NO:'           || BKGM.TWN_SO_NO                                         || CHR(10) ||
       'BLKSTWG:'         || NVL(BLCK_STWG_CD,'')                                   || CHR(10) ||
       'EQPICKDT:'        || @[cgo_pkup_dt]                                         || CHR(10) 
  FROM BKG_BOOKING  BKGM
     , BKG_CUSTOMER BSH
     , BKG_CUSTOMER BFW
     , BKG_VVD      BVVD
     , MDM_VSL_CNTR VSL
     , MDM_LOCATION POR
     , MDM_LOCATION POL
     , MDM_LOCATION POD
     , MDM_LOCATION DEL
     , BKG_BL_DOC    BDOC
     , BKG_CNTC_PSON BPSN
     , MDM_COMMODITY CMDT
     , MDM_REP_CMDT RCMDT
     , MDM_SLS_REP SREP
     ,(SELECT BKG_NO,CUST_REF_NO_CTNT FROM BKG_REFERENCE WHERE BKG_NO = @[bkg_no]  AND BKG_REF_TP_CD  = @[ebrf_ref_tp_cd]  AND ROWNUM =1 ) BREF1  
     ,(SELECT BKG_NO,CUST_REF_NO_CTNT FROM BKG_REFERENCE WHERE BKG_NO = @[bkg_no]  AND BKG_REF_TP_CD  = @[psan_ref_tp_cd]  AND ROWNUM =1 ) BREF2    
     ,(SELECT A.BKG_NO, A.HLG_TP_CD
         FROM BKG_EUR_TRO A,
              (SELECT MAX(TRO_SEQ) AS TRO_SEQ 
                 FROM BKG_EUR_TRO 
                WHERE BKG_NO = @[bkg_no] 
                  AND IO_BND_CD = 'I' ) B
        WHERE A.BKG_NO = @[bkg_no]
          AND A.IO_BND_CD = 'I'
          AND A.TRO_SEQ = B.TRO_SEQ) BET
     , VSK_VSL_PORT_SKD VSK 
     , BKG_VVD          n1st_vvd
     , VSK_VSL_PORT_SKD n1st_skd
     , bkg_vvd          last_vvd
     , vsk_vsl_port_skd last_skd
     , (SELECT A.XTER_RQST_NO AS BKG_NO, A.CUST_ADDR, A.CUST_NM
          FROM BKG_XTER_CUST A,
               (SELECT MAX(XTER_RQST_NO) XTER_RQST_NO
                  FROM BKG_XTER_CUST
                 WHERE XTER_SNDR_ID = 'WEB'
                   AND XTER_RQST_NO = @[bkg_no]
                   AND XTER_CUST_TP_CD = 'B') B
         WHERE A.XTER_SNDR_ID = 'WEB'
           AND A.XTER_RQST_NO = @[bkg_no]
           AND A.XTER_RQST_NO = B.XTER_RQST_NO
           AND A.XTER_CUST_TP_CD = 'B') BXC
      , MDM_YARD  YD  
 WHERE BKGM.BKG_NO                 = @[bkg_no]
   AND BKGM.POR_CD                 = POR.LOC_CD(+)
   AND BKGM.POL_CD                 = POL.LOC_CD(+)
   AND BKGM.POD_CD                 = POD.LOC_CD(+)
   AND BKGM.DEL_CD                 = DEL.LOC_CD(+)  
   AND BSH.BKG_NO(+)               = BKGM.BKG_NO 
   AND BSH.BKG_CUST_TP_CD(+)       = @[sh_cust_tp_cd]
   AND BFW.BKG_NO(+)               = BKGM.BKG_NO 
   AND BFW.BKG_CUST_TP_CD(+)       = @[fw_cust_tp_cd]  
   AND BVVD.BKG_NO(+)              = BKGM.BKG_NO  
   AND BVVD.POD_CD(+)              = BKGM.POD_CD 
   AND VSL.VSL_CD(+)               = BVVD.VSL_CD   
   AND BDOC.BKG_NO(+)              = BKGM.BKG_NO
   AND BREF1.BKG_NO(+)             = BKGM.BKG_NO                
   AND BREF2.BKG_NO(+)             = BKGM.BKG_NO 
   AND BPSN.BKG_NO(+)              = BKGM.BKG_NO           
   AND BPSN.BKG_CNTC_PSON_TP_CD(+) = @[bkg_cntc_pson_tp_cd]
   AND CMDT.CMDT_CD(+)             = BKGM.CMDT_CD  
   AND RCMDT.REP_CMDT_CD(+)        = BKGM.REP_CMDT_CD
   AND SREP.SREP_CD(+)             = BKGM.OB_SREP_CD
   AND BET.BKG_NO(+)               = BKGM.BKG_NO
   AND BVVD.VSL_CD                 = VSK.VSL_CD(+)
   AND BVVD.SKD_VOY_NO             = VSK.SKD_VOY_NO(+)
   AND BVVD.SKD_DIR_CD             = VSK.SKD_DIR_CD(+)
   AND BVVD.POD_CD                 = VSK.VPS_PORT_CD(+)
   AND VSK.CLPT_IND_SEQ(+)         = '1'
   and n1st_vvd.bkg_no (+)         = BKGM.bkg_no
   and n1st_vvd.pol_cd (+)         = BKGM.pol_cd
   and n1st_vvd.vsl_pre_pst_cd  in ('S', 'T')
   and n1st_vvd.vsl_cd             = n1st_skd.vsl_cd(+) 
   and n1st_vvd.skd_voy_no         = n1st_skd.skd_voy_no(+)
   and n1st_vvd.skd_dir_cd         = n1st_skd.skd_dir_cd(+)
   and n1st_vvd.pol_cd             = n1st_skd.vps_port_cd(+)
   and n1st_vvd.pol_clpt_ind_seq   = n1st_skd.clpt_ind_seq(+)
   and BKGM.bkg_no                 = last_vvd.bkg_no(+)
   and BKGM.pod_cd                 = last_vvd.pod_cd(+)
   and last_vvd.vsl_pre_pst_cd  in ('T', 'U')
   and last_vvd.vsl_cd          = last_skd.vsl_cd       (+)
   and last_vvd.skd_voy_no      = last_skd.skd_voy_no   (+)
   and last_vvd.skd_dir_cd      = last_skd.skd_dir_cd   (+)
   and last_vvd.pod_cd          = last_skd.vps_port_cd  (+)
   and last_vvd.pod_clpt_ind_seq= last_skd.clpt_ind_seq (+)
   and BXC.BKG_NO(+)            = BKGM.BKG_NO
   and YD.YD_CD (+)             = BKGM.POD_NOD_CD			]]></sql>
			<params>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="cxl_flg" type="12" value="" out="N"/>
				<param name="diff_rmk" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="cust_nm" type="12" value="" out="N"/>
				<param name="cgo_pkup_dt" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="ebrf_ref_tp_cd" type="12" value="" out="N"/>
				<param name="psan_ref_tp_cd" type="12" value="" out="N"/>
				<param name="sh_cust_tp_cd" type="12" value="" out="N"/>
				<param name="fw_cust_tp_cd" type="12" value="" out="N"/>
				<param name="bkg_cntc_pson_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
