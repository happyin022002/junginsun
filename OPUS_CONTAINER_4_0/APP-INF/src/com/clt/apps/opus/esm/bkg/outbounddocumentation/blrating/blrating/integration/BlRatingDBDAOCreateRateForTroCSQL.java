/*=========================================================
*Copyright(c) 2016 CyberLogitec
*@FileName : BlRatingDBDAOCreateRateForTroCSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2016.10.28
*@LastModifier : 
*@LastVersion : 1.0
* 2016.10.28 
* 1.0 Creation
=========================================================*/
package com.clt.apps.opus.esm.bkg.outbounddocumentation.blrating.blrating.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.clt.framework.support.db.ISQLTemplate;

/**
 *
 * @author 
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class BlRatingDBDAOCreateRateForTroCSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * BlRatingDBDAOCreateRateForTroCSQL
	  * </pre>
	  */
	public BlRatingDBDAOCreateRateForTroCSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("bkg_no",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("user_id",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.clt.apps.opus.esm.bkg.outbounddocumentation.blrating.blrating.integration").append("\n"); 
		query.append("FileName : BlRatingDBDAOCreateRateForTroCSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("#if (${ca_flg} == 'Y')" ).append("\n"); 
		query.append("MERGE INTO BKG_RT_HIS RATE" ).append("\n"); 
		query.append("USING (" ).append("\n"); 
		query.append("    SELECT " ).append("\n"); 
		query.append("		@[bkg_no] AS BKG_NO," ).append("\n"); 
		query.append("		'N' AS RT_BL_TP_CD," ).append("\n"); 
		query.append("		'P' AS FRT_TERM_CD," ).append("\n"); 
		query.append("		(SELECT CASE WHEN TAA_NO IS NOT NULL THEN 'T'" ).append("\n"); 
		query.append("            WHEN RFA_NO IS NOT NULL THEN 'R'" ).append("\n"); 
		query.append("            WHEN SC_NO  IS NOT NULL THEN 'S'" ).append("\n"); 
		query.append("            ELSE ''" ).append("\n"); 
		query.append("            END BKG_CTRT_TP_CD FROM BKG_BKG_HIS" ).append("\n"); 
		query.append("		WHERE BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("		AND   CORR_NO ='TMP0000001') BKG_CTRT_TP_CD," ).append("\n"); 
		query.append("		NVL((SELECT C.OFC_CD FROM BKG_BKG_HIS K, BKG_CHN_AGN C" ).append("\n"); 
		query.append("		              WHERE K.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("		                AND K.CHN_AGN_CD = C.CHN_AGN_CD" ).append("\n"); 
		query.append("		                AND K.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("						AND ROWNUM = 1" ).append("\n"); 
		query.append("		            ),P.OFC_CD) PPD_RCV_OFC_CD," ).append("\n"); 
		query.append("		CASE " ).append("\n"); 
		query.append("		WHEN F.F_PPD_PAYR_CNT_CD IS NOT NULL AND NVL(F.F_PPD_PAYR_CUST_SEQ,'') <> '0' THEN F.F_PPD_PAYR_CNT_CD" ).append("\n"); 
		query.append("		ELSE P.CUST_CNT_CD" ).append("\n"); 
		query.append("		END PPD_PAYR_CNT_CD," ).append("\n"); 
		query.append("		CASE " ).append("\n"); 
		query.append("		WHEN F.F_PPD_PAYR_CNT_CD IS NOT NULL AND NVL(F.F_PPD_PAYR_CUST_SEQ,'') <> '0' THEN F.F_PPD_PAYR_CUST_SEQ" ).append("\n"); 
		query.append("        ELSE P.CUST_SEQ " ).append("\n"); 
		query.append("        END PPD_PAYR_CUST_SEQ," ).append("\n"); 
		query.append("		C.OFC_CD CLT_OFC_CD," ).append("\n"); 
		query.append("		C.CUST_CNT_CD CLT_PAYR_CNT_CD," ).append("\n"); 
		query.append("		C.CUST_SEQ CLT_PAYR_CUST_SEQ," ).append("\n"); 
		query.append("        @[user_id] AS CRE_USR_ID," ).append("\n"); 
		query.append("        sysdate AS CRE_DT," ).append("\n"); 
		query.append("        @[user_id] AS UPD_USR_ID," ).append("\n"); 
		query.append("        sysdate AS UPD_DT" ).append("\n"); 
		query.append("		FROM (" ).append("\n"); 
		query.append("				SELECT ROWNUM,A.* FROM " ).append("\n"); 
		query.append("				(" ).append("\n"); 
		query.append("					--PPD RULE 1 FF CASE" ).append("\n"); 
		query.append("					SELECT BKG.BKG_NO BKG_NO," ).append("\n"); 
		query.append("					        10 AS FLG," ).append("\n"); 
		query.append("					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("						 CR_CLT_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("					     F.CUST_CNT_CD CUST_CNT_CD," ).append("\n"); 
		query.append("    					 F.CUST_SEQ CUST_SEQ," ).append("\n"); 
		query.append("    					 C.CUST_LGL_ENG_NM CUST_NM" ).append("\n"); 
		query.append("					FROM   MDM_CR_CUST CUST," ).append("\n"); 
		query.append("					       BKG_BKG_HIS BKG," ).append("\n"); 
		query.append("                           MDM_CUSTOMER C," ).append("\n"); 
		query.append("    					   BKG_CUST_HIS F," ).append("\n"); 
		query.append("                           MDM_ORGANIZATION O  " ).append("\n"); 
		query.append("					      " ).append("\n"); 
		query.append("					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("					AND    BKG.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("    				AND    BKG.BKG_NO = F.BKG_NO" ).append("\n"); 
		query.append("					AND    F.CORR_NO = 'TMP0000001'" ).append("\n"); 
		query.append("					AND    F.BKG_CUST_TP_CD = 'F'" ).append("\n"); 
		query.append("					AND    F.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    F.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("					AND    C.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    NVL(C.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("					AND    CUST.CUST_CNT_CD = F.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    CUST.CUST_SEQ = F.CUST_SEQ" ).append("\n"); 
		query.append("					AND    BKG.BKG_OFC_CD = O.OFC_CD" ).append("\n"); 
		query.append("					AND    O.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    NVL(O.PPD_PTY_TP_CD,'S') ='F'" ).append("\n"); 
		query.append("    				AND    0 < CUST.OB_CR_TERM_DYS" ).append("\n"); 
		query.append("					AND    CUST.CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("					AND    CUST.CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("					AND    CUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("					UNION" ).append("\n"); 
		query.append("					--PPD RULE 2 SH CASE" ).append("\n"); 
		query.append("					SELECT BKG.BKG_NO BKG_NO," ).append("\n"); 
		query.append("					        11 AS FLG," ).append("\n"); 
		query.append("					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("						 CR_CLT_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("						 S.CUST_CNT_CD CUST_CNT_CD," ).append("\n"); 
		query.append("    					 S.CUST_SEQ CUST_SEQ," ).append("\n"); 
		query.append("    					 C.CUST_LGL_ENG_NM CUST_NM" ).append("\n"); 
		query.append("					FROM   MDM_CR_CUST CUST," ).append("\n"); 
		query.append("					       BKG_BKG_HIS BKG," ).append("\n"); 
		query.append("                           MDM_CUSTOMER C," ).append("\n"); 
		query.append("    					   BKG_CUST_HIS S" ).append("\n"); 
		query.append("					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("					AND	   BKG.CORR_NO = 'TMP0000001'" ).append("\n"); 
		query.append("    				AND    BKG.BKG_NO = S.BKG_NO" ).append("\n"); 
		query.append("    				AND    S.CORR_NO = 'TMP0000001'" ).append("\n"); 
		query.append("    				AND    S.BKG_CUST_TP_CD = 'S'" ).append("\n"); 
		query.append("					AND    S.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    S.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("					AND    C.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    NVL(C.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("					AND    CUST.CUST_CNT_CD = S.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    CUST.CUST_SEQ = S.CUST_SEQ" ).append("\n"); 
		query.append("    				AND    0 < CUST.OB_CR_TERM_DYS" ).append("\n"); 
		query.append("					AND    CUST.CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("					AND    CUST.CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("					AND    CUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("					UNION" ).append("\n"); 
		query.append("					--PPD RULE 3 FF CASE" ).append("\n"); 
		query.append("					--????????????????? MDM OFFICE ?? OFC_TP_CD?? QT ??????? POR ?? FINC_CTRL_OFC_CD ???????" ).append("\n"); 
		query.append("					SELECT B.BKG_NO BKG_NO," ).append("\n"); 
		query.append("					        12 AS FLG," ).append("\n"); 
		query.append("					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("					        C.OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("					        F.CUST_CNT_CD," ).append("\n"); 
		query.append("					        F.CUST_SEQ," ).append("\n"); 
		query.append("					        C.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("					FROM    BKG_BKG_HIS B," ).append("\n"); 
		query.append("					        BKG_CUST_HIS F," ).append("\n"); 
		query.append("					        MDM_CUSTOMER C," ).append("\n"); 
		query.append("							MDM_ORGANIZATION O," ).append("\n"); 
		query.append("							MDM_LOCATION L" ).append("\n"); 
		query.append("					WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("    				AND  F.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("    				AND  F.BKG_CUST_TP_CD = 'F'" ).append("\n"); 
		query.append("    				AND  F.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("    				AND  F.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("    				AND  C.DELT_FLG ='N'" ).append("\n"); 
		query.append("    				AND  O.DELT_FLG ='N'" ).append("\n"); 
		query.append("    				AND  L.DELT_FLG ='N'" ).append("\n"); 
		query.append("    				AND  B.BKG_OFC_CD = O.OFC_CD " ).append("\n"); 
		query.append("    				AND  NVL(C.NMD_CUST_FLG,'N') ='N'	" ).append("\n"); 
		query.append("    				AND  NVL(O.PPD_PTY_TP_CD,'S') ='F'" ).append("\n"); 
		query.append("    				AND  B.POR_CD = L.LOC_CD" ).append("\n"); 
		query.append("    				AND  B.CORR_NO = 'TMP0000001'" ).append("\n"); 
		query.append("    				AND  F.CORR_NO = 'TMP0000001'" ).append("\n"); 
		query.append("					UNION " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("					--PPD RULE 4 SH CASE" ).append("\n"); 
		query.append("					--????????????????? MDM OFFICE ?? OFC_TP_CD?? QT ??????? POR ?? FINC_CTRL_OFC_CD ???????" ).append("\n"); 
		query.append("					SELECT B.BKG_NO BKG_NO," ).append("\n"); 
		query.append("					        13 AS FLG," ).append("\n"); 
		query.append("					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("					        C.OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("					        C.CUST_CNT_CD," ).append("\n"); 
		query.append("					        C.CUST_SEQ," ).append("\n"); 
		query.append("					        C.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("					FROM    BKG_BKG_HIS B," ).append("\n"); 
		query.append("					        BKG_CUST_HIS S," ).append("\n"); 
		query.append("					        MDM_CUSTOMER C," ).append("\n"); 
		query.append("							MDM_ORGANIZATION O," ).append("\n"); 
		query.append("							MDM_LOCATION L" ).append("\n"); 
		query.append("					WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("					AND    S.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("					AND    B.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("					AND    S.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("					AND    S.BKG_CUST_TP_CD = 'S'" ).append("\n"); 
		query.append("					AND    S.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    S.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("					AND    C.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    O.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    L.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    C.OFC_CD = O.OFC_CD " ).append("\n"); 
		query.append("					AND    NVL(C.NMD_CUST_FLG,'N') ='N'	" ).append("\n"); 
		query.append("					AND    B.POR_CD = L.LOC_CD" ).append("\n"); 
		query.append("					ORDER BY FLG" ).append("\n"); 
		query.append("					) A" ).append("\n"); 
		query.append("					WHERE ROWNUM = 1" ).append("\n"); 
		query.append("					)P," ).append("\n"); 
		query.append("					(SELECT " ).append("\n"); 
		query.append("					BKG_NO," ).append("\n"); 
		query.append("					OFC_CD," ).append("\n"); 
		query.append("					CUST_CNT_CD," ).append("\n"); 
		query.append("					CUST_SEQ" ).append("\n"); 
		query.append("					FROM (" ).append("\n"); 
		query.append("					SELECT ROWNUM,A.* FROM " ).append("\n"); 
		query.append("					(" ).append("\n"); 
		query.append("					--CCT" ).append("\n"); 
		query.append("					SELECT  BKG.BKG_NO AS BKG_NO," ).append("\n"); 
		query.append("					        21 AS FLG," ).append("\n"); 
		query.append("					        'C' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("					        CR_CLT_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("					        BCUST.CUST_CNT_CD AS CUST_CNT_CD," ).append("\n"); 
		query.append("					        BCUST.CUST_SEQ AS CUST_SEQ," ).append("\n"); 
		query.append("					        MCUST.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("					FROM    MDM_CR_CUST CUST," ).append("\n"); 
		query.append("					        BKG_BKG_HIS BKG," ).append("\n"); 
		query.append("					        BKG_CUST_HIS BCUST," ).append("\n"); 
		query.append("					        MDM_CUSTOMER MCUST" ).append("\n"); 
		query.append("					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("					AND    BKG.BKG_NO = BCUST.BKG_NO" ).append("\n"); 
		query.append("					AND    BCUST.BKG_CUST_TP_CD = 'C'" ).append("\n"); 
		query.append("					AND    CUST.CUST_CNT_CD = BCUST.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    CUST.CUST_SEQ = BCUST.CUST_SEQ" ).append("\n"); 
		query.append("					AND    BCUST.CUST_CNT_CD = MCUST.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    BCUST.CUST_SEQ = MCUST.CUST_SEQ    " ).append("\n"); 
		query.append("					AND    BKG.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("					AND    BCUST.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("					AND    IB_CR_TERM_DYS > 0" ).append("\n"); 
		query.append("					AND    CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("					AND    CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("					AND    MCUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    NVL(MCUST.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("					AND    CUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("					UNION" ).append("\n"); 
		query.append("					--CCT OFFICE CODE2" ).append("\n"); 
		query.append("					SELECT B.BKG_NO BKG_NO," ).append("\n"); 
		query.append("					        22 AS FLG," ).append("\n"); 
		query.append("					        'C' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("					        --C.OFC_CD AS OFC_CD, " ).append("\n"); 
		query.append("							-- DEL 에 해당되는 OFC 로 로직 변경 " ).append("\n"); 
		query.append("							(SELECT  FINC_CTRL_OFC_CD" ).append("\n"); 
		query.append("					            FROM MDM_LOCATION" ).append("\n"); 
		query.append("					            WHERE LOC_CD = (SELECT DEL_CD" ).append("\n"); 
		query.append("					                            FROM  BKG_BKG_HIS" ).append("\n"); 
		query.append("					                            WHERE BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("					                            AND   CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("					                            )) AS OFC_CD," ).append("\n"); 
		query.append("					        S.CUST_CNT_CD  AS CUST_CNT_CD," ).append("\n"); 
		query.append("					        NVL(S.CUST_SEQ,'1') AS CUST_SEQ," ).append("\n"); 
		query.append("					        C.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("					FROM    BKG_BKG_HIS B, " ).append("\n"); 
		query.append("					        BKG_CUST_HIS S," ).append("\n"); 
		query.append("					        MDM_CUSTOMER C" ).append("\n"); 
		query.append("					WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("					AND    S.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("					AND    DECODE(B.CUST_TO_ORD_FLG,'Y','N','C') = S.BKG_CUST_TP_CD" ).append("\n"); 
		query.append("					AND    S.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    S.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("					AND    C.DELT_FLG = 'N'" ).append("\n"); 
		query.append("					AND	NVL(C.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("					AND   B.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("					AND   S.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("					UNION" ).append("\n"); 
		query.append("					--REP CUSTOMER" ).append("\n"); 
		query.append("					SELECT BKG_NO," ).append("\n"); 
		query.append("					        31 AS FLG," ).append("\n"); 
		query.append("					        'R'AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("					        (SELECT  FINC_CTRL_OFC_CD" ).append("\n"); 
		query.append("					            FROM MDM_LOCATION" ).append("\n"); 
		query.append("					            WHERE LOC_CD = (SELECT DEL_CD" ).append("\n"); 
		query.append("					                            FROM  BKG_BKG_HIS" ).append("\n"); 
		query.append("					                            WHERE BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("					                            AND   CORR_NO ='TMP0000001')) AS OFC_CD," ).append("\n"); 
		query.append("					        REP_CUST_CNT_CD AS CUST_CNT_CD," ).append("\n"); 
		query.append("					        REP_CUST_SEQ AS CUST_SEQ," ).append("\n"); 
		query.append("					        MCUST.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("					FROM   MDM_ORGANIZATION OFC, " ).append("\n"); 
		query.append("					        BKG_BKG_HIS BKG," ).append("\n"); 
		query.append("					        MDM_CUSTOMER MCUST" ).append("\n"); 
		query.append("					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("					AND    REP_CUST_CNT_CD = MCUST.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    REP_CUST_SEQ = MCUST.CUST_SEQ" ).append("\n"); 
		query.append("					AND    MCUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND	NVL(MCUST.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("					AND   BKG.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("					AND    OFC.OFC_CD = NVL((SELECT CR_CLT_OFC_CD" ).append("\n"); 
		query.append("					                        FROM MDM_CR_CUST" ).append("\n"); 
		query.append("					                        WHERE (CUST_CNT_CD, CUST_SEQ) = (SELECT CUST_CNT_CD, CUST_SEQ" ).append("\n"); 
		query.append("					                                                            FROM   BKG_BKG_HIS B," ).append("\n"); 
		query.append("					                                                                    BKG_CUST_HIS C" ).append("\n"); 
		query.append("					                                                            WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("					                                                            AND    C.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("					                                                            AND    C.BKG_CUST_TP_CD = 'C'" ).append("\n"); 
		query.append("					                                                            AND    B.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("					                                                            AND    C.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("																				)" ).append("\n"); 
		query.append("					                        AND 0 < IB_CR_TERM_DYS" ).append("\n"); 
		query.append("											AND MCUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("					                        AND CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("					                        AND CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001'))," ).append("\n"); 
		query.append("					                    (SELECT  FINC_CTRL_OFC_CD" ).append("\n"); 
		query.append("					                        FROM MDM_LOCATION" ).append("\n"); 
		query.append("					                        WHERE LOC_CD = (SELECT DEL_CD" ).append("\n"); 
		query.append("					                                        FROM  BKG_BKG_HIS" ).append("\n"); 
		query.append("					                                        WHERE BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("					                                        AND   CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("					                    )" ).append("\n"); 
		query.append("					                    )" ).append("\n"); 
		query.append("					                    ORDER BY FLG" ).append("\n"); 
		query.append("					) A" ).append("\n"); 
		query.append("					WHERE " ).append("\n"); 
		query.append("					ROWNUM = 1)" ).append("\n"); 
		query.append("					) C," ).append("\n"); 
		query.append("				   (SELECT BK.BKG_NO," ).append("\n"); 
		query.append("					CASE WHEN (POR_L.CONTI_CD ='F' OR POR_L.CONTI_CD = 'E') AND(F.CUST_SEQ IS NOT NULL AND F.CUST_SEQ <> '0') AND EXISTS (SELECT 'Y' FROM MDM_LOCATION FL " ).append("\n"); 
		query.append("                                                                        WHERE  FL.CONTI_CD ='E' " ).append("\n"); 
		query.append("                                                                          AND  FL.DELT_FLG ='N'" ).append("\n"); 
		query.append("                                                                          AND  FL.CNT_CD = F.CUST_CNT_CD" ).append("\n"); 
		query.append("                                                                          AND ROWNUM =1 )" ).append("\n"); 
		query.append("                   THEN F.CUST_CNT_CD" ).append("\n"); 
		query.append("                   ELSE ''" ).append("\n"); 
		query.append("                   END F_PPD_PAYR_CNT_CD," ).append("\n"); 
		query.append("                   CASE WHEN (POR_L.CONTI_CD ='F' OR POR_L.CONTI_CD = 'E') AND(F.CUST_SEQ IS NOT NULL AND F.CUST_SEQ <> '0') AND EXISTS (SELECT 'Y' FROM MDM_LOCATION FL " ).append("\n"); 
		query.append("                                                                                WHERE  FL.CONTI_CD ='E' " ).append("\n"); 
		query.append("                                                                                  AND  FL.DELT_FLG ='N'" ).append("\n"); 
		query.append("                                                                                  AND  FL.CNT_CD = F.CUST_CNT_CD" ).append("\n"); 
		query.append("                                                                                  AND ROWNUM =1 )" ).append("\n"); 
		query.append("                   THEN F.CUST_SEQ" ).append("\n"); 
		query.append("                   ELSE 0" ).append("\n"); 
		query.append("                   END F_PPD_PAYR_CUST_SEQ" ).append("\n"); 
		query.append("				   FROM BKG_BKG_HIS BK,BKG_CUST_HIS F, MDM_LOCATION POR_L" ).append("\n"); 
		query.append("				   WHERE BK.BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("                     AND BK.BKG_STS_CD <>'X'" ).append("\n"); 
		query.append("                     AND BK.BKG_NO = F.BKG_NO" ).append("\n"); 
		query.append("                     AND F.BKG_CUST_TP_CD ='F'" ).append("\n"); 
		query.append("                     AND BK.POR_CD = POR_L.LOC_CD" ).append("\n"); 
		query.append("                     AND POR_L.DELT_FLG ='N'" ).append("\n"); 
		query.append("                     AND BK.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                     AND F.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("				   ) F" ).append("\n"); 
		query.append("					WHERE P.BKG_NO = C.BKG_NO(+)" ).append("\n"); 
		query.append("					  AND P.BKG_NO = F.BKG_NO(+)" ).append("\n"); 
		query.append("    ) T" ).append("\n"); 
		query.append("ON (T.BKG_NO = RATE.BKG_NO )" ).append("\n"); 
		query.append("WHEN MATCHED THEN" ).append("\n"); 
		query.append("    UPDATE SET" ).append("\n"); 
		query.append("      	PPD_RCV_OFC_CD = T.PPD_RCV_OFC_CD," ).append("\n"); 
		query.append("        PPD_PAYR_CNT_CD = T.PPD_PAYR_CNT_CD," ).append("\n"); 
		query.append("        PPD_PAYR_CUST_SEQ = T.PPD_PAYR_CUST_SEQ," ).append("\n"); 
		query.append("        CLT_OFC_CD = T.CLT_OFC_CD," ).append("\n"); 
		query.append("        CLT_PAYR_CNT_CD = T.CLT_PAYR_CNT_CD," ).append("\n"); 
		query.append("        CLT_PAYR_CUST_SEQ = T.CLT_PAYR_CUST_SEQ," ).append("\n"); 
		query.append("        UPD_DT = SYSDATE," ).append("\n"); 
		query.append("		UPD_USR_ID = @[user_id]" ).append("\n"); 
		query.append("    WHERE BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("      AND NOT EXISTS  (SELECT 'X' FROM BKG_CHG_RT_HIS C WHERE C.BKG_NO = @[bkg_no] AND C.CORR_NO = 'TMP0000001')--20160926 Prevent to automatically update" ).append("\n"); 
		query.append("WHEN NOT MATCHED THEN" ).append("\n"); 
		query.append("    INSERT(" ).append("\n"); 
		query.append("        BKG_NO," ).append("\n"); 
		query.append("        CORR_NO," ).append("\n"); 
		query.append("		RT_BL_TP_CD," ).append("\n"); 
		query.append("		FRT_TERM_CD," ).append("\n"); 
		query.append("		BKG_CTRT_TP_CD," ).append("\n"); 
		query.append("		PPD_RCV_OFC_CD," ).append("\n"); 
		query.append("		PPD_PAYR_CNT_CD," ).append("\n"); 
		query.append("		PPD_PAYR_CUST_SEQ," ).append("\n"); 
		query.append("		CLT_OFC_CD," ).append("\n"); 
		query.append("		CLT_PAYR_CNT_CD," ).append("\n"); 
		query.append("		CLT_PAYR_CUST_SEQ," ).append("\n"); 
		query.append("        CRE_USR_ID," ).append("\n"); 
		query.append("        CRE_DT," ).append("\n"); 
		query.append("        UPD_USR_ID," ).append("\n"); 
		query.append("        UPD_DT" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    VALUES ( " ).append("\n"); 
		query.append("		T.BKG_NO," ).append("\n"); 
		query.append("		'TMP0000001'," ).append("\n"); 
		query.append("		T.RT_BL_TP_CD," ).append("\n"); 
		query.append("		T.FRT_TERM_CD," ).append("\n"); 
		query.append("		T.BKG_CTRT_TP_CD," ).append("\n"); 
		query.append("		T.PPD_RCV_OFC_CD," ).append("\n"); 
		query.append("		T.PPD_PAYR_CNT_CD," ).append("\n"); 
		query.append("		T.PPD_PAYR_CUST_SEQ," ).append("\n"); 
		query.append("		T.CLT_OFC_CD," ).append("\n"); 
		query.append("		T.CLT_PAYR_CNT_CD," ).append("\n"); 
		query.append("		T.CLT_PAYR_CUST_SEQ," ).append("\n"); 
		query.append("	    T.CRE_USR_ID," ).append("\n"); 
		query.append("	    T.CRE_DT," ).append("\n"); 
		query.append("	    T.UPD_USR_ID," ).append("\n"); 
		query.append("	    T.UPD_DT" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("MERGE INTO BKG_RATE RATE" ).append("\n"); 
		query.append("USING (" ).append("\n"); 
		query.append("    SELECT " ).append("\n"); 
		query.append("		@[bkg_no] AS BKG_NO," ).append("\n"); 
		query.append("		'N' AS RT_BL_TP_CD," ).append("\n"); 
		query.append("		'P' AS FRT_TERM_CD," ).append("\n"); 
		query.append("		(SELECT CASE WHEN TAA_NO IS NOT NULL THEN 'T'" ).append("\n"); 
		query.append("            WHEN RFA_NO IS NOT NULL THEN 'R'" ).append("\n"); 
		query.append("            WHEN SC_NO  IS NOT NULL THEN 'S'" ).append("\n"); 
		query.append("            ELSE ''" ).append("\n"); 
		query.append("            END BKG_CTRT_TP_CD FROM BKG_BOOKING" ).append("\n"); 
		query.append("		WHERE BKG_NO = @[bkg_no]) BKG_CTRT_TP_CD," ).append("\n"); 
		query.append("		NVL((SELECT C.OFC_CD FROM BKG_BOOKING K, BKG_CHN_AGN C" ).append("\n"); 
		query.append("		              WHERE K.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("		                AND K.CHN_AGN_CD = C.CHN_AGN_CD" ).append("\n"); 
		query.append("						AND ROWNUM = 1" ).append("\n"); 
		query.append("		            ),P.OFC_CD) PPD_RCV_OFC_CD," ).append("\n"); 
		query.append("		CASE " ).append("\n"); 
		query.append("		WHEN F.F_PPD_PAYR_CNT_CD IS NOT NULL AND NVL(F.F_PPD_PAYR_CUST_SEQ,'') <> '0' THEN F.F_PPD_PAYR_CNT_CD" ).append("\n"); 
		query.append("		ELSE P.CUST_CNT_CD" ).append("\n"); 
		query.append("		END PPD_PAYR_CNT_CD," ).append("\n"); 
		query.append("		CASE " ).append("\n"); 
		query.append("		WHEN F.F_PPD_PAYR_CNT_CD IS NOT NULL AND NVL(F.F_PPD_PAYR_CUST_SEQ,'') <> '0' THEN F.F_PPD_PAYR_CUST_SEQ" ).append("\n"); 
		query.append("        ELSE P.CUST_SEQ " ).append("\n"); 
		query.append("        END PPD_PAYR_CUST_SEQ," ).append("\n"); 
		query.append("		C.OFC_CD CLT_OFC_CD," ).append("\n"); 
		query.append("		C.CUST_CNT_CD CLT_PAYR_CNT_CD," ).append("\n"); 
		query.append("		C.CUST_SEQ CLT_PAYR_CUST_SEQ," ).append("\n"); 
		query.append("        @[user_id] AS CRE_USR_ID," ).append("\n"); 
		query.append("        sysdate AS CRE_DT," ).append("\n"); 
		query.append("        @[user_id] AS UPD_USR_ID," ).append("\n"); 
		query.append("        sysdate AS UPD_DT" ).append("\n"); 
		query.append("		FROM (" ).append("\n"); 
		query.append("				SELECT ROWNUM,A.* FROM " ).append("\n"); 
		query.append("				(" ).append("\n"); 
		query.append("					--PPD RULE 1 FF CASE" ).append("\n"); 
		query.append("					SELECT BKG.BKG_NO BKG_NO," ).append("\n"); 
		query.append("					        10 AS FLG," ).append("\n"); 
		query.append("					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("						 CR_CLT_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append(" 						 F.CUST_CNT_CD CUST_CNT_CD," ).append("\n"); 
		query.append("    					 F.CUST_SEQ CUST_SEQ," ).append("\n"); 
		query.append("    					 C.CUST_LGL_ENG_NM CUST_NM" ).append("\n"); 
		query.append("					FROM   MDM_CR_CUST CUST," ).append("\n"); 
		query.append("					       BKG_BOOKING BKG," ).append("\n"); 
		query.append("                           MDM_CUSTOMER C," ).append("\n"); 
		query.append("    					   BKG_CUSTOMER F," ).append("\n"); 
		query.append("                           MDM_ORGANIZATION O" ).append("\n"); 
		query.append("					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("    				AND    BKG.BKG_NO = F.BKG_NO" ).append("\n"); 
		query.append("    				AND    F.BKG_CUST_TP_CD = 'F'" ).append("\n"); 
		query.append("					AND    F.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    F.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("					AND    C.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    NVL(C.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("					AND    CUST.CUST_CNT_CD = F.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    CUST.CUST_SEQ = F.CUST_SEQ" ).append("\n"); 
		query.append("					AND    BKG.BKG_OFC_CD = O.OFC_CD" ).append("\n"); 
		query.append("					AND    O.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    NVL(O.PPD_PTY_TP_CD,'S') ='F'" ).append("\n"); 
		query.append("    				AND    0 < CUST.OB_CR_TERM_DYS" ).append("\n"); 
		query.append("					AND    CUST.CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("					AND    CUST.CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("					AND    CUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("					UNION" ).append("\n"); 
		query.append("					--PPD RULE 2 SH CASE" ).append("\n"); 
		query.append("					SELECT BKG.BKG_NO BKG_NO," ).append("\n"); 
		query.append("					        11 AS FLG," ).append("\n"); 
		query.append("					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("						 CR_CLT_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("    					 S.CUST_CNT_CD CUST_CNT_CD," ).append("\n"); 
		query.append("    					 S.CUST_SEQ CUST_SEQ," ).append("\n"); 
		query.append("    					 C.CUST_LGL_ENG_NM CUST_NM" ).append("\n"); 
		query.append("					FROM   MDM_CR_CUST CUST," ).append("\n"); 
		query.append("    					   BKG_BOOKING BKG," ).append("\n"); 
		query.append("                           MDM_CUSTOMER C," ).append("\n"); 
		query.append("    					   BKG_CUSTOMER S" ).append("\n"); 
		query.append("					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("    				AND    BKG.BKG_NO = S.BKG_NO" ).append("\n"); 
		query.append("    				AND    S.BKG_CUST_TP_CD = 'S'" ).append("\n"); 
		query.append("					AND    S.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    S.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("					AND    C.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    NVL(C.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("					AND    CUST.CUST_CNT_CD = S.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    CUST.CUST_SEQ = S.CUST_SEQ" ).append("\n"); 
		query.append("    				AND    0 < CUST.OB_CR_TERM_DYS" ).append("\n"); 
		query.append("					AND    CUST.CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("					AND    CUST.CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("					AND    CUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("					UNION" ).append("\n"); 
		query.append("					--PPD RULE 3 FF CASE" ).append("\n"); 
		query.append("					--????????????????? MDM OFFICE ?? OFC_TP_CD?? QT ??????? POR ?? FINC_CTRL_OFC_CD ???????" ).append("\n"); 
		query.append("					SELECT B.BKG_NO BKG_NO," ).append("\n"); 
		query.append("					        12 AS FLG," ).append("\n"); 
		query.append("					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("					        C.OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("    						F.CUST_CNT_CD," ).append("\n"); 
		query.append("    						F.CUST_SEQ," ).append("\n"); 
		query.append("    						C.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("					FROM    BKG_BOOKING B," ).append("\n"); 
		query.append("					        BKG_CUSTOMER F," ).append("\n"); 
		query.append("					        MDM_CUSTOMER C," ).append("\n"); 
		query.append("							MDM_ORGANIZATION O," ).append("\n"); 
		query.append("							MDM_LOCATION L" ).append("\n"); 
		query.append("					WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("    				AND  F.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("    				AND  F.BKG_CUST_TP_CD = 'F'" ).append("\n"); 
		query.append("    				AND  F.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("    				AND  F.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("    				AND  C.DELT_FLG ='N'" ).append("\n"); 
		query.append("    				AND  O.DELT_FLG ='N'" ).append("\n"); 
		query.append("    				AND  L.DELT_FLG ='N'" ).append("\n"); 
		query.append("    				AND  B.BKG_OFC_CD = O.OFC_CD " ).append("\n"); 
		query.append("    				AND  NVL(C.NMD_CUST_FLG,'N') ='N'	" ).append("\n"); 
		query.append("    				AND  NVL(O.PPD_PTY_TP_CD,'S') ='F'" ).append("\n"); 
		query.append("    				AND  B.POR_CD = L.LOC_CD" ).append("\n"); 
		query.append("					UNION" ).append("\n"); 
		query.append("					--PPD RULE 4 SH CASE" ).append("\n"); 
		query.append("					--????????????????? MDM OFFICE ?? OFC_TP_CD?? QT ??????? POR ?? FINC_CTRL_OFC_CD ???????" ).append("\n"); 
		query.append("					SELECT B.BKG_NO BKG_NO," ).append("\n"); 
		query.append("					        13 AS FLG," ).append("\n"); 
		query.append("					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("					        C.OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("					        C.CUST_CNT_CD," ).append("\n"); 
		query.append("					        C.CUST_SEQ," ).append("\n"); 
		query.append("					        C.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("					FROM    BKG_BOOKING B," ).append("\n"); 
		query.append("					        BKG_CUSTOMER S," ).append("\n"); 
		query.append("					        MDM_CUSTOMER C," ).append("\n"); 
		query.append("							MDM_ORGANIZATION O," ).append("\n"); 
		query.append("							MDM_LOCATION L" ).append("\n"); 
		query.append("					WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("					AND    S.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("					AND    S.BKG_CUST_TP_CD = 'S'" ).append("\n"); 
		query.append("					AND    S.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    S.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("					AND    C.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    O.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    L.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    C.OFC_CD = O.OFC_CD " ).append("\n"); 
		query.append("					AND    NVL(C.NMD_CUST_FLG,'N') ='N'	" ).append("\n"); 
		query.append("					AND    B.POR_CD = L.LOC_CD" ).append("\n"); 
		query.append("					ORDER BY FLG" ).append("\n"); 
		query.append("					) A" ).append("\n"); 
		query.append("					WHERE ROWNUM = 1" ).append("\n"); 
		query.append("					)P," ).append("\n"); 
		query.append("					(SELECT " ).append("\n"); 
		query.append("					BKG_NO," ).append("\n"); 
		query.append("					OFC_CD," ).append("\n"); 
		query.append("					CUST_CNT_CD," ).append("\n"); 
		query.append("					CUST_SEQ" ).append("\n"); 
		query.append("					FROM (" ).append("\n"); 
		query.append("					SELECT ROWNUM,A.* FROM " ).append("\n"); 
		query.append("					(" ).append("\n"); 
		query.append("					--CCT" ).append("\n"); 
		query.append("					SELECT  BKG.BKG_NO AS BKG_NO," ).append("\n"); 
		query.append("					        21 AS FLG," ).append("\n"); 
		query.append("					        'C' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("					        CR_CLT_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("					        BCUST.CUST_CNT_CD AS CUST_CNT_CD," ).append("\n"); 
		query.append("					        BCUST.CUST_SEQ AS CUST_SEQ," ).append("\n"); 
		query.append("					        MCUST.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("					FROM    MDM_CR_CUST CUST," ).append("\n"); 
		query.append("					        BKG_BOOKING BKG," ).append("\n"); 
		query.append("					        BKG_CUSTOMER BCUST," ).append("\n"); 
		query.append("					        MDM_CUSTOMER MCUST" ).append("\n"); 
		query.append("					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("					AND    BKG.BKG_NO = BCUST.BKG_NO" ).append("\n"); 
		query.append("					AND    BCUST.BKG_CUST_TP_CD = 'C'" ).append("\n"); 
		query.append("					AND    CUST.CUST_CNT_CD = BCUST.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    CUST.CUST_SEQ = BCUST.CUST_SEQ" ).append("\n"); 
		query.append("					AND    BCUST.CUST_CNT_CD = MCUST.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    BCUST.CUST_SEQ = MCUST.CUST_SEQ    " ).append("\n"); 
		query.append("					AND    IB_CR_TERM_DYS > 0" ).append("\n"); 
		query.append("					AND    CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("					AND    CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("					AND    MCUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    NVL(MCUST.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("					AND    CUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("					UNION" ).append("\n"); 
		query.append("					--CCT OFFICE CODE2" ).append("\n"); 
		query.append("					SELECT B.BKG_NO BKG_NO," ).append("\n"); 
		query.append("					        22 AS FLG," ).append("\n"); 
		query.append("					        'C' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("					        --C.OFC_CD AS OFC_CD, " ).append("\n"); 
		query.append("							-- DEL 에 해당되는 OFC 로 로직 변경 " ).append("\n"); 
		query.append("							(SELECT  FINC_CTRL_OFC_CD" ).append("\n"); 
		query.append("					            FROM MDM_LOCATION" ).append("\n"); 
		query.append("					            WHERE LOC_CD = (SELECT DEL_CD" ).append("\n"); 
		query.append("					                            FROM  BKG_BOOKING" ).append("\n"); 
		query.append("					                            WHERE BKG_NO =@[bkg_no])) AS OFC_CD," ).append("\n"); 
		query.append("					        S.CUST_CNT_CD  AS CUST_CNT_CD," ).append("\n"); 
		query.append("					        NVL(S.CUST_SEQ,'1') AS CUST_SEQ," ).append("\n"); 
		query.append("					        C.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("					FROM    BKG_BOOKING B, " ).append("\n"); 
		query.append("					        BKG_CUSTOMER S," ).append("\n"); 
		query.append("					        MDM_CUSTOMER C" ).append("\n"); 
		query.append("					WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("					AND    S.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("					AND    DECODE(B.CUST_TO_ORD_FLG,'Y','N','C') = S.BKG_CUST_TP_CD" ).append("\n"); 
		query.append("					AND    S.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    S.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("					AND    C.DELT_FLG = 'N'" ).append("\n"); 
		query.append("					AND	NVL(C.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("					UNION" ).append("\n"); 
		query.append("					--REP CUSTOMER" ).append("\n"); 
		query.append("					SELECT BKG_NO," ).append("\n"); 
		query.append("					        31 AS FLG," ).append("\n"); 
		query.append("					        'R'AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("					        (SELECT  FINC_CTRL_OFC_CD" ).append("\n"); 
		query.append("					            FROM MDM_LOCATION" ).append("\n"); 
		query.append("					            WHERE LOC_CD = (SELECT DEL_CD" ).append("\n"); 
		query.append("					                            FROM  BKG_BOOKING" ).append("\n"); 
		query.append("					                            WHERE BKG_NO =@[bkg_no])) AS OFC_CD," ).append("\n"); 
		query.append("					        REP_CUST_CNT_CD AS CUST_CNT_CD," ).append("\n"); 
		query.append("					        REP_CUST_SEQ AS CUST_SEQ," ).append("\n"); 
		query.append("					        MCUST.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("					FROM   MDM_ORGANIZATION OFC, " ).append("\n"); 
		query.append("					        BKG_BOOKING BKG," ).append("\n"); 
		query.append("					        MDM_CUSTOMER MCUST" ).append("\n"); 
		query.append("					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("					AND    REP_CUST_CNT_CD = MCUST.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    REP_CUST_SEQ = MCUST.CUST_SEQ" ).append("\n"); 
		query.append("					AND    MCUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND	NVL(MCUST.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("					AND    OFC.OFC_CD = NVL((SELECT CR_CLT_OFC_CD" ).append("\n"); 
		query.append("					                        FROM MDM_CR_CUST" ).append("\n"); 
		query.append("					                        WHERE (CUST_CNT_CD, CUST_SEQ) = (SELECT CUST_CNT_CD, CUST_SEQ" ).append("\n"); 
		query.append("					                                                            FROM   BKG_BOOKING B," ).append("\n"); 
		query.append("					                                                                    BKG_CUSTOMER C" ).append("\n"); 
		query.append("					                                                            WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("					                                                            AND    C.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("					                                                            AND    C.BKG_CUST_TP_CD = 'C'" ).append("\n"); 
		query.append("																				)" ).append("\n"); 
		query.append("					                        AND 0 < IB_CR_TERM_DYS" ).append("\n"); 
		query.append("											AND MCUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("					                        AND CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("					                        AND CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no]))," ).append("\n"); 
		query.append("					                    (SELECT  FINC_CTRL_OFC_CD" ).append("\n"); 
		query.append("					                        FROM MDM_LOCATION" ).append("\n"); 
		query.append("					                        WHERE LOC_CD = (SELECT DEL_CD" ).append("\n"); 
		query.append("					                                        FROM  BKG_BOOKING" ).append("\n"); 
		query.append("					                                        WHERE BKG_NO =@[bkg_no])" ).append("\n"); 
		query.append("					                    )" ).append("\n"); 
		query.append("					                    )" ).append("\n"); 
		query.append("					                    ORDER BY FLG" ).append("\n"); 
		query.append("					) A" ).append("\n"); 
		query.append("					WHERE " ).append("\n"); 
		query.append("					ROWNUM = 1)" ).append("\n"); 
		query.append("					) C," ).append("\n"); 
		query.append("				   (SELECT BK.BKG_NO," ).append("\n"); 
		query.append("					CASE WHEN (POR_L.CONTI_CD ='F' OR POR_L.CONTI_CD = 'E') AND(F.CUST_SEQ IS NOT NULL AND F.CUST_SEQ <> '0') AND EXISTS (SELECT 'Y' FROM MDM_LOCATION FL " ).append("\n"); 
		query.append("                                                                        WHERE  FL.CONTI_CD ='E' " ).append("\n"); 
		query.append("                                                                          AND  FL.DELT_FLG ='N'" ).append("\n"); 
		query.append("                                                                          AND  FL.CNT_CD = F.CUST_CNT_CD" ).append("\n"); 
		query.append("                                                                          AND ROWNUM =1 )" ).append("\n"); 
		query.append("                   THEN F.CUST_CNT_CD" ).append("\n"); 
		query.append("                   ELSE ''" ).append("\n"); 
		query.append("                   END F_PPD_PAYR_CNT_CD," ).append("\n"); 
		query.append("                   CASE WHEN (POR_L.CONTI_CD ='F' OR POR_L.CONTI_CD = 'E') AND(F.CUST_SEQ IS NOT NULL AND F.CUST_SEQ <> '0') AND EXISTS (SELECT 'Y' FROM MDM_LOCATION FL " ).append("\n"); 
		query.append("                                                                                WHERE  FL.CONTI_CD ='E' " ).append("\n"); 
		query.append("                                                                                  AND  FL.DELT_FLG ='N'" ).append("\n"); 
		query.append("                                                                                  AND  FL.CNT_CD = F.CUST_CNT_CD" ).append("\n"); 
		query.append("                                                                                  AND ROWNUM =1 )" ).append("\n"); 
		query.append("                   THEN F.CUST_SEQ" ).append("\n"); 
		query.append("                   ELSE 0" ).append("\n"); 
		query.append("                   END F_PPD_PAYR_CUST_SEQ" ).append("\n"); 
		query.append("				   FROM BKG_BOOKING BK,BKG_CUSTOMER F, MDM_LOCATION POR_L" ).append("\n"); 
		query.append("				   WHERE BK.BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("                     AND BK.BKG_STS_CD <>'X'" ).append("\n"); 
		query.append("                     AND BK.BKG_NO = F.BKG_NO" ).append("\n"); 
		query.append("                     AND F.BKG_CUST_TP_CD ='F'" ).append("\n"); 
		query.append("                     AND BK.POR_CD = POR_L.LOC_CD" ).append("\n"); 
		query.append("                     AND POR_L.DELT_FLG ='N'" ).append("\n"); 
		query.append("				   ) F" ).append("\n"); 
		query.append("					WHERE P.BKG_NO = C.BKG_NO(+)" ).append("\n"); 
		query.append("					  AND P.BKG_NO = F.BKG_NO(+)" ).append("\n"); 
		query.append("    ) T" ).append("\n"); 
		query.append("ON (T.BKG_NO = RATE.BKG_NO )" ).append("\n"); 
		query.append("WHEN MATCHED THEN" ).append("\n"); 
		query.append("    UPDATE SET" ).append("\n"); 
		query.append("      	PPD_RCV_OFC_CD = T.PPD_RCV_OFC_CD," ).append("\n"); 
		query.append("        PPD_PAYR_CNT_CD = T.PPD_PAYR_CNT_CD," ).append("\n"); 
		query.append("        PPD_PAYR_CUST_SEQ = T.PPD_PAYR_CUST_SEQ," ).append("\n"); 
		query.append("        CLT_OFC_CD = T.CLT_OFC_CD," ).append("\n"); 
		query.append("        CLT_PAYR_CNT_CD = T.CLT_PAYR_CNT_CD," ).append("\n"); 
		query.append("        CLT_PAYR_CUST_SEQ = T.CLT_PAYR_CUST_SEQ," ).append("\n"); 
		query.append("        UPD_DT = SYSDATE," ).append("\n"); 
		query.append("		UPD_USR_ID = @[user_id]" ).append("\n"); 
		query.append("    WHERE BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("      AND NOT EXISTS  (SELECT 'X' FROM BKG_CHG_RT C WHERE C.BKG_NO = @[bkg_no])--20160926 Prevent to automatically update" ).append("\n"); 
		query.append("WHEN NOT MATCHED THEN" ).append("\n"); 
		query.append("    INSERT(" ).append("\n"); 
		query.append("        BKG_NO," ).append("\n"); 
		query.append("		RT_BL_TP_CD," ).append("\n"); 
		query.append("		FRT_TERM_CD," ).append("\n"); 
		query.append("		BKG_CTRT_TP_CD," ).append("\n"); 
		query.append("		PPD_RCV_OFC_CD," ).append("\n"); 
		query.append("		PPD_PAYR_CNT_CD," ).append("\n"); 
		query.append("		PPD_PAYR_CUST_SEQ," ).append("\n"); 
		query.append("		CLT_OFC_CD," ).append("\n"); 
		query.append("		CLT_PAYR_CNT_CD," ).append("\n"); 
		query.append("		CLT_PAYR_CUST_SEQ," ).append("\n"); 
		query.append("        CRE_USR_ID," ).append("\n"); 
		query.append("        CRE_DT," ).append("\n"); 
		query.append("        UPD_USR_ID," ).append("\n"); 
		query.append("        UPD_DT" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    VALUES ( " ).append("\n"); 
		query.append("		T.BKG_NO," ).append("\n"); 
		query.append("		T.RT_BL_TP_CD," ).append("\n"); 
		query.append("		T.FRT_TERM_CD," ).append("\n"); 
		query.append("		T.BKG_CTRT_TP_CD," ).append("\n"); 
		query.append("		T.PPD_RCV_OFC_CD," ).append("\n"); 
		query.append("		T.PPD_PAYR_CNT_CD," ).append("\n"); 
		query.append("		T.PPD_PAYR_CUST_SEQ," ).append("\n"); 
		query.append("		T.CLT_OFC_CD," ).append("\n"); 
		query.append("		T.CLT_PAYR_CNT_CD," ).append("\n"); 
		query.append("		T.CLT_PAYR_CUST_SEQ," ).append("\n"); 
		query.append("	    T.CRE_USR_ID," ).append("\n"); 
		query.append("	    T.CRE_DT," ).append("\n"); 
		query.append("	    T.UPD_USR_ID," ).append("\n"); 
		query.append("	    T.UPD_DT" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("#end" ).append("\n"); 

	}
}