<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UnmatchBLDBDAOModifyCompareBkgRevUmchBkgUSQL">
			<desc><![CDATA[modifyCompareBkgRevUmchBkg]]></desc>
			<sql><![CDATA[
UPDATE BKG_REV_UMCH_BKG
SET   STL_SYS_DIFF_AMT 
                        = (
							SELECT SUM( DECODE(A.UMCH_BKG_CTRT_TP_CD, 'C', A.RAT_UT_QTY * A.FRT_RT_AMT / DECODE(A.RAT_UT_CD, 'PC', 100, 1) / B.USD_LOCL_XCH_RT, 0) )
                            	   -
					        	   SUM( DECODE(A.UMCH_BKG_CTRT_TP_CD, 'B', A.RAT_UT_QTY * A.FRT_RT_AMT / DECODE(A.RAT_UT_CD, 'PC', 100, 1) / B.USD_LOCL_XCH_RT, 0) )
					        FROM   BKG_REV_UMCH_ITM_DTL  A ,
						           GL_MON_XCH_RT         B
						    WHERE  B.ACCT_XCH_RT_YRMON = LEAST(( SELECT TO_CHAR(RT_APLY_DT, 'YYYYMM') FROM BKG_RATE WHERE BKG_NO = @[bkg_no] ), (SELECT MAX(ACCT_XCH_RT_YRMON) FROM GL_MON_XCH_RT ))
	                        AND     B.ACCT_XCH_RT_LVL   = '1'
				            AND     B.CURR_CD           = A.CURR_CD
					        AND     A.BKG_NO            = @[bkg_no]
						    AND     A.UMCH_BKG_SEQ      = TO_NUMBER(@[max_umch_bkg_seq])
						  )
	  ,STL_MNL_DIFF_AMT
                        = (
							SELECT SUM( DECODE(A.UMCH_BKG_CTRT_TP_CD, 'C', A.RAT_UT_QTY * A.FRT_RT_AMT / DECODE(A.RAT_UT_CD, 'PC', 100, 1) / B.USD_LOCL_XCH_RT, 0) )
                            	   -
					        	   SUM( DECODE(A.UMCH_BKG_CTRT_TP_CD, 'B', A.RAT_UT_QTY * A.FRT_RT_AMT / DECODE(A.RAT_UT_CD, 'PC', 100, 1) / B.USD_LOCL_XCH_RT, 0) )
					        FROM   BKG_REV_UMCH_ITM_DTL  A ,
						           GL_MON_XCH_RT         B
						    WHERE  B.ACCT_XCH_RT_YRMON = LEAST(( SELECT TO_CHAR(RT_APLY_DT, 'YYYYMM') FROM BKG_RATE WHERE BKG_NO = @[bkg_no] ), (SELECT MAX(ACCT_XCH_RT_YRMON) FROM GL_MON_XCH_RT ))
	                        AND     B.ACCT_XCH_RT_LVL   = '1'
				            AND     B.CURR_CD           = A.CURR_CD
					        AND     A.BKG_NO            = @[bkg_no]
						    AND     A.UMCH_BKG_SEQ      = TO_NUMBER(@[max_umch_bkg_seq])
						  )
WHERE  BKG_NO       = @[bkg_no]
AND    UMCH_BKG_SEQ = TO_NUMBER(@[max_umch_bkg_seq])			]]></sql>
			<params>
				<param name="umch_rsn_rmk" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="max_umch_bkg_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
