<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AustraliaManifestListDownloadDBDAOsearchAusCarlstUbmreqRSQL">
			<desc><![CDATA[]]></desc>
			<sql><![CDATA[
SELECT DISTINCT MAX(BKG.BKG_NO) OVER (PARTITION BY CNTR.CNTR_NO) AS BKG_NO,
       CNTR.CNTR_NO,
       BKG.DE_TERM_CD,
       VVD.POL_CD AS VVD_POL,
       VVD.POD_CD AS VVD_POD,
       BKG.POD_CD AS BKG_POD,  
       BKG.DEL_CD AS BKG_DEL,
       (SELECT /*+ INDEX_DESC(SND XAK1BKG_CSTMS_AUS_SND_LOG) */
               TO_CHAR(SND.SND_DT, 'YYYY-MM-DD HH24:MI:SS')
          FROM BKG_CSTMS_AUS_SND_LOG SND
         WHERE SND.CNTR_NO = CNTR.CNTR_NO
           AND SND.AUS_SND_LOG_ID = @[search_div]
           AND ROWNUM = 1) AS SND_DT,
       (SELECT /*+ INDEX_DESC(SND XAK1BKG_CSTMS_AUS_SND_LOG) */
#if (${search_div} == 'UBMREQ')
               CASE WHEN LOG_FLG = 'N' THEN 'Sending'
                    WHEN CSTMS_RQST_FLG = 'Y' THEN 'Error'
                    ELSE 'Success'
               END
#else
               DECODE(CSTMS_RQST_FLG, 'Y', 'Error', 'Success')
#end
          FROM BKG_CSTMS_AUS_SND_LOG SND
         WHERE SND.CNTR_NO = CNTR.CNTR_NO
           AND SND.AUS_SND_LOG_ID = @[search_div]
           AND ROWNUM = 1) AS RCV_RSLT,
       (SELECT /*+ INDEX_DESC(SND XAK1BKG_CSTMS_AUS_SND_LOG) */
               SND.EDI_REF_ID
          FROM BKG_CSTMS_AUS_SND_LOG SND
         WHERE SND.CNTR_NO = CNTR.CNTR_NO
           AND SND.AUS_SND_LOG_ID = @[search_div]
           AND ROWNUM = 1) AS EDI_REF_ID

  FROM BKG_VVD VVD,
       BKG_CONTAINER CNTR,
       BKG_BOOKING BKG

 WHERE VVD.VSL_CD = SUBSTR(@[vvd], 1, 4)
   AND VVD.SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
   AND VVD.SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
   AND VVD.POD_CD = @[pod_cd]
   AND VVD.BKG_NO = BKG.BKG_NO
   AND BKG.BKG_STS_CD NOT IN ('S', 'X')
#if (${search_div} == 'UBMREQ')
   AND BKG.BKG_CGO_TP_CD = 'F'
#else
   AND BKG.BKG_CGO_TP_CD != 'F'
#end
#if (${del_cd} != '')
   AND BKG.DEL_CD = @[del_cd]
#end
   AND CNTR.BKG_NO = BKG.BKG_NO			]]></sql>
			<params>
				<param name="search_div" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
