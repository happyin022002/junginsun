<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ArgManifestListDownloadDBDAOsearchManifestListRSQL">
			<desc><![CDATA[searchManifestList]]></desc>
			<sql><![CDATA[
SELECT MAIN2.*
      ,NVL(IN_TZ_FLG,TS_IND) AS IN_TZ_FLG
FROM
(
SELECT MAIN.*
      , (SELECT CASE WHEN MAX(V2) >=2 THEN 'S'
                 ELSE 'N'
                 END TS_IND
           FROM (SELECT LEVEL SEQ
		   FROM   DUAL
		   CONNECT BY LEVEL <= 5
		   ) V1) TS_IND
FROM
(SELECT SUM(SEQ) OVER (ORDER BY BL_NO) ROW_SEQ
      ,TB.*
      ,NVL((SELECT 'Y'  
            FROM BKG_CSTMS_CD_CONV_CTNT
            WHERE CNT_CD = 'US'
            AND CSTMS_DIV_ID = 'NA_STAFF'
            AND DELT_FLG = 'N'
            AND ATTR_CTNT1 = @[upd_usr_id]
            AND ROWNUM = 1), 'N') AS NA_STF_FLG
	,(SELECT MAX(ROWNUM) SEQ
	  FROM BKG_VVD VVD, VSK_VSL_PORT_SKD VPS_ETA, VSK_VSL_PORT_SKD VPS_ETD, BKG_BOOKING BKG
	  WHERE VVD.VSL_CD     = VPS_ETD.VSL_CD(+)
	  AND VVD.SKD_VOY_NO = VPS_ETD.SKD_VOY_NO(+)
	  AND VVD.SKD_DIR_CD = VPS_ETD.SKD_DIR_CD(+)
	  AND VVD.POL_CD     = VPS_ETD.VPS_PORT_CD(+)
	  AND NVL(VVD.POL_CLPT_IND_SEQ,1) = VPS_ETD.CLPT_IND_SEQ(+)
      AND VVD.VSL_CD     = VPS_ETA.VSL_CD(+)
	  AND VVD.SKD_VOY_NO = VPS_ETA.SKD_VOY_NO(+)
	  AND VVD.SKD_DIR_CD = VPS_ETA.SKD_DIR_CD(+)
      AND VVD.POD_CD     = VPS_ETA.VPS_PORT_CD(+)
	  AND NVL(VVD.POD_CLPT_IND_SEQ,1) = VPS_ETA.CLPT_IND_SEQ(+)
      AND VVD.BKG_NO     = TB.BKG_NO
      AND BKG.BKG_NO     = VVD.BKG_NO) V2
  FROM (
SELECT DECODE(LAG(A.BL_NO) OVER (ORDER BY A.BL_NO), A.BL_NO, 0, 1) AS SEQ
      ,A.*
  FROM (
SELECT DECODE(BL.BL_NO, NULL, 'N', 'Y') AS DOWN_YN
      ,BKG.BKG_NO
      ,BKG.BL_NO
      ,CNT.CNTR_NO
      ,VVD.POL_YD_CD
      ,VVD.POL_CD
      ,VVD.POD_CD
      ,VVD.POD_YD_CD
      ,BKG.DEL_CD
      ,VVD.VSL_CD
      ,VVD.SKD_VOY_NO
      ,VVD.SKD_DIR_CD
      ,TO_CHAR(LOG.SND_DT, 'YYYY-MM-DD HH24:MI') AS SND_DT
      ,LOG.CRE_USR_ID
      ,VSL.VSL_ENG_NM
      ,VSL.LLOYD_NO
      ,VSL.CALL_SGN_NO
      ,TO_CHAR(SKD.VPS_ETA_DT,'YYYY-MM-DD HH24:MI') AS ETA_DT
      ,TO_CHAR(SKD.VPS_ETD_DT,'YYYY-MM-DD HH24:MI') AS ETD_DT
      ,@[mode_type] AS MODE_TYPE
      ,ROW_NUMBER() OVER (PARTITION BY CNT.BKG_NO, CNT.CNTR_NO  ORDER BY LOG.SND_DT DESC) AS RNUM
      ,BL.IN_TZ_FLG AS IN_TZ_FLG
  FROM BKG_BOOKING           BKG
      ,BKG_VVD               VVD
      ,BKG_CONTAINER         CNT
      ,VSK_VSL_PORT_SKD      SKD
      ,MDM_VSL_CNTR          VSL
      ,BKG_CSTMS_ARG_BL      BL
      ,BKG_CSTMS_ARG_SND_LOG LOG
 WHERE BKG.BKG_NO       = VVD.BKG_NO
   AND BKG.BKG_STS_CD <> 'X'
   AND BKG.BKG_NO       = CNT.BKG_NO
   AND VVD.VSL_CD       = SKD.VSL_CD
   AND VVD.SKD_VOY_NO   = SKD.SKD_VOY_NO
   AND VVD.SKD_DIR_CD   = SKD.SKD_DIR_CD
   AND BKG.BL_NO        = BL.BL_NO(+)
   AND BL.BL_NO         = LOG.BL_NO(+)
   AND LOG.IO_BND_CD(+) = @[mode_type]
   AND SKD.VSL_CD       = VSL.VSL_CD
#if (${bl_no} != '') 
   AND BKG.BL_NO        = @[bl_no]
#else
   AND VVD.VSL_CD       = SUBSTR(@[vvd_cd], 1, 4)
   AND VVD.SKD_VOY_NO   = SUBSTR(@[vvd_cd], 5, 4)
   AND VVD.SKD_DIR_CD   = SUBSTR(@[vvd_cd], 9, 1)
#end
    #if (${pod_cd} != '') 
   AND VVD.POD_CD       = @[pod_cd]
    #end
    #if (${pol_cd} != '') 
   AND VVD.POL_CD       = @[pol_cd]
    #end
    #if (${pod_yd_cd} != '') 
   AND VVD.POD_YD_CD    = @[pod_yd_cd]
    #end
    #if (${pol_yd_cd} != '') 
   AND VVD.POL_YD_CD    = @[pol_yd_cd]
    #end
#if (${mode_type} == 'I')
   AND VVD.POD_CD       = SKD.VPS_PORT_CD
   AND VVD.POD_CLPT_IND_SEQ = SKD.CLPT_IND_SEQ
#else
   AND VVD.POL_CD       = SKD.VPS_PORT_CD
   AND VVD.POL_CLPT_IND_SEQ = SKD.CLPT_IND_SEQ
#end
       ) A
 WHERE RNUM = 1
) TB
)MAIN)MAIN2			]]></sql>
			<params>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="mode_type" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_yd_cd" type="12" value="" out="N"/>
				<param name="pol_yd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
