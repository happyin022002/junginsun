<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TransshipmentMgtDBDAOsearchTargerBkgForAssignRSQL">
			<desc><![CDATA[vvd assign에서 next vvd를 지정할 대상을 조회한다.]]></desc>
			<sql><![CDATA[
select bk.bl_no
        , bk.bkg_no     
        , cntr.cntr_no
        , cntr.cntr_tpsz_cd
        , cntr.cntr_wgt
        , cntr.wgt_ut_cd
        , bk.pol_cd
        , bk.del_cd   
        , next_vvd.pod_cd next_port
        , substr(next_vvd.pod_yd_cd, 6, 2) next_port_yard
		, nvl(next_vvd.pod_yd_cd,next_vvd.pod_cd) next_tmnl
        , former_vvd.vsl_cd||former_vvd.skd_voy_no||former_vvd.skd_dir_cd former_vvd
        , to_char(former_skd.vps_etb_dt, 'yyyy-mm-dd hh24') etb
        , former_vvd.pod_yd_cd tmnl
        , next_vvd.vsl_cd||next_vvd.skd_voy_no||next_vvd.skd_dir_cd next_vvd
        , next_vvd.op_cd
        , to_char(next_skd.vps_etd_dt, 'yyyy-mm-dd hh24') etd
        , cntr.dcgo_flg
        , cntr.rc_flg
        , cntr.awk_cgo_flg
        , (select decode(nvl(st.stwg_cd, 'N'), 'N', 'N', 'Y') from bkg_booking st where st.bkg_no = bk.bkg_no) st
        , decodE(nvl(rmk.bkg_no, 'X'), 'X', 'X', 'Y') rmk  
        , next_vvd.vsl_pre_pst_cd  
        , next_vvd.vsl_seq
		, (select op_cntr_qty from bkg_quantity where bkg_no = cntr.bkg_no and cntr_tpsz_cd = cntr.cntr_tpsz_cd) as cntr_qty         
  from bkg_booking bk
        , bkg_vvd former_vvd
        , bkg_vvd next_vvd
        , vsk_vsl_port_skd former_skd
        , vsk_vsl_port_skd next_skd
        , bkg_container cntr
        , BKG_TS_RMK rmk
 where bk.bkg_no = former_vvd.bkg_no
   and bk.bkg_no = next_vvd.bkg_no
   and bk.bkg_no = cntr.bkg_no(+)
   and bk.bkg_no = rmk.bkg_no(+)
   and 'N'       = rmk.TS_RMK_DELT_FLG (+)
   and bk.bkg_sts_Cd NOT IN ('X','S')
   and former_vvd.vsl_cd            = former_skd.vsl_cd
   and former_vvd.skd_voy_no        = former_skd.skd_voy_no
   and former_vvd.skd_dir_cd        = former_skd.skd_dir_cd
   and former_vvd.pod_cd            = former_skd.vps_port_cd
   and former_vvd.pod_CLPT_IND_SEQ  = former_skd.CLPT_IND_SEQ
   and former_vvd.pod_cd            = next_vvd.pol_cd
   and next_vvd.vsl_cd              = next_skd.vsl_cd(+)
   and next_vvd.skd_voy_no          = next_skd.skd_voy_no(+)
   and next_vvd.skd_dir_cd          = next_skd.skd_dir_cd(+)
   and next_vvd.pol_cd              = next_skd.vps_port_cd(+)
   and next_vvd.pol_CLPT_IND_SEQ    = next_skd.CLPT_IND_SEQ(+)
   and next_vvd.vsl_pre_pst_cd = 'U'
   
   #if (${former_vvd}!='')
   	and former_vvd.vsl_cd        = substr(@[former_vvd], 1, 4)
   	and former_vvd.skd_voy_no    = substr(@[former_vvd], 5, 4)
   	and former_vvd.skd_dir_cd    = substr(@[former_vvd], 9, 1)
   #end

   #if(${relay_port} !='')
   	and former_vvd.pod_cd        = substr(@[relay_port], 1, 5)
   #end
   #if(${relay_port_yard_cd} !='')
   	and former_vvd.pod_yd_cd     like @[relay_port_yard_cd]||'%'
   #end
   #if (${pol_cd} !='') 
   	and bk.pol_cd                = @[pol_cd]
   #end
   #if (${next_port} !='')
   	and next_vvd.pod_cd          = @[next_port]
   #end
   #if (${pod_cd}!='')   
   	and bk.pod_cd                = @[pod_cd]
   #end
   #if (${next_vvd} !='')
   	and next_vvd.vsl_cd          = substr(@[next_vvd], 1, 4)
   	and next_vvd.skd_voy_no      = substr(@[next_vvd], 5, 4)
   	and next_vvd.skd_dir_cd      = substr(@[next_vvd], 9, 1)
   #end
   #if (${next_vvd_select} !=''&&${next_vvd_select} != 'All')
		#if(${next_vvd_select} == 'Assigned')
				AND (NEXT_VVD.VSL_CD IS NOT NULL OR NEXT_VVD.VSL_CD <> 'HJXX' OR NEXT_VVD.VSL_CD <> 'HJYY' OR NEXT_VVD.VSL_CD <> 'HJZZ')
	    #end
	
		#if(${next_vvd_select} == 'Not Assigned')
				AND (NEXT_VVD.VSL_CD IS NULL OR NEXT_VVD.VSL_CD = 'HJXX' OR NEXT_VVD.VSL_CD = 'HJYY' OR NEXT_VVD.VSL_CD = 'HJZZ')
		#end
   #end
   
   #if (${rc_flg} !='')
       and bk.rc_flg      = 'Y'  
   #end	
   
   #if (${dcgo_flg} !='')
       and bk.dcgo_flg    = 'Y'
   #end
   
   #if (${awk_cgo_flg} !='')
       and bk.awk_cgo_flg = 'Y'
   #end

   #if (${rd_cgo_flg} !='')
       and bk.rd_cgo_flg  = 'Y'
   #end
 order by next_vvd.vsl_cd
		, next_vvd.skd_voy_no
		, next_vvd.skd_dir_cd
		, next_vvd.pod_cd			]]></sql>
			<params>
				<param name="former_vvd" type="12" value="" out="N"/>
				<param name="relay_port" type="12" value="" out="N"/>
				<param name="relay_port_yard_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="next_port" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="next_vvd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
