<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PRISimulationDBDAORsltTAAContractInfoListRSQL">
			<desc><![CDATA[GET TAA CONTRACT INFO]]></desc>
			<sql><![CDATA[
SELECT 
       'TAA'                       AS CNTR_TP
      , TD.TAA_NO                   AS CNTR_NO
      , MC.CUST_LGL_ENG_NM          AS CUST_NM
      , 'N/A'                       AS ACT_CUST_NM
      , TA.RESPB_SREP_CD            AS SREP_CD 
      ,(SELECT MC.CMDT_NM
        FROM MDM_COMMODITY MC
        WHERE MC.CMDT_CD = TM.CMDT_CD) AS CMDT_NM
     ,(SELECT LISTAGG(OP.ROUT_PNT_LOC_CD || NVL2(CD.INTG_CD_VAL_DP_DESC, '(' ||CD.INTG_CD_VAL_DP_DESC|| ')', ''), ';') WITHIN GROUP (ORDER BY OP.TRI_PROP_NO)
       FROM   PRI_TRI_RT_ROUT_PNT  OP, COM_INTG_CD_DTL CD
       WHERE  OP.TRI_PROP_NO       = TL.TRI_PROP_NO
         AND  OP.ORG_DEST_TP_CD    = 'O'
         AND  CD.INTG_CD_ID        = 'CD02138' 
         AND  CD.INTG_CD_VAL_CTNT  = OP.RCV_DE_TERM_CD
     ) AS ORG_CD 
     ,(SELECT LISTAGG(OV.ROUT_VIA_PORT_CD, ';') WITHIN GROUP (ORDER BY OV.TRI_PROP_NO)
       FROM   PRI_TRI_RT_ROUT_VIA  OV
       WHERE  OV.TRI_PROP_NO           = TL.TRI_PROP_NO
       AND    OV.ORG_DEST_TP_CD    = 'O'
     ) AS ORG_VIA_CD 
     ,(SELECT LISTAGG(DV.ROUT_VIA_PORT_CD, ';') WITHIN GROUP (ORDER BY DV.TRI_PROP_NO)
       FROM   PRI_TRI_RT_ROUT_VIA  DV
       WHERE  DV.TRI_PROP_NO           = TL.TRI_PROP_NO
       AND    DV.ORG_DEST_TP_CD    = 'D'
     ) AS DEST_VIA_CD 
     ,(SELECT LISTAGG(DP.ROUT_PNT_LOC_CD || NVL2(CD.INTG_CD_VAL_DP_DESC, '(' ||CD.INTG_CD_VAL_DP_DESC|| ')', ''), ';') WITHIN GROUP (ORDER BY DP.TRI_PROP_NO)
       FROM   PRI_TRI_RT_ROUT_PNT  DP, COM_INTG_CD_DTL CD
       WHERE  DP.TRI_PROP_NO           = TL.TRI_PROP_NO
       AND    DP.ORG_DEST_TP_CD    = 'D'
       AND    CD.INTG_CD_ID        = 'CD02138' 
       AND    CD.INTG_CD_VAL_CTNT  = DP.RCV_DE_TERM_CD
     ) AS DEST_CD 
     ,(SELECT LISTAGG(INTG_CD_VAL_CTNT, ';') WITHIN GROUP (ORDER BY CD.INTG_CD_VAL_DP_SEQ)
       FROM   COM_INTG_CD_DTL CD
       WHERE  CD.INTG_CD_ID  = 'CD01701'
       AND    EXISTS
              (SELECT 'X'
               FROM   PRI_TRI_RT           RT
               WHERE  1=1
               AND     RT.TRI_PROP_NO        = TR.TRI_PROP_NO
               AND     RT.AMDT_SEQ           = TR.AMDT_SEQ
               AND     RT.PRC_CGO_TP_CD      = CD.INTG_CD_VAL_CTNT)
      ) AS PRC_CGO_TP_CD
    FROM  PRI_TAA_HDR TD
        , PRI_TAA_MN TA
        , PRI_TAA_TRI_LIST TL
        , PRI_TRI_MN TM
        , PRI_TRI_RT TR
        , MDM_CUSTOMER MC
        , MDM_SLS_REP MR 
    WHERE   1=1
    AND TA.TAA_PROP_NO = TD.TAA_PROP_NO
    AND TL.TAA_PROP_NO = TA.TAA_PROP_NO
    AND TL.AMDT_SEQ    = TA.AMDT_SEQ
    AND TM.TRI_PROP_NO = TL.TRI_PROP_NO
    AND TR.TRI_PROP_NO = TM.TRI_PROP_NO
    AND MC.CUST_CNT_CD = TA.CTRT_CUST_CNT_CD
    AND MC.CUST_SEQ    = TA.CTRT_CUST_SEQ
    AND MR.SREP_CD     = TA.RESPB_SREP_CD
    
    AND TO_DATE ( @[seff_dt],'YYYY-MM-DD' ) BETWEEN TA.EFF_DT AND TA.EXP_DT 
    AND TR.AMDT_SEQ = (SELECT MAX ( TT.AMDT_SEQ ) 
                             FROM PRI_TRI_RT TT
                            WHERE TT.TRI_PROP_NO = TR.TRI_PROP_NO
                              AND TT.PROP_STS_CD = 'F'
                              AND TA.CFM_FLG = 'Y'
                              AND TO_DATE ( @[seff_dt],'YYYY-MM-DD' ) BETWEEN TT.EFF_DT AND TT.EXP_DT)
    AND     TA.SVC_SCP_CD = @[ssvc_scp_cd]
    #if (${sctrt_cust} != '' && ${sctrt_cust_seq} != '')
    AND     TA.CTRT_CUST_CNT_CD          = @[sctrt_cust]
    AND     TA.CTRT_CUST_SEQ             = @[sctrt_cust_seq]
    #end
    #if (${scontract_no} != '')
    AND TD.TAA_NO                LIKE @[scontract_no]||'%'
    #end
    #if (${sprop_scp_srep_cd} != '')
    AND TA.RESPB_SREP_CD            = @[sprop_scp_srep_cd]
    #end
    #if (${sprc_ctrt_cust_tp_cd} != '')
    AND TA.PRC_CTRT_CUST_TP_CD      = @[sprc_ctrt_cust_tp_cd]
    #end
    #if (${sprop_scp_ofc_cd} != '')
    AND TA.RESPB_SLS_OFC_CD         = @[sprop_scp_ofc_cd]
    #end
    #if (${srout_pnt_loc_def_cd_ori} != '')
    AND     EXISTS
           (SELECT 'X'
            FROM   PRI_TRI_RT_ROUT_PNT  ORIG
            WHERE  1=1
            AND     ORIG.TRI_PROP_NO        = TL.TRI_PROP_NO
            AND     ORIG.ORG_DEST_TP_CD     = 'O'
            AND     ORIG.ROUT_PNT_LOC_CD    LIKE @[srout_pnt_loc_def_cd_ori]||'%'
            )
    #end
    #if (${srout_pnt_loc_def_cd_dest} != '')
    AND     EXISTS
           (SELECT 'X'
            FROM   PRI_TRI_RT_ROUT_PNT  DEST
            WHERE  1=1
            AND     DEST.TRI_PROP_NO        = TL.TRI_PROP_NO
            AND     DEST.ORG_DEST_TP_CD     = 'D'
            AND     DEST.ROUT_PNT_LOC_CD    LIKE @[srout_pnt_loc_def_cd_dest]||'%'
            )
    #end
    #if (${srout_via_port_def_cd_ori} != '')
    AND     EXISTS
           (SELECT 'X'
            FROM   PRI_TRI_RT_ROUT_VIA  OVIA
            WHERE  1=1
            AND     OVIA.TRI_PROP_NO        = TL.TRI_PROP_NO
            AND     OVIA.ORG_DEST_TP_CD     = 'O'
            AND     OVIA.ROUT_VIA_PORT_CD    LIKE @[srout_via_port_def_cd_ori]||'%'
            )
    #end
    #if (${srout_via_port_def_cd_dest} != '')
    AND     EXISTS
           (SELECT 'X'
            FROM   PRI_TRI_RT_ROUT_VIA  DVIA
            WHERE  1=1
            AND     DVIA.TRI_PROP_NO        = TL.TRI_PROP_NO
            AND     DVIA.ORG_DEST_TP_CD     = 'D'
            AND     DVIA.ROUT_VIA_PORT_CD    LIKE @[srout_via_port_def_cd_dest]||'%'
            )
    #end
    #if (${sprc_cgo_tp_cd} != '')
    AND     EXISTS
           (SELECT 'X'
            FROM   PRI_TRI_RT           RT
            WHERE  1=1
            AND     RT.TRI_PROP_NO        = TR.TRI_PROP_NO
            AND     RT.AMDT_SEQ           = TR.AMDT_SEQ
            AND     RT.PRC_CGO_TP_CD      = @[sprc_cgo_tp_cd]
            )
    #end
    #if (${scust} != '' && ${scust_seq} != '')
    AND    1 = -1
    #end
 ORDER BY TAA_NO, CUST_NM, SREP_CD, CMDT_NM			]]></sql>
			<params>
				<param name="seff_dt" type="12" value="" out="N"/>
				<param name="ssvc_scp_cd" type="12" value="" out="N"/>
				<param name="sctrt_cust" type="12" value="" out="N"/>
				<param name="sctrt_cust_seq" type="12" value="" out="N"/>
				<param name="scontract_no" type="12" value="" out="N"/>
				<param name="sprop_scp_srep_cd" type="12" value="" out="N"/>
				<param name="sprc_ctrt_cust_tp_cd" type="12" value="" out="N"/>
				<param name="sprop_scp_ofc_cd" type="12" value="" out="N"/>
				<param name="srout_pnt_loc_def_cd_ori" type="12" value="" out="N"/>
				<param name="srout_pnt_loc_def_cd_dest" type="12" value="" out="N"/>
				<param name="srout_via_port_def_cd_ori" type="12" value="" out="N"/>
				<param name="srout_via_port_def_cd_dest" type="12" value="" out="N"/>
				<param name="sprc_cgo_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
