<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TransshipmentMgtDBDAOsearchTSSummaryRSQL">
			<desc><![CDATA[T/S port에 입항한 1st VVD를 기준으로 연결되는 선명 별로 물량을 조회한다.   ]]></desc>
			<sql><![CDATA[
select 
#if (${disc_load_cd}=='D')
       vvd2.vsl_cd||vvd2.skd_voy_no||vvd2.skd_dir_cd vvd  
       , vvd2.pol_yd_cd
       , to_char(skd2.vps_eta_dt, 'yyyy-mm-dd') eta,
#elseif (${disc_load_cd}=='L')
       vvd1.vsl_cd||vvd1.skd_voy_no||vvd1.skd_dir_cd vvd 
       , vvd1.pod_yd_cd
       , to_char(skd1.vps_eta_dt, 'yyyy-mm-dd') eta,
#end 
 sum(decode(substr(cntr.cntr_tpsz_cd, 2, 1), '2', CNTR_VOL_QTY, 0)) ft20
, sum(decode(substr(cntr.cntr_tpsz_cd, 2, 1), '2', 0, CNTR_VOL_QTY)) ft40
, sum(decode(cntr.RD_CGO_FLG,'Y',0,decode(cntr.cntr_tpsz_cd, 'R2', CNTR_VOL_QTY,  0))) rf20
, sum(decode(cntr.RD_CGO_FLG,'Y',0,decode(cntr.cntr_tpsz_cd, 'R4', CNTR_VOL_QTY, 'R5', CNTR_VOL_QTY, 0))) rf40
  from bkg_booking bk
        , bkg_container cntr
        , bkg_vvd vvd1, vsk_vsl_port_skd skd1
        , bkg_vvd vvd2, vsk_vsl_port_skd skd2
 where bk.bkg_no         = VVD1.bkg_no 
   and bk.bkg_no         = VVD2.bkg_no 
   and vvd1.pod_cd       = vvd2.pol_cd
   AND BK.BKG_STS_CD     <> 'X'
   and bk.bkg_no         = cntr.bkg_no 
   and vvd1.vsl_cd        = skd1.vsl_cd
   and vvd1.skd_voy_no    = skd1.skd_voy_no
   and vvd1.skd_dir_cd    = skd1.skd_dir_cd
   and vvd1.pod_cd        = skd1.vps_port_cd 
   and vvd1.pod_clpt_ind_seq  = skd1.clpt_ind_seq
   and vvd2.vsl_cd        = skd2.vsl_cd
   and vvd2.skd_voy_no    = skd2.skd_voy_no
   and vvd2.skd_dir_cd    = skd2.skd_dir_cd
   and vvd2.pol_cd        = skd2.vps_port_cd
   and vvd2.pol_clpt_ind_seq  = skd2.clpt_ind_seq  

#if (${loc_cd}!='')
   and vvd1.pod_cd  = @[loc_cd]             
#end 

#if (${loc_cd}!='' && ${loc_yd_cd} !='')
   and vvd1.pod_yd_cd =@[loc_cd]||@[loc_yd_cd]           
#end

#if (${vvd} !='')
	#if (${disc_load_cd}=='D')
		and vvd1.vsl_Cd       = substr(@[vvd], 1, 4)
   		and vvd1.skd_voy_no   = substr(@[vvd], 5, 4)
   		and vvd1.skd_dir_cd   = substr(@[vvd], 9, 1)
	#elseif (${disc_load_cd}=='L')
		and vvd2.vsl_Cd       = substr(@[vvd], 1, 4)
   		and vvd2.skd_voy_no   = substr(@[vvd], 5, 4)
   		and vvd2.skd_dir_cd   = substr(@[vvd], 9, 1)
	#end
#end

#if (${search_kind_cd} =='D')
     #if (${disc_load_cd}=='D'&& ${dur_from}!=''&& ${dur_to}!='')
		and skd1.vps_eta_dt > to_date(@[dur_from], 'yyyy-mm-dd')
		and skd1.vps_eta_dt < to_date(@[dur_to],   'yyyy-mm-dd')+1
     #elseif (${disc_load_cd}=='L' && ${dur_from}!=''&& ${dur_to}!='')
	 	and skd2.vps_etd_dt > to_date(@[dur_from], 'yyyy-mm-dd')
	 	and skd2.vps_etd_dt < to_date(@[dur_to],   'yyyy-mm-dd')+1
     #end
#end

#if(${search_kind_cd} =='E' && ${vvd}=='' && 0==1)
--적용 중지
	 #if (${disc_load_cd}=='D'&& ${vps_etd_dt}!='')
        and skd1.vps_eta_dt > to_date(@[vps_etd_dt], 'yyyy-mm-dd')
        and skd1.vps_eta_dt < to_date(@[vps_etd_dt],   'yyyy-mm-dd')+1
     #elseif (${disc_load_cd}=='L' && ${vps_etd_dt}!='')
        and skd2.vps_etd_dt > to_date(@[vps_etd_dt], 'yyyy-mm-dd')
        and skd2.vps_etd_dt < to_date(@[vps_etd_dt],   'yyyy-mm-dd')+1
     #end 
#end

#if (${pol_cd} !='')
     and bk.pol_cd = @[pol_cd]
#end

#if (${pod_cd} !='')
     and bk.pod_cd = @[pod_cd] 
#end

#if (${disc_load_cd}=='D' && ${op_cd} !='' )
             and vvd2.op_cd = @[op_cd]
#elseif (${disc_load_cd}=='L' && ${op_cd} !='')
             and vvd1.op_cd = @[op_cd]
#end

#if (${special} != 'SD')
			 #if (${special} == 'All')
                 and (CNTR.dcgo_flg = 'Y'
                 or CNTR.rc_flg = 'Y'
                 or CNTR.awk_cgo_flg = 'Y'
                 or CNTR.rd_cgo_flg  = 'Y'
                 or bk.stwg_cd  is not null)
             #elseif (${special} == 'DG')
                 and CNTR.dcgo_flg = 'Y'
             #elseif (${special} == 'RF')
                 and CNTR.rc_flg = 'Y'
             #elseif (${special} == 'AK') 
                 and CNTR.awk_cgo_flg = 'Y'
             #elseif (${special} == 'ST')
                 and bk.stwg_cd  is not null
             #elseif (${special} == 'RD')
                 and CNTR.rd_cgo_flg  = 'Y'
             #end
#end


#if (${disc_load_cd}=='D')
group by 
       vvd2.vsl_cd||vvd2.skd_voy_no||vvd2.skd_dir_cd 
       , vvd2.pol_yd_cd
       , to_char(skd2.vps_eta_dt, 'yyyy-mm-dd') 
#elseif (${disc_load_cd}=='L')
group by 
       vvd1.vsl_cd||vvd1.skd_voy_no||vvd1.skd_dir_cd 
       , vvd1.pod_yd_cd
       , to_char(skd1.vps_eta_dt, 'yyyy-mm-dd')    
#end


#if (${disc_load_cd}=='D')
order by  
       vvd2.vsl_cd||vvd2.skd_voy_no||vvd2.skd_dir_cd 
       , vvd2.pol_yd_cd
       , to_char(skd2.vps_eta_dt, 'yyyy-mm-dd') 
#elseif (${disc_load_cd}=='L')
order by  
       vvd1.vsl_cd||vvd1.skd_voy_no||vvd1.skd_dir_cd 
       , vvd1.pod_yd_cd
       , to_char(skd1.vps_eta_dt, 'yyyy-mm-dd') 
#end			]]></sql>
			<params>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="loc_yd_cd" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="dur_from" type="12" value="" out="N"/>
				<param name="dur_to" type="12" value="" out="N"/>
				<param name="vps_etd_dt" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="op_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
