<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOInvoiceDAOSearchChaterInvoiceSdmsListRSQL">
			<desc><![CDATA[TCharterIOInvoiceDAOSearchChaterInvoiceSdmsListRSQL]]></desc>
			<sql><![CDATA[
SELECT A.STV_DMG_NO
     , A.VSL_CD
     , A.SKD_VOY_NO || A.SKD_DIR_CD DIRECTION
     , NVL(E.REV_DIR_CD,( SELECT LISTAGG (V.RLANE_DIR_CD, '|') WITHIN GROUP ( ORDER BY V.VSL_CD||V.SKD_VOY_NO||V.SKD_DIR_CD)
                            FROM AR_MST_REV_VVD V
                           WHERE V.VSL_CD = A.VSL_CD
                             AND V.SKD_VOY_NO = A.SKD_VOY_NO
                             AND V.SKD_DIR_CD = A.SKD_DIR_CD)) AS REV_DIR_CD
     , A.VPS_PORT_CD
     , (SELECT INTG_CD_VAL_DP_DESC
          FROM COM_INTG_CD_DTL
         WHERE INTG_CD_ID = 'CD01882'
           AND INTG_CD_VAL_CTNT = B.STV_DMG_PRT_CATE_CD) STV_DMG_PRT_CATE_CD
     , DECODE(C.STV_DMG_STL_PROC_STS_CD,'P',C.PAY_CURR_CD) PAY_CURR_CD
     , DECODE(C.STV_DMG_STL_PROC_STS_CD,'P',TO_CHAR(C.PAY_LOCL_AMT,'FM999,999,999,999,990.00')) PAY_LOCL_AMT
     , DECODE(C.STV_DMG_STL_PROC_STS_CD,'P',C.BIL_INV_NO) BIL_INV_NO
     , TO_CHAR(A.STV_DMG_EVNT_DT,'YYYYMMDD') PAY_DT
     , DECODE(E.SDMS_NO,NULL,'No','Yes') INV_STATUS
     , DECODE(C.STV_DMG_NO,NULL,B.STV_DMG_LOC_DESC,C.STL_RMK) STV_DMG_RMK
     , 'P' STV_DMG_STL_PROC_STS_CD
     , TO_CHAR(A.STV_DMG_EVNT_DT,'YYYYMMDD') IMSI_PAY_DT
  FROM OPF_STV_DMG A
     , OPF_STV_DMG_DTL B
     , OPF_STV_DMG_STL C
     , FMS_INV_DTL E
 WHERE A.STV_DMG_NO = B.STV_DMG_NO
   AND A.STV_DMG_NO = C.STV_DMG_NO(+)
   AND A.STV_DMG_NO = E.SDMS_NO(+)
   AND A.VSL_CD IN (SELECT VSL_CD
                      FROM FMS_CONTRACT
                     WHERE FLET_CTRT_NO = @[flet_ctrt_no]
                     UNION ALL
                    SELECT VSL_CD
                      FROM FMS_ID_VSL
                     WHERE FLET_CTRT_NO = @[flet_ctrt_no]
                       AND USE_FLG = 'Y')
#if(${app_flg} == 'N')
   AND E.SDMS_NO IS NULL
#elseif(${app_flg} == 'Y')
   AND E.SDMS_NO IS NOT NULL
#end

#if(${from_pay_dt} != '')
   AND TO_CHAR(A.STV_DMG_EVNT_DT,'YYYYMMDD') BETWEEN REPLACE(@[from_pay_dt],'-','') AND REPLACE(@[to_pay_dt],'-','')
#end
ORDER BY SUBSTR(A.STV_DMG_NO,4)			]]></sql>
			<params>
				<param name="flet_ctrt_no" type="12" value="" out="N"/>
				<param name="from_pay_dt" type="12" value="" out="N"/>
				<param name="to_pay_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
