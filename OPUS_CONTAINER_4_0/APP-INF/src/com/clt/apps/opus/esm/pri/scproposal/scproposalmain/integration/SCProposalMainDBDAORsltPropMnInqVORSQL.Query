<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCProposalMainDBDAORsltPropMnInqVORSQL">
			<desc><![CDATA[inquiry 조회]]></desc>
			<sql><![CDATA[
SELECT  
    SUBSTR(HDR.SC_NO,1,3) SC_NO1, 
	SUBSTR(HDR.SC_NO,4,16) SC_NO2,
    HDR.PRC_MST_PROP_TP_CD,
    MN.PROP_NO, 
    MN.AMDT_SEQ, 
    TO_CHAR(DUR.CTRT_EFF_DT, 'yyyy-MM-dd') CTRT_EFF_DT, 
    TO_CHAR(DUR.CTRT_EXP_DT, 'yyyy-MM-dd') CTRT_EXP_DT,
    MN.RF_FLG RF_FLG, 
    MN.GAMT_FLG GAMT_FLG, 
    MN.PROP_STS_CD, 
    STS_CD.INTG_CD_VAL_DP_DESC PROP_STS,
    MN.PROP_OFC_CD,  
    MN.PROP_SREP_CD, 
    SLS_REP1.SREP_NM PROP_SREP_NM,
    MN.PROP_APRO_OFC_CD, 
    MN.PROP_APRO_DT, 
    TO_CHAR(MN.CRE_DT,'YYYY-MM-DD') CRE_DT,
    TO_CHAR(MN.FILE_DT,'YYYY-MM-DD') FILE_DT,
    PTY.CUST_CNT_CD CUST_CNT_CD, 
    PTY.CUST_SEQ CUST_SEQ, 
    PTY.CTRT_PTY_NM  CTRT_PTY_NM ,
    PTY.CTRT_CUST_VAL_SGM_CD,
    SGM1.INTG_CD_VAL_DP_DESC CTRT_CUST_VAL_SGM,
    CUST_TP.PRC_CTRT_CUST_TP_CD PRC_CTRT_CUST_TP_CD,
    PTY.CTRT_CUST_SLS_OFC_CD, 
    PTY.CTRT_CUST_SREP_CD, 
	PROG_USR.USR_NM PROP_APRO_STAFF,
    SLS_REP2.SREP_NM CTRT_CUST_SREP_NM,
    MN.REAL_CUST_CNT_CD, 
    MN.REAL_CUST_SEQ, 
    CUST.CUST_LGL_ENG_NM REAL_CUST_NM,
    ( SELECT SGM2.INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL SGM2, MDM_CUSTOMER M 
       WHERE SGM2.INTG_CD_ID = 'CD00698' AND SGM2.INTG_CD_VAL_CTNT = M.VBS_CLSS_CD    
         AND M.CUST_CNT_CD = MN.REAL_CUST_CNT_CD AND M.CUST_SEQ = MN.REAL_CUST_SEQ ) AS REAL_CUST_VAL_SGM,
    MN.REAL_CUST_TP_CD, 
    MN.REAL_CUST_SLS_OFC_CD, 
    MN.REAL_CUST_SREP_CD, 
    SLS_REP3.SREP_NM REAL_CUST_SREP_NM,
    CASE MN.PROP_STS_CD 
        WHEN 'A' THEN MQC.FNL_MQC_QTY
        WHEN 'F' THEN MQC.FNL_MQC_QTY
    ELSE                        
        MQC.PROP_MQC_QTY
    END PROP_MQC_QTY,  
    MQC.CNTR_LOD_UT_CD, 
    UT.INTG_CD_VAL_DP_DESC UNIT,
    MN.BLPL_HDR_SEQ,
    PTY.PRC_CTRT_PTY_TP_CD,
    PTY.CTRT_PTY_ADDR,
    PTY.CTRT_PTY_SGN_NM,
    PTY.CTRT_PTY_SGN_TIT_NM,
	M.NVOCC_BD_NO OTI_NO,
	M.NVOCC_BD_ST_EFF_DT OTI_EFF_DT,
	M.NVOCC_BD_END_EFF_DT OTI_EXP_DT,
	M.NVOCC_BD_AMT OTI_AMT,
    MN.PRXY_FLG
FROM   PRI_SP_MN MN
     , PRI_SP_HDR HDR
     , PRI_SP_DUR DUR
     , PRI_SP_CTRT_PTY PTY
     , PRI_SP_CTRT_CUST_TP CUST_TP
     , PRI_SP_MQC MQC
     , MDM_CUSTOMER CUST
     , COM_INTG_CD_DTL STS_CD
     , COM_INTG_CD_DTL UT      
     , COM_INTG_CD_DTL SGM1
     , MDM_SLS_REP SLS_REP1
     , MDM_SLS_REP SLS_REP2
     , MDM_SLS_REP SLS_REP3
     , MDM_CUSTOMER M
	  ,(
		SELECT A.PROP_NO
    		  ,A.AMDT_SEQ
      	  	  ,A.PROP_STS_CD
      		  ,B.USR_NM
		FROM   PRI_SP_PROG A
		      ,COM_USER B
		WHERE  A.PROG_USR_ID = B.USR_ID
		AND    PROP_STS_CD = 'A'
	    AND    USE_FLG = 'Y'
		AND    PROP_PROG_SEQ =
          				(SELECT /*+ INDEX_DESC(B XPKPRI_SP_PROG)*/ PROP_PROG_SEQ
           				   FROM  PRI_SP_PROG B
           				  WHERE  PROP_NO = A.PROP_NO
           					AND  AMDT_SEQ = A.AMDT_SEQ
           					AND  PROP_STS_CD = 'A'
							AND  ROWNUM = 1)
		) PROG_USR
WHERE HDR.PROP_NO                 	= MN.PROP_NO
AND DUR.PROP_NO                 	= MN.PROP_NO
AND DUR.AMDT_SEQ                	= MN.AMDT_SEQ
AND PTY.PROP_NO                 	= MN.PROP_NO
AND PTY.AMDT_SEQ                	= MN.AMDT_SEQ
AND PTY.PRC_CTRT_PTY_TP_CD      	= 'C'
AND PTY.CUST_CNT_CD             	= M.CUST_CNT_CD
AND PTY.CUST_SEQ                	= M.CUST_SEQ
AND M.CNTR_DIV_FLG = 'Y'
AND CUST_TP.PROP_NO(+)              = PTY.PROP_NO
AND CUST_TP.AMDT_SEQ(+)             = PTY.AMDT_SEQ
AND CUST_TP.PRC_CTRT_PTY_TP_CD(+)   = PTY.PRC_CTRT_PTY_TP_CD
AND SLS_REP1.SREP_CD(+)             = MN.PROP_SREP_CD
AND SLS_REP2.SREP_CD(+)             = PTY.CTRT_CUST_SREP_CD
AND SLS_REP3.SREP_CD(+)         	= MN.REAL_CUST_SREP_CD
AND CUST.CUST_CNT_CD(+)         	= MN.REAL_CUST_CNT_CD
AND CUST.CUST_SEQ(+)            	= MN.REAL_CUST_SEQ 
AND CUST.CNTR_DIV_FLG(+) = 'Y'
AND STS_CD.INTG_CD_ID           	= 'CD01722'
AND STS_CD.INTG_CD_VAL_CTNT     	= MN.PROP_STS_CD
AND MQC.PROP_NO                 	= MN.PROP_NO
AND MQC.AMDT_SEQ                	= MN.AMDT_SEQ
AND UT.INTG_CD_ID               	= 'CD00897'
AND UT.INTG_CD_VAL_CTNT         	= MQC.CNTR_LOD_UT_CD
AND SGM1.INTG_CD_ID(+)              = 'CD00698'
AND SGM1.INTG_CD_VAL_CTNT(+)        = PTY.CTRT_CUST_VAL_SGM_CD
AND MN.PROP_NO 						= PROG_USR.PROP_NO(+)
AND MN.AMDT_SEQ						= PROG_USR.AMDT_SEQ(+)
AND MN.PROP_NO 						= @[prop_no]
AND MN.AMDT_SEQ 					= @[amdt_seq]			]]></sql>
			<params>
				<param name="prop_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
