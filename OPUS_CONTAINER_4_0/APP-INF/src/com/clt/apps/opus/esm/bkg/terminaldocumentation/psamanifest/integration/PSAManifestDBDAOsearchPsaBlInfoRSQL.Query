<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PSAManifestDBDAOsearchPsaBlInfoRSQL">
			<desc><![CDATA[]]></desc>
			<sql><![CDATA[
SELECT DISTINCT
       V.BKG_NO,
       PV.VSL_CD,
       PV.SKD_VOY_NO,
       PV.SKD_DIR_CD,
       B.BL_NO,

       (SELECT DECODE(PT2.PSA_LOC_CD, NULL, DECODE(PT1.PSA_LOC_CD, NULL, NVL(MDM.UN_LOC_CD, MDM.LOC_CD), PT1.PSA_LOC_CD), PT2.PSA_LOC_CD)
          FROM BKG_CSTMS_PSA_PORT PT1,
               BKG_CSTMS_PSA_PORT PT2,
               BKG_BOOKING BK,
               MDM_LOCATION MDM
         WHERE BK.BKG_NO = B.BKG_NO
           AND BK.POL_CD = PT1.LOC_CD(+)
           AND LENGTH(PT1.TML_CD(+)) = 5
           AND BK.POL_CD = PT2.LOC_CD(+)
           AND BK.POL_NOD_CD = PT2.TML_CD(+)
           AND BK.POL_CD = MDM.LOC_CD(+)
           AND ROWNUM = 1) AS POL_CD,

       (SELECT DECODE(PT2.PSA_LOC_CD, NULL, DECODE(PT1.PSA_LOC_CD, NULL, NVL(MDM.UN_LOC_CD, MDM.LOC_CD), PT1.PSA_LOC_CD), PT2.PSA_LOC_CD)
          FROM BKG_CSTMS_PSA_PORT PT1,
               BKG_CSTMS_PSA_PORT PT2,
               BKG_BOOKING BK,
               MDM_LOCATION MDM
         WHERE BK.BKG_NO = B.BKG_NO
           AND BK.POD_CD = PT1.LOC_CD(+)
           AND LENGTH(PT1.TML_CD(+)) = 5
           AND BK.POD_CD = PT2.LOC_CD(+)
           AND BK.POD_NOD_CD = PT2.TML_CD(+)
           AND BK.POD_CD = MDM.LOC_CD(+)
           AND ROWNUM = 1) AS POD_CD,

       (SELECT DECODE(PT2.PSA_LOC_CD, NULL, DECODE(PT1.PSA_LOC_CD, NULL, NVL(MDM.UN_LOC_CD, MDM.LOC_CD), PT1.PSA_LOC_CD), PT2.PSA_LOC_CD)
          FROM BKG_CSTMS_PSA_PORT PT1,
               BKG_CSTMS_PSA_PORT PT2,
               BKG_BOOKING BK,
               MDM_LOCATION MDM
         WHERE BK.BKG_NO = B.BKG_NO
           AND BK.DEL_CD = PT1.LOC_CD(+)
           AND LENGTH(PT1.TML_CD(+)) = 5
           AND BK.DEL_CD = PT2.LOC_CD(+)
           AND BK.DEL_NOD_CD = PT2.TML_CD(+)
           AND BK.DEL_CD = MDM.LOC_CD(+)
           AND ROWNUM = 1) AS DEL_CD,

       BD.PCK_QTY,
       NVL2(CNV.CSTMS_PCK_TP_CD, CNV.CSTMS_PCK_TP_CD, BD.PCK_TP_CD) AS CSTMS_PCK_TP_CD,
       BD.ACT_WGT,
       BD.WGT_UT_CD,
       BD.MEAS_QTY,
       BD.MEAS_UT_CD,
       BD.CSTMS_DESC,
       DECODE(V.POD_CD, B.POD_CD, 'L', 'T') AS TS_IND


  FROM BKG_VVD V,
       BKG_BOOKING B,
       BKG_VVD NV,
       BKG_CSTMS_PSA_VVD PV,
       BKG_BL_DOC BD,
       BKG_CSTMS_PCK_TP_CONV CNV


 WHERE V.VSL_CD = SUBSTR(@[vvd], 1, 4)
   AND V.SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
   AND V.SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
   AND V.POD_CD = 'SGSIN'
   AND v.VSL_CD = PV.VSL_CD(+)
   AND v.SKD_VOY_NO = PV.SKD_VOY_NO(+)
   AND v.SKD_DIR_CD = PV.SKD_DIR_CD(+)
   AND B.BKG_STS_CD NOT IN ('X', 'S')
   AND V.BKG_NO IN (#foreach(${key} in ${bkg_no}) #if($velocityCount < $bkg_no.size()) '${key}',#else '${key}' #end #end)
   AND V.BKG_NO = B.BKG_NO
   AND V.BKG_NO = NV.BKG_NO
   AND V.BKG_NO = BD.BKG_NO
   AND BD.PCK_TP_CD = CNV.PCK_TP_CD(+)
   AND CNV.CNT_CD(+) = 'SG'
   AND NV.VSL_PRE_PST_CD||NV.VSL_SEQ = (SELECT NVL(MIN(VSL_PRE_PST_CD||VSL_SEQ), V.VSL_PRE_PST_CD||V.VSL_SEQ)
                                          FROM BKG_VVD
                                         WHERE BKG_NO = V.BKG_NO
                                           AND V.VSL_PRE_PST_CD||V.VSL_SEQ < VSL_PRE_PST_CD||VSL_SEQ)
			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
