<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="StatusManageDBDAOSearchQtaStepCntRSQL">
			<desc><![CDATA[Step 별 Count 를 확인한다.]]></desc>
			<sql><![CDATA[
SELECT V.BSE_TP_CD
        ,V.BSE_YR
        ,V.BSE_QTR_CD
        ,SUM(DECODE(QTA_STEP_CD, '01', 1, 0)) AS STEP_01_CNT                    -- STEP 01 의 개수
        ,SUM(DECODE(QTA_STEP_CD, '02', 1, 0)) AS STEP_02_CNT                    -- STEP 02 의 개수
        ,SUM(DECODE(QTA_STEP_CD, '03', 1, '04', 1, '05', 1, 0)) AS STEP_03_CNT  -- SETP 03, 04, 05 의 개수
        ,DECODE(COUNT(1), 0, 'N'                                                -- 전체 STEP 의 개수가 0 일 경우
                        , SUM(DECODE(V.CSQ_VER_STS_CD, 'C', 1, 0)), 'Y'         -- 전체 STEP 의 개수와 Confirm 의 개수가 같을 경우 
                        , 'N' ) AS CONFIRM_FLG
        ,DECODE(MAX(R_CNT), 0, 'N', 'Y') AS RLSE_FLG                            -- RLSE 된 Data 존재 여부
        ,DECODE((SELECT COUNT(1) AS CNT
                   FROM CSQ_QTA_STEP_VER
                  WHERE BSE_TP_CD  = 'Q'
                    AND BSE_YR     = @[f_bse_yr]
                    AND BSE_QTR_CD = '1Q'), 0, 'N', 'Y') AS TRANSFER            -- 1Q Transfer 존재 여부
    FROM CSQ_QTA_STEP_VER V
        ,( SELECT COUNT(1) R_CNT
             FROM CSQ_QTA_RLSE_VER
            WHERE BSE_TP_CD      = @[f_bse_tp_cd]
              AND BSE_YR         = @[f_bse_yr]
              AND BSE_QTR_CD     = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])
              AND CSQ_VER_STS_CD = 'R'
         ) R
   WHERE V.BSE_TP_CD  = @[f_bse_tp_cd]
     AND V.BSE_YR     = @[f_bse_yr]
     AND V.BSE_QTR_CD = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])
GROUP BY V.BSE_TP_CD
        ,V.BSE_YR
        ,V.BSE_QTR_CD			]]></sql>
			<params>
				<param name="f_bse_yr" type="12" value="" out="N"/>
				<param name="f_bse_tp_cd" type="12" value="" out="N"/>
				<param name="f_bse_qtr_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
