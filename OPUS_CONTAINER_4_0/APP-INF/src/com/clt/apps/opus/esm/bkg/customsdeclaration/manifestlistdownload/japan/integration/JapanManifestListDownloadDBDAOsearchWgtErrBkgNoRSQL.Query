<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="JapanManifestListDownloadDBDAOsearchWgtErrBkgNoRSQL">
			<desc><![CDATA[searchWgtErrBkgNo
2011.04.06 김영철 [CHM-201109426-01] Sea-NACCS MFR 송신에러 ( WGT 정수자리수가 7자리 이상인지 체크함. )]]></desc>
			<sql><![CDATA[
SELECT BKG_JOIN_FNC(CURSOR(
SELECT 
	AA.BL_NO
FROM
	(		
	SELECT 
		NVL(B.BL_NO,' ') BL_NO,
		NVL(B.BKG_NO,' ') BKG_NO, 
		DECODE(LENGTH(RTRIM(I.BL_NO)),NULL,'N','Y') I_F,
		DECODE(LENGTH(RTRIM(B.POD_CD)),LENGTH(RTRIM(@[in_pod_cd])),'L','T') L_T,
		NVL(B.POL_CD,' ') POL_CD,
		NVL(B.POD_CD,' ') POD_CD,
		NVL(A.POL_CD,' ') POL_CD2,
		NVL(F.PCK_QTY,0) PCK_QTY,
		NVL(F.PCK_TP_CD,' ') PCK_TP_CD,
		NVL(F.ACT_WGT,0) ACT_WGT,
		NVL(F.WGT_UT_CD,' ') WGT_UT_CD,
		NVL(F.MEAS_QTY,0) MEAS_QTY,
		NVL(F.MEAS_UT_CD,' ') MEAS_UT_CD,
		DECODE(LENGTH(RTRIM(C1.CUST_NM)),NULL,'N','Y') CUST_NM1,
		DECODE(LENGTH(RTRIM(C1.CUST_ADDR)),NULL,'N','Y') CUST_ADDR1,
		DECODE(LENGTH(RTRIM(C2.CUST_NM)),NULL,'N','Y') CUST_NM2,
		DECODE(LENGTH(RTRIM(C2.CUST_ADDR)),NULL,'N','Y') CUST_ADDR2,
		DECODE(LENGTH(RTRIM(C3.CUST_NM)),NULL,'N','Y') CUST_NM3,
		DECODE(LENGTH(RTRIM(C3.CUST_ADDR)),NULL,'N','Y') CUST_ADDR3,
		DECODE(LENGTH(RTRIM(E.MK_DESC)),NULL,'N','Y') MK_DESC,
		DECODE(LENGTH(RTRIM(E.CMDT_DESC)),NULL,'N','Y') CMDT_DESC,	
		NVL(F.BDR_FLG,' ') BDR_FLG,
		'' CORR_NO,
		TO_CHAR(D.VPS_ETD_DT, 'YYYY-MM-DD  HH24:MI') VPS_ETD_DT
	FROM 
		BKG_VVD A, 
		BKG_BOOKING B, 
		VSK_VSL_PORT_SKD D,
		BKG_CUSTOMER C1, 
		BKG_CUSTOMER C2, 
		BKG_CUSTOMER C3,
		BKG_BL_MK_DESC E, 
		BKG_CSTMS_JP_BL I, 
		BKG_BL_DOC F
	WHERE A.VSL_CD         = @[in_vsl_cd]
	AND A.SKD_VOY_NO  = @[in_skd_voy_no]
	AND A.SKD_DIR_CD     = @[in_skd_dir_cd]
	AND A.POD_CD        = @[in_pod_cd]
	#if (${in_pol_cd}!= '') 
	AND A.POL_CD     = @[in_pol_cd]
	#end
	AND A.BKG_NO         = B.BKG_NO
	AND (B.BKG_STS_CD       = 'F'
	OR   B.BKG_STS_CD       = 'W'  )
	AND B.BL_NO          > ' '
	AND A.VSL_CD         = D.VSL_CD
	AND A.SKD_VOY_NO  = D.SKD_VOY_NO
	AND A.SKD_DIR_CD     = D.SKD_DIR_CD
	AND A.POL_CD        = D.VPS_PORT_CD
	AND D.CLPT_IND_SEQ   = '1'
	AND B.BKG_NO         = C1.BKG_NO
	AND C1.BKG_CUST_TP_CD        = 'S'
	AND B.BKG_NO         = C2.BKG_NO
	AND C2.BKG_CUST_TP_CD        = 'C'
	AND B.BKG_NO         = C3.BKG_NO
	AND C3.BKG_CUST_TP_CD        = 'N'
	AND B.BKG_NO         = E.BKG_NO(+)
	AND E.MK_SEQ(+)     = '1'
	AND B.BL_NO          = I.BL_NO(+)
	AND B.BKG_NO         = F.BKG_NO	
    AND LENGTH(ROUND(F.ACT_WGT,0)) > 6
	#if (${in_bl_type}== '1') 
	AND B.POD_CD     = @[in_pod_cd]
	#end
	#if (${in_bl_type}== '2') 
	AND B.POD_CD     <> @[in_pod_cd]
	#end
	ORDER BY A.POL_CD ASC, B.BL_NO ASC
	) AA )
) AS BKG_NO
FROM DUAL			]]></sql>
			<params>
				<param name="in_pod_cd" type="12" value="" out="N"/>
				<param name="in_vsl_cd" type="12" value="" out="N"/>
				<param name="in_skd_voy_no" type="12" value="" out="N"/>
				<param name="in_skd_dir_cd" type="12" value="" out="N"/>
				<param name="in_pol_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
