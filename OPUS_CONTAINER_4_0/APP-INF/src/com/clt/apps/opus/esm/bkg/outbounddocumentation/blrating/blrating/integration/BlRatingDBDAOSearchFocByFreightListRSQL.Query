<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BlRatingDBDAOSearchFocByFreightListRSQL">
			<desc><![CDATA[BlRatingDBDAOSearchFocByFreightList]]></desc>
			<sql><![CDATA[
#if (${ca_flg} == 'Y') 
WITH  MAIN_TEMP  AS
       (
SELECT
'c_' AS MM,'BKG1' AS BB ,NVL(CHG_AMT,0) AS CHG_AMT
FROM (
SELECT
MIN(BKG_NO) BKG_NO,
SUBSTR (MAX (SYS_CONNECT_BY_PATH (CURR_CD, '|')), 2)   AS CURR_CD,
SUBSTR (MAX (SYS_CONNECT_BY_PATH (CHG_AMT, '|')), 2)   AS CHG_AMT
FROM    (
SELECT
ROWNUM AS RID, T.*
FROM (
SELECT MIN(BKG_NO) AS BKG_NO ,CURR_CD ,SUM(CHG_AMT) AS CHG_AMT,DECODE(CURR_CD,'USD',0,1) SORT
FROM BKG_CHG_RT_HIS
WHERE BKG_NO = @[bkg_no] AND FRT_TERM_CD = 'C' AND N3PTY_RCV_OFC_CD IS NULL
AND FRT_INCL_XCLD_DIV_CD='N'
AND CORR_NO ='TMP0000001'
GROUP BY CURR_CD ORDER BY SORT
) T
)
START WITH  RID =  1
CONNECT BY PRIOR RID + 1 = RID
) MA,
(
SELECT BKG_NO ,CLT_OFC_CD AS OFC_CD ,CLT_PAYR_CNT_CD AS CNT_CD ,CLT_PAYR_CUST_SEQ AS CUST_SEQ
FROM BKG_RT_HIS
WHERE BKG_NO=@[bkg_no]
AND CORR_NO ='TMP0000001'
) SA
WHERE
MA.BKG_NO(+) = SA.BKG_NO
UNION ALL
SELECT
'cct_' AS MM,'BKG1' AS BB, NVL(CHG_AMT,0) AS CHG_AMT 
FROM (
SELECT
MIN(BKG_NO) AS BKG_NO,
SUBSTR (MAX (SYS_CONNECT_BY_PATH (CURR_CD, '|')), 2)   AS CURR_CD,
SUBSTR (MAX (SYS_CONNECT_BY_PATH (CHG_AMT, '|')), 2)   AS CHG_AMT
FROM    (
SELECT
ROWNUM AS RID, T.*
FROM (
SELECT MIN(BKG_NO) AS BKG_NO ,CURR_CD ,SUM(CHG_AMT) CHG_AMT ,DECODE(CURR_CD,'USD',0,1) SORT
FROM BKG_CHG_RT_HIS
WHERE BKG_NO=@[bkg_no] AND FRT_TERM_CD = 'C' AND N3PTY_RCV_OFC_CD IS NOT NULL
AND FRT_INCL_XCLD_DIV_CD='N'
AND CORR_NO ='TMP0000001'
GROUP BY CURR_CD ORDER BY SORT
) T
)
START WITH  RID =  1
CONNECT BY PRIOR RID + 1 = RID
) MA,
(
SELECT
MIN(BKG_NO) AS BKG_NO,
SUBSTR (MAX (SYS_CONNECT_BY_PATH (N3PTY_RCV_OFC_CD, '|')), 2)   AS OFC_CD,
SUBSTR (MAX (SYS_CONNECT_BY_PATH (N3PTY_CUST_CNT_CD, '|')), 2)   AS CNT_CD,
SUBSTR (MAX (SYS_CONNECT_BY_PATH (N3PTY_CUST_SEQ, '|')), 2)   AS CUST_SEQ
FROM    (
SELECT  ROWNUM AS RID, T.*
FROM (
SELECT MIN(BKG_NO) AS BKG_NO, N3PTY_RCV_OFC_CD,N3PTY_CUST_CNT_CD,N3PTY_CUST_SEQ
FROM BKG_CHG_RT_HIS
WHERE BKG_NO=@[bkg_no] AND FRT_TERM_CD = 'C' AND N3PTY_RCV_OFC_CD IS NOT NULL
AND FRT_INCL_XCLD_DIV_CD='N'
AND CORR_NO ='TMP0000001'
group by
N3PTY_RCV_OFC_CD,N3PTY_CUST_CNT_CD,N3PTY_CUST_SEQ
) T
)
START WITH  RID =  1
CONNECT BY PRIOR RID + 1 = RID
) SA
WHERE
MA.BKG_NO(+) = SA.BKG_NO
  ) 
SELECT  b.*,C.*
       
FROM    MAIN_TEMP  A,
       (
        SELECT  MM AS COL,CHG_AMT AS COL_AMT,BB from  MAIN_TEMP g where mm= 'c_'
       )  B,
       (
       SELECT  MM AS CCT ,CHG_AMT AS CCT_AMT ,BB  from  MAIN_TEMP g where mm= 'cct_'
      
       )  C
where a.bb = b.bb(+)
and   a.bb = c.bb(+)
and rownum =1
#else
WITH  MAIN_TEMP  AS
       (
SELECT
'c_' AS MM,'BKG1' AS BB ,NVL(CHG_AMT,0) AS CHG_AMT
FROM (
SELECT
MIN(BKG_NO) BKG_NO,
SUBSTR (MAX (SYS_CONNECT_BY_PATH (CURR_CD, '|')), 2)   AS CURR_CD,
SUBSTR (MAX (SYS_CONNECT_BY_PATH (CHG_AMT, '|')), 2)   AS CHG_AMT
FROM    (
SELECT
ROWNUM AS RID, T.*
FROM (
SELECT MIN(BKG_NO) AS BKG_NO ,CURR_CD ,SUM(CHG_AMT) AS CHG_AMT,DECODE(CURR_CD,'USD',0,1) SORT
FROM BKG_CHG_RT
WHERE BKG_NO = @[bkg_no] AND FRT_TERM_CD = 'C' AND N3PTY_RCV_OFC_CD IS NULL
AND FRT_INCL_XCLD_DIV_CD='N'
GROUP BY CURR_CD ORDER BY SORT
) T
)
START WITH  RID =  1
CONNECT BY PRIOR RID + 1 = RID
) MA,
(
SELECT BKG_NO ,CLT_OFC_CD AS OFC_CD ,CLT_PAYR_CNT_CD AS CNT_CD ,CLT_PAYR_CUST_SEQ AS CUST_SEQ
FROM BKG_RATE
WHERE BKG_NO=@[bkg_no]
) SA
WHERE
MA.BKG_NO(+) = SA.BKG_NO
UNION ALL
SELECT
'cct_' AS MM,'BKG1' AS BB, NVL(CHG_AMT,0) AS CHG_AMT 
FROM (
SELECT
MIN(BKG_NO) AS BKG_NO,
SUBSTR (MAX (SYS_CONNECT_BY_PATH (CURR_CD, '|')), 2)   AS CURR_CD,
SUBSTR (MAX (SYS_CONNECT_BY_PATH (CHG_AMT, '|')), 2)   AS CHG_AMT
FROM    (
SELECT
ROWNUM AS RID, T.*
FROM (
SELECT MIN(BKG_NO) AS BKG_NO ,CURR_CD ,SUM(CHG_AMT) CHG_AMT ,DECODE(CURR_CD,'USD',0,1) SORT
FROM BKG_CHG_RT
WHERE BKG_NO=@[bkg_no] AND FRT_TERM_CD = 'C' AND N3PTY_RCV_OFC_CD IS NOT NULL
AND FRT_INCL_XCLD_DIV_CD='N'
GROUP BY CURR_CD ORDER BY SORT
) T
)
START WITH  RID =  1
CONNECT BY PRIOR RID + 1 = RID
) MA,
(
SELECT
MIN(BKG_NO) AS BKG_NO,
SUBSTR (MAX (SYS_CONNECT_BY_PATH (N3PTY_RCV_OFC_CD, '|')), 2)   AS OFC_CD,
SUBSTR (MAX (SYS_CONNECT_BY_PATH (N3PTY_CUST_CNT_CD, '|')), 2)   AS CNT_CD,
SUBSTR (MAX (SYS_CONNECT_BY_PATH (N3PTY_CUST_SEQ, '|')), 2)   AS CUST_SEQ
FROM    (
SELECT  ROWNUM AS RID, T.*
FROM (
SELECT MIN(BKG_NO) AS BKG_NO, N3PTY_RCV_OFC_CD,N3PTY_CUST_CNT_CD,N3PTY_CUST_SEQ
FROM BKG_CHG_RT
WHERE BKG_NO=@[bkg_no] AND FRT_TERM_CD = 'C' AND N3PTY_RCV_OFC_CD IS NOT NULL
AND FRT_INCL_XCLD_DIV_CD='N'
group by
N3PTY_RCV_OFC_CD,N3PTY_CUST_CNT_CD,N3PTY_CUST_SEQ
) T
)
START WITH  RID =  1
CONNECT BY PRIOR RID + 1 = RID
) SA
WHERE
MA.BKG_NO(+) = SA.BKG_NO
  ) 
SELECT  b.*,C.*
       
FROM    MAIN_TEMP  A,
       (
        SELECT  MM AS COL,CHG_AMT AS COL_AMT,BB from  MAIN_TEMP g where mm= 'c_'
       )  B,
       (
       SELECT  MM AS CCT ,CHG_AMT AS CCT_AMT ,BB  from  MAIN_TEMP g where mm= 'cct_'
      
       )  C
where a.bb = b.bb(+)
and   a.bb = c.bb(+)
and rownum =1
#end			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
