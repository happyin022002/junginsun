<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChinaCustomsTransmissionDBDAOsearchCncusVvdRSQL">
			<desc><![CDATA[ChinaCncusVvdVO]]></desc>
			<sql><![CDATA[
SELECT SV.VSL_NM AS VSL_FULL_NAME,
#if (${trans_mode} == 'P')
       NVL(CV.OB_VSL_NM, SUBSTR(@[vvd], 1, 4)) AS VSL_CD,
       NVL(CV.OB_SKD_VOY_NO, SUBSTR(@[vvd], 5, 4)) AS VSL_VOY,
       NVL(CV.OB_SKD_DIR_NM, SUBSTR(@[vvd], 9, 1)) AS VSL_DIR,
#else
       NVL(CV.IB_VSL_NM, SUBSTR(@[vvd], 1, 4)) AS VSL_CD,
       NVL(CV.IB_SKD_VOY_NO, SUBSTR(@[vvd], 5, 4)) AS VSL_VOY,
       NVL(CV.IB_SKD_DIR_NM, SUBSTR(@[vvd], 9, 1)) AS VSL_DIR,
#end
       SV.CALL_SGN_NO AS CALL_SIGN,
       TO_CHAR(GLOBALDATE_PKG.TIME_CONV_FNC('KRPUS', SYSDATE, 'CNSHA'), 'YYYYMMDDHH24MISS') AS SEND_DATE,
       '530400000003' AS REP_PERSON,
       L3.LOC_CD AS ORG_PORT,
       L3.LOC_NM AS ORG_PORT_NAME,
       TO_CHAR(SV.ETD_DT, 'YYYYMMDDHH24MI') AS POL_ETD,
       SV.PRE_CLPT_CD AS P_PORT,
       L1.LOC_NM AS P_PORT_NAME,
       TRIM(SV.NXT_CLPT_CD) AS N_PORT,
       L2.LOC_NM AS N_PORT_NAME,
       TO_CHAR(SV.ETA_DT, 'YYYYMMDD') AS ETA,
       TO_CHAR(SV.ETD_DT, 'YYYYMMDD') AS ETD,
       NVL(SV.LLOYD_NO, '	') AS IMO_NO,
       SV.SLAN_CD AS LANE

  FROM BKG_CSTMS_CHN_VVD SV,
       MDM_LOCATION L1,
       MDM_LOCATION L2,
       MDM_LOCATION L3,
       BKG_CSTMS_CHN_CORR_VVD CV

 WHERE SV.VSL_CD = SUBSTR(@[vvd], 1, 4)
   AND SV.SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
   AND SV.SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
#if (${trans_mode} == 'D')
   AND SV.PORT_CD = @[port_cd]
#else
   AND SV.PORT_CD = @[pol]   
#end
   AND SV.VSL_CD = CV.VSL_CD(+)
   AND SV.SKD_VOY_NO = CV.SKD_VOY_NO(+)
   AND SV.SKD_DIR_CD = CV.SKD_DIR_CD(+)
#if (${trans_mode} == 'D')
   AND SV.CHN_MF_SND_IND_CD = 'R'
#else
   AND SV.CHN_MF_SND_IND_CD = @[trans_mode]
#end 
   AND L1.LOC_CD(+) = SV.PRE_CLPT_CD
   AND L2.LOC_CD(+) = SV.NXT_CLPT_CD
   AND L3.LOC_CD = @[port_cd]
   AND ROWNUM = 1
			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="port_cd" type="12" value="" out="N"/>
				<param name="pol" type="12" value="" out="N"/>
				<param name="trans_mode" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
