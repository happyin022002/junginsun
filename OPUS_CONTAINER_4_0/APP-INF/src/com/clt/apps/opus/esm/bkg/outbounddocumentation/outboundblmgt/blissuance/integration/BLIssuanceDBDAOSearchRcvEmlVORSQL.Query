<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLIssuanceDBDAOSearchRcvEmlVORSQL">
			<desc><![CDATA[BLIssueanceDBDAOSearchRcvEml]]></desc>
			<sql><![CDATA[
SELECT  
    BL_GRP_SEQ
    ,BL_VW_RT_TP_CD
    ,CASE WHEN XTER_USR_EML IS NULL THEN EML_CUST_ADDR
		  WHEN EML_CUST_ADDR IS NULL THEN XTER_USR_EML
          ELSE XTER_USR_EML || ';' || EML_CUST_ADDR
     END AS USR_EML
	,'' AS NTFY_PRF_FLG
	,'' AS NTFY_PRN_FLG
	,'' AS NTFY_AUTO_WBL_FLG
	,'' AS BKG_NO
FROM (
SELECT  CBG.BL_GRP_SEQ
       ,CBG.BL_VW_RT_TP_CD
#if (${ntfy_prf_flg} != '')
       ,CASE WHEN CBG.NTFY_PRF_FLG = 'Y' THEN  CBG.EML_CUST_ADDR
             ELSE '' END 
		AS EML_CUST_ADDR
       ,BKG_JOIN_FNC(CURSOR(SELECT BUI.USR_EML FROM BKG_XTER_USR_INFO BUI WHERE BUI.BL_GRP_SEQ = CBG.BL_GRP_SEQ AND BUI.RDY_FO_PRF_FLG = 'Y' AND TRIM(BUI.USR_EML) IS NOT NULL), ';')
        AS XTER_USR_EML
#end
#if (${ntfy_prn_flg} != '')
       ,CASE WHEN CBG.NTFY_PRN_FLG = 'Y' THEN  CBG.EML_CUST_ADDR
             ELSE '' END 
		AS EML_CUST_ADDR
       ,BKG_JOIN_FNC(CURSOR(SELECT BUI.USR_EML FROM BKG_XTER_USR_INFO BUI WHERE BUI.BL_GRP_SEQ = CBG.BL_GRP_SEQ AND BUI.RDY_FO_PRN_FLG = 'Y' AND TRIM(BUI.USR_EML) IS NOT NULL), ';')
        AS XTER_USR_EML
#end
#if (${ntfy_auto_wbl_flg} != '')
       ,CASE WHEN CBG.NTFY_AUTO_WBL_FLG = 'Y' THEN  CBG.EML_CUST_ADDR
             ELSE '' END 
		AS EML_CUST_ADDR
       ,BKG_JOIN_FNC(CURSOR(SELECT BUI.USR_EML FROM BKG_XTER_USR_INFO BUI WHERE BUI.BL_GRP_SEQ = CBG.BL_GRP_SEQ AND BUI.SEA_WBL_EML_FLG = 'Y' AND TRIM(BUI.USR_EML) IS NOT NULL), ';')
        AS XTER_USR_EML
#end

     
FROM BKG_BL_ISS BI
     ,BKG_INET_BL_CTRL_PTY IBC
     ,BKG_CTRL_PTY_BL_GRP CBG
WHERE 0=0
AND BI.INET_CTRL_PTY_NM = IBC.CUST_CNT_CD
AND BI.INET_CTRL_PTY_NO = IBC.CUST_SEQ
AND IBC.CTRL_PTY_SEQ = CBG.CTRL_PTY_SEQ
AND BI.BKG_NO = @[bkg_no]
) T
WHERE 0=0
AND (   EML_CUST_ADDR IS NOT NULL 
     OR XTER_USR_EML IS NOT NULL)
ORDER BY BL_GRP_SEQ			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
