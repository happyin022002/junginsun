<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="StatusReportDBDAOOutBdMovementStsListInVORSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
WITH AAA AS 
(
   SELECT  SUBSTR(V.SLS_YRMON, 1, 4) AS COST_YR
         , V.COST_WK
         , V.SLS_YRMON
         , V.TRD_CD
         , V.SUB_TRD_CD
         , V.RLANE_CD
         , V.DIR_CD
         , V.VSL_CD
         , V.SKD_VOY_NO
         , V.DIR_CD AS SKD_DIR_CD
         , V.IOC_CD
   FROM    MDM_REV_LANE RL
         , COA_MON_VVD V
   WHERE   RL.RLANE_CD = V.RLANE_CD
   AND     V.DELT_FLG = 'N'
   AND     V.VSL_CD = SUBSTR(@[vvd_cd], 1, 4)
   AND     V.SKD_VOY_NO = SUBSTR(@[vvd_cd], 5, 4)
   AND     V.DIR_CD = SUBSTR(@[vvd_cd], 9, 1)
)
, BKG_VVD_DATE_1 AS
(
   SELECT  B.BKG_NO
         , BV.SLAN_CD
         , BV.VSL_CD
         , BV.SKD_VOY_NO
         , BV.SKD_DIR_CD
         , DRL.TRD_CD
         , DRL.SUB_TRD_CD
         , DRL.RLANE_CD
         , BV.POL_CD
         , BV.POL_CLPT_IND_SEQ
         , BV.POD_CD
         , B.BKG_CGO_TP_CD
         , (
              SELECT  CONTI_CD
              FROM    MDM_LOCATION L
              WHERE   L.LOC_CD = BV.POL_CD
           ) FM_CONTI_CD,
           (
              SELECT  CONTI_CD
              FROM    MDM_LOCATION L
              WHERE   L.LOC_CD = BV.POD_CD
           ) TO_CONTI_CD
   FROM    BKG_VVD BV
         , BKG_BOOKING B
         , AAA M
         , MDM_DTL_REV_LANE DRL
         , MDM_REV_LANE RL
   WHERE   B.BKG_NO = BV.BKG_NO
   AND     M.VSL_CD = BV.VSL_CD
   AND     M.SKD_VOY_NO = BV.SKD_VOY_NO
   AND     M.SKD_DIR_CD = BV.SKD_DIR_CD
   AND     RL.VSL_SLAN_CD = BV.SLAN_CD
   AND     DRL.RLANE_CD = RL.RLANE_CD
   AND     DRL.RLANE_CD = M.RLANE_CD
   AND     DRL.VSL_SLAN_DIR_CD = M.DIR_CD
   AND     DRL.IOC_CD = M.IOC_CD
   AND     DRL.TRD_CD = M.TRD_CD
   AND     DRL.SUB_TRD_CD = M.SUB_TRD_CD
   AND     DRL.DELT_FLG = 'N'
   AND     DRL.FM_CONTI_CD = ( SELECT CONTI_CD FROM MDM_LOCATION L WHERE L.LOC_CD = BV.POL_CD )
   AND     DRL.TO_CONTI_CD = ( SELECT CONTI_CD FROM MDM_LOCATION L WHERE L.LOC_CD = BV.POD_CD )
   AND     RL.RLANE_CD = M.RLANE_CD
   AND     RL.VSL_TP_CD = 'C'
   AND     RL.DELT_FLG = 'N'
)
, BKG_VVD_DATE AS
(
    SELECT K.* , NVL(KK.KK,'N') CNTR_QTY_DIF
    FROM BKG_VVD_DATE_1 K
    , ( SELECT BKG_NO, 'Y' KK
    FROM (
    SELECT AA.BKG_NO, CNTR_TPSZ_CD, COUNT(*)
    FROM BKG_CONTAINER AA, BKG_VVD_DATE_1 BB
    WHERE AA.BKG_NO = BB.BKG_NO
    GROUP BY AA.BKG_NO, AA.CNTR_TPSZ_CD
    MINUS
    SELECT AA.BKG_NO, CNTR_TPSZ_CD, OP_CNTR_QTY
    FROM BKG_QUANTITY AA, BKG_VVD_DATE_1 BB
    WHERE AA.BKG_NO = BB.BKG_NO )) KK
    WHERE K.BKG_NO = KK.BKG_NO(+)
)
SELECT  ROWNUM RNUM
      , TRD_CD
      , SUB_TRD_CD
      , RLANE_CD
      , TRUNK_VVD
      , BKG_NO
      , BKG_RANK
      , BKG_STS_CD
      , CUST_NM
      , BKG_CGO_TP_CD
      , POR_CD
      , POD_CD
      , POL_CD
      , DEL_CD
      , CNTR_TPSZ_CD
      , OP_CNTR_QTY
      , RCV_TERM_CD
      , DE_TERM_CD
      , CNTR_NO
      , CNTR_TPSZ_CD_MV
      , CNTR_VOL_QTY
      , EQ_SUBST_TPSZ_CD
      , ADV_SHTG_CD
      , CNMV_STS_CD
      , ORG_YD_CD
      , CNMV_EVNT_DT
      , VPS_CCT_DT
      , VPS_ETD_DT
      , RCV_TERM_CD_MV
      , DE_TERM_CD_MV
      , BKG_CRE_DT
      , CNTR_PRT_FLG
      , CNTR_CFM_FLG
      , CNMV_YR
      , CNMV_ID_NO
      , CNMV_CYC_NO
      , DEST_TRNS_SVC_MOD_CD
      , XTER_BKG_RQST_CD
      , PRE_1_VVD
      , PRE_1_POL_CD
      , KEY_POL_CD
      , BKG_GET_TOKEN_FNC(CLM,1) AS CLM_SGHT_CD
      , BKG_GET_TOKEN_FNC(CLM,2) AS ARR_LOC_NM
      , BKG_GET_TOKEN_FNC(CLM,3) AS ARR_STE_CD 
      , BKG_GET_TOKEN_FNC(CLM,4) AS ARR_DT
      , BKG_GET_TOKEN_FNC(CLM,5) AS DEP_DT
      , VSL_PRE_PST_CD
      , DG
      , DG_STS
      , RF
      , RF_STS
      , AK
      , AK_STS
      , SUBGROUP_TITLE
      , VVD_CD
      , OFC_INC_SUB
      , CUST_TP_CD
      , CUST_CNT_CD
      , CUST_SEQ
      , CHK_LT_TYPE
      , CHK_INC_CLM
      , BKG_DT_FR
      , BKG_DT_TO
      , BKG_OFC_CD
      , COP_NO
      , CBKG_NO
      , CLM_DT
      , CNTR_CHECK
FROM    (
        SELECT  ROWNUM RNUM
              , TRD_CD
              , SUB_TRD_CD
              , RLANE_CD
              ,  TRUNK_VVD
              ,  BKG_NO
              ,  BKG_RANK
              ,  BKG_STS_CD
              ,  CUST_NM
              ,  BKG_CGO_TP_CD
              ,  POR_CD
              ,  POD_CD
              ,  POL_CD
              ,  DEL_CD
              , NVL(CNTR_TPSZ_CD, (SELECT CNTR_TPSZ_CD FROM BKG_QUANTITY WHERE BKG_NO = T.BKG_NO AND CNTR_TPSZ_CD = SUBSTR(T.CNTR_TPSZ_CD_MV,1,1)||DECODE(SUBSTR(T.CNTR_TPSZ_CD_MV,2,1),'4','5','4'))) CNTR_TPSZ_CD
              , NVL(OP_CNTR_QTY, (SELECT OP_CNTR_QTY FROM BKG_QUANTITY WHERE BKG_NO = T.BKG_NO AND CNTR_TPSZ_CD = SUBSTR(T.CNTR_TPSZ_CD_MV,1,1)||DECODE(SUBSTR(T.CNTR_TPSZ_CD_MV,2,1),'4','5','4'))) OP_CNTR_QTY
              --,      CNTR_TPSZ_CD
              --,      OP_CNTR_QTY
              ,  RCV_TERM_CD
              ,  DE_TERM_CD
              ,  CNTR_NO
              ,  CNTR_TPSZ_CD_MV
              ,  CNTR_VOL_QTY
              ,  EQ_SUBST_TPSZ_CD
              ,  ADV_SHTG_CD
              ,  CNMV_STS_CD
              ,  ORG_YD_CD
              ,  CNMV_EVNT_DT
              ,  VPS_CCT_DT
              ,  VPS_ETD_DT
              ,  RCV_TERM_CD_MV
              ,  DE_TERM_CD_MV
              ,  BKG_CRE_DT
              ,  CNTR_PRT_FLG
              ,  CNTR_CFM_FLG
              ,  CNMV_YR
              ,  CNMV_ID_NO
              ,  CNMV_CYC_NO
              ,  DEST_TRNS_SVC_MOD_CD
              ,  XTER_BKG_RQST_CD
              ,  PRE_1_VVD
              ,  PRE_1_POL_CD
              ,  KEY_POL_CD
              , CASE WHEN BKG_GET_TOKEN_FNC(CLM,4) IS NULL--ARR_DT
                     THEN EDI_322
                     WHEN BKG_GET_TOKEN_FNC(EDI_322,4) IS NULL
                     THEN CLM
                     WHEN BKG_GET_TOKEN_FNC(CLM,4) > BKG_GET_TOKEN_FNC(EDI_322,4)
                     THEN CLM
                END CLM
              ,  VSL_PRE_PST_CD
              ,  DG
              ,  DG_STS
              ,  DECODE(RF,'','',RF || ' C') RF
              ,  RF_STS
              ,  AK
              ,  AK_STS
              ,  SUBGROUP_TITLE
              ,  VVD_CD
              ,  OFC_INC_SUB
              ,  CUST_TP_CD
              ,  CUST_CNT_CD
              ,  CUST_SEQ
              ,  CHK_LT_TYPE
              ,  CHK_INC_CLM
              ,  BKG_DT_FR
              ,  BKG_DT_TO
              ,  BKG_OFC_CD
              ,  COP_NO
              ,  BKG_NO AS CBKG_NO
              ,  TO_CHAR(SYSDATE,'YYYY-MM-DD HH24:MI') AS CLM_DT
              ,  DECODE(  ADV_SHTG_CD,NULL,DECODE(CRN_VVD_CNT,NULL,'',
                                          DECODE(PRE_VVD_CNT,NULL,'',
                                          DECODE(SUBSTR(CRN_VVD_CNT,-2),SUBSTR(PRE_VVD_CNT,-2),'D',''))),
                                          ADV_SHTG_CD
                ) CNTR_CHECK
        FROM    (
                    SELECT DISTINCT A.*
              FROM (
                   SELECT   DISTINCT BVD.TRD_CD
                          , BVD.SUB_TRD_CD
                          , BVD.RLANE_CD
                          , VB.TRUNK_VVD
                          , VB.BKG_NO
                          , RANK() OVER(PARTITION BY VB.TRUNK_VVD, VB.BKG_NO, VB.POL_CD, A.CNTR_TPSZ_CD ORDER BY B.CNTR_NO) BKG_RANK
                          , VB.BKG_STS_CD
                          , SUBSTR(TRANSLATE(NVL(VB.SHPR_NAME,' '),CHR(10),' '),1,20) CUST_NM
                          , VB.BKG_CGO_TP_CD
                          , VB.POR_CD
                          , VB.POD_CD
                          , VB.POL_CD
                          , VB.DEL_CD
                          , A.CNTR_TPSZ_CD
                          , A.OP_CNTR_QTY
                          , B.RCV_TERM_CD
                          , B.DE_TERM_CD
                          , B.CNTR_NO
                          , B.CNTR_TPSZ_CD  CNTR_TPSZ_CD_MV
                          , B.CNTR_VOL_QTY
                          , B.EQ_SUBST_TPSZ_CD
                          , B.ADV_SHTG_CD
	                      , DECODE(BK.BKG_STS_CD,'X','',
				                DECODE((SELECT COP.COP_STS_CD FROM SCE_COP_HDR COP WHERE COP.BKG_NO = B.BKG_NO AND COP.CNTR_NO = B.CNTR_NO AND COP.COP_STS_CD <> 'X'),'F','MT',
					                (SELECT MST.CNMV_STS_CD FROM MST_CONTAINER MST WHERE MST.CNTR_NO = B.CNTR_NO))) CNMV_STS_CD
                          , B.ORG_YD_CD
                          , TO_CHAR(B.CNMV_EVNT_DT, 'YYYY-MM-DD HH24:MI') CNMV_EVNT_DT
                          , BK.PORT_CLZ_DT AS VPS_CCT_DT
                          , TO_CHAR(V.VPS_ETD_DT,  'YYYY-MM-DD HH24:MI') VPS_ETD_DT
                          , VB.RCV_TERM_CD RCV_TERM_CD_MV
                          , VB.DE_TERM_CD DE_TERM_CD_MV
                          , TO_CHAR(VB.BKG_CRE_DT,'YYYY-MM-DD') BKG_CRE_DT
                          , B.CNTR_PRT_FLG
                          , B.CNTR_CFM_FLG
                          , MOVE.CNMV_YR
                          , MOVE.CNMV_ID_NO
                          , MOVE.CNMV_CYC_NO
                          , VB.DEST_TRNS_SVC_MOD_CD
                          , VB.XTER_BKG_RQST_CD
                          , VB.PRE_1_VVD
                          , VB.PRE_1_POL_CD
                          , VB.KEY_POL_CD
                          , (  SELECT  NVL(CLM.CLM_SGHT_CD,' ')||','||NVL(CLM.ARR_LOC_NM,' ')||','||NVL(CLM.ARR_STE_CD,' ')||','||NVL(TO_CHAR(CLM.ARR_DT,'YYYY-MM-DD HH24:MI'),' ')||','||NVL(TO_CHAR(CLM.DEP_DT,'YYYY-MM-DD HH24:MI'),' ')
                               FROM    SCE_CLM_IF CLM, SCE_CLM_SGHT SGHT
                               WHERE   1 = 1
                               AND CLM.CNTR_NO = MOVE.CNTR_NO
                               AND CLM.CNMV_YR = MOVE.CNMV_YR
                               AND CLM.CLM_CYC_NO = MOVE.CNMV_CYC_NO
                               AND CLM.CNMV_ID_NO = MOVE.CNMV_ID_NO
                               AND CLM.CLM_SGHT_CD = SGHT.CLM_SGHT_CD
                               AND TO_CHAR(CLM.CLM_SEQ,'000')||TO_CHAR(CLM.ARR_DT,'YYYY-MM-DD HH24:MI:SS') = (  SELECT  MAX(TO_CHAR(CLM_SEQ,'000'))||TO_CHAR(MAX(Z.ARR_DT),'YYYY-MM-DD HH24:MI:SS')
                                                                                                                FROM    SCE_CLM_IF Z
                                                                                                                WHERE   Z.CNTR_NO = CLM.CNTR_NO
                                                                                                                AND     Z.CNMV_YR = CLM.CNMV_YR
                                                                                                                AND     Z.CLM_CYC_NO = CLM.CLM_CYC_NO
                                                                                                             )
                            ) CLM     
                          , (SELECT NVL(EDI_322_STS_CD,' ')||','||NVL(NVL(EVNT_CTY_NM, NVL((SELECT YD_NM FROM MDM_YARD M WHERE M.YD_CD = EVNT_YD_CD), EVNT_YD_CD)),' ')||','||NVL(EVNT_STE_CD,' ')||','||NVL(TO_CHAR(EVNT_DT,'YYYY-MM-DD HH24:MI'),' ')||','||' '
                               FROM EDI_322_MSG EDI
                               WHERE EDI.EQ_NO = MOVE.CNTR_NO
                               AND NVL(EDI.BKG_EDI_322_NO, EDI.BL_EDI_322_NO) = MOVE.BKG_NO
                               AND EVNT_DT = (SELECT MAX(EVNT_DT)
                                              FROM EDI_322_MSG Z
                                              WHERE Z.EQ_NO = EDI.EQ_NO)
                               AND ROWNUM = 1
                            ) EDI_322
                          , DECODE(VB.VSL_PRE_PST_CD,'T','TRUNK','U','POST','S','PRE') VSL_PRE_PST_CD
                          , (  SELECT  K.SPCL_CGO_APRO_CD 
                               FROM    BKG_DG_CGO K 
                               WHERE   K.BKG_NO = B.BKG_NO
                               AND     K.CNTR_NO = B.CNTR_NO
                               AND     K.DCGO_SEQ = (  SELECT MAX(G.DCGO_SEQ) FROM BKG_DG_CGO G WHERE G.BKG_NO = B.BKG_NO AND G.CNTR_NO = B.CNTR_NO  )
                            )  AS DG_STS
                          , BKG_JOIN_FNC(CURSOR(  SELECT IMDG_UN_NO FROM BKG_DG_CGO WHERE BKG_NO = VB.BKG_NO AND   CNTR_NO =B.CNTR_NO  )) DG
                          , (  SELECT  J.SPCL_CGO_APRO_CD 
                               FROM    BKG_RF_CGO J 
                               WHERE   J.BKG_NO = VB.BKG_NO
                               AND     J.RC_SEQ = (  SELECT MAX(S.RC_SEQ) FROM BKG_RF_CGO S WHERE S.BKG_NO = B.BKG_NO AND S.CNTR_NO = B.CNTR_NO  )
                            ) AS RF_STS
                          , BKG_JOIN_FNC(CURSOR(  SELECT CDO_TEMP FROM BKG_RF_CGO WHERE BKG_NO = VB.BKG_NO AND CNTR_NO =B.CNTR_NO  ))  RF
                          , (  SELECT  Y.SPCL_CGO_APRO_CD
                               FROM    BKG_AWK_CGO Y
                               WHERE   Y.BKG_NO = VB.BKG_NO
                               AND     Y.AWK_CGO_SEQ = (  SELECT MAX(Q.AWK_CGO_SEQ) FROM BKG_AWK_CGO Q WHERE Q.BKG_NO = B.BKG_NO AND Q.CNTR_NO = B.CNTR_NO  )
                            ) AS AK_STS
                          , BKG_JOIN_FNC(CURSOR(  SELECT  OVR_FWRD_LEN||'/' ||OVR_BKWD_LEN||'/' ||OVR_HGT ||'/' || OVR_LF_LEN ||'/' || OVR_RT_LEN
                                                  FROM    BKG_AWK_CGO
                                                  WHERE   BKG_NO = VB.BKG_NO
                                                  AND     CNTR_NO = B.CNTR_NO)
                            )   AK
                          , 'VVD : ' || V.VSL_CD||V.SKD_VOY_NO||V.SKD_DIR_CD || '   POL : ' || VB.KEY_POL_CD
                           	|| '    CCT : ' || TO_CHAR((PRD_COMMON_PKG.PRD_GET_CCT_BY_BKG_INFO_FNC(V.VSL_CD, V.SKD_VOY_NO, V.SKD_DIR_CD, V.VPS_PORT_CD, V.CLPT_IND_SEQ, V.YD_CD, BK.DCGO_FLG||BK.RC_FLG||BK.AWK_CGO_FLG||BK.BB_CGO_FLG||NVL((SELECT 'Y' FROM BKG_QTY_DTL QD WHERE QD.BKG_NO = BK.BKG_NO AND QD.DRY_CGO_FLG = 'Y' AND ROWNUM = 1), 'N'))),  'YYYY-MM-DD HH24:MI')
                           	|| '   ETD : ' || TO_CHAR(V.VPS_ETD_DT,  'YYYY-MM-DD HH24:MI')  SUBGROUP_TITLE
                          , '' VVD_CD
                          , '' OFC_INC_SUB
                          , '' CUST_TP_CD
                          , '' CUST_CNT_CD
                          , '' CUST_SEQ
                          , '' CHK_LT_TYPE
                          , '' CHK_INC_CLM
                          , '' BKG_DT_FR
                          , '' BKG_DT_TO
                          , '' BKG_OFC_CD
                          , (  SELECT  COP_NO
                               FROM    SCE_COP_HDR K
                               WHERE   K.BKG_NO = BK.BKG_NO
                               AND     K.CNTR_NO = B.CNTR_NO
                               AND     K.POD_NOD_CD = BK.POD_NOD_CD
                               AND     K.DEL_NOD_CD = BK.DEL_NOD_CD 
                               AND     K.COP_STS_CD <> 'X'
                            ) AS COP_NO  
                          , (  SELECT  TRNK_VSL_CD||TRNK_SKD_VOY_NO||TRNK_SKD_DIR_CD||SUBSTR(DECODE(SUBSTR(ORG_YD_CD,1,5),'CNHKG','HKGCN',SUBSTR(ORG_YD_CD,1,5)),1,2)
                               FROM    CTM_MOVEMENT
                               WHERE   CNTR_NO = B.CNTR_NO 
                               AND     BKG_NO =BK.BKG_NO 
                               AND     NVL(TRNK_VSL_CD,'COXX') NOT IN('COXX','COZZ')
                               AND     CNMV_EVNT_DT = (  SELECT  MAX(CNMV_EVNT_DT) 
                                                         FROM    CTM_MOVEMENT 
                                                         WHERE   CNTR_NO = B.CNTR_NO 
                                                         AND     BKG_NO =BK.BKG_NO 
                                                         AND     MVMT_STS_CD = 'OC'
                                                      )
                               AND     MVMT_STS_CD ='OC'                      
                               AND     ROWNUM = 1  
                            ) CRN_VVD_CNT
                          , (  SELECT  TRNK_VSL_CD||TRNK_SKD_VOY_NO||TRNK_SKD_DIR_CD||SUBSTR(DECODE(SUBSTR(CTM.ORG_YD_CD, 1, 5), 'CNHKG', 'HKGCN', SUBSTR(CTM.ORG_YD_CD, 1, 5)), 1, 2)
                               FROM    CTM_MOVEMENT CTM
                                     , BKG_BOOKING BB
                                     , BKG_CONTAINER BC
                               WHERE   CTM.BKG_NO = BB.BKG_NO
                               AND     CTM.BKG_NO = BC.BKG_NO
                               AND     CTM.CNTR_NO = BC.CNTR_NO
                               AND     CTM.BKG_NO <> BK.BKG_NO
                               AND     CTM.CNTR_NO = B.CNTR_NO
                               AND     CTM.BKG_CGO_TP_CD ='F'
                               AND     NVL(CTM.TRNK_VSL_CD, 'COXX') NOT IN('COXX','COZZ')
                               AND     CTM.CNMV_CYC_NO = (  SELECT  MAX(CNMV_CYC_NO) - 1
                                                            FROM    CTM_MOVEMENT
                                                            WHERE   CNTR_NO = B.CNTR_NO
                                                            AND     BKG_NO = BK.BKG_NO
                                                            AND     MVMT_STS_CD = 'OC'
                                                            AND     NVL(TRNK_VSL_CD, 'COXX') NOT IN('COXX','COZZ')
                                                        )
                               AND     CTM.CNMV_EVNT_DT < (  SELECT MAX(CNMV_EVNT_DT)
                                                             FROM   CTM_MOVEMENT
                                                             WHERE  CNTR_NO = B.CNTR_NO
                                                             AND    BKG_NO = BK.BKG_NO
                                                             AND    MVMT_STS_CD ='OC'
                                                             AND    NVL(TRNK_VSL_CD, 'COXX') NOT IN('COXX','COZZ')
                                                          )
                               AND     CTM.CNMV_EVNT_DT >= ( SELECT MAX(CNMV_EVNT_DT) - 30
                                                             FROM   CTM_MOVEMENT
                                                             WHERE  CNTR_NO = B.CNTR_NO
                                                             AND    BKG_NO = BK.BKG_NO
                                                             AND    MVMT_STS_CD ='OC'
                                                             AND    NVL(TRNK_VSL_CD, 'COXX') NOT IN('COXX','COZZ')
                                                          )
                               AND     CTM.MVMT_STS_CD IN ('OC','OP')
                               AND     BB.BKG_STS_CD <> 'X'
                               AND     ROWNUM = 1
                            ) PRE_VVD_CNT
                   FROM     BKG_WORK_V VB
                          , BKG_QUANTITY A
                          , VSK_VSL_PORT_SKD V
                          , BKG_CONTAINER B
                          , BKG_BOOKING BK
                          , CTM_MOVEMENT MOVE
                          , BKG_VVD_DATE BVD
                   WHERE    VB.BKG_NO = A.BKG_NO
                   AND      V.VSL_CD(+) = VB.KEY_VSL_CD
                   AND      V.SKD_VOY_NO(+) = VB.KEY_SKD_VOY_NO
                   AND      V.SKD_DIR_CD(+) = VB.KEY_SKD_DIR_CD
--                   AND      ( DECODE(VB.PRE_1_POL_CD,NULL,VB.TRUNK_POL,VB.PRE_1_POL_CD) = V.VPS_PORT_CD(+) )
                   AND      V.VPS_PORT_CD(+) = VB.KEY_POL_CD
                   AND      NVL(V.CLPT_IND_SEQ,BVD.POL_CLPT_IND_SEQ) = BVD.POL_CLPT_IND_SEQ
                   AND      VB.BKG_NO       = BK.BKG_NO
                   AND      B.CNTR_NO = MOVE.CNTR_NO(+)
                   AND      B.CNMV_YR = MOVE.CNMV_YR(+)
                   AND      B.CNMV_ID_NO = MOVE.CNMV_ID_NO(+)
                   AND      A.BKG_NO       = B.BKG_NO(+)
                   AND      A.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD(+)
                              AND      BVD.CNTR_QTY_DIF = 'N'
                   AND      (VB.BKG_STS_CD = 'F' OR VB.BKG_STS_CD = 'W' OR Vb.BKG_STS_CD = 'A')
                   AND      VB.BKG_NO = BVD.BKG_NO(+)

#if (${vvd_cd} != '') 
                   AND      VB.KEY_VSL_CD = SUBSTR(@[vvd_cd],1,4)
                   AND      VB.KEY_SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4)
                   AND      VB.KEY_SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)
#end

#if (${trd_cd} != '')
                   AND     BVD.TRD_CD = @[trd_cd]
#end

#if (${sub_trd_cd} != '') 
                   AND     BVD.SUB_TRD_CD = @[sub_trd_cd]
#end

#if (${rlane_cd} != '') 
                   AND     BVD.RLANE_CD = @[rlane_cd]
#end

#if (${ofc_inc_sub} == 'Y') 
                   AND      VB.BKG_OFC_CD IN (
                                                SELECT  OFC_CD  
                                                FROM    MDM_ORGANIZATION MO
                                                START WITH MO.OFC_CD = NVL(@[bkg_ofc_cd],VB.BKG_OFC_CD)
                                                CONNECT BY PRIOR MO.OFC_CD = MO.PRNT_OFC_CD
                                             )
#else 
       #if (${bkg_ofc_cd} != '') 
                   AND      VB.BKG_OFC_CD = @[bkg_ofc_cd] 
       #end
#end 

#if (${bkg_dt_fr} != '' || ${bkg_dt_fr} != '') 
                   AND      VB.BKG_CRE_DT BETWEEN TO_DATE(@[bkg_dt_fr],'YYYY-MM-DD') AND TO_DATE(@[bkg_dt_to],'YYYY-MM-DD') + 0.99999
#elseif (${bkg_dt_fr} != '') 
                   AND      VB.BKG_CRE_DT <= TO_DATE(@[bkg_dt_to],'YYYY-MM-DD') + 0.99999
#elseif (${bkg_dt_to} != '') 
                   AND      VB.BKG_CRE_DT >= TO_DATE(@[bkg_dt_fr],'YYYY-MM-DD')
#end

#if (${bkg_no} != '') 
                   AND      VB.BKG_NO = @[bkg_no]
#end
#if (${pol_cd} != '') 
                   AND      VB.KEY_POL_CD  LIKE RTRIM(@[pol_cd]) || '%'
#end
#if (${por_cd} != '') 
                   AND      VB.POR_CD LIKE RTRIM(@[por_cd]) || '%'
#end

#if (${rcv_term_cd} != '') 
                   AND      B.RCV_TERM_CD = @[rcv_term_cd]
#end
#if (${de_term_cd} != '') 
                   AND      VB.DE_TERM_CD = @[de_term_cd]
#end
#if (${org_yd_cd} != '') 
                   AND      B.ORG_YD_CD LIKE  @[org_yd_cd] || '%'
#end


#if (${chk_lt_type} == 'L') 
                   AND      VB.KEY_POL_CD = VB.POL_CD      --L/T Local  
#elseif (${chk_lt_type} == 'T') 
                   AND      VB.KEY_POL_CD <> VB.POL_CD     --T/S
#end

#if (${cntr_cfm_flg} != '') 
                   AND      B.CNTR_CFM_FLG = @[cntr_cfm_flg]  --Booking Container의 Tab의 Confirm 정보 
#end

#if (${bkg_sts_cd} != '') 
                   AND      VB.BKG_STS_CD = @[bkg_sts_cd]  --예약 현황 
#end

#if (${pre_1_vvd} != '') 
                   AND      VB.PRE_1_VVD LIKE @[pre_1_vvd] || '%' --pre_vvd
#end

#if (${pre_1_pol_cd} != '') 
                   AND      VB.PRE_1_POL_CD = @[pre_1_pol_cd]            --pre_pol       
#end

#if (${xter_bkg_rqst_cd} != '') 
                   AND      VB.XTER_BKG_RQST_CD = @[xter_bkg_rqst_cd]    --BKG Kind 
#end

#if (${cnmv_sts_cd} == 'Y') 
                   AND      B.CNMV_STS_CD = 'OC'     --O/C Status    Container Status가 OC인 항목 조회
#elseif  (${cnmv_sts_cd} == 'N') 
                   AND      B.CNMV_STS_CD != 'OC'
#end

#if (${bkg_cgo_tp_cd} != '') 
                   AND      BK.BKG_CGO_TP_CD = @[bkg_cgo_tp_cd]   --화물 종류All, Full, Empty로 구분 (Cargo Type 코드 참고)
#end

#if (${dest_trns_svc_mod_cd} != '') 
                   AND      VB.DEST_TRNS_SVC_MOD_CD = @[dest_trns_svc_mod_cd]  --Service Mode
#end

--------------------------------------------------------------------------
--1.'SHPR'
#if (${cust_tp_cd} == 'S') 
       #if (${cust_cnt_cd} != '' && ${cust_seq} == '') 
                   AND      SUBSTR(VB.SHIPPER,1,2) = @[cust_cnt_cd] 
       #end 
       #if (${cust_cnt_cd} != '' && ${cust_seq} != '') 
                   AND      VB.SHIPPER LIKE @[cust_cnt_cd] || @[cust_seq] || '%'
       #end 
       #if (${cust_nm} != '') 
                   AND      VB.SHPR_NAME LIKE   @[cust_nm] || '%'
       #end
--2.'CNEE'
#elseif (${cust_tp_cd} == 'C') 
       #if (${cust_cnt_cd} != '' && ${cust_seq} == '') 
                   AND      SUBSTR(VB.CONSIGNEE,1,2) = @[cust_cnt_cd]
       #end 
       #if (${cust_cnt_cd} != '' && ${cust_seq} != '') 
                   AND      VB.CONSIGNEE LIKE @[cust_cnt_cd] || @[cust_seq]
       #end
       #if (${cust_nm} != '') 
                   AND      VB.CONSIGNEE_NAME LIKE   @[cust_nm] || '%'
       #end 
--3.'NTFY'
#elseif (${cust_tp_cd} == 'N') 
       #if (${cust_cnt_cd} != '' && ${cust_seq} == '') 
                   AND      SUBSTR(VB.NTFY,1,2) = @[cust_cnt_cd]
       #end 
       #if (${cust_cnt_cd} != '' && ${cust_seq} != '') 
                   AND      VB.NTFY LIKE @[cust_cnt_cd] || @[cust_seq]
       #end 
       #if (${cust_nm} != '') 
                   AND      VB.NTFY_NAME LIKE   @[cust_nm] || '%'
       #end 
--4.'ANFY'
#elseif (${cust_tp_cd} == 'A') 
       #if (${cust_cnt_cd} != '' && ${cust_seq} == '') 
                   AND      SUBSTR(VB.ANTY,1,2) = @[cust_cnt_cd]
       #end 
       #if (${cust_cnt_cd} != '' && ${cust_seq} != '') 
                   AND      VB.ANTY LIKE @[cust_cnt_cd] || @[cust_seq]
       #end 
       #if (${cust_nm} != '') 
                   AND      VB.ANTY_NAME LIKE   @[cust_nm] || '%'
       #end 
--5.'FWDR'
#elseif (${cust_tp_cd} == 'F')
       #if (${cust_cnt_cd} != '' && ${cust_seq} == '') 
                   AND      SUBSTR(VB.FFDR,1,2) = @[cust_cnt_cd]
       #end 
       #if (${cust_cnt_cd} != '' && ${cust_seq} != '') 
                   AND      VB.FFDR LIKE @[cust_cnt_cd] || @[cust_seq]
       #end 
       #if (${cust_nm} != '') 
                   AND      VB.FFDR_NAME LIKE   @[cust_nm] || '%'
       #end 
#else
--6.'선택하지 않았을때..'
       #if (${cust_cnt_cd} != '' && ${cust_seq} == '') 
                   AND      ( SUBSTR(VB.SHIPPER,1,2) = @[cust_cnt_cd] OR 
                              SUBSTR(VB.CONSIGNEE,1,2)= @[cust_cnt_cd] OR
                              SUBSTR(VB.NTFY,1,2) = @[cust_cnt_cd] OR
                              SUBSTR(VB.ANTY,1,2) = @[cust_cnt_cd] OR 
                              SUBSTR(VB.FFDR,1,2) = @[cust_cnt_cd]
                            )
       #end 
       #if (${cust_cnt_cd} != '' && ${cust_seq} != '') 
                   AND      ( VB.SHIPPER = @[cust_cnt_cd] || @[cust_seq] OR    
                              VB.CONSIGNEE = @[cust_cnt_cd] || @[cust_seq] OR
                              VB.NTFY = @[cust_cnt_cd]|| @[cust_seq] OR
                              VB.ANTY = @[cust_cnt_cd]|| @[cust_seq] OR 
                              VB.FFDR = @[cust_cnt_cd]|| @[cust_seq]
                            )
       #end
       #if (${cust_nm} != '') 
                   AND      ( VB.SHPR_NAME = @[cust_nm] OR 
                              VB.CONSIGNEE_NAME = @[cust_nm] OR
                              VB.NTFY_NAME = @[cust_nm] OR
                              VB.ANTY_NAME = @[cust_nm] OR 
                              VB.FFDR_NAME = @[cust_nm]
                            )
       #end
#end

                           UNION ALL

                   SELECT   DISTINCT BVD.TRD_CD
                          , BVD.SUB_TRD_CD
                          , BVD.RLANE_CD
                          , VB.TRUNK_VVD
                          , VB.BKG_NO
                          , RANK() OVER(PARTITION BY VB.TRUNK_VVD, VB.BKG_NO, VB.POL_CD, A.CNTR_TPSZ_CD ORDER BY B.CNTR_NO) BKG_RANK
                          , VB.BKG_STS_CD
                          , SUBSTR(TRANSLATE(NVL(VB.SHPR_NAME,' '),CHR(10),' '),1,20) CUST_NM
                          , VB.BKG_CGO_TP_CD
                          , VB.POR_CD
                          , VB.POD_CD
                          , VB.POL_CD
                          , VB.DEL_CD
                          , A.CNTR_TPSZ_CD
                          , A.OP_CNTR_QTY
                          , B.RCV_TERM_CD
                          , B.DE_TERM_CD
                          , B.CNTR_NO
                          , B.CNTR_TPSZ_CD  CNTR_TPSZ_CD_MV
                          , B.CNTR_VOL_QTY
                          , B.EQ_SUBST_TPSZ_CD
                          , B.ADV_SHTG_CD
	                      , DECODE(BK.BKG_STS_CD,'X','',
				                DECODE((SELECT COP.COP_STS_CD FROM SCE_COP_HDR COP WHERE COP.BKG_NO = B.BKG_NO AND COP.CNTR_NO = B.CNTR_NO AND COP.COP_STS_CD <> 'X'),'F','MT',
					                (SELECT MST.CNMV_STS_CD FROM MST_CONTAINER MST WHERE MST.CNTR_NO = B.CNTR_NO))) CNMV_STS_CD
                          , B.ORG_YD_CD
                          , TO_CHAR(B.CNMV_EVNT_DT, 'YYYY-MM-DD HH24:MI') CNMV_EVNT_DT
                          , BK.PORT_CLZ_DT AS VPS_CCT_DT
                          , TO_CHAR(V.VPS_ETD_DT,  'YYYY-MM-DD HH24:MI') VPS_ETD_DT
                          , VB.RCV_TERM_CD RCV_TERM_CD_MV
                          , VB.DE_TERM_CD DE_TERM_CD_MV
                          , TO_CHAR(VB.BKG_CRE_DT,'YYYY-MM-DD') BKG_CRE_DT
                          , B.CNTR_PRT_FLG
                          , B.CNTR_CFM_FLG
                          , MOVE.CNMV_YR
                          , MOVE.CNMV_ID_NO
                          , MOVE.CNMV_CYC_NO
                          , VB.DEST_TRNS_SVC_MOD_CD
                          , VB.XTER_BKG_RQST_CD
                          , VB.PRE_1_VVD
                          , VB.PRE_1_POL_CD
                          , VB.KEY_POL_CD
                          , (  SELECT  NVL(CLM.CLM_SGHT_CD,' ')||','||NVL(CLM.ARR_LOC_NM,' ')||','||NVL(CLM.ARR_STE_CD,' ')||','||NVL(TO_CHAR(CLM.ARR_DT,'YYYY-MM-DD HH24:MI'),' ')||','||NVL(TO_CHAR(CLM.DEP_DT,'YYYY-MM-DD HH24:MI'),' ')
                               FROM    SCE_CLM_IF CLM, SCE_CLM_SGHT SGHT
                               WHERE   1 = 1
                               AND CLM.CNTR_NO = MOVE.CNTR_NO
                               AND CLM.CNMV_YR = MOVE.CNMV_YR
                               AND CLM.CLM_CYC_NO = MOVE.CNMV_CYC_NO
                               AND CLM.CNMV_ID_NO = MOVE.CNMV_ID_NO
                               AND CLM.CLM_SGHT_CD = SGHT.CLM_SGHT_CD
                               AND TO_CHAR(CLM.CLM_SEQ,'000')||TO_CHAR(CLM.ARR_DT,'YYYY-MM-DD HH24:MI:SS') = (  SELECT  MAX(TO_CHAR(CLM_SEQ,'000'))||TO_CHAR(MAX(Z.ARR_DT),'YYYY-MM-DD HH24:MI:SS')
                                                                                                                FROM    SCE_CLM_IF Z
                                                                                                                WHERE   Z.CNTR_NO = CLM.CNTR_NO
                                                                                                                AND     Z.CNMV_YR = CLM.CNMV_YR
                                                                                                                AND     Z.CLM_CYC_NO = CLM.CLM_CYC_NO
                                                                                                             )
                            ) CLM     
                          , (SELECT NVL(EDI_322_STS_CD,' ')||','||NVL(NVL(EVNT_CTY_NM, NVL((SELECT YD_NM FROM MDM_YARD M WHERE M.YD_CD = EVNT_YD_CD), EVNT_YD_CD)),' ')||','||NVL(EVNT_STE_CD,' ')||','||NVL(TO_CHAR(EVNT_DT,'YYYY-MM-DD HH24:MI'),' ')||','||' '
                               FROM EDI_322_MSG EDI
                               WHERE EDI.EQ_NO = MOVE.CNTR_NO
                               AND NVL(EDI.BKG_EDI_322_NO, EDI.BL_EDI_322_NO) = MOVE.BKG_NO
                               AND EVNT_DT = (SELECT MAX(EVNT_DT)
                                              FROM EDI_322_MSG Z
                                              WHERE Z.EQ_NO = EDI.EQ_NO)
                               AND ROWNUM = 1
                            ) EDI_322
                          , DECODE(VB.VSL_PRE_PST_CD,'T','TRUNK','U','POST','S','PRE') VSL_PRE_PST_CD
                          , (  SELECT  K.SPCL_CGO_APRO_CD 
                               FROM    BKG_DG_CGO K 
                               WHERE   K.BKG_NO = B.BKG_NO
                               AND     K.CNTR_NO = B.CNTR_NO
                               AND     K.DCGO_SEQ = (  SELECT MAX(G.DCGO_SEQ) FROM BKG_DG_CGO G WHERE G.BKG_NO = B.BKG_NO AND G.CNTR_NO = B.CNTR_NO  )
                            )  AS DG_STS
                          , BKG_JOIN_FNC(CURSOR(  SELECT IMDG_UN_NO FROM BKG_DG_CGO WHERE BKG_NO = VB.BKG_NO AND   CNTR_NO =B.CNTR_NO  )) DG
                          , (  SELECT  J.SPCL_CGO_APRO_CD 
                               FROM    BKG_RF_CGO J 
                               WHERE   J.BKG_NO = VB.BKG_NO
                               AND     J.RC_SEQ = (  SELECT MAX(S.RC_SEQ) FROM BKG_RF_CGO S WHERE S.BKG_NO = B.BKG_NO AND S.CNTR_NO = B.CNTR_NO  )
                            ) AS RF_STS
                          , BKG_JOIN_FNC(CURSOR(  SELECT CDO_TEMP FROM BKG_RF_CGO WHERE BKG_NO = VB.BKG_NO AND CNTR_NO =B.CNTR_NO  ))  RF
                          , (  SELECT  Y.SPCL_CGO_APRO_CD
                               FROM    BKG_AWK_CGO Y
                               WHERE   Y.BKG_NO = VB.BKG_NO
                               AND     Y.AWK_CGO_SEQ = (  SELECT MAX(Q.AWK_CGO_SEQ) FROM BKG_AWK_CGO Q WHERE Q.BKG_NO = B.BKG_NO AND Q.CNTR_NO = B.CNTR_NO  )
                            ) AS AK_STS
                          , BKG_JOIN_FNC(CURSOR(  SELECT  OVR_FWRD_LEN||'/' ||OVR_BKWD_LEN||'/' ||OVR_HGT ||'/' || OVR_LF_LEN ||'/' || OVR_RT_LEN
                                                  FROM    BKG_AWK_CGO
                                                  WHERE   BKG_NO = VB.BKG_NO
                                                  AND     CNTR_NO = B.CNTR_NO)
                            )   AK
                          , 'VVD : ' || V.VSL_CD||V.SKD_VOY_NO||V.SKD_DIR_CD || '   POL : ' || VB.KEY_POL_CD
                           	|| '    CCT : ' || TO_CHAR((PRD_COMMON_PKG.PRD_GET_CCT_BY_BKG_INFO_FNC(V.VSL_CD, V.SKD_VOY_NO, V.SKD_DIR_CD, V.VPS_PORT_CD, V.CLPT_IND_SEQ, V.YD_CD, BK.DCGO_FLG||BK.RC_FLG||BK.AWK_CGO_FLG||BK.BB_CGO_FLG||NVL((SELECT 'Y' FROM BKG_QTY_DTL QD WHERE QD.BKG_NO = BK.BKG_NO AND QD.DRY_CGO_FLG = 'Y' AND ROWNUM = 1), 'N'))),  'YYYY-MM-DD HH24:MI')
                           	|| '   ETD : ' || TO_CHAR(V.VPS_ETD_DT,  'YYYY-MM-DD HH24:MI')  SUBGROUP_TITLE
                          , '' VVD_CD
                          , '' OFC_INC_SUB
                          , '' CUST_TP_CD
                          , '' CUST_CNT_CD
                          , '' CUST_SEQ
                          , '' CHK_LT_TYPE
                          , '' CHK_INC_CLM
                          , '' BKG_DT_FR
                          , '' BKG_DT_TO
                          , '' BKG_OFC_CD
                          , (  SELECT  COP_NO
                               FROM    SCE_COP_HDR K
                               WHERE   K.BKG_NO = BK.BKG_NO
                               AND     K.CNTR_NO = B.CNTR_NO
                               AND     K.POD_NOD_CD = BK.POD_NOD_CD
                               AND     K.DEL_NOD_CD = BK.DEL_NOD_CD 
                               AND     K.COP_STS_CD <> 'X'
                            ) AS COP_NO  
                          , (  SELECT  TRNK_VSL_CD||TRNK_SKD_VOY_NO||TRNK_SKD_DIR_CD||SUBSTR(DECODE(SUBSTR(ORG_YD_CD,1,5),'CNHKG','HKGCN',SUBSTR(ORG_YD_CD,1,5)),1,2)
                               FROM    CTM_MOVEMENT
                               WHERE   CNTR_NO = B.CNTR_NO 
                               AND     BKG_NO =BK.BKG_NO 
                               AND     NVL(TRNK_VSL_CD,'COXX') NOT IN('COXX','COZZ')
                               AND     CNMV_EVNT_DT = (  SELECT  MAX(CNMV_EVNT_DT) 
                                                         FROM    CTM_MOVEMENT 
                                                         WHERE   CNTR_NO = B.CNTR_NO 
                                                         AND     BKG_NO =BK.BKG_NO 
                                                         AND     MVMT_STS_CD = 'OC'
                                                      )
                               AND     MVMT_STS_CD ='OC'                      
                               AND     ROWNUM = 1  
                            ) CRN_VVD_CNT
                          , (  SELECT  TRNK_VSL_CD||TRNK_SKD_VOY_NO||TRNK_SKD_DIR_CD||SUBSTR(DECODE(SUBSTR(CTM.ORG_YD_CD, 1, 5), 'CNHKG', 'HKGCN', SUBSTR(CTM.ORG_YD_CD, 1, 5)), 1, 2)
                               FROM    CTM_MOVEMENT CTM
                                     , BKG_BOOKING BB
                                     , BKG_CONTAINER BC
                               WHERE   CTM.BKG_NO = BB.BKG_NO
                               AND     CTM.BKG_NO = BC.BKG_NO
                               AND     CTM.CNTR_NO = BC.CNTR_NO
                               AND     CTM.BKG_NO <> BK.BKG_NO
                               AND     CTM.CNTR_NO = B.CNTR_NO
                               AND     CTM.BKG_CGO_TP_CD ='F'
                               AND     NVL(CTM.TRNK_VSL_CD, 'COXX') NOT IN('COXX','COZZ')
                               AND     CTM.CNMV_CYC_NO = (  SELECT  MAX(CNMV_CYC_NO) - 1
                                                            FROM    CTM_MOVEMENT
                                                            WHERE   CNTR_NO = B.CNTR_NO
                                                            AND     BKG_NO = BK.BKG_NO
                                                            AND     MVMT_STS_CD = 'OC'
                                                            AND     NVL(TRNK_VSL_CD, 'COXX') NOT IN('COXX','COZZ')
                                                         )
                               AND     CTM.CNMV_EVNT_DT < (  SELECT MAX(CNMV_EVNT_DT)
                                                             FROM   CTM_MOVEMENT
                                                             WHERE  CNTR_NO = B.CNTR_NO
                                                             AND    BKG_NO = BK.BKG_NO
                                                             AND    MVMT_STS_CD ='OC'
                                                             AND    NVL(TRNK_VSL_CD, 'COXX') NOT IN('COXX','COZZ')
                                                          )
                               AND     CTM.CNMV_EVNT_DT >= ( SELECT MAX(CNMV_EVNT_DT) - 30
                                                             FROM   CTM_MOVEMENT
                                                             WHERE  CNTR_NO = B.CNTR_NO
                                                             AND    BKG_NO = BK.BKG_NO
                                                             AND    MVMT_STS_CD ='OC'
                                                             AND    NVL(TRNK_VSL_CD, 'COXX') NOT IN('COXX','COZZ')
                                                          )
                               AND     CTM.MVMT_STS_CD IN ('OC','OP')
                               AND     BB.BKG_STS_CD <> 'X'
                               AND     ROWNUM = 1
                            ) PRE_VVD_CNT
                   FROM     BKG_WORK_V VB
                          , BKG_QUANTITY A
                          , VSK_VSL_PORT_SKD V
                          , BKG_CONTAINER B
                          , BKG_BOOKING BK
                          , CTM_MOVEMENT MOVE
                          , BKG_VVD_DATE BVD
                   WHERE    VB.BKG_NO = B.BKG_NO
                   AND      V.VSL_CD(+) = VB.KEY_VSL_CD
                   AND      V.SKD_VOY_NO(+) = VB.KEY_SKD_VOY_NO
                   AND      V.SKD_DIR_CD(+) = VB.KEY_SKD_DIR_CD
--                   AND      ( DECODE(VB.PRE_1_POL_CD,NULL,VB.TRUNK_POL,VB.PRE_1_POL_CD) = V.VPS_PORT_CD(+) )
                   AND      V.VPS_PORT_CD(+) = VB.KEY_POL_CD
                   AND      NVL(V.CLPT_IND_SEQ,BVD.POL_CLPT_IND_SEQ) = BVD.POL_CLPT_IND_SEQ
                   AND      VB.BKG_NO       = BK.BKG_NO
                   AND      B.CNTR_NO = MOVE.CNTR_NO(+)
                   AND      B.CNMV_YR = MOVE.CNMV_YR(+)
                   AND      B.CNMV_ID_NO = MOVE.CNMV_ID_NO(+)
                   AND      A.BKG_NO(+)       = B.BKG_NO
                   AND      A.CNTR_TPSZ_CD(+) = B.CNTR_TPSZ_CD
                              AND      BVD.CNTR_QTY_DIF = 'Y'
                   AND      (VB.BKG_STS_CD = 'F' OR VB.BKG_STS_CD = 'W' OR Vb.BKG_STS_CD = 'A')
                   AND      VB.BKG_NO = BVD.BKG_NO(+)

#if (${vvd_cd} != '') 
                   AND      VB.KEY_VSL_CD = SUBSTR(@[vvd_cd],1,4)
                   AND      VB.KEY_SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4)
                   AND      VB.KEY_SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)
#end

#if (${trd_cd} != '')
                   AND     BVD.TRD_CD = @[trd_cd]
#end

#if (${sub_trd_cd} != '') 
                   AND     BVD.SUB_TRD_CD = @[sub_trd_cd]
#end

#if (${rlane_cd} != '') 
                   AND     BVD.RLANE_CD = @[rlane_cd]
#end

#if (${ofc_inc_sub} == 'Y') 
                   AND      VB.BKG_OFC_CD IN (
                                                SELECT  OFC_CD  
                                                FROM    MDM_ORGANIZATION MO
                                                START WITH MO.OFC_CD = NVL(@[bkg_ofc_cd],VB.BKG_OFC_CD)
                                                CONNECT BY PRIOR MO.OFC_CD = MO.PRNT_OFC_CD
                                             )
#else 
       #if (${bkg_ofc_cd} != '') 
                   AND      VB.BKG_OFC_CD = @[bkg_ofc_cd] 
       #end
#end 

#if (${bkg_dt_fr} != '' || ${bkg_dt_fr} != '') 
                   AND      VB.BKG_CRE_DT BETWEEN TO_DATE(@[bkg_dt_fr],'YYYY-MM-DD') AND TO_DATE(@[bkg_dt_to],'YYYY-MM-DD') + 0.99999
#elseif (${bkg_dt_fr} != '') 
                   AND      VB.BKG_CRE_DT <= TO_DATE(@[bkg_dt_to],'YYYY-MM-DD') + 0.99999
#elseif (${bkg_dt_to} != '') 
                   AND      VB.BKG_CRE_DT >= TO_DATE(@[bkg_dt_fr],'YYYY-MM-DD')
#end

#if (${bkg_no} != '') 
                   AND      VB.BKG_NO = @[bkg_no]
#end
#if (${pol_cd} != '') 
                   AND      VB.KEY_POL_CD  LIKE RTRIM(@[pol_cd]) || '%'
#end
#if (${por_cd} != '') 
                   AND      VB.POR_CD LIKE RTRIM(@[por_cd]) || '%'
#end

#if (${rcv_term_cd} != '') 
                   AND      B.RCV_TERM_CD = @[rcv_term_cd]
#end
#if (${de_term_cd} != '') 
                   AND      VB.DE_TERM_CD = @[de_term_cd]
#end
#if (${org_yd_cd} != '') 
                   AND      B.ORG_YD_CD LIKE  @[org_yd_cd] || '%'
#end


#if (${chk_lt_type} == 'L') 
                   AND      VB.KEY_POL_CD = VB.POL_CD      --L/T Local  
#elseif (${chk_lt_type} == 'T') 
                   AND      VB.KEY_POL_CD <> VB.POL_CD     --T/S
#end

#if (${cntr_cfm_flg} != '') 
                   AND      B.CNTR_CFM_FLG = @[cntr_cfm_flg]  --Booking Container의 Tab의 Confirm 정보 
#end

#if (${bkg_sts_cd} != '') 
                   AND      VB.BKG_STS_CD = @[bkg_sts_cd]  --예약 현황 
#end

#if (${pre_1_vvd} != '') 
                   AND      VB.PRE_1_VVD LIKE @[pre_1_vvd] || '%' --pre_vvd
#end

#if (${pre_1_pol_cd} != '') 
                   AND      VB.PRE_1_POL_CD = @[pre_1_pol_cd]            --pre_pol       
#end

#if (${xter_bkg_rqst_cd} != '') 
                   AND      VB.XTER_BKG_RQST_CD = @[xter_bkg_rqst_cd]    --BKG Kind 
#end

#if (${cnmv_sts_cd} == 'Y') 
                   AND      B.CNMV_STS_CD = 'OC'     --O/C Status    Container Status가 OC인 항목 조회
#elseif  (${cnmv_sts_cd} == 'N') 
                   AND      B.CNMV_STS_CD != 'OC'
#end

#if (${bkg_cgo_tp_cd} != '') 
                   AND      BK.BKG_CGO_TP_CD = @[bkg_cgo_tp_cd]   --화물 종류All, Full, Empty로 구분 (Cargo Type 코드 참고)
#end

#if (${dest_trns_svc_mod_cd} != '') 
                   AND      VB.DEST_TRNS_SVC_MOD_CD = @[dest_trns_svc_mod_cd]  --Service Mode
#end

--------------------------------------------------------------------------
--1.'SHPR'
#if (${cust_tp_cd} == 'S') 
       #if (${cust_cnt_cd} != '' && ${cust_seq} == '') 
                   AND      SUBSTR(VB.SHIPPER,1,2) = @[cust_cnt_cd] 
       #end 
       #if (${cust_cnt_cd} != '' && ${cust_seq} != '') 
                   AND      VB.SHIPPER LIKE @[cust_cnt_cd] || @[cust_seq] || '%'
       #end 
       #if (${cust_nm} != '') 
                   AND      VB.SHPR_NAME LIKE   @[cust_nm] || '%'
       #end
--2.'CNEE'
#elseif (${cust_tp_cd} == 'C') 
       #if (${cust_cnt_cd} != '' && ${cust_seq} == '') 
                   AND      SUBSTR(VB.CONSIGNEE,1,2) = @[cust_cnt_cd]
       #end 
       #if (${cust_cnt_cd} != '' && ${cust_seq} != '') 
                   AND      VB.CONSIGNEE LIKE @[cust_cnt_cd] || @[cust_seq]
       #end
       #if (${cust_nm} != '') 
                   AND      VB.CONSIGNEE_NAME LIKE   @[cust_nm] || '%'
       #end 
--3.'NTFY'
#elseif (${cust_tp_cd} == 'N') 
       #if (${cust_cnt_cd} != '' && ${cust_seq} == '') 
                   AND      SUBSTR(VB.NTFY,1,2) = @[cust_cnt_cd]
       #end 
       #if (${cust_cnt_cd} != '' && ${cust_seq} != '') 
                   AND      VB.NTFY LIKE @[cust_cnt_cd] || @[cust_seq]
       #end 
       #if (${cust_nm} != '') 
                   AND      VB.NTFY_NAME LIKE   @[cust_nm] || '%'
       #end 
--4.'ANFY'
#elseif (${cust_tp_cd} == 'A') 
       #if (${cust_cnt_cd} != '' && ${cust_seq} == '') 
                   AND      SUBSTR(VB.ANTY,1,2) = @[cust_cnt_cd]
       #end 
       #if (${cust_cnt_cd} != '' && ${cust_seq} != '') 
                   AND      VB.ANTY LIKE @[cust_cnt_cd] || @[cust_seq]
       #end 
       #if (${cust_nm} != '') 
                   AND      VB.ANTY_NAME LIKE   @[cust_nm] || '%'
       #end 
--5.'FWDR'
#elseif (${cust_tp_cd} == 'F')
       #if (${cust_cnt_cd} != '' && ${cust_seq} == '') 
                   AND      SUBSTR(VB.FFDR,1,2) = @[cust_cnt_cd]
       #end 
       #if (${cust_cnt_cd} != '' && ${cust_seq} != '') 
                   AND      VB.FFDR LIKE @[cust_cnt_cd] || @[cust_seq]
       #end 
       #if (${cust_nm} != '') 
                   AND      VB.FFDR_NAME LIKE   @[cust_nm] || '%'
       #end 
#else
--6.'선택하지 않았을때..'
       #if (${cust_cnt_cd} != '' && ${cust_seq} == '') 
                   AND      ( SUBSTR(VB.SHIPPER,1,2) = @[cust_cnt_cd] OR 
                              SUBSTR(VB.CONSIGNEE,1,2)= @[cust_cnt_cd] OR
                              SUBSTR(VB.NTFY,1,2) = @[cust_cnt_cd] OR
                              SUBSTR(VB.ANTY,1,2) = @[cust_cnt_cd] OR 
                              SUBSTR(VB.FFDR,1,2) = @[cust_cnt_cd]
                            )
       #end 
       #if (${cust_cnt_cd} != '' && ${cust_seq} != '') 
                   AND      ( VB.SHIPPER = @[cust_cnt_cd] || @[cust_seq] OR    
                              VB.CONSIGNEE = @[cust_cnt_cd] || @[cust_seq] OR
                              VB.NTFY = @[cust_cnt_cd]|| @[cust_seq] OR
                              VB.ANTY = @[cust_cnt_cd]|| @[cust_seq] OR 
                              VB.FFDR = @[cust_cnt_cd]|| @[cust_seq]
                            )
       #end
       #if (${cust_nm} != '') 
                   AND      ( VB.SHPR_NAME = @[cust_nm] OR 
                              VB.CONSIGNEE_NAME = @[cust_nm] OR
                              VB.NTFY_NAME = @[cust_nm] OR
                              VB.ANTY_NAME = @[cust_nm] OR 
                              VB.FFDR_NAME = @[cust_nm]
                            )
       #end
#end


                           UNION ALL

                   SELECT   DISTINCT BVD.TRD_CD
                          , BVD.SUB_TRD_CD
                          , BVD.RLANE_CD
                          , VB.TRUNK_VVD
                         , VB.BKG_NO
                          , RANK() OVER(PARTITION BY VB.TRUNK_VVD, VB.BKG_NO, VB.POL_CD, A.CNTR_TPSZ_CD ORDER BY B.CNTR_NO) BKG_RANK
                          , VB.BKG_STS_CD
                          , SUBSTR(TRANSLATE(NVL(VB.SHPR_NAME,' '),CHR(10),' '),1,20) CUST_NM
                          , VB.BKG_CGO_TP_CD
                          , VB.POR_CD
                          , VB.POD_CD
                          , VB.POL_CD
                          , VB.DEL_CD
                          , A.CNTR_TPSZ_CD
                          , A.OP_CNTR_QTY
                          , B.RCV_TERM_CD
                          , B.DE_TERM_CD
                          , B.CNTR_NO
                          , B.CNTR_TPSZ_CD  CNTR_TPSZ_CD_MV
                          , B.CNTR_VOL_QTY
                          , B.EQ_SUBST_TPSZ_CD
                          , B.ADV_SHTG_CD
	                      , DECODE(BK.BKG_STS_CD,'X','',
				                DECODE((SELECT COP.COP_STS_CD FROM SCE_COP_HDR COP WHERE COP.BKG_NO = B.BKG_NO AND COP.CNTR_NO = B.CNTR_NO AND COP.COP_STS_CD <> 'X'),'F','MT',
					                (SELECT MST.CNMV_STS_CD FROM MST_CONTAINER MST WHERE MST.CNTR_NO = B.CNTR_NO))) CNMV_STS_CD
                          , B.ORG_YD_CD
                          , TO_CHAR(B.CNMV_EVNT_DT, 'YYYY-MM-DD HH24:MI') CNMV_EVNT_DT
                          , BK.PORT_CLZ_DT AS VPS_CCT_DT
                          , TO_CHAR(V.VPS_ETD_DT,  'YYYY-MM-DD HH24:MI') VPS_ETD_DT
                          , VB.RCV_TERM_CD RCV_TERM_CD_MV
                          , VB.DE_TERM_CD DE_TERM_CD_MV
                          , TO_CHAR(VB.BKG_CRE_DT,'YYYY-MM-DD') BKG_CRE_DT
                          , B.CNTR_PRT_FLG
                          , B.CNTR_CFM_FLG
                          , MOVE.CNMV_YR
                          , MOVE.CNMV_ID_NO
                          , MOVE.CNMV_CYC_NO
                          , VB.DEST_TRNS_SVC_MOD_CD
                          , VB.XTER_BKG_RQST_CD
                          , VB.PRE_1_VVD
                          , VB.PRE_1_POL_CD
                          , VB.KEY_POL_CD
                          , (  SELECT  NVL(CLM.CLM_SGHT_CD,' ')||','||NVL(CLM.ARR_LOC_NM,' ')||','||NVL(CLM.ARR_STE_CD,' ')||','||NVL(TO_CHAR(CLM.ARR_DT,'YYYY-MM-DD HH24:MI'),' ')||','||NVL(TO_CHAR(CLM.DEP_DT,'YYYY-MM-DD HH24:MI'),' ')
                               FROM    SCE_CLM_IF CLM, SCE_CLM_SGHT SGHT
                               WHERE   1 = 1
                               AND CLM.CNTR_NO = MOVE.CNTR_NO
                               AND CLM.CNMV_YR = MOVE.CNMV_YR
                               AND CLM.CLM_CYC_NO = MOVE.CNMV_CYC_NO
                               AND CLM.CNMV_ID_NO = MOVE.CNMV_ID_NO
                               AND CLM.CLM_SGHT_CD = SGHT.CLM_SGHT_CD
                               AND TO_CHAR(CLM.CLM_SEQ,'000')||TO_CHAR(CLM.ARR_DT,'YYYY-MM-DD HH24:MI:SS') = (  SELECT  MAX(TO_CHAR(CLM_SEQ,'000'))||TO_CHAR(MAX(Z.ARR_DT),'YYYY-MM-DD HH24:MI:SS')
                                                                                                                FROM    SCE_CLM_IF Z
                                                                                                                WHERE   Z.CNTR_NO = CLM.CNTR_NO
                                                                                                                AND     Z.CNMV_YR = CLM.CNMV_YR
                                                                                                                AND     Z.CLM_CYC_NO = CLM.CLM_CYC_NO
                                                                                                             )
                            ) CLM     
                          , (SELECT NVL(EDI_322_STS_CD,' ')||','||NVL(NVL(EVNT_CTY_NM, NVL((SELECT YD_NM FROM MDM_YARD M WHERE M.YD_CD = EVNT_YD_CD), EVNT_YD_CD)),' ')||','||NVL(EVNT_STE_CD,' ')||','||NVL(TO_CHAR(EVNT_DT,'YYYY-MM-DD HH24:MI'),' ')||','||' '
                               FROM EDI_322_MSG EDI
                               WHERE EDI.EQ_NO = MOVE.CNTR_NO
                               AND NVL(EDI.BKG_EDI_322_NO, EDI.BL_EDI_322_NO) = MOVE.BKG_NO
                               AND EVNT_DT = (SELECT MAX(EVNT_DT)
                                              FROM EDI_322_MSG Z
                                              WHERE Z.EQ_NO = EDI.EQ_NO)
                               AND ROWNUM = 1
                            ) EDI_322
                          , DECODE(VB.VSL_PRE_PST_CD,'T','TRUNK','U','POST','S','PRE') VSL_PRE_PST_CD
                          , (  SELECT  K.SPCL_CGO_APRO_CD 
                               FROM    BKG_DG_CGO K 
                               WHERE   K.BKG_NO = B.BKG_NO
                               AND     K.CNTR_NO = B.CNTR_NO
                               AND     K.DCGO_SEQ = (  SELECT MAX(G.DCGO_SEQ) FROM BKG_DG_CGO G WHERE G.BKG_NO = B.BKG_NO AND G.CNTR_NO = B.CNTR_NO  )
                            )  AS DG_STS
                          , BKG_JOIN_FNC(CURSOR(  SELECT IMDG_UN_NO FROM BKG_DG_CGO WHERE BKG_NO = VB.BKG_NO AND   CNTR_NO =B.CNTR_NO  )) DG
                          , (  SELECT  J.SPCL_CGO_APRO_CD 
                               FROM    BKG_RF_CGO J 
                               WHERE   J.BKG_NO = VB.BKG_NO
                               AND     J.RC_SEQ = (  SELECT MAX(S.RC_SEQ) FROM BKG_RF_CGO S WHERE S.BKG_NO = B.BKG_NO AND S.CNTR_NO = B.CNTR_NO  )
                            ) AS RF_STS
                          , BKG_JOIN_FNC(CURSOR(  SELECT CDO_TEMP FROM BKG_RF_CGO WHERE BKG_NO = VB.BKG_NO AND CNTR_NO =B.CNTR_NO  ))  RF
                          , (  SELECT  Y.SPCL_CGO_APRO_CD
                               FROM    BKG_AWK_CGO Y
                               WHERE   Y.BKG_NO = VB.BKG_NO
                               AND     Y.AWK_CGO_SEQ = (  SELECT MAX(Q.AWK_CGO_SEQ) FROM BKG_AWK_CGO Q WHERE Q.BKG_NO = B.BKG_NO AND Q.CNTR_NO = B.CNTR_NO  )
                            ) AS AK_STS
                          , BKG_JOIN_FNC(CURSOR(  SELECT  OVR_FWRD_LEN||'/' ||OVR_BKWD_LEN||'/' ||OVR_HGT ||'/' || OVR_LF_LEN ||'/' || OVR_RT_LEN
                                                  FROM    BKG_AWK_CGO
                                                  WHERE   BKG_NO = VB.BKG_NO
                                                  AND     CNTR_NO = B.CNTR_NO)
                            )   AK
                          , 'VVD : ' || V.VSL_CD||V.SKD_VOY_NO||V.SKD_DIR_CD || '   POL : ' || VB.KEY_POL_CD
                           	|| '    CCT : ' || TO_CHAR((PRD_COMMON_PKG.PRD_GET_CCT_BY_BKG_INFO_FNC(V.VSL_CD, V.SKD_VOY_NO, V.SKD_DIR_CD, V.VPS_PORT_CD, V.CLPT_IND_SEQ, V.YD_CD, BK.DCGO_FLG||BK.RC_FLG||BK.AWK_CGO_FLG||BK.BB_CGO_FLG||NVL((SELECT 'Y' FROM BKG_QTY_DTL QD WHERE QD.BKG_NO = BK.BKG_NO AND QD.DRY_CGO_FLG = 'Y' AND ROWNUM = 1), 'N'))),  'YYYY-MM-DD HH24:MI')
                           	|| '   ETD : ' || TO_CHAR(V.VPS_ETD_DT,  'YYYY-MM-DD HH24:MI')  SUBGROUP_TITLE
                          , '' VVD_CD
                          , '' OFC_INC_SUB
                          , '' CUST_TP_CD
                          , '' CUST_CNT_CD
                          , '' CUST_SEQ
                          , '' CHK_LT_TYPE
                          , '' CHK_INC_CLM
                          , '' BKG_DT_FR
                          , '' BKG_DT_TO
                          , '' BKG_OFC_CD
                          , (  SELECT  COP_NO
                               FROM    SCE_COP_HDR K
                               WHERE   K.BKG_NO = BK.BKG_NO
                               AND     K.CNTR_NO = B.CNTR_NO
                               AND     K.POD_NOD_CD = BK.POD_NOD_CD
                               AND     K.DEL_NOD_CD = BK.DEL_NOD_CD 
                               AND     K.COP_STS_CD <> 'X'
                            ) AS COP_NO  
                          , (  SELECT  TRNK_VSL_CD||TRNK_SKD_VOY_NO||TRNK_SKD_DIR_CD||SUBSTR(DECODE(SUBSTR(ORG_YD_CD,1,5),'CNHKG','HKGCN',SUBSTR(ORG_YD_CD,1,5)),1,2)
                               FROM    CTM_MOVEMENT
                               WHERE   CNTR_NO = B.CNTR_NO 
                               AND     BKG_NO =BK.BKG_NO 
                               AND     NVL(TRNK_VSL_CD,'COXX') NOT IN('COXX','COZZ')
                               AND     CNMV_EVNT_DT = (  SELECT  MAX(CNMV_EVNT_DT) 
                                                         FROM    CTM_MOVEMENT 
                                                         WHERE   CNTR_NO = B.CNTR_NO 
                                                         AND     BKG_NO =BK.BKG_NO 
                                                         AND     MVMT_STS_CD = 'OC'
                                                      )
                               AND     MVMT_STS_CD ='OC'                      
                               AND     ROWNUM = 1  
                            ) CRN_VVD_CNT
                          , (  SELECT  TRNK_VSL_CD||TRNK_SKD_VOY_NO||TRNK_SKD_DIR_CD||SUBSTR(DECODE(SUBSTR(CTM.ORG_YD_CD, 1, 5), 'CNHKG', 'HKGCN', SUBSTR(CTM.ORG_YD_CD, 1, 5)), 1, 2)
                               FROM    CTM_MOVEMENT CTM
                                     , BKG_BOOKING BB
                                     , BKG_CONTAINER BC
                               WHERE   CTM.BKG_NO = BB.BKG_NO
                               AND     CTM.BKG_NO = BC.BKG_NO
                               AND     CTM.CNTR_NO = BC.CNTR_NO
                               AND     CTM.BKG_NO <> BK.BKG_NO
                               AND     CTM.CNTR_NO = B.CNTR_NO
                               AND     CTM.BKG_CGO_TP_CD ='F'
                               AND     NVL(CTM.TRNK_VSL_CD, 'COXX') NOT IN('COXX','COZZ')
                               AND     CTM.CNMV_CYC_NO = (  SELECT  MAX(CNMV_CYC_NO) - 1
                                                            FROM    CTM_MOVEMENT
                                                            WHERE   CNTR_NO = B.CNTR_NO
                                                            AND     BKG_NO = BK.BKG_NO
                                                            AND     MVMT_STS_CD = 'OC'
                                                            AND     NVL(TRNK_VSL_CD, 'COXX') NOT IN('COXX','COZZ')
                                                         )
                               AND     CTM.CNMV_EVNT_DT < (  SELECT MAX(CNMV_EVNT_DT)
                                                             FROM   CTM_MOVEMENT
                                                             WHERE  CNTR_NO = B.CNTR_NO
                                                             AND    BKG_NO = BK.BKG_NO
                                                             AND    MVMT_STS_CD ='OC'
                                                             AND    NVL(TRNK_VSL_CD, 'COXX') NOT IN('COXX','COZZ')
                                                          )
                               AND     CTM.CNMV_EVNT_DT >= ( SELECT MAX(CNMV_EVNT_DT) - 30
                                                             FROM   CTM_MOVEMENT
                                                             WHERE  CNTR_NO = B.CNTR_NO
                                                             AND    BKG_NO = BK.BKG_NO
                                                             AND    MVMT_STS_CD ='OC'
                                                             AND    NVL(TRNK_VSL_CD, 'COXX') NOT IN('COXX','COZZ')
                                                          )
                               AND     CTM.MVMT_STS_CD IN ('OC','OP')
                               AND     BB.BKG_STS_CD <> 'X'
                               AND     ROWNUM = 1
                            ) PRE_VVD_CNT
                   FROM     BKG_WORK_V VB
                          , BKG_QUANTITY A
                          , VSK_VSL_PORT_SKD V
                          , BKG_CONTAINER B
                          , BKG_BOOKING BK
                          , CTM_MOVEMENT MOVE
                          , BKG_VVD_DATE BVD
                   WHERE    VB.BKG_NO = A.BKG_NO
                   AND      V.VSL_CD(+) = VB.KEY_VSL_CD
                   AND      V.SKD_VOY_NO(+) = VB.KEY_SKD_VOY_NO
                   AND      V.SKD_DIR_CD(+) = VB.KEY_SKD_DIR_CD
--                   AND      ( DECODE(VB.PRE_1_POL_CD,NULL,VB.TRUNK_POL,VB.PRE_1_POL_CD) = V.VPS_PORT_CD(+) )
                   AND      V.VPS_PORT_CD(+) = VB.KEY_POL_CD
                   AND      NVL(V.CLPT_IND_SEQ,BVD.POL_CLPT_IND_SEQ) = BVD.POL_CLPT_IND_SEQ
                   AND      VB.BKG_NO       = BK.BKG_NO
                   AND      B.CNTR_NO = MOVE.CNTR_NO(+)
                   AND      B.CNMV_YR = MOVE.CNMV_YR(+)
                   AND      B.CNMV_ID_NO = MOVE.CNMV_ID_NO(+)
                   AND      A.BKG_NO       = B.BKG_NO(+)
                   AND      A.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD(+)
                   AND      A.CNTR_TPSZ_CD NOT IN ( SELECT DISTINCT NVL(BQ.CNTR_TPSZ_CD, NVL((SELECT CNTR_TPSZ_CD FROM BKG_QUANTITY WHERE BKG_NO = BC.BKG_NO AND CNTR_TPSZ_CD = SUBSTR(BC.CNTR_TPSZ_CD,1,1)||DECODE(SUBSTR(BC.CNTR_TPSZ_CD,2,1),'4','5','4')),'  ')) CNTR_TPSZ_CD_BQ
                                                  FROM BKG_QUANTITY BQ, BKG_CONTAINER BC
                                                 WHERE BQ.BKG_NO (+) = BC.BKG_NO
                                                   AND BQ.CNTR_TPSZ_CD (+) = BC.CNTR_TPSZ_CD
                                                   AND BC.BKG_NO = A.BKG_NO
                                               )
                              AND      BVD.CNTR_QTY_DIF = 'Y'
                   AND      (VB.BKG_STS_CD = 'F' OR VB.BKG_STS_CD = 'W' OR Vb.BKG_STS_CD = 'A')
                   AND      VB.BKG_NO = BVD.BKG_NO(+)

#if (${vvd_cd} != '') 
                   AND      VB.KEY_VSL_CD = SUBSTR(@[vvd_cd],1,4)
                   AND      VB.KEY_SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4)
                   AND      VB.KEY_SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)
#end

#if (${trd_cd} != '')
                   AND     BVD.TRD_CD = @[trd_cd]
#end

#if (${sub_trd_cd} != '') 
                   AND     BVD.SUB_TRD_CD = @[sub_trd_cd]
#end

#if (${rlane_cd} != '') 
                   AND     BVD.RLANE_CD = @[rlane_cd]
#end

#if (${ofc_inc_sub} == 'Y') 
                   AND      VB.BKG_OFC_CD IN (
                                                SELECT  OFC_CD  
                                                FROM    MDM_ORGANIZATION MO
                                                START WITH MO.OFC_CD = NVL(@[bkg_ofc_cd],VB.BKG_OFC_CD)
                                                CONNECT BY PRIOR MO.OFC_CD = MO.PRNT_OFC_CD
                                             )
#else 
       #if (${bkg_ofc_cd} != '') 
                   AND      VB.BKG_OFC_CD = @[bkg_ofc_cd] 
       #end
#end 

#if (${bkg_dt_fr} != '' || ${bkg_dt_fr} != '') 
                   AND      VB.BKG_CRE_DT BETWEEN TO_DATE(@[bkg_dt_fr],'YYYY-MM-DD') AND TO_DATE(@[bkg_dt_to],'YYYY-MM-DD') + 0.99999
#elseif (${bkg_dt_fr} != '') 
                   AND      VB.BKG_CRE_DT <= TO_DATE(@[bkg_dt_to],'YYYY-MM-DD') + 0.99999
#elseif (${bkg_dt_to} != '') 
                   AND      VB.BKG_CRE_DT >= TO_DATE(@[bkg_dt_fr],'YYYY-MM-DD')
#end

#if (${bkg_no} != '') 
                   AND      VB.BKG_NO = @[bkg_no]
#end
#if (${pol_cd} != '') 
                   AND      VB.KEY_POL_CD  LIKE RTRIM(@[pol_cd]) || '%'
#end
#if (${por_cd} != '') 
                   AND      VB.POR_CD LIKE RTRIM(@[por_cd]) || '%'
#end

#if (${rcv_term_cd} != '') 
                   AND      B.RCV_TERM_CD = @[rcv_term_cd]
#end
#if (${de_term_cd} != '') 
                   AND      VB.DE_TERM_CD = @[de_term_cd]
#end
#if (${org_yd_cd} != '') 
                   AND      B.ORG_YD_CD LIKE  @[org_yd_cd] || '%'
#end


#if (${chk_lt_type} == 'L') 
                   AND      VB.KEY_POL_CD = VB.POL_CD      --L/T Local  
#elseif (${chk_lt_type} == 'T') 
                   AND      VB.KEY_POL_CD <> VB.POL_CD     --T/S
#end

#if (${cntr_cfm_flg} != '') 
                   AND      B.CNTR_CFM_FLG = @[cntr_cfm_flg]  --Booking Container의 Tab의 Confirm 정보 
#end

#if (${bkg_sts_cd} != '') 
                   AND      VB.BKG_STS_CD = @[bkg_sts_cd]  --예약 현황 
#end

#if (${pre_1_vvd} != '') 
                   AND      VB.PRE_1_VVD LIKE @[pre_1_vvd] || '%' --pre_vvd
#end

#if (${pre_1_pol_cd} != '') 
                   AND      VB.PRE_1_POL_CD = @[pre_1_pol_cd]            --pre_pol       
#end

#if (${xter_bkg_rqst_cd} != '') 
                   AND      VB.XTER_BKG_RQST_CD = @[xter_bkg_rqst_cd]    --BKG Kind 
#end

#if (${cnmv_sts_cd} == 'Y') 
                   AND      B.CNMV_STS_CD = 'OC'     --O/C Status    Container Status가 OC인 항목 조회
#elseif  (${cnmv_sts_cd} == 'N') 
                   AND      B.CNMV_STS_CD != 'OC'
#end

#if (${bkg_cgo_tp_cd} != '') 
                   AND      BK.BKG_CGO_TP_CD = @[bkg_cgo_tp_cd]   --화물 종류All, Full, Empty로 구분 (Cargo Type 코드 참고)
#end

#if (${dest_trns_svc_mod_cd} != '') 
                   AND      VB.DEST_TRNS_SVC_MOD_CD = @[dest_trns_svc_mod_cd]  --Service Mode
#end

--------------------------------------------------------------------------
--1.'SHPR'
#if (${cust_tp_cd} == 'S') 
       #if (${cust_cnt_cd} != '' && ${cust_seq} == '') 
                   AND      SUBSTR(VB.SHIPPER,1,2) = @[cust_cnt_cd] 
       #end 
       #if (${cust_cnt_cd} != '' && ${cust_seq} != '') 
                   AND      VB.SHIPPER LIKE @[cust_cnt_cd] || @[cust_seq] || '%'
       #end 
       #if (${cust_nm} != '') 
                   AND      VB.SHPR_NAME LIKE   @[cust_nm] || '%'
       #end
--2.'CNEE'
#elseif (${cust_tp_cd} == 'C') 
       #if (${cust_cnt_cd} != '' && ${cust_seq} == '') 
                   AND      SUBSTR(VB.CONSIGNEE,1,2) = @[cust_cnt_cd]
       #end 
       #if (${cust_cnt_cd} != '' && ${cust_seq} != '') 
                   AND      VB.CONSIGNEE LIKE @[cust_cnt_cd] || @[cust_seq]
       #end
       #if (${cust_nm} != '') 
                   AND      VB.CONSIGNEE_NAME LIKE   @[cust_nm] || '%'
       #end 
--3.'NTFY'
#elseif (${cust_tp_cd} == 'N') 
       #if (${cust_cnt_cd} != '' && ${cust_seq} == '') 
                   AND      SUBSTR(VB.NTFY,1,2) = @[cust_cnt_cd]
       #end 
       #if (${cust_cnt_cd} != '' && ${cust_seq} != '') 
                   AND      VB.NTFY LIKE @[cust_cnt_cd] || @[cust_seq]
       #end 
       #if (${cust_nm} != '') 
                   AND      VB.NTFY_NAME LIKE   @[cust_nm] || '%'
       #end 
--4.'ANFY'
#elseif (${cust_tp_cd} == 'A') 
       #if (${cust_cnt_cd} != '' && ${cust_seq} == '') 
                   AND      SUBSTR(VB.ANTY,1,2) = @[cust_cnt_cd]
       #end 
       #if (${cust_cnt_cd} != '' && ${cust_seq} != '') 
                   AND      VB.ANTY LIKE @[cust_cnt_cd] || @[cust_seq]
       #end 
       #if (${cust_nm} != '') 
                   AND      VB.ANTY_NAME LIKE   @[cust_nm] || '%'
       #end 
--5.'FWDR'
#elseif (${cust_tp_cd} == 'F')
       #if (${cust_cnt_cd} != '' && ${cust_seq} == '') 
                   AND      SUBSTR(VB.FFDR,1,2) = @[cust_cnt_cd]
       #end 
       #if (${cust_cnt_cd} != '' && ${cust_seq} != '') 
                   AND      VB.FFDR LIKE @[cust_cnt_cd] || @[cust_seq]
       #end 
       #if (${cust_nm} != '') 
                   AND      VB.FFDR_NAME LIKE   @[cust_nm] || '%'
       #end 
#else
--6.'선택하지 않았을때..'
       #if (${cust_cnt_cd} != '' && ${cust_seq} == '') 
                   AND      ( SUBSTR(VB.SHIPPER,1,2) = @[cust_cnt_cd] OR 
                              SUBSTR(VB.CONSIGNEE,1,2)= @[cust_cnt_cd] OR
                              SUBSTR(VB.NTFY,1,2) = @[cust_cnt_cd] OR
                              SUBSTR(VB.ANTY,1,2) = @[cust_cnt_cd] OR 
                              SUBSTR(VB.FFDR,1,2) = @[cust_cnt_cd]
                            )
       #end 
       #if (${cust_cnt_cd} != '' && ${cust_seq} != '') 
                   AND      ( VB.SHIPPER = @[cust_cnt_cd] || @[cust_seq] OR    
                              VB.CONSIGNEE = @[cust_cnt_cd] || @[cust_seq] OR
                              VB.NTFY = @[cust_cnt_cd]|| @[cust_seq] OR
                              VB.ANTY = @[cust_cnt_cd]|| @[cust_seq] OR 
                              VB.FFDR = @[cust_cnt_cd]|| @[cust_seq]
                            )
       #end
       #if (${cust_nm} != '') 
                   AND      ( VB.SHPR_NAME = @[cust_nm] OR 
                              VB.CONSIGNEE_NAME = @[cust_nm] OR
                              VB.NTFY_NAME = @[cust_nm] OR
                              VB.ANTY_NAME = @[cust_nm] OR 
                              VB.FFDR_NAME = @[cust_nm]
                            )
       #end
#end
                           ) A
                           ORDER BY TRUNK_VVD , KEY_POL_CD , BKG_NO , CNTR_TPSZ_CD , CNTR_NO
                ) T 
        )
WHERE   1 = 1
#if (${chk_dup_vvd} != '') 
AND     CNTR_CHECK = @[chk_dup_vvd]
#end
--------------------------------------------------------------------------
ORDER BY SUBGROUP_TITLE, BKG_NO, CNTR_NO			]]></sql>
			<params>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="sub_trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="bkg_ofc_cd" type="12" value="" out="N"/>
				<param name="bkg_dt_fr" type="12" value="" out="N"/>
				<param name="bkg_dt_to" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="por_cd" type="12" value="" out="N"/>
				<param name="rcv_term_cd" type="12" value="" out="N"/>
				<param name="de_term_cd" type="12" value="" out="N"/>
				<param name="org_yd_cd" type="12" value="" out="N"/>
				<param name="cntr_cfm_flg" type="12" value="" out="N"/>
				<param name="bkg_sts_cd" type="12" value="" out="N"/>
				<param name="pre_1_vvd" type="12" value="" out="N"/>
				<param name="pre_1_pol_cd" type="12" value="" out="N"/>
				<param name="xter_bkg_rqst_cd" type="12" value="" out="N"/>
				<param name="bkg_cgo_tp_cd" type="12" value="" out="N"/>
				<param name="dest_trns_svc_mod_cd" type="12" value="" out="N"/>
				<param name="cust_cnt_cd" type="12" value="" out="N"/>
				<param name="cust_seq" type="12" value="" out="N"/>
				<param name="cust_nm" type="12" value="" out="N"/>
				<param name="chk_dup_vvd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
