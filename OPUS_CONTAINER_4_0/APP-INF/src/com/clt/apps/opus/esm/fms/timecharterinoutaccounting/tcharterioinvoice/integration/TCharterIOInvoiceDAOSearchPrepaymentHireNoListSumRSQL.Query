<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOInvoiceDAOSearchPrepaymentHireNoListSumRSQL">
			<desc><![CDATA[TCharterIOInvoiceDAOSearchPrepaymentHireNoListSumRSQL]]></desc>
			<sql><![CDATA[
SELECT CURR_CD
     , TRIM(TO_CHAR(SUM(INV_AMT),'999,999,999,999,999,999.00')) INV_AMT
     , CURR_CD2
     , TRIM(TO_CHAR(SUM(INV_AMT2),'999,999,999,999,999,999.00')) INV_AMT2
  FROM (SELECT DECODE(FD.FLET_CURR_CHK_CD,'F',FD.CURR_CD,NULL) CURR_CD
             , DECODE(FD.FLET_CURR_CHK_CD,'F',FD.INV_AMT,NULL) INV_AMT
             , DECODE(FD.FLET_CURR_CHK_CD,'S',FD.CURR_CD,NULL) CURR_CD2
             , DECODE(FD.FLET_CURR_CHK_CD,'S',FD.INV_AMT,NULL) INV_AMT2
          FROM FMS_INVOICE FI
             , FMS_INV_DTL FD
             , FMS_ACCT_ITM FA
         WHERE FI.FLET_CTRT_NO = FD.FLET_CTRT_NO
           AND FI.FLET_CTRT_NO = @[flet_ctrt_no]
           AND FI.PPAY_HIR_NO = @[ppay_hir_no]
           AND FI.FLET_ISS_TP_CD = 'PRE'
           AND FI.INV_SEQ = FD.INV_SEQ
           AND FI.FLET_ISS_TP_CD = FD.FLET_ISS_TP_CD
           AND FD.ACCT_CD = FA.ACCT_CD
           AND FD.ACCT_ITM_SEQ = FA.ACCT_ITM_SEQ
           AND NOT EXISTS ( SELECT 'X'
                              FROM FMS_ACCT_ITM AI
                                 , FMS_ACCT_CATE AC
                             WHERE AI.ACCT_CD = AC.ACCT_CD
                               AND AI.ACCT_ITM_SEQ = AC.ACCT_ITM_SEQ
                               AND AC.FLET_ACCT_CATE_CD = 'BR' /*Brokerage*/
                               AND AI.ACCT_CD = FD.ACCT_CD
                               AND ROWNUM = 1 ) 
        )
 GROUP BY CURR_CD, CURR_CD2			]]></sql>
			<params>
				<param name="flet_ctrt_no" type="12" value="" out="N"/>
				<param name="ppay_hir_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
