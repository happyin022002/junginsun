<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingSearchDBDAOSearchBkgTmlEdiBatchRSQL">
			<desc><![CDATA[SearchBkgTmlEdiBatch]]></desc>
			<sql><![CDATA[
SELECT DISTINCT BK.BKG_NO
     , BK.BKG_STS_CD
     , DECODE(BK.BKG_CGO_TP_CD, 'F', 'F', 'P', 'M') F_M
     , VVD.VSL_CD||VVD.SKD_VOY_NO||VVD.SKD_DIR_CD FIRST_VVD
     , (SELECT TO_CHAR(VPS_ETB_DT, 'YYYY-MM-DD')
          FROM VSK_VSL_PORT_SKD SKD
         WHERE VVD.VSL_CD           = SKD.VSL_CD
           AND VVD.SKD_VOY_NO       = SKD.SKD_VOY_NO
           AND VVD.SKD_DIR_CD       = SKD.SKD_DIR_CD
           AND VVD.POL_CD           = SKD.VPS_PORT_CD
           AND VVD.pol_CLPT_IND_SEQ = SKD.CLPT_IND_SEQ) ETB
     , VVD.SLAN_CD LANE
     , VVD.POL_CD
     , VVD.POL_YD_CD
     , BK.MY_FWRD_CD FWDR_CD
     , BK.MY_FWRD_VSL_DESC VOYAGE
     , DCHG.CVY_REF_NO CRN
     , DCHG.UQ_VSL_ID_NO UVI
     , TO_CHAR(BKG_CRE_DT, 'YYYY-MM-DD HH:MI') BKG_DATE
     , BK.DOC_USR_ID BKG_STAFF
     , (SELECT USR.USR_NM FROM COM_USER USR WHERE USR.USR_ID = BK.DOC_USR_ID) BKG_STAFF_NM
  FROM BKG_BOOKING BK
     , BKG_VVD VVD
     , VSK_VSL_PORT_SKD SKD
     , BKG_VSL_DCHG_YD DCHG
 WHERE BK.BKG_NO = VVD.BKG_NO
   AND VVD.POL_YD_CD 		= @[edi_ref_cd]
   AND BK.BKG_STS_CD        <> 'X'
   AND BK.BKG_CGO_TP_CD 	IN('F','R')
   AND VVD.VSL_CD           = DCHG.VSL_CD(+)
   AND VVD.SKD_VOY_NO       = DCHG.SKD_VOY_NO(+)
   AND VVD.SKD_DIR_CD       = DCHG.SKD_DIR_CD(+)
   AND VVD.POL_CD           = DCHG.PORT_CD(+)
   AND VVD.pol_CLPT_IND_SEQ = DCHG.CLPT_IND_SEQ(+)
   AND VVD.VSL_CD           = SKD.VSL_CD
   AND VVD.SKD_VOY_NO       = SKD.SKD_VOY_NO
   AND VVD.SKD_DIR_CD       = SKD.SKD_DIR_CD
   AND VVD.POL_CD           = SKD.VPS_PORT_CD
   AND VVD.POL_CLPT_IND_SEQ = SKD.CLPT_IND_SEQ
   AND SKD.VPS_ETD_DT BETWEEN trunc(SYSDATE) AND trunc(SYSDATE) + 20
#if (${vvd} != '')
   AND VVD.VSL_CD = substr(@[vvd],1,4)
   AND VVD.SKD_VOY_NO = substr(@[vvd],5,4)
   AND VVD.SKD_DIR_CD = substr(@[vvd],9,1)
#end			]]></sql>
			<params>
				<param name="edi_ref_cd" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
