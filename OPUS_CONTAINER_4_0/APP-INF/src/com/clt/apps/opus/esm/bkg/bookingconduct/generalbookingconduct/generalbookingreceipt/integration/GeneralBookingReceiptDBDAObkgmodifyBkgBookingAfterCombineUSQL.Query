<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingReceiptDBDAObkgmodifyBkgBookingAfterCombineUSQL">
			<desc><![CDATA[combine이후 term, status 를 정리한다.]]></desc>
			<sql><![CDATA[
update bkg_booking
set WT_RSN_SPCL_CGO_FLG =
         nvl((select case when count(1) = 1 then 'Y' else null end 
              from bkg_booking 
               where bkg_no in (
#foreach($bkgNo IN ${bkg_no})        
	#if($velocityCount < $bkg_no.size()) '$bkgNo', #else '$bkgNo' #end
#end
								)
               and WT_RSN_SPCL_CGO_FLG = 'Y'
               and rownum = 1), 'N') 
  , WT_RSN_HLD_FLG =                
         nvl((select case when count(1) = 1 then 'Y' else null end   
                from bkg_booking
               where bkg_no in (
#foreach($bkgNo IN ${bkg_no})        
	#if($velocityCount < $bkg_no.size()) '$bkgNo', #else '$bkgNo' #end
#end
								)
                 and WT_RSN_HLD_FLG = 'Y'
                 and rownum = 1), 'N') 
  , rcv_term_cd = decode((select case when count(1) = 1 then 'NORMAL'
                                     else 'MIXED' end rcv_term_cd
                           from (select distinct rcv_term_cd
                                   from bkg_booking
					              where bkg_no in (
#foreach($bkgNo IN ${bkg_no})        
	#if($velocityCount < $bkg_no.size()) '$bkgNo', #else '$bkgNo' #end
#end
								)))
                         , 'MIXED', 'M', rcv_term_cd)
  , de_term_Cd  = decode((select case when count(1) = 1 then 'NORMAL'
                                     else 'MIXED' end de_term_cd
                           from (select distinct de_term_cd
                                   from bkg_booking
					              where bkg_no in (
#foreach($bkgNo IN ${bkg_no})        
	#if($velocityCount < $bkg_no.size()) '$bkgNo', #else '$bkgNo' #end
#end
								)))
                         , 'MIXED', 'M', de_term_cd)
  , bkg_sts_cd =  
         nvl((select case when count(1) = 1 then 'W' else null end  
                from bkg_booking
               where bkg_no in (
#foreach($bkgNo IN ${bkg_no})        
	#if($velocityCount < $bkg_no.size()) '$bkgNo', #else '$bkgNo' #end
#end
								)
                 and bkg_sts_cd = 'W'    
                 and rownum = 1), bkg_sts_cd)   

  , FLEX_HGT_FLG =  
         nvl((select case when count(1) = 1 then 'Y' else 'N' end  
                from bkg_booking
               where bkg_no in (
#foreach($bkgNo IN ${bkg_no})        
	#if($velocityCount < $bkg_no.size()) '$bkgNo', #else '$bkgNo' #end
#end
								)
                 and FLEX_HGT_FLG = 'Y'    
                 and rownum = 1), FLEX_HGT_FLG)   
  , upd_dt = sysdate
  , upd_usr_id = @[usr_id]  
  , LST_SAV_DT = SYSDATE                
where bkg_no = @[mst_bkg_no]			]]></sql>
			<params>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="mst_bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
