<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UsaCustomsReportDBDAOsearchTransmitHistoryList3RSQL">
			<desc><![CDATA[searchTransmitHistoryList3]]></desc>
			<sql><![CDATA[
SELECT *
FROM (
    SELECT CNT_CD
          ,IO_BND_CD
          ,STWG_SND_ID
          ,SND_DATE
          ,SND_DT
          ,SND_TM
          ,HIS_SEQ
          ,DECODE(A.TRSM_MSG_TP_ID, 'MI', DECODE(A.CGO_TP_CD, '', A.TRSM_MSG_TP_ID, A.TRSM_MSG_TP_ID||' ('||A.CGO_TP_CD||') '), A.TRSM_MSG_TP_ID) AS TRSM_MSG_TP_ID
          ,VVD
          ,POL_CD
          ,POD_CD
          ,CSTMS_PORT_CD
          ,OFC_CD
          ,USR_ID
          ,BL_NO
          ,DECODE(CNTR_KNT, 0, '', CNTR_KNT) AS CNTR_KNT
          ,MSG_DESC
          ,ROW_NUMBER() OVER(ORDER BY SND_DATE DESC) AS RNUM
          ,COUNT(*) OVER() AS TOTAL
      FROM (SELECT DISTINCT
                   L.CNT_CD
                  ,L.IO_BND_CD
                  ,'' AS STWG_SND_ID
                  ,L.SND_DT AS SND_DATE
                  ,TO_CHAR(L.SND_DT, 'YYYYMMDD') AS SND_DT
                  ,TO_CHAR(L.SND_DT, 'HH24MISS') AS SND_TM
                  ,L.HIS_SEQ
                  ,L.TRSM_MSG_TP_ID
                  ,L.VSL_CD || L.SKD_VOY_NO || L.SKD_DIR_CD AS VVD
                  ,L.VSL_CD
                  ,L.SKD_VOY_NO
                  ,L.SKD_DIR_CD
                  ,NVL(E.POL_CD, L.POL_CD) AS POL_CD
                  ,NVL(E.POD_CD, L.POD_CD) AS POD_CD
                  ,L.CSTMS_PORT_CD
                  ,L.SND_USR_OFC_CD AS OFC_CD
                  ,L.SND_USR_ID AS USR_ID
                  ,CASE WHEN TRSM_MSG_TP_ID = 'MI' THEN ''
                        ELSE E.BL_NO
                   END BL_NO
                  ,0 AS CNTR_KNT
                  ,'' AS MSG_DESC
                  ,DECODE(L.CGO_TP_CD, 'M', 'Empty', 'F', 'Full') AS CGO_TP_CD
             FROM BKG_CSTMS_ADV_SND_LOG     L
                 ,BKG_CSTMS_ADV_EDI_BL_RSPN E
            WHERE 1=1
              AND L.CNT_CD = E.CNT_CD(+)
              AND L.CRR_BAT_NO = E.CRR_BAT_NO(+)
              AND L.CNT_CD = @[cnt_cd]
              AND L.IO_BND_CD = @[io_bnd_cd]
    #if (${bl_no} != '') 
              AND E.BL_NO = @[bl_no]
    #else
        #if (${trsm_msg_tp_id} != '' && ${trsm_msg_tp_id} != 'AL')  
              AND L.TRSM_MSG_TP_ID = @[trsm_msg_tp_id]
        #end
        #if (${vvd} != '') 
              AND L.VSL_CD     = SUBSTR(@[vvd], 1, 4)
              AND L.SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
              AND L.SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
        #end
        #if (${pol_cd} != '') 
              AND L.POL_CD = @[pol_cd]
        #end
        #if (${pod_cd} != '') 
              AND L.POD_CD = @[pod_cd]
        #end
        #if (${snd_ofc_cd} != '') 
              AND L.SND_USR_OFC_CD LIKE @[snd_ofc_cd] || '%'
        #end
        #if (${snd_usr_id} != '') 
              AND L.SND_USR_ID LIKE @[snd_usr_id] || '%'
        #end
        #if (${snd_fromd} != '') 
              AND L.SND_DT >= TO_DATE(REPLACE(REPLACE(@[snd_fromd], '-', ''), '/', '') ||' '|| REPLACE(REPLACE(@[snd_fromt], ':', ''), '-',''),'YYYYMMDD HH24MI')
        #end 
        #if (${snd_tod} != '') 
              AND L.SND_DT <= TO_DATE(REPLACE(REPLACE(@[snd_tod], '-', ''), '/', '') ||' '|| REPLACE(REPLACE(@[snd_tot], ':', ''), '-',''),'YYYYMMDD HH24MI')
        #end
    #end
      
           UNION ALL
        
           SELECT DISTINCT
                  '' AS CNT_CD
                 ,'' AS IO_BND_CD
                 ,L.STWG_SND_ID   
                 ,L.SND_DT AS SND_DATE
                 ,TO_CHAR(L.SND_DT, 'YYYYMMDD') AS SND_DT
                 ,TO_CHAR(L.SND_DT, 'HH24MISS') AS SND_TM
                 ,0 AS HIS_SEQ
                 ,'ISF-5' AS TRSM_MSG_TP_ID
                 ,L.VSL_CD || L.SKD_VOY_NO || L.SKD_DIR_CD AS VVD
                 ,L.VSL_CD
                 ,L.SKD_VOY_NO
                 ,L.SKD_DIR_CD
                 ,L.POL_CD
                 ,L.POD_CD
                 ,L.CSTMS_PORT_CD
                 ,L.SND_USR_OFC_CD AS OFC_CD
                 ,L.SND_USR_ID AS USR_ID
                 ,L.BL_NO
                 ,0 AS CNTR_KNT
                 ,'' AS MSG_DESC
                 ,'' AS CGO_TP_CD
             FROM BKG_CSTMS_ADV_STWG_SND_LOG L
            WHERE 1=1
    #if (${bl_no} != '') 
              AND L.BL_NO = @[bl_no]
    #else
        #if (${trsm_msg_tp_id} == 'SN' || ${trsm_msg_tp_id} == 'AL')  
              AND L.SND_PROC_ID = 'ISF'
        #else
              AND 1=2
        #end
        #if (${vvd} != '') 
              AND L.VSL_CD     = SUBSTR(@[vvd], 1, 4)
              AND L.SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
              AND L.SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
        #end
        #if (${pol_cd} != '') 
              AND L.POL_CD = @[pol_cd]
        #end
        #if (${pod_cd} != '') 
              AND L.POD_CD = @[pod_cd]
        #end
        #if (${snd_ofc_cd} != '') 
              AND L.SND_USR_OFC_CD LIKE @[snd_ofc_cd] || '%'
        #end
        #if (${snd_usr_id} != '') 
              AND L.SND_USR_ID LIKE @[snd_usr_id] || '%'
        #end
        #if (${snd_fromd} != '') 
              AND L.SND_DT >= TO_DATE(REPLACE(REPLACE(@[snd_fromd], '-', ''), '/', '') ||' '|| REPLACE(REPLACE(@[snd_fromt], ':', ''), '-',''),'YYYYMMDD HH24MI')
        #end 
        #if (${snd_tod} != '') 
              AND L.SND_DT <= TO_DATE(REPLACE(REPLACE(@[snd_tod], '-', ''), '/', '') ||' '|| REPLACE(REPLACE(@[snd_tot], ':', ''), '-',''),'YYYYMMDD HH24MI')
        #end 
    #end 
    ) A
)
WHERE RNUM BETWEEN @[start_no] AND @[end_no]			]]></sql>
			<params>
				<param name="cnt_cd" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="trsm_msg_tp_id" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="snd_ofc_cd" type="12" value="" out="N"/>
				<param name="snd_usr_id" type="12" value="" out="N"/>
				<param name="snd_fromd" type="12" value="" out="N"/>
				<param name="snd_fromt" type="12" value="" out="N"/>
				<param name="snd_tod" type="12" value="" out="N"/>
				<param name="snd_tot" type="12" value="" out="N"/>
				<param name="start_no" type="12" value="" out="N"/>
				<param name="end_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
