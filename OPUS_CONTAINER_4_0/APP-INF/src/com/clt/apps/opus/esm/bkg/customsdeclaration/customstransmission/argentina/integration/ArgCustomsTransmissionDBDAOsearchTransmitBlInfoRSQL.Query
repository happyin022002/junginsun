<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ArgCustomsTransmissionDBDAOsearchTransmitBlInfoRSQL">
			<desc><![CDATA[searchTransmitBlInfo]]></desc>
			<sql><![CDATA[
SELECT VVD.VSL_CD                      AS VSL_CODE
      ,VSL.VSL_ENG_NM                  AS VSL_NAME
      ,VSL.VSL_RGST_CNT_CD             AS VSL_NATION_CD
      ,DECODE(@[mode_type], 'O', 'E', 'I') AS EX_IND
      ,DECODE(@[mode_type], 'I', VVD.POD_YD_CD, VVD.POL_YD_CD) AS TERMINAL_CD
      ,TO_CHAR(SKD.VPS_ETA_DT,'YYYYMMDD') AS ETA
      ,TO_CHAR(SKD.VPS_ETD_DT,'YYYYMMDD') AS ETD
      ,BKG.BL_NO                       AS BLNBR
      ,BKG.POL_CD                      AS BLPOL
      ,BKG.POD_CD                      AS BLPOD
      ,BKG.RCV_TERM_CD || BKG.DE_TERM_CD AS RD_TERM
      ,VVD.POL_CD                      AS VSPOL
      ,VVD.POD_CD                      AS VSPOD
      ,DECODE(BKG.KR_CSTMS_CUST_TP_CD, 'C', 'Y', 'N') AS CONSOLIDATE_IND
#if (${mode_type} == 'I')
      ,(SELECT DECODE(IN_TZ_FLG,'S','Y','Y','Y','N','N')
        FROM BKG_CSTMS_ARG_BL
        WHERE BL_NO = @[bl_no]) AS TR_IND
      ,(SELECT SUBSTR(VPS_PORT_CD, 1, 2)
          FROM VSK_VSL_PORT_SKD
         WHERE VSL_CD      = @[vsl_cd]
           AND SKD_VOY_NO  = @[skd_voy_no]
           AND SKD_DIR_CD  = @[skd_dir_cd]
           AND CLPT_IND_SEQ = '1'
           AND CLPT_SEQ = (SELECT MAX(CLPT_SEQ)
                             FROM VSK_VSL_PORT_SKD
                            WHERE VSL_CD      = @[vsl_cd]
                              AND SKD_VOY_NO  = @[skd_voy_no]
                              AND SKD_DIR_CD  = @[skd_dir_cd]
                              AND VPS_PORT_CD NOT LIKE 'AR%'
                              AND CLPT_IND_SEQ = '1'
                              AND CLPT_SEQ < (SELECT CLPT_SEQ
                                                FROM VSK_VSL_PORT_SKD
                                               WHERE VSL_CD      = @[vsl_cd]
                                                 AND SKD_VOY_NO  = @[skd_voy_no]
                                                 AND SKD_DIR_CD  = @[skd_dir_cd]
                                                 AND VPS_PORT_CD = VVD.POD_CD
                                                 AND CLPT_IND_SEQ = '1'
                                              )
                          )
           AND ROWNUM = 1
       ) AS FOREIGN_NATION_CD
    #else
      ,(SELECT DECODE(IN_TZ_FLG,'S','Y','Y','Y','N','N')
        FROM BKG_CSTMS_ARG_BL
        WHERE BL_NO = @[bl_no]) AS TR_IND
      ,(SELECT SUBSTR(VPS_PORT_CD, 1, 2)
          FROM VSK_VSL_PORT_SKD
         WHERE VSL_CD      = @[vsl_cd]
           AND SKD_VOY_NO  = @[skd_voy_no]
           AND SKD_DIR_CD  = @[skd_dir_cd]
           AND CLPT_IND_SEQ = '1'
           AND CLPT_SEQ = (SELECT MIN(CLPT_SEQ)
                             FROM VSK_VSL_PORT_SKD
                            WHERE VSL_CD      = @[vsl_cd]
                              AND SKD_VOY_NO  = @[skd_voy_no]
                              AND SKD_DIR_CD  = @[skd_dir_cd]
                              AND VPS_PORT_CD NOT LIKE 'AR%'
                              AND CLPT_IND_SEQ = '1'
                              AND CLPT_SEQ > (SELECT CLPT_SEQ
                                                FROM VSK_VSL_PORT_SKD
                                               WHERE VSL_CD      = @[vsl_cd]
                                                 AND SKD_VOY_NO  = @[skd_voy_no]
                                                 AND SKD_DIR_CD  = @[skd_dir_cd]
                                                 AND VPS_PORT_CD = VVD.POL_CD
                                                 AND CLPT_IND_SEQ = '1'
                                              )
                          )
           AND ROWNUM = 1
       ) AS FOREIGN_NATION_CD
    #end
      ,BKG.CMDT_CD                     AS COMMODITY_CD
      ,DOC.PCK_QTY                     AS BLPKG
      ,DOC.ACT_WGT                     AS BLWGT
      ,DOC.WGT_UT_CD                   AS BLWGT_UNIT
      ,SUBSTR(BKG_TOKEN_NL_FNC(DOC.CSTMS_DESC, 0, ''), 1, 80) AS B_DESC
      ,SUBSTR(BKG_TOKEN_NL_FNC(BMK.MK_DESC, 0, ''), 1, 100)  AS MARKNO
      ,(SELECT NVL(A.DE_NO, '')
          FROM ( SELECT DE_NO, REF_SEQ, MIN(REF_SEQ) OVER(PARTITION BY BKG_NO) AS MSEQ
                   FROM BKG_REF_DTL
                  WHERE BKG_NO = @[bkg_no]) A
         WHERE A.REF_SEQ = A.MSEQ) AS SHIP_ID_IND
      ,'CZ'                            AS SHP_BL_PT_TYPE
      ,SUBSTR(BKG_TOKEN_NL_FNC(SHP.CUST_NM ,0, ''),1,35)   AS SHP_BL_PT_NAME
      ,SUBSTR(BKG_TOKEN_NL_FNC(SHP.CUST_ADDR ,0, ''),1,35) AS SHP_BL_PT_ADDRESS
      ,SHP.CUST_STE_CD                 AS SHP_BL_PT_STREET
      ,SHP.CUST_CTY_NM                 AS SHP_BL_PT_CITY
      ,SHP.CUST_ZIP_ID                 AS SHP_BL_PT_POSTAL_CD
      ,SHP.CSTMS_DECL_CNT_CD           AS SHP_BL_PT_CNT_CD
      ,SUBSTR(MSH.CUST_RGST_NO, 1, INSTR(MSH.CUST_RGST_NO, '-') - 1) AS SHP_BL_PT_TAX_TYPE
      ,SUBSTR(MSH.CUST_RGST_NO, INSTR(MSH.CUST_RGST_NO, '-') + 1)    AS SHP_BL_PT_TAX_ID
      ,'CN'                            AS CNE_BL_PT_TYPE
      ,SUBSTR(BKG_TOKEN_NL_FNC(CNE.CUST_NM ,0, ''),1,35)   AS CNE_BL_PT_NAME
      ,SUBSTR(BKG_TOKEN_NL_FNC(CNE.CUST_ADDR ,0, ''),1,35) AS CNE_BL_PT_ADDRESS
      ,CNE.CUST_STE_CD                 AS CNE_BL_PT_STREET
      ,CNE.CUST_CTY_NM                 AS CNE_BL_PT_CITY
      ,CNE.CUST_ZIP_ID                 AS CNE_BL_PT_POSTAL_CD
      ,CNE.CSTMS_DECL_CNT_CD           AS CNE_BL_PT_CNT_CD
      ,SUBSTR(MCN.CUST_RGST_NO, 1, INSTR(MCN.CUST_RGST_NO, '-') - 1) AS CNE_BL_PT_TAX_TYPE
      ,SUBSTR(MCN.CUST_RGST_NO, INSTR(MCN.CUST_RGST_NO, '-') + 1)    AS CNE_BL_PT_TAX_ID
      ,'NI'                            AS NFY_BL_PT_TYPE
      ,SUBSTR(BKG_TOKEN_NL_FNC(NFY.CUST_NM ,0, ''),1,35)   AS NFY_BL_PT_NAME
      ,SUBSTR(BKG_TOKEN_NL_FNC(NFY.CUST_ADDR ,0, ''),1,35) AS NFY_BL_PT_ADDRESS
      ,NFY.CUST_STE_CD                 AS NFY_BL_PT_STREET
      ,NFY.CUST_CTY_NM                 AS NFY_BL_PT_CITY
      ,NFY.CUST_ZIP_ID                 AS NFY_BL_PT_POSTAL_CD
      ,NFY.CSTMS_DECL_CNT_CD           AS NFY_BL_PT_CNT_CD
      ,SUBSTR(MNF.CUST_RGST_NO, 1, INSTR(MNF.CUST_RGST_NO, '-') - 1) AS NFY_BL_PT_TAX_TYPE
      ,SUBSTR(MNF.CUST_RGST_NO, INSTR(MNF.CUST_RGST_NO, '-') + 1)    AS NFY_BL_PT_TAX_ID
  FROM BKG_BOOKING           BKG
      ,BKG_BL_DOC            DOC
      ,BKG_VVD               VVD
      ,BKG_BL_MK_DESC        BMK
      ,MDM_VSL_CNTR          VSL
      ,VSK_VSL_PORT_SKD      SKD
      ,BKG_CUSTOMER          SHP
      ,BKG_CUSTOMER          CNE
      ,BKG_CUSTOMER          NFY
      ,MDM_CUSTOMER          MSH
      ,MDM_CUSTOMER          MCN
      ,MDM_CUSTOMER          MNF
 WHERE BKG.BL_NO          = @[bl_no]
   AND VVD.VSL_CD         = @[vsl_cd]
   AND VVD.SKD_VOY_NO     = @[skd_voy_no]
   AND VVD.SKD_DIR_CD     = @[skd_dir_cd]
   AND VVD.POD_CD         = @[pod_cd]
   AND VVD.POL_CD         = @[pol_cd]
   AND BKG.BKG_NO         = DOC.BKG_NO
   AND BKG.BKG_NO         = VVD.BKG_NO
   AND BKG.BKG_NO         = BMK.BKG_NO(+)
   AND BMK.MK_SEQ(+)      = 1 
   AND VVD.VSL_CD         = VSL.VSL_CD
   AND VVD.VSL_CD         = SKD.VSL_CD
   AND VVD.SKD_VOY_NO     = SKD.SKD_VOY_NO
   AND VVD.SKD_DIR_CD     = SKD.SKD_DIR_CD
#if (${mode_type} == 'I') 
   AND SKD.VPS_PORT_CD    = VVD.POD_CD 
#else
   AND SKD.VPS_PORT_CD    = VVD.POL_CD
#end
   AND SKD.CLPT_IND_SEQ   = '1'
   AND BKG.BKG_NO         = SHP.BKG_NO
   AND SHP.BKG_CUST_TP_CD = 'S'
   AND BKG.BKG_NO         = CNE.BKG_NO
   AND CNE.BKG_CUST_TP_CD = 'C'
   AND BKG.BKG_NO         = NFY.BKG_NO(+)
   AND NFY.BKG_CUST_TP_CD(+) = 'N'
   AND SHP.CUST_CNT_CD    = MSH.CUST_CNT_CD(+)
   AND SHP.CUST_SEQ       = MSH.CUST_SEQ(+)
   AND CNE.CUST_CNT_CD    = MCN.CUST_CNT_CD(+)
   AND CNE.CUST_SEQ       = MCN.CUST_SEQ(+)
   AND NFY.CUST_CNT_CD    = MNF.CUST_CNT_CD(+)
   AND NFY.CUST_SEQ       = MNF.CUST_SEQ(+)			]]></sql>
			<params>
				<param name="mode_type" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
