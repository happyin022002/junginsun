/*=========================================================
*Copyright(c) 2016 CyberLogitec
*@FileName : BlRatingDBDAOModifyRateCntCdUSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2016.10.28
*@LastModifier : 
*@LastVersion : 1.0
* 2016.10.28 
* 1.0 Creation
=========================================================*/
package com.clt.apps.opus.esm.bkg.outbounddocumentation.blrating.blrating.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.clt.framework.support.db.ISQLTemplate;

/**
 *
 * @author 
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class BlRatingDBDAOModifyRateCntCdUSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * ModifyRateCntCd
	  * </pre>
	  */
	public BlRatingDBDAOModifyRateCntCdUSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("bkg_no",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("user_id",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.clt.apps.opus.esm.bkg.outbounddocumentation.blrating.blrating.integration").append("\n"); 
		query.append("FileName : BlRatingDBDAOModifyRateCntCdUSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("#if (${ca_flg} =='Y')" ).append("\n"); 
		query.append("	#if(${bkg_no} !='')" ).append("\n"); 
		query.append("    UPDATE BKG_RT_HIS" ).append("\n"); 
		query.append("SET PPD_PAYR_CNT_CD = (SELECT CASE WHEN (POR_L.CONTI_CD ='F' OR POR_L.CONTI_CD = 'E') " ).append("\n"); 
		query.append("                                        AND(F.CUST_SEQ IS NOT NULL AND NVL(F.CUST_SEQ,'') <> '0') " ).append("\n"); 
		query.append("                                        AND EXISTS (SELECT 'Y' " ).append("\n"); 
		query.append("                                                    FROM MDM_LOCATION FL " ).append("\n"); 
		query.append("                                                    WHERE  FL.CONTI_CD ='E'" ).append("\n"); 
		query.append("                                                    AND  FL.DELT_FLG ='N'" ).append("\n"); 
		query.append("                                                    AND  FL.CNT_CD = F.CUST_CNT_CD" ).append("\n"); 
		query.append("                                                    AND ROWNUM =1 )" ).append("\n"); 
		query.append("                                    THEN F.CUST_CNT_CD" ).append("\n"); 
		query.append("                               ELSE CR_RT_P.CUST_CNT_CD" ).append("\n"); 
		query.append("                               END UP_PPD_PAYR_CNT_CD" ).append("\n"); 
		query.append("                       FROM  BKG_BKG_HIS BK, BKG_RT_HIS RT, BKG_CUST_HIS F, BKG_CUST_HIS N, MDM_LOCATION POR_L, MDM_LOCATION DEL_L," ).append("\n"); 
		query.append("                             MDM_ORGANIZATION OFC, " ).append("\n"); 
		query.append("                            (SELECT ROWNUM,A.* FROM " ).append("\n"); 
		query.append("            				    (" ).append("\n"); 
		query.append("            				--PPD RULE 1 FF CASE" ).append("\n"); 
		query.append("        					SELECT BKG.BKG_NO BKG_NO," ).append("\n"); 
		query.append("        					        10 AS FLG," ).append("\n"); 
		query.append("        					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("        						 CR_CLT_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("        					     F.CUST_CNT_CD CUST_CNT_CD," ).append("\n"); 
		query.append("            					 F.CUST_SEQ CUST_SEQ," ).append("\n"); 
		query.append("            					 C.CUST_LGL_ENG_NM CUST_NM" ).append("\n"); 
		query.append("        					FROM   MDM_CR_CUST CUST," ).append("\n"); 
		query.append("        					       BKG_BKG_HIS BKG," ).append("\n"); 
		query.append("                                   MDM_CUSTOMER C," ).append("\n"); 
		query.append("            					   BKG_CUST_HIS F," ).append("\n"); 
		query.append("                                   MDM_ORGANIZATION O  " ).append("\n"); 
		query.append("        					      " ).append("\n"); 
		query.append("        					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("        					AND    BKG.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("            				AND    BKG.BKG_NO = F.BKG_NO" ).append("\n"); 
		query.append("        					AND    F.CORR_NO = 'TMP0000001'" ).append("\n"); 
		query.append("        					AND    F.BKG_CUST_TP_CD = 'F'" ).append("\n"); 
		query.append("        					AND    F.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("        					AND    F.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("        					AND    C.DELT_FLG ='N'" ).append("\n"); 
		query.append("        					AND    NVL(C.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("        					AND    CUST.CUST_CNT_CD = F.CUST_CNT_CD" ).append("\n"); 
		query.append("        					AND    CUST.CUST_SEQ = F.CUST_SEQ" ).append("\n"); 
		query.append("        					AND    BKG.BKG_OFC_CD = O.OFC_CD" ).append("\n"); 
		query.append("        					AND    O.DELT_FLG ='N'" ).append("\n"); 
		query.append("        					AND    NVL(O.PPD_PTY_TP_CD,'S') ='F'" ).append("\n"); 
		query.append("            				AND    0 < CUST.OB_CR_TERM_DYS" ).append("\n"); 
		query.append("        					AND    CUST.CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("        					AND    CUST.CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("        					AND    CUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("        					UNION" ).append("\n"); 
		query.append("        					--PPD RULE 2 SH CASE" ).append("\n"); 
		query.append("        					SELECT BKG.BKG_NO BKG_NO," ).append("\n"); 
		query.append("        					        11 AS FLG," ).append("\n"); 
		query.append("        					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("        						 CR_CLT_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("        						 S.CUST_CNT_CD CUST_CNT_CD," ).append("\n"); 
		query.append("            					 S.CUST_SEQ CUST_SEQ," ).append("\n"); 
		query.append("            					 C.CUST_LGL_ENG_NM CUST_NM" ).append("\n"); 
		query.append("        					FROM   MDM_CR_CUST CUST," ).append("\n"); 
		query.append("        					       BKG_BKG_HIS BKG," ).append("\n"); 
		query.append("                                   MDM_CUSTOMER C," ).append("\n"); 
		query.append("            					   BKG_CUST_HIS S" ).append("\n"); 
		query.append("        					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("        					AND	   BKG.CORR_NO = 'TMP0000001'" ).append("\n"); 
		query.append("            				AND    BKG.BKG_NO = S.BKG_NO" ).append("\n"); 
		query.append("            				AND    S.CORR_NO = 'TMP0000001'" ).append("\n"); 
		query.append("            				AND    S.BKG_CUST_TP_CD = 'S'" ).append("\n"); 
		query.append("        					AND    S.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("        					AND    S.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("        					AND    C.DELT_FLG ='N'" ).append("\n"); 
		query.append("        					AND    NVL(C.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("        					AND    CUST.CUST_CNT_CD = S.CUST_CNT_CD" ).append("\n"); 
		query.append("        					AND    CUST.CUST_SEQ = S.CUST_SEQ" ).append("\n"); 
		query.append("            				AND    0 < CUST.OB_CR_TERM_DYS" ).append("\n"); 
		query.append("        					AND    CUST.CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("        					AND    CUST.CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("        					AND    CUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("        					UNION" ).append("\n"); 
		query.append("        					--PPD RULE 3 FF CASE" ).append("\n"); 
		query.append("        					--????????????????? MDM OFFICE ?? OFC_TP_CD?? QT ??????? POR ?? FINC_CTRL_OFC_CD ???????" ).append("\n"); 
		query.append("        					SELECT B.BKG_NO BKG_NO," ).append("\n"); 
		query.append("        					        12 AS FLG," ).append("\n"); 
		query.append("        					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("        					        DECODE(O.OFC_TP_CD,'QT',L.FINC_CTRL_OFC_CD,C.OFC_CD) OFC_CD," ).append("\n"); 
		query.append("        					        F.CUST_CNT_CD," ).append("\n"); 
		query.append("        					        F.CUST_SEQ," ).append("\n"); 
		query.append("        					        C.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("        					FROM    BKG_BKG_HIS B," ).append("\n"); 
		query.append("        					        BKG_CUST_HIS F," ).append("\n"); 
		query.append("        					        MDM_CUSTOMER C," ).append("\n"); 
		query.append("        							MDM_ORGANIZATION O," ).append("\n"); 
		query.append("        							MDM_LOCATION L" ).append("\n"); 
		query.append("        					WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("            				AND  F.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("            				AND  F.BKG_CUST_TP_CD = 'F'" ).append("\n"); 
		query.append("            				AND  F.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("            				AND  F.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("            				AND  C.DELT_FLG ='N'" ).append("\n"); 
		query.append("            				AND  O.DELT_FLG ='N'" ).append("\n"); 
		query.append("            				AND  L.DELT_FLG ='N'" ).append("\n"); 
		query.append("            				AND  B.BKG_OFC_CD = O.OFC_CD " ).append("\n"); 
		query.append("            				AND  NVL(C.NMD_CUST_FLG,'N') ='N'	" ).append("\n"); 
		query.append("            				AND  NVL(O.PPD_PTY_TP_CD,'S') ='F'" ).append("\n"); 
		query.append("            				AND  B.POR_CD = L.LOC_CD" ).append("\n"); 
		query.append("            				AND  B.CORR_NO = 'TMP0000001'" ).append("\n"); 
		query.append("            				AND  F.CORR_NO = 'TMP0000001'" ).append("\n"); 
		query.append("        					UNION " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        					--PPD RULE 4 SH CASE" ).append("\n"); 
		query.append("        					--????????????????? MDM OFFICE ?? OFC_TP_CD?? QT ??????? POR ?? FINC_CTRL_OFC_CD ???????" ).append("\n"); 
		query.append("        					SELECT B.BKG_NO BKG_NO," ).append("\n"); 
		query.append("        					        13 AS FLG," ).append("\n"); 
		query.append("        					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("        					        DECODE(O.OFC_TP_CD,'QT',L.FINC_CTRL_OFC_CD,C.OFC_CD) OFC_CD," ).append("\n"); 
		query.append("        					        C.CUST_CNT_CD," ).append("\n"); 
		query.append("        					        C.CUST_SEQ," ).append("\n"); 
		query.append("        					        C.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("        					FROM    BKG_BKG_HIS B," ).append("\n"); 
		query.append("        					        BKG_CUST_HIS S," ).append("\n"); 
		query.append("        					        MDM_CUSTOMER C," ).append("\n"); 
		query.append("        							MDM_ORGANIZATION O," ).append("\n"); 
		query.append("        							MDM_LOCATION L" ).append("\n"); 
		query.append("        					WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("        					AND    S.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("        					AND    B.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("        					AND    S.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("        					AND    S.BKG_CUST_TP_CD = 'S'" ).append("\n"); 
		query.append("        					AND    S.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("        					AND    S.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("        					AND    C.DELT_FLG ='N'" ).append("\n"); 
		query.append("        					AND    O.DELT_FLG ='N'" ).append("\n"); 
		query.append("        					AND    L.DELT_FLG ='N'" ).append("\n"); 
		query.append("        					AND    C.OFC_CD = O.OFC_CD " ).append("\n"); 
		query.append("        					AND    NVL(C.NMD_CUST_FLG,'N') ='N'	" ).append("\n"); 
		query.append("        					AND    B.POR_CD = L.LOC_CD" ).append("\n"); 
		query.append("        					ORDER BY FLG" ).append("\n"); 
		query.append("            					) A" ).append("\n"); 
		query.append("            					WHERE ROWNUM = 1) CR_RT_P" ).append("\n"); 
		query.append("                       WHERE  BK.BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("                       AND  BK.BKG_STS_CD <>'X'" ).append("\n"); 
		query.append("                       AND  BK.BKG_NO = RT.BKG_NO" ).append("\n"); 
		query.append("                       AND  BK.BKG_NO = N.BKG_NO" ).append("\n"); 
		query.append("                       AND  BK.BKG_NO = F.BKG_NO" ).append("\n"); 
		query.append("                       AND  N.BKG_CUST_TP_CD ='N'" ).append("\n"); 
		query.append("                       AND  F.BKG_CUST_TP_CD ='F'" ).append("\n"); 
		query.append("                       AND  BK.POR_CD = POR_L.LOC_CD" ).append("\n"); 
		query.append("                       AND  POR_L.DELT_FLG ='N'" ).append("\n"); 
		query.append("                       AND  BK.DEL_CD = DEL_L.LOC_CD" ).append("\n"); 
		query.append("                       AND  DEL_L.DELT_FLG ='N'" ).append("\n"); 
		query.append("                       AND  DEL_L.FINC_CTRL_OFC_CD = OFC.OFC_CD" ).append("\n"); 
		query.append("                       AND  OFC.DELT_FLG='N'" ).append("\n"); 
		query.append("                       AND  BK.BKG_NO = CR_RT_P.BKG_NO(+)" ).append("\n"); 
		query.append("            		   AND  BK.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("              		   AND  RT.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("               		   AND  N.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("               		   AND  F.CORR_NO ='TMP0000001')," ).append("\n"); 
		query.append("    PPD_PAYR_CUST_SEQ = (SELECT CASE WHEN (POR_L.CONTI_CD ='F' OR POR_L.CONTI_CD = 'E') " ).append("\n"); 
		query.append("                                          AND(F.CUST_SEQ IS NOT NULL AND NVL(F.CUST_SEQ,'') <> '0') " ).append("\n"); 
		query.append("                                          AND EXISTS (SELECT 'Y' " ).append("\n"); 
		query.append("                                                      FROM MDM_LOCATION FL " ).append("\n"); 
		query.append("                                                      WHERE  FL.CONTI_CD ='E' " ).append("\n"); 
		query.append("                                                      AND  FL.DELT_FLG ='N'" ).append("\n"); 
		query.append("                                                      AND  FL.CNT_CD = F.CUST_CNT_CD" ).append("\n"); 
		query.append("                                                      AND ROWNUM =1 )" ).append("\n"); 
		query.append("                                    THEN F.CUST_SEQ" ).append("\n"); 
		query.append("                               ELSE CR_RT_P.CUST_SEQ" ).append("\n"); 
		query.append("                               END UP_PPD_PAYR_CUST_SEQ" ).append("\n"); 
		query.append("                       FROM  BKG_BKG_HIS BK, BKG_RT_HIS RT, BKG_CUST_HIS F, BKG_CUST_HIS N, MDM_LOCATION POR_L, MDM_LOCATION DEL_L," ).append("\n"); 
		query.append("                             MDM_ORGANIZATION OFC, " ).append("\n"); 
		query.append("                            (SELECT ROWNUM,A.* FROM " ).append("\n"); 
		query.append("            				    (" ).append("\n"); 
		query.append("            					        					--PPD RULE 1 FF CASE" ).append("\n"); 
		query.append("        					SELECT BKG.BKG_NO BKG_NO," ).append("\n"); 
		query.append("        					        10 AS FLG," ).append("\n"); 
		query.append("        					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("        						 CR_CLT_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("        					     F.CUST_CNT_CD CUST_CNT_CD," ).append("\n"); 
		query.append("            					 F.CUST_SEQ CUST_SEQ," ).append("\n"); 
		query.append("            					 C.CUST_LGL_ENG_NM CUST_NM" ).append("\n"); 
		query.append("        					FROM   MDM_CR_CUST CUST," ).append("\n"); 
		query.append("        					       BKG_BKG_HIS BKG," ).append("\n"); 
		query.append("                                   MDM_CUSTOMER C," ).append("\n"); 
		query.append("            					   BKG_CUST_HIS F," ).append("\n"); 
		query.append("                                   MDM_ORGANIZATION O  " ).append("\n"); 
		query.append("        					      " ).append("\n"); 
		query.append("        					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("        					AND    BKG.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("            				AND    BKG.BKG_NO = F.BKG_NO" ).append("\n"); 
		query.append("        					AND    F.CORR_NO = 'TMP0000001'" ).append("\n"); 
		query.append("        					AND    F.BKG_CUST_TP_CD = 'F'" ).append("\n"); 
		query.append("        					AND    F.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("        					AND    F.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("        					AND    C.DELT_FLG ='N'" ).append("\n"); 
		query.append("        					AND    NVL(C.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("        					AND    CUST.CUST_CNT_CD = F.CUST_CNT_CD" ).append("\n"); 
		query.append("        					AND    CUST.CUST_SEQ = F.CUST_SEQ" ).append("\n"); 
		query.append("        					AND    BKG.BKG_OFC_CD = O.OFC_CD" ).append("\n"); 
		query.append("        					AND    O.DELT_FLG ='N'" ).append("\n"); 
		query.append("        					AND    NVL(O.PPD_PTY_TP_CD,'S') ='F'" ).append("\n"); 
		query.append("            				AND    0 < CUST.OB_CR_TERM_DYS" ).append("\n"); 
		query.append("        					AND    CUST.CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("        					AND    CUST.CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("        					AND    CUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("        					UNION" ).append("\n"); 
		query.append("        					--PPD RULE 2 SH CASE" ).append("\n"); 
		query.append("        					SELECT BKG.BKG_NO BKG_NO," ).append("\n"); 
		query.append("        					        11 AS FLG," ).append("\n"); 
		query.append("        					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("        						 CR_CLT_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("        						 S.CUST_CNT_CD CUST_CNT_CD," ).append("\n"); 
		query.append("            					 S.CUST_SEQ CUST_SEQ," ).append("\n"); 
		query.append("            					 C.CUST_LGL_ENG_NM CUST_NM" ).append("\n"); 
		query.append("        					FROM   MDM_CR_CUST CUST," ).append("\n"); 
		query.append("        					       BKG_BKG_HIS BKG," ).append("\n"); 
		query.append("                                   MDM_CUSTOMER C," ).append("\n"); 
		query.append("            					   BKG_CUST_HIS S" ).append("\n"); 
		query.append("        					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("        					AND	   BKG.CORR_NO = 'TMP0000001'" ).append("\n"); 
		query.append("            				AND    BKG.BKG_NO = S.BKG_NO" ).append("\n"); 
		query.append("            				AND    S.CORR_NO = 'TMP0000001'" ).append("\n"); 
		query.append("            				AND    S.BKG_CUST_TP_CD = 'S'" ).append("\n"); 
		query.append("        					AND    S.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("        					AND    S.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("        					AND    C.DELT_FLG ='N'" ).append("\n"); 
		query.append("        					AND    NVL(C.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("        					AND    CUST.CUST_CNT_CD = S.CUST_CNT_CD" ).append("\n"); 
		query.append("        					AND    CUST.CUST_SEQ = S.CUST_SEQ" ).append("\n"); 
		query.append("            				AND    0 < CUST.OB_CR_TERM_DYS" ).append("\n"); 
		query.append("        					AND    CUST.CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("        					AND    CUST.CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("        					AND    CUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("        					UNION" ).append("\n"); 
		query.append("        					--PPD RULE 3 FF CASE" ).append("\n"); 
		query.append("        					--????????????????? MDM OFFICE ?? OFC_TP_CD?? QT ??????? POR ?? FINC_CTRL_OFC_CD ???????" ).append("\n"); 
		query.append("        					SELECT B.BKG_NO BKG_NO," ).append("\n"); 
		query.append("        					        12 AS FLG," ).append("\n"); 
		query.append("        					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("        					        DECODE(O.OFC_TP_CD,'QT',L.FINC_CTRL_OFC_CD,C.OFC_CD) OFC_CD," ).append("\n"); 
		query.append("        					        F.CUST_CNT_CD," ).append("\n"); 
		query.append("        					        F.CUST_SEQ," ).append("\n"); 
		query.append("        					        C.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("        					FROM    BKG_BKG_HIS B," ).append("\n"); 
		query.append("        					        BKG_CUST_HIS F," ).append("\n"); 
		query.append("        					        MDM_CUSTOMER C," ).append("\n"); 
		query.append("        							MDM_ORGANIZATION O," ).append("\n"); 
		query.append("        							MDM_LOCATION L" ).append("\n"); 
		query.append("        					WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("            				AND  F.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("            				AND  F.BKG_CUST_TP_CD = 'F'" ).append("\n"); 
		query.append("            				AND  F.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("            				AND  F.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("            				AND  C.DELT_FLG ='N'" ).append("\n"); 
		query.append("            				AND  O.DELT_FLG ='N'" ).append("\n"); 
		query.append("            				AND  L.DELT_FLG ='N'" ).append("\n"); 
		query.append("            				AND  B.BKG_OFC_CD = O.OFC_CD " ).append("\n"); 
		query.append("            				AND  NVL(C.NMD_CUST_FLG,'N') ='N'	" ).append("\n"); 
		query.append("            				AND  NVL(O.PPD_PTY_TP_CD,'S') ='F'" ).append("\n"); 
		query.append("            				AND  B.POR_CD = L.LOC_CD" ).append("\n"); 
		query.append("            				AND  B.CORR_NO = 'TMP0000001'" ).append("\n"); 
		query.append("            				AND  F.CORR_NO = 'TMP0000001'" ).append("\n"); 
		query.append("        					UNION " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        					--PPD RULE 4 SH CASE" ).append("\n"); 
		query.append("        					--????????????????? MDM OFFICE ?? OFC_TP_CD?? QT ??????? POR ?? FINC_CTRL_OFC_CD ???????" ).append("\n"); 
		query.append("        					SELECT B.BKG_NO BKG_NO," ).append("\n"); 
		query.append("        					        13 AS FLG," ).append("\n"); 
		query.append("        					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("        					        DECODE(O.OFC_TP_CD,'QT',L.FINC_CTRL_OFC_CD,C.OFC_CD) OFC_CD," ).append("\n"); 
		query.append("        					        C.CUST_CNT_CD," ).append("\n"); 
		query.append("        					        C.CUST_SEQ," ).append("\n"); 
		query.append("        					        C.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("        					FROM    BKG_BKG_HIS B," ).append("\n"); 
		query.append("        					        BKG_CUST_HIS S," ).append("\n"); 
		query.append("        					        MDM_CUSTOMER C," ).append("\n"); 
		query.append("        							MDM_ORGANIZATION O," ).append("\n"); 
		query.append("        							MDM_LOCATION L" ).append("\n"); 
		query.append("        					WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("        					AND    S.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("        					AND    B.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("        					AND    S.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("        					AND    S.BKG_CUST_TP_CD = 'S'" ).append("\n"); 
		query.append("        					AND    S.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("        					AND    S.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("        					AND    C.DELT_FLG ='N'" ).append("\n"); 
		query.append("        					AND    O.DELT_FLG ='N'" ).append("\n"); 
		query.append("        					AND    L.DELT_FLG ='N'" ).append("\n"); 
		query.append("        					AND    C.OFC_CD = O.OFC_CD " ).append("\n"); 
		query.append("        					AND    NVL(C.NMD_CUST_FLG,'N') ='N'	" ).append("\n"); 
		query.append("        					AND    B.POR_CD = L.LOC_CD" ).append("\n"); 
		query.append("        					ORDER BY FLG" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            					) A" ).append("\n"); 
		query.append("            					WHERE ROWNUM = 1) CR_RT_P" ).append("\n"); 
		query.append("                       WHERE  BK.BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("                       AND  BK.BKG_STS_CD <>'X'" ).append("\n"); 
		query.append("                       AND  BK.BKG_NO = RT.BKG_NO" ).append("\n"); 
		query.append("                       AND  BK.BKG_NO = N.BKG_NO" ).append("\n"); 
		query.append("                       AND  BK.BKG_NO = F.BKG_NO" ).append("\n"); 
		query.append("                       AND  N.BKG_CUST_TP_CD ='N'" ).append("\n"); 
		query.append("                       AND  F.BKG_CUST_TP_CD ='F'" ).append("\n"); 
		query.append("                       AND  BK.POR_CD = POR_L.LOC_CD" ).append("\n"); 
		query.append("                       AND  POR_L.DELT_FLG ='N'" ).append("\n"); 
		query.append("                       AND  BK.DEL_CD = DEL_L.LOC_CD" ).append("\n"); 
		query.append("                       AND  DEL_L.DELT_FLG ='N'" ).append("\n"); 
		query.append("                       AND  DEL_L.FINC_CTRL_OFC_CD = OFC.OFC_CD" ).append("\n"); 
		query.append("                       AND  OFC.DELT_FLG='N'" ).append("\n"); 
		query.append("                       AND  BK.BKG_NO = CR_RT_P.BKG_NO(+)" ).append("\n"); 
		query.append("            		   AND  BK.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("              		   AND  RT.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("               		   AND  N.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("               		   AND  F.CORR_NO ='TMP0000001')," ).append("\n"); 
		query.append("    CLT_PAYR_CNT_CD = ( SELECT CASE WHEN BK.CUST_TO_ORD_FLG='Y' AND ( NVL(N.CUST_CNT_CD,'')||N.CUST_SEQ = '0' OR N.CUST_CNT_CD||N.CUST_SEQ IS NULL OR N.CUST_SEQ IS NULL )" ).append("\n"); 
		query.append("                                    THEN OFC.REP_CUST_CNT_CD --FIN_OFC 의 AR CUSTOMER" ).append("\n"); 
		query.append("                                    WHEN BK.CUST_TO_ORD_FLG='Y' AND ( NVL(N.CUST_CNT_CD,'')||N.CUST_SEQ <> '0' AND N.CUST_CNT_CD||N.CUST_SEQ IS NOT NULL AND N.CUST_SEQ IS NOT NULL )" ).append("\n"); 
		query.append("                                    THEN N.CUST_CNT_CD    -- NOTIFY" ).append("\n"); 
		query.append("                                    ELSE CR_RT_C.CUST_CNT_CD  -- NOT NULL 을 위해 DEFALUT " ).append("\n"); 
		query.append("                                    END UP_CLT_PAYR_CNT_CD" ).append("\n"); 
		query.append("                             FROM  BKG_BKG_HIS BK, BKG_RT_HIS RT, BKG_CUST_HIS F, BKG_CUST_HIS N, MDM_LOCATION POR_L, MDM_LOCATION DEL_L," ).append("\n"); 
		query.append("                                    MDM_ORGANIZATION OFC, " ).append("\n"); 
		query.append("                    					(SELECT ROWNUM,A.* FROM " ).append("\n"); 
		query.append("                    					(" ).append("\n"); 
		query.append("                    					--CCT" ).append("\n"); 
		query.append("                    					SELECT  BKG.BKG_NO AS BKG_NO," ).append("\n"); 
		query.append("                    					        21 AS FLG," ).append("\n"); 
		query.append("                    					        'C' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("                    					        CR_CLT_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("                    					        BCUST.CUST_CNT_CD AS CUST_CNT_CD," ).append("\n"); 
		query.append("                    					        BCUST.CUST_SEQ AS CUST_SEQ," ).append("\n"); 
		query.append("                    					        MCUST.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("                    					FROM    MDM_CR_CUST CUST," ).append("\n"); 
		query.append("                    					        BKG_BKG_HIS BKG," ).append("\n"); 
		query.append("                    					        BKG_CUST_HIS BCUST," ).append("\n"); 
		query.append("                    					        MDM_CUSTOMER MCUST" ).append("\n"); 
		query.append("                    					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("                    					AND    BKG.BKG_NO = BCUST.BKG_NO" ).append("\n"); 
		query.append("                    					AND    BCUST.BKG_CUST_TP_CD = 'C'" ).append("\n"); 
		query.append("                    					AND    CUST.CUST_CNT_CD = BCUST.CUST_CNT_CD" ).append("\n"); 
		query.append("                    					AND    CUST.CUST_SEQ = BCUST.CUST_SEQ" ).append("\n"); 
		query.append("                    					AND    BCUST.CUST_CNT_CD = MCUST.CUST_CNT_CD" ).append("\n"); 
		query.append("                    					AND    BCUST.CUST_SEQ = MCUST.CUST_SEQ    " ).append("\n"); 
		query.append("                    					AND    IB_CR_TERM_DYS > 0" ).append("\n"); 
		query.append("                    					AND    CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("                    					AND    CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("                    					AND    MCUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("                    					AND    NVL(MCUST.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("                    					AND    CUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("                    					AND    BKG.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                    					AND    BCUST.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                    					UNION" ).append("\n"); 
		query.append("                    					--CCT OFFICE CODE2" ).append("\n"); 
		query.append("                    					SELECT B.BKG_NO BKG_NO," ).append("\n"); 
		query.append("                    					        22 AS FLG," ).append("\n"); 
		query.append("                    					        'C' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("                    					        FINC_CTRL_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("                    					        S.CUST_CNT_CD  AS CUST_CNT_CD," ).append("\n"); 
		query.append("                    					        NVL(S.CUST_SEQ,'1') AS CUST_SEQ," ).append("\n"); 
		query.append("                    					        C.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("                    					FROM    MDM_LOCATION M, " ).append("\n"); 
		query.append("                    					        BKG_BKG_HIS B, " ).append("\n"); 
		query.append("                    					        BKG_CUST_HIS S," ).append("\n"); 
		query.append("                    					        MDM_CUSTOMER C" ).append("\n"); 
		query.append("                    					WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("                    					AND    S.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("                    					AND    S.BKG_CUST_TP_CD = 'C'" ).append("\n"); 
		query.append("                    					AND    S.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("                    					AND    S.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("                    					AND    B.DEL_CD = M.LOC_CD" ).append("\n"); 
		query.append("                    					AND    C.DELT_FLG = 'N'" ).append("\n"); 
		query.append("                    					AND	NVL(C.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("                    					AND B.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                    					AND S.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                    					UNION" ).append("\n"); 
		query.append("                    					--REP CUSTOMER" ).append("\n"); 
		query.append("                    					SELECT BKG_NO," ).append("\n"); 
		query.append("                    					        31 AS FLG," ).append("\n"); 
		query.append("                    					        'R'AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("                    					        (SELECT  FINC_CTRL_OFC_CD" ).append("\n"); 
		query.append("                    					            FROM MDM_LOCATION" ).append("\n"); 
		query.append("                    					            WHERE LOC_CD = (SELECT DEL_CD" ).append("\n"); 
		query.append("                    					                            FROM  BKG_BKG_HIS" ).append("\n"); 
		query.append("                    					                            WHERE BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("                    												AND CORR_NO ='TMP0000001')) AS OFC_CD," ).append("\n"); 
		query.append("                    					        REP_CUST_CNT_CD AS CUST_CNT_CD," ).append("\n"); 
		query.append("                    					        REP_CUST_SEQ AS CUST_SEQ," ).append("\n"); 
		query.append("                    					        MCUST.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("                    					FROM   MDM_ORGANIZATION OFC, " ).append("\n"); 
		query.append("                    					        BKG_BKG_HIS BKG," ).append("\n"); 
		query.append("                    					        MDM_CUSTOMER MCUST" ).append("\n"); 
		query.append("                    					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("                    					AND    REP_CUST_CNT_CD = MCUST.CUST_CNT_CD" ).append("\n"); 
		query.append("                    					AND    REP_CUST_SEQ = MCUST.CUST_SEQ" ).append("\n"); 
		query.append("                    					AND    MCUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("                    					AND	NVL(MCUST.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("                    					AND BKG.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                    					AND    OFC.OFC_CD = NVL((SELECT CR_CLT_OFC_CD" ).append("\n"); 
		query.append("                    					                        FROM MDM_CR_CUST" ).append("\n"); 
		query.append("                    					                        WHERE (CUST_CNT_CD, CUST_SEQ) = (SELECT CUST_CNT_CD, CUST_SEQ" ).append("\n"); 
		query.append("                    					                                                            FROM   BKG_BKG_HIS B," ).append("\n"); 
		query.append("                    					                                                                    BKG_CUST_HIS C" ).append("\n"); 
		query.append("                    					                                                            WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("                    					                                                            AND    C.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("                    																				AND B.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                    																				AND C.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                    					                                                            AND    C.BKG_CUST_TP_CD = 'C'" ).append("\n"); 
		query.append("                    																				)" ).append("\n"); 
		query.append("                    					                        AND 0 < IB_CR_TERM_DYS" ).append("\n"); 
		query.append("                    											AND MCUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("                    					                        AND CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("                    					                        AND CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001'))," ).append("\n"); 
		query.append("                    					                    (SELECT  FINC_CTRL_OFC_CD" ).append("\n"); 
		query.append("                    					                        FROM MDM_LOCATION" ).append("\n"); 
		query.append("                    					                        WHERE LOC_CD = (SELECT DEL_CD" ).append("\n"); 
		query.append("                    					                                        FROM  BKG_BKG_HIS" ).append("\n"); 
		query.append("                    					                                        WHERE BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("                    															AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("                    					                    )" ).append("\n"); 
		query.append("                    					                    )" ).append("\n"); 
		query.append("                    					                    ORDER BY FLG" ).append("\n"); 
		query.append("                    					) A" ).append("\n"); 
		query.append("                    					WHERE " ).append("\n"); 
		query.append("                    					ROWNUM = 1) CR_RT_C" ).append("\n"); 
		query.append("                    					" ).append("\n"); 
		query.append("                             WHERE  BK.BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("                               AND  BK.BKG_STS_CD <>'X'" ).append("\n"); 
		query.append("                               AND  BK.BKG_NO = RT.BKG_NO" ).append("\n"); 
		query.append("                               AND  BK.BKG_NO = N.BKG_NO" ).append("\n"); 
		query.append("                               AND  BK.BKG_NO = F.BKG_NO" ).append("\n"); 
		query.append("                               AND  N.BKG_CUST_TP_CD ='N'" ).append("\n"); 
		query.append("                               AND  F.BKG_CUST_TP_CD ='F'" ).append("\n"); 
		query.append("                               AND  BK.POR_CD = POR_L.LOC_CD" ).append("\n"); 
		query.append("                               AND  POR_L.DELT_FLG ='N'" ).append("\n"); 
		query.append("                               AND  BK.DEL_CD = DEL_L.LOC_CD" ).append("\n"); 
		query.append("                               AND  DEL_L.DELT_FLG ='N'" ).append("\n"); 
		query.append("                               AND  DEL_L.FINC_CTRL_OFC_CD = OFC.OFC_CD" ).append("\n"); 
		query.append("                               AND  OFC.DELT_FLG='N'" ).append("\n"); 
		query.append("                               AND  BK.BKG_NO = CR_RT_C.BKG_NO(+)" ).append("\n"); 
		query.append("                    		   AND  BK.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                      		   AND  RT.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                       		   AND  N.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                       		   AND  F.CORR_NO ='TMP0000001')," ).append("\n"); 
		query.append("    CLT_PAYR_CUST_SEQ= (SELECT CASE WHEN BK.CUST_TO_ORD_FLG='Y' AND ( NVL(N.CUST_CNT_CD,'')||N.CUST_SEQ = '0' OR N.CUST_CNT_CD||N.CUST_SEQ IS NULL OR N.CUST_SEQ IS NULL)" ).append("\n"); 
		query.append("                                    THEN OFC.REP_CUST_SEQ   --FIN_OFC 의 AR CUSTOMER" ).append("\n"); 
		query.append("                                    WHEN BK.CUST_TO_ORD_FLG='Y' AND ( NVL(N.CUST_CNT_CD,'')||N.CUST_SEQ <> '0' AND N.CUST_CNT_CD||N.CUST_SEQ IS NOT NULL AND N.CUST_SEQ IS NOT NULL)" ).append("\n"); 
		query.append("                                    THEN N.CUST_SEQ       -- NOTIFY" ).append("\n"); 
		query.append("                                    ELSE CR_RT_C.CUST_SEQ -- NOT NULL 을 위해 DEFALUT " ).append("\n"); 
		query.append("                                    END UP_CLT_PAYR_CUST_SEQ" ).append("\n"); 
		query.append("                             FROM  BKG_BKG_HIS BK, BKG_RT_HIS RT, BKG_CUST_HIS F, BKG_CUST_HIS N, MDM_LOCATION POR_L, MDM_LOCATION DEL_L," ).append("\n"); 
		query.append("                                    MDM_ORGANIZATION OFC, " ).append("\n"); 
		query.append("                    					(SELECT ROWNUM,A.* FROM " ).append("\n"); 
		query.append("                    					(" ).append("\n"); 
		query.append("                    					--CCT" ).append("\n"); 
		query.append("                    					SELECT  BKG.BKG_NO AS BKG_NO," ).append("\n"); 
		query.append("                    					        21 AS FLG," ).append("\n"); 
		query.append("                    					        'C' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("                    					        CR_CLT_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("                    					        BCUST.CUST_CNT_CD AS CUST_CNT_CD," ).append("\n"); 
		query.append("                    					        BCUST.CUST_SEQ AS CUST_SEQ," ).append("\n"); 
		query.append("                    					        MCUST.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("                    					FROM    MDM_CR_CUST CUST," ).append("\n"); 
		query.append("                    					        BKG_BKG_HIS BKG," ).append("\n"); 
		query.append("                    					        BKG_CUST_HIS BCUST," ).append("\n"); 
		query.append("                    					        MDM_CUSTOMER MCUST" ).append("\n"); 
		query.append("                    					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("                    					AND    BKG.BKG_NO = BCUST.BKG_NO" ).append("\n"); 
		query.append("                    					AND    BCUST.BKG_CUST_TP_CD = 'C'" ).append("\n"); 
		query.append("                    					AND    CUST.CUST_CNT_CD = BCUST.CUST_CNT_CD" ).append("\n"); 
		query.append("                    					AND    CUST.CUST_SEQ = BCUST.CUST_SEQ" ).append("\n"); 
		query.append("                    					AND    BCUST.CUST_CNT_CD = MCUST.CUST_CNT_CD" ).append("\n"); 
		query.append("                    					AND    BCUST.CUST_SEQ = MCUST.CUST_SEQ    " ).append("\n"); 
		query.append("                    					AND    IB_CR_TERM_DYS > 0" ).append("\n"); 
		query.append("                    					AND    CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("                    					AND    CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("                    					AND    MCUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("                    					AND    NVL(MCUST.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("                    					AND    CUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("                    					AND    BKG.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                    					AND    BCUST.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                    					UNION" ).append("\n"); 
		query.append("                    					--CCT OFFICE CODE2" ).append("\n"); 
		query.append("                    					SELECT B.BKG_NO BKG_NO," ).append("\n"); 
		query.append("                    					        22 AS FLG," ).append("\n"); 
		query.append("                    					        'C' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("                    					        FINC_CTRL_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("                    					        S.CUST_CNT_CD  AS CUST_CNT_CD," ).append("\n"); 
		query.append("                    					        NVL(S.CUST_SEQ,'1') AS CUST_SEQ," ).append("\n"); 
		query.append("                    					        C.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("                    					FROM    MDM_LOCATION M, " ).append("\n"); 
		query.append("                    					        BKG_BKG_HIS B, " ).append("\n"); 
		query.append("                    					        BKG_CUST_HIS S," ).append("\n"); 
		query.append("                    					        MDM_CUSTOMER C" ).append("\n"); 
		query.append("                    					WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("                    					AND    S.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("                    					AND    S.BKG_CUST_TP_CD = 'C'" ).append("\n"); 
		query.append("                    					AND    S.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("                    					AND    S.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("                    					AND    B.DEL_CD = M.LOC_CD" ).append("\n"); 
		query.append("                    					AND    C.DELT_FLG = 'N'" ).append("\n"); 
		query.append("                    					AND	NVL(C.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("                    					AND B.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                    					AND S.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                    					UNION" ).append("\n"); 
		query.append("                    					--REP CUSTOMER" ).append("\n"); 
		query.append("                    					SELECT BKG_NO," ).append("\n"); 
		query.append("                    					        31 AS FLG," ).append("\n"); 
		query.append("                    					        'R'AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("                    					        (SELECT  FINC_CTRL_OFC_CD" ).append("\n"); 
		query.append("                    					            FROM MDM_LOCATION" ).append("\n"); 
		query.append("                    					            WHERE LOC_CD = (SELECT DEL_CD" ).append("\n"); 
		query.append("                    					                            FROM  BKG_BKG_HIS" ).append("\n"); 
		query.append("                    					                            WHERE BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("                    												AND CORR_NO ='TMP0000001')) AS OFC_CD," ).append("\n"); 
		query.append("                    					        REP_CUST_CNT_CD AS CUST_CNT_CD," ).append("\n"); 
		query.append("                    					        REP_CUST_SEQ AS CUST_SEQ," ).append("\n"); 
		query.append("                    					        MCUST.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("                    					FROM   MDM_ORGANIZATION OFC, " ).append("\n"); 
		query.append("                    					        BKG_BKG_HIS BKG," ).append("\n"); 
		query.append("                    					        MDM_CUSTOMER MCUST" ).append("\n"); 
		query.append("                    					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("                    					AND    REP_CUST_CNT_CD = MCUST.CUST_CNT_CD" ).append("\n"); 
		query.append("                    					AND    REP_CUST_SEQ = MCUST.CUST_SEQ" ).append("\n"); 
		query.append("                    					AND    MCUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("                    					AND	NVL(MCUST.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("                    					AND BKG.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                    					AND    OFC.OFC_CD = NVL((SELECT CR_CLT_OFC_CD" ).append("\n"); 
		query.append("                    					                        FROM MDM_CR_CUST" ).append("\n"); 
		query.append("                    					                        WHERE (CUST_CNT_CD, CUST_SEQ) = (SELECT CUST_CNT_CD, CUST_SEQ" ).append("\n"); 
		query.append("                    					                                                            FROM   BKG_BKG_HIS B," ).append("\n"); 
		query.append("                    					                                                                    BKG_CUST_HIS C" ).append("\n"); 
		query.append("                    					                                                            WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("                    					                                                            AND    C.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("                    																				AND B.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                    																				AND C.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                    					                                                            AND    C.BKG_CUST_TP_CD = 'C'" ).append("\n"); 
		query.append("                    																				)" ).append("\n"); 
		query.append("                    					                        AND 0 < IB_CR_TERM_DYS" ).append("\n"); 
		query.append("                    											AND MCUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("                    					                        AND CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("                    					                        AND CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] AND CORR_NO ='TMP0000001'))," ).append("\n"); 
		query.append("                    					                    (SELECT  FINC_CTRL_OFC_CD" ).append("\n"); 
		query.append("                    					                        FROM MDM_LOCATION" ).append("\n"); 
		query.append("                    					                        WHERE LOC_CD = (SELECT DEL_CD" ).append("\n"); 
		query.append("                    					                                        FROM  BKG_BKG_HIS" ).append("\n"); 
		query.append("                    					                                        WHERE BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("                    															AND CORR_NO ='TMP0000001')" ).append("\n"); 
		query.append("                    					                    )" ).append("\n"); 
		query.append("                    					                    )" ).append("\n"); 
		query.append("                    					                    ORDER BY FLG" ).append("\n"); 
		query.append("                    					) A" ).append("\n"); 
		query.append("                    					WHERE " ).append("\n"); 
		query.append("                    					ROWNUM = 1) CR_RT_C" ).append("\n"); 
		query.append("                    					" ).append("\n"); 
		query.append("                             WHERE  BK.BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("                               AND  BK.BKG_STS_CD <>'X'" ).append("\n"); 
		query.append("                               AND  BK.BKG_NO = RT.BKG_NO" ).append("\n"); 
		query.append("                               AND  BK.BKG_NO = N.BKG_NO" ).append("\n"); 
		query.append("                               AND  BK.BKG_NO = F.BKG_NO" ).append("\n"); 
		query.append("                               AND  N.BKG_CUST_TP_CD ='N'" ).append("\n"); 
		query.append("                               AND  F.BKG_CUST_TP_CD ='F'" ).append("\n"); 
		query.append("                               AND  BK.POR_CD = POR_L.LOC_CD" ).append("\n"); 
		query.append("                               AND  POR_L.DELT_FLG ='N'" ).append("\n"); 
		query.append("                               AND  BK.DEL_CD = DEL_L.LOC_CD" ).append("\n"); 
		query.append("                               AND  DEL_L.DELT_FLG ='N'" ).append("\n"); 
		query.append("                               AND  DEL_L.FINC_CTRL_OFC_CD = OFC.OFC_CD" ).append("\n"); 
		query.append("                               AND  OFC.DELT_FLG='N'" ).append("\n"); 
		query.append("                               AND  BK.BKG_NO = CR_RT_C.BKG_NO(+)" ).append("\n"); 
		query.append("                    		   AND  BK.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                      		   AND  RT.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                       		   AND  N.CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("                       		   AND  F.CORR_NO ='TMP0000001')," ).append("\n"); 
		query.append("    UPD_USR_ID = @[user_id]," ).append("\n"); 
		query.append("    UPD_DT = SYSDATE  " ).append("\n"); 
		query.append("WHERE BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("AND CORR_NO ='TMP0000001'" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("	#if(${bkg_no} !='')" ).append("\n"); 
		query.append("UPDATE BKG_RATE" ).append("\n"); 
		query.append("SET PPD_PAYR_CNT_CD = (SELECT CASE WHEN (POR_L.CONTI_CD ='F' OR POR_L.CONTI_CD = 'E') AND(F.CUST_SEQ IS NOT NULL AND NVL(F.CUST_SEQ,'') <> '0') AND EXISTS (SELECT 'Y' FROM MDM_LOCATION FL " ).append("\n"); 
		query.append("                                                                                                WHERE  FL.CONTI_CD ='E' " ).append("\n"); 
		query.append("                                                                                                  AND  FL.DELT_FLG ='N'" ).append("\n"); 
		query.append("                                                                                                  AND  FL.CNT_CD = F.CUST_CNT_CD" ).append("\n"); 
		query.append("                                                                                                  AND ROWNUM =1 )" ).append("\n"); 
		query.append("                                        THEN F.CUST_CNT_CD" ).append("\n"); 
		query.append("                                   ELSE CR_RT_P.CUST_CNT_CD" ).append("\n"); 
		query.append("                                   END UP_PPD_PAYR_CNT_CD" ).append("\n"); 
		query.append("                         FROM  BKG_BOOKING BK, BKG_RATE RT, BKG_CUSTOMER F, BKG_CUSTOMER N, MDM_LOCATION POR_L, MDM_LOCATION DEL_L," ).append("\n"); 
		query.append("                                        MDM_ORGANIZATION OFC, " ).append("\n"); 
		query.append("                                        (SELECT ROWNUM,A.* FROM " ).append("\n"); 
		query.append("                        				    (" ).append("\n"); 
		query.append("                        					" ).append("\n"); 
		query.append("					--PPD RULE 1 FF CASE" ).append("\n"); 
		query.append("					SELECT BKG.BKG_NO BKG_NO," ).append("\n"); 
		query.append("					        10 AS FLG," ).append("\n"); 
		query.append("					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("						 CR_CLT_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append(" 						 F.CUST_CNT_CD CUST_CNT_CD," ).append("\n"); 
		query.append("    					 F.CUST_SEQ CUST_SEQ," ).append("\n"); 
		query.append("    					 C.CUST_LGL_ENG_NM CUST_NM" ).append("\n"); 
		query.append("					FROM   MDM_CR_CUST CUST," ).append("\n"); 
		query.append("					       BKG_BOOKING BKG," ).append("\n"); 
		query.append("                           MDM_CUSTOMER C," ).append("\n"); 
		query.append("    					   BKG_CUSTOMER F," ).append("\n"); 
		query.append("                           MDM_ORGANIZATION O" ).append("\n"); 
		query.append("					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("    				AND    BKG.BKG_NO = F.BKG_NO" ).append("\n"); 
		query.append("    				AND    F.BKG_CUST_TP_CD = 'F'" ).append("\n"); 
		query.append("					AND    F.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    F.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("					AND    C.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    NVL(C.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("					AND    CUST.CUST_CNT_CD = F.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    CUST.CUST_SEQ = F.CUST_SEQ" ).append("\n"); 
		query.append("					AND    BKG.BKG_OFC_CD = O.OFC_CD" ).append("\n"); 
		query.append("					AND    O.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    NVL(O.PPD_PTY_TP_CD,'S') ='F'" ).append("\n"); 
		query.append("    				AND    0 < CUST.OB_CR_TERM_DYS" ).append("\n"); 
		query.append("					AND    CUST.CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("					AND    CUST.CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("					AND    CUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("					UNION" ).append("\n"); 
		query.append("					--PPD RULE 2 SH CASE" ).append("\n"); 
		query.append("					SELECT BKG.BKG_NO BKG_NO," ).append("\n"); 
		query.append("					        11 AS FLG," ).append("\n"); 
		query.append("					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("						 CR_CLT_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("    					 S.CUST_CNT_CD CUST_CNT_CD," ).append("\n"); 
		query.append("    					 S.CUST_SEQ CUST_SEQ," ).append("\n"); 
		query.append("    					 C.CUST_LGL_ENG_NM CUST_NM" ).append("\n"); 
		query.append("					FROM   MDM_CR_CUST CUST," ).append("\n"); 
		query.append("    					   BKG_BOOKING BKG," ).append("\n"); 
		query.append("                           MDM_CUSTOMER C," ).append("\n"); 
		query.append("    					   BKG_CUSTOMER S" ).append("\n"); 
		query.append("					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("    				AND    BKG.BKG_NO = S.BKG_NO" ).append("\n"); 
		query.append("    				AND    S.BKG_CUST_TP_CD = 'S'" ).append("\n"); 
		query.append("					AND    S.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    S.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("					AND    C.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    NVL(C.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("					AND    CUST.CUST_CNT_CD = S.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    CUST.CUST_SEQ = S.CUST_SEQ" ).append("\n"); 
		query.append("    				AND    0 < CUST.OB_CR_TERM_DYS" ).append("\n"); 
		query.append("					AND    CUST.CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("					AND    CUST.CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("					AND    CUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("					UNION" ).append("\n"); 
		query.append("					--PPD RULE 3 FF CASE" ).append("\n"); 
		query.append("					--????????????????? MDM OFFICE ?? OFC_TP_CD?? QT ??????? POR ?? FINC_CTRL_OFC_CD ???????" ).append("\n"); 
		query.append("					SELECT B.BKG_NO BKG_NO," ).append("\n"); 
		query.append("					        12 AS FLG," ).append("\n"); 
		query.append("					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("					        DECODE(O.OFC_TP_CD,'QT',L.FINC_CTRL_OFC_CD,C.OFC_CD) OFC_CD," ).append("\n"); 
		query.append("    						F.CUST_CNT_CD," ).append("\n"); 
		query.append("    						F.CUST_SEQ," ).append("\n"); 
		query.append("    						C.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("					FROM    BKG_BOOKING B," ).append("\n"); 
		query.append("					        BKG_CUSTOMER F," ).append("\n"); 
		query.append("					        MDM_CUSTOMER C," ).append("\n"); 
		query.append("							MDM_ORGANIZATION O," ).append("\n"); 
		query.append("							MDM_LOCATION L" ).append("\n"); 
		query.append("					WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("    				AND  F.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("    				AND  F.BKG_CUST_TP_CD = 'F'" ).append("\n"); 
		query.append("    				AND  F.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("    				AND  F.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("    				AND  C.DELT_FLG ='N'" ).append("\n"); 
		query.append("    				AND  O.DELT_FLG ='N'" ).append("\n"); 
		query.append("    				AND  L.DELT_FLG ='N'" ).append("\n"); 
		query.append("    				AND  B.BKG_OFC_CD = O.OFC_CD " ).append("\n"); 
		query.append("    				AND  NVL(C.NMD_CUST_FLG,'N') ='N'	" ).append("\n"); 
		query.append("    				AND  NVL(O.PPD_PTY_TP_CD,'S') ='F'" ).append("\n"); 
		query.append("    				AND  B.POR_CD = L.LOC_CD" ).append("\n"); 
		query.append("					UNION" ).append("\n"); 
		query.append("					--PPD RULE 4 SH CASE" ).append("\n"); 
		query.append("					--????????????????? MDM OFFICE ?? OFC_TP_CD?? QT ??????? POR ?? FINC_CTRL_OFC_CD ???????" ).append("\n"); 
		query.append("					SELECT B.BKG_NO BKG_NO," ).append("\n"); 
		query.append("					        13 AS FLG," ).append("\n"); 
		query.append("					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("					        DECODE(O.OFC_TP_CD,'QT',L.FINC_CTRL_OFC_CD,C.OFC_CD) OFC_CD," ).append("\n"); 
		query.append("					        C.CUST_CNT_CD," ).append("\n"); 
		query.append("					        C.CUST_SEQ," ).append("\n"); 
		query.append("					        C.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("					FROM    BKG_BOOKING B," ).append("\n"); 
		query.append("					        BKG_CUSTOMER S," ).append("\n"); 
		query.append("					        MDM_CUSTOMER C," ).append("\n"); 
		query.append("							MDM_ORGANIZATION O," ).append("\n"); 
		query.append("							MDM_LOCATION L" ).append("\n"); 
		query.append("					WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("					AND    S.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("					AND    S.BKG_CUST_TP_CD = 'S'" ).append("\n"); 
		query.append("					AND    S.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    S.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("					AND    C.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    O.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    L.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    C.OFC_CD = O.OFC_CD " ).append("\n"); 
		query.append("					AND    NVL(C.NMD_CUST_FLG,'N') ='N'	" ).append("\n"); 
		query.append("					AND    B.POR_CD = L.LOC_CD" ).append("\n"); 
		query.append("					ORDER BY FLG" ).append("\n"); 
		query.append("					" ).append("\n"); 
		query.append("                        					) A" ).append("\n"); 
		query.append("                        					WHERE ROWNUM = 1) CR_RT_P" ).append("\n"); 
		query.append("                        					" ).append("\n"); 
		query.append("                                 WHERE  BK.BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("                                   AND  BK.BKG_STS_CD <>'X'" ).append("\n"); 
		query.append("                                   AND  BK.BKG_NO = RT.BKG_NO" ).append("\n"); 
		query.append("                                   AND  BK.BKG_NO = N.BKG_NO" ).append("\n"); 
		query.append("                                   AND  BK.BKG_NO = F.BKG_NO" ).append("\n"); 
		query.append("                                   AND  N.BKG_CUST_TP_CD ='N'" ).append("\n"); 
		query.append("                                   AND  F.BKG_CUST_TP_CD ='F'" ).append("\n"); 
		query.append("                                   AND  BK.POR_CD = POR_L.LOC_CD" ).append("\n"); 
		query.append("                                   AND  POR_L.DELT_FLG ='N'" ).append("\n"); 
		query.append("                                   AND  BK.DEL_CD = DEL_L.LOC_CD" ).append("\n"); 
		query.append("                                   AND  DEL_L.DELT_FLG ='N'" ).append("\n"); 
		query.append("                                   AND  DEL_L.FINC_CTRL_OFC_CD = OFC.OFC_CD" ).append("\n"); 
		query.append("                                   AND  OFC.DELT_FLG='N'" ).append("\n"); 
		query.append("                                   AND  BK.BKG_NO = CR_RT_P.BKG_NO(+))," ).append("\n"); 
		query.append("    PPD_PAYR_CUST_SEQ = (SELECT CASE WHEN (POR_L.CONTI_CD ='F' OR POR_L.CONTI_CD = 'E') AND(F.CUST_SEQ IS NOT NULL AND NVL(F.CUST_SEQ,'') <> '0') AND EXISTS (SELECT 'Y' FROM MDM_LOCATION FL " ).append("\n"); 
		query.append("                                                                                            WHERE  FL.CONTI_CD ='E' " ).append("\n"); 
		query.append("                                                                                              AND  FL.DELT_FLG ='N'" ).append("\n"); 
		query.append("                                                                                              AND  FL.CNT_CD = F.CUST_CNT_CD" ).append("\n"); 
		query.append("                                                                                              AND ROWNUM =1 )" ).append("\n"); 
		query.append("                                    THEN F.CUST_SEQ" ).append("\n"); 
		query.append("                               ELSE CR_RT_P.CUST_SEQ" ).append("\n"); 
		query.append("                               END UP_PPD_PAYR_CUST_SEQ" ).append("\n"); 
		query.append("                             FROM  BKG_BOOKING BK, BKG_RATE RT, BKG_CUSTOMER F, BKG_CUSTOMER N, MDM_LOCATION POR_L, MDM_LOCATION DEL_L," ).append("\n"); 
		query.append("                                    MDM_ORGANIZATION OFC, " ).append("\n"); 
		query.append("                                    (SELECT ROWNUM,A.* FROM " ).append("\n"); 
		query.append("                    				    (" ).append("\n"); 
		query.append("                    					" ).append("\n"); 
		query.append("					--PPD RULE 1 FF CASE" ).append("\n"); 
		query.append("					SELECT BKG.BKG_NO BKG_NO," ).append("\n"); 
		query.append("					        10 AS FLG," ).append("\n"); 
		query.append("					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("						 CR_CLT_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append(" 						 F.CUST_CNT_CD CUST_CNT_CD," ).append("\n"); 
		query.append("    					 F.CUST_SEQ CUST_SEQ," ).append("\n"); 
		query.append("    					 C.CUST_LGL_ENG_NM CUST_NM" ).append("\n"); 
		query.append("					FROM   MDM_CR_CUST CUST," ).append("\n"); 
		query.append("					       BKG_BOOKING BKG," ).append("\n"); 
		query.append("                           MDM_CUSTOMER C," ).append("\n"); 
		query.append("    					   BKG_CUSTOMER F," ).append("\n"); 
		query.append("                           MDM_ORGANIZATION O" ).append("\n"); 
		query.append("					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("    				AND    BKG.BKG_NO = F.BKG_NO" ).append("\n"); 
		query.append("    				AND    F.BKG_CUST_TP_CD = 'F'" ).append("\n"); 
		query.append("					AND    F.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    F.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("					AND    C.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    NVL(C.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("					AND    CUST.CUST_CNT_CD = F.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    CUST.CUST_SEQ = F.CUST_SEQ" ).append("\n"); 
		query.append("					AND    BKG.BKG_OFC_CD = O.OFC_CD" ).append("\n"); 
		query.append("					AND    O.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    NVL(O.PPD_PTY_TP_CD,'S') ='F'" ).append("\n"); 
		query.append("    				AND    0 < CUST.OB_CR_TERM_DYS" ).append("\n"); 
		query.append("					AND    CUST.CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("					AND    CUST.CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("					AND    CUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("					UNION" ).append("\n"); 
		query.append("					--PPD RULE 2 SH CASE" ).append("\n"); 
		query.append("					SELECT BKG.BKG_NO BKG_NO," ).append("\n"); 
		query.append("					        11 AS FLG," ).append("\n"); 
		query.append("					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("						 CR_CLT_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("    					 S.CUST_CNT_CD CUST_CNT_CD," ).append("\n"); 
		query.append("    					 S.CUST_SEQ CUST_SEQ," ).append("\n"); 
		query.append("    					 C.CUST_LGL_ENG_NM CUST_NM" ).append("\n"); 
		query.append("					FROM   MDM_CR_CUST CUST," ).append("\n"); 
		query.append("    					   BKG_BOOKING BKG," ).append("\n"); 
		query.append("                           MDM_CUSTOMER C," ).append("\n"); 
		query.append("    					   BKG_CUSTOMER S" ).append("\n"); 
		query.append("					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("    				AND    BKG.BKG_NO = S.BKG_NO" ).append("\n"); 
		query.append("    				AND    S.BKG_CUST_TP_CD = 'S'" ).append("\n"); 
		query.append("					AND    S.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    S.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("					AND    C.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    NVL(C.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("					AND    CUST.CUST_CNT_CD = S.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    CUST.CUST_SEQ = S.CUST_SEQ" ).append("\n"); 
		query.append("    				AND    0 < CUST.OB_CR_TERM_DYS" ).append("\n"); 
		query.append("					AND    CUST.CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("					AND    CUST.CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("					AND    CUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("					UNION" ).append("\n"); 
		query.append("					--PPD RULE 3 FF CASE" ).append("\n"); 
		query.append("					--????????????????? MDM OFFICE ?? OFC_TP_CD?? QT ??????? POR ?? FINC_CTRL_OFC_CD ???????" ).append("\n"); 
		query.append("					SELECT B.BKG_NO BKG_NO," ).append("\n"); 
		query.append("					        12 AS FLG," ).append("\n"); 
		query.append("					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("					        DECODE(O.OFC_TP_CD,'QT',L.FINC_CTRL_OFC_CD,C.OFC_CD) OFC_CD," ).append("\n"); 
		query.append("    						F.CUST_CNT_CD," ).append("\n"); 
		query.append("    						F.CUST_SEQ," ).append("\n"); 
		query.append("    						C.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("					FROM    BKG_BOOKING B," ).append("\n"); 
		query.append("					        BKG_CUSTOMER F," ).append("\n"); 
		query.append("					        MDM_CUSTOMER C," ).append("\n"); 
		query.append("							MDM_ORGANIZATION O," ).append("\n"); 
		query.append("							MDM_LOCATION L" ).append("\n"); 
		query.append("					WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("    				AND  F.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("    				AND  F.BKG_CUST_TP_CD = 'F'" ).append("\n"); 
		query.append("    				AND  F.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("    				AND  F.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("    				AND  C.DELT_FLG ='N'" ).append("\n"); 
		query.append("    				AND  O.DELT_FLG ='N'" ).append("\n"); 
		query.append("    				AND  L.DELT_FLG ='N'" ).append("\n"); 
		query.append("    				AND  B.BKG_OFC_CD = O.OFC_CD " ).append("\n"); 
		query.append("    				AND  NVL(C.NMD_CUST_FLG,'N') ='N'	" ).append("\n"); 
		query.append("    				AND  NVL(O.PPD_PTY_TP_CD,'S') ='F'" ).append("\n"); 
		query.append("    				AND  B.POR_CD = L.LOC_CD" ).append("\n"); 
		query.append("					UNION" ).append("\n"); 
		query.append("					--PPD RULE 4 SH CASE" ).append("\n"); 
		query.append("					--????????????????? MDM OFFICE ?? OFC_TP_CD?? QT ??????? POR ?? FINC_CTRL_OFC_CD ???????" ).append("\n"); 
		query.append("					SELECT B.BKG_NO BKG_NO," ).append("\n"); 
		query.append("					        13 AS FLG," ).append("\n"); 
		query.append("					        'S' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("					        DECODE(O.OFC_TP_CD,'QT',L.FINC_CTRL_OFC_CD,C.OFC_CD) OFC_CD," ).append("\n"); 
		query.append("					        C.CUST_CNT_CD," ).append("\n"); 
		query.append("					        C.CUST_SEQ," ).append("\n"); 
		query.append("					        C.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("					FROM    BKG_BOOKING B," ).append("\n"); 
		query.append("					        BKG_CUSTOMER S," ).append("\n"); 
		query.append("					        MDM_CUSTOMER C," ).append("\n"); 
		query.append("							MDM_ORGANIZATION O," ).append("\n"); 
		query.append("							MDM_LOCATION L" ).append("\n"); 
		query.append("					WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("					AND    S.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("					AND    S.BKG_CUST_TP_CD = 'S'" ).append("\n"); 
		query.append("					AND    S.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("					AND    S.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("					AND    C.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    O.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    L.DELT_FLG ='N'" ).append("\n"); 
		query.append("					AND    C.OFC_CD = O.OFC_CD " ).append("\n"); 
		query.append("					AND    NVL(C.NMD_CUST_FLG,'N') ='N'	" ).append("\n"); 
		query.append("					AND    B.POR_CD = L.LOC_CD" ).append("\n"); 
		query.append("					ORDER BY FLG" ).append("\n"); 
		query.append("					" ).append("\n"); 
		query.append("                    					) A" ).append("\n"); 
		query.append("                    					WHERE ROWNUM = 1) CR_RT_P" ).append("\n"); 
		query.append("                    					" ).append("\n"); 
		query.append("                             WHERE  BK.BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("                               AND  BK.BKG_STS_CD <>'X'" ).append("\n"); 
		query.append("                               AND  BK.BKG_NO = RT.BKG_NO" ).append("\n"); 
		query.append("                               AND  BK.BKG_NO = N.BKG_NO" ).append("\n"); 
		query.append("                               AND  BK.BKG_NO = F.BKG_NO" ).append("\n"); 
		query.append("                               AND  N.BKG_CUST_TP_CD ='N'" ).append("\n"); 
		query.append("                               AND  F.BKG_CUST_TP_CD ='F'" ).append("\n"); 
		query.append("                               AND  BK.POR_CD = POR_L.LOC_CD" ).append("\n"); 
		query.append("                               AND  POR_L.DELT_FLG ='N'" ).append("\n"); 
		query.append("                               AND  BK.DEL_CD = DEL_L.LOC_CD" ).append("\n"); 
		query.append("                               AND  DEL_L.DELT_FLG ='N'" ).append("\n"); 
		query.append("                               AND  DEL_L.FINC_CTRL_OFC_CD = OFC.OFC_CD" ).append("\n"); 
		query.append("                               AND  OFC.DELT_FLG='N'" ).append("\n"); 
		query.append("                               AND  BK.BKG_NO = CR_RT_P.BKG_NO(+))," ).append("\n"); 
		query.append("    CLT_PAYR_CNT_CD = (SELECT CASE WHEN BK.CUST_TO_ORD_FLG='Y' AND ( NVL(N.CUST_CNT_CD,'')||N.CUST_SEQ = '0' OR N.CUST_CNT_CD||N.CUST_SEQ IS NULL OR N.CUST_SEQ IS NULL)" ).append("\n"); 
		query.append("                                    THEN OFC.REP_CUST_CNT_CD --FIN_OFC 의 AR CUSTOMER" ).append("\n"); 
		query.append("                                    WHEN BK.CUST_TO_ORD_FLG='Y' AND ( NVL(N.CUST_CNT_CD,'')||N.CUST_SEQ <> '0' AND N.CUST_CNT_CD||N.CUST_SEQ IS NOT NULL AND N.CUST_SEQ IS NOT NULL )" ).append("\n"); 
		query.append("                                    THEN N.CUST_CNT_CD    -- NOTIFY" ).append("\n"); 
		query.append("                                    ELSE CR_RT_C.CUST_CNT_CD  -- NOT NULL 을 위해 DEFALUT " ).append("\n"); 
		query.append("                                    END UP_CLT_PAYR_CNT_CD" ).append("\n"); 
		query.append("                        FROM  BKG_BOOKING BK, BKG_RATE RT, BKG_CUSTOMER F, BKG_CUSTOMER N, MDM_LOCATION POR_L, MDM_LOCATION DEL_L," ).append("\n"); 
		query.append("                              MDM_ORGANIZATION OFC, " ).append("\n"); 
		query.append("            					(SELECT ROWNUM,A.* FROM " ).append("\n"); 
		query.append("            					(" ).append("\n"); 
		query.append("            					--CCT" ).append("\n"); 
		query.append("            					SELECT  BKG.BKG_NO AS BKG_NO," ).append("\n"); 
		query.append("            					        21 AS FLG," ).append("\n"); 
		query.append("            					        'C' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("            					        CR_CLT_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("            					        BCUST.CUST_CNT_CD AS CUST_CNT_CD," ).append("\n"); 
		query.append("            					        BCUST.CUST_SEQ AS CUST_SEQ," ).append("\n"); 
		query.append("            					        MCUST.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("            					FROM    MDM_CR_CUST CUST," ).append("\n"); 
		query.append("            					        BKG_BOOKING BKG," ).append("\n"); 
		query.append("            					        BKG_CUSTOMER BCUST," ).append("\n"); 
		query.append("            					        MDM_CUSTOMER MCUST" ).append("\n"); 
		query.append("            					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("            					AND    BKG.BKG_NO = BCUST.BKG_NO" ).append("\n"); 
		query.append("            					AND    BCUST.BKG_CUST_TP_CD = 'C'" ).append("\n"); 
		query.append("            					AND    CUST.CUST_CNT_CD = BCUST.CUST_CNT_CD" ).append("\n"); 
		query.append("            					AND    CUST.CUST_SEQ = BCUST.CUST_SEQ" ).append("\n"); 
		query.append("            					AND    BCUST.CUST_CNT_CD = MCUST.CUST_CNT_CD" ).append("\n"); 
		query.append("            					AND    BCUST.CUST_SEQ = MCUST.CUST_SEQ    " ).append("\n"); 
		query.append("            					AND    IB_CR_TERM_DYS > 0" ).append("\n"); 
		query.append("            					AND    CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("            					AND    CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("            					AND    MCUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("            					AND    NVL(MCUST.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("            					AND    CUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("            					UNION" ).append("\n"); 
		query.append("            					--CCT OFFICE CODE2" ).append("\n"); 
		query.append("            					SELECT B.BKG_NO BKG_NO," ).append("\n"); 
		query.append("            					        22 AS FLG," ).append("\n"); 
		query.append("            					        'C' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("            					        FINC_CTRL_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("            					        S.CUST_CNT_CD  AS CUST_CNT_CD," ).append("\n"); 
		query.append("            					        NVL(S.CUST_SEQ,'1') AS CUST_SEQ," ).append("\n"); 
		query.append("            					        C.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("            					FROM    MDM_LOCATION M, " ).append("\n"); 
		query.append("            					        BKG_BOOKING B, " ).append("\n"); 
		query.append("            					        BKG_CUSTOMER S," ).append("\n"); 
		query.append("            					        MDM_CUSTOMER C" ).append("\n"); 
		query.append("            					WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("            					AND    S.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("            					AND    S.BKG_CUST_TP_CD = 'C'" ).append("\n"); 
		query.append("            					AND    S.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("            					AND    S.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("            					AND    B.DEL_CD = M.LOC_CD" ).append("\n"); 
		query.append("            					AND    C.DELT_FLG = 'N'" ).append("\n"); 
		query.append("            					AND	NVL(C.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("            					UNION" ).append("\n"); 
		query.append("            					--REP CUSTOMER" ).append("\n"); 
		query.append("            					SELECT BKG_NO," ).append("\n"); 
		query.append("            					        31 AS FLG," ).append("\n"); 
		query.append("            					        'R'AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("            					        (SELECT  FINC_CTRL_OFC_CD" ).append("\n"); 
		query.append("            					            FROM MDM_LOCATION" ).append("\n"); 
		query.append("            					            WHERE LOC_CD = (SELECT DEL_CD" ).append("\n"); 
		query.append("            					                            FROM  BKG_BOOKING" ).append("\n"); 
		query.append("            					                            WHERE BKG_NO =@[bkg_no])) AS OFC_CD," ).append("\n"); 
		query.append("            					        REP_CUST_CNT_CD AS CUST_CNT_CD," ).append("\n"); 
		query.append("            					        REP_CUST_SEQ AS CUST_SEQ," ).append("\n"); 
		query.append("            					        MCUST.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("            					FROM   MDM_ORGANIZATION OFC, " ).append("\n"); 
		query.append("            					        BKG_BOOKING BKG," ).append("\n"); 
		query.append("            					        MDM_CUSTOMER MCUST" ).append("\n"); 
		query.append("            					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("            					AND    REP_CUST_CNT_CD = MCUST.CUST_CNT_CD" ).append("\n"); 
		query.append("            					AND    REP_CUST_SEQ = MCUST.CUST_SEQ" ).append("\n"); 
		query.append("            					AND    MCUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("            					AND	NVL(MCUST.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("            					AND    OFC.OFC_CD = NVL((SELECT CR_CLT_OFC_CD" ).append("\n"); 
		query.append("            					                        FROM MDM_CR_CUST" ).append("\n"); 
		query.append("            					                        WHERE (CUST_CNT_CD, CUST_SEQ) = (SELECT CUST_CNT_CD, CUST_SEQ" ).append("\n"); 
		query.append("            					                                                            FROM   BKG_BOOKING B," ).append("\n"); 
		query.append("            					                                                                    BKG_CUSTOMER C" ).append("\n"); 
		query.append("            					                                                            WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("            					                                                            AND    C.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("            					                                                            AND    C.BKG_CUST_TP_CD = 'C'" ).append("\n"); 
		query.append("            																				)" ).append("\n"); 
		query.append("            					                        AND 0 < IB_CR_TERM_DYS" ).append("\n"); 
		query.append("            											AND MCUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("            					                        AND CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("            					                        AND CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no]))," ).append("\n"); 
		query.append("            					                    (SELECT  FINC_CTRL_OFC_CD" ).append("\n"); 
		query.append("            					                        FROM MDM_LOCATION" ).append("\n"); 
		query.append("            					                        WHERE LOC_CD = (SELECT DEL_CD" ).append("\n"); 
		query.append("            					                                        FROM  BKG_BOOKING" ).append("\n"); 
		query.append("            					                                        WHERE BKG_NO =@[bkg_no])" ).append("\n"); 
		query.append("            					                    )" ).append("\n"); 
		query.append("            					                    )" ).append("\n"); 
		query.append("            					                    ORDER BY FLG" ).append("\n"); 
		query.append("            					) A" ).append("\n"); 
		query.append("            					WHERE " ).append("\n"); 
		query.append("            					ROWNUM = 1) CR_RT_C" ).append("\n"); 
		query.append("            					" ).append("\n"); 
		query.append("                     WHERE  BK.BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("                       AND  BK.BKG_STS_CD <>'X'" ).append("\n"); 
		query.append("                       AND  BK.BKG_NO = RT.BKG_NO" ).append("\n"); 
		query.append("                       AND  BK.BKG_NO = N.BKG_NO" ).append("\n"); 
		query.append("                       AND  BK.BKG_NO = F.BKG_NO" ).append("\n"); 
		query.append("                       AND  N.BKG_CUST_TP_CD ='N'" ).append("\n"); 
		query.append("                       AND  F.BKG_CUST_TP_CD ='F'" ).append("\n"); 
		query.append("                       AND  BK.POR_CD = POR_L.LOC_CD" ).append("\n"); 
		query.append("                       AND  POR_L.DELT_FLG ='N'" ).append("\n"); 
		query.append("                       AND  BK.DEL_CD = DEL_L.LOC_CD" ).append("\n"); 
		query.append("                       AND  DEL_L.DELT_FLG ='N'" ).append("\n"); 
		query.append("                       AND  DEL_L.FINC_CTRL_OFC_CD = OFC.OFC_CD" ).append("\n"); 
		query.append("                       AND  OFC.DELT_FLG='N'" ).append("\n"); 
		query.append("                       AND  BK.BKG_NO = CR_RT_C.BKG_NO(+))," ).append("\n"); 
		query.append("    CLT_PAYR_CUST_SEQ = (SELECT CASE WHEN BK.CUST_TO_ORD_FLG='Y' AND ( NVL(N.CUST_CNT_CD,'')||N.CUST_SEQ = '0' OR N.CUST_CNT_CD||N.CUST_SEQ IS NULL OR N.CUST_SEQ IS NULL)" ).append("\n"); 
		query.append("                                THEN OFC.REP_CUST_SEQ   --FIN_OFC 의 AR CUSTOMER" ).append("\n"); 
		query.append("                                WHEN BK.CUST_TO_ORD_FLG='Y' AND ( NVL(N.CUST_CNT_CD,'')||N.CUST_SEQ <> '0' AND N.CUST_CNT_CD||N.CUST_SEQ IS NOT NULL AND N.CUST_SEQ IS NOT NULL)" ).append("\n"); 
		query.append("                                THEN N.CUST_SEQ       -- NOTIFY" ).append("\n"); 
		query.append("                                ELSE CR_RT_C.CUST_SEQ -- NOT NULL 을 위해 DEFALUT " ).append("\n"); 
		query.append("                                END UP_CLT_PAYR_CUST_SEQ" ).append("\n"); 
		query.append("                         FROM  BKG_BOOKING BK, BKG_RATE RT, BKG_CUSTOMER F, BKG_CUSTOMER N, MDM_LOCATION POR_L, MDM_LOCATION DEL_L," ).append("\n"); 
		query.append("                                MDM_ORGANIZATION OFC, " ).append("\n"); 
		query.append("                					(SELECT ROWNUM,A.* FROM " ).append("\n"); 
		query.append("                					(" ).append("\n"); 
		query.append("                					--CCT" ).append("\n"); 
		query.append("                					SELECT  BKG.BKG_NO AS BKG_NO," ).append("\n"); 
		query.append("                					        21 AS FLG," ).append("\n"); 
		query.append("                					        'C' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("                					        CR_CLT_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("                					        BCUST.CUST_CNT_CD AS CUST_CNT_CD," ).append("\n"); 
		query.append("                					        BCUST.CUST_SEQ AS CUST_SEQ," ).append("\n"); 
		query.append("                					        MCUST.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("                					FROM    MDM_CR_CUST CUST," ).append("\n"); 
		query.append("                					        BKG_BOOKING BKG," ).append("\n"); 
		query.append("                					        BKG_CUSTOMER BCUST," ).append("\n"); 
		query.append("                					        MDM_CUSTOMER MCUST" ).append("\n"); 
		query.append("                					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("                					AND    BKG.BKG_NO = BCUST.BKG_NO" ).append("\n"); 
		query.append("                					AND    BCUST.BKG_CUST_TP_CD = 'C'" ).append("\n"); 
		query.append("                					AND    CUST.CUST_CNT_CD = BCUST.CUST_CNT_CD" ).append("\n"); 
		query.append("                					AND    CUST.CUST_SEQ = BCUST.CUST_SEQ" ).append("\n"); 
		query.append("                					AND    BCUST.CUST_CNT_CD = MCUST.CUST_CNT_CD" ).append("\n"); 
		query.append("                					AND    BCUST.CUST_SEQ = MCUST.CUST_SEQ    " ).append("\n"); 
		query.append("                					AND    IB_CR_TERM_DYS > 0" ).append("\n"); 
		query.append("                					AND    CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("                					AND    CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("                					AND    MCUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("                					AND    NVL(MCUST.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("                					AND    CUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("                					UNION" ).append("\n"); 
		query.append("                					--CCT OFFICE CODE2" ).append("\n"); 
		query.append("                					SELECT B.BKG_NO BKG_NO," ).append("\n"); 
		query.append("                					        22 AS FLG," ).append("\n"); 
		query.append("                					        'C' AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("                					        FINC_CTRL_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("                					        S.CUST_CNT_CD  AS CUST_CNT_CD," ).append("\n"); 
		query.append("                					        NVL(S.CUST_SEQ,'1') AS CUST_SEQ," ).append("\n"); 
		query.append("                					        C.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("                					FROM    MDM_LOCATION M, " ).append("\n"); 
		query.append("                					        BKG_BOOKING B, " ).append("\n"); 
		query.append("                					        BKG_CUSTOMER S," ).append("\n"); 
		query.append("                					        MDM_CUSTOMER C" ).append("\n"); 
		query.append("                					WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("                					AND    S.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("                					AND    S.BKG_CUST_TP_CD = 'C'" ).append("\n"); 
		query.append("                					AND    S.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("                					AND    S.CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("                					AND    B.DEL_CD = M.LOC_CD" ).append("\n"); 
		query.append("                					AND    C.DELT_FLG = 'N'" ).append("\n"); 
		query.append("                					AND	NVL(C.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("                					UNION" ).append("\n"); 
		query.append("                					--REP CUSTOMER" ).append("\n"); 
		query.append("                					SELECT BKG_NO," ).append("\n"); 
		query.append("                					        31 AS FLG," ).append("\n"); 
		query.append("                					        'R'AS BKG_CUST_TP_CD," ).append("\n"); 
		query.append("                					        (SELECT  FINC_CTRL_OFC_CD" ).append("\n"); 
		query.append("                					            FROM MDM_LOCATION" ).append("\n"); 
		query.append("                					            WHERE LOC_CD = (SELECT DEL_CD" ).append("\n"); 
		query.append("                					                            FROM  BKG_BOOKING" ).append("\n"); 
		query.append("                					                            WHERE BKG_NO =@[bkg_no])) AS OFC_CD," ).append("\n"); 
		query.append("                					        REP_CUST_CNT_CD AS CUST_CNT_CD," ).append("\n"); 
		query.append("                					        REP_CUST_SEQ AS CUST_SEQ," ).append("\n"); 
		query.append("                					        MCUST.CUST_LGL_ENG_NM AS CUST_NM" ).append("\n"); 
		query.append("                					FROM   MDM_ORGANIZATION OFC, " ).append("\n"); 
		query.append("                					        BKG_BOOKING BKG," ).append("\n"); 
		query.append("                					        MDM_CUSTOMER MCUST" ).append("\n"); 
		query.append("                					WHERE  BKG.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("                					AND    REP_CUST_CNT_CD = MCUST.CUST_CNT_CD" ).append("\n"); 
		query.append("                					AND    REP_CUST_SEQ = MCUST.CUST_SEQ" ).append("\n"); 
		query.append("                					AND    MCUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("                					AND	NVL(MCUST.NMD_CUST_FLG,'N') ='N'" ).append("\n"); 
		query.append("                					AND    OFC.OFC_CD = NVL((SELECT CR_CLT_OFC_CD" ).append("\n"); 
		query.append("                					                        FROM MDM_CR_CUST" ).append("\n"); 
		query.append("                					                        WHERE (CUST_CNT_CD, CUST_SEQ) = (SELECT CUST_CNT_CD, CUST_SEQ" ).append("\n"); 
		query.append("                					                                                            FROM   BKG_BOOKING B," ).append("\n"); 
		query.append("                					                                                                    BKG_CUSTOMER C" ).append("\n"); 
		query.append("                					                                                            WHERE  B.BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("                					                                                            AND    C.BKG_NO = B.BKG_NO" ).append("\n"); 
		query.append("                					                                                            AND    C.BKG_CUST_TP_CD = 'C'" ).append("\n"); 
		query.append("                																				)" ).append("\n"); 
		query.append("                					                        AND 0 < IB_CR_TERM_DYS" ).append("\n"); 
		query.append("                											AND MCUST.DELT_FLG ='N'" ).append("\n"); 
		query.append("                					                        AND CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])" ).append("\n"); 
		query.append("                					                        AND CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no]))," ).append("\n"); 
		query.append("                					                    (SELECT  FINC_CTRL_OFC_CD" ).append("\n"); 
		query.append("                					                        FROM MDM_LOCATION" ).append("\n"); 
		query.append("                					                        WHERE LOC_CD = (SELECT DEL_CD" ).append("\n"); 
		query.append("                					                                        FROM  BKG_BOOKING" ).append("\n"); 
		query.append("                					                                        WHERE BKG_NO =@[bkg_no])" ).append("\n"); 
		query.append("                					                    )" ).append("\n"); 
		query.append("                					                    )" ).append("\n"); 
		query.append("                					                    ORDER BY FLG" ).append("\n"); 
		query.append("                					) A" ).append("\n"); 
		query.append("                					WHERE " ).append("\n"); 
		query.append("                					ROWNUM = 1) CR_RT_C" ).append("\n"); 
		query.append("                					" ).append("\n"); 
		query.append("                         WHERE  BK.BKG_NO =@[bkg_no]" ).append("\n"); 
		query.append("                           AND  BK.BKG_STS_CD <>'X'" ).append("\n"); 
		query.append("                           AND  BK.BKG_NO = RT.BKG_NO" ).append("\n"); 
		query.append("                           AND  BK.BKG_NO = N.BKG_NO" ).append("\n"); 
		query.append("                           AND  BK.BKG_NO = F.BKG_NO" ).append("\n"); 
		query.append("                           AND  N.BKG_CUST_TP_CD ='N'" ).append("\n"); 
		query.append("                           AND  F.BKG_CUST_TP_CD ='F'" ).append("\n"); 
		query.append("                           AND  BK.POR_CD = POR_L.LOC_CD" ).append("\n"); 
		query.append("                           AND  POR_L.DELT_FLG ='N'" ).append("\n"); 
		query.append("                           AND  BK.DEL_CD = DEL_L.LOC_CD" ).append("\n"); 
		query.append("                           AND  DEL_L.DELT_FLG ='N'" ).append("\n"); 
		query.append("                           AND  DEL_L.FINC_CTRL_OFC_CD = OFC.OFC_CD" ).append("\n"); 
		query.append("                           AND  OFC.DELT_FLG='N'" ).append("\n"); 
		query.append("                           AND  BK.BKG_NO = CR_RT_C.BKG_NO(+))," ).append("\n"); 
		query.append("    UPD_USR_ID = @[user_id]," ).append("\n"); 
		query.append("    UPD_DT = SYSDATE  " ).append("\n"); 
		query.append("WHERE BKG_NO = @[bkg_no]" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("#end" ).append("\n"); 

	}
}