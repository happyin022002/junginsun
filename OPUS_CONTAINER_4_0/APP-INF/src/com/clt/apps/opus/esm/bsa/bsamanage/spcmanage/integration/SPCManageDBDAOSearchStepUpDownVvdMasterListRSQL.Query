<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SPCManageDBDAOSearchStepUpDownVvdMasterListRSQL">
			<desc><![CDATA[ESM_BSA_0032 화면의 Master Data 조회 쿼리]]></desc>
			<sql><![CDATA[
SELECT 
#if (${chkprd} == 'M')
  SUBSTR(A.COST_YRMON, 1, 4) || A.COST_WK AS COST_YRWK,
#elseif (${chkprd} == 'W')
  SUBSTR(A.SLS_YRMON, 1, 4) || A.COST_WK AS COST_YRWK,
#end 
      A.SUB_TRD_CD,
      A.SLAN_CD ,
      B.TRD_CD,
      B.RLANE_CD,
      B.VSL_CD,
      B.SKD_VOY_NO,
      B.SKD_DIR_CD,
      B.BSA_OP_CD ,
      DECODE(B.BSA_OP_CD, 'J', 'J/O', 'S', 'S/C', B.BSA_OP_CD) AS BSA_OP_NM ,
      B.IOC_CD,
      B.VOP_CD,
      B.VSL_CAPA,
      B.BSA_CAPA,
#if (${rdocode} == '007')
      C.PORT_BSA_CAPA ,																--20150821.MOD
#else
   (SELECT CRR_BSA_CAPA 
      FROM BSA_VVD_OTR_CRR E 
     WHERE C.TRD_CD = E.TRD_CD 
       AND C.RLANE_CD = E.RLANE_CD AND C.VSL_CD = E.VSL_CD 
       AND C.SKD_VOY_NO = E.SKD_VOY_NO AND C.SKD_DIR_CD = E.SKD_DIR_CD 
       AND E.BSA_OP_JB_CD = '009' AND  C.CRR_CD = E.CRR_CD) AS PORT_BSA_CAPA,
#end 
      C.CRR_CD,
      C.BSA_OP_JB_CD,
      DECODE(D.STUP_FLG, 'Y', '1', '0') STUP_FLG,
      DECODE(B.PORT_BSA_CFM_FLG, 'Y', '1', '0') PORT_BSA_CFM_FLG
FROM COA_MON_VVD A ,
      BSA_VVD_MST B ,
      BSA_VVD_PORT_DWN C ,
      COA_LANE_RGST D
WHERE A.TRD_CD      = B.TRD_CD
  AND A.RLANE_CD    = B.RLANE_CD
  AND A.VSL_CD      = B.VSL_CD
  AND A.SKD_VOY_NO  = B.SKD_VOY_NO
  AND A.DIR_CD      = B.SKD_DIR_CD
  AND B.TRD_CD      = C.TRD_CD
  AND B.RLANE_CD    = C.RLANE_CD
  AND B.VSL_CD      = C.VSL_CD
  AND B.SKD_VOY_NO  = C.SKD_VOY_NO
  AND B.SKD_DIR_CD  = C.SKD_DIR_CD
  AND A.TRD_CD      = D.TRD_CD
  AND A.RLANE_CD    = D.RLANE_CD
  AND A.DIR_CD      = D.DIR_CD
  AND NVL(A.DELT_FLG, 'N') = 'N'
  AND NVL(D.STUP_FLG, 'N') = 'Y' 
  AND NVL(D.DELT_FLG, 'N') = 'N'
#if (${chkprd} == 'M')
  AND A.COST_YRMON BETWEEN @[txtyear]||@[txtfmmonth] AND @[txtyear]||@[txttomonth] 
#elseif (${chkprd} == 'W')
  AND A.SLS_YRMON LIKE @[txtyear] || '%'
  AND A.COST_WK BETWEEN @[txtfmweek] AND @[txttoweek] 
#end 
#if (${cobtrade} != '')
  AND A.TRD_CD = @[cobtrade] 
#end 
#if (${coblane} != '')
  AND A.RLANE_CD = @[coblane] 
#end 
#if (${cobdir} != '')
  AND A.DIR_CD = @[cobdir] 
#end 
#if (${cobioc} != '')
  AND A.IOC_CD = @[cobioc] 
#end 
  AND C.CRR_CD        = @[cobcarrier]
  AND C.BSA_OP_JB_CD  = @[rdocode]
  AND C.PORT_SEQ      = 999
  AND C.PORT_CD       = 'XXXXX'
ORDER BY 
#if (${chkprd} == 'M')
  SUBSTR(A.COST_YRMON, 1, 4) || A.COST_WK ,
#elseif (${chkprd} == 'W')
  SUBSTR(A.SLS_YRMON, 1, 4) || A.COST_WK ,
#end 
	  A.SUB_TRD_CD,
      A.SLAN_CD ,
      B.TRD_CD,
      B.RLANE_CD,     
      B.SKD_DIR_CD,
      B.BSA_OP_CD			]]></sql>
			<params>
				<param name="txtyear" type="12" value="" out="N"/>
				<param name="txtfmmonth" type="12" value="" out="N"/>
				<param name="txttomonth" type="12" value="" out="N"/>
				<param name="txtfmweek" type="12" value="" out="N"/>
				<param name="txttoweek" type="12" value="" out="N"/>
				<param name="cobtrade" type="12" value="" out="N"/>
				<param name="coblane" type="12" value="" out="N"/>
				<param name="cobdir" type="12" value="" out="N"/>
				<param name="cobioc" type="12" value="" out="N"/>
				<param name="cobcarrier" type="12" value="" out="N"/>
				<param name="rdocode" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
