<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingHistoryMgtDBDAOSearchHistBkgCntrSealNoRSQL">
			<desc><![CDATA[BookingHistoryMgtDBDAOSearchHistBkgCntrSealNoRSQL]]></desc>
			<sql><![CDATA[
WITH OLD AS
(SELECT @[bkg_no] BKG_NO
	  , @[cntr_no] CNTR_NO
	  , @[cntr_seal_no] CNTR_SEAL_NO
 FROM DUAL)
SELECT HIS_CATE_NM
     , PRE_CTNT
     , CRNT_CTNT
  FROM 
      (SELECT 'SEAL No.' HIS_CATE_NM
            , OLD.CNTR_SEAL_NO PRE_CTNT
            , NOW.CNTR_NO||'/'||
	   		   BKG_JOIN_FNC( CURSOR(SELECT CNTR_SEAL_NO
#if (${ca_flg} == 'Y')
                    		  FROM BKG_CNTR_SEAL_NO_HIS SEAL
		                     WHERE SEAL.BKG_NO  = NOW.BKG_NO
   							   AND SEAL.CORR_NO = NOW.CORR_NO
#else
                    		  FROM BKG_CNTR_SEAL_NO SEAL
		                     WHERE SEAL.BKG_NO  = NOW.BKG_NO
#end
							   AND SEAL.CNTR_NO = NOW.CNTR_NO
							 ORDER BY CNTR_SEAL_SEQ
 							)) CRNT_CTNT
#if (${ca_flg} == 'Y')
  FROM BKG_CNTR_HIS NOW, OLD
 WHERE NOW.BKG_NO (+) = OLD.BKG_NO
   AND NOW.CORR_NO(+) = 'TMP0000001' 
#else
  FROM BKG_CONTAINER NOW, OLD
 WHERE NOW.BKG_NO (+) = OLD.BKG_NO
#end
   AND NOW.CNTR_NO(+) = OLD.CNTR_NO
       )
 WHERE NVL(TRIM(PRE_CTNT), ' ') <> NVL(TRIM(CRNT_CTNT), ' ')
   AND LENGTH(PRE_CTNT) > ( CASE WHEN   LENGTH(CRNT_CTNT) > 1 AND @[cntr_seal_no] IS NOT NULL THEN  11
                                 ELSE 12 END )			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="FXT900035300" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="cntr_seal_no" type="12" value="HJCU1071090/CH147258,S123456" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
