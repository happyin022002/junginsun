<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CopDetailReceiveDBDAOSearchSceCopHdrRailRCVDTRSQL">
			<desc><![CDATA[SearchSceCopHdrRailRCVDT]]></desc>
			<sql><![CDATA[
SELECT cop_no
, TO_CHAR(rail_rcv_coff_fm_dt,'YYYYMMDDHH24MISS') rail_rcv_coff_fm_dt
, TO_CHAR(rail_rcv_coff_to_dt,'YYYYMMDDHH24MISS') rail_rcv_coff_to_dt
FROM (                          
SELECT A.cop_no, (A.RAIL_RCV_COFF_FM_DT+NUMTODSINTERVAL((TO_DATE(@[act_dt],'YYYY/MM/DD HH24:MI:SS')-A.VPS_EVNT_DT),'DAY')) rail_rcv_coff_fm_dt 
               , (A.RAIL_RCV_COFF_TO_DT+NUMTODSINTERVAL((TO_DATE(@[act_dt],'YYYY/MM/DD HH24:MI:SS')-A.VPS_EVNT_DT),'DAY')) rail_rcv_coff_to_dt 
       ,NUMTODSINTERVAL((TO_DATE(@[act_dt],'YYYY/MM/DD HH24:MI:SS')-A.VPS_EVNT_DT),'DAY') gap 
FROM   (SELECT H.COP_NO,H.RAIL_RCV_COFF_FM_DT,H.RAIL_RCV_COFF_TO_DT
               ,S.VPS_EVNT_DT,S.VPS_RCV_DT,S.VPS_RCV_NO 
               ,RANK() OVER (PARTITION BY H.COP_NO ORDER BY S.VPS_RCV_DT DESC, S.VPS_RCV_NO DESC) RANK_DT 
        FROM   SCE_COP_DTL D, SCE_COP_HDR H, SCE_SVC_PTAL_VPS_IF S   --, BKG_BL_ISS O 
        WHERE  D.VSL_CD                = @[vsl_cd]   
        AND    D.SKD_VOY_NO            = @[skd_voy_no]  
        AND    D.SKD_DIR_CD            = @[skd_dir_cd]   
        AND    D.VPS_PORT_CD           = @[vps_port_cd] 
        AND    NVL(D.CLPT_IND_SEQ,'1') = NVL(@[clpt_ind_seq],'1') 
        AND    D.STND_EDI_STS_CD       = 'AEL' 
        AND    H.COP_NO                = D.COP_NO 
        AND    H.COP_STS_CD            IN ('C','T') 
        AND    S.VSL_CD                = D.VSL_CD 
        AND    S.SKD_VOY_NO            = D.SKD_VOY_NO 
        AND    S.SKD_DIR_CD            = D.SKD_DIR_CD 
        AND    S.VPS_PORT_CD           = D.VPS_PORT_CD 
        AND    S.CLPT_IND_SEQ          = D.CLPT_IND_SEQ 
        AND    S.VPS_EVNT_TP_CD        = 'ETA') A 
WHERE  A.RANK_DT = 2         
AND    (
         TO_CHAR(A.RAIL_RCV_COFF_FM_DT,'MMDD') <> TO_CHAR(A.RAIL_RCV_COFF_FM_DT+NUMTODSINTERVAL((TO_DATE(@[act_dt],'YYYY/MM/DD HH24:MI:SS')-A.VPS_EVNT_DT),'DAY'),'MMDD')
         OR TO_CHAR(A.RAIL_RCV_COFF_TO_DT,'MMDD') <> TO_CHAR(A.RAIL_RCV_COFF_TO_DT+NUMTODSINTERVAL((TO_DATE(@[act_dt],'YYYY/MM/DD HH24:MI:SS')-A.VPS_EVNT_DT),'DAY'),'MMDD')
       )
) S
WHERE S.gap IS NOT NULL			]]></sql>
			<params>
				<param name="act_dt" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="vps_port_cd" type="12" value="" out="N"/>
				<param name="clpt_ind_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
