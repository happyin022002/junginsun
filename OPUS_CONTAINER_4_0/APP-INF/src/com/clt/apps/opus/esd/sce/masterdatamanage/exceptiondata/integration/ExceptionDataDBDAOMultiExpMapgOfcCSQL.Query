<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ExceptionDataDBDAOMultiExpMapgOfcCSQL">
			<desc><![CDATA[multi exp]]></desc>
			<sql><![CDATA[
MERGE  INTO   SCE_EXPT_OFC_MAPG_INFO A
		USING  ( SELECT  @[f_ofc_cd] AS OFC_CD,  @[f_mapg_ofc_cd] AS MAPG_OFC_CD, @[f_act_flg] AS DELT_FLG
							, @[f_ibflag] AS IB_FLG ,
							(select NVL(MAX(SUBSTR(OFC_CLSS_ID,1,1))+1,1)
							FROM SCE_EXPT_OFC_MAPG_INFO   								
			 				where not exists  														
			 					(select 'X'  																
			  				FROM SCE_EXPT_OFC_MAPG_INFO  								
			  				WHERE OFC_CD = @[f_ofc_cd]         									
			  				AND   MAPG_OFC_CD = @[f_mapg_ofc_cd]   										
			 					) 
			 				) MAX_OFC_CLSS_ID    													
			 				FROM    DUAL ) B                             
		ON     (A.OFC_CD = B.OFC_CD  AND A.MAPG_OFC_CD=B.MAPG_OFC_CD)
		WHEN   MATCHED THEN                                          
       UPDATE                                                
       SET    UPD_USR_ID   = @[f_usr_id], 
              UPD_DT       = SYSDATE,                        
              DELT_FLG      = DECODE(B.IB_FLG,'D','Y', 'N')  
		WHEN   NOT MATCHED THEN                                      
		   INSERT ( OFC_CLSS_ID,                                     
		            OFC_CD,                                          
		            MAPG_OFC_CD,                                     
		            MAPG_OFC_ENG_NM,                                 
		            LOC_CD,                                          
		            CRE_USR_ID,                                      
		            CRE_DT,
					UPD_USR_ID,                                           
		            DELT_FLG)                                        
		   VALUES (B.OFC_CD||B.MAPG_OFC_CD, @[f_ofc_cd], @[f_mapg_ofc_cd], @[f_mapg_ofc_nm], @[f_loc_cd], @[f_usr_id], SYSDATE, @[f_usr_id],'N')			]]></sql>
			<params>
				<param name="f_ofc_cd" type="12" value="" out="N"/>
				<param name="f_mapg_ofc_cd" type="12" value="" out="N"/>
				<param name="f_act_flg" type="12" value="" out="N"/>
				<param name="f_ibflag" type="12" value="" out="N"/>
				<param name="f_usr_id" type="12" value="" out="N"/>
				<param name="f_mapg_ofc_nm" type="12" value="" out="N"/>
				<param name="f_loc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
