<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceAuditDBDAOSearchApPayInvMainRSQL">
			<desc><![CDATA[AP_PAY_INV 테이블 INSERT]]></desc>
			<sql><![CDATA[
SELECT DISTINCT 
      W.RGST_NO AS INV_RGST_NO
      ,'TRS' AS INV_SUB_SYS_CD
      ,W.CRE_OFC_CD AS INV_OFC_CD
      ,CASE WHEN LOC.CONTI_CD != 'M' THEN W.CRE_OFC_CD ELSE ORD.CRE_OFC_CD END COST_OFC_CD 
      ,W.INV_VNDR_SEQ AS VNDR_SEQ
      ,W.INV_NO
      ,TO_CHAR(W.INV_ISS_DT,'YYYYMMDD') AS INV_ISS_DT
      ,TO_CHAR(W.INV_RCV_DT,'YYYYMMDD') AS INV_RCV_DT
      ,(SELECT GEN_PAY_TERM_CD FROM MDM_VENDOR WHERE VNDR_SEQ = W.INV_VNDR_SEQ) VNDR_TERM_NM
      ,W.INV_CURR_CD
      ,W.INV_TTL_AMT
      ,W.INV_VAT_AMT
      ,(W.INV_TTL_AMT - W.INV_VAT_AMT) INV_NET_AMT
      ,0 WHLD_TAX_AMT
      ,'' EQ_TP_CD -- TRS는 여러가지 EQ TYPE이 하나의 Invoice로 처리 될 수 있으므로 입력 불가능
    FROM TRS_TRSP_INV_WRK W ,
      MDM_VENDOR M ,
      TRS_TRSP_SVC_ORD ORD ,
      MDM_LOCATION LOC
    WHERE W.CRE_OFC_CD = @[ofc_cd] -- Login한 Office code
      AND W.TRSP_INV_AUD_STS_CD = 'CF'
      AND NVL(W.INV_HLD_FLG , ' ') <> 'T'
      AND NVL(W.DELT_FLG , 'N') = 'N'
      AND NVL(ORD.DELT_FLG , 'N') = 'N'
      AND W.INV_VNDR_SEQ = M.VNDR_SEQ
      AND ORD.INV_NO = W.INV_NO
      AND ORD.INV_VNDR_SEQ = W.INV_VNDR_SEQ
      AND SUBSTR(ORD.TO_NOD_CD, 1, 5) = LOC.LOC_CD
      AND W.INV_NO = @[inv_no] -- 파라메터로 받음 (Confirm 한 invoice no)
			]]></sql>
			<params>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="inv_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
