<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ProductCatalogCreateDBDAOSearchPrdCnstRemarkRSQL">
			<desc><![CDATA[SearchPrdCnstRemark]]></desc>
			<sql><![CDATA[
SELECT DISTINCT 'Route : ' || POR_CD ||	 POL_CD|| 
		 DECODE(N1ST_LANE_CD, '()-', '', N1ST_LANE_CD)||
		 DECODE(N1ST_TS_PORT_CD, '-', '', N1ST_TS_PORT_CD)||
		 DECODE(N2ND_LANE_CD, '()-', '', N2ND_LANE_CD)||
		 DECODE(N2ND_TS_PORT_CD, '-', '', N2ND_TS_PORT_CD)||
		 DECODE(N3RD_LANE_CD, '()-', '', N3RD_LANE_CD)||
		 POD_NOD_CD||
		 DEL_CD ||
		 ' : ' || 
		 ' Remark(' ||ROUT_CNST_RMK||') ' || DECODE( SVC_USE_FLG , '() - ' ,'', '- SVC' || SVC_USE_FLG)  	CNST_RMK
FROM (
         SELECT POR_NOD_CD||'-' POR_CD, 
				POL_NOD_CD||'-' POL_CD, N1ST_TS_PORT_CD||'-' N1ST_TS_PORT_CD,
        		N2ND_TS_PORT_CD||'-' N2ND_TS_PORT_CD, POD_NOD_CD||'-' POD_NOD_CD,
        		DEL_NOD_CD DEL_CD, ROUT_CNST_RMK, '('||SVC_USE_FLG||')  ' SVC_USE_FLG,
        		'('||N1ST_LANE_CD||')-' N1ST_LANE_CD,
        		'('||N2ND_LANE_CD||')-' N2ND_LANE_CD,
        		'('||N3RD_LANE_CD||')-' N3RD_LANE_CD
         FROM (
				SELECT MST.PCTL_NO, R.ROUT_CNST_SEQ ROUT_CNST_SEQ, DECODE(NVL(SVC_USE_FLG, 'Y'), 'N', 'X', 'R')	ROUT_CNST_FLG
				      , ROW_NUMBER() OVER (PARTITION BY MST.PCTL_NO
				                           ORDER BY DECODE(R.TRNK_LANE_CD, 'ALL', 1, 0)
				                                  , DECODE(R.POL_NOD_CD, 'ALL', 1, 0)
				                                  , DECODE(R.POL_NOD_CD, 'ALL', 1, 0)
				                                 , R.ROUT_CNST_SEQ DESC ) RN
				      , R.*
				FROM PRD_ROUT_CNST R,PRD_PROD_CTL_QTY Q,
					(
						SELECT  M.PCTL_NO, POL_CD,
								MAX (DECODE (TS.RK, 1, TS.LANE_CD)) N1ST_LANE_CD, N1ST_TS_PORT_CD,
								MAX (DECODE (TS.RK, 2, TS.LANE_CD)) N2ND_LANE_CD, N2ND_TS_PORT_CD,
								MAX (DECODE (TS.RK, 3, TS.LANE_CD)) N3RD_LANE_CD,
								POD_CD, DEL_NOD_CD, POR_NOD_CD,
								(SELECT VSL_SLAN_CD
								FROM VSK_VSL_SKD V
								WHERE V.VSL_CD = TRNK_VSL_CD
								AND V.SKD_VOY_NO = TRNK_SKD_VOY_NO
								AND V.SKD_DIR_CD = TRNK_SKD_DIR_CD ) TRNK_LANE,
								(SELECT /*+INDEX (D XPKPRD_PROD_CTL_ROUT_DTL) */
					    				ORG_NOD_CD
								FROM PRD_PROD_CTL_ROUT_DTL D
								WHERE PCTL_NO = M.PCTL_NO
								AND PCTL_IO_BND_CD = 'I' AND NOD_LNK_DIV_CD = 'N'
                   			AND MTY_YD_FLG = 'N'
                    			AND ROWNUM = 1
								) POD_NOD
               				,MAX (DECODE (TS.RK, 1, ORG_NOD_CD )) N1ST_ORG_NOD_CD, MAX (DECODE (TS.RK, 1, DEST_NOD_CD )) N1ST_DEST_NOD_CD
               				,MAX (DECODE (TS.RK, 2, ORG_NOD_CD )) N2ND_ORG_NOD_CD, MAX (DECODE (TS.RK, 2, DEST_NOD_CD )) N2ND_DEST_NOD_CD
               				,MAX (DECODE (TS.RK, 3, ORG_NOD_CD )) N3RD_ORG_NOD_CD, MAX (DECODE (TS.RK, 3, DEST_NOD_CD )) N3RD_DEST_NOD_CD
                            ,M.DG_SPCL_FLG, M.RF_SPCL_FLG, M.SPCL_AWK_CGO_FLG, M.BB_SPCL_FLG
						FROM PRD_PROD_CTL_MST M,
							 (SELECT PCTL_NO,ORG_NOD_CD,DEST_NOD_CD,
									 RANK () OVER (PARTITION BY PCTL_NO ORDER BY PCTL_SEQ) RK, VSL_SLAN_CD LANE_CD
								FROM PRD_PROD_CTL_ROUT_DTL DTL, PRD_OCN_ROUT ROUT
							   WHERE PCTL_NO = @[prdCtlNo] 
								AND  VSL_SLAN_CD IS NOT NULL
								AND  DTL.ROUT_ORG_NOD_CD = ROUT.ORG_LOC_CD
								AND	 DTL.ROUT_DEST_NOD_CD = ROUT.DEST_LOC_CD
								AND	 DTL.ROUT_SEQ = ROUT.ROUT_SEQ
							 ) TS
						WHERE M.PCTL_NO = @[prdCtlNo]  AND M.PCTL_NO = TS.PCTL_NO(+)
						GROUP BY M.PCTL_NO, POL_CD,
								 N1ST_TS_PORT_CD,
								 N2ND_TS_PORT_CD,
								 POD_CD,
								 DEL_NOD_CD,
                                 POR_NOD_CD,
								 TRNK_VSL_CD,
								 TRNK_SKD_VOY_NO,
								 TRNK_SKD_DIR_CD,M.DG_SPCL_FLG, M.RF_SPCL_FLG, M.SPCL_AWK_CGO_FLG, M.BB_SPCL_FLG
					 ) MST
				WHERE NVL(MST.TRNK_LANE, 'ALL') = DECODE(R.TRNK_LANE_CD, 'ALL', NVL(MST.TRNK_LANE, 'ALL'), R.TRNK_LANE_CD)
				AND MST.POL_CD LIKE DECODE(R.POL_NOD_CD, 'ALL', MST.POL_CD, SUBSTR(R.POL_NOD_CD,1,5)||'%')
				AND MST.N1ST_ORG_NOD_CD LIKE DECODE(LENGTH(R.POL_NOD_CD),7,R.POL_NOD_CD, MST.N1ST_ORG_NOD_CD)
				AND MST.POD_NOD LIKE DECODE(R.POD_NOD_CD, 'ALL', MST.POD_CD, R.POD_NOD_CD) ||'%'
                AND NVL(MST.POR_NOD_CD, R.POR_NOD_CD) LIKE NVL(R.POR_NOD_CD, MST.POR_NOD_CD)||'%'
		    	AND NVL(MST.DEL_NOD_CD, R.DEL_NOD_CD) LIKE NVL(R.DEL_NOD_CD, MST.DEL_NOD_CD)||'%'
	            AND NVL(MST.N1ST_TS_PORT_CD, ' ') = NVL(R.N1ST_TS_PORT_CD, NVL(MST.N1ST_TS_PORT_CD, ' '))
				AND NVL(MST.N2ND_TS_PORT_CD, ' ') = NVL(R.N2ND_TS_PORT_CD, NVL(MST.N2ND_TS_PORT_CD, ' '))
				AND NVL(MST.N1ST_LANE_CD, ' ') = NVL(R.N1ST_LANE_CD, NVL(MST.N1ST_LANE_CD, ' '))
				AND NVL(MST.N2ND_LANE_CD, ' ') = NVL(R.N2ND_LANE_CD, NVL(MST.N2ND_LANE_CD, ' '))
				AND NVL(MST.N3RD_LANE_CD, ' ') = NVL(R.N3RD_LANE_CD, NVL(MST.N3RD_LANE_CD, ' '))
				AND NVL(DELT_FLG, 'N') <> 'Y'
                AND Q.PCTL_NO = MST.PCTL_NO
                AND Q.CNTR_TPSZ_CD LIKE NVL(R.CNTR_TP_CD,'%')||NVL(R.CNTR_SZ_CD,'%')
                AND NVL(R.SPCL_CGO_CNTR_TP_CD,'AL') = (CASE WHEN NVL(R.SPCL_CGO_CNTR_TP_CD,'AL')  ='AL' THEN NVL(R.SPCL_CGO_CNTR_TP_CD,'AL') 
                                                            WHEN NVL(MST.DG_SPCL_FLG,'N') ='Y' AND NVL(MST.RF_SPCL_FLG,'N') ='Y' THEN 'RD'
                                                            WHEN NVL(MST.DG_SPCL_FLG,'N') ='Y' AND NVL(MST.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AD'
                                                            WHEN NVL(MST.DG_SPCL_FLG,'N') ='Y' THEN 'DG'
                                                            WHEN NVL(MST.RF_SPCL_FLG,'N') ='Y' THEN 'RF'
                                                            WHEN NVL(MST.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AK'
                                                            WHEN NVL(MST.BB_SPCL_FLG,'N') ='Y' THEN 'BB'
                                                            WHEN NVL(MST.DG_SPCL_FLG,'N') ='N' AND NVL(MST.RF_SPCL_FLG,'N') ='N' AND NVL(MST.SPCL_AWK_CGO_FLG,'N') ='N' AND NVL(MST.BB_SPCL_FLG,'N') ='N'  THEN 'GP'
                                                        END)
	    )
	  WHERE RN = 1
      )
WHERE @[cnstFlg] IN ('A','X','O','P','R',@[cnstFlg])
AND NVL(@[org_nod_cd], 'X') = 'X'

UNION ALL

SELECT 	DISTINCT 'Link : (' || 
    	LNK_ORG_NOD_CD || ' - ' ||	
    	LNK_DEST_NOD_CD	|| ') : ' || 
    	' ITEM' ||PCTL_CNST_ITM_NM || 
    	DECODE( CNTR_TP_CD , '() - ' ,'', ' CNTR TYPE' || CNTR_TP_CD) || 
    	DECODE( CMDT_CD , '() - ' ,'', ' CMDT' || CMDT_CD) ||  
    	DECODE( LNK_CNST_RMK , '() - ' ,'', ' Remark' || LNK_CNST_RMK) || 
    	DECODE( SVC_USE_FLG , '()  ' ,'', ' SVC' || SVC_USE_FLG)  CNST_RMK 
FROM 	( 
    	SELECT  C.LNK_ORG_NOD_CD LNK_ORG_NOD_CD ,   
    			C.LNK_DEST_NOD_CD LNK_DEST_NOD_CD,	
    			'('||PCTL_CNST_ITM_NM ||') - ' PCTL_CNST_ITM_NM, 
    			'(' ||	C.CNTR_TP_CD || ') - ' CNTR_TP_CD , 
    			'(' ||C.CMDT_CD||	') - ' CMDT_CD, 
    			'(' ||C.LNK_CNST_RMK||	') - ' LNK_CNST_RMK, 
    			'('||SVC_USE_FLG||')  ' SVC_USE_FLG	
    	FROM 	PRD_LNK_CNST_MGMT 					C
			, 	PRD_PROD_CTL_ROUT_DTL 				D
			, 	PRD_PROD_CTL_QTY 					Q
			,	PRD_PROD_CTL_MST 					M		
    	WHERE 	D.PCTL_NO 							= @[prdCtlNo]	
    	AND 	M.PCTL_NO 							= D.PCTL_NO													
    	AND 	D.NOD_LNK_DIV_CD 					= 'L'	
    	AND 	D.PCTL_NO 							= Q.PCTL_NO 
		AND 	D.ORG_NOD_CD 						LIKE @[org_nod_cd]||'%' 
		AND 	D.DEST_NOD_CD 						LIKE @[dest_nod_cd]||'%'

		 -- :2016-12-16-FRI: -------------------------------------------------------------------------------
	     AND 	D.ORG_NOD_CD 						LIKE C.LNK_ORG_NOD_CD ||'%'
	     AND 	D.DEST_NOD_CD 						LIKE C.LNK_DEST_NOD_CD||'%'	 
	
		 ----AND		CASE 	WHEN NVL(C.LNK_ORG_NOD_CD,'ALL') = 'ALL' THEN 'ALL'
		----					WHEN NVL(C.LNK_ORG_NOD_CD,'ALL') <>'ALL' THEN C.LNK_ORG_NOD_CD
		----					ELSE '*'
		----			END                 			= CASE	WHEN NVL(C.LNK_ORG_NOD_CD,'ALL') = 'ALL' THEN 'ALL'
	    ----     												WHEN NVL(C.LNK_ORG_NOD_CD,'ALL') <>'ALL' THEN SUBSTR(D.ORG_NOD_CD,1,LENGTH(C.LNK_ORG_NOD_CD))
	    ----     												ELSE '**'
	    ----											  END
		---- AND		CASE 	WHEN NVL(C.LNK_DEST_NOD_CD,'ALL') = 'ALL' THEN 'ALL'
		----					WHEN NVL(C.LNK_DEST_NOD_CD,'ALL') <>'ALL' THEN C.LNK_DEST_NOD_CD
		----					ELSE '*'
		----			END                 			= CASE 	WHEN NVL(C.LNK_DEST_NOD_CD,'ALL') = 'ALL' THEN 'ALL'
	    ----     												WHEN NVL(C.LNK_DEST_NOD_CD,'ALL') <>'ALL' THEN SUBSTR(D.DEST_NOD_CD,1,LENGTH(C.LNK_DEST_NOD_CD))
	    ----     												ELSE '**'
	    ----											  END   
		 -----------------------------------------------------------------------------------------------------

    	AND 	D.TRSP_MOD_CD 						= DECODE(C.TRSP_MOD_CD, 'AL' ,D.TRSP_MOD_CD, C.TRSP_MOD_CD ) 	
		AND 	NVL(M.CMDT_CD	,'X')  				= NVL(C.CMDT_CD, NVL(M.CMDT_CD,'X')) 	
		AND 	NVL(C.DELT_FLG	,'N') 				= 'N'	
    	AND 	NVL(C.SPCL_CGO_CNTR_TP_CD,'AL') 	= (CASE WHEN NVL(C.SPCL_CGO_CNTR_TP_CD,'AL') ='AL' THEN NVL(C.SPCL_CGO_CNTR_TP_CD,'AL')
                                                			WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' AND NVL(M.RF_SPCL_FLG,'N') ='Y' THEN 'RD'
                                                			WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' AND NVL(M.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AD'
                                                			WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' THEN 'DG'
                                                			WHEN NVL(M.RF_SPCL_FLG,'N') ='Y' THEN 'RF'
                                                			WHEN NVL(M.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AK'
                                                			WHEN NVL(M.BB_SPCL_FLG,'N') ='Y' THEN 'BB'
                                                			WHEN NVL(M.DG_SPCL_FLG,'N') ='N' AND NVL(M.RF_SPCL_FLG,'N') ='N' AND NVL(M.SPCL_AWK_CGO_FLG,'N') ='N' AND NVL(M.BB_SPCL_FLG,'N') ='N'  THEN 'GP'
                                           			   END)
    	AND 	Q.CNTR_TPSZ_CD 						LIKE NVL(C.CNTR_TP_CD,'%')||NVL(C.CNTR_SZ_CD,'%')
    	AND 	(	   
            		(   
                	TRUNC(TO_DATE(NVL(C.EFF_FM_DT,'19000101'),'yyyy/mm/dd hh24:mi:ss')) <= D.ARR_ST_DT 
					AND   
                	D.ARR_ST_DT < TRUNC(TO_DATE(NVL(C.EFF_TO_DT,'25000101'),'yyyy/mm/dd hh24:mi:ss')+1)   
            		) 
					OR   
            		(   
                	TRUNC(TO_DATE(NVL(C.EFF_FM_DT,'19000101'),'yyyy/mm/dd hh24:mi:ss')) <= D.DEP_FSH_DT 
					AND   
                	D.DEP_FSH_DT < TRUNC(TO_DATE(NVL(C.EFF_TO_DT,'25000101'),'yyyy/mm/dd hh24:mi:ss')+1)   
            		)   
         		)					
    	AND 	NVL(D.CNST_FLG, 'Z') IN ('L', 'X')	
)  
WHERE 	@[cnstFlg] IN ('A','X','O','I','L',@[cnstFlg]) 

UNION ALL

SELECT DISTINCT 'Location (' ||	
		NOD_CD || DECODE(PORT_PNT_CD, 'ALL', '', ' : '||DECODE(PORT_PNT_CD,'TS','T/S',PORT_PNT_CD)) || 
		') - ITEM' ||PCTL_CNST_ITM_NM || 
		DECODE( CNTR_TP_CD , '() - ' ,'', ' CNTR TYPE' || CNTR_TP_CD) || 
		DECODE( CMDT_CD , '() - ' ,'', ' CMDT' || CMDT_CD) || 
		DECODE( NOD_CNST_RMK , '() - ' ,'', ' Remark' || NOD_CNST_RMK) || 
		DECODE( SVC_USE_FLG , '()  ' ,'', ' SVC' || SVC_USE_FLG)   CNST_RMK 
FROM ( 
    SELECT  C.NOD_CD NOD_CD , 
    		'('||C.PCTL_CNST_ITM_NM ||') - ' PCTL_CNST_ITM_NM, 	
    		'(' ||	C.CNTR_TP_CD||C.CNTR_SZ_CD || ') - ' CNTR_TP_CD, 
    		'(' ||	C.CMDT_CD || ') - ' CMDT_CD, 
    		'(' ||	C.NOD_CNST_RMK || ') - ' NOD_CNST_RMK, 
    		'('||SVC_USE_FLG||')  ' SVC_USE_FLG	
			,D.PCTL_NO 
			,C.PORT_PNT_CD, D.PCTL_SEQ 
    FROM PRD_NOD_CNST_MGMT C, PRD_PROD_CTL_QTY Q,PRD_PROD_CTL_MST M , PRD_PROD_CTL_ROUT_DTL D		
    WHERE M.PCTL_NO = @[prdCtlNo]	
     AND M.PCTL_NO = D.PCTL_NO  
     AND D.PCTL_NO = Q.PCTL_NO
     AND D.ORG_NOD_CD LIKE @[nod_cd]||'%'
     AND D.NOD_LNK_DIV_CD = 'N'	
     AND D.ORG_NOD_CD LIKE DECODE(C.NOD_CD, 'ALL','%',C.NOD_CD||'%')
     AND NVL(M.CMDT_CD,'X')  = NVL(C.CMDT_CD, NVL(M.CMDT_CD,'X'))																 
     AND NVL(C.DELT_FLG, 'N') <> 'Y'															  		 
     AND NVL(C.SPCL_CGO_CNTR_TP_CD,'AL') = (CASE WHEN NVL(C.SPCL_CGO_CNTR_TP_CD,'AL') ='AL' THEN NVL(C.SPCL_CGO_CNTR_TP_CD,'AL')
                                                 WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' AND NVL(M.RF_SPCL_FLG,'N') ='Y' THEN 'RD'
                                                 WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' AND NVL(M.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AD'
                                                 WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' THEN 'DG'
                                                 WHEN NVL(M.RF_SPCL_FLG,'N') ='Y' THEN 'RF'
                                                 WHEN NVL(M.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AK'
                                                 WHEN NVL(M.BB_SPCL_FLG,'N') ='Y' THEN 'BB'
                                                 WHEN NVL(M.DG_SPCL_FLG,'N') ='N' AND NVL(M.RF_SPCL_FLG,'N') ='N' AND NVL(M.SPCL_AWK_CGO_FLG,'N') ='N' AND NVL(M.BB_SPCL_FLG,'N') ='N'  THEN 'GP'
                                             END)
     AND Q.CNTR_TPSZ_CD LIKE NVL(C.CNTR_TP_CD,'%')||NVL(C.CNTR_SZ_CD,'%')
     AND NVL(C.VSL_SLAN_CD,'ALL') = (CASE WHEN NVL(C.VSL_SLAN_CD,'ALL') = 'ALL' THEN NVL(C.VSL_SLAN_CD,'ALL')
                                          WHEN C.PORT_PNT_CD IN ('POR','POL') THEN (SELECT N1ST_LANE_CD
                                                                                      FROM PRD_OCN_ROUT O
                                                                                     WHERE (ORG_LOC_CD, DEST_LOC_CD, ROUT_SEQ ) 
                                                                                           = (SELECT DX.ROUT_ORG_NOD_CD, DX.ROUT_DEST_NOD_CD, DX.ROUT_SEQ
                                                                                                FROM PRD_PROD_CTL_ROUT_DTL DX
                                                                                               WHERE DX.PCTL_NO = D.PCTL_NO
                                                                                                 AND DX.PCTL_IO_BND_CD ='T'
                                                                                                 AND ROWNUM =1) )
                                          WHEN C.PORT_PNT_CD IN ('POD','DEL') THEN ( SELECT SUBSTR(TRIM(N1ST_LANE_CD||N2ND_LANE_CD||N3RD_LANE_CD||N4TH_LANE_CD),-3)
                                                                                       FROM PRD_OCN_ROUT O
                                                                                      WHERE (ORG_LOC_CD, DEST_LOC_CD, ROUT_SEQ ) 
                                                                                           = (SELECT DX.ROUT_ORG_NOD_CD, DX.ROUT_DEST_NOD_CD, DX.ROUT_SEQ
                                                                                                FROM PRD_PROD_CTL_ROUT_DTL DX
                                                                                               WHERE DX.PCTL_NO = D.PCTL_NO
                                                                                                 AND DX.PCTL_IO_BND_CD ='T'
                                                                                                 AND ROWNUM =1) )    
                                          WHEN C.PORT_PNT_CD IN ('ALL','TS') THEN (SELECT C.VSL_SLAN_CD
                                                                                     FROM PRD_OCN_ROUT O
                                                                                    WHERE (ORG_LOC_CD, DEST_LOC_CD, ROUT_SEQ ) 
                                                                                           = (SELECT DX.ROUT_ORG_NOD_CD, DX.ROUT_DEST_NOD_CD, DX.ROUT_SEQ
                                                                                                FROM PRD_PROD_CTL_ROUT_DTL DX
                                                                                               WHERE DX.PCTL_NO = D.PCTL_NO
                                                                                                 AND DX.PCTL_IO_BND_CD ='T'
                                                                                                 AND ROWNUM =1) 
                                                                                      AND C.VSL_SLAN_CD IN ( N1ST_LANE_CD,N2ND_LANE_CD,N3RD_LANE_CD,N4TH_LANE_CD))
                                      END)
     AND (																								 
            (																							 
                TRUNC(TO_DATE(NVL(C.EFF_FM_DT,'19000101'),'yyyy/mm/dd hh24:mi:ss')) <= D.ARR_ST_DT AND	 
                D.ARR_ST_DT < TRUNC(TO_DATE(NVL(C.EFF_TO_DT,'25000101'),'yyyy/mm/dd hh24:mi:ss')+1)		 
            ) OR																						 
            (																							 
                TRUNC(TO_DATE(NVL(C.EFF_FM_DT,'19000101'),'yyyy/mm/dd hh24:mi:ss')) <= D.DEP_FSH_DT AND	 
                D.DEP_FSH_DT < TRUNC(TO_DATE(NVL(C.EFF_TO_DT,'25000101'),'yyyy/mm/dd hh24:mi:ss')+1)	 
            )																							 
        ) 	

 ) CC 
WHERE NVL(CC.port_pnt_cd, 'ALL') = 'ALL' OR
                                            CC.port_pnt_cd IN (
                                                (SELECT CASE
                                                    WHEN PCTL_SEQ  = (SELECT  MIN(PCTL_SEQ) FROM PRD_PROD_CTL_ROUT_DTL
                                                        WHERE  PCTL_NO = DD.pctl_no
                                                        AND PCTL_IO_BND_CD = 'O'
                                                        AND NOD_LNK_DIV_CD = 'N'
                                                        AND MTY_YD_FLG = 'N'  ) THEN 'POR'
                                                    END
                                                FROM PRD_PROD_CTL_ROUT_DTL DD
                                                WHERE DD.pctl_no = CC.pctl_no
                                                AND Dd.NOD_LNK_DIV_CD = 'N'
                                                and dd.PCTL_SEQ = cc.PCTL_SEQ
                                                AND (DD.ORG_NOD_CD LIKE CC.NOD_CD||'%')
                                                ),
                                                (SELECT CASE
                                                    WHEN PCTL_SEQ  = (SELECT  MAX(PCTL_SEQ) FROM PRD_PROD_CTL_ROUT_DTL
                                                        WHERE  PCTL_NO = DD.pctl_no
                                                        AND PCTL_IO_BND_CD = 'O'
                                                        AND NOD_LNK_DIV_CD = 'N'
                                                        AND MTY_YD_FLG = 'N'  ) THEN 'POL'
                                                    END
                                                FROM PRD_PROD_CTL_ROUT_DTL DD
                                                WHERE DD.pctl_no = CC.pctl_no
                                                AND Dd.NOD_LNK_DIV_CD = 'N'
                                                and dd.PCTL_SEQ = cc.PCTL_SEQ
                                                AND (DD.ORG_NOD_CD LIKE CC.NOD_CD||'%')
                                                ),                                             
                                                (SELECT CASE
                                                    WHEN PCTL_SEQ  IN (SELECT  PCTL_SEQ FROM PRD_PROD_CTL_ROUT_DTL
                                                        WHERE  PCTL_NO = DD.pctl_no
                                                        AND PCTL_IO_BND_CD = 'T'
                                                        AND NOD_LNK_DIV_CD = 'N'  ) THEN 'TS'
                                                    END
                                                FROM PRD_PROD_CTL_ROUT_DTL DD
                                                WHERE DD.pctl_no = CC.pctl_no
                                                AND Dd.NOD_LNK_DIV_CD = 'N'
                                                and dd.PCTL_SEQ = cc.PCTL_SEQ
                                                AND (DD.ORG_NOD_CD LIKE CC.NOD_CD||'%')
                                                ),                                                
                                                (SELECT CASE
                                                    WHEN PCTL_SEQ  = (SELECT  MIN(PCTL_SEQ) FROM PRD_PROD_CTL_ROUT_DTL
                                                        WHERE  PCTL_NO = DD.pctl_no
                                                        AND PCTL_IO_BND_CD = 'I'
                                                        AND NOD_LNK_DIV_CD = 'N'
                                                        AND MTY_YD_FLG = 'N'  ) THEN 'POD'
                                                    END
                                                FROM PRD_PROD_CTL_ROUT_DTL DD
                                                WHERE DD.pctl_no = CC.pctl_no
                                                AND Dd.NOD_LNK_DIV_CD = 'N'
                                                and dd.PCTL_SEQ = cc.PCTL_SEQ
                                                AND (DD.ORG_NOD_CD LIKE CC.NOD_CD||'%')
                                                ),
                                                (SELECT CASE
                                                    WHEN PCTL_SEQ  = (SELECT  MAX(PCTL_SEQ) FROM PRD_PROD_CTL_ROUT_DTL
                                                        WHERE  PCTL_NO = DD.pctl_no
                                                        AND PCTL_IO_BND_CD = 'I'
                                                        AND NOD_LNK_DIV_CD = 'N'
                                                        AND MTY_YD_FLG = 'N'  ) THEN 'DEL'
                                                    END
                                                FROM PRD_PROD_CTL_ROUT_DTL DD
                                                WHERE DD.pctl_no = CC.pctl_no
                                                AND Dd.NOD_LNK_DIV_CD = 'N'
                                                and dd.PCTL_SEQ = cc.PCTL_SEQ
                                                AND (DD.ORG_NOD_CD LIKE CC.NOD_CD||'%')
                                                )
                                            )
AND @[cnstFlg] IN ('A','X','P','I','N',@[cnstFlg])
UNION ALL
SELECT 'Hub Loc :'||C.PORT_CD||'(PORT)-'||C.CNST_LANE_CD ||'(LANE)-'||C.HUB_LOC_CD||'(HUB)-'||C.NOD_CD||'(LOC) Remark('||HUB_LOC_CNST_RMK||')- SVC('||SVC_USE_FLG||')'
FROM PRD_HUB_LOC_CNST_MGMT C, PRD_PROD_CTL_MST M,PRD_PROD_CTL_ROUT_DTL D, PRD_PROD_CTL_QTY Q
WHERE C.PORT_CD  = DECODE(D.PCTL_IO_BND_CD,'I',SUBSTR(D.ROUT_ORG_NOD_CD,1,5),'O',SUBSTR(D.ROUT_DEST_NOD_CD,1,5)) 
AND C.HUB_LOC_CD = NVL((SELECT HUB_LOC_CD 
                         FROM PRD_INLND_ROUT_MST H
                        WHERE H.ROUT_ORG_NOD_CD = D.ROUT_ORG_NOD_CD
                          AND H.ROUT_DEST_NOD_CD = D.ROUT_DEST_NOD_CD
                          AND H.ROUT_SEQ = D.ROUT_SEQ),C.PORT_CD)
AND C.HUB_LOC_CD = SUBSTR(D.ORG_NOD_CD,1,5)
AND C.NOD_CD=DECODE(C.NOD_CD,'ALL',C.NOD_CD,DECODE(D.PCTL_IO_BND_CD,'I',SUBSTR(D.ROUT_DEST_NOD_CD,1,LENGTH(TRIM(C.NOD_CD))),'O',SUBSTR(D.ROUT_ORG_NOD_CD,1,LENGTH(TRIM(C.NOD_CD)))))
AND C.IO_BND_CD= DECODE(C.IO_BND_CD,'B',C.IO_BND_CD,D.PCTL_IO_BND_CD)
AND D.PCTL_IO_BND_CD <> 'T'
AND M.PCTL_NO = D.PCTL_NO
AND M.PCTL_NO = Q.PCTL_NO
AND Q.CNTR_TPSZ_CD LIKE NVL(C.CNTR_TP_CD,'%')||NVL(C.CNTR_SZ_CD,'%')
AND D.ORG_NOD_CD LIKE @[nod_cd]||'%'
AND C.CNST_LANE_CD = (CASE WHEN C.CNST_LANE_CD = 'ALL' THEN C.CNST_LANE_CD
                            ELSE (SELECT DECODE(D.PCTL_IO_BND_CD,'O',SUBSTR(TRIM(O.N1ST_LANE_CD||O.N2ND_LANE_CD||O.N3RD_LANE_CD||O.N4TH_LANE_CD),1,3)
                                                                  ,'I',SUBSTR(TRIM(O.N1ST_LANE_CD||O.N2ND_LANE_CD||O.N3RD_LANE_CD||O.N4TH_LANE_CD),-3)) 
                                    FROM PRD_OCN_ROUT O, PRD_PROD_CTL_ROUT_DTL DX
                                    WHERE O.ORG_LOC_CD = DX.ROUT_ORG_NOD_CD
                                    AND O.DEST_LOC_CD = DX.ROUT_DEST_NOD_CD
                                    AND O.ROUT_SEQ = DX.ROUT_SEQ
                                    AND DX.PCTL_NO = D.PCTL_NO
                                    AND DX.PCTL_IO_BND_CD ='T'
                                    AND ROWNUM = 1
									)
                      END)
AND NVL(C.SPCL_CGO_CNTR_TP_CD,'AL') = (CASE WHEN NVL(C.SPCL_CGO_CNTR_TP_CD,'AL') ='AL' THEN NVL(C.SPCL_CGO_CNTR_TP_CD,'AL')
                                            WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' AND NVL(M.RF_SPCL_FLG,'N') ='Y' THEN 'RD'
                                            WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' AND NVL(M.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AD'
                                            WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' THEN 'DG'
                                            WHEN NVL(M.RF_SPCL_FLG,'N') ='Y' THEN 'RF'
                                            WHEN NVL(M.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AK'
                                            WHEN NVL(M.BB_SPCL_FLG,'N') ='Y' THEN 'BB'
                                            WHEN NVL(M.DG_SPCL_FLG,'N') ='N' AND NVL(M.RF_SPCL_FLG,'N') ='N' AND NVL(M.SPCL_AWK_CGO_FLG,'N') ='N' AND NVL(M.BB_SPCL_FLG,'N') ='N'  THEN 'GP'
                                        END)
AND NVL(C.DIR_CD,'A') = (CASE WHEN NVL(C.DIR_CD,'A') = 'A' THEN NVL(C.DIR_CD,'A')
                              WHEN C.IO_BND_CD ='O' THEN  ( SELECT /*+ INDEX_ASC (DT XPKPRD_PROD_CTL_ROUT_DTL) */  SKD_DIR_CD 
                                                              FROM PRD_PROD_CTL_ROUT_DTL DT
                                                             WHERE PCTL_IO_BND_CD ='T'
                                                               AND PCTL_NO =M.PCTL_NO
                                                               AND ROWNUM = 1 ) 
                              WHEN C.IO_BND_CD ='I' THEN  ( SELECT /*+ INDEX_DESC (DT XPKPRD_PROD_CTL_ROUT_DTL) */  SKD_DIR_CD 
                                                              FROM PRD_PROD_CTL_ROUT_DTL DT
                                                             WHERE PCTL_IO_BND_CD ='T'
                                                               AND PCTL_NO =M.PCTL_NO
                                                               AND ROWNUM = 1 ) 
                              WHEN C.IO_BND_CD ='B' AND ( M.POR_CD = SUBSTR(C.NOD_CD,1,5) OR M.POL_CD = C.PORT_CD )   
                                                    THEN  ( SELECT /*+ INDEX_ASC (DT XPKPRD_PROD_CTL_ROUT_DTL) */  SKD_DIR_CD 
                                                              FROM PRD_PROD_CTL_ROUT_DTL DT
                                                             WHERE PCTL_IO_BND_CD ='T'
                                                               AND PCTL_NO =M.PCTL_NO
                                                               AND ROWNUM = 1 )                               
                              WHEN C.IO_BND_CD ='B' AND ( M.DEL_CD = SUBSTR(C.NOD_CD,1,5) OR M.POD_CD = C.PORT_CD )   
                                                    THEN  ( SELECT /*+ INDEX_DESC (DT XPKPRD_PROD_CTL_ROUT_DTL) */  SKD_DIR_CD 
                                                              FROM PRD_PROD_CTL_ROUT_DTL DT
                                                             WHERE PCTL_IO_BND_CD ='T'
                                                               AND PCTL_NO =M.PCTL_NO
                                                               AND ROWNUM = 1 ) 
                           END)
AND DECODE(C.NOD_CD,'ALL',1000,0) + DECODE(C.IO_BND_CD,'B',100,0) + DECODE(C.CNST_LANE_CD,'ALL',10,0) + DECODE(C.SPCL_CGO_CNTR_TP_CD,'AL',1,0) 
 = (SELECT MIN(DECODE(C2.NOD_CD,'ALL',1000,0) + DECODE(C2.IO_BND_CD,'B',100,0) + DECODE(C2.CNST_LANE_CD,'ALL',10,0) + DECODE(C2.SPCL_CGO_CNTR_TP_CD,'AL',1,0) )
     FROM PRD_HUB_LOC_CNST_MGMT C2
    WHERE C2.PORT_CD = C.PORT_CD
      AND C2.HUB_LOC_CD = C.HUB_LOC_CD
      AND C2.NOD_CD= DECODE(C2.NOD_CD,'ALL',C2.NOD_CD,DECODE(D.PCTL_IO_BND_CD,'I',SUBSTR(D.ROUT_DEST_NOD_CD,1,LENGTH(TRIM(C2.NOD_CD))),'O',SUBSTR(D.ROUT_ORG_NOD_CD,1,LENGTH(TRIM(C2.NOD_CD))))) 
      AND C2.IO_BND_CD =DECODE(C2.IO_BND_CD,'B',C2.IO_BND_CD,'ALL',C2.IO_BND_CD,D.PCTL_IO_BND_CD)
      AND C2.CNST_LANE_CD = (CASE WHEN C2.CNST_LANE_CD = 'ALL' THEN C2.CNST_LANE_CD
                                    ELSE (SELECT DECODE(D.PCTL_IO_BND_CD,'O',SUBSTR(TRIM(N1ST_LANE_CD||N2ND_LANE_CD||N3RD_LANE_CD||N4TH_LANE_CD),1,3)
                                                                        ,'I',SUBSTR(TRIM(N1ST_LANE_CD||N2ND_LANE_CD||N3RD_LANE_CD||N4TH_LANE_CD),-3)) 
                                    		FROM PRD_OCN_ROUT O, PRD_PROD_CTL_ROUT_DTL DX
                                    		WHERE O.ORG_LOC_CD = DX.ROUT_ORG_NOD_CD
                                    			AND O.DEST_LOC_CD = DX.ROUT_DEST_NOD_CD
                                    			AND O.ROUT_SEQ = DX.ROUT_SEQ
                                    			AND DX.PCTL_NO = D.PCTL_NO
                                    			AND DX.PCTL_IO_BND_CD ='T'
                                    			AND ROWNUM = 1
                                          )
                                END)
      AND NVL(C2.SPCL_CGO_CNTR_TP_CD,'AL') = (CASE WHEN NVL(C2.SPCL_CGO_CNTR_TP_CD,'AL') ='AL' THEN NVL(C2.SPCL_CGO_CNTR_TP_CD,'AL')
                                                   WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' AND NVL(M.RF_SPCL_FLG,'N') ='Y' THEN 'RD'
                                                   WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' AND NVL(M.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AD'
                                                   WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' THEN 'DG'
                                                   WHEN NVL(M.RF_SPCL_FLG,'N') ='Y' THEN 'RF'
                                                   WHEN NVL(M.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AK'
                                                   WHEN NVL(M.BB_SPCL_FLG,'N') ='Y' THEN 'BB'
                                                   WHEN NVL(M.DG_SPCL_FLG,'N') ='N' AND NVL(M.RF_SPCL_FLG,'N') ='N' AND NVL(M.SPCL_AWK_CGO_FLG,'N') ='N' AND NVL(M.BB_SPCL_FLG,'N') ='N'  THEN 'GP'
                                               END) 
      )
AND D.NOD_LNK_DIV_CD = 'N'  
AND D.PCTL_NO= @[prdCtlNo]
AND D.MTY_YD_FLG = 'N'			]]></sql>
			<params>
				<param name="prdCtlNo" type="12" value="" out="N"/>
				<param name="cnstFlg" type="12" value="" out="N"/>
				<param name="org_nod_cd" type="12" value="" out="N"/>
				<param name="dest_nod_cd" type="12" value="" out="N"/>
				<param name="nod_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
