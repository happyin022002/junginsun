<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RailSoManageDBDAOSearch04RailSoManageRSQL">
			<desc><![CDATA[IRG ADJUST  MAIN 조회 SQL]]></desc>
			<sql><![CDATA[
#set(${lnk_org_nod_cd}=${lnk_org_nod_cd})
#set(${lnk_dest_nod_cd}=${lnk_dest_nod_cd})
#set(${cgo_tp_cd}=${cgo_tp_cd})
#set(${rout_org_nod_cd}=${rout_org_nod_cd})
#set(${rout_dest_nod_cd}=${rout_dest_nod_cd})
#set(${rout_seq}=${rout_seq})
#set(${trsp_bnd_cd}=${trsp_bnd_cd})
#set(${bkg_rcvde_term_cd}=${bkg_rcvde_term_cd})
#set(${key_org}=${key_org})
#set(${key_dest}=${key_dest})
#set(${arr_size}=${arr_size})

#if(${empty_yn} == 'M')	
#foreach(${key} IN ${arr_size})
#if($velocityCount == 1)	
SELECT 
	'CY' BKG_RCVDE_TERM_CD,
	${lnk_org_nod_cd.get($key)} KEY_ORG ,
	${lnk_dest_nod_cd.get($key)} KEY_DEST,
	${cgo_tp_cd.get($key)} CGO_TP_CD,
	SUBSTR(${lnk_org_nod_cd.get($key)}, 1, 5) FM_NOD_CD,
	SUBSTR(${lnk_org_nod_cd.get($key)}, 6) FM_NOD_YARD,
	SUBSTR(${lnk_dest_nod_cd.get($key)}, 1, 5) TO_NOD_CD,
	SUBSTR(${lnk_dest_nod_cd.get($key)}, 6) TO_NOD_YARD,
	A.PRIO_SEQ,
	A.INLND_ROUT_RMK INLND_ROUT_RMK,
	${lnk_org_nod_cd.get($key)} FROM_NODE,
	${lnk_dest_nod_cd.get($key)} TO_NODE,
	A.ROUT_PLN_CD ROUT_PLN_CD,
	A.ROUT_ORG_NOD_CD,
	A.ROUT_DEST_NOD_CD,
	A.ROUT_SEQ,
	A.ROUT_ORG_NOD_CD ROUT_ORG_SET,
	A.ROUT_DEST_NOD_CD ROUT_DEST_SET,
	A.ROUT_SEQ ROUT_SEQ_SET,
	MAX( A.INLND_ROUT_INV_BIL_PATT_CD) RAIL_CMB_THRU_TP_CD,
	MAX( DECODE( B.ROUT_DTL_SEQ, 1, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
	MAX( DECODE( B.ROUT_DTL_SEQ, 2, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
	MAX( DECODE( B.ROUT_DTL_SEQ, 3, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
	MAX( DECODE( B.ROUT_DTL_SEQ, 4, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
	MAX( DECODE( B.ROUT_DTL_SEQ, 5, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
	MAX( DECODE( B.ROUT_DTL_SEQ, 6, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
	MAX( DECODE( B.ROUT_DTL_SEQ, 7, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
	MAX( DECODE( B.ROUT_DTL_SEQ, 8, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )IRG,
	MAX(DECODE( B.ROUT_DTL_SEQ, 1, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 1 , '', ' / ') )) ||
	MAX(DECODE( B.ROUT_DTL_SEQ, 2, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 2 , '', ' / ') )) ||
	MAX(DECODE( B.ROUT_DTL_SEQ, 3, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 3 , '', ' / ') )) ||
	MAX(DECODE( B.ROUT_DTL_SEQ, 4, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 4 , '', ' / ') )) ||
	MAX(DECODE( B.ROUT_DTL_SEQ, 5, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 5 , '', ' / ') )) ||
	MAX(DECODE( B.ROUT_DTL_SEQ, 6, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 6 , '', ' / ') )) ||
	MAX(DECODE( B.ROUT_DTL_SEQ, 7, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 7 , '', ' / ') )) ||
	MAX(DECODE( B.ROUT_DTL_SEQ, 8, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 8 , '', ' / ') )) REF_NO ,
	'' IRG_DROPDOWNLIST
FROM 
		PRD_INLND_ROUT_MST A,
	  PRD_INLND_ROUT_DTL B,
	  MDM_VENDOR C,
	  TRS_AGMT_HDR AGMT,
	  (
	    SELECT 
			    	A.ROUT_ORG_NOD_CD,
			      A.ROUT_DEST_NOD_CD,
			      A.ROUT_SEQ,
			      C.MIN_SEQ MIN_SEQ,
			      ROUT_DTL_SEQ MAX_SEQ
	    FROM 
	    	PRD_INLND_ROUT_DTL A,
	      (
	        SELECT 
			        	ROUT_ORG_NOD_CD,
			          ROUT_DEST_NOD_CD,
			          ROUT_SEQ,
			          ROUT_DTL_SEQ MIN_SEQ
	        FROM 
	        	PRD_INLND_ROUT_DTL
	        WHERE LNK_ORG_NOD_CD = ${lnk_org_nod_cd.get($key)}
	        AND 	ROUT_ORG_NOD_CD = ${rout_org_nod_cd.get($key)}
	        AND 	ROUT_DEST_NOD_CD = ${rout_dest_nod_cd.get($key)}
	        AND 	ROUT_SEQ = ${rout_seq.get($key)}
	        AND 	TRSP_MOD_CD='RD' 
	      ) C
	    WHERE LNK_DEST_NOD_CD = ${lnk_dest_nod_cd.get($key)}
	    AND 	A.ROUT_ORG_NOD_CD = C.ROUT_ORG_NOD_CD
	    AND 	A.ROUT_DEST_NOD_CD = C.ROUT_DEST_NOD_CD
	    AND 	A.ROUT_SEQ = C.ROUT_SEQ
	    AND 	TRSP_MOD_CD='RD' 
	   ) D
WHERE A.ROUT_ORG_NOD_CD = B.ROUT_ORG_NOD_CD
AND 	A.ROUT_DEST_NOD_CD = B.ROUT_DEST_NOD_CD
AND 	A.ROUT_SEQ = B.ROUT_SEQ
AND 	B.TRSP_AGMT_OFC_CTY_CD = AGMT.TRSP_AGMT_OFC_CTY_CD(+)
AND 	B.TRSP_AGMT_SEQ =AGMT.TRSP_AGMT_SEQ(+)
AND 	NVL(A.DELT_FLG, 'N') <> 'Y'
AND 	B.TRSP_MOD_CD='RD'
AND 	B.VNDR_SEQ = C.VNDR_SEQ
AND 	B.ROUT_ORG_NOD_CD = D.ROUT_ORG_NOD_CD
AND 	B.ROUT_DEST_NOD_CD = D.ROUT_DEST_NOD_CD
AND 	B.ROUT_SEQ = D.ROUT_SEQ
AND 	B.ROUT_DTL_SEQ >= D.MIN_SEQ
AND 	B.ROUT_DTL_SEQ <= D.MAX_SEQ
GROUP BY A.PRIO_SEQ, A.INLND_ROUT_RMK, A.ROUT_PLN_CD, A.ROUT_ORG_NOD_CD, A.ROUT_DEST_NOD_CD, A.ROUT_SEQ, B.TRSP_MOD_CD

#else	
UNION
SELECT 
	'CY' BKG_RCVDE_TERM_CD,
	${lnk_org_nod_cd.get($key)} KEY_ORG ,
	${lnk_dest_nod_cd.get($key)} KEY_DEST,
	${cgo_tp_cd.get($key)} CGO_TP_CD,
	SUBSTR(${lnk_org_nod_cd.get($key)}, 1, 5) FM_NOD_CD,
	SUBSTR(${lnk_org_nod_cd.get($key)}, 6) FM_NOD_YARD,
	SUBSTR(${lnk_dest_nod_cd.get($key)}, 1, 5) TO_NOD_CD,
	SUBSTR(${lnk_dest_nod_cd.get($key)}, 6) TO_NOD_YARD,
	A.PRIO_SEQ,
	A.INLND_ROUT_RMK INLND_ROUT_RMK,
	${lnk_org_nod_cd.get($key)} FROM_NODE,
	${lnk_dest_nod_cd.get($key)} TO_NODE,
	A.ROUT_PLN_CD ROUT_PLN_CD,
	A.ROUT_ORG_NOD_CD,
	A.ROUT_DEST_NOD_CD,
	A.ROUT_SEQ,
	A.ROUT_ORG_NOD_CD ROUT_ORG_SET,
	A.ROUT_DEST_NOD_CD ROUT_DEST_SET,
	A.ROUT_SEQ ROUT_SEQ_SET,
	MAX( A.INLND_ROUT_INV_BIL_PATT_CD) RAIL_CMB_THRU_TP_CD,
	MAX( DECODE( B.ROUT_DTL_SEQ, 1, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
	MAX( DECODE( B.ROUT_DTL_SEQ, 2, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
	MAX( DECODE( B.ROUT_DTL_SEQ, 3, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
	MAX( DECODE( B.ROUT_DTL_SEQ, 4, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
	MAX( DECODE( B.ROUT_DTL_SEQ, 5, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
	MAX( DECODE( B.ROUT_DTL_SEQ, 6, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
	MAX( DECODE( B.ROUT_DTL_SEQ, 7, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
	MAX( DECODE( B.ROUT_DTL_SEQ, 8, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )IRG,
	MAX(DECODE( B.ROUT_DTL_SEQ, 1, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 1 , '', ' / ') )) ||
	MAX(DECODE( B.ROUT_DTL_SEQ, 2, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 2 , '', ' / ') )) ||
	MAX(DECODE( B.ROUT_DTL_SEQ, 3, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 3 , '', ' / ') )) ||
	MAX(DECODE( B.ROUT_DTL_SEQ, 4, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 4 , '', ' / ') )) ||
	MAX(DECODE( B.ROUT_DTL_SEQ, 5, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 5 , '', ' / ') )) ||
	MAX(DECODE( B.ROUT_DTL_SEQ, 6, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 6 , '', ' / ') )) ||
	MAX(DECODE( B.ROUT_DTL_SEQ, 7, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 7 , '', ' / ') )) ||
	MAX(DECODE( B.ROUT_DTL_SEQ, 8, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 8 , '', ' / ') )) REF_NO ,
	'' IRG_DROPDOWNLIST
FROM 
		PRD_INLND_ROUT_MST A,
	  PRD_INLND_ROUT_DTL B,
	  MDM_VENDOR C,
	  TRS_AGMT_HDR AGMT,
	  (
	    SELECT 
			    	A.ROUT_ORG_NOD_CD,
			      A.ROUT_DEST_NOD_CD,
			      A.ROUT_SEQ,
			      C.MIN_SEQ MIN_SEQ,
			      ROUT_DTL_SEQ MAX_SEQ
	    FROM 
	    	PRD_INLND_ROUT_DTL A,
	      (
	        SELECT 
			        	ROUT_ORG_NOD_CD,
			          ROUT_DEST_NOD_CD,
			          ROUT_SEQ,
			          ROUT_DTL_SEQ MIN_SEQ
	        FROM 
	        	PRD_INLND_ROUT_DTL
	        WHERE LNK_ORG_NOD_CD = ${lnk_org_nod_cd.get($key)}
	        AND 	ROUT_ORG_NOD_CD = ${rout_org_nod_cd.get($key)}
	        AND 	ROUT_DEST_NOD_CD = ${rout_dest_nod_cd.get($key)}
	        AND 	ROUT_SEQ = ${rout_seq.get($key)}
	        AND 	TRSP_MOD_CD='RD' 
	      ) C
	    WHERE LNK_DEST_NOD_CD = ${lnk_dest_nod_cd.get($key)}
	    AND 	A.ROUT_ORG_NOD_CD = C.ROUT_ORG_NOD_CD
	    AND 	A.ROUT_DEST_NOD_CD = C.ROUT_DEST_NOD_CD
	    AND 	A.ROUT_SEQ = C.ROUT_SEQ
	    AND 	TRSP_MOD_CD='RD' 
	   ) D
WHERE A.ROUT_ORG_NOD_CD = B.ROUT_ORG_NOD_CD
AND 	A.ROUT_DEST_NOD_CD = B.ROUT_DEST_NOD_CD
AND 	A.ROUT_SEQ = B.ROUT_SEQ
AND 	B.TRSP_AGMT_OFC_CTY_CD = AGMT.TRSP_AGMT_OFC_CTY_CD(+)
AND 	B.TRSP_AGMT_SEQ =AGMT.TRSP_AGMT_SEQ(+)
AND 	NVL(A.DELT_FLG, 'N') <> 'Y'
AND 	B.TRSP_MOD_CD='RD'
AND 	B.VNDR_SEQ = C.VNDR_SEQ
AND 	B.ROUT_ORG_NOD_CD = D.ROUT_ORG_NOD_CD
AND 	B.ROUT_DEST_NOD_CD = D.ROUT_DEST_NOD_CD
AND 	B.ROUT_SEQ = D.ROUT_SEQ
AND 	B.ROUT_DTL_SEQ >= D.MIN_SEQ
AND 	B.ROUT_DTL_SEQ <= D.MAX_SEQ
GROUP BY A.PRIO_SEQ, A.INLND_ROUT_RMK, A.ROUT_PLN_CD, A.ROUT_ORG_NOD_CD, A.ROUT_DEST_NOD_CD, A.ROUT_SEQ, B.TRSP_MOD_CD
#end 
#end	

#else	
#foreach(${key} IN ${arr_size}) 
#if($velocityCount == 1)	
SELECT 
  ${trsp_bnd_cd.get($key)} TRSP_BND_CD,
  DECODE(${bkg_rcvde_term_cd.get($key)}, 'D', 'DOOR', 'CY') BKG_RCVDE_TERM_CD ,
#if(${trsp_bnd_cd.get($key)} == "'O'")
  ${key_dest.get($key)} POLPOD,
#elseif(${trsp_bnd_cd.get($key)} == "'I'")
  ${key_org.get($key)} POLPOD,
#end
  ${key_org.get($key)} KEY_ORG,
  ${key_dest.get($key)} KEY_DEST,
  ${cgo_tp_cd.get($key)} CGO_TP_CD,
  SUBSTR(${lnk_org_nod_cd.get($key)}, 1, 5) FM_NOD_CD,
  SUBSTR(${lnk_org_nod_cd.get($key)}, 6) FM_NOD_YARD,
  SUBSTR(${lnk_dest_nod_cd.get($key)}, 1, 5) TO_NOD_CD,
  SUBSTR(${lnk_dest_nod_cd.get($key)}, 6) TO_NOD_YARD,
  A.PRIO_SEQ,
  A.INLND_ROUT_RMK INLND_ROUT_RMK,
  ${lnk_org_nod_cd.get($key)} FROM_NODE,
  ${lnk_dest_nod_cd.get($key)} TO_NODE,
  A.ROUT_PLN_CD ROUT_PLN_CD,
  A.ROUT_ORG_NOD_CD,
  A.ROUT_DEST_NOD_CD,
  A.ROUT_SEQ,
  A.ROUT_ORG_NOD_CD ROUT_ORG_SET,
  A.ROUT_DEST_NOD_CD ROUT_DEST_SET,
  A.ROUT_SEQ ROUT_SEQ_SET,
  MAX( A.INLND_ROUT_INV_BIL_PATT_CD) RAIL_CMB_THRU_TP_CD,
  MAX( DECODE( B.ROUT_DTL_SEQ, 1, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
  MAX( DECODE( B.ROUT_DTL_SEQ, 2, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
  MAX( DECODE( B.ROUT_DTL_SEQ, 3, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
  MAX( DECODE( B.ROUT_DTL_SEQ, 4, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
  MAX( DECODE( B.ROUT_DTL_SEQ, 5, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
  MAX( DECODE( B.ROUT_DTL_SEQ, 6, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
  MAX( DECODE( B.ROUT_DTL_SEQ, 7, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
  MAX( DECODE( B.ROUT_DTL_SEQ, 8, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )IRG,
  MAX(DECODE( B.ROUT_DTL_SEQ, 1, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 1 , '', ' / ') )) ||
  MAX(DECODE( B.ROUT_DTL_SEQ, 2, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 2 , '', ' / ') )) ||
  MAX(DECODE( B.ROUT_DTL_SEQ, 3, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 3 , '', ' / ') )) ||
  MAX(DECODE( B.ROUT_DTL_SEQ, 4, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 4 , '', ' / ') )) ||
  MAX(DECODE( B.ROUT_DTL_SEQ, 5, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 5 , '', ' / ') )) ||
  MAX(DECODE( B.ROUT_DTL_SEQ, 6, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 6 , '', ' / ') )) ||
  MAX(DECODE( B.ROUT_DTL_SEQ, 7, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 7 , '', ' / ') )) ||
  MAX(DECODE( B.ROUT_DTL_SEQ, 8, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 8 , '', ' / ') )) REF_NO ,
  '' IRG_DROPDOWNLIST
FROM 
		PRD_INLND_ROUT_MST A,
	  PRD_INLND_ROUT_DTL B,
	  MDM_VENDOR C,
	  TRS_AGMT_HDR AGMT,
	  (
	    SELECT 
			    	A.ROUT_ORG_NOD_CD,
			      A.ROUT_DEST_NOD_CD,
			      A.ROUT_SEQ,
			      C.MIN_SEQ MIN_SEQ,
			      ROUT_DTL_SEQ MAX_SEQ
	    FROM 
	    	PRD_INLND_ROUT_DTL A,
	      (
	        SELECT 
			        	ROUT_ORG_NOD_CD,
			          ROUT_DEST_NOD_CD,
			          ROUT_SEQ,
			          ROUT_DTL_SEQ MIN_SEQ
	        FROM 
	        	PRD_INLND_ROUT_DTL
	        WHERE LNK_ORG_NOD_CD = ${lnk_org_nod_cd.get($key)}
	        AND 	ROUT_ORG_NOD_CD = ${rout_org_nod_cd.get($key)}
	        AND 	ROUT_DEST_NOD_CD = ${rout_dest_nod_cd.get($key)}
	        AND 	ROUT_SEQ = ${rout_seq.get($key)}
	        AND 	TRSP_MOD_CD='RD' 
	       ) C
	    WHERE LNK_DEST_NOD_CD = ${lnk_dest_nod_cd.get($key)}
	    AND 	A.ROUT_ORG_NOD_CD = C.ROUT_ORG_NOD_CD
	    AND 	A.ROUT_DEST_NOD_CD = C.ROUT_DEST_NOD_CD
	    AND 	A.ROUT_SEQ = C.ROUT_SEQ
	    AND 	TRSP_MOD_CD='RD' 
	  ) D
WHERE A.ROUT_ORG_NOD_CD = B.ROUT_ORG_NOD_CD
AND 	A.ROUT_DEST_NOD_CD = B.ROUT_DEST_NOD_CD
AND 	A.ROUT_SEQ = B.ROUT_SEQ
AND 	B.TRSP_AGMT_OFC_CTY_CD = AGMT.TRSP_AGMT_OFC_CTY_CD(+)
AND 	B.TRSP_AGMT_SEQ =AGMT.TRSP_AGMT_SEQ(+)
AND 	NVL(A.DELT_FLG, 'N') <> 'Y'
AND 	B.TRSP_MOD_CD='RD'
AND 	B.VNDR_SEQ = C.VNDR_SEQ
AND 	B.ROUT_ORG_NOD_CD = D.ROUT_ORG_NOD_CD
AND 	B.ROUT_DEST_NOD_CD = D.ROUT_DEST_NOD_CD
AND 	B.ROUT_SEQ = D.ROUT_SEQ
AND 	B.ROUT_DTL_SEQ >= D.MIN_SEQ
AND 	B.ROUT_DTL_SEQ <= D.MAX_SEQ
GROUP BY A.PRIO_SEQ, A.INLND_ROUT_RMK, A.ROUT_PLN_CD, A.ROUT_ORG_NOD_CD, A.ROUT_DEST_NOD_CD, A.ROUT_SEQ, B.TRSP_MOD_CD 

#else 
UNION
SELECT 
  ${trsp_bnd_cd.get($key)} TRSP_BND_CD,
  DECODE(${bkg_rcvde_term_cd.get($key)}, 'D', 'DOOR', 'CY') BKG_RCVDE_TERM_CD ,
#if(${trsp_bnd_cd.get($key)} == "'O'")
  ${key_dest.get($key)} POLPOD,
#elseif(${trsp_bnd_cd.get($key)} == "'I'")
  ${key_org.get($key)} POLPOD,
#end
  ${key_org.get($key)} KEY_ORG,
  ${key_dest.get($key)} KEY_DEST,
  ${cgo_tp_cd.get($key)} CGO_TP_CD,
  SUBSTR(${lnk_org_nod_cd.get($key)}, 1, 5) FM_NOD_CD,
  SUBSTR(${lnk_org_nod_cd.get($key)}, 6) FM_NOD_YARD,
  SUBSTR(${lnk_dest_nod_cd.get($key)}, 1, 5) TO_NOD_CD,
  SUBSTR(${lnk_dest_nod_cd.get($key)}, 6) TO_NOD_YARD,
  A.PRIO_SEQ,
  A.INLND_ROUT_RMK INLND_ROUT_RMK,
  ${lnk_org_nod_cd.get($key)} FROM_NODE,
  ${lnk_dest_nod_cd.get($key)} TO_NODE,
  A.ROUT_PLN_CD ROUT_PLN_CD,
  A.ROUT_ORG_NOD_CD,
  A.ROUT_DEST_NOD_CD,
  A.ROUT_SEQ,
  A.ROUT_ORG_NOD_CD ROUT_ORG_SET,
  A.ROUT_DEST_NOD_CD ROUT_DEST_SET,
  A.ROUT_SEQ ROUT_SEQ_SET,
  MAX( A.INLND_ROUT_INV_BIL_PATT_CD) RAIL_CMB_THRU_TP_CD,
  MAX( DECODE( B.ROUT_DTL_SEQ, 1, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
  MAX( DECODE( B.ROUT_DTL_SEQ, 2, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
  MAX( DECODE( B.ROUT_DTL_SEQ, 3, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
  MAX( DECODE( B.ROUT_DTL_SEQ, 4, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
  MAX( DECODE( B.ROUT_DTL_SEQ, 5, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
  MAX( DECODE( B.ROUT_DTL_SEQ, 6, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
  MAX( DECODE( B.ROUT_DTL_SEQ, 7, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )||
  MAX( DECODE( B.ROUT_DTL_SEQ, 8, DECODE( B.LNK_ORG_NOD_CD, ${lnk_org_nod_cd.get($key)}, B.LNK_ORG_NOD_CD)||'-('||C.VNDR_ABBR_NM||')-'||B.LNK_DEST_NOD_CD ) )IRG,
  MAX(DECODE( B.ROUT_DTL_SEQ, 1, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 1 , '', ' / ') )) ||
  MAX(DECODE( B.ROUT_DTL_SEQ, 2, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 2 , '', ' / ') )) ||
  MAX(DECODE( B.ROUT_DTL_SEQ, 3, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 3 , '', ' / ') )) ||
  MAX(DECODE( B.ROUT_DTL_SEQ, 4, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 4 , '', ' / ') )) ||
  MAX(DECODE( B.ROUT_DTL_SEQ, 5, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 5 , '', ' / ') )) ||
  MAX(DECODE( B.ROUT_DTL_SEQ, 6, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 6 , '', ' / ') )) ||
  MAX(DECODE( B.ROUT_DTL_SEQ, 7, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 7 , '', ' / ') )) ||
  MAX(DECODE( B.ROUT_DTL_SEQ, 8, NVL( AGMT.AGMT_REF_NO, 'N/A')|| DECODE( D.MAX_SEQ, 8 , '', ' / ') )) REF_NO ,
  '' IRG_DROPDOWNLIST
FROM 
  PRD_INLND_ROUT_MST A,
  PRD_INLND_ROUT_DTL B,
  MDM_VENDOR C,
  TRS_AGMT_HDR AGMT,
  (
    SELECT 
    	A.ROUT_ORG_NOD_CD,
      A.ROUT_DEST_NOD_CD,
      A.ROUT_SEQ,
      C.MIN_SEQ MIN_SEQ,
      ROUT_DTL_SEQ MAX_SEQ
    FROM 
    	PRD_INLND_ROUT_DTL A,
      (
        SELECT 
        	ROUT_ORG_NOD_CD,
          ROUT_DEST_NOD_CD,
          ROUT_SEQ,
          ROUT_DTL_SEQ MIN_SEQ
        FROM 
        	PRD_INLND_ROUT_DTL
        WHERE LNK_ORG_NOD_CD = ${lnk_org_nod_cd.get($key)}
        AND 	ROUT_ORG_NOD_CD = ${rout_org_nod_cd.get($key)}
        AND 	ROUT_DEST_NOD_CD = ${rout_dest_nod_cd.get($key)}
        AND 	ROUT_SEQ = ${rout_seq.get($key)}
        AND 	TRSP_MOD_CD='RD' 
       ) C
    WHERE LNK_DEST_NOD_CD = ${lnk_dest_nod_cd.get($key)}
    AND 	A.ROUT_ORG_NOD_CD = C.ROUT_ORG_NOD_CD
    AND 	A.ROUT_DEST_NOD_CD = C.ROUT_DEST_NOD_CD
    AND 	A.ROUT_SEQ = C.ROUT_SEQ
    AND 	TRSP_MOD_CD='RD' 
  ) D
WHERE A.ROUT_ORG_NOD_CD = B.ROUT_ORG_NOD_CD
AND 	A.ROUT_DEST_NOD_CD = B.ROUT_DEST_NOD_CD
AND 	A.ROUT_SEQ = B.ROUT_SEQ
AND 	B.TRSP_AGMT_OFC_CTY_CD = AGMT.TRSP_AGMT_OFC_CTY_CD(+)
AND 	B.TRSP_AGMT_SEQ =AGMT.TRSP_AGMT_SEQ(+)
AND 	NVL(A.DELT_FLG, 'N') <> 'Y'
AND 	B.TRSP_MOD_CD='RD'
AND 	B.VNDR_SEQ = C.VNDR_SEQ
AND 	B.ROUT_ORG_NOD_CD = D.ROUT_ORG_NOD_CD
AND 	B.ROUT_DEST_NOD_CD = D.ROUT_DEST_NOD_CD
AND 	B.ROUT_SEQ = D.ROUT_SEQ
AND 	B.ROUT_DTL_SEQ >= D.MIN_SEQ
AND 	B.ROUT_DTL_SEQ <= D.MAX_SEQ
GROUP BY A.PRIO_SEQ, A.INLND_ROUT_RMK, A.ROUT_PLN_CD, A.ROUT_ORG_NOD_CD, A.ROUT_DEST_NOD_CD, A.ROUT_SEQ, B.TRSP_MOD_CD 
#end	
#end	
#end
			]]></sql>
			<params>
			</params>
		</query>
	</querys>
</sqls>
