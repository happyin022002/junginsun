<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceInquiryCorrectionDBDAOSearchInvoiceInquiryCorrectionListRSQL">
			<desc><![CDATA[Invoice 생성내역을 조회]]></desc>
			<sql><![CDATA[
#if(${inv_tp_cd} == 'A' || ${inv_tp_cd} == 'C')
SELECT	
	A.IF_SYS_KND_CD			
,	COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00914', A.IF_SYS_KND_CD) IF_SYS_KND_NM				
,	A.TRSP_INV_AUD_STS_CD	
,	COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00824', A.TRSP_INV_AUD_STS_CD) TRSP_INV_AUD_STS_NM
,	DECODE(A.INV_HLD_FLG, 'N', '0', 'Y', '1') INV_HLD_FLG
,	'C' INV_TP_CD
,	A.INV_NO				
,	LPAD(TO_CHAR(A.INV_VNDR_SEQ), 6, '0') AS INV_VNDR_SEQ					
,	B.VNDR_LGL_ENG_NM INV_VNDR_NM					
,	C.CURR_CD				
,	SUM(NVL(C.BZC_AMT,0)+NVL(C.ETC_ADD_AMT,0) +NVL(C.FUEL_SCG_AMT,0)+NVL(C.NEGO_AMT,0)) WO_TOT_AMT				
,	C.INV_XCH_RT			
,	C.TRSP_INV_CALC_LGC_TP_CD
,	COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00874', C.TRSP_INV_CALC_LGC_TP_CD) TRSP_INV_CALC_LGC_TP_NM				
,	A.INV_CURR_CD			
,	SUM(C.INV_BZC_AMT) SO_INV_BZC_AMT				
,	SUM(NVL(C.INV_ETC_ADD_AMT,0)) AS SCG_AMT		
,	SUM(ABS(NVL(C.INV_ETC_ADD_AMT,0))) AS ABS_SCG_AMT
,	A.INV_BZC_AMT			
,	A.INV_VAT_AMT			
,	A.INV_WHLD_TAX_AMT		
,	A.INV_TTL_AMT			
,	TO_CHAR(A.INV_ISS_DT, 'YYYYMMDD') INV_ISS_DT	
,	TO_CHAR(A.INV_RCV_DT, 'YYYYMMDD') INV_RCV_DT	
,	TO_CHAR(A.PAY_DT, 'YYYYMMDD') PAY_DT			
,	E.GL_DT					
,	TO_CHAR(A.UPD_DT, 'YYYYMMDD') UPD_DT			
,	TO_CHAR(A.INV_CFM_DT, 'YYYYMMDD') INV_CFM_DT	
,	A.CSR_NO				
,	A.INV_PAY_MZD_CD		
,	A.INV_CHK_TRNS_NO		
,	MAX(C.INV_RMK) INV_REMARK			
,	A.CRE_OFC_CD			
,	A.CRE_USR_ID			
,	COUNT(D.OFC_CD) CNT_SPP	
,	'N' RFND_FLG			
,	A.RGST_NO
,   SUM(NVL(C.INV_ADJ_BZC_AMT, 0)) INV_ADJ_BZC_AMT
FROM TRS_TRSP_INV_WRK A		
,	MDM_VENDOR B			
,	TRS_TRSP_SVC_ORD C		
,	TRS_TRSP_INV_OFC D
,	AP_INV_HDR		 E	
WHERE
	A.INV_VNDR_SEQ					= B.VNDR_SEQ
AND	A.INV_VNDR_SEQ					= C.INV_VNDR_SEQ					
AND	A.INV_NO						= C.INV_NO	
AND A.CSR_NO					    = E.CSR_NO(+)
AND	C.TRSP_SO_STS_CD				='I'		
AND	D.INV_OFC_CD(+)		 			= @[FORM_USR_OFC_CD]			
AND	A.CRE_OFC_CD					= D.OFC_CD(+)
#if ( !(${fmdate} == '' ))
	#if(${date_cd} == 'IS' )
		AND A.INV_ISS_DT 
	#elseif(${date_cd} == 'PD')
		AND A.PAY_DT 
	#elseif(${date_cd} == 'GL')
		AND TO_DATE(NVL(E.GL_DT,'00010101')||'000001','YYYYMMDDHH24MISS')  
	#elseif(${date_cd} == 'SU' )
		AND A.UPD_DT 
	#elseif(${date_cd} == 'IC')
		AND A.INV_CFM_DT 
	#else
		AND A.INV_RCV_DT 
	#end
	BETWEEN TO_DATE(@[fmdate]||'000000','YYYYMMDDHH24MISS') AND TO_DATE(@[todate]||'235959','YYYYMMDDHH24MISS')		
#end

	AND A.TRSP_INV_AUD_STS_CD =   DECODE(@[status_cd], 'ALL', A.TRSP_INV_AUD_STS_CD, @[status_cd])
	AND NVL(A.INV_HLD_FLG, 'N') = DECODE(@[hold_cd], 'ALL', NVL(A.INV_HLD_FLG, 'N'), @[hold_cd])

#if (!(${combo_svc_provider} == '') ) 
	#if(${sp_tp} == 'wo')
		AND A.WO_VNDR_SEQ = ${combo_svc_provider}				
	#elseif(${sp_tp} == 'py')
		AND A.INV_VNDR_SEQ = ${combo_svc_provider}	
	#end
#end
#if ( $noCdArr.size() > 0)	
	#if(${no_tp} == 'iv')
		AND A.INV_NO 
	#elseif(${no_tp} == 'csr')
		AND A.CSR_NO 
    #else
		AND C.REF_INV_NO
	#end
	IN ( 
	#foreach( ${key} in ${noCdArr})
		#if($velocityCount == 1)
			 '${key}'
		#else
			,  '${key}'
		#end
	#end
	)					
#end
#if ( $ofcCdArr.size() > 0)	
		AND A.CRE_OFC_CD 
	IN ( 
	#foreach( ${key} in ${ofcCdArr})
		#if($velocityCount == 1)
			 '${key}'
		#else
			,  '${key}'
		#end
	#end
	)					
#end
	AND A.CRE_USR_ID = NVL(@[ivc_cre_usr_id], A.CRE_USR_ID)	
GROUP BY					
	A.IF_SYS_KND_CD			
,	A.TRSP_INV_AUD_STS_CD	
,	A.INV_HLD_FLG			
,	A.INV_NO				
,	A.INV_VNDR_SEQ			
,	B.VNDR_LGL_ENG_NM		
,	C.CURR_CD				
,	C.INV_XCH_RT			
,	C.TRSP_INV_CALC_LGC_TP_CD
,	A.INV_CURR_CD			
,	A.INV_BZC_AMT			
,	A.INV_VAT_AMT			
,	A.INV_WHLD_TAX_AMT		
,	A.INV_TTL_AMT			
,	A.INV_ISS_DT			
,	A.INV_RCV_DT			
,	A.PAY_DT				
,	E.GL_DT					
,	A.UPD_DT				
,	A.INV_CFM_DT			
,	A.CSR_NO				
,	A.INV_PAY_MZD_CD		
,	A.INV_CHK_TRNS_NO		
,	A.CRE_OFC_CD			
,	A.CRE_USR_ID			
,	A.TRSP_INV_AUD_STS_CD	
,	A.RGST_NO
#if(${amount_verify_cd} == 'T')
	HAVING
	A.INV_NO IS NOT NULL				
	AND		SUM(NVL(C.INV_ETC_ADD_AMT,0)) = 0
#elseif(${amount_verify_cd} == 'F')
	 HAVING 
	 A.INV_NO IS NOT NULL				
	 AND 	SUM(NVL(C.INV_ETC_ADD_AMT,0)) <> 0	
#end		
#end

#if(${inv_tp_cd} == 'A')
UNION ALL
#end
#if(${inv_tp_cd} == 'A' || ${inv_tp_cd} == 'R')
(	
SELECT /*+ INDEX(C XPKTRS_TRSP_RFND_INV)*/		
	A.IF_SYS_KND_CD		
  ,	COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00914', A.IF_SYS_KND_CD) IF_SYS_KND_NM			
  ,	A.TRSP_INV_AUD_STS_CD
  ,	COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00824', A.TRSP_INV_AUD_STS_CD) TRSP_INV_AUD_STS_NM					
  ,	DECODE(A.INV_HLD_FLG, 'N', '0', 'Y', '1') INV_HLD_FLG
  ,	'R' INV_TP_CD
  ,	A.INV_NO			
  ,	LPAD(TO_CHAR(A.INV_VNDR_SEQ), 6, '0') AS INV_VNDR_SEQ				
  ,	B.VNDR_LGL_ENG_NM INV_VNDR_NM				
  ,	'' CURR_CD			
  ,	0 WO_TOT_AMT				                            			
  ,	0 INV_XCH_RT		
  ,	'' TRSP_INV_CALC_LGC_TP_CD					
  ,	'' TRSP_INV_CALC_LGC_TP_NM				                			
  ,	A.INV_CURR_CD		
  ,	SUM(C.TRSP_RFND_INV_AMT) AS SO_INV_BZC_AMT
  ,	0 AS SCG_AMT		            			
  ,	0 AS ABS_SCG_AMT	            			
  ,	A.INV_BZC_AMT AS INV_BZC_AMT 			
  ,	A.INV_VAT_AMT AS INV_VAT_AMT				
  ,	A.INV_WHLD_TAX_AMT	
  ,	A.INV_TTL_AMT AS INV_TTL_AMT				
  ,	TO_CHAR(A.INV_ISS_DT, 'YYYYMMDD') INV_ISS_DT
  ,	TO_CHAR(A.INV_RCV_DT, 'YYYYMMDD') INV_RCV_DT
  ,	TO_CHAR(A.PAY_DT, 'YYYYMMDD') PAY_DT		
  ,	E.GL_DT				
  ,	TO_CHAR(A.UPD_DT, 'YYYYMMDD') UPD_DT		
  ,	TO_CHAR(A.INV_CFM_DT, 'YYYYMMDD') INV_CFM_DT
  ,	A.CSR_NO			
  ,	A.INV_PAY_MZD_CD	
  ,	A.INV_CHK_TRNS_NO	
  ,	'' INV_REMARK		
  ,	A.CRE_OFC_CD		
  ,	A.CRE_USR_ID		
  ,	COUNT(D.OFC_CD) CNT_SPP
  ,	'Y' RFND_FLG		
  ,	A.RGST_NO
  , 0 INV_ADJ_BZC_AMT
  FROM 					
  	TRS_TRSP_INV_WRK A	
  ,	MDM_VENDOR B		
  ,	TRS_TRSP_RFND_INV C	
  ,	TRS_TRSP_INV_OFC D
  , AP_INV_HDR       E	
WHERE
	A.INV_VNDR_SEQ					= B.VNDR_SEQ
AND	A.INV_VNDR_SEQ					= C.INV_VNDR_SEQ					
AND	A.INV_NO						= C.INV_NO	
AND A.CSR_NO 						= E.CSR_NO(+)
AND	NVL(A.INV_RJCT_FLG,'N') 		='N'		
AND	D.INV_OFC_CD(+)		 			= @[FORM_USR_OFC_CD]			
AND	A.CRE_OFC_CD					= D.OFC_CD(+)
#if ( !(${fmdate} == '' ))

	#if( ${date_cd} == 'IS' )
		AND A.INV_ISS_DT 
	#elseif(${date_cd} == 'PD' )
		AND A.PAY_DT 
	#elseif(${date_cd} == 'GL' )
		AND TO_DATE(NVL(E.GL_DT,'00010101')||'000001','YYYYMMDDHH24MISS')  
	#elseif(${date_cd} == 'SU' )
		AND A.UPD_DT 
	#elseif(${date_cd} == 'IC' )
		AND A.INV_CFM_DT 
	#else
		AND A.INV_RCV_DT 
	#end

	BETWEEN TO_DATE(@[fmdate]||'000000','YYYYMMDDHH24MISS') AND TO_DATE(@[todate]||'235959','YYYYMMDDHH24MISS')		
#end

	AND A.TRSP_INV_AUD_STS_CD =   DECODE(@[status_cd], 'ALL', A.TRSP_INV_AUD_STS_CD, @[status_cd])
	AND NVL(A.INV_HLD_FLG, 'N') = DECODE(@[hold_cd], 'ALL', NVL(A.INV_HLD_FLG, 'N'), @[hold_cd])

#if (!(${combo_svc_provider} == '') ) 
	#if(${sp_tp} == 'wo')
		AND A.WO_VNDR_SEQ = ${combo_svc_provider}				
	#elseif(${sp_tp} == 'py')
		AND A.INV_VNDR_SEQ = ${combo_svc_provider}	
	#end
#end
#if(${no_tp} != 'reference')
#if ( $noCdArr.size() > 0)	
	#if(${no_tp} == 'iv')
		AND A.INV_NO 
	#elseif(${no_tp} == 'csr')
		AND A.CSR_NO
    #end
	IN ( 
	#foreach( ${key} in ${noCdArr})
		#if($velocityCount == 1)
			 '${key}'
		#else
			,  '${key}'
		#end
	#end
	)					
#end
#end	
#if ( $ofcCdArr.size() > 0)	
		AND A.CRE_OFC_CD 
	IN ( 
	#foreach( ${key} in ${ofcCdArr})
		#if($velocityCount == 1)
			 '${key}'
		#else
			,  '${key}'
		#end
	#end
	)					
#end
	AND A.CRE_USR_ID = NVL(@[ivc_cre_usr_id], A.CRE_USR_ID)
GROUP BY					
	A.IF_SYS_KND_CD			
,	A.TRSP_INV_AUD_STS_CD	
,	A.INV_HLD_FLG			
,	A.INV_NO				
,	A.INV_VNDR_SEQ			
,	B.VNDR_LGL_ENG_NM		
,	A.INV_CURR_CD			
,	A.INV_BZC_AMT			
,	A.INV_VAT_AMT			
,	A.INV_WHLD_TAX_AMT		
,	A.INV_TTL_AMT			
,	A.INV_ISS_DT			
,	A.INV_RCV_DT			
,	A.PAY_DT				
,	E.GL_DT					
,	A.UPD_DT				
,	A.INV_CFM_DT			
,	A.CSR_NO				
,	A.INV_PAY_MZD_CD		
,	A.INV_CHK_TRNS_NO		
,	A.CRE_OFC_CD			
,	A.CRE_USR_ID			
,	A.TRSP_INV_AUD_STS_CD	
,	A.RGST_NO
)
#end

#if(${inv_tp_cd} == 'A')
UNION ALL
#end

#if(${inv_tp_cd} == 'A' || ${inv_tp_cd} == 'P')
--POOL CHASSIS REPOSITION
SELECT	
	A.IF_SYS_KND_CD			
,	COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00914', A.IF_SYS_KND_CD) IF_SYS_KND_NM				
,	A.TRSP_INV_AUD_STS_CD	
,	COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00824', A.TRSP_INV_AUD_STS_CD) TRSP_INV_AUD_STS_NM
,	DECODE(A.INV_HLD_FLG, 'N', '0', 'Y', '1') INV_HLD_FLG
,	'P' INV_TP_CD					
,	A.INV_NO				
,	LPAD(TO_CHAR(A.INV_VNDR_SEQ), 6, '0') AS INV_VNDR_SEQ					
,	B.VNDR_LGL_ENG_NM INV_VNDR_NM					
,	'' CURR_CD				
,	0 WO_TOT_AMT				
,	0 INV_XCH_RT			
,	'' TRSP_INV_CALC_LGC_TP_CD
,	'' TRSP_INV_CALC_LGC_TP_NM				
,	A.INV_CURR_CD			
,	0 SO_INV_BZC_AMT				
,	0 AS SCG_AMT		
,	0 AS ABS_SCG_AMT
,	A.INV_BZC_AMT			
,	A.INV_VAT_AMT			
,	A.INV_WHLD_TAX_AMT		
,	A.INV_TTL_AMT			
,	TO_CHAR(A.INV_ISS_DT, 'YYYYMMDD') INV_ISS_DT	
,	TO_CHAR(A.INV_RCV_DT, 'YYYYMMDD') INV_RCV_DT	
,	TO_CHAR(A.PAY_DT, 'YYYYMMDD') PAY_DT			
,	E.GL_DT					
,	TO_CHAR(A.UPD_DT, 'YYYYMMDD') UPD_DT			
,	TO_CHAR(A.INV_CFM_DT, 'YYYYMMDD') INV_CFM_DT	
,	A.CSR_NO				
,	A.INV_PAY_MZD_CD		
,	A.INV_CHK_TRNS_NO		
,	'' INV_REMARK			
,	A.CRE_OFC_CD			
,	A.CRE_USR_ID			
,	COUNT(D.OFC_CD) CNT_SPP	
,	'N' RFND_FLG			
,	A.RGST_NO
,   0 INV_ADJ_BZC_AMT
FROM TRS_TRSP_INV_WRK A		
,	MDM_VENDOR B			
,	TRS_TRSP_POOL_CHSS_INV C		
,	TRS_TRSP_INV_OFC D
,	AP_INV_HDR		 E	
WHERE
	A.INV_VNDR_SEQ					= B.VNDR_SEQ
AND	A.INV_VNDR_SEQ					= C.INV_VNDR_SEQ					
AND	A.INV_NO						= C.INV_NO	
AND A.CSR_NO					    = E.CSR_NO(+)
AND	D.INV_OFC_CD(+)		 			= @[FORM_USR_OFC_CD]			
AND	A.CRE_OFC_CD					= D.OFC_CD(+)
#if ( !(${fmdate} == '' ))
	#if(${date_cd} == 'IS' )
		AND A.INV_ISS_DT 
	#elseif(${date_cd} == 'PD')
		AND A.PAY_DT 
	#elseif(${date_cd} == 'GL')
		AND TO_DATE(NVL(E.GL_DT,'00010101')||'000001','YYYYMMDDHH24MISS')  
	#elseif(${date_cd} == 'SU' )
		AND A.UPD_DT 
	#elseif(${date_cd} == 'IC')
		AND A.INV_CFM_DT 
	#else
		AND A.INV_RCV_DT 
	#end
	BETWEEN TO_DATE(@[fmdate]||'000000','YYYYMMDDHH24MISS') AND TO_DATE(@[todate]||'235959','YYYYMMDDHH24MISS')		
#end

	AND A.TRSP_INV_AUD_STS_CD =   DECODE(@[status_cd], 'ALL', A.TRSP_INV_AUD_STS_CD, @[status_cd])
	AND NVL(A.INV_HLD_FLG, 'N') = DECODE(@[hold_cd], 'ALL', NVL(A.INV_HLD_FLG, 'N'), @[hold_cd])

#if (!(${combo_svc_provider} == '') ) 
	#if(${sp_tp} == 'wo')
		AND A.WO_VNDR_SEQ = ${combo_svc_provider}				
	#elseif(${sp_tp} == 'py')
		AND A.INV_VNDR_SEQ = ${combo_svc_provider}	
	#end
#end
#if(${no_tp} != 'reference')
#if ( $noCdArr.size() > 0)	
	#if(${no_tp} == 'iv')
		AND A.INV_NO 
	#elseif(${no_tp} == 'csr')
		AND A.CSR_NO 
	#end
	IN ( 
	#foreach( ${key} in ${noCdArr})
		#if($velocityCount == 1)
			 '${key}'
		#else
			,  '${key}'
		#end
	#end
	)					
#end
#end
#if ( $ofcCdArr.size() > 0)	
		AND A.CRE_OFC_CD 
	IN ( 
	#foreach( ${key} in ${ofcCdArr})
		#if($velocityCount == 1)
			 '${key}'
		#else
			,  '${key}'
		#end
	#end
	)					
#end
	AND A.CRE_USR_ID = NVL(@[ivc_cre_usr_id], A.CRE_USR_ID)	
GROUP BY					
	A.IF_SYS_KND_CD			
,	A.TRSP_INV_AUD_STS_CD	
,	A.INV_HLD_FLG			
,	A.INV_NO				
,	A.INV_VNDR_SEQ			
,	B.VNDR_LGL_ENG_NM
,	A.INV_CURR_CD			
,	A.INV_BZC_AMT			
,	A.INV_VAT_AMT			
,	A.INV_WHLD_TAX_AMT		
,	A.INV_TTL_AMT			
,	A.INV_ISS_DT			
,	A.INV_RCV_DT			
,	A.PAY_DT				
,	E.GL_DT					
,	A.UPD_DT				
,	A.INV_CFM_DT			
,	A.CSR_NO				
,	A.INV_PAY_MZD_CD		
,	A.INV_CHK_TRNS_NO		
,	A.CRE_OFC_CD			
,	A.CRE_USR_ID			
,	A.TRSP_INV_AUD_STS_CD	
,	A.RGST_NO
#end			]]></sql>
			<params>
				<param name="FORM_USR_OFC_CD" type="12" value="" out="N"/>
				<param name="fmdate" type="12" value="" out="N"/>
				<param name="todate" type="12" value="" out="N"/>
				<param name="status_cd" type="12" value="" out="N"/>
				<param name="hold_cd" type="12" value="" out="N"/>
				<param name="ivc_cre_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
