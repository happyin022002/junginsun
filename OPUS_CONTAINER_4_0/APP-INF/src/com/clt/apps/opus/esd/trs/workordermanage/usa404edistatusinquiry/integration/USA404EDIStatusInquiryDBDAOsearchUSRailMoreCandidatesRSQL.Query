<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="USA404EDIStatusInquiryDBDAOsearchUSRailMoreCandidatesRSQL">
			<desc><![CDATA[searchUSRailMoreCandidates]]></desc>
			<sql><![CDATA[
SELECT * FROM (
SELECT AGMT.VNDR_SEQ, AGMT.VNDR_NM, AGMT.AGMT_NO, AGMT.TRSP_RAIL_SCG_CD, AGMT.COM_SCG_APLY_FLG, AGMT.WO_APLY_FLG, AGMT.FM_NOD_CD, AGMT.TO_NOD_CD, 
       AGMT.AGMT_SCG_RT_DIV_CD, AGMT.TRSP_RAIL_RTO, AGMT.CURR_CD, AGMT.NUM_VAL AS TRSP_RT, AGMT.TRSP_AGMT_SCG_SEQ,
       AGMT.CGO_TP_CD, AGMT.AGMT_EQ_SZ_NO, AGMT.LBS_OVR_WGT, AGMT.WGT_MEAS_UT_CD, AGMT.USR_DEF_RMK,
       DECODE(AGMT.COM_SCG_KND_CD,'XXXXXX', NULL, AGMT.COM_SCG_KND_CD) AS COM_SCG_KND_CD,
       DECODE(AGMT.COM_SCG_SEQ,-1, NULL, AGMT.COM_SCG_SEQ) AS COM_SCG_SEQ,
       AGMT.SPCL_CGO_CNTR_TP_CD,
       VNDR.SUB_RAIL_SEQ, APLD.NUM_VAL APPL_RT, APLD.NUM_VAL APPL_RT_HIDDEN, DECODE(APLD.NUM_VAL, NULL, '0', '1') IBCHK,
       @[trsp_so_ofc_cty_cd] AS TRSP_SO_OFC_CTY_CD, @[trsp_so_seq] AS TRSP_SO_SEQ,
       VNDR.BZC_AMT, AGMT.RAIL_RTO_NO,
       AGMT.EFF_FM_DT,AGMT.EFF_TO_DT, APLD.TRSP_AGMT_SCG_SEQ TRSP_AGMT_SCG_SEQ2,
       CASE WHEN SUBSTR(@[basis_dt],1,8) BETWEEN TO_CHAR(AGMT.EFF_FM_DT,'YYYYMMDD') AND TO_CHAR(AGMT.EFF_TO_DT,'YYYYMMDD') THEN ''
            ELSE 'Not Matched'
       END RATE_STS
FROM (
        SELECT * 
          FROM (
                        /* FSG-NOT COMMON */
                        SELECT A.VNDR_SEQ AS VNDR_SEQ
                              ,C.VNDR_LGL_ENG_NM AS VNDR_NM
                              ,A.TRSP_AGMT_OFC_CTY_CD||A.TRSP_AGMT_SEQ AS AGMT_NO
                              ,A.TRSP_RAIL_SCG_CD
                              ,A.TRSP_RAIL_SCG_CD TRSP_RAIL_SCG_NM
                              ,A.COM_SCG_APLY_FLG
                              ,A.WO_APLY_FLG
                              ,DECODE(A.FM_NOD_CD, '00', '', A.FM_NOD_CD) AS FM_NOD_CD
                              ,DECODE(A.TO_NOD_CD, '00', '', A.TO_NOD_CD) AS TO_NOD_CD
                              ,'Ratio' AS AGMT_SCG_RT_DIV_CD
                              ,A.TRSP_RAIL_RTO AS TRSP_RAIL_RTO
                              ,@[curr_cd] AS CURR_CD
                              ,A.FX_SCG_ALL_RT AS FX_SCG_ALL_RT
                              ,A.FX_SCG_20FT_RT AS FX_SCG_20FT_RT
                              ,A.FX_SCG_40FT_RT AS FX_SCG_40FT_RT
                              ,A.FX_SCG_45FT_RT AS FX_SCG_45FT_RT
                               /* APPLIED AMOUNT */
                              ,A.SPCL_CGO_CNTR_TP_CD
                              ,A.AGMT_EQ_SZ_NO2 AS AGMT_EQ_SZ_NO
                              ,A.LBS_OVR_WGT
                              ,DECODE(A.TRSP_RAIL_SCG_CD, 'OWS', 'LBS', NULL) WGT_MEAS_UT_CD
                              ,A.USR_DEF_RMK
                              ,A.CGO_TP_CD
                              ,A.TRSP_AGMT_SCG_SEQ AS TRSP_AGMT_SCG_SEQ
                              ,A.NUM_VAL
                              ,'XXXXXX' AS COM_SCG_KND_CD
                              ,-1 AS COM_SCG_SEQ
                              ,A.RAIL_RTO_NO
                              ,A.EFF_FM_DT
                              ,A.EFF_TO_DT
                         FROM (
                                SELECT 'AL' AS AGMT_EQ_SZ_NO2
                                      ,NULL AS NUM_VAL
                                      ,A.* 
                                  FROM TRS_AGMT_RAIL_SCG_RT A
                                 WHERE TRSP_RAIL_SCG_CD = 'FSG'
                                   AND NVL(COM_SCG_APLY_FLG, '0') = '0'
                                   AND TRSP_RAIL_SCG_CD IS NOT NULL
                                   AND NVL(CGO_TP_CD, DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')) = DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')
                              ) A
                             ,MDM_VENDOR C
                             ,TRS_TRSP_RAIL_BIL_VNDR_SET G
                        WHERE 1=1
                          AND A.VNDR_SEQ = C.VNDR_SEQ
                          AND NVL(A.FM_NOD_CD, '00') = DECODE(LENGTH(NVL(A.FM_NOD_CD, '00')), 7, G.FM_NOD_CD, 5, SUBSTR(G.FM_NOD_CD, 1, 5), '00')
                          AND NVL(A.TO_NOD_CD, '00') = DECODE(LENGTH(NVL(A.TO_NOD_CD, '00')), 7, G.TO_NOD_CD, 5, SUBSTR(G.TO_NOD_CD, 1, 5), '00')
                          AND G.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                          AND G.TRSP_SO_SEQ = @[trsp_so_seq]
                          AND A.VNDR_SEQ = G.VNDR_SEQ
                        UNION ALL
                        /* FSG-COMMON 2 */
                        SELECT F.VNDR_SEQ AS VNDR_SEQ
                              ,C.VNDR_LGL_ENG_NM AS VNDR_NM
                              ,F.TRSP_AGMT_OFC_CTY_CD||F.TRSP_AGMT_SEQ AS AGMT_NO
                              ,F.TRSP_RAIL_SCG_CD
                              ,F.TRSP_RAIL_SCG_CD TRSP_RAIL_SCG_NM
                              ,F.COM_SCG_APLY_FLG
                              ,F.WO_APLY_FLG
                              ,DECODE(F.FM_NOD_CD, '00', '', F.FM_NOD_CD) AS FM_NOD_CD
                              ,DECODE(F.TO_NOD_CD, '00', '', F.TO_NOD_CD) AS TO_NOD_CD
                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN 'Fixed'
                                    ELSE 'Ratio'
                               END AS AGMT_SCG_RT_DIV_CD
                              ,F.TRSP_ONE_WY_RT AS TRSP_RAIL_RTO
                              ,@[curr_cd] AS CURR_CD
                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN F.TRSP_ONE_WY_RT
                                    ELSE NULL
                               END AS FX_SCG_ALL_RT
                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN F.TRSP_ONE_WY_RT
                                    ELSE NULL
                               END AS FX_SCG_20FT_RT
                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN F.TRSP_ONE_WY_RT
                                    ELSE NULL
                               END AS FX_SCG_40FT_RT
                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN F.TRSP_ONE_WY_RT
                                    ELSE NULL
                               END AS FX_SCG_45FT_RT
                               /* APPLIED AMOUNT */
                              ,F.SPCL_CGO_CNTR_TP_CD
                              ,F.AGMT_EQ_SZ_NO AS AGMT_EQ_SZ_NO
                              ,0 AS LBS_OVR_WGT
                              ,NULL AS WGT_MEAS_UT_CD
                              ,F.USR_DEF_RMK
                              ,F.CGO_TP_CD
                              ,F.TRSP_AGMT_SCG_SEQ AS TRSP_AGMT_SCG_SEQ
                              ,NULL AS NUM_VAL
                              ,F.COM_SCG_KND_CD
                              ,F.COM_SCG_SEQ
                              ,F.RAIL_RTO_NO
                              ,F.EFF_FM_DT
                              ,F.EFF_TO_DT
                         FROM MDM_VENDOR C
                             ,(SELECT COM_SCG_KND_CD
                                     ,EQ_TPSZ_CD AS TRSP_AGMT_EQ_TP_SZ_CD
                                     ,CURR_CD
                                     ,RT_TP_CD AS AGMT_SCG_RT_DIV_CD
                                     ,NVL(ONE_WY_RT, RND_RT) TRSP_ONE_WY_RT
                                     ,0 TRSP_RND_RT
                                     ,NVL(ONE_WY_RT, RND_RT) ETC_ADD_AMT
                                     ,AGMT_EQ_SZ_NO AS AGMT_EQ_SZ_NO
                                     ,EQ_TPSZ_CD AS EQ_TPSZ_CD
                                     ,COM_SCG_SEQ
                                     ,TRSP_SO_OFC_CTY_CD
                                     ,TRSP_SO_SEQ
                                     ,SUB_RAIL_SEQ
                                     ,VNDR_SEQ
                                     ,TRSP_AGMT_SCG_SEQ
                                     ,USR_DEF_RMK
                                     ,CGO_TP_CD
                                     ,SPCL_CGO_CNTR_TP_CD
                                     ,FM_NOD_CD
                                     ,TO_NOD_CD
                                     ,TRSP_AGMT_OFC_CTY_CD
                                     ,TRSP_AGMT_SEQ
                                     ,TRSP_RAIL_SCG_CD
                                     ,COM_SCG_APLY_FLG
                                     ,WO_APLY_FLG
                                     ,RAIL_RTO_NO
                                     ,EFF_FM_DT
                                     ,EFF_TO_DT
                                 FROM (
                                         SELECT 'FSG' AS COM_SCG_KND_CD
                                               ,ONE_WY_RT
                                               ,RND_RT
                                               ,EQ_TPSZ_CD
                                               ,CSM.CURR_CD
                                               ,RT_TP_CD
                                               ,CASE WHEN SUBSTR(EQ_TPSZ_CD, 1, 2) = 'AL' THEN
                                                            CASE SUBSTR(EQ_TPSZ_CD, 3, 1) WHEN '2' THEN '20'
                                                                                          WHEN '3' THEN '20'
                                                                                          WHEN '4' THEN '40'
                                                                                          WHEN '5' THEN '40'
                                                                                          WHEN '6' THEN '45'
                                                                                          WHEN '7' THEN '45'
                                                                                          ELSE 'AL'
                                                            END
                                                     WHEN SUBSTR(EQ_TPSZ_CD, 1, 2) <> 'AL' THEN
                                                            CASE SUBSTR(EQ_TPSZ_CD, 2, 1) WHEN '2' THEN '20'
                                                                                          WHEN '3' THEN '20'
                                                                                          WHEN '4' THEN '40'
                                                                                          WHEN '5' THEN '40'
                                                                                          WHEN '6' THEN '45'
                                                                                          WHEN '7' THEN '45'
                                                                                          ELSE 'AL'
                                                            END
                                                END AS AGMT_EQ_SZ_NO
                                               ,COM_SCG_SEQ
                                               ,RBVS.TRSP_SO_OFC_CTY_CD
                                               ,RBVS.TRSP_SO_SEQ
                                               ,RBVS.SUB_RAIL_SEQ
                                               ,RBVS.VNDR_SEQ
                                               ,A.TRSP_AGMT_SCG_SEQ
                                               ,A.USR_DEF_RMK
                                               ,A.CGO_TP_CD
                                               ,A.SPCL_CGO_CNTR_TP_CD
                                               ,A.FM_NOD_CD
                                               ,A.TO_NOD_CD
                                               ,A.TRSP_AGMT_OFC_CTY_CD
                                               ,A.TRSP_AGMT_SEQ
                                               ,A.TRSP_RAIL_SCG_CD
                                               ,A.COM_SCG_APLY_FLG
                                               ,A.WO_APLY_FLG
                                               ,A.RAIL_RTO_NO
                                               ,A.EFF_FM_DT
                                               ,A.EFF_TO_DT
                                           FROM TRS_COM_SCG_MGMT CSM
                                               ,(
                                                     SELECT 'AL' AS AGMT_EQ_SZ_NO2
                                                           ,A.* 
                                                       FROM TRS_AGMT_RAIL_SCG_RT A
                                                      WHERE TRSP_RAIL_SCG_CD = 'FSG'
                                                        AND NVL(A.COM_SCG_APLY_FLG, '0') = '1'
                                                        AND A.TRSP_RAIL_SCG_CD IS NOT NULL
                                                        AND NVL(A.CGO_TP_CD, DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')) = DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')
                                                ) A
                                               ,(
                                                    SELECT TRSP_SO_OFC_CTY_CD
                                                          ,TRSP_SO_SEQ
                                                          ,SUB_RAIL_SEQ
                                                          ,VNDR_SEQ
                                                          ,FM_NOD_CD
                                                          ,TO_NOD_CD 
                                                      FROM TRS_TRSP_RAIL_BIL_VNDR_SET
                                                     WHERE 1=1
                                                       AND TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                                                       AND TRSP_SO_SEQ = @[trsp_so_seq]
                                                ) RBVS
                                          WHERE 1=1
                                            AND TRSP_COST_MOD_CD = 'CY'
                                            AND AGMT_TRSP_TP_CD  = 'RD'
                                            AND (SCC_CD = MST_LOC_FNC(SUBSTR(RBVS.FM_NOD_CD, 1, 5),'SCC') OR
                                                 LCC_CD IN (MST_LOC_FNC(SUBSTR(RBVS.FM_NOD_CD, 1, 5),'LCC')) OR
                                                 RCC_CD IN (MST_LOC_FNC(SUBSTR(RBVS.FM_NOD_CD, 1, 5),'RCC'))
                                                )
                                            AND NVL(CSM.CGO_TP_CD, DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')) = DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')
                                            AND NVL(CSM.BND_CD, NVL(@[bound_cd],'X')) = NVL(@[bound_cd],'X')
                                            AND CSM.COM_SCG_KND_CD = 'SCFAAL'
                                            AND NVL(A.FM_NOD_CD, '00') = DECODE(LENGTH(NVL(A.FM_NOD_CD, '00')), 7, RBVS.FM_NOD_CD, 5, SUBSTR(RBVS.FM_NOD_CD, 1, 5), '00')
                                            AND NVL(A.TO_NOD_CD, '00') = DECODE(LENGTH(NVL(A.TO_NOD_CD, '00')), 7, RBVS.TO_NOD_CD, 5, SUBSTR(RBVS.TO_NOD_CD, 1, 5), '00')
                                            AND RBVS.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                                            AND RBVS.TRSP_SO_SEQ = @[trsp_so_seq]
                                            AND A.VNDR_SEQ = RBVS.VNDR_SEQ
                                      )
                               ) F
                        WHERE 1=1
                          AND F.VNDR_SEQ = C.VNDR_SEQ
                        UNION ALL
                        /* ETC */
                        SELECT A.VNDR_SEQ AS VNDR_SEQ
                              ,C.VNDR_LGL_ENG_NM AS VNDR_NM
                              ,A.TRSP_AGMT_OFC_CTY_CD||A.TRSP_AGMT_SEQ AS AGMT_NO
                              ,A.TRSP_RAIL_SCG_CD
                              ,A.TRSP_RAIL_SCG_CD TRSP_RAIL_SCG_NM
                              ,A.COM_SCG_APLY_FLG
                              ,A.WO_APLY_FLG
                              ,DECODE(A.FM_NOD_CD, '00', '', A.FM_NOD_CD) AS FM_NOD_CD
                              ,DECODE(A.TO_NOD_CD, '00', '', A.TO_NOD_CD) AS TO_NOD_CD
                              ,'Fixed' AS AGMT_SCG_RT_DIV_CD
                              ,A.TRSP_RAIL_RTO AS TRSP_RAIL_RTO
                              ,DECODE(A.CURR_CD, 'XXX', NULL, A.CURR_CD) AS CURR_CD
                              ,A.FX_SCG_ALL_RT AS FX_SCG_ALL_RT
                              ,A.FX_SCG_20FT_RT AS FX_SCG_20FT_RT
                              ,A.FX_SCG_40FT_RT AS FX_SCG_40FT_RT
                              ,A.FX_SCG_45FT_RT AS FX_SCG_45FT_RT
                               /* APPLIED AMOUNT */
                              ,A.SPCL_CGO_CNTR_TP_CD
                              ,A.AGMT_EQ_SZ_NO2 AS AGMT_EQ_SZ_NO
                              ,A.LBS_OVR_WGT
                              ,DECODE(A.TRSP_RAIL_SCG_CD, 'OWS', 'LBS', NULL) WGT_MEAS_UT_CD
                              ,A.USR_DEF_RMK
                              ,A.CGO_TP_CD
                              ,A.TRSP_AGMT_SCG_SEQ AS TRSP_AGMT_SCG_SEQ
                              ,A.NUM_VAL
                              ,'XXXXXX' AS COM_SCG_KND_CD
                              ,-1 AS COM_SCG_SEQ
                              ,NULL AS RAIL_RTO_NO
                              ,A.EFF_FM_DT
                              ,A.EFF_TO_DT
                         FROM (                        
                                SELECT B.AGMT_EQ_SZ_NO2
                                      ,B.NUM_VAL
                                      ,A.* 
                                  FROM TRS_AGMT_RAIL_SCG_RT A
                                      ,(SELECT * 
                                          FROM (
                                                  SELECT TRSP_AGMT_SCG_SEQ
                                                        ,AGMT_EQ_SZ_NO2
                                                        ,NUM_VAL
                                                    FROM TRS_AGMT_RAIL_SCG_RT
                                                  UNPIVOT INCLUDE NULLS
                                                          (NUM_VAL FOR AGMT_EQ_SZ_NO2 IN (FX_SCG_ALL_RT AS 'AL',
                                                                                          FX_SCG_20FT_RT AS '20',
                                                                                          FX_SCG_40FT_RT AS '40',
                                                                                          FX_SCG_45FT_RT AS '45')
                                                          )
                                                  WHERE 1=1
                                                    AND TRSP_RAIL_SCG_CD NOT IN ('FSG')
                                               )
                                         WHERE NUM_VAL IS NOT NULL
                                           AND AGMT_EQ_SZ_NO2 IN ( 
                                                                    (CASE WHEN SUBSTR(@[eq_tp_sz_cd], 2, 1) = '2' OR SUBSTR(@[eq_tp_sz_cd], 2, 1) = '3' THEN '20'
                                                                          WHEN SUBSTR(@[eq_tp_sz_cd], 2, 1) = '4' OR SUBSTR(@[eq_tp_sz_cd], 2, 1) = '5' THEN '40'
                                                                          WHEN SUBSTR(@[eq_tp_sz_cd], 2, 1) = '6' OR SUBSTR(@[eq_tp_sz_cd], 2, 1) = '7' THEN '45'
                                                                     END), 
                                                                     'AL'
                                                                 )
                                       ) B
                                 WHERE A.TRSP_AGMT_SCG_SEQ = B.TRSP_AGMT_SCG_SEQ
                                   AND TRSP_RAIL_SCG_CD != 'FSG'
                                   AND (   A.SPCL_CGO_CNTR_TP_CD IS NULL 
                                        OR 
                                           CASE WHEN @[spcl_cgo_cntr_tp_cd] IS NULL THEN A.SPCL_CGO_CNTR_TP_CD
                                                WHEN @[spcl_cgo_cntr_tp_cd] NOT IN ('DG', 'AD', 'RD') THEN A.SPCL_CGO_CNTR_TP_CD
                                                ELSE @[spcl_cgo_cntr_tp_cd]
                                           END = A.SPCL_CGO_CNTR_TP_CD
                                       )
                              ) A
                             ,MDM_VENDOR C
                             ,TRS_TRSP_RAIL_BIL_VNDR_SET G
                        WHERE 1=1
                          AND A.VNDR_SEQ = C.VNDR_SEQ
                          AND A.TRSP_RAIL_SCG_CD IS NOT NULL
                          AND NVL(A.FM_NOD_CD, '00') = DECODE(LENGTH(NVL(A.FM_NOD_CD, '00')), 7, G.FM_NOD_CD, 5, SUBSTR(G.FM_NOD_CD, 1, 5), '00')
                          AND NVL(A.TO_NOD_CD, '00') = DECODE(LENGTH(NVL(A.TO_NOD_CD, '00')), 7, G.TO_NOD_CD, 5, SUBSTR(G.TO_NOD_CD, 1, 5), '00')
                          AND NVL(A.CGO_TP_CD, DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')) = DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')
                          AND NVL(A.LBS_OVR_WGT, 0) <= NVL(@[wgt_qty], 1)
                          AND G.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                          AND G.TRSP_SO_SEQ = @[trsp_so_seq]
                          AND A.VNDR_SEQ = G.VNDR_SEQ
               )
	) AGMT
  , (
	    SELECT A.TRSP_SO_OFC_CTY_CD,A.TRSP_SO_SEQ,A.SUB_RAIL_SEQ,A.VNDR_SEQ,A.TRSP_AGMT_OFC_CTY_CD,A.TRSP_AGMT_SEQ, @[eq_tp_sz_cd] AS EQ_TPSZ_CD, B.TRSP_AGMT_SCG_SEQ,
	           B.TRSP_RAIL_SCG_CD, B.SCG_APLY_AMT AS NUM_VAL
              ,NVL(B.COM_SCG_KND_CD, 'XXXXXX') AS COM_SCG_KND_CD
              ,NVL(B.COM_SCG_SEQ, -1) AS COM_SCG_SEQ
	      FROM TRS_TRSP_RAIL_BIL_VNDR_SET A
	          ,TRS_RAIL_BIL_VNDR_SET_APLY B
	     WHERE 1=1    
	       AND A.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
	       AND A.TRSP_SO_SEQ = @[trsp_so_seq]
	       AND A.TRSP_SO_OFC_CTY_CD = B.TRSP_SO_OFC_CTY_CD
	       AND A.TRSP_SO_SEQ = B.TRSP_SO_SEQ
	       AND A.SUB_RAIL_SEQ = B.SUB_RAIL_SEQ
	) APLD
   ,TRS_TRSP_RAIL_BIL_VNDR_SET VNDR
WHERE 1=1
  AND SUBSTR(AGMT.AGMT_NO,1,3) = APLD.TRSP_AGMT_OFC_CTY_CD(+)
  AND SUBSTR(AGMT.AGMT_NO,4) = APLD.TRSP_AGMT_SEQ(+)
  AND AGMT.VNDR_SEQ = APLD.VNDR_SEQ(+)
  AND AGMT.TRSP_RAIL_SCG_CD = APLD.TRSP_RAIL_SCG_CD(+)
  AND AGMT.TRSP_AGMT_SCG_SEQ = APLD.TRSP_AGMT_SCG_SEQ(+)
  AND AGMT.COM_SCG_KND_CD = APLD.COM_SCG_KND_CD(+)
  AND AGMT.COM_SCG_SEQ = APLD.COM_SCG_SEQ(+)
  AND VNDR.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
  AND VNDR.TRSP_SO_SEQ = @[trsp_so_seq]
  AND SUBSTR(AGMT.AGMT_NO,1,3) = VNDR.TRSP_AGMT_OFC_CTY_CD
  AND SUBSTR(AGMT.AGMT_NO,4) = VNDR.TRSP_AGMT_SEQ
  AND AGMT.VNDR_SEQ = VNDR.VNDR_SEQ
  AND AGMT.TRSP_AGMT_SCG_SEQ = APLD.TRSP_AGMT_SCG_SEQ
-----------------------------------------------------------------------------------------------------------------
UNION
-----------------------------------------------------------------------------------------------------------------
SELECT AGMT.VNDR_SEQ, AGMT.VNDR_NM, AGMT.AGMT_NO, AGMT.TRSP_RAIL_SCG_CD, AGMT.COM_SCG_APLY_FLG, AGMT.WO_APLY_FLG, AGMT.FM_NOD_CD, AGMT.TO_NOD_CD, 
       AGMT.AGMT_SCG_RT_DIV_CD, AGMT.TRSP_RAIL_RTO, AGMT.CURR_CD, AGMT.NUM_VAL AS TRSP_RT, AGMT.TRSP_AGMT_SCG_SEQ,
       AGMT.CGO_TP_CD, AGMT.AGMT_EQ_SZ_NO, AGMT.LBS_OVR_WGT, AGMT.WGT_MEAS_UT_CD, AGMT.USR_DEF_RMK,
       DECODE(AGMT.COM_SCG_KND_CD,'XXXXXX', NULL, AGMT.COM_SCG_KND_CD) AS COM_SCG_KND_CD,
       DECODE(AGMT.COM_SCG_SEQ,-1, NULL, AGMT.COM_SCG_SEQ) AS COM_SCG_SEQ,
       AGMT.SPCL_CGO_CNTR_TP_CD,
       VNDR.SUB_RAIL_SEQ, APLD.NUM_VAL APPL_RT, APLD.NUM_VAL APPL_RT_HIDDEN, DECODE(APLD.NUM_VAL, NULL, '0', '1') IBCHK,
       @[trsp_so_ofc_cty_cd] AS TRSP_SO_OFC_CTY_CD, @[trsp_so_seq] AS TRSP_SO_SEQ,
       VNDR.BZC_AMT, AGMT.RAIL_RTO_NO,
       AGMT.EFF_FM_DT,AGMT.EFF_TO_DT, APLD.TRSP_AGMT_SCG_SEQ TRSP_AGMT_SCG_SEQ2,
       CASE WHEN SUBSTR(@[basis_dt],1,8) BETWEEN TO_CHAR(AGMT.EFF_FM_DT,'YYYYMMDD') AND TO_CHAR(AGMT.EFF_TO_DT,'YYYYMMDD') THEN ''
            ELSE 'Not Matched'
       END RATE_STS
FROM (
        SELECT * 
          FROM (
                        /* FSG-NOT COMMON */
                        SELECT A.VNDR_SEQ AS VNDR_SEQ
                              ,C.VNDR_LGL_ENG_NM AS VNDR_NM
                              ,A.TRSP_AGMT_OFC_CTY_CD||A.TRSP_AGMT_SEQ AS AGMT_NO
                              ,A.TRSP_RAIL_SCG_CD
                              ,A.TRSP_RAIL_SCG_CD TRSP_RAIL_SCG_NM
                              ,A.COM_SCG_APLY_FLG
                              ,A.WO_APLY_FLG
                              ,DECODE(A.FM_NOD_CD, '00', '', A.FM_NOD_CD) AS FM_NOD_CD
                              ,DECODE(A.TO_NOD_CD, '00', '', A.TO_NOD_CD) AS TO_NOD_CD
                              ,'Ratio' AS AGMT_SCG_RT_DIV_CD
                              ,A.TRSP_RAIL_RTO AS TRSP_RAIL_RTO
                              ,@[curr_cd] AS CURR_CD
                              ,A.FX_SCG_ALL_RT AS FX_SCG_ALL_RT
                              ,A.FX_SCG_20FT_RT AS FX_SCG_20FT_RT
                              ,A.FX_SCG_40FT_RT AS FX_SCG_40FT_RT
                              ,A.FX_SCG_45FT_RT AS FX_SCG_45FT_RT
                               /* APPLIED AMOUNT */
                              ,A.SPCL_CGO_CNTR_TP_CD
                              ,A.AGMT_EQ_SZ_NO2 AS AGMT_EQ_SZ_NO
                              ,A.LBS_OVR_WGT
                              ,DECODE(A.TRSP_RAIL_SCG_CD, 'OWS', 'LBS', NULL) WGT_MEAS_UT_CD
                              ,A.USR_DEF_RMK
                              ,A.CGO_TP_CD
                              ,A.TRSP_AGMT_SCG_SEQ AS TRSP_AGMT_SCG_SEQ
                              ,A.NUM_VAL
                              ,'XXXXXX' AS COM_SCG_KND_CD
                              ,-1 AS COM_SCG_SEQ
                              ,A.RAIL_RTO_NO
                              ,A.EFF_FM_DT
                              ,A.EFF_TO_DT
                         FROM (
                                SELECT 'AL' AS AGMT_EQ_SZ_NO2
                                      ,NULL AS NUM_VAL
                                      ,A.* 
                                  FROM TRS_AGMT_RAIL_SCG_RT A
                                 WHERE TRSP_RAIL_SCG_CD = 'FSG'
                                   AND NVL(COM_SCG_APLY_FLG, '0') = '0'
                                   AND TRSP_RAIL_SCG_CD IS NOT NULL
                                   AND SUBSTR(@[basis_dt],1,8) BETWEEN TO_CHAR(EFF_FM_DT,'YYYYMMDD') AND TO_CHAR(EFF_TO_DT,'YYYYMMDD')
                                   AND NVL(CGO_TP_CD, DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')) = DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')
                              ) A
                             ,MDM_VENDOR C
                             ,TRS_TRSP_RAIL_BIL_VNDR_SET G
                        WHERE 1=1
                          AND A.VNDR_SEQ = C.VNDR_SEQ
                          AND NVL(A.FM_NOD_CD, '00') = DECODE(LENGTH(NVL(A.FM_NOD_CD, '00')), 7, G.FM_NOD_CD, 5, SUBSTR(G.FM_NOD_CD, 1, 5), '00')
                          AND NVL(A.TO_NOD_CD, '00') = DECODE(LENGTH(NVL(A.TO_NOD_CD, '00')), 7, G.TO_NOD_CD, 5, SUBSTR(G.TO_NOD_CD, 1, 5), '00')
                          AND G.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                          AND G.TRSP_SO_SEQ = @[trsp_so_seq]
                          AND A.VNDR_SEQ = G.VNDR_SEQ
                        UNION ALL
                        /* FSG-COMMON 2 */
                        SELECT F.VNDR_SEQ AS VNDR_SEQ
                              ,C.VNDR_LGL_ENG_NM AS VNDR_NM
                              ,F.TRSP_AGMT_OFC_CTY_CD||F.TRSP_AGMT_SEQ AS AGMT_NO
                              ,F.TRSP_RAIL_SCG_CD
                              ,F.TRSP_RAIL_SCG_CD TRSP_RAIL_SCG_NM
                              ,F.COM_SCG_APLY_FLG
                              ,F.WO_APLY_FLG
                              ,DECODE(F.FM_NOD_CD, '00', '', F.FM_NOD_CD) AS FM_NOD_CD
                              ,DECODE(F.TO_NOD_CD, '00', '', F.TO_NOD_CD) AS TO_NOD_CD
                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN 'Fixed'
                                    ELSE 'Ratio'
                               END AS AGMT_SCG_RT_DIV_CD
                              ,F.TRSP_ONE_WY_RT AS TRSP_RAIL_RTO
                              ,@[curr_cd] AS CURR_CD
                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN F.TRSP_ONE_WY_RT
                                    ELSE NULL
                               END AS FX_SCG_ALL_RT
                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN F.TRSP_ONE_WY_RT
                                    ELSE NULL
                               END AS FX_SCG_20FT_RT
                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN F.TRSP_ONE_WY_RT
                                    ELSE NULL
                               END AS FX_SCG_40FT_RT
                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN F.TRSP_ONE_WY_RT
                                    ELSE NULL
                               END AS FX_SCG_45FT_RT
                               /* APPLIED AMOUNT */
                              ,F.SPCL_CGO_CNTR_TP_CD
                              ,F.AGMT_EQ_SZ_NO AS AGMT_EQ_SZ_NO
                              ,0 AS LBS_OVR_WGT
                              ,NULL AS WGT_MEAS_UT_CD
                              ,F.USR_DEF_RMK
                              ,F.CGO_TP_CD
                              ,F.TRSP_AGMT_SCG_SEQ AS TRSP_AGMT_SCG_SEQ
                              ,NULL AS NUM_VAL
                              ,F.COM_SCG_KND_CD
                              ,F.COM_SCG_SEQ
                              ,F.RAIL_RTO_NO
                              ,F.EFF_FM_DT
                              ,F.EFF_TO_DT
                         FROM MDM_VENDOR C
                             ,(SELECT COM_SCG_KND_CD
                                     ,EQ_TPSZ_CD AS TRSP_AGMT_EQ_TP_SZ_CD
                                     ,CURR_CD
                                     ,RT_TP_CD AS AGMT_SCG_RT_DIV_CD
                                     ,NVL(ONE_WY_RT, RND_RT) TRSP_ONE_WY_RT
                                     ,0 TRSP_RND_RT
                                     ,NVL(ONE_WY_RT, RND_RT) ETC_ADD_AMT
                                     ,AGMT_EQ_SZ_NO AS AGMT_EQ_SZ_NO
                                     ,EQ_TPSZ_CD AS EQ_TPSZ_CD
                                     ,COM_SCG_SEQ
                                     ,TRSP_SO_OFC_CTY_CD
                                     ,TRSP_SO_SEQ
                                     ,SUB_RAIL_SEQ
                                     ,VNDR_SEQ
                                     ,TRSP_AGMT_SCG_SEQ
                                     ,USR_DEF_RMK
                                     ,CGO_TP_CD
                                     ,SPCL_CGO_CNTR_TP_CD
                                     ,FM_NOD_CD
                                     ,TO_NOD_CD
                                     ,TRSP_AGMT_OFC_CTY_CD
                                     ,TRSP_AGMT_SEQ
                                     ,TRSP_RAIL_SCG_CD
                                     ,COM_SCG_APLY_FLG
                                     ,WO_APLY_FLG
                                     ,RAIL_RTO_NO
                                     ,EFF_FM_DT
                                     ,EFF_TO_DT
                                 FROM (
                                         SELECT 'FSG' AS COM_SCG_KND_CD
                                               ,ONE_WY_RT
                                               ,RND_RT
                                               ,EQ_TPSZ_CD
                                               ,CSM.CURR_CD
                                               ,RT_TP_CD
                                               ,CASE WHEN SUBSTR(EQ_TPSZ_CD, 1, 2) = 'AL' THEN
                                                            CASE SUBSTR(EQ_TPSZ_CD, 3, 1) WHEN '2' THEN '20'
                                                                                          WHEN '3' THEN '20'
                                                                                          WHEN '4' THEN '40'
                                                                                          WHEN '5' THEN '40'
                                                                                          WHEN '6' THEN '45'
                                                                                          WHEN '7' THEN '45'
                                                                                          ELSE 'AL'
                                                            END
                                                     WHEN SUBSTR(EQ_TPSZ_CD, 1, 2) <> 'AL' THEN
                                                            CASE SUBSTR(EQ_TPSZ_CD, 2, 1) WHEN '2' THEN '20'
                                                                                          WHEN '3' THEN '20'
                                                                                          WHEN '4' THEN '40'
                                                                                          WHEN '5' THEN '40'
                                                                                          WHEN '6' THEN '45'
                                                                                          WHEN '7' THEN '45'
                                                                                          ELSE 'AL'
                                                            END
                                                END AS AGMT_EQ_SZ_NO
                                               ,COM_SCG_SEQ
                                               ,RBVS.TRSP_SO_OFC_CTY_CD
                                               ,RBVS.TRSP_SO_SEQ
                                               ,RBVS.SUB_RAIL_SEQ
                                               ,RBVS.VNDR_SEQ
                                               ,A.TRSP_AGMT_SCG_SEQ
                                               ,A.USR_DEF_RMK
                                               ,A.CGO_TP_CD
                                               ,A.SPCL_CGO_CNTR_TP_CD
                                               ,A.FM_NOD_CD
                                               ,A.TO_NOD_CD
                                               ,A.TRSP_AGMT_OFC_CTY_CD
                                               ,A.TRSP_AGMT_SEQ
                                               ,A.TRSP_RAIL_SCG_CD
                                               ,A.COM_SCG_APLY_FLG
                                               ,A.WO_APLY_FLG
                                               ,A.RAIL_RTO_NO
                                               ,A.EFF_FM_DT
                                               ,A.EFF_TO_DT
                                           FROM TRS_COM_SCG_MGMT CSM
                                               ,(
                                                     SELECT 'AL' AS AGMT_EQ_SZ_NO2
                                                           ,A.* 
                                                       FROM TRS_AGMT_RAIL_SCG_RT A
                                                      WHERE TRSP_RAIL_SCG_CD = 'FSG'
                                                        AND NVL(A.COM_SCG_APLY_FLG, '0') = '1'
                                                        AND A.TRSP_RAIL_SCG_CD IS NOT NULL
                                                        AND SUBSTR(@[basis_dt],1,8) BETWEEN TO_CHAR(A.EFF_FM_DT,'YYYYMMDD') AND TO_CHAR(A.EFF_TO_DT,'YYYYMMDD')
                                                        AND NVL(A.CGO_TP_CD, DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')) = DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')
                                                ) A
                                               ,(
                                                    SELECT TRSP_SO_OFC_CTY_CD
                                                          ,TRSP_SO_SEQ
                                                          ,SUB_RAIL_SEQ
                                                          ,VNDR_SEQ
                                                          ,FM_NOD_CD
                                                          ,TO_NOD_CD 
                                                      FROM TRS_TRSP_RAIL_BIL_VNDR_SET
                                                     WHERE 1=1
                                                       AND TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                                                       AND TRSP_SO_SEQ = @[trsp_so_seq]
                                                ) RBVS
                                          WHERE 1=1
                                            AND TRSP_COST_MOD_CD = 'CY'
                                            AND AGMT_TRSP_TP_CD  = 'RD'
                                            AND (SCC_CD = MST_LOC_FNC(SUBSTR(RBVS.FM_NOD_CD, 1, 5),'SCC') OR
                                                 LCC_CD IN (MST_LOC_FNC(SUBSTR(RBVS.FM_NOD_CD, 1, 5),'LCC')) OR
                                                 RCC_CD IN (MST_LOC_FNC(SUBSTR(RBVS.FM_NOD_CD, 1, 5),'RCC'))
                                                )
                                            AND NVL(CSM.CGO_TP_CD, DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')) = DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')
                                            AND NVL(CSM.BND_CD, NVL(@[bound_cd],'X')) = NVL(@[bound_cd],'X')
                                            AND CSM.COM_SCG_KND_CD = 'SCFAAL'
                                            AND SUBSTR(@[basis_dt],1,8) BETWEEN TO_CHAR(CSM.EFF_FM_DT,'YYYYMMDD') AND TO_CHAR(CSM.EFF_TO_DT,'YYYYMMDD')                                            
                                            AND NVL(A.FM_NOD_CD, '00') = DECODE(LENGTH(NVL(A.FM_NOD_CD, '00')), 7, RBVS.FM_NOD_CD, 5, SUBSTR(RBVS.FM_NOD_CD, 1, 5), '00')
                                            AND NVL(A.TO_NOD_CD, '00') = DECODE(LENGTH(NVL(A.TO_NOD_CD, '00')), 7, RBVS.TO_NOD_CD, 5, SUBSTR(RBVS.TO_NOD_CD, 1, 5), '00')
                                            AND RBVS.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                                            AND RBVS.TRSP_SO_SEQ = @[trsp_so_seq]
                                            AND A.VNDR_SEQ = RBVS.VNDR_SEQ
                                      )
                               ) F
                        WHERE 1=1
                          AND F.VNDR_SEQ = C.VNDR_SEQ
                        UNION ALL
                        /* ETC */
                        SELECT A.VNDR_SEQ AS VNDR_SEQ
                              ,C.VNDR_LGL_ENG_NM AS VNDR_NM
                              ,A.TRSP_AGMT_OFC_CTY_CD||A.TRSP_AGMT_SEQ AS AGMT_NO
                              ,A.TRSP_RAIL_SCG_CD
                              ,A.TRSP_RAIL_SCG_CD TRSP_RAIL_SCG_NM
                              ,A.COM_SCG_APLY_FLG
                              ,A.WO_APLY_FLG
                              ,DECODE(A.FM_NOD_CD, '00', '', A.FM_NOD_CD) AS FM_NOD_CD
                              ,DECODE(A.TO_NOD_CD, '00', '', A.TO_NOD_CD) AS TO_NOD_CD
                              ,'Fixed' AS AGMT_SCG_RT_DIV_CD
                              ,A.TRSP_RAIL_RTO AS TRSP_RAIL_RTO
                              ,DECODE(A.CURR_CD, 'XXX', NULL, A.CURR_CD) AS CURR_CD
                              ,A.FX_SCG_ALL_RT AS FX_SCG_ALL_RT
                              ,A.FX_SCG_20FT_RT AS FX_SCG_20FT_RT
                              ,A.FX_SCG_40FT_RT AS FX_SCG_40FT_RT
                              ,A.FX_SCG_45FT_RT AS FX_SCG_45FT_RT
                               /* APPLIED AMOUNT */
                              ,A.SPCL_CGO_CNTR_TP_CD
                              ,A.AGMT_EQ_SZ_NO2 AS AGMT_EQ_SZ_NO
                              ,A.LBS_OVR_WGT
                              ,DECODE(A.TRSP_RAIL_SCG_CD, 'OWS', 'LBS', NULL) WGT_MEAS_UT_CD
                              ,A.USR_DEF_RMK
                              ,A.CGO_TP_CD
                              ,A.TRSP_AGMT_SCG_SEQ AS TRSP_AGMT_SCG_SEQ
                              ,A.NUM_VAL
                              ,'XXXXXX' AS COM_SCG_KND_CD
                              ,-1 AS COM_SCG_SEQ
                              ,NULL AS RAIL_RTO_NO
                              ,A.EFF_FM_DT
                              ,A.EFF_TO_DT
                         FROM (                        
                                SELECT B.AGMT_EQ_SZ_NO2
                                      ,B.NUM_VAL
                                      ,A.* 
                                  FROM TRS_AGMT_RAIL_SCG_RT A
                                      ,(SELECT * 
                                          FROM (
                                                  SELECT TRSP_AGMT_SCG_SEQ
                                                        ,AGMT_EQ_SZ_NO2
                                                        ,NUM_VAL
                                                    FROM TRS_AGMT_RAIL_SCG_RT
                                                  UNPIVOT INCLUDE NULLS
                                                          (NUM_VAL FOR AGMT_EQ_SZ_NO2 IN (FX_SCG_ALL_RT AS 'AL',
                                                                                          FX_SCG_20FT_RT AS '20',
                                                                                          FX_SCG_40FT_RT AS '40',
                                                                                          FX_SCG_45FT_RT AS '45')
                                                          )
                                                  WHERE 1=1
                                                    AND TRSP_RAIL_SCG_CD NOT IN ('FSG')
                                               )
                                         WHERE NUM_VAL IS NOT NULL
                                           AND AGMT_EQ_SZ_NO2 IN ( 
                                                                    (CASE WHEN SUBSTR(@[eq_tp_sz_cd], 2, 1) = '2' OR SUBSTR(@[eq_tp_sz_cd], 2, 1) = '3' THEN '20'
                                                                          WHEN SUBSTR(@[eq_tp_sz_cd], 2, 1) = '4' OR SUBSTR(@[eq_tp_sz_cd], 2, 1) = '5' THEN '40'
                                                                          WHEN SUBSTR(@[eq_tp_sz_cd], 2, 1) = '6' OR SUBSTR(@[eq_tp_sz_cd], 2, 1) = '7' THEN '45'
                                                                     END), 
                                                                     'AL'
                                                                 )
                                       ) B
                                 WHERE A.TRSP_AGMT_SCG_SEQ = B.TRSP_AGMT_SCG_SEQ
                                   AND TRSP_RAIL_SCG_CD != 'FSG'
                                   AND (   A.SPCL_CGO_CNTR_TP_CD IS NULL 
                                        OR 
                                           CASE WHEN @[spcl_cgo_cntr_tp_cd] IS NULL THEN A.SPCL_CGO_CNTR_TP_CD
                                                WHEN @[spcl_cgo_cntr_tp_cd] NOT IN ('DG', 'AD', 'RD') THEN A.SPCL_CGO_CNTR_TP_CD
                                                ELSE @[spcl_cgo_cntr_tp_cd]
                                           END = A.SPCL_CGO_CNTR_TP_CD
                                       )
                              ) A
                             ,MDM_VENDOR C
                             ,TRS_TRSP_RAIL_BIL_VNDR_SET G
                        WHERE 1=1
                          AND A.VNDR_SEQ = C.VNDR_SEQ
                          AND A.TRSP_RAIL_SCG_CD IS NOT NULL
                          AND NVL(A.FM_NOD_CD, '00') = DECODE(LENGTH(NVL(A.FM_NOD_CD, '00')), 7, G.FM_NOD_CD, 5, SUBSTR(G.FM_NOD_CD, 1, 5), '00')
                          AND NVL(A.TO_NOD_CD, '00') = DECODE(LENGTH(NVL(A.TO_NOD_CD, '00')), 7, G.TO_NOD_CD, 5, SUBSTR(G.TO_NOD_CD, 1, 5), '00')
                          AND SUBSTR(@[basis_dt],1,8) BETWEEN TO_CHAR(A.EFF_FM_DT,'YYYYMMDD') AND TO_CHAR(A.EFF_TO_DT,'YYYYMMDD')
                          AND NVL(A.CGO_TP_CD, DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')) = DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')
                          AND NVL(A.LBS_OVR_WGT, 0) <= NVL(@[wgt_qty], 1)
                          AND G.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                          AND G.TRSP_SO_SEQ = @[trsp_so_seq]
                          AND A.VNDR_SEQ = G.VNDR_SEQ
               )
	) AGMT
  , (
	    SELECT A.TRSP_SO_OFC_CTY_CD,A.TRSP_SO_SEQ,A.SUB_RAIL_SEQ,A.VNDR_SEQ,A.TRSP_AGMT_OFC_CTY_CD,A.TRSP_AGMT_SEQ, @[eq_tp_sz_cd] AS EQ_TPSZ_CD, B.TRSP_AGMT_SCG_SEQ,
	           B.TRSP_RAIL_SCG_CD, B.SCG_APLY_AMT AS NUM_VAL
              ,NVL(B.COM_SCG_KND_CD, 'XXXXXX') AS COM_SCG_KND_CD
              ,NVL(B.COM_SCG_SEQ, -1) AS COM_SCG_SEQ
	      FROM TRS_TRSP_RAIL_BIL_VNDR_SET A
	          ,TRS_RAIL_BIL_VNDR_SET_APLY B
	     WHERE 1=1    
	       AND A.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
	       AND A.TRSP_SO_SEQ = @[trsp_so_seq]
	       AND A.TRSP_SO_OFC_CTY_CD = B.TRSP_SO_OFC_CTY_CD
	       AND A.TRSP_SO_SEQ = B.TRSP_SO_SEQ
	       AND A.SUB_RAIL_SEQ = B.SUB_RAIL_SEQ
	) APLD
   ,TRS_TRSP_RAIL_BIL_VNDR_SET VNDR
WHERE 1=1
  AND SUBSTR(AGMT.AGMT_NO,1,3) = APLD.TRSP_AGMT_OFC_CTY_CD(+)
  AND SUBSTR(AGMT.AGMT_NO,4) = APLD.TRSP_AGMT_SEQ(+)
  AND AGMT.VNDR_SEQ = APLD.VNDR_SEQ(+)
  AND AGMT.TRSP_RAIL_SCG_CD = APLD.TRSP_RAIL_SCG_CD(+)
  AND AGMT.TRSP_AGMT_SCG_SEQ = APLD.TRSP_AGMT_SCG_SEQ(+)
  AND AGMT.COM_SCG_KND_CD = APLD.COM_SCG_KND_CD(+)
  AND AGMT.COM_SCG_SEQ = APLD.COM_SCG_SEQ(+)
  AND VNDR.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
  AND VNDR.TRSP_SO_SEQ = @[trsp_so_seq]
  AND SUBSTR(AGMT.AGMT_NO,1,3) = VNDR.TRSP_AGMT_OFC_CTY_CD
  AND SUBSTR(AGMT.AGMT_NO,4) = VNDR.TRSP_AGMT_SEQ
  AND AGMT.VNDR_SEQ = VNDR.VNDR_SEQ
)
ORDER BY SUB_RAIL_SEQ, AGMT_NO, TRSP_RAIL_SCG_CD, TRSP_AGMT_SCG_SEQ2 ASC NULLS LAST, TRSP_AGMT_SCG_SEQ			]]></sql>
			<params>
				<param name="trsp_so_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="trsp_so_seq" type="12" value="" out="N"/>
				<param name="basis_dt" type="12" value="" out="N"/>
				<param name="curr_cd" type="12" value="" out="N"/>
				<param name="cgo_tp_cd" type="12" value="" out="N"/>
				<param name="bound_cd" type="12" value="" out="N"/>
				<param name="eq_tp_sz_cd" type="12" value="" out="N"/>
				<param name="spcl_cgo_cntr_tp_cd" type="12" value="" out="N"/>
				<param name="wgt_qty" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
