<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EvaluationGroupTerminalKpiManageDBDAOSearchEGTerminalKpiManageRSQL">
			<desc><![CDATA[Terminal Productivity]]></desc>
			<sql><![CDATA[
SELECT 
      B.EV_YR,  
      B.EG_ID,
      B.EG_ID_SEQ,
      A.REG_GROUP,
      A.OFC_CD,
      Y.YD_CD,
      Y.YD_NM,
      B.VNDR_SEQ,
      A.VNDR_LGL_ENG_NM,
      '' AS PER,
      '' AS TARGET,
      B.KPI_TGT_RTO||DECODE(B.KPI_UT_CD, 'PC', '%' , 'PO', 'PT' , 'MM', 'MM') AS KPI_TGT_RTO,
      B.KPI_UT_CD,
      M.KPI_WGT_RTO,
      A.ENG_VNDR_RMK
FROM (
      SELECT D.EG_ID,
            D.EG_ID_SEQ,
            A.OFC_CD,
            DECODE(B.CONTI_CD, 'F', 'HAM', 'E', 'HAM', 'M', 'NYC', 'A', 'SHA') AS REG_GROUP ,
            V.VNDR_SEQ,
            V.VNDR_LGL_ENG_NM,
            D.ENG_VNDR_RMK
      FROM MDM_ORGANIZATION A,
           MDM_LOCATION B,
           MDM_VENDOR V,
           SPE_EV_GRP_SVC_PROV_MTCH D
      WHERE A.LOC_CD = B.LOC_CD
        AND A.DELT_FLG <> 'Y'
        AND V.OFC_CD = A.OFC_CD
        AND V.VNDR_SEQ = D.VNDR_SEQ 
      ) A,
    SPE_EV_GRP_TML_KPI_TGT_RTO B,
    MDM_YARD Y,
    SPE_EV_GRP_KPI_TGT_RTO M
WHERE A.EG_ID||A.EG_ID_SEQ = B.EG_ID||B.EG_ID_SEQ
  AND A.VNDR_SEQ = B.VNDR_SEQ
  AND B.YD_CD    = Y.YD_CD
  AND B.EV_YR    = M.EV_YR
  AND B.YD_CD    = UPPER(@[yd_cd])
  AND A.VNDR_SEQ = TO_NUMBER(@[vndr_seq])
  AND B.EV_YR    = @[ev_yr]
  AND A.EG_ID||A.EG_ID_SEQ = M.EG_ID||M.EG_ID_SEQ
  AND M.SP_KPI_CD = 'TMLP'
UNION ALL  
SELECT 
      M.EV_YR,
      D.EG_ID,
      D.EG_ID_SEQ,
      DECODE(B.CONTI_CD, 'F', 'HAM', 'E', 'HAM', 'M', 'NYC', 'A', 'SHA') AS REG_GROUP,
      A.OFC_CD,
      Y.YD_CD,
      Y.YD_NM,
      V.VNDR_SEQ,
      V.VNDR_LGL_ENG_NM,
      '' AS PER,
      '' AS TARGET,
      '' AS KPI_TGT_RTO,
      '' AS KPI_UT_CD,
      DECODE( M.SP_KPI_CD, 'TMLP', M.KPI_WGT_RTO, 0),
      D.ENG_VNDR_RMK
FROM MDM_ORGANIZATION A,
     MDM_LOCATION B,
     MDM_VENDOR V,
     SPE_EV_GRP_SVC_PROV_MTCH D,
     MDM_YARD Y,
     SPE_EV_GRP_KPI_TGT_RTO M
WHERE A.LOC_CD  = B.LOC_CD
  AND A.DELT_FLG <> 'Y'
  AND V.OFC_CD  = A.OFC_CD
  AND V.VNDR_SEQ = D.VNDR_SEQ
  AND M.EV_YR =  @[ev_yr]
  AND V.VNDR_SEQ = TO_NUMBER(@[vndr_seq])
  AND YD_CD = UPPER(@[yd_cd])
  AND M.SP_KPI_CD = 'TMLP'
  AND D.EG_ID||D.EG_ID_SEQ = M.EG_ID||M.EG_ID_SEQ
  AND D.EG_ID||D.EG_ID_SEQ||'TMLP' NOT IN (  SELECT D.EG_ID||D.EG_ID_SEQ||D.SP_KPI_CD
                                             FROM SPE_EV_GRP_TML_KPI_TGT_RTO D
                                             WHERE EV_YR = @[ev_yr]
                                               AND YD_CD = UPPER(@[yd_cd])
                                               AND VNDR_SEQ = TO_NUMBER(@[vndr_seq])
                                               AND SP_KPI_CD = 'TMLP' )			]]></sql>
			<params>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="vndr_seq" type="2" value="" out="N"/>
				<param name="ev_yr" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
