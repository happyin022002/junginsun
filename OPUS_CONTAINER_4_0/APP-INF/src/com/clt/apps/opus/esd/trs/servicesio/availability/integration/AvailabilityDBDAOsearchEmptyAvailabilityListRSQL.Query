<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AvailabilityDBDAOsearchEmptyAvailabilityListRSQL">
			<desc><![CDATA[search Empty Availability List]]></desc>
			<sql><![CDATA[
select
       x.eq_no
       ,x.eq_tpsz_cd
       ,x.cntr_tpsz_iso_cd
       ,x.iso_nm
       ,x.dor_nod_cd
       ,x.dor_nod_name
       ,x.dor_loc_nm
       ,x.dor_yd_addr
       ,x.dor_zip_cd
       ,x.dor_fctry_nm
       ,x.dor_ofc_eng_nm
       ,x.dor_phn_no
       ,x.to_nod_cd
       ,x.to_loc_nm
       ,x.to_nod_name
       ,x.to_yd_addr
       ,x.to_zip_cd
       ,x.to_ofc_eng_nm
       ,x.to_phn_no
       ,x.avb_sts
       ,x.avb_dt
       ,x.firt_free_dt
       ,x.last_free_dt
       ,x.wo_vndr_seq
       ,x.cop_fsh_dt
from (
	select /*+ ordered(a b d e f g) use_nl(e b a d f g) */
	       b.eq_no
	       ,b.eq_tpsz_cd
	       ,(SELECT cntr_tpsz_iso_cd FROM mdm_cntr_tp_sz WHERE cntr_tpsz_cd = b.eq_tpsz_cd) cntr_tpsz_iso_cd
	       ,(SELECT iso_cntr_tpsz_nm
	          FROM mst_iso_cntr_tp_sz
	         WHERE iso_cntr_tpsz_cd = (SELECT cntr_tpsz_iso_cd
	                                      FROM mdm_cntr_tp_sz
	                                    WHERE cntr_tpsz_cd = b.eq_tpsz_cd)) iso_nm
	       ,b.dor_nod_cd
	       ,f.zn_nm dor_nod_name
	       ,(select loc_nm from mdm_location where loc_cd = f.loc_cd) dor_loc_nm
	       ,b.dor_de_addr dor_yd_addr
	       ,b.dor_pst_cd dor_zip_cd
	       ,b.fctry_nm dor_fctry_nm
	       ,b.cntc_pson_nm dor_ofc_eng_nm
	       ,b.cntc_pson_phn_no dor_phn_no

	       ,b.to_nod_cd
	       ,(select loc_nm from mdm_location where loc_cd = g.loc_cd) to_loc_nm
	       ,g.yd_nm to_nod_name
	       ,g.yd_addr to_yd_addr
	       ,g.zip_cd to_zip_cd
	       ,g.yd_pic_nm to_ofc_eng_nm
	       ,g.phn_no to_phn_no
	       ,case when e.web_mty_dt is null and e.web_cre_dt is null then 'Unavailable'
	        else 'Available'
	        end avb_sts
	       ,case when e.web_mty_dt is not null then to_char(e.web_mty_dt,'yyyy-mm-dd')
	             when e.web_cre_dt is not null then to_char(e.web_cre_dt,'yyyy-mm-dd')
	        else ''
	        end avb_dt
	        ,to_char(e.ft_end_dt,'yyyy-mm-dd') firt_free_dt
	        ,to_char(e.ft_end_dt,'yyyy-mm-dd') last_free_dt
	        ,a.wo_vndr_seq
	        ,(select to_char(cop_fsh_dt,'yyyy-mm-dd') cop_fsh_dt from sce_cop_hdr where cop_no = b.cop_no) cop_fsh_dt
	        ,a.cre_dt
	  from DMT_CHG_CALC e
	       ,trs_trsp_svc_ord b
	       ,trs_trsp_wrk_ord a
	       ,BKG_CONTAINER d
	       ,mdm_zone f
	       ,mdm_yard g
	 where 1=1
#if (${period_type} != 'N' || (${period_type} != 'Y' && $wo_no.size() > 0))
		   and a.wo_vndr_seq = @[wo_vndr_seq]
#end
#if (${period_type} == 'N' && $wo_no.size() > 0) 
   AND (a.trsp_wo_ofc_cty_cd,a.trsp_wo_seq) in (
	#foreach($wonoKey in ${wo_no}) 
		#if($velocityCount < $wo_no.size()) 
			(substr('$wonoKey',0,3),to_number(substr('$wonoKey',4,length('$wonoKey')))),
		#else 
			(substr('$wonoKey',0,3),to_number(substr('$wonoKey',4,length('$wonoKey'))))
		#end 
	#end 
	)
#end 
#if (${period_type} == 'N' && $eq_no.size() > 0) 
   and  (1,b.eq_no) in ( 
	#foreach($EqNokey IN ${eq_no}) 
		#if($velocityCount < $eq_no.size()) 
			(1,'$EqNokey'),
		#else 
			(1,'$EqNokey')
		#end 
	#end
	)
#end
	   and NVL(a.delt_flg, 'N') = 'N'
	   and b.trsp_wo_ofc_cty_cd = a.trsp_wo_ofc_cty_cd
	   and b.trsp_wo_seq = a.trsp_wo_seq
	   and b.trsp_cost_dtl_mod_cd = 'DR'
       AND (@[to_nod_cd] is null OR substr(b.to_nod_cd,0,5 )  = @[to_nod_cd])
       AND (@[dor_nod_cd] is null OR substr(b.dor_nod_cd,0,5 )  = @[dor_nod_cd])
	   and d.bkg_no = b.bkg_no
	   and d.cntr_no = b.eq_no
	   and e.cntr_no(+) = d.cntr_no
	   and e.CNTR_CYC_NO(+) = d.CNMV_CYC_NO
	   and e.DMDT_TRF_CD(+) = 'DTIC'
	   and e.DMDT_CHG_LOC_DIV_CD(+) = 'DEL'
	   and e.chg_seq(+) = 1
#if (${period_type} == 'E')
		   and ((e.web_mty_dt is not null and e.web_mty_dt  >= to_date(@[dt_fr] || '000000','yyyymmddhh24miss')
		        and e.web_mty_dt  <= to_date(@[dt_to] || '235959','yyyymmddhh24miss'))
		       OR (e.web_mty_dt is null and e.web_cre_dt  >= to_date(@[dt_fr] || '000000','yyyymmddhh24miss')
		        and e.web_cre_dt  <= to_date(@[dt_to] || '235959','yyyymmddhh24miss')))
#elseif (${period_type} == 'L')
		   and e.ft_end_dt  >= to_date(@[dt_fr] || '000000','yyyymmddhh24miss')
		   and e.ft_end_dt  <= to_date(@[dt_to] || '235959','yyyymmddhh24miss')
#elseif (${period_type} == 'W')
		   and a.cre_dt  >= to_date(@[dt_fr] || '000000','yyyymmddhh24miss')
		   and a.cre_dt  <= to_date(@[dt_to] || '235959','yyyymmddhh24miss')
#end

#if (${period_type} != 'N')
		   and (@[dvsn] = 'A'
		         OR (@[dvsn] = 'Y' and (e.web_mty_dt is not null OR e.web_cre_dt is not null))
		         OR (@[dvsn] = 'N' and e.web_mty_dt is null and e.web_cre_dt is null))
#end
	   and f.zn_cd = b.dor_nod_cd
	   and g.yd_cd = b.to_nod_cd
	   and substr(g.loc_cd,0,2) = 'US'
    ) x
 WHERE 1=1
#if (${period_type} != 'N')
	   AND x.cop_fsh_dt is null
#end
	order by x.cre_dt desc			]]></sql>
			<params>
				<param name="wo_vndr_seq" type="2" value="105292" out="N"/>
				<param name="to_nod_cd" type="12" value="" out="N"/>
				<param name="dor_nod_cd" type="12" value="" out="N"/>
				<param name="dt_fr" type="12" value="" out="N"/>
				<param name="dt_to" type="12" value="" out="N"/>
				<param name="dvsn" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
