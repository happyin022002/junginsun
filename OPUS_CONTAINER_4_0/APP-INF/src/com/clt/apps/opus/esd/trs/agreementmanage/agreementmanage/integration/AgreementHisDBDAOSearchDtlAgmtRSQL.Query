<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AgreementHisDBDAOSearchDtlAgmtRSQL">
			<desc><![CDATA[Pair type Agreement 의 detail을 Inquiry]]></desc>
			<sql><![CDATA[
SELECT *
  FROM (
    SELECT ROWNUM NUM, X.*
      FROM (
        SELECT   /*+ INDEX(C XAK1TRS_AGMT_NOD) */
                 E.VNDR_SEQ
               , (SELECT MDM.VNDR_LGL_ENG_NM
                   FROM MDM_VENDOR MDM
                  WHERE MDM.VNDR_SEQ = E.VNDR_SEQ) VNDR_NM
               , A.TRSP_AGMT_OFC_CTY_CD 
               , A.TRSP_AGMT_SEQ 
               , A.TRSP_AGMT_OFC_CTY_CD||A.TRSP_AGMT_SEQ AGMT_NO
               , B.TRSP_COST_MOD_CD 
               , DECODE(B.CGO_TP_CD, '0', NULL, B.CGO_TP_CD) CGO_TP_CD
               , DECODE(B.TRSP_BND_CD , '0', NULL, B.TRSP_BND_CD) TRSP_BND_CD
               , DECODE(B.SPCL_CGO_CNTR_TP_CD , '00', NULL, B.SPCL_CGO_CNTR_TP_CD) SPCL_CGO_CNTR_TP_CD
               , DECODE(B.CUST_CNT_CD , 'XX', NULL, B.CUST_CNT_CD) CUST_CNT_CD 
               , DECODE(B.CUST_SEQ , '0', NULL, B.CUST_SEQ) CUST_SEQ
               , DECODE(B.CUST_CNT_CD||B.CUST_SEQ, 'XX0', NULL, B.CUST_CNT_CD||B.CUST_SEQ) AS CUSTOMER_CD
               , DECODE(B.CMDT_GRP_CD, 'XXXX', NULL, B.CMDT_GRP_CD) CMDT_GRP_CD 
               , DECODE(B.RAIL_SVC_TP_CD, '00', NULL, B.RAIL_SVC_TP_CD) RAIL_SVC_TP_CD 
               , DECODE(C.FM_NOD_CD, '0000000', NULL, C.FM_NOD_CD) FM_NOD_CD 
               , DECODE(C.VIA_NOD_CD, '0000000', NULL, C.VIA_NOD_CD) VIA_NOD_CD 
               , DECODE(C.DOR_NOD_CD, '0000000', NULL, C.DOR_NOD_CD) DOR_NOD_CD 
               , DECODE(C.TO_NOD_CD, '0000000', NULL, C.TO_NOD_CD) TO_NOD_CD 
               , D.TRSP_AGMT_EQ_TP_SZ_CD 
               , DECODE(D.WTR_RCV_TERM_CD, '0', NULL, D.WTR_RCV_TERM_CD) WTR_RCV_TERM_CD --FEEDER TERM (R)
               , DECODE(D.WTR_DE_TERM_CD, '0', NULL, D.WTR_DE_TERM_CD) WTR_DE_TERM_CD --FEEDER TERM (D)
               , DECODE(D.TRSP_AGMT_BDL_QTY, '0', NULL, D.TRSP_AGMT_BDL_QTY) TRSP_AGMT_BDL_QTY --CHASSIS
               , DECODE(D.TO_WGT, '0', NULL, '999999.99', 'MAX', D.TO_WGT) TO_WGT --WEIGHT TIER
               , DECODE(D.WGT_MEAS_UT_CD, 'XXX', NULL, D.WGT_MEAS_UT_CD) WGT_MEAS_UT_CD --UOM
               , D.CURR_CD
               , B.AGMT_TRSP_TP_CD --TRANS MODE TYPE
               , D.TRSP_ONE_WY_RT
               , D.TRSP_RND_RT
               , A.CTRT_OFC_CD
               , D.TRSP_AGMT_RT_TP_SER_NO
               , TO_CHAR(D.EFF_FM_DT,'YYYYMMDD') EFF_FM_DT
               , TO_CHAR(D.EFF_TO_DT,'YYYYMMDD') EFF_TO_DT
               , D.TRSP_RVS_APLY_FLG
               , A.INTER_RMK
               , D.USR_DEF_RMK
               , D.AGMT_COST_FLG
            FROM TRS_AGMT_HDR A 
               , TRS_AGMT_RT_TP B 
               , TRS_AGMT_NOD C 
               , TRS_AGMT_EQ_RT D
               , TRS_AGMT_APLY_VNDR E
            WHERE A.TRSP_AGMT_OFC_CTY_CD = B.TRSP_AGMT_OFC_CTY_CD
              AND A.TRSP_AGMT_SEQ = B.TRSP_AGMT_SEQ
              AND B.TRSP_AGMT_OFC_CTY_CD = C.TRSP_AGMT_OFC_CTY_CD
              AND B.TRSP_AGMT_SEQ = C.TRSP_AGMT_SEQ
              AND B.TRSP_AGMT_RT_TP_SER_NO = C.TRSP_AGMT_RT_TP_SER_NO
              AND C.TRSP_AGMT_OFC_CTY_CD = D.TRSP_AGMT_OFC_CTY_CD
              AND C.TRSP_AGMT_SEQ = D.TRSP_AGMT_SEQ
              AND C.TRSP_AGMT_RT_TP_SER_NO = D.TRSP_AGMT_RT_TP_SER_NO
              AND C.TRSP_AGMT_NOD_SEQ = D.TRSP_AGMT_NOD_SEQ
              AND B.TRSP_AGMT_RT_TP_CD = 'P'
              AND E.TRSP_AGMT_OFC_CTY_CD = A.TRSP_AGMT_OFC_CTY_CD
              AND E.TRSP_AGMT_SEQ = A.TRSP_AGMT_SEQ
              AND E.AGMT_VNDR_PRMRY_FLG = 'Y'
        #if (${fm_nod} != '' )
            AND C.FM_NOD_CD LIKE @[fm_nod]||'%'
        #end
        #if (${via_nod} != '' )
            AND C.VIA_NOD_CD LIKE @[via_nod]||'%'
        #end
        #if (${to_nod} != '' )
            AND C.TO_NOD_CD LIKE @[to_nod]||'%'
        #end
        #if (${dor_nod} != '' )
            AND C.DOR_NOD_CD LIKE @[dor_nod]||'%'
        #end
        #if (${costmode} != '') 
              AND B.TRSP_COST_MOD_CD = @[costmode]
        #end
        #if (${cargo} != '') 
              AND B.CGO_TP_CD = @[cargo]
        #end
              AND D.EQ_KND_CD = @[eqtype]
        #if ($eqtpsz.size() > 0)
              AND D.TRSP_AGMT_EQ_TP_SZ_CD IN (
        	#foreach($key in ${eqtpsz}) 
        
        		#if($velocityCount < $eqtpsz.size()) 
        			'$key', 
        		#else 
        			'$key' 
        		#end 
        
        	#end
        	)
        #end
        #if (${fmAgmtTrspTpCd} != '') 
              AND B.AGMT_TRSP_TP_CD = @[fmAgmtTrspTpCd]
        #end
        #if (${fmEffectiveAgmt} != 'A' )
              AND (SELECT TO_CHAR(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(A.CTRT_OFC_CD),'YYYYMMDD') FROM DUAL) BETWEEN TO_CHAR(D.EFF_FM_DT,'YYYYMMDD') AND TO_CHAR(D.EFF_TO_DT,'YYYYMMDD')
        #end
        #if (${fmVndrPrmrySeq} != '') 
              AND (A.TRSP_AGMT_OFC_CTY_CD, A.TRSP_AGMT_SEQ) IN (
                  SELECT TRSP_AGMT_OFC_CTY_CD, TRSP_AGMT_SEQ
                    FROM TRS_AGMT_APLY_VNDR
                   WHERE VNDR_SEQ = @[fmVndrPrmrySeq]
                  )
        #end

        -- 2015.02.09    Hyungwook Choi Start
        --UNION ALL
        UNION
        SELECT   /*+ INDEX(C XAK1TRS_AGMT_NOD) */
                 E.VNDR_SEQ
               , (SELECT MDM.VNDR_LGL_ENG_NM
                   FROM MDM_VENDOR MDM
                  WHERE MDM.VNDR_SEQ = E.VNDR_SEQ) VNDR_NM
               , A.TRSP_AGMT_OFC_CTY_CD 
               , A.TRSP_AGMT_SEQ 
               , A.TRSP_AGMT_OFC_CTY_CD||A.TRSP_AGMT_SEQ AGMT_NO
               , B.TRSP_COST_MOD_CD 
               , DECODE(B.CGO_TP_CD, '0', NULL, B.CGO_TP_CD) CGO_TP_CD
               , DECODE(B.TRSP_BND_CD , '0', NULL, B.TRSP_BND_CD) TRSP_BND_CD
               , DECODE(B.SPCL_CGO_CNTR_TP_CD , '00', NULL, B.SPCL_CGO_CNTR_TP_CD) SPCL_CGO_CNTR_TP_CD
               , DECODE(B.CUST_CNT_CD , 'XX', NULL, B.CUST_CNT_CD) CUST_CNT_CD 
               , DECODE(B.CUST_SEQ , '0', NULL, B.CUST_SEQ) CUST_SEQ
               , DECODE(B.CUST_CNT_CD||B.CUST_SEQ, 'XX0', NULL, B.CUST_CNT_CD||B.CUST_SEQ) AS CUSTOMER_CD
               , DECODE(B.CMDT_GRP_CD, 'XXXX', NULL, B.CMDT_GRP_CD) CMDT_GRP_CD 
               , DECODE(B.RAIL_SVC_TP_CD, '00', NULL, B.RAIL_SVC_TP_CD) RAIL_SVC_TP_CD 
               , DECODE(C.FM_NOD_CD, '0000000', NULL, C.FM_NOD_CD) FM_NOD_CD 
               , DECODE(C.VIA_NOD_CD, '0000000', NULL, C.VIA_NOD_CD) VIA_NOD_CD 
               , DECODE(C.DOR_NOD_CD, '0000000', NULL, C.DOR_NOD_CD) DOR_NOD_CD 
               , DECODE(C.TO_NOD_CD, '0000000', NULL, C.TO_NOD_CD) TO_NOD_CD 
               , D.TRSP_AGMT_EQ_TP_SZ_CD 
               , DECODE(D.WTR_RCV_TERM_CD, '0', NULL, D.WTR_RCV_TERM_CD) WTR_RCV_TERM_CD --FEEDER TERM (R)
               , DECODE(D.WTR_DE_TERM_CD, '0', NULL, D.WTR_DE_TERM_CD) WTR_DE_TERM_CD --FEEDER TERM (D)
               , DECODE(D.TRSP_AGMT_BDL_QTY, '0', NULL, D.TRSP_AGMT_BDL_QTY) TRSP_AGMT_BDL_QTY --CHASSIS
               , DECODE(D.TO_WGT, '0', NULL, '999999.99', 'MAX', D.TO_WGT) TO_WGT --WEIGHT TIER
               , DECODE(D.WGT_MEAS_UT_CD, 'XXX', NULL, D.WGT_MEAS_UT_CD) WGT_MEAS_UT_CD --UOM
               , D.CURR_CD
               , B.AGMT_TRSP_TP_CD --TRANS MODE TYPE
               , D.TRSP_ONE_WY_RT
               , D.TRSP_RND_RT
               , A.CTRT_OFC_CD
               , D.TRSP_AGMT_RT_TP_SER_NO
               , TO_CHAR(D.EFF_FM_DT,'YYYYMMDD') EFF_FM_DT
               , TO_CHAR(D.EFF_TO_DT,'YYYYMMDD') EFF_TO_DT
               , D.TRSP_RVS_APLY_FLG
               , A.INTER_RMK
               , D.USR_DEF_RMK
               , D.AGMT_COST_FLG
            FROM TRS_AGMT_HDR A 
               , TRS_AGMT_RT_TP B 
               , TRS_AGMT_NOD C 
               , TRS_AGMT_EQ_RT D
               , TRS_AGMT_APLY_VNDR E
            WHERE A.TRSP_AGMT_OFC_CTY_CD = B.TRSP_AGMT_OFC_CTY_CD
              AND A.TRSP_AGMT_SEQ = B.TRSP_AGMT_SEQ
              AND B.TRSP_AGMT_OFC_CTY_CD = C.TRSP_AGMT_OFC_CTY_CD
              AND B.TRSP_AGMT_SEQ = C.TRSP_AGMT_SEQ
              AND B.TRSP_AGMT_RT_TP_SER_NO = C.TRSP_AGMT_RT_TP_SER_NO
              AND C.TRSP_AGMT_OFC_CTY_CD = D.TRSP_AGMT_OFC_CTY_CD
              AND C.TRSP_AGMT_SEQ = D.TRSP_AGMT_SEQ
              AND C.TRSP_AGMT_RT_TP_SER_NO = D.TRSP_AGMT_RT_TP_SER_NO
              AND C.TRSP_AGMT_NOD_SEQ = D.TRSP_AGMT_NOD_SEQ
              AND B.TRSP_AGMT_RT_TP_CD = 'P'
              AND E.TRSP_AGMT_OFC_CTY_CD = A.TRSP_AGMT_OFC_CTY_CD
              AND E.TRSP_AGMT_SEQ = A.TRSP_AGMT_SEQ
              AND E.AGMT_VNDR_PRMRY_FLG = 'Y'
              AND D.TRSP_RVS_APLY_FLG = 'Y'
        #if (${fm_nod} != '' )
            AND C.FM_NOD_CD LIKE @[fm_nod]||'%'
        #end
        #if (${via_nod} != '' )
            AND C.VIA_NOD_CD LIKE @[via_nod]||'%'
        #end
        #if (${to_nod} != '' )
            AND C.TO_NOD_CD LIKE @[to_nod]||'%'
        #end
        #if (${dor_nod} != '' )
            AND C.DOR_NOD_CD LIKE @[dor_nod]||'%'
        #end
        #if (${costmode} != '') 
              AND B.TRSP_COST_MOD_CD = @[costmode]
        #end
        #if (${cargo} != '') 
              AND B.CGO_TP_CD = @[cargo]
        #end
              AND D.EQ_KND_CD = @[eqtype]
        #if ($eqtpsz.size() > 0)
              AND D.TRSP_AGMT_EQ_TP_SZ_CD IN (
        	#foreach($key in ${eqtpsz}) 
        
        		#if($velocityCount < $eqtpsz.size()) 
        			'$key', 
        		#else 
        			'$key' 
        		#end 
        
        	#end
        	)
        #end
        #if (${fmAgmtTrspTpCd} != '') 
              AND B.AGMT_TRSP_TP_CD = @[fmAgmtTrspTpCd]
        #end
        #if (${fmEffectiveAgmt} != 'A' )
              AND (SELECT TO_CHAR(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(A.CTRT_OFC_CD),'YYYYMMDD') FROM DUAL) BETWEEN TO_CHAR(D.EFF_FM_DT,'YYYYMMDD') AND TO_CHAR(D.EFF_TO_DT,'YYYYMMDD')
        #end
        #if (${fmVndrPrmrySeq} != '') 
              AND (A.TRSP_AGMT_OFC_CTY_CD, A.TRSP_AGMT_SEQ) IN (
                  SELECT TRSP_AGMT_OFC_CTY_CD, TRSP_AGMT_SEQ
                    FROM TRS_AGMT_APLY_VNDR
                   WHERE VNDR_SEQ = @[fmVndrPrmrySeq]
                  )
        #end
        -- 2015.02.09    Hyungwook Choi End

        -- 2015.12.03    Chanwoo Park Start
        -- Search for reverse case when From/To node is opposite
        UNION
        SELECT   /*+ INDEX(C XAK1TRS_AGMT_NOD) */
                 E.VNDR_SEQ
               , (SELECT MDM.VNDR_LGL_ENG_NM
                   FROM MDM_VENDOR MDM
                  WHERE MDM.VNDR_SEQ = E.VNDR_SEQ) VNDR_NM
               , A.TRSP_AGMT_OFC_CTY_CD 
               , A.TRSP_AGMT_SEQ 
               , A.TRSP_AGMT_OFC_CTY_CD||A.TRSP_AGMT_SEQ AGMT_NO
               , B.TRSP_COST_MOD_CD 
               , DECODE(B.CGO_TP_CD, '0', NULL, B.CGO_TP_CD) CGO_TP_CD
               , DECODE(B.TRSP_BND_CD , '0', NULL, B.TRSP_BND_CD) TRSP_BND_CD
               , DECODE(B.SPCL_CGO_CNTR_TP_CD , '00', NULL, B.SPCL_CGO_CNTR_TP_CD) SPCL_CGO_CNTR_TP_CD
               , DECODE(B.CUST_CNT_CD , 'XX', NULL, B.CUST_CNT_CD) CUST_CNT_CD 
               , DECODE(B.CUST_SEQ , '0', NULL, B.CUST_SEQ) CUST_SEQ
               , DECODE(B.CUST_CNT_CD||B.CUST_SEQ, 'XX0', NULL, B.CUST_CNT_CD||B.CUST_SEQ) AS CUSTOMER_CD
               , DECODE(B.CMDT_GRP_CD, 'XXXX', NULL, B.CMDT_GRP_CD) CMDT_GRP_CD 
               , DECODE(B.RAIL_SVC_TP_CD, '00', NULL, B.RAIL_SVC_TP_CD) RAIL_SVC_TP_CD 
               , DECODE(C.FM_NOD_CD, '0000000', NULL, C.FM_NOD_CD) FM_NOD_CD 
               , DECODE(C.VIA_NOD_CD, '0000000', NULL, C.VIA_NOD_CD) VIA_NOD_CD 
               , DECODE(C.DOR_NOD_CD, '0000000', NULL, C.DOR_NOD_CD) DOR_NOD_CD 
               , DECODE(C.TO_NOD_CD, '0000000', NULL, C.TO_NOD_CD) TO_NOD_CD 
               , D.TRSP_AGMT_EQ_TP_SZ_CD 
               , DECODE(D.WTR_RCV_TERM_CD, '0', NULL, D.WTR_RCV_TERM_CD) WTR_RCV_TERM_CD --FEEDER TERM (R)
               , DECODE(D.WTR_DE_TERM_CD, '0', NULL, D.WTR_DE_TERM_CD) WTR_DE_TERM_CD --FEEDER TERM (D)
               , DECODE(D.TRSP_AGMT_BDL_QTY, '0', NULL, D.TRSP_AGMT_BDL_QTY) TRSP_AGMT_BDL_QTY --CHASSIS
               , DECODE(D.TO_WGT, '0', NULL, '999999.99', 'MAX', D.TO_WGT) TO_WGT --WEIGHT TIER
               , DECODE(D.WGT_MEAS_UT_CD, 'XXX', NULL, D.WGT_MEAS_UT_CD) WGT_MEAS_UT_CD --UOM
               , D.CURR_CD
               , B.AGMT_TRSP_TP_CD --TRANS MODE TYPE
               , D.TRSP_ONE_WY_RT
               , D.TRSP_RND_RT
               , A.CTRT_OFC_CD
               , D.TRSP_AGMT_RT_TP_SER_NO
               , TO_CHAR(D.EFF_FM_DT,'YYYYMMDD') EFF_FM_DT
               , TO_CHAR(D.EFF_TO_DT,'YYYYMMDD') EFF_TO_DT
               , D.TRSP_RVS_APLY_FLG
               , A.INTER_RMK
               , D.USR_DEF_RMK
               , D.AGMT_COST_FLG
            FROM TRS_AGMT_HDR A 
               , TRS_AGMT_RT_TP B 
               , TRS_AGMT_NOD C 
               , TRS_AGMT_EQ_RT D
               , TRS_AGMT_APLY_VNDR E
            WHERE A.TRSP_AGMT_OFC_CTY_CD = B.TRSP_AGMT_OFC_CTY_CD
              AND A.TRSP_AGMT_SEQ = B.TRSP_AGMT_SEQ
              AND B.TRSP_AGMT_OFC_CTY_CD = C.TRSP_AGMT_OFC_CTY_CD
              AND B.TRSP_AGMT_SEQ = C.TRSP_AGMT_SEQ
              AND B.TRSP_AGMT_RT_TP_SER_NO = C.TRSP_AGMT_RT_TP_SER_NO
              AND C.TRSP_AGMT_OFC_CTY_CD = D.TRSP_AGMT_OFC_CTY_CD
              AND C.TRSP_AGMT_SEQ = D.TRSP_AGMT_SEQ
              AND C.TRSP_AGMT_RT_TP_SER_NO = D.TRSP_AGMT_RT_TP_SER_NO
              AND C.TRSP_AGMT_NOD_SEQ = D.TRSP_AGMT_NOD_SEQ
              AND B.TRSP_AGMT_RT_TP_CD = 'P'
              AND E.TRSP_AGMT_OFC_CTY_CD = A.TRSP_AGMT_OFC_CTY_CD
              AND E.TRSP_AGMT_SEQ = A.TRSP_AGMT_SEQ
              AND E.AGMT_VNDR_PRMRY_FLG = 'Y'
              AND D.TRSP_RVS_APLY_FLG = 'Y'
        #if (${to_nod} != '' )
            AND C.FM_NOD_CD LIKE @[to_nod]||'%' -- Opposite
        #end
        #if (${via_nod} != '' )
            AND C.VIA_NOD_CD LIKE @[via_nod]||'%'
        #end
        #if (${fm_nod} != '' )
            AND C.TO_NOD_CD LIKE @[fm_nod]||'%' -- Opposite
        #end
        #if (${dor_nod} != '' )
            AND C.DOR_NOD_CD LIKE @[dor_nod]||'%'
        #end
        #if (${costmode} != '') 
              AND B.TRSP_COST_MOD_CD = @[costmode]
        #end
        #if (${cargo} != '') 
              AND B.CGO_TP_CD = @[cargo]
        #end
              AND D.EQ_KND_CD = @[eqtype]
        #if ($eqtpsz.size() > 0)
              AND D.TRSP_AGMT_EQ_TP_SZ_CD IN (
        	#foreach($key in ${eqtpsz}) 
        
        		#if($velocityCount < $eqtpsz.size()) 
        			'$key', 
        		#else 
        			'$key' 
        		#end 
        
        	#end
        	)
        #end
        #if (${fmAgmtTrspTpCd} != '') 
              AND B.AGMT_TRSP_TP_CD = @[fmAgmtTrspTpCd]
        #end
        #if (${fmEffectiveAgmt} != 'A' )
              AND (SELECT TO_CHAR(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(A.CTRT_OFC_CD),'YYYYMMDD') FROM DUAL) BETWEEN TO_CHAR(D.EFF_FM_DT,'YYYYMMDD') AND TO_CHAR(D.EFF_TO_DT,'YYYYMMDD')
        #end
        #if (${fmVndrPrmrySeq} != '') 
              AND (A.TRSP_AGMT_OFC_CTY_CD, A.TRSP_AGMT_SEQ) IN (
                  SELECT TRSP_AGMT_OFC_CTY_CD, TRSP_AGMT_SEQ
                    FROM TRS_AGMT_APLY_VNDR
                   WHERE VNDR_SEQ = @[fmVndrPrmrySeq]
                  )
        #end
        -- 2015.12.03    Chanwoo Park End
   ) X
)
WHERE NUM BETWEEN 1 + ((@[cur_page_cnt]-1)*@[page_size]) AND (@[cur_page_cnt]*@[page_size])			]]></sql>
			<params>
				<param name="fm_nod" type="12" value="" out="N"/>
				<param name="via_nod" type="12" value="" out="N"/>
				<param name="to_nod" type="12" value="" out="N"/>
				<param name="dor_nod" type="12" value="" out="N"/>
				<param name="costmode" type="12" value="" out="N"/>
				<param name="cargo" type="12" value="" out="N"/>
				<param name="eqtype" type="12" value="" out="N"/>
				<param name="fmAgmtTrspTpCd" type="12" value="" out="N"/>
				<param name="fmVndrPrmrySeq" type="12" value="" out="N"/>
				<param name="cur_page_cnt" type="12" value="" out="N"/>
				<param name="page_size" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
