<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ProductCatalogCreateDBDAOSearchPrdConstraintRSQL">
			<desc><![CDATA[SearchPrdConstraint]]></desc>
			<sql><![CDATA[
SELECT SVC_USE_FLG,ROUT,PORT_PNT_CD,ITEM,CNTR_TP_CD, CMDT_CD, RMK, CRE_OFC_CD, CRE_USR_ID
FROM (
    SELECT R.SVC_USE_FLG,R.POL_NOD_CD || '-' || R.POD_NOD_CD || '-' || R.TRNK_LANE_CD ROUT,'' PORT_PNT_CD,'' ITEM,'' CNTR_TP_CD,'' CMDT_CD,ROUT_CNST_RMK RMK, R.CRE_OFC_CD,R.CRE_USR_ID ,
      ROW_NUMBER() OVER (PARTITION BY MST.PCTL_NO ORDER BY DECODE(R.TRNK_LANE_CD, 'ALL', 1, 0) , DECODE(R.POL_NOD_CD, 'ALL', 1, 0) , DECODE(R.POL_NOD_CD, 'ALL', 1, 0) , R.ROUT_CNST_SEQ DESC ) RN
    FROM PRD_ROUT_CNST R,PRD_PROD_CTL_QTY Q,
      (
        SELECT M.PCTL_NO,POR_NOD_CD, POL_CD, MAX (DECODE (TS.RK, 1, TS.LANE_CD)) N1ST_LANE_CD,N1ST_TS_PORT_CD, MAX (DECODE (TS.RK, 2, TS.LANE_CD)) N2ND_LANE_CD,
          N2ND_TS_PORT_CD, MAX (DECODE (TS.RK, 3, TS.LANE_CD)) N3RD_LANE_CD, POD_CD,DEL_NOD_CD,
          (
            SELECT VSL_SLAN_CD
            FROM VSK_VSL_SKD V
            WHERE V.VSL_CD = TRNK_VSL_CD
              AND V.SKD_VOY_NO = TRNK_SKD_VOY_NO
              AND V.SKD_DIR_CD = TRNK_SKD_DIR_CD ) TRNK_LANE,
          (
            SELECT /*+INDEX (D XPKPRD_PROD_CTL_ROUT_DTL) */ORG_NOD_CD
            FROM PRD_PROD_CTL_ROUT_DTL D
            WHERE PCTL_NO = M.PCTL_NO
              AND PCTL_IO_BND_CD = 'I'
              AND NOD_LNK_DIV_CD = 'N'
              AND MTY_YD_FLG = 'N'
              AND ROWNUM = 1 ) POD_NOD ,
          MAX (DECODE (TS.RK, 1, ORG_NOD_CD )) N1ST_ORG_NOD_CD,
          MAX (DECODE (TS.RK, 1, DEST_NOD_CD )) N1ST_DEST_NOD_CD ,
          MAX (DECODE (TS.RK, 2, ORG_NOD_CD )) N2ND_ORG_NOD_CD,
          MAX (DECODE (TS.RK, 2, DEST_NOD_CD )) N2ND_DEST_NOD_CD ,
          MAX (DECODE (TS.RK, 3, ORG_NOD_CD )) N3RD_ORG_NOD_CD,
          MAX (DECODE (TS.RK, 3, DEST_NOD_CD )) N3RD_DEST_NOD_CD,
          M.DG_SPCL_FLG, M.RF_SPCL_FLG, M.SPCL_AWK_CGO_FLG, M.BB_SPCL_FLG
        FROM PRD_PROD_CTL_MST M,
          (
            SELECT PCTL_NO, ORG_NOD_CD,DEST_NOD_CD, RANK () OVER (PARTITION BY PCTL_NO ORDER BY PCTL_SEQ) RK,VSL_SLAN_CD LANE_CD
            FROM PRD_PROD_CTL_ROUT_DTL DTL,PRD_OCN_ROUT ROUT
            WHERE PCTL_NO = @[pctl_no]
              AND VSL_SLAN_CD IS NOT NULL
              AND DTL.ROUT_ORG_NOD_CD = ROUT.ORG_LOC_CD
              AND DTL.ROUT_DEST_NOD_CD = ROUT.DEST_LOC_CD
              AND DTL.ROUT_SEQ = ROUT.ROUT_SEQ ) TS
        WHERE M.PCTL_NO = @[pctl_no]
          AND M.PCTL_NO = TS.PCTL_NO(+)
        GROUP BY M.PCTL_NO, POR_NOD_CD, POL_CD, N1ST_TS_PORT_CD, N2ND_TS_PORT_CD, POD_CD, DEL_NOD_CD, TRNK_VSL_CD, TRNK_SKD_VOY_NO, TRNK_SKD_DIR_CD
                 ,M.DG_SPCL_FLG, M.RF_SPCL_FLG, M.SPCL_AWK_CGO_FLG, M.BB_SPCL_FLG ) MST
    WHERE NVL(MST.TRNK_LANE, 'ALL') = DECODE(R.TRNK_LANE_CD, 'ALL', NVL(MST.TRNK_LANE, 'ALL'), R.TRNK_LANE_CD)
      AND NVL(MST.POR_NOD_CD, R.POR_NOD_CD) LIKE NVL(R.POR_NOD_CD, MST.POR_NOD_CD)||'%'
      AND MST.POL_CD LIKE DECODE(R.POL_NOD_CD, 'ALL', MST.POL_CD, SUBSTR(R.POL_NOD_CD, 1, 5)||'%')
      AND MST.N1ST_ORG_NOD_CD LIKE DECODE(LENGTH(R.POL_NOD_CD), 7, R.POL_NOD_CD, MST.N1ST_ORG_NOD_CD)
      AND MST.POD_NOD LIKE DECODE(R.POD_NOD_CD, 'ALL', MST.POD_CD, R.POD_NOD_CD) ||'%'
      AND NVL(MST.DEL_NOD_CD, R.DEL_NOD_CD) LIKE NVL(R.DEL_NOD_CD, MST.DEL_NOD_CD)||'%'
      AND NVL(MST.N1ST_TS_PORT_CD, ' ') = NVL(R.N1ST_TS_PORT_CD, NVL(MST.N1ST_TS_PORT_CD, ' '))
      AND NVL(MST.N2ND_TS_PORT_CD, ' ') = NVL(R.N2ND_TS_PORT_CD, NVL(MST.N2ND_TS_PORT_CD, ' '))
      AND NVL(MST.N1ST_LANE_CD, ' ') = NVL(R.N1ST_LANE_CD, NVL(MST.N1ST_LANE_CD, ' '))
      AND NVL(MST.N2ND_LANE_CD, ' ') = NVL(R.N2ND_LANE_CD, NVL(MST.N2ND_LANE_CD, ' '))
      AND NVL(MST.N3RD_LANE_CD, ' ') = NVL(R.N3RD_LANE_CD, NVL(MST.N3RD_LANE_CD, ' '))
      AND NVL(DELT_FLG, 'N') <> 'Y' 
      AND Q.PCTL_NO = MST.PCTL_NO
      AND Q.CNTR_TPSZ_CD LIKE NVL(R.CNTR_TP_CD,'%')||NVL(R.CNTR_SZ_CD,'%')
      AND NVL(R.SPCL_CGO_CNTR_TP_CD,'AL') = (CASE WHEN NVL(R.SPCL_CGO_CNTR_TP_CD,'AL')  ='AL' THEN NVL(R.SPCL_CGO_CNTR_TP_CD,'AL') 
                                                  WHEN NVL(MST.DG_SPCL_FLG,'N') ='Y' AND NVL(MST.RF_SPCL_FLG,'N') ='Y' THEN 'RD'
                                                  WHEN NVL(MST.DG_SPCL_FLG,'N') ='Y' AND NVL(MST.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AD'
                                                  WHEN NVL(MST.DG_SPCL_FLG,'N') ='Y' THEN 'DG'
                                                  WHEN NVL(MST.RF_SPCL_FLG,'N') ='Y' THEN 'RF'
                                                  WHEN NVL(MST.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AK'
                                                  WHEN NVL(MST.BB_SPCL_FLG,'N') ='Y' THEN 'BB'
                                                  WHEN NVL(MST.DG_SPCL_FLG,'N') ='N' AND NVL(MST.RF_SPCL_FLG,'N') ='N' AND NVL(MST.SPCL_AWK_CGO_FLG,'N') ='N' AND NVL(MST.BB_SPCL_FLG,'N') ='N'  THEN 'GP'
                                              END)
     ) M
WHERE RN = 1 -- ROUTE 끝
UNION ALL
SELECT DISTINCT C.SVC_USE_FLG,C.LNK_ORG_NOD_CD||'-'||LNK_DEST_NOD_CD ROUT,'' PORT_PNT_CD,PCTL_CNST_ITM_NM ITEM, C.CNTR_TP_CD||C.CNTR_SZ_CD CNTR_TP_CD,
  C.CMDT_CD,LNK_CNST_RMK RMK,C.CRE_OFC_CD, C.CRE_USR_ID
FROM PRD_LNK_CNST_MGMT C, PRD_PROD_CTL_QTY Q , PRD_PROD_CTL_ROUT_DTL D ,PRD_PROD_CTL_MST M   
WHERE M.PCTL_NO = @[pctl_no]
AND M.PCTL_NO = D.PCTL_NO    
AND D.NOD_LNK_DIV_CD = 'L'   
and D.PCTL_NO = Q.PCTL_NO   
AND D.ORG_NOD_CD LIKE C.LNK_ORG_NOD_CD||'%'   
AND D.DEST_NOD_CD LIKE C.LNK_DEST_NOD_CD||'%'   
AND D.TRSP_MOD_CD = DECODE(C.TRSP_MOD_CD, 'AL' ,D.TRSP_MOD_CD, C.TRSP_MOD_CD )  
AND NVL(M.CMDT_CD,'X')  = NVL(C.CMDT_CD, NVL(M.CMDT_CD,'X'))    
AND NVL(C.DELT_FLG, 'N') <> 'Y'   
AND NVL(C.SPCL_CGO_CNTR_TP_CD,'AL') = (CASE WHEN NVL(C.SPCL_CGO_CNTR_TP_CD,'AL') ='AL' THEN NVL(C.SPCL_CGO_CNTR_TP_CD,'AL')
                                            WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' AND NVL(M.RF_SPCL_FLG,'N') ='Y' THEN 'RD'
                                            WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' AND NVL(M.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AD'
                                            WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' THEN 'DG'
                                            WHEN NVL(M.RF_SPCL_FLG,'N') ='Y' THEN 'RF'
                                            WHEN NVL(M.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AK'
                                            WHEN NVL(M.BB_SPCL_FLG,'N') ='Y' THEN 'BB'
                                            WHEN NVL(M.DG_SPCL_FLG,'N') ='N' AND NVL(M.RF_SPCL_FLG,'N') ='N' AND NVL(M.SPCL_AWK_CGO_FLG,'N') ='N' AND NVL(M.BB_SPCL_FLG,'N') ='N'  THEN 'GP'
                                        END)
AND Q.CNTR_TPSZ_CD LIKE NVL(C.CNTR_TP_CD,'%')||NVL(C.CNTR_SZ_CD,'%')
AND (   
        (   
            TRUNC(TO_DATE(NVL(C.EFF_FM_DT,'19000101'),'yyyy/mm/dd hh24:mi:ss')) <= D.ARR_ST_DT AND   
            D.ARR_ST_DT < TRUNC(TO_DATE(NVL(C.EFF_TO_DT,'25000101'),'yyyy/mm/dd hh24:mi:ss')+1)   
        ) OR   
        (   
            TRUNC(TO_DATE(NVL(C.EFF_FM_DT,'19000101'),'yyyy/mm/dd hh24:mi:ss')) <= D.DEP_FSH_DT AND   
            D.DEP_FSH_DT < TRUNC(TO_DATE(NVL(C.EFF_TO_DT,'25000101'),'yyyy/mm/dd hh24:mi:ss')+1)   
        )   
    )
 -- LINK 끝
UNION ALL
SELECT DISTINCT C.SVC_USE_FLG,NOD_CD ROUT,DECODE(C.PORT_PNT_CD, 'ALL', DECODE(C.NOD_CD, 'ALL', 'ALL', P.PORT_PNT_CD), C.PORT_PNT_CD) PORT_PNT_CD,
  PCTL_CNST_ITM_NM ITEM, C.CNTR_TP_CD||C.CNTR_SZ_CD CNTR_TP_CD, C.CMDT_CD,NOD_CNST_RMK RMK ,C.CRE_OFC_CD,C.CRE_USR_ID
FROM PRD_NOD_CNST_MGMT C,
  (
    SELECT ORG_NOD_CD,CNTR_TPSZ_CD, ARR_ST_DT, DEP_FSH_DT, CMDT_CD,
      DG_SPCL_FLG,RF_SPCL_FLG,SPCL_AWK_CGO_FLG,BB_SPCL_FLG,PCTL_NO,
      DECODE(PCTL_IO_BND_CD, 'O', DECODE(SUBSTR(POR, 1, 5), SUBSTR(POL, 1, 5), 'POR, POL', SUBSTR(ORG_NOD_CD, 1, 5), 'POR', DECODE(MTY_YD_FLG, 'Y', 'MTY', 'POL' )), 'I', DECODE(SUBSTR(POD, 1, 5), SUBSTR(DEL, 1, 5), 'POD, DEL', SUBSTR(ORG_NOD_CD, 1, 5), 'POD', DECODE(MTY_YD_FLG, 'Y', 'MTY', 'DEL' )), 'T/S') PORT_PNT_CD
    FROM (
        SELECT D.ORG_NOD_CD,NVL(M.POR_NOD_CD, POR_CD) POR, NVL(M.POL_NOD_CD, POL_CD) POL,NVL(M.POD_NOD_CD, POD_CD) POD, NVL(M.DEL_NOD_CD, DEL_CD) DEL,
          CNTR_TPSZ_CD, ARR_ST_DT, DEP_FSH_DT, CMDT_CD, PCTL_IO_BND_CD, MTY_YD_FLG, M.DG_SPCL_FLG, M.RF_SPCL_FLG, M.SPCL_AWK_CGO_FLG, M.BB_SPCL_FLG, M.PCTL_NO
        FROM PRD_PROD_CTL_ROUT_DTL D, PRD_PROD_CTL_MST M,PRD_PROD_CTL_QTY Q
        WHERE D.PCTL_NO = @[pctl_no]
          AND D.PCTL_NO = M.PCTL_NO
          AND D.PCTL_NO = Q.PCTL_NO
          AND D.NOD_LNK_DIV_CD = 'N' ) J 
   ) P
WHERE P.ORG_NOD_CD LIKE DECODE(C.NOD_CD, 'ALL', '%', C.NOD_CD||'%')
  AND NVL(C.DELT_FLG, 'N') <> 'Y'  AND P.CNTR_TPSZ_CD LIKE NVL(C.CNTR_TP_CD, '%')||NVL(C.CNTR_SZ_CD, '%')
  AND NVL(C.SPCL_CGO_CNTR_TP_CD,'AL') = (CASE WHEN NVL(C.SPCL_CGO_CNTR_TP_CD,'AL') ='AL' THEN NVL(C.SPCL_CGO_CNTR_TP_CD,'AL')
                                              WHEN NVL(P.DG_SPCL_FLG,'N') ='Y' AND NVL(P.RF_SPCL_FLG,'N') ='Y' THEN 'RD'
                                              WHEN NVL(P.DG_SPCL_FLG,'N') ='Y' AND NVL(P.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AD'
                                              WHEN NVL(P.DG_SPCL_FLG,'N') ='Y' THEN 'DG'
                                              WHEN NVL(P.RF_SPCL_FLG,'N') ='Y' THEN 'RF'
                                              WHEN NVL(P.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AK'
                                              WHEN NVL(P.BB_SPCL_FLG,'N') ='Y' THEN 'BB'
                                              WHEN NVL(P.DG_SPCL_FLG,'N') ='N' AND NVL(P.RF_SPCL_FLG,'N') ='N' AND NVL(P.SPCL_AWK_CGO_FLG,'N') ='N' AND NVL(P.BB_SPCL_FLG,'N') ='N'  THEN 'GP'
                                          END)
  AND P.CNTR_TPSZ_CD LIKE NVL(C.CNTR_TP_CD, '%')||NVL(C.CNTR_SZ_CD, '%')
  AND NVL(C.VSL_SLAN_CD,'ALL') =(CASE WHEN NVL(C.VSL_SLAN_CD,'ALL') = 'ALL' THEN NVL(C.VSL_SLAN_CD,'ALL')
                                      WHEN C.PORT_PNT_CD IN ('POR','POL') THEN (SELECT N1ST_LANE_CD
                                                                                  FROM PRD_OCN_ROUT O
                                                                                 WHERE (ORG_LOC_CD, DEST_LOC_CD, ROUT_SEQ ) 
                                                                                      = (SELECT DX.ROUT_ORG_NOD_CD, DX.ROUT_DEST_NOD_CD, DX.ROUT_SEQ
                                                                                           FROM PRD_PROD_CTL_ROUT_DTL DX
                                                                                          WHERE DX.PCTL_NO LIKE P.PCTL_NO
                                                                                            AND DX.PCTL_IO_BND_CD ='T'
                                                                                            AND ROWNUM =1) )
                                      WHEN C.PORT_PNT_CD IN ('POD','DEL') THEN (SELECT SUBSTR(TRIM(N1ST_LANE_CD||N2ND_LANE_CD||N3RD_LANE_CD||N4TH_LANE_CD),-3)
                                                                                  FROM PRD_OCN_ROUT O
                                                                                 WHERE (ORG_LOC_CD, DEST_LOC_CD, ROUT_SEQ ) 
                                                                                      = (SELECT DX.ROUT_ORG_NOD_CD, DX.ROUT_DEST_NOD_CD, DX.ROUT_SEQ
                                                                                           FROM PRD_PROD_CTL_ROUT_DTL DX
                                                                                          WHERE DX.PCTL_NO LIKE P.PCTL_NO
                                                                                            AND DX.PCTL_IO_BND_CD ='T'
                                                                                            AND ROWNUM =1) )    
                                      WHEN C.PORT_PNT_CD IN ('ALL','TS') THEN (SELECT C.VSL_SLAN_CD
                                                                                  FROM PRD_OCN_ROUT O
                                                                                 WHERE (ORG_LOC_CD, DEST_LOC_CD, ROUT_SEQ ) 
                                                                                      = (SELECT DX.ROUT_ORG_NOD_CD, DX.ROUT_DEST_NOD_CD, DX.ROUT_SEQ
                                                                                           FROM PRD_PROD_CTL_ROUT_DTL DX
                                                                                          WHERE DX.PCTL_NO LIKE P.PCTL_NO
                                                                                            AND DX.PCTL_IO_BND_CD ='T'
                                                                                            AND ROWNUM =1) 
                                                                                    AND C.VSL_SLAN_CD IN ( N1ST_LANE_CD,N2ND_LANE_CD,N3RD_LANE_CD,N4TH_LANE_CD))
                                 END)
  AND NVL(p.CMDT_CD, 'X') = NVL(C.CMDT_CD, NVL(p.CMDT_CD, 'X'))
  AND (NVL(C.port_pnt_cd, 'ALL') = 'ALL'
      OR P.PORT_PNT_CD LIKE '%'||DECODE(C.port_pnt_cd, 'TS', 'T/S', C.port_pnt_cd)||'%')
  AND (																								 
        (																							 
            TRUNC(TO_DATE(NVL(C.EFF_FM_DT,'19000101'),'yyyy/mm/dd hh24:mi:ss')) <= P.ARR_ST_DT AND	 
            P.ARR_ST_DT < TRUNC(TO_DATE(NVL(C.EFF_TO_DT,'25000101'),'yyyy/mm/dd hh24:mi:ss')+1)		 
        ) OR																						 
        (																							 
            TRUNC(TO_DATE(NVL(C.EFF_FM_DT,'19000101'),'yyyy/mm/dd hh24:mi:ss')) <= P.DEP_FSH_DT AND	 
            P.DEP_FSH_DT < TRUNC(TO_DATE(NVL(C.EFF_TO_DT,'25000101'),'yyyy/mm/dd hh24:mi:ss')+1)	 
        )																							 
    ) 	

UNION ALL
SELECT C.SVC_USE_FLG, C.HUB_LOC_CD ROUT,'HUB' PORT_PNT_CD, C.PORT_CD||'(PORT)-'||C.HUB_LOC_CD||'(HUB)-'||C.NOD_CD||'(LOC)' ITEM,
  C.SPCL_CGO_CNTR_TP_CD,'',C.HUB_LOC_CNST_RMK,'',C.CRE_USR_ID
FROM PRD_HUB_LOC_CNST_MGMT C, PRD_PROD_CTL_MST M,PRD_PROD_CTL_ROUT_DTL D, PRD_PROD_CTL_QTY Q
WHERE C.PORT_CD  = DECODE(D.PCTL_IO_BND_CD,'I',SUBSTR(D.ROUT_ORG_NOD_CD,1,5),'O',SUBSTR(D.ROUT_DEST_NOD_CD,1,5)) 
AND C.HUB_LOC_CD = NVL((SELECT HUB_LOC_CD 
                         FROM PRD_INLND_ROUT_MST H
                        WHERE H.ROUT_ORG_NOD_CD = D.ROUT_ORG_NOD_CD
                          AND H.ROUT_DEST_NOD_CD = D.ROUT_DEST_NOD_CD
                          AND H.ROUT_SEQ = D.ROUT_SEQ),C.PORT_CD)
AND C.HUB_LOC_CD = SUBSTR(D.ORG_NOD_CD,1,5)
AND C.NOD_CD=DECODE(C.NOD_CD,'ALL',C.NOD_CD,DECODE(D.PCTL_IO_BND_CD,'I',SUBSTR(D.ROUT_DEST_NOD_CD,1,LENGTH(TRIM(C.NOD_CD))),'O',SUBSTR(D.ROUT_ORG_NOD_CD,1,LENGTH(TRIM(C.NOD_CD))))) 
AND C.IO_BND_CD= DECODE(C.IO_BND_CD,'B',C.IO_BND_CD,D.PCTL_IO_BND_CD)
AND D.PCTL_IO_BND_CD <> 'T'
AND M.PCTL_NO = D.PCTL_NO    
AND M.PCTL_NO = Q.PCTL_NO
AND Q.CNTR_TPSZ_CD LIKE NVL(C.CNTR_TP_CD,'%')||NVL(C.CNTR_SZ_CD,'%')
AND C.CNST_LANE_CD = (CASE WHEN C.CNST_LANE_CD = 'ALL' THEN C.CNST_LANE_CD
                            ELSE (SELECT DECODE(D.PCTL_IO_BND_CD,'O',SUBSTR(TRIM(N1ST_LANE_CD||N2ND_LANE_CD||N3RD_LANE_CD||N4TH_LANE_CD),1,3)
                                                                ,'I',SUBSTR(TRIM(N1ST_LANE_CD||N2ND_LANE_CD||N3RD_LANE_CD||N4TH_LANE_CD),-3)) 
                                    FROM PRD_OCN_ROUT O
                                   WHERE (ORG_LOC_CD, DEST_LOC_CD, ROUT_SEQ ) 
                                       = (SELECT DX.ROUT_ORG_NOD_CD, DX.ROUT_DEST_NOD_CD, DX.ROUT_SEQ
                                            FROM PRD_PROD_CTL_ROUT_DTL DX
                                           WHERE DX.PCTL_NO LIKE D.PCTL_NO
                                             AND DX.PCTL_IO_BND_CD ='T'
                                             AND ROWNUM =1)
                                  )
                      END)
AND NVL(C.SPCL_CGO_CNTR_TP_CD,'AL') = (CASE WHEN NVL(C.SPCL_CGO_CNTR_TP_CD,'AL') ='AL' THEN NVL(C.SPCL_CGO_CNTR_TP_CD,'AL')
                                            WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' AND NVL(M.RF_SPCL_FLG,'N') ='Y' THEN 'RD'
                                            WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' AND NVL(M.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AD'
                                            WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' THEN 'DG'
                                            WHEN NVL(M.RF_SPCL_FLG,'N') ='Y' THEN 'RF'
                                            WHEN NVL(M.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AK'
                                            WHEN NVL(M.BB_SPCL_FLG,'N') ='Y' THEN 'BB'
                                            WHEN NVL(M.DG_SPCL_FLG,'N') ='N' AND NVL(M.RF_SPCL_FLG,'N') ='N' AND NVL(M.SPCL_AWK_CGO_FLG,'N') ='N' AND NVL(M.BB_SPCL_FLG,'N') ='N'  THEN 'GP'
                                        END)
AND NVL(C.DIR_CD,'A') = (CASE WHEN NVL(C.DIR_CD,'A') = 'A' THEN NVL(C.DIR_CD,'A')
                              WHEN C.IO_BND_CD ='O' THEN  ( SELECT /*+ INDEX_ASC (DT XPKPRD_PROD_CTL_ROUT_DTL) */  SKD_DIR_CD 
                                                              FROM PRD_PROD_CTL_ROUT_DTL DT
                                                             WHERE PCTL_IO_BND_CD ='T'
                                                               AND PCTL_NO =M.PCTL_NO
                                                               AND ROWNUM = 1 ) 
                              WHEN C.IO_BND_CD ='I' THEN  ( SELECT /*+ INDEX_DESC (DT XPKPRD_PROD_CTL_ROUT_DTL) */  SKD_DIR_CD 
                                                              FROM PRD_PROD_CTL_ROUT_DTL DT
                                                             WHERE PCTL_IO_BND_CD ='T'
                                                               AND PCTL_NO =M.PCTL_NO
                                                               AND ROWNUM = 1 ) 
                              WHEN C.IO_BND_CD ='B' AND ( M.POR_CD = SUBSTR(C.NOD_CD,1,5) OR M.POL_CD = C.PORT_CD )   
                                                    THEN  ( SELECT /*+ INDEX_ASC (DT XPKPRD_PROD_CTL_ROUT_DTL) */  SKD_DIR_CD 
                                                              FROM PRD_PROD_CTL_ROUT_DTL DT
                                                             WHERE PCTL_IO_BND_CD ='T'
                                                               AND PCTL_NO =M.PCTL_NO
                                                               AND ROWNUM = 1 )                               
                              WHEN C.IO_BND_CD ='B' AND ( M.DEL_CD = SUBSTR(C.NOD_CD,1,5) OR M.POD_CD = C.PORT_CD )   
                                                    THEN  ( SELECT /*+ INDEX_DESC (DT XPKPRD_PROD_CTL_ROUT_DTL) */  SKD_DIR_CD 
                                                              FROM PRD_PROD_CTL_ROUT_DTL DT
                                                             WHERE PCTL_IO_BND_CD ='T'
                                                               AND PCTL_NO =M.PCTL_NO
                                                               AND ROWNUM = 1 ) 
                           END)
AND DECODE(C.NOD_CD,'ALL',1000,0) + DECODE(C.IO_BND_CD,'B',100,0) + DECODE(C.CNST_LANE_CD,'ALL',10,0) + DECODE(C.SPCL_CGO_CNTR_TP_CD,'AL',1,0) 
 = (SELECT MIN(DECODE(C2.NOD_CD,'ALL',1000,0) + DECODE(C2.IO_BND_CD,'B',100,0) + DECODE(C2.CNST_LANE_CD,'ALL',10,0) + DECODE(C2.SPCL_CGO_CNTR_TP_CD,'AL',1,0) )
     FROM PRD_HUB_LOC_CNST_MGMT C2
    WHERE C2.PORT_CD = C.PORT_CD
      AND C2.HUB_LOC_CD = C.HUB_LOC_CD
      AND C2.NOD_CD= DECODE(C2.NOD_CD,'ALL',C2.NOD_CD,DECODE(D.PCTL_IO_BND_CD,'I',SUBSTR(D.ROUT_DEST_NOD_CD,1,LENGTH(TRIM(C2.NOD_CD))),'O',SUBSTR(D.ROUT_ORG_NOD_CD,1,LENGTH(TRIM(C2.NOD_CD))))) 
      AND C2.IO_BND_CD =DECODE(C2.IO_BND_CD,'B',C2.IO_BND_CD,'ALL',C2.IO_BND_CD,D.PCTL_IO_BND_CD)
      AND C2.CNST_LANE_CD = (CASE WHEN C2.CNST_LANE_CD = 'ALL' THEN C2.CNST_LANE_CD
                                    ELSE (SELECT DECODE(D.PCTL_IO_BND_CD,'O',SUBSTR(TRIM(N1ST_LANE_CD||N2ND_LANE_CD||N3RD_LANE_CD||N4TH_LANE_CD),1,3)
                                                                        ,'I',SUBSTR(TRIM(N1ST_LANE_CD||N2ND_LANE_CD||N3RD_LANE_CD||N4TH_LANE_CD),-3)) 
                                            FROM PRD_OCN_ROUT O
                                           WHERE (ORG_LOC_CD, DEST_LOC_CD, ROUT_SEQ ) 
                                               = (SELECT DX.ROUT_ORG_NOD_CD, DX.ROUT_DEST_NOD_CD, DX.ROUT_SEQ
                                                    FROM PRD_PROD_CTL_ROUT_DTL DX
                                                   WHERE DX.PCTL_NO LIKE D.PCTL_NO
                                                     AND DX.PCTL_IO_BND_CD ='T'
                                                     AND ROWNUM =1) 
                                          )
                                END)
      AND NVL(C2.SPCL_CGO_CNTR_TP_CD,'AL') = (CASE WHEN NVL(C2.SPCL_CGO_CNTR_TP_CD,'AL') ='AL' THEN NVL(C2.SPCL_CGO_CNTR_TP_CD,'AL')
                                                   WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' AND NVL(M.RF_SPCL_FLG,'N') ='Y' THEN 'RD'
                                                   WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' AND NVL(M.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AD'
                                                   WHEN NVL(M.DG_SPCL_FLG,'N') ='Y' THEN 'DG'
                                                   WHEN NVL(M.RF_SPCL_FLG,'N') ='Y' THEN 'RF'
                                                   WHEN NVL(M.SPCL_AWK_CGO_FLG,'N') ='Y' THEN 'AK'
                                                   WHEN NVL(M.BB_SPCL_FLG,'N') ='Y' THEN 'BB'
                                                   WHEN NVL(M.DG_SPCL_FLG,'N') ='N' AND NVL(M.RF_SPCL_FLG,'N') ='N' AND NVL(M.SPCL_AWK_CGO_FLG,'N') ='N' AND NVL(M.BB_SPCL_FLG,'N') ='N'  THEN 'GP'
                                               END) 
      )
AND D.NOD_LNK_DIV_CD = 'N'  
AND D.PCTL_NO= @[pctl_no]
AND D.MTY_YD_FLG = 'N'			]]></sql>
			<params>
				<param name="pctl_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
