<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RailInvoiceauditDBDAOVerifyInvoiceFileImportSoIFListRSQL">
			<desc><![CDATA[Rail S/O Interface 테이블의 금액조회]]></desc>
			<sql><![CDATA[
SELECT																			 
    Z.TRSP_SO_OFC_CTY_CD															 
    ,	Z.TRSP_SO_SEQ																	 
    ,	''									AS RAIL_CMB_THRU_TP_CD						 
    ,	Z.CGO_TP_CD																		 
    ,	Z.CURR_CD																		 
    ,	SUM(Z.BZC_AMT)						AS BZC_AMT									 
    ,	''									AS FUEL_SCG_AMT								 
    ,	''									AS OVR_WGT_SCG_AMT							 
    ,	''									AS NEGO_AMT									 
    ,	SUM(Z.ETC_ADD_AMT)					AS ETC_ADD_AMT								 
    ,	CASE WHEN TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC(Z.CURR_CD					 
    											, SUM(TOT_AMT))						 
           = TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC(@[currency], @[invBilAmt])				 
         THEN 'C'																	 
    	 ELSE 'D'																	 
    END 								AS TRSP_RAIL_INV_AUD_CD						 
    ,	Z.RAIL_BIL_DT																	 
    ,	Z.EQ_TPSZ_CD																	 
    ,	Z.FM_NOD_CD																		 
    ,	SUBSTR(Z.FM_NOD_CD, 1,5)			AS FM_NOD_CD1								 
    ,	SUBSTR(Z.FM_NOD_CD, 6,2)			AS FM_NOD_CD2								 
    ,	Z.TO_NOD_CD																		 
    ,	SUBSTR(Z.TO_NOD_CD, 1,5)			AS TO_NOD_CD1								 
    ,	SUBSTR(Z.TO_NOD_CD, 6,2)			AS TO_NOD_CD2								 
    ,	DECODE(Z.TRSP_CO_IND_CD															 
    			,'T', 'DOM'															 
    			,'H', 'NIS'															 
    			,'S', 'SEN')			AS TRSP_INV_CO_IND_CD						 
    ,	'F'   								AS TRSP_INV_TP_CD							 
FROM																				 
    (																					 
        SELECT																			 
        	A.CNTR_NO AS EQ_NO
        ,	C.CNTR_TPSZ_CD AS EQ_TPSZ_CD
        ,	A.TRSP_SO_OFC_CTY_CD														 
        ,	A.TRSP_SO_SEQ																 
        ,	'F' AS CGO_TP_CD
        ,	'USD' AS CURR_CD																	 
        ,	B.AGMT_RT_AMT AS BZC_AMT
        ,	NVL('', 0) AS ETC_ADD_AMT
        ,	NVL(B.AGMT_RT_AMT, 0)
        +	NVL('', 0) AS TOT_AMT
        ,	CASE WHEN A.DMST_INV_STY_CD = 'T'
        		 THEN																	 
        		 (																		 
        			SELECT																 
        				FM_YD_CD
        			FROM																 
        				DOM_RAIL_SO_MST       DOM_A
                      , DOM_RAIL_SO_DTL       DOM_B
        			WHERE																 
        				DOM_A.TRSP_SO_OFC_CTY_CD = DOM_B.TRSP_SO_OFC_CTY_CD
                        AND DOM_A.TRSP_SO_SEQ       = DOM_B.TRSP_SO_SEQ
                        AND DOM_A.TRSP_SO_OFC_CTY_CD= A.TRSP_SO_OFC_CTY_CD
                        AND DOM_A.TRSP_SO_SEQ       = A.TRSP_SO_SEQ					 
        				AND DOM_A.CNTR_NO				= A.CNTR_NO								 
        				AND DOM_B.SUB_RAIL_SEQ	= 1							 
        		)																		 
        		ELSE B.FM_YD_CD
        	END FM_NOD_CD																 
        ,	CASE WHEN A.DMST_INV_STY_CD = 'T'
        		 THEN																	 
        		 (																		 
        			NVL(																 
        			(																	 
        				SELECT															 
        					TO_YD_CD
        				FROM															 
        					DOM_RAIL_SO_MST       DOM_A
                          , DOM_RAIL_SO_DTL       DOM_B
        				WHERE															 
        					DOM_A.TRSP_SO_OFC_CTY_CD = DOM_B.TRSP_SO_OFC_CTY_CD
                            AND DOM_A.TRSP_SO_SEQ       = DOM_B.TRSP_SO_SEQ
                            AND DOM_A.TRSP_SO_OFC_CTY_CD= A.TRSP_SO_OFC_CTY_CD
                            AND DOM_A.TRSP_SO_SEQ       = A.TRSP_SO_SEQ						 					 
        					AND DOM_A.CNTR_NO				= A.CNTR_NO							 
        					AND DOM_B.SUB_RAIL_SEQ	= 2						 
        			),																	 
        			(																	 
        				SELECT															 
        					TO_YD_CD
        				FROM															 
        					DOM_RAIL_SO_MST       DOM_A
                          , DOM_RAIL_SO_DTL       DOM_B
        				WHERE															 
        					DOM_A.TRSP_SO_OFC_CTY_CD = DOM_B.TRSP_SO_OFC_CTY_CD
                            AND DOM_A.TRSP_SO_SEQ       = DOM_B.TRSP_SO_SEQ
                            AND DOM_A.TRSP_SO_OFC_CTY_CD= A.TRSP_SO_OFC_CTY_CD
                            AND DOM_A.TRSP_SO_SEQ       = A.TRSP_SO_SEQ						 					 
        					AND DOM_A.CNTR_NO				= A.CNTR_NO								 
        					AND DOM_B.SUB_RAIL_SEQ	= 1						 
        			)																	 
        			)																	 
        		)																		 
        		ELSE B.TO_YD_CD
        	END TO_NOD_CD																 
        ,	TO_CHAR(A.CRE_DT ,'YYYYMMDD') AS RAIL_BIL_DT
        ,	'T' AS TRSP_CO_IND_CD
        FROM																			 
        	DOM_RAIL_SO_MST       A
          , DOM_RAIL_SO_DTL       B
          , MST_CONTAINER         C
          , DOM_BOOKING           D
		  , TRS_TRSP_RAIL_INV_DTL E
        WHERE A.TRSP_SO_OFC_CTY_CD = B.TRSP_SO_OFC_CTY_CD
        AND   A.TRSP_SO_SEQ = B.TRSP_SO_SEQ
        AND   A.CNTR_NO = C.CNTR_NO
        AND   A.DMST_BKG_NO = D.DMST_BKG_NO
        AND   A.CNTR_NO = D.CNTR_NO
		AND   B.PAIR_VNDR_SEQ = @[railRoadCode]													 
        AND	  A.CNTR_NO = @[cntrNo]
        AND	  A.CRE_DT				BETWEEN	TO_DATE( @[wblDt]||'000001','YYYYMMDDHH24MISS')-7	 
        							AND		TO_DATE( @[wblDt]||'235959','YYYYMMDDHH24MISS')+3
        AND	  A.DELT_FLG			= 'N'	
		AND   A.TRSP_SO_OFC_CTY_CD= E.TRSP_SO_OFC_CTY_CD(+)
		AND   A.TRSP_SO_SEQ       = E.TRSP_SO_SEQ(+)
		AND   A.CNTR_NO           = E.EQ_NO(+)
		AND   @[railRoadCode]     = E.INV_VNDR_SEQ(+)
		AND   E.INV_NO IS NULL											 
    ) Z																				 
GROUP BY																			 
Z.TRSP_SO_OFC_CTY_CD															 
,	Z.TRSP_SO_SEQ																	 
,	Z.CGO_TP_CD																		 
,	Z.CURR_CD																		 
,	Z.RAIL_BIL_DT																	 
,	Z.EQ_NO																			 
,	Z.EQ_TPSZ_CD																	 
,	Z.FM_NOD_CD																		 
,	Z.TO_NOD_CD																		 
,	Z.TRSP_CO_IND_CD																 
ORDER BY																			 
Z.TRSP_CO_IND_CD			]]></sql>
			<params>
				<param name="currency" type="12" value="" out="N"/>
				<param name="invBilAmt" type="12" value="" out="N"/>
				<param name="railRoadCode" type="12" value="" out="N"/>
				<param name="cntrNo" type="12" value="" out="N"/>
				<param name="wblDt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
