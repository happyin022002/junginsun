<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ProductCatalogCreateDBDAOSearchProdOceanRoutRSQL">
			<desc><![CDATA[ProductCatalogCreateDBDAOSearchProdOceanRout]]></desc>
			<sql><![CDATA[
SELECT
  count(*) cnt
FROM PRD_OCN_ROUT A,MDM_VSL_SVC_LANE N1,MDM_VSL_SVC_LANE N2,MDM_VSL_SVC_LANE N3,MDM_VSL_SVC_LANE N4,
     (SELECT @[por] POR_POL FROM DUAL -- CHO possible POR (이 경우는 POR=POL이 같은 경우다)
       UNION 
      SELECT EQLZ_PORT_CD 
        FROM BKG_EQLZ_PORT 
       WHERE LOC_CD = (CASE WHEN (@[pol] IS NULL OR @[pol] = @[por]) AND @[por_n] IS NULL AND @[pol_n] IS NULL AND @[m_pu] IS NULL THEN @[por] ELSE 'X' END)
     ) POR,
     (SELECT @[del] POD_DEL FROM DUAL 
       UNION 
      SELECT EQLZ_PORT_CD 
        FROM BKG_EQLZ_PORT 
       WHERE LOC_CD = (CASE WHEN (@[pod] IS NULL OR @[pod] = @[del]) AND @[pod_n] IS NULL AND @[del_n] IS NULL THEN @[del] ELSE 'X' END)
     ) DEL
WHERE A.ORG_LOC_CD IN (  -- CHO 
					SELECT DISTINCT PORT_CD
					  FROM PRD_HUB_LOC_MTCH J1
					 WHERE J1.LOC_CD = POR.POR_POL)
AND A.ORG_LOC_CD = DECODE(@[pol],@[por],A.ORG_LOC_CD,NVL(@[pol],A.ORG_LOC_CD))
AND A.DEST_LOC_CD IN (  -- CHO 
                     SELECT DISTINCT PORT_CD 
                       FROM PRD_HUB_LOC_MTCH 
                      WHERE LOC_CD = DEL.POD_DEL )
AND A.DEST_LOC_CD = DECODE(@[pod],@[del],A.DEST_LOC_CD,NVL(@[pod],A.DEST_LOC_CD))
AND A.ROUT_SEQ = A.ROUT_SEQ
AND NVL(A.UPD_IND_CD,'S') IN ('C','U','S','T','A','V','G')
AND N1.VSL_SLAN_CD(+) = N1ST_LANE_CD
AND N2.VSL_SLAN_CD(+) = N2ND_LANE_CD
AND N3.VSL_SLAN_CD(+) = N3RD_LANE_CD
AND N4.VSL_SLAN_CD(+) = N4TH_LANE_CD
AND NVL(N1ST_POD_CD, 'XX') = CASE WHEN A.LNK_KNT = 1 AND NVL(@[pod], 'X') <> 'X' THEN @[pod] ELSE NVL(N1ST_POD_CD, 'XX') END 
AND NVL(N2ND_POD_CD, 'XX') = CASE WHEN A.LNK_KNT = 2 AND NVL(@[pod], 'X') <> 'X' THEN @[pod] ELSE NVL(N2ND_POD_CD, 'XX') END 
AND NVL(N3RD_POD_CD, 'XX') = CASE WHEN A.LNK_KNT = 3 AND NVL(@[pod], 'X') <> 'X' THEN @[pod] ELSE NVL(N3RD_POD_CD, 'XX') END 
AND NVL(N4TH_POD_CD, 'XX') = CASE WHEN A.LNK_KNT = 4 AND NVL(@[pod], 'X') <> 'X' THEN @[pod] ELSE NVL(N4TH_POD_CD, 'XX') END                      
AND N1ST_LANE_CD IN ( NVL(@[lane1],N1ST_LANE_CD),(SELECT DECODE(VSL_SVC_TP_CD,'O','FDR',VSL_SLAN_CD) FROM MDM_VSL_SVC_LANE WHERE VSL_SLAN_CD = @[lane1]) )
AND NVL(N1ST_LANE_CD, 'X') IN ( DECODE(A.LNK_KNT, 1, NVL(NVL(@[lane2], N1ST_LANE_CD), 'X'), NVL(N1ST_LANE_CD, 'X')), DECODE(A.LNK_KNT, 1, (SELECT DECODE(VSL_SVC_TP_CD,'O','FDR',VSL_SLAN_CD) FROM MDM_VSL_SVC_LANE WHERE VSL_SLAN_CD  = @[lane2]), NVL(N1ST_LANE_CD, 'X')))
AND NVL(N2ND_LANE_CD, 'X') IN ( DECODE(A.LNK_KNT, 2, NVL(NVL(@[lane2], N2ND_LANE_CD), 'X'), NVL(N2ND_LANE_CD, 'X')), DECODE(A.LNK_KNT, 2, (SELECT DECODE(VSL_SVC_TP_CD,'O','FDR',VSL_SLAN_CD) FROM MDM_VSL_SVC_LANE WHERE VSL_SLAN_CD  = @[lane2]), NVL(N2ND_LANE_CD, 'X')))
AND NVL(N3RD_LANE_CD, 'X') IN ( DECODE(A.LNK_KNT, 3, NVL(NVL(@[lane2], N3RD_LANE_CD), 'X'), NVL(N3RD_LANE_CD, 'X')), DECODE(A.LNK_KNT, 3, (SELECT DECODE(VSL_SVC_TP_CD,'O','FDR',VSL_SLAN_CD) FROM MDM_VSL_SVC_LANE WHERE VSL_SLAN_CD  = @[lane2]), NVL(N3RD_LANE_CD, 'X')))
AND NVL(N4TH_LANE_CD, 'X') IN ( DECODE(A.LNK_KNT, 4, NVL(NVL(@[lane2], N4TH_LANE_CD), 'X'), NVL(N4TH_LANE_CD, 'X')), DECODE(A.LNK_KNT, 4, (SELECT DECODE(VSL_SVC_TP_CD,'O','FDR',VSL_SLAN_CD) FROM MDM_VSL_SVC_LANE WHERE VSL_SLAN_CD  = @[lane2]), NVL(N4TH_LANE_CD, 'X')))                              
AND NOT EXISTS
(
   SELECT 'X' FROM PRD_MBGO_MGMT TT
   WHERE SUBSTR (A.ORG_LOC_CD, 1, 2) = TT.FM_CNT_CD
   AND A.TS_IND_CD = 'D'
   AND SUBSTR (A.DEST_LOC_CD, 1, 2) = TT.TO_CNT_CD
)
			]]></sql>
			<params>
				<param name="por" type="12" value="" out="N"/>
				<param name="pol" type="12" value="" out="N"/>
				<param name="por_n" type="12" value="" out="N"/>
				<param name="pol_n" type="12" value="" out="N"/>
				<param name="m_pu" type="12" value="" out="N"/>
				<param name="del" type="12" value="" out="N"/>
				<param name="pod" type="12" value="" out="N"/>
				<param name="pod_n" type="12" value="" out="N"/>
				<param name="del_n" type="12" value="" out="N"/>
				<param name="lane1" type="12" value="" out="N"/>
				<param name="lane2" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
