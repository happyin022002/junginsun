<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PreDispatchSentHistoryDBDAOSearchPreDispatchSentHistoryRSQL">
			<desc><![CDATA[searchPreDispatchSentHistory]]></desc>
			<sql><![CDATA[
SELECT
      A.TRSP_SO_OFC_CTY_CD
     ,A.TRSP_SO_SEQ       
     ,B.TRSP_DIS_REF_NO   
     ,A.TRSP_WO_OFC_CTY_CD
     ,A.TRSP_WO_SEQ             
     ,A.VNDR_SEQ VNDR_SEQ 
     ,D.VNDR_ABBR_NM      
     ,TO_CHAR(C.CRE_DT, 'YYYY-MM-DD HH24:MI:SS') SNT_DT
     ,C.TRSP_DIS_ISS_SEQ
     ,C.DIS_N1ST_FAX_NO 
     ,C.DIS_N2ND_FAX_NO 
     ,C.DIS_N3RD_FAX_NO 
     ,COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00959', FAX1.FAX_PROC_STS_CD) DIS_N1ST_FAX_RSLT_FLG
     ,COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00959', FAX2.FAX_PROC_STS_CD) DIS_N2ND_FAX_RSLT_FLG
     ,COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00959', FAX3.FAX_PROC_STS_CD) DIS_N3RD_FAX_RSLT_FLG
     ,C.DIS_N1ST_EML
     ,C.DIS_N2ND_EML
     ,C.DIS_N3RD_EML
     ,COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00960', EML1.EML_PROC_STS_CD) DIS_N1ST_EML_RSLT_FLG
     ,COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00960', EML2.EML_PROC_STS_CD) DIS_N2ND_EML_RSLT_FLG
     ,COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00960', EML3.EML_PROC_STS_CD) DIS_N3RD_EML_RSLT_FLG
FROM  TRS_TRSP_SVC_ORD A
    , TRS_TRSP_DIS_MST B
    , TRS_TRSP_DIS_HIS C
    , MDM_VENDOR D
    , TRS_TRSP_WRK_ORD E
    , COM_FAX_SND_INFO FAX1
    , COM_FAX_SND_INFO FAX2
    , COM_FAX_SND_INFO FAX3
    , COM_EML_SND_INFO EML1
    , COM_EML_SND_INFO EML2
    , COM_EML_SND_INFO EML3
    , MDM_LOCATION LOC
WHERE A.TRSP_SO_OFC_CTY_CD  = B.TRSP_SO_OFC_CTY_CD
AND   A.TRSP_SO_SEQ         = B.TRSP_SO_SEQ
AND   A.TRSP_WO_OFC_CTY_CD  = B.TRSP_WO_OFC_CTY_CD
AND   A.TRSP_WO_SEQ         = B.TRSP_WO_SEQ
AND   B.TRSP_SO_OFC_CTY_CD  = C.TRSP_SO_OFC_CTY_CD
AND   B.TRSP_SO_SEQ         = C.TRSP_SO_SEQ
AND   B.TRSP_WO_OFC_CTY_CD  = C.TRSP_WO_OFC_CTY_CD
AND   B.TRSP_WO_SEQ         = C.TRSP_WO_SEQ
AND   B.TRSP_DIS_REF_NO     = C.TRSP_DIS_REF_NO
AND   A.TRSP_WO_OFC_CTY_CD  = E.TRSP_WO_OFC_CTY_CD
AND   A.TRSP_WO_SEQ         = E.TRSP_WO_SEQ
AND   C.DIS_N1ST_FAX_SND_NO = FAX1.FAX_SND_NO(+)
AND   C.DIS_N2ND_FAX_SND_NO = FAX2.FAX_SND_NO(+)
AND   C.DIS_N3RD_FAX_SND_NO = FAX3.FAX_SND_NO(+)
AND   C.DIS_N1ST_EML_SND_NO = EML1.EML_SND_NO(+)
AND   C.DIS_N2ND_EML_SND_NO = EML2.EML_SND_NO(+)
AND   C.DIS_N3RD_EML_SND_NO = EML3.EML_SND_NO(+)
AND   A.VNDR_SEQ = D.VNDR_SEQ
AND   B.TRSP_WO_CXL_FLG IS NULL
AND   A.TRSP_CRR_MOD_CD = 'TD'
AND   A.TRSP_SO_STS_CD  = 'I'
AND   A.DELT_FLG        = 'N'
AND   LOC.LOC_CD   = SUBSTR(A.FM_NOD_CD, 1, 5)
AND   LOC.CONTI_CD = 'M'
AND   LOC.DELT_FLG = 'N'
AND   A.CRE_OFC_CD      = @[ctrl_ofc_cd]
#if ( ${hid_frmdate} != '' && ${hid_todate} != '' )
    #if ( ${rad_wonotic} == 'W' )
        AND E.LOCL_CRE_DT BETWEEN TO_DATE(${hid_frmdate}, 'YYYYMMDD') AND TO_DATE(${hid_todate}, 'YYYYMMDD') + 0.99999
    #elseif ( ${rad_wonotic} == 'L' )
        AND B.DLY_DIS_SNT_DT BETWEEN TO_DATE(${hid_frmdate}, 'YYYYMMDD') AND TO_DATE(${hid_todate}, 'YYYYMMDD') + 0.99999
    #elseif ( ${rad_wonotic} == 'N' )
        AND C.CRE_DT BETWEEN TO_DATE(${hid_frmdate}, 'YYYYMMDD') AND TO_DATE(${hid_todate}, 'YYYYMMDD') + 0.99999
        AND C.CNTR_AVAL_NTC_UPD_FLG IS NOT NULL
    #end
#end

#if ($arr_wo_no.size() > 0) 
    AND (A.TRSP_WO_OFC_CTY_CD, A.TRSP_WO_SEQ) in (
    #foreach( ${key} in ${arr_wo_no}) 
	    #if($velocityCount < $arr_wo_no.size()) 
		    (SUBSTR('$key',1,3),SUBSTR('$key',4)),
	    #else 
		    (SUBSTR('$key',1,3),SUBSTR('$key',4))
	    #end 
    #end
	)
#end

#if($arr_bkg_no.size() > 0)
AND A.BKG_NO IN (
    #foreach(${bkg_no} IN ${arr_bkg_no})
		#if($velocityCount == 1)
	        '${bkg_no}'
		#else
	       ,'${bkg_no}'
		#end
    #end
    )
#end
#if($arr_bill_no.size() > 0)
AND A.BL_NO IN (
    #foreach(${bill_no} IN ${arr_bill_no})
		#if($velocityCount == 1)
	        '${bill_no}'
		#else
	       ,'${bill_no}'
		#end
    #end
    )
#end
#if($arr_cntr_no.size() > 0)
AND A.EQ_NO IN (
    #foreach(${cntr_no} IN ${arr_cntr_no})
		#if($velocityCount == 1)
	        '${cntr_no}'
		#else
	       ,'${cntr_no}'
		#end
    #end
)
#end
#if ( ${reference_no} != '' )
AND B.TRSP_DIS_REF_NO = '${reference_no}'
#end
#if ( ${wo_iss_ofc_cd} != '' )
AND E.CRE_OFC_CD = '${wo_iss_ofc_cd}'
#end
#if ( ${combo_svc_provider} != '' )
AND A.VNDR_SEQ = ${combo_svc_provider}
#end
ORDER BY B.TRSP_DIS_REF_NO, C.TRSP_DIS_ISS_SEQ			]]></sql>
			<params>
				<param name="ctrl_ofc_cd" type="12" value="CHIBB" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
