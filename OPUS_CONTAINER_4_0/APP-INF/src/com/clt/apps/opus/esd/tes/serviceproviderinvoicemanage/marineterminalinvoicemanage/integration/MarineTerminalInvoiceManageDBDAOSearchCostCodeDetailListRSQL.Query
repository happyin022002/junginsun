<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MarineTerminalInvoiceManageDBDAOSearchCostCodeDetailListRSQL">
			<desc><![CDATA[SearchCostCodeDetailList]]></desc>
			<sql><![CDATA[
/* Cost Code 별 detail 가져오는 쿼리 */
SELECT DISTINCT 
        'S'            AS calc_tp_cd
       ,A.LGS_COST_CD  AS lgs_cost_cd
       ,D.CNTR_TPSZ_CD AS cntr_tpsz_cd 
       ,A.IO_BND_CD    AS io_bnd_cd
	   ,CASE WHEN @[dcgo_ind_cd]='ALL'
              AND A.DCGO_APLY_TP_CD   = 'A'
              AND C.DCGO_NON_CLSS_FLG = 'Y'
             THEN 'AN'
             WHEN @[dcgo_ind_cd]='ALL'
              AND A.DCGO_APLY_TP_CD   = 'A'
              AND C.DCGO_SAM_CLSS_FLG = 'Y' 
             THEN 'AS'
             WHEN @[dcgo_ind_cd]='ALL'
              AND A.DCGO_APLY_TP_CD   = 'S'
              AND C.DCGO_NON_CLSS_FLG = 'Y'
             THEN 'SN'
             WHEN @[dcgo_ind_cd]='ALL'
              AND C.DCGO_N1ST_CLSS_FLG = 'Y'
             THEN '1'
             WHEN @[dcgo_ind_cd]='ALL'
              AND C.DCGO_N2ND_CLSS_FLG = 'Y'
             THEN '2'
             WHEN @[dcgo_ind_cd]='ALL'
              AND C.DCGO_N3RD_CLSS_FLG = 'Y'
             THEN '3'
             WHEN @[dcgo_ind_cd]='ALL'
              AND C.DCGO_N4TH_CLSS_FLG = 'Y'
             THEN '4'
             WHEN @[dcgo_ind_cd]='ALL'
              AND C.DCGO_N5TH_CLSS_FLG = 'Y'
             THEN '5'
             WHEN @[dcgo_ind_cd]='ALL'
              AND C.DCGO_N6TH_CLSS_FLG = 'Y'
             THEN '6'
             WHEN @[dcgo_ind_cd]='ALL'
              AND C.DCGO_N7TH_CLSS_FLG = 'Y'
             THEN '7'
             WHEN @[dcgo_ind_cd]='ALL'
              AND C.DCGO_N8TH_CLSS_FLG = 'Y'
             THEN '8'
             WHEN @[dcgo_ind_cd]='ALL'
              AND C.DCGO_N9TH_CLSS_FLG = 'Y'
             THEN '9'
			 WHEN 'ALL' = 'ALL'
             AND  A.DCGO_APLY_TP_CD = 'N'
             THEN 'None'
             ELSE @[dcgo_ind_cd]            
             END dcgo_ind_cd
       ,''               AS rc_flg            /* Referer  */
       ,@[tml_wrk_dy_cd] AS tml_wrk_dy_cd     /* Apply Date */ 

       ,DECODE(A.IOC_CD, 'I','IPC','S','Same','O','OCN') AS ioc_cd /* IPC */
       ,DECODE(A.TML_TRNS_MOD_CD,'V','Mother','R','Rail','T','Truck','B','Barge','O','Other','S','Same','F','Feeder') AS tml_trns_mod_cd /* Mode */
       ,A.LANE_CD      AS lane_cd
       ,DECODE(A.SUB_TRD_CD,'O','OTH','','',A.SUB_TRD_CD) AS SUB_TRD_CD
       ,'1 ~ 9999999'    AS tier               /* VOL. Tier*/
       ,'1'           AS calc_vol_qty        /* Calculated\\\\\\\\nVol. */
       ,'1'           AS rvis_vol_qty        /* Revised\\\\\\\\n Vol. */
	   ,'1'           AS stay_days   
       ,A.TML_AGMT_VOL_UT_CD AS vol_tr_ut_cd /* UOM */
       ,D.AGMT_RT      AS ctrt_rt            /* Rate */
       ,A.CURR_CD      AS curr_cd            /* AGMT Curr */
       ,NVL('1',1) * NVL(D.AGMT_RT,0) AS inv_amt /* Amount */
       /* VO Fields */
       ,'' AS cost_code
       ,'' AS agmt_ofc_cty_cd
       ,'' AS agmt_seq
       ,'' AS agmt_ver_no
       ,'' AS yd_cd
       ,'' AS vndr_seq      
       ,'' AS eff_fm_dt
       ,'' AS eff_to_dt
       ,'' AS cre_ofc_cd
       ,'' AS ctrt_ofc_cd
       ,'' AS cre_dt
       ,'' AS upd_dt
	   ,100 AS portion
	   , 1 AS inv_xch_rt
	   , A.AGMT_DTL_RMK
FROM TES_TML_AGMT_DTL A, 
  TES_TML_AGMT_APLY_DY B, 
  TES_TML_AGMT_DG_CGO_CLSS C, 
  (  SELECT A.TML_AGMT_OFC_CTY_CD, 
              A.TML_AGMT_SEQ, 
              A.TML_AGMT_VER_NO, 
              A.TML_AGMT_DTL_SEQ, 
	#if (${cost_cd_inv_tp_cd} == 'SE' || ${cost_cd_inv_tp_cd} == 'OE') 
              B.EQ_APLY_TP_CD CNTR_APLY_TP_CD, 
              B.EQ_TPSZ_CD CNTR_TPSZ_CD, 
	#else
              B.CNTR_APLY_TP_CD , 
              B.CNTR_TPSZ_CD, 
	#end

              A.LGS_COST_CD, 
              A.tml_agmt_vol_ut_cd, 
              DECODE(AGMT_RT,NULL,a.agmt_ut_rt,AGMT_RT) AGMT_RT 
    FROM TES_TML_AGMT_DTL A, 
      	(	SELECT * 
	#if (${cost_cd_inv_tp_cd} == 'SE' || ${cost_cd_inv_tp_cd} == 'OE') 
			FROM TES_TML_AGMT_EQ_TP_SZ
			WHERE 1=1
			AND EQ_APLY_TP_CD = 'R'
	#else
			FROM TES_TML_AGMT_TP_SZ
			WHERE 1=1
			AND CNTR_TPSZ_CD NOT IN ('DW','DX')
	#end 
			

	#if (${rf_yn} == 'Y') 
		AND CNTR_TPSZ_CD  IN ('R2','R4','R5','R7','R8','R9')
	#end
		
		) B 
    WHERE A.TML_AGMT_OFC_CTY_CD = B.TML_AGMT_OFC_CTY_CD(+) 
      AND A.TML_AGMT_SEQ = B.TML_AGMT_SEQ(+) 
      AND A.TML_AGMT_VER_NO = B.TML_AGMT_VER_NO(+) 
      AND A.TML_AGMT_DTL_SEQ = B.TML_AGMT_DTL_SEQ(+) 
      AND A.TML_AGMT_OFC_CTY_CD = @[agmt_ofc_cty_cd]
      AND A.TML_AGMT_SEQ        = TO_NUMBER(@[agmt_seq])
      AND A.TML_AGMT_VER_NO     = TO_NUMBER(REPLACE(@[agmt_ver_no],'.',''))
      AND A.LGS_COST_CD         = @[cost_code]
	  AND NVL(A.TML_FREE_DYS_TP_CD,'R')  = 'R'

  ) D 
WHERE 1=1
  AND A.TML_AGMT_OFC_CTY_CD = @[agmt_ofc_cty_cd]
  AND A.TML_AGMT_SEQ        = TO_NUMBER(@[agmt_seq])
  AND A.TML_AGMT_VER_NO     = TO_NUMBER(REPLACE(@[agmt_ver_no],'.',''))
  AND A.LGS_COST_CD         = @[cost_code]
  AND NVL(A.TML_FREE_DYS_TP_CD,'R')  = 'R'
  AND A.TMP_SAV_FLG IS NULL 
  AND A.TML_AGMT_OFC_CTY_CD = B.TML_AGMT_OFC_CTY_CD(+) 
  AND A.TML_AGMT_OFC_CTY_CD = C.TML_AGMT_OFC_CTY_CD(+) 
  AND A.TML_AGMT_OFC_CTY_CD = D.TML_AGMT_OFC_CTY_CD(+) 
  AND A.TML_AGMT_SEQ = B.TML_AGMT_SEQ(+) 
  AND A.TML_AGMT_SEQ = C.TML_AGMT_SEQ(+) 
  AND A.TML_AGMT_SEQ = D.TML_AGMT_SEQ(+) 
  AND A.TML_AGMT_VER_NO = B.TML_AGMT_VER_NO(+) 
  AND A.TML_AGMT_VER_NO = C.TML_AGMT_VER_NO(+) 
  AND A.TML_AGMT_VER_NO = D.TML_AGMT_VER_NO(+) 
  AND A.TML_AGMT_DTL_SEQ = B.TML_AGMT_DTL_SEQ(+) 
  AND A.TML_AGMT_DTL_SEQ = C.TML_AGMT_DTL_SEQ(+) 
  AND A.TML_AGMT_DTL_SEQ = D.TML_AGMT_DTL_SEQ(+) 

 
#if (${tml_agmt_vol_ut_cd} != 'ALL') 
	AND A.TML_AGMT_VOL_UT_CD = @[tml_agmt_vol_ut_cd]
#end

#if (${cntr_tpsz_cd} != 'ALL') 
	AND D.CNTR_TPSZ_CD =@[cntr_tpsz_cd]
#end


#if (${dcgo_ind_cd} == 'ALL') -- DG 전부 보여줌
	AND (A.DCGO_APLY_TP_CD IN ('N','A','S') OR A.DCGO_APLY_TP_CD IS NULL) 
#elseif (${dcgo_ind_cd} == 'N') -- DG NONE 
    AND A.DCGO_APLY_TP_CD = 'N'  
#elseif (${dcgo_ind_cd} == 'AN') -- SAME NO DG 인것
    AND A.DCGO_APLY_TP_CD   = 'A'
    AND C.DCGO_NON_CLSS_FLG = 'Y'
#elseif (${dcgo_ind_cd} == 'AS') -- SAME DG 인것
    AND A.DCGO_APLY_TP_CD   = 'A'
    AND C.DCGO_SAM_CLSS_FLG = 'Y'
#elseif (${dcgo_ind_cd} == 'SN') -- Seperate No DG 인것
    AND A.DCGO_APLY_TP_CD   = 'S'
    AND C.DCGO_NON_CLSS_FLG = 'Y'
#else -- Seperate 1,2,3~9 인것
    AND DECODE(@[dcgo_ind_cd], '1',C.DCGO_N1ST_CLSS_FLG, '2',C.DCGO_N2ND_CLSS_FLG, '3',C.DCGO_N3RD_CLSS_FLG, '4',C.DCGO_N4TH_CLSS_FLG, '5',C.DCGO_N5TH_CLSS_FLG,
                               '6',C.DCGO_N6TH_CLSS_FLG, '7',C.DCGO_N7TH_CLSS_FLG, '8',C.DCGO_N8TH_CLSS_FLG, '9',C.DCGO_N9TH_CLSS_FLG) = 'Y'
#end


#if (${tml_wrk_dy_cd} != '') 
	 AND DECODE(@[tml_wrk_dy_cd],  'HO',B.HOL_FLG, 'SA',B.SAT_FLG, 'SU',B.SUN_FLG, 'WD',B.WKDY_FLG) = 'Y'
#end

ORDER BY LGS_COST_CD DESC, cntr_tpsz_cd, io_bnd_cd, dcgo_ind_cd, rc_flg, tml_wrk_dy_cd, ioc_cd, tml_trns_mod_cd, lane_cd, tier, calc_vol_qty, rvis_vol_qty, vol_tr_ut_cd, ctrt_rt, curr_cd			]]></sql>
			<params>
				<param name="dcgo_ind_cd" type="12" value="" out="N"/>
				<param name="tml_wrk_dy_cd" type="12" value="" out="N"/>
				<param name="agmt_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="agmt_seq" type="12" value="" out="N"/>
				<param name="agmt_ver_no" type="12" value="" out="N"/>
				<param name="cost_code" type="12" value="" out="N"/>
				<param name="tml_agmt_vol_ut_cd" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
