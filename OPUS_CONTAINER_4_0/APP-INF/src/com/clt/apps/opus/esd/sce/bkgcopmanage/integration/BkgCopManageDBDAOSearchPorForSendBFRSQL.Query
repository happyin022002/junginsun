<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BkgCopManageDBDAOSearchPorForSendBFRSQL">
			<desc><![CDATA[BF edi status 를 전송하기 위하여 POR 정보를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT DISTINCT cntr_no,
  b.bkg_no,
  nod_cd,
  act_dt,
  b.cop_no,
  'BF' as edi_stnd_sts_cd,
  'COP' as cre_usr_id
FROM edi_grp_cgo cgo,
  edi_grp_cust cust,
  bkg_customer bcust,
  (
    SELECT @[cntr_no] as cntr_no,
      @[bkg_no] as bkg_no,
      por_nod_cd as nod_cd,
	  cop_no,
      TO_CHAR( GLOBALDATE_PKG.TIME_CONV_FNC(COM_ConstantMgr_PKG.COM_getBaseLocationCode_FNC(), sysdate, substr(por_nod_cd, 1, 5)), 'YYYYMMDDHH24MISS' ) act_dt
    FROM sce_cop_hdr
    WHERE bkg_no = @[bkg_no]
      AND cntr_no = @[cntr_no] ) b
WHERE cgo.edi_stnd_sts_cd = 'BF'
  AND cgo.edi_grp_cd = cust.edi_grp_cd
  AND cust.cust_cnt_cd = bcust.cust_cnt_cd
  AND cust.cust_seq = bcust.cust_seq
  AND bcust.bkg_no = b.bkg_no
UNION
SELECT DISTINCT cntr_no,
  b.bkg_no,
  nod_cd,
  act_dt,
  b.cop_no,
  'BF' as edi_stnd_sts_cd,
  'COP' as cre_usr_id
FROM edi_grp_cgo cgo,
  edi_grp_cust cust,
  bkg_booking bkg,
  (
    SELECT @[cntr_no] as cntr_no,
      @[bkg_no] as bkg_no,
      por_nod_cd as nod_cd,
	  cop_no,
      TO_CHAR( GLOBALDATE_PKG.TIME_CONV_FNC(COM_ConstantMgr_PKG.COM_getBaseLocationCode_FNC(), sysdate, substr(por_nod_cd, 1, 5)), 'YYYYMMDDHH24MISS' ) act_dt
    FROM sce_cop_hdr
    WHERE bkg_no = @[bkg_no]
      AND cntr_no = @[cntr_no] ) b
WHERE cgo.edi_stnd_sts_cd = 'BF'
  AND cgo.edi_grp_cd = cust.edi_grp_cd
  AND cust.sc_no = DECODE(cust.bkg_ctrt_div_cd, '1', bkg.sc_no, '2', bkg.rfa_no)
  AND bkg.bkg_no = b.bkg_no			]]></sql>
			<params>
				<param name="cntr_no" type="12" value="SENU5059360" out="N"/>
				<param name="bkg_no" type="12" value="NYC000020210" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
