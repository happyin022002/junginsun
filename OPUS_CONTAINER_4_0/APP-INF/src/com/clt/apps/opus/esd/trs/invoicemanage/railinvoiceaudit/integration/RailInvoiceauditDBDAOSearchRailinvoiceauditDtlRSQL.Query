<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RailInvoiceauditDBDAOSearchRailinvoiceauditDtlRSQL">
			<desc><![CDATA[RailInvoice에 대한 Detail 정보 조회]]></desc>
			<sql><![CDATA[
SELECT X.TRSP_INV_CO_IND_CD
      ,X.TRSP_INV_TP_CD
      ,X.RAIL_BIL_DT
      ,X.WBL_DT
      ,X.WBL_NO
      ,X.INV_RMK
      ,X.SUB_INV_SEQ
      ,X.TRSP_SO_OFC_CTY_CD
      ,X.TRSP_SO_SEQ
      ,X.SUB_RAIL_SEQ
      ,X.ORG_TRSP_RAIL_INV_AUD_CD
      ,X.CRNT_TRSP_RAIL_INV_AUD_CD
      ,X.PAY_FLG
      ,X.EQ_NO
      ,X.EQ_TPSZ_CD
      ,X.CGO_TP_CD
      ,X.FM_NOD_CD1
      ,X.FM_NOD_CD2
      ,X.TO_NOD_CD1
      ,X.TO_NOD_CD2
      ,X.FM_NOD_CD
      ,X.TO_NOD_CD
      ,X.INV_ORG_NOD_NM
      ,X.INV_DEST_NOD_NM
      ,X.CURR_CD
      ,X.BZC_AMT
      ,X.FUEL_SCG_AMT
      ,X.OVR_WGT_SCG_AMT
      ,X.NEGO_AMT
      ,X.INV_CURR_CD
      ,X.INV_BZC_AMT
      ,X.INV_BIL_AMT
      ,X.INV_ETC_ADD_AMT
      ,X.TMP_TRSP_RAIL_INV_AUD_CD
      ,X.HZD_MTRL_SCG_AMT
      ,X.ETC_ADD_AMT
      ,X.WO_EXE_DT
      ,X.ORG_GATE_OUT_DT
      ,X.DEST_GATE_IN_DT
      ,DECODE(X.CGO_TP_CD, 'M', X.INTER_RMK, 'F', DECODE(X.INTER_RMK_CHK, '', '', 'Y')) INTER_RMK
      ,CASE
         WHEN X.CGO_TP_CD = 'F' THEN '1'
         ELSE '0'
       END POP_IMG
      ,X.BKG_NO
  FROM (SELECT A.TRSP_INV_CO_IND_CD
              ,A.TRSP_INV_TP_CD
              ,TO_CHAR(A.RAIL_BIL_DT, 'YYYYMMDD') RAIL_BIL_DT
              ,TO_CHAR(A.WBL_DT, 'YYYYMMDD') WBL_DT
              ,A.WBL_NO
              ,A.INV_RMK
              ,A.SUB_INV_SEQ
              ,A.TRSP_SO_OFC_CTY_CD
              ,A.TRSP_SO_SEQ
              ,A.SUB_RAIL_SEQ
              ,A.ORG_TRSP_RAIL_INV_AUD_CD
              ,A.CRNT_TRSP_RAIL_INV_AUD_CD
              ,A.PAY_FLG
              ,A.EQ_NO
              ,A.EQ_TPSZ_CD
              ,A.CGO_TP_CD
              ,SUBSTR(A.FM_NOD_CD, 0, 5) FM_NOD_CD1
              ,SUBSTR(A.FM_NOD_CD, 6, 7) FM_NOD_CD2
              ,SUBSTR(A.TO_NOD_CD, 0, 5) TO_NOD_CD1
              ,SUBSTR(A.TO_NOD_CD, 6, 7) TO_NOD_CD2
              ,A.FM_NOD_CD
              ,A.TO_NOD_CD
              ,A.INV_ORG_NOD_NM
              ,A.INV_DEST_NOD_NM
              ,A.CURR_CD
              ,A.BZC_AMT
              ,A.FUEL_SCG_AMT
              ,A.OVR_WGT_SCG_AMT
              ,A.NEGO_AMT
              ,A.INV_CURR_CD
              ,A.INV_BZC_AMT
              ,A.INV_BIL_AMT
              ,A.INV_ETC_ADD_AMT
              ,A.TMP_TRSP_RAIL_INV_AUD_CD
              ,A.HZD_MTRL_SCG_AMT
              ,A.ETC_ADD_AMT
              ,NVL(NVL(B.ORG_GATE_OUT_DT, B.DEST_GATE_IN_DT), B.WO_EXE_DT) WO_EXE_DT
              ,B.ORG_GATE_OUT_DT
              ,B.DEST_GATE_IN_DT
              ,B.INTER_RMK
              ,(SELECT MAX(RMK.BKG_NO)
                  FROM TRS_INTER_RMK RMK
                 WHERE RMK.BKG_NO IN(B.BKG_NO,
                               'DUM000000000')
                   AND NVL(RMK.EQ_NO, 'X') = NVL2(RMK.EQ_NO, B.EQ_NO, 'X')
                   AND NVL(RMK.TRSP_SO_OFC_CTY_CD, 'XX') = NVL2(RMK.TRSP_SO_OFC_CTY_CD, A.TRSP_SO_OFC_CTY_CD, 'XX')
                   AND NVL(RMK.TRSP_SO_SEQ, '99999') = NVL2(RMK.TRSP_SO_SEQ, A.TRSP_SO_SEQ, '99999')
                   AND NVL(RMK.DELT_FLG, 'X') = 'N') AS INTER_RMK_CHK
              ,B.BKG_NO
          FROM TRS_TRSP_RAIL_INV_DTL A ,
               TRS_TRSP_RAIL_BIL_ORD B
         WHERE INV_NO = @[invNo]
           AND INV_VNDR_SEQ = @[invVndrSeq]
           AND CRNT_TRSP_RAIL_INV_AUD_CD = @[railInvAudCd]
           AND A.TRSP_SO_OFC_CTY_CD = B.TRSP_SO_OFC_CTY_CD(+)
           AND A.TRSP_SO_SEQ = B.TRSP_SO_SEQ(+)
     ) X			]]></sql>
			<params>
				<param name="invNo" type="12" value="" out="N"/>
				<param name="invVndrSeq" type="12" value="" out="N"/>
				<param name="railInvAudCd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
