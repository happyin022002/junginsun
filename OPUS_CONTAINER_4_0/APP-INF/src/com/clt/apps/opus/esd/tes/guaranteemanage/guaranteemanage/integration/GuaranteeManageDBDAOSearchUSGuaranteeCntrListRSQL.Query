<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GuaranteeManageDBDAOSearchUSGuaranteeCntrListRSQL">
			<desc><![CDATA[Guarantee CNTR 목록 조회]]></desc>
			<sql><![CDATA[
SELECT 
		  GL.GNTE_NO
		, GL.TML_GNTE_CNTR_LIST_SEQ
		, GL.GNTE_PROC_TP_CD
		, CASE	WHEN GL.TML_IF_OFC_CD IS NOT NULL AND GL.TML_IF_SEQ IS NOT NULL 
				THEN 'I/F'
				ELSE ''
		END CHK_TPB_IF
		, CASE	WHEN GL.IRR_NO IS NOT NULL
				THEN 'I'
				ELSE ''
		END CHK_IRR
		, GL.CNTR_NO
		, GL.CNTR_TPSZ_CD
		, GL.BKG_NO
		, GL.BKG_NO bkg_no2		-- 원천 Data 비교 위해...
		, GL.BKG_NO_LIST_CTNT
		, GL.BL_NO
		, GL.VVD_CD
		, GL.SC_NO
        , TO_CHAR(GL.FM_DT, 'YYYY-MM-DD') FM_DT		
        , TO_CHAR(GL.TO_DT, 'YYYY-MM-DD') TO_DT		
		, GL.GNTE_AMT
		, (
		SELECT	I.N3PTY_INV_NO
		FROM	TPB_OTS_DTL D
				, TPB_OTS_GRP M
				, TPB_INV_RVIS I
		WHERE	1   = 1
		AND		D.N3PTY_NO		= M.N3PTY_NO
		AND		M.N3PTY_INV_NO	= I.N3PTY_INV_NO
		AND		I.N3PTY_INV_RVIS_SEQ	= 1
		AND		D.N3PTY_EXPN_TP_CD		= 'TES'
		AND		N3PTY_IF_TP_CD			= 'S'   -- TPB로 자동으로 넘어온 건
		AND		D.MNL_INP_TP_CD			= 'G'
		AND		D.IF_OFC_CD		= GL.TML_IF_OFC_CD
		AND		D.SRC_IF_SEQ_NO	= GL.TML_IF_SEQ
		) TPB_INV_NO --// TPB와 협의해서 TPB I/F table의 KEY값으로 TPB에서 실제 생성된 TPB INVOICE가 있을 경우 INV_NO를 가져온다.
		, GL.TML_IF_OFC_CD
		, GL.TML_IF_SEQ
		, GL.IRR_NO
FROM	TES_GNTE_HDR GH
		, TES_GNTE_CNTR_LIST GL
WHERE	1	= 1
AND		NVL(GH.DMY_FLG,'N') <> 'Y'
AND		GH.GNTE_NO	= GL.GNTE_NO
AND		GH.GNTE_NO	= @[gnte_no]
ORDER BY GH.GNTE_NO, GL.TML_GNTE_CNTR_LIST_SEQ			]]></sql>
			<params>
				<param name="gnte_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
