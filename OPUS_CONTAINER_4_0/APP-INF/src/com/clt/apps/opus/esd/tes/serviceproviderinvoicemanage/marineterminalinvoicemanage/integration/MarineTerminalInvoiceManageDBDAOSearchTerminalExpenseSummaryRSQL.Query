<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MarineTerminalInvoiceManageDBDAOSearchTerminalExpenseSummaryRSQL">
			<desc><![CDATA[SearchTerminalExpenseSummary]]></desc>
			<sql><![CDATA[
SELECT 'SINHO' HQ_OFC_CD,                                                                   				
    --DECODE(L.CONTI_CD, 'F', 'HAMUR','E','HAMUR','M','NYCNA','A', O.AR_HD_QTR_OFC_CD ) RHQ_OFC_CD,    
    O.AR_HD_QTR_OFC_CD RHQ_OFC_CD,     				
    H.INV_OFC_CD,                                                                           				
    H.COST_OFC_CD,                                                                          				
    H.YD_CD,                                                                                				
    LPAD(H.VNDR_SEQ, 6, '0') VNDR_SEQ,                                                        				
    DECODE(V.VNDR_CNT_CD,'KR',V.VNDR_LOCL_LANG_NM,V.VNDR_LGL_ENG_NM) VNDR_LGL_ENG_NM,         				
    H.CURR_CD,                                                                              				
    SUM(NVL(D.INV_AMT,0)) INV_AMT,                                                      					
    SUM(NVL(D.INV_AMT*H.VAT_AMT/H.TTL_INV_AMT,0)) VAT_AMT,                                                 
    SUM(NVL(D.INV_AMT*H.WHLD_TAX_AMT/H.TTL_INV_AMT,0)) WHLD_TAX_AMT,                                       
    SUM(NVL(D.INV_AMT,0))+SUM(NVL(D.INV_AMT*H.VAT_AMT/H.TTL_INV_AMT,0))									
			-SUM(NVL(D.INV_AMT*H.WHLD_TAX_AMT/H.TTL_INV_AMT,0)) TTL_INV_AMT, 								
    NVL(ROUND(SUM(D.INV_AMT/G.USD_LOCL_XCH_RT),2),0)                           	        				
     +NVL(ROUND(SUM(D.INV_AMT*H.VAT_AMT/H.TTL_INV_AMT/G.USD_LOCL_XCH_RT),2),0)                				
     -NVL(ROUND(SUM(D.INV_AMT*H.WHLD_TAX_AMT/H.TTL_INV_AMT/G.USD_LOCL_XCH_RT),2),0) USD_AMT   				
FROM TES_TML_SO_HDR H, TES_TML_SO_DTL D, MDM_ORGANIZATION O, MDM_LOCATION L, GL_MON_XCH_RT G, MDM_VENDOR V	
WHERE H.TML_SO_OFC_CTY_CD = D.TML_SO_OFC_CTY_CD                                             				
AND H.TML_SO_SEQ = D.TML_SO_SEQ                                                             				
AND H.DELT_FLG IS NULL                                                                      				
AND H.TML_INV_STS_CD <> 'R'                                                                  				
AND H.TML_INV_RJCT_STS_CD <>'RJ'
AND H.TTL_INV_AMT <> 0

#if (${yd_cd} != '') 
and h.yd_cd = @[yd_cd]
#else 
#end 

#if (${vndr_seq} != '') 
and h.vndr_seq = @[vndr_seq]
#else 
#end

#if (${cost_ofc_cd} != '') 
and cost_ofc_cd in (
#foreach($cost_ofc_cd_num IN ${cost_ofc_cd})
	#if($velocityCount < $cost_ofc_cd.size()) 
	'$cost_ofc_cd_num', 
	#else 
	'$cost_ofc_cd_num' 
	#end 
#end
)
#else 
#end

#if (${inv_ofc_cd} != '') 
AND H.INV_OFC_CD IN (
#foreach($inv_ofc_cd_num IN ${inv_ofc_cd})
	#if($velocityCount < $inv_ofc_cd.size()) 
	'$inv_ofc_cd_num', 
	#else 
	'$inv_ofc_cd_num' 
	#end 
#end
)
#else 
#end

#if (${inv_date_type} == 'I') 
			AND h.iss_dt BETWEEN TO_DATE(REPLACE(@[fm_prd_dt],'-'),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_prd_dt],'-'),'YYYYMMDD')+0.99999
#elseif (${inv_date_type} == 'R') 
			AND H.rcv_dt BETWEEN TO_DATE(REPLACE(@[fm_prd_dt],'-'),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_prd_dt],'-'),'YYYYMMDD')+0.99999
#elseif (${inv_date_type} == 'P') 
			AND h.locl_upd_dt BETWEEN TO_DATE(REPLACE(@[fm_prd_dt],'-'),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_prd_dt],'-'),'YYYYMMDD')+0.99999
#elseif (${inv_date_type} == 'A') 
			AND d.atb_dt BETWEEN TO_DATE(REPLACE(@[fm_prd_dt],'-'),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_prd_dt],'-'),'YYYYMMDD')+0.99999 
#else 
#end

#if (${vvd} != '') 
AND D.vsl_cd = SUBSTR(@[vvd],1,4)    
AND D.skd_voy_no = SUBSTR(@[vvd],5,4)
AND D.skd_dir_cd = SUBSTR(@[vvd],9,1)
#else 
#end

AND H.VNDR_SEQ = V.VNDR_SEQ                                                                   				
AND H.CURR_CD = G.CURR_CD                                                                   				
AND G.ACCT_XCH_RT_YRMON = TO_CHAR(H.ISS_DT,'YYYYMM')
AND G.ACCT_XCH_RT_LVL = 1                                                                   				
AND H.INV_OFC_CD = O.OFC_CD(+)                                                              				
AND O.LOC_CD     = L.LOC_CD(+)                                                              				
GROUP BY H.INV_OFC_CD, H.COST_OFC_CD, H.YD_CD, H.CURR_CD, H.VNDR_SEQ, L.CONTI_CD, O.AR_HD_QTR_OFC_CD		
        , V.VNDR_LGL_ENG_NM, V.VNDR_CNT_CD , V.VNDR_LOCL_LANG_NM	                                   		
ORDER BY H.INV_OFC_CD, H.COST_OFC_CD, H.YD_CD, H.VNDR_SEQ			]]></sql>
			<params>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
				<param name="fm_prd_dt" type="12" value="" out="N"/>
				<param name="to_prd_dt" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
