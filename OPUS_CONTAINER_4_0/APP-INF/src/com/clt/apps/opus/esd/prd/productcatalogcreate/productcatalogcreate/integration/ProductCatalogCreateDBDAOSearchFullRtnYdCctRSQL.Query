<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ProductCatalogCreateDBDAOSearchFullRtnYdCctRSQL">
			<desc><![CDATA[SearchFullRtnYdCct]]></desc>
			<sql><![CDATA[
SELECT yd_cd1, yd_cd, DECODE(SPCL, 'GEN', CUT_OFF) GEN, DECODE(SPCL, 'DG', CUT_OFF) DG, DECODE(SPCL, 'RF', CUT_OFF) RF
  FROM (SELECT RK
              ,ORG_NOD_CD yd_cd1
              ,(CASE WHEN TP LIKE '%RAIL%' THEN ORG_NOD_CD || '(rail)'
                     ELSE ORG_NOD_CD
               END) yd_cd
              ,SPCL
              ,(CASE WHEN TP LIKE '%RAIL%' THEN TO_CHAR(TO_DATE(@[from_time], 'YYYYMMDD'), 'YYYY-MM-DD HH24:MI') || ' - ' || TO_CHAR(TO_DATE(@[to_time], 'YYYYMMDD'), 'YYYY-MM-DD HH24:MI')
                    ELSE TO_CHAR(NVL(INLND_CCT_FNC, ARR_ST_DT), 'YYYY-MM-DD HH24:MI')
               END) CUT_OFF
          FROM (SELECT RANK() OVER(ORDER BY D.PCTL_SEQ) RK
                      ,(CASE WHEN D.ORG_NOD_CD = M.FULL_RTN_YD_CD AND D.ORG_NOD_CD = M.HUB_NOD_CD AND SUBSTR(D.ORG_NOD_CD, 1, 2) IN('US', 'CA')  THEN 'FULL_CY_RAIL'
                             WHEN D.ORG_NOD_CD = M.FULL_RTN_YD_CD AND D.ORG_NOD_CD <> M.HUB_NOD_CD THEN 'FULL_CY'
                             WHEN D.ORG_NOD_CD = M.HUB_NOD_CD AND D.ORG_NOD_CD <> M.FULL_RTN_YD_CD THEN 'RAIL'
                       END) TP
                      ,D.ORG_NOD_CD
                      ,D.ARR_ST_DT
                      ,D.DEP_FSH_DT
                      ,(CASE WHEN PC.RF_SPCL_FLG = 'Y' THEN 'RF'
                             WHEN PC.DG_SPCL_FLG = 'Y' THEN 'DG'
                             ELSE 'GEN'
                       END) SPCL
                      ,(LEAD(ARR_ST_DT, 1) OVER(ORDER BY D.PCTL_SEQ) - DEP_FSH_DT) * 24 TTIME
                      ,PRD_GET_INLND_CCT_FNC(D.PCTL_NO) INLND_CCT_FNC
                --M.FULL_RTN_YD_CD,M.HUB_NOD_CD, 
                  FROM PRD_PROD_CTL_ROUT_DTL D, PRD_INLND_ROUT_MST M, PRD_PROD_CTL_MST PC
                 WHERE D.PCTL_NO = @[pctl_no]
                   AND D.PCTL_NO = PC.PCTL_NO
                   AND D.ROUT_ORG_NOD_CD = M.ROUT_ORG_NOD_CD
                   AND D.ROUT_DEST_NOD_CD = M.ROUT_DEST_NOD_CD
                   AND D.ROUT_SEQ = M.ROUT_SEQ
                   AND D.PCTL_IO_BND_CD = 'O'
                   AND D.MTY_YD_FLG <> 'Y'
                   AND D.NOD_LNK_DIV_CD = 'N'
                   AND (D.ORG_NOD_CD = M.FULL_RTN_YD_CD OR D.ORG_NOD_CD = M.HUB_NOD_CD)
				 )
		)			]]></sql>
			<params>
				<param name="from_time" type="12" value="" out="N"/>
				<param name="to_time" type="12" value="" out="N"/>
				<param name="pctl_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
