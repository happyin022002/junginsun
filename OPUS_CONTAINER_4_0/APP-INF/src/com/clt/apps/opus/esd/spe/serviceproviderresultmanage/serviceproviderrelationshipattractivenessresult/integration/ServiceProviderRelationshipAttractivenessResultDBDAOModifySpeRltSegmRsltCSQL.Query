<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ServiceProviderRelationshipAttractivenessResultDBDAOModifySpeRltSegmRsltCSQL">
			<desc><![CDATA[SRS Analysis Result 등록 테이블에 merge into로 값을 insert or update한다.]]></desc>
			<sql><![CDATA[
MERGE INTO SPE_RLT_SEGM_RSLT A
		 USING ( SELECT A.VNDR_SEQ
		                 ,@[ev_yr] EV_YR
		                 ,B.SI_GRP_CD
        		 				 ,ROUND(
                           	CASE
                           	WHEN @[ra_grp_cd] = 'HM' THEN
                           		SQRT(((TO_NUMBER(@[atrc_to_hjs_scre]) - 2.5)  * (TO_NUMBER(@[atrc_to_hjs_scre]) - 2.5)) + ((TO_NUMBER(@[atrc_to_sp_scre]) - 2.5)  * (TO_NUMBER(@[atrc_to_sp_scre]) - 2.5)))
                           	WHEN @[ra_grp_cd] = 'EX' THEN
                           		SQRT(((TO_NUMBER(@[atrc_to_hjs_scre]) - 2.5)  * (TO_NUMBER(@[atrc_to_hjs_scre]) - 2.5)) + ((TO_NUMBER(@[atrc_to_sp_scre]))  * (TO_NUMBER(@[atrc_to_sp_scre]))))
                           	WHEN @[ra_grp_cd] = 'DV' THEN
                           		SQRT((TO_NUMBER(@[atrc_to_hjs_scre])   * TO_NUMBER(@[atrc_to_hjs_scre]) ) + ((TO_NUMBER(@[atrc_to_sp_scre]) - 2.5)  * (TO_NUMBER(@[atrc_to_sp_scre]) - 2.5)))
                           	WHEN @[ra_grp_cd] = 'LM' THEN
                           		SQRT(((TO_NUMBER(@[atrc_to_hjs_scre]) )  * (TO_NUMBER(@[atrc_to_hjs_scre]) )) + ((TO_NUMBER(@[atrc_to_sp_scre]) )  * (TO_NUMBER(@[atrc_to_sp_scre]) )))
                           END , 2) RA_SCRE
		                 ,B.SI_SCRE
		                 ,ROUND(
                            CASE
                            WHEN B.SI_GRP_CD = 'CR' THEN
                                (B.SI_SCRE + (2.5 * 3 ))
                            WHEN B.SI_GRP_CD = 'LV' THEN
                                (B.SI_SCRE + (2.5 * 1 ))
                            WHEN B.SI_GRP_CD = 'BN' THEN
                                (B.SI_SCRE + (2.5 * 2 ))
                            WHEN B.SI_GRP_CD = 'RT' THEN
                                (B.SI_SCRE + (2.5 * 0 ))
                            END , 2) MODI_SI_SCRE
		         FROM SPE_EV_GRP_SVC_PROV_MTCH A
		             ,SPE_EV_GRP_STRG_IMPT_RSLT B
		             , SPE_EV_GRP C
		         WHERE A.VNDR_SEQ = TO_NUMBER(@[vndr_seq])
		         AND   @[ev_yr]  = B.EV_YR(+)
		         AND   A.EG_ID = B.EG_ID(+)
		         AND   A.EG_ID_SEQ = B.EG_ID_SEQ(+)
		         AND   C.EG_ID = SUBSTR(@[eg_id],0,5)
		         AND   C.EG_ID_SEQ = TO_NUMBER(@[eg_id_seq])
		         AND   A.EG_ID = C.EG_ID
		         AND   A.EG_ID_SEQ = C.EG_ID_SEQ
		     ) B
		 ON (A.VNDR_SEQ = B.VNDR_SEQ
		     AND  A.EV_YR = B.EV_YR)
		 WHEN MATCHED THEN
		 UPDATE SET  
		        RA_SCRE =  B.RA_SCRE,
		  		SI_SCRE =  B.SI_SCRE,
		  		MODI_SI_SCRE =  B.MODI_SI_SCRE,
            	MODI_RA_SCRE =  ROUND(
	                                 CASE
	                                 WHEN @[ra_grp_cd] = 'HM' THEN
	                                 (TO_NUMBER(B.RA_SCRE) + (2.5 * 3 ))
	                                 WHEN @[ra_grp_cd] = 'EX' THEN
	                                 (TO_NUMBER(B.RA_SCRE) + (2.5 * 2 ))
	                                 WHEN @[ra_grp_cd] = 'DV' THEN
	                                 (TO_NUMBER(B.RA_SCRE) + (2.5 * 1 ))
	                                 WHEN @[ra_grp_cd] = 'LM' THEN
	                                 (TO_NUMBER(B.RA_SCRE) + (2.5 * 0 ))
	                               END , 2),
             SRS_GRP_CD  =   CASE
                             WHEN (B.SI_GRP_CD = 'CR' AND @[ra_grp_cd] = 'LM') THEN 'G1'
                             WHEN (B.SI_GRP_CD = 'CR' AND @[ra_grp_cd] = 'EX') THEN 'C1'
                             WHEN (B.SI_GRP_CD = 'CR' AND @[ra_grp_cd] = 'DV') THEN 'C2'
                             WHEN (B.SI_GRP_CD = 'CR' AND @[ra_grp_cd] = 'HM') THEN 'ST'
                             WHEN (B.SI_GRP_CD = 'BN' AND @[ra_grp_cd] = 'LM') THEN 'TA'
                             WHEN (B.SI_GRP_CD = 'BN' AND @[ra_grp_cd] = 'EX') THEN 'TA'
                             WHEN (B.SI_GRP_CD = 'BN' AND @[ra_grp_cd] = 'DV') THEN 'C3'
                             WHEN (B.SI_GRP_CD = 'BN' AND @[ra_grp_cd] = 'HM') THEN 'C4'
                             WHEN (B.SI_GRP_CD = 'LV' AND @[ra_grp_cd] = 'LM') THEN 'TA'
                             WHEN (B.SI_GRP_CD = 'LV' AND @[ra_grp_cd] = 'EX') THEN 'TA'
                             WHEN (B.SI_GRP_CD = 'LV' AND @[ra_grp_cd] = 'DV') THEN 'TA'
                             WHEN (B.SI_GRP_CD = 'LV' AND @[ra_grp_cd] = 'HM') THEN 'C5'
                             WHEN (B.SI_GRP_CD = 'RT' AND @[ra_grp_cd] = 'LM') THEN 'TA'
                             WHEN (B.SI_GRP_CD = 'RT' AND @[ra_grp_cd] = 'EX') THEN 'TA'
                             WHEN (B.SI_GRP_CD = 'RT' AND @[ra_grp_cd] = 'DV') THEN 'TA'
                             WHEN (B.SI_GRP_CD = 'RT' AND @[ra_grp_cd] = 'HM') THEN 'G2'
                             END,
             SRS_GRP_NM =    CASE
                             WHEN (B.SI_GRP_CD = 'CR' AND @[ra_grp_cd] = 'LM') THEN 'GRAY'
                             WHEN (B.SI_GRP_CD = 'CR' AND @[ra_grp_cd] = 'EX') THEN 'COLLABORATIVE'
                             WHEN (B.SI_GRP_CD = 'CR' AND @[ra_grp_cd] = 'DV') THEN 'COLLABORATIVE'
                             WHEN (B.SI_GRP_CD = 'CR' AND @[ra_grp_cd] = 'HM') THEN 'STRATEGIC'
                             WHEN (B.SI_GRP_CD = 'BN' AND @[ra_grp_cd] = 'LM') THEN 'TRANSACTIONAL'
                             WHEN (B.SI_GRP_CD = 'BN' AND @[ra_grp_cd] = 'EX') THEN 'TRANSACTIONAL'
                             WHEN (B.SI_GRP_CD = 'BN' AND @[ra_grp_cd] = 'DV') THEN 'COLLABORATIVE'
                             WHEN (B.SI_GRP_CD = 'BN' AND @[ra_grp_cd] = 'HM') THEN 'COLLABORATIVE'
                             WHEN (B.SI_GRP_CD = 'LV' AND @[ra_grp_cd] = 'LM') THEN 'TRANSACTIONAL'
                             WHEN (B.SI_GRP_CD = 'LV' AND @[ra_grp_cd] = 'EX') THEN 'TRANSACTIONAL'
                             WHEN (B.SI_GRP_CD = 'LV' AND @[ra_grp_cd] = 'DV') THEN 'TRANSACTIONAL'
                             WHEN (B.SI_GRP_CD = 'LV' AND @[ra_grp_cd] = 'HM') THEN 'COLLABORATIVE'
                             WHEN (B.SI_GRP_CD = 'RT' AND @[ra_grp_cd] = 'LM') THEN 'TRANSACTIONAL'
                             WHEN (B.SI_GRP_CD = 'RT' AND @[ra_grp_cd] = 'EX') THEN 'TRANSACTIONAL'
                             WHEN (B.SI_GRP_CD = 'RT' AND @[ra_grp_cd] = 'DV') THEN 'TRANSACTIONAL'
                             WHEN (B.SI_GRP_CD = 'RT' AND @[ra_grp_cd] = 'HM') THEN 'GRAY 2'
                             END,
		             UPD_USR_ID = @[upd_usr_id],
		             UPD_DT = SYSDATE
		 WHEN NOT MATCHED THEN
		 INSERT ( VNDR_SEQ
		         ,EV_YR
		         ,SI_SCRE
		         ,MODI_SI_SCRE
		         ,RA_SCRE
		         ,MODI_RA_SCRE
		         ,CRE_USR_ID
		         ,CRE_DT
		         ,UPD_USR_ID
		         ,UPD_DT
		         )
		 VALUES( B.VNDR_SEQ
		         ,B.EV_YR
		         ,B.SI_SCRE
		         ,B.MODI_SI_SCRE
		         ,B.RA_SCRE
		         ,ROUND(
		               CASE
		               WHEN @[ra_grp_cd] = 'HM' THEN
		                   (B.RA_SCRE + (2.5 * 3 ))
		               WHEN @[ra_grp_cd] = 'EX' THEN
		                   (B.RA_SCRE + (2.5 * 2 ))
		               WHEN @[ra_grp_cd] = 'DV' THEN
		                   (B.RA_SCRE + (2.5 * 1 ))
		               WHEN @[ra_grp_cd] = 'LM' THEN
		                   (B.RA_SCRE + (2.5 * 0 ))
		          END , 2)
		         ,@[cre_usr_id]
		         ,SYSDATE
		         ,@[upd_usr_id]
		         ,SYSDATE
		     )			]]></sql>
			<params>
				<param name="ev_yr" type="12" value="" out="N"/>
				<param name="ra_grp_cd" type="12" value="" out="N"/>
				<param name="atrc_to_hjs_scre" type="12" value="" out="N"/>
				<param name="atrc_to_sp_scre" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
				<param name="eg_id" type="12" value="" out="N"/>
				<param name="eg_id_seq" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
