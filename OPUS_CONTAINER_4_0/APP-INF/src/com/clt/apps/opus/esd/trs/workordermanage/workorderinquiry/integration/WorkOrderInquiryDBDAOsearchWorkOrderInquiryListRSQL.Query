<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="WorkOrderInquiryDBDAOsearchWorkOrderInquiryListRSQL">
			<desc><![CDATA[searchWorkOrderInquiryList]]></desc>
			<sql><![CDATA[
SELECT /*+ ORDERED  */
	A.WO_VNDR_SEQ,
	NVL(MAX(H.WO_ISS_KNT) OVER (PARTITION BY A.TRSP_WO_OFC_CTY_CD, A.TRSP_WO_SEQ),1) MAX_KNT ,
	C.VNDR_LGL_ENG_NM AS VNDR_NM ,
	A.TRSP_WO_OFC_CTY_CD||A.TRSP_WO_SEQ AS TRSP_WO_OFC_CTY_CD ,
	A.TRSP_WO_SEQ ,
	H.WO_ISS_KNT ,
	H.CRE_OFC_CD ,
	A.CRE_USR_ID AS UPD_USR_ID ,
	H.INTER_USE_FLG ,
	D.USR_NM AS UPD_USR_NM ,
	B.TRSP_COST_DTL_MOD_CD ,
	COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00744',B.TRSP_COST_DTL_MOD_CD) AS TRSP_COST_DTL_MOD_NM ,
	B.TRSP_CRR_MOD_CD ,
	COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00283',B.TRSP_CRR_MOD_CD) AS TRSP_CRR_MOD_NM ,
	DECODE(A.WO_TRSP_STS_CD,'S','Started','P','Partially Completed','C','Completed') WO_TRSP_STS_CD ,
	H.WO_ISS_STS_CD AS WO_ISS_STS_CD,
	COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00804',H.WO_ISS_STS_CD) AS WO_ISS_STS_CD_NM,
	( (CASE WHEN H.WO_PRN_USE_FLG='Y' THEN 'PRN ' ELSE '' END) || 
	  (CASE WHEN H.WO_FAX_USE_FLG='Y' THEN 'FAX ' ELSE '' END)|| 
	  (CASE WHEN H.WO_EML_USE_FLG='Y' THEN 'EML ' ELSE '' END)|| 
	  (CASE WHEN H.WO_EDI_USE_FLG='Y' THEN 'EDI' ELSE '' END) 
	) AS WO_ISS_TP ,
	H.WO_PRN_USE_FLG ,
	H.WO_FAX_USE_FLG ,
	H.WO_EML_USE_FLG ,
	TO_CHAR(H.LOCL_CRE_DT, 'YYYY-MM-DD HH24:MI:SS') AS WO_ISS_DT ,
	H.WO_N1ST_FAX_NO ,
	H.WO_N2ND_FAX_NO ,
	H.WO_N3RD_FAX_NO ,
	H.WO_N1ST_EML ,
	H.WO_N2ND_EML ,
	H.WO_N3RD_EML ,
	DECODE(H.WO_N3RD_EML_RSLT_FLG, 'Y', 'Success', 'N', '') AS WO_EML3_STATUS ,
	CASE WHEN ( COUNT(B.EDI_RCV_RSLT_CD) OVER (PARTITION BY A.TRSP_WO_OFC_CTY_CD , A.TRSP_WO_SEQ , H.WO_ISS_KNT) ) <> ( COUNT(B.EDI_RCV_RSLT_CD) OVER (PARTITION BY A.TRSP_WO_OFC_CTY_CD , A.TRSP_WO_SEQ , H.WO_ISS_KNT , B.EDI_RCV_RSLT_CD) ) THEN 'N' 
		 ELSE B.EDI_RCV_RSLT_CD 
	END EDI_RCV_RSLT_CD ,
	TO_CHAR(B.EDI_RCV_RSLT_DT, 'YYYY-MM-DD HH24:MI:SS') AS EDI_RCV_RSLT_DT ,
	COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00959',FAX1.FAX_PROC_STS_CD) AS FAX1_STS_CD ,
	COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00959',FAX2.FAX_PROC_STS_CD) AS FAX2_STS_CD ,
	COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00959',FAX3.FAX_PROC_STS_CD) AS FAX3_STS_CD ,
	COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00960',EML1.EML_PROC_STS_CD) AS EML1_STS_CD ,
	COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00960',EML2.EML_PROC_STS_CD) AS EML2_STS_CD ,
	COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00960',EML3.EML_PROC_STS_CD) AS EML3_STS_CD ,
	B.FM_NOD_CD,
    DECODE(LENGTH(B.FM_NOD_CD), 7, TRS_COMMON_PKG.GET_YD_CD_NM_FNC(B.FM_NOD_CD), 5, (SELECT LOC_NM FROM MDM_LOCATION WHERE LOC_CD = B.FM_NOD_CD))FM_NOD_CD_NM,
	B.TO_NOD_CD,
	DECODE(LENGTH(B.TO_NOD_CD), 7, TRS_COMMON_PKG.GET_YD_CD_NM_FNC(B.TO_NOD_CD), 5, (SELECT LOC_NM FROM MDM_LOCATION WHERE LOC_CD = B.TO_NOD_CD))TO_NOD_CD_NM,
	B.VIA_NOD_CD,
	DECODE(LENGTH(B.VIA_NOD_CD), 7, TRS_COMMON_PKG.GET_YD_CD_NM_FNC(B.VIA_NOD_CD), 5, (SELECT LOC_NM FROM MDM_LOCATION WHERE LOC_CD = B.VIA_NOD_CD))VIA_NOD_CD_NM,
	B.DOR_NOD_CD,
    DECODE(LENGTH(B.DOR_NOD_CD), 7, (SELECT ZN_NM FROM MDM_ZONE WHERE ZN_CD = B.DOR_NOD_CD), 5, (SELECT LOC_NM FROM MDM_LOCATION WHERE LOC_CD = B.DOR_NOD_CD)) AS DOR_NOD_CD_NM,			
	B.CURR_CD,
	SUM(NVL(B.BZC_AMT, 0)) BZC_AMT,
	SUM(NVL(B.ETC_ADD_AMT, 0)) ETC_ADD_AMT,
	SUM(NVL(B.FUEL_SCG_AMT, 0)) FUEL_SCG_AMT,
	SUM(NVL(B.NEGO_AMT, 0)) NEGO_AMT,
	SUM(NVL(B.BZC_AMT, 0) + NVL(B.ETC_ADD_AMT, 0) + NVL(B.FUEL_SCG_AMT, 0) + NVL(B.NEGO_AMT, 0)) TOTAL
FROM 
	TRS_TRSP_WRK_ORD A ,
	TRS_TRSP_WRK_ORD_HIS H ,
	COM_USER D ,
	COM_FAX_SND_INFO FAX1 ,
	COM_FAX_SND_INFO FAX2 ,
	COM_FAX_SND_INFO FAX3 ,
	COM_EML_SND_INFO EML1 ,
	COM_EML_SND_INFO EML2 ,
	COM_EML_SND_INFO EML3 ,
	MDM_VENDOR C ,
	TRS_TRSP_SVC_ORD B
WHERE A.TRSP_WO_OFC_CTY_CD = B.TRSP_WO_OFC_CTY_CD(+)
	AND A.TRSP_WO_SEQ = B.TRSP_WO_SEQ(+)
	AND A.TRSP_WO_OFC_CTY_CD = H.TRSP_WO_OFC_CTY_CD(+)
	AND A.TRSP_WO_SEQ = H.TRSP_WO_SEQ(+)
	AND A.WO_VNDR_SEQ = C.VNDR_SEQ(+)
	AND NVL(B.DELT_FLG, 'N') = 'N'
	AND H.WO_N1ST_FAX_SND_NO = FAX1.FAX_SND_NO(+)
	AND H.WO_N2ND_FAX_SND_NO = FAX2.FAX_SND_NO(+)
	AND H.WO_N3RD_FAX_SND_NO = FAX3.FAX_SND_NO(+)
	AND H.WO_N1ST_EML_SND_NO = EML1.EML_SND_NO(+)
	AND H.WO_N2ND_EML_SND_NO = EML2.EML_SND_NO(+)
	AND H.WO_N3RD_EML_SND_NO = EML3.EML_SND_NO(+)
	AND A.CRE_USR_ID = D.USR_ID(+)
	AND A.WO_ISS_STS_CD <> 'X'
#if(${fmdate} != '' && ${todate} != '' )
  AND A.LOCL_CRE_DT BETWEEN TO_DATE(@[fmdate]||'000001', 'YYYYMMDDHH24MISS') AND TO_DATE(@[todate]||'235959', 'YYYYMMDDHH24MISS')
#end
#if(${combo_svc_provider} != '')
  AND A.WO_VNDR_SEQ = @[combo_svc_provider]
#end

#if($wo_no.size() > 0)  
AND (A.TRSP_WO_OFC_CTY_CD,A.TRSP_WO_SEQ) IN (
	#foreach($code IN ${wo_no})  
		#if($velocityCount == 1)  
 			(SUBSTR('$code', 1, 3),SUBSTR('$code', 4))
		#else  
		   ,(SUBSTR('$code', 1, 3),SUBSTR('$code', 4))  
		#end  
	#end
)
#end 

#if(${wo_issue_office} != '')
  AND A.CRE_OFC_CD = @[wo_issue_office]
  AND H.CRE_OFC_CD = @[wo_issue_office]
#end
#if(${wo_issue_user} != '')
  AND A.CRE_USR_ID = @[wo_issue_user]
#end
#if(${wo_iss_sts} != '' && ${wo_iss_sts} != 'ALL')
  AND H.WO_ISS_STS_CD = @[wo_iss_sts]
#end
#if(${sel_costmode} != '' && ${sel_costmode} != 'ALL')
  AND B.TRSP_COST_DTL_MOD_CD = @[sel_costmode]
#end
#if(${issue_type} != '' && ${issue_type} =='PR')
  AND DECODE(H.WO_PRN_USE_FLG, 'Y', 'PR', '') = @[issue_type]
#end
#if(${issue_type} != '' && ${issue_type} =='FA')
  AND DECODE(H.WO_FAX_USE_FLG, 'Y', 'FA', '') = @[issue_type]
#end
#if(${issue_type} != '' && ${issue_type} =='EM')
  AND DECODE(H.WO_EML_USE_FLG, 'Y', 'EM', '') = @[issue_type]
#end
#if(${issue_type} != '' && ${issue_type} =='ED')
  AND DECODE(H.WO_EDI_USE_FLG, 'Y', 'ED', '') = @[issue_type]
#end
#if(${sel_transmode} != '' && ${sel_transmode} != 'ALL')
  AND B.TRSP_CRR_MOD_CD = @[sel_transmode]
#end
GROUP BY A.WO_VNDR_SEQ, C.VNDR_LGL_ENG_NM, H.CRE_OFC_CD, A.CRE_USR_ID, H.INTER_USE_FLG, D.USR_NM, B.TRSP_COST_DTL_MOD_CD, B.TRSP_CRR_MOD_CD, H.WO_ISS_STS_CD, H.WO_PRN_USE_FLG, H.WO_FAX_USE_FLG, H.WO_EML_USE_FLG, H.WO_EDI_USE_FLG, H.LOCL_CRE_DT, H.WO_N1ST_FAX_NO, H.WO_N2ND_FAX_NO, H.WO_N3RD_FAX_NO, H.WO_N1ST_EML, H.WO_N2ND_EML, H.WO_N3RD_EML, H.WO_N3RD_EML_RSLT_FLG, B.EDI_RCV_RSLT_CD, B.EDI_RCV_RSLT_DT, FAX1.FAX_PROC_STS_CD, FAX2.FAX_PROC_STS_CD, FAX3.FAX_PROC_STS_CD, EML1.EML_PROC_STS_CD, EML2.EML_PROC_STS_CD, EML3.EML_PROC_STS_CD, B.FM_NOD_CD, B.TO_NOD_CD, B.VIA_NOD_CD, B.DOR_NOD_CD, B.CURR_CD, A.TRSP_WO_OFC_CTY_CD, A.TRSP_WO_SEQ, H.WO_ISS_KNT, A.WO_ISS_STS_CD,A.WO_TRSP_STS_CD
ORDER BY TRSP_WO_OFC_CTY_CD, A.TRSP_WO_SEQ, H.WO_ISS_KNT			]]></sql>
			<params>
				<param name="fmdate" type="12" value="" out="N"/>
				<param name="todate" type="12" value="" out="N"/>
				<param name="combo_svc_provider" type="12" value="" out="N"/>
				<param name="wo_issue_office" type="12" value="" out="N"/>
				<param name="wo_issue_user" type="12" value="" out="N"/>
				<param name="wo_iss_sts" type="12" value="" out="N"/>
				<param name="sel_costmode" type="12" value="" out="N"/>
				<param name="issue_type" type="12" value="" out="N"/>
				<param name="sel_transmode" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
