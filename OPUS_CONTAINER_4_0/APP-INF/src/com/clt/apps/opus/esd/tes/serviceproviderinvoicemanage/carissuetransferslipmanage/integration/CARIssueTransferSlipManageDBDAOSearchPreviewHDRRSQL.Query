<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CARIssueTransferSlipManageDBDAOSearchPreviewHDRRSQL">
			<desc><![CDATA[SearchPreviewHDR]]></desc>
			<sql><![CDATA[
SELECT
		CSR_NO	PRE_CSR_NO
		, ''	PRE_OFFICE
		, ATTR_CTNT10 PRE_PRPD_DY
		--, (SELECT DECODE(VNDR_CNT_CD,'KR',VNDR_LOCL_LANG_NM,VNDR_LGL_ENG_NM) FROM  MDM_VENDOR  WHERE  VNDR_SEQ = VNDR_NO)  PRE_PAY_TO
        ,(  SELECT DECODE(MV.VNDR_CNT_CD,'KR',SUBSTRB(MV.VNDR_LOCL_LANG_NM, 1, 37) , SUBSTRB(MV.VNDR_LGL_ENG_NM, 1, 37) )  || ' (G5'|| ML.CNT_CD || LPAD(TO_CHAR(MV.VNDR_SEQ),6, '0') || ')' AS VENDOR_NAME 
            FROM      
                         MDM_VENDOR MV ,
                         MDM_ORGANIZATION MO ,
                         MDM_LOCATION ML
            WHERE     1=1
            AND       MV.OFC_CD = MO.OFC_CD(+)
            AND       MO.LOC_CD = ML.LOC_CD(+)
            AND       MV.VNDR_SEQ = H.VNDR_NO
			AND       ROWNUM=1  
          ) PRE_PAY_TO
		, CSR_TP_CD PRE_CSR_TYPE
		, ( SELECT (SELECT M.ACCT_ENG_NM FROM MDM_ACCOUNT M WHERE ACCT_CD = DTRB_COA_ACCT_CD)
			FROM (
					SELECT SUM(INV_AMT) SUM_AMT, DTRB_COA_ACCT_CD
					FROM AP_INV_DTRB D WHERE CSR_NO = @[csr_no]
					GROUP BY D.DTRB_COA_CO_CD, D.DTRB_COA_RGN_CD, D.DTRB_COA_CTR_CD, D.DTRB_COA_ACCT_CD, D.DTRB_COA_INTER_CO_CD
							, D.DTRB_COA_VVD_CD, D.INV_DESC, D.ATTR_CTNT3, D.ATTR_CTNT1, D.LINE_NO
					--ORDER BY SUM_AMT DESC  --20160211 CSR Type이 CREDIT일때,즉(-)amount 일때 Prepaid VAT가 먼저 나와서 아래처럼 수정함
					ORDER BY LINE_NO ASC
				) A WHERE ROWNUM = 1
			) PRE_DESC
		, PAY_GRP_LU_CD PRE_PAY_GROUP
		, ATTR_CATE_NM PRE_EVI_TP
		, ( SELECT DECODE(SUBSTR(VNDR_TERM_NM,1,1),'O','',TO_CHAR(A.ISS_DT+VNDR_TERM_NM,'YYYY/MM/DD'))
			FROM	(SELECT MAX(ISS_DT) ISS_DT, VNDR_SEQ FROM TES_TML_SO_HDR WHERE CSR_NO = @[csr_no] AND NVL(DELT_FLG,'N') <> 'Y' GROUP BY VNDR_SEQ) A, MDM_VENDOR B
			WHERE A.VNDR_SEQ = B.VNDR_SEQ )  PRE_DUE_DATE
		, CASE
			WHEN (CSR_AMT = 0 AND ATTR_CTNT2 IS NOT NULL) THEN ATTR_CTNT2
		  END AS  PRE_ASA_NO
		, SUBSTR(INV_DT,1,4)||'/'||SUBSTR(INV_DT,5,2)||'/'||SUBSTR(INV_DT,7,2) PRE_INV_DT
		, CSR_CURR_CD  PRE_CURR_CD
		, CSR_AMT  PRE_AMT
		, DECODE(PAY_DT,'','',CSR_CURR_CD)  PRE_PAY_CURR_CD
		, DECODE(PAY_DT,'','',PAY_AMT)  PRE_PAY_AMT
		, ATTR_CTNT1  APRO_STEP
	   , DECODE( VNDR_CNT_CD, 'US', 'CHK ADDR : ' || NVL(CHK_DE_ADDR1, '') , '' ) AS CHK_ADDR1
	   , DECODE( VNDR_CNT_CD, 'US', NVL(CHK_DE_ADDR2, '') , '' ) AS CHK_ADDR2
	   , DECODE( VNDR_CNT_CD, 'US', NVL(CHK_DE_ADDR3, '') , '' ) AS CHK_ADDR3
	   , DECODE( VNDR_CNT_CD, 'US', NVL(CHK_DE_CTY_NM, '') , '' ) AS CHK_CTY_NM
	   , DECODE( VNDR_CNT_CD, 'US', NVL(CHK_DE_STE_CD, '') , '' ) AS CHK_STE_CD
	   , DECODE( VNDR_CNT_CD, 'US', NVL(CHK_DE_ZIP_CD, '') , '' ) AS CHK_ZIP_CD
	   , DECODE( VNDR_CNT_CD, 'US', NVL(CHK_DE_CNT_CD, '') , '' ) AS CHK_CNT_CD
FROM	AP_INV_HDR H
		, MDM_VENDOR V
WHERE	H.VNDR_NO	= V.VNDR_SEQ
AND	CSR_NO	= @[csr_no]			]]></sql>
			<params>
				<param name="csr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
