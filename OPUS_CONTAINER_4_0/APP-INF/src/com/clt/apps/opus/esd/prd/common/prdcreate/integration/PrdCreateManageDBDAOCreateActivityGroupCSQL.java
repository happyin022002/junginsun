/*=========================================================
*Copyright(c) 2011 CyberLogitec
*@FileName : PrdCreateManageDBDAOCreateActivityGroupCSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2011.03.18
*@LastModifier : 김진주
*@LastVersion : 1.0
* 2011.03.18 김진주
* 1.0 Creation
=========================================================*/
package com.clt.apps.opus.esd.prd.common.prdcreate.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.clt.framework.support.db.ISQLTemplate;

/**
 *
 * @author KimJinJoo
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class PrdCreateManageDBDAOCreateActivityGroupCSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * PrdCreateManageDBDAOCreateActivityGroupCSQL
	  * </pre>
	  */
	public PrdCreateManageDBDAOCreateActivityGroupCSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("io_bnd_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("upd_usr_id",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("hd_pctl_no",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("cre_usr_id",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.clt.apps.opus.esd.prd.common.prdcreate.integration").append("\n"); 
		query.append("FileName : PrdCreateManageDBDAOCreateActivityGroupCSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("INSERT INTO PRD_PROD_CTL_ACT_GRP_DTL                                                                                  " ).append("\n"); 
		query.append("(                                                                                                                     " ).append("\n"); 
		query.append("PCTL_NO, COST_ACT_GRP_SEQ, COST_ACT_GRP_CD, COST_ACT_GRP_TP_CD, VSL_SLAN_CD,                                                                                                          " ).append("\n"); 
		query.append("CTRL_OFC_CD, PCTL_COST_MOD_CD, PCTL_IO_BND_CD, N1ST_NOD_CD, N1ST_NOD_TP_CD,                                                                                                       " ).append("\n"); 
		query.append("N1ST_NOD_PLN_DT, N2ND_NOD_CD, N3RD_NOD_CD, N4TH_NOD_CD, TRSP_MOD_CD,                                                                                                          " ).append("\n"); 
		query.append("N1ST_LNK_DIST, N1ST_LNK_DIST_UT_CD, N2ND_LNK_DIST, N2ND_LNK_DIST_UT_CD, N3RD_LNK_DIST,                                                                                                        " ).append("\n"); 
		query.append("N3RD_DIST_UT_CD, N1ST_VNDR_SEQ, N2ND_VNDR_SEQ, N3RD_VNDR_SEQ, INLND_ROUT_INV_BIL_PATT_CD,                                                                                           " ).append("\n"); 
		query.append("N1ST_RAIL_CRR_TP_CD, N2ND_RAIL_CRR_TP_CD, N3RD_RAIL_CRR_TP_CD, --CUST_NOMI_TRKR_FLG, CUST_CNT_CD,CUST_SEQ, " ).append("\n"); 
		query.append("PRE_NOD_CD, PRE_VNDR_SEQ, NXT_NOD_CD, NXT_VNDR_SEQ,                                                                                                         " ).append("\n"); 
		query.append("TRSP_SO_STS_CD, ROUT_ORG_NOD_CD, ROUT_DEST_NOD_CD, ROUT_SEQ,INV_BIL_PATT_DIV_FLG," ).append("\n"); 
		query.append("INLND_ROUT_INCL_STTL_FLG,N1ST_TRSP_AGMT_SEQ,N2ND_TRSP_AGMT_SEQ,N3RD_TRSP_AGMT_SEQ," ).append("\n"); 
		query.append("N1ST_AGMT_REF_NO,N2ND_AGMT_REF_NO,N3RD_AGMT_REF_NO,N1ST_TRSP_AGMT_OFC_CTY_CD,N2ND_TRSP_AGMT_OFC_CTY_CD," ).append("\n"); 
		query.append("N3RD_TRSP_AGMT_OFC_CTY_CD ,CRE_USR_ID, CRE_DT, UPD_USR_ID, UPD_DT                                                                                                         " ).append("\n"); 
		query.append(") " ).append("\n"); 
		query.append("SELECT" ).append("\n"); 
		query.append("T.PCTL_NO,                                                                                                            " ).append("\n"); 
		query.append("DECODE(T.PCTL_IO_BND_CD2,'O',0, 'T',390, 'I',590, 980)                                                                                                                     " ).append("\n"); 
		query.append("+ (RANK() OVER ( PARTITION BY T.PCTL_NO,T.PCTL_IO_BND_CD2 ORDER BY T.PCTL_NO, T.PCTL_SEQ)) * 10 AG_SEQ,                " ).append("\n"); 
		query.append("T.COST_ACT_GRP_CD, T.COST_ACT_GRP_TP_CD, T.VSL_SLAN_CD, T.CTL_OFFICE, T.PCTL_COST_MOD_CD, T.PCTL_IO_BND_CD,                                                                                                     " ).append("\n"); 
		query.append("T.ORG_NOD_CD, T.ORG_NOD_TP_CD, T.ARR_ST_DT, T.N2ND_NOD_CD, T.N3RD_NOD_CD, T.N4TH_NOD_CD, T.TRSP_MOD_CD,                                                                                                        " ).append("\n"); 
		query.append("T.N1ST_LNK_DIST, T.N1ST_LNK_DIST_UT_CD, T.N2ND_LNK_DIST, T.N2ND_LNK_DIST_UT_CD, T.N3RD_LNK_DIST, T.N3RD_LNK_DIST_UT_CD,                                                                                                " ).append("\n"); 
		query.append("T.N1ST_VNDR_SEQ, T.N2ND_VNDR_SEQ, T.N3RD_VNDR_SEQ, T.INLND_ROUT_INV_BIL_PATT_CD, T.N1ST_RD_CRR_CD, T.N2ND_RD_CRR_CD, T.N3RD_RD_CRR_CD,                                                                                                     " ).append("\n"); 
		query.append("--T.CUST_NOMI_TRKR_FLG,T.CUST_CNT_CD,CUST_SEQ, " ).append("\n"); 
		query.append("T.PRE_NOD_CD, T.PRE_VNDR_SEQ, T.NXT_NOD_CD, T.NXT_VNDR_SEQ,                                                                                                       " ).append("\n"); 
		query.append("T.TRSP_SO_STS_CD, T.ROUT_ORG_NOD_CD, T.ROUT_DEST_NOD_CD, T.ROUT_SEQ," ).append("\n"); 
		query.append("DECODE(" ).append("\n"); 
		query.append("    SUBSTR(T.INLND_ROUT_INV_BIL_PATT_CD,2,1),'1'," ).append("\n"); 
		query.append("    DECODE(" ).append("\n"); 
		query.append("    (SELECT" ).append("\n"); 
		query.append("    COUNT(*) CNT" ).append("\n"); 
		query.append("    FROM " ).append("\n"); 
		query.append("    PRD_INLND_ROUT_DTL" ).append("\n"); 
		query.append("    WHERE" ).append("\n"); 
		query.append("    ROUT_ORG_NOD_CD = T.ROUT_ORG_NOD_CD" ).append("\n"); 
		query.append("    AND ROUT_DEST_NOD_CD = T.ROUT_DEST_NOD_CD" ).append("\n"); 
		query.append("    AND ROUT_SEQ = T.ROUT_SEQ" ).append("\n"); 
		query.append("    AND TRSP_MOD_CD = 'RD'" ).append("\n"); 
		query.append("    GROUP BY " ).append("\n"); 
		query.append("    ROUT_ORG_NOD_CD,ROUT_DEST_NOD_CD,ROUT_SEQ),1,'N','Y')," ).append("\n"); 
		query.append("    'N') " ).append("\n"); 
		query.append("INV_BIL_PATT_DIV_FLG," ).append("\n"); 
		query.append("T.INLND_ROUT_INCL_STTL_FLG, T.N1ST_AGMT_SEQ, T.N2ND_AGMT_SEQ, T.N3RD_AGMT_SEQ, T.N1ST_AGMT_REF_NO, T.N2ND_AGMT_REF_NO,T. N3RD_AGMT_REF_NO," ).append("\n"); 
		query.append("T.N1ST_TRSP_AGMT_OFC_CTY_CD, T.N2ND_TRSP_AGMT_OFC_CTY_CD, T.N3RD_TRSP_AGMT_OFC_CTY_CD" ).append("\n"); 
		query.append(",@[cre_usr_id], sysdate CRE_DT, @[upd_usr_id], sysdate UPD_DT    " ).append("\n"); 
		query.append("FROM" ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("    SELECT                                                                                                            " ).append("\n"); 
		query.append("    A.PCTL_NO, A.PCTL_SEQ," ).append("\n"); 
		query.append("    CASE" ).append("\n"); 
		query.append("		WHEN PCTL_IO_BND_CD2='T' AND TRSP_MOD_CD='WD'" ).append("\n"); 
		query.append("		AND LEAD(COST_ACT_GRP_CD) OVER (PARTITION BY PCTL_NO ORDER BY PCTL_NO,PCTL_SEQ) ='NTST'" ).append("\n"); 
		query.append("		AND LAG(COST_ACT_GRP_CD) OVER (PARTITION BY PCTL_NO ORDER BY PCTL_NO,PCTL_SEQ) ='NTST'" ).append("\n"); 
		query.append("		THEN 'TYWD'" ).append("\n"); 
		query.append("		ELSE COST_ACT_GRP_CD" ).append("\n"); 
		query.append("	END  COST_ACT_GRP_CD," ).append("\n"); 
		query.append("	A.COST_ACT_GRP_TP_CD, A.VSL_SLAN_CD," ).append("\n"); 
		query.append("    A.CTL_OFFICE, A.PCTL_COST_MOD_CD, A.PCTL_IO_BND_CD, A.PCTL_IO_BND_CD2, A.ORG_NOD_CD,                                                                                                     " ).append("\n"); 
		query.append("    A.ORG_NOD_TP_CD, A.ARR_ST_DT, A.N2ND_NOD_CD, A.N3RD_NOD_CD, A.N4TH_NOD_CD,                                                                                                    " ).append("\n"); 
		query.append("    A.TRSP_MOD_CD, A.N1ST_LNK_DIST, A.N1ST_LNK_DIST_UT_CD, A.N2ND_LNK_DIST, A.N2ND_LNK_DIST_UT_CD,                                                                                            " ).append("\n"); 
		query.append("    A.N3RD_LNK_DIST, A.N3RD_LNK_DIST_UT_CD, A.N1ST_VNDR_SEQ, A.N2ND_VNDR_SEQ, A.N3RD_VNDR_SEQ,                                                                                                  " ).append("\n"); 
		query.append("    A.INLND_ROUT_INV_BIL_PATT_CD, A.N1ST_RD_CRR_CD, A.N2ND_RD_CRR_CD, A.N3RD_RD_CRR_CD, --A.CUST_NOMI_TRKR_FLG,A.CUST_CNT_CD, A.CUST_SEQ, " ).append("\n"); 
		query.append("    A.PRE_NOD_CD, A.PRE_VNDR_SEQ, A.NXT_NOD_CD,                                                                                                     " ).append("\n"); 
		query.append("    A.NXT_VNDR_SEQ, " ).append("\n"); 
		query.append("    DECODE(SUBSTR(A.COST_ACT_GRP_CD,1,1),'D','','V','',DECODE(A.COST_ACT_GRP_TP_CD,'N','','P')) TRSP_SO_STS_CD, " ).append("\n"); 
		query.append("    A.ROUT_ORG_NOD_CD, A.ROUT_DEST_NOD_CD, A.ROUT_SEQ," ).append("\n"); 
		query.append("    A.INLND_ROUT_INCL_STTL_FLG,A.N1ST_AGMT_SEQ, A.N2ND_AGMT_SEQ, A.N3RD_AGMT_SEQ, A.N1ST_AGMT_REF_NO, A.N2ND_AGMT_REF_NO,A.N3RD_AGMT_REF_NO," ).append("\n"); 
		query.append("    A.N1ST_TRSP_AGMT_OFC_CTY_CD, A.N2ND_TRSP_AGMT_OFC_CTY_CD, A.N3RD_TRSP_AGMT_OFC_CTY_CD" ).append("\n"); 
		query.append("    FROM                                                                                                              " ).append("\n"); 
		query.append("    ( " ).append("\n"); 
		query.append("        -- NTSY 관련 수정되는 부분. [S]-----------------------------------------------------------------  " ).append("\n"); 
		query.append("        -- NODE                                                                                                               " ).append("\n"); 
		query.append("        select " ).append("\n"); 
		query.append("        PCTL_NO, PCTL_SEQ,  " ).append("\n"); 
		query.append("        case " ).append("\n"); 
		query.append("            when cnt > 2 and RNK <>1 AND COST_ACT_GRP_CD ='NTST' AND RNK +1 = (LEAD(RNK) OVER(PARTITION BY COST_ACT_GRP_CD, SUBSTR(ORG_NOD_CD,1,5) " ).append("\n"); 
		query.append("                                                                                              ORDER BY PCTL_SEQ )) THEN 'NTSY'" ).append("\n"); 
		query.append("            ELSE COST_ACT_GRP_CD" ).append("\n"); 
		query.append("        END" ).append("\n"); 
		query.append("        COST_ACT_GRP_CD, COST_ACT_GRP_TP_CD, VSL_SLAN_CD, CTL_OFFICE, PCTL_COST_MOD_CD,	" ).append("\n"); 
		query.append("        PCTL_IO_BND_CD,	PCTL_IO_BND_CD2, ORG_NOD_CD, ORG_NOD_TP_CD,	ARR_ST_DT, N2ND_NOD_CD, N3RD_NOD_CD, N4TH_NOD_CD, " ).append("\n"); 
		query.append("        TRSP_MOD_CD, N1ST_LNK_DIST, N1ST_LNK_DIST_UT_CD, N2ND_LNK_DIST, N2ND_LNK_DIST_UT_CD, N3RD_LNK_DIST, " ).append("\n"); 
		query.append("        N3RD_LNK_DIST_UT_CD, N1ST_VNDR_SEQ, N2ND_VNDR_SEQ, N3RD_VNDR_SEQ, N1ST_RD_CRR_CD, N2ND_RD_CRR_CD, N3RD_RD_CRR_CD, " ).append("\n"); 
		query.append("        INLND_ROUT_INV_BIL_PATT_CD, --CUST_NOMI_TRKR_FLG,CUST_CNT_CD, CUST_SEQ, " ).append("\n"); 
		query.append("        PRE_NOD_CD, PRE_VNDR_SEQ, NXT_NOD_CD, " ).append("\n"); 
		query.append("        NXT_VNDR_SEQ, TRSP_SO_STS_CD, ROUT_ORG_NOD_CD, ROUT_DEST_NOD_CD, ROUT_SEQ, INLND_ROUT_INCL_STTL_FLG, N1ST_AGMT_SEQ, " ).append("\n"); 
		query.append("        N2ND_AGMT_SEQ, N3RD_AGMT_SEQ, N1ST_AGMT_REF_NO, N2ND_AGMT_REF_NO, N3RD_AGMT_REF_NO, N1ST_TRSP_AGMT_OFC_CTY_CD, " ).append("\n"); 
		query.append("        N2ND_TRSP_AGMT_OFC_CTY_CD, N3RD_TRSP_AGMT_OFC_CTY_CD " ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        from (                                                                                                     " ).append("\n"); 
		query.append("                SELECT                                                                                                        " ).append("\n"); 
		query.append("                        D.PCTL_NO,                                                                                                    " ).append("\n"); 
		query.append("                        D.PCTL_SEQ,          " ).append("\n"); 
		query.append("                        COUNT(*) OVER(  PARTITION BY COST_ACT_GRP_CD, SUBSTR(ORG_NOD_CD,1,5)) CNT,                                                                                        " ).append("\n"); 
		query.append("                        RANK() OVER(  PARTITION BY COST_ACT_GRP_CD, SUBSTR(ORG_NOD_CD,1,5) ORDER BY PCTL_SEQ) RNK," ).append("\n"); 
		query.append("                         (CASE" ).append("\n"); 
		query.append("                            WHEN --(MST.BKG_RCV_TERM_CD='S') AND " ).append("\n"); 
		query.append("                            (D.PCTL_IO_BND_CD = 'O') AND (D.ORG_NOD_TP_CD='M') AND (M.COST_ACT_GRP_CD <> 'NOBS') " ).append("\n"); 
		query.append("                            AND D.PCTL_SEQ <> (SELECT PCTL_SEQ FROM PRD_PROD_CTL_ROUT_DTL DD " ).append("\n"); 
		query.append("                                                  WHERE" ).append("\n"); 
		query.append("                                                  PCTL_SEQ = (SELECT MAX(PCTL_SEQ) FROM PRD_PROD_CTL_ROUT_DTL " ).append("\n"); 
		query.append("                                                                WHERE PCTL_IO_BND_CD='O' AND NOD_LNK_DIV_CD='N' " ).append("\n"); 
		query.append("                                                                AND PCTL_NO = DD.PCTL_NO)" ).append("\n"); 
		query.append("                                                  AND PCTL_NO = D.PCTL_NO) AND NVL(D.MTY_YD_FLG,'N') <>'Y' THEN 'NOBY'" ).append("\n"); 
		query.append("                            WHEN --(MST.BKG_DE_TERM_CD='S') AND " ).append("\n"); 
		query.append("                            (D.PCTL_IO_BND_CD = 'I') AND (D.ORG_NOD_TP_CD='M') AND (M.COST_ACT_GRP_CD <> 'NIBS')  " ).append("\n"); 
		query.append("                            AND D.PCTL_SEQ <> (SELECT PCTL_SEQ FROM PRD_PROD_CTL_ROUT_DTL DD " ).append("\n"); 
		query.append("                                                  WHERE" ).append("\n"); 
		query.append("                                                  PCTL_SEQ = (SELECT MIN(PCTL_SEQ) FROM PRD_PROD_CTL_ROUT_DTL " ).append("\n"); 
		query.append("                                                                WHERE PCTL_IO_BND_CD='I' AND NOD_LNK_DIV_CD='N' " ).append("\n"); 
		query.append("                                                                AND PCTL_NO = DD.PCTL_NO)" ).append("\n"); 
		query.append("                                                  AND PCTL_NO = D.PCTL_NO) AND NVL(D.MTY_YD_FLG,'N') <>'Y' THEN 'NIBY'" ).append("\n"); 
		query.append("                            WHEN --INBOUND/ USNYCM1 OR USORFM2인 경우 직전 TRSP_MOD = 'VD', 직후 TRSP_MOD = 'WD' 이면 'NTST'" ).append("\n"); 
		query.append("                                ORG_NOD_CD IN ('USNYCM1', 'USORFM2','USPDXM1')" ).append("\n"); 
		query.append("                                AND D.PCTL_IO_BND_CD = 'I' AND  D.ORG_NOD_TP_CD='M' AND D.NOD_LNK_DIV_CD = 'N'" ).append("\n"); 
		query.append("                                AND 'WD' = (SELECT TRSP_MOD_CD FROM PRD_PROD_CTL_ROUT_DTL " ).append("\n"); 
		query.append("                                            WHERE PCTL_NO = D.PCTL_NO AND PCTL_SEQ = D.PCTL_SEQ + 1 )" ).append("\n"); 
		query.append("                                AND 'VD' = (SELECT TRSP_MOD_CD FROM PRD_PROD_CTL_ROUT_DTL" ).append("\n"); 
		query.append("                                            WHERE PCTL_NO = D.PCTL_NO AND PCTL_SEQ = D.PCTL_SEQ - 1) THEN 'NTST'" ).append("\n"); 
		query.append("                            WHEN --OUTBOUND/ USNYCM1 OR USORFM2인 경우 직후 TRSP_MOD = 'VD', 직전 TRSP_MOD = 'WD' 이면 'NTST'" ).append("\n"); 
		query.append("                                ORG_NOD_CD IN ('USNYCM1', 'USORFM2','USPDXM1')" ).append("\n"); 
		query.append("                                AND D.PCTL_IO_BND_CD = 'O' AND  D.ORG_NOD_TP_CD='M' AND D.NOD_LNK_DIV_CD = 'N'" ).append("\n"); 
		query.append("                                AND 'WD' = (SELECT TRSP_MOD_CD FROM PRD_PROD_CTL_ROUT_DTL " ).append("\n"); 
		query.append("                                            WHERE PCTL_NO = D.PCTL_NO AND PCTL_SEQ = D.PCTL_SEQ - 1 )" ).append("\n"); 
		query.append("                                AND 'VD' = (SELECT TRSP_MOD_CD FROM PRD_PROD_CTL_ROUT_DTL" ).append("\n"); 
		query.append("                                            WHERE PCTL_NO = D.PCTL_NO AND PCTL_SEQ = D.PCTL_SEQ + 1) THEN 'NTST'" ).append("\n"); 
		query.append("                            ELSE M.COST_ACT_GRP_CD                                                                                                                                             " ).append("\n"); 
		query.append("                        END) COST_ACT_GRP_CD," ).append("\n"); 
		query.append("                        M.COST_ACT_GRP_TP_CD,                                                                                         " ).append("\n"); 
		query.append("                        D.VSL_SLAN_CD ,                                                                                               " ).append("\n"); 
		query.append("                   		(CASE  -- so office 관련 추가 " ).append("\n"); 
		query.append("                			  WHEN ORG_NOD_TP_CD = 'Z' THEN	 " ).append("\n"); 
		query.append("                			      (SELECT OFC_CD FROM MDM_YARD WHERE YD_CD = (SELECT REP_YD_CD FROM MDM_ZONE WHERE ZN_CD = ORG_NOD_CD))	 " ).append("\n"); 
		query.append("                			  ELSE  " ).append("\n"); 
		query.append("                			      (SELECT OFC_CD FROM MDM_YARD WHERE YD_CD = ORG_NOD_CD)  " ).append("\n"); 
		query.append("                         END) CTL_OFFICE, " ).append("\n"); 
		query.append("                        '' PCTL_COST_MOD_CD,                                                                                          " ).append("\n"); 
		query.append("                        D.PCTL_IO_BND_CD,   " ).append("\n"); 
		query.append("                        D.PCTL_IO_BND_CD PCTL_IO_BND_CD2,                                                                                         " ).append("\n"); 
		query.append("                        D.ORG_NOD_CD,                                                                                                 " ).append("\n"); 
		query.append("                        D.ORG_NOD_TP_CD,                                                                                              " ).append("\n"); 
		query.append("                        D.ARR_ST_DT,                                                                                                  " ).append("\n"); 
		query.append("                        D.DEST_NOD_CD N2ND_NOD_CD,                                                                                    " ).append("\n"); 
		query.append("                        '' N3RD_NOD_CD,                                                                                               " ).append("\n"); 
		query.append("                        '' N4TH_NOD_CD,                                                                                               " ).append("\n"); 
		query.append("                        '' TRSP_MOD_CD,                                                                                               " ).append("\n"); 
		query.append("                        NULL N1ST_LNK_DIST,                                                                                           " ).append("\n"); 
		query.append("                        '' N1ST_LNK_DIST_UT_CD,                                                                                       " ).append("\n"); 
		query.append("                        NULL N2ND_LNK_DIST,                                                                                           " ).append("\n"); 
		query.append("                        '' N2ND_LNK_DIST_UT_CD,                                                                                       " ).append("\n"); 
		query.append("                        NULL N3RD_LNK_DIST,                                                                                           " ).append("\n"); 
		query.append("                        '' N3RD_LNK_DIST_UT_CD,                                                                                       " ).append("\n"); 
		query.append("                        D.N1ST_VNDR_SEQ,                                                                                              " ).append("\n"); 
		query.append("                        D.N2ND_VNDR_SEQ,                                                                                              " ).append("\n"); 
		query.append("                        D.N3RD_VNDR_SEQ,                                                                                              " ).append("\n"); 
		query.append("                        '' N1ST_RD_CRR_CD,'' N2ND_RD_CRR_CD,'' N3RD_RD_CRR_CD,                                                        " ).append("\n"); 
		query.append("                        '' INLND_ROUT_INV_BIL_PATT_CD,                                                        " ).append("\n"); 
		query.append("                        --'' CUST_NOMI_TRKR_FLG,'' CUST_CNT_CD,NULL CUST_SEQ,                                                                                                          " ).append("\n"); 
		query.append("                        LAG(D.ORG_NOD_CD,1) OVER (PARTITION BY D.PCTL_NO ORDER BY D.PCTL_SEQ) PRE_NOD_CD,                             " ).append("\n"); 
		query.append("                        (                                                                                                             " ).append("\n"); 
		query.append("                            SELECT DISTINCT N1ST_VNDR_SEQ FROM PRD_PROD_CTL_ROUT_DTL                                                  " ).append("\n"); 
		query.append("                            WHERE PCTL_NO = D.PCTL_NO AND DEST_NOD_CD = D.ORG_NOD_CD                                                  " ).append("\n"); 
		query.append("                            AND NOD_LNK_DIV_CD ='L' AND D.NOD_LNK_DIV_CD ='L'                                                         " ).append("\n"); 
		query.append("                        ) PRE_VNDR_SEQ," ).append("\n"); 
		query.append("                        LEAD(D.ORG_NOD_CD,1) OVER (PARTITION BY D.PCTL_NO ORDER BY D.PCTL_SEQ) NXT_NOD_CD,                            " ).append("\n"); 
		query.append("                        DECODE(                                                                                                       " ).append("\n"); 
		query.append("                            M.COST_ACT_GRP_CD,                                                                                        " ).append("\n"); 
		query.append("                            'NIBC','',                                                                                                " ).append("\n"); 
		query.append("                            (SELECT  N1ST_VNDR_SEQ FROM PRD_PROD_CTL_ROUT_DTL" ).append("\n"); 
		query.append("                               WHERE PCTL_NO = D.PCTL_NO AND ORG_NOD_CD = D.ORG_NOD_CD" ).append("\n"); 
		query.append("                               AND NOD_LNK_DIV_CD ='L' AND D.NOD_LNK_DIV_CD ='L' )" ).append("\n"); 
		query.append("                        ) NXT_VNDR_SEQ," ).append("\n"); 
		query.append("                        '' TRSP_SO_STS_CD," ).append("\n"); 
		query.append("                        D.ROUT_ORG_NOD_CD," ).append("\n"); 
		query.append("                        D.ROUT_DEST_NOD_CD," ).append("\n"); 
		query.append("                        D.ROUT_SEQ," ).append("\n"); 
		query.append("                        NULL INLND_ROUT_INCL_STTL_FLG," ).append("\n"); 
		query.append("                        NULL N1ST_AGMT_SEQ," ).append("\n"); 
		query.append("                        NULL N2ND_AGMT_SEQ," ).append("\n"); 
		query.append("                        NULL N3RD_AGMT_SEQ," ).append("\n"); 
		query.append("                        NULL N1ST_AGMT_REF_NO," ).append("\n"); 
		query.append("                        NULL N2ND_AGMT_REF_NO," ).append("\n"); 
		query.append("                        NULL N3RD_AGMT_REF_NO," ).append("\n"); 
		query.append("                        NULL N1ST_TRSP_AGMT_OFC_CTY_CD," ).append("\n"); 
		query.append("                        NULL N2ND_TRSP_AGMT_OFC_CTY_CD," ).append("\n"); 
		query.append("                        NULL N3RD_TRSP_AGMT_OFC_CTY_CD     " ).append("\n"); 
		query.append("                FROM    PRD_PROD_CTL_ROUT_DTL D,PRD_COST_ACT_GRP_MAPG M, PRD_PROD_CTL_MST MST                                                       " ).append("\n"); 
		query.append("                WHERE                                                                                                         " ).append("\n"); 
		query.append("                        D.NOD_LNK_DIV_CD ='N'                                                                                         " ).append("\n"); 
		query.append("                        AND M.N1ST_NOD_TP_CD = " ).append("\n"); 
		query.append("                                    ( " ).append("\n"); 
		query.append("                                        DECODE( -- O/B" ).append("\n"); 
		query.append("                                                D.PCTL_SEQ,   " ).append("\n"); 
		query.append("                                                -- PCTL_NO 가 1이 O/B 일때 R_TERM 이 S면S, 그외는 Y, O/B아니면 DTL 자기것. " ).append("\n"); 
		query.append("                                                1, DECODE(M.PCTL_IO_BND_CD,'O',DECODE(MST.BKG_RCV_TERM_CD,'S','S','Y'),D.ORG_NOD_TP_CD),                                                        " ).append("\n"); 
		query.append("                                                -- PCTL_NO 가 3이 O/B 일때 R_TERM 이 F면 N, 그외는 O/B의 MAX PCTL_SEQ 이면 M, 아니면 DTL 자기것." ).append("\n"); 
		query.append("                                                -- 즉, POR  = POL 일때  " ).append("\n"); 
		query.append("                                                3, DECODE(M.PCTL_IO_BND_CD,'O',DECODE(MST.BKG_RCV_TERM_CD,'F','N'," ).append("\n"); 
		query.append("                                                                                DECODE(D.PCTL_SEQ," ).append("\n"); 
		query.append("                                                                                (SELECT MAX(PCTL_SEQ) " ).append("\n"); 
		query.append("                                                                                 FROM PRD_PROD_CTL_ROUT_DTL " ).append("\n"); 
		query.append("                                                                                 WHERE PCTL_IO_BND_CD='O' AND PCTL_NO=D.PCTL_NO),'M'," ).append("\n"); 
		query.append("                                                                                D.ORG_NOD_TP_CD))," ).append("\n"); 
		query.append("                                                D.ORG_NOD_TP_CD),                                          " ).append("\n"); 
		query.append("                                                -- I/B " ).append("\n"); 
		query.append("                                                (SELECT MAX(PCTL_SEQ)-2 FROM PRD_PROD_CTL_ROUT_DTL WHERE PCTL_NO=D.PCTL_NO)," ).append("\n"); 
		query.append("                                                DECODE(M.PCTL_IO_BND_CD,'I',DECODE(MST.BKG_DE_TERM_CD,'F','N'," ).append("\n"); 
		query.append("                                                    DECODE(D.PCTL_SEQ," ).append("\n"); 
		query.append("                                                    (SELECT MIN(PCTL_SEQ) " ).append("\n"); 
		query.append("                                                     FROM PRD_PROD_CTL_ROUT_DTL " ).append("\n"); 
		query.append("                                                     WHERE PCTL_IO_BND_CD='I' AND PCTL_NO=D.PCTL_NO),'M'," ).append("\n"); 
		query.append("                                                    D.ORG_NOD_TP_CD))," ).append("\n"); 
		query.append("                                                D.ORG_NOD_TP_CD),                          " ).append("\n"); 
		query.append("                                                " ).append("\n"); 
		query.append("                                                (SELECT MAX(PCTL_SEQ) FROM PRD_PROD_CTL_ROUT_DTL WHERE PCTL_NO=D.PCTL_NO ), " ).append("\n"); 
		query.append("                                                DECODE(M.PCTL_IO_BND_CD,'I',DECODE(MST.BKG_DE_TERM_CD,'S','S','Y'),D.ORG_NOD_TP_CD)," ).append("\n"); 
		query.append("                                                " ).append("\n"); 
		query.append("                                                (SELECT MAX(PCTL_SEQ) FROM PRD_PROD_CTL_ROUT_DTL WHERE PCTL_IO_BND_CD='O' AND PCTL_NO=D.PCTL_NO),'M'," ).append("\n"); 
		query.append("                                                (SELECT MIN(PCTL_SEQ) FROM PRD_PROD_CTL_ROUT_DTL WHERE PCTL_IO_BND_CD='I' AND PCTL_NO=D.PCTL_NO),'M'," ).append("\n"); 
		query.append("                                                DECODE(M.PCTL_IO_BND_CD,'T','M',D.ORG_NOD_TP_CD) " ).append("\n"); 
		query.append("                                               )                 " ).append("\n"); 
		query.append("                                    )                                                                                           " ).append("\n"); 
		query.append("                        AND M.PCTL_IO_BND_CD = DECODE(" ).append("\n"); 
		query.append("                                                D.PCTL_SEQ, " ).append("\n"); 
		query.append("                                                3, DECODE(D.PCTL_IO_BND_CD,'O',DECODE(MST.BKG_RCV_TERM_CD,'F','N',D.PCTL_IO_BND_CD),D.PCTL_IO_BND_CD),                         " ).append("\n"); 
		query.append("                                               (SELECT MAX(PCTL_SEQ)-2 FROM PRD_PROD_CTL_ROUT_DTL WHERE PCTL_NO=D.PCTL_NO),           " ).append("\n"); 
		query.append("                                               DECODE(D.PCTL_IO_BND_CD,'I',DECODE(MST.BKG_DE_TERM_CD,'F','N',D.PCTL_IO_BND_CD),D.PCTL_IO_BND_CD)," ).append("\n"); 
		query.append("                                               D.PCTL_IO_BND_CD)                            " ).append("\n"); 
		query.append("                        AND D.NOD_LNK_DIV_CD = M.COST_ACT_GRP_TP_CD                                                                   " ).append("\n"); 
		query.append("                        AND DECODE(SUBSTR(M.COST_ACT_GRP_CD,4,1),'C','Y','N') = NVL(D.MTY_YD_FLG,'N')" ).append("\n"); 
		query.append("                        --AND D.PCTL_NO = P.PCTL_NO" ).append("\n"); 
		query.append("                        AND D.PCTL_IO_BND_CD = DECODE(@[io_bnd_cd],'A',D.PCTL_IO_BND_CD,@[io_bnd_cd])                                     " ).append("\n"); 
		query.append("                        AND D.PCTL_NO = MST.PCTL_NO    " ).append("\n"); 
		query.append("                        AND MST.PCTL_NO LIKE @[hd_pctl_no]||'%'" ).append("\n"); 
		query.append("        ) " ).append("\n"); 
		query.append("        -- NTSY 관련 수정되는 부분. [E]-----------------------------------------------------------------                                                                                            " ).append("\n"); 
		query.append("        UNION ALL                                                                                                     " ).append("\n"); 
		query.append("        --LINK                                                                                                        " ).append("\n"); 
		query.append("        SELECT                                                                                                        " ).append("\n"); 
		query.append("        S.PCTL_NO,                                                                                                    " ).append("\n"); 
		query.append("        S.PCTL_SEQ,                                                                                                   " ).append("\n"); 
		query.append("        (CASE" ).append("\n"); 
		query.append("            WHEN S.INLND_ROUT_INCL_STTL_FLG='Y' AND SUBSTR(G.COST_ACT_GRP_CD,2,3)='YTD' AND" ).append("\n"); 
		query.append("                (SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD=N1ST_NOD_CD) = DECODE(S.PCTL_IO_BND_CD2,'O','R','I','M') AND" ).append("\n"); 
		query.append("                (SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD=N2ND_NOD_CD) = DECODE(S.PCTL_IO_BND_CD2,'O','M','I','R') AND N3RD_NOD_CD IS NULL THEN 'DMLK'" ).append("\n"); 
		query.append("            ELSE G.COST_ACT_GRP_CD            " ).append("\n"); 
		query.append("        END) COST_ACT_GRP_CD,                                                                                  " ).append("\n"); 
		query.append("        G.COST_ACT_GRP_TP_CD,                                                                                         " ).append("\n"); 
		query.append("        S.VSL_SLAN_CD ," ).append("\n"); 
		query.append("        DECODE" ).append("\n"); 
		query.append("        (" ).append("\n"); 
		query.append("            DECODE(SUBSTR(G.COST_ACT_GRP_CD,3,2),'RD',S.INLND_ROUT_INV_BIL_PATT_CD,''),'',                                                                                               " ).append("\n"); 
		query.append("            NVL" ).append("\n"); 
		query.append("            (" ).append("\n"); 
		query.append("                (CASE" ).append("\n"); 
		query.append("                    WHEN S.N4TH_NOD_CD IS NOT NULL THEN-- NODE 4" ).append("\n"); 
		query.append("                        (   SELECT CTRL_OFC_CD FROM TRS_TRSP_OFC_EXPT_RULE" ).append("\n"); 
		query.append("                            WHERE                             " ).append("\n"); 
		query.append("                            FM_NOD_CD = DECODE(LENGTH(FM_NOD_CD),2,SUBSTR(S.N1ST_NOD_CD,1,2),5,SUBSTR(S.N1ST_NOD_CD,1,5),7,S.N1ST_NOD_CD)" ).append("\n"); 
		query.append("                            AND VIA_NOD_CD = DECODE(LENGTH(VIA_NOD_CD),2,SUBSTR(DECODE(S.PCTL_IO_BND_CD2,'O',S.N3RD_NOD_CD,S.N2ND_NOD_CD),1,2)," ).append("\n"); 
		query.append("                                                                       5,SUBSTR(DECODE(S.PCTL_IO_BND_CD2,'O',S.N3RD_NOD_CD,S.N2ND_NOD_CD),1,5)," ).append("\n"); 
		query.append("                                                                       7,DECODE(S.PCTL_IO_BND_CD2,'O',S.N3RD_NOD_CD,S.N2ND_NOD_CD)) --F-D-V-T(O)/F-V-D-T(I)" ).append("\n"); 
		query.append("                            AND DOR_NOD_CD = DECODE(LENGTH(DOR_NOD_CD),2,SUBSTR(DECODE(S.PCTL_IO_BND_CD2,'O',S.N2ND_NOD_CD,S.N3RD_NOD_CD),1,2)," ).append("\n"); 
		query.append("                                                                       5,SUBSTR(DECODE(S.PCTL_IO_BND_CD2,'O',S.N2ND_NOD_CD,S.N3RD_NOD_CD),1,5)," ).append("\n"); 
		query.append("                                                                       7,DECODE(S.PCTL_IO_BND_CD2,'O',S.N2ND_NOD_CD,S.N3RD_NOD_CD))            " ).append("\n"); 
		query.append("                            AND TO_NOD_CD = DECODE(LENGTH(TO_NOD_CD),2,SUBSTR(S.N4TH_NOD_CD,1,2),5,SUBSTR(S.N4TH_NOD_CD,1,5),7,S.N4TH_NOD_CD)" ).append("\n"); 
		query.append("                            AND NVL(DELT_FLG,'N') <> 'Y' " ).append("\n"); 
		query.append("                            AND ROWNUM = 1)" ).append("\n"); 
		query.append("                    WHEN S.N3RD_NOD_CD IS NOT NULL THEN -- NODE 3" ).append("\n"); 
		query.append("                        (   SELECT CTRL_OFC_CD FROM TRS_TRSP_OFC_EXPT_RULE" ).append("\n"); 
		query.append("                            WHERE" ).append("\n"); 
		query.append("                            FM_NOD_CD = DECODE(LENGTH(FM_NOD_CD),2,SUBSTR(S.N1ST_NOD_CD,1,2),5,SUBSTR(S.N1ST_NOD_CD,1,5),7,S.N1ST_NOD_CD)" ).append("\n"); 
		query.append("                            AND DECODE(SUBSTR(G.COST_ACT_GRP_CD,2,1),'D',DOR_NOD_CD,VIA_NOD_CD) = " ).append("\n"); 
		query.append("                                DECODE(LENGTH(DECODE(SUBSTR(G.COST_ACT_GRP_CD,2,1),'D',DOR_NOD_CD,VIA_NOD_CD))," ).append("\n"); 
		query.append("                                       2,SUBSTR(S.N2ND_NOD_CD,1,2),5,SUBSTR(S.N2ND_NOD_CD,1,5),7,S.N2ND_NOD_CD)" ).append("\n"); 
		query.append("                            AND DECODE(SUBSTR(G.COST_ACT_GRP_CD,2,1),'D',VIA_NOD_CD,DOR_NOD_CD) IS NULL " ).append("\n"); 
		query.append("                            AND TO_NOD_CD = DECODE(LENGTH(TO_NOD_CD),2,SUBSTR(S.N3RD_NOD_CD,1,2),5,SUBSTR(S.N3RD_NOD_CD,1,5),7,S.N3RD_NOD_CD)" ).append("\n"); 
		query.append("                            AND NVL(DELT_FLG,'N') <> 'Y' " ).append("\n"); 
		query.append("                            AND ROWNUM = 1" ).append("\n"); 
		query.append("                       )     " ).append("\n"); 
		query.append("                    ELSE" ).append("\n"); 
		query.append("                        (   SELECT CTRL_OFC_CD FROM TRS_TRSP_OFC_EXPT_RULE" ).append("\n"); 
		query.append("                            WHERE  " ).append("\n"); 
		query.append("                            FM_NOD_CD = DECODE(LENGTH(FM_NOD_CD),2,SUBSTR(S.N1ST_NOD_CD,1,2),5,SUBSTR(S.N1ST_NOD_CD,1,5),7,S.N1ST_NOD_CD)" ).append("\n"); 
		query.append("                            AND TO_NOD_CD = DECODE(LENGTH(TO_NOD_CD),2,SUBSTR(S.N2ND_NOD_CD,1,2),5,SUBSTR(S.N2ND_NOD_CD,1,5),7,S.N2ND_NOD_CD)" ).append("\n"); 
		query.append("                            AND VIA_NOD_CD IS NULL" ).append("\n"); 
		query.append("                            AND DOR_NOD_CD IS NULL" ).append("\n"); 
		query.append("                            AND NVL(DELT_FLG,'N') <> 'Y' " ).append("\n"); 
		query.append("                            AND ROWNUM = 1" ).append("\n"); 
		query.append("                        )" ).append("\n"); 
		query.append("                END)" ).append("\n"); 
		query.append("               ,(CASE 																																		  " ).append("\n"); 
		query.append("          			WHEN DECODE(SUBSTR(G.COST_ACT_GRP_CD,1,2),'OD',S.N2ND_NOD_TP_CD,S.N1ST_NOD_TP_CD) = 'Z' THEN											 " ).append("\n"); 
		query.append("             			(SELECT OFC_CD FROM MDM_YARD WHERE YD_CD = (SELECT REP_YD_CD FROM MDM_ZONE WHERE ZN_CD = DECODE(SUBSTR(G.COST_ACT_GRP_CD,1,2),'OD',S.N2ND_NOD_CD,S.N1ST_NOD_CD))) " ).append("\n"); 
		query.append("          			ELSE																																		  " ).append("\n"); 
		query.append("             			(SELECT OFC_CD FROM MDM_YARD WHERE YD_CD = DECODE(SUBSTR(G.COST_ACT_GRP_CD,1,2),'OD',S.N2ND_NOD_CD,S.N1ST_NOD_CD)) 						  " ).append("\n"); 
		query.append("       		   END)																																			      " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                " ).append("\n"); 
		query.append("            )," ).append("\n"); 
		query.append("            'PHXSC'" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("        CTL_OFFICE,           " ).append("\n"); 
		query.append("        (CASE                                                                                                         " ).append("\n"); 
		query.append("           WHEN S.N1ST_NOD_TP_CD = 'Z' OR S.N2ND_NOD_TP_CD ='Z' OR                                                    " ).append("\n"); 
		query.append("               S.N3RD_NOD_TP_CD = 'Z' OR S.N4TH_NOD_TP_CD = 'Z' THEN 'Z'                                              " ).append("\n"); 
		query.append("           ELSE 'C'                                                                                                   " ).append("\n"); 
		query.append("        END ) PCTL_COST_MOD_CD,                                                                                       " ).append("\n"); 
		query.append("        S.PCTL_IO_BND_CD,    " ).append("\n"); 
		query.append("        S.PCTL_IO_BND_CD2,                                                                                             " ).append("\n"); 
		query.append("        S.N1ST_NOD_CD,                                                                                                " ).append("\n"); 
		query.append("        S.N1ST_NOD_TP_CD,                                                                                             " ).append("\n"); 
		query.append("        S.ARR_ST_DT,                                                                                                  " ).append("\n"); 
		query.append("        S.N2ND_NOD_CD,                                                                                                " ).append("\n"); 
		query.append("        S.N3RD_NOD_CD,                                                                                                " ).append("\n"); 
		query.append("        S.N4TH_NOD_CD,                                                                                                " ).append("\n"); 
		query.append("        (CASE                                                                                                         " ).append("\n"); 
		query.append("            WHEN S.N1ST_TRSP_MOD_CD = S.N2ND_TRSP_MOD_CD AND S.N1ST_TRSP_MOD_CD = S.N3RD_TRSP_MOD_CD THEN             " ).append("\n"); 
		query.append("                DECODE(S.N1ST_TRSP_MOD_CD,'N','',S.N1ST_TRSP_MOD_CD)                                                  " ).append("\n"); 
		query.append("            WHEN S.N3RD_TRSP_MOD_CD <> 'N' THEN ---3    --3개이구 1+2 혹은 2+1이다...                                                                                                                 " ).append("\n"); 
		query.append("                    DECODE(S.N1ST_TRSP_MOD_CD,S.N2ND_TRSP_MOD_CD,                                                     " ).append("\n"); 
		query.append("                           SUBSTR(S.N1ST_TRSP_MOD_CD,1,1)||SUBSTR(S.N3RD_TRSP_MOD_CD,1,1),                            " ).append("\n"); 
		query.append("                           SUBSTR(S.N1ST_TRSP_MOD_CD,1,1)||SUBSTR(S.N2ND_TRSP_MOD_CD,1,1))                      " ).append("\n"); 
		query.append("                                                                                                                 " ).append("\n"); 
		query.append("            WHEN S.N2ND_TRSP_MOD_CD <> 'N' THEN ---2                                                                  " ).append("\n"); 
		query.append("                DECODE(S.N1ST_TRSP_MOD_CD,S.N2ND_TRSP_MOD_CD,S.N1ST_TRSP_MOD_CD," ).append("\n"); 
		query.append("                        SUBSTR(S.N1ST_TRSP_MOD_CD,1,1)||SUBSTR(S.N2ND_TRSP_MOD_CD,1,1))" ).append("\n"); 
		query.append("            ELSE S.N1ST_TRSP_MOD_CD                                                                                   " ).append("\n"); 
		query.append("        END ) TRSP_MOD_CD,                                                                                                       " ).append("\n"); 
		query.append("        (SELECT L.LNK_DIST FROM PRD_INLND_EACH_LNK L                                                                  " ).append("\n"); 
		query.append("           WHERE                                                                                                      " ).append("\n"); 
		query.append("           LNK_ORG_NOD_CD = S.N1ST_NOD_CD                                                                             " ).append("\n"); 
		query.append("           AND LNK_DEST_NOD_CD =S.N2ND_NOD_CD                                                                         " ).append("\n"); 
		query.append("           AND TRSP_MOD_CD = S.N1ST_TRSP_MOD_CD ) N1ST_LNK_DIST,                                                      " ).append("\n"); 
		query.append("        (SELECT L.DIST_UT_CD FROM PRD_INLND_EACH_LNK L                                                                " ).append("\n"); 
		query.append("           WHERE LNK_ORG_NOD_CD = S.N1ST_NOD_CD                                                                       " ).append("\n"); 
		query.append("           AND LNK_DEST_NOD_CD =S.N2ND_NOD_CD                                                                         " ).append("\n"); 
		query.append("           AND TRSP_MOD_CD = S.N1ST_TRSP_MOD_CD ) N1ST_LNK_DIST_UT_CD,                                                " ).append("\n"); 
		query.append("        (SELECT L.LNK_DIST FROM PRD_INLND_EACH_LNK L                                                                  " ).append("\n"); 
		query.append("           WHERE LNK_ORG_NOD_CD = S.N2ND_NOD_CD                                                                       " ).append("\n"); 
		query.append("           AND LNK_DEST_NOD_CD =S.N3RD_NOD_CD                                                                         " ).append("\n"); 
		query.append("           AND TRSP_MOD_CD = S.N2ND_TRSP_MOD_CD ) N2ND_LNK_DIST,                                                      " ).append("\n"); 
		query.append("        (SELECT L.DIST_UT_CD FROM PRD_INLND_EACH_LNK L                                                                " ).append("\n"); 
		query.append("           WHERE LNK_ORG_NOD_CD = S.N2ND_NOD_CD                                                                       " ).append("\n"); 
		query.append("           AND LNK_DEST_NOD_CD =S.N3RD_NOD_CD                                                                         " ).append("\n"); 
		query.append("           AND TRSP_MOD_CD = S.N2ND_TRSP_MOD_CD ) N2ND_LNK_DIST_UT_CD,                                                " ).append("\n"); 
		query.append("        (SELECT L.LNK_DIST FROM PRD_INLND_EACH_LNK L                                                                  " ).append("\n"); 
		query.append("           WHERE LNK_ORG_NOD_CD = S.N3RD_NOD_CD                                                                       " ).append("\n"); 
		query.append("           AND LNK_DEST_NOD_CD =S.N4TH_NOD_CD" ).append("\n"); 
		query.append("           AND TRSP_MOD_CD = S.N3RD_TRSP_MOD_CD ) N3RD_LNK_DIST,                                                      " ).append("\n"); 
		query.append("        (SELECT L.DIST_UT_CD FROM PRD_INLND_EACH_LNK L                                                                " ).append("\n"); 
		query.append("           WHERE LNK_ORG_NOD_CD = S.N3RD_NOD_CD" ).append("\n"); 
		query.append("           AND LNK_DEST_NOD_CD =S.N4TH_NOD_CD" ).append("\n"); 
		query.append("           AND TRSP_MOD_CD = S.N3RD_TRSP_MOD_CD ) N3RD_DIST_UT_CD,                                                    " ).append("\n"); 
		query.append("        S.N1ST_VNDR_SEQ,                                                                                              " ).append("\n"); 
		query.append("        S.N2ND_VNDR_SEQ,                                                                                              " ).append("\n"); 
		query.append("        S.N3RD_VNDR_SEQ,                                                                                              " ).append("\n"); 
		query.append("        S.N1ST_RD_CRR_CD,                                                                                             " ).append("\n"); 
		query.append("        S.N2ND_RD_CRR_CD,                                                                                             " ).append("\n"); 
		query.append("        S.N3RD_RD_CRR_CD,                                                                                             " ).append("\n"); 
		query.append("        DECODE(SUBSTR(G.COST_ACT_GRP_CD,3,2),'RD',S.INLND_ROUT_INV_BIL_PATT_CD,'') INLND_ROUT_INV_BIL_PATT_CD,                                                                                " ).append("\n"); 
		query.append("        --S.CUST_NOMI_TRKR_FLG,S.CUST_CNT_CD,S.CUST_SEQ,                                                                                                           " ).append("\n"); 
		query.append("        '' ,                                                                                                          " ).append("\n"); 
		query.append("        NULL ,                                                                                                        " ).append("\n"); 
		query.append("        '' ,                                                                                                          " ).append("\n"); 
		query.append("        NULL ,                                                                                                        " ).append("\n"); 
		query.append("        '' TRSP_SO_STS_CD ,                                                                                           " ).append("\n"); 
		query.append("        S.ROUT_ORG_NOD_CD,                                                                                            " ).append("\n"); 
		query.append("        S.ROUT_DEST_NOD_CD,                                                                                           " ).append("\n"); 
		query.append("        S.ROUT_SEQ,                                                                                                    " ).append("\n"); 
		query.append("        S.INLND_ROUT_INCL_STTL_FLG," ).append("\n"); 
		query.append("        S.N1ST_AGMT_SEQ," ).append("\n"); 
		query.append("        S.N2ND_AGMT_SEQ," ).append("\n"); 
		query.append("        S.N3RD_AGMT_SEQ," ).append("\n"); 
		query.append("        S.N1ST_AGMT_REF_NO," ).append("\n"); 
		query.append("        S.N2ND_AGMT_REF_NO," ).append("\n"); 
		query.append("        S.N3RD_AGMT_REF_NO," ).append("\n"); 
		query.append("        S.N1ST_TRSP_AGMT_OFC_CTY_CD," ).append("\n"); 
		query.append("        S.N2ND_TRSP_AGMT_OFC_CTY_CD," ).append("\n"); 
		query.append("        S.N3RD_TRSP_AGMT_OFC_CTY_CD                                                                                                          " ).append("\n"); 
		query.append("        FROM                                                                                                          " ).append("\n"); 
		query.append("        (                                                                                                             " ).append("\n"); 
		query.append("            SELECT D.PCTL_NO,           " ).append("\n"); 
		query.append("            MAX(TRIM(CT.INLND_ROUT_INV_BIL_PATT_CD)) INLND_ROUT_INV_BIL_PATT_CD,                                                                              " ).append("\n"); 
		query.append("            DECODE(CT.CNT,0,'N',99,'N',D.PCTL_IO_BND_CD) PCTL_IO_BND_CD,   " ).append("\n"); 
		query.append("            MAX(D.PCTL_IO_BND_CD) PCTL_IO_BND_CD2,                                           " ).append("\n"); 
		query.append("            MIN(CT.PCTL_SEQ) PCTL_SEQ,                                                                                " ).append("\n"); 
		query.append("            MAX(CT.PCTL_SEQ) MX_PCTL_SEQ,                                                                             " ).append("\n"); 
		query.append("            CT.CNT,                                                                                                   " ).append("\n"); 
		query.append("            MIN(DECODE(RK, 1, D.ORG_NOD_CD)) N1ST_NOD_CD,                                                             " ).append("\n"); 
		query.append("            DECODE(CT.CNT,0,'N',99,'N',MAX(DECODE(RK, 1, D.ORG_NOD_TP_CD)) ) N1ST_NOD_TP_CD,                          " ).append("\n"); 
		query.append("            DECODE(CT.CNT,0,'N',99,'N',NVL(MAX(DECODE(RK, 1, D.TRSP_MOD_CD)),'N')) N1ST_TRSP_MOD_CD,                  " ).append("\n"); 
		query.append("            MAX(DECODE(RK, 1, D.ARR_ST_DT)) ARR_ST_DT,                                                                " ).append("\n"); 
		query.append("            MAX(DECODE(RK, 2, D.ORG_NOD_CD, 1, D.DEST_NOD_CD)) N2ND_NOD_CD,                                           " ).append("\n"); 
		query.append("            DECODE(CT.CNT,0,'N',99,'N',MAX(DECODE(RK, 2, D.ORG_NOD_TP_CD, 1, D.DEST_NOD_TP_CD)) ) N2ND_NOD_TP_CD,     " ).append("\n"); 
		query.append("            DECODE(CT.CNT,0,'N',99,'N',NVL(MAX(DECODE(RK, 2, D.TRSP_MOD_CD)),'N')) N2ND_TRSP_MOD_CD,                  " ).append("\n"); 
		query.append("            MAX(DECODE(RK, 3, D.ORG_NOD_CD, 2, D.DEST_NOD_CD)) N3RD_NOD_CD,                                           " ).append("\n"); 
		query.append("            DECODE(CT.CNT,0,'N',99,'N',MAX(DECODE(RK, 3, D.ORG_NOD_TP_CD, 2, D.DEST_NOD_TP_CD)) ) N3RD_NOD_TP_CD,     " ).append("\n"); 
		query.append("            DECODE(CT.CNT,0,'N',99,'N',NVL(MAX(DECODE(RK, 3, D.TRSP_MOD_CD)),'N')) N3RD_TRSP_MOD_CD,                  " ).append("\n"); 
		query.append("            DECODE(CT.CNT,0,'N',99,'N',MAX(DECODE(RK, 4, D.ORG_NOD_TP_CD, 3, D.DEST_NOD_TP_CD)) ) N4TH_NOD_TP_CD,     " ).append("\n"); 
		query.append("            MAX(DECODE(RK, 3, D.DEST_NOD_CD)) N4TH_NOD_CD,                                                            " ).append("\n"); 
		query.append("            D.VSL_SLAN_CD,                                                                                            " ).append("\n"); 
		query.append("            MAX(DECODE(RK, 1, D.N1ST_VNDR_SEQ)) N1ST_VNDR_SEQ,                                                        " ).append("\n"); 
		query.append("            MAX(DECODE(RK, 2, D.N1ST_VNDR_SEQ)) N2ND_VNDR_SEQ,                                                        " ).append("\n"); 
		query.append("            MAX(DECODE(RK, 3, D.N1ST_VNDR_SEQ)) N3RD_VNDR_SEQ,                                                        " ).append("\n"); 
		query.append("            MAX(                                                                                                      " ).append("\n"); 
		query.append("                DECODE(D.TRSP_MOD_CD,'RD', DECODE(RK,1,D.RAIL_CRR_TP_CD))     " ).append("\n"); 
		query.append("            ) N1ST_RD_CRR_CD,                                                                                         " ).append("\n"); 
		query.append("            MAX(                                                                                                      " ).append("\n"); 
		query.append("                DECODE(D.TRSP_MOD_CD,'RD', DECODE(RK,2,D.RAIL_CRR_TP_CD))     " ).append("\n"); 
		query.append("            ) N2ND_RD_CRR_CD,                                                                                         " ).append("\n"); 
		query.append("            MAX(                                                                                                      " ).append("\n"); 
		query.append("                DECODE(D.TRSP_MOD_CD,'RD', DECODE(RK,3,D.RAIL_CRR_TP_CD))     " ).append("\n"); 
		query.append("            ) N3RD_RD_CRR_CD,                                                                                         " ).append("\n"); 
		query.append("            D.ROUT_ORG_NOD_CD,                                                                                        " ).append("\n"); 
		query.append("            D.ROUT_DEST_NOD_CD,                                                                                       " ).append("\n"); 
		query.append("            D.ROUT_SEQ ,                                                                                              " ).append("\n"); 
		query.append("            MIN(CT.T_VVD_SEQ) T_VVD_SEQ,                                                                              " ).append("\n"); 
		query.append("            (CASE                                                                                                     " ).append("\n"); 
		query.append("                WHEN MIN(CT.T_VVD_SEQ) > MIN(CT.PCTL_SEQ) THEN -1" ).append("\n"); 
		query.append("                WHEN MIN(CT.T_VVD_SEQ) = MIN(CT.PCTL_SEQ) THEN 0                                                      " ).append("\n"); 
		query.append("                ELSE 1                                                                                                " ).append("\n"); 
		query.append("            END) IS_PRE_VVD," ).append("\n"); 
		query.append("            --'' CUST_NOMI_TRKR_FLG,'' CUST_CNT_CD,'' CUST_SEQ," ).append("\n"); 
		query.append("            MAX(DECODE(RK,1,TRIM(D.TRSP_AGMT_SEQ))) N1ST_AGMT_SEQ," ).append("\n"); 
		query.append("            MAX(DECODE(RK,2,TRIM(D.TRSP_AGMT_SEQ))) N2ND_AGMT_SEQ," ).append("\n"); 
		query.append("            MAX(DECODE(RK,3,TRIM(D.TRSP_AGMT_SEQ))) N3RD_AGMT_SEQ," ).append("\n"); 
		query.append("            MAX(DECODE(RK,1,TRIM(D.AGMT_REF_NO))) N1ST_AGMT_REF_NO," ).append("\n"); 
		query.append("            MAX(DECODE(RK,2,TRIM(D.AGMT_REF_NO))) N2ND_AGMT_REF_NO," ).append("\n"); 
		query.append("            MAX(DECODE(RK,3,TRIM(D.AGMT_REF_NO))) N3RD_AGMT_REF_NO," ).append("\n"); 
		query.append("            MAX(D.INLND_ROUT_INCL_STTL_FLG) INLND_ROUT_INCL_STTL_FLG," ).append("\n"); 
		query.append("            MAX(DECODE(RK,1,TRIM(D.TRSP_AGMT_OFC_CTY_CD))) N1ST_TRSP_AGMT_OFC_CTY_CD," ).append("\n"); 
		query.append("            MAX(DECODE(RK,2,TRIM(D.TRSP_AGMT_OFC_CTY_CD))) N2ND_TRSP_AGMT_OFC_CTY_CD," ).append("\n"); 
		query.append("            MAX(DECODE(RK,3,TRIM(D.TRSP_AGMT_OFC_CTY_CD))) N3RD_TRSP_AGMT_OFC_CTY_CD            " ).append("\n"); 
		query.append("            FROM PRD_PROD_CTL_ROUT_DTL D,                                                                             " ).append("\n"); 
		query.append("            (                                                                                                         " ).append("\n"); 
		query.append("                SELECT M2.PCTL_NO,                                                                                    " ).append("\n"); 
		query.append("                M2.PCTL_SEQ,                                                                                          " ).append("\n"); 
		query.append("                RANK() OVER ( PARTITION BY M2.PCTL_NO, M2.CNT ORDER BY M2.PCTL_NO, M2.PCTL_SEQ) RK,                   " ).append("\n"); 
		query.append("                M2.PCTL_IO_BND_CD,                                                                                    " ).append("\n"); 
		query.append("                M2.N1ST_VNDR_SEQ,                                                                                     " ).append("\n"); 
		query.append("                M2.CNT,                                                                                               " ).append("\n"); 
		query.append("                M2.T_VVD_SEQ," ).append("\n"); 
		query.append("                M2.INLND_ROUT_INV_BIL_PATT_CD," ).append("\n"); 
		query.append("                M2.SHPR_CNT_CD, M2.SHPR_SEQ," ).append("\n"); 
		query.append("                M2.CNEE_CNT_CD, M2.CNEE_SEQ," ).append("\n"); 
		query.append("                M2.ACT_CUST_CNT_CD, M2.ACT_CUST_SEQ --, M2.CUST_NOMI_TRKR_FLG              " ).append("\n"); 
		query.append("                FROM" ).append("\n"); 
		query.append("                (" ).append("\n"); 
		query.append("                    SELECT" ).append("\n"); 
		query.append("                    PCTL_NO, PCTL_SEQ, RK, PCTL_IO_BND_CD, N1ST_VNDR_SEQ, N2ND_VNDR_SEQ, N3RD_VNDR_SEQ,               " ).append("\n"); 
		query.append("                    T_VVD_SEQ, INLND_ROUT_INV_BIL_PATT_CD,INLND_ROUT_CMB_FLG," ).append("\n"); 
		query.append("                    SHPR_CNT_CD,SHPR_SEQ,CNEE_CNT_CD,CNEE_SEQ,ACT_CUST_CNT_CD,ACT_CUST_SEQ,--CUST_NOMI_TRKR_FLG, " ).append("\n"); 
		query.append("                    D_TERM, CNT2,                                       " ).append("\n"); 
		query.append("                    (                                                                                                 " ).append("\n"); 
		query.append("                     CASE                                                                                             " ).append("\n"); 
		query.append("                        WHEN CNT2 = 0  AND (R_TERM = 'D' OR SUBSTR(PCTL_NO,1,1) ='O') THEN                                                          " ).append("\n"); 
		query.append("                           LEAD(CNT2) OVER (PARTITION BY PCTL_NO ORDER BY PCTL_SEQ)            " ).append("\n"); 
		query.append("                        WHEN CNT2 = 99 AND (D_TERM = 'D' OR SUBSTR(PCTL_NO,1,1) ='I') THEN                                                         " ).append("\n"); 
		query.append("                           LAG(CNT2) OVER (PARTITION BY PCTL_NO ORDER BY PCTL_SEQ)                                    " ).append("\n"); 
		query.append("                        ELSE CNT2                                                                                     " ).append("\n"); 
		query.append("                     END                                                                                              " ).append("\n"); 
		query.append("                    ) CNT -- PRD_COST_ACT_GRP_MAPG 과 매핑할 그룹 역활정리 , MT_PU, MT_RTN 을 정리  ,GROUP BY 적용위해                                                                                            " ).append("\n"); 
		query.append("                    FROM                                                                                              " ).append("\n"); 
		query.append("                    (                                                                                                 " ).append("\n"); 
		query.append("                        SELECT                                                                                        " ).append("\n"); 
		query.append("                        M.PCTL_NO,                                                                                    " ).append("\n"); 
		query.append("                        M.PCTL_SEQ,                                                                                   " ).append("\n"); 
		query.append("                        TRIM(M.INLND_ROUT_INV_BIL_PATT_CD) INLND_ROUT_INV_BIL_PATT_CD,                                                             " ).append("\n"); 
		query.append("                        M.INLND_ROUT_CMB_FLG,                         " ).append("\n"); 
		query.append("                        (CASE                                                                                         " ).append("\n"); 
		query.append("                            WHEN TRIM(M.INLND_ROUT_INV_BIL_PATT_CD) IS NOT NULL THEN                                        " ).append("\n"); 
		query.append("                            (" ).append("\n"); 
		query.append("                                 RANK() OVER ( PARTITION BY M.PCTL_NO, M.INLND_ROUT_INV_BIL_PATT_CD,                  " ).append("\n"); 
		query.append("                                               DECODE(M.INLND_ROUT_CMB_FLG,'Y',M.PCTL_NO,M.PCTL_SEQ)                  " ).append("\n"); 
		query.append("                                ORDER BY M.PCTL_NO, M.PCTL_SEQ)                                                       " ).append("\n"); 
		query.append("                            )" ).append("\n"); 
		query.append("                            ELSE                                                                                      " ).append("\n"); 
		query.append("                            (" ).append("\n"); 
		query.append("                                RANK() OVER ( PARTITION BY M.PCTL_NO, M.PCTL_IO_BND_CD, M.N1ST_VNDR_SEQ,              " ).append("\n"); 
		query.append("                                               DECODE(M.INLND_ROUT_CMB_FLG,'Y',M.PCTL_NO,PCTL_SEQ)                    " ).append("\n"); 
		query.append("                                ORDER BY M.PCTL_NO, M.PCTL_SEQ)" ).append("\n"); 
		query.append("                            )" ).append("\n"); 
		query.append("                        END) RK," ).append("\n"); 
		query.append("                        M.PCTL_IO_BND_CD,                                                                             " ).append("\n"); 
		query.append("                        M.N1ST_VNDR_SEQ ,                                                                             " ).append("\n"); 
		query.append("                        M.N2ND_VNDR_SEQ ,                                                                             " ).append("\n"); 
		query.append("                        M.N3RD_VNDR_SEQ ,                                                                             " ).append("\n"); 
		query.append("                        PRD_GET_TLANE_FNC(M.PCTL_NO,'SEQ') T_VVD_SEQ,                                                                                  " ).append("\n"); 
		query.append("                        (CASE                                                                                         " ).append("\n"); 
		query.append("                            WHEN  (M.PCTL_SEQ =2) AND (M.PCTL_IO_BND_CD='O') THEN 0                                                                 " ).append("\n"); 
		query.append("                            WHEN  M.PCTL_SEQ = (                                                                        " ).append("\n"); 
		query.append("                                SELECT MAX(PCTL_SEQ) FROM PRD_PROD_CTL_ROUT_DTL                                       " ).append("\n"); 
		query.append("                                WHERE NOD_LNK_DIV_CD ='L' AND PCTL_NO = M.PCTL_NO) AND (M.PCTL_IO_BND_CD='I') THEN 99                            " ).append("\n"); 
		query.append("                            WHEN TRIM(M.INLND_ROUT_INV_BIL_PATT_CD) IS NOT NULL THEN                                          " ).append("\n"); 
		query.append("                            (                                                                                       " ).append("\n"); 
		query.append("                                SELECT                                                                                " ).append("\n"); 
		query.append("                                COUNT                                                                                 " ).append("\n"); 
		query.append("                                (DISTINCT INLND_ROUT_INV_BIL_PATT_CD|| DECODE(INLND_ROUT_CMB_FLG,'Y','Y',PCTL_SEQ))   " ).append("\n"); 
		query.append("                                FROM PRD_PROD_CTL_ROUT_DTL X                                                          " ).append("\n"); 
		query.append("                                WHERE X.PCTL_NO = M.PCTL_NO AND M.PCTL_SEQ >= X.PCTL_SEQ AND M.NOD_LNK_DIV_CD ='L'    " ).append("\n"); 
		query.append("                                AND X.NOD_LNK_DIV_CD ='L'                                                             " ).append("\n"); 
		query.append("                            )                                                                                         " ).append("\n"); 
		query.append("                            ELSE (                                                                                    " ).append("\n"); 
		query.append("                                SELECT COUNT(DISTINCT NVL(DECODE(INLND_ROUT_CMB_FLG,'Y',TO_CHAR(N1ST_VNDR_SEQ)),      " ).append("\n"); 
		query.append("                                PCTL_NO||PCTL_SEQ)) FROM PRD_PROD_CTL_ROUT_DTL X                                      " ).append("\n"); 
		query.append("                                WHERE X.PCTL_NO = M.PCTL_NO AND M.PCTL_SEQ >= X.PCTL_SEQ                              " ).append("\n"); 
		query.append("                                AND M.NOD_LNK_DIV_CD ='L' AND X.NOD_LNK_DIV_CD ='L')                                  " ).append("\n"); 
		query.append("                        END                                                                                           " ).append("\n"); 
		query.append("                        ) CNT2, -- PRD_COST_ACT_GRP_MAPG 과 매핑할 그룹 역활" ).append("\n"); 
		query.append("                        MST.BKG_RCV_TERM_CD R_TERM," ).append("\n"); 
		query.append("                        MST.BKG_DE_TERM_CD D_TERM," ).append("\n"); 
		query.append("                        MST.SHPR_CNT_CD,MST.SHPR_SEQ," ).append("\n"); 
		query.append("                        MST.CNEE_CNT_CD,MST.CNEE_SEQ," ).append("\n"); 
		query.append("                        '' ACT_CUST_CNT_CD ,'' ACT_CUST_SEQ --, -- MST.ACT_CUST_CNT_CD, MST.ACT_CUST_SEQ," ).append("\n"); 
		query.append("                        --'' CUST_NOMI_TRKR_FLG --M.CUST_NOMI_TRKR_FLG" ).append("\n"); 
		query.append("                        FROM                                                                                          " ).append("\n"); 
		query.append("                        PRD_PROD_CTL_ROUT_DTL M, PRD_PROD_CTL_MST MST                                                                       " ).append("\n"); 
		query.append("                        WHERE M.NOD_LNK_DIV_CD ='L'                                                                   " ).append("\n"); 
		query.append("                        AND M.PCTL_IO_BND_CD = DECODE(@[io_bnd_cd],'A',M.PCTL_IO_BND_CD,@[io_bnd_cd]) " ).append("\n"); 
		query.append("                        AND M.PCTL_NO = MST.PCTL_NO " ).append("\n"); 
		query.append("                        AND MST.PCTL_NO LIKE @[hd_pctl_no]||'%'                   " ).append("\n"); 
		query.append("                        ORDER BY 1,2                                                                                  " ).append("\n"); 
		query.append("                    )                                                                                                 " ).append("\n"); 
		query.append("                ) M2                                                                                                  " ).append("\n"); 
		query.append("                ORDER BY 1, 2                                                                                         " ).append("\n"); 
		query.append("            ) CT                                                                                                      " ).append("\n"); 
		query.append("            WHERE D.NOD_LNK_DIV_CD ='L'                                                                                                                                                       " ).append("\n"); 
		query.append("            AND D.PCTL_NO = CT.PCTL_NO                                                                                " ).append("\n"); 
		query.append("            AND D.PCTL_SEQ = CT.PCTL_SEQ                                                                              " ).append("\n"); 
		query.append("            AND D.PCTL_IO_BND_CD = CT.PCTL_IO_BND_CD  " ).append("\n"); 
		query.append("            GROUP BY D.PCTL_NO, D.PCTL_IO_BND_CD, CT.CNT,D.VSL_SLAN_CD,D.ROUT_ORG_NOD_CD,                             " ).append("\n"); 
		query.append("            D.ROUT_DEST_NOD_CD,D.ROUT_SEQ                                                                             " ).append("\n"); 
		query.append("            ORDER BY 1, 2 DESC                                                                                        " ).append("\n"); 
		query.append("        ) S,                                                                                                          " ).append("\n"); 
		query.append("        PRD_COST_ACT_GRP_MAPG G                                                                                       " ).append("\n"); 
		query.append("        WHERE S.PCTL_IO_BND_CD = G.PCTL_IO_BND_CD                                                                     " ).append("\n"); 
		query.append("        AND S.N1ST_NOD_TP_CD = G.N1ST_NOD_TP_CD                                                                       " ).append("\n"); 
		query.append("        AND NVL(S.N2ND_NOD_TP_CD, 'N') =G.N2ND_NOD_TP_CD                                                              " ).append("\n"); 
		query.append("        AND NVL(S.N3RD_NOD_TP_CD, 'N') =G.N3RD_NOD_TP_CD                                                              " ).append("\n"); 
		query.append("        AND NVL(S.N4TH_NOD_TP_CD, 'N') =G.N4TH_NOD_TP_CD                                                              " ).append("\n"); 
		query.append("        AND S.N1ST_TRSP_MOD_CD = G.N1ST_TRSP_MOD_CD                                                                   " ).append("\n"); 
		query.append("        AND NVL(S.N2ND_TRSP_MOD_CD, 'N') = G.N2ND_TRSP_MOD_CD                                                         " ).append("\n"); 
		query.append("        AND NVL(S.N3RD_TRSP_MOD_CD, 'N') = G.N3RD_TRSP_MOD_CD                                                         " ).append("\n"); 
		query.append("        AND G.COST_ACT_GRP_TP_CD ='L'                                                                                 " ).append("\n"); 
		query.append("        AND G.COST_ACT_GRP_CD LIKE DECODE(S.PCTL_IO_BND_CD," ).append("\n"); 
		query.append("                                    'T',DECODE(S.N1ST_TRSP_MOD_CD,'WD',DECODE(S.IS_PRE_VVD,-1,'PR%',0,'TR%','PO%'),G.COST_ACT_GRP_CD)" ).append("\n"); 
		query.append("                                    ,G.COST_ACT_GRP_CD)" ).append("\n"); 
		query.append("                                                                                                                    " ).append("\n"); 
		query.append("        UNION ALL                                                                                                     " ).append("\n"); 
		query.append("        --COMMON AG FOR COA                                                                                           " ).append("\n"); 
		query.append("        SELECT                                                                                                        " ).append("\n"); 
		query.append("        PCTL_NO, MAX(PCTL_SEQ) PCTL_SEQ, 'COMN','N','','','','C','C','','', --10                                          " ).append("\n"); 
		query.append("        NULL,'','','','',NULL,'',NULL,'',NULL,'',NULL,NULL,NULL,'','','','',--'','', --30                               " ).append("\n"); 
		query.append("        --NULL," ).append("\n"); 
		query.append("        '',NULL,'',NULL,'','','',NULL, --39                                                                       " ).append("\n"); 
		query.append("        NULL,NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL" ).append("\n"); 
		query.append("        FROM PRD_PROD_CTL_ROUT_DTL" ).append("\n"); 
		query.append("        WHERE PCTL_NO LIKE @[hd_pctl_no]||'%'" ).append("\n"); 
		query.append("        GROUP BY PCTL_NO                                                                                 " ).append("\n"); 
		query.append("    ) A                                                                                                                                                                                                       " ).append("\n"); 
		query.append("    ORDER BY 1,2 ASC   " ).append("\n"); 
		query.append(") T" ).append("\n"); 
		query.append("ORDER BY 1,2 ASC" ).append("\n"); 

	}
}