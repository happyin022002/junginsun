<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CARIssueTransferSlipManageDBDAOCreateApInvHDRCSQL">
			<desc><![CDATA[CreateApInvHDR]]></desc>
			<sql><![CDATA[
insert into AP_INV_HDR (
		csr_no                                            ,
		csr_tp_cd                                         ,
		inv_dt                                            ,
		inv_term_dt                                       ,
		gl_dt                                             ,
		vndr_no                                           ,
		csr_amt                                           ,
		pay_amt                                           ,
		pay_dt                                            ,
		csr_curr_cd                                       ,
		vndr_term_nm                                      ,
		inv_desc                                          ,
		attr_cate_nm                                      ,
		attr_ctnt1                                        ,
		attr_ctnt2                                        ,
		attr_ctnt3                                        ,
		attr_ctnt4                                        ,
		attr_ctnt5                                        ,
		attr_ctnt6                                        ,
		attr_ctnt7                                        ,
		attr_ctnt8                                        ,
		attr_ctnt9                                        ,
		attr_ctnt10                                       ,
		attr_ctnt11                                       ,
		attr_ctnt12                                       ,
		attr_ctnt13                                       ,
		attr_ctnt14                                       ,
		attr_ctnt15                                       ,
		glo_attr_ctnt1                                    ,
		glo_attr_ctnt2                                    ,
		glo_attr_ctnt3                                    ,
		glo_attr_ctnt4                                    ,
		glo_attr_ctnt5                                    ,
		glo_attr_ctnt6                                    ,
		glo_attr_ctnt7                                    ,
		glo_attr_ctnt8                                    ,
		glo_attr_ctnt9                                    ,
		glo_attr_ctnt10                                   ,
		glo_attr_ctnt11                                   ,
		glo_attr_ctnt12                                   ,
		glo_attr_ctnt13                                   ,
		glo_attr_ctnt14                                   ,
		glo_attr_ctnt15                                   ,
		glo_attr_ctnt16                                   ,
		glo_attr_ctnt17                                   ,
		glo_attr_ctnt18                                   ,
		src_ctnt                                          ,
		pay_mzd_lu_cd                                     ,
		pay_grp_lu_cd                                     ,
		coa_co_cd                                         ,
		coa_rgn_cd                                        ,
		coa_ctr_cd                                        ,
		coa_acct_cd                                       ,
		coa_vvd_cd                                        ,
		coa_inter_co_cd                                   ,
		coa_ftu_n1st_cd                                   ,
		coa_ftu_n2nd_cd                                   ,
		ppd_no                                            ,
		ppd_dtrb_no                                       ,
		ppd_aply_amt                                      ,
		ppd_gl_dt                                         ,
		apro_flg                                          ,
		tax_decl_flg                                      ,
		err_csr_no                                        ,
		if_flg                                            ,
		if_dt                                             ,
		if_err_rsn                                        ,
		ppay_aply_flg                                     ,
		tj_ofc_cd                                         ,
		act_xch_rt                                        ,
		imp_err_flg                                       ,
		rcv_err_flg                                       ,
		tax_curr_xch_flg                                  ,
		usr_eml                                           ,
		imp_err_rsn                                       ,
		rcv_err_rsn                                       ,
		ftu_use_ctnt1                                     ,
		ftu_use_ctnt2                                     ,
		ftu_use_ctnt3                                     ,
		ftu_use_ctnt4                                     ,
		ftu_use_ctnt5                                     ,
		cre_dt                                            ,
		cre_usr_id                                        ,
		eai_evnt_dt
		 ) values (
		@[csr_no]													,
		@[csr_tp_cd]												,
		@[inv_dt]													,
		@[inv_term_dt]                                              ,       											
		/*  2008-06-18: AP_PERIOD TABLE의 구조 변경으로 수정  */
--		(SELECT DECODE(A.STS,'O',[],'C',B.DT,'N',NULL)
--		 FROM   (SELECT NVL((SELECT CLZ_STS_CD STS
--		         FROM   AP_PERIOD
--		         WHERE  SYS_DIV_CD = '15'
--		         AND    EFF_YRMON  = SUBSTR([],1,6)
--		         AND    OFC_CD = []
--		         AND    AR_AP_DIV_CD = 'P' ),'C') STS FROM DUAL) A,
--		        (SELECT MIN(EFF_YRMON)||'01' DT
--		         FROM   AP_PERIOD
--		         WHERE  SYS_DIV_CD = '15'
--		         AND    EFF_YRMON >= SUBSTR([],1,6)
--		         AND    CLZ_STS_CD = 'O'
--		         AND    OFC_CD = TES_AP_PERIOD_OFC_CD_FNC('M','15',SUBSTR([],1,6),[])
--		         AND    AR_AP_DIV_CD = 'P') B ),
		(SELECT DECODE(A.STS,'O',@[gl_dt],'C',B.DT,'N',NULL)
		 FROM   (SELECT NVL((SELECT CASE WHEN SUM(DECODE(CLZ_STS_CD,'O',1,0)) > 0 THEN 'O' ELSE 'C' END STS
		         FROM   AP_PERIOD
		         WHERE  SYS_DIV_CD = '15'
		         AND    EFF_YRMON  = SUBSTR(@[gl_dt],1,6)
		         AND    OFC_CD IN (@[ap_ofc_cd],(SELECT M.AR_HD_QTR_OFC_CD FROM MDM_ORGANIZATION M WHERE M.OFC_CD = @[ap_ofc_cd]))
		         AND    AR_AP_DIV_CD = 'P'),'C') STS FROM DUAL) A,
		        (SELECT MIN(EFF_YRMON)||'01' DT
		         FROM   AP_PERIOD
		         WHERE  SYS_DIV_CD = '15'
		         AND    EFF_YRMON >= SUBSTR(@[gl_dt],1,6)
		         AND    AR_AP_DIV_CD = 'P'
		         AND    OFC_CD IN (@[ap_ofc_cd],(SELECT M.AR_HD_QTR_OFC_CD FROM MDM_ORGANIZATION M WHERE M.OFC_CD = @[ap_ofc_cd]))
		         AND    CLZ_STS_CD = 'O') B ),
		@[vndr_seq]	                                              ,
		@[csr_amt]                                                ,
		''                                                 ,
		''                                            ,
		@[curr_cd]                                        ,
--		[]                                                 ,                     --vndr_term_nm
		(SELECT
		 CASE
		 WHEN SUBSTR(@[gen_pay_term_cd],1,1)='O' THEN @[gen_pay_term_cd]
		 ELSE
		     CASE
		     WHEN @[payment_due_dt] IS NOT NULL AND @[max_iss_dt] IS NOT NULL THEN
		     		CASE
		     		WHEN NVL(TO_DATE(@[payment_due_dt],'YYYY-MM-DD') - (TO_DATE(@[max_iss_dt],'YYYY-MM-DD')),0) >= 0
		     			 AND NVL(TO_DATE(@[payment_due_dt],'YYYY-MM-DD') - (TO_DATE(@[max_iss_dt],'YYYY-MM-DD')),0) <= 100
		     			 THEN TO_CHAR(NVL(TO_DATE(@[payment_due_dt],'YYYY-MM-DD') - (TO_DATE(@[max_iss_dt],'YYYY-MM-DD')),0))
		     		ELSE @[gen_pay_term_cd]
		     		END
		     ELSE @[gen_pay_term_cd]
		     END
		 END RES
		 FROM DUAL),                                                                                              --vndr_term_nm
--		(SELECT VNDR_LOCL_LANG_NM FROM  MDM_VENDOR  WHERE  VNDR_SEQ = [])  ,
--		(SELECT DECODE(VNDR_CNT_CD,'KR',VNDR_LOCL_LANG_NM,VNDR_LGL_ENG_NM) FROM  MDM_VENDOR  WHERE  VNDR_SEQ = [])  ,    --inv_desc
		''  ,    --inv_desc	2007-12-17 : ERP의 요청으로 max acct nm을 배부치고 넣는다.
		@[attr_cate_nm]                                                 ,											--attr_cate_nm
		@[attr_ctnt1]                                                 ,											--attr_ctnt1
		@[attr_ctnt2]                                                 ,											--attr_ctnt2
		@[attr_ctnt3]                                                 ,											--attr_ctnt3
		@[evi_total_net_amt]                                                 ,											--attr_ctnt4
		@[evi_tax_no2]                                                 ,											--attr_ctnt5
		@[evi_total_tax_amt]                                                 ,											--attr_ctnt6
		''                                                 ,											--attr_ctnt7
		@[attr_ctnt8]                                                 ,											--attr_ctnt8
		''                                                 ,											--attr_ctnt9
		@[usr_nm]                                                 ,											--attr_ctnt10
		''                                                 ,											--attr_ctnt11
		''                                                 ,											--attr_ctnt12
		''                                                 ,											--attr_ctnt13
		''                                                 ,											--attr_ctnt14
		''                                                 ,											--attr_ctnt15
		@[evi_ctnt1]                                                 ,											--glo_attr_ctnt1
		@[evi_ctnt2]                                                 ,											--glo_attr_ctnt2
		@[evi_ctnt3]                                                 ,											--glo_attr_ctnt3
		@[evi_ctnt4]                                                 ,											--glo_attr_ctnt4
		@[evi_ctnt5]                                                 ,											--glo_attr_ctnt5
		@[evi_ctnt6]                                                 ,											--glo_attr_ctnt6
		@[evi_ctnt7]                                                 ,											--glo_attr_ctnt7
		@[evi_ctnt8]                                                 ,											--glo_attr_ctnt8
		@[evi_ctnt9]                                                 ,											--glo_attr_ctnt9
		@[evi_ctnt10]                                                 ,											--glo_attr_ctnt10
		@[evi_ctnt11]                                                 ,											--glo_attr_ctnt11
		@[evi_ctnt12]                                                 ,											--glo_attr_ctnt12
		@[evi_tax_no]                                                 ,											--glo_attr_ctnt13
		''                                                 ,											--glo_attr_ctnt14
		''                                                 ,											--glo_attr_ctnt15
		''                                                 ,											--glo_attr_ctnt16
		''                                                 ,											--glo_attr_ctnt17
		''                                                 ,											--glo_attr_ctnt18
		'SO_TERMINAL'                                                 ,											--src_ctnt
		--(SELECT SLD.LU_CD

		--  FROM SCO_LU_HDR SLH, SCO_LU_DTL SLD
		-- WHERE SLH.LU_TP_CD = SLD.LU_TP_CD
  		--   AND SLH.LU_TP_CD = 'PAYMENT METHOD'
  		--   AND NVL(SLD.ENBL_FLG, 'Y') = 'Y'
  		--   AND NVL(SLD.LU_ST_DT, SYSDATE) >= SYSDATE
  		--   AND SLH.LU_APPL_CD = 'SAP'
  		--   AND SLD.ATTR_CTNT2 = 
        (SELECT PAY_MZD_CD
           FROM MDM_VENDOR
          WHERE VNDR_SEQ = @[vndr_seq]),												    --pay_mzd_lu_cd
		@[pay_grp_lu_cd]                                                 ,											--pay_grp_lu_cd
		'01'                                                 ,											--coa_co_cd
		(SELECT finc_rgn_cd FROM MDM_ORGANIZATION WHERE ofc_cd = @[cost_ofc_cd] AND NVL(delt_flg,'N') = 'N') ,		--coa_rgn_cd
		(SELECT ap_ctr_cd FROM MDM_ORGANIZATION WHERE ofc_cd = @[cost_ofc_cd] AND NVL(delt_flg,'N') = 'N')   ,		--coa_ctr_cd
		'210111'                                                 ,											--coa_acct_cd
		'0000000000'                                                 ,											--coa_vvd_cd
		(SELECT nvl(SUBS_CO_CD,'00') FROM mdm_vendor WHERE vndr_seq = @[vndr_seq] )	                      ,   	--coa_inter_co_cd
		'000000'		          									,											--coa_ftu_n1st_cd
		'000000'                                                 ,											--coa_ftu_n2nd_cd
		''                                                 ,											--ppd_no
		''                                                 ,											--ppd_dtrb_no
		''                                                 ,											--ppd_aply_amt
		''                                                 ,											--ppd_gl_dt
		'N'                                                 ,											--apro_flg
		''                                                 ,											--tax_decl_flg
		''                                                 ,											--err_csr_no
		''                                                 ,											--if_flg
		''                                                 ,											--if_dt
		''                                                 ,											--if_err_rsn
		''                                                 ,											--ppay_aply_flg
		@[ap_ofc_cd]                                                 ,											--tj_ofc_cd
		''                                                 ,											--act_xch_rt
		''                                                 ,											--imp_err_flg
		''                                                 ,											--rcv_err_flg
		''                                                 ,											--tax_curr_xch_flg
		@[usr_eml]                                                 ,											--usr_eml
		''                                                 ,											--imp_err_rsn
		''                                                 ,											--rcv_err_rsn
		''                                                 ,											--ftu_use_ctnt1
		''                                                 ,											--ftu_use_ctnt2
		''                                                 ,											--ftu_use_ctnt3
		''                                                 ,											--ftu_use_ctnt4
		''                                                 ,											--ftu_use_ctnt5
		SYSDATE             ,											--cre_dt
		@[cre_usr_id]		                                            ,										--cre_usr_id
		SYSDATE															--eai_evnt_dt
		)			]]></sql>
			<params>
				<param name="csr_no" type="12" value="" out="N"/>
				<param name="csr_tp_cd" type="12" value="" out="N"/>
				<param name="inv_dt" type="12" value="" out="N"/>
				<param name="inv_term_dt" type="12" value="" out="N"/>
				<param name="gl_dt" type="12" value="" out="N"/>
				<param name="ap_ofc_cd" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
				<param name="csr_amt" type="12" value="" out="N"/>
				<param name="curr_cd" type="12" value="" out="N"/>
				<param name="gen_pay_term_cd" type="12" value="" out="N"/>
				<param name="payment_due_dt" type="12" value="" out="N"/>
				<param name="max_iss_dt" type="12" value="" out="N"/>
				<param name="attr_cate_nm" type="12" value="" out="N"/>
				<param name="attr_ctnt1" type="12" value="" out="N"/>
				<param name="attr_ctnt2" type="12" value="" out="N"/>
				<param name="attr_ctnt3" type="12" value="" out="N"/>
				<param name="evi_total_net_amt" type="12" value="" out="N"/>
				<param name="evi_tax_no2" type="12" value="" out="N"/>
				<param name="evi_total_tax_amt" type="12" value="" out="N"/>
				<param name="attr_ctnt8" type="12" value="" out="N"/>
				<param name="usr_nm" type="12" value="" out="N"/>
				<param name="evi_ctnt1" type="12" value="" out="N"/>
				<param name="evi_ctnt2" type="12" value="" out="N"/>
				<param name="evi_ctnt3" type="12" value="" out="N"/>
				<param name="evi_ctnt4" type="12" value="" out="N"/>
				<param name="evi_ctnt5" type="12" value="" out="N"/>
				<param name="evi_ctnt6" type="12" value="" out="N"/>
				<param name="evi_ctnt7" type="12" value="" out="N"/>
				<param name="evi_ctnt8" type="12" value="" out="N"/>
				<param name="evi_ctnt9" type="12" value="" out="N"/>
				<param name="evi_ctnt10" type="12" value="" out="N"/>
				<param name="evi_ctnt11" type="12" value="" out="N"/>
				<param name="evi_ctnt12" type="12" value="" out="N"/>
				<param name="evi_tax_no" type="12" value="" out="N"/>
				<param name="pay_grp_lu_cd" type="12" value="" out="N"/>
				<param name="cost_ofc_cd" type="12" value="" out="N"/>
				<param name="usr_eml" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
