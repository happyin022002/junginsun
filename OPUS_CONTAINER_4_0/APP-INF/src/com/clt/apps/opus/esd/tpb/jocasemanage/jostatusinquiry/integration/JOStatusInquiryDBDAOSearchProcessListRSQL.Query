<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="JOStatusInquiryDBDAOSearchProcessListRSQL">
			<desc><![CDATA[JO TPB -> JO TPB Process Inquiry]]></desc>
			<sql><![CDATA[
WITH TES AS
(
SELECT H.COST_OFC_CD
      ,A.CSR_NO
      ,H.TML_INV_RJCT_STS_CD
      ,H.INV_NO
      ,D.LGS_COST_CD
      ,H.CURR_CD
      ,D.INV_AMT
      ,D.TML_CRR_CD
      ,D.CALC_RMK
      ,(CASE WHEN D.INV_AMT>0 THEN 'Y' ELSE 'N' END) IF_TPB_FLG   --'Y'case Only TPB I/F; Only Plus JO (with TPB I/F)
      ,D.TML_SO_OFC_CTY_CD
      ,D.TML_SO_SEQ
      ,D.TML_SO_DTL_SEQ
  FROM TES_TML_SO_HDR H
      ,TES_TML_SO_DTL D
      ,AP_INV_HDR A
 WHERE D.TML_SO_OFC_CTY_CD=H.TML_SO_OFC_CTY_CD
   AND D.TML_SO_SEQ=H.TML_SO_SEQ
   AND D.LGS_COST_CD='SVXXJO'
   AND A.CSR_NO=H.CSR_NO
   AND NVL(H.DELT_FLG,'N')='N'
  /* 화면 조건 */
   AND A.GL_DT >= TO_CHAR(TPB_GET_SRCH_DATE_FNC(@[s_sdate],'YYYY-MM-DD',@[s_ofc_cd_for_rhq]),'YYYYMMDD')
   AND A.GL_DT < TO_CHAR(TPB_GET_SRCH_DATE_FNC(@[s_edate],'YYYY-MM-DD',@[s_ofc_cd_for_rhq]) + 1,'YYYYMMDD')
   AND H.COST_OFC_CD IN (
                           SELECT OFC_CD
                             FROM TPB_HNDL_OFC
                            WHERE N3PTY_OFC_TP_CD = 'G'
                              AND DELT_FLG = 'N'
                              AND N3PTY_OFC_CD IN (
                                                     SELECT OFC_CD
                                                       FROM TPB_HNDL_OFC
                                                      WHERE DELT_FLG = 'N'
#if (${s_if_rhq_cd} != '') 
                                                        AND RHQ_CD = @[s_if_rhq_cd]
#end
#if (${s_if_ofc_cd} != '') 
                                                        AND OFC_CD = @[s_if_ofc_cd]
#end

                                                  )
                        )

#if (${s_cd_kind} == 'C' && ${s_cd_value} != '') 
   AND A.CSR_NO = @[s_cd_value]
#elseif (${s_cd_kind} == 'S' && ${s_cd_value} != '') 
   AND H.INV_NO = @[s_cd_value]
#end

--[H Inquiry case] PLUS JO (TPB Only)
UNION

SELECT H.COST_OFC_CD
      ,A.CSR_NO
      ,H.TML_INV_RJCT_STS_CD
      ,H.INV_NO
      ,D.LGS_COST_CD
      ,H.CURR_CD
      ,D.INV_AMT
      ,D.TML_CRR_CD
      ,D.CALC_RMK
      ,(CASE WHEN D.INV_AMT > 0 THEN 'Y' ELSE 'N' END) IF_TPB_FLG   --'Y'case Only TPB I/F; Only Plus JO (with TPB I/F)
      ,D.TML_SO_OFC_CTY_CD
      ,D.TML_SO_SEQ
      ,D.TML_SO_DTL_SEQ
  FROM TES_TML_SO_HDR H
      ,TES_TML_SO_DTL D
      ,AP_INV_HDR A
      ,TPB_OTS_DTL TD
 WHERE D.TML_SO_OFC_CTY_CD = H.TML_SO_OFC_CTY_CD
   AND D.TML_SO_SEQ = H.TML_SO_SEQ
   AND D.LGS_COST_CD = 'SVXXJO'
   AND A.CSR_NO = H.CSR_NO
   AND H.INV_NO = TD.N3PTY_SRC_NO
   AND NVL(H.DELT_FLG,'N')='N'
   
 /* 화면 조건 */
   AND A.GL_DT >= TO_CHAR(TPB_GET_SRCH_DATE_FNC(@[s_sdate],'YYYY-MM-DD',@[s_ofc_cd_for_rhq]),'YYYYMMDD')
   AND A.GL_DT < TO_CHAR(TPB_GET_SRCH_DATE_FNC(@[s_edate],'YYYY-MM-DD',@[s_ofc_cd_for_rhq]) + 1,'YYYYMMDD')
   AND H.COST_OFC_CD IN (
                           SELECT OFC_CD
                             FROM TPB_HNDL_OFC
                            WHERE N3PTY_OFC_TP_CD = 'G'
                              AND DELT_FLG = 'N'
                              AND N3PTY_OFC_CD IN (
                                                     SELECT OFC_CD
                                                       FROM TPB_HNDL_OFC
                                                      WHERE DELT_FLG = 'N'
#if (${s_if_rhq_cd} != '') 
                                                        AND RHQ_CD = @[s_if_rhq_cd]
#end
#if (${s_if_ofc_cd} != '') 
                                                        AND OFC_CD = @[s_if_ofc_cd]
#end

                                                  )
                        )
                        
#if (${s_cd_kind} == 'C' && ${s_cd_value} != '') 
   AND TD.CSR_NO = @[s_cd_value]
#elseif (${s_cd_kind} == 'S' && ${s_cd_value} != '') 
   AND H.INV_NO = @[s_cd_value]
#end

)

--[J Inquiry case] PLUS JO (=TES Only)
SELECT --[TES]-----------------------------------------------------------------------------------------
       TES.COST_OFC_CD
      ,TES.CSR_NO
      ,TES.TML_INV_RJCT_STS_CD
      ,TES.INV_NO
      ,TES.LGS_COST_CD
      ,TES.CURR_CD
      ,TES.INV_AMT
      ,TES.TML_CRR_CD
      ,TES.CALC_RMK
--[TPB]-----------------------------------------------------------------------------------------
      ,NULL OTS_STS_NM
      ,NULL N3PTY_NO
      ,NULL N3PTY_INV_NO
      ,NULL TRD_PARTY_CODE
      ,NULL TRD_PARTY_NAME
      ,NULL IF_CURR_CD
      ,NULL IF_AMT
      ,NULL CFM_AMT
      ,NULL INV_AMT1
      ,NULL INV_IF_DT
      ,NULL CRE_USR_ID
      ,NULL INV_IF_OFC_CD
      ,TPB_GET_RCVR_ACT_YN_FNC(NULL) AS CLT_ACT_YN
      ,NULL CXL_CSR_NO
--[AR]------------------------------------------------------------------------------------------
      ,NULL GL_EFF_DT
      ,NULL INV_ERP_IF_STS_CD
      ,NULL AR_CURR_CD
      ,NULL CHG_AMT
      ,NULL AP_AR_OFFST_NO
      ,'J'  DISPLAY_TYPE
  FROM TES
      ,TES_N3RD_PTY_IF T
 WHERE TES.IF_TPB_FLG='Y'
/*TPB 조건 */
   AND T.TML_SO_OFC_CTY_CD = TES.TML_SO_OFC_CTY_CD
   AND T.TML_SO_SEQ = TES.TML_SO_SEQ
   AND T.TML_SO_DTL_SEQ = TES.TML_SO_DTL_SEQ
   AND NOT EXISTS (
                     SELECT 'X' 
                       FROM TPB_OTS_DTL OTPB
                      WHERE OTPB.CSR_NO = T.CSR_NO
                        AND OTPB.IF_OFC_CD = T.TML_IF_OFC_CD
                        AND OTPB.SRC_IF_SEQ_NO = T.TML_IF_SEQ
                        AND OTPB.N3PTY_BIL_TP_CD = 'JO'
                  )
                  
UNION

--[I Inquiry case New CSR NOT Interfaced] = [H Inquiry case](=New CSR TES Only)  (+)  [TPB(+) + INV(+)](=Old CSR TPB Only)
SELECT --[TES]-----------------------------------------------------------------------------------------
       TES.COST_OFC_CD
      ,TES.CSR_NO
      ,TES.TML_INV_RJCT_STS_CD
      ,TES.INV_NO
      ,TES.LGS_COST_CD
      ,TES.CURR_CD
      ,TES.INV_AMT
      ,TES.TML_CRR_CD
      ,TES.CALC_RMK
--[TPB]-----------------------------------------------------------------------------------------
      ,COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00588', NVL(OTPC.OTS_STS_CD,'Z'))
      	AS OTS_STS_NM
      ,CTPB.N3PTY_NO
      ,OTPG.N3PTY_INV_NO
      ,CASE CTPB.VNDR_CUST_DIV_CD WHEN 'V' THEN LPAD(TO_CHAR(CTPB.VNDR_SEQ), 6, '0') WHEN 'C' THEN CTPB.CUST_CNT_CD||LPAD(CTPB.CUST_SEQ, 6, '0') WHEN 'S' THEN CTPB.N3PTY_OFC_CD END AS TRD_PARTY_CODE
      ,CASE CTPB.VNDR_CUST_DIV_CD WHEN 'V' THEN CTPB.VNDR_LGL_ENG_NM WHEN 'C' THEN CTPB.CUST_LGL_ENG_NM WHEN 'S' THEN CTPB.N3PTY_OFC_CD END AS TRD_PARTY_NAME
      ,CTPB.IF_CURR_CD
      ,CTPB.IF_AMT
      ,CTPB.CFM_AMT
      ,CTPB.INV_AMT  AS INV_AMT1
      ,OTPS.INV_IF_DT
      ,OTPS.CRE_USR_ID
      ,OTPS.INV_IF_OFC_CD
      ,TPB_GET_RCVR_ACT_YN_FNC(CTPB.N3PTY_NO) AS CLT_ACT_YN
      ,CTPB.CSR_NO CXL_CSR_NO
--[AR]------------------------------------------------------------------------------------------
      ,NULL GL_EFF_DT
      ,NULL INV_ERP_IF_STS_CD
      ,NULL AR_CURR_CD
      ,NULL CHG_AMT
      ,NULL AP_AR_OFFST_NO
      ,'I'  DISPLAY_TYPE
  FROM TES
      ,TPB_OTS_DTL CTPB
      ,TPB_OTS_GRP OTPG
      ,TPB_OTS_GRP_STS OTPC
      ,TPB_INV_IF_SMRY OTPS
 WHERE CTPB.N3PTY_SRC_NO = TES.INV_NO
   AND CTPB.CSR_NO <> TES.CSR_NO
   AND CTPB.N3PTY_BIL_TP_CD = 'JO'
   AND NOT EXISTS (
                     SELECT 'X'
                       FROM TPB_OTS_DTL D
                      WHERE D.CSR_NO = TES.CSR_NO
                  )
   AND OTPG.N3PTY_NO(+) = CTPB.N3PTY_NO
   AND OTPC.N3PTY_NO(+) = OTPG.N3PTY_NO
   AND OTPC.OTS_STS_LST_FLG(+) = 'Y'
   AND OTPG.N3PTY_INV_NO(+) IS NOT NULL
   AND OTPS.IF_BL_NO(+) = OTPG.N3PTY_INV_NO

UNION

--[G Inquiry case] MINUS JO
SELECT --[TES]-----------------------------------------------------------------------------------------
       TES.COST_OFC_CD
      ,TES.CSR_NO 
      ,TES.TML_INV_RJCT_STS_CD 
      ,TES.INV_NO 
      ,TES.LGS_COST_CD 
      ,TES.CURR_CD 
      ,TES.INV_AMT 
      ,TES.TML_CRR_CD 
      ,TES.CALC_RMK
      --[TPB]-----------------------------------------------------------------------------------------
      ,NULL OTS_STS_NM
      ,NULL N3PTY_NO 
      ,NULL N3PTY_INV_NO 
      ,NULL TRD_PARTY_CODE 
      ,NULL TRD_PARTY_NAME 
      ,NULL IF_CURR_CD 
      ,NULL IF_AMT 
      ,NULL CFM_AMT 
      ,NULL INV_AMT1
      ,NULL INV_IF_DT 
      ,NULL CRE_USR_ID 
      ,NULL INV_IF_OFC_CD       
      ,NULL CLT_ACT_YN   
      ,NULL CXL_CSR_NO
      --[AR]------------------------------------------------------------------------------------------
      ,NULL GL_EFF_DT 
      ,NULL INV_ERP_IF_STS_CD 
      ,NULL AR_CURR_CD 
      ,NULL CHG_AMT 
      ,NULL AP_AR_OFFST_NO        
      ,'G' DISPLAY_TYPE
  FROM TES
 WHERE TES.IF_TPB_FLG = 'N'
#if ((${s_cd_kind} == 'T' || ${s_cd_kind} == 'I') && ${s_cd_value} != '') 
   AND 1 = 0
#end

UNION 

--[F Inquiry case] PLUS JO + CANDIDATE TPB
SELECT --[TES]-----------------------------------------------------------------------------------------
       TES.COST_OFC_CD
      ,TES.CSR_NO 
      ,TES.TML_INV_RJCT_STS_CD 
      ,TES.INV_NO 
      ,TES.LGS_COST_CD 
      ,TES.CURR_CD 
      ,TES.INV_AMT 
      ,TES.TML_CRR_CD 
      ,TES.CALC_RMK
      --[TPB]-----------------------------------------------------------------------------------------
      --,NULL OTS_STS_NM
      ,COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00588','Z') OTS_STS_NM
      ,OTPB.N3PTY_NO 
      ,NULL N3PTY_INV_NO 
      ,CASE OTPB.VNDR_CUST_DIV_CD WHEN 'V' THEN LPAD(TO_CHAR(OTPB.VNDR_SEQ), 6, '0') WHEN 'C' THEN OTPB.CUST_CNT_CD||LPAD(OTPB.CUST_SEQ, 6, '0') WHEN 'S' THEN OTPB.N3PTY_OFC_CD END AS TRD_PARTY_CODE 
      ,CASE OTPB.VNDR_CUST_DIV_CD WHEN 'V' THEN OTPB.VNDR_LGL_ENG_NM WHEN 'C' THEN OTPB.CUST_LGL_ENG_NM WHEN 'S' THEN OTPB.N3PTY_OFC_CD END AS TRD_PARTY_NAME 
      ,OTPB.IF_CURR_CD 
      ,OTPB.IF_AMT 
      ,OTPB.CFM_AMT 
      ,OTPB.INV_AMT  AS INV_AMT1
      ,NULL INV_IF_DT 
      ,NULL CRE_USR_ID 
      ,NULL INV_IF_OFC_CD       
      ,TPB_GET_RCVR_ACT_YN_FNC(OTPB.N3PTY_NO) AS CLT_ACT_YN   
      ,NULL CXL_CSR_NO
      --[AR]------------------------------------------------------------------------------------------
      ,NULL GL_EFF_DT 
      ,NULL INV_ERP_IF_STS_CD 
      ,NULL AR_CURR_CD
      ,NULL CHG_AMT 
      ,NULL AP_AR_OFFST_NO 
      ,'F'  DISPLAY_TYPE           
  FROM TES
      ,TES_N3RD_PTY_IF T
      ,TPB_OTS_DTL OTPB 
 WHERE TES.IF_TPB_FLG = 'Y'
/*TPB 조건 */
   AND T.TML_SO_OFC_CTY_CD = TES.TML_SO_OFC_CTY_CD
   AND T.TML_SO_SEQ = TES.TML_SO_SEQ
   AND T.TML_SO_DTL_SEQ = TES.TML_SO_DTL_SEQ
   AND OTPB.CSR_NO = T.CSR_NO
   AND OTPB.IF_OFC_CD = T.TML_IF_OFC_CD
   AND OTPB.SRC_IF_SEQ_NO = T.TML_IF_SEQ
   AND OTPB.N3PTY_BIL_TP_CD = 'JO'
   AND OTPB.N3PTY_NO IS NULL
#if ((${s_cd_kind} == 'T' || ${s_cd_kind} == 'I') && ${s_cd_value} != '') 
   AND 1 = 0
#end

UNION 

--[E Inquiry case] PLUS JO + TPB + NON-INV
SELECT --[TES]-----------------------------------------------------------------------------------------
       TES.COST_OFC_CD
      ,TES.CSR_NO 
      ,TES.TML_INV_RJCT_STS_CD 
      ,TES.INV_NO 
      ,TES.LGS_COST_CD 
      ,TES.CURR_CD 
      ,TES.INV_AMT 
      ,TES.TML_CRR_CD 
      ,TES.CALC_RMK
      --[TPB]-----------------------------------------------------------------------------------------
      ,COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00588', OTPC.OTS_STS_CD) AS OTS_STS_NM
      ,OTPB.N3PTY_NO 
      ,OTPG.N3PTY_INV_NO 
      ,CASE OTPB.VNDR_CUST_DIV_CD WHEN 'V' THEN LPAD(TO_CHAR(OTPB.VNDR_SEQ), 6, '0') WHEN 'C' THEN OTPB.CUST_CNT_CD||LPAD(OTPB.CUST_SEQ, 6, '0') WHEN 'S' THEN OTPB.N3PTY_OFC_CD END AS TRD_PARTY_CODE 
      ,CASE OTPB.VNDR_CUST_DIV_CD WHEN 'V' THEN OTPB.VNDR_LGL_ENG_NM WHEN 'C' THEN OTPB.CUST_LGL_ENG_NM WHEN 'S' THEN OTPB.N3PTY_OFC_CD END AS TRD_PARTY_NAME 
      ,OTPB.IF_CURR_CD 
      ,OTPB.IF_AMT 
      ,OTPB.CFM_AMT 
      ,OTPB.INV_AMT  AS INV_AMT1
      ,NULL INV_IF_DT 
      ,NULL CRE_USR_ID 
      ,NULL INV_IF_OFC_CD       
      ,TPB_GET_RCVR_ACT_YN_FNC(OTPB.N3PTY_NO) AS CLT_ACT_YN   
      ,NULL CXL_CSR_NO
      --[AR]------------------------------------------------------------------------------------------
      ,NULL GL_EFF_DT 
      ,NULL INV_ERP_IF_STS_CD 
      ,NULL AR_CURR_CD
      ,NULL CHG_AMT 
      ,NULL AP_AR_OFFST_NO          
      ,'E'  DISPLAY_TYPE
  FROM TES
      ,TES_N3RD_PTY_IF T
      ,TPB_OTS_DTL OTPB 
      ,TPB_OTS_GRP OTPG 
      ,TPB_OTS_GRP_STS OTPC 
 WHERE TES.IF_TPB_FLG='Y'
/*TPB 조건 */
   AND T.TML_SO_OFC_CTY_CD = TES.TML_SO_OFC_CTY_CD
   AND T.TML_SO_SEQ = TES.TML_SO_SEQ
   AND T.TML_SO_DTL_SEQ = TES.TML_SO_DTL_SEQ
   AND OTPB.CSR_NO = T.CSR_NO
   AND OTPB.IF_OFC_CD = T.TML_IF_OFC_CD
   AND OTPB.SRC_IF_SEQ_NO = T.TML_IF_SEQ
   AND OTPB.N3PTY_BIL_TP_CD = 'JO'
   AND OTPB.N3PTY_NO IS NOT NULL
   AND OTPG.N3PTY_NO = OTPB.N3PTY_NO
   AND OTPC.N3PTY_NO = OTPG.N3PTY_NO
   AND OTPC.OTS_STS_LST_FLG = 'Y'
   AND OTPG.N3PTY_INV_NO IS NULL
/* 화면 조건 */
#if (${s_cd_kind} == 'T' && ${s_cd_value} != '') 
   AND OTPB.N3PTY_NO = @[s_cd_value]
#elseif (${s_cd_kind} == 'I' && ${s_cd_value} != '') 
   AND 1 = 0
#end

 UNION

--[D Inquiry case] PLUS JO + TPB + INV
SELECT --[TES]-----------------------------------------------------------------------------------------
       TES.COST_OFC_CD
      ,TES.CSR_NO 
      ,TES.TML_INV_RJCT_STS_CD 
      ,TES.INV_NO 
      ,TES.LGS_COST_CD 
      ,TES.CURR_CD 
      ,TES.INV_AMT 
      ,TES.TML_CRR_CD 
      ,TES.CALC_RMK
      --[TPB]-----------------------------------------------------------------------------------------
      ,COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00588', OTPC.OTS_STS_CD) AS OTS_STS_NM
      ,OTPB.N3PTY_NO 
      ,OTPG.N3PTY_INV_NO 
      ,CASE OTPB.VNDR_CUST_DIV_CD WHEN 'V' THEN LPAD(TO_CHAR(OTPB.VNDR_SEQ), 6, '0') WHEN 'C' THEN OTPB.CUST_CNT_CD||LPAD(OTPB.CUST_SEQ, 6, '0') WHEN 'S' THEN OTPB.N3PTY_OFC_CD END AS TRD_PARTY_CODE 
      ,CASE OTPB.VNDR_CUST_DIV_CD WHEN 'V' THEN OTPB.VNDR_LGL_ENG_NM WHEN 'C' THEN OTPB.CUST_LGL_ENG_NM WHEN 'S' THEN OTPB.N3PTY_OFC_CD END AS TRD_PARTY_NAME 
      ,OTPB.IF_CURR_CD 
      ,OTPB.IF_AMT 
      ,OTPB.CFM_AMT 
      ,OTPB.INV_AMT AS INV_AMT1
      ,OTPS.INV_IF_DT 
      ,OTPS.CRE_USR_ID 
      ,OTPS.INV_IF_OFC_CD       
      ,TPB_GET_RCVR_ACT_YN_FNC(OTPB.N3PTY_NO) AS CLT_ACT_YN   
      ,NULL CXL_CSR_NO
      --[AR]------------------------------------------------------------------------------------------
      ,BB.GL_EFF_DT 
      ,DD.INV_ERP_IF_STS_CD 
      ,CC.CURR_CD AS AR_CURR_CD
      ,CC.CHG_AMT   
      ,BB.AP_AR_OFFST_NO                 
      ,'D' DISPLAY_TYPE
  FROM TES
      ,TES_N3RD_PTY_IF T
      ,TPB_OTS_DTL OTPB 
      ,TPB_OTS_GRP OTPG 
      ,TPB_OTS_GRP_STS OTPC 
      ,TPB_INV_IF_SMRY OTPS
      ,INV_AR_IF_MN AA
      ,INV_AR_MN BB
      ,INV_AR_CHG CC
      ,INV_AR_AMT DD
      ,INV_AR_IF_CHG EE 
 WHERE TES.IF_TPB_FLG = 'Y'
   AND T.TML_SO_OFC_CTY_CD = TES.TML_SO_OFC_CTY_CD
   AND T.TML_SO_SEQ = TES.TML_SO_SEQ
   AND T.TML_SO_DTL_SEQ = TES.TML_SO_DTL_SEQ
   AND OTPB.CSR_NO = T.CSR_NO
   AND OTPB.IF_OFC_CD = T.TML_IF_OFC_CD
   AND OTPB.SRC_IF_SEQ_NO = T.TML_IF_SEQ
   AND OTPB.N3PTY_BIL_TP_CD = 'JO'
   AND OTPB.N3PTY_NO IS NOT NULL
   AND OTPG.N3PTY_NO = OTPB.N3PTY_NO
   AND OTPC.N3PTY_NO = OTPG.N3PTY_NO
   AND OTPC.OTS_STS_LST_FLG = 'Y'
   AND OTPG.N3PTY_INV_NO IS NOT NULL
   AND OTPS.IF_BL_NO = OTPG.N3PTY_INV_NO 
/* 화면 조건 */
#if (${s_cd_kind} == 'T' && ${s_cd_value} != '') 
   AND OTPB.N3PTY_NO = @[s_cd_value]
#elseif (${s_cd_kind} == 'I' && ${s_cd_value} != '') 
   AND OTPG.N3PTY_INV_NO = @[s_cd_value]
#end
/*AR 조건 */
   AND AA.IF_SRC_CD = 'TPB'
   AND AA.BL_SRC_NO = OTPS.IF_BL_NO
   AND AA.INV_SRC_NO = OTPS.N3PTY_INV_NO
   AND BB.AR_IF_NO = AA.AR_IF_NO
   AND CC.AR_IF_NO = BB.AR_IF_NO
   AND DD.AR_IF_NO = BB.AR_IF_NO
   AND EE.SRC_IF_DT = AA.SRC_IF_DT
   AND EE.SRC_IF_SEQ = AA.SRC_IF_SEQ
   AND CC.CHG_SEQ = EE.CHG_SEQ
   AND CC.AR_IF_SER_NO = DD.AR_IF_SER_NO
   AND CC.CHG_AMT = OTPB.IF_AMT
  
 UNION 


--[C Inquiry case] PLUS JO + TPB + INV
SELECT --[TES]-----------------------------------------------------------------------------------------
       TES.COST_OFC_CD
      ,TES.CSR_NO 
      ,TES.TML_INV_RJCT_STS_CD 
      ,TES.INV_NO 
      ,TES.LGS_COST_CD 
      ,NULL CURR_CD
      ,NULL INV_AMT
      ,NULL TML_CRR_CD 
      ,NULL CALC_RMK
      --[TPB]-----------------------------------------------------------------------------------------
      ,COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00588', OTPC.OTS_STS_CD) AS OTS_STS_NM
      ,CTPB.N3PTY_NO 
      ,OTPG.N3PTY_INV_NO 
      ,CASE CTPB.VNDR_CUST_DIV_CD WHEN 'V' THEN LPAD(TO_CHAR(CTPB.VNDR_SEQ), 6, '0') WHEN 'C' THEN CTPB.CUST_CNT_CD||LPAD(CTPB.CUST_SEQ, 6, '0') WHEN 'S' THEN CTPB.N3PTY_OFC_CD END AS TRD_PARTY_CODE 
      ,CASE CTPB.VNDR_CUST_DIV_CD WHEN 'V' THEN CTPB.VNDR_LGL_ENG_NM WHEN 'C' THEN CTPB.CUST_LGL_ENG_NM WHEN 'S' THEN CTPB.N3PTY_OFC_CD END AS TRD_PARTY_NAME 
      ,CTPB.IF_CURR_CD 
      ,CTPB.IF_AMT 
      ,CTPB.CFM_AMT 
      ,CTPB.INV_AMT  AS INV_AMT1
      ,OTPS.INV_IF_DT 
      ,OTPS.CRE_USR_ID 
      ,OTPS.INV_IF_OFC_CD       
      ,TPB_GET_RCVR_ACT_YN_FNC(CTPB.N3PTY_NO) AS CLT_ACT_YN   
      ,CTPB.CSR_NO CXL_CSR_NO
      --[AR]------------------------------------------------------------------------------------------
      ,BB.GL_EFF_DT 
      ,DD.INV_ERP_IF_STS_CD 
      ,CC.CURR_CD AS AR_CURR_CD
      ,CC.CHG_AMT 
      ,BB.AP_AR_OFFST_NO          
      ,'C'  DISPLAY_TYPE       
  FROM TES
      ,TES_N3RD_PTY_IF T
      ,TPB_OTS_DTL OTPB 
      ,TPB_OTS_DTL CTPB 
      ,TPB_OTS_GRP OTPG 
      ,TPB_OTS_GRP_STS OTPC 
      ,TPB_INV_IF_SMRY OTPS
      ,INV_AR_IF_MN AA
      ,INV_AR_MN BB
      ,INV_AR_CHG CC
      ,INV_AR_AMT DD
      ,INV_AR_IF_CHG EE 
 WHERE TES.IF_TPB_FLG = 'Y'
   AND T.TML_SO_OFC_CTY_CD = TES.TML_SO_OFC_CTY_CD
   AND T.TML_SO_SEQ = TES.TML_SO_SEQ
   AND T.TML_SO_DTL_SEQ = TES.TML_SO_DTL_SEQ
   AND OTPB.CSR_NO = T.CSR_NO
   AND OTPB.IF_OFC_CD = T.TML_IF_OFC_CD
   AND OTPB.SRC_IF_SEQ_NO = T.TML_IF_SEQ
   AND OTPB.N3PTY_BIL_TP_CD = 'JO'
   AND OTPB.OTS_DTL_SEQ IN (
                              SELECT MIN(OTS_DTL_SEQ)
                                FROM TPB_OTS_DTL O
                               WHERE O.CSR_NO=T.CSR_NO
                            GROUP BY N3PTY_SRC_NO
                           )
   AND CTPB.N3PTY_SRC_NO = OTPB.N3PTY_SRC_NO
   AND CTPB.CSR_NO <> OTPB.CSR_NO
   AND CTPB.N3PTY_BIL_TP_CD = 'JO'
   AND CTPB.N3PTY_NO IS NOT NULL
   AND OTPG.N3PTY_NO = CTPB.N3PTY_NO
   AND OTPC.N3PTY_NO = OTPG.N3PTY_NO
   AND OTPC.OTS_STS_LST_FLG = 'Y'
   AND OTPG.N3PTY_INV_NO IS NOT NULL
   AND OTPS.IF_BL_NO = OTPG.N3PTY_INV_NO 
/* 화면 조건 */
#if (${s_cd_kind} == 'T' && ${s_cd_value} != '') 
   AND CTPB.N3PTY_NO = @[s_cd_value]
#elseif (${s_cd_kind} == 'I' && ${s_cd_value} != '') 
   AND OTPG.N3PTY_INV_NO = @[s_cd_value]
#end
/*AR 조건 */
   AND AA.IF_SRC_CD = 'TPB'
   AND AA.BL_SRC_NO = OTPS.IF_BL_NO
   AND AA.INV_SRC_NO = OTPS.N3PTY_INV_NO
   AND BB.AR_IF_NO = AA.AR_IF_NO
   AND CC.AR_IF_NO = BB.AR_IF_NO
   AND DD.AR_IF_NO = BB.AR_IF_NO
   AND EE.SRC_IF_DT = AA.SRC_IF_DT
   AND EE.SRC_IF_SEQ = AA.SRC_IF_SEQ
   AND CC.CHG_SEQ = EE.CHG_SEQ
   AND CC.AR_IF_SER_NO = DD.AR_IF_SER_NO
   AND CC.CHG_AMT = CTPB.IF_AMT
  
  
 UNION

--[B Inquiry case] PLUS JO + TPB + NON-INV
SELECT --[TES]-----------------------------------------------------------------------------------------
       TES.COST_OFC_CD
      ,TES.CSR_NO 
      ,TES.TML_INV_RJCT_STS_CD 
      ,TES.INV_NO 
      ,TES.LGS_COST_CD 
      ,NULL CURR_CD
      ,NULL INV_AMT
      ,NULL TML_CRR_CD 
      ,NULL CALC_RMK
      --[TPB]-----------------------------------------------------------------------------------------
      ,COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00588', OTPC.OTS_STS_CD) AS OTS_STS_NM
      ,CTPB.N3PTY_NO 
      ,OTPG.N3PTY_INV_NO 
      ,CASE CTPB.VNDR_CUST_DIV_CD WHEN 'V' THEN LPAD(TO_CHAR(CTPB.VNDR_SEQ), 6, '0') WHEN 'C' THEN CTPB.CUST_CNT_CD||LPAD(CTPB.CUST_SEQ, 6, '0') WHEN 'S' THEN CTPB.N3PTY_OFC_CD END AS TRD_PARTY_CODE 
      ,CASE CTPB.VNDR_CUST_DIV_CD WHEN 'V' THEN CTPB.VNDR_LGL_ENG_NM WHEN 'C' THEN CTPB.CUST_LGL_ENG_NM WHEN 'S' THEN CTPB.N3PTY_OFC_CD END AS TRD_PARTY_NAME 
      ,CTPB.IF_CURR_CD 
      ,CTPB.IF_AMT 
      ,CTPB.CFM_AMT 
      ,CTPB.INV_AMT AS INV_AMT1
      ,NULL INV_IF_DT 
      ,NULL CRE_USR_ID 
      ,NULL INV_IF_OFC_CD       
      ,TPB_GET_RCVR_ACT_YN_FNC(CTPB.N3PTY_NO) AS CLT_ACT_YN   
      ,CTPB.CSR_NO CXL_CSR_NO
      --[AR]------------------------------------------------------------------------------------------
      ,NULL GL_EFF_DT 
      ,NULL INV_ERP_IF_STS_CD 
      ,NULL AR_CURR_CD
      ,NULL CHG_AMT 
      ,NULL AP_AR_OFFST_NO      
      ,'B'  DISPLAY_TYPE           
  FROM TES
      ,TES_N3RD_PTY_IF T
      ,TPB_OTS_DTL OTPB 
      ,TPB_OTS_DTL CTPB 
      ,TPB_OTS_GRP OTPG 
      ,TPB_OTS_GRP_STS OTPC 
 WHERE TES.IF_TPB_FLG = 'Y'
   AND T.TML_SO_OFC_CTY_CD = TES.TML_SO_OFC_CTY_CD
   AND T.TML_SO_SEQ = TES.TML_SO_SEQ
   AND T.TML_SO_DTL_SEQ = TES.TML_SO_DTL_SEQ
   AND OTPB.CSR_NO = T.CSR_NO
   AND OTPB.IF_OFC_CD = T.TML_IF_OFC_CD
   AND OTPB.SRC_IF_SEQ_NO = T.TML_IF_SEQ
   AND OTPB.N3PTY_BIL_TP_CD = 'JO'
   AND OTPB.OTS_DTL_SEQ IN (
                              SELECT MIN(OTS_DTL_SEQ)
                                FROM TPB_OTS_DTL O
                               WHERE O.CSR_NO=T.CSR_NO
                            GROUP BY N3PTY_SRC_NO
                           )
   AND CTPB.N3PTY_SRC_NO = OTPB.N3PTY_SRC_NO
   AND CTPB.CSR_NO <> OTPB.CSR_NO
   AND CTPB.N3PTY_BIL_TP_CD = 'JO'
   AND CTPB.N3PTY_NO IS NOT NULL
   AND OTPG.N3PTY_NO = CTPB.N3PTY_NO
   AND OTPC.N3PTY_NO = OTPG.N3PTY_NO
   AND OTPC.OTS_STS_LST_FLG = 'Y'
   AND OTPG.N3PTY_INV_NO IS NULL
/* 화면 조건 */
#if (${s_cd_kind} == 'T' && ${s_cd_value} != '') 
   AND CTPB.N3PTY_NO = @[s_cd_value]
#elseif (${s_cd_kind} == 'I' && ${s_cd_value} != '') 
   AND 1 = 0
#end


  
 UNION

--[A Inquiry case] PLUS JO + CANDIDATE TPB
SELECT --[TES]-----------------------------------------------------------------------------------------
       TES.COST_OFC_CD
      ,TES.CSR_NO 
      ,TES.TML_INV_RJCT_STS_CD 
      ,TES.INV_NO 
      ,TES.LGS_COST_CD 
      ,NULL CURR_CD
      ,NULL INV_AMT
      ,NULL TML_CRR_CD 
      ,NULL CALC_RMK
      --[TPB]-----------------------------------------------------------------------------------------
      --,NULL OTS_STS_NM
      ,COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00588','Z') OTS_STS_NM
      ,CTPB.N3PTY_NO 
      ,NULL N3PTY_INV_NO 
      ,CASE CTPB.VNDR_CUST_DIV_CD WHEN 'V' THEN LPAD(TO_CHAR(CTPB.VNDR_SEQ), 6, '0') WHEN 'C' THEN CTPB.CUST_CNT_CD||LPAD(CTPB.CUST_SEQ, 6, '0') WHEN 'S' THEN CTPB.N3PTY_OFC_CD END AS TRD_PARTY_CODE 
      ,CASE CTPB.VNDR_CUST_DIV_CD WHEN 'V' THEN CTPB.VNDR_LGL_ENG_NM WHEN 'C' THEN CTPB.CUST_LGL_ENG_NM WHEN 'S' THEN CTPB.N3PTY_OFC_CD END AS TRD_PARTY_NAME 
      ,CTPB.IF_CURR_CD 
      ,CTPB.IF_AMT 
      ,CTPB.CFM_AMT 
      ,CTPB.INV_AMT AS INV_AMT1
      ,NULL INV_IF_DT 
      ,NULL CRE_USR_ID 
      ,NULL INV_IF_OFC_CD       
      ,TPB_GET_RCVR_ACT_YN_FNC(CTPB.N3PTY_NO) AS CLT_ACT_YN   
      ,CTPB.CSR_NO CXL_CSR_NO
      --[AR]------------------------------------------------------------------------------------------
      ,NULL GL_EFF_DT 
      ,NULL INV_ERP_IF_STS_CD 
      ,NULL AS AR_CURR_CD
      ,NULL CHG_AMT 
      ,NULL AP_AR_OFFST_NO        
      ,'A'  DISPLAY_TYPE         
  FROM TES
      ,TES_N3RD_PTY_IF T
      ,TPB_OTS_DTL OTPB 
      ,TPB_OTS_DTL CTPB 
 WHERE TES.IF_TPB_FLG = 'Y'
   AND T.TML_SO_OFC_CTY_CD = TES.TML_SO_OFC_CTY_CD
   AND T.TML_SO_SEQ = TES.TML_SO_SEQ
   AND T.TML_SO_DTL_SEQ = TES.TML_SO_DTL_SEQ
   AND OTPB.CSR_NO = T.CSR_NO
   AND OTPB.IF_OFC_CD = T.TML_IF_OFC_CD
   AND OTPB.SRC_IF_SEQ_NO = T.TML_IF_SEQ
   AND OTPB.N3PTY_BIL_TP_CD = 'JO'
   AND OTPB.OTS_DTL_SEQ IN (
                              SELECT MIN(OTS_DTL_SEQ)
                                FROM TPB_OTS_DTL O
                               WHERE O.CSR_NO=T.CSR_NO
                            GROUP BY N3PTY_SRC_NO
                           )
   AND CTPB.N3PTY_SRC_NO = OTPB.N3PTY_SRC_NO
   AND CTPB.CSR_NO <> OTPB.CSR_NO
   AND CTPB.N3PTY_BIL_TP_CD = 'JO'
   AND CTPB.N3PTY_NO IS NULL
/* 화면 조건 */
#if ((${s_cd_kind} == 'T' || ${s_cd_kind} == 'I') && ${s_cd_value} != '') 
   AND 1 = 0
#end			]]></sql>
			<params>
				<param name="s_sdate" type="12" value="20090101" out="N"/>
				<param name="s_ofc_cd_for_rhq" type="12" value="" out="N"/>
				<param name="s_edate" type="12" value="20100101" out="N"/>
				<param name="s_if_rhq_cd" type="12" value="" out="N"/>
				<param name="s_if_ofc_cd" type="12" value="BKKBB" out="N"/>
				<param name="s_cd_value" type="12" value="abcd" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
