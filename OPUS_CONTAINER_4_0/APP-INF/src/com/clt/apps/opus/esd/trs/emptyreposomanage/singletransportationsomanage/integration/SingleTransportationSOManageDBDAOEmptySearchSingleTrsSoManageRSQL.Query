<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SingleTransportationSOManageDBDAOEmptySearchSingleTrsSoManageRSQL">
			<desc><![CDATA[Empty Repo S/O 조회 대상 그룹을 조회한다.]]></desc>
			<sql><![CDATA[
SELECT 
	A.SO_IF_DIV_CD TRSP_COST_DTL_MOD_CD, 
	DECODE(A.SO_IF_DIV_CD, 'O', 'On-Hire', 'F', 'Off-Hire', 'Empty Repo') TRSP_COST_DTL_MOD_NAME, 
	A.REF_ID,
    A.BKG_NO,
	COUNT(A.REF_ID)  ALLOCATED,  
	SUM( DECODE( SO.TRSP_SO_STS_CD ,'C',1,'R',1,0 )) CRET_QTY, 
	COUNT(SO.TRSP_WO_SEQ ) WO_QTY, 
	SUM( DECODE(SO.TRSP_SO_SEQ , NULL , 1, 0 )) REMAING_QTY, 
	A.TRSP_MOD_CD TRSP_CRR_MOD_CD, 
	DECODE(A.TRSP_MOD_CD, 'W', 'WD', 'T', 'TD', 'R', 'RD', '') TRSP_CRR_MOD_NAME, 
	A.FM_YD_CD FM_NOD_CD, 
	A.TO_YD_CD TO_NOD_CD, 
	A.CNTR_TPSZ_CD EQ_TPSZ_CD, 
	A.SO_RQST_DT REQUESTED_DATE 
FROM EQR_REPO_EXE_SO_IF A, 
     TRS_TRSP_SVC_ORD SO, 
     MDM_LOCATION LOC   
WHERE 
    A.REPO_PLN_ID = SO.REPO_PLN_ID(+)	
AND A.PLN_YRWK = SO.PLN_YRWK(+) 	
AND A.REF_ID = SO.REF_ID(+) 		
AND A.REF_SEQ = SO.REF_SEQ(+) 		
AND LOC.LOC_CD = SUBSTR(A.FM_YD_CD, 1, 5)  
AND A.TRSP_MOD_CD IN ('T', 'R', 'W')
AND A.WO_RQST_FLG = 'Y'  
AND A.CO_CD = 'H'  
AND NVL(SO.DELT_FLG(+),'N')  <>'Y'
AND NOT EXISTS (SELECT 1 FROM MDM_COUNTRY CNTY WHERE CNTY.CNT_CD IN('US', 'CA') AND A.TRSP_MOD_CD = 'R' AND LOC.CONTI_CD = 'M' AND LOC.CNT_CD = CNTY.CNT_CD)
#if( !(${hid_frmreqdate} == '') && !(${hid_toreqdate} == '') )
AND A.SO_RQST_DT BETWEEN '${hid_frmreqdate}' AND '${hid_toreqdate}'
#end
#if($arr_ref.size() > 0) 
AND A.REF_ID IN (
	#foreach( ${key} in ${arr_ref}) 
			#if($velocityCount == 1)
		    '${key}'	
			#else 
		    , '${key}'
			#end 
	#end 
			)
#end
#if($arr_cntr.size() > 0) 
AND A.CNTR_NO IN (
	#foreach( ${key} in ${arr_cntr}) 
			#if($velocityCount == 1)
		    '${key}'	
			#else 
		    , '${key}'
			#end 
	#end 
			)
#end
#if($arr_bkg.size() > 0) 
AND A.BKG_NO IN (
	#foreach( ${key} in ${arr_bkg}) 
			#if($velocityCount == 1)
		    '${key}'	
			#else 
		    , '${key}'
			#end 
	#end 
			)
#end
#if($arr_office.size() > 0) 
AND A.EQ_CTRL_OFC_CD IN (
	#foreach( ${key} in ${arr_office}) 
			#if($velocityCount == 1)
		    UPPER('${key}')	
			#else 
		    , UPPER('${key}')
			#end 
	#end 
			)
#end
#if( !(${sel_kind} == 'ALL') )
	#if( ${sel_kind} == 'ER' )
AND A.SO_IF_DIV_CD NOT IN ('F', 'O')  -- M:Empty Repo, O:On-Hire, F:Off-Hire
	#elseif( ${sel_kind} == 'CN' )
AND A.SO_IF_DIV_CD = 'O'			--M:Empty Repo, O:On-Hire, F:Off-Hire
	#elseif( ${sel_kind} == 'CF' )
AND A.SO_IF_DIV_CD = 'F'
	#end
#end
#if( !(${frm_node} == '') )
AND A.FM_YD_CD LIKE '${frm_node}'||'%'
#end
-- Multi From Node로 조회
#if ($arr_fmnode.size() > 0) 
    AND A.FM_YD_CD in (
    #foreach( ${key} in ${arr_fmnode}) 
	    #if($velocityCount < $arr_fmnode.size()) 
	        '$key', 
	    #else 
            '$key' 
	    #end 
    #end
    )
#end
#if( !(${to_node} == '') )
AND A.TO_YD_CD LIKE '${to_node}'||'%'
#end
-- Multi To Node로 조회
#if ($arr_tonode.size() > 0) 
    AND A.TO_YD_CD in (
    #foreach( ${key} in ${arr_tonode}) 
	    #if($velocityCount < $arr_tonode.size()) 
	        '$key', 
	    #else 
            '$key' 
	    #end 
    #end
    )
#end
#if( !(${cntr_type} == 'ALL') )
AND SUBSTR(A.CNTR_TPSZ_CD, 1, 1) = '${cntr_type}'
#end
#if( !(${cntr_size} == 'ALL') )
AND SUBSTR(A.CNTR_TPSZ_CD, 2, 1) = '${cntr_size}'
#end

GROUP BY A.SO_IF_DIV_CD, A.REF_ID, A.BKG_NO,
	A.TRSP_MOD_CD, A.TRSP_MOD_CD, A.FM_YD_CD, A.TO_YD_CD, 
	A.CNTR_TPSZ_CD, A.SO_RQST_DT 
HAVING  SUM( DECODE(SO.TRSP_SO_SEQ , NULL , 1, 0 ))  <> 0	
ORDER BY A.SO_IF_DIV_CD, A.SO_RQST_DT, A.REF_ID, A.CNTR_TPSZ_CD			]]></sql>
			<params>
			</params>
		</query>
	</querys>
</sqls>
