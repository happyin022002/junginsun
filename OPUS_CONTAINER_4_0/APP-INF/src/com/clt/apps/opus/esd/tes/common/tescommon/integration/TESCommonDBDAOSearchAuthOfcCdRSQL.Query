<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TESCommonDBDAOSearchAuthOfcCdRSQL">
			<desc><![CDATA[SearchAuthOfcCd]]></desc>
			<sql><![CDATA[
SELECT
        --act_tp ACT_TP,
        --B.OFC_CD,
        --B.OFC_TP_CD,
        -- B.AR_HD_QTR_OFC_CD,
        --DECODE(C.CNT_CD,'HQ','KR',C.CNT_CD) CNT_CD,
        NVL(
		CASE
        WHEN B.OFC_TP_CD IN ('HO')
        THEN 'Y'
        WHEN B.OFC_TP_CD IN ('HQ','QT')
        THEN
           (SELECT
                CASE
                WHEN COUNT(X.OFC_CD) > 0 THEN 'Y'
                ELSE 'N1'||@[act_tp]
                END
            FROM (
                SELECT OFC_CD
                FROM MDM_ORGANIZATION
                WHERE DELT_FLG = 'N'
                CONNECT BY NOCYCLE PRIOR OFC_CD = PRNT_OFC_CD
                START WITH OFC_CD = (SELECT AR_HD_QTR_OFC_CD FROM MDM_ORGANIZATION WHERE OFC_CD = @[no_ofc_cd])
                ) X
            WHERE X.OFC_CD = @[cre_ofc_cd])
        ELSE
            CASE
            WHEN @[act_tp] = 'AGMT' --//LOGIN OFC와 YARD의 Country가 동일한 것에만 권한 부여
            THEN
               (SELECT
                    CASE
                    WHEN Y.LOC_CD IS NOT NULL
                    --THEN DECODE(SUBSTR(Y.LOC_CD,1,2),DECODE(C.CNT_CD,'HQ','SG',C.CNT_CD),'Y','N2'||[act_tp])
                    THEN DECODE(DECODE(SUBSTR(Y.LOC_CD,1,2),'HK','CN',SUBSTR(Y.LOC_CD,1,2)),DECODE(C.CNT_CD,'HQ','SG','HK','CN',C.CNT_CD),'Y',
                                DECODE(Y.OFC_CD,@[cre_ofc_cd],'Y',DECODE(@[no_ofc_cd],@[cre_ofc_cd],'Y','N2'||@[act_tp])))
                    ELSE 'N2'||@[act_tp]
                    END
                FROM MDM_YARD Y
                WHERE Y.YD_CD = nvl(@[no_yd_cd],'') AND NVL(Y.DELT_FLG,'N')='N')--
            WHEN @[act_tp] = 'INV'  --//LOGIN OFC와 하위 OFC에 권한 부여
            THEN
               (SELECT
                    CASE
                    WHEN COUNT(X.OFC_CD) > 0 THEN 'Y'
                    ELSE 'N2'||@[act_tp]
                    END
                FROM (
                    SELECT OFC_CD
                    FROM MDM_ORGANIZATION
                    WHERE DELT_FLG = 'N'
                    CONNECT BY NOCYCLE PRIOR OFC_CD = PRNT_OFC_CD
                    START WITH OFC_CD = @[cre_ofc_cd]
                    ) X
                WHERE X.OFC_CD = @[no_ofc_cd])
            ELSE ''
            END
        END, 'X') AUTH_OFCS
FROM MDM_ORGANIZATION B,
     (SELECT C.LOC_CD, C.CNT_CD FROM MDM_LOCATION C WHERE NVL(C.DELT_FLG,'N') <> 'Y') C
WHERE 1 = 1
AND B.OFC_CD = @[cre_ofc_cd]
AND NVL(B.DELT_FLG,'N') <> 'Y'
AND B.LOC_CD = C.LOC_CD(+)			]]></sql>
			<params>
				<param name="act_tp" type="12" value="" out="N"/>
				<param name="no_ofc_cd" type="12" value="" out="N"/>
				<param name="cre_ofc_cd" type="12" value="" out="N"/>
				<param name="no_yd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
