<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="Edi322ReceiveDBDAOSearchEdi322BkgNoRSQL">
			<desc><![CDATA[SearchEdi322BkgNo]]></desc>
			<sql><![CDATA[
SELECT BB.BKG_NO
FROM BKG_BOOKING BB,
  (
    SELECT BKG_NO
    FROM(
        SELECT BKG_NO
        FROM BKG_CONTAINER
        WHERE CNTR_NO LIKE @[cntr_no] ||'%'
		AND    ( NVL(CNMV_ID_NO,0) <> 0 AND NVL(CNMV_ID_NO,0) <> 0)
        ORDER BY CNTR_NO, CNMV_YR DESC, CNMV_ID_NO DESC, CNMV_CYC_NO DESC)
    WHERE ROWNUM=1) BC
WHERE BB.BKG_NO = BC.BKG_NO
  AND BB.BKG_CGO_TP_CD = 'F'
  AND BB.BKG_STS_CD <> 'X'
  AND ROWNUM =1
  AND 'F'= (SELECT NVL(BKG_CGO_TP_CD, 'M') BKG_CGO_TP_CD
            FROM CTM_MOVEMENT
            WHERE (CNTR_NO,
                  CNMV_YR,
                  CNMV_ID_NO,
                  CNMV_CYC_NO, 1) IN (SELECT CNTR_NO,
                                      CNMV_YR,
                                      CNMV_ID_NO,
                                      CNMV_CYC_NO,
									RANK() OVER (PARTITION BY SUBSTR(CNTR_NO,1,10) ORDER BY CNMV_YR DESC, CNMV_ID_NO DESC, CNMV_CYC_NO DESC ) RNK_ROW
                                    FROM MST_CONTAINER
                                    WHERE CNTR_NO LIKE @[cntr_no] ||'%' ) )			]]></sql>
			<params>
				<param name="cntr_no" type="12" value="INKU222428" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
