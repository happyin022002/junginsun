<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PreDispatchSentHistoryDBDAOBatchPreDispatchSentHistoryCSQL">
			<desc><![CDATA[PreDispatchSentHistoryDBDAOBatchPreDispatchSentHistoryCSQL]]></desc>
			<sql><![CDATA[
INSERT INTO TRS_TRSP_DIS_HIS ( 
	TRSP_SO_OFC_CTY_CD, TRSP_SO_SEQ, TRSP_WO_OFC_CTY_CD, TRSP_WO_SEQ, 
	TRSP_DIS_REF_NO, TRSP_DIS_ISS_SEQ, 
	CGOR_FRT_PAY_IND_FLG, CGOR_ORG_BL_RCVR_IND_FLG, CGOR_CSTMS_ACPT_RE_IND_FLG, 
	CNTR_PKUP_NO, AVAL_DT, LST_FREE_DT, 
	DIS_N1ST_FAX_NO, DIS_N2ND_FAX_NO, DIS_N3RD_FAX_NO, 
	DIS_N1ST_EML, DIS_N2ND_EML, DIS_N3RD_EML, 
	CRE_OFC_CD, CRE_USR_ID, CRE_DT, CNTR_AVAL_NTC_UPD_FLG 
) 
SELECT 
	A.TRSP_SO_OFC_CTY_CD, A.TRSP_SO_SEQ, A.TRSP_WO_OFC_CTY_CD, A.TRSP_WO_SEQ, 
	B.TRSP_DIS_REF_NO, MAX(C.TRSP_DIS_ISS_SEQ) + 1, 
	F.FRT_CLT_FLG, DECODE(F.CSTMS_CLR_CD, 'Y', 'Y', ' '), F.CSTMS_CLR_CD,
	A.CNTR_PKUP_NO, A.AVAL_DT, A.LST_FREE_DT, 
	D.DIS_N1ST_FAX_NO, D.DIS_N2ND_FAX_NO, D.DIS_N3RD_FAX_NO, 
	E.DIS_N1ST_EML, E.DIS_N2ND_EML, E.DIS_N3RD_EML, 
	A.CRE_OFC_CD, A.UPD_USR_ID, SYSDATE, 'Y' 
FROM TRS_TRSP_SVC_ORD A, TRS_TRSP_DIS_MST B, TRS_TRSP_DIS_HIS C, 
( 
	SELECT VNDR_SEQ, 
		MAX(DECODE(ROWNUM, 1, WO_FAX_NO, '')) DIS_N1ST_FAX_NO, 
		MAX(DECODE(ROWNUM, 2, WO_FAX_NO, '')) DIS_N2ND_FAX_NO, 
		MAX(DECODE(ROWNUM, 3, WO_FAX_NO, '')) DIS_N3RD_FAX_NO 
	FROM TRS_TRSP_WRK_ORD_CC_FAX 
	WHERE VNDR_SEQ = @[vndr_seq] 
	GROUP BY VNDR_SEQ 
) D, 
( 
	SELECT VNDR_SEQ, 
		MAX(DECODE(ROWNUM, 1, WO_EML, '')) DIS_N1ST_EML, 
		MAX(DECODE(ROWNUM, 2, WO_EML, '')) DIS_N2ND_EML, 
		MAX(DECODE(ROWNUM, 3, WO_EML, '')) DIS_N3RD_EML 
	FROM TRS_TRSP_WRK_ORD_CC_EML 
	WHERE VNDR_SEQ = @[vndr_seq]  
	GROUP BY VNDR_SEQ 
) E ,
BKG_CGO_RLSE F
WHERE A.TRSP_SO_OFC_CTY_CD = B.TRSP_SO_OFC_CTY_CD 
AND A.TRSP_SO_SEQ = B.TRSP_SO_SEQ 
AND A.TRSP_WO_OFC_CTY_CD = B.TRSP_WO_OFC_CTY_CD 
AND A.TRSP_WO_SEQ = B.TRSP_WO_SEQ 
AND B.TRSP_SO_OFC_CTY_CD = C.TRSP_SO_OFC_CTY_CD 
AND B.TRSP_SO_SEQ = C.TRSP_SO_SEQ 
AND B.TRSP_WO_OFC_CTY_CD = C.TRSP_WO_OFC_CTY_CD 
AND B.TRSP_WO_SEQ = C.TRSP_WO_SEQ 
AND B.TRSP_DIS_REF_NO = C.TRSP_DIS_REF_NO 
AND A.VNDR_SEQ = D.VNDR_SEQ(+) 
AND A.VNDR_SEQ = E.VNDR_SEQ(+) 
AND A.BL_NO = F.BL_NO(+)
AND A.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd] 
AND A.TRSP_SO_SEQ = @[trsp_so_seq] 
GROUP BY A.TRSP_SO_OFC_CTY_CD, A.TRSP_SO_SEQ, A.TRSP_WO_OFC_CTY_CD, A.TRSP_WO_SEQ, B.TRSP_DIS_REF_NO, 
F.FRT_CLT_FLG, DECODE(F.CSTMS_CLR_CD, 'Y', 'Y', ' '), F.CSTMS_CLR_CD, A.CNTR_PKUP_NO, A.AVAL_DT, 
A.LST_FREE_DT, D.DIS_N1ST_FAX_NO, D.DIS_N2ND_FAX_NO, D.DIS_N3RD_FAX_NO, E.DIS_N1ST_EML, E.DIS_N2ND_EML, E.DIS_N3RD_EML, 
A.CRE_OFC_CD, A.UPD_USR_ID 			]]></sql>
			<params>
				<param name="vndr_seq" type="2" value="" out="N"/>
				<param name="trsp_so_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="trsp_so_seq" type="2" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
