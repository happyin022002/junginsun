<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="USA404EDIStatusInquiryDBDAOsearchFlatFileKleinSchmitRailBillAddressRSQL">
			<desc><![CDATA[searchFlatFileKleinSchmitRailBillAddress]]></desc>
			<sql><![CDATA[
SELECT  PARTY_TP, PARTY_NM, PARTY_ADD1, PARTY_ADD2, PARTY_CITY, PARTY_STATE, PARTY_POSTAL
FROM (
	SELECT  DISTINCT PARTY_TP, PARTY_NM, PARTY_ADD1, PARTY_ADD2, PARTY_CITY, PARTY_STATE, PARTY_POSTAL, RANK() OVER(PARTITION BY PARTY_TP ORDER BY BKG_CUST_TP_SEQ) RK
	FROM
	(
		SELECT 
			  DECODE(J.BKG_CUST_TP_CD, 'S', 1, 'F', 2, 'C', 3, 'N', 4) BKG_CUST_TP_SEQ
			 ,CASE WHEN A.TRSP_BND_CD = 'O' THEN 
					 CASE WHEN NVL(M.RAIL_ROAD_PRIO_FLG, 'N') = 'Y' AND J.BKG_CUST_TP_CD IN ('S', 'F') THEN 'SF'
						  WHEN NVL(M.RAIL_ROAD_PRIO_FLG, 'N') = 'N' AND J.BKG_CUST_TP_CD IN ('S', 'F') THEN ''
						  ELSE '' 
					 END
				   WHEN A.TRSP_BND_CD = 'I' THEN 
					 CASE WHEN NVL(M.RAIL_ROAD_PRIO_FLG, 'N') = 'Y' AND J.BKG_CUST_TP_CD = 'C' THEN CASE WHEN B.CUST_TO_ORD_FLG = 'Y' THEN 'N1' ELSE 'UC' END
						  WHEN NVL(M.RAIL_ROAD_PRIO_FLG, 'N') = 'N' AND J.BKG_CUST_TP_CD = 'C' THEN ''
						  ELSE '' 
					 END
				   ELSE ''
			  END PARTY_TP
			 ,CASE WHEN A.TRSP_BND_CD = 'O' THEN  CASE WHEN NVL(M.RAIL_ROAD_PRIO_FLG, 'N') = 'Y' AND J.BKG_CUST_TP_CD IN ('S', 'F') THEN NVL(M.CUST_ABBR_NM, J.CUST_NM)	ELSE J.CUST_NM END
				   WHEN A.TRSP_BND_CD = 'I' THEN  CASE WHEN NVL(M.RAIL_ROAD_PRIO_FLG, 'N') = 'Y' AND J.BKG_CUST_TP_CD = 'C' THEN NVL(M.CUST_ABBR_NM, J.CUST_NM) ELSE J.CUST_NM END
				   ELSE J.CUST_NM
			  END PARTY_NM
			 ,TRIM(REPLACE(REPLACE(REPLACE(J.CUST_ADDR, CHR(13), ' '), CHR(10), ' '), CHR(43), ' ')) AS PARTY_ADD1
			 ,'' AS PARTY_ADD2
			 ,J.CUST_CTY_NM AS PARTY_CITY
			 ,NVL(L.STE_CD, J.CUST_STE_CD) AS PARTY_STATE
			 ,J.CUST_ZIP_ID AS PARTY_POSTAL
		  FROM TRS_TRSP_RAIL_BIL_ORD A
			  ,BKG_CUSTOMER          J
			  ,MDM_CUSTOMER          M
			  ,BKG_BOOKING           B
              ,MDM_LOCATION          L
		 WHERE A.BKG_NO = J.BKG_NO
		   AND A.BKG_NO = B.BKG_NO
		   AND J.BKG_CUST_TP_CD IN ('S', 'F', 'N', 'C')
		   AND J.CUST_CNT_CD    = M.CUST_CNT_CD
		   AND J.CUST_SEQ       = M.CUST_SEQ
           AND M.LOC_CD = L.LOC_CD
           AND M.DELT_FLG = 'N'
           AND L.DELT_FLG = 'N'
		   AND A.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
		   AND A.TRSP_SO_SEQ = @[trsp_so_seq]
	)
	WHERE PARTY_TP IS NOT NULL AND PARTY_NM IS NOT NULL
)
WHERE RK = 1			]]></sql>
			<params>
				<param name="trsp_so_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="trsp_so_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
