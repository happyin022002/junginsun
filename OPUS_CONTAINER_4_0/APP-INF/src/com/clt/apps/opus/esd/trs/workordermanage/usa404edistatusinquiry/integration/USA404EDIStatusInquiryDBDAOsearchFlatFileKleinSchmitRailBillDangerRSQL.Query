<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="USA404EDIStatusInquiryDBDAOsearchFlatFileKleinSchmitRailBillDangerRSQL">
			<desc><![CDATA[searchFlatFileKleinSchmitRailBillDanger]]></desc>
			<sql><![CDATA[
#if(${f_type} == 'L')
SELECT PKG_CD
      ,PKG_QTY
      ,UNBR
      ,CFR_NBR
      ,DG_STCC
      ,GWGT
      ,GWGT_UNIT
      ,NWGT
      ,NWGT_UNIT
      ,CLASS
      ,CLASS2
      ,PKG_GRP
      ,PROPER
      ,PROPER_NOS
      ,TECHNICAL
      ,DECLARANT
      ,SPCL_PROVISION
      ,ERAP_CD
      ,ERAP_CONTACT
      ,FLASH
      ,FLASH_UNIT
      ,TEMP_CONTROL
      ,TEMP_CONTROL_UNIT
      ,TEMP_EMERENCY
      ,TEMP_EMERENCY_UNIT
      ,WGT_NE
      ,WGT_NE_UNIT
      ,PIOSON_ZONE
      ,LIMIT
      ,MAR_POLL
      ,D13_IND
      ,HOT_IND
      ,INHALATION_IND
      ,RESIDUE_IND
      ,PIOSON_IND
      ,RQ_IND
      ,PIC_NM
      ,PIC_TEL
      ,DCGO_SEQ
      ,DG_CNTR_SEQ
      ,DOT_AUTH_NO
      ,DOT_SPCL_APRO_NO
      ,DOT_EXP_NO
      ,TRSP_SO_OFC_CTY_CD
      ,TRSP_SO_SEQ
      ,BKG_NO
      ,EQ_NO
      ,EQ_TPSZ
  FROM (SELECT P.OUT_IMDG_PCK_CD1 PKG_CD
              ,NVL(P.OUT_IMDG_PCK_QTY1, 0) PKG_QTY
              ,P.IMDG_UN_NO AS UNBR
              ,DECODE(S.CFR_FLG, 'Y', 'NA' || S.IMDG_UN_NO) CFR_NBR
              ,STCC.STCC_CD DG_STCC
              ,NVL(P.GRS_WGT, 0) AS GWGT
              ,'KGS' AS GWGT_UNIT
              ,NVL(P.NET_WGT, 0) AS NWGT
              ,'KGS' AS NWGT_UNIT
              ,P.IMDG_CLSS_CD AS CLASS
			  ,REGEXP_REPLACE((NVL2(P.IMDG_SUBS_RSK_LBL_CD1, P.IMDG_SUBS_RSK_LBL_CD1 || ',' , '' ) 
			   || NVL2(P.IMDG_SUBS_RSK_LBL_CD2, P.IMDG_SUBS_RSK_LBL_CD2 || ',' , '' ) 
			   || NVL2(P.IMDG_SUBS_RSK_LBL_CD3, P.IMDG_SUBS_RSK_LBL_CD3 || ',' , '' ) 
			   || NVL2(P.IMDG_SUBS_RSK_LBL_CD4, P.IMDG_SUBS_RSK_LBL_CD4 || ',' , '' )), ',{1}$')  AS CLASS2
--              ,(SELECT LISTAGG(IMDG_SUBS_RSK_LBL_CD, ',') WITHIN GROUP(ORDER BY IMDG_SUBS_RSK_LBL_CD) FROM SCG_IMDG_SUBS_RSK_LBL WHERE IMDG_UN_NO = P.IMDG_UN_NO AND IMDG_UN_NO_SEQ = P.IMDG_UN_NO_SEQ) AS CLASS2
              ,STCC.PCK_GRP_VAL_CD AS PKG_GRP
              ,P.PRP_SHP_NM AS PROPER
              ,DECODE(INSTR(P.PRP_SHP_NM, 'N.O.S', 1, 1), 0, '', 'NOS') AS PROPER_NOS
              ,P.HZD_DESC AS TECHNICAL
              ,(SELECT DE.DECL_NM FROM BKG_DG_DECL DE WHERE DE.BKG_NO = P.BKG_NO AND DE.DG_CNTR_SEQ = P.DG_CNTR_SEQ AND DE.DECL_NM IS NOT NULL AND ROWNUM = 1) AS DECLARANT
              ,P.IMDG_UN_NO_SPCL_PROVI_CTNT AS SPCL_PROVISION
              ,P.ERAP_NO AS ERAP_CD
              ,P.ERAP_CNTC_NO AS ERAP_CONTACT
              ,P.FLSH_PNT_CDO_TEMP AS FLASH
              ,NVL2(P.FLSH_PNT_CDO_TEMP, 'CE', '') AS FLASH_UNIT
              ,'' AS TEMP_CONTROL
              ,'' AS TEMP_CONTROL_UNIT
              ,'' AS TEMP_EMERENCY
              ,'' AS TEMP_EMERENCY_UNIT
              ,CASE WHEN NVL(P.NET_EXPLO_WGT, 0) > 0 THEN TO_CHAR(P.NET_EXPLO_WGT) END AS WGT_NE
              ,CASE WHEN NVL(P.NET_EXPLO_WGT, 0) > 0 THEN 'KGS' END AS WGT_NE_UNIT
              ,S.CFR_PSN_INH_ZN_CD AS PIOSON_ZONE
              ,DECODE(P.IMDG_LMT_QTY_FLG, 'N', '', P.IMDG_LMT_QTY_FLG) AS LIMIT
              ,P.MRN_POLUT_FLG AS MAR_POLL
              ,'' AS D13_IND
              ,'' AS HOT_IND
              ,'' AS INHALATION_IND
              ,DECODE(P.RSD_FLG, 'N', '', P.RSD_FLG) AS RESIDUE_IND
              ,'' AS PIOSON_IND
              ,DECODE(NVL(S.CFR_RPT_QTY, 0), 0, '', 'Y') AS RQ_IND
              ,P.EMER_CNTC_PSON_NM AS PIC_NM
              ,P.EMER_CNTC_PHN_NO_CTNT AS PIC_TEL
              ,P.DCGO_SEQ
              ,P.DG_CNTR_SEQ
              ,P.DOT_AUTH_NO
              ,P.DOT_SPCL_APRO_NO
              ,P.DOT_EXP_NO
              ,A.TRSP_SO_OFC_CTY_CD
              ,A.TRSP_SO_SEQ
              ,A.BKG_NO
              ,P.CNTR_NO AS EQ_NO
              ,P.CNTR_TPSZ_CD AS EQ_TPSZ
          FROM TRS_TRSP_RAIL_BIL_ORD A
              ,BKG_CONTAINER D
              ,BKG_DG_CGO P
              ,SCG_IMDG_UN_NO S
              ,(SELECT BKG_NO
                      ,DCGO_SEQ
                      ,STCC_CD
                      ,STCC_SEQ
                      ,PCK_GRP_VAL_CD
                  FROM (SELECT DG.BKG_NO
                              ,DG.DCGO_SEQ
                              ,STCC.STCC_CD
                              ,STCC.STCC_SEQ
                              ,STCC.PCK_GRP_VAL_CD
                              ,ROW_NUMBER() OVER(PARTITION BY DG.BKG_NO, DG.DCGO_SEQ ORDER BY STCC.STCC_CD, STCC.STCC_SEQ) RN
                          FROM BKG_DG_CGO            DG
                              ,TRS_STCC              STCC
                              ,TRS_TRSP_RAIL_BIL_ORD SO
                         WHERE SO.BKG_NO = DG.BKG_NO
                           AND SO.EQ_NO = DG.CNTR_NO
                           AND DG.IMDG_UN_NO = NVL(STCC.UN_CMDT_CD, DG.IMDG_UN_NO)
                           AND DG.IMDG_UN_NO_SEQ = NVL(STCC.IMDG_UN_NO_SEQ, DG.IMDG_UN_NO_SEQ)
                           AND DG.IMDG_CLSS_CD = NVL(STCC.HZD_MTRL_CLSS_CD, DG.IMDG_CLSS_CD)
                           AND NVL(DG.IMDG_PCK_GRP_CD, 'XX') = NVL2(DG.IMDG_PCK_GRP_CD, NVL(STCC.PCK_GRP_CD, DG.IMDG_PCK_GRP_CD), 'XX')
                           AND UPPER(REPLACE(TRIM(DG.PRP_SHP_NM), ' ', '')) = UPPER(REPLACE(TRIM(STCC.PRP_SHP_NM), ' ', ''))
                           AND STCC.DELT_FLG = 'N'
                           AND SO.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                           AND SO.TRSP_SO_SEQ = @[trsp_so_seq])
                 WHERE RN = 1) STCC
         WHERE A.BKG_NO = D.BKG_NO
           AND A.EQ_NO = D.CNTR_NO
           AND A.BKG_NO = P.BKG_NO
           AND A.EQ_NO = P.CNTR_NO
           AND A.DELT_FLG = 'N'
           AND P.IMDG_UN_NO = S.IMDG_UN_NO(+)
           AND P.IMDG_UN_NO_SEQ = S.IMDG_UN_NO_SEQ(+)
           AND P.BKG_NO = STCC.BKG_NO(+)
           AND P.DCGO_SEQ = STCC.DCGO_SEQ(+)
           AND A.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
           AND A.TRSP_SO_SEQ = @[trsp_so_seq]
	)
#elseif(${f_type} == 'D')
SELECT
	'' AS PKG_CD
	,'' AS PKG_QTY
	,'' AS UNBR   
	,'' AS CFR_NBR         
	,'' AS DG_STCC
	,'' AS GWGT
	,'' AS GWGT_UNIT
	,'' AS NWGT
	,'' AS NWGT_UNIT
	,'' AS CLASS
	,'' AS CLASS2
	,'' AS PKG_GRP
	,'' AS PROPER
	,'' AS PROPER_NOS
	,'' AS TECHNICAL
	,'' AS DECLARANT
	,'' AS SPCL_PROVISION
	,'' AS ERAP_CD
	,'' AS ERAP_CONTACT
	,'' AS FLASH
	,'' AS FLASH_UNIT
	,'' AS TEMP_CONTROL
	,'' AS TEMP_CONTROL_UNIT
	,'' AS TEMP_EMERENCY
	,'' AS TEMP_EMERENCY_UNIT
	,'' AS WGT_NE
	,'' AS WGT_NE_UNIT
	,'' AS PIOSON_ZONE
	,'' AS LIMIT
	,'' AS MAR_POLL
	,'' AS D13_IND
	,'' AS HOT_IND
	,'' AS INHALATION_IND
	,'' AS RESIDUE_IND
	,'' AS PIOSON_IND
	,'' AS RQ_IND
	,'' AS PIC_NM
	,'' AS PIC_TEL
	,'' AS DCGO_SEQ
    ,'' AS DG_CNTR_SEQ
	,'' AS DOT_AUTH_NO
    ,'' AS DOT_SPCL_APRO_NO
    ,'' AS DOT_EXP_NO	
    ,'' AS TRSP_SO_OFC_CTY_CD
    ,'' AS TRSP_SO_SEQ
    ,'' AS BKG_NO
    ,'' AS EQ_NO
    ,'' AS EQ_TPSZ
FROM DUAL
#end			]]></sql>
			<params>
				<param name="trsp_so_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="trsp_so_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
