<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MarineTerminalInvoiceManageDBDAOModifyCntrListForTerminalInvoiceConfirmUSQL">
			<desc><![CDATA[ModifyCntrListForTerminalInvoiceConfirm]]></desc>
			<sql><![CDATA[
UPDATE TES_TML_SO_DTL OUTER
SET (
  OUTER.UPD_USR_ID
  ,OUTER.UPD_DT
  ,OUTER.LOCL_UPD_DT		
　,OUTER.ACCT_CD
) = (
    SELECT @[usr_id] UPD_USR_ID  									-- UPDATE DATA
		   ,SYSDATE  UPD_DT										
           ,GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[ofc_cd])	LOCL_UPD_DT-- UPDATE DATA
           , DECODE(D.TML_CRR_CD,NULL,C.ACCT_CD,'',C.ACCT_CD,'TSG',C.ACCT_CD,C.CRR_ACCT_CD) ACCT_CD    -- 2008-07-31: 이D의 요청으로 전용terminal이외도 타선사인경우 타선사 Acct를 물린다.
    FROM   TES_TML_SO_HDR H, TES_TML_SO_DTL D, TES_LGS_COST C
    WHERE  D.TML_SO_OFC_CTY_CD = @[tml_so_ofc_cty_cd]
    AND    D.TML_SO_SEQ        = @[tml_so_seq]
    AND    H.TML_SO_OFC_CTY_CD = D.TML_SO_OFC_CTY_CD
    AND    H.TML_SO_SEQ = D.TML_SO_SEQ
    AND    D.LGS_COST_CD = C.LGS_COST_CD(+)
    AND    OUTER.TML_SO_OFC_CTY_CD      = D.TML_SO_OFC_CTY_CD
    AND    OUTER.TML_SO_SEQ             = D.TML_SO_SEQ
    AND    OUTER.TML_SO_DTL_SEQ         = D.TML_SO_DTL_SEQ
)
 where exists
(
    SELECT 'X'
    FROM   TES_TML_SO_DTL B
    WHERE  TML_SO_OFC_CTY_CD = @[tml_so_ofc_cty_cd]
    AND    TML_SO_SEQ        = @[tml_so_seq]
    AND    OUTER.TML_SO_OFC_CTY_CD      = B.TML_SO_OFC_CTY_CD
    AND    OUTER.TML_SO_SEQ             = B.TML_SO_SEQ
    AND    OUTER.TML_SO_DTL_SEQ         = B.TML_SO_DTL_SEQ
)			]]></sql>
			<params>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="tml_so_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="tml_so_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
