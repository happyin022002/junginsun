<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="WorkOrderPreviewDBDAOAddWorkOrderPreviewSvcOrdUSQL">
			<desc><![CDATA[trs_trsp_svc_ord update]]></desc>
			<sql><![CDATA[
UPDATE TRS_TRSP_SVC_ORD T
SET 
      TRSP_WO_OFC_CTY_CD  = @[trsp_wo_ofc_cty_cd]
    , TRSP_WO_SEQ       = @[trsp_wo_seq]
    , TRSP_SO_STS_CD    = 'I'
    , VNDR_SEQ          = @[vndr_seq]
    , WO_RJCT_FLG       = null 
    , UPD_DT            = SYSDATE
    , WO_EXE_DT         = DECODE(TRSP_COST_DTL_MOD_CD,'DR',NVL(DOR_NOD_PLN_DT, GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(CRE_OFC_CD)), GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(CRE_OFC_CD))
	, UPD_USR_ID 		= @[upd_usr_id]
    , LOCL_UPD_DT       = GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(CRE_OFC_CD)
    , TRS_SUB_STS_CD    = CASE WHEN @[trs_sub_sts_cd] = 'DF' THEN 'DF'
                               WHEN @[wo_iss_sts_cd] = 'I' AND NVL(T.TRS_SUB_STS_CD, 'XX') IN ('DF', 'XX') THEN 'OR'
                               ELSE TRS_SUB_STS_CD
                           END
	,TRSP_AGMT_OFC_CTY_CD = (SELECT TRSP_AGMT_OFC_CTY_CD FROM TRS_TRSP_WRK_ORD_PRV_TMP X  WHERE X.TRSP_SO_OFC_CTY_CD = T.TRSP_SO_OFC_CTY_CD	 AND X.TRSP_SO_SEQ = T.TRSP_SO_SEQ	 AND X.WO_PRV_GRP_SEQ = @[wo_prv_grp_seq])
    ,TRSP_AGMT_SEQ 		= (SELECT TRSP_AGMT_SEQ FROM TRS_TRSP_WRK_ORD_PRV_TMP X  WHERE X.TRSP_SO_OFC_CTY_CD = T.TRSP_SO_OFC_CTY_CD	 AND X.TRSP_SO_SEQ = T.TRSP_SO_SEQ	 AND X.WO_PRV_GRP_SEQ = @[wo_prv_grp_seq])
	#if (${conti_cd} == 'M' && ${wo_edi_use_flg} == 'Y') 
       	, EDI_SND_MSG_TP_CD = '204'
		, EDI_SND_DT = SYSDATE
       	, EDI_CTRL_SEQ = TRS_TRSP_SVC_ORD_SEQ3.NEXTVAL
	#end
	
WHERE (TRSP_SO_OFC_CTY_CD, TRSP_SO_SEQ) IN (
        SELECT TRSP_SO_OFC_CTY_CD, TRSP_SO_SEQ
        FROM TRS_TRSP_WRK_ORD_PRV_TMP
        WHERE WO_PRV_GRP_SEQ = @[wo_prv_grp_seq]
            AND WO_ISS_NO = @[wo_iss_no])			]]></sql>
			<params>
				<param name="trsp_wo_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="trsp_wo_seq" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="trs_sub_sts_cd" type="12" value="" out="N"/>
				<param name="wo_iss_sts_cd" type="12" value="" out="N"/>
				<param name="wo_prv_grp_seq" type="12" value="" out="N"/>
				<param name="wo_iss_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
