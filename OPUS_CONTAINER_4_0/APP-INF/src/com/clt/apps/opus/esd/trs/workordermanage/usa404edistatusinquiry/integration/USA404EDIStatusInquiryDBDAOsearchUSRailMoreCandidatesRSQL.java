/*=========================================================
*Copyright(c) 2016 CyberLogitec
*@FileName : USA404EDIStatusInquiryDBDAOsearchUSRailMoreCandidatesRSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2016.09.29
*@LastModifier : 김성욱
*@LastVersion : 1.0
* 2016.09.29 김성욱
* 1.0 Creation
=========================================================*/
package com.clt.apps.opus.esd.trs.workordermanage.usa404edistatusinquiry.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.clt.framework.support.db.ISQLTemplate;

/**
 *
 * @author Sung-Wook Kim
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class USA404EDIStatusInquiryDBDAOsearchUSRailMoreCandidatesRSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * searchUSRailMoreCandidates
	  * </pre>
	  */
	public USA404EDIStatusInquiryDBDAOsearchUSRailMoreCandidatesRSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("wgt_qty",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("trsp_so_ofc_cty_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("curr_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("cgo_tp_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("bound_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("basis_dt",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("trsp_so_seq",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("spcl_cgo_cntr_tp_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("eq_tp_sz_cd",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.clt.apps.opus.esd.trs.workordermanage.usa404edistatusinquiry.integration").append("\n"); 
		query.append("FileName : USA404EDIStatusInquiryDBDAOsearchUSRailMoreCandidatesRSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("SELECT * FROM (" ).append("\n"); 
		query.append("SELECT AGMT.VNDR_SEQ, AGMT.VNDR_NM, AGMT.AGMT_NO, AGMT.TRSP_RAIL_SCG_CD, AGMT.COM_SCG_APLY_FLG, AGMT.WO_APLY_FLG, AGMT.FM_NOD_CD, AGMT.TO_NOD_CD, " ).append("\n"); 
		query.append("       AGMT.AGMT_SCG_RT_DIV_CD, AGMT.TRSP_RAIL_RTO, AGMT.CURR_CD, AGMT.NUM_VAL AS TRSP_RT, AGMT.TRSP_AGMT_SCG_SEQ," ).append("\n"); 
		query.append("       AGMT.CGO_TP_CD, AGMT.AGMT_EQ_SZ_NO, AGMT.LBS_OVR_WGT, AGMT.WGT_MEAS_UT_CD, AGMT.USR_DEF_RMK," ).append("\n"); 
		query.append("       DECODE(AGMT.COM_SCG_KND_CD,'XXXXXX', NULL, AGMT.COM_SCG_KND_CD) AS COM_SCG_KND_CD," ).append("\n"); 
		query.append("       DECODE(AGMT.COM_SCG_SEQ,-1, NULL, AGMT.COM_SCG_SEQ) AS COM_SCG_SEQ," ).append("\n"); 
		query.append("       AGMT.SPCL_CGO_CNTR_TP_CD," ).append("\n"); 
		query.append("       VNDR.SUB_RAIL_SEQ, APLD.NUM_VAL APPL_RT, APLD.NUM_VAL APPL_RT_HIDDEN, DECODE(APLD.NUM_VAL, NULL, '0', '1') IBCHK," ).append("\n"); 
		query.append("       @[trsp_so_ofc_cty_cd] AS TRSP_SO_OFC_CTY_CD, @[trsp_so_seq] AS TRSP_SO_SEQ," ).append("\n"); 
		query.append("       VNDR.BZC_AMT, AGMT.RAIL_RTO_NO," ).append("\n"); 
		query.append("       AGMT.EFF_FM_DT,AGMT.EFF_TO_DT, APLD.TRSP_AGMT_SCG_SEQ TRSP_AGMT_SCG_SEQ2," ).append("\n"); 
		query.append("       CASE WHEN SUBSTR(@[basis_dt],1,8) BETWEEN TO_CHAR(AGMT.EFF_FM_DT,'YYYYMMDD') AND TO_CHAR(AGMT.EFF_TO_DT,'YYYYMMDD') THEN ''" ).append("\n"); 
		query.append("            ELSE 'Not Matched'" ).append("\n"); 
		query.append("       END RATE_STS" ).append("\n"); 
		query.append("FROM (" ).append("\n"); 
		query.append("        SELECT * " ).append("\n"); 
		query.append("          FROM (" ).append("\n"); 
		query.append("                        /* FSG-NOT COMMON */" ).append("\n"); 
		query.append("                        SELECT A.VNDR_SEQ AS VNDR_SEQ" ).append("\n"); 
		query.append("                              ,C.VNDR_LGL_ENG_NM AS VNDR_NM" ).append("\n"); 
		query.append("                              ,A.TRSP_AGMT_OFC_CTY_CD||A.TRSP_AGMT_SEQ AS AGMT_NO" ).append("\n"); 
		query.append("                              ,A.TRSP_RAIL_SCG_CD" ).append("\n"); 
		query.append("                              ,A.TRSP_RAIL_SCG_CD TRSP_RAIL_SCG_NM" ).append("\n"); 
		query.append("                              ,A.COM_SCG_APLY_FLG" ).append("\n"); 
		query.append("                              ,A.WO_APLY_FLG" ).append("\n"); 
		query.append("                              ,DECODE(A.FM_NOD_CD, '00', '', A.FM_NOD_CD) AS FM_NOD_CD" ).append("\n"); 
		query.append("                              ,DECODE(A.TO_NOD_CD, '00', '', A.TO_NOD_CD) AS TO_NOD_CD" ).append("\n"); 
		query.append("                              ,'Ratio' AS AGMT_SCG_RT_DIV_CD" ).append("\n"); 
		query.append("                              ,A.TRSP_RAIL_RTO AS TRSP_RAIL_RTO" ).append("\n"); 
		query.append("                              ,@[curr_cd] AS CURR_CD" ).append("\n"); 
		query.append("                              ,A.FX_SCG_ALL_RT AS FX_SCG_ALL_RT" ).append("\n"); 
		query.append("                              ,A.FX_SCG_20FT_RT AS FX_SCG_20FT_RT" ).append("\n"); 
		query.append("                              ,A.FX_SCG_40FT_RT AS FX_SCG_40FT_RT" ).append("\n"); 
		query.append("                              ,A.FX_SCG_45FT_RT AS FX_SCG_45FT_RT" ).append("\n"); 
		query.append("                               /* APPLIED AMOUNT */" ).append("\n"); 
		query.append("                              ,A.SPCL_CGO_CNTR_TP_CD" ).append("\n"); 
		query.append("                              ,A.AGMT_EQ_SZ_NO2 AS AGMT_EQ_SZ_NO" ).append("\n"); 
		query.append("                              ,A.LBS_OVR_WGT" ).append("\n"); 
		query.append("                              ,DECODE(A.TRSP_RAIL_SCG_CD, 'OWS', 'LBS', NULL) WGT_MEAS_UT_CD" ).append("\n"); 
		query.append("                              ,A.USR_DEF_RMK" ).append("\n"); 
		query.append("                              ,A.CGO_TP_CD" ).append("\n"); 
		query.append("                              ,A.TRSP_AGMT_SCG_SEQ AS TRSP_AGMT_SCG_SEQ" ).append("\n"); 
		query.append("                              ,A.NUM_VAL" ).append("\n"); 
		query.append("                              ,'XXXXXX' AS COM_SCG_KND_CD" ).append("\n"); 
		query.append("                              ,-1 AS COM_SCG_SEQ" ).append("\n"); 
		query.append("                              ,A.RAIL_RTO_NO" ).append("\n"); 
		query.append("                              ,A.EFF_FM_DT" ).append("\n"); 
		query.append("                              ,A.EFF_TO_DT" ).append("\n"); 
		query.append("                         FROM (" ).append("\n"); 
		query.append("                                SELECT 'AL' AS AGMT_EQ_SZ_NO2" ).append("\n"); 
		query.append("                                      ,NULL AS NUM_VAL" ).append("\n"); 
		query.append("                                      ,A.* " ).append("\n"); 
		query.append("                                  FROM TRS_AGMT_RAIL_SCG_RT A" ).append("\n"); 
		query.append("                                 WHERE TRSP_RAIL_SCG_CD = 'FSG'" ).append("\n"); 
		query.append("                                   AND NVL(COM_SCG_APLY_FLG, '0') = '0'" ).append("\n"); 
		query.append("                                   AND TRSP_RAIL_SCG_CD IS NOT NULL" ).append("\n"); 
		query.append("                                   AND NVL(CGO_TP_CD, DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')) = DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')" ).append("\n"); 
		query.append("                              ) A" ).append("\n"); 
		query.append("                             ,MDM_VENDOR C" ).append("\n"); 
		query.append("                             ,TRS_TRSP_RAIL_BIL_VNDR_SET G" ).append("\n"); 
		query.append("                        WHERE 1=1" ).append("\n"); 
		query.append("                          AND A.VNDR_SEQ = C.VNDR_SEQ" ).append("\n"); 
		query.append("                          AND NVL(A.FM_NOD_CD, '00') = DECODE(LENGTH(NVL(A.FM_NOD_CD, '00')), 7, G.FM_NOD_CD, 5, SUBSTR(G.FM_NOD_CD, 1, 5), '00')" ).append("\n"); 
		query.append("                          AND NVL(A.TO_NOD_CD, '00') = DECODE(LENGTH(NVL(A.TO_NOD_CD, '00')), 7, G.TO_NOD_CD, 5, SUBSTR(G.TO_NOD_CD, 1, 5), '00')" ).append("\n"); 
		query.append("                          AND G.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]" ).append("\n"); 
		query.append("                          AND G.TRSP_SO_SEQ = @[trsp_so_seq]" ).append("\n"); 
		query.append("                          AND A.VNDR_SEQ = G.VNDR_SEQ" ).append("\n"); 
		query.append("                        UNION ALL" ).append("\n"); 
		query.append("                        /* FSG-COMMON 2 */" ).append("\n"); 
		query.append("                        SELECT F.VNDR_SEQ AS VNDR_SEQ" ).append("\n"); 
		query.append("                              ,C.VNDR_LGL_ENG_NM AS VNDR_NM" ).append("\n"); 
		query.append("                              ,F.TRSP_AGMT_OFC_CTY_CD||F.TRSP_AGMT_SEQ AS AGMT_NO" ).append("\n"); 
		query.append("                              ,F.TRSP_RAIL_SCG_CD" ).append("\n"); 
		query.append("                              ,F.TRSP_RAIL_SCG_CD TRSP_RAIL_SCG_NM" ).append("\n"); 
		query.append("                              ,F.COM_SCG_APLY_FLG" ).append("\n"); 
		query.append("                              ,F.WO_APLY_FLG" ).append("\n"); 
		query.append("                              ,DECODE(F.FM_NOD_CD, '00', '', F.FM_NOD_CD) AS FM_NOD_CD" ).append("\n"); 
		query.append("                              ,DECODE(F.TO_NOD_CD, '00', '', F.TO_NOD_CD) AS TO_NOD_CD" ).append("\n"); 
		query.append("                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN 'Fixed'" ).append("\n"); 
		query.append("                                    ELSE 'Ratio'" ).append("\n"); 
		query.append("                               END AS AGMT_SCG_RT_DIV_CD" ).append("\n"); 
		query.append("                              ,F.TRSP_ONE_WY_RT AS TRSP_RAIL_RTO" ).append("\n"); 
		query.append("                              ,@[curr_cd] AS CURR_CD" ).append("\n"); 
		query.append("                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN F.TRSP_ONE_WY_RT" ).append("\n"); 
		query.append("                                    ELSE NULL" ).append("\n"); 
		query.append("                               END AS FX_SCG_ALL_RT" ).append("\n"); 
		query.append("                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN F.TRSP_ONE_WY_RT" ).append("\n"); 
		query.append("                                    ELSE NULL" ).append("\n"); 
		query.append("                               END AS FX_SCG_20FT_RT" ).append("\n"); 
		query.append("                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN F.TRSP_ONE_WY_RT" ).append("\n"); 
		query.append("                                    ELSE NULL" ).append("\n"); 
		query.append("                               END AS FX_SCG_40FT_RT" ).append("\n"); 
		query.append("                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN F.TRSP_ONE_WY_RT" ).append("\n"); 
		query.append("                                    ELSE NULL" ).append("\n"); 
		query.append("                               END AS FX_SCG_45FT_RT" ).append("\n"); 
		query.append("                               /* APPLIED AMOUNT */" ).append("\n"); 
		query.append("                              ,F.SPCL_CGO_CNTR_TP_CD" ).append("\n"); 
		query.append("                              ,F.AGMT_EQ_SZ_NO AS AGMT_EQ_SZ_NO" ).append("\n"); 
		query.append("                              ,0 AS LBS_OVR_WGT" ).append("\n"); 
		query.append("                              ,NULL AS WGT_MEAS_UT_CD" ).append("\n"); 
		query.append("                              ,F.USR_DEF_RMK" ).append("\n"); 
		query.append("                              ,F.CGO_TP_CD" ).append("\n"); 
		query.append("                              ,F.TRSP_AGMT_SCG_SEQ AS TRSP_AGMT_SCG_SEQ" ).append("\n"); 
		query.append("                              ,NULL AS NUM_VAL" ).append("\n"); 
		query.append("                              ,F.COM_SCG_KND_CD" ).append("\n"); 
		query.append("                              ,F.COM_SCG_SEQ" ).append("\n"); 
		query.append("                              ,F.RAIL_RTO_NO" ).append("\n"); 
		query.append("                              ,F.EFF_FM_DT" ).append("\n"); 
		query.append("                              ,F.EFF_TO_DT" ).append("\n"); 
		query.append("                         FROM MDM_VENDOR C" ).append("\n"); 
		query.append("                             ,(SELECT COM_SCG_KND_CD" ).append("\n"); 
		query.append("                                     ,EQ_TPSZ_CD AS TRSP_AGMT_EQ_TP_SZ_CD" ).append("\n"); 
		query.append("                                     ,CURR_CD" ).append("\n"); 
		query.append("                                     ,RT_TP_CD AS AGMT_SCG_RT_DIV_CD" ).append("\n"); 
		query.append("                                     ,NVL(ONE_WY_RT, RND_RT) TRSP_ONE_WY_RT" ).append("\n"); 
		query.append("                                     ,0 TRSP_RND_RT" ).append("\n"); 
		query.append("                                     ,NVL(ONE_WY_RT, RND_RT) ETC_ADD_AMT" ).append("\n"); 
		query.append("                                     ,AGMT_EQ_SZ_NO AS AGMT_EQ_SZ_NO" ).append("\n"); 
		query.append("                                     ,EQ_TPSZ_CD AS EQ_TPSZ_CD" ).append("\n"); 
		query.append("                                     ,COM_SCG_SEQ" ).append("\n"); 
		query.append("                                     ,TRSP_SO_OFC_CTY_CD" ).append("\n"); 
		query.append("                                     ,TRSP_SO_SEQ" ).append("\n"); 
		query.append("                                     ,SUB_RAIL_SEQ" ).append("\n"); 
		query.append("                                     ,VNDR_SEQ" ).append("\n"); 
		query.append("                                     ,TRSP_AGMT_SCG_SEQ" ).append("\n"); 
		query.append("                                     ,USR_DEF_RMK" ).append("\n"); 
		query.append("                                     ,CGO_TP_CD" ).append("\n"); 
		query.append("                                     ,SPCL_CGO_CNTR_TP_CD" ).append("\n"); 
		query.append("                                     ,FM_NOD_CD" ).append("\n"); 
		query.append("                                     ,TO_NOD_CD" ).append("\n"); 
		query.append("                                     ,TRSP_AGMT_OFC_CTY_CD" ).append("\n"); 
		query.append("                                     ,TRSP_AGMT_SEQ" ).append("\n"); 
		query.append("                                     ,TRSP_RAIL_SCG_CD" ).append("\n"); 
		query.append("                                     ,COM_SCG_APLY_FLG" ).append("\n"); 
		query.append("                                     ,WO_APLY_FLG" ).append("\n"); 
		query.append("                                     ,RAIL_RTO_NO" ).append("\n"); 
		query.append("                                     ,EFF_FM_DT" ).append("\n"); 
		query.append("                                     ,EFF_TO_DT" ).append("\n"); 
		query.append("                                 FROM (" ).append("\n"); 
		query.append("                                         SELECT 'FSG' AS COM_SCG_KND_CD" ).append("\n"); 
		query.append("                                               ,ONE_WY_RT" ).append("\n"); 
		query.append("                                               ,RND_RT" ).append("\n"); 
		query.append("                                               ,EQ_TPSZ_CD" ).append("\n"); 
		query.append("                                               ,CSM.CURR_CD" ).append("\n"); 
		query.append("                                               ,RT_TP_CD" ).append("\n"); 
		query.append("                                               ,CASE WHEN SUBSTR(EQ_TPSZ_CD, 1, 2) = 'AL' THEN" ).append("\n"); 
		query.append("                                                            CASE SUBSTR(EQ_TPSZ_CD, 3, 1) WHEN '2' THEN '20'" ).append("\n"); 
		query.append("                                                                                          WHEN '3' THEN '20'" ).append("\n"); 
		query.append("                                                                                          WHEN '4' THEN '40'" ).append("\n"); 
		query.append("                                                                                          WHEN '5' THEN '40'" ).append("\n"); 
		query.append("                                                                                          WHEN '6' THEN '45'" ).append("\n"); 
		query.append("                                                                                          WHEN '7' THEN '45'" ).append("\n"); 
		query.append("                                                                                          ELSE 'AL'" ).append("\n"); 
		query.append("                                                            END" ).append("\n"); 
		query.append("                                                     WHEN SUBSTR(EQ_TPSZ_CD, 1, 2) <> 'AL' THEN" ).append("\n"); 
		query.append("                                                            CASE SUBSTR(EQ_TPSZ_CD, 2, 1) WHEN '2' THEN '20'" ).append("\n"); 
		query.append("                                                                                          WHEN '3' THEN '20'" ).append("\n"); 
		query.append("                                                                                          WHEN '4' THEN '40'" ).append("\n"); 
		query.append("                                                                                          WHEN '5' THEN '40'" ).append("\n"); 
		query.append("                                                                                          WHEN '6' THEN '45'" ).append("\n"); 
		query.append("                                                                                          WHEN '7' THEN '45'" ).append("\n"); 
		query.append("                                                                                          ELSE 'AL'" ).append("\n"); 
		query.append("                                                            END" ).append("\n"); 
		query.append("                                                END AS AGMT_EQ_SZ_NO" ).append("\n"); 
		query.append("                                               ,COM_SCG_SEQ" ).append("\n"); 
		query.append("                                               ,RBVS.TRSP_SO_OFC_CTY_CD" ).append("\n"); 
		query.append("                                               ,RBVS.TRSP_SO_SEQ" ).append("\n"); 
		query.append("                                               ,RBVS.SUB_RAIL_SEQ" ).append("\n"); 
		query.append("                                               ,RBVS.VNDR_SEQ" ).append("\n"); 
		query.append("                                               ,A.TRSP_AGMT_SCG_SEQ" ).append("\n"); 
		query.append("                                               ,A.USR_DEF_RMK" ).append("\n"); 
		query.append("                                               ,A.CGO_TP_CD" ).append("\n"); 
		query.append("                                               ,A.SPCL_CGO_CNTR_TP_CD" ).append("\n"); 
		query.append("                                               ,A.FM_NOD_CD" ).append("\n"); 
		query.append("                                               ,A.TO_NOD_CD" ).append("\n"); 
		query.append("                                               ,A.TRSP_AGMT_OFC_CTY_CD" ).append("\n"); 
		query.append("                                               ,A.TRSP_AGMT_SEQ" ).append("\n"); 
		query.append("                                               ,A.TRSP_RAIL_SCG_CD" ).append("\n"); 
		query.append("                                               ,A.COM_SCG_APLY_FLG" ).append("\n"); 
		query.append("                                               ,A.WO_APLY_FLG" ).append("\n"); 
		query.append("                                               ,A.RAIL_RTO_NO" ).append("\n"); 
		query.append("                                               ,A.EFF_FM_DT" ).append("\n"); 
		query.append("                                               ,A.EFF_TO_DT" ).append("\n"); 
		query.append("                                           FROM TRS_COM_SCG_MGMT CSM" ).append("\n"); 
		query.append("                                               ,(" ).append("\n"); 
		query.append("                                                     SELECT 'AL' AS AGMT_EQ_SZ_NO2" ).append("\n"); 
		query.append("                                                           ,A.* " ).append("\n"); 
		query.append("                                                       FROM TRS_AGMT_RAIL_SCG_RT A" ).append("\n"); 
		query.append("                                                      WHERE TRSP_RAIL_SCG_CD = 'FSG'" ).append("\n"); 
		query.append("                                                        AND NVL(A.COM_SCG_APLY_FLG, '0') = '1'" ).append("\n"); 
		query.append("                                                        AND A.TRSP_RAIL_SCG_CD IS NOT NULL" ).append("\n"); 
		query.append("                                                        AND NVL(A.CGO_TP_CD, DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')) = DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')" ).append("\n"); 
		query.append("                                                ) A" ).append("\n"); 
		query.append("                                               ,(" ).append("\n"); 
		query.append("                                                    SELECT TRSP_SO_OFC_CTY_CD" ).append("\n"); 
		query.append("                                                          ,TRSP_SO_SEQ" ).append("\n"); 
		query.append("                                                          ,SUB_RAIL_SEQ" ).append("\n"); 
		query.append("                                                          ,VNDR_SEQ" ).append("\n"); 
		query.append("                                                          ,FM_NOD_CD" ).append("\n"); 
		query.append("                                                          ,TO_NOD_CD " ).append("\n"); 
		query.append("                                                      FROM TRS_TRSP_RAIL_BIL_VNDR_SET" ).append("\n"); 
		query.append("                                                     WHERE 1=1" ).append("\n"); 
		query.append("                                                       AND TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]" ).append("\n"); 
		query.append("                                                       AND TRSP_SO_SEQ = @[trsp_so_seq]" ).append("\n"); 
		query.append("                                                ) RBVS" ).append("\n"); 
		query.append("                                          WHERE 1=1" ).append("\n"); 
		query.append("                                            AND TRSP_COST_MOD_CD = 'CY'" ).append("\n"); 
		query.append("                                            AND AGMT_TRSP_TP_CD  = 'RD'" ).append("\n"); 
		query.append("                                            AND (SCC_CD = MST_LOC_FNC(SUBSTR(RBVS.FM_NOD_CD, 1, 5),'SCC') OR" ).append("\n"); 
		query.append("                                                 LCC_CD IN (MST_LOC_FNC(SUBSTR(RBVS.FM_NOD_CD, 1, 5),'LCC')) OR" ).append("\n"); 
		query.append("                                                 RCC_CD IN (MST_LOC_FNC(SUBSTR(RBVS.FM_NOD_CD, 1, 5),'RCC'))" ).append("\n"); 
		query.append("                                                )" ).append("\n"); 
		query.append("                                            AND NVL(CSM.CGO_TP_CD, DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')) = DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')" ).append("\n"); 
		query.append("                                            AND NVL(CSM.BND_CD, NVL(@[bound_cd],'X')) = NVL(@[bound_cd],'X')" ).append("\n"); 
		query.append("                                            AND CSM.COM_SCG_KND_CD = 'SCFAAL'" ).append("\n"); 
		query.append("                                            AND NVL(A.FM_NOD_CD, '00') = DECODE(LENGTH(NVL(A.FM_NOD_CD, '00')), 7, RBVS.FM_NOD_CD, 5, SUBSTR(RBVS.FM_NOD_CD, 1, 5), '00')" ).append("\n"); 
		query.append("                                            AND NVL(A.TO_NOD_CD, '00') = DECODE(LENGTH(NVL(A.TO_NOD_CD, '00')), 7, RBVS.TO_NOD_CD, 5, SUBSTR(RBVS.TO_NOD_CD, 1, 5), '00')" ).append("\n"); 
		query.append("                                            AND RBVS.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]" ).append("\n"); 
		query.append("                                            AND RBVS.TRSP_SO_SEQ = @[trsp_so_seq]" ).append("\n"); 
		query.append("                                            AND A.VNDR_SEQ = RBVS.VNDR_SEQ" ).append("\n"); 
		query.append("                                      )" ).append("\n"); 
		query.append("                               ) F" ).append("\n"); 
		query.append("                        WHERE 1=1" ).append("\n"); 
		query.append("                          AND F.VNDR_SEQ = C.VNDR_SEQ" ).append("\n"); 
		query.append("                        UNION ALL" ).append("\n"); 
		query.append("                        /* ETC */" ).append("\n"); 
		query.append("                        SELECT A.VNDR_SEQ AS VNDR_SEQ" ).append("\n"); 
		query.append("                              ,C.VNDR_LGL_ENG_NM AS VNDR_NM" ).append("\n"); 
		query.append("                              ,A.TRSP_AGMT_OFC_CTY_CD||A.TRSP_AGMT_SEQ AS AGMT_NO" ).append("\n"); 
		query.append("                              ,A.TRSP_RAIL_SCG_CD" ).append("\n"); 
		query.append("                              ,A.TRSP_RAIL_SCG_CD TRSP_RAIL_SCG_NM" ).append("\n"); 
		query.append("                              ,A.COM_SCG_APLY_FLG" ).append("\n"); 
		query.append("                              ,A.WO_APLY_FLG" ).append("\n"); 
		query.append("                              ,DECODE(A.FM_NOD_CD, '00', '', A.FM_NOD_CD) AS FM_NOD_CD" ).append("\n"); 
		query.append("                              ,DECODE(A.TO_NOD_CD, '00', '', A.TO_NOD_CD) AS TO_NOD_CD" ).append("\n"); 
		query.append("                              ,'Fixed' AS AGMT_SCG_RT_DIV_CD" ).append("\n"); 
		query.append("                              ,A.TRSP_RAIL_RTO AS TRSP_RAIL_RTO" ).append("\n"); 
		query.append("                              ,DECODE(A.CURR_CD, 'XXX', NULL, A.CURR_CD) AS CURR_CD" ).append("\n"); 
		query.append("                              ,A.FX_SCG_ALL_RT AS FX_SCG_ALL_RT" ).append("\n"); 
		query.append("                              ,A.FX_SCG_20FT_RT AS FX_SCG_20FT_RT" ).append("\n"); 
		query.append("                              ,A.FX_SCG_40FT_RT AS FX_SCG_40FT_RT" ).append("\n"); 
		query.append("                              ,A.FX_SCG_45FT_RT AS FX_SCG_45FT_RT" ).append("\n"); 
		query.append("                               /* APPLIED AMOUNT */" ).append("\n"); 
		query.append("                              ,A.SPCL_CGO_CNTR_TP_CD" ).append("\n"); 
		query.append("                              ,A.AGMT_EQ_SZ_NO2 AS AGMT_EQ_SZ_NO" ).append("\n"); 
		query.append("                              ,A.LBS_OVR_WGT" ).append("\n"); 
		query.append("                              ,DECODE(A.TRSP_RAIL_SCG_CD, 'OWS', 'LBS', NULL) WGT_MEAS_UT_CD" ).append("\n"); 
		query.append("                              ,A.USR_DEF_RMK" ).append("\n"); 
		query.append("                              ,A.CGO_TP_CD" ).append("\n"); 
		query.append("                              ,A.TRSP_AGMT_SCG_SEQ AS TRSP_AGMT_SCG_SEQ" ).append("\n"); 
		query.append("                              ,A.NUM_VAL" ).append("\n"); 
		query.append("                              ,'XXXXXX' AS COM_SCG_KND_CD" ).append("\n"); 
		query.append("                              ,-1 AS COM_SCG_SEQ" ).append("\n"); 
		query.append("                              ,NULL AS RAIL_RTO_NO" ).append("\n"); 
		query.append("                              ,A.EFF_FM_DT" ).append("\n"); 
		query.append("                              ,A.EFF_TO_DT" ).append("\n"); 
		query.append("                         FROM (                        " ).append("\n"); 
		query.append("                                SELECT B.AGMT_EQ_SZ_NO2" ).append("\n"); 
		query.append("                                      ,B.NUM_VAL" ).append("\n"); 
		query.append("                                      ,A.* " ).append("\n"); 
		query.append("                                  FROM TRS_AGMT_RAIL_SCG_RT A" ).append("\n"); 
		query.append("                                      ,(SELECT * " ).append("\n"); 
		query.append("                                          FROM (" ).append("\n"); 
		query.append("                                                  SELECT TRSP_AGMT_SCG_SEQ" ).append("\n"); 
		query.append("                                                        ,AGMT_EQ_SZ_NO2" ).append("\n"); 
		query.append("                                                        ,NUM_VAL" ).append("\n"); 
		query.append("                                                    FROM TRS_AGMT_RAIL_SCG_RT" ).append("\n"); 
		query.append("                                                  UNPIVOT INCLUDE NULLS" ).append("\n"); 
		query.append("                                                          (NUM_VAL FOR AGMT_EQ_SZ_NO2 IN (FX_SCG_ALL_RT AS 'AL'," ).append("\n"); 
		query.append("                                                                                          FX_SCG_20FT_RT AS '20'," ).append("\n"); 
		query.append("                                                                                          FX_SCG_40FT_RT AS '40'," ).append("\n"); 
		query.append("                                                                                          FX_SCG_45FT_RT AS '45')" ).append("\n"); 
		query.append("                                                          )" ).append("\n"); 
		query.append("                                                  WHERE 1=1" ).append("\n"); 
		query.append("                                                    AND TRSP_RAIL_SCG_CD NOT IN ('FSG')" ).append("\n"); 
		query.append("                                               )" ).append("\n"); 
		query.append("                                         WHERE NUM_VAL IS NOT NULL" ).append("\n"); 
		query.append("                                           AND AGMT_EQ_SZ_NO2 IN ( " ).append("\n"); 
		query.append("                                                                    (CASE WHEN SUBSTR(@[eq_tp_sz_cd], 2, 1) = '2' OR SUBSTR(@[eq_tp_sz_cd], 2, 1) = '3' THEN '20'" ).append("\n"); 
		query.append("                                                                          WHEN SUBSTR(@[eq_tp_sz_cd], 2, 1) = '4' OR SUBSTR(@[eq_tp_sz_cd], 2, 1) = '5' THEN '40'" ).append("\n"); 
		query.append("                                                                          WHEN SUBSTR(@[eq_tp_sz_cd], 2, 1) = '6' OR SUBSTR(@[eq_tp_sz_cd], 2, 1) = '7' THEN '45'" ).append("\n"); 
		query.append("                                                                     END), " ).append("\n"); 
		query.append("                                                                     'AL'" ).append("\n"); 
		query.append("                                                                 )" ).append("\n"); 
		query.append("                                       ) B" ).append("\n"); 
		query.append("                                 WHERE A.TRSP_AGMT_SCG_SEQ = B.TRSP_AGMT_SCG_SEQ" ).append("\n"); 
		query.append("                                   AND TRSP_RAIL_SCG_CD != 'FSG'" ).append("\n"); 
		query.append("                                   AND (   A.SPCL_CGO_CNTR_TP_CD IS NULL " ).append("\n"); 
		query.append("                                        OR " ).append("\n"); 
		query.append("                                           CASE WHEN @[spcl_cgo_cntr_tp_cd] IS NULL THEN A.SPCL_CGO_CNTR_TP_CD" ).append("\n"); 
		query.append("                                                WHEN @[spcl_cgo_cntr_tp_cd] NOT IN ('DG', 'AD', 'RD') THEN A.SPCL_CGO_CNTR_TP_CD" ).append("\n"); 
		query.append("                                                ELSE @[spcl_cgo_cntr_tp_cd]" ).append("\n"); 
		query.append("                                           END = A.SPCL_CGO_CNTR_TP_CD" ).append("\n"); 
		query.append("                                       )" ).append("\n"); 
		query.append("                              ) A" ).append("\n"); 
		query.append("                             ,MDM_VENDOR C" ).append("\n"); 
		query.append("                             ,TRS_TRSP_RAIL_BIL_VNDR_SET G" ).append("\n"); 
		query.append("                        WHERE 1=1" ).append("\n"); 
		query.append("                          AND A.VNDR_SEQ = C.VNDR_SEQ" ).append("\n"); 
		query.append("                          AND A.TRSP_RAIL_SCG_CD IS NOT NULL" ).append("\n"); 
		query.append("                          AND NVL(A.FM_NOD_CD, '00') = DECODE(LENGTH(NVL(A.FM_NOD_CD, '00')), 7, G.FM_NOD_CD, 5, SUBSTR(G.FM_NOD_CD, 1, 5), '00')" ).append("\n"); 
		query.append("                          AND NVL(A.TO_NOD_CD, '00') = DECODE(LENGTH(NVL(A.TO_NOD_CD, '00')), 7, G.TO_NOD_CD, 5, SUBSTR(G.TO_NOD_CD, 1, 5), '00')" ).append("\n"); 
		query.append("                          AND NVL(A.CGO_TP_CD, DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')) = DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')" ).append("\n"); 
		query.append("                          AND NVL(A.LBS_OVR_WGT, 0) <= NVL(@[wgt_qty], 1)" ).append("\n"); 
		query.append("                          AND G.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]" ).append("\n"); 
		query.append("                          AND G.TRSP_SO_SEQ = @[trsp_so_seq]" ).append("\n"); 
		query.append("                          AND A.VNDR_SEQ = G.VNDR_SEQ" ).append("\n"); 
		query.append("               )" ).append("\n"); 
		query.append("	) AGMT" ).append("\n"); 
		query.append("  , (" ).append("\n"); 
		query.append("	    SELECT A.TRSP_SO_OFC_CTY_CD,A.TRSP_SO_SEQ,A.SUB_RAIL_SEQ,A.VNDR_SEQ,A.TRSP_AGMT_OFC_CTY_CD,A.TRSP_AGMT_SEQ, @[eq_tp_sz_cd] AS EQ_TPSZ_CD, B.TRSP_AGMT_SCG_SEQ," ).append("\n"); 
		query.append("	           B.TRSP_RAIL_SCG_CD, B.SCG_APLY_AMT AS NUM_VAL" ).append("\n"); 
		query.append("              ,NVL(B.COM_SCG_KND_CD, 'XXXXXX') AS COM_SCG_KND_CD" ).append("\n"); 
		query.append("              ,NVL(B.COM_SCG_SEQ, -1) AS COM_SCG_SEQ" ).append("\n"); 
		query.append("	      FROM TRS_TRSP_RAIL_BIL_VNDR_SET A" ).append("\n"); 
		query.append("	          ,TRS_RAIL_BIL_VNDR_SET_APLY B" ).append("\n"); 
		query.append("	     WHERE 1=1    " ).append("\n"); 
		query.append("	       AND A.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]" ).append("\n"); 
		query.append("	       AND A.TRSP_SO_SEQ = @[trsp_so_seq]" ).append("\n"); 
		query.append("	       AND A.TRSP_SO_OFC_CTY_CD = B.TRSP_SO_OFC_CTY_CD" ).append("\n"); 
		query.append("	       AND A.TRSP_SO_SEQ = B.TRSP_SO_SEQ" ).append("\n"); 
		query.append("	       AND A.SUB_RAIL_SEQ = B.SUB_RAIL_SEQ" ).append("\n"); 
		query.append("	) APLD" ).append("\n"); 
		query.append("   ,TRS_TRSP_RAIL_BIL_VNDR_SET VNDR" ).append("\n"); 
		query.append("WHERE 1=1" ).append("\n"); 
		query.append("  AND SUBSTR(AGMT.AGMT_NO,1,3) = APLD.TRSP_AGMT_OFC_CTY_CD(+)" ).append("\n"); 
		query.append("  AND SUBSTR(AGMT.AGMT_NO,4) = APLD.TRSP_AGMT_SEQ(+)" ).append("\n"); 
		query.append("  AND AGMT.VNDR_SEQ = APLD.VNDR_SEQ(+)" ).append("\n"); 
		query.append("  AND AGMT.TRSP_RAIL_SCG_CD = APLD.TRSP_RAIL_SCG_CD(+)" ).append("\n"); 
		query.append("  AND AGMT.TRSP_AGMT_SCG_SEQ = APLD.TRSP_AGMT_SCG_SEQ(+)" ).append("\n"); 
		query.append("  AND AGMT.COM_SCG_KND_CD = APLD.COM_SCG_KND_CD(+)" ).append("\n"); 
		query.append("  AND AGMT.COM_SCG_SEQ = APLD.COM_SCG_SEQ(+)" ).append("\n"); 
		query.append("  AND VNDR.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]" ).append("\n"); 
		query.append("  AND VNDR.TRSP_SO_SEQ = @[trsp_so_seq]" ).append("\n"); 
		query.append("  AND SUBSTR(AGMT.AGMT_NO,1,3) = VNDR.TRSP_AGMT_OFC_CTY_CD" ).append("\n"); 
		query.append("  AND SUBSTR(AGMT.AGMT_NO,4) = VNDR.TRSP_AGMT_SEQ" ).append("\n"); 
		query.append("  AND AGMT.VNDR_SEQ = VNDR.VNDR_SEQ" ).append("\n"); 
		query.append("  AND AGMT.TRSP_AGMT_SCG_SEQ = APLD.TRSP_AGMT_SCG_SEQ" ).append("\n"); 
		query.append("-----------------------------------------------------------------------------------------------------------------" ).append("\n"); 
		query.append("UNION" ).append("\n"); 
		query.append("-----------------------------------------------------------------------------------------------------------------" ).append("\n"); 
		query.append("SELECT AGMT.VNDR_SEQ, AGMT.VNDR_NM, AGMT.AGMT_NO, AGMT.TRSP_RAIL_SCG_CD, AGMT.COM_SCG_APLY_FLG, AGMT.WO_APLY_FLG, AGMT.FM_NOD_CD, AGMT.TO_NOD_CD, " ).append("\n"); 
		query.append("       AGMT.AGMT_SCG_RT_DIV_CD, AGMT.TRSP_RAIL_RTO, AGMT.CURR_CD, AGMT.NUM_VAL AS TRSP_RT, AGMT.TRSP_AGMT_SCG_SEQ," ).append("\n"); 
		query.append("       AGMT.CGO_TP_CD, AGMT.AGMT_EQ_SZ_NO, AGMT.LBS_OVR_WGT, AGMT.WGT_MEAS_UT_CD, AGMT.USR_DEF_RMK," ).append("\n"); 
		query.append("       DECODE(AGMT.COM_SCG_KND_CD,'XXXXXX', NULL, AGMT.COM_SCG_KND_CD) AS COM_SCG_KND_CD," ).append("\n"); 
		query.append("       DECODE(AGMT.COM_SCG_SEQ,-1, NULL, AGMT.COM_SCG_SEQ) AS COM_SCG_SEQ," ).append("\n"); 
		query.append("       AGMT.SPCL_CGO_CNTR_TP_CD," ).append("\n"); 
		query.append("       VNDR.SUB_RAIL_SEQ, APLD.NUM_VAL APPL_RT, APLD.NUM_VAL APPL_RT_HIDDEN, DECODE(APLD.NUM_VAL, NULL, '0', '1') IBCHK," ).append("\n"); 
		query.append("       @[trsp_so_ofc_cty_cd] AS TRSP_SO_OFC_CTY_CD, @[trsp_so_seq] AS TRSP_SO_SEQ," ).append("\n"); 
		query.append("       VNDR.BZC_AMT, AGMT.RAIL_RTO_NO," ).append("\n"); 
		query.append("       AGMT.EFF_FM_DT,AGMT.EFF_TO_DT, APLD.TRSP_AGMT_SCG_SEQ TRSP_AGMT_SCG_SEQ2," ).append("\n"); 
		query.append("       CASE WHEN SUBSTR(@[basis_dt],1,8) BETWEEN TO_CHAR(AGMT.EFF_FM_DT,'YYYYMMDD') AND TO_CHAR(AGMT.EFF_TO_DT,'YYYYMMDD') THEN ''" ).append("\n"); 
		query.append("            ELSE 'Not Matched'" ).append("\n"); 
		query.append("       END RATE_STS" ).append("\n"); 
		query.append("FROM (" ).append("\n"); 
		query.append("        SELECT * " ).append("\n"); 
		query.append("          FROM (" ).append("\n"); 
		query.append("                        /* FSG-NOT COMMON */" ).append("\n"); 
		query.append("                        SELECT A.VNDR_SEQ AS VNDR_SEQ" ).append("\n"); 
		query.append("                              ,C.VNDR_LGL_ENG_NM AS VNDR_NM" ).append("\n"); 
		query.append("                              ,A.TRSP_AGMT_OFC_CTY_CD||A.TRSP_AGMT_SEQ AS AGMT_NO" ).append("\n"); 
		query.append("                              ,A.TRSP_RAIL_SCG_CD" ).append("\n"); 
		query.append("                              ,A.TRSP_RAIL_SCG_CD TRSP_RAIL_SCG_NM" ).append("\n"); 
		query.append("                              ,A.COM_SCG_APLY_FLG" ).append("\n"); 
		query.append("                              ,A.WO_APLY_FLG" ).append("\n"); 
		query.append("                              ,DECODE(A.FM_NOD_CD, '00', '', A.FM_NOD_CD) AS FM_NOD_CD" ).append("\n"); 
		query.append("                              ,DECODE(A.TO_NOD_CD, '00', '', A.TO_NOD_CD) AS TO_NOD_CD" ).append("\n"); 
		query.append("                              ,'Ratio' AS AGMT_SCG_RT_DIV_CD" ).append("\n"); 
		query.append("                              ,A.TRSP_RAIL_RTO AS TRSP_RAIL_RTO" ).append("\n"); 
		query.append("                              ,@[curr_cd] AS CURR_CD" ).append("\n"); 
		query.append("                              ,A.FX_SCG_ALL_RT AS FX_SCG_ALL_RT" ).append("\n"); 
		query.append("                              ,A.FX_SCG_20FT_RT AS FX_SCG_20FT_RT" ).append("\n"); 
		query.append("                              ,A.FX_SCG_40FT_RT AS FX_SCG_40FT_RT" ).append("\n"); 
		query.append("                              ,A.FX_SCG_45FT_RT AS FX_SCG_45FT_RT" ).append("\n"); 
		query.append("                               /* APPLIED AMOUNT */" ).append("\n"); 
		query.append("                              ,A.SPCL_CGO_CNTR_TP_CD" ).append("\n"); 
		query.append("                              ,A.AGMT_EQ_SZ_NO2 AS AGMT_EQ_SZ_NO" ).append("\n"); 
		query.append("                              ,A.LBS_OVR_WGT" ).append("\n"); 
		query.append("                              ,DECODE(A.TRSP_RAIL_SCG_CD, 'OWS', 'LBS', NULL) WGT_MEAS_UT_CD" ).append("\n"); 
		query.append("                              ,A.USR_DEF_RMK" ).append("\n"); 
		query.append("                              ,A.CGO_TP_CD" ).append("\n"); 
		query.append("                              ,A.TRSP_AGMT_SCG_SEQ AS TRSP_AGMT_SCG_SEQ" ).append("\n"); 
		query.append("                              ,A.NUM_VAL" ).append("\n"); 
		query.append("                              ,'XXXXXX' AS COM_SCG_KND_CD" ).append("\n"); 
		query.append("                              ,-1 AS COM_SCG_SEQ" ).append("\n"); 
		query.append("                              ,A.RAIL_RTO_NO" ).append("\n"); 
		query.append("                              ,A.EFF_FM_DT" ).append("\n"); 
		query.append("                              ,A.EFF_TO_DT" ).append("\n"); 
		query.append("                         FROM (" ).append("\n"); 
		query.append("                                SELECT 'AL' AS AGMT_EQ_SZ_NO2" ).append("\n"); 
		query.append("                                      ,NULL AS NUM_VAL" ).append("\n"); 
		query.append("                                      ,A.* " ).append("\n"); 
		query.append("                                  FROM TRS_AGMT_RAIL_SCG_RT A" ).append("\n"); 
		query.append("                                 WHERE TRSP_RAIL_SCG_CD = 'FSG'" ).append("\n"); 
		query.append("                                   AND NVL(COM_SCG_APLY_FLG, '0') = '0'" ).append("\n"); 
		query.append("                                   AND TRSP_RAIL_SCG_CD IS NOT NULL" ).append("\n"); 
		query.append("                                   AND SUBSTR(@[basis_dt],1,8) BETWEEN TO_CHAR(EFF_FM_DT,'YYYYMMDD') AND TO_CHAR(EFF_TO_DT,'YYYYMMDD')" ).append("\n"); 
		query.append("                                   AND NVL(CGO_TP_CD, DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')) = DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')" ).append("\n"); 
		query.append("                              ) A" ).append("\n"); 
		query.append("                             ,MDM_VENDOR C" ).append("\n"); 
		query.append("                             ,TRS_TRSP_RAIL_BIL_VNDR_SET G" ).append("\n"); 
		query.append("                        WHERE 1=1" ).append("\n"); 
		query.append("                          AND A.VNDR_SEQ = C.VNDR_SEQ" ).append("\n"); 
		query.append("                          AND NVL(A.FM_NOD_CD, '00') = DECODE(LENGTH(NVL(A.FM_NOD_CD, '00')), 7, G.FM_NOD_CD, 5, SUBSTR(G.FM_NOD_CD, 1, 5), '00')" ).append("\n"); 
		query.append("                          AND NVL(A.TO_NOD_CD, '00') = DECODE(LENGTH(NVL(A.TO_NOD_CD, '00')), 7, G.TO_NOD_CD, 5, SUBSTR(G.TO_NOD_CD, 1, 5), '00')" ).append("\n"); 
		query.append("                          AND G.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]" ).append("\n"); 
		query.append("                          AND G.TRSP_SO_SEQ = @[trsp_so_seq]" ).append("\n"); 
		query.append("                          AND A.VNDR_SEQ = G.VNDR_SEQ" ).append("\n"); 
		query.append("                        UNION ALL" ).append("\n"); 
		query.append("                        /* FSG-COMMON 2 */" ).append("\n"); 
		query.append("                        SELECT F.VNDR_SEQ AS VNDR_SEQ" ).append("\n"); 
		query.append("                              ,C.VNDR_LGL_ENG_NM AS VNDR_NM" ).append("\n"); 
		query.append("                              ,F.TRSP_AGMT_OFC_CTY_CD||F.TRSP_AGMT_SEQ AS AGMT_NO" ).append("\n"); 
		query.append("                              ,F.TRSP_RAIL_SCG_CD" ).append("\n"); 
		query.append("                              ,F.TRSP_RAIL_SCG_CD TRSP_RAIL_SCG_NM" ).append("\n"); 
		query.append("                              ,F.COM_SCG_APLY_FLG" ).append("\n"); 
		query.append("                              ,F.WO_APLY_FLG" ).append("\n"); 
		query.append("                              ,DECODE(F.FM_NOD_CD, '00', '', F.FM_NOD_CD) AS FM_NOD_CD" ).append("\n"); 
		query.append("                              ,DECODE(F.TO_NOD_CD, '00', '', F.TO_NOD_CD) AS TO_NOD_CD" ).append("\n"); 
		query.append("                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN 'Fixed'" ).append("\n"); 
		query.append("                                    ELSE 'Ratio'" ).append("\n"); 
		query.append("                               END AS AGMT_SCG_RT_DIV_CD" ).append("\n"); 
		query.append("                              ,F.TRSP_ONE_WY_RT AS TRSP_RAIL_RTO" ).append("\n"); 
		query.append("                              ,@[curr_cd] AS CURR_CD" ).append("\n"); 
		query.append("                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN F.TRSP_ONE_WY_RT" ).append("\n"); 
		query.append("                                    ELSE NULL" ).append("\n"); 
		query.append("                               END AS FX_SCG_ALL_RT" ).append("\n"); 
		query.append("                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN F.TRSP_ONE_WY_RT" ).append("\n"); 
		query.append("                                    ELSE NULL" ).append("\n"); 
		query.append("                               END AS FX_SCG_20FT_RT" ).append("\n"); 
		query.append("                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN F.TRSP_ONE_WY_RT" ).append("\n"); 
		query.append("                                    ELSE NULL" ).append("\n"); 
		query.append("                               END AS FX_SCG_40FT_RT" ).append("\n"); 
		query.append("                              ,CASE WHEN F.AGMT_SCG_RT_DIV_CD = 'F' THEN F.TRSP_ONE_WY_RT" ).append("\n"); 
		query.append("                                    ELSE NULL" ).append("\n"); 
		query.append("                               END AS FX_SCG_45FT_RT" ).append("\n"); 
		query.append("                               /* APPLIED AMOUNT */" ).append("\n"); 
		query.append("                              ,F.SPCL_CGO_CNTR_TP_CD" ).append("\n"); 
		query.append("                              ,F.AGMT_EQ_SZ_NO AS AGMT_EQ_SZ_NO" ).append("\n"); 
		query.append("                              ,0 AS LBS_OVR_WGT" ).append("\n"); 
		query.append("                              ,NULL AS WGT_MEAS_UT_CD" ).append("\n"); 
		query.append("                              ,F.USR_DEF_RMK" ).append("\n"); 
		query.append("                              ,F.CGO_TP_CD" ).append("\n"); 
		query.append("                              ,F.TRSP_AGMT_SCG_SEQ AS TRSP_AGMT_SCG_SEQ" ).append("\n"); 
		query.append("                              ,NULL AS NUM_VAL" ).append("\n"); 
		query.append("                              ,F.COM_SCG_KND_CD" ).append("\n"); 
		query.append("                              ,F.COM_SCG_SEQ" ).append("\n"); 
		query.append("                              ,F.RAIL_RTO_NO" ).append("\n"); 
		query.append("                              ,F.EFF_FM_DT" ).append("\n"); 
		query.append("                              ,F.EFF_TO_DT" ).append("\n"); 
		query.append("                         FROM MDM_VENDOR C" ).append("\n"); 
		query.append("                             ,(SELECT COM_SCG_KND_CD" ).append("\n"); 
		query.append("                                     ,EQ_TPSZ_CD AS TRSP_AGMT_EQ_TP_SZ_CD" ).append("\n"); 
		query.append("                                     ,CURR_CD" ).append("\n"); 
		query.append("                                     ,RT_TP_CD AS AGMT_SCG_RT_DIV_CD" ).append("\n"); 
		query.append("                                     ,NVL(ONE_WY_RT, RND_RT) TRSP_ONE_WY_RT" ).append("\n"); 
		query.append("                                     ,0 TRSP_RND_RT" ).append("\n"); 
		query.append("                                     ,NVL(ONE_WY_RT, RND_RT) ETC_ADD_AMT" ).append("\n"); 
		query.append("                                     ,AGMT_EQ_SZ_NO AS AGMT_EQ_SZ_NO" ).append("\n"); 
		query.append("                                     ,EQ_TPSZ_CD AS EQ_TPSZ_CD" ).append("\n"); 
		query.append("                                     ,COM_SCG_SEQ" ).append("\n"); 
		query.append("                                     ,TRSP_SO_OFC_CTY_CD" ).append("\n"); 
		query.append("                                     ,TRSP_SO_SEQ" ).append("\n"); 
		query.append("                                     ,SUB_RAIL_SEQ" ).append("\n"); 
		query.append("                                     ,VNDR_SEQ" ).append("\n"); 
		query.append("                                     ,TRSP_AGMT_SCG_SEQ" ).append("\n"); 
		query.append("                                     ,USR_DEF_RMK" ).append("\n"); 
		query.append("                                     ,CGO_TP_CD" ).append("\n"); 
		query.append("                                     ,SPCL_CGO_CNTR_TP_CD" ).append("\n"); 
		query.append("                                     ,FM_NOD_CD" ).append("\n"); 
		query.append("                                     ,TO_NOD_CD" ).append("\n"); 
		query.append("                                     ,TRSP_AGMT_OFC_CTY_CD" ).append("\n"); 
		query.append("                                     ,TRSP_AGMT_SEQ" ).append("\n"); 
		query.append("                                     ,TRSP_RAIL_SCG_CD" ).append("\n"); 
		query.append("                                     ,COM_SCG_APLY_FLG" ).append("\n"); 
		query.append("                                     ,WO_APLY_FLG" ).append("\n"); 
		query.append("                                     ,RAIL_RTO_NO" ).append("\n"); 
		query.append("                                     ,EFF_FM_DT" ).append("\n"); 
		query.append("                                     ,EFF_TO_DT" ).append("\n"); 
		query.append("                                 FROM (" ).append("\n"); 
		query.append("                                         SELECT 'FSG' AS COM_SCG_KND_CD" ).append("\n"); 
		query.append("                                               ,ONE_WY_RT" ).append("\n"); 
		query.append("                                               ,RND_RT" ).append("\n"); 
		query.append("                                               ,EQ_TPSZ_CD" ).append("\n"); 
		query.append("                                               ,CSM.CURR_CD" ).append("\n"); 
		query.append("                                               ,RT_TP_CD" ).append("\n"); 
		query.append("                                               ,CASE WHEN SUBSTR(EQ_TPSZ_CD, 1, 2) = 'AL' THEN" ).append("\n"); 
		query.append("                                                            CASE SUBSTR(EQ_TPSZ_CD, 3, 1) WHEN '2' THEN '20'" ).append("\n"); 
		query.append("                                                                                          WHEN '3' THEN '20'" ).append("\n"); 
		query.append("                                                                                          WHEN '4' THEN '40'" ).append("\n"); 
		query.append("                                                                                          WHEN '5' THEN '40'" ).append("\n"); 
		query.append("                                                                                          WHEN '6' THEN '45'" ).append("\n"); 
		query.append("                                                                                          WHEN '7' THEN '45'" ).append("\n"); 
		query.append("                                                                                          ELSE 'AL'" ).append("\n"); 
		query.append("                                                            END" ).append("\n"); 
		query.append("                                                     WHEN SUBSTR(EQ_TPSZ_CD, 1, 2) <> 'AL' THEN" ).append("\n"); 
		query.append("                                                            CASE SUBSTR(EQ_TPSZ_CD, 2, 1) WHEN '2' THEN '20'" ).append("\n"); 
		query.append("                                                                                          WHEN '3' THEN '20'" ).append("\n"); 
		query.append("                                                                                          WHEN '4' THEN '40'" ).append("\n"); 
		query.append("                                                                                          WHEN '5' THEN '40'" ).append("\n"); 
		query.append("                                                                                          WHEN '6' THEN '45'" ).append("\n"); 
		query.append("                                                                                          WHEN '7' THEN '45'" ).append("\n"); 
		query.append("                                                                                          ELSE 'AL'" ).append("\n"); 
		query.append("                                                            END" ).append("\n"); 
		query.append("                                                END AS AGMT_EQ_SZ_NO" ).append("\n"); 
		query.append("                                               ,COM_SCG_SEQ" ).append("\n"); 
		query.append("                                               ,RBVS.TRSP_SO_OFC_CTY_CD" ).append("\n"); 
		query.append("                                               ,RBVS.TRSP_SO_SEQ" ).append("\n"); 
		query.append("                                               ,RBVS.SUB_RAIL_SEQ" ).append("\n"); 
		query.append("                                               ,RBVS.VNDR_SEQ" ).append("\n"); 
		query.append("                                               ,A.TRSP_AGMT_SCG_SEQ" ).append("\n"); 
		query.append("                                               ,A.USR_DEF_RMK" ).append("\n"); 
		query.append("                                               ,A.CGO_TP_CD" ).append("\n"); 
		query.append("                                               ,A.SPCL_CGO_CNTR_TP_CD" ).append("\n"); 
		query.append("                                               ,A.FM_NOD_CD" ).append("\n"); 
		query.append("                                               ,A.TO_NOD_CD" ).append("\n"); 
		query.append("                                               ,A.TRSP_AGMT_OFC_CTY_CD" ).append("\n"); 
		query.append("                                               ,A.TRSP_AGMT_SEQ" ).append("\n"); 
		query.append("                                               ,A.TRSP_RAIL_SCG_CD" ).append("\n"); 
		query.append("                                               ,A.COM_SCG_APLY_FLG" ).append("\n"); 
		query.append("                                               ,A.WO_APLY_FLG" ).append("\n"); 
		query.append("                                               ,A.RAIL_RTO_NO" ).append("\n"); 
		query.append("                                               ,A.EFF_FM_DT" ).append("\n"); 
		query.append("                                               ,A.EFF_TO_DT" ).append("\n"); 
		query.append("                                           FROM TRS_COM_SCG_MGMT CSM" ).append("\n"); 
		query.append("                                               ,(" ).append("\n"); 
		query.append("                                                     SELECT 'AL' AS AGMT_EQ_SZ_NO2" ).append("\n"); 
		query.append("                                                           ,A.* " ).append("\n"); 
		query.append("                                                       FROM TRS_AGMT_RAIL_SCG_RT A" ).append("\n"); 
		query.append("                                                      WHERE TRSP_RAIL_SCG_CD = 'FSG'" ).append("\n"); 
		query.append("                                                        AND NVL(A.COM_SCG_APLY_FLG, '0') = '1'" ).append("\n"); 
		query.append("                                                        AND A.TRSP_RAIL_SCG_CD IS NOT NULL" ).append("\n"); 
		query.append("                                                        AND SUBSTR(@[basis_dt],1,8) BETWEEN TO_CHAR(A.EFF_FM_DT,'YYYYMMDD') AND TO_CHAR(A.EFF_TO_DT,'YYYYMMDD')" ).append("\n"); 
		query.append("                                                        AND NVL(A.CGO_TP_CD, DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')) = DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')" ).append("\n"); 
		query.append("                                                ) A" ).append("\n"); 
		query.append("                                               ,(" ).append("\n"); 
		query.append("                                                    SELECT TRSP_SO_OFC_CTY_CD" ).append("\n"); 
		query.append("                                                          ,TRSP_SO_SEQ" ).append("\n"); 
		query.append("                                                          ,SUB_RAIL_SEQ" ).append("\n"); 
		query.append("                                                          ,VNDR_SEQ" ).append("\n"); 
		query.append("                                                          ,FM_NOD_CD" ).append("\n"); 
		query.append("                                                          ,TO_NOD_CD " ).append("\n"); 
		query.append("                                                      FROM TRS_TRSP_RAIL_BIL_VNDR_SET" ).append("\n"); 
		query.append("                                                     WHERE 1=1" ).append("\n"); 
		query.append("                                                       AND TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]" ).append("\n"); 
		query.append("                                                       AND TRSP_SO_SEQ = @[trsp_so_seq]" ).append("\n"); 
		query.append("                                                ) RBVS" ).append("\n"); 
		query.append("                                          WHERE 1=1" ).append("\n"); 
		query.append("                                            AND TRSP_COST_MOD_CD = 'CY'" ).append("\n"); 
		query.append("                                            AND AGMT_TRSP_TP_CD  = 'RD'" ).append("\n"); 
		query.append("                                            AND (SCC_CD = MST_LOC_FNC(SUBSTR(RBVS.FM_NOD_CD, 1, 5),'SCC') OR" ).append("\n"); 
		query.append("                                                 LCC_CD IN (MST_LOC_FNC(SUBSTR(RBVS.FM_NOD_CD, 1, 5),'LCC')) OR" ).append("\n"); 
		query.append("                                                 RCC_CD IN (MST_LOC_FNC(SUBSTR(RBVS.FM_NOD_CD, 1, 5),'RCC'))" ).append("\n"); 
		query.append("                                                )" ).append("\n"); 
		query.append("                                            AND NVL(CSM.CGO_TP_CD, DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')) = DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')" ).append("\n"); 
		query.append("                                            AND NVL(CSM.BND_CD, NVL(@[bound_cd],'X')) = NVL(@[bound_cd],'X')" ).append("\n"); 
		query.append("                                            AND CSM.COM_SCG_KND_CD = 'SCFAAL'" ).append("\n"); 
		query.append("                                            AND SUBSTR(@[basis_dt],1,8) BETWEEN TO_CHAR(CSM.EFF_FM_DT,'YYYYMMDD') AND TO_CHAR(CSM.EFF_TO_DT,'YYYYMMDD')                                            " ).append("\n"); 
		query.append("                                            AND NVL(A.FM_NOD_CD, '00') = DECODE(LENGTH(NVL(A.FM_NOD_CD, '00')), 7, RBVS.FM_NOD_CD, 5, SUBSTR(RBVS.FM_NOD_CD, 1, 5), '00')" ).append("\n"); 
		query.append("                                            AND NVL(A.TO_NOD_CD, '00') = DECODE(LENGTH(NVL(A.TO_NOD_CD, '00')), 7, RBVS.TO_NOD_CD, 5, SUBSTR(RBVS.TO_NOD_CD, 1, 5), '00')" ).append("\n"); 
		query.append("                                            AND RBVS.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]" ).append("\n"); 
		query.append("                                            AND RBVS.TRSP_SO_SEQ = @[trsp_so_seq]" ).append("\n"); 
		query.append("                                            AND A.VNDR_SEQ = RBVS.VNDR_SEQ" ).append("\n"); 
		query.append("                                      )" ).append("\n"); 
		query.append("                               ) F" ).append("\n"); 
		query.append("                        WHERE 1=1" ).append("\n"); 
		query.append("                          AND F.VNDR_SEQ = C.VNDR_SEQ" ).append("\n"); 
		query.append("                        UNION ALL" ).append("\n"); 
		query.append("                        /* ETC */" ).append("\n"); 
		query.append("                        SELECT A.VNDR_SEQ AS VNDR_SEQ" ).append("\n"); 
		query.append("                              ,C.VNDR_LGL_ENG_NM AS VNDR_NM" ).append("\n"); 
		query.append("                              ,A.TRSP_AGMT_OFC_CTY_CD||A.TRSP_AGMT_SEQ AS AGMT_NO" ).append("\n"); 
		query.append("                              ,A.TRSP_RAIL_SCG_CD" ).append("\n"); 
		query.append("                              ,A.TRSP_RAIL_SCG_CD TRSP_RAIL_SCG_NM" ).append("\n"); 
		query.append("                              ,A.COM_SCG_APLY_FLG" ).append("\n"); 
		query.append("                              ,A.WO_APLY_FLG" ).append("\n"); 
		query.append("                              ,DECODE(A.FM_NOD_CD, '00', '', A.FM_NOD_CD) AS FM_NOD_CD" ).append("\n"); 
		query.append("                              ,DECODE(A.TO_NOD_CD, '00', '', A.TO_NOD_CD) AS TO_NOD_CD" ).append("\n"); 
		query.append("                              ,'Fixed' AS AGMT_SCG_RT_DIV_CD" ).append("\n"); 
		query.append("                              ,A.TRSP_RAIL_RTO AS TRSP_RAIL_RTO" ).append("\n"); 
		query.append("                              ,DECODE(A.CURR_CD, 'XXX', NULL, A.CURR_CD) AS CURR_CD" ).append("\n"); 
		query.append("                              ,A.FX_SCG_ALL_RT AS FX_SCG_ALL_RT" ).append("\n"); 
		query.append("                              ,A.FX_SCG_20FT_RT AS FX_SCG_20FT_RT" ).append("\n"); 
		query.append("                              ,A.FX_SCG_40FT_RT AS FX_SCG_40FT_RT" ).append("\n"); 
		query.append("                              ,A.FX_SCG_45FT_RT AS FX_SCG_45FT_RT" ).append("\n"); 
		query.append("                               /* APPLIED AMOUNT */" ).append("\n"); 
		query.append("                              ,A.SPCL_CGO_CNTR_TP_CD" ).append("\n"); 
		query.append("                              ,A.AGMT_EQ_SZ_NO2 AS AGMT_EQ_SZ_NO" ).append("\n"); 
		query.append("                              ,A.LBS_OVR_WGT" ).append("\n"); 
		query.append("                              ,DECODE(A.TRSP_RAIL_SCG_CD, 'OWS', 'LBS', NULL) WGT_MEAS_UT_CD" ).append("\n"); 
		query.append("                              ,A.USR_DEF_RMK" ).append("\n"); 
		query.append("                              ,A.CGO_TP_CD" ).append("\n"); 
		query.append("                              ,A.TRSP_AGMT_SCG_SEQ AS TRSP_AGMT_SCG_SEQ" ).append("\n"); 
		query.append("                              ,A.NUM_VAL" ).append("\n"); 
		query.append("                              ,'XXXXXX' AS COM_SCG_KND_CD" ).append("\n"); 
		query.append("                              ,-1 AS COM_SCG_SEQ" ).append("\n"); 
		query.append("                              ,NULL AS RAIL_RTO_NO" ).append("\n"); 
		query.append("                              ,A.EFF_FM_DT" ).append("\n"); 
		query.append("                              ,A.EFF_TO_DT" ).append("\n"); 
		query.append("                         FROM (                        " ).append("\n"); 
		query.append("                                SELECT B.AGMT_EQ_SZ_NO2" ).append("\n"); 
		query.append("                                      ,B.NUM_VAL" ).append("\n"); 
		query.append("                                      ,A.* " ).append("\n"); 
		query.append("                                  FROM TRS_AGMT_RAIL_SCG_RT A" ).append("\n"); 
		query.append("                                      ,(SELECT * " ).append("\n"); 
		query.append("                                          FROM (" ).append("\n"); 
		query.append("                                                  SELECT TRSP_AGMT_SCG_SEQ" ).append("\n"); 
		query.append("                                                        ,AGMT_EQ_SZ_NO2" ).append("\n"); 
		query.append("                                                        ,NUM_VAL" ).append("\n"); 
		query.append("                                                    FROM TRS_AGMT_RAIL_SCG_RT" ).append("\n"); 
		query.append("                                                  UNPIVOT INCLUDE NULLS" ).append("\n"); 
		query.append("                                                          (NUM_VAL FOR AGMT_EQ_SZ_NO2 IN (FX_SCG_ALL_RT AS 'AL'," ).append("\n"); 
		query.append("                                                                                          FX_SCG_20FT_RT AS '20'," ).append("\n"); 
		query.append("                                                                                          FX_SCG_40FT_RT AS '40'," ).append("\n"); 
		query.append("                                                                                          FX_SCG_45FT_RT AS '45')" ).append("\n"); 
		query.append("                                                          )" ).append("\n"); 
		query.append("                                                  WHERE 1=1" ).append("\n"); 
		query.append("                                                    AND TRSP_RAIL_SCG_CD NOT IN ('FSG')" ).append("\n"); 
		query.append("                                               )" ).append("\n"); 
		query.append("                                         WHERE NUM_VAL IS NOT NULL" ).append("\n"); 
		query.append("                                           AND AGMT_EQ_SZ_NO2 IN ( " ).append("\n"); 
		query.append("                                                                    (CASE WHEN SUBSTR(@[eq_tp_sz_cd], 2, 1) = '2' OR SUBSTR(@[eq_tp_sz_cd], 2, 1) = '3' THEN '20'" ).append("\n"); 
		query.append("                                                                          WHEN SUBSTR(@[eq_tp_sz_cd], 2, 1) = '4' OR SUBSTR(@[eq_tp_sz_cd], 2, 1) = '5' THEN '40'" ).append("\n"); 
		query.append("                                                                          WHEN SUBSTR(@[eq_tp_sz_cd], 2, 1) = '6' OR SUBSTR(@[eq_tp_sz_cd], 2, 1) = '7' THEN '45'" ).append("\n"); 
		query.append("                                                                     END), " ).append("\n"); 
		query.append("                                                                     'AL'" ).append("\n"); 
		query.append("                                                                 )" ).append("\n"); 
		query.append("                                       ) B" ).append("\n"); 
		query.append("                                 WHERE A.TRSP_AGMT_SCG_SEQ = B.TRSP_AGMT_SCG_SEQ" ).append("\n"); 
		query.append("                                   AND TRSP_RAIL_SCG_CD != 'FSG'" ).append("\n"); 
		query.append("                                   AND (   A.SPCL_CGO_CNTR_TP_CD IS NULL " ).append("\n"); 
		query.append("                                        OR " ).append("\n"); 
		query.append("                                           CASE WHEN @[spcl_cgo_cntr_tp_cd] IS NULL THEN A.SPCL_CGO_CNTR_TP_CD" ).append("\n"); 
		query.append("                                                WHEN @[spcl_cgo_cntr_tp_cd] NOT IN ('DG', 'AD', 'RD') THEN A.SPCL_CGO_CNTR_TP_CD" ).append("\n"); 
		query.append("                                                ELSE @[spcl_cgo_cntr_tp_cd]" ).append("\n"); 
		query.append("                                           END = A.SPCL_CGO_CNTR_TP_CD" ).append("\n"); 
		query.append("                                       )" ).append("\n"); 
		query.append("                              ) A" ).append("\n"); 
		query.append("                             ,MDM_VENDOR C" ).append("\n"); 
		query.append("                             ,TRS_TRSP_RAIL_BIL_VNDR_SET G" ).append("\n"); 
		query.append("                        WHERE 1=1" ).append("\n"); 
		query.append("                          AND A.VNDR_SEQ = C.VNDR_SEQ" ).append("\n"); 
		query.append("                          AND A.TRSP_RAIL_SCG_CD IS NOT NULL" ).append("\n"); 
		query.append("                          AND NVL(A.FM_NOD_CD, '00') = DECODE(LENGTH(NVL(A.FM_NOD_CD, '00')), 7, G.FM_NOD_CD, 5, SUBSTR(G.FM_NOD_CD, 1, 5), '00')" ).append("\n"); 
		query.append("                          AND NVL(A.TO_NOD_CD, '00') = DECODE(LENGTH(NVL(A.TO_NOD_CD, '00')), 7, G.TO_NOD_CD, 5, SUBSTR(G.TO_NOD_CD, 1, 5), '00')" ).append("\n"); 
		query.append("                          AND SUBSTR(@[basis_dt],1,8) BETWEEN TO_CHAR(A.EFF_FM_DT,'YYYYMMDD') AND TO_CHAR(A.EFF_TO_DT,'YYYYMMDD')" ).append("\n"); 
		query.append("                          AND NVL(A.CGO_TP_CD, DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')) = DECODE(@[cgo_tp_cd], 'F', 'F', 'C', 'F', 'M', 'M')" ).append("\n"); 
		query.append("                          AND NVL(A.LBS_OVR_WGT, 0) <= NVL(@[wgt_qty], 1)" ).append("\n"); 
		query.append("                          AND G.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]" ).append("\n"); 
		query.append("                          AND G.TRSP_SO_SEQ = @[trsp_so_seq]" ).append("\n"); 
		query.append("                          AND A.VNDR_SEQ = G.VNDR_SEQ" ).append("\n"); 
		query.append("               )" ).append("\n"); 
		query.append("	) AGMT" ).append("\n"); 
		query.append("  , (" ).append("\n"); 
		query.append("	    SELECT A.TRSP_SO_OFC_CTY_CD,A.TRSP_SO_SEQ,A.SUB_RAIL_SEQ,A.VNDR_SEQ,A.TRSP_AGMT_OFC_CTY_CD,A.TRSP_AGMT_SEQ, @[eq_tp_sz_cd] AS EQ_TPSZ_CD, B.TRSP_AGMT_SCG_SEQ," ).append("\n"); 
		query.append("	           B.TRSP_RAIL_SCG_CD, B.SCG_APLY_AMT AS NUM_VAL" ).append("\n"); 
		query.append("              ,NVL(B.COM_SCG_KND_CD, 'XXXXXX') AS COM_SCG_KND_CD" ).append("\n"); 
		query.append("              ,NVL(B.COM_SCG_SEQ, -1) AS COM_SCG_SEQ" ).append("\n"); 
		query.append("	      FROM TRS_TRSP_RAIL_BIL_VNDR_SET A" ).append("\n"); 
		query.append("	          ,TRS_RAIL_BIL_VNDR_SET_APLY B" ).append("\n"); 
		query.append("	     WHERE 1=1    " ).append("\n"); 
		query.append("	       AND A.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]" ).append("\n"); 
		query.append("	       AND A.TRSP_SO_SEQ = @[trsp_so_seq]" ).append("\n"); 
		query.append("	       AND A.TRSP_SO_OFC_CTY_CD = B.TRSP_SO_OFC_CTY_CD" ).append("\n"); 
		query.append("	       AND A.TRSP_SO_SEQ = B.TRSP_SO_SEQ" ).append("\n"); 
		query.append("	       AND A.SUB_RAIL_SEQ = B.SUB_RAIL_SEQ" ).append("\n"); 
		query.append("	) APLD" ).append("\n"); 
		query.append("   ,TRS_TRSP_RAIL_BIL_VNDR_SET VNDR" ).append("\n"); 
		query.append("WHERE 1=1" ).append("\n"); 
		query.append("  AND SUBSTR(AGMT.AGMT_NO,1,3) = APLD.TRSP_AGMT_OFC_CTY_CD(+)" ).append("\n"); 
		query.append("  AND SUBSTR(AGMT.AGMT_NO,4) = APLD.TRSP_AGMT_SEQ(+)" ).append("\n"); 
		query.append("  AND AGMT.VNDR_SEQ = APLD.VNDR_SEQ(+)" ).append("\n"); 
		query.append("  AND AGMT.TRSP_RAIL_SCG_CD = APLD.TRSP_RAIL_SCG_CD(+)" ).append("\n"); 
		query.append("  AND AGMT.TRSP_AGMT_SCG_SEQ = APLD.TRSP_AGMT_SCG_SEQ(+)" ).append("\n"); 
		query.append("  AND AGMT.COM_SCG_KND_CD = APLD.COM_SCG_KND_CD(+)" ).append("\n"); 
		query.append("  AND AGMT.COM_SCG_SEQ = APLD.COM_SCG_SEQ(+)" ).append("\n"); 
		query.append("  AND VNDR.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]" ).append("\n"); 
		query.append("  AND VNDR.TRSP_SO_SEQ = @[trsp_so_seq]" ).append("\n"); 
		query.append("  AND SUBSTR(AGMT.AGMT_NO,1,3) = VNDR.TRSP_AGMT_OFC_CTY_CD" ).append("\n"); 
		query.append("  AND SUBSTR(AGMT.AGMT_NO,4) = VNDR.TRSP_AGMT_SEQ" ).append("\n"); 
		query.append("  AND AGMT.VNDR_SEQ = VNDR.VNDR_SEQ" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("ORDER BY SUB_RAIL_SEQ, AGMT_NO, TRSP_RAIL_SCG_CD, TRSP_AGMT_SCG_SEQ2 ASC NULLS LAST, TRSP_AGMT_SCG_SEQ" ).append("\n"); 

	}
}