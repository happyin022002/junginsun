<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RailBillingReqCreateDBDAOsearchRailRampLocationFullRSQL">
			<desc><![CDATA[Rail Billing Full Cntr Request (Rail Ramp)화면에 대한 조회]]></desc>
			<sql><![CDATA[
select a.rout_org_nod_cd																																							
             	   ,a.rout_dest_nod_cd																																							
             	   ,a.rout_seq																																							
             	   ,a.pctl_io_bnd_cd																																							
             	   ,a.org_loc_cd																																							
             	   ,a.org_loc_nm																																							
             	   ,a.org_yd_cd																																							
             	   ,a.org_yd_nm																																							
             	   ,a.org_yd_addr																																							
             	   ,a.dest_loc_cd																																							
             	   ,a.dest_loc_nm																																							
             	   ,a.dest_yd_cd																																							
             	   ,a.dest_yd_nm																																							
             	   ,a.dest_yd_addr																																							
             	   ,a.block_vndr_flg																																							
             	   ,a.rail_bulk_vndr_flg
				   ,a.rail_ns_vndr_flg																																							
             	   ,a.bill_type_flg																																							
             	   ,a.embargo_flg																																							
             	   ,a.tofc_flg																																							
             	   ,a.wrs_full_flg																																							
             	   ,a.auto_irg_flg																																							
               from (                                                                                                                                                       
             SELECT DISTINCT                                                                                                                                                
                         rout_org_nod_cd                                                                                                                                    
                        ,rout_dest_nod_cd                                                                                                                                   
                        ,rout_seq                                                                                                                                           
                        ,prio_seq                                                                                                                                           
                        ,pctl_io_bnd_cd                                                                                                                                     
                        ,org_loc_cd                                                                                                                                         
                        ,org_loc_nm                                                                                                                                         
                        ,org_yd_cd                                                                                                                                          
                        ,org_yd_nm                                                                                                                                          
                        ,org_yd_addr                                                                                                                                        
                        ,dest_loc_cd                                                                                                                                        
                        ,dest_loc_nm                                                                                                                                        
                        ,dest_yd_cd                                                                                                                                         
                        ,dest_yd_nm                                                                                                                                         
                        ,dest_yd_addr                                                                                                                                       
                        ,block_vndr_flg                                                                                                                                     
                        ,rail_bulk_vndr_flg   
						,rail_ns_vndr_flg                                                                                                                              
                        ,bill_type_flg                                                                                                                                      
                        ,embargo_flg                                                                                                                                        
                        ,tofc_flg                                                                                                                                           
                        ,wrs_full_flg                                                                                                                                       
                        ,auto_irg_flg                                                                                                                                       
                        --,max(rail_rout_multi_cnt) over() rail_rout_multi_cnt -- rail org/dest rout媛?媛곴컖 ?ㅻⅤ寃?珥?紐뉕굔?몄?(rail 援ш컙??multi ?몄? ?뺤씤)                   		
                   FROM (                                                                                                                                                   
                        SELECT  /*+ ORDERED USE_NL(cop, act, mst, dtl, yd1, loc1, cnt1, yd2, loc2, cnt2)*/                                                                  
                                 mst.rout_org_nod_cd      rout_org_nod_cd                                                                                                   
                                ,mst.rout_dest_nod_cd     rout_dest_nod_cd                                                                                                  
                                ,mst.rout_seq             rout_seq                                                                                                          
                                ,mst.prio_seq             prio_seq                                                                                                          
                                ,MAX(mst.pctl_io_bnd_cd)       pctl_io_bnd_cd                                                                                               
                                ,MAX(loc1.loc_cd)              org_loc_cd                                                                                                   
                                ,MAX(loc1.loc_nm || ' ' || cnt1.cnt_nm) org_loc_nm                                                                                          
                                ,yd1.yd_cd org_yd_cd                                                                                                                        
                                ,MAX(yd1.yd_nm) org_yd_nm                                                                                                                   
                                ,MAX(yd1.yd_addr) org_yd_addr                                                                                                               
                                ,MAX(loc2.loc_cd) dest_loc_cd                                                                                                               
                                ,MAX(loc2.loc_nm || ' ' || cnt2.cnt_nm) dest_loc_nm                                                                                         
                                ,yd2.yd_cd dest_yd_cd                                                                                                                       
                                ,MAX(yd2.yd_nm) dest_yd_nm                                                                                                                  
                                ,MAX(yd2.yd_addr) dest_yd_addr                                                                                                              
                                ,MAX(DECODE(dtl.vndr_seq, 105484, 'Y', 108386, 'Y', 'N')) block_vndr_flg                                                       
                                ,MAX(DECODE(dtl.vndr_seq, 119993, 'Y', 'N')) rail_bulk_vndr_flg 
								,MAX(DECODE(dtl.vndr_seq, 108299, 'Y', 'N')) rail_ns_vndr_flg                                                                            
                                ,MAX(DECODE(mst.inlnd_rout_inv_bil_patt_cd, 'S2R', 'Y', 'S3R', 'Y', 'N')) bill_type_flg                                                     
                                ,'' embargo_flg                                                                                                                             
                                ,MAX(DECODE(dtl.rail_crr_tp_cd, 'TOI', 'Y', 'TRI', 'Y', 'N')) tofc_flg                                                                      
                                ,MAX(DECODE(mst.wrs_full_cmdt_cd, null, 'N', 'Y')) wrs_full_flg                                                                             
                                ,MAX(act.inv_bil_patt_div_flg) auto_irg_flg                                                                                                 
                               -- ,rank() over(order by yd1.yd_cd, yd2.yd_cd) rail_rout_multi_cnt                                                                             
                            FROM sce_cop_hdr cop                                                                                                                            
                                ,PRD_PROD_CTL_ACT_GRP_DTL act                                                                                                                       
                                ,prd_inlnd_rout_mst mst                                                                                                                     
                                ,prd_inlnd_rout_dtl dtl                                                                                                                     
                                ,mdm_yard yd1                                                                                                                               
                                ,mdm_location loc1                                                                                                                          
                                ,mdm_country cnt1                                                                                                                           
                                ,mdm_yard yd2                                                                                                                               
                                ,mdm_location loc2                                                                                                                          
                                ,mdm_country cnt2                                                                                                                           
                           WHERE cop.pctl_no = act.pctl_no(+)                                                                                                                 
                             AND cop.cop_sts_cd IN ('C', 'T', 'F')                                                                                                          
                             AND 'P' = decode(cop.cop_no, cop.mst_cop_no,'P','X')                                                                                                              
                             AND SUBSTR(act.pctl_io_bnd_cd, 1, 1) = 'O'                                                                                                     
                             AND act.trsp_mod_cd = 'RD'                                                                                                                     
                             AND act.trsp_so_sts_cd = 'P'                                                                                                                   
                             AND cop.bkg_no = UPPER(@[bkg_no])
							 AND act.rout_org_nod_cd = mst.rout_org_nod_cd(+)                                                                                               
                             AND act.rout_dest_nod_cd = mst.rout_dest_nod_cd(+)                                                                                             
                             AND act.rout_seq = mst.rout_seq(+)                                                                                                             
                             AND mst.rout_org_nod_cd = dtl.rout_org_nod_cd(+)                                                                                               
                             AND mst.rout_dest_nod_cd = dtl.rout_dest_nod_cd(+)                                                                                             
                             AND mst.rout_seq = dtl.rout_seq(+)                                                                                                             
                             AND NVL(mst.delt_flg, 'N') = 'N'                                                                                                               
                             AND SUBSTR(act.n1st_nod_cd, 1, 5) = loc1.loc_cd(+)                                                                                             
                             AND loc1.cnt_cd = cnt1.cnt_cd(+)                                                                                                               
                             AND act.n1st_nod_cd = yd1.yd_cd(+)                                                                                                             
                             AND SUBSTR(DECODE(TRIM(NVL(act.n3rd_nod_cd, '')), '', act.n2nd_nod_cd,                                                                         
                                               DECODE(TRIM(NVL(act.n4th_nod_cd, '')), '',                                                                                   
                                                          act.n3rd_nod_cd, act.n4th_nod_cd)), 1, 5) = loc2.loc_cd(+)                                                        
                             AND loc2.cnt_cd = cnt2.cnt_cd(+)                                                                                                               
                             AND DECODE(TRIM(NVL(act.n3rd_nod_cd, '')), '', act.n2nd_nod_cd,                                                                                
                                               DECODE(TRIM(NVL(act.n4th_nod_cd, '')), '',                                                                                   
                                                          act.n3rd_nod_cd, act.n4th_nod_cd)) = yd2.yd_cd(+)                                                                 
                        GROUP BY mst.rout_org_nod_cd                                                                                                                        
                                ,mst.rout_dest_nod_cd                                                                                                                       
                                ,mst.rout_seq                                                                                                                               
                                ,mst.prio_seq                                                                                                                               
                                ,yd1.yd_cd                                                                                                                                  
                                ,yd2.yd_cd                                                                                                                                  
                        ORDER BY mst.rout_org_nod_cd,mst.rout_dest_nod_cd,mst.rout_seq, mst.prio_seq, yd1.yd_cd, yd2.yd_cd                                                                            
                        )                                                                                                                                                   
                        order by wrs_full_flg desc, rout_org_nod_cd, rout_dest_nod_cd, prio_seq                                                                             
             )a  
             where rownum = 1 			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="PHXZ1105017" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
