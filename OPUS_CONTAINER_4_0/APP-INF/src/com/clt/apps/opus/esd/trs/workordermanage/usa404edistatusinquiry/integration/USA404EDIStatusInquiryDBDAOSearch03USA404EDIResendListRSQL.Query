<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="USA404EDIStatusInquiryDBDAOSearch03USA404EDIResendListRSQL">
			<desc><![CDATA[404 EDI Resend FF의 내용을 조회 SQL]]></desc>
			<sql><![CDATA[
SELECT A.TRSP_SO_OFC_CTY_CD
      ,A.TRSP_SO_SEQ
      ,CASE WHEN   (A.CGO_TP_CD='F' AND A.TRSP_BND_CD='I' AND A.FM_NOD_CD='USEZA61') 
				OR (A.CGO_TP_CD='F' AND A.TRSP_BND_CD='O'  AND A.TO_NOD_CD='USEZA61') 
				OR (A.CGO_TP_CD='M' AND A.FM_NOD_CD='USEZA61') 
				OR (A.CGO_TP_CD='M' AND A.TO_NOD_CD='USEZA61') 
			THEN 'MAHER' 
	   END APP_MAHER
	  ,A.EQ_NO CNTR_NO_R
      ,A.RAIL_CMB_THRU_TP_CD RAIL_CMB
      ,S.EDI_RCV_VNDR_ABBR_NM APP_MTC1
      ,T.EDI_RCV_VNDR_ABBR_NM APP_MTC2
      ,C.USA_EDI_CD APPRECV_C
      ,A.CGO_TP_CD
      ,DECODE(A.CGO_TP_CD, 'F', 'B', 'M', 'E', '') SHIPQLF_C
	  ,NVL(A.CND_CSTMS_CLR_FLG, 'N') AS CLEARED_QUAL
	  ,CASE WHEN A.TRSP_BND_CD NOT IN ('I', 'O') THEN NULL ELSE A.TRSP_BND_CD END BOUND_IND	
      ,DECODE(A.CGO_TP_CD, 'M', 'EMPTY REPO', O.BKG_NO) BKGNO
      ,DECODE(A.TRSP_BND_CD, 'I', A.BL_NO, '') BLNO
      ,(SELECT FM_BKG_NO FROM BKG_BOOKING BBK WHERE BBK.BKG_NO = DECODE(A.CGO_TP_CD, 'M', A.BKG_NO, DECODE(A.TRSP_BND_CD, 'O', O.BKG_NO, A.BKG_NO)) AND BBK.BKG_CRE_TP_CD != 'C') SPLITBL
      ,DECODE(A.CGO_TP_CD, 'M', A.REF_ID, '') MTREFNO
      ,BK.SC_NO AS BKG_SCNO
      ,A.VSL_CD VSLCODE
      ,A.SKD_VOY_NO || A.SKD_DIR_CD VOYAGE
      ,Q.VSL_ENG_NM VSLNAME
      ,(SELECT TO_CHAR(SYS_SET_DT, 'YYYYMMDDHH24MI') FROM BKG_CLZ_TM WHERE BKG_NO = BK.BKG_NO AND CLZ_TP_CD = 'T' AND CLZ_YD_CD = BK.POL_NOD_CD) AS VSLCUTOFF
      ,Q.LLOYD_NO LLOYD
      ,(SELECT MAX(DECODE(A.TRSP_BND_CD, 'O', VK.OB_CSSM_VOY_NO, A.TRSP_BND_CD, 'I', VK.IB_CSSM_VOY_NO, ''))
          FROM VSK_VSL_PORT_SKD VK
         WHERE VK.VSL_CD = A.VSL_CD
           AND VK.SKD_VOY_NO = A.SKD_VOY_NO
           AND VK.SKD_DIR_CD = A.SKD_DIR_CD
           AND VK.YD_CD = DECODE(A.TRSP_BND_CD, 'O', BK.POL_NOD_CD, BK.POD_NOD_CD)) AS CONSORT_VOY
      ,NVL(DECODE(A.TRSP_BND_CD, 'O', A.POL_NOD_CD, ''), '') POL
      ,NVL(DECODE(A.TRSP_BND_CD, 'O', (SELECT J.YD_NM FROM MDM_YARD J WHERE J.YD_CD = A.POL_NOD_CD AND J.DELT_FLG = 'N'), ''), '') POL_NM
      ,NVL(DECODE(A.TRSP_BND_CD, 'O', (SELECT DECODE(INSTR(J.LOC_NM, ','), 0, J.LOC_NM, SUBSTR(J.LOC_NM, 1, INSTR(J.LOC_NM, ',') - 1)) FROM MDM_LOCATION J WHERE J.LOC_CD = SUBSTR(A.POL_NOD_CD, 1, 5)), ''), '') POL_CT
      ,NVL(DECODE(A.TRSP_BND_CD, 'I', A.POD_NOD_CD, ''), '') POD
      ,NVL(DECODE(A.TRSP_BND_CD, 'I', (SELECT J.YD_NM FROM MDM_YARD J WHERE J.YD_CD = A.POD_NOD_CD AND J.DELT_FLG = 'N'), ''), '') POD_NM
      ,NVL(DECODE(A.TRSP_BND_CD, 'I', (SELECT DECODE(INSTR(J.LOC_NM, ','), 0, J.LOC_NM, SUBSTR(J.LOC_NM, 1, INSTR(J.LOC_NM, ',') - 1)) FROM MDM_LOCATION J WHERE J.LOC_CD = SUBSTR(A.POD_NOD_CD, 1, 5)), ''), '') POD_CT
      ,LPAD(O.BIL_EDI_CTRL_SEQ, 9, '0') CREDIT
      ,'M' || LPAD(O.BIL_EDI_CTRL_SEQ, 8, '0') MTC_CREDIT
      ,DECODE(SUBSTR(BK.DEL_CD, 1, 2), 'CA', CND.IBD_LOC_GDS_DESC, DECODE(AI.IBD_TRSP_TP_CD, '61', AI.IBD_TRSP_NO, '')) IMTRANSNO
      ,DECODE(SUBSTR(BK.DEL_CD, 1, 2), 'CA', '', DECODE(AI.IBD_TRSP_TP_CD, '62', AI.IBD_TRSP_NO)) TRANSEXPNO
      ,'' DOCK
      ,'' FFDESC
      ,A.EQ_TPSZ_CD EQTPSZ
      ,SUBSTR(A.EQ_NO, 1, 4) EQINIT
      ,SUBSTR(A.EQ_NO, 5, 6) EQNO

      ,ROUND(CASE A.TRSP_BND_CD WHEN 'O' THEN DECODE(A.WGT_MEAS_UT_CD, 'KGS', NVL(A.CNTR_WGT, 0), TRS_COMMON_PKG.GET_CONV_WGT_TO_KGS_FNC('LBS', NVL(A.CNTR_WGT, 0)))
                                WHEN 'I' THEN SP.BL_WGT
       END) + ROUND(NVL(MST_SPEC_FNC('TARE', A.EQ_NO), 0)) AS   WGT
	  ,ROUND(NVL(MST_SPEC_FNC('TARE', A.EQ_NO), 0)) AS TARE_WGT
      ,ROUND(CASE A.TRSP_BND_CD WHEN 'O' THEN DECODE(A.WGT_MEAS_UT_CD, 'KGS', NVL(A.CNTR_WGT, 0), TRS_COMMON_PKG.GET_CONV_WGT_TO_KGS_FNC('LBS', NVL(A.CNTR_WGT, 0)))
                                WHEN 'I' THEN SP.BL_WGT
       END)  NET_WGT 
      ,ROUND(DECODE(A.TRSP_BND_CD, 'O', DECODE(A.WGT_MEAS_UT_CD, 'KGS', NVL(A.CNTR_WGT, 0), TRS_COMMON_PKG.GET_CONV_WGT_TO_KGS_FNC('LBS', NVL(A.CNTR_WGT, 0))), DECODE(D.WGT_UT_CD, 'KGS', NVL(D.CNTR_WGT, 0), TRS_COMMON_PKG.GET_CONV_WGT_TO_KGS_FNC('LBS', NVL(D.CNTR_WGT, 0))))) NET_WGT

      ,O.EQDESC_C
      ,DECODE(SUBSTR(A.EQ_TPSZ_CD, 2, 1), '2', '2000', '7', '4500', '4000') EQLTH_C
      ,SUBSTR(A.EQ_NO, 11, 1) EQCHK
      ,(SELECT CNTR_SEAL_NO FROM BKG_CNTR_SEAL_NO WHERE BKG_NO = D.BKG_NO AND CNTR_NO = D.CNTR_NO AND CNTR_SEAL_SEQ = 1) SEALNO
      ,A.STCC_CD AS STCC
      ,DECODE(A.CGO_TP_CD, 'M', 'XP', DECODE(A.TRSP_BND_CD, 'I', 'IP', 'O', 'XP', '')) SPCHAND_C
      ,'ML' ILTRANS_C
      ,'' CUSTENTTP_C
      ,DECODE(SUBSTR(BK.DEL_CD, 1, 2), 'CA', CV.CVY_REF_NO, AI.IBD_TRSP_NO) CUSTENTNO
      ,DECODE(C.USA_EDI_CD, 'CPRS', '61', '') CUSTTYPE
      ,DECODE(C.USA_EDI_CD, 'CPRS',
              CASE WHEN AI.CSTMS_CLR_TP_CD = 'L' THEN (SELECT F.LOC_AMS_PORT_CD FROM MDM_LOCATION F WHERE F.LOC_CD = CND.CSTMS_POD_CD)
                   ELSE(SELECT F.LOC_AMS_PORT_CD FROM MDM_LOCATION F WHERE F.LOC_CD = CND.HUB_LOC_CD)
              END,
              '') CUSTLOC
      ,DECODE(A.TRSP_BND_CD, 'O', 'K', 'I', 'D', '') AS CUSTLOCQUAL
      ,DECODE(C.USA_EDI_CD, 'CPRS', DECODE(A.WGT_MEAS_UT_CD, 'KGS', TRS_COMMON_PKG.GET_CONV_WGT_TO_LBS_FNC('KGS', NVL(A.CNTR_WGT, 0)), A.CNTR_WGT), 0) CARGOWGT
      ,I.YD_NM ORGCTY
      ,I.YD_LOC_STE_CD ORGSTATE
      ,I.YD_CTRL_OFC_CTY_NM || ', ' || I.YD_CTRL_OFC_STE_CD ORGLOC
      ,A.FM_NOD_CD ORGYD
      ,SUBSTR(A.FM_NOD_CD, 1, 2) AS ORGCNT
      ,K.YD_NM DSTCTY
      ,K.YD_LOC_STE_CD DSTSTATE
      ,K.YD_CTRL_OFC_CTY_NM || ', ' || K.YD_CTRL_OFC_STE_CD DSTLOC
      ,A.TO_NOD_CD DSTYD
      ,SUBSTR(A.TO_NOD_CD, 1, 2) AS DSTCNT
      ,DECODE(A.CGO_TP_CD, 'F', DECODE(C.USA_EDI_CD, 'CPRS', 'NYK LINE NORTH AMERICA INC', 'NYK INTERNATIONAL'), 'NYK EMPTY') AS SHPR_N
      ,CASE WHEN   (A.CGO_TP_CD='F' AND A.TRSP_BND_CD='I' AND A.FM_NOD_CD='USEZA61') 
				OR (A.CGO_TP_CD='F' AND A.TRSP_BND_CD='O'  AND A.TO_NOD_CD='USEZA61') 
				OR (A.CGO_TP_CD='M' AND A.FM_NOD_CD='USEZA61') 
				OR (A.CGO_TP_CD='M' AND A.TO_NOD_CD='USEZA61')
			THEN DECODE(A.CGO_TP_CD, 'F', 'NYK INTERNATIONAL', 'NYK EMPTY')
	   END SHPR_N_MAHER
      ,TRIM(REPLACE(REPLACE(REPLACE(REPLACE(I.YD_CTRL_OFC_ADDR, CHR(13), ' '), CHR(10), ' '), CHR(9), ' '), CHR(43), ' ')) SHPR_A
      ,I.YD_CTRL_OFC_CTY_NM SHPR_C
      ,I.YD_CTRL_OFC_STE_CD SHPR_S
      ,SUBSTR(I.YD_CD, 1, 2) AS SHPR_CN
      ,I.YD_CTRL_OFC_ZIP_CD SHPR_P  
     
    , CASE WHEN BK.DCGO_FLG = 'N' THEN 
            CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = SUBSTR(A.TO_NOD_CD, 1, 2) AND SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' THEN ''
               WHEN SUBSTR(A.FM_NOD_CD, 1, 2) != SUBSTR(A.TO_NOD_CD, 1, 2) AND (SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA') THEN
                  DECODE(A.CGO_TP_CD, 'F', CUST.SHPR_CUST_CODE)
            END
          ELSE 
               CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR  SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA' 
                 THEN DECODE(A.CGO_TP_CD, 'F', SHIP_DE.CUST_CNT_CD || SHIP_DE.CUST_SEQ)
                END   
        END AS ASHPR_CODE
        
      , CASE WHEN BK.DCGO_FLG = 'N' THEN 
            CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = SUBSTR(A.TO_NOD_CD, 1, 2) AND SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' THEN ''
               WHEN SUBSTR(A.FM_NOD_CD, 1, 2) != SUBSTR(A.TO_NOD_CD, 1, 2) AND (SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA') THEN
                  DECODE(A.CGO_TP_CD, 'F', CUST.SHPR_CUST_NM)
            END
          ELSE CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR  SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA' THEN 
                    DECODE(A.CGO_TP_CD, 'F', TRIM(REPLACE( REPLACE(REPLACE(SHIP_DE.CUST_NM, CHR(13), ' '), CHR(10), ' '), CHR(43), ' ')), '')
                END    
        END AS ASHPR_N
      , CASE WHEN BK.DCGO_FLG = 'N' THEN 
            CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = SUBSTR(A.TO_NOD_CD, 1, 2) AND SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' THEN ''
               WHEN SUBSTR(A.FM_NOD_CD, 1, 2) != SUBSTR(A.TO_NOD_CD, 1, 2) AND (SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA') THEN
                  DECODE(A.CGO_TP_CD, 'F', CUST.SHPR_CUST_ADDR)
            END
          ELSE CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR  SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA' THEN  
                    DECODE(A.CGO_TP_CD, 'F', TRIM(REPLACE( REPLACE(REPLACE(SHIP_DE.CUST_ADDR, CHR(13), ' '), CHR(10), ' '), CHR(43), ' ')), '')
               END     
        END AS ASHPR_A
      , CASE WHEN BK.DCGO_FLG = 'N' THEN 
            CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = SUBSTR(A.TO_NOD_CD, 1, 2) AND SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' THEN ''
               WHEN SUBSTR(A.FM_NOD_CD, 1, 2) != SUBSTR(A.TO_NOD_CD, 1, 2) AND (SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA') THEN
                  DECODE(A.CGO_TP_CD, 'F', CUST.SHPR_CUST_CTY_NM)
               ELSE ''
            END
          ELSE CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR  SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA' THEN 
                    DECODE(A.CGO_TP_CD, 'F', TRIM(REPLACE( REPLACE(REPLACE(SHIP_DE.CUST_CTY_NM, CHR(13), ' '), CHR(10), ' '), CHR(43), ' ')), '')
                END    
        END AS ASHPR_C
        
      , CASE WHEN BK.DCGO_FLG = 'N' THEN 
            CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = SUBSTR(A.TO_NOD_CD, 1, 2) AND SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' THEN ''
               WHEN SUBSTR(A.FM_NOD_CD, 1, 2) != SUBSTR(A.TO_NOD_CD, 1, 2) AND (SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA') THEN
                  DECODE(A.CGO_TP_CD, 'F', CUST.SHPR_CUST_STE_CD)
            END
          ELSE CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR  SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA' THEN DECODE(A.CGO_TP_CD, 'F', SHIP_DE.CUST_STE_CD) END    
        END AS ASHPR_S
        
      , CASE WHEN BK.DCGO_FLG = 'N' THEN 
            CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = SUBSTR(A.TO_NOD_CD, 1, 2) AND SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' THEN ''
               WHEN SUBSTR(A.FM_NOD_CD, 1, 2) != SUBSTR(A.TO_NOD_CD, 1, 2) AND (SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA') THEN
                  DECODE(A.CGO_TP_CD, 'F', CUST.SHPR_CUST_ZIP_ID)
            END
          ELSE CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR  SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA' THEN DECODE(A.CGO_TP_CD, 'F', SHIP_DE.CUST_ZIP_ID) END     
        END AS ASHPR_P
        
      , CASE WHEN BK.DCGO_FLG = 'N' THEN 
            CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = SUBSTR(A.TO_NOD_CD, 1, 2) AND SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' THEN ''
               WHEN SUBSTR(A.FM_NOD_CD, 1, 2) != SUBSTR(A.TO_NOD_CD, 1, 2) AND (SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA') THEN
                  DECODE(A.CGO_TP_CD, 'F', CUST.SHPR_CUST_CNT_CD)
            END
          ELSE CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR  SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA' THEN  DECODE(A.CGO_TP_CD, 'F', SHIP_DE.CUST_CNT_CD) END     
        END AS ASHPR_CN
       
      ,DECODE(A.CGO_TP_CD, 'F', 'NYK INTERNATIONAL', 'NYK EMPTY') CNEE_N
      ,TRIM(REPLACE(REPLACE(REPLACE(K.YD_CTRL_OFC_ADDR, CHR(13), ' '), CHR(10), ' '), CHR(43), ' ')) CNEE_A
      ,K.YD_CTRL_OFC_CTY_NM CNEE_C
      ,K.YD_CTRL_OFC_STE_CD CNEE_S
      ,SUBSTR(K.YD_CD, 1, 2) AS CNEE_CN
      ,K.YD_CTRL_OFC_ZIP_CD CNEE_P
       
      ,CASE
         WHEN K.YD_LOC_CTY_NM IS NULL THEN ''
         ELSE
          NVL((SELECT NT.EDI_NTFY_NM FROM TRS_TRSP_NTFY_SET NT WHERE UPPER(NT.NTFY_YD_CTY_NM) = UPPER(K.YD_LOC_CTY_NM) AND NT.NTFY_BND_CD = DECODE(A.BKG_CGO_TP_CD, 'F', A.TRSP_BND_CD, 'E')),
              (SELECT NT.EDI_NTFY_NM FROM TRS_TRSP_NTFY_SET NT WHERE UPPER(NT.NTFY_YD_CTY_NM) = UPPER(K.YD_LOC_CTY_NM) AND NT.NTFY_BND_CD = 'A'))
       END AS NTFY_N
      ,REPLACE(REPLACE(K.YD_CTRL_OFC_ADDR, CHR(10), ''), CHR(13), '') AS NTFY_A
      ,K.YD_CTRL_OFC_CTY_NM AS NTFY_C
      ,K.YD_LOC_STE_CD AS NTFY_S
      ,SUBSTR(A.TO_NOD_CD, 1, 2) AS NTFY_CN
      ,K.YD_CTRL_OFC_ZIP_CD AS NTFY_P
      ,CASE
         WHEN K.YD_LOC_CTY_NM IS NULL THEN ''
         ELSE NVL((SELECT NT.EDI_NTFY_INFO_CTNT FROM TRS_TRSP_NTFY_SET NT WHERE UPPER(NT.NTFY_YD_CTY_NM) = UPPER(K.YD_LOC_CTY_NM) AND NT.NTFY_BND_CD = DECODE(A.BKG_CGO_TP_CD, 'F', A.TRSP_BND_CD, 'E')),
              (SELECT NT.EDI_NTFY_INFO_CTNT FROM TRS_TRSP_NTFY_SET NT WHERE UPPER(NT.NTFY_YD_CTY_NM) = UPPER(K.YD_LOC_CTY_NM) AND NT.NTFY_BND_CD = 'A'))
       END AS NTFY_T
       
      ,'NYK INTERNATIONAL' CARE_N
      ,K.YD_CTRL_OFC_ADDR CARE_A
      ,K.YD_CTRL_OFC_CTY_NM CARE_C
      ,K.YD_CTRL_OFC_STE_CD CARE_S
      ,SUBSTR(K.YD_CD, 1, 2) AS CARE_CN
      ,K.YD_CTRL_OFC_ZIP_CD CARE_P
      ,'NYK INTERNATIONAL' BILL_N
      ,(SELECT CONS_VAL_CTNT FROM COM_STUP_CONS WHERE CONS_CD = 'OPC006') BILL_A
      ,(SELECT CONS_VAL_CTNT FROM COM_STUP_CONS WHERE CONS_CD = 'OPC007') BILL_C
      ,(SELECT CONS_VAL_CTNT FROM COM_STUP_CONS WHERE CONS_CD = 'OPC008') BILL_S
      ,'SG' BILL_CN
      ,(SELECT CONS_VAL_CTNT FROM COM_STUP_CONS WHERE CONS_CD = 'OPC009') BILL_P
       
   , CASE WHEN BK.DCGO_FLG = 'N'  THEN 
          CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = SUBSTR(A.TO_NOD_CD, 1, 2) AND SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' THEN ''
             WHEN SUBSTR(A.FM_NOD_CD, 1, 2) != SUBSTR(A.TO_NOD_CD, 1, 2) AND (SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA') THEN
                DECODE(A.CGO_TP_CD, 'F', CUST.CNEE_CUST_CODE)  
          END
        ELSE 
			CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR  SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA' THEN  
				DECODE(A.CGO_TP_CD, 'F', CONS_DE.CUST_CNT_CD || CONS_DE.CUST_SEQ)  
			END
      END AS UTCN_CODE
      
    , CASE WHEN BK.DCGO_FLG = 'N'  THEN 
          CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = SUBSTR(A.TO_NOD_CD, 1, 2) AND SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' THEN ''
             WHEN SUBSTR(A.FM_NOD_CD, 1, 2) != SUBSTR(A.TO_NOD_CD, 1, 2) AND (SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA') THEN                    
                DECODE(A.CGO_TP_CD, 'F', CUST.CNEE_CUST_NM) 
          END
        ELSE 
           CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR  SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA' THEN 
             DECODE(A.CGO_TP_CD, 'F', TRIM(REPLACE(REPLACE(REPLACE(CONS_DE.CUST_NM, CHR(13), ' '), CHR(10), ' '), CHR(43), ' '))) 
           END  
      END AS UTCN_N
      
    , CASE WHEN BK.DCGO_FLG = 'N'  THEN 
         CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = SUBSTR(A.TO_NOD_CD, 1, 2) AND SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' THEN ''
            WHEN SUBSTR(A.FM_NOD_CD, 1, 2) != SUBSTR(A.TO_NOD_CD, 1, 2) AND (SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA') THEN 
              DECODE(A.CGO_TP_CD, 'F', CUST.CNEE_CUST_ADDR)
         END
      ELSE 
			CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR  SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA' THEN  
				DECODE(A.CGO_TP_CD, 'F', TRIM(REPLACE(REPLACE(REPLACE(CONS_DE.CUST_ADDR, CHR(13), ' '), CHR(10), ' '), CHR(43), ' ')))
			END
      END AS UTCN_A
      
    , CASE WHEN BK.DCGO_FLG = 'N'  THEN 
         CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = SUBSTR(A.TO_NOD_CD, 1, 2) AND SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' THEN ''
            WHEN SUBSTR(A.FM_NOD_CD, 1, 2) != SUBSTR(A.TO_NOD_CD, 1, 2) AND (SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA') THEN 
              DECODE(A.CGO_TP_CD, 'F', CUST.CNEE_CUST_CTY_NM)
         END
      ELSE
         CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR  SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA' THEN  
              DECODE(A.CGO_TP_CD, 'F', TRIM(REPLACE(REPLACE(REPLACE(CONS_DE.CUST_CTY_NM, CHR(13), ' '), CHR(10), ' '), CHR(43), ' ')))
         END     
      END AS UTCN_C
      
    , CASE WHEN BK.DCGO_FLG = 'N'  THEN 
         CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = SUBSTR(A.TO_NOD_CD, 1, 2) AND SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' THEN ''
            WHEN SUBSTR(A.FM_NOD_CD, 1, 2) != SUBSTR(A.TO_NOD_CD, 1, 2) AND (SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA') THEN 
              DECODE(A.CGO_TP_CD, 'F', CUST.CNEE_CUST_STE_CD)
            ELSE ''
         END
      ELSE CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR  SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA' THEN  
                DECODE(A.CGO_TP_CD, 'F', CONS_DE.CUST_STE_CD)
           END     
      END AS UTCN_S
      
    , CASE WHEN BK.DCGO_FLG = 'N' THEN 
         CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = SUBSTR(A.TO_NOD_CD, 1, 2) AND SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' THEN ''
            WHEN SUBSTR(A.FM_NOD_CD, 1, 2) != SUBSTR(A.TO_NOD_CD, 1, 2) AND (SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA') THEN 
              DECODE(A.CGO_TP_CD, 'F', CUST.CNEE_CUST_CNT_CD)
            ELSE ''
         END
      ELSE CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR  SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA' THEN  
                DECODE(A.CGO_TP_CD, 'F', CONS_DE.CUST_CNT_CD)
           END     
      END AS UTCN_CN
      
    , CASE WHEN BK.DCGO_FLG = 'N' THEN 
         CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = SUBSTR(A.TO_NOD_CD, 1, 2) AND SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' THEN ''
            WHEN SUBSTR(A.FM_NOD_CD, 1, 2) != SUBSTR(A.TO_NOD_CD, 1, 2) AND (SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA') THEN 
              DECODE(A.CGO_TP_CD, 'F', CUST.CNEE_CUST_ZIP_ID)
            ELSE ''
         END
      ELSE CASE WHEN SUBSTR(A.FM_NOD_CD, 1, 2) = 'CA' OR  SUBSTR(A.TO_NOD_CD, 1, 2) = 'CA' THEN  
                DECODE(A.CGO_TP_CD, 'F', CONS_DE.CUST_ZIP_ID)
           END
      END AS UTCN_P
       
      ,'NYK INTERNATIONAL' RECV_N
      ,(SELECT CONS_VAL_CTNT FROM COM_STUP_CONS WHERE CONS_CD = 'OPC006') RECV_A
      ,(SELECT CONS_VAL_CTNT FROM COM_STUP_CONS WHERE CONS_CD = 'OPC007') RECV_C
      ,(SELECT CONS_VAL_CTNT FROM COM_STUP_CONS WHERE CONS_CD = 'OPC008') RECV_S
      ,'' RECV_CN
      ,(SELECT CONS_VAL_CTNT FROM COM_STUP_CONS WHERE CONS_CD = 'OPC009') RECV_P
       
      ,CASE
         WHEN K.YD_LOC_CTY_NM IS NULL THEN ''
         ELSE
          NVL((SELECT NT.EDI_NTFY_NM FROM TRS_TRSP_NTFY_SET NT WHERE UPPER(NT.NTFY_YD_CTY_NM) = UPPER(K.YD_LOC_CTY_NM) AND NT.NTFY_BND_CD = DECODE(A.BKG_CGO_TP_CD, 'F', A.TRSP_BND_CD, 'M')),
              (SELECT NT.EDI_NTFY_NM FROM TRS_TRSP_NTFY_SET NT WHERE UPPER(NT.NTFY_YD_CTY_NM) = UPPER(K.YD_LOC_CTY_NM) AND NT.NTFY_BND_CD = 'A'))
       END AS CUSBRK_N
      ,REPLACE(REPLACE(K.YD_CTRL_OFC_ADDR, CHR(10), ''), CHR(13), '') AS CUSBRK_A
      ,K.YD_CTRL_OFC_CTY_NM AS CUSBRK_C
      ,K.YD_LOC_STE_CD AS CUSBRK_S
      ,SUBSTR(A.TO_NOD_CD, 1, 2) AS CUSBRK_CN
      ,K.YD_CTRL_OFC_ZIP_CD AS CUSBRK_P
       
      ,'NYK INTERNATIONAL' ADMC_C
      ,SP.FDA FDA_IND
      ,TRIM(REPLACE(REPLACE(REPLACE(BF.CUST_NM, CHR(13), ' '), CHR(10), ' '), CHR(43), ' ')) CUST_F
      ,TRIM(REPLACE(REPLACE(REPLACE(BE.CUST_NM, CHR(13), ' '), CHR(10), ' '), CHR(43), ' ')) CUST_E
      ,M.CDO_TEMP TEMP
      ,NVL2(M.CDO_TEMP, 'C', '') TUN
      ,M.VENT_RTO VENT
      ,M.HUMID_NO HUMID
      ,M.PWR_SPL_CBL_FLG GENSET
      ,(SELECT CONS_VAL_CTNT FROM COM_STUP_CONS WHERE CONS_CD = 'OPC010') REFID
      ,A.AUTO_XPT_SYS_NO REFVAL
      ,'' S
      ,DECODE(A.CGO_TP_CD, 'M', 'EMPTY REPO', O.BKG_NO) BKGNO_OLD
      ,DECODE(A.TRSP_BND_CD, 'I', A.BL_NO, '') BLNO_OLD
      ,TO_CHAR(A.WO_ISS_DT, 'YYYYMMDD') SNDDT_OLD
      ,'N' TYPE
      ,O.ROUTCARR ROUTCARR
      ,O.ROUTSEQ ROUTSEQ
      ,O.ROUTCITY ROUTCITY
      ,O.INTMOSVR INTMOSVR
      ,O.TRANSTP TRANSTP
      ,O.TO_YARD_CD TO_YARD_CD
      ,UPPER(O.AGMT_REF_NO) CONTRACT
      ,O.ROUTCARR2 ROUTCARR2
      ,O.ROUTSEQ2 ROUTSEQ2
      ,O.ROUTCITY2 ROUTCITY2
      ,O.INTMOSVR2 INTMOSVR2
      ,O.TRANSTP2 TRANSTP2
      ,O.TO_YARD_CD2 TO_YARD_CD2
      ,UPPER(O.AGMT_REF_NO2) CONTRACT2
      ,O.ROUTCARR3 ROUTCARR3
      ,O.ROUTSEQ3 ROUTSEQ3
      ,O.ROUTCITY3 ROUTCITY3
      ,O.INTMOSVR3 INTMOSVR3
      ,O.TRANSTP3 TRANSTP3
      ,O.TO_YARD_CD3 TO_YARD_CD3
      ,UPPER(O.AGMT_REF_NO3) CONTRACT3
      ,'' INBOND
      ,SP.LADELINE1
      ,SP.LADEDESC1
	  ,SP.COMMCODE1
      ,SP.NISCOMM1 AS BKG_COMM1
      ,SP.NISRETP1 AS REF_COMM1
      ,SP.HS_CD1
      ,SP.UNITCODE1
      ,DECODE(A.TRSP_BND_CD, 'O', NVL(A.PCK_QTY, 1), 'I', NVL(D.PCK_QTY, 1), '1') LADEQTY
      ,DECODE(A.TRSP_BND_CD, 'O', NVL(A.PCK_TP_CD, 'PCS'), DECODE(D.PCK_QTY, NULL, 'TLD', D.PCK_TP_CD)) PACKFORM
      ,A.CRE_OFC_CD
  FROM TRS_TRSP_RAIL_BIL_ORD A
      ,MDM_VENDOR C
      ,BKG_CONTAINER D
      ,MDM_YARD I
      ,MDM_YARD K
      ,BKG_RF_CGO M
      ,MDM_VSL_CNTR Q
      ,TRS_TRSP_RAIL_EDI_NOD S
      ,TRS_TRSP_RAIL_EDI_NOD T
      ,BKG_BOOKING BK
      ,BKG_CSTMS_ADV_BL CND
      ,MDM_ORGANIZATION OFC
      ,BKG_CSTMS_CND_VSL CV
      ,BKG_CUSTOMER BF
      ,BKG_CUSTOMER BE
      ,BKG_CSTMS_ADV_IBD AI
      ,TRS_TRSP_RAIL_OFC_EXPT ROFC
      ,BKG_CNTR_SEAL_NO SEAL
      ,BKG_DG_DECL  SHIP_DE   
      ,BKG_DG_DECL  CONS_DE
      ,(SELECT A.TRSP_SO_OFC_CTY_CD
              ,A.TRSP_SO_SEQ
              ,MIN(DECODE(A.SUB_RAIL_SEQ, 1, A.VNDR_SEQ)) VNDR_SEQ
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 1, B.USA_EDI_CD, '')) ROUTCARR
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 1, DECODE(SUBSTR(C.RAIL_CMB_THRU_TP_CD, 3), 'T', 'S', 'C', 'S', 'R'), '')) ROUTSEQ
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 1, PRD.INLND_ROUT_JUNC_NM, '')) ROUTCITY
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 1, MST.ROUT_PLN_CD, '')) INTMOSVR
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 1, DECODE(SUBSTR(A.RAIL_CRR_TP_CD, 1, 1), 'C', 'X'), '')) TRANSTP
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 1, A.TO_NOD_CD, '')) TO_YARD_CD
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 1, AGMT.AGMT_REF_NO)) AGMT_REF_NO
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 2, B.USA_EDI_CD, '')) ROUTCARR2
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 2, '1', '')) ROUTSEQ2
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 2, PRD.INLND_ROUT_JUNC_NM, '')) ROUTCITY2
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 2, MST.ROUT_PLN_CD, '')) INTMOSVR2
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 2, DECODE(SUBSTR(A.RAIL_CRR_TP_CD, 1, 1), 'C', 'X'), '')) TRANSTP2
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 2, A.TO_NOD_CD, '')) TO_YARD_CD2
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 2, AGMT.AGMT_REF_NO)) AGMT_REF_NO2
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 3, B.USA_EDI_CD, '')) ROUTCARR3
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 3, '2', '')) ROUTSEQ3
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 3, PRD.INLND_ROUT_JUNC_NM, '')) ROUTCITY3
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 3, MST.ROUT_PLN_CD, '')) INTMOSVR3
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 3, DECODE(SUBSTR(A.RAIL_CRR_TP_CD, 1, 1), 'C', 'X'), '')) TRANSTP3
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 3, A.TO_NOD_CD, '')) TO_YARD_CD3
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 3, AGMT.AGMT_REF_NO)) AGMT_REF_NO3
              ,MAX(NVL(EDI.BIL_EDI_CTRL_SEQ, RSND_EDI.BIL_EDI_CTRL_SEQ)) BIL_EDI_CTRL_SEQ
              ,MAX(C.BKG_NO) BKG_NO
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 1, DECODE(SUBSTR(A.RAIL_CRR_TP_CD, 1, 1), 'C', 'CN', 'T', 'CC'))) EQDESC_C
              ,MAX(C.FM_NOD_CD) FM_NOD_CD
              ,MAX(C.TO_NOD_CD) TO_NOD_CD
          FROM TRS_TRSP_RAIL_BIL_VNDR_SET A
              ,MDM_VENDOR                 B
              ,TRS_TRSP_RAIL_BIL_ORD      C
              ,TRS_TRSP_EDI_TMP           TMP
              ,TRS_TRSP_EDI_RAIL_ORD      EDI
              ,TRS_TRSP_EDI_RAIL_ORD_RSND RSND_EDI
              ,TRS_AGMT_HDR               AGMT
              ,PRD_INLND_ROUT_DTL         PRD
              ,PRD_INLND_ROUT_MST         MST
         WHERE TMP.TRSP_EDI_SND_NO = @[strsp_edi_snd_no]
           AND A.TRSP_SO_OFC_CTY_CD = TMP.TRSP_SO_OFC_CTY_CD
           AND A.TRSP_SO_SEQ = TMP.TRSP_SO_SEQ
           AND A.VNDR_SEQ = B.VNDR_SEQ(+)
           AND A.TRSP_SO_OFC_CTY_CD = C.TRSP_SO_OFC_CTY_CD
           AND A.TRSP_SO_SEQ = C.TRSP_SO_SEQ
           AND C.ROUT_ORG_NOD_CD = PRD.ROUT_ORG_NOD_CD
           AND C.ROUT_DEST_NOD_CD = PRD.ROUT_DEST_NOD_CD
           AND C.ROUT_SEQ = PRD.ROUT_SEQ
           AND A.ROUT_DTL_SEQ = PRD.ROUT_DTL_SEQ
           AND MST.ROUT_ORG_NOD_CD = PRD.ROUT_ORG_NOD_CD
           AND MST.ROUT_DEST_NOD_CD = PRD.ROUT_DEST_NOD_CD
           AND MST.ROUT_SEQ = PRD.ROUT_SEQ
           AND A.TRSP_SO_OFC_CTY_CD = EDI.TRSP_SO_OFC_CTY_CD(+)
           AND A.TRSP_SO_SEQ = EDI.TRSP_SO_SEQ(+)
           AND A.TRSP_SO_OFC_CTY_CD = RSND_EDI.TRSP_SO_OFC_CTY_CD(+)
           AND A.TRSP_SO_SEQ = RSND_EDI.TRSP_SO_SEQ(+)
           AND A.TRSP_AGMT_OFC_CTY_CD = AGMT.TRSP_AGMT_OFC_CTY_CD(+)
           AND A.TRSP_AGMT_SEQ = AGMT.TRSP_AGMT_SEQ(+)
           AND C.RAIL_CMB_THRU_TP_CD IN ('C1T', 'C2T', 'C3T', 'C2R', 'C3R', 'C2C', 'C3S')
         GROUP BY A.TRSP_SO_OFC_CTY_CD ,A.TRSP_SO_SEQ
        UNION
        SELECT A.TRSP_SO_OFC_CTY_CD
              ,A.TRSP_SO_SEQ
              ,A.VNDR_SEQ
              ,B.USA_EDI_CD ROUTCARR
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 1, DECODE(SUBSTR(C.RAIL_CMB_THRU_TP_CD, 3), 'T', 'S', 'C', 'S', 'R'), 2, 1, 3, 2)) ROUTSEQ
              ,PRD.INLND_ROUT_JUNC_NM ROUTCITY
              ,MST.ROUT_PLN_CD INTMOSVR
              ,DECODE(SUBSTR(A.RAIL_CRR_TP_CD, 1, 1), 'C', 'X') TRANSTP
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 1, A.TO_NOD_CD, '')) TO_YARD_CD
              ,MAX(AGMT.AGMT_REF_NO) AGMT_REF_NO
              ,'' ROUTCARR2
              ,'' ROUTSEQ2
              ,'' ROUTCITY2
              ,'' INTMOSVR2
              ,'' TRANSTP2
              ,'' TO_YARD_CD2
              ,'' AGMT_REF_NO2
              ,'' ROUTCARR3
              ,'' ROUTSEQ3
              ,'' ROUTCITY3
              ,'' INTMOSVR3
              ,'' TRANSTP3
              ,'' TO_YARD_CD3
              ,'' AGMT_REF_NO3
              ,MAX(NVL(EDI.BIL_EDI_CTRL_SEQ, RSND_EDI.BIL_EDI_CTRL_SEQ)) BIL_EDI_CTRL_SEQ
              ,MAX(C.BKG_NO) BKG_NO
              ,MAX(DECODE(A.SUB_RAIL_SEQ, 1, DECODE(SUBSTR(A.RAIL_CRR_TP_CD, 1, 1), 'C', 'CN', 'T', 'CC'))) EQDESC_C
              ,MAX(A.FM_NOD_CD) FM_NOD_CD
              ,MAX(A.TO_NOD_CD) TO_NOD_CD
          FROM TRS_TRSP_RAIL_BIL_VNDR_SET A
              ,MDM_VENDOR                 B
              ,TRS_TRSP_RAIL_BIL_ORD      C
              ,TRS_TRSP_EDI_TMP           TMP
              ,TRS_TRSP_EDI_RAIL_ORD      EDI
              ,TRS_TRSP_EDI_RAIL_ORD_RSND RSND_EDI
              ,TRS_AGMT_HDR               AGMT
              ,PRD_INLND_ROUT_DTL         PRD
              ,PRD_INLND_ROUT_MST         MST
         WHERE TMP.TRSP_EDI_SND_NO = @[strsp_edi_snd_no]
           AND A.TRSP_SO_OFC_CTY_CD = TMP.TRSP_SO_OFC_CTY_CD
           AND A.TRSP_SO_SEQ = TMP.TRSP_SO_SEQ
           AND A.VNDR_SEQ = B.VNDR_SEQ(+)
           AND A.TRSP_SO_OFC_CTY_CD = C.TRSP_SO_OFC_CTY_CD
           AND A.TRSP_SO_SEQ = C.TRSP_SO_SEQ
           AND C.ROUT_ORG_NOD_CD = PRD.ROUT_ORG_NOD_CD
           AND C.ROUT_DEST_NOD_CD = PRD.ROUT_DEST_NOD_CD
           AND C.ROUT_SEQ = PRD.ROUT_SEQ
           AND A.ROUT_DTL_SEQ = PRD.ROUT_DTL_SEQ
           AND MST.ROUT_ORG_NOD_CD = PRD.ROUT_ORG_NOD_CD
           AND MST.ROUT_DEST_NOD_CD = PRD.ROUT_DEST_NOD_CD
           AND MST.ROUT_SEQ = PRD.ROUT_SEQ
           AND A.TRSP_SO_OFC_CTY_CD = EDI.TRSP_SO_OFC_CTY_CD(+)
           AND A.TRSP_SO_SEQ = EDI.TRSP_SO_SEQ(+)
           AND A.TRSP_SO_OFC_CTY_CD = RSND_EDI.TRSP_SO_OFC_CTY_CD(+)
           AND A.TRSP_SO_SEQ = RSND_EDI.TRSP_SO_SEQ(+)
           AND A.TRSP_AGMT_OFC_CTY_CD = AGMT.TRSP_AGMT_OFC_CTY_CD(+)
           AND A.TRSP_AGMT_SEQ = AGMT.TRSP_AGMT_SEQ(+)
           AND B.VNDR_SEQ = EDI.VNDR_SEQ
           AND C.RAIL_CMB_THRU_TP_CD IN ('S2R', 'S3R')
         GROUP BY A.TRSP_SO_OFC_CTY_CD
                 ,A.TRSP_SO_SEQ
                 ,A.VNDR_SEQ
                 ,B.USA_EDI_CD
                 ,A.TO_NOD_CD
                 ,PRD.INLND_ROUT_JUNC_NM
                 ,MST.ROUT_PLN_CD
                 ,A.RAIL_CRR_TP_CD
         ORDER BY TRSP_SO_SEQ) O
      ,(
		SELECT A.TRSP_SO_OFC_CTY_CD
			  ,A.TRSP_SO_SEQ
			  ,MAX(FDA_DECL_FLG) FDA
			  ,MAX(DECODE(LADELINE, 1, LADELINE, '')) LADELINE1
			  ,MAX(DECODE(LADELINE, 1, LADEDESC, '')) LADEDESC1
			  ,MAX(DECODE(LADELINE, 1, COMMCODE, '')) COMMCODE1
			  ,MAX(DECODE(LADELINE, 1, NISCOMM, '')) NISCOMM1
			  ,MAX(DECODE(LADELINE, 1, NISRETP, '')) NISRETP1
			  ,MAX(DECODE(LADELINE, 1, HAMO_TRF_CD, '')) HS_CD1
			  ,MAX(DECODE(LADELINE, 1, '', '')) UNITCODE1
			  ,MAX(BL_WEIGHT) BL_WGT
		  FROM (SELECT A.TRSP_SO_OFC_CTY_CD
					  ,A.TRSP_SO_SEQ
					  ,TO_NUMBER(NVL(D.RK, '1')) LADELINE
					  ,REPLACE(REPLACE(NVL(D.CNTR_MF_GDS_DESC, 'F.A.K'), CHR(13), ' '), CHR(10), ' ') LADEDESC
					  ,DECODE(D.HAMO_TRF_CD, '3590000', '3522286', D.HAMO_TRF_CD) COMMCODE
					  ,B.CMDT_CD NISCOMM
					  ,B.REP_CMDT_CD NISRETP
					  ,TF.FDA_DECL_FLG
					  ,TF.HAMO_TRF_CD
				  FROM TRS_TRSP_RAIL_BIL_ORD A
					  ,TRS_TRSP_RAIL_BIL_VNDR_SET AB
					  ,BKG_BOOKING B
					  ,BKG_CONTAINER C
					  ,(SELECT BD.BKG_NO
							  ,BD.CNTR_NO
							  ,BD.CNTR_MF_GDS_DESC
							  ,BD.HAMO_TRF_CD
							  ,BD.CMDT_HS_CD
							  ,ROW_NUMBER() OVER(PARTITION BY BD.BKG_NO, BD.CNTR_NO ORDER BY BD.CNTR_MF_SEQ) RK
						  FROM BKG_CNTR_MF_DESC BD) D
					  ,MDM_REP_CMDT E
					  ,MDM_COMMODITY F
					  ,BKG_RATE BRH
					  ,MDM_VENDOR VD
					  ,TRS_TRSP_EDI_TMP STMP
					  ,BKG_HAMO_TRF TF
					  ,BKG_DG_CGO P
				 WHERE A.BKG_NO = B.BKG_NO(+)
				   AND A.BKG_NO = C.BKG_NO(+)
				   AND A.EQ_NO = C.CNTR_NO(+)
				   AND A.BKG_NO = D.BKG_NO(+)
				   AND A.EQ_NO = D.CNTR_NO(+)
				   AND 1 = D.RK(+)
				   AND B.REP_CMDT_CD = E.REP_CMDT_CD(+)
				   AND B.CMDT_CD = F.CMDT_CD(+)
				   AND A.BKG_NO = BRH.BKG_NO(+)
				   AND A.TRSP_SO_OFC_CTY_CD = AB.TRSP_SO_OFC_CTY_CD
				   AND A.TRSP_SO_SEQ = AB.TRSP_SO_SEQ
				   AND AB.SUB_RAIL_SEQ = 1
				   AND AB.VNDR_SEQ = VD.VNDR_SEQ(+)
				   AND D.CMDT_HS_CD = TF.HAMO_TRF_CD(+)
				   AND STMP.TRSP_EDI_SND_NO = @[strsp_edi_snd_no]
				   AND A.TRSP_SO_OFC_CTY_CD = STMP.TRSP_SO_OFC_CTY_CD
				   AND A.TRSP_SO_SEQ = STMP.TRSP_SO_SEQ
				   AND A.BKG_NO = P.BKG_NO(+)
				   AND A.EQ_NO = P.CNTR_NO(+)
				   AND P.DCGO_SEQ(+) = 1) A
				  ,(
						SELECT TRSP_SO_OFC_CTY_CD, TRSP_SO_SEQ, SUM(NVL(WGT, 0)) BL_WEIGHT
						  FROM (SELECT /*+ LEADING(STMP) USE_NL(A) USE_NL(BC B B1)*/
								 STMP.TRSP_SO_OFC_CTY_CD
								,STMP.TRSP_SO_SEQ
								,DECODE(BC.WGT_UT_CD,'KGS', NVL(BC.CNTR_WGT, 0),TRS_COMMON_PKG.GET_CONV_WGT_TO_KGS_FNC(BC.WGT_UT_CD, BC.CNTR_WGT)) WGT
								  FROM BKG_CONTAINER         BC
									  ,BKG_BOOKING           B
									  ,BKG_BOOKING           B1
									  ,TRS_TRSP_RAIL_BIL_ORD A
									  ,TRS_TRSP_EDI_TMP      STMP
								 WHERE 1 = 1
								   AND STMP.TRSP_EDI_SND_NO = @[strsp_edi_snd_no]
								   AND A.TRSP_SO_OFC_CTY_CD = STMP.TRSP_SO_OFC_CTY_CD
								   AND A.TRSP_SO_SEQ = STMP.TRSP_SO_SEQ
								   AND A.BKG_NO = B.BKG_NO
								   AND EXISTS (SELECT 1
										  FROM TRS_TRSP_RAIL_BIL_ORD O, SCE_COP_HDR M, SCE_COP_HDR S
										 WHERE O.TRSP_SO_OFC_CTY_CD = STMP.TRSP_SO_OFC_CTY_CD
										   AND O.TRSP_SO_SEQ = STMP.TRSP_SO_SEQ
										   AND O.TRSP_BND_CD = 'I'
										   AND NVL(O.DELT_FLG, 'N') <> 'Y'
										   AND S.COP_NO = O.COP_NO
										   AND S.MST_COP_NO = M.COP_NO
										   AND M.BKG_NO = B.BKG_NO
										   AND ROWNUM = 1)
								   AND B.BKG_NO <> B1.BKG_NO
								   AND B.VSL_CD = B1.VSL_CD
								   AND B.SKD_VOY_NO = B1.SKD_VOY_NO
								   AND B.SKD_DIR_CD = B1.SKD_DIR_CD
								   AND B1.BKG_NO = BC.BKG_NO
								   AND BC.CNTR_NO = A.EQ_NO
								   AND B1.BKG_CGO_TP_CD = 'F'
								   AND (B1.BKG_STS_CD = 'W' OR B1.BKG_STS_CD = 'F')
								UNION ALL
								SELECT /*+ LEADING(STMP) USE_NL(O) USE_NL(BC)*/
								 STMP.TRSP_SO_OFC_CTY_CD
								,STMP.TRSP_SO_SEQ
								,DECODE(BC.WGT_UT_CD,'KGS', NVL(BC.CNTR_WGT, 0),TRS_COMMON_PKG.GET_CONV_WGT_TO_KGS_FNC(BC.WGT_UT_CD, BC.CNTR_WGT)) WGT
								  FROM TRS_TRSP_RAIL_BIL_ORD O, TRS_TRSP_EDI_TMP STMP, BKG_CONTAINER BC
								 WHERE 1 = 1
								   AND STMP.TRSP_EDI_SND_NO = @[strsp_edi_snd_no]
								   AND STMP.TRSP_SO_OFC_CTY_CD = O.TRSP_SO_OFC_CTY_CD
								   AND STMP.TRSP_SO_SEQ = O.TRSP_SO_SEQ
								   AND O.TRSP_BND_CD = 'I'
								   AND NVL(O.DELT_FLG, 'N') <> 'Y'
								   AND O.BKG_NO = BC.BKG_NO
								   AND O.EQ_NO = BC.CNTR_NO)
						 GROUP BY TRSP_SO_OFC_CTY_CD, TRSP_SO_SEQ
					) B
		 WHERE A.TRSP_SO_OFC_CTY_CD = B.TRSP_SO_OFC_CTY_CD(+)
		   AND A.TRSP_SO_SEQ = B.TRSP_SO_SEQ(+)
		 GROUP BY A.TRSP_SO_OFC_CTY_CD, A.TRSP_SO_SEQ
	  ) SP
	,    (
      SELECT BKG_NO
            ,MAX(DECODE(BKG_CUST_TP_CD, 'S', CUST_CNT_CD)) SHPR_CUST_CNT_CD
            ,MAX(DECODE(BKG_CUST_TP_CD, 'S', CUST_SEQ)) SHPR_CUST_SEQ
            ,MAX(DECODE(BKG_CUST_TP_CD, 'S', NVL2(CUST_SEQ, CUST_CNT_CD || CUST_SEQ, ''))) SHPR_CUST_CODE
            ,MAX(DECODE(BKG_CUST_TP_CD, 'S', CUST_NM)) SHPR_CUST_NM
            ,MAX(DECODE(BKG_CUST_TP_CD, 'S', CUST_ADDR)) SHPR_CUST_ADDR
            ,MAX(DECODE(BKG_CUST_TP_CD, 'S', CUST_CTY_NM)) SHPR_CUST_CTY_NM
            ,MAX(DECODE(BKG_CUST_TP_CD, 'S', CUST_STE_CD)) SHPR_CUST_STE_CD
            ,MAX(DECODE(BKG_CUST_TP_CD, 'S', CUST_ZIP_ID)) SHPR_CUST_ZIP_ID
                 
            ,MAX(DECODE(BKG_CUST_TP_CD, 'C', CUST_CNT_CD)) CNEE_CUST_CNT_CD
            ,MAX(DECODE(BKG_CUST_TP_CD, 'C', CUST_SEQ)) CNEE_CUST_SEQ
            ,MAX(DECODE(BKG_CUST_TP_CD, 'C', NVL2(CUST_SEQ, CUST_CNT_CD || CUST_SEQ, ''))) CNEE_CUST_CODE
            ,MAX(DECODE(BKG_CUST_TP_CD, 'C', CUST_NM)) CNEE_CUST_NM
            ,MAX(DECODE(BKG_CUST_TP_CD, 'C', CUST_ADDR)) CNEE_CUST_ADDR
            ,MAX(DECODE(BKG_CUST_TP_CD, 'C', CUST_CTY_NM)) CNEE_CUST_CTY_NM
            ,MAX(DECODE(BKG_CUST_TP_CD, 'C', CUST_STE_CD)) CNEE_CUST_STE_CD
            ,MAX(DECODE(BKG_CUST_TP_CD, 'C', CUST_ZIP_ID)) CNEE_CUST_ZIP_ID
                 
            ,MAX(DECODE(BKG_CUST_TP_CD, 'N', CUST_CNT_CD)) NTFY_CUST_CNT_CD
            ,MAX(DECODE(BKG_CUST_TP_CD, 'N', CUST_SEQ)) NTFY_CUST_SEQ
            ,MAX(DECODE(BKG_CUST_TP_CD, 'N', NVL2(CUST_SEQ, CUST_CNT_CD || CUST_SEQ, ''))) NTFY_CUST_CODE
            ,MAX(DECODE(BKG_CUST_TP_CD, 'N', CUST_NM)) NTFY_CUST_NM
            ,MAX(DECODE(BKG_CUST_TP_CD, 'N', CUST_ADDR)) NTFY_CUST_ADDR
            ,MAX(DECODE(BKG_CUST_TP_CD, 'N', CUST_CTY_NM)) NTFY_CUST_CTY_NM
            ,MAX(DECODE(BKG_CUST_TP_CD, 'N', CUST_STE_CD)) NTFY_CUST_STE_CD
            ,MAX(DECODE(BKG_CUST_TP_CD, 'N', CUST_ZIP_ID)) NTFY_CUST_ZIP_ID
        FROM (SELECT DECODE(SO.TRSP_BND_CD, 'O', EDI.BKG_NO, SO.BKG_NO) BKG_NO
                    ,EDI.BIL_ISS_KNT
                    ,B.BKG_CUST_TP_CD
                    ,B.CUST_CNT_CD
                    ,B.CUST_SEQ
                    ,TRIM(REPLACE(REPLACE(REPLACE(B.CUST_NM, CHR(13), ' '), CHR(10), ' '), CHR(43), ' ')) CUST_NM
                    ,TRIM(REPLACE(REPLACE(REPLACE(B.CUST_ADDR, CHR(13), ' '), CHR(10), ' '), CHR(43), ' '))CUST_ADDR
                    ,TRIM(REPLACE(REPLACE(REPLACE(NVL(B.CUST_CTY_NM, M.CTY_NM), CHR(13), ' '), CHR(10), ' '), CHR(43), ' ')) CUST_CTY_NM
                    ,TRIM(REPLACE(REPLACE(REPLACE(NVL(B.CUST_STE_CD, M.STE_CD), CHR(13), ' '), CHR(10), ' '), CHR(43), ' ')) CUST_STE_CD
                    ,TRIM(REPLACE(REPLACE(REPLACE(NVL(B.CUST_ZIP_ID, M.ZIP_CD), CHR(13), ' '), CHR(10), ' '), CHR(43), ' ')) CUST_ZIP_ID    
                    ,ROW_NUMBER() OVER(PARTITION BY B.BKG_NO, B.BKG_CUST_TP_CD, B.CUST_CNT_CD, B.CUST_SEQ ORDER BY M.PRMRY_CHK_FLG DESC, M.ADDR_SEQ) RK           
                FROM TRS_TRSP_EDI_TMP      STMP
                    ,TRS_TRSP_RAIL_BIL_ORD SO
                    ,TRS_TRSP_EDI_RAIL_ORD EDI
                    ,BKG_CUSTOMER          B
                    ,MDM_CUST_ADDR         M
               WHERE 1 = 1
                 AND STMP.TRSP_EDI_SND_NO = @[strsp_edi_snd_no]
                 AND STMP.TRSP_SO_OFC_CTY_CD = SO.TRSP_SO_OFC_CTY_CD
                 AND STMP.TRSP_SO_SEQ = SO.TRSP_SO_SEQ
                 AND SO.TRSP_SO_OFC_CTY_CD = EDI.TRSP_SO_OFC_CTY_CD(+)
                 AND SO.TRSP_SO_SEQ = EDI.TRSP_SO_SEQ(+)
                 AND B.BKG_NO = SO.BKG_NO
                 AND B.CUST_CNT_CD = M.CUST_CNT_CD(+)
                 AND B.CUST_SEQ = M.CUST_SEQ(+)
                 AND B.BKG_CUST_TP_CD IN ('S', 'C', 'N')
                 AND M.DELT_FLG = 'N'
                 AND EDI.BIL_ISS_KNT =
                     (SELECT MAX(BIL_ISS_KNT)
                        FROM TRS_TRSP_EDI_RAIL_ORD
                       WHERE TRSP_SO_OFC_CTY_CD = EDI.TRSP_SO_OFC_CTY_CD
                         AND TRSP_SO_SEQ = EDI.TRSP_SO_SEQ))
       WHERE rk = 1
       GROUP BY BKG_NO    
    ) CUST	
  WHERE A.TRSP_SO_OFC_CTY_CD = O.TRSP_SO_OFC_CTY_CD
   AND A.TRSP_SO_SEQ = O.TRSP_SO_SEQ
   AND A.TRSP_SO_OFC_CTY_CD = SP.TRSP_SO_OFC_CTY_CD
   AND A.TRSP_SO_SEQ = SP.TRSP_SO_SEQ
   AND O.VNDR_SEQ = C.VNDR_SEQ(+)
   AND A.BKG_NO = D.BKG_NO(+)
   AND A.EQ_NO = D.CNTR_NO(+)
   AND A.BL_NO = AI.BL_NO(+)
   AND 'US' = AI.CNT_CD(+)
   AND O.FM_NOD_CD = I.YD_CD
   AND O.TO_NOD_CD = K.YD_CD
   AND A.BKG_NO = BF.BKG_NO(+)
   AND BF.BKG_CUST_TP_CD(+) = 'F'
   AND A.BKG_NO = BE.BKG_NO(+)
   AND BE.BKG_CUST_TP_CD(+) = 'E'
   AND A.BKG_NO = M.BKG_NO(+)
   AND A.EQ_NO = M.CNTR_NO(+)   
   AND A.VSL_CD = Q.VSL_CD(+)
   AND NVL(A.POL_NOD_CD, A.FM_NOD_CD) = S.EDI_RCV_NOD_CD(+)
   AND NVL(A.POD_NOD_CD, A.TO_NOD_CD) = T.EDI_RCV_NOD_CD(+)
   AND A.BKG_NO = BK.BKG_NO(+)
   AND A.DELT_FLG = 'N'
   AND A.BL_NO = CND.BL_NO(+)
   AND A.BKG_NO = CND.BKG_NO(+)	
   AND DECODE(A.TRSP_BND_CD, 'I', DECODE(SUBSTR(A.TO_NOD_CD, 1, 2), 'US', 'US', 'CA', 'CA', ''), 'O', DECODE(SUBSTR(A.FM_NOD_CD, 1, 2), 'US', 'US', 'CA', 'CA', ''), '') = CND.CNT_CD(+)
   AND CND.VSL_CD = CV.VSL_CD(+)
   AND CND.SKD_VOY_NO = CV.SKD_VOY_NO(+)
   AND CND.SKD_DIR_CD = CV.SKD_DIR_CD(+)
   AND CND.POD_CD = CV.PORT_CD(+)
   AND K.OFC_CD = ROFC.OFC_CD(+)
   AND DECODE(K.OFC_CD, ROFC.OFC_CD, ROFC.CTRL_OFC_CD, K.OFC_CD) = OFC.OFC_CD
   AND D.BKG_NO = SEAL.BKG_NO(+)
   AND D.CNTR_NO = SEAL.CNTR_NO(+)
   AND SEAL.CNTR_SEAL_SEQ(+) = 1
   AND A.BKG_NO = SHIP_DE.BKG_NO(+)
   AND A.EQ_NO = SHIP_DE.CNTR_NO(+)
   AND SHIP_DE.DG_DECL_SEQ(+) = 1
   AND A.BKG_NO = CONS_DE.BKG_NO(+)
   AND A.EQ_NO = CONS_DE.CNTR_NO(+)
   AND CONS_DE.DG_DECL_SEQ(+) = 2  
   AND A.BKG_NO = CUST.BKG_NO(+) 
 ORDER BY C.USA_EDI_CD,A.TRSP_SO_SEQ			]]></sql>
			<params>
				<param name="strsp_edi_snd_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
