<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="WorkOrderPreviewDBDAOSearchEdiUsaTroCntrRSQL">
			<desc><![CDATA[searchEdi_USA_TRO_CNTR]]></desc>
			<sql><![CDATA[
SELECT /*+ USE_NL(DOR_YARD_DTL) INDEX(BV XPKBKG_BKG_VVD) */												
		 so.eq_no as cntr_no
 		,trs_common_pkg.get_cntr_tare_wgt_to_uom_fnc('LBS', so.eq_tpsz_cd) as cntr_tare_wgt
	 	,so.cntr_lbs_wgt as cntr_gross_wgt
 		,so.cntr_lbs_wgt-trs_common_pkg.get_cntr_tare_wgt_to_uom_fnc('LBS', so.eq_tpsz_cd) as cntr_net_wgt
		,'LBS' as cntr_wgt_unit
  		,tpsz.cntr_tpsz_iso_cd as cntr_tp
		,so.eq_tpsz_cd as cntr_tp_desc
		,so.trsp_bnd_cd as tro_bound
		,so.trsp_crr_mod_cd as tro_type
		,'' as tro_haul_type
		,so.bkg_no as bkg_no
		,so.bl_no as bl_no
		,so.trsp_so_ofc_cty_cd||so.trsp_so_seq as so_no
		,LPAD(so.edi_ctrl_seq, 9, 0) as unique_no
        --,CASE WHEN (select EDI.FRT_CLT_FLG||EDI.OBL_RDEM_FLG||EDI.CSTMS_CLR_CD FOC from BKG_CGO_RLSE EDI WHERE EDI.BL_NO = SO.BL_NO ) = 'YYY'
        ,CASE WHEN TRS_GET_FOC_INFO_FNC(SO.BL_NO, SO.TRSP_SO_OFC_CTY_CD, SO.TRSP_SO_SEQ, NULL) = 'YYY'
                    THEN PK.PKUP_NO 
		  ELSE '' 
		  END as pu_no
		,(SELECT IT.IBD_TRSP_NO FROM BKG_CSTMS_ADV_IBD IT 
               WHERE IT.CNT_CD = 'US' AND IT.BL_NO = SO.BL_NO)  as it_no
		,(SELECT PU.CUST_REF_NO_CTNT
          FROM BKG_REFERENCE PU
          WHERE PU.BKG_NO = SO.BKG_NO
          AND PU.CNTR_NO = SO.EQ_NO AND PU.BKG_REF_TP_CD = 'CTPO' ) AS po_no
  		,TO_CHAR(PK.PKUP_AVAL_DT,'YYYYMMDD') as ava_date
		,TO_CHAR(PK.LST_FREE_DT,'YYYYMMDD') as lf_date
  		,TO_CHAR(so.n1st_nod_pln_dt,'YYYYMMDDHHMM') as edt
		,TO_CHAR(so.lst_nod_pln_dt,'YYYYMMDDHHMM') as eat
		,so.lst_loc_cd as usa_l_city
		,trs_get_blck_stwg_cd_fnc(so.bkg_no) as mlb 
		,so.slan_cd as tvvd_lane	
		,vsl.call_sgn_no as tvvd_vsl_call
 		, vsl.vsl_eng_nm as tvsl_name
		,so.vsl_cd||so.skd_voy_no||so.skd_dir_cd as tvvd_vvd
 		,so.por_cd as tvvd_por
		,so.pol_cd as tvvd_pol
 		,loc1.loc_nm as tvvd_pol_nm
		,so.pod_cd as tvvd_pod
  		,loc2.loc_nm as tvvd_pod_nm
		,TO_CHAR(skd1.vps_etd_dt, 'YYYYMMDDHH24MI')	as tvvd_etd
  		,TO_CHAR(skd2.vps_eta_dt, 'YYYYMMDDHH24MI')as tvvd_eta
		,DECODE(so.cgo_tp_cd,'F','N','B','N','Y') as mt_ind
		,bkg_cntr.rc_flg as rf_ind   
		,bkg_cntr.dcgo_flg as dg_ind   
		,bkg_cntr.awk_cgo_flg as awk_ind  		
		,so.spcl_cgo_cntr_tp_cd as spe_cargo
   		,REPLACE(so.spcl_instr_rmk, CHR(13)||CHR(10), ' ') as spcl_inst
		,REPLACE(bkg.inter_rmk, CHR(13)||CHR(10), ' ') as remark 
   		,''	as trm_customs_no
		,cm.cmdt_hs_cd	as cmd_hs_cd
		,NVL(from_yard.yd_cd,from_lse_yard.lse_co_yd_cd) as fm_yd
		,REPLACE(trs_common_pkg.get_yd_cd_nm_fnc(so.fm_nod_cd),CHR(13)||CHR(10), ' ') as fm_yd_desc
  		,TO_CHAR(so.n1st_nod_pln_dt ,'YYYYMMDDHH24MI') as fm_yd_dt
		,REPLACE(NVL(from_yard.yd_addr,from_lse_yard.yd_addr), CHR(13)||CHR(10), ' ') as fm_addr
		,'' as fm_city
		,'' as fm_state
		,NVL(from_yard.zip_cd,'') as fm_zip
		,NVL(from_yard.phn_no,from_lse_yard.phn_no) as fm_tel
		,NVL(from_yard.fax_no,from_lse_yard.fax_no) as fm_fax
		,NVL(from_yard.yd_pic_nm,from_lse_yard.yd_pic_nm) as fm_pic
		,NVL(dor_yard.zn_cd, so.dor_nod_cd) as dr_yd
		,REPLACE(NVL(so.fctry_nm,''), CHR(13)||CHR(10), ' ') as dr_yd_desc
		,TO_CHAR(so.dor_nod_pln_dt,'YYYYMMDDHH24MI') as dr_yd_dt
		,REPLACE(NVL(so.dor_de_addr,''), CHR(13)||CHR(10), ' ') as dr_addr
		,'' as dr_city
		,'' as dr_state
		,NVL(dor_yard_dtl.zip_cd, so.dor_pst_cd) as dr_zip
		,so.cntc_pson_phn_no as dr_tel
		,so.cntc_pson_fax_no as dr_fax
		,so.cntc_pson_nm as dr_pic
		,NVL(via_yard.yd_cd,via_lse_yard.lse_co_yd_cd) as via_yd
		,REPLACE(trs_common_pkg.get_yd_cd_nm_fnc(so.via_nod_cd),CHR(13)||CHR(10), ' ') as via_yd_desc
		,'' as via_yd_dt
		,REPLACE(NVL(via_yard.yd_addr,via_lse_yard.yd_addr),CHR(13)||CHR(10), ' ') as via_addr
		,'' as via_city
		,'' as via_state
		,NVL(via_yard.zip_cd, '') as via_zip
		,NVL(via_yard.phn_no,via_lse_yard.phn_no) as via_tel
		,NVL(via_yard.fax_no,via_lse_yard.fax_no) as via_fax
		,NVL(via_yard.yd_pic_nm,via_lse_yard.yd_pic_nm) as via_pic
		,NVL(to_yard.yd_cd, to_lse_yard.lse_co_yd_cd) as to_yd
		,REPLACE(trs_common_pkg.get_yd_cd_nm_fnc(so.to_nod_cd),CHR(13)||CHR(10), ' ') as to_yd_desc
		,TO_CHAR(so.lst_nod_pln_dt,'YYYYMMDDHH24MI') as to_yd_dt
		,REPLACE(NVL(to_yard.yd_addr, to_lse_yard.yd_addr),CHR(13)||CHR(10), ' ') as to_addr
		,''	as to_city
		,''	as to_state
		,NVL(to_yard.zip_cd, '')	AS TO_ZIP
		,NVL(to_yard.phn_no, to_lse_yard.phn_no) as to_tel
		,NVL(to_yard.fax_no, to_lse_yard.fax_no) as to_fax
		,NVL(to_yard.yd_pic_nm, to_lse_yard.yd_pic_nm)	as to_pic
		,(SELECT SEAL.CNTR_SEAL_NO  FROM BKG_CNTR_SEAL_NO SEAL
                           WHERE SEAL.CNTR_SEAL_SEQ = 1
                            AND SEAL.BKG_NO  = SO.BKG_NO
                            AND SEAL.CNTR_NO = SO.EQ_NO ) seal_no 
		,LTRIM(TO_CHAR(TO_CHAR(NVL(so.bzc_amt,0) +	NVL(so.etc_add_amt,0)+NVL(so.fuel_scg_amt,0) +	NVL(so.nego_amt,0)), '999999999999990.00')) as cntr_rate
		,so.curr_cd as cntr_rate_cur	
	FROM trs_trsp_svc_ord  so
 		,mdm_cntr_tp_sz	tpsz
		,bkg_container bkg_cntr    
 		,mdm_vsl_cntr vsl
 		,mdm_location loc1
 		,mdm_location loc2
 		,vsk_vsl_port_skd skd1
 		,vsk_vsl_port_skd skd2
		,bkg_vvd bv 
		,bkg_booking bkg
		,bkg_cntr_mf_desc cm 
		,BKG_PKUP_NTC_PKUP_NO PK	
		,mdm_yard from_yard
 		,mdm_lse_co_yd from_lse_yard
	 	,mdm_yard via_yard
 		,mdm_lse_co_yd via_lse_yard
 		,mdm_yard to_yard
 		,mdm_lse_co_yd to_lse_yard
 		,mdm_zone dor_yard
 		,mdm_zn_dtl dor_yard_dtl
        ,mdm_location loc_pk
   WHERE so.delt_flg<> 'Y'
 	 AND so.trsp_so_ofc_cty_cd= @[trsp_so_ofc_cty_cd]
	 AND so.trsp_so_seq= @[trsp_so_seq]
	 AND so.eq_tpsz_cd= tpsz.cntr_tpsz_cd(+)
	 AND so.bkg_no = bkg_cntr.bkg_no(+)
	 AND so.eq_no	= bkg_cntr.cntr_no(+)
	 AND so.vsl_cd= vsl.vsl_cd(+)
	 AND so.pol_cd= loc1.loc_cd(+)
	 AND so.pod_cd= loc2.loc_cd(+)
	 AND SO.BKG_NO= PK.BKG_NO(+)
     AND SO.EQ_NO=  PK.CNTR_NO(+)
     AND PK.DEL_CD = loc_pk.LOC_CD(+)
     AND PK.OFC_CD = loc_pk.EQ_CTRL_OFC_CD(+)
     AND 'N'       = loc_pk.DELT_FLG(+)
	 AND bv.vsl_pre_pst_cd(+)= 'T'
 	 AND bv.vsl_cd= skd1.vsl_cd(+)
	 AND bv.skd_voy_no= skd1.skd_voy_no(+)
	 AND bv.skd_dir_cd= skd1.skd_dir_cd(+)
	 AND bv.pol_cd= skd1.vps_port_cd(+) 
	 AND skd1.clpt_ind_seq(+)= 1						
	 AND NVL(skd1.skd_cng_sts_cd,'XX' ) <> 'S' 
 	 AND bv.vsl_cd= skd2.vsl_cd(+)
	 AND bv.skd_voy_no= skd2.skd_voy_no(+)
	 AND bv.skd_dir_cd= skd2.skd_dir_cd(+)
	 AND bv.pol_cd= skd2.vps_port_cd(+) 
	 AND skd2.clpt_ind_seq(+)= 1						
	 AND NVL(skd2.skd_cng_sts_cd,'XX' ) <> 'S' 
	 AND bkg.bkg_no	= bv.bkg_no(+)
	 AND so.bkg_no= bkg.bkg_no(+)
	 AND so.bkg_no= cm.bkg_no(+)
	 AND so.eq_no= cm.cntr_no(+)
	 AND cm.cntr_mf_seq(+) = 1  	 
	 AND so.fm_nod_cd	= from_yard.yd_cd(+)
	 AND from_yard.delt_flg(+)= 'N'			
	 AND so.fm_nod_cd= from_lse_yard.lse_co_yd_cd(+)
	 AND from_lse_yard.delt_flg(+) = 'N'
	 AND so.via_nod_cd= via_yard.yd_cd(+)
	 AND via_yard.delt_flg(+) = 'N'			
	 AND so.via_nod_cd= via_lse_yard.lse_co_yd_cd(+)
	 AND via_lse_yard.delt_flg(+)= 'N'
	 AND so.to_nod_cd= to_yard.yd_cd(+)
	 AND to_yard.delt_flg(+) = 'N'			
	 AND so.to_nod_cd= to_lse_yard.lse_co_yd_cd(+)
	 AND to_lse_yard.delt_flg(+)= 'N'
	 AND so.dor_nod_cd = dor_yard.zn_cd(+)
	 AND so.dor_nod_cd= dor_yard_dtl.zn_cd(+)
	 AND dor_yard.delt_flg(+) = 'N'			]]></sql>
			<params>
				<param name="trsp_so_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="trsp_so_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
