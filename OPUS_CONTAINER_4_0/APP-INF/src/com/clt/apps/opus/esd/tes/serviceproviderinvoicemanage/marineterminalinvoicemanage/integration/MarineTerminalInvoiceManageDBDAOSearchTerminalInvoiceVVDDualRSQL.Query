<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MarineTerminalInvoiceManageDBDAOSearchTerminalInvoiceVVDDualRSQL">
			<desc><![CDATA[SearchTerminalInvoiceVVDDual]]></desc>
			<sql><![CDATA[
			-- VVD BOUND 자동 배분 체크 동일 Yard, Atb Date에 항차가 ± 1 까지 조회
			-- 반대 방향의 배는 반드시 한개만 존재한다고 하나 만약의 경우를 대비 Rownum처리 - ( 4342. 01. 19 이경한 과장 요청 CSR )
			SELECT	VSL_CD VVD_VSL_CD, SKD_VOY_NO VVD_SKD_VOY_NO, SKD_DIR_CD VVD_SKD_DIR_CD, TO_CHAR(VPS_ETB_DT,'YYYY-MM-DD') VVD_ATB_DT
			FROM	VSK_VSL_PORT_SKD
			WHERE	VPS_PORT_CD	= SUBSTR(@[yd_cd],1,5)
			AND		VSL_CD		= SUBSTR(@[vvd],1,4)
			-- DB 형변환 문제로 인하여 변경 - 특이한 경우 발생 ( 2009-07-23 )
			AND	( SKD_VOY_NO  = TO_CHAR( SUBSTR(@[vvd],5,4) )
					OR SKD_VOY_NO  = LPAD(TO_CHAR( TO_NUMBER( SUBSTR(@[vvd],5,4) ) + 1 ),4,'0')
					OR SKD_VOY_NO  = LPAD(TO_CHAR( TO_NUMBER( SUBSTR(@[vvd],5,4) ) - 1 ),4,'0'))
			AND	SKD_DIR_CD  = DECODE(SUBSTR(@[vvd],9,1),'E','W','W','E','S','N','N','S')
			AND TO_CHAR(VPS_ETB_DT,'YYYY-MM-DD')	= @[atb_dt]
			AND	ROWNUM	= 1			]]></sql>
			<params>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="atb_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
