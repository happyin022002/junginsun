<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EmptyReleaseRedeliveryOrderMgtDBDAOSearchBkgDgCgoforEdiRSQL">
			<desc><![CDATA[BKG_DG_CGO 테이블에서 EDI로 전송할 정보를 조회한다]]></desc>
			<sql><![CDATA[
SELECT DG.IMDG_UN_NO AS UNBR
      ,DG.IMDG_CLSS_CD AS CLAS
      ,IMDG.IMDG_PCK_DESC AS DG_DESC
      ,DG.PRP_SHP_NM AS PROPER_NM
      ,DG.HZD_DESC AS TECH_NM
      ,(SELECT   SA.APRO_REF_NO
		  FROM   SCG_APRO_RQST      SAR
			  ,  SCG_VVD_APRO_RQST  SVAR
			  ,  SCG_AUTHORIZATION  SA
			  ,  BKG_VVD			BV
	     WHERE    1 = 1
		   AND    SAR.BKG_NO           = SVAR.BKG_NO
		   AND    SAR.BKG_NO           = BV.BKG_NO
		   AND    SAR.SPCL_CGO_APRO_RQST_SEQ = SVAR.SPCL_CGO_APRO_RQST_SEQ
		   AND    SAR.SPCL_CGO_CATE_CD = 'DG'
		   AND    SAR.LST_RQST_DAT_FLG = 'Y'
		   AND    SVAR.BKG_NO           = SA.BKG_NO
		   AND    SVAR.SPCL_CGO_APRO_RQST_SEQ = SA.SPCL_CGO_APRO_RQST_SEQ
		   AND    SVAR.BKG_NO           = DG.BKG_NO
		   AND    SVAR.VSL_CD           = BV.VSL_CD
		   AND    SVAR.SKD_VOY_NO       = BV.SKD_VOY_NO
		   AND    SVAR.SKD_DIR_CD       = BV.SKD_DIR_CD
		   AND    BV.VSL_PRE_PST_CD||BV.VSL_SEQ = (SELECT MIN(BV1.VSL_PRE_PST_CD||BV1.VSL_SEQ) FROM BKG_VVD BV1 WHERE BV1.BKG_NO = BV.BKG_NO)
		   AND    SA.SPCL_CGO_AUTH_SEQ= (SELECT   MAX(SAM.SPCL_CGO_AUTH_SEQ)
                            			   FROM    SCG_AUTHORIZATION SAM
                               			  WHERE    SAM.BKG_NO         = SA.BKG_NO
                               				AND    SAM.SPCL_CGO_APRO_RQST_SEQ = SA.SPCL_CGO_APRO_RQST_SEQ)  
           AND      ROWNUM = 1) AS DG_APPROVAL
      ,DG.EMER_CNTC_PHN_NO_CTNT AS PHON
      ,DG.FLSH_PNT_CDO_TEMP AS FPNT
      ,'C' AS FPUN
      ,REPLACE(REPLACE(DG.DIFF_RMK, CHR(13), ' '), CHR(10), ' ') AS DG_REMARK
      ,DG.EMS_NO AS EMSNO
      ,DG.PSA_NO AS PSACLS
      ,DG.IMDG_PCK_GRP_CD AS PKGGRP
      ,DG.MRN_POLUT_FLG AS MAR_POLL
      ,DG.HZD_DESC AS HAZ_CONT
      ,DG.IMDG_LMT_QTY_FLG AS IMO_LIMIT
      ,DG.PRP_SHP_NM AS PRP_SHP_NM
  FROM TRS_TRSP_SVC_ORD ORD
      ,BKG_DG_CGO       DG
      ,SCG_IMDG_PCK_CD  IMDG
 WHERE ORD.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
   AND ORD.TRSP_SO_SEQ = @[trsp_so_seq]
   AND DG.BKG_NO = ORD.BKG_NO
   AND NVL(DG.CNTR_NO, 'X') =  NVL2(DG.CNTR_NO, NVL(ORD.EQ_NO, DG.CNTR_NO), 'X')
   AND DG.CNTR_TPSZ_CD = ORD.EQ_TPSZ_CD
   AND DG.OUT_IMDG_PCK_CD1 = IMDG.IMDG_PCK_CD(+)
   AND IMDG.DELT_FLG(+) = 'N'			]]></sql>
			<params>
				<param name="trsp_so_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="trsp_so_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
