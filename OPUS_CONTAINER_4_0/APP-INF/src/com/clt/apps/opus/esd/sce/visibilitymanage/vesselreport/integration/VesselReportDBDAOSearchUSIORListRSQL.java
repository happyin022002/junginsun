/*=========================================================
*Copyright(c) 2016 CyberLogitec
*@FileName : VesselReportDBDAOSearchUSIORListRSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2016.09.29
*@LastModifier : 김성욱
*@LastVersion : 1.0
* 2016.09.29 김성욱
* 1.0 Creation
=========================================================*/
package com.clt.apps.opus.esd.sce.visibilitymanage.vesselreport.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.clt.framework.support.db.ISQLTemplate;

/**
 *
 * @author Sung-Wook Kim
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class VesselReportDBDAOSearchUSIORListRSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * 2010.12.23 이윤정 [CHM-201007730-01] US Inland Operation Report 상의 특수문자 인식 재처리 로직 추가. CHR(29) 처리 로직추가
	  * 2012.02.22 채창호 [CHM-201115166-01]:Split 01-US Inland Operation Report 내, 324 EDI 기능 추가
	  * </pre>
	  */
	public VesselReportDBDAOSearchUSIORListRSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("to_dt",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("s_lane",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("s_pup_office",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("vndr_seq",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("fm_dt",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("s_sc_no",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("s_vvd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("edi_status",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("s_del",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.clt.apps.opus.esd.sce.visibilitymanage.vesselreport.integration").append("\n"); 
		query.append("FileName : VesselReportDBDAOSearchUSIORListRSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("SELECT * FROM (" ).append("\n"); 
		query.append("SELECT L.* , ROW_NUMBER() OVER (PARTITION BY BKG_NO, CNTR_NO ORDER BY ARR_DT DESC, RCV_DT DESC) NUM" ).append("\n"); 
		query.append("FROM (" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("SELECT " ).append("\n"); 
		query.append("  BKG_NO," ).append("\n"); 
		query.append("  BL_NO," ).append("\n"); 
		query.append("  UNMATCH_FLG," ).append("\n"); 
		query.append("  BKG_POD_CD," ).append("\n"); 
		query.append("  BKG_DEL_CD," ).append("\n"); 
		query.append("  DEL_LOC_NM,	-- CORRECTION 1" ).append("\n"); 
		query.append("  COP_POD_CD," ).append("\n"); 
		query.append("  COP_DEL_CD," ).append("\n"); 
		query.append("  KK.CNTR_NO," ).append("\n"); 
		query.append("  TPSZ," ).append("\n"); 
		query.append("  SUBSTR(MVMT,1,2) MVMT_STS," ).append("\n"); 
		query.append("  SUBSTR(MVMT,3,7) MVMT_YD," ).append("\n"); 
		query.append("  SUBSTR(MVMT,10) MVMT_DT," ).append("\n"); 
		query.append("  DUP_FLG," ).append("\n"); 
		query.append("  VVD," ).append("\n"); 
		query.append("  LANE," ).append("\n"); 
		query.append("  ETA," ).append("\n"); 
		query.append("  SPE," ).append("\n"); 
		query.append("  RAIL_DEST," ).append("\n"); 
		query.append("  CSTMS_LOC_CD," ).append("\n"); 
		query.append("  EQ_CTRL_OFC_CD," ).append("\n"); 
		query.append("  TERM," ).append("\n"); 
		query.append("  ADD_TRSP," ).append("\n"); 
		query.append("  RL_SO_PLN_FLG," ).append("\n"); 
		query.append("  RL_SO_FLG," ).append("\n"); 
		query.append("  RL_WO_FLG," ).append("\n"); 
		query.append("  TS_SO_PLN_FLG," ).append("\n"); 
		query.append("  TS_SO_FLG," ).append("\n"); 
		query.append("  TS_WO_FLG," ).append("\n"); 
		query.append("  TC_SO_PLN_FLG," ).append("\n"); 
		query.append("  TC_SO_FLG," ).append("\n"); 
		query.append("  TC_WO_FLG," ).append("\n"); 
		query.append("  DR_SO_PLN_FLG," ).append("\n"); 
		query.append("  DR_SO_FLG," ).append("\n"); 
		query.append("  DR_WO_FLG," ).append("\n"); 
		query.append("  DR_WO_DT," ).append("\n"); 
		query.append("  DR_FM," ).append("\n"); 
		query.append("  DR_TO," ).append("\n"); 
		query.append("  DR_SP," ).append("\n"); 
		query.append("  DR_SP_NM," ).append("\n"); 
		query.append("  COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00134', COP_STS_CD) COP_STS_CD," ).append("\n"); 
		query.append("  FRM," ).append("\n"); 
		query.append("  GUIDE ," ).append("\n"); 
		query.append("  PKUP_YD_CD," ).append("\n"); 
		query.append("  PKUP_AVAL_DT," ).append("\n"); 
		query.append("  PKUP_FREE_DT," ).append("\n"); 
		query.append("  F," ).append("\n"); 
		query.append("  O," ).append("\n"); 
		query.append("  C," ).append("\n"); 
		query.append("  DSPO_CD," ).append("\n"); 
		query.append("  PKUP_NO," ).append("\n"); 
		query.append("  PKUP_OFC_CD," ).append("\n"); 
		query.append("  PKUP_END," ).append("\n"); 
		query.append("  SC_NO," ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("  SELECT CUST_LGL_ENG_NM" ).append("\n"); 
		query.append("    FROM PRI_SP_HDR A1" ).append("\n"); 
		query.append("        ,PRI_SP_MN A2" ).append("\n"); 
		query.append("        ,PRI_SP_CTRT_PTY A3" ).append("\n"); 
		query.append("        ,MDM_CUSTOMER X" ).append("\n"); 
		query.append("   WHERE 1=1" ).append("\n"); 
		query.append("     AND A1.SC_NO = KK.SC_NO" ).append("\n"); 
		query.append("     AND A1.PROP_NO = A2.PROP_NO" ).append("\n"); 
		query.append("     AND A2.AMDT_SEQ = (" ).append("\n"); 
		query.append("                        SELECT MAX(AMDT_SEQ)" ).append("\n"); 
		query.append("                          FROM PRI_SP_MN" ).append("\n"); 
		query.append("                         WHERE PROP_NO = A1.PROP_NO" ).append("\n"); 
		query.append("                           AND PROP_STS_CD = 'F')" ).append("\n"); 
		query.append("     AND A2.PROP_NO  = A3.PROP_NO" ).append("\n"); 
		query.append("     AND A2.AMDT_SEQ = A3.AMDT_SEQ" ).append("\n"); 
		query.append("     AND A3.PRC_CTRT_PTY_TP_CD = 'C'" ).append("\n"); 
		query.append("     AND X.CUST_CNT_CD = A3.CUST_CNT_CD " ).append("\n"); 
		query.append("     AND X.CUST_SEQ = A3.CUST_SEQ" ).append("\n"); 
		query.append("     AND ROWNUM=1" ).append("\n"); 
		query.append("  ) AS SC_CUST_NM," ).append("\n"); 
		query.append("  CNEE_NM," ).append("\n"); 
		query.append("  CNEE_ADDR," ).append("\n"); 
		query.append("  SHPR_NM," ).append("\n"); 
		query.append("  SHPR_ADDR," ).append("\n"); 
		query.append("  NTFY_NM," ).append("\n"); 
		query.append("  NTFY_ADDR," ).append("\n"); 
		query.append("  FILER," ).append("\n"); 
		query.append("  IT_NO," ).append("\n"); 
		query.append("  IT_DATE," ).append("\n"); 
		query.append("  PO_NO," ).append("\n"); 
		query.append("  SEAL_NO," ).append("\n"); 
		query.append("  CNTR_WGT," ).append("\n"); 
		query.append("  DECODE(SRC, 'EDI_322_MSG', NVL(COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD30032', CLM.CLM_SGHT_ABBR_NM), CLM.CLM_SGHT_ABBR_NM)" ).append("\n"); 
		query.append("                           , CLM.CLM_SGHT_ABBR_NM) AS CLM_CRNT_STS," ).append("\n"); 
		query.append("  CLM.ARR_LOC_NM AS CLM_LOC," ).append("\n"); 
		query.append("  CLM.ARR_STE_CD AS CLM_STATE,  " ).append("\n"); 
		query.append("  TO_CHAR(CLM.ARR_DT,'YYYY/MM/DD HH24:MI:SS') AS CLM_DT," ).append("\n"); 
		query.append("  BKG_CNTR_RMK," ).append("\n"); 
		query.append("  NVL(EDI_SND_TP_CD,'N') EDI_SND_TP_CD," ).append("\n"); 
		query.append("  TO_CHAR(EDI_SND_DT,'YYYY-MM-DD HH24:MI:SS') EDI_SND_DT," ).append("\n"); 
		query.append("  VNDR_SEQ," ).append("\n"); 
		query.append("  (SELECT VNDR_LGL_ENG_NM FROM MDM_VENDOR A" ).append("\n"); 
		query.append("   WHERE A.VNDR_SEQ = KK.VNDR_SEQ ) VNDR_NAME," ).append("\n"); 
		query.append("  ESTM_DT RAIL_ETA," ).append("\n"); 
		query.append("  CLM.ARR_DT," ).append("\n"); 
		query.append("  CLM.RCV_DT," ).append("\n"); 
		query.append("  INTER_RMK," ).append("\n"); 
		query.append("  DO_HLD_FLG" ).append("\n"); 
		query.append("FROM (" ).append("\n"); 
		query.append("SELECT BKG_NO,BL_NO,UNMATCH_FLG,BKG_POD_CD,BKG_DEL_CD,DEL_LOC_NM,POD_CD COP_POD_CD,DEL_CD COP_DEL_CD,CNTR_NO,  -- CORRECTION 2" ).append("\n"); 
		query.append("	   CNTR_TPSZ_CD TPSZ," ).append("\n"); 
		query.append("       DUP_FLG," ).append("\n"); 
		query.append("       VVD_CD VVD,SLAN_CD LANE,VPS_ETA_DT ETA,SPCL_CGO_CNTR_RF_FLG SPE," ).append("\n"); 
		query.append("       RAIL_DEST,CSTMS_LOC_CD,EQ_CTRL_OFC_CD,BKG_DE_TERM_CD TERM,ADD_TRSP,RL_SO_PLN_FLG,RL_SO_FLG,RL_WO_FLG," ).append("\n"); 
		query.append("       TS_SO_PLN_FLG,TS_SO_FLG,TS_WO_FLG,TC_SO_PLN_FLG,TC_SO_FLG,TC_WO_FLG,DR_SO_PLN_FLG,DR_SO_FLG,DR_WO_FLG,DR_WO_DT,DR_FM,DR_TO,DR_SP,DR_SP_NM,COP_STS_CD,FRM," ).append("\n"); 
		query.append("       DECODE(BKG_DE_TERM_CD,'D',DECODE(DR_WO_FLG,'N','Door','End'),'End') GUIDE ," ).append("\n"); 
		query.append("       PKUP_YD_CD,PKUP_AVAL_DT,LST_FREE_DT PKUP_FREE_DT,F,O,C,DSPO_CD,PKUP_NO,PKUP_OFC_CD,PKUP_END,SC_NO," ).append("\n"); 
		query.append("       CNEE_NM,CNEE_ADDR,SHPR_NM,SHPR_ADDR,NTFY_NM,NTFY_ADDR,FILE_CD FILER,IBD_TRSP_NO IT_NO,IBD_TRSP_ISS_DT IT_DATE,PO_NO,CNTR_SEAL_NO SEAL_NO,CNTR_WGT," ).append("\n"); 
		query.append("--       CLM_CRNT_STS,CLM_LOC,CLM_STATE,CLM_DT," ).append("\n"); 
		query.append("      BKG_CNTR_RMK," ).append("\n"); 
		query.append("      (SELECT /*+ INDEX_DESC(A XPKSCE_EDI_324_SND_RSLT) */" ).append("\n"); 
		query.append("              EDI_SND_TP_CD" ).append("\n"); 
		query.append("         FROM SCE_EDI_324_SND_RSLT A" ).append("\n"); 
		query.append("        WHERE BKG_NO = K.BKG_NO" ).append("\n"); 
		query.append("          AND VNDR_SEQ = K.VNDR_SEQ" ).append("\n"); 
		query.append("          AND CNTR_NO = K.CNTR_NO" ).append("\n"); 
		query.append("          AND (VSL_CD, SKD_VOY_NO, SKD_DIR_CD) = ( SELECT /*+ INDEX_DESC(A XPKSCE_COP_DTL) */ VSL_CD, SKD_VOY_NO, SKD_DIR_CD" ).append("\n"); 
		query.append("                                                     FROM SCE_COP_DTL A" ).append("\n"); 
		query.append("                                                    WHERE COP_NO = K.COP_NO" ).append("\n"); 
		query.append("                                                      AND ACT_CD LIKE 'F___D_'" ).append("\n"); 
		query.append("                                                      AND SUBSTR(ACT_CD,3,1) IN ( 'V','W' )" ).append("\n"); 
		query.append("                                                      AND COP_DTL_SEQ LIKE '4%'" ).append("\n"); 
		query.append("                                                      AND ROWNUM = 1 )" ).append("\n"); 
		query.append("          AND ROWNUM = 1) EDI_SND_TP_CD ," ).append("\n"); 
		query.append("      ( SELECT /*+ INDEX_DESC(A XPKSCE_EDI_324_SND_RSLT) */ " ).append("\n"); 
		query.append("               EDI_SND_DT " ).append("\n"); 
		query.append("          FROM SCE_EDI_324_SND_RSLT A" ).append("\n"); 
		query.append("         WHERE BKG_NO = K.BKG_NO" ).append("\n"); 
		query.append("           AND VNDR_SEQ = K.VNDR_SEQ" ).append("\n"); 
		query.append("           AND CNTR_NO = K.CNTR_NO" ).append("\n"); 
		query.append("           AND (VSL_CD, SKD_VOY_NO, SKD_DIR_CD) = ( SELECT /*+ INDEX_DESC(A XPKSCE_COP_DTL) */ VSL_CD, SKD_VOY_NO, SKD_DIR_CD" ).append("\n"); 
		query.append("                                                      FROM SCE_COP_DTL A" ).append("\n"); 
		query.append("                                                     WHERE COP_NO = K.COP_NO" ).append("\n"); 
		query.append("                                                       AND ACT_CD LIKE 'F___D_'" ).append("\n"); 
		query.append("                                                       AND SUBSTR(ACT_CD,3,1) IN ( 'V','W' )" ).append("\n"); 
		query.append("                                                       AND COP_DTL_SEQ LIKE '4%'" ).append("\n"); 
		query.append("                                                       AND ROWNUM = 1 )" ).append("\n"); 
		query.append("           AND ROWNUM = 1 ) EDI_SND_DT," ).append("\n"); 
		query.append("      VNDR_SEQ," ).append("\n"); 
		query.append("      ESTM_DT," ).append("\n"); 
		query.append("      (SELECT LPAD(CCM.MVMT_STS_CD,2,' ')||LPAD(CCM.ORG_YD_CD,7,' ')||TO_CHAR(CCM.CNMV_EVNT_DT,'YYYY/MM/DD HH24:MI:SS')" ).append("\n"); 
		query.append("         FROM CTM_MOVEMENT CCM" ).append("\n"); 
		query.append("        WHERE CCM.CNTR_NO = K.CNTR_NO" ).append("\n"); 
		query.append("          AND CCM.CNMV_CYC_NO =K.CNMV_CYC_NO" ).append("\n"); 
		query.append("          AND CCM.CNMV_YR||LPAD(CCM.CNMV_ID_NO,5,'0')||CCM.CNMV_SPLIT_NO = (" ).append("\n"); 
		query.append("                         SELECT MAX(CCM2.CNMV_YR||LPAD(CCM2.CNMV_ID_NO,5,'0')||CCM2.CNMV_SPLIT_NO)" ).append("\n"); 
		query.append("                           FROM CTM_MOVEMENT CCM2" ).append("\n"); 
		query.append("                          WHERE CCM.CNTR_NO = CCM2.CNTR_NO" ).append("\n"); 
		query.append("                            AND CCM.CNMV_CYC_NO =CCM2.CNMV_CYC_NO" ).append("\n"); 
		query.append("                        )" ).append("\n"); 
		query.append("      ) MVMT," ).append("\n"); 
		query.append("      INTER_RMK," ).append("\n"); 
		query.append("      DO_HLD_FLG" ).append("\n"); 
		query.append("FROM (" ).append("\n"); 
		query.append("        SELECT /*+ INDEX(BS XPKBKG_CNTR_SEAL_NO) */" ).append("\n"); 
		query.append("              BKG.BKG_NO ," ).append("\n"); 
		query.append("              BKG.BL_NO," ).append("\n"); 
		query.append("              BKG.POD_CD BKG_POD_CD ," ).append("\n"); 
		query.append("              BKG.DEL_CD BKG_DEL_CD ," ).append("\n"); 
		query.append("			  ML.LOC_NM DEL_LOC_NM,  -- CORRECTION 3 " ).append("\n"); 
		query.append("              SUBSTR(SCH.POD_NOD_CD, 1, 5) POD_CD ," ).append("\n"); 
		query.append("              SUBSTR(SCH.DEL_NOD_CD, 1, 5) DEL_CD ," ).append("\n"); 
		query.append("              (CASE WHEN BKG.POD_CD = NVL(SUBSTR(SCH.POD_NOD_CD, 1, 5),BKG.POD_CD) AND BKG.DEL_CD = NVL(SUBSTR(SCH.DEL_NOD_CD, 1, 5),BKG.DEL_CD) THEN 'N'" ).append("\n"); 
		query.append("                    ELSE 'Y'" ).append("\n"); 
		query.append("               END) UNMATCH_FLG," ).append("\n"); 
		query.append("              SCH.COP_NO," ).append("\n"); 
		query.append("              (CASE WHEN SCH.COP_NO = SCH.MST_COP_NO THEN 'Y' ELSE 'N' END) DUP_FLG," ).append("\n"); 
		query.append("              BC.CNTR_NO ," ).append("\n"); 
		query.append("              BC.CNTR_TPSZ_CD , " ).append("\n"); 
		query.append("              BC.CNMV_CYC_NO,                          " ).append("\n"); 
		query.append("              VPS.VSL_CD||VPS.SKD_VOY_NO||VPS.SKD_DIR_CD VVD_CD ," ).append("\n"); 
		query.append("              VPS.SLAN_CD ," ).append("\n"); 
		query.append("              TO_CHAR(VPS.VPS_ETA_DT,'YYYY/MM/DD HH24:MI:SS') VPS_ETA_DT ," ).append("\n"); 
		query.append("              DECODE(BC.RC_FLG,'Y','RF',DECODE(BC.RD_CGO_FLG,'Y','RD',DECODE(BC.DCGO_FLG,'Y','DG',DECODE(BC.BB_CGO_FLG,'Y','BB',DECODE(BC.AWK_CGO_FLG,'Y','AK'))))) SPCL_CGO_CNTR_RF_FLG," ).append("\n"); 
		query.append("              SUBSTR(MAX(CASE WHEN S.TRSP_MOD_CD = 'RD' THEN S.COST_ACT_GRP_SEQ||NVL(S.N4TH_NOD_CD, NVL(S.N3RD_NOD_CD, S.N2ND_NOD_CD)) END),4) RAIL_DEST, " ).append("\n"); 
		query.append("              AD_BL.CSTMS_LOC_CD ," ).append("\n"); 
		query.append("              ML.EQ_CTRL_OFC_CD ," ).append("\n"); 
		query.append("              BKG.DE_TERM_CD BKG_DE_TERM_CD,       " ).append("\n"); 
		query.append("              DECODE(MAX(CASE WHEN S.TRSP_MOD_CD ='RD' AND S.TRSP_SO_STS_CD IN ('I','E','X') THEN 'Y' ELSE 'N' END),'Y',                             " ).append("\n"); 
		query.append("              --CASE OF Rail Issued" ).append("\n"); 
		query.append("              DECODE(BKG.DE_TERM_CD,'Y',   " ).append("\n"); 
		query.append("                    DECODE(DECODE(CSTMS_LOC_CD,BKG.POD_CD,'0','1')  " ).append("\n"); 
		query.append("                    ||DECODE(CSTMS_LOC_CD,SUBSTR(NVL(SUBSTR(MAX(CASE WHEN S.TRSP_MOD_CD = 'RD' THEN S.COST_ACT_GRP_SEQ||NVL(S.N4TH_NOD_CD, NVL(S.N3RD_NOD_CD, S.N2ND_NOD_CD)) END),4,5)," ).append("\n"); 
		query.append("                                                       DECODE(BKG.POD_CD, AD_BL.HUB_LOC_CD, AD_BL.HUB_LOC_CD)),1,5),'0','1')  " ).append("\n"); 
		query.append("                    ||DECODE(CSTMS_LOC_CD,BKG.DEL_CD,'0','1')   " ).append("\n"); 
		query.append("                    ||DECODE(SIGN(INSTR(SUBSTR(MAX(CASE WHEN S.TRSP_MOD_CD = 'RD' THEN S.COST_ACT_GRP_SEQ||S.N4TH_NOD_CD||S.N3RD_NOD_CD||S.N2ND_NOD_CD END),4)||SUBSTR(MIN(CASE WHEN S.TRSP_MOD_CD = 'RD' THEN S.COST_ACT_GRP_SEQ||S.N4TH_NOD_CD||S.N3RD_NOD_CD||S.N2ND_NOD_CD END),4)" ).append("\n"); 
		query.append("                          ,CSTMS_LOC_CD)),1,0,1)                                          " ).append("\n"); 
		query.append("                    ||DECODE(CSTMS_LOC_CD||SUBSTR(NVL(SUBSTR(MAX(CASE WHEN S.TRSP_MOD_CD = 'RD' THEN S.COST_ACT_GRP_SEQ||NVL(S.N4TH_NOD_CD, NVL(S.N3RD_NOD_CD, S.N2ND_NOD_CD)) END),4,5)," ).append("\n"); 
		query.append("                                                       DECODE(BKG.POD_CD, AD_BL.HUB_LOC_CD, AD_BL.HUB_LOC_CD)),1,5), 'USMKCUSKCK', '0','USKCKUSMKC','0', '1' )  " ).append("\n"); 
		query.append("                    ||DECODE(CSTMS_LOC_CD||BKG.DEL_CD, 'USMKCUSKCK', '0','USKCKUSMKC','0', '1' )," ).append("\n"); 
		query.append("                    '111111','Y','N'),  " ).append("\n"); 
		query.append("              DECODE(DECODE(CSTMS_LOC_CD,BKG.POD_CD,'0','1')  " ).append("\n"); 
		query.append("                    ||DECODE(CSTMS_LOC_CD,SUBSTR(NVL(SUBSTR(MAX(CASE WHEN S.TRSP_MOD_CD = 'RD' THEN S.COST_ACT_GRP_SEQ||NVL(S.N4TH_NOD_CD, NVL(S.N3RD_NOD_CD, S.N2ND_NOD_CD)) END),4,5), " ).append("\n"); 
		query.append("                                                       DECODE(BKG.POD_CD, AD_BL.HUB_LOC_CD, AD_BL.HUB_LOC_CD)),1,5),'0','1')  " ).append("\n"); 
		query.append("                    --DECODE(edi.c_loc,BKG.del_loc,'0','1')||     Door는 POD와 C_LOC가 같아도 ADD로 본다   " ).append("\n"); 
		query.append("                    ||DECODE(CSTMS_LOC_CD||SUBSTR(NVL(SUBSTR(MAX(CASE WHEN S.TRSP_MOD_CD = 'RD' THEN S.COST_ACT_GRP_SEQ||NVL(S.N4TH_NOD_CD, NVL(S.N3RD_NOD_CD, S.N2ND_NOD_CD)) END),4,5)," ).append("\n"); 
		query.append("                                                       DECODE(BKG.POD_CD, AD_BL.HUB_LOC_CD, AD_BL.HUB_LOC_CD)),1,5), 'USMKCUSKCK', '0','USKCKUSMKC','0', '1' )  " ).append("\n"); 
		query.append("                    ||DECODE(CSTMS_LOC_CD||BKG.DEL_CD, 'USMKCUSKCK', '0','USKCKUSMKC','0', '1' )," ).append("\n"); 
		query.append("                    '1111','Y','N')),   " ).append("\n"); 
		query.append("            --CASE OF Rail NOT Issued  " ).append("\n"); 
		query.append("              DECODE(" ).append("\n"); 
		query.append("                DECODE(CSTMS_LOC_CD,BKG.POD_CD,'0','1')  " ).append("\n"); 
		query.append("                ||DECODE(CSTMS_LOC_CD,SUBSTR(AD_BL.HUB_LOC_CD,1,5),'0','1')  " ).append("\n"); 
		query.append("                ||DECODE(CSTMS_LOC_CD,BKG.DEL_CD,'0','1')  " ).append("\n"); 
		query.append("                ||DECODE(CSTMS_LOC_CD||SUBSTR(AD_BL.HUB_LOC_CD,1,5), 'USMKCUSKCK', '0','USKCKUSMKC','0', '1' )  " ).append("\n"); 
		query.append("                ||DECODE(CSTMS_LOC_CD||BKG.DEL_CD, 'USMKCUSKCK', '0','USKCKUSMKC','0', '1' )," ).append("\n"); 
		query.append("                '11111','Y','N')" ).append("\n"); 
		query.append("              ) ADD_TRSP,                     " ).append("\n"); 
		query.append("              MAX(CASE WHEN S.TRSP_MOD_CD ='RD' AND S.TRSP_SO_STS_CD ='P' THEN 'Y' ELSE 'N' END)  RL_SO_PLN_FLG," ).append("\n"); 
		query.append("              MAX(CASE WHEN S.TRSP_MOD_CD ='RD' AND S.TRSP_SO_STS_CD IN ('C','R','I','E','F','X') THEN 'Y' ELSE 'N' END) RL_SO_FLG, " ).append("\n"); 
		query.append("              --MAX(CASE WHEN S.TRSP_MOD_CD ='RD' AND S.TRSP_SO_STS_CD IN ('I','E','X') THEN 'Y' ELSE 'N' END)  RL_WO_FLG," ).append("\n"); 
		query.append("              MAX(CASE WHEN S.TRSP_MOD_CD ='RD' AND S.TRSP_SO_STS_CD IN ('I','E','X') THEN 'Y' " ).append("\n"); 
		query.append("                       WHEN S.TRSP_MOD_CD ='RD' AND S.TRSP_SO_STS_CD IN ('C','R','F','P') THEN 'N' " ).append("\n"); 
		query.append("                       WHEN S.TRSP_MOD_CD ='RD' AND S.TRSP_SO_STS_CD is null THEN 'N' " ).append("\n"); 
		query.append("                  ELSE NULL END)  RL_WO_FLG," ).append("\n"); 
		query.append("             (CASE WHEN MIN(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD <> 'IDTD' THEN S.COST_ACT_GRP_SEQ END) = MIN(S.COST_ACT_GRP_SEQ) " ).append("\n"); 
		query.append("                   THEN DECODE(SUBSTR(MIN(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD <> 'IDTD' THEN S.COST_ACT_GRP_SEQ||S.TRSP_SO_STS_CD END),4,1),'P','Y','N')  ELSE 'N' END) TS_SO_PLN_FLG," ).append("\n"); 
		query.append("             (CASE WHEN MIN(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD <> 'IDTD' THEN S.COST_ACT_GRP_SEQ END) = MIN(S.COST_ACT_GRP_SEQ) " ).append("\n"); 
		query.append("                   THEN DECODE(SUBSTR(MIN(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD <> 'IDTD' THEN S.COST_ACT_GRP_SEQ||S.TRSP_SO_STS_CD END),4,1),'P','N','Y')  ELSE 'N' END) TS_SO_FLG," ).append("\n"); 
		query.append("             (CASE WHEN MIN(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD <> 'IDTD' THEN S.COST_ACT_GRP_SEQ END) = MIN(S.COST_ACT_GRP_SEQ) " ).append("\n"); 
		query.append("                   --THEN DECODE(SUBSTR(MIN(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD <> 'IDTD' THEN S.COST_ACT_GRP_SEQ||S.TRSP_SO_STS_CD END),4,1),'I','Y','E','Y','X','Y','N') ELSE 'N' END) TS_WO_FLG," ).append("\n"); 
		query.append("                   THEN DECODE(SUBSTR(MIN(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD <> 'IDTD' THEN S.COST_ACT_GRP_SEQ||S.TRSP_SO_STS_CD END),4,1),'I','Y','E','Y','X','Y','N') ELSE Null END) TS_WO_FLG," ).append("\n"); 
		query.append("             (CASE WHEN MIN(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD <> 'IDTD' THEN S.COST_ACT_GRP_SEQ END) <> MIN(S.COST_ACT_GRP_SEQ) " ).append("\n"); 
		query.append("                   THEN DECODE(SUBSTR(MIN(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD <> 'IDTD' THEN S.COST_ACT_GRP_SEQ||S.TRSP_SO_STS_CD END),4,1),'P','Y','N') ELSE 'N' END) TC_SO_PLN_FLG ," ).append("\n"); 
		query.append("             (CASE WHEN MIN(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD <> 'IDTD' THEN S.COST_ACT_GRP_SEQ END) <> MIN(S.COST_ACT_GRP_SEQ) " ).append("\n"); 
		query.append("                   THEN DECODE(SUBSTR(MIN(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD <> 'IDTD' THEN S.COST_ACT_GRP_SEQ||S.TRSP_SO_STS_CD END),4,1),'P','N','Y') ELSE 'N' END) TC_SO_FLG," ).append("\n"); 
		query.append("             (CASE WHEN MIN(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD <> 'IDTD' THEN S.COST_ACT_GRP_SEQ END) <> MIN(S.COST_ACT_GRP_SEQ) " ).append("\n"); 
		query.append("                   --THEN DECODE(SUBSTR(MIN(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD <> 'IDTD' THEN S.COST_ACT_GRP_SEQ||S.TRSP_SO_STS_CD END),4,1),'I','Y','E','Y','X','Y','N') ELSE 'N' END) TC_WO_FLG," ).append("\n"); 
		query.append("                   THEN DECODE(SUBSTR(MIN(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD <> 'IDTD' THEN S.COST_ACT_GRP_SEQ||S.TRSP_SO_STS_CD END),4,1),'I','Y','E','Y','X','Y','N') ELSE Null END) TC_WO_FLG," ).append("\n"); 
		query.append("              MAX(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD = 'IDTD' AND S.TRSP_SO_STS_CD = 'P' THEN 'Y' ELSE 'N' END) DR_SO_PLN_FLG ," ).append("\n"); 
		query.append("              MAX(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD = 'IDTD' AND S.TRSP_SO_STS_CD IN ('C','R','I','E','F','X') THEN 'Y' ELSE 'N' END) DR_SO_FLG," ).append("\n"); 
		query.append("              --MAX(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD = 'IDTD' AND S.TRSP_SO_STS_CD IN ('I','E','F','X') AND SO.COST_ACT_GRP_CD = 'IDTD' THEN 'Y' ELSE 'N' END) DR_WO_FLG," ).append("\n"); 
		query.append("              MAX(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD = 'IDTD' AND S.TRSP_SO_STS_CD IN ('I','E','F','X') THEN 'Y' " ).append("\n"); 
		query.append("                       WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD = 'IDTD' AND S.TRSP_SO_STS_CD IN ('C','R','P') THEN 'N' " ).append("\n"); 
		query.append("              ELSE null END) DR_WO_FLG," ).append("\n"); 
		query.append("              MAX(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD = 'IDTD' AND SO.COST_ACT_GRP_CD = 'IDTD' THEN TO_CHAR(WK.CRE_DT,'YYYY/MM/DD HH24:MI:SS') END) DR_WO_DT , " ).append("\n"); 
		query.append("              MAX(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD = 'IDTD' THEN S.N1ST_NOD_CD END) DR_FM ," ).append("\n"); 
		query.append("              MAX(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD = 'IDTD' THEN NVL(N4TH_NOD_CD, NVL(N3RD_NOD_CD, N2ND_NOD_CD)) END) DR_TO ," ).append("\n"); 
		query.append("              MAX(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD = 'IDTD' AND S.COP_NO = SO.COP_NO AND S.COST_ACT_GRP_CD=SO.COST_ACT_GRP_CD THEN NVL(WK.WO_VNDR_SEQ,S.N1ST_VNDR_SEQ) END) DR_SP," ).append("\n"); 
		query.append("              MAX(CASE WHEN S.TRSP_MOD_CD = 'TD' AND S.COST_ACT_GRP_CD = 'IDTD' AND S.COP_NO = SO.COP_NO AND S.COST_ACT_GRP_CD=SO.COST_ACT_GRP_CD " ).append("\n"); 
		query.append("                       THEN (SELECT V.VNDR_LGL_ENG_NM " ).append("\n"); 
		query.append("                               FROM MDM_VENDOR V" ).append("\n"); 
		query.append("                              WHERE NVL(WK.WO_VNDR_SEQ,S.N1ST_VNDR_SEQ) = V.VNDR_SEQ) " ).append("\n"); 
		query.append("                   END) DR_SP_NM,              " ).append("\n"); 
		query.append("--              COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00134', COP_STS_CD) COP_STS_CD, " ).append("\n"); 
		query.append("              COP_STS_CD, " ).append("\n"); 
		query.append("              (CASE WHEN MAX(CASE WHEN S.TRSP_MOD_CD = 'TD' THEN S.COST_ACT_GRP_SEQ END) > MAX(CASE WHEN S.TRSP_MOD_CD = 'RD' THEN S.COST_ACT_GRP_SEQ END)" ).append("\n"); 
		query.append("                    THEN SUBSTR(MAX(CASE WHEN S.TRSP_MOD_CD = 'TD' THEN S.COST_ACT_GRP_SEQ||S.N1ST_NOD_CD END),4) END ) FRM,  " ).append("\n"); 
		query.append("--              PUC.PKUP_YD_CD ,  " ).append("\n"); 
		query.append("              NVL((SELECT NOD_CD " ).append("\n"); 
		query.append("                     FROM SCE_COP_DTL " ).append("\n"); 
		query.append("                    WHERE COP_NO = SCH.COP_NO " ).append("\n"); 
		query.append("                      AND COP_DTL_SEQ = (SELECT MAX(COP_DTL_SEQ) FROM SCE_COP_DTL " ).append("\n"); 
		query.append("                                          WHERE COP_NO = SCH.COP_NO " ).append("\n"); 
		query.append("                                            AND  ACT_CD LIKE 'FI%DO'" ).append("\n"); 
		query.append("                                            AND SUBSTR(NOD_CD, 1, 2) IN ('US','CA')" ).append("\n"); 
		query.append("                                        )" ).append("\n"); 
		query.append("                  ), PUC.PKUP_YD_CD)  PKUP_YD_CD," ).append("\n"); 
		query.append("              TO_CHAR(PUC.PKUP_AVAL_DT,'YYYY/MM/DD HH24:MI:SS') PKUP_AVAL_DT,  " ).append("\n"); 
		query.append("              TO_CHAR(PUC.LST_FREE_DT,'YYYY/MM/DD HH24:MI:SS') LST_FREE_DT ," ).append("\n"); 
		query.append("              IBC.FRT_CLT_FLG F," ).append("\n"); 
		query.append("              IBC.OBL_RDEM_FLG O," ).append("\n"); 
		query.append("              IBC.CSTMS_CLR_CD C," ).append("\n"); 
		query.append("              (SELECT ICR.DSPO_CD " ).append("\n"); 
		query.append("                 FROM BKG_CSTMS_ADV_RSLT ICR" ).append("\n"); 
		query.append("                WHERE ICR.CNT_CD = SUBSTR(BKG.POD_CD, 1, 2)" ).append("\n"); 
		query.append("                  AND ICR.BL_NO = BKG.BL_NO" ).append("\n"); 
		query.append("                  AND ICR.CSTMS_SEQ = (SELECT MAX(CSTMS_SEQ) " ).append("\n"); 
		query.append("                                         FROM BKG_CSTMS_ADV_RSLT ICR2" ).append("\n"); 
		query.append("                                        WHERE ICR.CNT_CD =ICR2.CNT_CD" ).append("\n"); 
		query.append("                                          AND ICR.BL_NO =ICR2.BL_NO" ).append("\n"); 
		query.append("                                       )" ).append("\n"); 
		query.append("              ) DSPO_CD," ).append("\n"); 
		query.append("              PUC.PKUP_NO , " ).append("\n"); 
		query.append("              PUC.OFC_CD PKUP_OFC_CD , " ).append("\n"); 
		query.append("              DECODE(PUC.PKUP_NTC_IND_CD,'S','Y','E','Y','N') PKUP_END," ).append("\n"); 
		query.append("              BKG.SC_NO," ).append("\n"); 
		query.append("              --(SCEM)US Inland Operation Report 상의 특수문자중  chr(29)인식 재처리 로직 추가 시작(CHM-201007730-01)" ).append("\n"); 
		query.append("              MAX(DECODE(BKG_CUST_TP_CD,'C',SUBSTRB(BKG_SPCLCHAR_CONV_FNC(CU.CUST_NM, 'M'), 1, 50))) CNEE_NM ," ).append("\n"); 
		query.append("              MAX(DECODE(BKG_CUST_TP_CD,'C',SUBSTRB(BKG_SPCLCHAR_CONV_FNC(CU.CUST_ADDR,'M'), 1, 50))) CNEE_ADDR ," ).append("\n"); 
		query.append("              MAX(DECODE(BKG_CUST_TP_CD,'S',SUBSTRB(BKG_SPCLCHAR_CONV_FNC(CU.CUST_NM,  'M'), 1, 50))) SHPR_NM ," ).append("\n"); 
		query.append("              MAX(DECODE(BKG_CUST_TP_CD,'S',SUBSTRB(BKG_SPCLCHAR_CONV_FNC(CU.CUST_ADDR, 'M'), 1, 50))) SHPR_ADDR ," ).append("\n"); 
		query.append("              MAX(DECODE(BKG_CUST_TP_CD,'N',SUBSTRB(BKG_SPCLCHAR_CONV_FNC(CU.CUST_NM, 'M'), 1, 50))) NTFY_NM ," ).append("\n"); 
		query.append("              MAX(DECODE(BKG_CUST_TP_CD,'N',SUBSTRB(BKG_SPCLCHAR_CONV_FNC(CU.CUST_ADDR, 'M'), 1, 50))) NTFY_ADDR ,              " ).append("\n"); 
		query.append("              --(SCEM)US Inland Operation Report 상의 특수문자중  chr(29)인식 재처리 로직 추가 끝(CHM-201007730-01) " ).append("\n"); 
		query.append("              DECODE(SUBSTR(BKG.POD_CD,1,2),'US',BKG.USA_CSTMS_FILE_CD,'CA',BKG.CND_CSTMS_FILE_CD ) FILE_CD," ).append("\n"); 
		query.append("              AD_BD.IBD_TRSP_NO," ).append("\n"); 
		query.append("              TO_CHAR(AD_BD.IBD_TRSP_ISS_DT,'YYYY/MM/DD HH24:MI:SS') IBD_TRSP_ISS_DT," ).append("\n"); 
		query.append("              --BC.PO_NO PO_NO , " ).append("\n"); 
		query.append("              MAX((SELECT CUST_REF_NO_CTNT FROM BKG_REFERENCE WHERE BKG_NO=BKG.BKG_NO AND CNTR_NO=BC.CNTR_NO AND BKG_REF_TP_CD='CTPO' AND ROWNUM=1)) PO_NO ,            " ).append("\n"); 
		query.append("              BS.CNTR_SEAL_NO," ).append("\n"); 
		query.append("              TRUNC(DECODE(BC.WGT_UT_CD, 'KGS', NVL(BC.CNTR_WGT, 0) * 2.2, NVL(BC.CNTR_WGT, 0))) CNTR_WGT ,   " ).append("\n"); 
		query.append("--              SUBSTR(MAX(CASE WHEN S.TRSP_MOD_CD = 'RD' THEN S.COST_ACT_GRP_SEQ||CLM.CLM_SGHT_ABBR_NM END),4) CLM_CRNT_STS," ).append("\n"); 
		query.append("--              SUBSTR(MAX(CASE WHEN S.TRSP_MOD_CD = 'RD' THEN S.COST_ACT_GRP_SEQ||RL.ARR_LOC_NM END),4) CLM_LOC," ).append("\n"); 
		query.append("--              SUBSTR(MAX(CASE WHEN S.TRSP_MOD_CD = 'RD' THEN S.COST_ACT_GRP_SEQ||RL.ARR_STE_CD END),4) CLM_STATE," ).append("\n"); 
		query.append("--              SUBSTR(MAX(CASE WHEN S.TRSP_MOD_CD = 'RD' THEN S.COST_ACT_GRP_SEQ||TO_CHAR(RL.ARR_DT,'YYYY/MM/DD HH24:MI:SS') END),4) CLM_DT," ).append("\n"); 
		query.append("              NVL(REPLACE(REPLACE(REPLACE(REPLACE(MAX(BC.DIFF_RMK), chr(10),' '), chr(13),' '), CHR(34),' '),CHR(10),' '), ' ') BKG_CNTR_RMK," ).append("\n"); 
		query.append("              NVL(MAX(( SELECT VNDR_SEQ FROM EDI_324_GRP WHERE VNDR_SEQ = S.N1ST_VNDR_SEQ AND S.COST_ACT_GRP_CD = 'IYRD')),MAX(S.N1ST_VNDR_SEQ)) VNDR_SEQ," ).append("\n"); 
		query.append("              RANK() OVER (PARTITION BY SCH.COP_NO, DTL.ACT_CD ORDER BY SCH.COP_NO, DTL.COP_DTL_SEQ DESC) RAIL_RANK," ).append("\n"); 
		query.append("              TO_CHAR(DTL.ESTM_DT,'YYYY/MM/DD HH24:MI:SS') ESTM_DT," ).append("\n"); 
		query.append("	          MAX(DO_REF.INTER_RMK) INTER_RMK," ).append("\n"); 
		query.append("		      NVL(MAX(DO_REF.DO_HLD_FLG),'N') AS DO_HLD_FLG" ).append("\n"); 
		query.append("         FROM VSK_VSL_PORT_SKD VPS" ).append("\n"); 
		query.append("            , BKG_BOOKING BKG" ).append("\n"); 
		query.append("		#if(${s_cntr_no} != '' && ${s_bkg_no} == '')" ).append("\n"); 
		query.append("            , (SELECT *" ).append("\n"); 
		query.append("                 FROM (SELECT H.*" ).append("\n"); 
		query.append("                         FROM SCE_COP_HDR H" ).append("\n"); 
		query.append("                        WHERE 1=1" ).append("\n"); 
		query.append("                          AND H.CNTR_NO IN (                                    " ).append("\n"); 
		query.append("                                 #foreach( $ele in ${s_cntr_no}) " ).append("\n"); 
		query.append("                                    #if($velocityCount == 1) " ).append("\n"); 
		query.append("                                        '$ele'" ).append("\n"); 
		query.append("                                    #else" ).append("\n"); 
		query.append("                                        ,'$ele'" ).append("\n"); 
		query.append("                                    #end " ).append("\n"); 
		query.append("                                 #end" ).append("\n"); 
		query.append("                              )" ).append("\n"); 
		query.append("                          AND H.COP_STS_CD NOT IN ('X')" ).append("\n"); 
		query.append("                        ORDER BY DECODE(H.COP_STS_CD, 'T', 1, 'C', 1, 'F', 2), H.UPD_DT DESC" ).append("\n"); 
		query.append("                       )" ).append("\n"); 
		query.append("                WHERE ROWNUM = 1) SCH" ).append("\n"); 
		query.append("        #else" ).append("\n"); 
		query.append("            , SCE_COP_HDR SCH" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("            , SCE_PLN_SO_LIST S" ).append("\n"); 
		query.append("            , MDM_LOCATION ML" ).append("\n"); 
		query.append("            , BKG_CONTAINER BC" ).append("\n"); 
		query.append("            , BKG_CNTR_SEAL_NO BS" ).append("\n"); 
		query.append("            , BKG_CUSTOMER CU" ).append("\n"); 
		query.append("            , BKG_CGO_RLSE IBC" ).append("\n"); 
		query.append("            , BKG_CSTMS_ADV_BL AD_BL" ).append("\n"); 
		query.append("            , BKG_CSTMS_ADV_IBD AD_BD" ).append("\n"); 
		query.append("            , BKG_PKUP_NTC_PKUP_NO PUC " ).append("\n"); 
		query.append("            , TRS_TRSP_SVC_ORD SO" ).append("\n"); 
		query.append("--            , TRS_TRSP_RAIL_BIL_ORD RL" ).append("\n"); 
		query.append("            , TRS_TRSP_WRK_ORD WK" ).append("\n"); 
		query.append("--            , SCE_CLM_SGHT CLM" ).append("\n"); 
		query.append("            , SCE_COP_DTL DTL" ).append("\n"); 
		query.append("            , BKG_VVD VVD" ).append("\n"); 
		query.append("            , BKG_DO_REF DO_REF" ).append("\n"); 
		query.append("           #if(${dateselect} == 'S')" ).append("\n"); 
		query.append("            , EDI_324_GRP EG" ).append("\n"); 
		query.append("            , SCE_EDI_324_SND_RSLT SLT" ).append("\n"); 
		query.append("           #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        WHERE 1= 1" ).append("\n"); 
		query.append("     #if(${fm_dt} != '' && ${to_dt} != '')" ).append("\n"); 
		query.append("       #if(${dateselect} == 'E')" ).append("\n"); 
		query.append("          AND VPS.VPS_ETA_DT BETWEEN to_date(@[fm_dt]||' 00:00:00','YYYY/MM/DD HH24:MI:SS') AND to_date(@[to_dt]||' 23:59:59','YYYY/MM/DD HH24:MI:SS')" ).append("\n"); 
		query.append("       #elseif(${dateselect} == 'R')" ).append("\n"); 
		query.append("          AND DTL.ESTM_DT BETWEEN to_date(@[fm_dt]||' 00:00:00','YYYY/MM/DD HH24:MI:SS') AND to_date(@[to_dt]||' 23:59:59','YYYY/MM/DD HH24:MI:SS')" ).append("\n"); 
		query.append("       #end" ).append("\n"); 
		query.append("     #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("       /* BOOKING LOCATION */" ).append("\n"); 
		query.append("		-- AND BKG.DEL_CD = ML.LOC_CD	-- CORRECTION 4" ).append("\n"); 
		query.append("       /* COP DTAIL */" ).append("\n"); 
		query.append("          AND SCH.COP_NO = DTL.COP_NO(+)" ).append("\n"); 
		query.append("          AND DTL.ACT_CD(+) = 'FIRRAD'" ).append("\n"); 
		query.append("       /* correction */" ).append("\n"); 
		query.append("        #if(${s_bkg_no} != '')  " ).append("\n"); 
		query.append("   	      AND (BKG.BKG_NO IN (                                    " ).append("\n"); 
		query.append("                                #foreach( $ele in ${s_bkg_no}) " ).append("\n"); 
		query.append("                                    #if($velocityCount == 1) " ).append("\n"); 
		query.append("                                        '$ele'" ).append("\n"); 
		query.append("	                                #else" ).append("\n"); 
		query.append("                                        ,'$ele'" ).append("\n"); 
		query.append("    	                            #end " ).append("\n"); 
		query.append("                                #end" ).append("\n"); 
		query.append("        	                 )" ).append("\n"); 
		query.append("               )" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        /* correction */" ).append("\n"); 
		query.append("		#if(${s_cntr_no} != '')" ).append("\n"); 
		query.append("       	  AND (SCH.CNTR_NO IN (                                    " ).append("\n"); 
		query.append("                                 #foreach( $ele in ${s_cntr_no}) " ).append("\n"); 
		query.append("                                    #if($velocityCount == 1) " ).append("\n"); 
		query.append("                                        '$ele'" ).append("\n"); 
		query.append("                                    #else" ).append("\n"); 
		query.append("                                        ,'$ele'" ).append("\n"); 
		query.append("                                    #end " ).append("\n"); 
		query.append("                                 #end" ).append("\n"); 
		query.append("                              )" ).append("\n"); 
		query.append("               )" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        /* MASTER BOOKING_Status */" ).append("\n"); 
		query.append("        #if(${mst_bkg_sts} != '')" ).append("\n"); 
		query.append("            #if(${mst_bkg_sts} == 'Y')" ).append("\n"); 
		query.append("          AND SCH.MST_COP_NO = SCH.COP_NO" ).append("\n"); 
		query.append("            #elseif(${mst_bkg_sts} == 'N')" ).append("\n"); 
		query.append("          AND SCH.MST_COP_NO != SCH.COP_NO" ).append("\n"); 
		query.append("            #end" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        /* POL_POD */" ).append("\n"); 
		query.append("        #if(${s_pol_pod} != '')" ).append("\n"); 
		query.append("          AND VPS.VPS_PORT_CD IN (" ).append("\n"); 
		query.append("        		#if( ${s_pol_pod} == 'ALL')" ).append("\n"); 
		query.append("                	#foreach($ele in ${port_cd}) " ).append("\n"); 
		query.append("                		#if($velocityCount == 1) " ).append("\n"); 
		query.append("                        	'$ele'" ).append("\n"); 
		query.append("                        #else" ).append("\n"); 
		query.append("                        	,'$ele' " ).append("\n"); 
		query.append("                        #end " ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                #else" ).append("\n"); 
		query.append("                	#foreach($ele in ${s_pol_pod})" ).append("\n"); 
		query.append("                    	#if($velocityCount == 1) " ).append("\n"); 
		query.append("                        	'$ele'" ).append("\n"); 
		query.append("                        #else" ).append("\n"); 
		query.append("                        	,'$ele'" ).append("\n"); 
		query.append("                        #end " ).append("\n"); 
		query.append("                    #end " ).append("\n"); 
		query.append("                #end" ).append("\n"); 
		query.append("                                  )                          " ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        /* Lane */" ).append("\n"); 
		query.append("        #if(${s_lane} != '')" ).append("\n"); 
		query.append("          AND VPS.SLAN_CD = @[s_lane]" ).append("\n"); 
		query.append("        #end            " ).append("\n"); 
		query.append("        #if(${s_vvd} != '')" ).append("\n"); 
		query.append("          AND VPS.VSL_CD = substr(@[s_vvd],1,4)" ).append("\n"); 
		query.append("          AND VPS.SKD_VOY_NO = substr(@[s_vvd],5,4)" ).append("\n"); 
		query.append("          AND VPS.SKD_DIR_CD = substr(@[s_vvd],9,1)" ).append("\n"); 
		query.append("        #end " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("--          AND BKG.VSL_CD = VPS.VSL_CD" ).append("\n"); 
		query.append("--          AND BKG.SKD_VOY_NO = VPS.SKD_VOY_NO" ).append("\n"); 
		query.append("--          AND BKG.SKD_DIR_CD = VPS.SKD_DIR_CD" ).append("\n"); 
		query.append("--          AND BKG.POD_CD = VPS.VPS_PORT_CD" ).append("\n"); 
		query.append("          AND BKG.BKG_NO = VVD.BKG_NO" ).append("\n"); 
		query.append("          AND VVD.VSL_CD = VPS.VSL_CD" ).append("\n"); 
		query.append("          AND VVD.SKD_VOY_NO = VPS.SKD_VOY_NO" ).append("\n"); 
		query.append("          AND VVD.SKD_DIR_CD = VPS.SKD_DIR_CD" ).append("\n"); 
		query.append("          AND VVD.POD_CD = VPS.VPS_PORT_CD" ).append("\n"); 
		query.append("          AND SUBSTR(VVD.POD_CD, 1, 2) IN ('US','CA')" ).append("\n"); 
		query.append("        /* DEL */" ).append("\n"); 
		query.append("        #if(${s_del} != '')" ).append("\n"); 
		query.append("          AND   BKG.DEL_CD  =  @[s_del]" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        /* SC_NO */" ).append("\n"); 
		query.append("        #if(${s_sc_no} != '')" ).append("\n"); 
		query.append("          AND BKG.SC_NO  =  @[s_sc_no]" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("          AND BKG.BKG_CGO_TP_CD IN ('F', 'R')" ).append("\n"); 
		query.append("          AND BKG.BKG_STS_CD IN ('F', 'W')" ).append("\n"); 
		query.append("        #if(${s_c_loc} != '')" ).append("\n"); 
		query.append("            #if(${s_c_loc} == 'L')" ).append("\n"); 
		query.append("          AND ( BKG.DEST_TRNS_SVC_MOD_CD IN ('CLO', 'ELO','LOC','NLO') OR BKG.DEST_TRNS_SVC_MOD_CD IS NULL )" ).append("\n"); 
		query.append("            #else" ).append("\n"); 
		query.append("          AND BKG.DEST_TRNS_SVC_MOD_CD IN ('CIP', 'IPI','MLB','NIP')" ).append("\n"); 
		query.append("            #end" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("          AND BC.BKG_NO = BKG.BKG_NO" ).append("\n"); 
		query.append("        /* P_NO */" ).append("\n"); 
		query.append("        #if(${t_p_no} == 'Y')" ).append("\n"); 
		query.append("          AND PUC.PKUP_NO IS NOT NULL" ).append("\n"); 
		query.append("        #elseif(${t_p_no} == 'N')" ).append("\n"); 
		query.append("          AND PUC.PKUP_NO IS NULL" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("          AND BC.BKG_NO =BS.BKG_NO(+)" ).append("\n"); 
		query.append("          AND BC.CNTR_NO = BS.CNTR_NO(+)" ).append("\n"); 
		query.append("          AND BS.CNTR_SEAL_SEQ (+) = 1" ).append("\n"); 
		query.append("          AND BKG.BL_NO = AD_BL.BL_NO(+)" ).append("\n"); 
		query.append("          AND SUBSTR(BKG.POD_CD, 1, 2) =AD_BL.CNT_CD(+)" ).append("\n"); 
		query.append("          AND BKG.BL_NO = AD_BD.BL_NO(+)" ).append("\n"); 
		query.append("          AND SUBSTR(BKG.POD_CD, 1, 2) =AD_BD.CNT_CD(+)" ).append("\n"); 
		query.append("          AND BKG.BL_NO = IBC.BL_NO(+)" ).append("\n"); 
		query.append("          AND SCH.BKG_NO(+) = BC.BKG_NO" ).append("\n"); 
		query.append("          AND SCH.CNTR_NO(+) = BC.CNTR_NO" ).append("\n"); 
		query.append("          AND SCH.COP_STS_CD(+) <> 'X'" ).append("\n"); 
		query.append("          AND S.COP_NO(+) = SCH.COP_NO" ).append("\n"); 
		query.append("          AND S.COST_ACT_GRP_SEQ(+) > '599'" ).append("\n"); 
		query.append("          AND S.COST_ACT_GRP_CD(+) <> 'DMLK'" ).append("\n"); 
		query.append("          AND S.TRSP_MOD_CD(+) > 'A'" ).append("\n"); 
		query.append("        /* So_Office */" ).append("\n"); 
		query.append("        #if(${s_eq_office} != '') " ).append("\n"); 
		query.append("          AND S.CTRL_OFC_CD IN ( " ).append("\n"); 
		query.append("                                #foreach($ele in ${s_eq_offic})" ).append("\n"); 
		query.append("                                	#if($velocityCount == 1) " ).append("\n"); 
		query.append("                                    	'$ele'" ).append("\n"); 
		query.append("                                    #else" ).append("\n"); 
		query.append("                                    	,'$ele'" ).append("\n"); 
		query.append("                                    #end " ).append("\n"); 
		query.append("                                #end " ).append("\n"); 
		query.append("                               )" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        /* SO OFC CD 조절  END */" ).append("\n"); 
		query.append("          AND BC.BKG_NO = SO.BKG_NO(+)" ).append("\n"); 
		query.append("          AND BC.CNTR_NO = SO.EQ_NO(+)" ).append("\n"); 
		query.append("          AND SO.DELT_FLG(+) <> 'Y'" ).append("\n"); 
		query.append("          AND SO.TRSP_SO_TP_CD(+) <> 'S'" ).append("\n"); 
		query.append("          AND WK.TRSP_WO_OFC_CTY_CD(+) = SO.TRSP_WO_OFC_CTY_CD" ).append("\n"); 
		query.append("          AND WK.TRSP_WO_SEQ(+) = SO.TRSP_WO_SEQ" ).append("\n"); 
		query.append("--          AND BC.BKG_NO = RL.BKG_NO(+)" ).append("\n"); 
		query.append("--          AND BC.CNTR_NO = RL.EQ_NO(+)" ).append("\n"); 
		query.append("--          AND RL.DELT_FLG(+) <> 'Y'" ).append("\n"); 
		query.append("--          AND RL.CLM_SGHT_CD = CLM.CLM_SGHT_CD(+)" ).append("\n"); 
		query.append("          AND BC.BKG_NO   = PUC.BKG_NO(+)  " ).append("\n"); 
		query.append("          AND BC.CNTR_NO  = PUC.CNTR_NO(+)" ).append("\n"); 
		query.append("        /* PKUP_Office */" ).append("\n"); 
		query.append("        #if(${s_pup_office} != '')" ).append("\n"); 
		query.append("          AND NVL(PUC.OFC_CD(+),'X') =  @[s_pup_office]" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        /* PKUP_Status */" ).append("\n"); 
		query.append("        #if(${t_pup_sts} != '')" ).append("\n"); 
		query.append("            #if(${t_pup_sts} == 'I')" ).append("\n"); 
		query.append("          AND PUC.PKUP_NTC_IND_CD  IS NOT NULL" ).append("\n"); 
		query.append("            #elseif(${t_pup_sts} == 'N')" ).append("\n"); 
		query.append("          AND PUC.PKUP_NTC_IND_CD  IS NULL" ).append("\n"); 
		query.append("            #end" ).append("\n"); 
		query.append("        #end            " ).append("\n"); 
		query.append("          AND BKG.BKG_NO = CU.BKG_NO" ).append("\n"); 
		query.append("          AND CU.BKG_CUST_TP_CD IN ('S','C','N')" ).append("\n"); 
		query.append("          AND ML.LOC_CD = BKG.DEL_CD" ).append("\n"); 
		query.append("		  AND BKG.BKG_NO = DO_REF.BKG_NO(+)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        /* EQ CONTROL OFFICE */" ).append("\n"); 
		query.append("        #if(${s_neweq_office} != '')" ).append("\n"); 
		query.append("          AND  ML.EQ_CTRL_OFC_CD  IN ( 	#if( ${s_neweq_office} == 'ALL')" ).append("\n"); 
		query.append("                                        	#foreach($ele in ${eqmt_ofc}) " ).append("\n"); 
		query.append("                                           		#if($velocityCount == 1) " ).append("\n"); 
		query.append("		                                           	'$ele'" ).append("\n"); 
		query.append("                                                #else" ).append("\n"); 
		query.append("                                                    ,'$ele' " ).append("\n"); 
		query.append("                                                #end " ).append("\n"); 
		query.append("                                            #end " ).append("\n"); 
		query.append("                                        #else" ).append("\n"); 
		query.append("                                           	#foreach($ele in ${s_neweq_office}) " ).append("\n"); 
		query.append("                                              	#if($velocityCount == 1) " ).append("\n"); 
		query.append("                                                    '$ele'" ).append("\n"); 
		query.append("                                                #else" ).append("\n"); 
		query.append("                                                    ,'$ele' " ).append("\n"); 
		query.append("                                                #end " ).append("\n"); 
		query.append("                                            #end " ).append("\n"); 
		query.append("                                        #end" ).append("\n"); 
		query.append("                                     )" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        /* Rail DEST */" ).append("\n"); 
		query.append("		#if(${s_rail_dest} != '')" ).append("\n"); 
		query.append("       	  AND (SUBSTR(CASE WHEN S.TRSP_MOD_CD = 'RD' " ).append("\n"); 
		query.append("                           THEN S.COST_ACT_GRP_SEQ||NVL(S.N4TH_NOD_CD, NVL(S.N3RD_NOD_CD, S.N2ND_NOD_CD)) " ).append("\n"); 
		query.append("                       END, 4) IN (                                    " ).append("\n"); 
		query.append("	                                   	#foreach( $ele in ${s_rail_dest}) " ).append("\n"); 
		query.append("    	                               		#if($velocityCount == 1) " ).append("\n"); 
		query.append("        	                                	'$ele'" ).append("\n"); 
		query.append("		    	                            #else" ).append("\n"); 
		query.append("        	    	                            ,'$ele'" ).append("\n"); 
		query.append("            			                    #end " ).append("\n"); 
		query.append("                        	            #end" ).append("\n"); 
		query.append("                          	       ) " ).append("\n"); 
		query.append("               OR " ).append("\n"); 
		query.append("               SUBSTR(SUBSTR(CASE WHEN S.TRSP_MOD_CD = 'RD' " ).append("\n"); 
		query.append("                                  THEN S.COST_ACT_GRP_SEQ||NVL(S.N4TH_NOD_CD, NVL(S.N3RD_NOD_CD, S.N2ND_NOD_CD)) " ).append("\n"); 
		query.append("                              END, 4), 1, 5) IN (                                        " ).append("\n"); 
		query.append("                                		           		#foreach( $ele in ${s_rail_dest}) " ).append("\n"); 
		query.append("                                        		   			#if($velocityCount == 1) " ).append("\n"); 
		query.append("					                            		        '$ele'" ).append("\n"); 
		query.append("		                    				                #else" ).append("\n"); 
		query.append("							                                    ,'$ele'" ).append("\n"); 
		query.append("                		    						        #end " ).append("\n"); 
		query.append("                        		                    	#end" ).append("\n"); 
		query.append("                              		             )" ).append("\n"); 
		query.append("       		)   -- 0915 pushkar Rail dest 조건 변경" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        /* Service Provider */" ).append("\n"); 
		query.append("        #if(${vndr_seq} != '' && ${vndr_seq} != 'All')" ).append("\n"); 
		query.append("          AND NVL(( SELECT VNDR_SEQ " ).append("\n"); 
		query.append("                      FROM EDI_324_GRP " ).append("\n"); 
		query.append("                     WHERE VNDR_SEQ = S.N1ST_VNDR_SEQ " ).append("\n"); 
		query.append("                       AND S.COST_ACT_GRP_CD = 'IYRD'), S.N1ST_VNDR_SEQ) = @[vndr_seq]     -- 0915 pushkar Vendor 조건 추가" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        #if(${dateselect} == 'S')" ).append("\n"); 
		query.append("          AND S.N1ST_VNDR_SEQ = EG.VNDR_SEQ" ).append("\n"); 
		query.append("          AND SLT.BKG_NO(+) = SCH.BKG_NO" ).append("\n"); 
		query.append("          AND SLT.COP_NO(+) = SCH.COP_NO" ).append("\n"); 
		query.append("          AND SLT.CNTR_NO (+) = SCH.CNTR_NO" ).append("\n"); 
		query.append("          #if(${fm_dt} != '' && ${to_dt} != '')" ).append("\n"); 
		query.append("          AND SLT.EDI_SND_DT BETWEEN to_date(@[fm_dt]||' 00:00:00','YYYY/MM/DD HH24:MI:SS') AND to_date(@[to_dt]||' 23:59:59','YYYY/MM/DD HH24:MI:SS') " ).append("\n"); 
		query.append("          #end " ).append("\n"); 
		query.append("        #end " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        GROUP BY SCH.COP_NO," ).append("\n"); 
		query.append("                 (CASE WHEN SCH.COP_NO = SCH.MST_COP_NO THEN 'Y' ELSE 'N' END)," ).append("\n"); 
		query.append("                 DTL.ACT_CD,DTL.ESTM_DT, DTL.COP_DTL_SEQ," ).append("\n"); 
		query.append("                 AD_BL.HUB_LOC_CD," ).append("\n"); 
		query.append("                 BKG.BKG_NO ," ).append("\n"); 
		query.append("                 BKG.BL_NO," ).append("\n"); 
		query.append("                 BKG.POD_CD ," ).append("\n"); 
		query.append("                 BKG.DEL_CD ," ).append("\n"); 
		query.append("			     ML.LOC_NM , 		-- CORRECTION 5" ).append("\n"); 
		query.append("                 SUBSTR(SCH.POD_NOD_CD, 1, 5)  ," ).append("\n"); 
		query.append("                 SUBSTR(SCH.DEL_NOD_CD, 1, 5)  ," ).append("\n"); 
		query.append("                 SCH.CNTR_NO, " ).append("\n"); 
		query.append("                 BC.CNTR_NO ," ).append("\n"); 
		query.append("                 BC.CNTR_TPSZ_CD ," ).append("\n"); 
		query.append("                 BC.CNMV_CYC_NO," ).append("\n"); 
		query.append("                 VPS.VSL_CD||VPS.SKD_VOY_NO||VPS.SKD_DIR_CD  ," ).append("\n"); 
		query.append("                 VPS.SLAN_CD ," ).append("\n"); 
		query.append("                 VPS.VPS_ETA_DT ," ).append("\n"); 
		query.append("                 DECODE(BC.RC_FLG,'Y','RF',DECODE(BC.RD_CGO_FLG,'Y','RD',DECODE(BC.DCGO_FLG,'Y','DG',DECODE(BC.BB_CGO_FLG,'Y','BB',DECODE(BC.AWK_CGO_FLG,'Y','AK'))))) ," ).append("\n"); 
		query.append("                 SCH.TRNK_VSL_CD," ).append("\n"); 
		query.append("                 SCH.TRNK_SKD_VOY_NO," ).append("\n"); 
		query.append("                 SCH.TRNK_SKD_DIR_CD, " ).append("\n"); 
		query.append("                 AD_BL.CSTMS_LOC_CD ," ).append("\n"); 
		query.append("                 ML.EQ_CTRL_OFC_CD ," ).append("\n"); 
		query.append("                 BKG.DE_TERM_CD," ).append("\n"); 
		query.append("                 SCH.COP_STS_CD," ).append("\n"); 
		query.append("                 PUC.PKUP_YD_CD ,  " ).append("\n"); 
		query.append("                 PUC.PKUP_AVAL_DT ,  " ).append("\n"); 
		query.append("                 PUC.LST_FREE_DT  ," ).append("\n"); 
		query.append("                 IBC.FRT_CLT_FLG ," ).append("\n"); 
		query.append("                 IBC.OBL_RDEM_FLG ," ).append("\n"); 
		query.append("                 IBC.CSTMS_CLR_CD," ).append("\n"); 
		query.append("                 PUC.PKUP_NO , " ).append("\n"); 
		query.append("                 PUC.OFC_CD ," ).append("\n"); 
		query.append("                 DECODE(PUC.PKUP_NTC_IND_CD,'S','Y','E','Y','N') ," ).append("\n"); 
		query.append("                 BKG.SC_NO," ).append("\n"); 
		query.append("                 DECODE(SUBSTR(BKG.POD_CD,1,2),'US',BKG.USA_CSTMS_FILE_CD,'CA',BKG.CND_CSTMS_FILE_CD )," ).append("\n"); 
		query.append("                 AD_BD.IBD_TRSP_NO," ).append("\n"); 
		query.append("                 AD_BD.IBD_TRSP_ISS_DT," ).append("\n"); 
		query.append("                 BC.PO_NO  ,             " ).append("\n"); 
		query.append("                 BS.CNTR_SEAL_NO," ).append("\n"); 
		query.append("                 TRUNC(DECODE(BC.WGT_UT_CD, 'KGS', NVL(BC.CNTR_WGT, 0) * 2.2, NVL(BC.CNTR_WGT, 0)))," ).append("\n"); 
		query.append("                 NOD_CD  --0915 pushkar" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("              ) K" ).append("\n"); 
		query.append("        WHERE 1=1" ).append("\n"); 
		query.append("          AND RAIL_RANK = 1" ).append("\n"); 
		query.append("/* Rail_Billing_Status */" ).append("\n"); 
		query.append("#if(${t_rail_billing_sts} != '')" ).append("\n"); 
		query.append("  #if(${t_rail_billing_sts} == 'Y')" ).append("\n"); 
		query.append("          AND RL_WO_FLG ='Y'" ).append("\n"); 
		query.append("  #elseif(${t_rail_billing_sts} == 'N')" ).append("\n"); 
		query.append("          AND RL_WO_FLG ='N'" ).append("\n"); 
		query.append("  #end" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("/* Truck_Status : Truck Issued 상태코드 (I/E/X) */" ).append("\n"); 
		query.append("#if(${t_truck_sts} != '')" ).append("\n"); 
		query.append("       #if(${t_truck_sts} == 'Y')" ).append("\n"); 
		query.append("          AND TS_WO_FLG||TC_WO_FLG||DR_WO_FLG LIKE '%Y%'" ).append("\n"); 
		query.append("       #elseif(${t_truck_sts} == 'N')" ).append("\n"); 
		query.append("          AND TS_WO_FLG||TC_WO_FLG||DR_WO_FLG NOT LIKE '%Y%'" ).append("\n"); 
		query.append("       #end" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("/* End_Status  '%EXECUTED%' */" ).append("\n"); 
		query.append("#if(${t_end_sts} != '')" ).append("\n"); 
		query.append("  #if(${t_end_sts} == 'Y')" ).append("\n"); 
		query.append("          --AND RL_WO_FLG||TS_WO_FLG||TC_WO_FLG||DR_WO_FLG LIKE '%Y%'" ).append("\n"); 
		query.append("          AND ((RL_WO_FLG||TS_WO_FLG||TC_WO_FLG||DR_WO_FLG  LIKE '%Y%' AND RL_WO_FLG||TS_WO_FLG||TC_WO_FLG||DR_WO_FLG  NOT LIKE '%N%') " ).append("\n"); 
		query.append("                OR RL_WO_FLG||TS_WO_FLG||TC_WO_FLG||DR_WO_FLG is null)   --finished" ).append("\n"); 
		query.append("  #elseif(${t_end_sts} == 'N')" ).append("\n"); 
		query.append("          --AND RL_WO_FLG||TS_WO_FLG||TC_WO_FLG||DR_WO_FLG NOT LIKE '%Y%'" ).append("\n"); 
		query.append("          AND (RL_WO_FLG||TS_WO_FLG||TC_WO_FLG||DR_WO_FLG NOT LIKE '%Y%' OR RL_WO_FLG||TS_WO_FLG||TC_WO_FLG||DR_WO_FLG LIKE '%N%') -- progress" ).append("\n"); 
		query.append("  #end    " ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("/* Cost_Mode  : 'R' Rail 'D'>Door 'S'>Shuttle 'A'>Additional(CY) 'W'>WATER */" ).append("\n"); 
		query.append("#if(${t_cost_mode} != '')" ).append("\n"); 
		query.append("  #if(${t_cost_mode} == 'R')" ).append("\n"); 
		query.append("          AND RL_SO_PLN_FLG||RL_SO_FLG LIKE '%Y%'" ).append("\n"); 
		query.append("  #elseif(${t_cost_mode} == 'D')" ).append("\n"); 
		query.append("          AND DR_SO_PLN_FLG||DR_SO_FLG  LIKE '%Y%'" ).append("\n"); 
		query.append("  #elseif(${t_cost_mode} == 'S')" ).append("\n"); 
		query.append("          AND TS_SO_PLN_FLG||TS_SO_FLG LIKE '%Y%'" ).append("\n"); 
		query.append("  #elseif(${t_cost_mode} == 'A')" ).append("\n"); 
		query.append("          AND TC_SO_PLN_FLG||TC_SO_FLG  LIKE '%Y%'" ).append("\n"); 
		query.append("  #end" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("      ) KK" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    , (" ).append("\n"); 
		query.append("--        SELECT * " ).append("\n"); 
		query.append("--          FROM (" ).append("\n"); 
		query.append("--                SELECT C1.*, ROW_NUMBER() OVER (PARTITION BY C1.CNTR_NO ORDER BY C1.ARR_DT DESC, C1.RCV_DT DESC) NUM2" ).append("\n"); 
		query.append("--                  FROM (" ).append("\n"); 
		query.append("                        SELECT SCS.CLM_SGHT_ABBR_NM CLM_SGHT_ABBR_NM" ).append("\n"); 
		query.append("                             , CMC.ARR_LOC_NM ARR_LOC" ).append("\n"); 
		query.append("                             , CMC.ARR_LOC_NM ARR_LOC_NM" ).append("\n"); 
		query.append("                             , CMC.ARR_STE_CD ARR_STE_CD" ).append("\n"); 
		query.append("                             , CMC.ARR_DT ARR_DT" ).append("\n"); 
		query.append("                             , CMC.CNTR_NO" ).append("\n"); 
		query.append("                             , CMC.UPD_DT RCV_DT" ).append("\n"); 
		query.append("--                             , ROW_NUMBER() OVER (PARTITION BY CMC.CNTR_NO ORDER BY CMC.ARR_DT DESC, CMC.UPD_DT DESC) NUM" ).append("\n"); 
		query.append("                             , 'SCE_CLM_IF' AS SRC" ).append("\n"); 
		query.append("                          FROM SCE_CLM_IF CMC" ).append("\n"); 
		query.append("                             , SCE_CLM_SGHT SCS" ).append("\n"); 
		query.append("                         WHERE 1=1" ).append("\n"); 
		query.append("                           AND CMC.SO_MAPG_STS_CD != '52'" ).append("\n"); 
		query.append("                           AND CMC.CLM_SGHT_CD = SCS.CLM_SGHT_CD(+)" ).append("\n"); 
		query.append("                         UNION ALL" ).append("\n"); 
		query.append("                        SELECT EDI_322_STS_CD CLM_SGHT_ABBR_NM" ).append("\n"); 
		query.append("                             , EDI.EVNT_YD_CD ARR_LOC" ).append("\n"); 
		query.append("                             , EDI.EVNT_CTY_NM ARR_LOC_NM" ).append("\n"); 
		query.append("                             , EDI.EVNT_STE_CD ARR_STE_CD" ).append("\n"); 
		query.append("                             , EDI.EVNT_DT ARR_DT" ).append("\n"); 
		query.append("                             , EDI.EQ_NO CNTR_NO" ).append("\n"); 
		query.append("                             , EDI.UPD_DT RCV_DT" ).append("\n"); 
		query.append("--                             , ROW_NUMBER() OVER (PARTITION BY EDI.EQ_NO ORDER BY EDI.EVNT_DT DESC, EDI.UPD_DT DESC) NUM" ).append("\n"); 
		query.append("                             , 'EDI_322_MSG' AS SRC" ).append("\n"); 
		query.append("                          FROM EDI_322_MSG EDI" ).append("\n"); 
		query.append("--                       ) C1" ).append("\n"); 
		query.append("--                 WHERE NUM = 1" ).append("\n"); 
		query.append("--             )" ).append("\n"); 
		query.append("--             WHERE NUM2 = 1" ).append("\n"); 
		query.append("      ) CLM" ).append("\n"); 
		query.append("WHERE 1=1" ).append("\n"); 
		query.append("AND KK.CNTR_NO = CLM.CNTR_NO(+)" ).append("\n"); 
		query.append("#if(${edi_status} != 'ALL')" ).append("\n"); 
		query.append("  AND NVL(EDI_SND_TP_CD,'N') = @[edi_status]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append(") L" ).append("\n"); 
		query.append(") LL" ).append("\n"); 
		query.append("WHERE NUM = 1" ).append("\n"); 

	}
}