<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ExceptionDataDBDAOSearchSubscriberGroupMappingRSQL">
			<desc><![CDATA[select group map]]></desc>
			<sql><![CDATA[
select
	grp.COP_EXPT_SUBSC_CS_SEQ COP_EXPT_SUBSC_CS_SEQ,                                                                                 
	tp1.expt_cd r_expt_tp,                                                                                    
	tp1.expt_cd_nm cop_expt_tp_nm,                                                                                 
	tp1.expt_cd_desc expt_tp_desc,                                                                             
	tp2.expt_cd r_expt_tp_dtl,                                                                                
	tp2.expt_cd_nm cop_expt_tp_dtl_nm,                                                                             
	tp2.expt_cd_desc cop_expt_tp_dtl_desc,   	                                                                   
	case when substr(tp3.expt_cd, 4, 1 ) = '1' then tp3.expt_cd else '' end r_fm_act,                         
	case when substr(tp3.expt_cd, 4, 1 ) = '1' then tp3.expt_cd_nm else '' end fm_act_nm,                      
	case when substr(tp3.expt_cd, 4, 1 ) = '1' then tp3.expt_cd_desc else '' end fm_act_desc,                  
	case when substr(tp.expt_cd, 4, 1 ) = '2' then tp.expt_cd else '' end r_to_act,                           
	case when substr(tp.expt_cd, 4, 1 ) = '2' then tp.expt_cd_nm else '' end to_act_nm,                        
	case when substr(tp.expt_cd, 4, 1 ) = '2' then tp.expt_cd_desc else '' end to_act_desc,                    
	grp.cop_expt_subsc_grp_cd r_subseq_grp,                                                                                 
	case when grp.cop_expt_subsc_grp_cd = 'L' then 'Logistics Operation'                                       
	     else case when grp.cop_expt_subsc_grp_cd = 'C' then 'Customer Service'                                
	     else case when grp.cop_expt_subsc_grp_cd = 'U' then 'US Rail Tracing'                                 
	     else '' end end                                                                                       
	     end cop_expt_subsc_grp_nm, /*cop_expt_subsc_grp_nm*/
	grp.subsc_grp_ntfd_pty_cd r_noti_prty,                                                                                 
	case when grp.subsc_grp_ntfd_pty_cd = '1' then 'BKG Create Office'                                         
	     else case when grp.subsc_grp_ntfd_pty_cd = '2' then 'BKG POR Office'                                  
	     else case when grp.subsc_grp_ntfd_pty_cd = '3' then 'BKG POL Office'                                  
	     else case when grp.subsc_grp_ntfd_pty_cd = '4' then 'BKG POD Office'                                  
	     else case when grp.subsc_grp_ntfd_pty_cd = '5' then 'BKG DEL Office'                                  
	     else case when grp.subsc_grp_ntfd_pty_cd = '6' then 'Exception Office'                                
	     else case when grp.subsc_grp_ntfd_pty_cd = '7' then 'US Rail Office'                                  
	     end end end end end end end subsc_grp_ntfd_pty_nm, /*subsc_grp_ntfd_pty_nm*/
	grp.cre_usr_id,                                                                                            
	grp.upd_usr_id r_usr_id,                                                                                            
	TO_CHAR(grp.UPD_DT, 'YYYY/MM/DD HH24:MI') r_upd_dt,                                                                                                
	grp.act_flg r_act                                                                                                
	,fa.act_nm fm_act_desc
	,ta.act_nm to_act_desc
from sce_expt_subsc_mst_grp grp, sce_expt_cd tp, mdm_activity fa, mdm_activity ta,                           
( select * from sce_expt_cd where substr(expt_cd, 2, length(expt_cd) ) = '0000000' and act_flg = 'Y' ) tp1,  
( select * from sce_expt_cd where substr(expt_cd, 4, length(expt_cd) ) = '00000' and act_flg = 'Y' ) tp2,    
( select  expt_cd, substr(expt_cd, 1, 3 )||substr(expt_cd, 5, 2 ) expt_cd1, expt_cd_nm, expt_cd_desc         
  from sce_expt_cd where substr(expt_cd, 4, 1 ) = '1' and act_flg = 'Y' ) tp3                                
where grp.expt_cd = tp.expt_cd                                                                               
and substr(grp.expt_cd, 1, 1 ) = substr(tp1.expt_cd, 1, 1 )                                                  
and substr(grp.expt_cd, 1, 3 ) = substr(tp2.expt_cd, 1, 3 )                                                  
and substr(grp.expt_cd, 1, 3 )||substr(grp.expt_cd, 5, 2 ) = tp3.expt_cd1                                    
and tp.act_flg = 'Y'                                                                                         

#if(${h_expt_tp} != '')
AND substr(tp.expt_cd, 1, 1 ) = @[h_expt_tp]
#end

#if(${h_expt_tp_dtl} != '')
AND substr(tp.expt_cd, 1, 3 ) = @[h_expt_tp_dtl]
#end
		
and fa.act_cd(+) = DECODE(substr(tp3.expt_cd, 4, 1 ),'1',tp3.expt_cd_nm)  
and ta.act_cd(+) = DECODE(substr(tp.expt_cd, 4, 1 ),'2',tp.expt_cd_nm)  

order by  tp.expt_cd			]]></sql>
			<params>
				<param name="h_expt_tp" type="12" value="2" out="N"/>
				<param name="h_expt_tp_dtl" type="12" value="201" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
