<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TESInvoiceCommonDBDAOGetAgmtStsRSQL">
			<desc><![CDATA[(calc 계산시) agreement의 status를 가져온다.]]></desc>
			<sql><![CDATA[
SELECT	(SELECT	COUNT(TML_AGMT_STS_CD)
		FROM	TES_TML_AGMT_HDR H
		WHERE	H.YD_CD    = @[yd_cd]
		AND		H.VNDR_SEQ = @[vndr_seq]
		AND		H.DELT_FLG = 'N'
		AND     H.TML_AGMT_STS_CD = 'C'
		AND		TO_CHAR(H.EFF_FM_DT,'YYYYMMDD') <= REPLACE(@[from_date],'-')
		AND		TO_CHAR(H.EFF_TO_DT,'YYYYMMDD') >= REPLACE(@[to_date],'-')
		AND		H.TML_AGMT_VER_NO = ( SELECT	MAX(M.TML_AGMT_VER_NO)
                                      FROM		TES_TML_AGMT_HDR M
                                      WHERE		M.YD_CD               = @[yd_cd]
                                      AND		M.VNDR_SEQ            = @[vndr_seq]
                                      AND		M.DELT_FLG            = 'N'
									  AND       M.TML_AGMT_STS_CD     = 'C'
                                      AND		TO_CHAR(M.EFF_FM_DT,'YYYYMMDD') <= REPLACE(@[from_date],'-')       
                                      AND		TO_CHAR(M.EFF_TO_DT,'YYYYMMDD') >= REPLACE(@[to_date],'-')) ) EX
		, (SELECT	TML_AGMT_STS_CD                                                                      
		FROM	TES_TML_AGMT_HDR H                                                                   
		WHERE	H.YD_CD    = @[yd_cd]                                                                         
		AND		H.VNDR_SEQ = @[vndr_seq]                                                                      
		AND		H.DELT_FLG = 'N'      
		AND     H.TML_AGMT_STS_CD = 'C'                                                               
		AND		TO_CHAR(H.EFF_FM_DT,'YYYYMMDD') <= REPLACE(@[from_date],'-')                                    
		AND		TO_CHAR(H.EFF_TO_DT,'YYYYMMDD') >= REPLACE(@[to_date],'-')                                    
		AND		H.TML_AGMT_VER_NO = ( SELECT	MAX(M.TML_AGMT_VER_NO)                                  
                                      FROM		TES_TML_AGMT_HDR M                                      
                                      WHERE		M.YD_CD               = @[yd_cd]                                 
                                      AND		M.VNDR_SEQ            = @[vndr_seq]                                       
                                      AND		M.DELT_FLG            = 'N'    
									  AND       M.TML_AGMT_STS_CD     = 'C'                         
                                      AND		TO_CHAR(M.EFF_FM_DT,'YYYYMMDD') <= REPLACE(@[from_date],'-')       
                                      AND		TO_CHAR(M.EFF_TO_DT,'YYYYMMDD') >= REPLACE(@[to_date],'-')) ) ST 
FROM	DUAL			]]></sql>
			<params>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
				<param name="from_date" type="12" value="" out="N"/>
				<param name="to_date" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
