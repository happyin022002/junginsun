<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OffdockCYInvoiceManageDBDAORecalculateRevisedVolumeCountUSQL">
			<desc><![CDATA[RecalculateRevisedVolumeCount]]></desc>
			<sql><![CDATA[
UPDATE TES_TML_SO_DTL D
SET D.RVIS_VOL_QTY = (
 	SELECT B.RVIS_VOL_QTY
 	FROM (
		SELECT
	 		A.CNTR_TPSZ_CD, A.CNTR_STY_CD,
			SUM(DECODE(A.TML_RVIS_IND_FLG,'Y',0,1))
			OVER (PARTITION BY A.CNTR_TPSZ_CD, A.CNTR_STY_CD) AS RVIS_VOL_QTY
 		FROM TES_TML_SO_HDR H,  TES_TML_SO_CNTR_LIST A
 		WHERE 1=1
 			AND H.TML_SO_OFC_CTY_CD = A.TML_SO_OFC_CTY_CD
 			AND H.TML_SO_SEQ = A.TML_SO_SEQ
 			AND H.TML_SO_OFC_CTY_CD = @[tml_so_ofc_cty_cd]
 			AND H.TML_SO_SEQ = @[tml_so_seq]
 			AND A.VRFY_RSLT_IND_CD = 'CO'
			AND A.CNTR_TPSZ_CD = @[cntr_tpsz_cd]
			AND A.DCGO_CLSS_CD = @[param_dcgo_clss_cd]
			AND A.CNTR_STY_CD = @[cntr_sty_cd]
			AND DECODE(A.RC_FLG,'Y','Y','N') = DECODE(@[param_rc_flg],'Y','Y','N')
	) B
 	GROUP BY B.CNTR_TPSZ_CD, B.CNTR_STY_CD, B.RVIS_VOL_QTY
)
WHERE 1=1
	AND D.TML_SO_OFC_CTY_CD = @[tml_so_ofc_cty_cd]
	AND D.TML_SO_SEQ = @[tml_so_seq]
	AND D.CNTR_TPSZ_CD = @[cntr_tpsz_cd]
	AND D.LGS_COST_CD = @[lgs_cost_cd]
	AND D.DCGO_IND_CD = @[param_dcgo_clss_cd]
	AND DECODE(D.RC_FLG,'Y','Y','N') = DECODE(@[param_rc_flg],'Y','Y','N')			]]></sql>
			<params>
				<param name="tml_so_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="tml_so_seq" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="param_dcgo_clss_cd" type="12" value="" out="N"/>
				<param name="cntr_sty_cd" type="12" value="" out="N"/>
				<param name="param_rc_flg" type="12" value="" out="N"/>
				<param name="lgs_cost_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
