<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PrdCreateManageDBDAOUpdatePrdDtlN1stVndrSeqObUSQL">
			<desc><![CDATA[updatePrdDtlN1stVndrSeqOb]]></desc>
			<sql><![CDATA[
UPDATE PRD_PROD_CTL_ROUT_DTL D SET (D.N1ST_VNDR_SEQ,D.CUST_NOMI_TRKR_FLG,D.TRSP_MOD_CD,D.INLND_ROUT_CMB_FLG) 
 = ( SELECT C.VNDR_SEQ,'Y','TD','N'                                                          
     FROM PRD_CUST_PRF C                                                                 
     WHERE C.ORG_LOC_CD =SUBSTR(D.ORG_NOD_CD,1,5)                                        
     AND C.DEST_LOC_CD =SUBSTR(D.DEST_NOD_CD,1,5)                                        
     AND C.TRSP_MOD_CD = 'TD'                                                            
     AND C.TRSP_MOD_CD =D.TRSP_MOD_CD                                                    
     AND D.MTY_YD_FLG ='N'                                                               
     AND D.NOD_LNK_DIV_CD ='L'                                                           
     AND D.PCTL_IO_BND_CD ='I'                                                           
     AND ( C.CUST_CNT_CD, C.CUST_SEQ) = (                                                
     	SELECT DECODE(M.ACT_CUST_CNT_CD,'',M.CNEE_CNT_CD,M.ACT_CUST_CNT_CD),              
              DECODE(M.ACT_CUST_SEQ,'',M.CNEE_SEQ,M.ACT_CUST_SEQ)                        
       FROM PRD_PROD_CTL_MST M                                                           
       WHERE M.PCTL_NO LIKE @[hd_pctl_no]||'%'                                                       
         AND M.PCTL_NO = D.PCTL_NO                                                       
         AND ROWNUM =1   )                                                               
     AND ROWNUM =1                                                                       
    )                                                                                    
 WHERE EXISTS                                                                            
 (SELECT 'X' FROM PRD_CUST_PRF C                                                         
  WHERE C.ORG_LOC_CD =SUBSTR(D.ORG_NOD_CD,1,5)                                           
     AND C.DEST_LOC_CD =SUBSTR(D.DEST_NOD_CD,1,5)                                        
     AND C.TRSP_MOD_CD = 'TD'                                                            
     AND C.TRSP_MOD_CD =D.TRSP_MOD_CD                                                    
     AND D.MTY_YD_FLG ='N'                                                               
     AND D.NOD_LNK_DIV_CD ='L'                                                           
     AND D.PCTL_IO_BND_CD ='I'                                                           
     AND ( C.CUST_CNT_CD, C.CUST_SEQ) = (                                                
     	SELECT DECODE(M.ACT_CUST_CNT_CD,'',M.CNEE_CNT_CD,M.ACT_CUST_CNT_CD),              
              DECODE(M.ACT_CUST_SEQ,'',M.CNEE_SEQ,M.ACT_CUST_SEQ)                        
       FROM PRD_PROD_CTL_MST M                                                           
       WHERE M.PCTL_NO LIKE @[hd_pctl_no||'%'                                                       
         AND M.PCTL_NO = D.PCTL_NO                                                       
         AND ROWNUM =1   )                                                               
 )                                                                                       
 AND  NOT EXISTS                                                                         
 (SELECT 'X' FROM PRD_PROD_CTL_ROUT_DTL D2                                               
  WHERE D2.PCTL_NO = D.PCTL_NO                                                           
  AND D2.TRSP_MOD_CD ='RD'                                                               
  AND D2.PCTL_IO_BND_CD =D.PCTL_IO_BND_CD                                                
  AND D2.INLND_ROUT_INV_BIL_PATT_CD IS NOT  NULL                                         
  AND D2.PCTL_SEQ = D.PCTL_SEQ -2                                                        
  AND D2.PCTL_SEQ = D.PCTL_SEQ +2                                                        
  )		                                                                              
 AND  D.MTY_YD_FLG ='N'                                                                  
 AND  D.PCTL_NO LIKE @[hhd_pctl_no|'%'                                                              
 AND  D.PCTL_SEQ < (SELECT MAX(D2.PCTL_SEQ)-2 FROM PRD_PROD_CTL_ROUT_DTL D2              
                     WHERE D2.PCTL_NO = D.PCTL_NO)			]]></sql>
			<params>
				<param name="hd_pctl_no" type="12" value="" out="N"/>
			</params>
		</quhd_pctl_norys>
</sqls>
