<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EmptyReleaseRedeliveryOrderMgtDBDAOSearchRelredInfoForEdiResendRSQL">
			<desc><![CDATA[RELRED EDI Resend를 위한 Info 정보 조회]]></desc>
			<sql><![CDATA[
SELECT BKG_NO
      ,TRSP_SO_OFC_CTY_CD
      ,TRSP_SO_SEQ
      ,TRSP_BND_CD
	  ,TRO_SEQ
      ,VENDOR
      ,TRANS_MODE
      ,PD_DT
      ,SPCL_INST
      ,CNTR_NO
      ,CNTR_TYPE
      ,UCR
      ,CARGOTYPE
      ,SEAL
      ,CNTR_QTY
      ,DIND
      ,RIND
      ,AIND
      ,TEMP_F
      ,TEMP_C
      ,RF_VOLTAGE
      ,VENT
      ,VENT_CMH
      ,VENT_PCT
      ,HUMID
      ,GENSET
      ,RF_REMARK
      ,RFDRY_IND
      ,RF_DRAIN
      ,OVF
      ,OVR
      ,OVH
      ,OVLW
      ,OVRW
      ,OVWGT
      ,VOID_SLOT
      ,STWG_REQ
      ,TTL_DIM_LEN
      ,TTL_DIM_WDT
      ,TTL_DIM_HGT
      ,CMD
      ,CMDD
      ,WGT_UNIT AS GWGTUNIT
      ,TRIM(REGEXP_SUBSTR(T.WGT_STR, '[^|]+', 1, 3)) AS GWGT
      ,WGT_UNIT AS NWGTUNIT
      ,TRIM(REGEXP_SUBSTR(T.WGT_STR, '[^|]+', 1, 1)) AS NWGT
      ,WGT_UNIT AS TWGTUNIT
      ,TRIM(REGEXP_SUBSTR(T.WGT_STR, '[^|]+', 1, 2)) AS TWGT
      ,CNTR_SLT_NO
  FROM (SELECT ORD.BKG_NO
              ,ORD.TRSP_SO_OFC_CTY_CD
              ,ORD.TRSP_SO_SEQ
			  ,ORD.TRSP_BND_CD
			  ,ORD.TRO_SEQ
              ,VNDR.VNDR_LGL_ENG_NM AS VENDOR
              ,CASE WHEN SUBSTR(ORD.TRSP_CRR_MOD_CD, 1, 1) = 'W'
                    THEN 'F'
                    ELSE SUBSTR(ORD.TRSP_CRR_MOD_CD, 1, 1)
               END AS TRANS_MODE
              ,TO_CHAR(ORD.N1ST_NOD_PLN_DT, 'YYYYMMDDHHMM') AS PD_DT
              ,REPLACE(REPLACE(EUR.SPCL_INSTR_RMK, CHR(13), ' '), CHR(10), ' ') AS SPCL_INST
              ,ORD.EQ_NO AS CNTR_NO
              ,ORD.EQ_TPSZ_CD AS CNTR_TYPE
              ,NVL((SELECT BR.CUST_REF_NO_CTNT FROM BKG_REFERENCE BR WHERE BR.BKG_REF_TP_CD = 'CUCR' AND BR.BKG_NO = ORD.BKG_NO AND BR.CNTR_NO = ORD.EQ_NO AND ROWNUM = 1)
                  ,(SELECT BR.CUST_REF_NO_CTNT FROM BKG_REFERENCE BR WHERE BR.BKG_REF_TP_CD = 'CUCR' AND BR.BKG_NO = ORD.BKG_NO AND ROWNUM = 1)) AS UCR
              ,NVL(ORD.CGO_TP_CD, 'M') AS CARGOTYPE
              ,(SELECT CNTR_SEAL_NO FROM BKG_CNTR_SEAL_NO WHERE BKG_NO = ORD.BKG_NO AND ROWNUM = 1) AS SEAL
              ,COUNT(ORD.EQ_TPSZ_CD) AS CNTR_QTY
              ,CASE
                 WHEN (SELECT COUNT(*) FROM BKG_DG_CGO WHERE BKG_NO = ORD.BKG_NO AND CNTR_NO = ORD.EQ_NO) > 0 THEN 'Y'
                 ELSE 'N'
               END AS DIND
              ,CASE
                 WHEN COUNT(RF.CNTR_NO) > 0 THEN 'Y'
                 ELSE 'N'
               END AS RIND
              ,CASE
                 WHEN COUNT(AWK.CNTR_NO) > 0 THEN 'Y'
                 ELSE 'N'
               END AS AIND
              ,RF.FDO_TEMP AS TEMP_F
              ,RF.CDO_TEMP AS TEMP_C
              ,RF.VLTG_NO AS RF_VOLTAGE
              ,RF.CNTR_VENT_TP_CD AS VENT
              ,RF.CBM_PER_HR_QTY AS VENT_CMH
              ,RF.VENT_RTO AS VENT_PCT
              ,RF.HUMID_NO AS HUMID
              ,RF.PWR_SPL_CBL_FLG AS GENSET
              ,REPLACE(REPLACE(RF.DIFF_RMK, CHR(13), ' '), CHR(10), ' ') AS RF_REMARK
              ,CASE
                 WHEN COUNT(RF.CNTR_NO) > 0 THEN 'Y'
                 ELSE 'N'
               END AS RFDRY_IND
              ,RF.CNTR_DRN_CD AS RF_DRAIN
              ,AWK.OVR_BKWD_LEN AS OVF
              ,AWK.OVR_FWRD_LEN AS OVR
              ,AWK.OVR_HGT AS OVH
              ,AWK.OVR_LF_LEN AS OVLW
              ,AWK.OVR_RT_LEN AS OVRW
              ,AWK.GRS_WGT || AWK.WGT_UT_CD AS OVWGT
              ,AWK.OVR_VOID_SLT_QTY AS VOID_SLOT
              ,AWK.STWG_RQST_DESC AS STWG_REQ
              ,AWK.TTL_DIM_LEN AS TTL_DIM_LEN
              ,AWK.TTL_DIM_WDT AS TTL_DIM_WDT
              ,AWK.TTL_DIM_HGT AS TTL_DIM_HGT
              ,ORD.CMDT_CD AS CMD
              ,M.CMDT_NM CMDD
              ,TRS_GET_COM_SO_RAIL_WGT_FNC('S', ORD.TRSP_SO_OFC_CTY_CD, ORD.TRSP_SO_SEQ, '', ORD.BKG_NO, ORD.EQ_NO, ORD.EQ_TPSZ_CD, NVL(NVL(B.WGT_UT_CD, ORD.WGT_MEAS_UT_CD), 'KGS'), NULL, 'Y') AS WGT_STR
              ,NVL(NVL(B.WGT_UT_CD, ORD.WGT_MEAS_UT_CD), 'KGS') AS WGT_UNIT
              ,ORD.CNTR_SLT_NO
          FROM TRS_TRSP_SVC_ORD         ORD
              ,MDM_VENDOR               VNDR
              ,BKG_EUR_TRO              EUR
              ,BKG_RF_CGO               RF
              ,BKG_AWK_CGO              AWK
              ,MDM_COMMODITY            M
              ,MDM_CNTR_TP_SZ           S
              ,COM_INTG_CD_DTL          C
              ,BKG_CONTAINER            B
         WHERE 1 = 1
           AND ORD.TRSP_WO_OFC_CTY_CD = @[trsp_wo_ofc_cty_cd]
           AND ORD.TRSP_WO_SEQ = @[trsp_wo_seq]
           AND TRSP_SO_OFC_CTY_CD IN (
           #foreach($code IN ${trsp_so_ofc_cty_cd})
               #if($velocityCount == 1)
                   '$code'
               #else
                  ,'$code'
               #end
           #end
           )
           AND TRSP_SO_SEQ IN (
           #foreach($code IN ${trsp_so_seq})
               #if($velocityCount == 1)
                   '$code'
               #else
                  ,'$code'
               #end
           #end
           )
           AND ORD.VNDR_SEQ = VNDR.VNDR_SEQ
           AND ORD.BKG_NO = EUR.BKG_NO(+)
           AND ORD.EQ_NO = EUR.CNTR_NO(+)
           AND ORD.TRSP_BND_CD = EUR.IO_BND_CD(+)
           AND EUR.CXL_FLG(+) = 'N' -- Cancel된 TRO는 제외
           AND ORD.BKG_NO = RF.BKG_NO(+)
           AND ORD.EQ_NO = RF.CNTR_NO(+)
           AND ORD.BKG_NO = AWK.BKG_NO(+)
           AND ORD.EQ_NO = AWK.CNTR_NO(+)
           AND ORD.DELT_FLG = 'N'
           AND ORD.CMDT_CD = M.CMDT_CD(+)
           AND AWK.CNTR_TPSZ_CD = S.CNTR_TPSZ_CD(+)
           AND AWK.WGT_UT_CD = C.INTG_CD_VAL_CTNT(+)
           AND C.INTG_CD_ID(+) = 'CD00582'
           AND ORD.BKG_NO = B.BKG_NO(+)
           AND ORD.EQ_NO = B.CNTR_NO(+)
         GROUP BY ORD.TRSP_SO_OFC_CTY_CD
                 ,ORD.TRSP_SO_SEQ
                 ,ORD.TRO_SEQ
				 ,ORD.TRSP_BND_CD
                 ,VNDR.VNDR_LGL_ENG_NM
                 ,ORD.TRSP_CRR_MOD_CD
                 ,ORD.N1ST_NOD_PLN_DT
                 ,EUR.SPCL_INSTR_RMK
                 ,ORD.EQ_NO
                 ,ORD.EQ_TPSZ_CD
                 ,ORD.CGO_TP_CD
                 ,ORD.BKG_NO
                 ,RF.FDO_TEMP
                 ,RF.CDO_TEMP
                 ,RF.VLTG_NO
                 ,RF.CNTR_VENT_TP_CD
                 ,RF.CBM_PER_HR_QTY
                 ,RF.VENT_RTO
                 ,RF.HUMID_NO
                 ,RF.PWR_SPL_CBL_FLG
                 ,RF.DIFF_RMK
                 ,RF.CNTR_DRN_CD
                 ,AWK.OVR_BKWD_LEN
                 ,AWK.OVR_FWRD_LEN
                 ,AWK.OVR_HGT
                 ,AWK.OVR_LF_LEN
                 ,AWK.OVR_RT_LEN
                 ,AWK.GRS_WGT
                 ,AWK.WGT_UT_CD
                 ,AWK.OVR_VOID_SLT_QTY
                 ,AWK.STWG_RQST_DESC
                 ,AWK.TTL_DIM_LEN
                 ,AWK.TTL_DIM_WDT
                 ,AWK.TTL_DIM_HGT
                 ,AWK.WGT_UT_CD
                 ,AWK.GRS_WGT
                 ,AWK.CNTR_TPSZ_CD
                 ,ORD.CMDT_CD
                 ,M.CMDT_NM
                 ,B.WGT_UT_CD
                 ,ORD.WGT_MEAS_UT_CD
                 ,ORD.CNTR_SLT_NO
       ) T			]]></sql>
			<params>
				<param name="trsp_wo_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="trsp_wo_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
