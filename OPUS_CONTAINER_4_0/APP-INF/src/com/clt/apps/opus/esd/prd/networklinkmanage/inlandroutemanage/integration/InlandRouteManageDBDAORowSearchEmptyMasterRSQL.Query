<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InlandRouteManageDBDAORowSearchEmptyMasterRSQL">
			<desc><![CDATA[RowSearchEmptyMaster]]></desc>
			<sql><![CDATA[
SELECT ROWNUM rn, rout_org_nod_cd, rout_dest_nod_cd, 
    SUBSTR( rout_org_nod_cd,1,5) org_loc, SUBSTR( rout_org_nod_cd,6) org_loc_type, 
    SUBSTR( rout_dest_nod_cd,1,5) dest_loc, SUBSTR( rout_dest_nod_cd,6) dest_loc_type, 
    rout_seq, nvl(prio_seq,0) prio_seq, inlnd_rout_inv_bil_patt_cd,rout_pln_cd,cre_usr_id,cre_ofc_cd,to_char(cre_dt,'yyyy-mm-dd') cre_dt,inlnd_rout_rmk , 
    rail_crr_tp_cd ,inlnd_rout_junc_nm 
FROM ( 
    SELECT rout_org_nod_cd, rout_dest_nod_cd, rout_seq, prio_seq 
         ,MAX(DECODE(cnt,1, inlnd_rout_inv_bil_patt_cd, DECODE(rout_dtl_seq,1, inlnd_rout_inv_bil_patt_cd))) inlnd_rout_inv_bil_patt_cd 
         ,MAX(DECODE(cnt,1, rout_pln_cd, DECODE(rout_dtl_seq,1, rout_pln_cd))) rout_pln_cd 
         ,MAX(DECODE(cnt,1, cre_usr_id, DECODE(rout_dtl_seq,1, cre_usr_id))) cre_usr_id 
         ,MAX(DECODE(cnt,1, cre_ofc_cd, DECODE(rout_dtl_seq,1, cre_ofc_cd))) cre_ofc_cd 
         ,MAX(DECODE(cnt,1, cre_dt, DECODE(rout_dtl_seq,1, cre_dt))) cre_dt 
         ,MAX(DECODE(cnt,1, inlnd_rout_rmk, DECODE(rout_dtl_seq,1, inlnd_rout_rmk))) inlnd_rout_rmk 
         ,MAX(DECODE(cnt,1, rail_crr_tp_cd, DECODE(rout_dtl_seq,1, rail_crr_tp_cd))) rail_crr_tp_cd 
         ,MAX(DECODE(cnt,1, inlnd_rout_junc_nm, DECODE(rout_dtl_seq,1, inlnd_rout_junc_nm))) inlnd_rout_junc_nm 
         ,rout_org_nod_cd AS pod0 
         ,rout_dest_nod_cd AS del 
     FROM ( 
    
           SELECT rout_org_nod_cd, rout_dest_nod_cd, rout_seq, prio_seq,inlnd_rout_bkg_flg , 
                  rout_dtl_seq, cnt,lnk_org_nod_cd, lnk_dest_nod_cd,trsp_mod_cd, 
                  inlnd_rout_inv_bil_patt_cd,rout_pln_cd,cre_usr_id,cre_ofc_cd,cre_dt, 
                  inlnd_rout_rmk ,rail_crr_tp_cd ,inlnd_rout_junc_nm    
             FROM ( 
                   SELECT m.rout_org_nod_cd, m.rout_dest_nod_cd, m.rout_seq, decode(m.prio_seq,0,null,m.prio_seq) prio_seq,m.inlnd_rout_bkg_flg , 
                        d.lnk_org_nod_cd,d.lnk_dest_nod_cd, d.rout_dtl_seq,d.trsp_mod_cd, 
                        COUNT (*) OVER (PARTITION BY m.rout_org_nod_cd, m.rout_dest_nod_cd, m.rout_seq 
                           ORDER BY m.rout_org_nod_cd, m.rout_dest_nod_cd, m.rout_seq) AS cnt , 
                        m.inlnd_rout_inv_bil_patt_cd,m.rout_pln_cd,m.cre_usr_id,m.cre_ofc_cd,m.cre_dt, 
                        m.inlnd_rout_rmk,d.rail_crr_tp_cd,d.inlnd_rout_junc_nm 
                   FROM prd_inlnd_rout_mst m, prd_inlnd_rout_dtl d 
                   WHERE m.rout_org_nod_cd = @[i_rout_org_nod_cd] 
                     AND m.rout_dest_nod_cd = @[i_rout_dest_nod_cd]
                     AND m.rout_seq = @[i_rout_seq] 
                     AND NVL(m.DELT_FLG,'N') ='N' 
                     AND m.rout_org_nod_cd = d.rout_org_nod_cd 
                     AND m.rout_dest_nod_cd = d.rout_dest_nod_cd 
                     AND m.rout_seq = d.rout_seq 
             
                     AND m.pctl_io_bnd_cd ='M' 
                     AND EXISTS 
                            ( 
                                SELECT 'X' FROM prd_node N 
                                WHERE n.nod_cd = m.rout_org_nod_cd 
                                AND  n.nod_tp_cd  != 'Z' 
                             ) 
                     AND EXISTS 
                            ( 
                                SELECT 'X' FROM prd_node n 
                                WHERE n.nod_cd = m.rout_dest_nod_cd 
                                AND  n.nod_tp_cd  != 'Z' 
                             ) 
                
                   ORDER BY m.rout_seq, d.rout_dtl_seq 
               ) 
   
          ) m 
    GROUP BY m.rout_org_nod_cd, m.rout_dest_nod_cd, m.rout_seq, m.prio_seq 
    ORDER BY rout_org_nod_cd, rout_dest_nod_cd, prio_seq 
)			]]></sql>
			<params>
				<param name="i_rout_org_nod_cd" type="12" value="" out="N"/>
				<param name="i_rout_dest_nod_cd" type="12" value="" out="N"/>
				<param name="i_rout_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
