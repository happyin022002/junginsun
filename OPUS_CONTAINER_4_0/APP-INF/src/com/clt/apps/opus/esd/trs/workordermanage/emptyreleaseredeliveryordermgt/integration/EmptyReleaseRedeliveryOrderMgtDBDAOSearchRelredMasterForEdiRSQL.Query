<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EmptyReleaseRedeliveryOrderMgtDBDAOSearchRelredMasterForEdiRSQL">
			<desc><![CDATA[EmptyReleaseRedeliveryOrderMgtDBDAOSearchRelredMasterForEdi
- 2015.07.30 CHAN WOO PARK : Chile case 추가 ]]></desc>
			<sql><![CDATA[
SELECT ORD.CRE_OFC_CD AS I_OFFICE
      ,DECODE(@[type], 'RLS', 'O', 'I' ) AS BD
	  ,ORD.TRSP_SO_STS_CD
      ,DECODE(@[type], 'RLS', 'OUT', 'IN') AS BD_DISP
	  ,ORD.BKG_NO
	  ,ORD.BL_NO
      ,ORD.TRSP_CRR_MOD_CD AS MODE_CD
      ,DECODE(ORD.TRSP_COST_DTL_MOD_CD, 'ER', 'R', 'CF', 'S', DECODE(ORD.TRSP_SO_TP_CD, 'Y', 'C', 'S')) AS TYPE_CD
      ,DECODE(ORD.TRSP_COST_DTL_MOD_CD, 'ER', 'MT REPO', 'CF', 'S/T', DECODE(ORD.TRSP_SO_TP_CD, 'Y', 'C/H', 'S/T')) AS TYPE_DISP
      ,ORD.POL_CD AS POL
      ,(SELECT LOC_NM FROM MDM_LOCATION WHERE LOC_CD = ORD.POL_CD) AS POL_DESC
      ,ORD.POD_CD AS POD
      ,(SELECT LOC_NM FROM MDM_LOCATION WHERE LOC_CD = ORD.POD_CD) AS POD_DESC
      ,NVL2(ORD.DOR_NOD_CD, DZ.LOC_CD, TD.LOC_CD) AS DEST
      ,NVL2(ORD.DOR_NOD_CD, DLD.LOC_NM, TLD.LOC_NM) AS DEST_DESC
      ,DECODE(@[type], 'RLS', ORD.FM_NOD_CD, ORD.TO_NOD_CD) AS EMPTY_CY
      ,DECODE(@[type], 'RLS', YD.YD_NM, TD.YD_NM) AS MTY_CY_DESC
      ,DECODE(@[type], 'RLS', ORD.FM_NOD_CD, ORD.TO_NOD_CD) AS ORG_EMPTY_CY
      ,MV.VNDR_SEQ AS S_P
      ,MV.VNDR_LGL_ENG_NM AS VNDR_LGL_ENG_NM
      ,TO_CHAR(ORD.N1ST_NOD_PLN_DT, 'YYYY-MM-DD') AS PD_DATE_DISP
      ,TO_CHAR(ORD.N1ST_NOD_PLN_DT, 'YYYY-MM-DD') AS PD_DATE
      ,ORD.EQ_NO AS CNTR_NO
      ,ORD.EQ_NO AS EQ_NO
      ,ORD.EQ_TPSZ_CD AS TP
      ,'C' AS CB
      ,'' AS EMPTY_DEST
	  ,DECODE(@[type], 'RLS', TD.YD_NM, YD.YD_NM) AS YD_NM
	  ,DECODE(@[type], 'RLS', TD.FAX_NO, YD.FAX_NO) AS FAX_NO
	  ,DECODE(@[type], 'RLS', TD.YD_EML, YD.YD_EML) AS EMAIL
      ,'' AS OFFICE
      ,'' AS USER_ID
      ,'' AS ISSUE_DT
      ,'' AS FAX_EMAIL_RST
      ,ORD.BKG_NO AS BKG_NO
      ,ORD.BL_NO AS BL_NO
      ,BK.VSL_CD || BK.SKD_VOY_NO || BK.SKD_DIR_CD AS VVD
      ,ORD.REF_ID AS EPP_REF
      ,ORD.TRSP_WO_OFC_CTY_CD || ORD.TRSP_WO_SEQ AS WO_NO
      ,REPLACE(REPLACE(REPLACE(REPLACE(RTRIM(TRO.SPCL_INSTR_RMK), CHR(10), ''), CHR(13), ''), CHR(34), ''), CHR(9), ' ') AS SPCL_INST
      ,REPLACE(REPLACE(REPLACE(REPLACE(SUBSTR(RTRIM(S.CUST_NM), 1, 50), CHR(10), ''), CHR(13), ''), CHR(34), ''), CHR(9), ' ') AS SHPR
      ,REPLACE(REPLACE(REPLACE(REPLACE(SUBSTR(RTRIM(C.CUST_NM), 1, 50), CHR(10), ''), CHR(13), ''), CHR(34), ''), CHR(9), ' ') AS CNEE
      ,REPLACE(REPLACE(REPLACE(REPLACE(SUBSTR(RTRIM(C.CUST_NM), 1, 50), CHR(10), ''), CHR(13), ''), CHR(34), ''), CHR(9), ' ') AS NTFY
      ,DECODE(@[wo_iss_sts_cd], 'I', 'N', 'R', 'U', 'N', 'C') AS STATUS
      ,DECODE(@[type], 'RLS', ORD.FM_NOD_CD) AS EQREL
      ,DECODE(@[type], 'RLS', LD.LOC_CD) AS EQREL_LOC
      ,DECODE(@[type], 'RLS', LD.LOC_NM) AS EQREL_NAME
      ,DECODE(@[type], 'RDV', ORD.TO_NOD_CD) AS EQRES
      ,DECODE(@[type], 'RDV', TLD.LOC_CD) AS EQRES_LOC
      ,DECODE(@[type], 'RDV', TLD.LOC_NM) AS EQRES_NAME
      ,VSL.CALL_SGN_NO AS VSL_CALL
      ,VSL.LLOYD_NO AS VSL_LOYD
      ,VSL.VSL_ENG_NM AS VSL_NAME
      ,DECODE(ORD.TRSP_BND_CD, 'O', ETD.OB_CSSM_VOY_NO, 'I', ETA.IB_CSSM_VOY_NO, '') AS CONSORT_VOY
      ,TO_CHAR(ETD.VPS_ETD_DT, 'YYYYMMDDHH24MM') AS VVD_ETD
      ,TO_CHAR(ETA.VPS_ETA_DT, 'YYYYMMDDHH24MM') AS VVD_ETA
      ,'C' AS HAUL_TYPE
      ,'' AS SHIP_OPR
      ,BK.DCGO_FLG AS DR_IND
      ,BK.RC_FLG AS RF_IND
      ,BK.AWK_CGO_FLG AS AK_IND
      ,TRO.CNTR_PKUP_DT
      ,TRO.CNTR_RTN_YD_CD
      ,ORD.TRSP_SO_TP_CD
      ,ORD.CGO_TP_CD
      ,ORD.TRSP_SO_OFC_CTY_CD AS SO_OFC_CTY_CD
      ,ORD.TRSP_SO_SEQ AS SO_SEQ
      ,ORD.CRE_OFC_CD AS STK_OFC_CD
      ,'' AS STK_JB_SEQ
      ,'' AS CRE_USR_ID
      ,'' AS UPD_USR_ID
      ,'' AS FAX_SND_NO
      ,@[type] AS TYPE
      ,'' AS SPCL_INST
      ,'' AS SEND_KEY
	  ,'' AS STK_ISS_CD
	  ,ORD.CRE_OFC_CD AS USER_OFC
      ,CASE
         WHEN ORD.TRSP_SO_TP_CD = 'M' THEN
           CASE
             WHEN @[type] = 'RLS'
             THEN 'MTRELORD'
             ELSE 'MTRESORD'
           END
         WHEN ORD.TRSP_COST_DTL_MOD_CD = 'DR' THEN
           CASE
             WHEN @[type] = 'RLS'
             THEN 'MTRELORD'
             ELSE 'MTRESORD'
           END
         ELSE
           CASE
             WHEN @[type] = 'RLS'
             THEN 'FULLRELORD'
             ELSE 'FULLRESORD'
           END
       END AS MSG_ID
      ,ORD.TRSP_BND_CD AS TRSP_BND_CD
      ,ORD.TRSP_COST_DTL_MOD_CD
  FROM TRS_TRSP_SVC_ORD ORD
	  ,TRS_TRSP_WRK_ORD_PRV_TMP T
      ,BKG_BOOKING      BK
      ,BKG_CUSTOMER     S
      ,BKG_CUSTOMER     C
      ,BKG_CUSTOMER     N
      ,BKG_EUR_TRO      TRO
      ,MDM_VSL_CNTR     VSL
      ,VSK_VSL_PORT_SKD ETD
      ,VSK_VSL_PORT_SKD ETA
      ,MDM_YARD         YD
      ,MDM_LOCATION     LD
      ,MDM_YARD         TD
	  ,MDM_LOCATION     TLD
      ,MDM_ZONE         DZ
      ,MDM_LOCATION     DLD
      ,MDM_VENDOR       MV
 WHERE 1 = 1
   AND ORD.TRSP_SO_OFC_CTY_CD = T.TRSP_SO_OFC_CTY_CD
   AND ORD.TRSP_SO_SEQ = T.TRSP_SO_SEQ
   AND T.WO_PRV_GRP_SEQ = @[wo_prv_grp_seq]
   AND T.WO_ISS_NO = @[wo_iss_no]
   AND ORD.BKG_NO = BK.BKG_NO(+)
   AND ORD.BKG_NO = S.BKG_NO(+)
   AND ORD.BKG_NO = C.BKG_NO(+)
   AND ORD.BKG_NO = N.BKG_NO(+)
   AND 'S' = S.BKG_CUST_TP_CD(+)
   AND 'C' = C.BKG_CUST_TP_CD(+)
   AND 'N' = N.BKG_CUST_TP_CD(+)
   AND ORD.BKG_NO = TRO.BKG_NO(+)
   AND ORD.TRSP_BND_CD = TRO.IO_BND_CD(+)
   AND ORD.TRO_SEQ = TRO.TRO_SEQ(+)
   AND 'C' = TRO.TRO_PROC_CD(+)
   AND 'C' = TRO.HLG_TP_CD(+)
   AND 'N' = TRO.CNTR_CFM_FLG(+)
   AND 'N' = TRO.CXL_FLG(+)
   AND ORD.DELT_FLG = 'N'
   AND ORD.VSL_CD = VSL.VSL_CD(+)
   AND ORD.VSL_CD = ETD.VSL_CD(+)
   AND ORD.SKD_VOY_NO = ETD.SKD_VOY_NO(+)
   AND ORD.SKD_DIR_CD = ETD.SKD_DIR_CD(+)
   AND ORD.POL_CD = ETD.VPS_PORT_CD(+)
   AND ORD.VSL_CD = ETA.VSL_CD(+)
   AND ORD.SKD_VOY_NO = ETA.SKD_VOY_NO(+)
   AND ORD.SKD_DIR_CD = ETA.SKD_DIR_CD(+)
   AND ORD.POD_CD = ETA.VPS_PORT_CD(+)
   AND ORD.FM_NOD_CD = YD.YD_CD
   AND YD.LOC_CD = LD.LOC_CD
   AND ORD.TO_NOD_CD = TD.YD_CD
   AND TD.LOC_CD = TLD.LOC_CD
   AND ORD.DOR_NOD_CD = DZ.ZN_CD(+)
   AND DZ.LOC_CD = DLD.LOC_CD(+)
   AND ORD.VNDR_SEQ = MV.VNDR_SEQ
--   AND (ORD.CGO_TP_CD = 'M' OR (ORD.CGO_TP_CD = 'F' AND ORD.TRSP_COST_DTL_MOD_CD IN ('DR', 'CY', 'LS', 'TS')))
   AND ORD.TRSP_SO_TP_CD IN('Y', 'M')
   AND ORD.CONTI_CD = 'E'
   AND T.WO_CXL_FLG = (CASE  WHEN T.WO_ISS_STS_CD IN ('I', 'R') THEN 'N'   WHEN T.WO_ISS_STS_CD IN ('C', 'N') THEN 'Y' 	ELSE 'N'  END)
   AND ROWNUM = 1

UNION ALL

-- 2015.07.30 CHAN WOO PARK
-- COST_MD : EMPTY REPO / CNT_CD : CHILE CASE 추가
SELECT ORD.CRE_OFC_CD AS I_OFFICE
      ,DECODE(@[type], 'RLS', 'O', 'I' ) AS BD
	  ,ORD.TRSP_SO_STS_CD
      ,DECODE(@[type], 'RLS', 'OUT', 'IN') AS BD_DISP
	  ,ORD.BKG_NO
	  ,ORD.BL_NO
      ,ORD.TRSP_CRR_MOD_CD AS MODE_CD
      ,DECODE(ORD.TRSP_COST_DTL_MOD_CD, 'ER', 'R', 'CF', 'S', DECODE(ORD.TRSP_SO_TP_CD, 'Y', 'C', 'S')) AS TYPE_CD
      ,DECODE(ORD.TRSP_COST_DTL_MOD_CD, 'ER', 'MT REPO', 'CF', 'S/T', DECODE(ORD.TRSP_SO_TP_CD, 'Y', 'C/H', 'S/T')) AS TYPE_DISP
      ,ORD.POL_CD AS POL
      ,(SELECT LOC_NM FROM MDM_LOCATION WHERE LOC_CD = ORD.POL_CD) AS POL_DESC
      ,ORD.POD_CD AS POD
      ,(SELECT LOC_NM FROM MDM_LOCATION WHERE LOC_CD = ORD.POD_CD) AS POD_DESC
      ,NVL2(ORD.DOR_NOD_CD, DZ.LOC_CD, TD.LOC_CD) AS DEST
      ,NVL2(ORD.DOR_NOD_CD, DLD.LOC_NM, TLD.LOC_NM) AS DEST_DESC
      ,DECODE(@[type], 'RLS', ORD.FM_NOD_CD, ORD.TO_NOD_CD) AS EMPTY_CY
      ,DECODE(@[type], 'RLS', YD.YD_NM, TD.YD_NM) AS MTY_CY_DESC
      ,DECODE(@[type], 'RLS', ORD.FM_NOD_CD, ORD.TO_NOD_CD) AS ORG_EMPTY_CY
      ,MV.VNDR_SEQ AS S_P
      ,MV.VNDR_LGL_ENG_NM AS VNDR_LGL_ENG_NM
      ,TO_CHAR(ORD.N1ST_NOD_PLN_DT, 'YYYYMMDD') AS PD_DATE_DISP
      ,TO_CHAR(ORD.N1ST_NOD_PLN_DT, 'YYYYMMDD') AS PD_DATE
      ,ORD.EQ_NO AS CNTR_NO
      ,ORD.EQ_NO AS EQ_NO
      ,ORD.EQ_TPSZ_CD AS TP
      ,'C' AS CB
      ,'' AS EMPTY_DEST
	  ,DECODE(@[type], 'RLS', TD.YD_NM, YD.YD_NM) AS YD_NM
	  ,DECODE(@[type], 'RLS', TD.FAX_NO, YD.FAX_NO) AS FAX_NO
	  ,DECODE(@[type], 'RLS', TD.YD_EML, YD.YD_EML) AS EMAIL
      ,'' AS OFFICE
      ,'' AS USER_ID
      ,'' AS ISSUE_DT
      ,'' AS FAX_EMAIL_RST
      ,ORD.BKG_NO AS BKG_NO
      ,ORD.BL_NO AS BL_NO
      ,BK.VSL_CD || BK.SKD_VOY_NO || BK.SKD_DIR_CD AS VVD
	  ,ORD.REF_ID ||'-'|| ORD.REF_SEQ  AS EPP_REF
      ,ORD.TRSP_WO_OFC_CTY_CD || ORD.TRSP_WO_SEQ AS WO_NO
      ,REPLACE(REPLACE(REPLACE(REPLACE(RTRIM(TRO.SPCL_INSTR_RMK), CHR(10), ''), CHR(13), ''), CHR(34), ''), CHR(9), ' ') AS SPCL_INST
      ,REPLACE(REPLACE(REPLACE(REPLACE(SUBSTR(RTRIM(S.CUST_NM), 1, 50), CHR(10), ''), CHR(13), ''), CHR(34), ''), CHR(9), ' ') AS SHPR
      ,REPLACE(REPLACE(REPLACE(REPLACE(SUBSTR(RTRIM(C.CUST_NM), 1, 50), CHR(10), ''), CHR(13), ''), CHR(34), ''), CHR(9), ' ') AS CNEE
      ,REPLACE(REPLACE(REPLACE(REPLACE(SUBSTR(RTRIM(C.CUST_NM), 1, 50), CHR(10), ''), CHR(13), ''), CHR(34), ''), CHR(9), ' ') AS NTFY
      ,DECODE(@[wo_iss_sts_cd], 'I', 'N', 'R', 'U', 'N', 'C') AS STATUS
      ,DECODE(@[type], 'RLS', ORD.FM_NOD_CD) AS EQREL
      ,DECODE(@[type], 'RLS', LD.LOC_CD) AS EQREL_LOC
      ,DECODE(@[type], 'RLS', LD.LOC_NM) AS EQREL_NAME
      ,DECODE(@[type], 'RDV', ORD.TO_NOD_CD) AS EQRES
      ,DECODE(@[type], 'RDV', TLD.LOC_CD) AS EQRES_LOC
      ,DECODE(@[type], 'RDV', TLD.LOC_NM) AS EQRES_NAME
      ,VSL.CALL_SGN_NO AS VSL_CALL
      ,VSL.LLOYD_NO AS VSL_LOYD
      ,VSL.VSL_ENG_NM AS VSL_NAME
      ,DECODE(ORD.TRSP_BND_CD, 'O', ETD.OB_CSSM_VOY_NO, 'I', ETA.IB_CSSM_VOY_NO, '') AS CONSORT_VOY
      ,TO_CHAR(ETD.VPS_ETD_DT, 'YYYYMMDDHH24MM') AS VVD_ETD
      ,TO_CHAR(ETA.VPS_ETA_DT, 'YYYYMMDDHH24MM') AS VVD_ETA
      ,'C' AS HAUL_TYPE
      ,'' AS SHIP_OPR
      ,BK.DCGO_FLG AS DR_IND
      ,BK.RC_FLG AS RF_IND
      ,BK.AWK_CGO_FLG AS AK_IND
      ,TRO.CNTR_PKUP_DT
      ,TRO.CNTR_RTN_YD_CD
      ,ORD.TRSP_SO_TP_CD
      ,ORD.CGO_TP_CD
      ,ORD.TRSP_SO_OFC_CTY_CD AS SO_OFC_CTY_CD
      ,ORD.TRSP_SO_SEQ AS SO_SEQ
      ,ORD.CRE_OFC_CD AS STK_OFC_CD
      ,'' AS STK_JB_SEQ
      ,'' AS CRE_USR_ID
      ,'' AS UPD_USR_ID
      ,'' AS FAX_SND_NO
      ,@[type] AS TYPE
      ,'' AS SPCL_INST
      ,'' AS SEND_KEY
	  ,'' AS STK_ISS_CD
	  ,ORD.CRE_OFC_CD AS USER_OFC
      ,CASE
         WHEN ORD.TRSP_SO_TP_CD = 'M' THEN
           CASE
             WHEN @[type] = 'RLS'
             THEN 'MTRELORD'
             ELSE 'MTRESORD'
           END
         WHEN ORD.TRSP_COST_DTL_MOD_CD = 'DR' THEN
           CASE
             WHEN @[type] = 'RLS'
             THEN 'MTRELORD'
             ELSE 'MTRESORD'
           END
         ELSE
           CASE
             WHEN @[type] = 'RLS'
             THEN 'FULLRELORD'
             ELSE 'FULLRESORD'
           END
       END AS MSG_ID
      ,ORD.TRSP_BND_CD AS TRSP_BND_CD
      ,ORD.TRSP_COST_DTL_MOD_CD
  FROM TRS_TRSP_SVC_ORD ORD
	  ,TRS_TRSP_WRK_ORD_PRV_TMP T
      ,BKG_BOOKING      BK
      ,BKG_CUSTOMER     S
      ,BKG_CUSTOMER     C
      ,BKG_CUSTOMER     N
      ,BKG_EUR_TRO      TRO
      ,MDM_VSL_CNTR     VSL
      ,VSK_VSL_PORT_SKD ETD
      ,VSK_VSL_PORT_SKD ETA
      ,MDM_YARD         YD
      ,MDM_LOCATION     LD
      ,MDM_YARD         TD
	  ,MDM_LOCATION     TLD
      ,MDM_ZONE         DZ
      ,MDM_LOCATION     DLD
      ,MDM_VENDOR       MV
 WHERE 1 = 1
   AND ORD.TRSP_SO_OFC_CTY_CD = T.TRSP_SO_OFC_CTY_CD
   AND ORD.TRSP_SO_SEQ = T.TRSP_SO_SEQ
   AND T.WO_PRV_GRP_SEQ = @[wo_prv_grp_seq]
   AND T.WO_ISS_NO = @[wo_iss_no]
   AND ORD.BKG_NO = BK.BKG_NO(+)
   AND ORD.BKG_NO = S.BKG_NO(+)
   AND ORD.BKG_NO = C.BKG_NO(+)
   AND ORD.BKG_NO = N.BKG_NO(+)
   AND 'S' = S.BKG_CUST_TP_CD(+)
   AND 'C' = C.BKG_CUST_TP_CD(+)
   AND 'N' = N.BKG_CUST_TP_CD(+)
   AND ORD.BKG_NO = TRO.BKG_NO(+)
   AND ORD.TRSP_BND_CD = TRO.IO_BND_CD(+)
   AND ORD.TRO_SEQ = TRO.TRO_SEQ(+)
   AND 'C' = TRO.TRO_PROC_CD(+)
   AND 'C' = TRO.HLG_TP_CD(+)
   AND 'N' = TRO.CNTR_CFM_FLG(+)
   AND 'N' = TRO.CXL_FLG(+)
   AND ORD.DELT_FLG = 'N'
   AND ORD.VSL_CD = VSL.VSL_CD(+)
   AND ORD.VSL_CD = ETD.VSL_CD(+)
   AND ORD.SKD_VOY_NO = ETD.SKD_VOY_NO(+)
   AND ORD.SKD_DIR_CD = ETD.SKD_DIR_CD(+)
   AND ORD.POL_CD = ETD.VPS_PORT_CD(+)
   AND ORD.VSL_CD = ETA.VSL_CD(+)
   AND ORD.SKD_VOY_NO = ETA.SKD_VOY_NO(+)
   AND ORD.SKD_DIR_CD = ETA.SKD_DIR_CD(+)
   AND ORD.POD_CD = ETA.VPS_PORT_CD(+)
   AND ORD.FM_NOD_CD = YD.YD_CD
   AND YD.LOC_CD = LD.LOC_CD
   AND ORD.TO_NOD_CD = TD.YD_CD
   AND TD.LOC_CD = TLD.LOC_CD
   AND ORD.DOR_NOD_CD = DZ.ZN_CD(+)
   AND DZ.LOC_CD = DLD.LOC_CD(+)
   AND ORD.VNDR_SEQ = MV.VNDR_SEQ
   AND ORD.CGO_TP_CD = 'M'
   AND DECODE(@[type], 'RLS', LD.CNT_CD, TLD.CNT_CD) = 'CL'
   AND T.WO_CXL_FLG = (CASE  WHEN T.WO_ISS_STS_CD IN ('I', 'R') THEN 'N'   WHEN T.WO_ISS_STS_CD IN ('C', 'N') THEN 'Y' 	ELSE 'N'  END)
   AND ROWNUM = 1			]]></sql>
			<params>
				<param name="type" type="12" value="" out="N"/>
				<param name="wo_iss_sts_cd" type="12" value="" out="N"/>
				<param name="wo_prv_grp_seq" type="12" value="" out="N"/>
				<param name="wo_iss_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
