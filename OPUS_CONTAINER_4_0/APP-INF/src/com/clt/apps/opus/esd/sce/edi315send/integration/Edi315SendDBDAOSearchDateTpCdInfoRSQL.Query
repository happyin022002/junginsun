<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="Edi315SendDBDAOSearchDateTpCdInfoRSQL">
			<desc><![CDATA[edi 315 DateTpCd info]]></desc>
			<sql><![CDATA[
#if (${trans_tp_cd} == 'OBSTRT' && ${loc_tp_cd} == 'FR' && ${date_tp_cd} == 'CO')

SELECT 	@[date_tp_cd] AS DATE_TP_CD,
		TO_CHAR(SYS_SET_DT,'YYYYMMDDHH24MI') AS DATE_INFO
  FROM  BKG_CLZ_TM
 WHERE 	BKG_NO = @[bkg_no]
   AND 	CLZ_TP_CD = 'R'

#else 

SELECT 	@[date_tp_cd] AS DATE_TP_CD,
		CASE
#if ((${trans_tp_cd} == 'TRNKPC' || ${trans_tp_cd} == 'TRNKMC' || ${trans_tp_cd} == 'TRNKOC') && (${loc_tp_cd} == 'LP'))
        	WHEN @[date_tp_cd] = 'ETA' THEN TO_CHAR(VVPS.VPS_ETA_DT,'YYYYMMDDHH24MI')
#else
        	WHEN @[date_tp_cd] = 'ETA' THEN TO_CHAR(SCD.ESTM_DT,'YYYYMMDDHH24MI')
#end

       		WHEN @[date_tp_cd] = 'EAV' THEN TO_CHAR(SCD.ESTM_DT,'YYYYMMDDHH24MI')

#if ((${trans_tp_cd} == 'TRNKPC' || ${trans_tp_cd} == 'TRNKMC' || ${trans_tp_cd} == 'TRNKOC') && (${loc_tp_cd} == 'DP'))
        	WHEN @[date_tp_cd] = 'ATD' THEN TO_CHAR(VAPS.ACT_DEP_DT,'YYYYMMDDHH24MI')
#else
        	WHEN @[date_tp_cd] = 'ATD' THEN TO_CHAR(SCD.ACT_DT,'YYYYMMDDHH24MI')
#end

#if ((${trans_tp_cd} == 'TRNKPC' || ${trans_tp_cd} == 'TRNKMC' || ${trans_tp_cd} == 'TRNKOC') && (${loc_tp_cd} == 'DP'))
        	WHEN @[date_tp_cd] = 'ETD' THEN TO_CHAR(VVPS.VPS_ETD_DT,'YYYYMMDDHH24MI')
#else
        	WHEN @[date_tp_cd] = 'ETD' THEN TO_CHAR(SCD.ESTM_DT,'YYYYMMDDHH24MI')
#end

        	WHEN @[date_tp_cd] = 'LD' THEN TO_CHAR(SCD.ACT_DT,'YYYYMMDDHH24MI')

#if ((${trans_tp_cd} == 'TRNKPC' || ${trans_tp_cd} == 'TRNKMC' || ${trans_tp_cd} == 'TRNKOC') && (${loc_tp_cd} == 'LP'))
        	WHEN @[date_tp_cd] = 'ATA' THEN TO_CHAR(VAPS.ACT_ARR_DT,'YYYYMMDDHH24MI')
#else
        	WHEN @[date_tp_cd] = 'ATA' THEN TO_CHAR(SCD.ACT_DT,'YYYYMMDDHH24MI')
#end

        	WHEN @[date_tp_cd] = 'DD' THEN TO_CHAR(SCD.ACT_DT,'YYYYMMDDHH24MI')
    	END AS DATE_INFO
  FROM 	SCE_COP_DTL SCD
      ,	SCE_COP_HDR SCH
#if (${trans_tp_cd} == 'TRNKPC' || ${trans_tp_cd} == 'TRNKMC' || ${trans_tp_cd} == 'TRNKOC')
      , BKG_VVD BV
      , VSK_ACT_PORT_SKD VAPS
      , VSK_VSL_PORT_SKD VVPS
#end
 WHERE  SCD.COP_NO = SCH.COP_NO
   AND 	SCH.COP_NO = @[cop_no]
    
#if (${trans_tp_cd} == 'OBSTRT')
	#if (${loc_tp_cd} == 'FRCTY') 
	AND SCD.ACT_CD = 'XXXXX'
	#elseif(${loc_tp_cd} == 'EP') 
	AND SCD.ACT_CD = 'MOTYDO'
	#elseif(${loc_tp_cd} == 'OBDR') 
	AND SCD.ACT_CD = 'MOTZAD'
	#elseif(${loc_tp_cd} == 'FR') 
	AND SCD.ACT_CD = ( SELECT ACT_CD FROM SCE_COP_DTL WHERE COP_NO = @[cop_no] AND ACT_CD IN ('FOTYAD','FOTRAD','FOTMAD') AND COP_DTL_SEQ = (SELECT MIN(COP_DTL_SEQ) FROM SCE_COP_DTL WHERE COP_NO = @[cop_no] AND ACT_CD IN ('FOTYAD','FOTRAD','FOTMAD')))
	#end
#end

#if (${trans_tp_cd} == 'OBIMD')
	#if (${loc_tp_cd} == 'START')
    AND  SCD.COP_DTL_SEQ =  @[cop_dtl_seq]  --- 출발지     위에서 조회한 SEQ
    #elseif(${loc_tp_cd} == 'END')
    AND SCD.COP_DTL_SEQ = (SELECT MIN(COP_DTL_SEQ) 
                             FROM SCE_COP_DTL 
                            WHERE COP_NO = @[cop_no] 
                              AND SUBSTR(ACT_CD, 5,2) = 'AD'  -- 직후 도착지 FM - TO 를 다 가져오기 위해
                              AND COP_DTL_SEQ > @[cop_dtl_seq])      
    #end
#end
#if (${trans_tp_cd} == 'IBIMD')
	#if (${loc_tp_cd} == 'START')
    AND  SCD.COP_DTL_SEQ = (SELECT MAX(COP_DTL_SEQ) 
                              FROM SCE_COP_DTL 
                             WHERE COP_NO = @[cop_no]
                               AND SUBSTR(ACT_CD, 5,2) = 'DO'
                               AND COP_DTL_SEQ < @[cop_dtl_seq]) 
	#elseif(${loc_tp_cd} == 'END')
    AND  SCD.COP_DTL_SEQ =  @[cop_dtl_seq]  --- 도착지
	#end
#end

#if (${trans_tp_cd} == 'TRNKPC' || ${trans_tp_cd} == 'TRNKMC' || ${trans_tp_cd} == 'TRNKOC')
    AND SCH.BKG_NO = BV.BKG_NO
    AND SCD.VSL_CD = BV.VSL_CD
    AND SCD.SKD_VOY_NO = BV.SKD_VOY_NO
    AND SCD.SKD_DIR_CD = BV.SKD_DIR_CD
    AND SUBSTR(SCD.NOD_CD, 1, 5) = SUBSTR(@[loc_yd_cd], 1, 5)
    AND SCD.VSL_CD = VVPS.VSL_CD(+)
    AND SCD.SKD_VOY_NO = VVPS.SKD_VOY_NO(+)
    AND SCD.SKD_DIR_CD = VVPS.SKD_DIR_CD(+)
    AND SCD.VPS_PORT_CD = VVPS.VPS_PORT_CD(+)
    AND VVPS.CLPT_IND_SEQ(+) = SCD.CLPT_IND_SEQ
    AND SCD.VSL_CD = VAPS.VSL_CD(+)
    AND SCD.SKD_VOY_NO = VAPS.SKD_VOY_NO(+)
    AND SCD.SKD_DIR_CD = VAPS.SKD_DIR_CD(+)
    AND SCD.VPS_PORT_CD = VAPS.VPS_PORT_CD(+)
    AND VAPS.CLPT_IND_SEQ(+) = SCD.CLPT_IND_SEQ
#end

#if (${trans_tp_cd} == 'TRNKPC')
    AND BV.VSL_PRE_PST_CD = 'S'

	#if (${loc_tp_cd} == 'LP')
    	#if (${date_tp_cd} == 'ETD' || ${date_tp_cd} == 'ATD' || ${date_tp_cd} == 'ETA' || ${date_tp_cd} == 'ATA')
			AND SCD.ACT_CD IN ('FLVMDO', 'FLWMDO','FTVMDO') -- TRNKPC, LP, ETD/ATD
        #elseif(${date_tp_cd} == 'LD')
			AND SCD.ACT_CD IN ('FLWMLO', 'FLVMLO','FTVMLO') -- TRNKPC, LP, LD 
        #end	
	#elseif(${loc_tp_cd} == 'DP')
		#if (${date_tp_cd} == 'ETA' || ${date_tp_cd} == 'ATA' || ${date_tp_cd} == 'ETD' || ${date_tp_cd} == 'ATD')
			AND SCD.ACT_CD IN ('FTWMAD','FTVMAD','FUWMAD') -- TRNKPC, DP, ETA/ATA
        #elseif(${date_tp_cd} == 'DD')
			AND SCD.ACT_CD IN ('FTWMUD','FTVMUD','FUWMUD') -- TRNKPC, DP, DD 
        #end		
	#end
#end

#if (${trans_tp_cd} == 'TRNKMC')
    AND BV.VSL_PRE_PST_CD = 'T'

	#if (${loc_tp_cd} == 'LP')
		#if (${date_tp_cd} == 'ETD' || ${date_tp_cd} == 'ATD' || ${date_tp_cd} == 'ETA' || ${date_tp_cd} == 'ATA')
			AND SCD.ACT_CD IN ('FTVMDO','FUVMDO','FLVMDO','FLWMDO') -- TRNKMC, LP, 'ETD','ATD'
        #elseif(${date_tp_cd} == 'LD')
			AND SCD.ACT_CD IN ('FTVMLO','FLVMLO','FLWMLO','FTWMLO') -- TRNKMC, LP, 'LD'
        #end 
	#elseif(${loc_tp_cd} == 'DP') 
		#if (${date_tp_cd} == 'ETA' || ${date_tp_cd} == 'ATA' || ${date_tp_cd} == 'ETD' || ${date_tp_cd} == 'ATD')
			AND SCD.ACT_CD IN ('FTWMAD','FTVMAD','FUWMAD','FUVMAD') -- TRNKPC, DP, 'ETA', 'ATA'
        #elseif(${date_tp_cd} == 'DD')
			AND SCD.ACT_CD IN ('FTWMUD','FTVMUD','FUWMUD') -- TRNKPC, DP, 'DD'
        #end 
	#end
#end

#if (${trans_tp_cd} == 'TRNKOC')
    AND BV.VSL_PRE_PST_CD = 'U'

	#if (${loc_tp_cd} == 'LP')
		#if (${date_tp_cd} == 'ETD' || ${date_tp_cd} == 'ATD' || ${date_tp_cd} == 'ETA' || ${date_tp_cd} == 'ATA')
			AND SCD.ACT_CD IN ('FLVMDO','FLWMDO','FTVMDO','FTWMDO') -- -- TRNKOC, LP, ETD, ATD
        #elseif(${date_tp_cd} == 'LD')
			AND SCD.ACT_CD IN ('FLWMLO','FLVMLO','FTVMLO','FTWMLO') -- TRNKOC, LP, LD
        #end 
	#elseif(${loc_tp_cd} == 'DP') 
		#if (${date_tp_cd} == 'ETA' || ${date_tp_cd} == 'ATA' || ${date_tp_cd} == 'ETD' || ${date_tp_cd} == 'ATD')
			AND SCD.ACT_CD IN ('FTWMAD','FTVMAD','FUWMAD','FUVMAD') -- TRNKOC, DP, 'ETA', 'ATA'
        #elseif(${date_tp_cd} == 'DD')
			AND SCD.ACT_CD IN ('FTWMUD','FTVMUD','FUWMUD','FUVMUD') -- TRNKOC, DP, 'DD'
        #end 
	#end
#end

#if (${trans_tp_cd} == 'TRNKTT')
	#if (${loc_tp_cd} == 'START') 
	AND SCD.ACT_CD = 'FTTMDO'
	#elseif(${loc_tp_cd} == 'END') 
	AND SCD.ACT_CD = 'FTTMAD'
	#end
#end

#if (${trans_tp_cd} == 'IBEND')
	#if (${loc_tp_cd} == 'LIBH')
		#if(${date_tp_cd} == 'ATA')
    AND SCD.COP_DTL_SEQ = (SELECT MAX(COP_DTL_SEQ) 
                             FROM SCE_COP_DTL 
                            WHERE COP_NO = @[cop_no]
                               AND ( ACT_CD LIKE 'F%AD' OR ACT_CD  LIKE 'F%UD'))
		#else
    AND SCD.COP_DTL_SEQ = (SELECT MAX(COP_DTL_SEQ) 
                             FROM SCE_COP_DTL 
                            WHERE COP_NO = @[cop_no]
                              AND SUBSTR(ACT_CD,1,2) = 'FI')
		#end
	#elseif(${loc_tp_cd} == 'IBDR') 
	AND SCD.ACT_CD = 'FITZAD'
	#elseif(${loc_tp_cd} == 'ER') 
	AND SCD.ACT_CD = 'MITYAD'
	#elseif(${loc_tp_cd} == 'TOCTY') 
	AND SCD.ACT_CD = 'XXXXX'
	#end
#end

#end			]]></sql>
			<params>
				<param name="date_tp_cd" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="cop_no" type="12" value="" out="N"/>
				<param name="cop_dtl_seq" type="12" value="" out="N"/>
				<param name="loc_yd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
