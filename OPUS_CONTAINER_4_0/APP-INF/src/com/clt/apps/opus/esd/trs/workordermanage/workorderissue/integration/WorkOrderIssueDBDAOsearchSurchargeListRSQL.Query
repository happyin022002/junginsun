<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="WorkOrderIssueDBDAOsearchSurchargeListRSQL">
			<desc><![CDATA[searchSurchargeList]]></desc>
			<sql><![CDATA[
SELECT 
		/*+ LEADING(C) USE_NL(A) */
	   A.TRSP_SO_OFC_CTY_CD
      ,A.TRSP_SO_SEQ
      ,A.TRSP_SO_SEQ AS UNIQUE_CD
      ,A.LGS_COST_CD
      ,B.LGS_COST_FULL_NM
      ,A.SCG_AMT
      ,A.DRY_RUN_RLBL_PTY_TP_CD
      ,A.FNE_CUZ_DESC
      ,A.FUMG_COST_TP_CD
      ,A.MGST_TPSZ_CD
      ,A.INSP_RF_PTI_CSTMS_TP_CD
      ,A.LFTG_KNT
      ,A.LFTG_CUZ_DESC
      ,A.STOP_LOC_NOD_CD
      ,A.GRS_WGT
      ,TO_CHAR(A.INCRT_DT, 'YYYYMMDD') INCRT_DT
      ,A.SCL_STOP_PLC_NOD_CD
      ,A.STO_DYS
      ,A.OB_BKG_NO
      ,A.WT_HRS
      ,A.OTR_RMK
      ,A.INV_SCG_AMT
      ,A.INV_DRY_RUN_RLBL_PTY_TP_CD
      ,A.INV_FNE_CUZ_DESC
      ,A.INV_FUMG_COST_TP_CD
      ,A.INV_MGST_TPSZ_CD
      ,A.INV_INSP_RF_PTI_CSTMS_TP_CD
      ,A.INV_LFTG_KNT
      ,A.INV_LFTG_CUZ_DESC
      ,A.INV_STOP_LOC_NOD_CD
      ,A.INV_GRS_WGT
      ,TO_CHAR(A.INV_INCRT_DT, 'YYYYMMDD') INV_INCRT_DT
      ,A.INV_SCL_STOP_PLC_NOD_CD
      ,A.INV_STO_DYS
      ,A.INV_OB_BKG_NO
      ,A.INV_WT_HRS
      ,A.INV_OTR_RMK
      ,A.N3PTY_BIL_FLG
      ,A.CUST_CNT_CD
      ,A.CUST_SEQ
      ,A.N3PTY_VNDR_SEQ
      ,A.N3PTY_OFC_CD
      ,A.N3PTY_AMT
      ,A.N3PTY_DESC
      ,C.N3PTY_CURR_CD
      ,A.CRE_OFC_CD
      ,A.CRE_USR_ID
      ,TO_CHAR(A.LOCL_CRE_DT, 'YYYYMMDD') CRE_DT
      ,TO_CHAR(A.INCUR_DT, 'YYYYMMDD') INCUR_DT
      ,A.CHSS_NO
      ,TO_CHAR(A.INV_INCUR_DT, 'YYYYMMDD') INV_INCUR_DT
      ,A.INV_CHSS_NO
      ,C.REF_INV_NO
      ,A.TRSP_AGMT_OFC_CTY_CD
      ,A.TRSP_AGMT_SEQ
      ,A.TRSP_AGMT_RT_TP_SER_NO
      ,A.TRSP_AGMT_SCG_NOD_SEQ
      ,A.TRSP_AGMT_SCG_RT_SEQ
      ,A.FUEL_RTO
      ,A.COM_SCG_KND_CD
      ,A.COM_SCG_SEQ
      ,A.SCG_DTL_SEQ
      ,NVL(A.CURR_CD, C.CURR_CD) AS CURR_CD
      ,(SELECT ROUND((X1.USD_LOCL_XCH_RT / X2.USD_LOCL_XCH_RT),6) AS RATE
          FROM GL_MON_XCH_RT X1
             , GL_MON_XCH_RT X2
         WHERE X1.ACCT_XCH_RT_YRMON = TO_CHAR(C.LOCL_CRE_DT, 'YYYYMM') -- S/O Creation Date
           AND X1.ACCT_XCH_RT_LVL = '1'
           AND X1.CURR_CD = C.CURR_CD -- W/O Currency
           AND X2.ACCT_XCH_RT_YRMON = TO_CHAR(C.LOCL_CRE_DT, 'YYYYMM') -- S/O Creation Date
           AND X2.ACCT_XCH_RT_LVL = '1'
           AND X2.CURR_CD = NVL(A.CURR_CD, C.CURR_CD) -- SCG Currency
           AND X1.DELT_FLG = 'N'
           AND X2.DELT_FLG = 'N'
       ) AS WO_SCG_XCH_RT
      ,NVL(A.ORG_SCG_AMT, A.SCG_AMT) AS ORG_SCG_AMT
  FROM TRS_TRSP_SCG_DTL A
      ,TES_LGS_COST     B
      ,TRS_TRSP_SVC_ORD C
 WHERE  1=1
#if($SoNo.size() > 0 ) 
   AND  (C.TRSP_SO_OFC_CTY_CD, C.TRSP_SO_SEQ) IN (
	#foreach($code IN ${SoNo})  
		#if($velocityCount == 1)  
						(SUBSTR('$code', 1, 3),SUBSTR('$code', 4, 8))
		#else  
					   ,(SUBSTR('$code', 1, 3),SUBSTR('$code', 4, 8))
		#end 
	#end  
		)
#end
		
  AND  A.TRSP_SO_OFC_CTY_CD = C.TRSP_SO_OFC_CTY_CD 	
  AND  A.TRSP_SO_SEQ = C.TRSP_SO_SEQ				 	
  AND  A.LGS_COST_CD = B.LGS_COST_CD			]]></sql>
			<params>
			</params>
		</query>
	</querys>
</sqls>
