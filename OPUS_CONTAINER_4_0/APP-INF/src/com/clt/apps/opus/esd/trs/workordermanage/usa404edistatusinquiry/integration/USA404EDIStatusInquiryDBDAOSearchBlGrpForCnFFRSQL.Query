<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="USA404EDIStatusInquiryDBDAOSearchBlGrpForCnFFRSQL">
			<desc><![CDATA[USA404EDIStatusInquiryDBDAOSearchBlGrpForCnFF]]></desc>
			<sql><![CDATA[
SELECT T.*
  FROM (SELECT  /*+ LEADING(BC) USE_NL(B) USE_NL(B1)*/ 
               BC.BKG_NO BL_BKGNO
              ,B1.BL_NO BL_BLNO
              ,BC.CNTR_NO EQ_NO
              ,SUM_PCK_QTY BL_LADEQTY
              ,REPLACE(REPLACE(D.CNTR_MF_GDS_DESC, CHR(13), ' '), CHR(10), ' ') BL_LADEDESC
              ,D.HAMO_TRF_CD BL_COMMCODE
              ,D.PCK_TP_CD BL_PACKFORM
          FROM BKG_CONTAINER BC
              ,BKG_BOOKING B
              ,BKG_BOOKING B1
              ,(SELECT BKG_NO
                      ,CNTR_NO
                      ,CNTR_MF_GDS_DESC
                      ,HAMO_TRF_CD
                      ,SUM_PCK_QTY
                      ,CASE	WHEN FIRST_PCK_TP_CD = LAST_PCK_TP_CD THEN FIRST_PCK_TP_CD
                         	ELSE 'PC'
                       END PCK_TP_CD
                  FROM (SELECT K.BKG_NO
                              ,K.CNTR_NO
                              ,K.CNTR_MF_SEQ
                              ,K.CNTR_MF_GDS_DESC
                              ,K.HAMO_TRF_CD
                              ,SUM(NVL(PCK_QTY, 0)) OVER(PARTITION BY K.BKG_NO, K.CNTR_NO) SUM_PCK_QTY
                              ,MIN(K.CNTR_MF_SEQ) OVER(PARTITION BY K.BKG_NO, K.CNTR_NO) MIN_CNTR_MF_SEQ
                              ,FIRST_VALUE(K.PCK_TP_CD) OVER(PARTITION BY K.BKG_NO, K.CNTR_NO ORDER BY K.PCK_TP_CD) FIRST_PCK_TP_CD
                              ,LAST_VALUE(K.PCK_TP_CD) OVER(PARTITION BY K.BKG_NO, K.CNTR_NO ORDER BY K.PCK_TP_CD) LAST_PCK_TP_CD
                          FROM BKG_CNTR_MF_DESC K)
                 WHERE CNTR_MF_SEQ = MIN_CNTR_MF_SEQ) D
         WHERE 1 = 1
           AND EXISTS (SELECT 1
                  FROM SCE_COP_HDR M, SCE_COP_HDR S, TRS_TRSP_RAIL_BIL_ORD O
                 WHERE O.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                   AND O.TRSP_SO_SEQ = @[trsp_so_seq]
                   AND O.TRSP_BND_CD = 'I'
                   AND NVL(O.DELT_FLG, 'N') <> 'Y'
                   AND S.COP_NO = O.COP_NO
                   AND S.MST_COP_NO = M.COP_NO
                   AND M.BKG_NO = B.BKG_NO)
           AND B.BKG_NO <> B1.BKG_NO
           AND B.VSL_CD = B1.VSL_CD
           AND B.SKD_VOY_NO = B1.SKD_VOY_NO
           AND B.SKD_DIR_CD = B1.SKD_DIR_CD
           AND B1.BKG_NO = BC.BKG_NO
           AND BC.CNTR_NO = @[eq_no]
           AND B1.BKG_CGO_TP_CD = 'F'
           AND (B1.BKG_STS_CD = 'W' OR B1.BKG_STS_CD = 'F')
           AND BC.BKG_NO = D.BKG_NO(+)
           AND BC.CNTR_NO = D.CNTR_NO(+)
         ORDER BY BC.BKG_NO, B1.BL_NO, BC.CNTR_NO) T
 RIGHT OUTER JOIN DUAL
    ON 1 = 1			]]></sql>
			<params>
				<param name="trsp_so_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="trsp_so_seq" type="12" value="" out="N"/>
				<param name="eq_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
