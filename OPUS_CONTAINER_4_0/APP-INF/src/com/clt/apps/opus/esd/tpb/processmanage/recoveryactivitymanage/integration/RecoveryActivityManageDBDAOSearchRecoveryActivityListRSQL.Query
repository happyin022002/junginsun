<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RecoveryActivityManageDBDAOSearchRecoveryActivityListRSQL">
			<desc><![CDATA[Recovery Activity List Search]]></desc>
			<sql><![CDATA[
SELECT 2 SORTNO
      ,B.N3PTY_NO
      ,B.OTS_GRP_RCVR_ACT_SEQ
      ,B.ACT_RMK
      ,TO_CHAR(TPB_GET_LCL_DATE_FNC(B.LOCL_CRE_DT,@[user_ofc_cd]),'YYYY-MM-DD HH24:MI') LOCL_CRE_DT
      ,B.CLT_ACT_UPD_OFC_CD
      ,B.UPD_USR_ID
      ,B.CNTC_PSON_NM
      ,DECODE(B.N3PTY_CLT_RMK_TP_CD,'A',1,0) N3PTY_NO_Y
      ,DECODE(B.N3PTY_CLT_RMK_TP_CD,'M',1,0) N3PTY_NO_N
      ,NVL2(B.FILE_NO,'File Attach',DECODE(B.N3PTY_CLT_RMK_TP_CD,'M','File Attach')) IMG_FILE_NO
      ,B.FILE_NO
      ,A.N3PTY_INV_NO
      ,B.N3PTY_CLT_RMK_TP_CD
	  ,NVL2(b.file_no, ( SELECT COUNT(0) cnt FROM TPB_TTL_FILE_MGMT f WHERE f.file_no=b.file_no AND f.delt_flg='N' ), 0) As file_count		
  FROM TPB_OTS_GRP A
      ,TPB_OTS_GRP_RCVR_ACT B
 WHERE A.N3PTY_NO = B.N3PTY_NO
#if (${s_n3pty_no} != '') 
   AND A.N3PTY_NO = @[s_n3pty_no]
#else 
   AND 1 = 0
#end
UNION
SELECT 2 SORTNO
      ,B.N3PTY_NO
      ,B.OTS_GRP_RCVR_ACT_SEQ
      ,TPB_GET_IF_RMK_FNC(B.N3PTY_NO) ACT_RMK
      ,TO_CHAR(TPB_GET_LCL_DATE_FNC(B.LOCL_CRE_DT,@[user_ofc_cd]),'YYYY-MM-DD HH24:MI') LOCL_CRE_DT
      ,B.CLT_ACT_UPD_OFC_CD
      ,B.UPD_USR_ID
      ,B.CNTC_PSON_NM
      ,DECODE(B.N3PTY_CLT_RMK_TP_CD,'A',1,0) N3PTY_NO_Y
      ,DECODE(B.N3PTY_CLT_RMK_TP_CD,'M',1,0) N3PTY_NO_N
      ,NVL2(B.FILE_NO,'File Attach',DECODE(B.N3PTY_CLT_RMK_TP_CD,'M','File Attach')) IMG_FILE_NO
      ,B.FILE_NO
      ,A.N3PTY_INV_NO
      ,B.N3PTY_CLT_RMK_TP_CD
	  ,NVL2(b.file_no, ( SELECT COUNT(0) cnt FROM TPB_TTL_FILE_MGMT f WHERE f.file_no=b.file_no AND f.delt_flg='N' ), 0) As file_count
  FROM TPB_OTS_GRP A
      ,TPB_OTS_GRP_RCVR_ACT B
 WHERE A.N3PTY_NO = B.N3PTY_NO
#if (${s_n3pty_no} != '') 
   AND A.N3PTY_NO = @[s_n3pty_no]
#else 
   AND 1 = 0
#end
   AND B.OTS_GRP_RCVR_ACT_SEQ = 1
   AND TPB_GET_IF_RMK_FNC(B.N3PTY_NO) IS NOT NULL
ORDER BY SORTNO, N3PTY_NO, OTS_GRP_RCVR_ACT_SEQ			]]></sql>
			<params>
				<param name="user_ofc_cd" type="12" value="" out="N"/>
				<param name="s_n3pty_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
