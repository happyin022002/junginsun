<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MstMgmtDBDAOSearchMdmDatProcCompletionListRSQL">
			<desc><![CDATA[MDM_DAT_PROC Completion List 정보 조회]]></desc>
			<sql><![CDATA[
SELECT		DISTINCT
			XX.*
FROM		(

(SELECT RQST_NO,
       P.MST_DAT_SUBJ_CD,
       (SELECT INTG_CD_VAL_DP_DESC
          FROM COM_INTG_CD_DTL
         WHERE INTG_CD_ID = 'CD20091'
           AND INTG_CD_VAL_CTNT = P.MST_DAT_SUBJ_CD ) AS MST_DAT_SUBJ_DESC,
	   (SELECT INTG_CD_VAL_DESC
          FROM COM_INTG_CD_DTL
         WHERE INTG_CD_ID = 'CD20091'
           AND INTG_CD_VAL_CTNT = P.MST_DAT_SUBJ_CD ) AS RQST_DTL_PGM_NO,
       RQST_USR_ID,
       RQST_OFC_CD,
       APRO_USR_ID,
	   PROC_TP_CD,
       (SELECT INTG_CD_VAL_DP_DESC
          FROM COM_INTG_CD_DTL
         WHERE INTG_CD_ID = 'CD20093'
           AND INTG_CD_VAL_CTNT = P.PROC_TP_CD ) PROC_TP_NM,
       
	   DECODE(PROC_TP_CD, 'A', APRO_RMK, RJCT_RMK) RMK,
       TO_CHAR(GLOBALDATE_PKG.TIME_CONV_FNC((SELECT LOC_CD FROM MDM_ORGANIZATION WHERE OFC_CD = P.RQST_OFC_CD), RQST_CRE_DT, 'GMT'), 'YYYY-MM-DD HH24:MI:SS') RQST_CRE_DT,
       TO_CHAR(GLOBALDATE_PKG.TIME_CONV_FNC((SELECT LOC_CD FROM MDM_ORGANIZATION WHERE OFC_CD = P.RQST_OFC_CD), PROC_UPD_DT, 'GMT'), 'YYYY-MM-DD HH24:MI:SS') PROC_UPD_DT,
	   DECODE(@[mdaa_chk],'Y', 'S', A.AUTH_TP_CD) AUTH_TP_CD,
	
       P.RQST_UPD_DT,
       P.PROC_CRE_DT,
       P.CRE_USR_ID,
       P.CRE_DT,
       P.UPD_USR_ID,
       P.UPD_DT,
	   P.DELT_FLG,     
	   
       CASE P.MST_DAT_SUBJ_CD
         WHEN 'CUST' THEN (SELECT DECODE(CUST_SEQ, 0, '', CUST_CNT_CD || LPAD(CUST_SEQ, 6, '0'))
          FROM MDM_CUST_RQST CR
         WHERE CR.RQST_NO = P.RQST_NO )
         WHEN 'GCST' THEN (SELECT CUST_GRP_ID
          					 FROM MDM_CUST_PERF_GRP_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
		 WHEN 'VNDR' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT VNDR_SEQ
          					 FROM MDM_VNDR_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
		 WHEN 'CARR' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT CRR_CD
          					 FROM MDM_CRR_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
		 WHEN 'CHRG' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT CHG_CD
          					 FROM MDM_CHG_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
		 WHEN 'VESL' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT VSL_CD
          					 FROM MDM_VSL_CNTR_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
		 WHEN 'CMDT' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT CMDT_CD
          					 FROM MDM_CMDT_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
         WHEN 'LOCA' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT LOC_CD
          					 FROM MDM_LOC_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
         WHEN 'REVL' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT RLANE_CD
          					 FROM MDM_REV_LANE_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
         WHEN 'SCVL' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT VSL_SLAN_CD
          					 FROM MDM_VSL_SVC_LANE_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
         WHEN 'SREP' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT SREP_CD
          					 FROM MDM_SLS_REP_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
         WHEN 'SVSP' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT SVC_SCP_CD
          					 FROM MDM_SVC_SCP_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
         WHEN 'TRDE' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT TRD_CD
          					 FROM MDM_TRD_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
         WHEN 'YARD' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT YD_CD
          					 FROM MDM_YD_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
         WHEN 'ZONE' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT ZN_CD
          					 FROM MDM_ZN_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
         ELSE ''
       END RQST_CD,

       CASE P.MST_DAT_SUBJ_CD
         WHEN 'CUST' THEN (SELECT CUST_LGL_ENG_NM
          FROM MDM_CUST_RQST CR
         WHERE CR.RQST_NO = P.RQST_NO)
         WHEN 'GCST' THEN (SELECT CUST_GRP_NM
          					 FROM MDM_CUST_PERF_GRP_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
		 WHEN 'VNDR' THEN (SELECT VNDR_LGL_ENG_NM
          					 FROM MDM_VNDR_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
		 WHEN 'CARR' THEN (SELECT CRR_NM
          					 FROM MDM_CRR_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
		 WHEN 'CHRG' THEN (SELECT CHG_NM
          					 FROM MDM_CHG_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
		 WHEN 'VESL' THEN (SELECT VSL_ENG_NM
          					 FROM MDM_VSL_CNTR_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
		 WHEN 'CMDT' THEN (SELECT CMDT_NM
          					 FROM MDM_CMDT_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
         WHEN 'LOCA' THEN (SELECT LOC_NM
          					 FROM MDM_LOC_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
         WHEN 'REVL' THEN (SELECT RLANE_NM
          					 FROM MDM_REV_LANE_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
         WHEN 'SCVL' THEN (SELECT VSL_SLAN_NM
          					 FROM MDM_VSL_SVC_LANE_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
         WHEN 'SREP' THEN (SELECT SREP_NM
          					 FROM MDM_SLS_REP_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
         WHEN 'SVSP' THEN (SELECT SVC_SCP_NM
          					 FROM MDM_SVC_SCP_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
         WHEN 'TRDE' THEN (SELECT TRD_NM
          					 FROM MDM_TRD_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
         WHEN 'YARD' THEN (SELECT YD_NM
          					 FROM MDM_YD_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
         WHEN 'ZONE' THEN (SELECT ZN_NM
          					 FROM MDM_ZN_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
         ELSE ''
       END RQST_NM

  FROM MDM_DAT_PROC P,
       MDM_USR_AUTH A

 WHERE 1=1
	#if (${mdaa_chk} == 'Y')
	   --AND A.MST_DAT_SUBJ_CD = 'MDAA'
      #else
       AND P.MST_DAT_SUBJ_CD = A.MST_DAT_SUBJ_CD
	  #end		
   AND P.PROC_TP_CD != 'O'
   AND (
		   (	P.RQST_USR_ID = A.USR_ID
				#if (${mdaa_chk} != 'Y')
					AND P.RQST_USR_ID = @[rqst_usr_id]
				#end			
			)

		#if (${mdaa_chk} != 'Y')
		OR ( 
                 A.USR_ID = @[rqst_usr_id] 
             AND ( P.RQST_OFC_CD IN (
					SELECT OFC_CD
                    FROM (
						SELECT OFC_KIND OFC_KND_CD ,
                               A.OFC_CD OFC_CD,
                               L1 OFC_LVL,
                               DECODE(A.L1, 1, A.OFC_CD, 2, B.OFC_CD, 3, C.OFC_CD, 4, D.OFC_CD) HO ,
									   CASE
										 WHEN DECODE(A.L1, 1, A.OFC_CD, 2, A.OFC_CD, 3, B.OFC_CD, 4, C.OFC_CD) = DECODE(A.L1, 1, A.OFC_CD, 2, B.OFC_CD, 3, C.OFC_CD, 4, D.OFC_CD) THEN NULL
										 ELSE DECODE(A.L1, 1, A.OFC_CD, 2, A.OFC_CD, 3, B.OFC_CD, 4, C.OFC_CD)
									   END AS RHQ ,
									   CASE
										 WHEN DECODE(A.L1, 1, A.OFC_CD, 2, A.OFC_CD, 3, A.OFC_CD, 4, B.OFC_CD) = DECODE(A.L1, 1, A.OFC_CD, 2, A.OFC_CD, 3, B.OFC_CD, 4, C.OFC_CD) THEN NULL
										 ELSE DECODE(A.L1, 1, A.OFC_CD, 2, A.OFC_CD, 3, A.OFC_CD, 4, B.OFC_CD)
									   END AS BB_AA ,
									   CASE
										 WHEN DECODE(A.L1, 1, A.OFC_CD, 2, A.OFC_CD, 3, A.OFC_CD, 4, A.OFC_CD) = DECODE(A.L1, 1, A.OFC_CD, 2, A.OFC_CD, 3, A.OFC_CD, 4, B.OFC_CD) THEN NULL
										 ELSE DECODE(A.L1, 1, A.OFC_CD, 2, A.OFC_CD, 3, A.OFC_CD, 4, A.OFC_CD)
									   END AS SUB_BB ,
                               A.OFC_ENG_NM ,
                               A.DEL AS STATUS
                          FROM (SELECT OFC_CD ,
                                       OFC_ENG_NM,
                                       LOC_CD ,
                                       PRNT_OFC_CD ,
                                       DELT_FLG DEL ,
                                       A.OFC_KND_CD OFC_KIND ,
                                       LEVEL L1
                                  FROM MDM_ORGANIZATION A START WITH A.OFC_CD = COM_CONSTANTMGR_PKG.COM_getHeadOfficeCode_FNC() CONNECT BY PRIOR A.OFC_CD = A.PRNT_OFC_CD ) A ,
                               MDM_ORGANIZATION B ,
                               MDM_ORGANIZATION C ,
                               MDM_ORGANIZATION D
                         WHERE A.PRNT_OFC_CD = B.OFC_CD(+)
                           AND B.PRNT_OFC_CD = C.OFC_CD(+)
                           AND C.PRNT_OFC_CD = D.OFC_CD(+) )
                 WHERE 1=1

				#if (${ofc_knd_cd} == '1')
					AND HO = @[rqst_ofc_cd]
				#elseif (${ofc_knd_cd} == '2')
					AND RHQ = @[rqst_ofc_cd]
				#elseif (${ofc_knd_cd} == '3')
					AND BB_AA = @[rqst_ofc_cd]
				#elseif (${ofc_knd_cd} == '4')
					AND SUB_BB = @[rqst_ofc_cd]
				#elseif (${ofc_knd_cd} == '5' ) 
					AND OFC_CD = @[rqst_ofc_cd]
				#end

                	AND STATUS <> 'Y' ) 
			  )  
          )
		#end
   )
   AND NVL(P.DELT_FLG, 'N') <> 'Y'

#if (${fm_rqst_dt} != '')
   AND P.RQST_CRE_DT BETWEEN TO_DATE(REPLACE(@[fm_rqst_dt], '-', ''), 'YYYYMMDD') 
						 AND TO_DATE(REPLACE(@[to_rqst_dt], '-', ''), 'YYYYMMDD') + 0.999999
#end

#if (${mst_dat_subj_cd} != '')
   AND P.MST_DAT_SUBJ_CD = @[mst_dat_subj_cd]
#end
)
#if(${mst_dat_subj_cd} == '' || ${mst_dat_subj_cd} == 'CUST')
UNION ALL
(
SELECT RQST_NO,
       P.MST_DAT_SUBJ_CD,
       (SELECT INTG_CD_VAL_DP_DESC
          FROM COM_INTG_CD_DTL
         WHERE INTG_CD_ID = 'CD20091'
           AND INTG_CD_VAL_CTNT = P.MST_DAT_SUBJ_CD ) AS MST_DAT_SUBJ_DESC,
	   (SELECT INTG_CD_VAL_DESC
          FROM COM_INTG_CD_DTL
         WHERE INTG_CD_ID = 'CD20091'
           AND INTG_CD_VAL_CTNT = P.MST_DAT_SUBJ_CD ) AS RQST_DTL_PGM_NO,
       RQST_USR_ID,
       RQST_OFC_CD,
       APRO_USR_ID,
	   PROC_TP_CD,
       (SELECT INTG_CD_VAL_DP_DESC
          FROM COM_INTG_CD_DTL
         WHERE INTG_CD_ID = 'CD20093'
           AND INTG_CD_VAL_CTNT = P.PROC_TP_CD ) PROC_TP_NM,
       
	   DECODE(PROC_TP_CD, 'A', APRO_RMK, RJCT_RMK) RMK,
       TO_CHAR(GLOBALDATE_PKG.TIME_CONV_FNC((SELECT LOC_CD FROM MDM_ORGANIZATION WHERE OFC_CD = P.RQST_OFC_CD), RQST_CRE_DT, 'GMT'), 'YYYY-MM-DD HH24:MI:SS') RQST_CRE_DT,
       TO_CHAR(GLOBALDATE_PKG.TIME_CONV_FNC((SELECT LOC_CD FROM MDM_ORGANIZATION WHERE OFC_CD = P.RQST_OFC_CD), PROC_UPD_DT, 'GMT'), 'YYYY-MM-DD HH24:MI:SS') PROC_UPD_DT,
	   DECODE(@[mdaa_chk],'Y', 'S', A.AUTH_TP_CD) AUTH_TP_CD,
	
       P.RQST_UPD_DT,
       P.PROC_CRE_DT,
       P.CRE_USR_ID,
       P.CRE_DT,
       P.UPD_USR_ID,
       P.UPD_DT,
	   P.DELT_FLG,     
	   
       CASE P.MST_DAT_SUBJ_CD
         WHEN 'CUST' THEN (SELECT DECODE(CUST_SEQ, 0, '', CUST_CNT_CD || LPAD(CUST_SEQ, 6, '0'))
          FROM MDM_CUST_RQST CR
         WHERE CR.RQST_NO = P.RQST_NO )
         WHEN 'GCST' THEN (SELECT CUST_GRP_ID
          					 FROM MDM_CUST_PERF_GRP_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
		 WHEN 'VNDR' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT VNDR_SEQ
          					 FROM MDM_VNDR_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
		 WHEN 'CARR' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT CRR_CD
          					 FROM MDM_CRR_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
		 WHEN 'CHRG' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT CHG_CD
          					 FROM MDM_CHG_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
		 WHEN 'VESL' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT VSL_CD
          					 FROM MDM_VSL_CNTR_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
		 WHEN 'CMDT' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT CMDT_CD
          					 FROM MDM_CMDT_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
         WHEN 'LOCA' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT LOC_CD
          					 FROM MDM_LOC_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
         WHEN 'REVL' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT RLANE_CD
          					 FROM MDM_REV_LANE_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
         WHEN 'SCVL' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT VSL_SLAN_CD
          					 FROM MDM_VSL_SVC_LANE_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
         WHEN 'SREP' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT SREP_CD
          					 FROM MDM_SLS_REP_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
         WHEN 'SVSP' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT SVC_SCP_CD
          					 FROM MDM_SVC_SCP_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
         WHEN 'TRDE' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT TRD_CD
          					 FROM MDM_TRD_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
         WHEN 'YARD' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT YD_CD
          					 FROM MDM_YD_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
         WHEN 'ZONE' THEN DECODE(PROC_TP_CD, 'R', '', (SELECT ZN_CD
          					 FROM MDM_ZN_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO))
         ELSE ''
       END RQST_CD,

       CASE P.MST_DAT_SUBJ_CD
         WHEN 'CUST' THEN (SELECT CUST_LGL_ENG_NM
          FROM MDM_CUST_RQST CR
         WHERE CR.RQST_NO = P.RQST_NO)
         WHEN 'GCST' THEN (SELECT CUST_GRP_NM
          					 FROM MDM_CUST_PERF_GRP_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
		 WHEN 'VNDR' THEN (SELECT VNDR_LGL_ENG_NM
          					 FROM MDM_VNDR_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
		 WHEN 'CARR' THEN (SELECT CRR_NM
          					 FROM MDM_CRR_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
		 WHEN 'CHRG' THEN (SELECT CHG_NM
          					 FROM MDM_CHG_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
		 WHEN 'VESL' THEN (SELECT VSL_ENG_NM
          					 FROM MDM_VSL_CNTR_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
		 WHEN 'CMDT' THEN (SELECT CMDT_NM
          					 FROM MDM_CMDT_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
         WHEN 'LOCA' THEN (SELECT LOC_NM
          					 FROM MDM_LOC_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
         WHEN 'REVL' THEN (SELECT RLANE_NM
          					 FROM MDM_REV_LANE_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
         WHEN 'SCVL' THEN (SELECT VSL_SLAN_NM
          					 FROM MDM_VSL_SVC_LANE_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
         WHEN 'SREP' THEN (SELECT SREP_NM
          					 FROM MDM_SLS_REP_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
         WHEN 'SVSP' THEN (SELECT SVC_SCP_NM
          					 FROM MDM_SVC_SCP_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
         WHEN 'TRDE' THEN (SELECT TRD_NM
          					 FROM MDM_TRD_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
         WHEN 'YARD' THEN (SELECT YD_NM
          					 FROM MDM_YD_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
         WHEN 'ZONE' THEN (SELECT ZN_NM
          					 FROM MDM_ZN_RQST CR
         					WHERE CR.RQST_NO = P.RQST_NO)
         ELSE ''
       END RQST_NM

  FROM MDM_DAT_PROC P,
       MDM_USR_AUTH A
 WHERE 1=1
  AND P.MST_DAT_SUBJ_CD = A.MST_DAT_SUBJ_CD
	  	
   AND P.PROC_TP_CD <> 'O'
   AND P.MST_DAT_SUBJ_CD = 'CUST'
   AND  ( 
                 A.USR_ID = @[rqst_usr_id]
             AND (SELECT SUBSTR(LOC_CD, 1,2) FROM MDM_ORGANIZATION WHERE OFC_CD = @[rqst_ofc_cd]) 
                = (SELECT CUST_CNT_CD FROM MDM_CUST_RQST WHERE RQST_NO = P.RQST_NO) 
             
		   )
   AND NVL(P.DELT_FLG, 'N') <> 'Y' 
#if (${fm_rqst_dt} != '')
   AND P.RQST_CRE_DT BETWEEN TO_DATE(REPLACE(@[fm_rqst_dt], '-', ''), 'YYYYMMDD') 
						 AND TO_DATE(REPLACE(@[to_rqst_dt], '-', ''), 'YYYYMMDD') + 0.999999
#end
)
#end
)	XX
ORDER BY XX.UPD_DT DESC			]]></sql>
			<params>
				<param name="mdaa_chk" type="12" value="" out="N"/>
				<param name="rqst_usr_id" type="12" value="" out="N"/>
				<param name="rqst_ofc_cd" type="12" value="" out="N"/>
				<param name="fm_rqst_dt" type="12" value="" out="N"/>
				<param name="to_rqst_dt" type="12" value="" out="N"/>
				<param name="mst_dat_subj_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
