<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AgentCanalTransitFeeBCDBDAOsearchCanalTzVVDListRSQL">
			<desc><![CDATA[searchCanalTzVVDList]]></desc>
			<sql><![CDATA[
SELECT (SELECT VSL_ENG_NM FROM MDM_VSL_CNTR WHERE VSL_CD = A.VSL_CD) VSL_NM
       ,A.VSL_CD 
       ,A.SKD_VOY_NO
       ,A.SKD_DIR_CD
       ,A.SLAN_CD LANE
	   ,A.YD_CD
       ,A.TRNS_DT
       ,(SELECT TO_CHAR(X.DUE_DT,'YYYY-MM-DD') 
           FROM PSO_CHARGE X 
          WHERE X.ISS_CTY_CD = A.ISS_CTY_CD 
            AND X.SO_SEQ = A.SO_SEQ
       ) PY_DUE_DT
       ,ADV_PY_STS  --'A', 'P'
       ,(SELECT NTC_YRMON FROM PSO_CNL_TZ_FEE 
          WHERE A.VSL_CD =VSL_CD 
            AND A.SKD_VOY_NO = SKD_VOY_NO 
            AND A.SKD_DIR_CD = SKD_DIR_CD 
            AND PSO_BZTP_CD = 5
            AND CNL_TZ_BZTP_CD = 'E'
        ) ADV_PY_REV_MON
       ,(SELECT NVL(MAX(CALL_SEQ),'1') FROM PSO_CNL_TZ_FEE  --존재하지 않을때 초기값 1, 실제로는 존재하지 않을 수 없다.
          WHERE VSL_CD       = A.VSL_CD
            AND SKD_VOY_NO   = A.SKD_VOY_NO
            AND SKD_DIR_CD   = A.SKD_DIR_CD
            AND YD_CD        = A.YD_CD
            AND 'E'          = CNL_TZ_BZTP_CD) ESEQ
       ,(SELECT NVL(MAX(CALL_SEQ),'2')+1 FROM PSO_CNL_TZ_FEE  --존재하지 않을때 초기값2, 실제로는 존재하지 않을 수 없다. "추가되는 값 =(존재하는MAX값+1)" 이 된다.
          WHERE VSL_CD       = A.VSL_CD
            AND SKD_VOY_NO   = A.SKD_VOY_NO
            AND SKD_DIR_CD   = A.SKD_DIR_CD
            AND YD_CD        = A.YD_CD
            AND 'I'          = CNL_TZ_BZTP_CD) ISEQ
	   ,'' REVYRMON
       ,'' TRANSYMD
       ,VNDR_SEQ 
  FROM (               
        SELECT  A.VSL_CD 
               ,A.SKD_VOY_NO
               ,A.SKD_DIR_CD
               ,A.SLAN_CD
               ,C.YD_CD
               ,A.VPS_PORT_CD
               ,TO_CHAR(A.VPS_ETA_DT,'YYYY-MM-DD') TRNS_DT
               ,(SELECT ISS_CTY_CD 
                   FROM PSO_CNL_TZ_FEE
                  WHERE VSL_CD       = A.VSL_CD
                    AND SKD_VOY_NO   = A.SKD_VOY_NO
                    AND SKD_DIR_CD   = A.SKD_DIR_CD
                    AND YD_CD        = C.YD_CD
                    AND 'E'          = CNL_TZ_BZTP_CD
               ) ISS_CTY_CD
               ,(SELECT SO_SEQ 
                   FROM PSO_CNL_TZ_FEE
                  WHERE VSL_CD       = A.VSL_CD
                    AND SKD_VOY_NO   = A.SKD_VOY_NO
                    AND SKD_DIR_CD   = A.SKD_DIR_CD
                    AND YD_CD        = C.YD_CD
                    AND 'E'          = CNL_TZ_BZTP_CD
               ) SO_SEQ 
               ,(SELECT CNL_TZ_PROC_STS_CD
                   FROM PSO_CNL_TZ_FEE
                  WHERE VSL_CD       = A.VSL_CD
                    AND SKD_VOY_NO   = A.SKD_VOY_NO
                    AND SKD_DIR_CD   = A.SKD_DIR_CD
                    AND YD_CD        = C.YD_CD
                    AND 'E'          = CNL_TZ_BZTP_CD
               ) AS ADV_PY_STS
			   ,C.VNDR_SEQ
          FROM VSK_VSL_PORT_SKD A, MDM_VSL_SVC_LANE B, PSO_CNL_TZ_FEE C, VSK_VSL_SKD D
         WHERE 1=1
           AND VPS_PORT_CD = (SELECT decode(vndr_cnt_cd,'PA','PAPAC','EGSUZ') FROM MDM_VENDOR WHERE VNDR_SEQ=@[vndr_seq])
           AND VPS_ETA_DT BETWEEN TO_DATE(@[transymd],'YYYYMMDD')-7 AND TO_DATE(@[transymd],'YYYYMMDD')+7
           AND B.VSL_SLAN_CD = D.VSL_SLAN_CD 
           AND B.CNL_AGN_VNDR_SEQ = @[vndr_seq]
           AND A.VSL_CD = C.VSL_CD 
           AND A.SKD_VOY_NO = C.SKD_VOY_NO
           AND A.SKD_DIR_CD = C.SKD_DIR_CD
           AND A.YD_CD = C.YD_CD
           AND C.VNDR_SEQ = @[vndr_seq]
           AND C.NTC_YRMON < @[revyrmon]
           AND C.CNL_TZ_BZTP_CD = 'I'
           AND C.PSO_BZTP_CD = 5
           AND C.CNL_TZ_PROC_STS_CD ='A'
		   AND D.VSL_CD = A.VSL_CD
 		   AND D.SKD_VOY_NO = A.SKD_VOY_NO
		   AND D.SKD_DIR_CD = A.SKD_DIR_CD
        GROUP BY A.VSL_CD 
               ,A.SKD_VOY_NO
               ,A.SKD_DIR_CD
               ,A.SLAN_CD
               ,C.YD_CD
               ,A.VPS_PORT_CD
               ,TO_CHAR(A.VPS_ETA_DT,'YYYY-MM-DD')
			   ,VNDR_SEQ
       ) A			]]></sql>
			<params>
				<param name="vndr_seq" type="12" value="2132" out="N"/>
				<param name="transymd" type="12" value="20090606" out="N"/>
				<param name="revyrmon" type="12" value="200905" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
