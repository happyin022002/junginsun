<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountPayableInvoiceDBDAOSearchInvoiceAccrualListRSQL">
			<desc><![CDATA[SearchInvoiceAccrualList]]></desc>
			<sql><![CDATA[
SELECT  SIH.INV_NO                    AS INV_NO
      , SIH.INV_SEQ                   AS INV_SEQ
      , SIH.VNDR_NO                   AS VNDR_NO
      , MV.VNDR_LGL_ENG_NM            AS VNDR_NM
      , SIH.INV_CURR_CD               AS CURR_CD
      , TRIM(OPUSADM.SAP_GET_CUR_AMT_FNC(SIH.INV_CURR_CD, SIH.INV_AMT)) AS INV_AMT
      , SIH.INV_DT                    AS INV_DT
      , SIH.INV_TP_LU_CD              AS INV_TP_LU_CD
      , SLCC.SGM_CTNT4                AS ACCRUAL_ACCT_CD
      , NVL(SIH.INV_XCH_RT, 1)        AS INV_XCH_RT
      , SIH.OFC_CD                    AS OFC_CD
      , SID.ACCTG_DT                  AS GL_DT
      , SID.DTRB_LINE_NO              AS LINE_NO
      , SID.LINE_TP_LU_CD             AS LINE_TP_LU_CD
      , TRIM(OPUSADM.SAP_GET_CUR_AMT_FNC(SIH.INV_CURR_CD, SID.DTRB_AMT)) AS DTRB_AMT
      , TRIM(OPUSADM.SAP_GET_CUR_AMT_FNC(SIH.INV_CURR_CD, SID.DTRB_FUNC_AMT)) AS DTRB_FUNC_AMT
      , SLCC2.SGM_CTNT1||'.'||SLCC2.SGM_CTNT2||'.'||SLCC2.SGM_CTNT3||'.'||SLCC2.SGM_CTNT4||'.'||SLCC2.SGM_CTNT5||'.'||SLCC2.SGM_CTNT6  AS DTRB_COA
      , SID.ATTR_CTNT1                AS VNDR_INV_NO
      , SID.ATTR_CTNT2                AS VNDR_INV_DATE
      , SID.ATTR_CTNT3                AS LOCATION_CD
      , SID.ATTR_CTNT11               AS ACTIVITY_DATE
      , SID.ATTR_CTNT12               AS ACTIVITY_PLACE
      , SID.ATTR_CTNT14               AS SERVICE_LANE
      , SID.DTRB_DESC                 AS DTRB_DESC
      , NVL(SIH.GLO_ATTR_CTNT20, 'N') AS INTERFACE_FLAG
      , NVL((SELECT  NVL(IF_FLG, 'N') 
             FROM    GL_ESTM_IF_ERP GEIE 
             WHERE   GEIE.SYS_SRC_ID = 'SAP' AND GEIE.EXE_YRMON = TO_CHAR(SID.ACCTG_DT, 'YYYYMM') AND GEIE.WO_NO = SIH.INV_NO AND ROWNUM = 1), 'N')
                                      AS ACCRUAL_IF_FLAG
FROM    SAP_INV_HDR SIH
      , SAP_INV_DTL SID
      , SCO_LEGR_CD_CMB SLCC
      , SCO_LEGR_CD_CMB SLCC2
      , MDM_VENDOR MV
WHERE   SIH.INV_SEQ = SID.INV_SEQ
AND     TO_NUMBER(SIH.VNDR_NO) = MV.VNDR_SEQ 
AND     SIH.LIAB_CD_CMB_SEQ = SLCC.CD_CMB_SEQ
AND     SID.DTRB_CD_CMB_SEQ = SLCC2.CD_CMB_SEQ
AND     EXISTS (SELECT  'Y' 
                FROM    SCO_LU_HDR SLH, SCO_LU_DTL SLD 
                WHERE   SLH.LU_TP_CD = SLD.LU_TP_CD 
                AND     SLH.LU_TP_CD = 'AP ACCRUAL ACCOUNT' 
                AND     NVL(SLD.ENBL_FLG, 'Y') = 'Y'
                AND     NVL(SLD.LU_ST_DT, SYSDATE) >= SYSDATE 
                AND     SLH.LU_APPL_CD = 'SAP'
                AND     SLCC.SGM_CTNT4 = SLD.LU_CD)
AND    SIH.ATTR_CTNT12 IS NOT NULL 
AND    SIH.ATTR_CTNT15 = 'Y'
AND    SIH.INV_CXL_DT IS NULL
AND    SIH.INV_DT >= TO_DATE(@[inv_date_from], 'YYYY-MM-DD')   
AND    SIH.INV_DT < TO_DATE(@[inv_date_to], 'YYYY-MM-DD') + 1
AND    (SIH.OFC_CD = @[ofc_cd] OR SIH.OFC_CD IN (SELECT MO.AP_OFC_CD FROM MDM_ORGANIZATION MO WHERE MO.AP_CTRL_OFC_CD = @[ofc_cd] AND MO.AP_OFC_CD IS NOT NULL ) )
#if (${vndr_no} != '')
       AND   SIH.VNDR_NO = @[vndr_no]
#end
#if (${inv_no} != '')
       AND  SIH.INV_NO = @[inv_no]
#end
AND    NVL(SIH.GLO_ATTR_CTNT20, 'N') = @[accrual_if_flag]
ORDER  BY SIH.INV_NO, SID.DTRB_LINE_NO			]]></sql>
			<params>
				<param name="inv_date_from" type="12" value="" out="N"/>
				<param name="inv_date_to" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="vndr_no" type="12" value="" out="N"/>
				<param name="inv_no" type="12" value="" out="N"/>
				<param name="accrual_if_flag" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
