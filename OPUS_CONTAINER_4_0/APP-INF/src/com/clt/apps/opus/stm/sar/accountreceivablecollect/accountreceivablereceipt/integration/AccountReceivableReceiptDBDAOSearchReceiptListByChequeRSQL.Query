<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivableReceiptDBDAOSearchReceiptListByChequeRSQL">
			<desc><![CDATA[ReceiptListByCheque]]></desc>
			<sql><![CDATA[
SELECT 
       SR.CHQ_NO,
       SR.RCT_NO,       
       SR.ASA_NO,
       SR.RCT_OFC_CD,       
       SR.RCT_CUST_CNT_CD||'-'||LPAD(SR.RCT_CUST_SEQ, 6, '0') as  RCT_CUST_CD,
       NVL(MCC.LOCL_NM, MC.CUST_LGL_ENG_NM) as RCT_CUST_NM,
       SR.RCT_DT,
       SR.RCT_DPS_DT,
       SR.BANK_ACCT_SEQ, 
       SBA.BANK_ACCT_NM,
       SR.RCT_CXL_RSN_CD,
       SR.RCT_CXL_DT,
       SR.RCT_CURR_CD,
       SAR_GET_CUR_AMT_FNC(SR.RCT_CURR_CD, SR.RCT_AMT) 	as RCT_AMT,
       SR.RCT_TP_CD,
       SAR_GET_CUR_AMT_FNC(SR.RCT_CURR_CD, DECODE(SR.RCT_STS_CD, 'UNID', SR.BAL_RCT_AMT, 0)) 	as UNID_AMT,
       SAR_GET_CUR_AMT_FNC(SR.RCT_CURR_CD, DECODE(SR.RCT_STS_CD, 'UNAPP', SR.BAL_RCT_AMT, 0)) 	as UNAPP_AMT,
       SAR_GET_CUR_AMT_FNC(SR.RCT_CURR_CD, SR.BANK_CHG_AMT) 	as BANK_CHG_AMT,
      (SELECT SAR_GET_CUR_AMT_FNC(SR.RCT_CURR_CD, SUM(SRAD.RCT_APLY_AMT)) 
        FROM   SAR_RCT_APLY_HDR SRAH,
               SAR_RCT_APLY_DTL SRAD
        WHERE  SRAH.RCT_SEQ = SRAD.RCT_SEQ
        AND    SRAH.RCT_APLY_HDR_SEQ = SRAD.RCT_APLY_HDR_SEQ
        AND    SRAD.WRTF_CD = 'RFD'
        AND    SRAD.RCT_SEQ = SR.RCT_SEQ
        AND    SRAH.RVS_FLG = 'N')  as RFD_AMT,
       SR.RCT_RMK,
       SR.CRE_USR_ID, 
       CU.USR_NM,
       @[usr_ofc]  as USR_OFC
FROM   MDM_CUSTOMER MC,
       MDM_CR_CUST  MCC,
       COM_USER CU,
       MDM_ORGANIZATION MO,
       SAP_BANK_ACCT SBA,
       SAR_RECEIPT SR
WHERE  SR.BANK_ACCT_SEQ = SBA.BANK_ACCT_SEQ(+)
AND    SR.RCT_OFC_CD = MO.OFC_CD(+)
AND    SR.CRE_USR_ID = CU.USR_ID(+)
AND    SR.RCT_CUST_CNT_CD =MC.CUST_CNT_CD(+)
AND    SR.RCT_CUST_SEQ = MC.CUST_SEQ(+)
AND    SR.RCT_CUST_CNT_CD = MCC.CUST_CNT_CD(+)
AND    SR.RCT_CUST_SEQ = MCC.CUST_SEQ(+)
#if (${rct_ofc_cd} != '')
       AND    SR.RCT_OFC_CD in (${rct_ofc_cd}) 
#end   
#if (${rct_dt_tp_cd} == 'RECEIPT') 
AND    SR.RCT_DT >= NVL(REPLACE(@[rct_dt_fm], '-', ''), SR.RCT_DT) 
AND    SR.RCT_DT <= NVL(REPLACE(@[rct_dt_to], '-', ''), SR.RCT_DT)     
#end
#if (${rct_dt_tp_cd} == 'DEPOSIT')
AND    SR.RCT_DPS_DT >= NVL(REPLACE(@[rct_dt_fm], '-', ''), SR.RCT_DPS_DT)
AND    SR.RCT_DPS_DT <= NVL(REPLACE(@[rct_dt_to], '-', ''), SR.RCT_DPS_DT)     
#end          
AND    ( (@[rct_sts_cd] = 'ALL') OR
         (@[rct_sts_cd] = 'CANCEL' AND SR.RCT_CXL_DT IS NOT NULL ) OR
         (@[rct_sts_cd] = 'RECEIPT' AND SR.RCT_CXL_DT IS NULL )
       )
#if (${rct_unpay_sts_flg} == 'UNAPP')
    AND    SR.RCT_STS_CD IN ('UNAPP','UNID')
#end
#if (${rct_cust_cnt_cd} != '' )
    AND    SR.RCT_CUST_CNT_CD = @[rct_cust_cnt_cd]
#end
#if (${rct_cust_seq} != '') 
    AND    SR.RCT_CUST_SEQ = @[rct_cust_seq]
#end    
#if (${bank_acct_seq} != '')     
    AND    SR.BANK_ACCT_SEQ = @[bank_acct_seq] 
#end
#if (${rct_cxl_rsn_cd} != '')
    AND    SR.RCT_CXL_RSN_CD = @[rct_cxl_rsn_cd]
#end    
#if (${rct_usr_id} != '')
    AND    SR.CRE_USR_ID = @[rct_usr_id]
#end  
#if (${rct_tp_cd} != '')
    AND    SR.RCT_TP_CD = @[rct_tp_cd]
#end    
#if (${chq_no} != '')
    AND    SR.CHQ_NO = @[chq_no]
#end    
#if (${rct_no} != '')    
    AND    SR.RCT_NO = @[rct_no]
#end    
#if (${asa_no} != '')
    AND    SR.ASA_NO = @[asa_no]
#end			]]></sql>
			<params>
				<param name="usr_ofc" type="12" value="" out="N"/>
				<param name="rct_dt_fm" type="12" value="" out="N"/>
				<param name="rct_dt_to" type="12" value="" out="N"/>
				<param name="rct_sts_cd" type="12" value="" out="N"/>
				<param name="rct_cust_cnt_cd" type="12" value="" out="N"/>
				<param name="rct_cust_seq" type="12" value="" out="N"/>
				<param name="bank_acct_seq" type="12" value="" out="N"/>
				<param name="rct_cxl_rsn_cd" type="12" value="" out="N"/>
				<param name="rct_usr_id" type="12" value="" out="N"/>
				<param name="rct_tp_cd" type="12" value="" out="N"/>
				<param name="chq_no" type="12" value="" out="N"/>
				<param name="rct_no" type="12" value="" out="N"/>
				<param name="asa_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
