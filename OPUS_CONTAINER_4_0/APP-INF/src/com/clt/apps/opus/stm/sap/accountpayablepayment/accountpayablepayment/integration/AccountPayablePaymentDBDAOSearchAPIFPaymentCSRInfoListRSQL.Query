<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountPayablePaymentDBDAOSearchAPIFPaymentCSRInfoListRSQL">
			<desc><![CDATA[SearchAPIFPaymentCSRInfoList]]></desc>
			<sql><![CDATA[
SELECT  SIH.INV_SEQ                        AS INV_SEQ
      , SIH.INV_NO                         AS CSR_NO
      , SIH.INV_CURR_CD                    AS INV_CURR_CD
      , SIH.INV_PAY_CURR_CD                AS INV_PAY_CURR_CD
      , SIH.PAY_MZD_LU_CD                  AS PAY_MZD_LU_CD
      , MV.ENG_ADDR                        AS PAY_ADDR1
      , MV.LOCL_LANG_ADDR                  AS PAY_ADDR2
      , MV.LOC_CD                          AS AP_CTY_CD
      , MV.VNDR_CNT_CD                     AS AP_CNT_CD
      , 'NEGOTIABLE'                       AS PAY_STS_LU_CD
      , MV.VNDR_LGL_ENG_NM                 AS VNDR_NM
      , MV.ZIP_CD                          AS ZIP_CD
      , SIH.VNDR_NO                        AS VNDR_NO
      , DECODE(SIH.INV_PAY_CURR_CD, @[functional_currency], 1, NVL((SELECT  GDXR.CONV_XCH_RT 
                                                                    FROM    GL_DLY_XCH_RT GDXR 
                                                                    WHERE   GDXR.ACCT_XCH_RT_DT = @[pay_dt]
                                                                    AND     ACCT_XCH_RT_LVL = '1' 
                                                                    AND     FM_CURR_CD = SIH.INV_PAY_CURR_CD 
                                                                    AND     TO_CURR_CD = @[functional_currency]
                                                                    AND     GDXR.DELT_FLG <> 'Y' AND ROWNUM = 1), 1)) AS PAY_XCH_RT
      , @[pay_dt]                          AS PAY_XCH_DT
      , '1'                                AS XCH_RT_TP_CD
      , 1                                  AS PAY_BAT_RUN_SEQ
      , SPS.XTER_BANK_ACCT_SEQ             AS XTER_BANK_ACCT_SEQ
      , MV.VNDR_LGL_ENG_NM                 AS PAY_DESC
      , SIH.OFC_CD                         AS OFC_CD
      , TO_CHAR(TO_DATE(@[pay_dt],'YYYYMMDD'), 'YYYYMMDD') AS ACCTG_DT
      , SIH.INV_AMT                        AS PAY_AMT
      , SUBSTR(@[pay_dt], 1, 6)            AS EFF_YRMON
      , 'N'                                AS ACCTG_PST_FLG 
      , DECODE(SIH.INV_PAY_CURR_CD, @[functional_currency], SIH.INV_AMT,
               ROUND(SIH.INV_AMT * NVL((SELECT  GDXR.CONV_XCH_RT FROM GL_DLY_XCH_RT GDXR 
                                        WHERE   GDXR.ACCT_XCH_RT_DT = @[pay_dt]
                                        AND     ACCT_XCH_RT_LVL = '1' 
                                        AND     FM_CURR_CD = SIH.INV_PAY_CURR_CD 
                                        AND     TO_CURR_CD = @[functional_currency]
                                        AND     GDXR.DELT_FLG <> 'Y' AND ROWNUM = 1), 1), 
              (SELECT NVL(MC.DP_PRCS_KNT, 0) FROM MDM_CURRENCY MC WHERE MC.CURR_CD = @[functional_currency] AND ROWNUM = 1))) AS PAY_FUNC_AMT
      , SPS.PAY_SKD_NO                     AS PAY_SKD_NO
      , SIH.AP_INV_SRC_CD                  AS AP_INV_SRC_CD
      , SIH.LIAB_CD_CMB_SEQ                AS LIAB_CD_CMB_SEQ
      , SIH.ATTR_CTNT13                    AS ATTR_CTNT13 
      , SIH.AP_APSTS_CD                    AS AP_APSTS_CD 
      , 'SYSTEM'                           AS USR_ID
      , TO_CHAR(SYSDATE, 'YYYYMMDD')       AS SYS_TODAY 
      , NVL(SIH.PAY_STS_FLG, 'N')          AS INV_PAY_STS_FLG
      , NVL(SPS.PAY_STS_FLG, 'N')          AS PAY_STS_FLG
FROM    SAP_INV_HDR SIH
      , SAP_PAY_SKD SPS
      , MDM_VENDOR MV
WHERE   SIH.INV_SEQ = SPS.INV_SEQ 
AND     TO_NUMBER(SIH.VNDR_NO) = MV.VNDR_SEQ 
AND     SPS.PAY_SKD_NO = 1
AND     SIH.INV_NO = @[csr_no]
AND     SIH.INV_CXL_DT IS NULL
--AND     NVL(SPS.INV_HLD_FLG,'N') = 'N'
AND     SPS.PAY_BAT_RUN_SEQ IS NULL
			]]></sql>
			<params>
				<param name="functional_currency" type="12" value="" out="N"/>
				<param name="pay_dt" type="12" value="" out="N"/>
				<param name="csr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
