<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivableAdjustDBDAOSearchSarDtrbExchGainLossListRSQL">
			<desc><![CDATA[GET SAR DISTRIBUTION ( CASE 'EXCH_GAIN', 'EXCH_LOSS' )]]></desc>
			<sql><![CDATA[
SELECT
    DTRB_SRC_SEQ,
    DTRB_SRC_TBL_CD,
    DTRB_SRC_TP_CD,
    INP_DR_AMT,
    INP_CR_AMT,
    ACCT_DR_AMT,
    ACCT_CR_AMT,
    ORZ_SEQ,
    BL_CURR_CD,
    DECODE(MAX_CONV_XCH_RT, MIN_CONV_XCH_RT, 'RND', 'EXCH') CONV_XCH_RT_FLG,
    CUST_CNT_CD,
    CUST_SEQ,
    DIFF_FLG,
    GL_DTRB_SRC_TP_CD,
    GL_INP_DR_AMT,
    GL_INP_CR_AMT,
    GL_ACCT_DR_AMT,
    GL_ACCT_CR_AMT  
FROM
(
    SELECT
        DTRB_SRC_SEQ,
        DTRB_SRC_TBL_CD,
        CASE WHEN NVL(SUM(ACCT_DR_AMT),0) - NVL(SUM(ACCT_CR_AMT),0) < 0 THEN 'EXCH_LOSS'
             WHEN NVL(SUM(ACCT_DR_AMT),0) - NVL(SUM(ACCT_CR_AMT),0) > 0 THEN 'EXCH_GAIN'
        END AS DTRB_SRC_TP_CD,
        CASE WHEN NVL(SUM(ACCT_DR_AMT),0) - NVL(SUM(ACCT_CR_AMT),0) < 0 THEN 0
        END AS INP_DR_AMT,
        CASE WHEN NVL(SUM(ACCT_DR_AMT),0) - NVL(SUM(ACCT_CR_AMT),0) > 0 THEN 0
        END AS INP_CR_AMT,
        CASE WHEN NVL(SUM(ACCT_DR_AMT),0) - NVL(SUM(ACCT_CR_AMT),0) < 0 THEN ABS(NVL(SUM(ACCT_DR_AMT),0) - NVL(SUM(ACCT_CR_AMT),0))
        END AS ACCT_DR_AMT,
        CASE WHEN NVL(SUM(ACCT_DR_AMT),0) - NVL(SUM(ACCT_CR_AMT),0) > 0 THEN ABS(NVL(SUM(ACCT_DR_AMT),0) - NVL(SUM(ACCT_CR_AMT),0))
        END AS ACCT_CR_AMT,
        ORZ_SEQ,
        CURR_CD AS BL_CURR_CD,
        MAX(CONV_XCH_RT) MAX_CONV_XCH_RT,
        MIN(CONV_XCH_RT) MIN_CONV_XCH_RT,
        CUST_CNT_CD,
        CUST_SEQ,
        SIGN(NVL(SUM(ACCT_DR_AMT),0) - NVL(SUM(ACCT_CR_AMT),0)) DIFF_FLG,
		CASE WHEN NVL(SUM(GL_ACCT_DR_AMT),0) - NVL(SUM(GL_ACCT_CR_AMT),0) < 0 THEN 'EXCH_LOSS'
             WHEN NVL(SUM(GL_ACCT_DR_AMT),0) - NVL(SUM(GL_ACCT_CR_AMT),0) > 0 THEN 'EXCH_GAIN'
             ELSE ''
        END AS GL_DTRB_SRC_TP_CD,
        CASE WHEN NVL(SUM(GL_ACCT_DR_AMT),0) - NVL(SUM(GL_ACCT_CR_AMT),0) < 0 THEN 0
        END AS GL_INP_DR_AMT,
        CASE WHEN NVL(SUM(GL_ACCT_DR_AMT),0) - NVL(SUM(GL_ACCT_CR_AMT),0) > 0 THEN 0
        END AS GL_INP_CR_AMT,
        CASE WHEN NVL(SUM(GL_ACCT_DR_AMT),0) - NVL(SUM(GL_ACCT_CR_AMT),0) < 0 THEN ABS(NVL(SUM(GL_ACCT_DR_AMT),0) - NVL(SUM(GL_ACCT_CR_AMT),0))
        END AS GL_ACCT_DR_AMT,
        CASE WHEN NVL(SUM(GL_ACCT_DR_AMT),0) - NVL(SUM(GL_ACCT_CR_AMT),0) > 0 THEN ABS(NVL(SUM(GL_ACCT_DR_AMT),0) - NVL(SUM(GL_ACCT_CR_AMT),0))
        END AS GL_ACCT_CR_AMT
    FROM
        SAR_CLT_DTRB
    WHERE DTRB_SRC_SEQ = @[adj_his_seq]
	AND   DTRB_SRC_TBL_CD = 'ADJ'
    GROUP BY
        DTRB_SRC_SEQ,
        DTRB_SRC_TBL_CD,
        ORZ_SEQ,
        CURR_CD,
        CUST_CNT_CD,
        CUST_SEQ
)			]]></sql>
			<params>
				<param name="adj_his_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
