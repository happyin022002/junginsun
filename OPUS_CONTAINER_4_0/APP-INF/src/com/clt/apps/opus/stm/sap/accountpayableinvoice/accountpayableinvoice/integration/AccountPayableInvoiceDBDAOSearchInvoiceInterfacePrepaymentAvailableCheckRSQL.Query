<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountPayableInvoiceDBDAOSearchInvoiceInterfacePrepaymentAvailableCheckRSQL">
			<desc><![CDATA[AccountPayableInvoiceDBDAOSearchInvoiceInterfacePrepaymentAvailableCheckRSQL]]></desc>
			<sql><![CDATA[
SELECT  PREPAY_INV_NO  AS PREPAY_INVOICE_NUMBER
   FROM    (SELECT  SIH.INV_SEQ              AS INV_SEQ
                  , SID.DTRB_LINE_NO         AS PREPAY_LINE_NUM
                  , (SELECT  SUM(NVL(SID2.PPAY_RMN_AMT, SID2.DTRB_AMT)) FROM SAP_INV_DTL SID2 WHERE SID2.INV_SEQ = SID.INV_SEQ AND SID2.DTRB_LINE_NO = SID.DTRB_LINE_NO
                     AND     SID2.LINE_TP_LU_CD IN ('ITEM', 'ACCRUAL', 'REC_TAX', 'NONREC_TAX' ) AND NVL(SID2.RVS_FLG, 'N') <> 'Y') AS PREPAY_AMOUNT_REMAINING
                  , SID.DTRB_AMT             AS LINE_AMOUNT
                  , SID.ACCTG_DT             AS ACCOUNTING_DATE
                  , SID.EFF_YRMON            AS PERIOD_NAME
                  , SID.DTRB_DESC            AS LINE_DESC
                  , SIH.INV_NO               AS PREPAY_INV_NO
                  , SIH.INV_DT               AS INV_DT
                  , SIH.INV_CURR_CD          AS INV_CURR_CD
                  , SIH.INV_PAY_CURR_CD      AS INV_PAY_CURR_CD
                  , SIH.VNDR_NO              AS VENDOR_NO
                  , MV.VNDR_LGL_ENG_NM       AS VENDOR_NAME
                  , SIH.ERY_STL_DT           AS ERY_STL_DT
            FROM    SAP_INV_HDR SIH
                  , SAP_INV_DTL SID
                  , MDM_VENDOR MV
            WHERE   SIH.INV_SEQ = SID.INV_SEQ
            AND     TO_NUMBER(SIH.VNDR_NO) = MV.VNDR_SEQ 
            AND     SIH.INV_TP_LU_CD = 'PREPAYMENT'
            AND     SID.LINE_TP_LU_CD = 'ITEM'
            AND     SIH.PAY_STS_FLG = 'Y'
            AND     SIH.ERY_STL_DT <= SYSDATE
            AND     (SELECT  SUM(NVL(SID2.PPAY_RMN_AMT, SID2.DTRB_AMT)) FROM SAP_INV_DTL SID2 WHERE SID2.INV_SEQ = SID.INV_SEQ AND SID2.DTRB_LINE_NO = SID.DTRB_LINE_NO
                     AND     SID2.LINE_TP_LU_CD IN ('ITEM', 'ACCRUAL', 'REC_TAX', 'NONREC_TAX' ) AND NVL(SID2.RVS_FLG, 'N') <> 'Y') > 0
            AND     NVL(SID.RVS_FLG, 'N') <> 'Y')
   WHERE   PREPAY_INV_NO =  @[ppay_inv_no]
   AND     PREPAY_LINE_NUM = @[ppay_inv_line_no]
   AND     PREPAY_AMOUNT_REMAINING >= @[ppay_aply_amt]			]]></sql>
			<params>
				<param name="ppay_inv_no" type="12" value="" out="N"/>
				<param name="ppay_inv_line_no" type="12" value="" out="N"/>
				<param name="ppay_aply_amt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
