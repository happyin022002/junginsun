<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivalbeAgentDBDAOsearchASAInquiryListRSQL">
			<desc><![CDATA[Agent Statement of Account Inquiry]]></desc>
			<sql><![CDATA[
SELECT   DECODE(GROUPING_ID(SAM.ASA_NO),0, SAM.ASA_NO,'TOTAL') ASA_NO
, SAM.CURR_CD
, DECODE(GROUPING_ID(SAM.ASA_NO),0,MAX(TO_CHAR(TO_DATE(SAM.ASA_PRD_FM_DT,'YYYYMMDD'),'YYYY-MM-DD')))   BIL_CRE_PRD_FM_DT
, DECODE(GROUPING_ID(SAM.ASA_NO),0,MAX(TO_CHAR(TO_DATE(SAM.ASA_PRD_TO_DT,'YYYYMMDD'),'YYYY-MM-DD')))  BIL_CRE_PRD_TO_DT
, DECODE(GROUPING_ID(SAM.ASA_NO),0,SUM(ROUND(SAD.PREV_BAL_AMT, 2)),'') PREV_BAL_AMT
, SUM(ROUND(SAD.REV_RFD_AMT, 2))  REV_RFD_AMT
, SUM(ROUND(SAD.EXPENSE_AMT, 2))  EXPENSE_AMT
, SUM(ROUND(SAD.COMM_AMT, 2))     COMM_AMT
, SUM(ROUND(SAD.RMTC_AMT, 2)) RMTC_AMT
, DECODE(GROUPING_ID(SAM.ASA_NO),0,SUM(ROUND(SAD.LAST_BAL_AMT, 2)),'') LAST_BAL_AMT  
, SUM(ROUND(SAM.ACT_BAL_AMT, 2)) ACTUAL_BAL_AMT
, SUM(ROUND(SAD.UNSET_BAL_AMT, 2)) UNSET_BAL_AMT
, DECODE(GROUPING_ID(SAM.ASA_NO),0,MAX(TO_CHAR(SAM.ASA_FSH_DT,'YYYY-MM-DD')))  AGN_ASA_CRE_DT
, DECODE(GROUPING_ID(SAM.ASA_NO),0,MAX(TO_CHAR(SAM.ASA_APRO_DT,'YYYY-MM-DD HH24:MI:SS'))) APRO_DT
, DECODE(GROUPING_ID(SAM.ASA_NO),0,MAX(SAM.OFC_CD))      OFC_CD
, DECODE(GROUPING_ID(SAM.ASA_NO),0,MAX(SAM.AGN_CD))      AGN_CD
, DECODE(GROUPING_ID(SAM.ASA_NO),0,MAX(SAM.ASA_STS_CD))  ASA_STS_CD

,'' AR_OFC_CD
,'' ASA_NO3_FM
,'' ASA_NO3_TO
,'' APPRO
FROM SAR_ASA_MST SAM
,(
SELECT ASA_NO,
       SUM(PREV_BAL_AMT) PREV_BAL_AMT,
       SUM(REV_RFD_AMT) REV_RFD_AMT,
       SUM(EXPENSE_AMT) EXPENSE_AMT,
       SUM(COMM_AMT) COMM_AMT,
       SUM(RMTC_AMT) RMTC_AMT,
       SUM(LAST_BAL_AMT) LAST_BAL_AMT,
       SUM(ACTUAL_BAL_AMT) ACTUAL_BAL_AMT,
       SUM(UNSET_BAL_AMT) UNSET_BAL_AMT
FROM (
SELECT ASA_NO,
       NVL(ASA_CR_AMT, 0)-NVL(ASA_DR_AMT, 0) PREV_BAL_AMT,
       0 REV_RFD_AMT,
       0 EXPENSE_AMT,
       0 COMM_AMT,
       0 RMTC_AMT,
       0 LAST_BAL_AMT,
       0 ACTUAL_BAL_AMT,
      (SELECT SUM(ROUND(SOD.BAL_AMT, 2)) AS BAL_AMT
        FROM SAR_OTS_HDR SOH, 
             SAR_OTS_DTL SOD
        WHERE SOH.RHQ_CD            = SOD.RHQ_CD  
        AND SOH.OTS_OFC_CD          = SOD.OTS_OFC_CD
        AND SOH.BL_NO               = SOD.BL_NO 
        AND SOH.INV_NO              = SOD.INV_NO 
        AND SOH.BL_NO = ASA_NO) AS UNSET_BAL_AMT
FROM   SAR_ASA_DTL
WHERE  ASA_DTL_SEQ = 1
UNION ALL
SELECT ASA_NO,
       0 PREV_BAL_AMT,
       ASA_CR_AMT rev_fnd ,
       0 EXPENSE_AMT,
       0 COMM_AMT,
       0 RMTC_AMT,
       0 LAST_BAL_AMT,
       0 ACTUAL_BAL_AMT,
       0 UNSET_BAL_AMT
FROM   SAR_ASA_DTL
WHERE  ASA_DTL_SEQ = 2
UNION ALL
SELECT ASA_NO,
       0 PREV_BAL_AMT,
       (-1)*ASA_DR_AMT REV_RFD_AMT,
       0 EXPENSE_AMT,
       0 COMM_AMT,
       0 RMTC_AMT,
       0 LAST_BAL_AMT,
       0 ACTUAL_BAL_AMT,
       0 UNSET_BAL_AMT
FROM   SAR_ASA_DTL
WHERE  ASA_DTL_SEQ = 3
UNION ALL
SELECT ASA_NO,
       0 PREV_BAL_AMT,
       0 REV_RFD_AMT,
       NVL(ASA_DR_AMT, 0)-NVL(ASA_CR_AMT, 0) EXPENSE_AMT,
       0 COMM_AMT,
       0 RMTC_AMT,
       0 LAST_BAL_AMT,
       0 ACTUAL_BAL_AMT,
       0 UNSET_BAL_AMT
FROM   SAR_ASA_DTL
WHERE  ASA_DTL_SEQ = 4
UNION ALL
SELECT ASA_NO,
       0 PREV_BAL_AMT,
       0 REV_RFD_AMT,
       0 EXPENSE_AMT,
       NVL(ASA_DR_AMT, 0)-NVL(ASA_CR_AMT, 0) COMM_AMT,
       0 RMTC_AMT,
       0 LAST_BAL_AMT,
       0 ACTUAL_BAL_AMT,
       0 UNSET_BAL_AMT
FROM   SAR_ASA_DTL
WHERE  ASA_DTL_SEQ = 5
UNION ALL
SELECT ASA_NO,
       0 PREV_BAL_AMT,
       0 REV_RFD_AMT,
       0 EXPENSE_AMT,
       0 COMM_AMT,
       NVL(ASA_DR_AMT, 0)-NVL(ASA_CR_AMT, 0) RMTC_AMT,
       0 LAST_BAL_AMT,
       0 ACTUAL_BAL_AMT,
       0 UNSET_BAL_AMT
FROM   SAR_ASA_DTL
WHERE  ASA_DTL_SEQ = 6
UNION ALL
SELECT ASA_NO,
       0 PREV_BAL_AMT,
       0 REV_RFD_AMT,
       0 EXPENSE_AMT,
       0 COMM_AMT,
       0 RMTC_AMT,
       NVL(ASA_DR_AMT, 0)-NVL(ASA_CR_AMT, 0) LAST_BAL_AMT,
       0 ACTUAL_BAL_AMT,
       0 UNSET_BAL_AMTbal
FROM   SAR_ASA_DTL
WHERE  ASA_DTL_SEQ = 7
) GROUP BY ASA_NO
) SAD
WHERE 1 = 1
AND SAM.ASA_NO = SAD.ASA_NO
AND SAM.OFC_CD   = @[ar_ofc_cd]

#if ( ${bil_cre_prd_fm_dt} != '' )
   AND SUBSTR(SAM.ASA_PRD_FM_DT,1,6) >=  REPLACE(@[bil_cre_prd_fm_dt],'-','')       
#end  

#if ( ${bil_cre_prd_to_dt} != '' )
   AND SUBSTR(SAM.ASA_PRD_TO_DT,1,6) <=  REPLACE(@[bil_cre_prd_to_dt],'-','')       
#end  

#if ( ${appro} == 'N' )
   AND SAM.ASA_STS_CD IN ('O', 'F') 
#elseif ( ${appro} == 'A' )     
   AND SAM.ASA_STS_CD IN ('A') 
#end  

#if ( ${asa_no3_fm} != '' && ${asa_no3_to} != '' ) 
   AND TO_NUMBER(SUBSTR(SAM.ASA_NO, 7, 4)) BETWEEN TO_NUMBER(@[asa_no3_fm]) AND TO_NUMBER(@[asa_no3_to])
#end

GROUP by ROLLUP(SAM.ASA_NO), SAM.CURR_CD			]]></sql>
			<params>
				<param name="ar_ofc_cd" type="12" value="" out="N"/>
				<param name="bil_cre_prd_fm_dt" type="12" value="" out="N"/>
				<param name="bil_cre_prd_to_dt" type="12" value="" out="N"/>
				<param name="asa_no3_fm" type="12" value="" out="N"/>
				<param name="asa_no3_to" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
