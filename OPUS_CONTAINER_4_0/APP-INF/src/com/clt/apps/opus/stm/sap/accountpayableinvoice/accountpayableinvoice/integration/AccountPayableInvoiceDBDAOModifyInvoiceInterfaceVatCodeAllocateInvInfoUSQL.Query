<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountPayableInvoiceDBDAOModifyInvoiceInterfaceVatCodeAllocateInvInfoUSQL">
			<desc><![CDATA[Front 에서 Interface되는 비용 전표중 국내 부가세를 갖는 경우에 한해서 해당 Vendor Invoice No을 갖는 비용에 Tax Code을 맵핑 처리]]></desc>
			<sql><![CDATA[
UPDATE  SAP_INV_DTL SID1
SET     SID1.DTRB_VAT_CD = (WITH RESULT_VAT AS (SELECT  SID.DTRB_AMT
                                                      , SID.INV_DTRB_SEQ
                                                      , SID.ATTR_CTNT1 AS VNDR_INV_NO
                                                      , SID.INV_SEQ
                                                      , SID.DTRB_VAT_CD
                                                FROM    SAP_INV_DTL SID
                                                      , SCO_LEGR_CD_CMB SLCC
                                                WHERE   SID.INV_SEQ = @[inv_seq]
                                                AND     SID.LINE_TP_LU_CD = 'TAX'
                                                AND     NVL(SID.RVS_FLG, 'N') = 'N'
                                                AND     SID.DTRB_AMT <> 0
                                                AND     SID.DTRB_CD_CMB_SEQ = SLCC.CD_CMB_SEQ 
                                                AND     SLCC.SGM_CTNT4 IN (SELECT  SLD.LU_CD FROM SCO_LU_HDR SLH, SCO_LU_DTL SLD 
                                                                           WHERE   SLH.LU_TP_CD = SLD.LU_TP_CD AND SLH.LU_TP_CD = 'AP TAX ACCOUNT' AND NVL(SLD.ENBL_FLG, 'Y') = 'Y'
                                                                           AND     NVL(SLD.LU_ST_DT, SYSDATE) >= SYSDATE AND SLH.LU_APPL_CD = 'SAP'AND SLD.ATTR_CTNT1 = 'INTERNAL'))
                              SELECT  RESULT_VAT.DTRB_VAT_CD
                              FROM    RESULT_VAT
                              WHERE   RESULT_VAT.INV_SEQ = SID1.INV_SEQ
                              AND     RESULT_VAT.VNDR_INV_NO = SID1.ATTR_CTNT1)
WHERE   SID1.INV_SEQ = @[inv_seq]
AND     SID1.DTRB_AMT <> 0
AND     SID1.DTRB_VAT_CD IS NULL 
AND     SID1.LINE_TP_LU_CD = 'ITEM'
AND     NOT EXISTS (SELECT  'A' FROM SAP_INV_DTL SID2, SCO_LEGR_CD_CMB SLCC
                    WHERE   SID2.INV_DTRB_SEQ = SID1.INV_DTRB_SEQ
                    AND     NVL(SID2.RVS_FLG, 'N') = 'N'
                    AND     SID2.DTRB_AMT <> 0
                    AND     SID2.DTRB_CD_CMB_SEQ = SLCC.CD_CMB_SEQ 
                    AND     SLCC.SGM_CTNT4 IN (SELECT  SLD.LU_CD FROM SCO_LU_HDR SLH, SCO_LU_DTL SLD 
                                               WHERE   SLH.LU_TP_CD = SLD.LU_TP_CD AND SLH.LU_TP_CD = 'AP TAX ACCOUNT' AND NVL(SLD.ENBL_FLG, 'Y') = 'Y'
                                               AND     NVL(SLD.LU_ST_DT, SYSDATE) >= SYSDATE AND SLH.LU_APPL_CD = 'SAP'AND SLD.ATTR_CTNT1 = 'WITHHOLDING'))			]]></sql>
			<params>
				<param name="inv_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
