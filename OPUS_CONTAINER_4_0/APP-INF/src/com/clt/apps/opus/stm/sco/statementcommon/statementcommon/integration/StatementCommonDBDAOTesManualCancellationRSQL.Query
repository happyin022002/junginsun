<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="StatementCommonDBDAOTesManualCancellationRSQL">
			<desc><![CDATA[Select TesManualCancellation]]></desc>
			<sql><![CDATA[
SELECT  VVD         VVD
      , YARD        YARD_CODE
      , TO_CHAR(ACT_DT, 'YYYY-MM') 	ACT_DT
      , VNDR        VENDOR_CODE
      , CST         COST_CODE
      , SUM(ESTM_QTY) ESTM_QTY
      , SUM(ESTM_AMT) ESTM_AMT
      , SUM(ACT_QTY)  ACT_QTY
      , SUM(ACT_AMT)  ACT_AMT
      , SUM(ACCL_QTY) ACCL_QTY
      , SUM(ACCL_AMT) ACCL_AMT
      , MAX(CXL_FLG)  CANCEL_FLAG
      , MIN(REV_YRMON) AS REV_YRMON
      , MIN(ACCT_CD) AS  ACCT_CD
      , MIN(ACCL_SEQ) AS ACCL_SEQ
FROM    (
        SELECT  VSL_CD || SKD_VOY_NO || SKD_DIR_CD || REV_DIR_CD AS VVD 
              , NOD_CD                  AS  YARD
              , VNDR_NO                 AS  VNDR
              , COA_COST_SRC_CD         AS  CST
              , ESTM_QTY                AS  ESTM_QTY
              , ESTM_COST_AMT           AS  ESTM_AMT
              , ACT_QTY                 AS  ACT_QTY
              , ACT_COST_AMT            AS  ACT_AMT
              , ACCL_QTY                AS  ACCL_QTY
              , ACCL_COST_AMT           AS  ACCL_AMT
              , CXL_FLG                 AS  CXL_FLG
              , ACT_DT                  AS  ACT_DT
              , UPD_DT                  AS  UPD_DT
              --, ROW_NUMBER() OVER (PARTITION BY VSL_CD,SKD_VOY_NO,SKD_DIR_CD,REV_DIR_CD,NOD_CD ORDER BY UPD_DT DESC) ROW_SEQ
              , REV_YRMON               AS  REV_YRMON
              , ACCT_CD                 AS  ACCT_CD
              , ACCL_SEQ                AS  ACCL_SEQ
        FROM    SAC_TML_ACCL_COST_IF    ACCL
        WHERE   ACCL.EXE_YRMON = @[exe_month]
        AND     ACCL.SYS_SRC_ID = 'TES'
        AND     NVL(CXL_FLG, 'N') = @[cancel_flg]
#if (${vvd} != '')
        AND     VSL_CD || SKD_VOY_NO || SKD_DIR_CD || REV_DIR_CD LIKE @[vvd]|| '%'  
#end
#if (${yd_cd} != '')
        AND     NOD_CD LIKE @[yd_cd] || '%'  
#end
        ) TML_ACCL
GROUP   BY VVD, YARD, VNDR, CST, TO_CHAR(ACT_DT, 'YYYY-MM')
ORDER   BY VVD, YARD, ACT_DT, VNDR, CST			]]></sql>
			<params>
				<param name="exe_month" type="12" value="" out="N"/>
				<param name="cancel_flg" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
