<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivableAgentDBDAOSearchAsaUsdTtlAmtRSQL">
			<desc><![CDATA[ASA Collect & Refund USD Total Amount By ASA_NO]]></desc>
			<sql><![CDATA[
SELECT NVL(SUM(NVL(ACF.USD_AMT, 0) + ROUND(NVL(ACF.LOCL_AMT, 0) * NVL(SAR_GET_GL_XCH_RT_FNC('1',GLX.MAX_XCH_DT,ACF.LOCL_CURR_CD,'USD'),0),2)
                                   + ROUND(NVL(ACF.N3RD_AMT1, 0) * NVL(SAR_GET_GL_XCH_RT_FNC('1',GLX.MAX_XCH_DT,ACF.N3RD_CURR_CD1,'USD'),0),2)
                                   + ROUND(NVL(ACF.N3RD_AMT2, 0) * NVL(SAR_GET_GL_XCH_RT_FNC('1',GLX.MAX_XCH_DT,ACF.N3RD_CURR_CD2,'USD'),0),2)
                                   + ROUND(NVL(ACF.N3RD_AMT3, 0) * NVL(SAR_GET_GL_XCH_RT_FNC('1',GLX.MAX_XCH_DT,ACF.N3RD_CURR_CD3,'USD'),0),2)
                                   + ROUND(NVL(ACF.N3RD_AMT4, 0) * NVL(SAR_GET_GL_XCH_RT_FNC('1',GLX.MAX_XCH_DT,ACF.N3RD_CURR_CD4,'USD'),0),2)),0) ASA_USD_AMT
          FROM   SAR_AGN_CLT_RFND_MST ACF
               , SAR_OTS_HDR   SOH
			   , (SELECT MAX(ACCT_XCH_RT_DT) MAX_XCH_DT
                  FROM    GL_DLY_XCH_RT
                  WHERE   ACCT_XCH_RT_LVL = '1') GLX
        WHERE 1=1
          AND    ACF.ASA_NO      = @[asa_no]
          AND    ACF.BL_NO       = SOH.BL_NO
		  AND    ACF.INV_NO      = SOH.INV_NO
          AND    ACF.AR_OFC_CD   = SOH.OTS_OFC_CD
          AND    SOH.OTS_TP_CD IS NULL			]]></sql>
			<params>
				<param name="asa_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
