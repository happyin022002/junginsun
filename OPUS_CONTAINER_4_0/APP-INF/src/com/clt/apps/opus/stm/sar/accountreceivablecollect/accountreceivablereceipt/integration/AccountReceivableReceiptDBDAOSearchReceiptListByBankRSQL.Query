<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivableReceiptDBDAOSearchReceiptListByBankRSQL">
			<desc><![CDATA[ReceiptListByBank]]></desc>
			<sql><![CDATA[
SELECT RCT_OFC_CD,
       BANK_ACCT_NM,
       RCT_CURR_CD,
       SAR_GET_CUR_AMT_FNC(RCT_CURR_CD, SUM(RCT_AMT)) RCT_AMT,
       SAR_GET_CUR_AMT_FNC(RCT_CURR_CD, SUM(RCT_UNA_AMT)) UNA_AMT,
       SAR_GET_CUR_AMT_FNC(RCT_CURR_CD, SUM(RCT_UNI_AMT)) UNI_AMT,
       SAR_GET_CUR_AMT_FNC(RCT_CURR_CD, SUM(RCT_CXL_AMT)) BOU_AMT,
       SAR_GET_CUR_AMT_FNC(RCT_CURR_CD, SUM(RFD_AMT)) 	REF_AMT
FROM  (       
       SELECT SR.RCT_OFC_CD,
    		SBA.BANK_ACCT_NM,
              SR.RCT_NO,
              SR.RCT_DT,
              SR.RCT_DPS_DT,
              SR.RCT_CURR_CD,
              SR.RCT_AMT,
			  DECODE(SR.RCT_STS_CD, 'UNAPP', SR.BAL_RCT_AMT, 0) RCT_UNA_AMT,
			  DECODE(SR.RCT_STS_CD, 'UNID', SR.BAL_RCT_AMT, 0) RCT_UNI_AMT,
              DECODE(SR.RCT_CXL_DT, NULL, 0, SR.RCT_AMT) RCT_CXL_AMT,
              (SELECT SUM(RCT_APLY_AMT)
			   FROM SAR_RCT_APLY_DTL
			   WHERE RCT_SEQ = SR.RCT_SEQ
			   AND WRTF_CD = 'RFD') RFD_AMT
       FROM   SAR_RECEIPT SR,
              SAP_BANK_ACCT SBA,
              SCO_OFC_INFO SO
       WHERE  SR.BANK_ACCT_SEQ = SBA.BANK_ACCT_SEQ
       AND    SR.RCT_OFC_CD = SO.OFC_CD
       AND    SR.CRE_USR_ID = NVL(@[rct_usr_id], SR.CRE_USR_ID)
#if (${rct_dt_tp_cd} == 'RECEIPT') 
       AND    SR.RCT_DT >= NVL(REPLACE(@[rct_dt_fm], '-', ''), SR.RCT_DT) 
       AND    SR.RCT_DT <= NVL(REPLACE(@[rct_dt_to], '-', ''), SR.RCT_DT)     
#end
#if (${rct_dt_tp_cd} == 'DEPOSIT')
       AND    SR.RCT_DPS_DT >= NVL(REPLACE(@[rct_dt_fm], '-', ''), SR.RCT_DPS_DT)
       AND    SR.RCT_DPS_DT <= NVL(REPLACE(@[rct_dt_to], '-', ''), SR.RCT_DPS_DT) 
#end
      AND    SR.BANK_ACCT_SEQ = NVL(@[bank_acct_seq], SR.BANK_ACCT_SEQ)
       AND    SR.RCT_TP_CD = NVL(@[rct_tp_cd], SR.RCT_TP_CD)
       AND    ( (@[rct_sts_cd] = 'ALL') OR
                (@[rct_sts_cd] = 'CANCEL' AND SR.RCT_CXL_DT IS NOT NULL ) OR
                (@[rct_sts_cd] = 'RECEIPT' AND SR.RCT_CXL_DT IS NULL )
              )
       AND    SR.RCT_CURR_CD = NVL(@[rct_curr_cd], SR.RCT_CURR_CD)
#if (${rct_ofc_cd} != '')
       AND    SR.RCT_OFC_CD in ( ${rct_ofc_cd} ) 
#end    
      )
GROUP BY
       RCT_OFC_CD,
       BANK_ACCT_NM,
       RCT_CURR_CD			]]></sql>
			<params>
				<param name="rct_usr_id" type="12" value="" out="N"/>
				<param name="rct_dt_fm" type="12" value="" out="N"/>
				<param name="rct_dt_to" type="12" value="" out="N"/>
				<param name="bank_acct_seq" type="12" value="" out="N"/>
				<param name="rct_tp_cd" type="12" value="" out="N"/>
				<param name="rct_sts_cd" type="12" value="" out="N"/>
				<param name="rct_curr_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
