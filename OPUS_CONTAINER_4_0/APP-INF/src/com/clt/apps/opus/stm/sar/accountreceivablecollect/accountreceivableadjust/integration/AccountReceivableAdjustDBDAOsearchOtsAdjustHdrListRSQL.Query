<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivableAdjustDBDAOsearchOtsAdjustHdrListRSQL">
			<desc><![CDATA[Retrieve Outstanding Adjustment ]]></desc>
			<sql><![CDATA[
SELECT DISTINCT A.BL_NO
       , A.BKG_NO
       , A.INV_NO
       , B.INV_OFC_CD
       , A.BIL_TO_CUST_CNT_CD||'-'||LPAD(A.BIL_TO_CUST_SEQ, 6, '0') AS BIL_TO_CUST_CD 
       , A.VSL_CD||A.SKD_VOY_NO||A.DIR_CD AS LOCL_VVD_CD
	   , A.RHQ_CD
       , A.BIL_TO_CUST_CNT_CD
       , A.BIL_TO_CUST_SEQ
	   , A.RHQ_CD||B.INV_OFC_CD||A.BL_NO||A.INV_NO AS OTS_HDR_KEY
	   , A.SHP_TO_CUST_CNT_CD||'-'||LPAD(A.SHP_TO_CUST_SEQ, 6, '0') AS SHP_BIL_TO_CUST_CD
	   , A.TRNK_VVD_CD
       , A.SAIL_ARR_DT
       , DECODE(A.BKG_IO_BND_CD, 'O', 'O/B', 'I/B') AS IO_BND_CD
       , A.DUE_DT
       , A.CUST_SREP_CD AS SREP_CD
       , A.OTS_RMK
	   , A.XCH_RT_TP_CD
       , A.XCH_RT_DT
       , A.CR_MK_FLG AS CR_FLG
       , A.OTS_SRC_CD AS AR_FINC_SRC_CD
       , A.MAX_AR_IF_NO
FROM SAR_OTS_HDR A, 
     SAR_OTS_HIS B
WHERE A.RHQ_CD = B.RHQ_CD  
AND A.OTS_OFC_CD = B.OTS_OFC_CD   
AND A.BL_NO = B.BL_NO 
AND A.INV_NO = B.INV_NO 
AND A.RHQ_CD = @[rhq_cd]
#if(${ots_cd} == 'COU') 
    AND A.OTS_OFC_CD = @[rep_ots_ofc_cd]  
#else 
    AND A.OTS_OFC_CD = @[adjt_ofc_cd]
#end  
#if(${bl_no} != '')   
    AND A.BL_NO = @[bl_no]  
#end
#if(${ots_smry_cd} == 'INV')
    #if(${inv_no} != '')  
        AND A.INV_NO = @[inv_no] 
    #else  
        AND A.INV_NO <> '**********' 
    #end 
#else 
    #if(${inv_no} != '') 
        AND A.INV_NO = @[inv_no]
    #else 
        AND A.INV_NO = '**********'
    #end 
#end 
AND B.OTS_HIS_TP_CD = 'OTS' 
AND A.STL_FLG = 'N'
AND EXISTS (SELECT 'X'
       		FROM SAR_OTS_HIS P,
            	 SAR_OTS_CHG Q
       		WHERE P.OTS_HIS_SEQ = Q.OTS_HIS_SEQ
       		AND P.RHQ_CD = B.RHQ_CD
       		AND P.INV_OFC_CD = B.INV_OFC_CD
       		AND P.BL_NO = B.BL_NO
       		AND P.INV_NO = B.INV_NO
       		GROUP BY P.RHQ_CD
         			, P.INV_OFC_CD
       	 			, P.BL_NO
         			, P.INV_NO
         			, Q.CHG_TP_CD
         			, Q.BL_CURR_CD
       		HAVING SUM(Q.BAL_AMT) != 0)
ORDER BY B.INV_OFC_CD			]]></sql>
			<params>
				<param name="rhq_cd" type="12" value="" out="N"/>
				<param name="rep_ots_ofc_cd" type="12" value="" out="N"/>
				<param name="adjt_ofc_cd" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="inv_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
