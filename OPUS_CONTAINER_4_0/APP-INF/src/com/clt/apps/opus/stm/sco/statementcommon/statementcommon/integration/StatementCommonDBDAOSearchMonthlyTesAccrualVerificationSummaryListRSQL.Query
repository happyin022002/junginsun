<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="StatementCommonDBDAOSearchMonthlyTesAccrualVerificationSummaryListRSQL">
			<desc><![CDATA[Summary List]]></desc>
			<sql><![CDATA[
SELECT @[mdl_tp_cd] AS MDL_TP_CD
     , REPLACE(@[accl_yrmon], '-', '') AS ACCL_YRMON
     , TRGT.ACT_MONTH AS ACT_YRMON
     , NVL(SUM(ACCL.ACCL_ESTM_USD)  , 0) AS ACCL_ESTM_USD
     , NVL(SUM(ACCL.ACCL_ACT_USD)   , 0) AS ACCL_ACT_USD
     , NVL(SUM(ACCL.ACCL_ACCL_USD)  , 0) AS ACCL_ACCL_USD
     , NVL(SUM(TRGT.TRGT_ESTM_USD)  , 0) AS TRGT_ESTM_USD
     , NVL(SUM(TRGT.TRGT_ACT_USD)   , 0) AS TRGT_ACT_USD
     , NVL(SUM(TRGT.TRGT_ACCL_USD)  , 0) AS TRGT_ACCL_USD
  FROM (
        SELECT SUBSTR(ACCL_T.ACT_DT,1,6) AS ACT_MONTH
             , ACCL_T.ACCT_CD AS ACCT_CD
             , NVL(ACCL_T.TRD_CD, 'NON_TRD') AS TRD_CD
             , ACCL_T.LOCL_CURR_CD AS LOCL_CURR_CD
             , ROUND(SUM(NVL(ACCL_T.ESTM_AMT    ,0) * FM_RT.CONV_XCH_RT/TO_RT.CONV_XCH_RT),2) AS ACCL_ESTM_USD
             , ROUND(SUM(NVL(ACCL_T.ACT_AMT     ,0) * FM_RT.CONV_XCH_RT/TO_RT.CONV_XCH_RT),2) AS ACCL_ACT_USD
             , ROUND(SUM(NVL(ACCL_T.ACCL_AMT    ,0) * FM_RT.CONV_XCH_RT/TO_RT.CONV_XCH_RT),2) AS ACCL_ACCL_USD
          FROM SAC_COST_ACCL_INFO   ACCL_T
             , SAC_DLY_XCH_RT       FM_RT
             , SAC_DLY_XCH_RT       TO_RT
         WHERE ACCL_T.EXE_YRMON         = REPLACE(@[accl_yrmon], '-', '')
           AND ACCL_T.SYS_SRC_ID        = @[mdl_tp_cd] -- TES OR TRS
           AND NVL(ACCL_T.ACCL_FLG,'Y') = 'Y'
           AND FM_RT.ACCT_XCH_RT_LVL    = '1'
           AND FM_RT.FM_CURR_CD         = ACCL_T.LOCL_CURR_CD
           AND FM_RT.ACCT_XCH_RT_DT     = ACCL_T.ACT_DT
           AND TO_RT.ACCT_XCH_RT_DT     = ACCL_T.ACT_DT
           AND TO_RT.ACCT_XCH_RT_LVL    = '1'
           AND TO_RT.FM_CURR_CD         = @[locl_curr_cd]
#if( ${trd_cd} !='')
           AND NVL(ACCL_T.TRD_CD, 'NON_TRD')        = @[trd_cd] -- Trade
#end
#if( ${acct_cd} !='')
           AND ACCL_T.ACCT_CD           = @[acct_cd] -- Account
#end
         GROUP BY SUBSTR(ACCL_T.ACT_DT,1,6)
             , ACCL_T.ACCT_CD
             , NVL(ACCL_T.TRD_CD, 'NON_TRD')
             , ACCL_T.LOCL_CURR_CD
       ) ACCL
     , (
        SELECT SUBSTR(TO_CHAR(TRGT.ACT_DT,'YYYYMMDD'),1,6) AS ACT_MONTH
             , TRGT.ACCT_CD AS ACCT_CD
             , NVL(TRGT.TRD_CD, 'NON_TRD') AS TRD_CD
             , TRGT.LOCL_CURR_CD AS LOCL_CURR_CD
             , ROUND(SUM(NVL(TRGT.ESTM_COST_AMT ,0)  * FM_RT.CONV_XCH_RT/TO_RT.CONV_XCH_RT),2) AS TRGT_ESTM_USD
             , ROUND(SUM(NVL(TRGT.ACT_COST_AMT  ,0)  * FM_RT.CONV_XCH_RT/TO_RT.CONV_XCH_RT),2) AS TRGT_ACT_USD
             , ROUND(SUM(NVL(TRGT.ACCL_COST_AMT ,0)  * FM_RT.CONV_XCH_RT/TO_RT.CONV_XCH_RT),2) AS TRGT_ACCL_USD
          FROM SAC_TML_ACCL_COST_IF TRGT
             , SAC_DLY_XCH_RT       FM_RT
             , SAC_DLY_XCH_RT       TO_RT
         WHERE TRGT.EXE_YRMON           = REPLACE(@[accl_yrmon], '-', '')
           AND NVL(TRGT.CXL_FLG, 'N')   = 'N'
           AND FM_RT.ACCT_XCH_RT_LVL    = '1'
           AND FM_RT.FM_CURR_CD         = TRGT.LOCL_CURR_CD
           AND FM_RT.ACCT_XCH_RT_DT     = SUBSTR(TO_CHAR(TRGT.ACT_DT,'YYYYMMDD'),1,8)
           AND TO_RT.ACCT_XCH_RT_DT     = SUBSTR(TO_CHAR(TRGT.ACT_DT,'YYYYMMDD'),1,8)
           AND TO_RT.ACCT_XCH_RT_LVL    = '1'
           AND TO_RT.FM_CURR_CD         = @[locl_curr_cd]
#if( ${trd_cd} !='')
           AND NVL(TRGT.TRD_CD, 'NON_TRD') = @[trd_cd] -- Trade
#end
#if( ${acct_cd} !='')
           AND TRGT.ACCT_CD             = @[acct_cd] -- Account
#end
         GROUP BY SUBSTR(TO_CHAR(TRGT.ACT_DT,'YYYYMMDD'),1,6)
             , TRGT.ACCT_CD
             , NVL(TRGT.TRD_CD, 'NON_TRD')
             , TRGT.LOCL_CURR_CD     
       ) TRGT
 WHERE 1=1  
   AND ACCL.ACT_MONTH       (+)= TRGT.ACT_MONTH    
   AND ACCL.ACCT_CD         (+)= TRGT.ACCT_CD      
   AND ACCL.TRD_CD          (+)= TRGT.TRD_CD       
   AND ACCL.LOCL_CURR_CD    (+)= TRGT.LOCL_CURR_CD 
 GROUP BY TRGT.ACT_MONTH
 ORDER BY TRGT.ACT_MONTH			]]></sql>
			<params>
				<param name="mdl_tp_cd" type="12" value="" out="N"/>
				<param name="accl_yrmon" type="12" value="" out="N"/>
				<param name="locl_curr_cd" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="acct_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
