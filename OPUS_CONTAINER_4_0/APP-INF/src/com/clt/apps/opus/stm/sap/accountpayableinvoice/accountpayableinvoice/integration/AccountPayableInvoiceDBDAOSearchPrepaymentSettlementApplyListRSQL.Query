<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountPayableInvoiceDBDAOSearchPrepaymentSettlementApplyListRSQL">
			<desc><![CDATA[searchPrepaymentSettlementApplyList]]></desc>
			<sql><![CDATA[
SELECT APPLY_V.ROW_ID
      ,APPLY_V.INV_SEQ
      ,APPLY_V.INV_NO
      ,APPLY_V.VNDR_NO
      ,APPLY_V.VNDR_LGL_ENG_NM
      ,APPLY_V.INV_CURR_CD
      ,APPLY_V.INV_PAY_CURR_CD
      ,APPLY_V.INV_DT
      ,APPLY_V.PAY_CROSS_RATE_DT
      ,APPLY_V.INV_DESC
      ,TRIM(SAP_GET_CUR_AMT_FNC(APPLY_V.INV_PAY_CURR_CD,  APPLY_V.AMOUNT_UNPAID)) AMOUNT_UNPAID
      ,TRIM(SAP_GET_CUR_AMT_FNC(APPLY_V.INV_PAY_CURR_CD,  APPLY_V.TAX_UNPAID)) TAX_UNPAID
      ,0  AS AMOUNT_APPLY
      ,'' AS APPLY_GL_DATE
	  ,'0' AS APPLY
FROM   OPUSADM.SAP_APPLY_PREPAYS_FR_PREPAY_V APPLY_V
WHERE  1 = 1
AND    EXISTS (SELECT 'Y' FROM SAP_PAY_SKD SPS WHERE SPS.INV_HLD_FLG = 'Y' AND SPS.INV_SEQ = APPLY_V.INV_SEQ)
AND    APPLY_V.INV_SEQ IN (SELECT  SIH.INV_SEQ
                           FROM    SAP_INV_HDR SIH
                                 , SCO_LEGR_CD_CMB SLCC 
                           WHERE   SIH.LIAB_CD_CMB_SEQ = SLCC.CD_CMB_SEQ
                           AND     SIH.INV_TP_LU_CD = 'STANDARD'
                           AND     SIH.INV_SEQ = APPLY_V.INV_SEQ
                           AND     SLCC.SGM_CTNT2 = (SELECT  SLCC2.SGM_CTNT2
                                                     FROM    SCO_LEGR_CD_CMB SLCC2
                                                     WHERE   SLCC2.CD_CMB_SEQ = @[liab_cd_cmb_seq]))
AND    APPLY_V.VNDR_NO = @[vndr_no]
AND    APPLY_V.INV_CURR_CD = @[inv_curr_cd]
ORDER  BY APPLY_V.INV_NO			]]></sql>
			<params>
				<param name="liab_cd_cmb_seq" type="12" value="" out="N"/>
				<param name="vndr_no" type="12" value="" out="N"/>
				<param name="inv_curr_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
