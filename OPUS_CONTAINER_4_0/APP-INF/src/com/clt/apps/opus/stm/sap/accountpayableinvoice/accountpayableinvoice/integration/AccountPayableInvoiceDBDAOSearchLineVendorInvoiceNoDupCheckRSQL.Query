<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountPayableInvoiceDBDAOSearchLineVendorInvoiceNoDupCheckRSQL">
			<desc><![CDATA[Input된 Header의 증빙 Type이 "Invoices" 이면, Line의 DFF 항목중 Vendor Invoice No 값은 중복으로 작성을 할 수 없는 Validation을 체크 한다. (동일 전표에서는 상관 없음)]]></desc>
			<sql><![CDATA[
SELECT 'E' AS VALUE1
      ,'Duplicated Of Supplier Invoice No :' || VENDOR_INVOICE_NO || ' [' || INVOICE_NUM || ']' AS VALUE2
FROM   (SELECT SID.ATTR_CTNT1    AS VENDOR_INVOICE_NO
             , SIH.INV_NO        AS INVOICE_NUM
        FROM   SAP_INV_DTL SID
             , SAP_INV_HDR SIH
        WHERE  SID.INV_SEQ = SIH.INV_SEQ
        AND    SIH.VNDR_NO = (SELECT  MV.VNDR_SEQ
                              FROM    MDM_VENDOR MV
                              WHERE   MV.VNDR_SEQ = @[vendor_no]  
                              AND     ROWNUM = 1)
        AND    SIH.INV_NO <> NVL(@[inv_no], 'xxx')   
        AND    SIH.INV_TP_LU_CD = 'STANDARD'
        AND    SIH.ATTR_CATE_NM = 'INVOICES'
        AND    SIH.INV_CXL_DT IS NULL 
        UNION  ALL
        SELECT INV_NO_V.INV_NO   AS VENDOR_INVOICE_NO
             , NVL(INV_NO_V.CSR_NO, INV_NO_V.REF_PK) AS INVOICE_NUM
        FROM   AP_INV_NO_CHK_V INV_NO_V 
        WHERE  -- INV_NO_V.INV_NO = UPPER('JO_TPB_TEST')   AND  
               INV_NO_V.VNDR_SEQ = @[vendor_no]  
        AND    INV_NO_V.MDL_CD <> 'SAP'
        AND    NVL(INV_NO_V.CSR_NO, 'yyy') <> NVL(@[inv_no], 'xxx') 
        ) DUP_VENDOR_INVOICE
WHERE  VENDOR_INVOICE_NO = UPPER(@[vendor_invoice_no])  
AND    ROWNUM = 1			]]></sql>
			<params>
				<param name="vendor_no" type="12" value="" out="N"/>
				<param name="inv_no" type="12" value="" out="N"/>
				<param name="vendor_invoice_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
