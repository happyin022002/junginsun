<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountPayableInvoiceDBDAOSearchInvoiceApprovalListRSQL">
			<desc><![CDATA[CSR Approval List - Retrieve]]></desc>
			<sql><![CDATA[
SELECT  SIH.OFC_CD                  AS OFC_CD
      , SIH.INV_NO                  AS INV_NO
      , SIH.INV_SEQ                 AS INV_SEQ
      , SIH.VNDR_NO                 AS VNDR_NO
      , MV.VNDR_LGL_ENG_NM          AS VNDR_LGL_ENG_NM
      , SIH.GL_DT                   AS GL_DT
      , SIH.INV_DT                  AS INV_DT
      , SIH.CRE_DT                  AS CTE_DT
      , SIH.ATTR_CTNT12             AS PROCESSING_FLAG
      , SIH.ATTR_CTNT15             AS APPROVAL_FLAG
      , SIH.INV_CURR_CD             AS INV_CURR_CD
      , TRIM(OPUSADM.SAP_GET_CUR_AMT_FNC(SIH.INV_CURR_CD, SIH.INV_AMT)) AS INV_AMT
      , SIH.ATTR_CATE_NM            AS ATTR_CATE_NM
      , CU.USR_NM                   AS USR_NM
      , SIH.INV_DESC                AS INV_DESC
      , SIH.CRE_USR_ID              AS CRE_USR_ID
      , SIH.UPD_USR_ID              AS UPD_USR_ID
      , SIH.AP_INV_SRC_CD           AS AP_INV_SRC_CD
      , SPS.DUE_DT                  AS DUE_DATE
FROM    SAP_INV_HDR SIH
      , MDM_VENDOR MV
      , COM_USER CU
      , MDM_ORGANIZATION MO
      , SAP_PAY_SKD SPS
WHERE   1 = 1
AND     SIH.VNDR_NO = TO_CHAR(MV.VNDR_SEQ)
AND     SIH.CRE_USR_ID = CU.USR_ID
AND     SIH.OFC_CD = MO.OFC_CD 
AND     SIH.INV_SEQ IS NOT NULL
AND     SPS.INV_SEQ = SIH.INV_SEQ
AND     SPS.ROWID = (SELECT MAX(SPS2.ROWID) FROM SAP_PAY_SKD SPS2 WHERE SPS2.INV_SEQ = SIH.INV_SEQ)
AND     NVL(SPS.INV_HLD_FLG, 'N') <> 'Y'
AND     (SIH.ATTR_CTNT15 <> 'Y' OR SIH.ATTR_CTNT15 IS NULL)
AND     SIH.ATTR_CTNT12 IS NOT NULL
AND     SIH.AP_APSTS_CD <> 'MANUALLY APPROVED'
AND     SIH.INV_CXL_DT IS NULL
AND     EXISTS (SELECT 'A' FROM SAP_INV_DTL SID WHERE SIH.INV_SEQ = SID.INV_SEQ AND SID.MTCH_STS_FLG = 'A')
AND     SIH.OFC_CD = @[ofc_cd]
AND     SIH.CRE_DT < TO_DATE(@[cre_dt], 'YYYY-MM-DD') + 1
#if (${vndr_no} != '') 
AND     SIH.VNDR_NO = @[vndr_no]
#end
#if (${inv_no} != '') 
AND     SIH.INV_NO = @[inv_no]
#end			]]></sql>
			<params>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="cre_dt" type="12" value="" out="N"/>
				<param name="vndr_no" type="12" value="" out="N"/>
				<param name="inv_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
