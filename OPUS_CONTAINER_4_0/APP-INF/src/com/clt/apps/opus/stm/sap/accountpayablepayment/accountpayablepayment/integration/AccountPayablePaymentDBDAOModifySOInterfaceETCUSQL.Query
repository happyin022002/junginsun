<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountPayablePaymentDBDAOModifySOInterfaceETCUSQL">
			<desc><![CDATA[ModifySOInterfaceETC]]></desc>
			<sql><![CDATA[
--UPDATE AP_PAY_INV 
--SET AP_PAY_DT = to_date(?, 'YYYY-MM-DD HH24:MI:SS'), AP_PAY_AMT = ?, AP_PAY_FLG = 'Y', INV_STS_CD = 'D' 
--WHERE CSR_NO = ?
UPDATE  AP_PAY_INV  A
SET (A.AP_PAY_AMT, A.AP_PAY_DT, A.INV_STS_CD, A.AP_PAY_FLG)
    = (
       SELECT SUM(SPD.PAY_AMT) AS PAY_AMT
             ,TO_CHAR(MAX(SPH.PAY_DT),'YYYYMMDD') PAY_DT
             ,@[status]
             ,'Y'
       FROM  SAP_INV_HDR SIH
            ,SAP_PAY_HDR SPH 
            ,SAP_PAY_DTL SPD
       WHERE SPH.PAY_SEQ = SPD.PAY_SEQ
       AND   SIH.INV_SEQ = SPD.INV_SEQ
       AND   SIH.INV_NO = A.CSR_NO
       GROUP BY SIH.INV_NO, SIH.PAY_MZD_LU_CD
      ) 
   ,EAI_EVNT_DT = SYSDATE
WHERE   A.CSR_NO = @[csr_no]
AND EXISTS  (
              SELECT 'Y'
              FROM  SAP_INV_HDR SIH
              WHERE 1=1
              AND SIH.INV_NO = A.CSR_NO              
            )			]]></sql>
			<params>
				<param name="status" type="12" value="" out="N"/>
				<param name="csr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
