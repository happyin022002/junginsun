<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivableOutstandingDBDAOAROustandingbySADateVORSQL">
			<desc><![CDATA[Outstanding inquiry search]]></desc>
			<sql><![CDATA[
#if ( ${summary_yn} == 'S')
    SELECT 
       SOH.RHQ_CD       		RHQ_CD,  
       SOH.OTS_OFC_CD   		OTS_OFC_CD, 

	#if ( ${kind_3} == 'CUSTOMER')
       SOH.BIL_TO_CUST_CNT_CD||LPAD(SOH.BIL_TO_CUST_SEQ,6, '0') CUST_CD,
       MC.CUST_LGL_ENG_NM   	CUST_NM,
       MCC.CR_CURR_CD       	CREDIT_CURR_CD,           
       MCC.CR_AMT   	        CREDIT_LIMIT,
       MCC.OB_CR_TERM_DYS   	OB_TERM,  
       MCC.IB_CR_TERM_DYS   	IB_TERM,
       MCC.CR_FLG   	        CREDIT_FLG, 
       
	#elseif ( ${kind_3} == 'VVD')
		SOH.VSL_CD||SOH.SKD_VOY_NO ||SOH.DIR_CD 		VVD ,	
    #elseif ( ${kind_3} == 'SALESREP')
		SOH.CUST_SREP_CD								SALE_REP_CD,
    #elseif ( ${kind_3} == 'SA_DATE')
		TO_CHAR(TO_DATE(SOH.SAIL_ARR_DT,'YYYY-MM-DD'),'YYYY-MM-DD')      SAIL_ARR_DT,
	#elseif ( ${kind_3} == 'HJSREF')
		SOH.BKG_REF_NO       							REF_NO,
	#elseif ( ${kind_3} == 'APAR_OFFSET')
		SOH.AP_AR_OFFST_NO   							AP_AR_OFFST_NO, 
	#end

       SUM(DECODE (SOD.BL_CURR_CD, 'USD', 1, 0*NULL) * NVL (SOD.BAL_AMT, 0) USD,
       --''                       EX_RATE, 
       SUM(DECODE (SOD.BL_CURR_CD, 'USD', 1, 0*NULL) * NVL (SOD.BAL_LOCL_AMT, 0) USD_EQV_LCL,         
       SUM(SOD.BAL_LOCL_AMT ) 	TOT_LCL,
       SUM(SOD.BAL_USD_AMT  )	TOT_USD,
       SUM(SOD.BAL_AMT) BAL_AMT
#else

SELECT SOH.RHQ_CD       										RHQ_CD,  
       SOH.OTS_OFC_CD   										OTS_OFC_CD, 
       SOH.BL_NO        										BL_NO,
       SOH.BKG_NO      	 										BKG_NO,
       SOH.INV_NO       										INV_NO,  
       SOD.CHG_TP_CD       										CHG_TP_CD,  
       SOH.BIL_TO_CUST_CNT_CD||LPAD(SOH.BIL_TO_CUST_SEQ,6, '0') CUST_CD,
       MC.CUST_LGL_ENG_NM   									CUST_NM,
       MCC.CR_CURR_CD       									CREDIT_CURR_CD,           
       MCC.CR_AMT           									CREDIT_LIMIT,
       MCC.OB_CR_TERM_DYS   									OB_TERM,  
       MCC.IB_CR_TERM_DYS   									IB_TERM,
       MCC.CR_FLG           									CREDIT_FLG, 
       SOH.VSL_CD||SOH.SKD_VOY_NO ||SOH.DIR_CD 					VVD , 
       SOH.LANE_CD          									LANE_CD, 
       SOH.BKG_IO_BND_CD    									BND, 
       TO_CHAR(TO_DATE(SOH.SAIL_ARR_DT,'YYYY-MM-DD'),'YYYY-MM-DD')      SAIL_ARR_DT, 
       SOH.POR_CD           									POR_CD, 
       SOH.POL_CD           									POL_CD, 
       SOH.POD_CD           									POD_CD, 
       SOH.DEL_CD           									DEL_CD, 
       TO_CHAR(TO_DATE(SOH.INV_DT,'YYYY-MM-DD'),'YYYY-MM-DD')   INV_DT, 
       SOH.SVC_SCP_CD       									SVC_SCP_CD, 
       SOH.CUST_SREP_CD     									SALE_REP_CD,
       SOH.BKG_REF_NO       									REF_NO, 
       TO_CHAR(TO_DATE(SOH.DUE_DT,'YYYY-MM-DD'),'YYYY-MM-DD')   DUE_DT, 
       TO_DATE(replace(@[sail_arr_dt],'-',''), 'YYYYMMDD') - TO_DATE(SOH.DUE_DT,'YYYYMMDD') AS OVER_DUE,
       SOH.OTS_GRP_TP_CD    									OTS_GRP_TP_CD, 
       SOH.OTS_TP_CD        									OTS_TP_CD, 
       SOH.SC_NO            									SC_NO, 
       SOH.OTS_RMK          									RMK, 
       SOH.OTS_SRC_CD       									KIND2,
       SOH.AP_AR_OFFST_NO   									AP_AR_OFFST_NO, 
       DECODE (SOD.BL_CURR_CD, 'USD', 1, 0*NULL) * NVL (SOD.BAL_AMT, 0) USD,
       DECODE (SOD.BL_CURR_CD, 'USD', 1, 0*NULL) * SOD.LOCL_XCH_RT      EX_RATE, 
       DECODE (SOD.BL_CURR_CD, 'USD', 1, 0*NULL) * NVL (SOD.BAL_LOCL_AMT, 0) USD_EQV_LCL,         
       SOD.BAL_LOCL_AMT  			TOT_LCL,
       SOD.BAL_USD_AMT   				TOT_USD ,
       SOD.BAL_AMT
#end
     
FROM SAR_OTS_HDR SOH, 
     SAR_OTS_DTL SOD, 
     MDM_CUSTOMER MC, 
     MDM_CR_CUST MCC
WHERE SOH.RHQ_CD            = SOD.RHQ_CD  
AND SOH.OTS_OFC_CD          = SOD.OTS_OFC_CD
AND SOH.BL_NO               = SOD.BL_NO 
AND SOH.INV_NO              = SOD.INV_NO  
AND SOH.BIL_TO_CUST_CNT_CD  = MC.CUST_CNT_CD
AND SOH.BIL_TO_CUST_SEQ     = MC.CUST_SEQ  
AND MC.CUST_CNT_CD          = MCC.CUST_CNT_CD  (+)
AND MC.CUST_SEQ             = MCC.CUST_SEQ  (+)
AND SOH.RHQ_CD              = @[rhq]
AND SOH.OTS_OFC_CD           = @[ofc_cd]
AND SOH.SAIL_ARR_DT        <= replace(@[sail_arr_dt],'-','')

#if (${kind2_radio} == 'ALL')
  AND NVL(SOH.OTS_SRC_CD, 'NISAR') IN ('NISAR', 'OTHER', 'STM AR', '3RD',  'BMS', 'STM AP', 'JO', 'CDAM')
#end 

#if (${kind2_radio} != 'ALL')
  AND SOH.OTS_SRC_CD LIKE @[kind2_radio]
#end 

#if ( ${bnd} != 'ALL')
   AND SOH.BKG_IO_BND_CD = @[bnd]
#else
   AND SOH.BKG_IO_BND_CD IN ('I','O')
#end 

#if ( ${overdue_from} != '')
	AND    TO_DATE(replace(@[sail_arr_dt],'-',''), 'YYYYMMDD') - TO_DATE(SOH.DUE_DT,'YYYYMMDD')  >= @[overdue_from]
#end 

#if ( ${overdue_to} != '')
	AND    TO_DATE(replace(@[sail_arr_dt],'-',''), 'YYYYMMDD') - TO_DATE(SOH.DUE_DT,'YYYYMMDD')  <= @[overdue_to]
#end 

#if ( ${svc_scp_cd} != '')
   AND SOH.SVC_SCP_CD LIKE @[svc_scp_cd]||'%'
#end 

#if ( ${port} != '')
    #if ( ${bnd} == 'I')
        AND SOH.POD_CD LIKE @[port]||'%'
    #elseif ( ${bnd} == 'O')
        AND SOH.POL_CD LIKE @[port]||'%'
    #else
        AND ( SOH.POD_CD LIKE @[port]||'%' OR SOH.POL_CD LIKE @[port]||'%' )
    #end 
#end

#if ( ${credit_flg} != 'ALL')
   AND NVL(MCC.CR_FLG,'N') = @[credit_flg]
#end

#if ( ${rate_yn} != 'ALL')
   AND NVL(SOH.OTS_RT_FLG,'Y') = @[rate_yn]
#end

#if ( ${bl_inv} == 'B')
   AND SOH.INV_NO	= '**********'
#end

#if ( ${bl_inv} == 'I')
   AND SOH.INV_NO	<> '**********'
#end

#if (  ${ots_grp_tp_cd} != '' and ${ots_grp_tp_cd} != 'ALL' )
   AND SOH.OTS_GRP_TP_CD = @[ots_grp_tp_cd]
#end

#if (  ${ots_tp_cd} != '' and ${ots_tp_cd} != 'ALL')
   AND SOH.OTS_TP_CD = @[ots_tp_cd]
#end

#if ( ${kind_3} == 'CUSTOMER')
   #if ( ${kind3_code} != '')
   		AND SOH.BIL_TO_CUST_CNT_CD||LPAD(SOH.BIL_TO_CUST_SEQ,6, '0') = @[kind3_code]
   #end
#end

#if ( ${kind_3} == 'VVD')
   #if ( ${kind3_code} != '')
   		AND SOH.VSL_CD||SOH.SKD_VOY_NO ||SOH.DIR_CD = @[kind3_code]
   #end
#end

#if ( ${kind_3} == 'SALESREP')
   #if ( ${kind3_code} != '')
   		AND SOH.CUST_SREP_CD = @[kind3_code]
   #end
#end

#if ( ${kind_3} == 'HJSREF')
   #if ( ${kind3_code} != '')
   		AND SOH.BKG_REF_NO = @[kind3_code]
   #end
#end

#if ( ${kind_3} == 'APAR_OFFSET')
   #if ( ${kind3_code} != '')
   		AND SOH.AP_AR_OFFST_NO = @[kind3_code]
   #end
#end

#if ( ${kind_3} == 'SA_DATE')
   #if ( ${sail_arr_dt_fm} != '')
   		AND SOH.SAIL_ARR_DT        >= REPLACE(@[sail_arr_dt_fm],'-','')
   #end
   #if ( ${sail_arr_dt_to} != '')
   		AND SOH.SAIL_ARR_DT        <= REPLACE(@[sail_arr_dt_to],'-','')
   #end
#end

#if ( ${kind_3} == 'SCNO')
   #if ( ${kind3_code} != '')
   		AND SOH.SC_NO LIKE  @[kind3_code]||'%'
   #else
		AND SOH.SC_NO IS NOT NULL
   #end
#end


#if ( ${ots_opy} == 'OTS')
   	AND SOD.BAL_USD_AMT > 0
#elseif ( ${ots_opy} == 'OPY')
   	AND SOD.BAL_USD_AMT < 0
#end



#if ( ${summary_yn} == 'S')
	GROUP BY SOH.RHQ_CD , SOH.OTS_OFC_CD ,

	#if ( ${kind_3} == 'CUSTOMER')
		SOH.BIL_TO_CUST_CNT_CD||LPAD(SOH.BIL_TO_CUST_SEQ,6, '0') , MC.CUST_LGL_ENG_NM , MCC.CR_CURR_CD , MCC.CR_AMT ,  MCC.OB_CR_TERM_DYS , MCC.IB_CR_TERM_DYS , MCC.CR_FLG    
	#elseif ( ${kind_3} == 'VVD')
        SOH.VSL_CD||SOH.SKD_VOY_NO ||SOH.DIR_CD 
	#elseif ( ${kind_3} == 'SALESREP')
		SOH.CUST_SREP_CD
	#elseif ( ${kind_3} == 'SA_DATE')
    	TO_CHAR(TO_DATE(SOH.SAIL_ARR_DT,'YYYY-MM-DD'),'YYYY-MM-DD')
    #elseif ( ${kind_3} == 'HJSREF')
		SOH.BKG_REF_NO
	#elseif ( ${kind_3} == 'APAR_OFFSET')
		SOH.AP_AR_OFFST_NO
	#elseif ( ${kind_3} == 'SCNO')
        'x'
    #end
	 
#end

#if ( ${summary_yn} == 'S')
	ORDER BY SOH.RHQ_CD , SOH.OTS_OFC_CD ,

	#if ( ${kind_3} == 'CUSTOMER')
		SOH.BIL_TO_CUST_CNT_CD||LPAD(SOH.BIL_TO_CUST_SEQ,6, '0') , MC.CUST_LGL_ENG_NM , MCC.CR_CURR_CD , MCC.CR_AMT ,  MCC.OB_CR_TERM_DYS , MCC.IB_CR_TERM_DYS , MCC.CR_FLG    
	#elseif ( ${kind_3} == 'VVD')
        SOH.VSL_CD||SOH.SKD_VOY_NO ||SOH.DIR_CD 
	#elseif ( ${kind_3} == 'SALESREP')
		SOH.CUST_SREP_CD
	#elseif ( ${kind_3} == 'SA_DATE')
    	TO_CHAR(TO_DATE(SOH.SAIL_ARR_DT,'YYYY-MM-DD'),'YYYY-MM-DD')
    #elseif ( ${kind_3} == 'HJSREF')
		SOH.BKG_REF_NO
	#elseif ( ${kind_3} == 'APAR_OFFSET')
		SOH.AP_AR_OFFST_NO
	#elseif ( ${kind_3} == 'SCNO')
        'x'
    #end
#else
	ORDER BY SOH.RHQ_CD , SOH.OTS_OFC_CD, SOH.BL_NO, SOH.INV_NO 
#end					]]></sql>
			<params>
				<param name="sail_arr_dt" type="12" value="" out="N"/>
				<param name="rhq" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="kind2_radio" type="12" value="" out="N"/>
				<param name="bnd" type="12" value="" out="N"/>
				<param name="overdue_from" type="12" value="" out="N"/>
				<param name="overdue_to" type="12" value="" out="N"/>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="port" type="12" value="" out="N"/>
				<param name="credit_flg" type="12" value="" out="N"/>
				<param name="rate_yn" type="12" value="" out="N"/>
				<param name="ots_grp_tp_cd" type="12" value="" out="N"/>
				<param name="ots_tp_cd" type="12" value="" out="N"/>
				<param name="kind3_code" type="12" value="" out="N"/>
				<param name="sail_arr_dt_fm" type="12" value="" out="N"/>
				<param name="sail_arr_dt_to" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
