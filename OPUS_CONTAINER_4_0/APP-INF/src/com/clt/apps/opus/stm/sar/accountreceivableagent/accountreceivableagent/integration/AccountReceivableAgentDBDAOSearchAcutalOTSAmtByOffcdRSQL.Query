<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivableAgentDBDAOSearchAcutalOTSAmtByOffcdRSQL">
			<desc><![CDATA[Search OTS Amount By Offce code]]></desc>
			<sql><![CDATA[
SELECT NVL(SUM(ROUND(NVL(SOD.BAL_AMT,0) * NVL(SAR_GET_GL_XCH_RT_FNC('1',GLX.MAX_XCH_DT,SOD.BL_CURR_CD,'USD'),0),2)),0) AS OTS_USD_AMT            
  FROM   SAR_OTS_HDR   SOH 
       , SAR_OTS_DTL   SOD
	   , (SELECT MAX(ACCT_XCH_RT_DT) MAX_XCH_DT
          FROM    GL_DLY_XCH_RT
          WHERE   ACCT_XCH_RT_LVL = '1') GLX
  WHERE 1=1
  AND SOH.RHQ_CD              = SOD.RHQ_CD
  AND SOH.OTS_OFC_CD          = SOD.OTS_OFC_CD
  AND SOH.BL_NO               = SOD.BL_NO 
  AND SOH.INV_NO              = SOD.INV_NO
  AND SOH.OTS_TP_CD IS NULL
  AND SOH.REV_TP_SRC_CD != 'ASA'
  AND SOH.OTS_OFC_CD          = @[ots_ofc_cd] 
  AND SOH.DUE_DT <=  REPLACE(@[asa_prd_to_dt],'-','')     -- period_to			]]></sql>
			<params>
				<param name="ots_ofc_cd" type="12" value="" out="N"/>
				<param name="asa_prd_to_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
