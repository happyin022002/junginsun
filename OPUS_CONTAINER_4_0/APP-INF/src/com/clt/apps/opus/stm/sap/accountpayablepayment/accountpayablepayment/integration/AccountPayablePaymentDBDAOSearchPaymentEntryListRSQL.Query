<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountPayablePaymentDBDAOSearchPaymentEntryListRSQL">
			<desc><![CDATA[AccountPayablePaymentDBDAOsearchPaymentEntryListRSQL]]></desc>
			<sql><![CDATA[
SELECT
    PAY_SEQ,
    PAY_TP_CD,
    BANK_ACCT_NM,
    PAY_DT,
    OFC_CD,
    VNDR_NM,
    VNDR_NO,
    PAY_AMT,    
    REMIT_TO_ACCT_NO,
    CURR_CD,
    DOC_SEQ,
    PAY_BAT_NM,
    PAY_MZD_LU_CD,
    PAY_STE_NM,
    PAY_XCH_DT,
    XCH_RT_TP_CD,
    PAY_XCH_RT,
    PAY_CNT_CD,
    PAY_ADDR1,
    TRIM(OPUSADM.SAP_GET_CUR_AMT_FNC(PAY_FUNC_CURR_CD, PAY_FUNC_AMT)) AS PAY_FUNC_AMT,
    BANK_ACCT_SEQ,
    XTER_BANK_ACCT_SEQ,
	BANK_ACCT_NO,
    PAY_CURR_PRCS,
    PERIOD_CHK,
	'' AS FR_DT,
	'' AS TO_DT,
	'' AS VNDR_PAY_GRP_CD,
	'' AS USR_ID,
	'' AS CHK_FLG,
	'' AS PAY_NO
    ,(SELECT SUM(DECODE(ACCTG_PST_FLG, 'Y', 1, 0 )) FROM SAP_PAY_DTL D WHERE D.PAY_SEQ = A.PAY_SEQ ) AS CNT_ACCTG_PST_FLG_Y
    ,PAY_STS_LU_CD
FROM (
    SELECT SPH.PAY_SEQ,
           DECODE(SPH.PAY_TP_CD,'B','Batch','M','Manual') AS PAY_TP_CD,
           SPH.BANK_ACCT_NM,
           TO_CHAR(SPH.PAY_DT, 'YYYYMMDD') AS PAY_DT,
           SPH.OFC_CD,
           SPH.VNDR_NM,
           SPH.VNDR_NO,
           TRIM(OPUSADM.SAP_GET_CUR_AMT_FNC(SPH.CURR_CD, SPH.PAY_AMT)) AS PAY_AMT,    
           SBA.BANK_ACCT_NO AS REMIT_TO_ACCT_NO,
           SPH.CURR_CD,
           SPH.DOC_SEQ,
           SPH.PAY_BAT_NM,
           SPH.PAY_MZD_LU_CD,
           SPH.PAY_STE_NM,
           SPH.PAY_XCH_DT,
           DECODE(SPH.XCH_RT_TP_CD, 1, 'Corporate') AS XCH_RT_TP_CD,
           SPH.PAY_XCH_RT,
           SPH.PAY_CNT_CD,
           SPH.PAY_ADDR1,
           SPH.PAY_FUNC_AMT,
           SPH.BANK_ACCT_SEQ,
           SPH.XTER_BANK_ACCT_SEQ,
		   SPH.BANK_ACCT_NO,						
          (SELECT NVL(DP_PRCS_KNT, 0) FROM MDM_CURRENCY M WHERE M.CURR_CD = SPH.CURR_CD AND ROWNUM=1 ) AS PAY_CURR_PRCS,
          'Y' AS PERIOD_CHK,
          (
            SELECT  SLD.lU_CD    
            FROM    SCO_LU_HDR SLH
                  , SCO_LU_DTL SLD
            WHERE   SLH.LU_TP_CD = SLD.LU_TP_CD
            AND     SLH.LU_TP_CD = 'FUNCTIONAL CURRENCY'
            AND     SLH.LU_APPL_CD = 'SCO'
            AND     NVL(SLD.ENBL_FLG, 'Y') = 'Y'
            AND     NVL(SLD.LU_ST_DT, SYSDATE) >= SYSDATE 
            AND     ROWNUM = 1      
          ) AS PAY_FUNC_CURR_CD
          ,SPH.PAY_STS_LU_CD
    FROM SAP_PAY_HDR SPH, SAP_INV_SEL_CRTE SISC ,SAP_BANK_ACCT SBA
    WHERE SPH.PAY_BAT_RUN_SEQ = SISC.PAY_BAT_SEQ(+)
    AND   SPH.XTER_BANK_ACCT_SEQ = SBA.BANK_ACCT_SEQ(+)
    AND   SPH.PAY_DT  BETWEEN TO_DATE(REPLACE(@[fr_dt],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_dt],'-',''),'YYYYMMDD') + 0.99999
	#if (${ofc_cd} != '')
	    AND  SPH.OFC_CD = @[ofc_cd]
	#end
	#if (${bank_acct_nm} != '')
	    AND  SPH.BANK_ACCT_NM = @[bank_acct_nm]
	#end
	#if (${vndr_pay_grp_cd} != '')
	    AND  SISC.VNDR_PAY_GRP_CD = @[vndr_pay_grp_cd]
	#end
	#if (${pay_mzd_lu_cd} != '')
	    AND  SPH.PAY_MZD_LU_CD = @[pay_mzd_lu_cd]
	#end
	#if (${doc_seq} != '')
	    AND  SPH.DOC_SEQ = @[doc_seq]
	#end
	#if (${pay_bat_nm} != '')
	    AND  SPH.PAY_BAT_NM = @[pay_bat_nm]
	#end
	#if (${vndr_nm} != '')
	    AND  SPH.VNDR_NM LIKE @[vndr_nm]||'%'
	#end
) A
ORDER BY PAY_DT, PAY_SEQ, PAY_TP_CD, OFC_CD, VNDR_NO			]]></sql>
			<params>
				<param name="fr_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="bank_acct_nm" type="12" value="" out="N"/>
				<param name="vndr_pay_grp_cd" type="12" value="" out="N"/>
				<param name="pay_mzd_lu_cd" type="12" value="" out="N"/>
				<param name="doc_seq" type="12" value="" out="N"/>
				<param name="pay_bat_nm" type="12" value="" out="N"/>
				<param name="vndr_nm" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
