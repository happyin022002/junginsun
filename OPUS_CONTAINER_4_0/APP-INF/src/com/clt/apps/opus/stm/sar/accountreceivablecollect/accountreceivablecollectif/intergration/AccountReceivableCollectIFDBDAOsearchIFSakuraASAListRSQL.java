/*=========================================================
*Copyright(c) 2016 CyberLogitec
*@FileName : AccountReceivableCollectIFDBDAOsearchIFSakuraASAListRSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2016.10.12
*@LastModifier : 
*@LastVersion : 1.0
* 2016.10.12 
* 1.0 Creation
=========================================================*/
package com.clt.apps.opus.stm.sar.accountreceivablecollect.accountreceivablecollectif.intergration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.clt.framework.support.db.ISQLTemplate;

/**
 *
 * @author 
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class AccountReceivableCollectIFDBDAOsearchIFSakuraASAListRSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * searchIFSakuraASAList
	  * </pre>
	  */
	public AccountReceivableCollectIFDBDAOsearchIFSakuraASAListRSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("asa_no",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("check_status",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.clt.apps.opus.stm.sar.accountreceivablecollect.accountreceivablecollectif.intergration").append("\n"); 
		query.append("FileName : AccountReceivableCollectIFDBDAOsearchIFSakuraASAListRSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("#if (${asa_no} == '' )" ).append("\n"); 
		query.append("SELECT DISTINCT" ).append("\n"); 
		query.append("       SAH.ADJ_NO AS ref_doc_no" ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${grp_yn} == 'Y' )" ).append("\n"); 
		query.append("SELECT" ).append("\n"); 
		query.append("	MAX(IF_SEQ_NO) IF_SEQ_NO," ).append("\n"); 
		query.append("	MAX(REC_ID) REC_ID," ).append("\n"); 
		query.append("	ACCT_CO_CD," ).append("\n"); 
		query.append("	IF_DOC_TP_CD," ).append("\n"); 
		query.append("	DOC_DT," ).append("\n"); 
		query.append("	PST_DT," ).append("\n"); 
		query.append("	REF_DOC_NO," ).append("\n"); 
		query.append("	DOC_HDR_CD," ).append("\n"); 
		query.append("	CURR_CD, " ).append("\n"); 
		query.append("	TAX_CALC_AUTO_FLG," ).append("\n"); 
		query.append("	PST_KEY_CD," ).append("\n"); 
		query.append("	VAT_TAX_CD," ).append("\n"); 
		query.append("	SUM(LOCL_AMT) LOCL_AMT," ).append("\n"); 
		query.append("	SUM(DOC_AMT) DOC_AMT," ).append("\n"); 
		query.append("	SUM(LOCL_TAX_AMT) LOCL_TAX_AMT," ).append("\n"); 
		query.append("	SUM(DOC_TAX_AMT) DOC_TAX_AMT," ).append("\n"); 
		query.append("	ASGN_NO," ).append("\n"); 
		query.append("	ITM_DESC," ).append("\n"); 
		query.append("	PLN_DT," ).append("\n"); 
		query.append("	COST_CTR_CD," ).append("\n"); 
		query.append("	ORD_NO," ).append("\n"); 
		query.append("	MN_ASET_NO," ).append("\n"); 
		query.append("	SUB_ASET_NO," ).append("\n"); 
		query.append("	ASET_TJ_TP_CD," ).append("\n"); 
		query.append("	ASET_VAL_DT," ).append("\n"); 
		query.append("	GL_ACCT_NO," ).append("\n"); 
		query.append("	CUST_NO," ).append("\n"); 
		query.append("	VNDR_CRTR_ACCT_NO," ).append("\n"); 
		query.append("	DUE_DT_CALC_BSEL_DT," ).append("\n"); 
		query.append("	PAY_MZD_CD," ).append("\n"); 
		query.append("	STE_CNTRL_BANK_IND_CD," ).append("\n"); 
		query.append("	MTRL_NO," ).append("\n"); 
		query.append("	FUEL_LAND_QTY," ).append("\n"); 
		query.append("	MEAS_BSE_UT_CD," ).append("\n"); 
		query.append("	PFITCTR_CD," ).append("\n"); 
		query.append("	ALTN_ACCT_NO," ).append("\n"); 
		query.append("	BIZ_PRNR_REF_KEY_CD1," ).append("\n"); 
		query.append("	BIZ_PRNR_REF_KEY_CD2," ).append("\n"); 
		query.append("	LINE_ITM_REF_KEY_CD," ).append("\n"); 
		query.append("	INSTR_KEY_CD1," ).append("\n"); 
		query.append("	INSTR_KEY_CD2," ).append("\n"); 
		query.append("	INSTR_KEY_CD3," ).append("\n"); 
		query.append("	PAY_REF_CD," ).append("\n"); 
		query.append("	AUTOMTC_PAY_CURR_CD," ).append("\n"); 
		query.append("	PAY_CURR_AMT," ).append("\n"); 
		query.append("	CTRT_NO," ).append("\n"); 
		query.append("	CTRT_TP_CD," ).append("\n"); 
		query.append("	PAY_RSN_CD," ).append("\n"); 
		query.append("	CLSS_CD," ).append("\n"); 
		query.append("	ACT_PLC_CD," ).append("\n"); 
		query.append("	ENTR_EXPN_ID," ).append("\n"); 
		query.append("	BUD_MGMT_DIV_CD," ).append("\n"); 
		query.append("	ACT_DT," ).append("\n"); 
		query.append("	VSL_CD," ).append("\n"); 
		query.append("	VVL_CD," ).append("\n"); 
		query.append("	HUS_BANK_ID," ).append("\n"); 
		query.append("	PAY_BLCK_KEY_CD," ).append("\n"); 
		query.append("	NULL N1ST_LODG_PORT_CD," ).append("\n"); 
		query.append("	NULL N1ST_LODG_PORT_ETD_DT," ).append("\n"); 
		query.append("	NULL LST_DCHG_PORT_CD," ).append("\n"); 
		query.append("	NULL LST_DCHG_PORT_ETA_DT," ).append("\n"); 
		query.append("	NULL TRD_CD," ).append("\n"); 
		query.append("	NULL TRNK_VVD_CD," ).append("\n"); 
		query.append("	REC_TP_CD," ).append("\n"); 
		query.append("	NULL SLAN_CD," ).append("\n"); 
		query.append("	NULL BKG_QTY," ).append("\n"); 
		query.append("	NULL ASA_FLG, " ).append("\n"); 
		query.append("	RVS_FLG," ).append("\n"); 
		query.append("    CRE_USR_ID," ).append("\n"); 
		query.append("	UPD_USR_ID" ).append("\n"); 
		query.append("FROM (" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("SELECT DISTINCT" ).append("\n"); 
		query.append("      --  SAR_AR_IF_SEQ.NEXTVAL  as AR_IF_Seq" ).append("\n"); 
		query.append("       --SAH.ADJ_HIS_SEQ AS If_Seq_No" ).append("\n"); 
		query.append("       null AS If_Seq_No" ).append("\n"); 
		query.append("       , '' AS rec_id" ).append("\n"); 
		query.append("       , '1000' AS acct_co_cd    " ).append("\n"); 
		query.append("       , 'H2' AS if_doc_tp_Cd " ).append("\n"); 
		query.append("       , SAH.ADJ_APLY_DT AS doc_dt" ).append("\n"); 
		query.append("       , SAH.ADJ_GL_DT  AS pst_dt" ).append("\n"); 
		query.append("       --20150312 wskim" ).append("\n"); 
		query.append("       --, SUBSTR(SOHI.IF_NO, 1, LENGTH(SOHI.IF_NO)-1) AS ref_doc_no" ).append("\n"); 
		query.append("       , SAH.ADJ_NO AS ref_doc_no" ).append("\n"); 
		query.append("       --EAI에서 끌고가는 시간을 하나로 Fix 해야 함(Batch No.(File ID 'OPR301' + Timestamp [YYYYMMDDHHMMSS])" ).append("\n"); 
		query.append("       --,'OPR301'||TO_CHAR(SYSDATE,'YYYYMMDDHHMMSS') AS doc_hdr_cd" ).append("\n"); 
		query.append("       , NULL    AS doc_hdr_cd             --6" ).append("\n"); 
		query.append("       , SAM.CURR_CD  AS curr_cd           --7" ).append("\n"); 
		query.append("       ,'' AS tax_calc_auto_flg            --8" ).append("\n"); 
		query.append("       , CASE" ).append("\n"); 
		query.append("             WHEN SCD.DTRB_SRC_TP_CD IN ('ADJ', 'REC') THEN" ).append("\n"); 
		query.append("                 DECODE(NVL(SCD.ACCT_DR_AMT, 0), 0, '11', '01')" ).append("\n"); 
		query.append("             ELSE" ).append("\n"); 
		query.append("                 DECODE(NVL(SCD.ACCT_DR_AMT, 0), 0, '50', '40')" ).append("\n"); 
		query.append("         END    AS pst_key_cd            --9" ).append("\n"); 
		query.append("       --20150227 wskim V1.9 적용 " ).append("\n"); 
		query.append("       --, NULL           AS vat_tax_cd    --10" ).append("\n"); 
		query.append("       , CASE" ).append("\n"); 
		query.append("             WHEN SCD.DTRB_SRC_TP_CD = 'HDR_RND' THEN" ).append("\n"); 
		query.append("                 DECODE( SUBSTR(MO.FINC_RGN_CD, 1,2), '11','B0','D0')  " ).append("\n"); 
		query.append("         END  AS vat_tax_cd  --10" ).append("\n"); 
		query.append("       -- 20151026 Currency Key의 기준으로 local amount 계산 기준 바꿔야함." ).append("\n"); 
		query.append("       , CASE " ).append("\n"); 
		query.append("             WHEN SCD.DTRB_SRC_TP_CD IN ('ADJ', 'REC') THEN" ).append("\n"); 
		query.append("                 CASE" ).append("\n"); 
		query.append("                     WHEN SAM.CURR_CD = FC.CURR_CD THEN" ).append("\n"); 
		query.append("                         NULL" ).append("\n"); 
		query.append("                     ELSE" ).append("\n"); 
		query.append("                         ABS(NVL(SCD.ACCT_DR_AMT, 0) - NVL(SCD.ACCT_CR_AMT, 0))" ).append("\n"); 
		query.append("                 END" ).append("\n"); 
		query.append("             ELSE" ).append("\n"); 
		query.append("                 ABS(NVL(SCD.ACCT_DR_AMT, 0) - NVL(SCD.ACCT_CR_AMT, 0)) " ).append("\n"); 
		query.append("         END            AS locl_amt   --11" ).append("\n"); 
		query.append("       --, DECODE(SIGN(SAH.ADJ_AMT),1,SCD.INP_DR_AMT,-1,SCD.INP_CR_AMT) AS doc_amt" ).append("\n"); 
		query.append("       , CASE " ).append("\n"); 
		query.append("             WHEN (SCD.CURR_CD = SACR.LOCL_CURR_CD) AND (SCD.DTRB_SRC_TP_CD IN ('ADJ', 'REC')) THEN" ).append("\n"); 
		query.append("                 ABS(NVL(SCD.INP_DR_AMT, 0) - NVL(SCD.INP_CR_AMT, 0))" ).append("\n"); 
		query.append("             WHEN SCD.CURR_CD = 'USD' AND (SCD.DTRB_SRC_TP_CD IN ('ADJ', 'REC')) THEN" ).append("\n"); 
		query.append("                 TO_NUMBER(SAR_GET_CUR_AMT_FNC(SACR.LOCL_CURR_CD, (ABS(NVL(SCD.INP_DR_AMT, 0) - NVL(SCD.INP_CR_AMT, 0)) * SACR.ASA_XCH_RT1)))" ).append("\n"); 
		query.append("             WHEN SCD.CURR_CD = SACR.N3RD_CURR_CD1 AND (SCD.DTRB_SRC_TP_CD IN ('ADJ', 'REC')) THEN" ).append("\n"); 
		query.append("                 TO_NUMBER(SAR_GET_CUR_AMT_FNC(SACR.LOCL_CURR_CD, (ABS(NVL(SCD.INP_DR_AMT, 0) - NVL(SCD.INP_CR_AMT, 0)) * SACR.N3RD_XCH_RT1)))" ).append("\n"); 
		query.append("             WHEN SCD.CURR_CD = SACR.N3RD_CURR_CD2 AND (SCD.DTRB_SRC_TP_CD IN ('ADJ', 'REC')) THEN" ).append("\n"); 
		query.append("                 TO_NUMBER(SAR_GET_CUR_AMT_FNC(SACR.LOCL_CURR_CD, (ABS(NVL(SCD.INP_DR_AMT, 0) - NVL(SCD.INP_CR_AMT, 0)) * SACR.N3RD_XCH_RT2)))" ).append("\n"); 
		query.append("             WHEN SCD.CURR_CD = SACR.N3RD_CURR_CD3 AND (SCD.DTRB_SRC_TP_CD IN ('ADJ', 'REC')) THEN" ).append("\n"); 
		query.append("                 TO_NUMBER(SAR_GET_CUR_AMT_FNC(SACR.LOCL_CURR_CD, (ABS(NVL(SCD.INP_DR_AMT, 0) - NVL(SCD.INP_CR_AMT, 0)) * SACR.N3RD_XCH_RT3)))" ).append("\n"); 
		query.append("             WHEN SCD.CURR_CD = SACR.N3RD_CURR_CD4 AND (SCD.DTRB_SRC_TP_CD IN ('ADJ', 'REC')) THEN" ).append("\n"); 
		query.append("                 TO_NUMBER(SAR_GET_CUR_AMT_FNC(SACR.LOCL_CURR_CD, (ABS(NVL(SCD.INP_DR_AMT, 0) - NVL(SCD.INP_CR_AMT, 0)) * SACR.N3RD_XCH_RT4)))" ).append("\n"); 
		query.append("             ELSE" ).append("\n"); 
		query.append("                 0" ).append("\n"); 
		query.append("        END    AS doc_amt             --12" ).append("\n"); 
		query.append("       ,'' AS locl_tax_amt            --13" ).append("\n"); 
		query.append("       ,'' AS doc_tax_amt             --14" ).append("\n"); 
		query.append("       --, DECODE(SCD.DTRB_SRC_TP_CD,'EXCH_LOSS',REPLACE(SAH.ADJ_NO,'ADJ'),'EXCH_GAIN',REPLACE(SAH.ADJ_NO,'ADJ'), 'HDR_RND',REPLACE(SAH.ADJ_NO,'ADJ'), SOC.BL_NO)  AS asgn_no -- 길이초과 19 max 18 DEV" ).append("\n"); 
		query.append("       --20160314  Migration시 ORG_INV_NO 송부" ).append("\n"); 
		query.append("       --  , DECODE(SCD.DTRB_SRC_TP_CD, 'ADJ', SAM.ASA_NO, 'REC', SOHI.BL_NO, SAM.ASA_NO)   AS asgn_no    --15" ).append("\n"); 
		query.append("          , CASE " ).append("\n"); 
		query.append("             WHEN SCD.DTRB_SRC_TP_CD= 'ADJ' THEN  " ).append("\n"); 
		query.append("                  SAM.ASA_NO" ).append("\n"); 
		query.append("             WHEN SCD.DTRB_SRC_TP_CD= 'REC'  THEN" ).append("\n"); 
		query.append("                (SELECT NVL(A.ORG_INV_NO, SOHI.BL_NO)" ).append("\n"); 
		query.append("                 FROM SAR_OTS_HDR A" ).append("\n"); 
		query.append("                 WHERE A.RHQ_CD = SOHI.RHQ_CD" ).append("\n"); 
		query.append("                 AND A.OTS_OFC_CD = SOHI.OTS_OFC_CD" ).append("\n"); 
		query.append("                 AND A.BL_NO = SOHI.BL_NO" ).append("\n"); 
		query.append("                 AND A.INV_NO = SOHI.INV_NO" ).append("\n"); 
		query.append("                 AND A.BL_NO = SOHI.BL_NO)" ).append("\n"); 
		query.append("             ELSE" ).append("\n"); 
		query.append("                 SAM.ASA_NO" ).append("\n"); 
		query.append("         END             AS asgn_no   " ).append("\n"); 
		query.append("          --20160314" ).append("\n"); 
		query.append("       , DECODE(SCD.DTRB_SRC_TP_CD,'REC', SAM.AGN_CD||':'" ).append("\n"); 
		query.append("                                                    ||(SELECT USR_NM " ).append("\n"); 
		query.append("                                                        FROM COM_USER" ).append("\n"); 
		query.append("                                                        WHERE USR_ID = SAH.CRE_USR_ID),'') AS itm_desc --16" ).append("\n"); 
		query.append("       -- 20150319 REC일떄 sailing date로 변경" ).append("\n"); 
		query.append("       --, DECODE(SCD.DTRB_SRC_TP_CD, 'REC', SAM.ASA_PRD_TO_DT, '') AS pln_dt                            --17" ).append("\n"); 
		query.append("        , DECODE(SCD.DTRB_SRC_TP_CD, 'REC', SOHI.SAIL_DT, '') AS pln_dt                            --17" ).append("\n"); 
		query.append("       -- EXCH_GAIN/LOSS, HDR_RND : MDA Trade 에서 profit_center_code 가져옴" ).append("\n"); 
		query.append("       , CASE" ).append("\n"); 
		query.append("             WHEN SCD.DTRB_SRC_TP_CD IN ('EXCH_GAIN', 'EXCH_LOSS', 'HDR_RND') THEN" ).append("\n"); 
		query.append("                 --20150306 WSKIM Profit Center code 변경" ).append("\n"); 
		query.append("                 /*(SELECT MSS.MODI_COST_CTR_CD " ).append("\n"); 
		query.append("                  FROM   MDM_SVC_SCP MSS" ).append("\n"); 
		query.append("                  WHERE  MSS.SVC_SCP_CD =SOHI.SVC_SCP_CD)*/" ).append("\n"); 
		query.append("                 NVL((SELECT MSS.MODI_COST_CTR_CD " ).append("\n"); 
		query.append("                      FROM   MDM_SVC_SCP MSS" ).append("\n"); 
		query.append("                      WHERE  MSS.SVC_SCP_CD =SOHI.SVC_SCP_CD), " ).append("\n"); 
		query.append("                        NVL(DECODE((SELECT SSCC.TGT_CD " ).append("\n"); 
		query.append("                                    FROM   SCO_STMT_CD_CONV SSCC " ).append("\n"); 
		query.append("                                    WHERE  SSCC.CONV_TP_CD = 'GL ACCT OF PROFIT CENTER'" ).append("\n"); 
		query.append("                                    AND    SSCC.SRC_CD = MA.MODI_ACCT_CD " ).append("\n"); 
		query.append("                                    AND    SSCC.USE_FLG = 'Y' " ).append("\n"); 
		query.append("                                    AND    SSCC.DELT_FLG = 'N' " ).append("\n"); 
		query.append("                                    AND ROWNUM = 1), 'ZH', MO.MODI_COST_CTR_CD," ).append("\n"); 
		query.append("                                                          (SELECT SSCC.TGT_CD " ).append("\n"); 
		query.append("                                                           FROM   SCO_STMT_CD_CONV SSCC " ).append("\n"); 
		query.append("                                                           WHERE  SSCC.CONV_TP_CD = 'GL ACCT OF PROFIT CENTER'" ).append("\n"); 
		query.append("                                                           AND    SSCC.SRC_CD = MA.MODI_ACCT_CD " ).append("\n"); 
		query.append("                                                           AND SSCC.USE_FLG = 'Y' " ).append("\n"); 
		query.append("                                                           AND SSCC.DELT_FLG = 'N' " ).append("\n"); 
		query.append("                                                           AND ROWNUM = 1)), 'A106') )" ).append("\n"); 
		query.append("         END  AS COST_CTR_CD         --18" ).append("\n"); 
		query.append("       ,'' AS ORD_NO                 --19" ).append("\n"); 
		query.append("       ,'' AS MN_ASET_NO             --20" ).append("\n"); 
		query.append("       ,'' AS SUB_ASET_NO            --21" ).append("\n"); 
		query.append("       ,'' AS ASET_TJ_TP_CD          --22" ).append("\n"); 
		query.append("       ,'' AS ASET_VAL_DT            --23" ).append("\n"); 
		query.append("       --20150107 wskim Receipt(ASA)는 EXCH_GAIN/LOSS, HDR_RND에만 적용.G/L Account Number       " ).append("\n"); 
		query.append("       , CASE" ).append("\n"); 
		query.append("             WHEN (SCD.DTRB_SRC_TP_CD = 'EXCH_GAIN') THEN" ).append("\n"); 
		query.append("                 '8225101000'  --GAIN" ).append("\n"); 
		query.append("             WHEN SCD.DTRB_SRC_TP_CD = 'EXCH_LOSS' THEN" ).append("\n"); 
		query.append("                 '8325401000'  --LOSS" ).append("\n"); 
		query.append("             WHEN (SCD.DTRB_SRC_TP_CD = 'HDR_RND') THEN" ).append("\n"); 
		query.append("                 --20150120 wskim HDR_RND 부분 G/L Account Number 변경" ).append("\n"); 
		query.append("                 /*CASE " ).append("\n"); 
		query.append("                     --Debit 금액이 있으면  LOSS, Credit 금액이 있으면 GAIN" ).append("\n"); 
		query.append("                     WHEN NVL(SCD.ACCT_DR_AMT, 0) <> 0 THEN" ).append("\n"); 
		query.append("                         '8325401000'" ).append("\n"); 
		query.append("                     WHEN NVL(SCD.ACCT_CR_AMT, 0) <> 0 THEN" ).append("\n"); 
		query.append("                         '8225101000' " ).append("\n"); 
		query.append("                 END             " ).append("\n"); 
		query.append("                 */" ).append("\n"); 
		query.append("                 '7001000000'   --HDR_ROUND" ).append("\n"); 
		query.append("         END  AS GL_ACCT_NO          --24" ).append("\n"); 
		query.append("       --, DECODE(SCD.DTRB_SRC_TBL_CD,'REC',SCD.CUST_CNT_CD||TO_CHAR(SCD.CUST_SEQ,'000000'),'RFD',SCD.CUST_CNT_CD||TO_CHAR(SCD.CUST_SEQ,'000000'),'') AS cust_no -- 향후  MDA vendor에서 SAP Account 가져옴" ).append("\n"); 
		query.append("       , CASE " ).append("\n"); 
		query.append("             --20150224 wskim 컬럼 변경. SCD.DTRB_SRC_TBL_CD -> SCD.DTRB_SRC_TP_CD" ).append("\n"); 
		query.append("             --WHEN SCD.DTRB_SRC_TBL_CD = 'ADJ' THEN" ).append("\n"); 
		query.append("             WHEN SCD.DTRB_SRC_TP_CD = 'ADJ' THEN" ).append("\n"); 
		query.append("                 --20150304 wskim 로직 변경" ).append("\n"); 
		query.append("                 /*(SELECT MODI_VNDR_CD" ).append("\n"); 
		query.append("                  FROM   MDM_VENDOR MV                                  " ).append("\n"); 
		query.append("                  WHERE  MV.VNDR_SEQ = MO.VNDR_SEQ)*/" ).append("\n"); 
		query.append("                 MO.MODI_AGN_CD" ).append("\n"); 
		query.append("             --20150224 wskim 컬럼 변경. SCD.DTRB_SRC_TBL_CD -> SCD.DTRB_SRC_TP_CD     " ).append("\n"); 
		query.append("             --WHEN SCD.DTRB_SRC_TBL_CD = 'REC' THEN" ).append("\n"); 
		query.append("             --20161012 Migration 관련 수정" ).append("\n"); 
		query.append("             WHEN SCD.DTRB_SRC_TP_CD = 'REC' THEN" ).append("\n"); 
		query.append("                CASE " ).append("\n"); 
		query.append("                      WHEN  (SELECT NVL(A.ORG_INV_NO, 'XX')" ).append("\n"); 
		query.append("                             FROM SAR_OTS_HDR A" ).append("\n"); 
		query.append("                             WHERE A.RHQ_CD = SOC.RHQ_CD" ).append("\n"); 
		query.append("                             AND A.OTS_OFC_CD = SOC.OTS_OFC_CD" ).append("\n"); 
		query.append("                             AND A.BL_NO = SOC.BL_NO" ).append("\n"); 
		query.append("                             AND A.INV_NO = SOC.INV_NO" ).append("\n"); 
		query.append("                             AND A.BL_NO = SOC.BL_NO) ='XX' THEN" ).append("\n"); 
		query.append("                             " ).append("\n"); 
		query.append("                           'G1'||SCD.CUST_CNT_CD||TRIM(TO_CHAR(SCD.CUST_SEQ, '000000'))" ).append("\n"); 
		query.append("                       ELSE" ).append("\n"); 
		query.append("                           MC.MODI_CUST_CD" ).append("\n"); 
		query.append("                 END" ).append("\n"); 
		query.append("             ELSE" ).append("\n"); 
		query.append("                 NULL" ).append("\n"); 
		query.append("             END    AS cust_no      --25 " ).append("\n"); 
		query.append("       ,'' AS vndr_crtr_acct_no     --26" ).append("\n"); 
		query.append("       --20150302 wskim 로직수정.v2.0" ).append("\n"); 
		query.append("       --, DECODE(SCD.DTRB_SRC_TP_CD, 'REC', SAM.ASA_PRD_TO_DT, '')  AS due_dt_calc_bsel_dt   --27" ).append("\n"); 
		query.append("       , CASE" ).append("\n"); 
		query.append("             WHEN SCD.DTRB_SRC_TP_CD IN ('REC','ADJ') THEN" ).append("\n"); 
		query.append("                 SAM.ASA_PRD_TO_DT" ).append("\n"); 
		query.append("         END   AS due_dt_calc_bsel_dt   --27" ).append("\n"); 
		query.append("       --20150305 wskim substr(ssc.tgt_Cd, 0, 1) -> ssc.tgt_cd" ).append("\n"); 
		query.append("       , DECODE(SCD.DTRB_SRC_TP_CD, 'REC', (SELECT SUBSTR(SSC.TGT_CD,0,1)" ).append("\n"); 
		query.append("                                            FROM   SCO_STMT_CD_CONV SSC" ).append("\n"); 
		query.append("                                            WHERE  SSC.CONV_TP_CD = 'RECEIPT TYPE'" ).append("\n"); 
		query.append("                                            AND    SSC.SRC_CD = 'OFF'" ).append("\n"); 
		query.append("                                           ), '') AS pay_mzd_cd                     --28" ).append("\n"); 
		query.append("       ,'' AS ste_cntrl_bank_ind_cd  --29" ).append("\n"); 
		query.append("       ,'' AS mtrl_no                --30" ).append("\n"); 
		query.append("       ,'' AS fuel_land_qty          --31" ).append("\n"); 
		query.append("       ,'' AS meas_bse_ut_cd         --32" ).append("\n"); 
		query.append("       -- EXCH_GAIN/LOSS, HDR_RND : MDA Trade 에서 profit_center_code 가져옴" ).append("\n"); 
		query.append("       , CASE" ).append("\n"); 
		query.append("             WHEN SCD.DTRB_SRC_TP_CD IN ('EXCH_GAIN', 'EXCH_LOSS', 'HDR_RND') THEN" ).append("\n"); 
		query.append("                 --20150306 WSKIM Profit Center code 변경" ).append("\n"); 
		query.append("                 /*(SELECT MSS.MODI_COST_CTR_CD " ).append("\n"); 
		query.append("                  FROM   MDM_SVC_SCP MSS" ).append("\n"); 
		query.append("                  WHERE  MSS.SVC_SCP_CD =SOHI.SVC_SCP_CD)*/" ).append("\n"); 
		query.append("                 NVL((SELECT MSS.MODI_COST_CTR_CD " ).append("\n"); 
		query.append("                      FROM   MDM_SVC_SCP MSS" ).append("\n"); 
		query.append("                      WHERE  MSS.SVC_SCP_CD =SOHI.SVC_SCP_CD), " ).append("\n"); 
		query.append("                        NVL(DECODE((SELECT SSCC.TGT_CD " ).append("\n"); 
		query.append("                                    FROM   SCO_STMT_CD_CONV SSCC " ).append("\n"); 
		query.append("                                    WHERE  SSCC.CONV_TP_CD = 'GL ACCT OF PROFIT CENTER'" ).append("\n"); 
		query.append("                                    AND    SSCC.SRC_CD = MA.MODI_ACCT_CD " ).append("\n"); 
		query.append("                                    AND    SSCC.USE_FLG = 'Y' " ).append("\n"); 
		query.append("                                    AND    SSCC.DELT_FLG = 'N' " ).append("\n"); 
		query.append("                                    AND ROWNUM = 1), 'ZH', MO.MODI_COST_CTR_CD," ).append("\n"); 
		query.append("                                                          (SELECT SSCC.TGT_CD " ).append("\n"); 
		query.append("                                                           FROM   SCO_STMT_CD_CONV SSCC " ).append("\n"); 
		query.append("                                                           WHERE  SSCC.CONV_TP_CD = 'GL ACCT OF PROFIT CENTER'" ).append("\n"); 
		query.append("                                                           AND    SSCC.SRC_CD = MA.MODI_ACCT_CD " ).append("\n"); 
		query.append("                                                           AND SSCC.USE_FLG = 'Y' " ).append("\n"); 
		query.append("                                                           AND SSCC.DELT_FLG = 'N' " ).append("\n"); 
		query.append("                                                           AND ROWNUM = 1)), 'A106') )" ).append("\n"); 
		query.append("         END  AS pfitctr_cd          --33" ).append("\n"); 
		query.append("       , CASE" ).append("\n"); 
		query.append("             --20150224 wskim 컬럼 변경. SCD.DTRB_SRC_TBL_CD -> SCD.DTRB_SRC_TP_CD" ).append("\n"); 
		query.append("             --WHEN SCD.DTRB_SRC_TBL_CD = 'ADJ' THEN" ).append("\n"); 
		query.append("             WHEN SCD.DTRB_SRC_TP_CD = 'ADJ' THEN" ).append("\n"); 
		query.append("                 '5360000000'" ).append("\n"); 
		query.append("             --WHEN SCD.DTRB_SRC_TBL_CD = 'REC' THEN" ).append("\n"); 
		query.append("             WHEN SCD.DTRB_SRC_TP_CD = 'REC' THEN" ).append("\n"); 
		query.append("                 (SELECT MA.MODI_ACCT_CD" ).append("\n"); 
		query.append("                  FROM   MDM_ACCOUNT MA" ).append("\n"); 
		query.append("                  WHERE  MA.ACCT_CD = SLC.SGM_CTNT4)" ).append("\n"); 
		query.append("             ELSE " ).append("\n"); 
		query.append("                 ''                 " ).append("\n"); 
		query.append("        END  AS altn_acct_no        --34" ).append("\n"); 
		query.append("      , CASE" ).append("\n"); 
		query.append("             --20150224 wskim 컬럼 변경. SCD.DTRB_SRC_TBL_CD -> SCD.DTRB_SRC_TP_CD" ).append("\n"); 
		query.append("             --WHEN SCD.DTRB_SRC_TBL_CD = 'ADJ' THEN" ).append("\n"); 
		query.append("             WHEN SCD.DTRB_SRC_TP_CD = 'ADJ' THEN" ).append("\n"); 
		query.append("                 'A106'" ).append("\n"); 
		query.append("             -- Receipt(ASA)의 REC : MDA Organization 에서 profit_center_code 가져옴" ).append("\n"); 
		query.append("             --20150224 wskim 컬럼 변경. SCD.DTRB_SRC_TBL_CD -> SCD.DTRB_SRC_TP_CD" ).append("\n"); 
		query.append("             --WHEN SCD.DTRB_SRC_TBL_CD = 'REC' THEN" ).append("\n"); 
		query.append("             WHEN SCD.DTRB_SRC_TP_CD = 'REC' THEN" ).append("\n"); 
		query.append("                 --20150306 WSKIM Profit Center code 변경" ).append("\n"); 
		query.append("                 /*(SELECT MSS.MODI_COST_CTR_CD " ).append("\n"); 
		query.append("                  FROM   MDM_SVC_SCP MSS" ).append("\n"); 
		query.append("                  WHERE  MSS.SVC_SCP_CD =SOHI.SVC_SCP_CD)*/" ).append("\n"); 
		query.append("                 NVL((SELECT MSS.MODI_COST_CTR_CD " ).append("\n"); 
		query.append("                      FROM   MDM_SVC_SCP MSS" ).append("\n"); 
		query.append("                      WHERE  MSS.SVC_SCP_CD =SOHI.SVC_SCP_CD), " ).append("\n"); 
		query.append("                        NVL(DECODE((SELECT SSCC.TGT_CD " ).append("\n"); 
		query.append("                                    FROM   SCO_STMT_CD_CONV SSCC " ).append("\n"); 
		query.append("                                    WHERE  SSCC.CONV_TP_CD = 'GL ACCT OF PROFIT CENTER'" ).append("\n"); 
		query.append("                                    AND    SSCC.SRC_CD = MA.MODI_ACCT_CD " ).append("\n"); 
		query.append("                                    AND    SSCC.USE_FLG = 'Y' " ).append("\n"); 
		query.append("                                    AND    SSCC.DELT_FLG = 'N' " ).append("\n"); 
		query.append("                                    AND ROWNUM = 1), 'ZH', MO.MODI_COST_CTR_CD," ).append("\n"); 
		query.append("                                                          (SELECT SSCC.TGT_CD " ).append("\n"); 
		query.append("                                                           FROM   SCO_STMT_CD_CONV SSCC " ).append("\n"); 
		query.append("                                                           WHERE  SSCC.CONV_TP_CD = 'GL ACCT OF PROFIT CENTER'" ).append("\n"); 
		query.append("                                                           AND    SSCC.SRC_CD = MA.MODI_ACCT_CD " ).append("\n"); 
		query.append("                                                           AND SSCC.USE_FLG = 'Y' " ).append("\n"); 
		query.append("                                                           AND SSCC.DELT_FLG = 'N' " ).append("\n"); 
		query.append("                                                           AND ROWNUM = 1)), 'A106') )       " ).append("\n"); 
		query.append("             ELSE" ).append("\n"); 
		query.append("                 ''" ).append("\n"); 
		query.append("         END  AS biz_prnr_ref_key_cd1     --35" ).append("\n"); 
		query.append("       , CASE" ).append("\n"); 
		query.append("             --20150224 wskim 컬럼 변경. SCD.DTRB_SRC_TBL_CD -> SCD.DTRB_SRC_TP_CD" ).append("\n"); 
		query.append("             --WHEN SCD.DTRB_SRC_TBL_CD = 'REC' THEN" ).append("\n"); 
		query.append("             WHEN SCD.DTRB_SRC_TP_CD = 'REC' THEN" ).append("\n"); 
		query.append("                 (SELECT TGT_CD" ).append("\n"); 
		query.append("                  FROM   SCO_STMT_CD_CONV" ).append("\n"); 
		query.append("                  WHERE  CONV_TP_CD = 'CASHIER PLACE CODE'" ).append("\n"); 
		query.append("                  AND    SRC_CD = SAM.AGN_CD) " ).append("\n"); 
		query.append("             ELSE" ).append("\n"); 
		query.append("                 ''" ).append("\n"); 
		query.append("         END  AS biz_prnr_ref_key_cd2     --36" ).append("\n"); 
		query.append("       ,'' AS line_itm_ref_key_cd         --37" ).append("\n"); 
		query.append("       ,'' AS instr_key_cd1               --38" ).append("\n"); 
		query.append("       ,'' AS instr_key_cd2               --39" ).append("\n"); 
		query.append("       ,'' AS instr_key_cd3               --40" ).append("\n"); 
		query.append("       --20150224 wskim 컬럼 변경. SCD.DTRB_SRC_TBL_CD -> SCD.DTRB_SRC_TP_CD" ).append("\n"); 
		query.append("       --, DECODE(SCD.DTRB_SRC_TBL_CD, 'ADJ', '41', '')  AS pay_ref_cd    --41" ).append("\n"); 
		query.append("       , DECODE(SCD.DTRB_SRC_TP_CD, 'ADJ', '41', '')  AS pay_ref_cd    --41" ).append("\n"); 
		query.append("       --20150129 wskim space로 변경 됨." ).append("\n"); 
		query.append("       -- , DECODE(SCD.DTRB_SRC_TBL_CD, 'REC', DECODE(SCD.CURR_CD, FC.CURR_CD, '', FC.CURR_CD), '') AS automtc_pay_curr_cd    --42" ).append("\n"); 
		query.append("       , '' AS automtc_pay_curr_cd        --42" ).append("\n"); 
		query.append("       --20150129 wskim space로 변경 됨." ).append("\n"); 
		query.append("       --, DECODE(SCD.DTRB_SRC_TBL_CD, 'REC', DECODE(SCD.CURR_CD, FC.CURR_CD, '', ABS(NVL(SCD.ACCT_DR_AMT, 0) - NVL(SCD.ACCT_CR_AMT, 0))), NULL) AS pay_curr_amt   --43" ).append("\n"); 
		query.append("       , '' AS pay_curr_amt               --43" ).append("\n"); 
		query.append("       --20150120 wskim Office SAP-ID 변경" ).append("\n"); 
		query.append("       /*, (SELECT MODI_VNDR_CD" ).append("\n"); 
		query.append("          FROM MDM_VENDOR MV" ).append("\n"); 
		query.append("          WHERE MV.VNDR_SEQ = MO.VNDR_SEQ" ).append("\n"); 
		query.append("         )   AS ctrt_no " ).append("\n"); 
		query.append("       */" ).append("\n"); 
		query.append("       , MO.MODI_AGN_CD  AS ctrt_no       --44  " ).append("\n"); 
		query.append("       , 'Z' AS ctrt_tp_cd                --45" ).append("\n"); 
		query.append("       ,'' AS pay_rsn_cd                  --46" ).append("\n"); 
		query.append("       ,'' AS clss_cd                     --47" ).append("\n"); 
		query.append("       ,CASE " ).append("\n"); 
		query.append("            WHEN SCD.DTRB_SRC_TP_CD IN ('ADJ', 'REC') THEN " ).append("\n"); 
		query.append("                ''" ).append("\n"); 
		query.append("            ELSE" ).append("\n"); 
		query.append("                (SELECT ML.MODI_LOC_CD" ).append("\n"); 
		query.append("                 FROM   MDM_LOCATION ML" ).append("\n"); 
		query.append("                 WHERE ML.LOC_CD = MO.LOC_CD)                " ).append("\n"); 
		query.append("        END  AS act_plc_cd                --48" ).append("\n"); 
		query.append("       ,'' AS entr_expn_id                --49" ).append("\n"); 
		query.append("       ,'' AS bud_mgmt_div_cd             --50" ).append("\n"); 
		query.append("       ,CASE " ).append("\n"); 
		query.append("            WHEN SCD.DTRB_SRC_TP_CD IN ('ADJ', 'REC') THEN " ).append("\n"); 
		query.append("                ''" ).append("\n"); 
		query.append("            ELSE " ).append("\n"); 
		query.append("                SAH.ADJ_APLY_DT  " ).append("\n"); 
		query.append("        END AS act_dt                     --51" ).append("\n"); 
		query.append("       ,'' AS vsl_cd                      --52" ).append("\n"); 
		query.append("       ,'' AS vvl_Cd                      --53" ).append("\n"); 
		query.append("       ,'' AS hus_bank_id                 --54" ).append("\n"); 
		query.append("       ,'' AS pay_blck_key_cd             --55" ).append("\n"); 
		query.append("       --20150129 wskim 신규 추가 항목. REC_TP_CD" ).append("\n"); 
		query.append("       ,SCD.DTRB_SRC_TP_CD     AS  rec_tp_cd" ).append("\n"); 
		query.append("       ,SCD.CLT_DTRB_SEQ " ).append("\n"); 
		query.append("       ,mo.VNDR_SEQ" ).append("\n"); 
		query.append("       ,'N' AS rvs_flg -- 20150319 narmal/reverse sequence 분리" ).append("\n"); 
		query.append("       ,SCD.CRE_USR_ID" ).append("\n"); 
		query.append("	   ,SCD.UPD_USR_ID" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("FROM   SAR_ADJ_HIS SAH " ).append("\n"); 
		query.append("     , SAR_CLT_DTRB SCD " ).append("\n"); 
		query.append("     , SCO_LEGR_CD_CMB SLC " ).append("\n"); 
		query.append("     , SAR_ASA_MST SAM" ).append("\n"); 
		query.append("     , SAR_AGN_CLT_RFND_MST SACR     " ).append("\n"); 
		query.append("     , SAR_OTS_CHG SOC " ).append("\n"); 
		query.append("     , SAR_OTS_HIS SOHI       " ).append("\n"); 
		query.append("     , MDM_ORGANIZATION MO" ).append("\n"); 
		query.append("     --20150306 wskim MDM_ACCOUNT 추가" ).append("\n"); 
		query.append("     ,  MDM_ACCOUNT MA" ).append("\n"); 
		query.append("     ,  MDM_CUSTOMER    MC --20161012 Migration 관련 수정" ).append("\n"); 
		query.append("     , (SELECT SLD.LU_CD CURR_CD" ).append("\n"); 
		query.append("        FROM   SCO_LU_HDR SLH" ).append("\n"); 
		query.append("              ,SCO_LU_DTL SLD" ).append("\n"); 
		query.append("        WHERE  SLH.LU_APPL_CD ='SCO'" ).append("\n"); 
		query.append("        AND    SLH.LU_TP_CD ='FUNCTIONAL CURRENCY'" ).append("\n"); 
		query.append("        AND    SLH.LU_TP_CD = SLD.LU_TP_CD) FC" ).append("\n"); 
		query.append("WHERE  SAH.ADJ_HIS_SEQ = SCD.DTRB_SRC_SEQ " ).append("\n"); 
		query.append("AND    SCD.DTRB_CD_CMB_SEQ = SLC.CD_CMB_SEQ " ).append("\n"); 
		query.append("AND    SCD.CUST_CNT_CD = MC.CUST_CNT_CD(+) --20161012 Migration 관련 수정" ).append("\n"); 
		query.append("AND    SCD.CUST_SEQ = MC.CUST_SEQ(+) --20161012 Migration 관련 수정" ).append("\n"); 
		query.append("AND    SAH.OTS_HIS_SEQ = SOC.OTS_HIS_SEQ " ).append("\n"); 
		query.append("AND    SAH.CHG_TP_CD = SOC.CHG_TP_CD" ).append("\n"); 
		query.append("AND    SOC.OTS_HIS_SEQ = SOHI.OTS_HIS_SEQ" ).append("\n"); 
		query.append("AND    SAH.ADJ_NO = SAM.ASA_NO" ).append("\n"); 
		query.append("AND    SAM.ASA_NO = SACR.ASA_NO" ).append("\n"); 
		query.append("AND    SOHI.OTS_OFC_CD = SACR.AR_OFC_CD" ).append("\n"); 
		query.append("AND    SOHI.BL_NO = SACR.BL_NO" ).append("\n"); 
		query.append("AND    SOC.CHG_TP_CD = SACR.CHG_TP_CD" ).append("\n"); 
		query.append("--asa curr 환산 환율 구하는 중    " ).append("\n"); 
		query.append("AND    MO.OFC_CD = SAM.AGN_CD" ).append("\n"); 
		query.append("--20150306 wskim MDM_ACCOUNT 추가" ).append("\n"); 
		query.append("AND    SLC.SGM_CTNT4 = MA.ACCT_CD" ).append("\n"); 
		query.append("AND    SCD.DTRB_SRC_TBL_CD = 'ADJ'" ).append("\n"); 
		query.append("#if (${asa_no} != '' )" ).append("\n"); 
		query.append("AND    SAH.ADJ_NO = @[asa_no]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("AND    SCD.AR_IF_STS_CD = @[check_status]" ).append("\n"); 
		query.append("#if (${grp_yn} == 'Y' )" ).append("\n"); 
		query.append(") GROUP BY" ).append("\n"); 
		query.append(" ACCT_CO_CD" ).append("\n"); 
		query.append(",IF_DOC_TP_CD" ).append("\n"); 
		query.append(",DOC_DT" ).append("\n"); 
		query.append(",PST_DT" ).append("\n"); 
		query.append(",REF_DOC_NO" ).append("\n"); 
		query.append(",DOC_HDR_CD" ).append("\n"); 
		query.append(",CURR_CD" ).append("\n"); 
		query.append(",TAX_CALC_AUTO_FLG" ).append("\n"); 
		query.append(",PST_KEY_CD" ).append("\n"); 
		query.append(",VAT_TAX_CD" ).append("\n"); 
		query.append(",ASGN_NO" ).append("\n"); 
		query.append(",ITM_DESC" ).append("\n"); 
		query.append(",PLN_DT" ).append("\n"); 
		query.append(",COST_CTR_CD" ).append("\n"); 
		query.append(",ORD_NO" ).append("\n"); 
		query.append(",MN_ASET_NO" ).append("\n"); 
		query.append(",SUB_ASET_NO" ).append("\n"); 
		query.append(",ASET_TJ_TP_CD" ).append("\n"); 
		query.append(",ASET_VAL_DT" ).append("\n"); 
		query.append(",GL_ACCT_NO" ).append("\n"); 
		query.append(",CUST_NO" ).append("\n"); 
		query.append(",VNDR_CRTR_ACCT_NO" ).append("\n"); 
		query.append(",DUE_DT_CALC_BSEL_DT" ).append("\n"); 
		query.append(",PAY_MZD_CD" ).append("\n"); 
		query.append(",STE_CNTRL_BANK_IND_CD" ).append("\n"); 
		query.append(",MTRL_NO" ).append("\n"); 
		query.append(",FUEL_LAND_QTY" ).append("\n"); 
		query.append(",MEAS_BSE_UT_CD" ).append("\n"); 
		query.append(",PFITCTR_CD" ).append("\n"); 
		query.append(",ALTN_ACCT_NO" ).append("\n"); 
		query.append(",BIZ_PRNR_REF_KEY_CD1" ).append("\n"); 
		query.append(",BIZ_PRNR_REF_KEY_CD2" ).append("\n"); 
		query.append(",LINE_ITM_REF_KEY_CD" ).append("\n"); 
		query.append(",INSTR_KEY_CD1" ).append("\n"); 
		query.append(",INSTR_KEY_CD2" ).append("\n"); 
		query.append(",INSTR_KEY_CD3" ).append("\n"); 
		query.append(",PAY_REF_CD" ).append("\n"); 
		query.append(",AUTOMTC_PAY_CURR_CD" ).append("\n"); 
		query.append(",PAY_CURR_AMT" ).append("\n"); 
		query.append(",CTRT_NO" ).append("\n"); 
		query.append(",CTRT_TP_CD" ).append("\n"); 
		query.append(",PAY_RSN_CD" ).append("\n"); 
		query.append(",CLSS_CD" ).append("\n"); 
		query.append(",ACT_PLC_CD" ).append("\n"); 
		query.append(",ENTR_EXPN_ID" ).append("\n"); 
		query.append(",BUD_MGMT_DIV_CD" ).append("\n"); 
		query.append(",ACT_DT" ).append("\n"); 
		query.append(",VSL_CD" ).append("\n"); 
		query.append(",VVL_CD" ).append("\n"); 
		query.append(",HUS_BANK_ID" ).append("\n"); 
		query.append(",PAY_BLCK_KEY_CD" ).append("\n"); 
		query.append(",REC_TP_CD" ).append("\n"); 
		query.append(",RVS_FLG" ).append("\n"); 
		query.append(",CRE_USR_ID" ).append("\n"); 
		query.append(",UPD_USR_ID" ).append("\n"); 
		query.append(" ORDER BY RVS_FLG " ).append("\n"); 
		query.append("#end" ).append("\n"); 

	}
}