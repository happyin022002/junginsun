<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountPayableInvoiceDBDAOAddUnsettledAccountPaymentSummaryCSQL">
			<desc><![CDATA[AccountPayableInvoiceDBDAOAddUnsettledAccountPaymentSummaryCSQL]]></desc>
			<sql><![CDATA[
INSERT INTO SAP_UNSTL_SMRY 
(   UNSTL_ACCT_ITM_SEQ
  , UNSTL_YRMON
  , INV_SEQ
  , INV_NO
  , GL_DT
  , UNSTL_SRC_CD
  , UNSTL_CATE_NM
  , VNDR_NO
  , VNDR_NM
  , STL_KEY_NO
  , COA_RGN_CD
  , COA_CTR_CD
  , OFC_CD
  , COA_ACCT_CD
  , UNSTL_CURR_CD
  , CONV_XCH_RT
  , INP_DR_AMT
  , INP_CR_AMT
  , ACCT_DR_AMT
  , ACCT_CR_AMT
  , UNSTL_AMT
  , UNSTL_TJ_DT
  , UNSTL_DESC
  , UNSTL_DL_NO
  , UNSTL_DL_LINE_NO
  , ACCT_STL_FLG
  , ATTR_CTNT1
  , ATTR_CTNT2
  , ATTR_CTNT3
  , ATTR_CTNT4
  , ATTR_CTNT5
  , ATTR_CTNT6
  , ATTR_CTNT7
  , ATTR_CTNT8
  , ATTR_CTNT9
  , ATTR_CTNT10
  , CRE_USR_ID
  , CRE_DT
  , UPD_USR_ID
  , UPD_DT
)
SELECT  SAP_UNSTL_SMRY_SEQ.NEXTVAL        AS UNSTL_ACCT_ITM_SEQ
      , TO_CHAR(SPD.ACCTG_DT, 'YYYYMM')   AS UNSTL_YRMON
      , SPD.INV_SEQ                       AS INV_SEQ
      , SIH.INV_NO                        AS INV_NO
      , TO_CHAR(SPD.ACCTG_DT, 'YYYYMMDD') AS GL_DT
      , 'AP'                              AS UNSTL_SRC_CD
      , 'SAP_PSY_DTL'                     AS UNSTL_CATE_NM
      , SPH.VNDR_NO                       AS VNDR_NO
      , MV.VNDR_LGL_ENG_NM                AS VNDR_NM
      , SIH.INV_NO                        AS STL_KEY_NO
      , SLCC.SGM_CTNT2                    AS COA_RGN_CD
      , SLCC.SGM_CTNT3                    AS COA_CTR_CD
      , SPH.OFC_CD                        AS OFC_CD
      , SLCC.SGM_CTNT4                    AS COA_ACCT_CD
      , SPH.CURR_CD                       AS UNSTL_CURR_CD
      , SPH.PAY_XCH_RT                    AS CONV_XCH_RT
      , SPD.PAY_AMT                       AS INP_DR_AMT
      , 0                                 AS INP_CR_AMT
      , SPD.PAY_FUNC_AMT                  AS ACCT_DR_AMT
      , 0                                 AS ACCT_CR_AMT
      , SPD.PAY_AMT * -1                  AS UNSTL_AMT
      , TO_CHAR(SPH.PAY_DT, 'YYYYMMDD')   AS UNSTL_TJ_DT
      , SIH.INV_DESC                      AS UNSTL_DESC
      , ''                                AS UNSTL_DL_NO
      , ''                                AS UNSTL_DL_LINE_NO
      , 'N'                               AS ACCT_STL_FLG
      , ''                                AS ATTR_CTNT1
      , ''                                AS ATTR_CTNT2
      , ''                                AS ATTR_CTNT3
      , ''                                AS ATTR_CTNT4
      , ''                                AS ATTR_CTNT5
      , ''                                AS ATTR_CTNT6
      , ''                                AS ATTR_CTNT7
      , ''                                AS ATTR_CTNT8
      , ''                                AS ATTR_CTNT9
      , ''                                AS ATTR_CTNT10
      , @[usr_id]                         AS CRE_USR_ID
      , SYSDATE                           AS CRE_DT
      , @[usr_id]                         AS UPD_USR_ID
      , SYSDATE                           AS UPD_DT
FROM    SAP_PAY_HDR SPH
      , SAP_PAY_DTL SPD
      , SAP_INV_HDR SIH
      , MDM_VENDOR MV
      , SCO_LEGR_CD_CMB SLCC
WHERE   TO_NUMBER(SPH.VNDR_NO) = MV.VNDR_SEQ 
AND     SPH.PAY_SEQ = SPD.PAY_SEQ
AND     SPD.INV_SEQ = SIH.INV_SEQ
AND     SIH.LIAB_CD_CMB_SEQ = SLCC.CD_CMB_SEQ
AND     SPH.PAY_STS_LU_CD <> 'VOIDED'
AND     NVL(SPD.RVS_FLG, 'N') <> 'Y'
AND     SPD.PAY_AMT <> 0
AND     SPD.ACCTG_DT >= TO_DATE(REPLACE(@[unstl_yrmon],'-',''), 'YYYYMM')
AND     SPD.ACCTG_DT <  ADD_MONTHS(TO_DATE(REPLACE(@[unstl_yrmon],'-',''), 'YYYYMM'), 1)			]]></sql>
			<params>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="unstl_yrmon" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
