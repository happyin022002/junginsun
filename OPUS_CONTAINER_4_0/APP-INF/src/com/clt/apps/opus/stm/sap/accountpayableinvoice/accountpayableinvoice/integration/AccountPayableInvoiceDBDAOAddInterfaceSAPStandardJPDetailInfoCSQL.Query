<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountPayableInvoiceDBDAOAddInterfaceSAPStandardJPDetailInfoCSQL">
			<desc><![CDATA[AddInterfaceSAPStandardJPDetailInfo]]></desc>
			<sql><![CDATA[
INSERT INTO SAP_AP_IF 
      ( AP_IF_SEQ
      , IF_SEQ_NO
      , REC_ID
      , ACCT_CO_CD
      , IF_DOC_TP_CD
      , DOC_DT
      , PST_DT
      , REF_DOC_NO
      , DOC_HDR_CD
      , CURR_CD
      , TAX_CALC_AUTO_FLG
      , PST_KEY_CD
      , VAT_TAX_CD
      , LOCL_AMT
      , DOC_AMT
      , LOCL_TAX_AMT
      , DOC_TAX_AMT
      , ASGN_NO
      , ITM_DESC
      , PLN_DT
      , COST_CTR_CD
      , ORD_NO
      , MN_ASET_NO
      , SUB_ASET_NO
      , ASET_TJ_TP_CD
      , ASET_VAL_DT
      , GL_ACCT_NO
      , CUST_NO
      , VNDR_CRTR_ACCT_NO
      , DUE_DT_CALC_BSEL_DT
      , PAY_MZD_CD
      , STE_CNTRL_BANK_IND_CD
      , MTRL_NO
      , FUEL_LAND_QTY
      , MEAS_BSE_UT_CD
      , PFITCTR_CD
      , ALTN_ACCT_NO
      , BIZ_PRNR_REF_KEY_CD1
      , BIZ_PRNR_REF_KEY_CD2
      , LINE_ITM_REF_KEY_CD
      , INSTR_KEY_CD1
      , INSTR_KEY_CD2
      , INSTR_KEY_CD3
      , PAY_REF_CD
      , AUTOMTC_PAY_CURR_CD
      , PAY_CURR_AMT
      , CTRT_NO
      , CTRT_TP_CD
      , PAY_RSN_CD
      , CLSS_CD
      , ACT_PLC_CD
      , ENTR_EXPN_ID
      , BUD_MGMT_DIV_CD
      , ACT_DT
      , VSL_CD
      , VVL_CD
      , HUS_BANK_ID
      , PAY_BLCK_KEY_CD
      , CRE_USR_ID
      , CRE_DT
      , UPD_USR_ID
      , UPD_DT
      , IF_FLG
      , IF_FILE_ID
      , IF_DT
      , IF_ITM_CATE_CD
      )
      SELECT  SAP_IF_TO_SAP_SEQ.NEXTVAL           AS IF_SEQ
            , @[slip_interface_seq]               AS SLIP_IF_SEQ_NO
            , DECODE(SID.LINE_TP_LU_CD, 'TAX', 'X', NULL) AS RECORD_ID
            , '1000'                              AS COMPANY_CODE
            , 'U5'                                AS DOCUMENT_TYPE
            , TO_CHAR(SIH.INV_DT, 'YYYYMMDD')     AS DOCUMENT_DATE
            , SIH.GL_DT                           AS POSTING_DATE
            , SUBSTR(SIH.INV_NO, 1, 16)           AS REFERENCE_DOCUMENT_NO
            , 'OPR305' || TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') AS DOCUMENT_HEADER_TEXT
            , SIH.INV_CURR_CD                     AS CURRENCE_CODE
            , NULL                                AS TAX_CALCULATE_AUTO_FLAG
            , CASE WHEN (SID.LINE_TP_LU_CD IN ('TAX', 'WITHHOLDING TAX') OR MA.ACCT_CD = '211691') AND SID.DTRB_AMT < 0 THEN '50'   ----- 2014/10/06 PREPAY 하드코딩 부분 모두 제외 처리
                   WHEN (SID.LINE_TP_LU_CD IN ('TAX', 'WITHHOLDING TAX') OR MA.ACCT_CD = '211691') AND SID.DTRB_AMT >= 0 THEN '40'
                   WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM <> 'REFUND' AND SID.DTRB_AMT < 0 THEN '50'
                   WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM <> 'REFUND' AND SID.DTRB_AMT >= 0 THEN '40'
                   WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND SAM.AR_ACCT_CD = SLCC.SGM_CTNT4 AND ROWNUM = 1),'N') = 'Y' AND SID.DTRB_AMT < 0 THEN '11'
                   WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND SAM.AR_ACCT_CD = SLCC.SGM_CTNT4 AND ROWNUM = 1),'N') = 'Y' AND SID.DTRB_AMT >= 0 THEN '01'
                   WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND (SAM.LEGR_XCH_DIFF_INCM_ACCT_CD = SLCC.SGM_CTNT4 OR SAM.LEGR_XCH_DIFF_LSS_ACCT_CD = SLCC.SGM_CTNT4) AND ROWNUM = 1),'N') = 'Y' AND SID.DTRB_AMT < 0 THEN '50'
                   WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND (SAM.LEGR_XCH_DIFF_INCM_ACCT_CD = SLCC.SGM_CTNT4 OR SAM.LEGR_XCH_DIFF_LSS_ACCT_CD = SLCC.SGM_CTNT4) AND ROWNUM = 1),'N') = 'Y' AND SID.DTRB_AMT >= 0 THEN '40'
              ELSE '40' END                       AS POST_KEY
            , CASE WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM NOT IN ('REFUND', 'ARAPOFFSET') AND SID.DTRB_VAT_CD IS NOT NULL AND MA.ACCT_CD NOT LIKE '954%' AND MA.ACCT_CD <> '211691'
                        AND NVL((SELECT  SLD.ATTR_CTNT2 FROM SCO_LU_HDR SLH, SCO_LU_DTL SLD
                                 WHERE   SLH.LU_TP_CD = SLD.LU_TP_CD AND SLH.LU_TP_CD = 'AP TAX CODE' AND NVL(SLD.ENBL_FLG, 'Y') = 'Y'
                                 AND     NVL(SLD.LU_ST_DT, SYSDATE) >= SYSDATE AND SLH.LU_APPL_CD = 'SAP'AND SLD.LU_CD = SID.DTRB_VAT_CD AND ROWNUM = 1), 'N') = 'Y' THEN 'E3'
                   WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM NOT IN ('REFUND', 'ARAPOFFSET') AND SID.DTRB_VAT_CD IS NULL AND MA.ACCT_CD NOT LIKE '954%' AND MA.ACCT_CD <> '211691' THEN 'F0' --2015.02.04 추가
                   WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM NOT IN ('REFUND', 'ARAPOFFSET') AND SID.DTRB_VAT_CD IS NOT NULL AND MA.ACCT_CD NOT LIKE '954%' AND MA.ACCT_CD <> '211691'
                        AND NVL((SELECT  SLD.ATTR_CTNT2 FROM SCO_LU_HDR SLH, SCO_LU_DTL SLD
                                 WHERE   SLH.LU_TP_CD = SLD.LU_TP_CD AND SLH.LU_TP_CD = 'AP TAX CODE' AND NVL(SLD.ENBL_FLG, 'Y') = 'Y'
                                 AND     NVL(SLD.LU_ST_DT, SYSDATE) >= SYSDATE AND SLH.LU_APPL_CD = 'SAP'AND SLD.LU_CD = SID.DTRB_VAT_CD AND ROWNUM = 1), 'N') = 'N' THEN 'F0' --2015.02.04 추가
                   WHEN SID.LINE_TP_LU_CD = 'TAX' AND SID.DTRB_AMT <> 0 THEN 'E3' 
                   WHEN (SID.LINE_TP_LU_CD IN ( 'WITHHOLDING TAX' ) OR MA.ACCT_CD = '211691') AND SID.DTRB_AMT <> 0 THEN 'F0' ELSE NULL END   --- Tax Code (Business Logic)
                                                  AS TAX_ON_SALES
            , CASE WHEN SID.LINE_TP_LU_CD = 'TAX' THEN NULL
                   WHEN SIH.AP_INV_SRC_CD = 'AR' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND (SAM.LEGR_XCH_DIFF_INCM_ACCT_CD = SLCC.SGM_CTNT4 OR SAM.LEGR_XCH_DIFF_LSS_ACCT_CD = SLCC.SGM_CTNT4) AND ROWNUM = 1),'N') = 'Y' THEN DECODE(SIH.INV_CURR_CD, @[functional_currency], NULL, ABS(NVL(SID.DTRB_FUNC_AMT, 0)))
              ELSE DECODE(SIH.INV_CURR_CD, @[functional_currency], NULL, ABS(NVL(SID.DTRB_FUNC_AMT, 0))) END  -- 2014.10.27 금액수정
                                                  AS LOCAL_AMOUNT
            , CASE WHEN SIH.AP_INV_SRC_CD = 'AR' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND (SAM.LEGR_XCH_DIFF_INCM_ACCT_CD = SLCC.SGM_CTNT4 OR SAM.LEGR_XCH_DIFF_LSS_ACCT_CD = SLCC.SGM_CTNT4) AND ROWNUM = 1),'N') = 'Y' THEN TO_CHAR(ABS(NVL(SID.DTRB_AMT, 0))) 
                   ELSE DECODE(SID.LINE_TP_LU_CD, 'TAX', NULL, ABS(NVL(SID.DTRB_AMT, 0))) END AS DOCUMENT_AMOUNT
            , DECODE(SID.LINE_TP_LU_CD, 'TAX', DECODE(SIH.INV_CURR_CD, @[functional_currency], NULL, ABS(NVL(SID.DTRB_FUNC_AMT, 0))) --2014.10.27 금액수정
                                      , NULL)     AS LOCAL_TAX_AMOUNT
            , DECODE(SID.LINE_TP_LU_CD, 'TAX', ABS(NVL(SID.DTRB_AMT, 0)), NULL) AS DOCUMENT_TAX_AMOUNT
            , CASE WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT', 'WITHHOLDING TAX') AND SIH.ATTR_CATE_NM NOT IN ('REFUND', 'ARAPOFFSET') THEN SUBSTR(SIH.INV_NO, 1, 16)
                   WHEN SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND SAM.AR_ACCT_CD = SLCC.SGM_CTNT4 AND ROWNUM = 1),'N') = 'Y' THEN SUBSTR(SIH.ATTR_CTNT4, 4, 16) 
                   WHEN SIH.ATTR_CATE_NM = 'ARAPOFFSET' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND SAM.AR_ACCT_CD = SLCC.SGM_CTNT4 AND ROWNUM = 1),'N') = 'Y' THEN SUBSTR(SIH.ATTR_CTNT2, 4, 16) 
                   WHEN SID.LINE_TP_LU_CD = 'TAX' THEN NULL ELSE SUBSTR(SIH.INV_NO, 1, 16) END AS ASSIGNMENT_NUMBER
            , CASE WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM NOT IN ('ARAPOFFSET') AND MA.ACCT_CD NOT LIKE '954%' AND MA.ACCT_CD <> '211691' --2015.01.19 수정
                        AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND (SAM.LEGR_XCH_DIFF_INCM_ACCT_CD = SLCC.SGM_CTNT4 OR SAM.LEGR_XCH_DIFF_LSS_ACCT_CD = SLCC.SGM_CTNT4) AND ROWNUM = 1),'N') = 'N'
                        THEN SIH.OFC_CD || ':' || CU.USR_NM 
                   WHEN SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND SAM.AR_ACCT_CD = SLCC.SGM_CTNT4 AND ROWNUM = 1),'N') = 'Y' THEN SIH.OFC_CD || ':' || CU.USR_NM ELSE NULL END --2014.10.17 USER 정보 추가
                                                  AS ITEM_TEXT
            , CASE WHEN SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND SAM.AR_ACCT_CD = SLCC.SGM_CTNT4 AND ROWNUM = 1),'N') = 'Y'
                                                    THEN NVL((SELECT SR.RCT_DPS_DT FROM SAR_RECEIPT SR WHERE SR.RCT_NO = SIH.ATTR_CTNT4 AND ROWNUM = 1),  
                                                              (SELECT SAH.ADJ_DT FROM SAR_ADJ_HDR SAH WHERE SAH.ADJ_NO = SIH.ATTR_CTNT4 AND ROWNUM = 1))
                   ELSE NULL END                  AS PLANNING_DATE  --2015.01.19 수정
            , CASE WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM NOT IN ('REFUND', 'ARAPOFFSET') AND MA.ACCT_CD NOT LIKE '954%' AND MA.ACCT_CD <> '211691' THEN 
                        NVL((SELECT MT.MODI_COST_CTR_CD FROM MDM_TRADE MT WHERE MT.TRD_CD = SID.ATTR_CTNT7 AND ROWNUM = 1),
                            NVL((SELECT DECODE(MVSL.VSL_SLAN_CD, 'COM', NULL, 'CNT', NULL, MVSL.MODI_COST_CTR_CD) FROM MDM_VSL_SVC_LANE MVSL WHERE MVSL.VSL_SLAN_CD = SID.ATTR_CTNT14), 
                               NVL(DECODE((SELECT  SSCC.TGT_CD FROM SCO_STMT_CD_CONV SSCC WHERE SSCC.CONV_TP_CD = 'GL ACCT OF PROFIT CENTER'
                                           AND     SSCC.SRC_CD = MA.MODI_ACCT_CD AND SSCC.USE_FLG = 'Y' AND SSCC.DELT_FLG = 'N' AND ROWNUM = 1), 'ZH', MO.MODI_COST_CTR_CD,
                                          (SELECT  SSCC.TGT_CD FROM SCO_STMT_CD_CONV SSCC WHERE SSCC.CONV_TP_CD = 'GL ACCT OF PROFIT CENTER'
                                           AND     SSCC.SRC_CD = MA.MODI_ACCT_CD AND SSCC.USE_FLG = 'Y' AND SSCC.DELT_FLG = 'N' AND ROWNUM = 1)), --2015.02.11 수정 
                                    'A106') ) ) --2015.02.09 수정 --2015.01.28 수정 -- Profit Center(Code Conversion)
                   WHEN SIH.AP_INV_SRC_CD = 'AR' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND (SAM.LEGR_XCH_DIFF_INCM_ACCT_CD = SLCC.SGM_CTNT4 OR SAM.LEGR_XCH_DIFF_LSS_ACCT_CD = SLCC.SGM_CTNT4) AND ROWNUM = 1),'N') = 'Y' THEN
                   NVL((SELECT DECODE(MVSL.VSL_SLAN_CD, 'COM', NULL, 'CNT', NULL, MVSL.MODI_COST_CTR_CD) FROM MDM_VSL_SVC_LANE MVSL WHERE MVSL.VSL_SLAN_CD = SID.ATTR_CTNT14), --2015.02.04 수정
                          NVL(DECODE((SELECT  SSCC.TGT_CD FROM SCO_STMT_CD_CONV SSCC WHERE SSCC.CONV_TP_CD = 'GL ACCT OF PROFIT CENTER'
                                      AND     SSCC.SRC_CD = MA.MODI_ACCT_CD AND SSCC.USE_FLG = 'Y' AND SSCC.DELT_FLG = 'N' AND ROWNUM = 1), 'ZH', MO.MODI_COST_CTR_CD,
                                     (SELECT  SSCC.TGT_CD FROM SCO_STMT_CD_CONV SSCC WHERE SSCC.CONV_TP_CD = 'GL ACCT OF PROFIT CENTER'
                                      AND     SSCC.SRC_CD = MA.MODI_ACCT_CD AND SSCC.USE_FLG = 'Y' AND SSCC.DELT_FLG = 'N' AND ROWNUM = 1)), --2015.02.11 수정 
                                'A106') )
                   WHEN SID.LINE_TP_LU_CD = 'WITHHOLDING TAX' THEN NULL ELSE NULL END  --2015.01.26 수정
                                                  AS COST_CENTER 
            , NULL                                AS ORDER_NUMBER
            , NULL                                AS MAIN_ASSET_NUMBER
            , NULL                                AS ASSET_SUB_NUMBER
            , NULL                                AS ASSET_TRANSACTION_TYPE
            , NULL                                AS ASSET_VALUE_DATE
            , CASE WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM NOT IN ('REFUND', 'ARAPOFFSET') AND MA.ACCT_CD <> '211691' THEN MA.MODI_ACCT_CD 
                   WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM = 'ARAPOFFSET' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND SAM.AR_ACCT_CD = SLCC.SGM_CTNT4 AND ROWNUM = 1),'N') = 'Y' THEN '5400269051' -- 2015.01.19 수정  2014.10.23 수정 --- VTM의 G/L Account 처리
                   WHEN SIH.AP_INV_SRC_CD = 'AR' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND (SAM.LEGR_XCH_DIFF_INCM_ACCT_CD = SLCC.SGM_CTNT4 ) AND ROWNUM = 1),'N') = 'Y' THEN '8225101000'
                   WHEN SIH.AP_INV_SRC_CD = 'AR' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND (SAM.LEGR_XCH_DIFF_LSS_ACCT_CD = SLCC.SGM_CTNT4) AND ROWNUM = 1),'N') = 'Y' THEN '8325401000'
                   WHEN (SID.LINE_TP_LU_CD = 'WITHHOLDING TAX' OR MA.ACCT_CD = '211691') THEN '6480204000' ELSE NULL END 
                                                  AS GL_ACCOUNT_NO
            , CASE WHEN SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND SAM.AR_ACCT_CD = SLCC.SGM_CTNT4 AND ROWNUM = 1),'N') = 'Y'
                        AND NVL((SELECT SR.RCT_CUST_CNT_CD FROM SAR_RECEIPT SR WHERE SR.RCT_NO = SIH.ATTR_CTNT4 AND ROWNUM = 1),
                                (SELECT SAH.BIL_TO_CUST_CNT_CD FROM SAR_ADJ_HDR SAH WHERE SAH.ADJ_NO = SIH.ATTR_CTNT4 AND ROWNUM = 1)) = 'TB' 
                                 THEN NVL((SELECT 'G5'|| ML.CNT_CD || LPAD(TO_CHAR(MV.VNDR_SEQ),6, '0') 
                                           FROM   SAR_RECEIPT SR, MDM_VENDOR MV, MDM_ORGANIZATION MO, MDM_LOCATION ML 
                                           WHERE  SR.RCT_NO = SIH.ATTR_CTNT4 AND MV.OFC_CD = MO.OFC_CD(+) AND MO.LOC_CD = ML.LOC_CD(+)
                                           AND    MV.RFND_PSDO_CUST_CD = SR.RCT_CUST_CNT_CD||TRIM(TO_CHAR(SR.RCT_CUST_SEQ, '000000')) AND ROWNUM = 1),
                                          (SELECT 'G5'|| ML.CNT_CD || LPAD(TO_CHAR(MV.VNDR_SEQ),6, '0') 
                                           FROM   SAR_ADJ_HDR SAH, MDM_VENDOR MV, MDM_ORGANIZATION MO, MDM_LOCATION ML 
                                           WHERE  SAH.ADJ_NO = SIH.ATTR_CTNT4 AND MV.OFC_CD = MO.OFC_CD(+) AND MO.LOC_CD = ML.LOC_CD(+)
                                           AND    MV.RFND_PSDO_CUST_CD = SAH.BIL_TO_CUST_CNT_CD||TRIM(TO_CHAR(SAH.BIL_TO_CUST_SEQ, '000000')) AND ROWNUM = 1))
                   WHEN SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND SAM.AR_ACCT_CD = SLCC.SGM_CTNT4 AND ROWNUM = 1),'N') = 'Y'
                        AND NVL((SELECT SR.RCT_CUST_CNT_CD FROM SAR_RECEIPT SR WHERE SR.RCT_NO = SIH.ATTR_CTNT4 AND ROWNUM = 1),
                                (SELECT SAH.BIL_TO_CUST_CNT_CD FROM SAR_ADJ_HDR SAH WHERE SAH.ADJ_NO = SIH.ATTR_CTNT4 AND ROWNUM = 1)) <> 'TB'         
                                 THEN NVL((SELECT 'G1' || SR.RCT_CUST_CNT_CD || LPAD(TO_CHAR(SR.RCT_CUST_SEQ), 6, '0') 
                                           FROM   SAR_RECEIPT SR WHERE SR.RCT_NO = SIH.ATTR_CTNT4 AND ROWNUM = 1),  
                                          (SELECT 'G1' || SAH.BIL_TO_CUST_CNT_CD || LPAD(TO_CHAR(SAH.BIL_TO_CUST_SEQ), 6, '0') 
                                           FROM   SAR_ADJ_HDR SAH WHERE SAH.ADJ_NO = SIH.ATTR_CTNT4 AND ROWNUM = 1))
              ELSE NULL END                       AS CUSTOMER_NUMBER
            , NULL                                AS VENDOR_ACCOUNT_NO
            , CASE WHEN SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND SAM.AR_ACCT_CD = SLCC.SGM_CTNT4 AND ROWNUM = 1),'N') = 'Y'
                                                    THEN NVL((SELECT SR.RCT_DPS_DT FROM SAR_RECEIPT SR WHERE SR.RCT_NO = SIH.ATTR_CTNT4 AND ROWNUM = 1),  
                                                              (SELECT SAH.ADJ_DT FROM SAR_ADJ_HDR SAH WHERE SAH.ADJ_NO = SIH.ATTR_CTNT4 AND ROWNUM = 1))
                   ELSE NULL END                  AS CALCULATE_DUE_DATE  -- 2015.01.19 추가
            , NULL                                AS PAYMENT_METHOD -- Payment Method (Code Conversion)
            , NULL                                AS STATE_CENTRAL_BANK
            , NULL                                AS MATERIAL_NO
            , NULL                                AS QUANTITY
            , NULL                                AS BASE_UNIT
            , CASE WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM NOT IN ('REFUND', 'ARAPOFFSET') AND MA.ACCT_CD NOT LIKE '954%' AND MA.ACCT_CD <> '211691' THEN 
                        NVL((SELECT MT.MODI_COST_CTR_CD FROM MDM_TRADE MT WHERE MT.TRD_CD = SID.ATTR_CTNT7 AND ROWNUM = 1),
                            NVL((SELECT DECODE(MVSL.VSL_SLAN_CD, 'COM', NULL, 'CNT', NULL, MVSL.MODI_COST_CTR_CD) FROM MDM_VSL_SVC_LANE MVSL WHERE MVSL.VSL_SLAN_CD = SID.ATTR_CTNT14), 
                                   NVL(DECODE((SELECT  SSCC.TGT_CD FROM SCO_STMT_CD_CONV SSCC WHERE SSCC.CONV_TP_CD = 'GL ACCT OF PROFIT CENTER'
                                               AND     SSCC.SRC_CD = MA.MODI_ACCT_CD AND SSCC.USE_FLG = 'Y' AND SSCC.DELT_FLG = 'N' AND ROWNUM = 1), 'ZH', MO.MODI_COST_CTR_CD,
                                              (SELECT  SSCC.TGT_CD FROM SCO_STMT_CD_CONV SSCC WHERE SSCC.CONV_TP_CD = 'GL ACCT OF PROFIT CENTER'
                                               AND     SSCC.SRC_CD = MA.MODI_ACCT_CD AND SSCC.USE_FLG = 'Y' AND SSCC.DELT_FLG = 'N' AND ROWNUM = 1)), --2015.02.11 수정 
                                        'A106') ) ) --2015.02.09 수정 --2015.01.28 수정 -- Profit Center(Code Conversion)
                   WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM = 'ARAPOFFSET' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND SAM.AR_ACCT_CD = SLCC.SGM_CTNT4 AND ROWNUM = 1),'N') = 'Y' THEN 'A106' 
                   WHEN SIH.AP_INV_SRC_CD = 'AR' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND (SAM.LEGR_XCH_DIFF_INCM_ACCT_CD = SLCC.SGM_CTNT4 OR SAM.LEGR_XCH_DIFF_LSS_ACCT_CD = SLCC.SGM_CTNT4) AND ROWNUM = 1),'N') = 'Y' THEN 
                        NVL((SELECT DECODE(MVSL.VSL_SLAN_CD, 'COM', NULL, 'CNT', NULL, MVSL.MODI_COST_CTR_CD) FROM MDM_VSL_SVC_LANE MVSL WHERE MVSL.VSL_SLAN_CD = SID.ATTR_CTNT14), --2015.02.04 수정
                           NVL(DECODE((SELECT  SSCC.TGT_CD FROM SCO_STMT_CD_CONV SSCC WHERE SSCC.CONV_TP_CD = 'GL ACCT OF PROFIT CENTER'
                                       AND     SSCC.SRC_CD = MA.MODI_ACCT_CD AND SSCC.USE_FLG = 'Y' AND SSCC.DELT_FLG = 'N' AND ROWNUM = 1), 'ZH', MO.MODI_COST_CTR_CD,
                                      (SELECT  SSCC.TGT_CD FROM SCO_STMT_CD_CONV SSCC WHERE SSCC.CONV_TP_CD = 'GL ACCT OF PROFIT CENTER'
                                       AND     SSCC.SRC_CD = MA.MODI_ACCT_CD AND SSCC.USE_FLG = 'Y' AND SSCC.DELT_FLG = 'N' AND ROWNUM = 1)), --2015.02.11 수정 
                                'A106') )
                   WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM NOT IN ('REFUND', 'ARAPOFFSET') AND MA.ACCT_CD LIKE '954%' THEN 'A106'
                   WHEN SID.LINE_TP_LU_CD = 'WITHHOLDING TAX' OR  MA.ACCT_CD = '211691' THEN 'Z002'  ELSE NULL END
                                                  AS PROFIT_CENTER 
            , CASE WHEN SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND SAM.AR_ACCT_CD = SLCC.SGM_CTNT4 AND ROWNUM = 1),'N') = 'Y' THEN '5400269050'
                   --WHEN SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND (SAM.LEGR_XCH_DIFF_INCM_ACCT_CD = SLCC.SGM_CTNT4 OR SAM.LEGR_XCH_DIFF_INCM_ACCT_CD = SLCC.SGM_CTNT4) AND ROWNUM = 1),'N') = 'Y' THEN MA.MODI_ACCT_CD -- 2014.10.23 변경
                   ELSE NULL END --- VTM의 G/L Account 처리
                                                  AS ALTERNATIVE_ACCOUNT_NO
            , CASE WHEN SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND SAM.AR_ACCT_CD = SLCC.SGM_CTNT4 AND ROWNUM = 1),'N') = 'Y'
                                                    THEN 'A106'  --2015.04.20 수정
                   ELSE NULL END                  AS BIZ_PARTNER_REF_KEY1 -- Profit Center (Code Conversion)
            , CASE WHEN SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND SAM.AR_ACCT_CD = SLCC.SGM_CTNT4 AND ROWNUM = 1),'N') = 'Y' THEN '01' ELSE NULL END AS BIZ_PARTNER_REF_KEY2 -- 2015.01.19 추가
            , NULL                                AS LINE_ITEM_REF_KEY    -- Office SAP-ID (Code Conversion)
            , NULL                                AS INSTRUCTION_KEY1
            , NULL                                AS INSTRUCTION_KEY2
            , NULL                                AS INSTRUCTION_KEY3
            , NULL                                AS PAYMENT_REFERENCE
            , NULL                                AS AUTOMATIC_PAY_CURRENCY
            , NULL                                AS PAYMENT_CURR_AMOUNT
            , CASE WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM NOT IN ('REFUND', 'ARAPOFFSET') AND MA.ACCT_CD <> '211691' THEN 'G5'|| ML.CNT_CD || LPAD(TO_CHAR(MV.VNDR_SEQ),6, '0') --2015.03.30 수정
                   WHEN SID.LINE_TP_LU_CD = 'WITHHOLDING TAX' OR MA.ACCT_CD = '211691' THEN 'G5'|| ML.CNT_CD || LPAD(TO_CHAR(MV.VNDR_SEQ),6, '0') --2015.03.30 수정
                   WHEN SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND SAM.AR_ACCT_CD = SLCC.SGM_CTNT4 AND ROWNUM = 1),'N') = 'Y'
                        AND NVL((SELECT SR.RCT_CUST_CNT_CD FROM SAR_RECEIPT SR WHERE SR.RCT_NO = SIH.ATTR_CTNT4 AND ROWNUM = 1),
                                (SELECT SAH.BIL_TO_CUST_CNT_CD FROM SAR_ADJ_HDR SAH WHERE SAH.ADJ_NO = SIH.ATTR_CTNT4 AND ROWNUM = 1)) = 'TB' 
                                 THEN NVL((SELECT 'G5'|| ML.CNT_CD || LPAD(TO_CHAR(MV.VNDR_SEQ),6, '0') 
                                           FROM   SAR_RECEIPT SR, MDM_VENDOR MV, MDM_ORGANIZATION MO, MDM_LOCATION ML 
                                           WHERE  SR.RCT_NO = SIH.ATTR_CTNT4 AND MV.OFC_CD = MO.OFC_CD(+) AND MO.LOC_CD = ML.LOC_CD(+)
                                           AND    MV.RFND_PSDO_CUST_CD = SR.RCT_CUST_CNT_CD||TRIM(TO_CHAR(SR.RCT_CUST_SEQ, '000000')) AND ROWNUM = 1),
                                          (SELECT 'G5'|| ML.CNT_CD || LPAD(TO_CHAR(MV.VNDR_SEQ),6, '0') 
                                           FROM   SAR_ADJ_HDR SAH, MDM_VENDOR MV, MDM_ORGANIZATION MO, MDM_LOCATION ML 
                                           WHERE  SAH.ADJ_NO = SIH.ATTR_CTNT4 AND MV.OFC_CD = MO.OFC_CD(+) AND MO.LOC_CD = ML.LOC_CD(+)
                                           AND    MV.RFND_PSDO_CUST_CD = SAH.BIL_TO_CUST_CNT_CD||TRIM(TO_CHAR(SAH.BIL_TO_CUST_SEQ, '000000')) AND ROWNUM = 1))
                   WHEN SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND SAM.AR_ACCT_CD = SLCC.SGM_CTNT4 AND ROWNUM = 1),'N') = 'Y'
                        AND NVL((SELECT SR.RCT_CUST_CNT_CD FROM SAR_RECEIPT SR WHERE SR.RCT_NO = SIH.ATTR_CTNT4 AND ROWNUM = 1),
                                (SELECT SAH.BIL_TO_CUST_CNT_CD FROM SAR_ADJ_HDR SAH WHERE SAH.ADJ_NO = SIH.ATTR_CTNT4 AND ROWNUM = 1)) <> 'TB'         
                                 THEN NVL((SELECT 'G1' || SR.RCT_CUST_CNT_CD || LPAD(TO_CHAR(SR.RCT_CUST_SEQ), 6, '0') 
                                           FROM   SAR_RECEIPT SR WHERE SR.RCT_NO = SIH.ATTR_CTNT4 AND ROWNUM = 1),  
                                          (SELECT 'G1' || SAH.BIL_TO_CUST_CNT_CD || LPAD(TO_CHAR(SAH.BIL_TO_CUST_SEQ), 6, '0') 
                                           FROM   SAR_ADJ_HDR SAH WHERE SAH.ADJ_NO = SIH.ATTR_CTNT4 AND ROWNUM = 1))
                   WHEN SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND (SAM.LEGR_XCH_DIFF_INCM_ACCT_CD = SLCC.SGM_CTNT4 OR SAM.LEGR_XCH_DIFF_LSS_ACCT_CD = SLCC.SGM_CTNT4) AND ROWNUM = 1),'N') = 'Y' THEN 
                        'G5'|| ML.CNT_CD || LPAD(TO_CHAR(MV.VNDR_SEQ),6, '0')
                   WHEN SIH.ATTR_CATE_NM = 'ARAPOFFSET' THEN 'G5'|| ML.CNT_CD || LPAD(TO_CHAR(MV.VNDR_SEQ),6, '0') --2015.03.30 수정
                   ELSE NULL END                  AS CONTRACT_NUMBER --- Office SAP-ID  (Code Conversion)
            , CASE WHEN SID.LINE_TP_LU_CD = 'TAX' THEN NULL ELSE 'Z' END AS CONTRACT_TYPE  -- WHEN SIH.ATTR_CATE_NM = 'ARAPOFFSET' THEN NULL
            , NULL                                AS PAYMENT_REASON
            , CASE WHEN SID.LINE_TP_LU_CD = 'WITHHOLDING TAX' OR MA.ACCT_CD = '211691' THEN 'C130' ELSE NULL END AS CLASSIFICATION --2014.10.17 Withholding인 경우 상수값 추가
            , CASE WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM NOT IN ('REFUND', 'ARAPOFFSET') AND MA.ACCT_CD NOT LIKE '954%' AND MA.ACCT_CD <> '211691' THEN 
                        NVL((SELECT ML.MODI_LOC_CD FROM MDM_YARD MY, MDM_LOCATION ML WHERE MY.LOC_CD = ML.LOC_CD AND MY.YD_CD = SID.ATTR_CTNT12 AND ROWNUM = 1),
                            NVL((SELECT ML.MODI_LOC_CD FROM MDM_ORGANIZATION MO2, MDM_LOCATION ML WHERE MO2.LOC_CD = ML.LOC_CD AND MO2.OFC_CD = SID.ATTR_CTNT12 AND ROWNUM = 1), 
                                  (SELECT ML.MODI_LOC_CD FROM MDM_LOCATION ML WHERE ML.LOC_CD = SID.ATTR_CTNT12 AND ROWNUM = 1))) -- 2013.10.23 변경 --POL DTX code (Code Conversion)
                   WHEN SIH.AP_INV_SRC_CD = 'AR' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND (SAM.LEGR_XCH_DIFF_INCM_ACCT_CD = SLCC.SGM_CTNT4 OR SAM.LEGR_XCH_DIFF_LSS_ACCT_CD = SLCC.SGM_CTNT4) AND ROWNUM = 1),'N') = 'Y' THEN 
                        NVL((SELECT ML.MODI_LOC_CD FROM MDM_YARD MY, MDM_LOCATION ML WHERE MY.LOC_CD = ML.LOC_CD AND MY.YD_CD = SID.ATTR_CTNT12 AND ROWNUM = 1),
                            NVL((SELECT ML.MODI_LOC_CD FROM MDM_ORGANIZATION MO2, MDM_LOCATION ML WHERE MO2.LOC_CD = ML.LOC_CD AND MO2.OFC_CD = SID.ATTR_CTNT12 AND ROWNUM = 1), 
                                  (SELECT ML.MODI_LOC_CD FROM MDM_LOCATION ML WHERE ML.LOC_CD = SID.ATTR_CTNT12 AND ROWNUM = 1)))
              ELSE NULL END                       AS ACTIVITY_PLACE
            , NULL                                AS ENTERTAINMENT_EXP_ID
            , NULL                                AS BUDGET_MANAGE_DIVISION
            , CASE WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM NOT IN ('REFUND', 'ARAPOFFSET') AND MA.ACCT_CD NOT LIKE '954%' AND MA.ACCT_CD <> '211691' THEN --2015.02.05 수정
                        SUBSTR(REPLACE(REPLACE(SID.ATTR_CTNT11, '/', ''), '-', ''), 1, 8) 
                   WHEN SIH.AP_INV_SRC_CD = 'AR' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND (SAM.LEGR_XCH_DIFF_INCM_ACCT_CD = SLCC.SGM_CTNT4 OR SAM.LEGR_XCH_DIFF_LSS_ACCT_CD = SLCC.SGM_CTNT4) AND ROWNUM = 1),'N') = 'Y' THEN 
                        SUBSTR(REPLACE(REPLACE(SID.ATTR_CTNT11, '/', ''), '-', ''), 1, 8) ELSE NULL END -- 2014.10.29 --2014.10.23 변경
                                                  AS ACTIVITY_DATE
            , CASE WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM NOT IN ('REFUND', 'ARAPOFFSET') AND MA.ACCT_CD NOT LIKE '954%' AND MA.ACCT_CD <> '211691' AND SUBSTR(SLCC.SGM_CTNT6, 1, 4) NOT IN ('CFDR', '0000', 'CNTC', 'COMC') THEN 
                        (SELECT MVC.MODI_VSL_CD FROM MDM_VSL_CNTR MVC WHERE MVC.VSL_CD = SUBSTR(SLCC.SGM_CTNT6, 1, 4) AND ROWNUM = 1) --2014.10.23 변경 --Trunk Vessel DTX code (Code Conversion)
              ELSE NULL END                       AS VESSEL
            , CASE WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM NOT IN ('REFUND', 'ARAPOFFSET') AND MA.ACCT_CD NOT LIKE '954%' AND MA.ACCT_CD <> '211691' AND SUBSTR(SLCC.SGM_CTNT6, 1, 4) NOT IN ('CFDR', '0000', 'CNTC', 'COMC') THEN 
                        (SELECT MVC.MODI_VSL_CD FROM MDM_VSL_CNTR MVC WHERE MVC.VSL_CD = SUBSTR(SLCC.SGM_CTNT6, 1, 4) AND ROWNUM = 1) || SUBSTR(SLCC.SGM_CTNT6, 6, 3) ||
                        (SELECT SUBSTR(MVSLD.MODI_VSL_SLAN_DIR_CD, 1, 1) FROM MDM_VSL_SVC_LANE_DIR MVSLD 
                         WHERE  MVSLD.VSL_SLAN_CD = NVL(SID.ATTR_CTNT14, (SELECT VVS.VSL_SLAN_CD FROM VSK_VSL_SKD VVS WHERE VVS.VSL_CD||VVS.SKD_VOY_NO||VVS.SKD_DIR_CD = SUBSTR(SLCC.SGM_CTNT6, 1, 9) AND ROWNUM = 1))
                         AND    MVSLD.VSL_SLAN_DIR_CD = SUBSTR(SLCC.SGM_CTNT6, 9, 1)) -- 2014.10.23 변경  --Trunk VVD DTX code (Code Conversion)
              ELSE NULL END                       AS VVL_CODE
            , NULL                                AS HOUSE_BANK
            , NULL                                AS PAYMENT_BLOCK_KEY
            , @[usr_id]                           AS CRE_USR_ID
            , SYSDATE                             AS CRE_DT
            , @[usr_id]                           AS UPD_USR_ID
            , SYSDATE                             AS UPD_DT
            , 'N'                                 AS INTERFACE_FLAG
            , NULL                                AS INTERFACE_FILE_ID
            , NULL                                AS INTERFACE_DATE
            , CASE WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM NOT IN ('REFUND', 'ARAPOFFSET') AND MA.ACCT_CD NOT LIKE '954%' AND MA.ACCT_CD <> '211691' THEN 'ITEM(PL)'
                   WHEN SID.LINE_TP_LU_CD IN ('ITEM', 'MISCELLANEOUS', 'FREIGHT') AND SIH.ATTR_CATE_NM NOT IN ('REFUND', 'ARAPOFFSET') AND MA.ACCT_CD LIKE '954%' THEN 'ITEM(CLEAR)'
                   WHEN MA.ACCT_CD = '211691' THEN 'WITHHOLDING TAX(ITEM)'
                   WHEN SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND SAM.AR_ACCT_CD = SLCC.SGM_CTNT4 AND ROWNUM = 1),'N') = 'Y' THEN 'ITEM(REFUND)'
                   WHEN SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND (SAM.LEGR_XCH_DIFF_INCM_ACCT_CD = SLCC.SGM_CTNT4 ) AND ROWNUM = 1),'N') = 'Y' THEN 'ITEM(REFUND/GAIN)'
                   WHEN SIH.ATTR_CATE_NM = 'REFUND' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND (SAM.LEGR_XCH_DIFF_LSS_ACCT_CD = SLCC.SGM_CTNT4) AND ROWNUM = 1),'N') = 'Y' THEN 'ITEM(REFUND/LOSS)'
                   WHEN SIH.ATTR_CATE_NM = 'ARAPOFFSET' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND SAM.AR_ACCT_CD = SLCC.SGM_CTNT4 AND ROWNUM = 1),'N') = 'Y' THEN 'OFFSET' 
                   WHEN SIH.ATTR_CATE_NM = 'ARAPOFFSET' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND (SAM.LEGR_XCH_DIFF_INCM_ACCT_CD = SLCC.SGM_CTNT4 ) AND ROWNUM = 1),'N') = 'Y' THEN 'OFFSET/GAIN'
                   WHEN SIH.ATTR_CATE_NM = 'ARAPOFFSET' AND NVL((SELECT  'Y' FROM SAR_ACCT_MTX SAM WHERE SAM.PAY_ACCT_CD IS NOT NULL AND (SAM.LEGR_XCH_DIFF_LSS_ACCT_CD = SLCC.SGM_CTNT4) AND ROWNUM = 1),'N') = 'Y' THEN 'OFFSET/LOSS' 
              ELSE SID.LINE_TP_LU_CD END AS IF_ITEM_CATEGROY
      FROM    SAP_INV_HDR SIH
            , SAP_INV_DTL SID
            , SCO_LEGR_CD_CMB SLCC
            , COM_USER CU  -- 2014.10.17 -- User 정보 추가
            , MDM_ACCOUNT MA -- 2014.10.23 추가 
            , MDM_ORGANIZATION MO --2015.01.19 추가
            , MDM_VENDOR MV --2015.01.21 추가
            , MDM_ORGANIZATION MO2 --2015.03.30 추가
            , MDM_LOCATION ML --2015.03.30 추가
      WHERE   SIH.INV_SEQ = SID.INV_SEQ 
      AND     SID.DTRB_CD_CMB_SEQ = SLCC.CD_CMB_SEQ
      AND     TO_NUMBER(SIH.VNDR_NO) = MV.VNDR_SEQ --2015.01.21 추가
      AND     SIH.CRE_USR_ID = CU.USR_ID  -- 2014.10.17 -- User 정보 추가
      AND     SIH.OFC_CD = MO.OFC_CD --2015.01.19 추가
      AND     MV.OFC_CD = MO2.OFC_CD -- 2015.03.30 추가
      AND     MO2.LOC_CD = ML.LOC_CD -- 2015.03.30 추가
      AND     SLCC.SGM_CTNT4 = MA.ACCT_CD -- 2014.10.23 추가 
      AND     SID.LINE_TP_LU_CD <> 'PREPAY'   -- 2014/10/06 선급금 정산 Line 제외
      AND     SID.DTRB_AMT <> 0 --2015.02.03 추가
      AND     SIH.INV_SEQ = @[inv_seq]			]]></sql>
			<params>
				<param name="slip_interface_seq" type="12" value="" out="N"/>
				<param name="functional_currency" type="12" value="" out="N"/>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="inv_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
