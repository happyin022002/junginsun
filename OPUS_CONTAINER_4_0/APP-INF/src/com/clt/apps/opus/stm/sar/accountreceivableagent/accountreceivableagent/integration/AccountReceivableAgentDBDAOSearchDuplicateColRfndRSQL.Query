<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivableAgentDBDAOSearchDuplicateColRfndRSQL">
			<desc><![CDATA[SearchDuplicateColRfnd]]></desc>
			<sql><![CDATA[
SELECT SUBSTR(XMLAGG (XMLELEMENT (X , ',', BL_NO) ORDER BY BL_NO).EXTRACT ( '//text()' ), 2) BL_LIST
FROM (
        SELECT DISTINCT BL_NO
        FROM (
              SELECT AR_OFC_CD, BL_NO, INV_NO, CHG_TP_CD, 'USD' BL_CURR_CD, USD_AMT ADJ_AMT
              FROM SAR_AGN_CLT_RFND_MST
              WHERE ASA_NO = @[asa_no]
              AND NVL(USD_AMT, 0) <> 0
              UNION ALL
              SELECT AR_OFC_CD, BL_NO, INV_NO, CHG_TP_CD, LOCL_CURR_CD BL_CURR_CD, LOCL_AMT ADJ_AMT
              FROM SAR_AGN_CLT_RFND_MST
              WHERE ASA_NO = @[asa_no]
              AND NVL(LOCL_AMT, 0) <> 0
              UNION ALL
              SELECT AR_OFC_CD, BL_NO, INV_NO, CHG_TP_CD, N3RD_CURR_CD1 BL_CURR_CD, N3RD_AMT1 ADJ_AMT
              FROM SAR_AGN_CLT_RFND_MST
              WHERE ASA_NO = @[asa_no]
              AND NVL(N3RD_AMT1, 0) <> 0
              UNION ALL
              SELECT AR_OFC_CD, BL_NO, INV_NO, CHG_TP_CD, N3RD_CURR_CD2 BL_CURR_CD, N3RD_AMT2 ADJ_AMT
              FROM SAR_AGN_CLT_RFND_MST
              WHERE ASA_NO = @[asa_no]
              AND NVL(N3RD_AMT2, 0) <> 0
              UNION ALL
              SELECT AR_OFC_CD, BL_NO, INV_NO, CHG_TP_CD, N3RD_CURR_CD3 BL_CURR_CD, N3RD_AMT3 ADJ_AMT
              FROM SAR_AGN_CLT_RFND_MST
              WHERE ASA_NO = @[asa_no]
              AND NVL(N3RD_AMT3, 0) <> 0
              UNION ALL
              SELECT AR_OFC_CD, BL_NO, INV_NO, CHG_TP_CD, N3RD_CURR_CD4 BL_CURR_CD, N3RD_AMT4 ADJ_AMT
              FROM SAR_AGN_CLT_RFND_MST
              WHERE ASA_NO = @[asa_no]
              AND NVL(N3RD_AMT4, 0) <> 0
             ) A
        WHERE EXISTS (SELECT 'X'
                      FROM SAR_OTS_DTL
                      WHERE OTS_OFC_CD = A.AR_OFC_CD
                      AND BL_NO = A.BL_NO
                      AND INV_NO = A.INV_NO
                      AND CHG_TP_CD = A.CHG_TP_CD
                      AND BL_CURR_CD = A.BL_CURR_CD
                      AND BAL_AMT = 0)
     )			]]></sql>
			<params>
				<param name="asa_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
