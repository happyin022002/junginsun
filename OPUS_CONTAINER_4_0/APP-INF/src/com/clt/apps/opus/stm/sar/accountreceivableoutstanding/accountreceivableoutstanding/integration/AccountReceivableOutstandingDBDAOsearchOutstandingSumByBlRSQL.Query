<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivableOutstandingDBDAOsearchOutstandingSumByBlRSQL">
			<desc><![CDATA[Outstanding Inquiry by B/L(Invoice)  Summary]]></desc>
			<sql><![CDATA[
WITH CURRENCY
AS (
    SELECT MC.DP_PRCS_KNT
      FROM SAR_OTS_HDR SOH,
           MDM_CURRENCY MC
     WHERE SOH.OFC_CURR_CD = MC.CURR_CD(+)
       AND SOH.BL_NO = @[bl_no]
       AND SOH.RHQ_CD = @[rhq_cd]
       AND SOH.OTS_OFC_CD = @[ots_ofc_cd]
       AND SOH.INV_NO = @[inv_no] )
SELECT 
         A.RHQ_CD
       , A.OTS_OFC_CD
       , A.BL_NO
       , A.INV_NO       
       , SUM(ROUND(A.INV_AMT * A.LOCL_XCH_RT,CURR.DP_PRCS_KNT)) AS INV_LOCL_AMT        
       , SUM(ROUND(A.INV_AMT * A.USD_XCH_RT, 2)) AS INV_USD_AMT
       , SUM(ROUND(A.RCT_AMT * A.LOCL_XCH_RT, CURR.DP_PRCS_KNT)) AS RCT_LOCL_AMT        
       , SUM(ROUND(A.RCT_AMT * A.USD_XCH_RT, 2)) AS RCT_USD_AMT
       , SUM(ROUND(A.ADJ_AMT * A.LOCL_XCH_RT, CURR.DP_PRCS_KNT)) AS ADJ_LOCL_AMT        
       , SUM(ROUND(A.ADJ_AMT * A.USD_XCH_RT, 2)) AS ADJ_USD_AMT
       , SUM(ROUND(A.BAL_LOCL_AMT, CURR.DP_PRCS_KNT))  AS BAL_LOCL_AMT     
       , SUM(ROUND(A.BAL_USD_AMT, 2))  AS BAL_USD_AMT
FROM     SAR_OTS_DTL A,CURRENCY CURR
WHERE 1 = 1      
  AND A.BL_NO = @[bl_no]
  AND A.RHQ_CD = @[rhq_cd]
  AND A.OTS_OFC_CD = @[ots_ofc_cd]
  AND A.INV_NO = @[inv_no]
GROUP BY 
         A.RHQ_CD
       , A.OTS_OFC_CD
       , A.BL_NO
       , A.INV_NO
       , CURR.DP_PRCS_KNT			]]></sql>
			<params>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="rhq_cd" type="12" value="" out="N"/>
				<param name="ots_ofc_cd" type="12" value="" out="N"/>
				<param name="inv_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
