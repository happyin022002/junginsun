<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivableOutstandingDBDAOSearchOTSAgingBaseCntListRSQL">
			<desc><![CDATA[Select Aging Count]]></desc>
			<sql><![CDATA[
SELECT  
        '' AS SAIL_ARR_DT
		#if(${sum_ofc_cust_tp} == 'OFC')
           #if(${sum_tp} == 'OFC')
      		, A.CLT_OFC_CD
		    , A.CLT_OFC_CD AS PRIMARY_KEY
           #else      
    		, MAX(A.CLT_OFC_CD) AS CLT_OFC_CD
            , '' AS CUST_LGL_ENG_NM
		    , MAX(A.CLT_OFC_CD) AS PRIMARY_KEY
           #end
		#elseif(${sum_ofc_cust_tp} == 'CUST')
		, A.CLT_OFC_CD
		, A.BIL_TO_CUST_CNT_CD
		, A.BIL_TO_CUST_SEQ
		, A.CLT_OFC_CD || A.BIL_TO_CUST_CNT_CD || A.BIL_TO_CUST_SEQ AS PRIMARY_KEY
		, (
		   SELECT CUST_LGL_ENG_NM 
		   FROM MDM_CUSTOMER 
		   WHERE CUST_CNT_CD = A.BIL_TO_CUST_CNT_CD AND CUST_SEQ = A.BIL_TO_CUST_SEQ
		   ) AS CUST_LGL_ENG_NM
		
		#end
        , COUNT(CASE WHEN A.BKG_IO_BND_CD ='I' THEN 1 ELSE NULL END) AS IB_CNT
	    , COUNT(CASE WHEN A.BKG_IO_BND_CD ='O' THEN 1 ELSE NULL END) AS OB_CNT
		, COUNT(A.RHQ_CD) AS TOT_CNT
FROM SAR_OTS_HDR A
WHERE 1 = 1
#if(${stl_flg} != '')
AND A.STL_FLG = @[stl_flg]
#end

#if(${cr_mk_flg} != '')
AND A.CR_MK_FLG = @[cr_mk_flg]
#end

#if(${ots_grp_tp_cd} != '')
AND A.OTS_GRP_TP_CD = @[ots_grp_tp_cd]
#end

#if(${bl_sum_tp} == 'OTS')
AND EXISTS (SELECT 1 
              FROM SAR_OTS_DTL                      
            WHERE 1 = 1
            AND RHQ_CD = A.RHQ_CD
            AND OTS_OFC_CD = A.OTS_OFC_CD
            AND BL_NO = A.BL_NO
            AND INV_NO = A.INV_NO
            AND BAL_AMT > 0)

#elseif(${bl_sum_tp} == 'OPY')
AND EXISTS (SELECT 1 
              FROM SAR_OTS_DTL                      
            WHERE 1 = 1
            AND RHQ_CD = A.RHQ_CD
            AND OTS_OFC_CD = A.OTS_OFC_CD
            AND BL_NO = A.BL_NO
            AND INV_NO = A.INV_NO
            AND BAL_AMT < 0)
#end

#if(${bl_inv_tp} == 'INV')
AND A.INV_NO <> '**********'
#elseif(${bl_inv_tp} == 'BL')
AND A.INV_NO = '**********'
#end

#if(${ots_src_cd} != '')
  #if(${ots_src_cd} == 'OTHER')
    AND (A.OTS_SRC_CD IN (SELECT LU_CD 
                           FROM SCO_LU_DTL 
                          WHERE LU_TP_CD = 'OTS SRC CD'  
                            AND LU_CD NOT IN ('INVAR','BMS','JO','CDAM','AGENT','3RD')
                         )
         OR A.OTS_SRC_CD IS NULL 
         )
  #else   
	AND A.OTS_SRC_CD = @[ots_src_cd]
  #end
#end


#if(${clt_ofc_cd} != '')
AND A.CLT_OFC_CD IN (${clt_ofc_cd})
#end

#if(${due_tp} == 'BAD_OTS')
AND 1 = 1
#elseif(${due_tp} == 'WI_TERM_OTS')
AND A.DUE_DT >= @[due_dt]
#end

#if(${sail_arr_dt} != '')
AND A.SAIL_ARR_DT >= @[sail_arr_dt]
#end

#if(${ots_rt_flg} != '')
AND A.OTS_RT_FLG = @[ots_rt_flg]
#end

#if(${bil_to_cust_cnt_cd} != '')
AND A.BIL_TO_CUST_CNT_CD = @[bil_to_cust_cnt_cd]
#end

#if(${bil_to_cust_seq} != '')
AND A.BIL_TO_CUST_SEQ = @[bil_to_cust_seq]
#end

#if(${sum_ofc_cust_tp} == 'OFC' && ${sum_tp} == 'OFC')
GROUP BY 
  A.CLT_OFC_CD
#elseif(${sum_ofc_cust_tp} == 'CUST')
GROUP BY
  A.CLT_OFC_CD
, A.BIL_TO_CUST_CNT_CD
, A.BIL_TO_CUST_SEQ
#end			]]></sql>
			<params>
				<param name="stl_flg" type="12" value="" out="N"/>
				<param name="cr_mk_flg" type="12" value="" out="N"/>
				<param name="ots_grp_tp_cd" type="12" value="" out="N"/>
				<param name="ots_src_cd" type="12" value="" out="N"/>
				<param name="due_dt" type="12" value="" out="N"/>
				<param name="sail_arr_dt" type="12" value="" out="N"/>
				<param name="ots_rt_flg" type="12" value="" out="N"/>
				<param name="bil_to_cust_cnt_cd" type="12" value="" out="N"/>
				<param name="bil_to_cust_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
