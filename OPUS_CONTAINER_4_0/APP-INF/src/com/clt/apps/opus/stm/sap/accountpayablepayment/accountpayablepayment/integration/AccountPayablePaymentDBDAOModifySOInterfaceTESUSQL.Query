<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountPayablePaymentDBDAOModifySOInterfaceTESUSQL">
			<desc><![CDATA[ModifySOInterfaceTES]]></desc>
			<sql><![CDATA[
--UPDATE TES_TML_SO_HDR
--SET PAY_FLG = 'Y', PAY_DT = TO_DATE(SUBSTR(?,1,8),'YYYY-MM-DD'), TML_INV_STS_CD = 'D'  
--WHERE CSR_NO = ?
UPDATE TES_TML_SO_HDR A
SET (A.PAY_FLG, A.PAY_DT, A.TML_INV_STS_CD)
    = (
       SELECT 'Y'
             ,MAX(SPH.PAY_DT) PAY_DT
             ,@[status]
       FROM  SAP_INV_HDR SIH
            ,SAP_PAY_HDR SPH 
            ,SAP_PAY_DTL SPD
       WHERE SPH.PAY_SEQ = SPD.PAY_SEQ
       AND   SIH.INV_SEQ = SPD.INV_SEQ
       AND   SIH.INV_NO = A.CSR_NO
       GROUP BY SIH.INV_NO, SIH.PAY_MZD_LU_CD
      ) 
WHERE   A.CSR_NO = @[csr_no]
AND EXISTS  (
              SELECT 'Y'
              FROM  SAP_INV_HDR SIH
              WHERE 1=1
              AND SIH.INV_NO = A.CSR_NO              
            )			]]></sql>
			<params>
				<param name="status" type="12" value="" out="N"/>
				<param name="csr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
