<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivableCreateAccountingDBDAOsearchCreateOtsLedgerListRSQL">
			<desc><![CDATA[Create Ots Ledger List]]></desc>
			<sql><![CDATA[
SELECT 
SLH.EFF_YRMON        EFF_YRMON 
,SLH.RHQ_CD           RHQ_CD 
,SLD.OTS_OFC_CD       OTS_OFC_CD 
,SLD.DMST_DR_ACCT_CD  DMST_DR_ACCT_CD 
,SLH.OTS_TP_CD        OTS_TP_CD 
,SLD.BL_CURR_CD       BL_CURR_CD
,SAR_GET_CUR_AMT_FNC(SLD.BL_CURR_CD,NVL(SUM(SLD.PRE_BAL_AMT ),0)) AS PRV_BAL  
,SAR_GET_CUR_AMT_FNC(SLD.BL_CURR_CD,NVL(SUM(SLD.THS_MON_AMT),0)) AS THS_AMT 
,SAR_GET_CUR_AMT_FNC(SLD.BL_CURR_CD,NVL(SUM(SLD.THS_MON_BAL_AMT),0)) AS THS_BAL 
,SAR_GET_CUR_AMT_FNC(SLD.BL_CURR_CD,NVL(SUM(SLD.THS_MON_BAL_AMT),0)) AS ths_bal_ck   
,SAR_GET_CUR_AMT_FNC('JPY',NVL(SUM(SLD.THS_MON_BAL_FUNC_AMT),0)) AS COP_KRW 
,SAR_GET_CUR_AMT_FNC('USD',NVL(SUM(SLD.THS_MON_BAL_USD_AMT),0)) AS COP_USD   
,'' END_KRW 
,'' END_USD
--       NVL(SUM(SLH.ths_bal_clskrw ), 0) AS END_KRW , 
--       NVL(SUM(SLH.ths_bal_clsusd ), 0) AS END_USD
,'' GL_MONTH
,'' THS_BAL_CK
,'' AR_OFC_CD
,'' AR_RHQ_CD
,'' AR_DMST_DR_ACCT_CD
,'' GL_SLDTH
,'' SOURCE
,'' CURR
,'' AR_ACCT_CD 
,'' FUNC_CURR 
FROM SAR_OTS_LEGR_HDR SLH
 ,   SAR_OTS_LEGR_DTL SLD
WHERE 1=1
  AND SLH.EFF_YRMON     = SLD.EFF_YRMON
  AND SLH.RHQ_CD        = SLD.RHQ_CD
  AND SLH.OTS_OFC_CD    = SLD.OTS_OFC_CD
  AND SLH.BL_NO         = SLD.BL_NO
  AND SLH.INV_NO        = SLD.INV_NO
  AND    (NVL(SLD.PRE_BAL_AMT, 0)<>0  
        OR     NVL(SLD.THS_MON_AMT , 0)<>0 
        OR     NVL(SLD.THS_MON_BAL_AMT , 0) <>0)
#if (${gl_month} != '' )
	AND SLH.EFF_YRMON = REPLACE( @[gl_month] ,'-','')
#end

#if (${ar_rhq_cd} != '' )
	AND SLH.RHQ_CD =  @[ar_rhq_cd]
#end

#if (${ar_ofc_cd} != '' )
	AND SLH.OTS_OFC_CD =  @[ar_ofc_cd]
#end

#if (${ar_dmst_dr_acct_cd} != '' )
	AND SLH.AR_DMST_DR_ACCT_CD =  @[ar_dmst_dr_acct_cd]
#end

#if (${curr} != '' )
	AND SLD.BL_CURR_CD =  @[curr]
#end

#if (${ar_acct_cd} != '' )
	AND SLD.DMST_DR_ACCT_CD =  @[ar_acct_cd]
#end

#if ( ${source} == 'INVAR' )
    AND SLH.OTS_TP_CD = 'INVAR'
#elseif  (${source} == 'BMS' )
    AND SLH.OTS_TP_CD = 'BMS' 

#elseif ( ${source} == 'OTHER' )	 	
    AND SLH.OTS_TP_CD = 'OTHER' 	
                     
#elseif ( ${source} == 'JOO' ) 
    AND SLH.OTS_TP_CD = 'JOO' 		
                  
#elseif ( ${source} == 'FMS' )
    AND SLH.OTS_TP_CD = 'FMS' 

#elseif ( ${source} == 'STM A%' )
    AND SLH.OTS_TP_CD LIKE 'STM A%'
#elseif  (${source} == 'TPB' )
    AND SLH.OTS_TP_CD = 'TPB' 
#end
GROUP BY SLH.EFF_YRMON , SLH.RHQ_CD , SLD.OTS_OFC_CD, SLD.DMST_DR_ACCT_CD , SLH.OTS_TP_CD , SLD.BL_CURR_CD			]]></sql>
			<params>
				<param name="gl_month" type="12" value="" out="N"/>
				<param name="ar_rhq_cd" type="12" value="" out="N"/>
				<param name="ar_ofc_cd" type="12" value="" out="N"/>
				<param name="ar_dmst_dr_acct_cd" type="12" value="" out="N"/>
				<param name="curr" type="12" value="" out="N"/>
				<param name="ar_acct_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
