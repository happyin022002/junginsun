<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountPayableInvoiceDBDAOModifyInterfaceSAPStandardNonJPDRCRDiffInfoUSQL">
			<desc><![CDATA[SAKURA로 I/F된 내역 중 Prepayment와 Apply된 경우 건별 Accounted 금액의 산출과 합계 금액의 Accounted 금액 Diff 내역을 조정 처리]]></desc>
			<sql><![CDATA[
UPDATE SAP_AP_IF SAI
SET    SAI.LOCL_AMT = SAI.LOCL_AMT + (((SELECT  SUM(DECODE(SAI3.PST_KEY_CD, '40', SAI3.LOCL_AMT, '21', SAI3.LOCL_AMT, '01', SAI3.LOCL_AMT, 0)) 
                                        FROM    SAP_AP_IF SAI3 
                                        WHERE   SAI3.REF_DOC_NO = @[csr_no])
                                     - (SELECT  SUM(DECODE(SAI3.PST_KEY_CD, '50', SAI3.LOCL_AMT, '31', SAI3.LOCL_AMT, '11', SAI3.LOCL_AMT, 0)) 
                                        FROM    SAP_AP_IF SAI3 
                                        WHERE   SAI3.REF_DOC_NO = @[csr_no])) * (-1))
WHERE  SAI.REF_DOC_NO = @[csr_no]
AND    AP_IF_SEQ = (SELECT  MAX(SAI2.AP_IF_SEQ) 
                    FROM    SAP_AP_IF SAI2 
                    WHERE   SAI2.REF_DOC_NO = @[csr_no] AND SAI2.PST_KEY_CD IN ('40', '21', '01') AND SAI2.LOCL_AMT IS NOT NULL )
AND    (SELECT  SUM(DECODE(SAI3.PST_KEY_CD, '40', SAI3.LOCL_AMT, '21', SAI3.LOCL_AMT, '01', SAI3.LOCL_AMT, 0)) 
        FROM    SAP_AP_IF SAI3 
        WHERE   SAI3.REF_DOC_NO = @[csr_no])
       <> (SELECT  SUM(DECODE(SAI3.PST_KEY_CD, '50', SAI3.LOCL_AMT, '31', SAI3.LOCL_AMT, '11', SAI3.LOCL_AMT, 0)) 
           FROM    SAP_AP_IF SAI3 
           WHERE   SAI3.REF_DOC_NO = @[csr_no])			]]></sql>
			<params>
				<param name="csr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
