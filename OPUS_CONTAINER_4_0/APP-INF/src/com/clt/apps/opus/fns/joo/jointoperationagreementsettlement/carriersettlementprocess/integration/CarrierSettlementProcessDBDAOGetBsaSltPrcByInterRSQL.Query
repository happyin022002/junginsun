<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CarrierSettlementProcessDBDAOGetBsaSltPrcByInterRSQL">
			<desc><![CDATA[Inter OUS RDR의 경우 VVD, FROM/To Port 변경시 Slot Price 정보를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT CASE WHEN SM.BSA_SLT_PRC1 > 0 THEN SM.BSA_SLT_PRC1
            ELSE SM.BSA_SLT_PRC2
       END AS BSA_SLT_PRC
  FROM (SELECT NVL((SELECT MAX(CD.UC_AMT) AS BSA_SLT_PRC
                          FROM BSA_OVR_USD_MST CM
                             , BSA_OVR_USD_SLT_PRC CD
                         WHERE CM.OVR_USD_SLT_PRC_SEQ = CD.OVR_USD_SLT_PRC_SEQ
                           AND CD.UC_AMT <> 0
                           AND CM.DELT_FLG = 'N'
                           AND CM.TRD_CD = @[trd_cd]
                           AND CM.RLANE_CD = @[rlane_cd]
						   #if (${re_divr_cd} == 'R')
                           AND CD.CRR_CD = @[jo_crr_cd] /*Revenue 일때만 적용한다.*/
                           #end
                           AND CM.DIR_CD = @[skd_dir_cd]
                           AND SUBSTR(REPLACE(@[uc_bss_port_etd_dt],'-'),1,8) BETWEEN CM.BSA_SLT_PRC_FM_DT AND CM.BSA_SLT_PRC_TO_DT
                           AND CM.FM_PORT_CD = @[fm_port_cd]
                           AND CM.TO_PORT_CD = @[to_port_cd]), 0) AS BSA_SLT_PRC1
             , NVL((SELECT SUM(CP.UC_AMT) AS BSA_SLT_PRC
                          FROM BSA_OCN_OVR_SLT_PRC CP
                             , BSA_OCN_OVR_MST CM
                         WHERE CM.BSA_SLT_COST_TP_CD = CP.BSA_SLT_COST_TP_CD
                           AND CM.OVR_USD_SLT_PRC_SEQ = CP.OVR_USD_SLT_PRC_SEQ
                           AND CM.TRD_CD = CP.TRD_CD
                           AND CM.RLANE_CD = CP.RLANE_CD
                           AND CM.DIR_CD = CP.DIR_CD
                           AND CM.DELT_FLG = 'N'
                           AND CP.TRD_CD = @[trd_cd]
                           AND CP.RLANE_CD = @[rlane_cd]
						   AND CP.CRR_CD = @[jo_crr_cd]
                           AND CP.DIR_CD = @[skd_dir_cd]
                           AND CP.BSA_SLT_COST_TP_CD = '021' /*Shot Leg 코드값.*/
                           AND SUBSTR(REPLACE(@[uc_bss_port_etd_dt],'-'),1,8) BETWEEN CM.BSA_SLT_PRC_FM_DT AND CM.BSA_SLT_PRC_TO_DT ), 0) AS BSA_SLT_PRC2
          FROM DUAL 
        ) SM			]]></sql>
			<params>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="jo_crr_cd" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="uc_bss_port_etd_dt" type="12" value="" out="N"/>
				<param name="fm_port_cd" type="12" value="" out="N"/>
				<param name="to_port_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
