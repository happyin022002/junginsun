<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CarrierSettlementProcessDBDAOSearchSlotXchStatusListByFinancePartnerRSQL">
			<desc><![CDATA[dsfsdf]]></desc>
			<sql><![CDATA[
WITH P AS (SELECT SUBSTR( @[acct_yrmon],1,4)||'01' ACCT_YRMON_FR ,REPLACE( @[acct_yrmon] , '-')ACCT_YRMON, @[re_divr_cd] RE_DIVR_CD    FROM DUAL)
SELECT
       S.JO_CRR_CD
,      SUM(S.CUR_STL_BSA_QTY  )CUR_STL_BSA_QTY
,      SUM(S.STL_LOCL_AMT     )STL_LOCL_AMT
,      SUM(S.TERM_STL_BSA_QTY )TERM_STL_BSA_QTY
,      SUM(S.TERM_STL_LOCL_AMT)TERM_STL_LOCL_AMT
 FROM(
    SELECT   /*+  ORDERED  */
             A.JO_CRR_CD
            ,SUM(CASE WHEN A.ACCT_YRMON=P.ACCT_YRMON
                      THEN ( CASE WHEN A.STL_ADJ_FLG= 'Y' 
                                  THEN B.BSA_QTY
                                  ELSE A.BSA_QTY END)
                       ELSE 0 END 
                 )CUR_STL_BSA_QTY
            ,SUM(CASE WHEN A.ACCT_YRMON=P.ACCT_YRMON
                      THEN B.STL_LOCL_AMT
                      ELSE 0 END 
                 )STL_LOCL_AMT
                      
            ,SUM(CASE WHEN A.ACCT_YRMON BETWEEN P.ACCT_YRMON_FR AND P.ACCT_YRMON
                      THEN ( CASE WHEN A.STL_ADJ_FLG= 'Y' 
                                  THEN B.BSA_QTY
                                  ELSE A.BSA_QTY END)
                       ELSE 0 END 
                 )TERM_STL_BSA_QTY          
            ,SUM(CASE WHEN A.ACCT_YRMON BETWEEN P.ACCT_YRMON_FR AND P.ACCT_YRMON
                      THEN ( CASE WHEN A.STL_ADJ_FLG= 'Y' 
                                  THEN B.STL_LOCL_AMT
                                  ELSE
                                       0
                                  END)
                       ELSE 0 END 
                 )TERM_STL_LOCL_AMT
    FROM  JOO_SETTLEMENT A,
          JOO_STL_DTL    B, 
          P, JOO_CRR_AUTH AUTH 
    WHERE A.ACCT_YRMON    = B.ACCT_YRMON (+)
    AND   A.STL_VVD_SEQ   = B.STL_VVD_SEQ(+)
    AND   A.STL_SEQ       = B.STL_SEQ    (+)
    AND   A.RE_DIVR_CD    = P.RE_DIVR_CD
    AND   A.JO_STL_ITM_CD = 'OUS'
    AND   A.JO_CRR_CD = AUTH.JO_CRR_CD
    AND   A.RLANE_CD  = AUTH.RLANE_CD
    AND   AUTH.AUTH_OFC_CD = @[ofc_cd]
    AND    AUTH.DELT_FLG = 'N'
    AND   A.ACCT_YRMON   BETWEEN  P.ACCT_YRMON_FR  AND P.ACCT_YRMON AND A.STL_LOCL_AMT<>0
    GROUP BY A.JO_CRR_CD
    UNION ALL
    SELECT   /*+  ORDERED  */
             A.JO_CRR_CD
            ,0 CUR_STL_BSA_QTY
            ,0 STL_LOCL_AMT    
            ,0 TERM_STL_BSA_QTY          
            ,SUM(CASE WHEN A.ACCT_YRMON BETWEEN P.ACCT_YRMON_FR AND P.ACCT_YRMON
                      THEN ( CASE WHEN A.STL_ADJ_FLG= 'Y' 
                                  THEN 0
                                  ELSE
                                        NVL(SL1_06.CSR_LOCL_AMT , 0)
                                  END)
                       ELSE 0 END 
                 )TERM_STL_LOCL_AMT
    FROM  JOO_SETTLEMENT A,
          JOO_STL_DTL    B, 
          JOO_SLIP       SL1_06,
           P, JOO_CRR_AUTH AUTH 
    WHERE A.ACCT_YRMON    = B.ACCT_YRMON (+)
    AND   A.STL_VVD_SEQ   = B.STL_VVD_SEQ(+)
    AND   A.STL_SEQ       = B.STL_SEQ    (+)
    AND   A.RE_DIVR_CD    = P.RE_DIVR_CD
    AND   A.JO_CRR_CD = AUTH.JO_CRR_CD
    AND   A.RLANE_CD  = AUTH.RLANE_CD
    AND   AUTH.AUTH_OFC_CD = @[ofc_cd]
    AND    AUTH.DELT_FLG = 'N'
    AND   A.JO_STL_ITM_CD = 'OUS'  AND A.STL_LOCL_AMT<>0
    AND   A.ACCT_YRMON  = SL1_06.ACCT_YRMON(+)
    AND   A.STL_VVD_SEQ = SL1_06.STL_VVD_SEQ(+)
    AND   A.STL_SEQ     = SL1_06.STL_SEQ(+)
    AND   SL1_06.SLP_TP_CD(+) = '06' --18수입, 06비용
    AND   SL1_06.DR_CR_CD(+)  = 'DR'
    AND   A.ACCT_YRMON   BETWEEN  P.ACCT_YRMON_FR  AND P.ACCT_YRMON   
    GROUP BY A.JO_CRR_CD
    UNION ALL
    SELECT   /*+  ORDERED  */
             A.JO_CRR_CD
            ,0 CUR_STL_BSA_QTY
            ,SUM(CASE WHEN A.ACCT_YRMON=P.ACCT_YRMON
                      THEN ( CASE WHEN A.STL_ADJ_FLG= 'Y' 
                                  THEN 0
                                  ELSE 
                                       NVL(SL1_18.CSR_LOCL_AMT , 0)
                                  END)
                       ELSE 0 END 
                 )STL_LOCL_AMT
            ,0 TERM_STL_BSA_QTY          
            ,0 TERM_STL_LOCL_AMT
    FROM  JOO_SETTLEMENT A,
          JOO_STL_DTL    B, 
          JOO_SLIP       SL1_18,
           P, JOO_CRR_AUTH AUTH 
    WHERE A.ACCT_YRMON    = B.ACCT_YRMON (+)
    AND   A.STL_VVD_SEQ   = B.STL_VVD_SEQ(+)
    AND   A.STL_SEQ       = B.STL_SEQ    (+)
    AND   A.RE_DIVR_CD    = P.RE_DIVR_CD
    AND   A.JO_CRR_CD = AUTH.JO_CRR_CD
    AND   A.RLANE_CD  = AUTH.RLANE_CD
    AND   AUTH.AUTH_OFC_CD = @[ofc_cd]
    AND    AUTH.DELT_FLG = 'N'
    AND   A.JO_STL_ITM_CD = 'OUS'  AND A.STL_LOCL_AMT<>0
    AND   A.ACCT_YRMON  = SL1_18.ACCT_YRMON(+)
    AND   A.STL_VVD_SEQ = SL1_18.STL_VVD_SEQ(+)
    AND   A.STL_SEQ     = SL1_18.STL_SEQ(+)
    AND   SL1_18.SLP_TP_CD(+) = '18' --18수입, 06비용
    AND   SL1_18.DR_CR_CD(+)  = 'DR'
    AND   A.ACCT_YRMON   BETWEEN  P.ACCT_YRMON_FR  AND P.ACCT_YRMON
    GROUP BY A.JO_CRR_CD
    )S
GROUP BY S.JO_CRR_CD
ORDER BY S.JO_CRR_CD			]]></sql>
			<params>
				<param name="acct_yrmon" type="12" value="" out="N"/>
				<param name="re_divr_cd" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
