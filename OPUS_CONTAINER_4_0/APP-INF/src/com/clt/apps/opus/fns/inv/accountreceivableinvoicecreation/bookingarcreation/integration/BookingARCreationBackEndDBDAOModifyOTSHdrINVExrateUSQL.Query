<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingARCreationBackEndDBDAOModifyOTSHdrINVExrateUSQL">
			<desc><![CDATA[Modify OTS Hdr INV Exrate]]></desc>
			<sql><![CDATA[
UPDATE SAR_OTS_HDR 
   SET INV_LOCL_XCH_RT = DECODE(INV_CURR_CD, OFC_CURR_CD, 1, NVL(@[usd_xch_rt], 0)), 
	   UPD_USR_ID = @[upd_usr_id], 
	   UPD_DT = SYSDATE  
WHERE (RHQ_CD, OTS_OFC_CD, BL_NO, INV_NO) IN  
      (SELECT RHQ_CD, OTS_OFC_CD, BL_NO, INV_NO 
       FROM SAR_OTS_HIS 
       WHERE REF_NO = @[ar_if_no]
       -- AND (NVL(INV_LOCL_XCH_RT, 0) = 0 OR NVL(INV_USD_XCH_RT, 0) = 0) 
       AND OTS_HIS_SEQ = (SELECT MAX(B.OTS_HIS_SEQ) 
                          FROM SAR_OTS_HIS A, 
                               SAR_OTS_HIS B 
                          WHERE A.RHQ_CD = B.RHQ_CD 
                          AND A.OTS_OFC_CD = B.OTS_OFC_CD  
                          AND A.BL_NO = B.BL_NO 
						  AND A.INV_NO = B.INV_NO
                          AND A.OTS_HIS_TP_CD = 'OTS' 
                          AND B.OTS_HIS_TP_CD = 'OTS' 
                          AND A.REF_NO = @[ar_if_no])) 
AND INV_CURR_CD IS NOT NULL 
AND (INV_NO = '**********' OR (INV_NO <> '**********' AND NVL(INV_LOCL_XCH_RT, 0) = 0))			]]></sql>
			<params>
				<param name="usd_xch_rt" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="ar_if_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
