<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RenewalMasterDataMgtDBDAOCalculateFinancialAffairsMtxListRSQL">
			<desc><![CDATA[Create Financial Affairs Matrix Search.]]></desc>
			<sql><![CDATA[
SELECT 'R' AS IBFLAG
     , B.JO_CRR_CD
     , B.RLANE_CD
     , B.RE_DIVR_CD
     , B.JO_STL_ITM_CD
     , D.JO_STL_ITM_NM
     , A.CUST_CNT_CD||LPAD(A.CUST_SEQ,6,'0') AS CUST_CD
     , ''||A.VNDR_SEQ AS VNDR_SEQ
     , C.DR_ACCT_CD
     , (SELECT MA.ACCT_ENG_NM
          FROM MDM_ACCOUNT MA
         WHERE MA.DELT_FLG = 'N'
           AND MA.ACCT_CD  = C.DR_ACCT_CD) AS DR_ACCT_NM
     , B.DR_CTR_CD
     , B.DR_LOC_CD
     , C.CR_ACCT_CD
     , (SELECT MA.ACCT_ENG_NM
          FROM MDM_ACCOUNT MA
         WHERE MA.DELT_FLG = 'N'
           AND MA.ACCT_CD  = C.CR_ACCT_CD) AS CR_ACCT_NM
     , B.CR_CTR_CD
     , B.CR_LOC_CD
     , B.LOCL_CURR_CD
     , D.ORD_SEQ
  FROM JOO_CARRIER A
     , JOO_FINC_MTX B
     , JOO_STL_ITM_ACCT C
     , JOO_STL_ITM D
 WHERE A.JO_CRR_CD      = B.JO_CRR_CD
   AND A.RLANE_CD       = B.RLANE_CD
   AND B.RE_DIVR_CD     = C.RE_DIVR_CD
   AND B.JO_STL_ITM_CD  = C.JO_STL_ITM_CD
   AND C.JO_STL_ITM_CD  = D.JO_STL_ITM_CD
   AND B.JO_CRR_CD      = @[jo_crr_cd]
   AND B.RLANE_CD       = @[rlane_cd]
   AND B.RE_DIVR_CD     = @[re_divr_cd] 
UNION ALL 
SELECT 'I'          AS IBFLAG
     , @[jo_crr_cd] AS JO_CRR_CD
     , @[rlane_cd]  AS RLANE_CD
     , @[re_divr_cd] AS RE_DIVR_CD
     , A.JO_STL_ITM_CD
     , A.JO_STL_ITM_NM
     , @[cust_cd]   AS CUST_CD
     , @[vndr_seq]  AS VNDR_SEQ
     , B.DR_ACCT_CD
     , (SELECT MA.ACCT_ENG_NM
          FROM MDM_ACCOUNT MA
         WHERE MA.DELT_FLG = 'N'
           AND MA.ACCT_CD  = B.DR_ACCT_CD) AS DR_ACCT_NM
     , C.AP_CTR_CD  AS DR_CTR_CD
     , C.LOC_CD     AS DR_LOC_CD
     , B.CR_ACCT_CD
     , (SELECT MA.ACCT_ENG_NM
          FROM MDM_ACCOUNT MA
         WHERE MA.DELT_FLG = 'N'
           AND MA.ACCT_CD  = B.CR_ACCT_CD) AS CR_ACCT_NM
     , C.AP_CTR_CD  AS CR_CTR_CD
     , C.LOC_CD     AS CR_LOC_CD
     , @[locl_curr_cd] AS LOCL_CURR_CD
     , A.ORD_SEQ
  FROM JOO_STL_ITM A
     , JOO_STL_ITM_ACCT B
     , MDM_ORGANIZATION C
     , MDM_ORGANIZATION D
 WHERE A.JO_STL_ITM_CD  = B.JO_STL_ITM_CD
   AND C.OFC_CD         = D.AP_OFC_CD
   AND D.OFC_CD         = @[ofc_cd]
   AND B.RE_DIVR_CD     = @[re_divr_cd]
   AND NOT EXISTS ( SELECT JO_STL_ITM_CD
                      FROM JOO_FINC_MTX X
                     WHERE X.JO_CRR_CD      = @[jo_crr_cd]
                       AND X.RLANE_CD       = @[rlane_cd]
                       AND X.RE_DIVR_CD     = B.RE_DIVR_CD
                       AND X.JO_STL_ITM_CD  = A.JO_STL_ITM_CD )
ORDER  BY IBFLAG DESC, ORD_SEQ			]]></sql>
			<params>
				<param name="jo_crr_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="re_divr_cd" type="12" value="" out="N"/>
				<param name="cust_cd" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
				<param name="locl_curr_cd" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
