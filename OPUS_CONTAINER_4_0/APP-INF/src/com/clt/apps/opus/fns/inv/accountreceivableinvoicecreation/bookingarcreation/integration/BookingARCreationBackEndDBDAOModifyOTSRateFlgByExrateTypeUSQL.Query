<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingARCreationBackEndDBDAOModifyOTSRateFlgByExrateTypeUSQL">
			<desc><![CDATA[Modify OTS Rate Flg By Exrate Type]]></desc>
			<sql><![CDATA[
#if (${locl_curr_cd} == 'USD')       
    UPDATE SAR_OTS_HDR A
	    SET OTS_RT_FLG = NVL((SELECT 'N' 
       	   				      FROM SAR_OTS_DTL
                              WHERE RHQ_CD = A.RHQ_CD
                              AND OTS_OFC_CD = A.OTS_OFC_CD
                              AND BL_NO = A.BL_NO
                              AND INV_NO = A.INV_NO
                              AND (NVL(LOCL_XCH_RT, 0) = 0 OR NVL(USD_XCH_RT, 0) = 0)
                              AND ROWNUM = 1), 'Y')
    WHERE 1 = 1
	#if (${io_bnd_cd} != '')
		AND BKG_IO_BND_CD = @[io_bnd_cd]
	#end
	#if (${xch_rt_tp_cd} == 'V')
		AND DECODE(@[chg_curr_cd], OFC_CURR_CD, XCH_RT_TP_CD, XCH_RT_N3RD_TP_CD) = 'V'                     
    	AND VSL_CD = @[vsl_cd]
    	AND SKD_VOY_NO  = @[skd_voy_no]
    	AND DIR_CD = @[skd_dir_cd]
    	AND DECODE(@[io_bnd_cd], 'O', POL_CD, 'I', POD_CD) = @[port_cd]
    	AND SVC_SCP_CD =  @[svc_scp_cd]
	#elseif (${xch_rt_tp_cd} == 'I')
   		AND DECODE(@[chg_curr_cd], OFC_CURR_CD, XCH_RT_TP_CD, XCH_RT_N3RD_TP_CD) = 'I'
   		AND SHP_TO_CUST_CNT_CD = @[cust_cnt_cd]
   		AND SHP_TO_CUST_SEQ = @[cust_seq]
   		AND XCH_RT_DT between replace(@[fm_dt],'-','') and replace(@[to_dt],'-','')
   	#elseif (${xch_rt_tp_cd} == 'D')
   		AND DECODE(@[chg_curr_cd], OFC_CURR_CD, XCH_RT_TP_CD, XCH_RT_N3RD_TP_CD) = 'D'
   		AND XCH_RT_DT between replace(@[fm_dt],'-','') and replace(@[to_dt],'-','')
   	#end
#elseif (${chg_curr_cd} == 'USD')
    UPDATE SAR_OTS_HDR A
	    SET OTS_RT_FLG = NVL((SELECT 'N' 
       	   				      FROM SAR_OTS_DTL
                              WHERE RHQ_CD = A.RHQ_CD
                              AND OTS_OFC_CD = A.OTS_OFC_CD
                              AND BL_NO = A.BL_NO
                              AND INV_NO = A.INV_NO
                              AND (NVL(LOCL_XCH_RT, 0) = 0 OR NVL(USD_XCH_RT, 0) = 0)
                              AND ROWNUM = 1), 'Y')
    WHERE 1 = 1
	#if (${io_bnd_cd} != '')
		AND BKG_IO_BND_CD = @[io_bnd_cd]
	#end
	#if (${xch_rt_tp_cd} == 'V')	
		AND DECODE(@[locl_curr_cd], OFC_CURR_CD, XCH_RT_TP_CD, XCH_RT_N3RD_TP_CD) = 'V'                     
    	AND VSL_CD = @[vsl_cd]
    	AND SKD_VOY_NO  = @[skd_voy_no]
    	AND DIR_CD = @[skd_dir_cd]
    	AND DECODE(@[io_bnd_cd], 'O', POL_CD, 'I', POD_CD) = @[port_cd]
    	AND SVC_SCP_CD =  @[svc_scp_cd]
	#elseif (${xch_rt_tp_cd} == 'I')
   		AND DECODE(@[locl_curr_cd], OFC_CURR_CD, XCH_RT_TP_CD, XCH_RT_N3RD_TP_CD) = 'I'
   		AND SHP_TO_CUST_CNT_CD = @[cust_cnt_cd]
   		AND SHP_TO_CUST_SEQ = @[cust_seq]
   		AND XCH_RT_DT between replace(@[fm_dt],'-','') and replace(@[to_dt],'-','')
   	#elseif (${xch_rt_tp_cd} == 'D')
   		AND DECODE(@[locl_curr_cd], OFC_CURR_CD, XCH_RT_TP_CD, XCH_RT_N3RD_TP_CD) = 'D'
   		AND XCH_RT_DT between replace(@[fm_dt],'-','') and replace(@[to_dt],'-','')
   	#end
#end			]]></sql>
			<params>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="chg_curr_cd" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="port_cd" type="12" value="" out="N"/>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="cust_cnt_cd" type="12" value="" out="N"/>
				<param name="cust_seq" type="12" value="" out="N"/>
				<param name="fm_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="locl_curr_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
