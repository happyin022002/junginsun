<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceIssueDBDAOsearchINVMainInfoForIssueRSQL">
			<desc><![CDATA[Issue 화면 조건에 의해 발행대상 정보 조회(Invoice Main)]]></desc>
			<sql><![CDATA[
SELECT 
    A.ACT_CUST_CNT_CD
    , A.ACT_CUST_SEQ
    , A.INV_CUST_CNT_CD
    , A.INV_CUST_SEQ
    , B.REP_CUST_CNT_CD
    , B.REP_CUST_SEQ
    , A.REV_TP_CD||A.REV_SRC_CD REV_TP_SRC_CD
    , A.VSL_CD
    , A.SKD_VOY_NO
    , A.SKD_DIR_CD
    , A.IO_BND_CD
    , DECODE(A.IO_BND_CD, 'I', A.POD_CD, A.POL_CD) PORT_CD
    , A.POR_CD
    , A.POL_CD
    , A.POD_CD
    , A.DEL_CD
    , A.SVC_SCP_CD
    , A.SAIL_ARR_DT
    , A.BKG_NO
    , A.BL_SRC_NO
    , A.INV_SPLIT_CD
    , A.USD_XCH_RT
    , A.AR_IF_NO
    , A.AR_OFC_CD
    , @[user_id] AS USER_ID
    , A.INV_CURR_CD
    , A.INV_DELT_DIV_CD
	, NVL(A.BFR_INV_CURR_CD, @[inv_curr_cd]) BFR_INV_CURR_CD
FROM INV_AR_MN A,
     MDM_ORGANIZATION B
WHERE A.AR_OFC_CD = B.OFC_CD
AND A.INV_DELT_DIV_CD <> 'Y'
AND A.BL_INV_CFM_DT IS NOT NULL
AND A.OTS_PAY_CD IS NULL AND A.ORG_INV_NO IS NULL --Except migration data
AND A.AR_OFC_CD = @[ar_ofc_cd2]
#if (${bl_src_no} != '') 
   AND A.BL_SRC_NO = @[bl_src_no]
#end                                                       
#if (${act_cust_cnt_cd} != '') 
   AND A.ACT_CUST_CNT_CD = @[act_cust_cnt_cd]
#end
#if (${act_cust_seq} != '') 
   AND A.ACT_CUST_SEQ = @[act_cust_seq]
#end
#if (${vvd} != '') 
   AND A.VSL_CD = SUBSTR(@[vvd], 1, 4)
   AND A.SKD_VOY_NO = SUBSTR(@[vvd], 5, 4) 
   AND A.SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
#end
#if (${port} != '') 
  AND DECODE(A.IO_BND_CD, 'I', A.POD_CD, A.POL_CD) = @[port]
#end
#if (${scp} != '') 
   AND A.SVC_SCP_CD = @[scp]
#end
#if (${bnd} != 'A' && ${bnd} != '')     
   AND A.IO_BND_CD = @[bnd]
#end
#if (${rev_type} != '')
	#if (${rev_type} == 'M')     
   	    AND A.REV_TP_CD = 'M'
	#elseif (${rev_type} == 'F')     
   	    AND A.REV_TP_CD <> 'M'
	#end
#end
#if (${inv_dup_flg} != 'Y') 
    AND A.INV_ISS_FLG = 'N'
#end
AND B.DELT_FLG = 'N'
AND A.INV_SRC_NO IS NULL
AND A.INV_CLR_FLG = 'N'
--AND NOT(NVL(A.INV_SPLIT_CD,'N') = 'M' AND A.INV_NO IS NOT NULL)			]]></sql>
			<params>
				<param name="user_id" type="12" value="" out="N"/>
				<param name="inv_curr_cd" type="12" value="" out="N"/>
				<param name="ar_ofc_cd2" type="12" value="" out="N"/>
				<param name="bl_src_no" type="12" value="" out="N"/>
				<param name="act_cust_cnt_cd" type="12" value="" out="N"/>
				<param name="act_cust_seq" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="port" type="12" value="" out="N"/>
				<param name="scp" type="12" value="" out="N"/>
				<param name="bnd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
