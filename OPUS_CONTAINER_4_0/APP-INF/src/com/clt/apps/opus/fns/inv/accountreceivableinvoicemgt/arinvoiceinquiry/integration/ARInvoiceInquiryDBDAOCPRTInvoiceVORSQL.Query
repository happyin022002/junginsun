<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ARInvoiceInquiryDBDAOCPRTInvoiceVORSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
SELECT	RPT_TMPLT_NM 
#foreach( ${key} in ${allcols})
 #if( $key == 'CHG001'||$key == 'CHG002'||$key == 'CHG003'||$key == 'CHG004'||$key == 'CHG005'||$key == 'CHG999') 
 ,(DECODE (0
   #foreach( ${key} in ${allcols})
      #if($key == 'INV069')
         +1
      #else
	     +0
      #end
   #end
,0,  
    #if( $key == 'CHG001')
         SUM(CHG001_S),
    #elseif( $key == 'CHG002')
         SUM(CHG002_S),
    #elseif( $key == 'CHG003')
         SUM(CHG003_S),
    #elseif( $key == 'CHG004')
         SUM(CHG004_S),
    #elseif( $key == 'CHG005')
         SUM(CHG005_S),
    #elseif( $key == 'CHG999')
         SUM(CHG_AMT)-(SUM(CHG001_S)+ SUM(CHG002_S)+ SUM(CHG003_S)+ SUM(CHG004_S)+ SUM(CHG005_S)),
    #end
    #if( $key == 'CHG999')
         SUM(CNTR_AMT)-(SUM(CHG001)+SUM(CHG002)+SUM(CHG003)+SUM(CHG004)+SUM(CHG005))  )) $key
    #else
         SUM($key)  )) $key
    #end
 #else
	,$key 
 #end
#end
FROM ( 
SELECT  @[rpt_tmplt_nm] RPT_TMPLT_NM
        ,MN.BKG_NO                  AS INV001
       /*  BKG MAIN  */
        ,MN.BL_NO                   AS INV002 
        ,MN.SCAC_CD                 AS INV003
        ,MN.TOT_PCK_QTY             AS INV004
        ,MN.TOT_PCK_TP              AS INV005
        ,MN.ACT_WGT                 AS INV006
        ,MN.TOT_WGT_UT_CD           AS INV007
        ,MN.TOT_MEAS_QTY            AS INV008
        ,MN.MEAS_UT_CD              AS INV009 
        ,MN.BKG_OFC_CD              AS INV010
        ,MN.OBL_ISS_OFC_CD          AS INV011  
        ,MN.RFA_NO                  AS INV012
        ,MN.SC_NO                   AS INV013 
      /* CUSTOMER */   
        ,MN.CONSIGNEE               AS INV014
		,MN.CONSIGNEE_NM            AS INV015
       	,MN.CN_GROUP_CUST           AS INV016
	    ,MN.CN_GROUP_CUST_NM        AS INV017
        ,MN.NOTIFY_PARTY            AS INV018
	    ,MN.NOTIFY_PARTY_NM         AS INV019
        ,MN.SHIPPER                 AS INV020
	    ,MN.SHIPPER_NM              AS INV021
        ,MN.SH_GROUP_CUST           AS INV022
        ,MN.SH_GROUP_CUST_NM        AS INV023
        ,MN.ALSO_NOTIFY             AS INV063
        ,MN.SHIPPER_ADDR            AS INV147
        ,MN.FORWARDER_ADDR          AS INV148
        ,MN.ACTUAL_CUST_NM          AS INV149
        ,MN.BKG_CNTC_EMAIL          AS INV150
        ,MN.BKG_CNTC_NM             AS INV151
         /* ROUTE CONDITION */
        ,MN.POR_CD                  AS INV024
        ,MN.POR_CNT                 AS INV025
        ,MN.POR_NM                  AS INV026
        ,MN.POL_CD                  AS INV027
        ,MN.POL_NM                  AS INV028
        ,MN.PRE_RELAY_PORT          AS INV029
        ,MN.POD_CD                  AS INV030  
        ,MN.POD_NM                  AS INV031
        ,MN.POST_RELAY_PORT         AS INV032
        ,MN.DEL_CD                  AS INV033 
        ,MN.DEL_CNT                 AS INV034
        ,MN.DEL_STE                 AS INV035 
        ,MN.DEL_NM                  AS INV036 
        ,MN.FNL_DEST_CD             AS INV037
        ,MN.RCV_TERM_CD             AS INV038
        ,MN.DE_TERM_CD              AS INV039
        ,MN.FNL_DEST_NM             AS INV040   
        ,MN.EQ_CTRL_OFC             AS INV041 
        ,MN.DEST_TRNS_SVC_MOD_CD    AS INV042
       /*  VESSEL  */
        ,MN.T_VVD                   AS INV043
        ,MN.VESSEL_NM               AS INV044
        ,MN.T_LANE                  AS INV045
        ,MN.FST_VVD                 AS INV046
         /* DATE,TIME */
        ,MN.OC_DT                   AS INV047
        ,TO_CHAR(TO_DATE(SUBSTR(MN.F_POL_ETAETD,1,8),'YYYYMMDD'),'YYYY-MM-DD')  AS INV048  
        ,TO_CHAR(TO_DATE(SUBSTR(MN.F_POL_ETAETD,9,8),'YYYYMMDD'),'YYYY-MM-DD')  AS INV050
        ,TO_CHAR(TO_DATE(SUBSTR(MN.T_POL_ETAETD,1,8),'YYYYMMDD'),'YYYY-MM-DD')  AS INV051
        ,TO_CHAR(TO_DATE(SUBSTR(MN.T_POL_ETAETD,9,8),'YYYYMMDD'),'YYYY-MM-DD')  AS INV052
        ,TO_CHAR(TO_DATE(SUBSTR(MN.T_POD_ETAETD,1,8),'YYYYMMDD'),'YYYY-MM-DD')  AS INV055
        ,TO_CHAR(TO_DATE(SUBSTR(MN.T_POD_ETAETD,9,8),'YYYYMMDD'),'YYYY-MM-DD')  AS INV057
      	,TO_CHAR(TO_DATE(SUBSTR(MN.L_POD_ETAETD,1,8),'YYYYMMDD'),'YYYY-MM-DD')  AS INV058
      	,TO_CHAR(TO_DATE(SUBSTR(MN.L_POD_ETAETD,9,8),'YYYYMMDD'),'YYYY-MM-DD')  AS INV059
        ,DECODE( MN.FRT_TERM_CD, 'P', TO_CHAR(TO_DATE(SUBSTR(MN.F_POL_ETAETD,9,8),'YYYYMMDD')  
                                             + DECODE(NVL(MN.OB_CUST_CRTERM, 0),0, NVL(MN.OB_OFC_CRTERM, 0), NVL(MN.OB_CUST_CRTERM, 0)),'YYYY-MM-DD')
                                    , TO_CHAR((TO_DATE(SUBSTR(MN.L_POD_ETAETD,1,8),'YYYYMMDD')  
                                             + DECODE(NVL(MN.IB_CUST_CRTERM, 0),0, NVL(MN.IB_OFC_CRTERM, 0) ,NVL(MN.IB_CUST_CRTERM, 0))),'YYYY-MM-DD')        
                                             ) AS INV049 
        ,MN.OBRD_DT                 AS INV053
        ,MN.OBL_ISS_DT              AS INV054     
        ,MN.AN_SENT_DT              AS INV056      
        ,MN.CUST_CLR_DT             AS INV060 
        ,DECODE(TO_CHAR(MN.DEL_ARR_DT,'YYYY-MM-DD'), NULL, DECODE(MN.COP_DEL_ETA,'00000000', MN.VSK_DEL_ETA, TO_CHAR(TO_DATE(MN.COP_DEL_ETA,'YYYYMMDD'),'YYYY-MM-DD')),TO_CHAR(MN.DEL_ARR_DT,'YYYY-MM-DD'))  AS INV061
        ,MN.MVMT_STS                AS INV062
        ,MN.PCK_AVAIL_DT            AS INV064
        ,MN.FREE_DT                 AS INV065  
        ,MN.DELIVER_DT              AS INV066 
        ,MN.MT_RTN_DT               AS INV067
        ,MN.IC_DT                   AS INV080
        ,TO_CHAR(TO_DATE(IAM.BL_INV_IF_DT,'YYYYMMDD'), 'YYYY-MM-DD') AS INV081
       /* CONTAINER  INV068 - INV078 */
        ,MN.MEAS_QTY                AS INV068
        ,MN.CNTR_NO                 AS INV069
        ,MN.CNTR_PRT_FLG            AS INV070
        ,MN.CNTR_SEAL_NO            AS INV071
        ,MN.CNTR_SZ_CD              AS INV072
        ,MN.CNTR_TPSZ_CD            AS INV073  
        ,MN.CNTR_VOL_QTY            AS INV074
        ,MN.PCK_QTY                 AS INV075
        ,MN.PCK_TP_CD               AS INV076
        ,MN.CNTR_WGT                AS INV077
        ,MN.WGT_UT_CD               AS INV078   
      /*   CUSTOMER REF.  */
        ,MN.BKPO                    AS INV082  
        ,MN.CTPO                    AS INV083  
        ,MN.PRT_NO                  AS INV084    
        ,MN.INV_REF_NO              AS INV085   
        ,MN.BKG_REF_NO              AS INV086   
        ,MN.SI_REF_NO               AS INV087  
        ,MN.EXP_REF_NO              AS INV088    
     /*  RATE   */
        ,MN.THR_CUST                AS INV092
        ,MN.CNTR_CHG_CURR           AS INV126
        ,MN.AUD_STS_CD              AS INV101
        ,MN.GRP_CUR                 AS INV103
        ,MN.TOT_CURR_AMT            AS INV102
        ,DECODE(MN.FRT_TERM_CD, 'P', NVL(MN.THR_CUST, MN.PPD_CUST), NVL(MN.THR_CUST, MN.CCT_CUST)) AS INV104
        ,DECODE(MN.FRT_TERM_CD, 'P', NVL(MN.N3PTY_OFC, MN.PPD_OFC), NVL(MN.N3PTY_OFC, MN.CCT_OFC)) AS INV105
        ,MN.CNTR_SUM1               AS INV106
        ,MN.CNTR_SUM2               AS INV107  
        ,DECODE( MN.FRT_TERM_CD, 'P'  ,DECODE(NVL(MN.OB_CUST_CRTERM, 0),0, NVL(MN.OB_OFC_CRTERM, 0), NVL(MN.OB_CUST_CRTERM, 0))
                                      ,DECODE(NVL(MN.IB_CUST_CRTERM, 0),0, NVL(MN.IB_OFC_CRTERM, 0), NVL(MN.IB_CUST_CRTERM, 0))) AS INV108 
        ,DECODE( MN.FRT_TERM_CD, 'P'  ,(TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD'),'YYYYMMDD')
                                         - (TO_DATE(SUBSTR(MN.F_POL_ETAETD,9,8),'YYYYMMDD')  
                                             + DECODE(NVL(MN.OB_CUST_CRTERM, 0),0, NVL(MN.OB_OFC_CRTERM, 0), NVL(MN.OB_CUST_CRTERM, 0)))) 
                                      ,(TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD'),'YYYYMMDD')
                                         - (TO_DATE(SUBSTR(MN.L_POD_ETAETD,1,8),'YYYYMMDD')  
                                             + DECODE(NVL(MN.IB_CUST_CRTERM, 0),0, NVL(MN.IB_OFC_CRTERM, 0), NVL(MN.IB_CUST_CRTERM, 0))))) AS INV109
        ,MN.CLT_FLG                 AS INV110 
        ,DECODE(MN.N3PTY_OFC, '', DECODE(MN.FRT_TERM_CD, 'P', MN.GL_EX_PPD, MN.GL_EX_CCT), MN.GL_EX_THR) AS INV111
        --,DECODE(MN.N3PTY_OFC, '', DECODE(MN.FRT_TERM_CD, 'P', MN.LCL_TOT_PPD, MN.LCL_TOT_CCT), MN.LCL_TOT_THR) AS INV112
        --,DECODE(MN.N3PTY_OFC, '', DECODE(MN.FRT_TERM_CD, 'P', MN.USD_TOT_PPD, MN.USD_TOT_CCT), MN.USD_TOT_THR) AS INV141 
		,IAM.INV_TTL_LOCL_AMT AS INV112
        ,(SELECT SUM(ROUND(CHG_AMT * USD_XCH_RT, 2))
          FROM INV_AR_CHG
          WHERE AR_IF_NO = IAM.AR_IF_NO) AS INV141 
        ,MN.CHG_CD                  AS INV096
        ,MN.CHG_CURR                AS INV127
        ,MN.CHG_RATED_AS            AS INV128
        ,MN.CHG_RATE                AS INV129
        ,MN.TOT_CHG_AMT             AS INV131  
     /* COMMODITY */
        ,MN.CMDT_CD                 AS INV113 
        ,MN.CMDT_NM                 AS INV114 
        ,MN.CSTMS_DESC              AS INV115
        ,MN.CNTR_SP_CGO_FG          AS INV116
        ,MN.MK_DESC                 AS INV079
     /*  I/B INFORM   */
        ,MN.RTN_YD_CD               AS INV117
        ,MN.HUB_LOC_CD              AS INV118  
        ,MN.IBD_TRSP_NO             AS INV119  
        ,MN.IBD_TRSP_ISS_DT         AS INV120 
        ,MN.PKUP_NO                 AS INV121 
        ,MN.PKUP_YD_CD              AS INV122  
        ,MN.OBL_RDEM_FLG            AS INV124
        ,MN.CSTMS_CLR_CD            AS INV125       
        ,MN.RT_APLY_DT              AS INV142      
        ,MN.CGO_RCV_DT              AS INV144
        ,MN.DEPT_NO                 AS INV145  
        ,''                         AS INV146
        ,MN.FRT_TERM_CD
        /* ADD NEW ITEMS *****************************************************/
        ,MN.BL_TP_CD                AS INV201
        ,MN.BOUND                   AS INV202
        ,SUBSTR(MN.T_VVD, 9, 1)     AS INV203
        ,MN.FORWARDER               AS INV204
        ,MN.FORWARDER_NM            AS INV205
        ,MN.SLS_OFC_CD              AS INV206
        ,MN.SREP_CD                 AS INV207
        ,MN.TRADE_CD                AS INV208
        ,MN.TRAFFIC_MOD             AS INV209
        ,MN.CNTR_MEAS_UT            AS INV210
        ,MN.CNTR_DESC               AS INV211
        ,MN.CREDIT_AMT              AS INV212
        ,MN.CREDIT_FLG              AS INV213		
        --,MN.BILL_CUST_NM            AS INV214
        --,MN.BILL_CUST_ADDR          AS INV215
		,(SELECT CUST_LGL_ENG_NM
          FROM MDM_CUSTOMER
          WHERE CUST_CNT_CD = IAM.ACT_CUST_CNT_CD
          AND CUST_SEQ = IAM.ACT_CUST_SEQ) AS INV214
        ,(SELECT BZET_ADDR
          FROM MDM_CUST_ADDR
          WHERE CUST_CNT_CD = IAM.ACT_CUST_CNT_CD
          AND CUST_SEQ = IAM.ACT_CUST_SEQ
          AND PRMRY_CHK_FLG = 'Y') AS INV215
        --,MN.CUST_OFC_NM             AS INV216
        --,MN.CUST_OFC_SAP_ID         AS INV217
		,(SELECT B.OFC_ENG_NM
          FROM MDM_CUSTOMER A, MDM_ORGANIZATION B
          WHERE A.OFC_CD = B.OFC_CD
          AND A.CUST_CNT_CD = IAM.ACT_CUST_CNT_CD
          AND A.CUST_SEQ = IAM.ACT_CUST_SEQ) AS INV216
        ,(SELECT B.MODI_AGN_CD
          FROM MDM_CUSTOMER A, MDM_ORGANIZATION B
          WHERE A.OFC_CD = B.OFC_CD
          AND A.CUST_CNT_CD = IAM.ACT_CUST_CNT_CD
          AND A.CUST_SEQ = IAM.ACT_CUST_SEQ) AS INV217
        ,MN.DISCHARGE_DT            AS INV218
        ,DECODE(SHR.OTS_TP_CD, '', '', TO_CHAR(SHR.UPD_DT, 'YYYY-MM-DD')) AS INV219 
        ,MN.MT_OUT_DT               AS INV220
        ,MN.LOADING_DT              AS INV221
        ,TO_CHAR(TO_DATE(IAM.BL_INV_IF_DT,'YYYYMMDD'), 'YYYY-MM-DD') AS INV222           
        ,TO_CHAR(TO_DATE(IAM.BL_INV_IF_DT,'YYYYMMDD'), 'YYYY-MM-DD') AS INV223        
        ,TO_CHAR(TO_DATE(IAM.ISS_DT,'YYYYMMDD'), 'YYYY-MM-DD')       AS INV224        
        ,(SELECT MAX(TO_CHAR(RCT_UPD_DT, 'YYYY-MM-DD'))
          FROM SAR_OTS_DTL
          WHERE RHQ_CD = SHS.RHQ_CD
          AND OTS_OFC_CD = SHS.OTS_OFC_CD
          AND BL_NO = SHS.BL_NO
          AND INV_NO = SHS.INV_NO)  AS INV225        
        ,(SELECT LU_DESC
          FROM SCO_LU_DTL
          WHERE LU_TP_CD = 'OTS TYPE'
          AND LU_CD = SHR.OTS_TP_CD) AS INV226        
        ,DECODE(SHR.OTS_TP_CD, '', '', SHR.UPD_USR_ID) AS INV227 
        ,DECODE(SHR.OTS_TP_CD, '', '', SHR.OTS_RMK)    AS INV228
        ,IAM.CRE_USR_ID             AS INV229   
        ,MN.CARRIER                 AS INV230
        ,(SELECT DECODE(COUNT(DISTINCT BL_SRC_NO), 0, '', 1, 'N', 'Y')
          FROM INV_AR_MN
          WHERE INV_NO = IAM.INV_NO) AS INV231
        ,IAM.INV_NO                 AS INV232
        ,DECODE(IAM.INV_NO, '', '', 'SF') AS INV233
        ,SHR.CLT_OFC_CD             AS INV234
        ,SHR.OTS_OFC_CD             AS INV235
        ,(SELECT B.LOC_NM
          FROM MDM_ORGANIZATION A,
               MDM_LOCATION B
          WHERE A.OFC_CD = SHR.OTS_OFC_CD
          AND B.LOC_CD = A.LOC_CD)  AS INV236
        ,DECODE(IAM.INV_NO, '', '', IAM.AR_OFC_CD) AS INV237
        ,MN.CHG_AMT                 AS INV238
        ,(SELECT ROUND(MN.CHG_AMT * B.ISS_XCH_RT, C.DP_PRCS_KNT)
          FROM INV_AR_MN A,
               INV_AR_CHG B,
               MDM_CURRENCY C
          WHERE A.AR_IF_NO = IAM.AR_IF_NO
          AND A.AR_IF_NO = B.AR_IF_NO
          AND A.INV_CURR_CD = C.CURR_CD
          AND B.CURR_CD = MN.CHG_CURR
          AND ROWNUM = 1)           AS INV239
        --,MN.USD_CHG_AMT             AS INV240
		,(SELECT ROUND(MN.CHG_AMT * USD_XCH_RT, 2)
          FROM INV_AR_CHG
          WHERE AR_IF_NO = IAM.AR_IF_NO
          AND CURR_CD = MN.CHG_CURR
          AND ROWNUM = 1) AS INV240
        ,(SELECT MN.CHG_AMT
          FROM INV_AR_CHG
          WHERE AR_IF_NO = IAM.AR_IF_NO
          AND CHG_CD = MN.CHG_CD
          AND TJ_SRC_NM <> 'VAT'
          AND ROWNUM = 1)           AS INV241
        ,DECODE(IAM.INV_DELT_DIV_CD, 'X', 'Cancelled', DECODE(IAM.INV_NO, '', 'Unbilled', 'Billed')) AS INV242
        ,MN.CHG_NM                  AS INV243
        ,MN.THR_PAY_FLG             AS INV244
        ,(SELECT INV_XCH_RT
          FROM INV_AR_CHG
          WHERE AR_IF_NO = IAM.AR_IF_NO
          AND CURR_CD = MN.CHG_CURR
          AND ROWNUM = 1)           AS INV245
        ,(SELECT ISS_XCH_RT
          FROM INV_AR_CHG
          WHERE AR_IF_NO = IAM.AR_IF_NO
          AND CURR_CD = MN.CHG_CURR
          AND ROWNUM = 1)           AS INV246
        ,DECODE(IAM.INV_CURR_CD, IAM.LOCL_CURR_CD, 1, 'USD', IAM.INV_LOCL_XCH_RT, NULL) AS INV247
        ,IAM.INV_CURR_CD            AS INV248
        ,MN.FRT_TERM_CD             AS INV249
        ,(SELECT SUM(ROUND(B.CHG_AMT * B.ISS_XCH_RT, C.DP_PRCS_KNT))
          FROM INV_AR_MN A,
               INV_AR_CHG B,
               MDM_CURRENCY C
          WHERE A.AR_IF_NO = IAM.AR_IF_NO
          AND A.AR_IF_NO = B.AR_IF_NO
          AND A.INV_CURR_CD = C.CURR_CD) AS INV250
        ,(SELECT ROUND(MN.CHG_AMT * B.ISS_XCH_RT, C.DP_PRCS_KNT)
          FROM INV_AR_MN A,
               INV_AR_CHG B,
               MDM_CURRENCY C
          WHERE A.AR_IF_NO = IAM.AR_IF_NO
          AND A.AR_IF_NO = B.AR_IF_NO
          AND A.INV_CURR_CD = C.CURR_CD
          AND B.CURR_CD = MN.CHG_CURR
          AND B.CHG_CD = MN.CHG_CD
          AND B.TJ_SRC_NM = 'VAT'
          AND ROWNUM = 1)           AS INV251
        ,(SELECT MN.CHG_AMT
          FROM INV_AR_CHG
          WHERE AR_IF_NO = IAM.AR_IF_NO
          AND CHG_CD = MN.CHG_CD
          AND TJ_SRC_NM = 'VAT'
          AND ROWNUM = 1)           AS INV252
        ,(SELECT MN.CHG_RATED_AS
          FROM INV_AR_CHG
          WHERE AR_IF_NO = IAM.AR_IF_NO
          AND CHG_CD = MN.CHG_CD
          AND TJ_SRC_NM = 'VAT'
          AND ROWNUM = 1)           AS INV253
        ,MN.FST_POL                 AS INV254
        ,MN.LST_POD                 AS INV255
        ,MN.LST_VVD                 AS INV256
        ,IAM.SVC_SCP_CD             AS INV257
        ,IAM.VSL_CD||IAM.SKD_VOY_NO||IAM.SKD_DIR_CD AS INV258
        /***********************************************************/
        ,MN.CHG001_S
        ,MN.CHG002_S
        ,MN.CHG003_S
        ,MN.CHG004_S
        ,MN.CHG005_S
        ,MN.CHG001
        ,MN.CHG002
        ,MN.CHG003
        ,MN.CHG004
        ,MN.CHG005  
        ,MN.CHG_AMT
        ,MN.CNTR_AMT
FROM 
    (SELECT O.BKG_NO
        ,O.BL_NO 
        ,O.SC_NO
        ,O.RFA_NO 
        ,'NYKSC' AS SCAC_CD   
        ,O.BKG_OFC_CD 
        ,O.POR_CD 
        ,SUBSTR(O.POR_CD,1,2) AS POR_CNT
        ,(SELECT LOC1.LOC_NM FROM MDM_LOCATION LOC1  
          WHERE  O.POR_CD = LOC1.LOC_CD(+)) AS POR_NM
        ,O.POD_CD 
        ,(SELECT LOC3.LOC_NM FROM MDM_LOCATION LOC3  
          WHERE  O.POD_CD = LOC3.LOC_CD(+)) AS POD_NM
        ,O.POL_CD 
        ,(SELECT LOC2.LOC_NM FROM MDM_LOCATION LOC2  
          WHERE  O.POL_CD = LOC2.LOC_CD(+)) AS POL_NM
        ,(SELECT NVL(MAX(CO1.CUST_CONV_CD_CTNT), O.DEL_CD) 
          FROM  INV_CPRT_CD_CONV CO1  
          WHERE CO1.CPRT_CONV_TP_CD ='LOCATION'
          AND   CO1.CO_CD_CTNT = O.DEL_CD
          AND   CO1.SC_NO  = NVL(O.SC_NO,'X') 
          AND   CO1.RFA_NO = NVL(O.RFA_NO,'X'))  AS DEL_CD 
        ,SUBSTR(O.DEL_CD,1,2)                AS DEL_CNT
        ,(SELECT LOC4.STE_CD FROM MDM_LOCATION LOC4  
          WHERE  O.DEL_CD = LOC4.LOC_CD(+)) AS DEL_STE 
        ,(SELECT LOC5.LOC_NM FROM MDM_LOCATION LOC5  
          WHERE  O.DEL_CD = LOC5.LOC_CD(+)) AS DEL_NM
        ,(SELECT LOC6.EQ_CTRL_OFC_CD  FROM MDM_LOCATION LOC6  
          WHERE  O.DEL_CD = LOC6.LOC_CD(+)) AS EQ_CTRL_OFC 
        ,O.FNL_DEST_CD
        ,(SELECT NVL(MAX(CO2.CUST_CONV_CD_CTNT), O.RCV_TERM_CD)
          FROM INV_CPRT_CD_CONV CO2
          WHERE CO2.CPRT_CONV_TP_CD ='RECEIVINGTERM'
          AND CO2.CO_CD_CTNT = O.RCV_TERM_CD
          AND CO2.SC_NO = NVL(O.SC_NO, 'X')
          AND CO2.RFA_NO = NVL(O.RFA_NO, 'X')) AS RCV_TERM_CD
        ,(SELECT NVL(MAX(CO2.CUST_CONV_CD_CTNT), O.DE_TERM_CD)
          FROM INV_CPRT_CD_CONV CO2
          WHERE CO2.CPRT_CONV_TP_CD ='DELIVERYTERM'
          AND CO2.CO_CD_CTNT = O.DE_TERM_CD
          AND CO2.SC_NO = NVL(O.SC_NO, 'X')
          AND CO2.RFA_NO = NVL(O.RFA_NO, 'X')) AS DE_TERM_CD
        ,O.DEST_TRNS_SVC_MOD_CD
        ,P.FNL_DEST_NM
        ,P.PCK_QTY AS TOT_PCK_QTY
        ,P.PCK_TP_CD AS TOT_PCK_TP
        ,P.ACT_WGT
        ,P.WGT_UT_CD AS TOT_WGT_UT_CD
        ,P.MEAS_QTY  AS TOT_MEAS_QTY
        ,P.MEAS_UT_CD
        ,P.VSL_NM
        ,P.CSTMS_DESC
       /* CUSTOMER  */   
        ,( SELECT DECODE(C1.CUST_CNT_CD||C1.CUST_SEQ, '', '', C1.CUST_CNT_CD||'-'||LPAD(TO_CHAR(C1.CUST_SEQ),6,'0'))
           FROM  BKG_CUSTOMER C1
           WHERE C1.BKG_NO = O.BKG_NO AND C1.BKG_CUST_TP_CD ='C' ) AS CONSIGNEE 
        ,( SELECT C1.CUST_NM
           FROM  BKG_CUSTOMER C1
           WHERE C1.BKG_NO = O.BKG_NO AND C1.BKG_CUST_TP_CD ='C' ) AS CONSIGNEE_NM 
        ,(SELECT DECODE(L1.CUST_GRP_ID, '', '', SUBSTR(L1.CUST_GRP_ID,3,2)||'-'||SUBSTR(L1.CUST_GRP_ID,5,6))
          FROM  MDM_CUSTOMER L1, BKG_CUSTOMER C3
          WHERE C3.BKG_NO = O.BKG_NO 
          AND   C3.CUST_CNT_CD = L1.CUST_CNT_CD 
          AND   C3.CUST_SEQ    = L1.CUST_SEQ
          AND   C3.BKG_CUST_TP_CD = 'C'  
          )  AS CN_GROUP_CUST 
        ,(SELECT L2.CUST_LGL_ENG_NM  
          FROM  MDM_CUSTOMER L1, MDM_CUSTOMER L2, BKG_CUSTOMER C3
          WHERE C3.BKG_NO = O.BKG_NO 
          AND   C3.CUST_CNT_CD = L1.CUST_CNT_CD 
          AND   C3.CUST_SEQ    = L1.CUST_SEQ
          AND   C3.BKG_CUST_TP_CD = 'C'  
          AND   SUBSTR(L1.CUST_GRP_ID,3,2) = L2.CUST_CNT_CD
          AND   SUBSTR(L1.CUST_GRP_ID,5,6) = L2.CUST_SEQ
          )  AS CN_GROUP_CUST_NM  
        ,(SELECT DECODE(C5.CUST_CNT_CD||C5.CUST_SEQ, '', '', C5.CUST_CNT_CD||'-'||LPAD(TO_CHAR(C5.CUST_SEQ),6,'0'))
          FROM BKG_CUSTOMER C5
          WHERE C5.BKG_NO=O.BKG_NO AND C5.BKG_CUST_TP_CD ='N'  ) AS NOTIFY_PARTY  
        ,(SELECT C5.CUST_NM
          FROM BKG_CUSTOMER C5
          WHERE C5.BKG_NO=O.BKG_NO AND C5.BKG_CUST_TP_CD ='N'  ) AS NOTIFY_PARTY_NM   
        ,(SELECT DECODE(C7.CUST_CNT_CD||C7.CUST_SEQ, '', '', C7.CUST_CNT_CD||'-'||LPAD(TO_CHAR(C7.CUST_SEQ),6,'0'))
          FROM BKG_CUSTOMER C7
          WHERE C7.BKG_NO=O.BKG_NO AND C7.BKG_CUST_TP_CD ='S' ) AS SHIPPER  
        ,(SELECT C7.CUST_NM
          FROM BKG_CUSTOMER C7
          WHERE C7.BKG_NO=O.BKG_NO AND C7.BKG_CUST_TP_CD ='S' ) AS SHIPPER_NM  
        ,(SELECT DECODE(L3.CUST_GRP_ID, '', '', SUBSTR(L3.CUST_GRP_ID,3,2)||'-'||SUBSTR(L3.CUST_GRP_ID,5,6))
          FROM  MDM_CUSTOMER L3, BKG_CUSTOMER C9
          WHERE C9.BKG_NO = O.BKG_NO  
          AND C9.CUST_CNT_CD = L3.CUST_CNT_CD 
          AND C9.CUST_SEQ = L3.CUST_SEQ          
          AND C9.BKG_CUST_TP_CD = 'S' ) AS SH_GROUP_CUST 
        ,(SELECT L2.CUST_LGL_ENG_NM  
          FROM  MDM_CUSTOMER L1, MDM_CUSTOMER L2, BKG_CUSTOMER C3
          WHERE C3.BKG_NO = O.BKG_NO 
          AND   C3.CUST_CNT_CD = L1.CUST_CNT_CD 
          AND   C3.CUST_SEQ    = L1.CUST_SEQ
          AND   C3.BKG_CUST_TP_CD = 'S'  
          AND   SUBSTR(L1.CUST_GRP_ID,3,2) = L2.CUST_CNT_CD
          AND   SUBSTR(L1.CUST_GRP_ID,5,6) = L2.CUST_SEQ
          )  AS SH_GROUP_CUST_NM   
        ,(SELECT S.CUST_NM
          FROM   BKG_CUSTOMER S
          WHERE  S.BKG_NO = O.BKG_NO AND S.BKG_CUST_TP_CD = 'A' ) AS ALSO_NOTIFY
        ,(SELECT C9.CUST_ADDR
          FROM BKG_CUSTOMER C9
          WHERE C9.BKG_NO=O.BKG_NO AND C9.BKG_CUST_TP_CD ='S' )AS SHIPPER_ADDR     
        ,(SELECT C9.CUST_ADDR  
          FROM BKG_CUSTOMER C9
          WHERE C9.BKG_NO=O.BKG_NO AND C9.BKG_CUST_TP_CD ='F' )AS FORWARDER_ADDR
        ,(SELECT C9.CUST_NM
          FROM BKG_CUSTOMER C9
          WHERE C9.BKG_NO=O.BKG_NO AND C9.BKG_CUST_TP_CD ='E' )AS ACTUAL_CUST_NM
        ,(SELECT C10.CNTC_PSON_EML
          FROM BKG_CNTC_PSON C10
          WHERE C10.BKG_NO=O.BKG_NO AND C10.BKG_CNTC_PSON_TP_CD ='BK' )AS BKG_CNTC_EMAIL
        ,(SELECT C11.CNTC_PSON_NM
          FROM BKG_CNTC_PSON C11
          WHERE C11.BKG_NO=O.BKG_NO AND C11.BKG_CNTC_PSON_TP_CD ='BK' )AS BKG_CNTC_NM
       /* ROUTE CONDITION */
        ,(SELECT /*+ INDEX_DESC( K1 XPKBKG_VVD ) */ 
                 K1.POL_CD  
          FROM BKG_VVD K1
          WHERE K1.BKG_NO = O.BKG_NO
          AND   K1.VSL_PRE_PST_CD='S'  AND ROWNUM = 1 )  AS PRE_RELAY_PORT 
        ,(SELECT /*+ INDEX( K2 XPKBKG_VVD ) */
                  K2.POL_CD
          FROM BKG_VVD K2
          WHERE K2.BKG_NO = O.BKG_NO
          AND   K2.VSL_PRE_PST_CD='U' AND ROWNUM = 1 )   AS POST_RELAY_PORT
       /*  VESSEL  */
        ,(SELECT K3.VSL_CD||K3.SKD_VOY_NO||K3.SKD_DIR_CD
          FROM BKG_VVD K3
          WHERE K3.BKG_NO = O.BKG_NO AND K3.VSL_PRE_PST_CD ='T' ) AS T_VVD    
        ,(SELECT VSL_ENG_NM||' '||(SELECT K3.SKD_VOY_NO||K3.SKD_DIR_CD FROM BKG_VVD K3 WHERE K3.BKG_NO = O.BKG_NO AND K3.VSL_PRE_PST_CD ='T')  
          FROM MDM_VSL_CNTR 
          WHERE VSL_CD = (SELECT K3.VSL_CD 
                          FROM BKG_VVD K3 
                          WHERE K3.BKG_NO = O.BKG_NO 
                          AND K3.VSL_PRE_PST_CD ='T')) AS VESSEL_NM
        ,(SELECT K4.SLAN_CD FROM BKG_VVD K4
          WHERE K4.BKG_NO = O.BKG_NO AND K4.VSL_PRE_PST_CD ='T'  ) AS T_LANE 
        ,(SELECT /*+ INDEX( K5 XPKBKG_VVD ) */
                K5.VSL_CD||K5.SKD_VOY_NO||K5.SKD_DIR_CD 
          FROM  BKG_VVD K5
          WHERE K5.BKG_NO = O.BKG_NO  
          AND K5.POL_CD = O.POL_CD      
          AND K5.VSL_PRE_PST_CD||K5.VSL_SEQ = (SELECT MIN(S.VSL_PRE_PST_CD||S.VSL_SEQ) 
                                               FROM BKG_VVD S                
                                               WHERE S.BKG_NO = O.BKG_NO    
                                               AND S.POL_CD = O.POL_CD)      
          ) AS FST_VVD           
        ,(SELECT TO_CHAR(V1.VPS_ETA_DT,'YYYYMMDD')||TO_CHAR(V1.VPS_ETD_DT,'YYYYMMDD')
          FROM  BKG_VVD K5, VSK_VSL_PORT_SKD V1
          WHERE K5.BKG_NO = O.BKG_NO  
          AND K5.POL_CD = O.POL_CD     
          AND K5.VSL_PRE_PST_CD||K5.VSL_SEQ = (SELECT MIN(S.VSL_PRE_PST_CD||S.VSL_SEQ) 
                                               FROM BKG_VVD S               
                                               WHERE S.BKG_NO = O.BKG_NO    
                                               AND S.POL_CD = O.POL_CD)      
          AND V1.VSL_CD = K5.VSL_CD
          AND V1.SKD_VOY_NO = K5.SKD_VOY_NO
          AND V1.SKD_DIR_CD = K5.SKD_DIR_CD
          AND V1.VPS_PORT_CD = K5.POL_CD
          AND V1.CLPT_IND_SEQ = (SELECT MAX(V2.CLPT_IND_SEQ) FROM VSK_VSL_PORT_SKD V2
                                 WHERE  V2.VSL_CD = K5.VSL_CD
                                 AND    V2.SKD_VOY_NO = K5.SKD_VOY_NO
                                 AND    V2.SKD_DIR_CD = K5.SKD_DIR_CD
                                 AND    V2.VPS_PORT_CD =  K5.POL_CD)
          ) AS F_POL_ETAETD
       /* DATE,TIME */
        ,TO_CHAR(P.BL_OBRD_DT,'YYYY-MM-DD') AS OBRD_DT  
        ,TO_CHAR(R.OBL_ISS_DT,'YYYY-MM-DD') AS OBL_ISS_DT 
        ,S.DEL_ARR_DT
        ,(SELECT TO_CHAR(KK.VPS_ETA_DT,'YYYYMMDD')||TO_CHAR(KK.VPS_ETD_DT,'YYYYMMDD') AS ETAETD 
          FROM VSK_VSL_PORT_SKD KK, BKG_VVD BB
          WHERE   KK.VSL_CD = BB.VSL_CD
          AND     KK.SKD_VOY_NO = BB.SKD_VOY_NO
          AND     KK.SKD_DIR_CD = BB.SKD_DIR_CD
          AND     KK.VPS_PORT_CD = BB.POL_CD
          AND     BB.VSL_PRE_PST_CD='T'
          AND     BB.BKG_NO = O.BKG_NO
          AND     KK.CLPT_IND_SEQ = (SELECT MAX(CLPT_IND_SEQ) FROM VSK_VSL_PORT_SKD
                                     WHERE  VSL_CD = KK.VSL_CD
                                     AND    SKD_VOY_NO = KK.SKD_VOY_NO
                                     AND    SKD_DIR_CD = KK.SKD_DIR_CD
                                     AND    VPS_PORT_CD = KK.VPS_PORT_CD)
          ) AS T_POL_ETAETD     
        ,(SELECT TO_CHAR(KK1.VPS_ETA_DT,'YYYYMMDD')||TO_CHAR(KK1.VPS_ETD_DT,'YYYYMMDD') AS ETAETD 
          FROM VSK_VSL_PORT_SKD KK1, BKG_VVD BB1
          WHERE   KK1.VSL_CD     = BB1.VSL_CD
          AND     KK1.SKD_VOY_NO = BB1.SKD_VOY_NO
          AND     KK1.SKD_DIR_CD = BB1.SKD_DIR_CD
          AND     KK1.VPS_PORT_CD = BB1.POD_CD
          AND     BB1.VSL_PRE_PST_CD='T'
          AND     BB1.BKG_NO = O.BKG_NO
          AND     KK1.CLPT_IND_SEQ = (SELECT MAX(CLPT_IND_SEQ) FROM VSK_VSL_PORT_SKD
                                     WHERE VSL_CD = KK1.VSL_CD
                                     AND   SKD_VOY_NO = KK1.SKD_VOY_NO
                                     AND   SKD_DIR_CD = KK1.SKD_DIR_CD
                                     AND   VPS_PORT_CD = KK1.VPS_PORT_CD)
          ) AS T_POD_ETAETD           
        ,(SELECT TO_CHAR(V3.VPS_ETA_DT,'YYYYMMDD')||TO_CHAR(V3.VPS_ETD_DT,'YYYYMMDD')
          FROM  BKG_VVD K6, VSK_VSL_PORT_SKD V3
          WHERE K6.BKG_NO = O.BKG_NO
          AND K6.POD_CD = O.POD_CD     
          AND K6.VSL_PRE_PST_CD||K6.VSL_SEQ = (SELECT MAX(S.VSL_PRE_PST_CD||S.VSL_SEQ) 
                                               FROM BKG_VVD S                
                                               WHERE S.BKG_NO = O.BKG_NO    
                                               AND S.POD_CD = O.POD_CD)       
          AND V3.VSL_CD = K6.VSL_CD
          AND V3.SKD_VOY_NO = K6.SKD_VOY_NO
          AND V3.SKD_DIR_CD = K6.SKD_DIR_CD
          AND V3.VPS_PORT_CD = K6.POD_CD
          AND V3.CLPT_IND_SEQ = (SELECT MAX(V4.CLPT_IND_SEQ) FROM VSK_VSL_PORT_SKD V4
                                 WHERE  V4.VSL_CD = K6.VSL_CD
                                 AND    V4.SKD_VOY_NO = K6.SKD_VOY_NO
                                 AND    V4.SKD_DIR_CD = K6.SKD_DIR_CD
                                 AND    V4.VPS_PORT_CD =  K6.POD_CD)
          ) AS L_POD_ETAETD
        ,(SELECT SUBSTR(MAX(DECODE(COPD.ACT_CD, 'FITRDO', '1', '0') || NVL(TO_CHAR(COPD.PLN_DT, 'YYYYMMDDHH24MISS'), '00000000000000')
                            || NVL(TO_CHAR(NVL(COPD.ACT_DT, COPD.ESTM_DT), 'YYYYMMDDHH24MISS'), '00000000000000')
                            || COPD.NOD_CD ), 2,8)
          FROM SCE_COP_HDR COPM  , SCE_COP_DTL COPD
          WHERE COPM.BKG_NO(+) = O.BKG_NO 
          AND COPD.COP_NO = COPM.COP_NO
          AND COPM.COP_STS_CD <> 'X'
          AND COPD.ACT_CD IN ('FITRDO', 'FUVMAD')  
         ) AS COP_DEL_ETA 
        ,(SELECT  TO_CHAR(VSKD.VPS_ETA_DT + DECODE(SUBSTR(O.POD_CD,1,2) , 'US', 2 , DECODE(O.POD_CD, O.DEL_CD, 1, 2)),'YYYY-MM-DD')  
          FROM BKG_VVD BVVD, VSK_VSL_PORT_SKD VSKD
          WHERE  BVVD.VSL_CD = VSKD.VSL_CD(+)  
          AND  BVVD.SKD_VOY_NO = VSKD.SKD_VOY_NO(+)
          AND  BVVD.SKD_DIR_CD = VSKD.SKD_DIR_CD(+)
          AND  BVVD.POD_CD = VSKD.VPS_PORT_CD(+)
          AND  BVVD.POD_CLPT_IND_SEQ = VSKD.CLPT_IND_SEQ(+)
          AND  O.BKG_NO = BVVD.BKG_NO
          AND  O.POD_CD = BVVD.POD_CD
        ) AS VSK_DEL_ETA     
        , TO_CHAR(NVL(
          (SELECT /*+ INDEX_DESC (S XAK11CTM_MOVEMENT)*/
                  S.CNMV_EVNT_DT
           FROM   CTM_MOVEMENT S
           WHERE  1=1
           AND    S.CNTR_NO     (+) = V.CNTR_NO
           AND    S.CNMV_YR     (+) = V.CNMV_YR
           AND    S.CNMV_CYC_NO (+) = V.CNMV_CYC_NO
           AND    S.MVMT_STS_CD (+) = 'OC'
           AND    ROWNUM            = 1
           ), V.CGO_RCV_DT), 'YYYY-MM-DD') AS OC_DT  
        ,(SELECT TO_CHAR(NVL(P.FAX_SND_DT, NVL(P.EML_SND_DT, '')),'YYYY-MM-DD') AN_SENT_DT
          FROM BKG_ARR_NTC_DTL P
          WHERE O.BKG_NO = P.BKG_NO(+)
          AND  P.BKG_CUST_TP_CD(+) ='C' 
          AND  P.CUST_CNTC_TP_CD(+) = 'C1'  ) AS AN_SENT_DT 
        ,TO_CHAR(T.CSTMS_CLR_LST_DT,'YYYY-MM-DD')  AS CUST_CLR_DT 
        ,(SELECT /*+ INDEX_DESC(S XAK2CTM_MOVEMENT)*/
                 S.MVMT_STS_CD||' '|| NVL(TO_CHAR(S.CNMV_EVNT_DT,'YYYY-MM-DD'),'') 
          FROM   CTM_MOVEMENT S
          WHERE  S.BKG_NO     (+) = O.BKG_NO
          AND    S.CNTR_NO    (+) = V.CNTR_NO
          AND    S.CNMV_CYC_NO(+) = V.CNMV_CYC_NO
          AND    ROWNUM           = 1
         ) AS MVMT_STS
        ,(SELECT /*+ INDEX_DESC(S XAK11CTM_MOVEMENT) */
                 TO_CHAR(S.CNMV_EVNT_DT, 'YYYY-MM-DD')  
          FROM   CTM_MOVEMENT S
          WHERE  1=1
          AND    S.CNTR_NO     (+)  = V.CNTR_NO
          AND    S.CNMV_YR     (+)  = V.CNMV_YR      
          AND    S.CNMV_CYC_NO (+)  = V.CNMV_CYC_NO
          AND    S.MVMT_STS_CD (+)  = 'ID'
          AND    ROWNUM             = 1
         ) AS PCK_AVAIL_DT
        ,TO_CHAR(S.PKUP_FREE_DT,'YYYY-MM-DD' ) AS FREE_DT  
        ,(SELECT /*+ INDEX_DESC(S XAK11CTM_MOVEMENT) */
                 TO_CHAR(S.CNMV_EVNT_DT, 'YYYY-MM-DD')  
          FROM   CTM_MOVEMENT S
          WHERE  1=1
          AND    S.CNTR_NO     (+)  = V.CNTR_NO
          AND    S.CNMV_YR     (+)  = V.CNMV_YR      
          AND    S.CNMV_CYC_NO (+)  = V.CNMV_CYC_NO
          AND    S.MVMT_STS_CD (+)  = 'ID'
          AND    ROWNUM             = 1
         ) AS DELIVER_DT 
        ,(SELECT /*+ INDEX_ASC(S XAK11CTM_MOVEMENT)*/
                 TO_CHAR(S.CNMV_EVNT_DT,'YYYY-MM-DD')  
          FROM   CTM_MOVEMENT S
          WHERE  1=1
          AND    S.CNTR_NO     (+) = V.CNTR_NO
          AND    S.CNMV_YR     (+) = V.CNMV_YR
          AND    S.CNMV_CYC_NO (+) = V.CNMV_CYC_NO
          AND    S.MVMT_STS_CD (+) = 'MT'
          AND    ROWNUM            = 1
         ) AS MT_RTN_DT
        ,(SELECT /*+ INDEX_ASC(S XAK11CTM_MOVEMENT)*/
                 TO_CHAR(S.CNMV_EVNT_DT,'YYYY-MM-DD')  
          FROM   CTM_MOVEMENT S
          WHERE  1=1
          AND    S.CNTR_NO     (+) = V.CNTR_NO
          AND    S.CNMV_YR     (+) = V.CNMV_YR
          AND    S.CNMV_CYC_NO (+) = V.CNMV_CYC_NO
          AND    S.MVMT_STS_CD (+) = 'IC'
          AND    ROWNUM            = 1   
         ) AS IC_DT
      /*  RATE  INV089 - INV112 */  
        ,DECODE(Q.CLT_PAYR_CNT_CD||Q.CLT_PAYR_CUST_SEQ, '', '', Q.CLT_PAYR_CNT_CD||'-'||LPAD(TO_CHAR(Q.CLT_PAYR_CUST_SEQ),6,'0')) AS CCT_CUST   
        ,DECODE(U.N3PTY_CUST_CNT_CD||U.N3PTY_CUST_SEQ, '', '', U.N3PTY_CUST_CNT_CD||'-'||LPAD(TO_CHAR(U.N3PTY_CUST_SEQ),6,'0')) AS THR_CUST
        ,Q.CLT_OFC_CD   AS CCT_OFC
        ,(SELECT DECODE(U.FRT_TERM_CD, 'C',T.FRT_CLT_FLG,  MIN(NVL(OT.OTS_STL_FLG,'N'))) FROM BKG_OUTSTANDING OT
          WHERE OT.CLT_BL_NO = O.BL_NO AND OT.OFC_CD = DECODE(U.N3PTY_RCV_OFC_CD, '', DECODE(U.FRT_TERM_CD, 'P', Q.PPD_RCV_OFC_CD, Q.CLT_OFC_CD), U.N3PTY_RCV_OFC_CD) AND OT.OTS_BND_TP_CD='O')  AS CLT_FLG 
        ,(SELECT GLM.USD_LOCL_XCH_RT 
          FROM BKG_CHG_RT R1, GL_MON_XCH_RT GLM
          WHERE R1.BKG_NO = O.BKG_NO
          AND R1.FRT_TERM_CD='C'
          AND R1.FRT_INCL_XCLD_DIV_CD ='N'
          AND R1.N3PTY_RCV_OFC_CD IS NULL
          AND GLM.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R1.CRE_DT,'YYYYMMDD'),1,6)
          AND GLM.ACCT_XCH_RT_LVL = '1'
          AND GLM.CURR_CD =  (SELECT O2.AR_CURR_CD
                              FROM MDM_ORGANIZATION O1, MDM_ORGANIZATION O2
                              WHERE O1.OFC_CD =Q.CLT_OFC_CD
                              AND  O2.OFC_CD = O1.AR_OFC_CD) 
          AND ROWNUM=1 )      AS GL_EX_CCT 
       ,(SELECT SUM(ROUND(R1.CHG_AMT*(GL2.USD_LOCL_XCH_RT/GL1.USD_LOCL_XCH_RT),2))
         FROM BKG_CHG_RT R1, GL_MON_XCH_RT GL1, GL_MON_XCH_RT GL2 
         WHERE R1.BKG_NO = O.BKG_NO
         AND R1.FRT_TERM_CD='C'
         AND R1.FRT_INCL_XCLD_DIV_CD ='N'
         AND R1.N3PTY_RCV_OFC_CD IS NULL
         AND GL1.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R1.CRE_DT,'YYYYMMDD'),1,6)
         AND GL1.ACCT_XCH_RT_LVL = '1'  
         AND GL1.CURR_CD = R1.CURR_CD
         AND GL2.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R1.CRE_DT,'YYYYMMDD'),1,6)
         AND GL2.ACCT_XCH_RT_LVL = '1'  
         AND GL2.CURR_CD =  (SELECT O2.AR_CURR_CD
                             FROM MDM_ORGANIZATION O1, MDM_ORGANIZATION O2
                             WHERE O1.OFC_CD =Q.CLT_OFC_CD
                             AND  O2.OFC_CD = O1.AR_OFC_CD)   ) AS LCL_TOT_CCT 
        ,(SELECT SUM(ROUND(R1.CHG_AMT/GL1.USD_LOCL_XCH_RT,2))    
          FROM BKG_CHG_RT R1, GL_MON_XCH_RT GL1 
          WHERE R1.BKG_NO = O.BKG_NO
          AND R1.FRT_TERM_CD ='C'
          AND R1.FRT_INCL_XCLD_DIV_CD ='N'
          AND R1.N3PTY_RCV_OFC_CD IS NULL
          AND GL1.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R1.CRE_DT,'YYYYMMDD'),1,6)
          AND GL1.ACCT_XCH_RT_LVL = '1'  
          AND GL1.CURR_CD = R1.CURR_CD            ) AS USD_TOT_CCT 
        ,Q.AUD_STS_CD  AS AUD_STS_CD  
        ,DECODE(Q.PPD_PAYR_CNT_CD||Q.PPD_PAYR_CUST_SEQ, '', '', Q.PPD_PAYR_CNT_CD||'-'||LPAD(TO_CHAR(Q.PPD_PAYR_CUST_SEQ),6,'0')) AS PPD_CUST
        ,Q.PPD_RCV_OFC_CD   AS PPD_OFC    
        ,(SELECT GLM.USD_LOCL_XCH_RT 
          FROM BKG_CHG_RT R1, GL_MON_XCH_RT GLM
          WHERE R1.BKG_NO = O.BKG_NO
          AND R1.FRT_TERM_CD='P'
          AND R1.FRT_INCL_XCLD_DIV_CD ='N'
          AND R1.N3PTY_RCV_OFC_CD IS NULL
          AND GLM.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R1.CRE_DT,'YYYYMMDD'),1,6)
          AND GLM.ACCT_XCH_RT_LVL = '1'  
          AND GLM.CURR_CD =  (SELECT O2.AR_CURR_CD
                              FROM MDM_ORGANIZATION O1, MDM_ORGANIZATION O2
                              WHERE O1.OFC_CD =Q.PPD_RCV_OFC_CD
                              AND  O2.OFC_CD = O1.AR_OFC_CD )
          AND ROWNUM=1     )      AS GL_EX_PPD  
        ,(SELECT SUM(ROUND(R2.CHG_AMT*(GL4.USD_LOCL_XCH_RT/GL3.USD_LOCL_XCH_RT),2))
          FROM BKG_CHG_RT R2, GL_MON_XCH_RT GL3, GL_MON_XCH_RT GL4
          WHERE R2.BKG_NO = O.BKG_NO
          AND   R2.FRT_TERM_CD ='P'
          AND   R2.FRT_INCL_XCLD_DIV_CD ='N'
          AND   R2.N3PTY_RCV_OFC_CD IS NULL
          AND   GL3.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R2.CRE_DT,'YYYYMMDD'),1,6)
          AND   GL3.ACCT_XCH_RT_LVL = '1'  
          AND   GL3.CURR_CD = R2.CURR_CD
          AND   GL4.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R2.CRE_DT,'YYYYMMDD'),1,6)
          AND   GL4.ACCT_XCH_RT_LVL = '1'  
          AND   GL4.CURR_CD =  (SELECT O2.AR_CURR_CD
                                FROM MDM_ORGANIZATION O1, MDM_ORGANIZATION O2
                                WHERE O1.OFC_CD =Q.PPD_RCV_OFC_CD
                                AND  O2.OFC_CD = O1.AR_OFC_CD)   ) AS LCL_TOT_PPD 
        ,(SELECT SUM(ROUND(R1.CHG_AMT/GL1.USD_LOCL_XCH_RT,2))    
          FROM BKG_CHG_RT R1, GL_MON_XCH_RT GL1 
          WHERE R1.BKG_NO = O.BKG_NO
          AND R1.FRT_TERM_CD='P'
          AND R1.FRT_INCL_XCLD_DIV_CD ='N'
          AND R1.N3PTY_RCV_OFC_CD IS NULL
          AND GL1.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R1.CRE_DT,'YYYYMMDD'),1,6)
          AND GL1.ACCT_XCH_RT_LVL = '1'  
          AND GL1.CURR_CD = R1.CURR_CD            ) AS USD_TOT_PPD 
        ,(SELECT GLM.USD_LOCL_XCH_RT 
          FROM BKG_CHG_RT R1, GL_MON_XCH_RT GLM
          WHERE R1.BKG_NO = O.BKG_NO
          AND R1.FRT_TERM_CD=U.FRT_TERM_CD
          AND R1.N3PTY_RCV_OFC_CD = U.N3PTY_RCV_OFC_CD
          AND R1.FRT_INCL_XCLD_DIV_CD ='N'
          AND GLM.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R1.CRE_DT,'YYYYMMDD'),1,6)
          AND GLM.ACCT_XCH_RT_LVL = '1'
          AND GLM.CURR_CD =  (SELECT O2.AR_CURR_CD
                              FROM MDM_ORGANIZATION O1, MDM_ORGANIZATION O2
                              WHERE O1.OFC_CD = U.N3PTY_RCV_OFC_CD
                              AND  O2.OFC_CD = O1.AR_OFC_CD) 
          AND ROWNUM=1 )      AS GL_EX_THR
       ,(SELECT SUM(ROUND(R1.CHG_AMT*(GL2.USD_LOCL_XCH_RT/GL1.USD_LOCL_XCH_RT),2))
         FROM BKG_CHG_RT R1, GL_MON_XCH_RT GL1, GL_MON_XCH_RT GL2 
         WHERE R1.BKG_NO = O.BKG_NO
         AND R1.FRT_TERM_CD=U.FRT_TERM_CD
         AND R1.N3PTY_RCV_OFC_CD = U.N3PTY_RCV_OFC_CD
         AND R1.FRT_INCL_XCLD_DIV_CD ='N'
         AND GL1.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R1.CRE_DT,'YYYYMMDD'),1,6)
         AND GL1.ACCT_XCH_RT_LVL = '1'  
         AND GL1.CURR_CD = R1.CURR_CD
         AND GL2.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R1.CRE_DT,'YYYYMMDD'),1,6)
         AND GL2.ACCT_XCH_RT_LVL = '1'  
         AND GL2.CURR_CD =  (SELECT O2.AR_CURR_CD
                             FROM MDM_ORGANIZATION O1, MDM_ORGANIZATION O2
                             WHERE O1.OFC_CD = U.N3PTY_RCV_OFC_CD
                             AND  O2.OFC_CD = O1.AR_OFC_CD)   ) AS LCL_TOT_THR 
        ,(SELECT SUM(ROUND(R1.CHG_AMT/GL1.USD_LOCL_XCH_RT,2))    
          FROM BKG_CHG_RT R1, GL_MON_XCH_RT GL1 
          WHERE R1.BKG_NO = O.BKG_NO
          AND R1.FRT_TERM_CD = U.FRT_TERM_CD
          AND R1.N3PTY_RCV_OFC_CD = U.N3PTY_RCV_OFC_CD
          AND R1.FRT_INCL_XCLD_DIV_CD ='N'
          AND GL1.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R1.CRE_DT,'YYYYMMDD'),1,6)
          AND GL1.ACCT_XCH_RT_LVL = '1'  
          AND GL1.CURR_CD = R1.CURR_CD            ) AS USD_TOT_THR   
        ,TO_CHAR(Q.RT_APLY_DT,'YYYY-MM-DD') RT_APLY_DT  
        ,(SELECT NVL(MAX(CR.IB_CR_TERM_DYS),0) FROM MDM_CR_CUST CR
          WHERE (CR.CUST_CNT_CD, CR.CUST_SEQ) = (SELECT C1.CUST_CNT_CD, C1.CUST_SEQ
                                                 FROM  BKG_CUSTOMER C1
                                                 WHERE C1.BKG_NO = O.BKG_NO AND C1.BKG_CUST_TP_CD ='C')) AS IB_CUST_CRTERM  
        ,(SELECT M2.IB_CR_TERM_DYS 
          FROM  MDM_ORGANIZATION M1, MDM_ORGANIZATION M2
          WHERE  M1.OFC_CD = Q.CLT_OFC_CD
          AND    M2.OFC_CD = M1.AR_OFC_CD) AS IB_OFC_CRTERM     
        ,(SELECT NVL(MAX(CR2.OB_CR_TERM_DYS),0) FROM MDM_CR_CUST CR2  
          WHERE (CR2.CUST_CNT_CD, CR2.CUST_SEQ) = (SELECT C1.CUST_CNT_CD, C1.CUST_SEQ
                                                   FROM  BKG_CUSTOMER C1
                                                   WHERE C1.BKG_NO = O.BKG_NO AND C1.BKG_CUST_TP_CD ='S')) AS OB_CUST_CRTERM   
        ,(SELECT M2.OB_CR_TERM_DYS         
          FROM  MDM_ORGANIZATION M1, MDM_ORGANIZATION M2
          WHERE  M1.OFC_CD = Q.PPD_RCV_OFC_CD
          AND    M2.OFC_CD = M1.AR_OFC_CD) AS OB_OFC_CRTERM  
        ,(SELECT CNTR_SEAL_NO  FROM BKG_CNTR_SEAL_NO
          WHERE BKG_NO =  O.BKG_NO
          AND   CNTR_NO = V.CNTR_NO 
          AND CNTR_SEAL_SEQ = 1 ) AS CNTR_SEAL_NO
        ,(SELECT  DECODE(V.CNTR_TPSZ_CD, 'D7','45',SUBSTR(SZ.CNTR_SZ_DESC, 1, 2)) FROM MDM_CNTR_SZ SZ,MDM_CNTR_TP_SZ TP
          WHERE  TP.CNTR_TPSZ_CD = V.CNTR_TPSZ_CD
          AND TP.CNTR_SZ_CD = SZ.CNTR_SZ_CD     )  AS CNTR_SZ_CD
        ,(SELECT NVL(MAX(CO2.CUST_CONV_CD_CTNT), V.CNTR_TPSZ_CD) 
          FROM  INV_CPRT_CD_CONV CO2  
          WHERE CO2.CPRT_CONV_TP_CD ='CNTRTPSZ'
          AND   CO2.CO_CD_CTNT = V.CNTR_TPSZ_CD 
          AND   CO2.SC_NO  = NVL(O.SC_NO,'X') 
          AND   CO2.RFA_NO = NVL(O.RFA_NO,'X')) AS CNTR_TPSZ_CD    
        ,NVL(V.DCGO_FLG, NVL(V.RC_FLG,NVL(V.BB_CGO_FLG,NVL(V.AWK_CGO_FLG,'')))) AS CNTR_SP_CGO_FG  
        ,(SELECT SUBSTR(U1.CUST_REF_NO_CTNT,1,50) FROM BKG_REFERENCE U1 
          WHERE O.BKG_NO = U1.BKG_NO(+)
          AND U1.BKG_REF_TP_CD='BKPO' AND ROWNUM=1) AS BKPO  
        ,(SELECT SUBSTR(U2.CUST_REF_NO_CTNT,1,50) FROM BKG_REFERENCE U2 
          WHERE O.BKG_NO = U2.BKG_NO(+) 
          AND  V.CNTR_NO = U2.CNTR_NO(+) 
          AND U2.BKG_REF_TP_CD='CTPO' AND ROWNUM=1) AS CTPO  
        ,(SELECT V.PRT_NO FROM BKG_REF_DTL V 
          WHERE O.BKG_NO = V.BKG_NO(+)
          AND V.CUST_REF_TP_CD='HP' AND ROWNUM=1)  AS PRT_NO    
        ,(SELECT SUBSTR(U3.CUST_REF_NO_CTNT,1,50) FROM BKG_REFERENCE U3 
          WHERE O.BKG_NO = U3.BKG_NO(+)
          AND U3.BKG_REF_TP_CD='FINV' AND ROWNUM=1) AS INV_REF_NO   
        ,(SELECT SUBSTR(U4.CUST_REF_NO_CTNT,1,50) FROM BKG_REFERENCE U4 
          WHERE O.BKG_NO = U4.BKG_NO(+)
          AND U4.BKG_REF_TP_CD='EBRF' AND ROWNUM=1) AS BKG_REF_NO   
        ,(SELECT SUBSTR(U5.CUST_REF_NO_CTNT,1,50) FROM BKG_REFERENCE U5     
          WHERE O.BKG_NO = U5.BKG_NO(+)
          AND U5.BKG_REF_TP_CD='ESRF' AND ROWNUM=1) AS SI_REF_NO  
        ,(SELECT U6.CUST_NM FROM BKG_CUSTOMER U6  
          WHERE O.BKG_NO = U6.BKG_NO(+)
          AND U6.BKG_CUST_TP_CD = 'E' AND ROWNUM=1) AS EXP_REF_NO    
        ,(SELECT NVL(MAX(CO3.CUST_CONV_CD_CTNT), U.CHG_CD) 
          FROM  INV_CPRT_CD_CONV CO3  
          WHERE CO3.CPRT_CONV_TP_CD ='CHARGE' 
          AND  CO3.CO_CD_CTNT = U.CHG_CD
          AND  CO3.SC_NO  = NVL(O.SC_NO,'X') 
          AND  CO3.RFA_NO = NVL(O.RFA_NO,'X'))  AS CHG_CD
        ,(SELECT NVL(MAX(CO4.CUST_CONV_CD_CTNT), O.CMDT_CD) 
          FROM  INV_CPRT_CD_CONV CO4  
          WHERE CO4.CPRT_CONV_TP_CD ='COMMODITY' 
          AND  CO4.CO_CD_CTNT = O.CMDT_CD
          AND  CO4.SC_NO  = NVL(O.SC_NO,'X') 
          AND  CO4.RFA_NO = NVL(O.RFA_NO,'X')) AS CMDT_CD   
        ,(SELECT D.CMDT_NM FROM MDM_COMMODITY D WHERE O.CMDT_CD = D.CMDT_CD(+)) AS CMDT_NM 
        ,(SELECT TO_CHAR(SUBSTR(S.MK_DESC, 1, 4000)) FROM BKG_BL_MK_DESC S WHERE S.BKG_NO = O.BKG_NO AND S.MK_SEQ=1) AS MK_DESC
        ,(SELECT M.RTN_YD_CD FROM BKG_PKUP_NTC M 
          WHERE M.BKG_NO = O.BKG_NO 
          AND  M.NTC_SEQ = (SELECT MAX(MM.NTC_SEQ) 
                            FROM BKG_PKUP_NTC MM 
                            WHERE MM.BKG_NO = O.BKG_NO)) AS RTN_YD_CD
        ,(SELECT HUB_LOC_CD FROM BKG_CSTMS_ADV_BL
          WHERE BL_NO = O.BL_NO    
          AND CNT_CD =SUBSTR(O.DEL_CD,1,2)) AS HUB_LOC_CD  
        ,(SELECT MAX(DECODE(CNT_CD, 'US', IBD_TRSP_NO, ''))  
          FROM BKG_CSTMS_ADV_IBD                        
          WHERE  BL_NO = O.BL_NO AND CNT_CD ='US' ) AS IBD_TRSP_NO  
        ,(SELECT MAX(DECODE(CNT_CD ,'US', TO_CHAR(IBD_TRSP_ISS_DT,'YYYY-MM-DD'), ''))
          FROM  BKG_CSTMS_ADV_IBD
          WHERE BL_NO = O.BL_NO AND CNT_CD ='US' ) AS IBD_TRSP_ISS_DT 
        ,(SELECT M1.PKUP_NO FROM BKG_PKUP_NTC M1 
          WHERE M1.BKG_NO = O.BKG_NO 
          AND M1.NTC_SEQ = (SELECT MAX(M2.NTC_SEQ) 
                           FROM BKG_PKUP_NTC M2 WHERE M2.BKG_NO = O.BKG_NO)) AS PKUP_NO 
        ,(SELECT M3.PKUP_YD_CD FROM BKG_PKUP_NTC M3 
          WHERE M3.BKG_NO = O.BKG_NO 
          AND M3.NTC_SEQ = (SELECT MAX(M4.NTC_SEQ) 
                           FROM BKG_PKUP_NTC M4 WHERE M4.BKG_NO = O.BKG_NO)) AS PKUP_YD_CD  
        ,(SELECT MAX(TO_CHAR(BC.CGO_RCV_DT,'YYYY-MM-DD')) 
          FROM BKG_CONTAINER BC 
          WHERE BC.BKG_NO = O.BKG_NO  ) AS CGO_RCV_DT
        ,(SELECT SUBSTR(U7.CUST_REF_NO_CTNT,1,50) FROM BKG_REFERENCE U7
          WHERE O.BKG_NO = U7.BKG_NO(+)
          AND U7.BKG_REF_TP_CD='HPDP' AND ROWNUM=1) AS DEPT_NO           
        ,U.FRT_TERM_CD
        ,R.OBL_ISS_OFC_CD
        ,V.MEAS_QTY     
        ,V.CNTR_NO      
        ,V.CNTR_PRT_FLG 
        ,V.CNTR_VOL_QTY 
        ,V.PCK_QTY       
        ,V.PCK_TP_CD    
        ,V.CNTR_WGT     
        ,V.WGT_UT_CD   
        ,V.CURR_CD AS CNTR_CHG_CURR
        ,U.CURR_CD AS GRP_CUR
        ,U.CHG_SUM1 AS TOT_CURR_AMT
        ,V.CNTR_SUM1              
        ,V.CNTR_SUM2   
        ,U.CURR_CD AS CHG_CURR
        ,U.RAT_AS_QTY AS CHG_RATED_AS
        ,U.CHG_UT_AMT AS CHG_RATE
        ,U.CHG_SUM2 AS TOT_CHG_AMT
        ,T.OBL_RDEM_FLG
        ,T.CSTMS_CLR_CD
        ,U.N3PTY_RCV_OFC_CD AS N3PTY_OFC
        /* ADD NEW ITEMS *****************************************************/
        ,O.BL_TP_CD
        ,DECODE(U.FRT_TERM_CD, 'P', 'O', 'I') AS BOUND
        ,( SELECT DECODE(C1.CUST_CNT_CD||C1.CUST_SEQ, '', '', C1.CUST_CNT_CD||'-'||LPAD(TO_CHAR(C1.CUST_SEQ),6,'0'))
           FROM  BKG_CUSTOMER C1
           WHERE C1.BKG_NO = O.BKG_NO AND C1.BKG_CUST_TP_CD ='F' ) AS FORWARDER 
        ,( SELECT C1.CUST_NM
           FROM  BKG_CUSTOMER C1
           WHERE C1.BKG_NO = O.BKG_NO AND C1.BKG_CUST_TP_CD ='F' ) AS FORWARDER_NM 
        ,DECODE(U.FRT_TERM_CD, 'P', O.OB_SLS_OFC_CD, O.IB_SLS_OFC_CD) AS SLS_OFC_CD
        ,O.OB_SREP_CD AS SREP_CD
        ,(SELECT TRD_CD FROM COA_RGST_BKG WHERE BKG_NO = O.BKG_NO) AS TRADE_CD
        ,DECODE(DECODE(U.FRT_TERM_CD, 'P', O.RCV_TERM_CD, O.DE_TERM_CD), 'S', 'LCL', 'FCL') AS TRAFFIC_MOD
        ,V.MEAS_UT_CD AS CNTR_MEAS_UT
        ,V.DIFF_RMK AS CNTR_DESC
        ,(SELECT NVL(CR.CR_AMT, 0) FROM MDM_CR_CUST CR
          WHERE (CR.CUST_CNT_CD, CR.CUST_SEQ) = (SELECT C1.CUST_CNT_CD, C1.CUST_SEQ
                                                 FROM  BKG_CUSTOMER C1
                                                 WHERE C1.BKG_NO = O.BKG_NO AND C1.BKG_CUST_TP_CD = DECODE(U.FRT_TERM_CD, 'P', 'S', 'C'))) AS CREDIT_AMT       
        ,(SELECT NVL(CR2.CR_FLG, 'N') FROM MDM_CR_CUST CR2  
          WHERE (CR2.CUST_CNT_CD, CR2.CUST_SEQ) = (SELECT C1.CUST_CNT_CD, C1.CUST_SEQ
                                                   FROM  BKG_CUSTOMER C1
                                                   WHERE C1.BKG_NO = O.BKG_NO AND C1.BKG_CUST_TP_CD = DECODE(U.FRT_TERM_CD, 'P', 'S', 'C'))) AS CREDIT_FLG              
        ,(SELECT CUST_LGL_ENG_NM
          FROM MDM_CUSTOMER
          WHERE CUST_CNT_CD = DECODE(U.N3PTY_RCV_OFC_CD, '', DECODE(U.FRT_TERM_CD, 'P', Q.PPD_PAYR_CNT_CD, Q.CLT_PAYR_CNT_CD), U.N3PTY_CUST_CNT_CD)
          AND CUST_SEQ = DECODE(U.N3PTY_RCV_OFC_CD, '', DECODE(U.FRT_TERM_CD, 'P', Q.PPD_PAYR_CUST_SEQ, Q.CLT_PAYR_CUST_SEQ), U.N3PTY_CUST_SEQ)) AS BILL_CUST_NM
        ,(SELECT BZET_ADDR
          FROM MDM_CUST_ADDR
          WHERE CUST_CNT_CD = DECODE(U.N3PTY_RCV_OFC_CD, '', DECODE(U.FRT_TERM_CD, 'P', Q.PPD_PAYR_CNT_CD, Q.CLT_PAYR_CNT_CD), U.N3PTY_CUST_CNT_CD)
          AND CUST_SEQ = DECODE(U.N3PTY_RCV_OFC_CD, '', DECODE(U.FRT_TERM_CD, 'P', Q.PPD_PAYR_CUST_SEQ, Q.CLT_PAYR_CUST_SEQ), U.N3PTY_CUST_SEQ)
          AND PRMRY_CHK_FLG = 'Y') AS BILL_CUST_ADDR
        ,(SELECT B.OFC_ENG_NM
          FROM MDM_CUSTOMER A, MDM_ORGANIZATION B
          WHERE A.OFC_CD = B.OFC_CD
          AND A.CUST_CNT_CD = DECODE(U.N3PTY_RCV_OFC_CD, '', DECODE(U.FRT_TERM_CD, 'P', Q.PPD_PAYR_CNT_CD, Q.CLT_PAYR_CNT_CD), U.N3PTY_CUST_CNT_CD)
          AND A.CUST_SEQ = DECODE(U.N3PTY_RCV_OFC_CD, '', DECODE(U.FRT_TERM_CD, 'P', Q.PPD_PAYR_CUST_SEQ, Q.CLT_PAYR_CUST_SEQ), U.N3PTY_CUST_SEQ)) AS CUST_OFC_NM
        ,(SELECT B.MODI_AGN_CD
          FROM MDM_CUSTOMER A, MDM_ORGANIZATION B
          WHERE A.OFC_CD = B.OFC_CD
          AND A.CUST_CNT_CD = DECODE(U.N3PTY_RCV_OFC_CD, '', DECODE(U.FRT_TERM_CD, 'P', Q.PPD_PAYR_CNT_CD, Q.CLT_PAYR_CNT_CD), U.N3PTY_CUST_CNT_CD)
          AND A.CUST_SEQ = DECODE(U.N3PTY_RCV_OFC_CD, '', DECODE(U.FRT_TERM_CD, 'P', Q.PPD_PAYR_CUST_SEQ, Q.CLT_PAYR_CUST_SEQ), U.N3PTY_CUST_SEQ)) AS CUST_OFC_SAP_ID   
        ,(SELECT /*+ INDEX_ASC(S XAK11CTM_MOVEMENT)*/
                 TO_CHAR(S.CNMV_EVNT_DT,'YYYY-MM-DD')  
          FROM   CTM_MOVEMENT S
          WHERE  1=1
          AND    S.CNTR_NO     (+) = V.CNTR_NO
          AND    S.CNMV_YR     (+) = V.CNMV_YR
          AND    S.CNMV_CYC_NO (+) = V.CNMV_CYC_NO
          AND    S.MVMT_STS_CD (+) = 'VD'
          AND    ROWNUM            = 1   
         ) AS DISCHARGE_DT   
        ,(SELECT MAX(OTS_HIS_SEQ)
          FROM SAR_OTS_HIS A,
               MDM_ORGANIZATION B
          WHERE B.OFC_CD = DECODE(U.N3PTY_RCV_OFC_CD, '', DECODE(U.FRT_TERM_CD, 'P', Q.PPD_RCV_OFC_CD, Q.CLT_OFC_CD), U.N3PTY_RCV_OFC_CD)
          AND A.BL_NO = O.BL_NO
          AND A.INV_OFC_CD = B.AR_OFC_CD
          AND A.OTS_HIS_TP_CD = 'OTS') AS OTS_HIS_SEQ
        ,(SELECT /*+ INDEX_ASC(S XAK11CTM_MOVEMENT)*/
                 TO_CHAR(S.CNMV_EVNT_DT,'YYYY-MM-DD')  
          FROM   CTM_MOVEMENT S
          WHERE  1=1
          AND    S.CNTR_NO     (+) = V.CNTR_NO
          AND    S.CNMV_YR     (+) = V.CNMV_YR
          AND    S.CNMV_CYC_NO (+) = V.CNMV_CYC_NO
          AND    S.MVMT_STS_CD (+) = 'OP'
          AND    ROWNUM            = 1   
         ) AS MT_OUT_DT  
        ,(SELECT /*+ INDEX_ASC(S XAK11CTM_MOVEMENT)*/
                 TO_CHAR(S.CNMV_EVNT_DT,'YYYY-MM-DD')  
          FROM   CTM_MOVEMENT S
          WHERE  1=1
          AND    S.CNTR_NO     (+) = V.CNTR_NO
          AND    S.CNMV_YR     (+) = V.CNMV_YR
          AND    S.CNMV_CYC_NO (+) = V.CNMV_CYC_NO
          AND    S.MVMT_STS_CD (+) = 'VL'
          AND    ROWNUM            = 1   
         ) AS LOADING_DT   
        ,(SELECT MAX(AR_IF_NO)
          FROM INV_AR_MN A,
               MDM_ORGANIZATION B
          WHERE B.OFC_CD = DECODE(U.N3PTY_RCV_OFC_CD, '', DECODE(U.FRT_TERM_CD, 'P', Q.PPD_RCV_OFC_CD, Q.CLT_OFC_CD), U.N3PTY_RCV_OFC_CD)
          AND A.BL_SRC_NO = O.BL_NO
          AND A.AR_OFC_CD = B.AR_OFC_CD
          AND A.REV_TP_CD <> 'M'
          AND A.BL_INV_CFM_DT IS NOT NULL
          AND A.INV_DELT_DIV_CD <> 'Y') AS AR_IF_NO 
        ,(SELECT CRR_CD
          FROM MDM_VSL_CNTR 
          WHERE VSL_CD = (SELECT K3.VSL_CD 
                          FROM BKG_VVD K3 
                          WHERE K3.BKG_NO = O.BKG_NO 
                          AND K3.VSL_PRE_PST_CD ='T')) AS CARRIER
        ,U.CHG_AMT  
        ,(SELECT ROUND(U.CHG_AMT/GL1.USD_LOCL_XCH_RT, 2)
          FROM GL_MON_XCH_RT GL1 
          WHERE GL1.ACCT_XCH_RT_YRMON = SUBSTR(TO_CHAR(U.CRE_DT,'YYYYMMDD'), 1, 6)
          AND GL1.ACCT_XCH_RT_LVL = '1'  
          AND GL1.CURR_CD = U.CURR_CD) AS USD_CHG_AMT 
        ,(SELECT CHG_NM
          FROM MDM_CHARGE
          WHERE CHG_CD = U.CHG_CD) AS CHG_NM
        ,DECODE(U.N3PTY_RCV_OFC_CD, '', 'N', 'Y') AS THR_PAY_FLG
        ,O.POL_CD AS FST_POL  
        ,O.POD_CD AS LST_POD 
        ,(SELECT /*+ INDEX_DESC( K6 XPKBKG_VVD ) */ 
                 K6.VSL_CD||K6.SKD_VOY_NO||K6.SKD_DIR_CD 
          FROM  BKG_VVD K6
          WHERE K6.BKG_NO = O.BKG_NO
          AND K6.POD_CD = O.POD_CD      
          AND K6.VSL_PRE_PST_CD||K6.VSL_SEQ = (SELECT MAX(S.VSL_PRE_PST_CD||S.VSL_SEQ) 
                                               FROM BKG_VVD S               
                                               WHERE S.BKG_NO = O.BKG_NO     
                                               AND S.POD_CD = O.POD_CD)      
          ) AS LST_VVD
        ,V.CHG_AMT AS CNTR_AMT
        /***********************************************************/
        ,U.CHG001_S
        ,U.CHG002_S
        ,U.CHG003_S
        ,U.CHG004_S
        ,U.CHG005_S
        ,V.CHG001
        ,V.CHG002
        ,V.CHG003
        ,V.CHG004
        ,V.CHG005  
    FROM BKG_BOOKING O,
         BKG_BL_DOC P,
         BKG_RATE Q,
         BKG_BL_ISS R,
         BKG_ARR_NTC S,
         BKG_CGO_RLSE T, 
         (SELECT A.BKG_NO, B.FRT_TERM_CD, B.RT_SEQ, B.N3PTY_RCV_OFC_CD, B.N3PTY_CUST_CNT_CD, 
                 B.N3PTY_CUST_SEQ, B.CHG_CD, B.CURR_CD, B.RAT_UT_CD, B.RAT_AS_QTY, B.CHG_UT_AMT, B.CHG_AMT, B.CRE_DT,
                 SUM(B.CHG_AMT) OVER (PARTITION BY B.BKG_NO, B.FRT_TERM_CD, B.CURR_CD) CHG_SUM1,
                 SUM(B.CHG_AMT) OVER (PARTITION BY B.BKG_NO, B.FRT_TERM_CD, B.CURR_CD, B.CHG_CD) CHG_SUM2,
                 DECODE(C.DP_SEQ, 1, B.CHG_AMT, 0) CHG001_S,
                 DECODE(C.DP_SEQ, 2, B.CHG_AMT, 0) CHG002_S,
                 DECODE(C.DP_SEQ, 3, B.CHG_AMT, 0) CHG003_S,
                 DECODE(C.DP_SEQ, 4, B.CHG_AMT, 0) CHG004_S,
                 DECODE(C.DP_SEQ, 5, B.CHG_AMT, 0) CHG005_S
          FROM BKG_BOOKING A,
               BKG_CHG_RT B,
               INV_CPRT_TMPLT_CHG C,
               MDM_CHARGE D
		       #if (${cust_cd} != '' && ${cust_gb} != 'P')
                   ,BKG_CUSTOMER E
                   ,MDM_CUSTOMER H
               #end
               ,BKG_BL_DOC F
               ,BKG_VVD G
			   #if (${from_date} != '' && ${to_date} != '')
               		#if (${date_gb} == '1STVVD' || ${date_gb} == 'ETA' || ${date_gb} == 'ETD')
                   		,BKG_VVD I
                   		,VSK_VSL_PORT_SKD J
  	           		#end
			   #end
          WHERE A.BKG_NO = B.BKG_NO(+)
          AND A.BKG_NO = F.BKG_NO(+)
          AND A.BKG_NO = G.BKG_NO(+)
          AND B.FRT_INCL_XCLD_DIV_CD(+) ='N'
          AND G.VSL_PRE_PST_CD(+) = 'T'
          AND C.AR_OFC_CD(+) = @[ar_ofc_cd]
          AND C.RPT_TMPLT_NM(+) = @[rpt_tmplt_nm]          
          #if (${sc_no} != '')
              AND C.CPRT_TP_CTNT(+) = 'S'
              AND C.CPRT_VAL_CTNT(+) = @[sc_no]
          #elseif (${rfa_no} != '')
              AND C.CPRT_TP_CTNT(+) = 'R'
              AND C.CPRT_VAL_CTNT(+) = @[rfa_no]
          #else
              AND C.CPRT_TP_CTNT(+) = 'X'
          #end 
          AND C.CHG_CD(+) = DECODE(C.CPRT_CHG_GRP_FLG(+), 'N', D.CHG_CD, D.REP_CHG_CD)
          AND B.CHG_CD = D.CHG_CD(+)       
          #if (${bl_nos} != '')
              AND A.BL_NO in (${bl_nos})
          #end
          #if (${frt_term_cd} != 'A')
              AND B.FRT_TERM_CD = @[frt_term_cd]
          #end
          #if (${sc_no} != '')
              AND A.SC_NO = @[sc_no]
          #end
          #if (${rfa_no} != '')
              AND A.RFA_NO = @[rfa_no]
          #end
          #if (${bkg_ofc_cd} != '')
              AND A.BKG_OFC_CD = @[bkg_ofc_cd]
          #end
          #if (${ob_sls_ofc_cd} != '')
              AND A.OB_SLS_OFC_CD = @[ob_sls_ofc_cd]
          #end
          #if (${cust_cd} != '' && ${cust_gb} != 'P')
              AND A.BKG_NO = E.BKG_NO
              AND E.CUST_CNT_CD = H.CUST_CNT_CD 
              AND E.CUST_SEQ = H.CUST_SEQ     
              #if (${cust_gb} == 'S' || ${cust_gb} == 'C' || ${cust_gb} == 'N' || ${cust_gb} == 'F')
                  AND E.BKG_CUST_TP_CD = @[cust_gb]
                  AND E.CUST_CNT_CD||E.CUST_SEQ IN (@[cust_cd])
              #end
              #if (${cust_gb} == 'GS')
                  AND E.BKG_CUST_TP_CD = 'S'
                  AND SUBSTR(H.CUST_GRP_ID, 3) IN (@[cust_cd])
              #end
              #if (${cust_gb} == 'GC')
                  AND E.BKG_CUST_TP_CD = 'C'
                  AND SUBSTR(H.CUST_GRP_ID, 3) IN (@[cust_cd])
              #end
          #end
          #if (${from_date} != '' && ${to_date} != '')
              #if (${date_gb} == 'OBD')
                  AND F.BL_OBRD_DT between to_date(REPLACE(@[from_date],'-',''),'YYYYMMDD') and to_date(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999             
              #end 
              #if (${date_gb} == 'PCD')              
                  AND A.PORT_CLZ_DT  between to_date(REPLACE(@[from_date],'-',''),'YYYYMMDD') and to_date(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999              
              #end 
              #if (${date_gb} == 'BDR')             
                  AND F.BDR_DT  between to_date(REPLACE(@[from_date],'-',''),'YYYYMMDD') and to_date(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999             
              #end 
              #if (${date_gb} == '1STVVD')
                  AND I.BKG_NO(+) = A.BKG_NO
                  AND I.VSL_CD = J.VSL_CD
                  AND I.SKD_VOY_NO = J.SKD_VOY_NO
                  AND I.SKD_DIR_CD = J.SKD_DIR_CD
                  AND I.POL_CD = J.VPS_PORT_CD
                  AND I.POL_YD_CD = J.YD_CD
                  AND I.POL_CLPT_IND_SEQ = J.CLPT_IND_SEQ
                  AND I.ROWID = (SELECT SUBSTR(MIN(S.VSL_PRE_PST_CD||LTRIM(TO_CHAR(S.VSL_SEQ, '000'))||ROWID), 5) -- 1st VVD
                                 FROM BKG_VVD S
                                 WHERE S.BKG_NO = I.BKG_NO)
                  AND J.VPS_ETD_DT BETWEEN TO_DATE(REPLACE(@[from_date],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999
                  AND NVL(J.SKD_CNG_STS_CD, ' ') <> 'S'
              #end
              #if (${date_gb} == 'ETD')                    
                  AND I.BKG_NO(+) = A.BKG_NO
                  AND I.VSL_CD = J.VSL_CD
                  AND I.SKD_VOY_NO = J.SKD_VOY_NO
                  AND I.SKD_DIR_CD = J.SKD_DIR_CD
                  AND I.POL_CD = J.VPS_PORT_CD
                  AND I.POL_YD_CD = J.YD_CD
                  AND I.POL_CLPT_IND_SEQ = J.CLPT_IND_SEQ
                  AND I.VSL_PRE_PST_CD = 'T'
                  AND J.VPS_ETD_DT BETWEEN TO_DATE(REPLACE(@[from_date],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999
                  AND NVL(J.SKD_CNG_STS_CD, ' ') <> 'S'                    
              #end 
              #if (${date_gb} == 'ETA')                   
                  AND I.BKG_NO(+) = A.BKG_NO
                  AND I.VSL_CD = J.VSL_CD
                  AND I.SKD_VOY_NO = J.SKD_VOY_NO
                  AND I.SKD_DIR_CD = J.SKD_DIR_CD
                  AND I.POD_CD = J.VPS_PORT_CD
                  AND I.POD_YD_CD = J.YD_CD
                  AND I.POD_CLPT_IND_SEQ = J.CLPT_IND_SEQ
                  AND I.VSL_PRE_PST_CD = 'T'
                  AND J.VPS_ETA_DT BETWEEN TO_DATE(REPLACE(@[from_date],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999
                  AND NVL(J.SKD_CNG_STS_CD, ' ') <> 'S'                   
              #end
          #end
          #if (${del_cd} != '')
              AND A.DEL_CD like @[del_cd]||'%'
          #end
          #if (${por_cd} != '')
              AND A.POR_CD like @[por_cd]||'%'
          #end
          #if (${pol_cd} != '')
              AND A.POL_CD like @[pol_cd]||'%'
          #end
          #if (${pod_cd} != '')
              AND A.POD_CD like @[pod_cd]||'%'
          #end
          #if (${vvd} != '')         
              AND G.VSL_CD||G.SKD_VOY_NO||G.SKD_DIR_CD = @[vvd]
          #end       
		  #if ((${from_date} != '' && ${to_date} != '' && (${date_gb} == 'IVD' || ${date_gb} == 'IFD')) ||
               (${cust_cd} != '' && ${cust_gb} == 'P'))
              AND EXISTS (SELECT 'X'
                          FROM INV_AR_MN
                          WHERE BKG_NO = A.BKG_NO
                          AND IO_BND_CD = DECODE(B.FRT_TERM_CD, 'P', 'O', 'I')
                          AND REV_TP_CD <> 'M'
                          AND INV_DELT_DIV_CD <> 'Y'
                          #if (${from_date} != '' && ${to_date} != '')	
                              #if (${date_gb} == 'IVD')
                                  AND TO_DATE(ISS_DT,'YYYYMMDD') BETWEEN TO_DATE(REPLACE(@[from_date],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999             
                              #end 
                              #if (${date_gb} == 'IFD')              
                                  AND TO_DATE(BL_INV_IF_DT,'YYYYMMDD') BETWEEN TO_DATE(REPLACE(@[from_date],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999              
                              #end 
                          #end  
                          #if (${cust_cd} != '') 
                              #if (${cust_gb} == 'P')
                                  AND ACT_CUST_CNT_CD||ACT_CUST_SEQ IN (@[cust_cd])
                              #end 
                          #end       
                          )     
          #end   
         ) U,
         (SELECT A.BKG_NO, C.FRT_TERM_CD, B.CNTR_NO, B.CNMV_CYC_NO, B.CNMV_YR, B.CGO_RCV_DT, B.CNTR_TPSZ_CD, B.MEAS_QTY, 
                 B.MEAS_UT_CD, B.CNTR_PRT_FLG, B.CNTR_VOL_QTY, B.PCK_QTY, B.PCK_TP_CD, B.CNTR_WGT, B.WGT_UT_CD, B.DCGO_FLG, 
                 B.RC_FLG, B.BB_CGO_FLG, B.AWK_CGO_FLG, B.DIFF_RMK, C.CHG_CD, C.CURR_CD, C.RAT_UT_CD, C.RAT_AS_QTY, C.CHG_UT_AMT, C.CHG_AMT,
                 SUM(C.CHG_AMT) OVER (PARTITION BY C.BKG_NO, C.FRT_TERM_CD, C.CNTR_NO, C.CURR_CD) CNTR_SUM1,
                 SUM(C.CHG_AMT) OVER (PARTITION BY C.BKG_NO, C.FRT_TERM_CD, C.CNTR_NO, C.CURR_CD, C.CHG_CD) CNTR_SUM2,
                 DECODE(D.DP_SEQ, 1, C.CHG_AMT, 0) CHG001,
                 DECODE(D.DP_SEQ, 2, C.CHG_AMT, 0) CHG002,
                 DECODE(D.DP_SEQ, 3, C.CHG_AMT, 0) CHG003,
                 DECODE(D.DP_SEQ, 4, C.CHG_AMT, 0) CHG004,
                 DECODE(D.DP_SEQ, 5, C.CHG_AMT, 0) CHG005
          FROM BKG_BOOKING A,
               BKG_CONTAINER B,
               BKG_CNTR_RT C,
               INV_CPRT_TMPLT_CHG D,
               MDM_CHARGE K
               #if (${cust_cd} != '' && ${cust_gb} != 'P') 
                   ,BKG_CUSTOMER E
                   ,MDM_CUSTOMER H
               #end
               ,BKG_BL_DOC F
               ,BKG_VVD G
			   #if (${from_date} != '' && ${to_date} != '')
               		#if (${date_gb} == '1STVVD' || ${date_gb} == 'ETA' || ${date_gb} == 'ETD')
                   		,BKG_VVD I
                   		,VSK_VSL_PORT_SKD J
  	           		#end
			   #end
          WHERE A.BKG_NO = B.BKG_NO(+)
          AND A.BKG_NO = C.BKG_NO(+)
          AND A.BKG_NO = F.BKG_NO(+)
          AND A.BKG_NO = G.BKG_NO(+)
          AND B.CNTR_NO = NVL(C.CNTR_NO, B.CNTR_NO)
          AND C.FRT_INCL_XCLD_DIV_CD(+) ='N' 
          AND G.VSL_PRE_PST_CD(+) = 'T'
          AND D.AR_OFC_CD(+) = @[ar_ofc_cd]
          AND D.RPT_TMPLT_NM(+) = @[rpt_tmplt_nm]
          #if (${sc_no} != '')
              AND D.CPRT_TP_CTNT(+) = 'S'
              AND D.CPRT_VAL_CTNT(+) = @[sc_no]
          #elseif (${rfa_no} != '')
              AND D.CPRT_TP_CTNT(+) = 'R'
              AND D.CPRT_VAL_CTNT(+) = @[rfa_no]
          #else
              AND D.CPRT_TP_CTNT(+) = 'X'
          #end 
          AND D.CHG_CD(+) = DECODE(D.CPRT_CHG_GRP_FLG(+), 'N', K.CHG_CD, K.REP_CHG_CD)
          AND C.CHG_CD = K.CHG_CD(+)
          #if (${bl_nos} != '')
              AND A.BL_NO in (${bl_nos})
          #end
          #if (${frt_term_cd} != 'A')
              AND C.FRT_TERM_CD = @[frt_term_cd]
          #end
          #if (${sc_no} != '')
              AND A.SC_NO = @[sc_no]
          #end
          #if (${rfa_no} != '')
              AND A.RFA_NO = @[rfa_no]
          #end
          #if (${bkg_ofc_cd} != '')
              AND A.BKG_OFC_CD = @[bkg_ofc_cd]
          #end
          #if (${ob_sls_ofc_cd} != '')
              AND A.OB_SLS_OFC_CD = @[ob_sls_ofc_cd]
          #end
          #if (${cust_cd} != '' && ${cust_gb} != 'P')
              AND A.BKG_NO = E.BKG_NO
              AND E.CUST_CNT_CD = H.CUST_CNT_CD 
              AND E.CUST_SEQ = H.CUST_SEQ     
              #if (${cust_gb} == 'S' || ${cust_gb} == 'C' || ${cust_gb} == 'N' || ${cust_gb} == 'F')
                  AND E.BKG_CUST_TP_CD = @[cust_gb]
                  AND E.CUST_CNT_CD||E.CUST_SEQ IN (@[cust_cd])
              #end
              #if (${cust_gb} == 'GS')
                  AND E.BKG_CUST_TP_CD = 'S'
                  AND SUBSTR(H.CUST_GRP_ID, 3) IN (@[cust_cd])
              #end
              #if (${cust_gb} == 'GC')
                  AND E.BKG_CUST_TP_CD = 'C'
                  AND SUBSTR(H.CUST_GRP_ID, 3) IN (@[cust_cd])
              #end
          #end
          #if (${from_date} != '' && ${to_date} != '')
              #if (${date_gb} == 'OBD')
                  AND F.BL_OBRD_DT BETWEEN TO_DATE(REPLACE(@[from_date],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999             
              #end 
              #if (${date_gb} == 'PCD')              
                  AND A.PORT_CLZ_DT BETWEEN TO_DATE(REPLACE(@[from_date],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999              
              #end 
              #if (${date_gb} == 'BDR')             
                  AND F.BDR_DT BETWEEN TO_DATE(REPLACE(@[from_date],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999             
              #end 
              #if (${date_gb} == '1STVVD')
                  AND I.BKG_NO(+) = A.BKG_NO
                  AND I.VSL_CD = J.VSL_CD
                  AND I.SKD_VOY_NO = J.SKD_VOY_NO
                  AND I.SKD_DIR_CD = J.SKD_DIR_CD
                  AND I.POL_CD = J.VPS_PORT_CD
                  AND I.POL_YD_CD = J.YD_CD
                  AND I.POL_CLPT_IND_SEQ = J.CLPT_IND_SEQ
                  AND I.ROWID = (SELECT SUBSTR(MIN(S.VSL_PRE_PST_CD||LTRIM(TO_CHAR(S.VSL_SEQ, '000'))||ROWID), 5) -- 1st VVD
                                 FROM BKG_VVD S
                                 WHERE S.BKG_NO = I.BKG_NO)
                  AND J.VPS_ETD_DT BETWEEN TO_DATE(REPLACE(@[from_date],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999
                  AND NVL(J.SKD_CNG_STS_CD, ' ') <> 'S'
              #end
              #if (${date_gb} == 'ETD')                    
                  AND I.BKG_NO(+) = A.BKG_NO
                  AND I.VSL_CD = J.VSL_CD
                  AND I.SKD_VOY_NO = J.SKD_VOY_NO
                  AND I.SKD_DIR_CD = J.SKD_DIR_CD
                  AND I.POL_CD = J.VPS_PORT_CD
                  AND I.POL_YD_CD = J.YD_CD
                  AND I.POL_CLPT_IND_SEQ = J.CLPT_IND_SEQ
                  AND I.VSL_PRE_PST_CD = 'T'
                  AND J.VPS_ETD_DT BETWEEN TO_DATE(REPLACE(@[from_date],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999
                  AND NVL(J.SKD_CNG_STS_CD, ' ') <> 'S'                    
              #end 
              #if (${date_gb} == 'ETA')                   
                  AND I.BKG_NO(+) = A.BKG_NO
                  AND I.VSL_CD = J.VSL_CD
                  AND I.SKD_VOY_NO = J.SKD_VOY_NO
                  AND I.SKD_DIR_CD = J.SKD_DIR_CD
                  AND I.POD_CD = J.VPS_PORT_CD
                  AND I.POD_YD_CD = J.YD_CD
                  AND I.POD_CLPT_IND_SEQ = J.CLPT_IND_SEQ
                  AND I.VSL_PRE_PST_CD = 'T'
                  AND J.VPS_ETA_DT BETWEEN TO_DATE(REPLACE(@[from_date],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999
                  AND NVL(J.SKD_CNG_STS_CD, ' ') <> 'S'                   
              #end
          #end
          #if (${del_cd} != '')
              AND A.DEL_CD like @[del_cd]||'%'
          #end
          #if (${por_cd} != '')
              AND A.POR_CD like @[por_cd]||'%'
          #end
          #if (${pol_cd} != '')
              AND A.POL_CD like @[pol_cd]||'%'
          #end
          #if (${pod_cd} != '')
              AND A.POD_CD like @[pod_cd]||'%'
          #end
          #if (${vvd} != '')         
              AND G.VSL_CD||G.SKD_VOY_NO||G.SKD_DIR_CD = @[vvd]
          #end    
		  #if ((${from_date} != '' && ${to_date} != '' && (${date_gb} == 'IVD' || ${date_gb} == 'IFD')) ||
               (${cust_cd} != '' && ${cust_gb} == 'P'))
              AND EXISTS (SELECT 'X'
                          FROM INV_AR_MN
                          WHERE BKG_NO = A.BKG_NO
                          AND IO_BND_CD = DECODE(C.FRT_TERM_CD, 'P', 'O', 'I')
                          AND REV_TP_CD <> 'M'
                          AND INV_DELT_DIV_CD <> 'Y'
                          #if (${from_date} != '' && ${to_date} != '')	
                              #if (${date_gb} == 'IVD')
                                  AND TO_DATE(ISS_DT,'YYYYMMDD') BETWEEN TO_DATE(REPLACE(@[from_date],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999             
                              #end 
                              #if (${date_gb} == 'IFD')              
                                  AND TO_DATE(BL_INV_IF_DT,'YYYYMMDD') BETWEEN TO_DATE(REPLACE(@[from_date],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999              
                              #end 
                          #end  
                          #if (${cust_cd} != '') 
                              #if (${cust_gb} == 'P')
                                  AND ACT_CUST_CNT_CD||ACT_CUST_SEQ IN (@[cust_cd])
                              #end 
                          #end       
                          )     
          #end      
         ) V
    WHERE O.BKG_NO = P.BKG_NO(+)
    AND O.BKG_NO = Q.BKG_NO(+)
    AND O.BKG_STS_CD IN ('F','S')
    AND O.BKG_CGO_TP_CD <> 'P'
    AND O.BKG_NO = R.BKG_NO(+)
    AND O.BKG_NO = S.BKG_NO(+)
    AND O.BL_NO = T.BL_NO(+)
    AND O.BKG_NO = U.BKG_NO
    AND U.BKG_NO = V.BKG_NO(+)
    AND U.FRT_TERM_CD = V.FRT_TERM_CD(+)
    AND U.CURR_CD = V.CURR_CD(+)
    AND U.CHG_CD = V.CHG_CD(+)
    AND U.RAT_UT_CD = V.RAT_UT_CD(+)) MN,    
    INV_AR_MN IAM,
    SAR_OTS_HIS SHS,
    SAR_OTS_HDR SHR
WHERE MN.AR_IF_NO = IAM.AR_IF_NO(+)
AND MN.OTS_HIS_SEQ = SHS.OTS_HIS_SEQ(+)
AND SHS.RHQ_CD = SHR.RHQ_CD
AND SHS.OTS_OFC_CD = SHR.OTS_OFC_CD
AND SHS.BL_NO = SHR.BL_NO
AND SHS.INV_NO = SHR.INV_NO
#if (${from_date} != '' && ${to_date} != '')	
	#if (${date_gb} == 'IVD')
    	AND TO_DATE(IAM.ISS_DT,'YYYYMMDD') BETWEEN TO_DATE(REPLACE(@[from_date],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999             
    #end 
    #if (${date_gb} == 'IFD')              
    	AND TO_DATE(IAM.BL_INV_IF_DT,'YYYYMMDD') BETWEEN TO_DATE(REPLACE(@[from_date],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999              
    #end 
#end  
#if (${cust_cd} != '') 
	#if (${cust_gb} == 'P')
        AND IAM.ACT_CUST_CNT_CD||IAM.ACT_CUST_SEQ IN (@[cust_cd])
	#end 
#end 
)
GROUP BY RPT_TMPLT_NM
#foreach( ${key} in ${allcols}) 
	#if($key != 'CHG001' && $key != 'CHG002' && $key != 'CHG003' && $key != 'CHG004' && $key != 'CHG005' && $key != 'CHG999')
		,$key
	#end	
#end
ORDER BY RPT_TMPLT_NM
#foreach( ${key} in ${allcols}) 
    ,$key
#end			]]></sql>
			<params>
				<param name="rpt_tmplt_nm" type="12" value="" out="N"/>
				<param name="ar_ofc_cd" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
				<param name="rfa_no" type="12" value="" out="N"/>
				<param name="frt_term_cd" type="12" value="" out="N"/>
				<param name="bkg_ofc_cd" type="12" value="" out="N"/>
				<param name="ob_sls_ofc_cd" type="12" value="" out="N"/>
				<param name="cust_gb" type="12" value="" out="N"/>
				<param name="cust_cd" type="12" value="" out="N"/>
				<param name="from_date" type="12" value="" out="N"/>
				<param name="to_date" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
				<param name="por_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
