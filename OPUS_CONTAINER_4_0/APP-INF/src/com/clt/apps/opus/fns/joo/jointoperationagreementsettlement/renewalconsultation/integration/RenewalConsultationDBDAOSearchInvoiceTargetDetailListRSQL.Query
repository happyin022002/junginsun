<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RenewalConsultationDBDAOSearchInvoiceTargetDetailListRSQL">
			<desc><![CDATA[Invoice Target Detail Search.]]></desc>
			<sql><![CDATA[
SELECT STL.VSL_CD
     , STL.SKD_VOY_NO
     , STL.SKD_DIR_CD
     , STL.REV_DIR_CD
     , STL.REV_YRMON
     , STL.STL_VVD_SEQ
     , STL.JO_CRR_CD
     , STL.RLANE_CD
     , STL.JO_STL_ITM_CD
     , STL.ORD_SEQ
     , STL.JO_STL_JB_CD
     , STL.LOCL_CURR_CD
     , STL.RE_DIVR_CD
     , STL.REV_VVD
     , STL.REV_ACT_AMT
     , STL.EXP_VVD
     , STL.EXP_ACT_AMT
     , STL.STL_RMK
     , STL.JO_CRR_CD || STL.RLANE_CD || STL.LOCL_CURR_CD AS DTL_GRP_KEY
  FROM (
        SELECT STL.VSL_CD
             , STL.SKD_VOY_NO
             , STL.SKD_DIR_CD
             , STL.REV_DIR_CD
             , STL.REV_YRMON
             , STL.STL_VVD_SEQ
             , STL.JO_CRR_CD
             , STL.RLANE_CD
             , STL.JO_STL_ITM_CD
             , STL.ORD_SEQ
             , STL.JO_STL_JB_CD
             , STL.LOCL_CURR_CD
             , STL.RE_DIVR_CD
             , DECODE(STL.RE_DIVR_CD,'R',STL.VSL_CD||STL.SKD_VOY_NO||STL.SKD_DIR_CD||STL.REV_DIR_CD,'') AS REV_VVD
             , DECODE(STL.RE_DIVR_CD,'R',STL.ACT_AMT,'') AS REV_ACT_AMT
             , DECODE(STL.RE_DIVR_CD,'E',STL.VSL_CD||STL.SKD_VOY_NO||STL.SKD_DIR_CD||STL.REV_DIR_CD,'') AS EXP_VVD
             , DECODE(STL.RE_DIVR_CD,'E',STL.ACT_AMT,'') AS EXP_ACT_AMT
             , STL.STL_RMK
          FROM (
                SELECT STL.VSL_CD
                     , STL.SKD_VOY_NO
                     , STL.SKD_DIR_CD
                     , STL.REV_DIR_CD
                     , STL.REV_YRMON
                     , STL.STL_VVD_SEQ
                     , STL.JO_CRR_CD
                     , STL.RLANE_CD
                     , STL.JO_STL_ITM_CD
                     , SIT.ORD_SEQ
                     , STL.JO_STL_JB_CD
                     , STL.LOCL_CURR_CD
                     , STL.RE_DIVR_CD
                     , ROUND(STL.ACT_AMT, 2) AS ACT_AMT
                     , STL.STL_RMK
                  FROM JOO_STL_TGT STL
                     , JOO_STL_ITM SIT
                 WHERE 1=1
                   AND STL.JO_STL_ITM_CD    = SIT.JO_STL_ITM_CD
                   AND STL.STL_TGT_FLG      = 'Y'
                   AND NVL(STL.ACT_AMT, 0)  <> 0
                   AND STL.REV_YRMON        BETWEEN REPLACE(@[fr_rev_yrmon],'-') AND REPLACE(@[to_rev_yrmon],'-') /* Condition Target Revenue Month*/
#if (${jo_crr_cd}!='')
                   AND STL.JO_CRR_CD        = @[jo_crr_cd] /*sheet selected carrier */
#end
#if (${rlane_cd}!='')
                   AND STL.RLANE_CD         = @[rlane_cd] /*sheet selected lane */
#end
#if (${locl_curr_cd}!='')
                   AND STL.LOCL_CURR_CD     = @[locl_curr_cd] /*sheet selected Currency */
#end
#if (${re_divr_cd}!='')
                   AND STL.RE_DIVR_CD      = @[re_divr_cd]     /* Condition ALL, Revenue : R , Expense : E */
#end
#if (${trd_cd}!='')
                   /* Condition Trade */
                   AND EXISTS   (   SELECT 'X'
                                      FROM JOO_CARRIER CRR
                                     WHERE 1=1
                                       AND CRR.DELT_FLG         = 'N'
                                       AND CRR.JO_CRR_CD        = STL.JO_CRR_CD
                                       AND CRR.RLANE_CD         = STL.RLANE_CD
                                       AND CRR.TRD_CD           = @[trd_cd]
                                     )
#end
#if (${auth_ofc_cd}!='')
                   /* Condition Auth Office Cd */
                   AND EXISTS   (   SELECT 'X'
                                      FROM JOO_CRR_AUTH CA
                                     WHERE 1=1
                                       AND CA.DELT_FLG         = 'N'
                                       AND CA.JO_CRR_CD        = STL.JO_CRR_CD
                                       AND CA.RLANE_CD         = STL.RLANE_CD
                                       AND CA.AUTH_OFC_CD      = @[auth_ofc_cd]
                                     )
#end

           ) STL
       ) STL
 ORDER BY STL.RE_DIVR_CD DESC
     , STL.JO_CRR_CD
     , STL.RLANE_CD
     , STL.VSL_CD
     , STL.SKD_VOY_NO
     , STL.SKD_DIR_CD
     , STL.REV_DIR_CD
     , STL.REV_YRMON
     , STL.ORD_SEQ
     , STL.JO_STL_JB_CD			]]></sql>
			<params>
				<param name="fr_rev_yrmon" type="12" value="" out="N"/>
				<param name="to_rev_yrmon" type="12" value="" out="N"/>
				<param name="jo_crr_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="locl_curr_cd" type="12" value="" out="N"/>
				<param name="re_divr_cd" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="auth_ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
