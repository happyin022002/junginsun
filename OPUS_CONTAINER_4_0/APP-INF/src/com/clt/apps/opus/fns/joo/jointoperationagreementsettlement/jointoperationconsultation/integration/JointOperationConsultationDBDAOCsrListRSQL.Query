<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="JointOperationConsultationDBDAOCsrListRSQL">
			<desc><![CDATA[JOO_CSR List 조회 (APRO_FLG =' N' 인것만)
NYK Modify : 2014.11.10 ( RVS_CSR_FLG = 'Y' )]]></desc>
			<sql><![CDATA[
SELECT A.SLP_TP_CD||A.SLP_FUNC_CD||A.SLP_OFC_CD||A.SLP_ISS_DT||A.SLP_SER_NO AS CSR_NO
     , TO_CHAR(A.CRE_DT,'YYYYMMDD') AS SLP_ISS_DT
     , TO_CHAR(A.EFF_DT,'YYYYMMDD') AS EFF_DT
     , A.CSR_LOCL_CURR_CD
     , A.CSR_LOCL_AMT
     , B.USR_NM AS ISSUER
     , A.CSR_DESC
     , C.LST_APRO_FLG
  FROM JOO_CSR A
     , COM_USER B
     , (SELECT A.APRO_RQST_NO
             , B.CSR_NO
             , A.APSTS_CD
             , NVL(C.APSTS_CD, 'P') AS P_APSTS_CD
             , CASE WHEN C.APRO_RQST_SEQ = (SELECT /*+INDEX_DESC(X XPKCOM_APRO_RQST_ROUT)*/
                                                   X.APRO_RQST_SEQ
                                              FROM COM_APRO_RQST_ROUT X
                                             WHERE X.APRO_RQST_NO   = C.APRO_RQST_NO
                                               AND X.DELT_FLG       = 'N'
                                               AND ROWNUM = 1       ) THEN 'Y'
                    ELSE 'N'
               END AS LST_APRO_FLG --최종결재자여부
          FROM COM_APRO_RQST_HDR    A
             , COM_APRO_CSR_DTL     B
             , COM_APRO_RQST_ROUT   C
         WHERE NVL(A.DELT_FLG, 'N') = 'N'
           AND NVL(B.DELT_FLG, 'N') = 'N'
           AND NVL(C.DELT_FLG, 'N') = 'N'
           AND A.SUB_SYS_CD         = 'JOO'
           AND NVL(A.APSTS_CD,'P')  = 'P'
           AND NVL(C.APSTS_CD,'P')  = 'P'
           AND A.APRO_RQST_NO       = B.APRO_RQST_NO
           AND A.APRO_RQST_NO       = C.APRO_RQST_NO
           AND A.CRNT_APRO_SEQ      = C.APRO_RQST_SEQ ) C
 WHERE A.CRE_USR_ID     = B.USR_ID(+)
   AND A.SLP_TP_CD||A.SLP_FUNC_CD||A.SLP_OFC_CD||A.SLP_ISS_DT||A.SLP_SER_NO = C.CSR_NO
   AND A.APRO_FLG       = 'N'
   AND A.CXL_FLG        = 'N'
   --AND A.RVS_CSR_FLG = 'Y' /*Reverse Flag Y not display*/
   AND EXISTS ( SELECT 1
                  FROM JOO_SLIP X
                     , JOO_STL_TGT Z
                     , JOO_CRR_AUTH Y
                 WHERE X.VSL_CD         = Z.VSL_CD
                   AND X.SKD_VOY_NO     = Z.SKD_VOY_NO
                   AND X.SKD_DIR_CD     = Z.SKD_DIR_CD
                   AND X.REV_DIR_CD     = Z.REV_DIR_CD
                   AND X.REV_YRMON      = Z.REV_YRMON
                   AND X.STL_VVD_SEQ    = Z.STL_VVD_SEQ
                   AND X.DR_CR_CD       = 'DR'
                   AND Z.JO_CRR_CD      = Y.JO_CRR_CD
                   AND Z.RLANE_CD       = Y.RLANE_CD
                   AND X.SLP_TP_CD      = A.SLP_TP_CD
                   AND X.SLP_FUNC_CD    = A.SLP_FUNC_CD
                   AND X.SLP_OFC_CD     = A.SLP_OFC_CD
                   AND X.SLP_ISS_DT     = A.SLP_ISS_DT
                   AND X.SLP_SER_NO     = A.SLP_SER_NO
                   AND Y.JO_CRR_AUTH_CD IN ('W','R')
                   AND Y.DELT_FLG = 'N' )
#if (${csr_no} == '')
   #if (${if_flg} == '0')
   AND A.CRE_DT <= TO_DATE(REPLACE(@[slp_iss_dt],'-','')||'235959','YYYYMMDDHH24MISS')
   #else
   AND A.EFF_DT <= TO_DATE(REPLACE(@[slp_iss_dt],'-',''),'YYYYMMDD')
   #end
#else
   AND A.SLP_TP_CD || A.SLP_FUNC_CD || A.SLP_OFC_CD || A.SLP_ISS_DT || A.SLP_SER_NO = @[csr_no]
#end
#if (${auth_ofc_cd}!='')
   AND (A.SLP_OFC_CD = @[auth_ofc_cd] OR A.SLP_ISS_OFC_CD = @[auth_ofc_cd])
#end
 ORDER BY 1			]]></sql>
			<params>
				<param name="slp_iss_dt" type="12" value="20100129" out="N"/>
				<param name="csr_no" type="12" value="06SSELFAR10012900001" out="N"/>
				<param name="auth_ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
