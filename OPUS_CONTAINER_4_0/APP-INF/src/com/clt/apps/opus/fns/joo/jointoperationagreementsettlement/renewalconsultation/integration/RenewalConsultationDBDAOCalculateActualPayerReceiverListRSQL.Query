<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RenewalConsultationDBDAOCalculateActualPayerReceiverListRSQL">
			<desc><![CDATA[Select actual payer/receiver for slip Auto Invoice, Invoice detail Search.]]></desc>
			<sql><![CDATA[
SELECT STL.VSL_CD
     , STL.SKD_VOY_NO
     , STL.SKD_DIR_CD
     , STL.REV_DIR_CD
     , STL.REV_YRMON
     , STL.STL_VVD_SEQ
     , STL.JO_CRR_CD
     , STL.RLANE_CD
     , STL.JO_STL_ITM_CD
     , STL.JO_STL_JB_CD
     , STL.LOCL_CURR_CD
     , STL.RE_DIVR_CD
     , STL.ACT_AMT
     , STL.STL_RMK
     , SUM(STL.ACT_AMT) OVER ( PARTITION BY STL.JO_CRR_CD, STL.LOCL_CURR_CD, STL.RE_DIVR_CD) AS ACT_INV_AMT
  FROM JOO_STL_TGT STL
 WHERE 1=1
   AND STL.STL_TGT_FLG      = 'Y'
   AND NVL(STL.ACT_AMT, 0)  <> 0
   /*Condition Start*/
   AND STL.REV_YRMON    BETWEEN REPLACE(@[fr_rev_yrmon],'-','') AND REPLACE(@[to_rev_yrmon],'-','') /* Condition Target Revenue Month*/

#if (${trd_cd}!='')
   /* Condition Trade */
   AND EXISTS   (   SELECT 'X'
                      FROM JOO_CARRIER CRR
                     WHERE 1=1
                       AND CRR.DELT_FLG         = 'N'
                       AND CRR.JO_CRR_CD        = STL.JO_CRR_CD
                       AND CRR.RLANE_CD         = STL.RLANE_CD
                       AND CRR.TRD_CD           = @[trd_cd]
                 ) 
#end
#if (${rlane_cd}!='')
   AND STL.RLANE_CD     = @[rlane_cd]   /* Condition Lane */
#end
#if (${rev_vvd}!='')
   AND STL.VSL_CD||STL.SKD_VOY_NO||STL.SKD_DIR_CD||STL.REV_DIR_CD LIKE @[rev_vvd]||'%'        /* Condition VVD */
#end
#if (${jo_stl_itm_cds} != '' && ${jo_stl_itm_cds} != 'ALL')
   /* Condition Items */
   AND STL.JO_STL_ITM_CD IN ( #foreach($key IN ${jo_stl_itm_cds})#if($velocityCount < $jo_stl_itm_cds.size()) '$key', #else '$key' #end #end)
#end
   /*Codition E n d*/
   /*Sheet Condition Start*/
   AND STL.JO_CRR_CD        = @[jo_crr_cd] /*Sheet Carrier*/
   AND STL.LOCL_CURR_CD     = @[locl_curr_cd] /*Sheet Currency*/
   AND STL.RE_DIVR_CD       = @[re_divr_cd]   /*Sheet Rev, Exp */
   /*Sheet Condition End */
 ORDER BY STL.RE_DIVR_CD
        , STL.VSL_CD  
        , STL.SKD_VOY_NO
        , STL.SKD_DIR_CD
        , STL.REV_DIR_CD
        , STL.REV_YRMON
        , STL.STL_VVD_SEQ 
        , STL.JO_CRR_CD
        , STL.JO_STL_ITM_CD
        , STL.RLANE_CD			]]></sql>
			<params>
				<param name="fr_rev_yrmon" type="12" value="" out="N"/>
				<param name="to_rev_yrmon" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="rev_vvd" type="12" value="" out="N"/>
				<param name="jo_crr_cd" type="12" value="" out="N"/>
				<param name="locl_curr_cd" type="12" value="" out="N"/>
				<param name="re_divr_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
