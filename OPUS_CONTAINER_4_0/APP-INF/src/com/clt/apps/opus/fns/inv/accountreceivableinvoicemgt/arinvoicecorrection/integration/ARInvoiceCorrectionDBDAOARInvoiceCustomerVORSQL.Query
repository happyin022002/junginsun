<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ARInvoiceCorrectionDBDAOARInvoiceCustomerVORSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
SELECT ACT_CUST_CNT_CD,
       ACT_CUST_SEQ,
       CUST_LGL_ENG_NM,
       VSL_CD||SKD_VOY_NO||SKD_DIR_CD VVD,
       SVC_SCP_CD,
       POR_CD,
       POL_CD,
       POD_CD,
       DEL_CD,
       BL_SRC_NO,
       AR_IF_NO,
       MN.BKG_NO,
       SHPR.CUST_CNT_CD SHPR_CUST_CNT_CD,
       LPAD(SHPR.CUST_SEQ,6,0) SHPR_CUST_SEQ,
       SHPR.CUST_NM SHPR_CUST_NM,
       SHPR.CUST_ADDR SHPR_CUST_ADDR,
       FWDR.CUST_CNT_CD FWDR_CUST_CNT_CD,
       LPAD(FWDR.CUST_SEQ,6,0) FWDR_CUST_SEQ,
       FWDR.CUST_NM FWDR_CUST_NM,
       FWDR.CUST_ADDR FWDR_CUST_ADDR,
       MN.BL_INV_IF_DT,
	   DECODE(INSTR(NVL(DECODE(SUBSTR(SHPR.CUST_NM,1,2),'TO','',SHPR.CUST_NM),FWDR.CUST_NM),' '),0,NVL(DECODE(SUBSTR(SHPR.CUST_NM,1,2),'TO','',SHPR.CUST_NM),FWDR.CUST_NM),SUBSTR(NVL(DECODE(SUBSTR(SHPR.CUST_NM,1,2),'TO','',SHPR.CUST_NM),FWDR.CUST_NM),1,INSTR(NVL(DECODE(SUBSTR(SHPR.CUST_NM,1,2),'TO','',SHPR.CUST_NM),FWDR.CUST_NM),' '))) CUST_NM,
	   MN.INV_RMK,
	   MN.BL_INV_CFM_DT,
       MN.SAIL_ARR_DT,
       MN.IO_BND_CD,
	   MN.AR_OFC_CD,
	   MN.GL_EFF_DT,
	   MN.SAIL_DT
  FROM INV_AR_MN    MN,
       MDM_CUSTOMER CUST,
       BKG_CUSTOMER SHPR,
       BKG_CUSTOMER FWDR
 WHERE MN.ACT_CUST_CNT_CD = CUST.CUST_CNT_CD
   AND MN.ACT_CUST_SEQ    = CUST.CUST_SEQ 
   AND MN.BKG_NO          = SHPR.BKG_NO
   AND DECODE(MN.IO_BND_CD,'O','S','C') = SHPR.BKG_CUST_TP_CD
   AND MN.BKG_NO          = FWDR.BKG_NO
   AND DECODE(MN.IO_BND_CD,'O','F','N') = FWDR.BKG_CUST_TP_CD
   AND MN.AR_OFC_CD = @[ofc_cd]
   AND MN.ACT_CUST_CNT_CD = @[act_cust_cnt_cd]
   AND MN.ACT_CUST_SEQ = TO_NUMBER(@[act_cust_seq])
   AND MN.BL_INV_IF_DT = replace(@[bl_inv_if_dt],'-','')
#if (${io_bnd_cd} != '')
   AND MN.IO_BND_CD = @[io_bnd_cd]
#end
#if (${port_cd} != '')
   AND DECODE(MN.IO_BND_CD ,'O',MN.POL_CD,MN.POD_CD) = @[port_cd]
#end
   AND NVL(MN.INV_ISS_FLG,'N') = 'N'
   AND MN.OTS_PAY_CD IS NULL AND MN.ORG_INV_NO IS NULL --Except migration data
   AND MN.AR_IF_NO IN (SELECT MAX(AR_IF_NO) AR_IF_NO
                         FROM INV_AR_MN
                        WHERE AR_OFC_CD = @[ofc_cd]						 
						  AND REV_TP_CD<> 'M'
                          AND NVL(INV_DELT_DIV_CD,'N') <> 'Y'
                          AND NVL(INV_SPLIT_CD,'N') NOT IN ('M','X')
						  --AND NVL(INV_ISS_FLG,'N') = 'N'
						  AND BL_SRC_NO  IN (SELECT BL_SRC_NO
                                                 FROM INV_AR_MN 
                                                WHERE AR_OFC_CD = @[ofc_cd]
                                                  AND ACT_CUST_CNT_CD = @[act_cust_cnt_cd]
                                                  AND ACT_CUST_SEQ = TO_NUMBER(@[act_cust_seq])
                          						  AND BL_INV_IF_DT = replace(@[bl_inv_if_dt],'-','')
#if (${io_bnd_cd} != '')
                                                  AND IO_BND_CD = @[io_bnd_cd]
#end
#if (${port_cd} != '')
												  AND DECODE(IO_BND_CD ,'O',POL_CD,POD_CD) = @[port_cd]
#end
												  AND REV_TP_CD<> 'M'
                          						  AND NVL(INV_DELT_DIV_CD,'N') <> 'Y'
                          						  AND NVL(INV_SPLIT_CD,'N') NOT IN ('M','X')
                                                  AND NVL(INV_ISS_FLG,'N') = 'N')
						 
                        GROUP BY BL_SRC_NO )			]]></sql>
			<params>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="act_cust_cnt_cd" type="12" value="" out="N"/>
				<param name="act_cust_seq" type="12" value="" out="N"/>
				<param name="bl_inv_if_dt" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="port_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
