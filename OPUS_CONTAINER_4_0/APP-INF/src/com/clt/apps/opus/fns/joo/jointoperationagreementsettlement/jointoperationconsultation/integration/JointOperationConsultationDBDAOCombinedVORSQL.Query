<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="JointOperationConsultationDBDAOCombinedVORSQL">
			<desc><![CDATA[FNS_JOO_0016 화면의 조회   ]]></desc>
			<sql><![CDATA[
SELECT 'I' AS IBFLAG
      ,A.ACCT_YRMON
      ,A.JO_CRR_CD
      ,A.RLANE_CD
      ,A.RE_DIVR_CD
      ,A.STL_VVD_SEQ
      ,A.STL_SEQ
      ,A.JO_STL_ITM_CD
      ,A.JO_STL_JB_CD
      ,A.LOCL_CURR_CD
      ,A.CMB_CFM_FLG
      ,A.UPD_USR_ID     
      ,A.R_VVD
      ,DECODE(A.R_BSA_QTY, 0, NULL, A.R_BSA_QTY) AS R_BSA_QTY
      ,DECODE(A.R_BSA_SLT_PRC, 0, NULL, A.R_BSA_SLT_PRC) AS R_BSA_SLT_PRC      
      ,A.R_STL_LOCL_AMT
      ,A.E_VVD
      ,DECODE(A.E_BSA_QTY, 0, NULL, A.E_BSA_QTY) AS E_BSA_QTY
      ,DECODE(A.E_BSA_SLT_PRC, 0, NULL, A.E_BSA_SLT_PRC) AS E_BSA_SLT_PRC
      ,A.E_STL_LOCL_AMT
      ,A.STL_RMK
  FROM (
        SELECT
              'I' AS IBFLAG
              ,A.ACCT_YRMON
              ,A.JO_CRR_CD
              ,A.RLANE_CD
              ,A.RE_DIVR_CD
              ,A.STL_VVD_SEQ
              ,A.STL_SEQ
              ,A.JO_STL_ITM_CD
              ,C.ORD_SEQ 
              ,A.JO_STL_JB_CD
              ,A.LOCL_CURR_CD
              ,A.CMB_CFM_FLG
              ,A.UPD_USR_ID     
              ,DECODE(A.RE_DIVR_CD,'R',A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD||A.REV_DIR_CD,'') AS R_VVD
              ,DECODE(A.RE_DIVR_CD,'R',DECODE(A.STL_ADJ_FLG,'Y',B.BSA_QTY,CASE WHEN A.JO_STL_ITM_CD = 'R/F' AND A.JO_MNU_NM = 'R/F' THEN A.USD_SLT_BSA_QTY ELSE A.BSA_QTY END)) AS R_BSA_QTY
              ,DECODE(A.RE_DIVR_CD,'R',DECODE(A.STL_ADJ_FLG,'Y',B.BSA_SLT_PRC,CASE WHEN A.JO_STL_ITM_CD = 'R/F' AND A.JO_MNU_NM = 'R/F' THEN A.RF_SCG_PRC ELSE A.BSA_SLT_PRC END)) AS R_BSA_SLT_PRC
              ,DECODE(A.RE_DIVR_CD,'R',DECODE(A.STL_ADJ_FLG,'Y',B.STL_LOCL_AMT,A.STL_LOCL_AMT)) AS R_STL_LOCL_AMT
              ,DECODE(A.RE_DIVR_CD,'E',A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD||A.REV_DIR_CD,'') AS E_VVD
              ,DECODE(A.RE_DIVR_CD,'E',DECODE(A.STL_ADJ_FLG,'Y',B.BSA_QTY,CASE WHEN A.JO_STL_ITM_CD = 'R/F' AND A.JO_MNU_NM = 'R/F' THEN A.USD_SLT_BSA_QTY ELSE A.BSA_QTY END)) AS E_BSA_QTY
              ,DECODE(A.RE_DIVR_CD,'E',DECODE(A.STL_ADJ_FLG,'Y',B.BSA_SLT_PRC,CASE WHEN A.JO_STL_ITM_CD = 'R/F' AND A.JO_MNU_NM = 'R/F' THEN A.RF_SCG_PRC ELSE A.BSA_SLT_PRC END)) AS E_BSA_SLT_PRC
              ,DECODE(A.RE_DIVR_CD,'E',DECODE(A.STL_ADJ_FLG,'Y',B.STL_LOCL_AMT,A.STL_LOCL_AMT)) AS E_STL_LOCL_AMT
              ,SUBSTR(DECODE(A.STL_RMK,NULL,NULL,','||A.STL_RMK)||DECODE(A.FM_PORT_CD,NULL,NULL,DECODE(A.JO_MNU_NM,'RDR',DECODE(A.TO_PORT_CD, NULL,',RDR Port:'||A.FM_PORT_CD,','||A.FM_PORT_CD||'-'||A.TO_PORT_CD), ','||A.FM_PORT_CD||DECODE(A.TO_PORT_CD,NULL,NULL,'-'||A.TO_PORT_CD))) || DECODE(A.SAIL_DYS,NULL,NULL,',Sail Days:'||A.SAIL_DYS), 2) AS STL_RMK
        FROM   JOO_SETTLEMENT  A,
               JOO_STL_DTL     B,
               JOO_STL_ITM     C
        WHERE  A.ACCT_YRMON  = B.ACCT_YRMON (+)
        AND    A.STL_VVD_SEQ = B.STL_VVD_SEQ(+)
        AND    A.STL_SEQ     = B.STL_SEQ    (+)
        AND    A.ACCT_YRMON = REPLACE(@[acct_yrmon],'-','')
        AND    A.JO_CRR_CD  = @[jo_crr_cd]
        --2010.01.05 stl_locl_amt가 0이어도 combined처리 되어야 함 ==> adjustment의 combined된 data 삭제불가 때문임...
        --AND    DECODE(A.STL_ADJ_FLG,'Y',NVL(B.STL_LOCL_AMT,0),NVL(A.STL_LOCL_AMT,0)) != 0
#if (${trd_cd} != '')
		AND    A.TRD_CD     = @[trd_cd]
#end
#if (${re_divr_cd} != '')
		AND    A.RE_DIVR_CD = @[re_divr_cd]
#end
		AND    NVL(A.CMB_CFM_FLG,'N') = 'N'
		AND    A.RLANE_CD IN (
       #foreach($key IN ${rlane_cd}) 
         #if($velocityCount < $rlane_cd.size()) 
          '$key', 
         #else 
          '$key' 
         #end 
       #end 
		)
#if (${locl_curr_cd} != '')
		AND    A.LOCL_CURR_CD = @[locl_curr_cd]
#end
        AND    A.JO_STL_ITM_CD = C.JO_STL_ITM_CD
    ) A
ORDER BY A.RLANE_CD, A.ORD_SEQ, A.JO_STL_JB_CD, A.STL_VVD_SEQ, A.STL_SEQ			]]></sql>
			<params>
				<param name="acct_yrmon" type="12" value="2009-07" out="N"/>
				<param name="jo_crr_cd" type="12" value="COS" out="N"/>
				<param name="trd_cd" type="12" value="AES" out="N"/>
				<param name="re_divr_cd" type="12" value="R" out="N"/>
				<param name="locl_curr_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
