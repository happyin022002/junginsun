<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CarrierSettlementProcessDBDAOSearchTgtVoyVsUnstlStatusListRSQL">
			<desc><![CDATA[Target Voyage vs Unsettled Status]]></desc>
			<sql><![CDATA[
SELECT
        A.TRD_CD
       ,A.RLANE_CD
       ,A.JO_CRR_CD
       ,A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD AS VVD
       ,A.VSL_CD
       ,A.SKD_VOY_NO
       ,A.SKD_DIR_CD
       ,B.REV_YRMON
       ,A.ACCT_YRMON
       ,A.JO_STL_ITM_CD
       ,NVL(SUM(E.R_COA_BSA_AMT),0) AS R_COA_BSA_AMT
       ,NVL(SUM(C.R_JOO_CMB_AMT),0) AS R_JOO_CMB_AMT
       ,NVL(SUM(D.R_JOO_SLP_AMT),0) AS R_JOO_SLP_AMT
       ,NVL(SUM(E.E_COA_BSA_AMT),0) AS E_COA_BSA_AMT
       ,NVL(SUM(C.E_JOO_CMB_AMT),0) AS E_JOO_CMB_AMT
       ,NVL(SUM(D.E_JOO_SLP_AMT),0) AS E_JOO_SLP_AMT
FROM    JOO_STL_VVD     A
       ,AR_MST_REV_VVD  B
       ,(
        SELECT
               C.ACCT_YRMON
              ,C.STL_VVD_SEQ
              ,SUM(DECODE(C.RE_DIVR_CD,'R',C.STL_LOCL_AMT,0)) AS R_JOO_CMB_AMT
              ,SUM(DECODE(C.RE_DIVR_CD,'E',C.STL_LOCL_AMT,0)) AS E_JOO_CMB_AMT
        FROM  JOO_SETTLEMENT  C
             ,JOO_STL_CMB_DTL D
             ,JOO_STL_CMB     E
        WHERE  C.ACCT_YRMON  = D.ACCT_YRMON
		AND    C.STL_VVD_SEQ = D.STL_VVD_SEQ
		AND    C.STL_SEQ     = D.STL_SEQ
		AND    D.ACCT_YRMON  = E.ACCT_YRMON
		AND    D.JO_CRR_CD   = E.JO_CRR_CD
		AND    D.STL_CMB_SEQ = E.STL_CMB_SEQ
		AND    D.RE_DIVR_CD  = E.RE_DIVR_CD
        AND    C.CMB_CFM_FLG = 'Y'
        AND    E.RVS_CMB_FLG = 'N'
        AND    C.ACCT_YRMON  BETWEEN REPLACE(@[acct_yrmon_fr],'-','') AND REPLACE(@[acct_yrmon_to],'-','')
#if (${trd_cd} != '')
        AND    C.TRD_CD      = @[trd_cd]
#end        
#if (${rlane_cd} != '')
        AND    C.RLANE_CD    = @[rlane_cd]
#end        
#if (${jo_crr_cd} != '')
        AND    C.JO_CRR_CD   = @[jo_crr_cd]
#end        
#if (${jo_stl_itm_cd} != '')
        AND    C.JO_STL_ITM_CD = @[jo_stl_itm_cd]
#end        
        GROUP  BY
               C.ACCT_YRMON
              ,C.STL_VVD_SEQ
       ) C
       ,(
        SELECT
               A.ACCT_YRMON
              ,A.STL_VVD_SEQ
              ,SUM(DECODE(A.RE_DIVR_CD,'R',C.CSR_LOCL_AMT,0)) AS R_JOO_SLP_AMT
              ,SUM(DECODE(A.RE_DIVR_CD,'E',C.CSR_LOCL_AMT,0)) AS E_JOO_SLP_AMT
        FROM   JOO_STL_CMB_DTL A
              ,JOO_STL_CMB     B
              ,JOO_SLIP        C
              ,JOO_SETTLEMENT  D
        WHERE  A.ACCT_YRMON  = B.ACCT_YRMON
		AND    A.JO_CRR_CD   = B.JO_CRR_CD
		AND    A.STL_CMB_SEQ = B.STL_CMB_SEQ
		AND    A.RE_DIVR_CD  = B.RE_DIVR_CD
        AND    A.ACCT_YRMON  = D.ACCT_YRMON
        AND    A.STL_VVD_SEQ = D.STL_VVD_SEQ
        AND    A.STL_SEQ     = D.STL_SEQ
		AND    B.SLP_TP_CD   = C.SLP_TP_CD
		AND    B.SLP_FUNC_CD = C.SLP_FUNC_CD
		AND    B.SLP_OFC_CD  = C.SLP_OFC_CD
		AND    B.SLP_ISS_DT  = C.SLP_ISS_DT
		AND    B.SLP_SER_NO  = C.SLP_SER_NO
        AND    B.RVS_CMB_FLG = 'N'
        AND    A.ACCT_YRMON  BETWEEN REPLACE(@[acct_yrmon_fr],'-','') AND REPLACE(@[acct_yrmon_to],'-','')
#if (${trd_cd} != '')
        AND    D.TRD_CD      = @[trd_cd]
#end        
#if (${rlane_cd} != '')
        AND    D.RLANE_CD    = @[rlane_cd]
#end        
#if (${jo_crr_cd} != '')
        AND    D.JO_CRR_CD   = @[jo_crr_cd]
#end        
#if (${jo_stl_itm_cd} != '')
        AND    D.JO_STL_ITM_CD = @[jo_stl_itm_cd]
#end        
        GROUP  BY
               A.ACCT_YRMON
              ,A.STL_VVD_SEQ
       ) D
      ,(
		SELECT
		        A.COST_YRMON AS ACCT_YRMON
		       ,C.CRR_CD  AS JO_CRR_CD
		       ,A.TRD_CD
		       ,A.RLANE_CD
		       ,A.VSL_CD
		       ,A.SKD_VOY_NO
		       ,A.DIR_CD AS SKD_DIR_CD
               ,'S/H' AS JO_STL_ITM_CD
		       ,SUM(CASE WHEN C.BSA_OP_JB_CD IN ('001','002','004') THEN C.CRR_PERF_AMT ELSE 0 END) AS R_COA_BSA_AMT
		       ,SUM(CASE WHEN C.BSA_OP_JB_CD IN ('000','003','005') THEN C.CRR_PERF_AMT ELSE 0 END) AS E_COA_BSA_AMT
		  FROM COA_MON_VVD      A,
		       BSA_VVD_MST      B,
		       BSA_VVD_CRR_PERF C
		 WHERE A.VSL_CD      = B.VSL_CD
		   AND A.SKD_VOY_NO  = B.SKD_VOY_NO
		   AND A.DIR_CD      = B.SKD_DIR_CD
		   AND A.TRD_CD      = B.TRD_CD
		   AND A.RLANE_CD    = B.RLANE_CD
		   AND A.VSL_CD      = C.VSL_CD
		   AND A.SKD_VOY_NO  = C.SKD_VOY_NO
		   AND A.DIR_CD      = C.SKD_DIR_CD
		   AND A.TRD_CD      = C.TRD_CD
		   AND A.RLANE_CD    = C.RLANE_CD
		   AND A.COST_YRMON BETWEEN REPLACE(@[acct_yrmon_fr],'-','') AND REPLACE(@[acct_yrmon_to],'-','')
		   AND C.BSA_OP_JB_CD IN ('000','001','002','003','004','005')
#if (${trd_cd} != '')
           AND A.TRD_CD      = @[trd_cd]
#end        
#if (${rlane_cd} != '')
        AND    A.RLANE_CD    = @[rlane_cd]
#end        
#if (${jo_crr_cd} != '')
        AND    C.CRR_CD      = @[jo_crr_cd]
#end        
#if (${jo_stl_itm_cd} != '')
        AND    'S/H'         = @[jo_stl_itm_cd]
#end        
		   AND C.CRR_CD      <> COM_CONSTANTMGR_PKG.COM_getCompanyCode_FNC
		   AND A.DELT_FLG    = 'N'
		 GROUP BY
		        A.COST_YRMON
		       ,C.CRR_CD
		       ,A.TRD_CD
		       ,A.RLANE_CD
		       ,A.VSL_CD
		       ,A.SKD_VOY_NO
		       ,A.DIR_CD
		HAVING SUM(C.CRR_BSA_CAPA) <> 0
		AND    SUM(C.CRR_PERF_AMT) <> 0
      ) E
WHERE  A.VSL_CD        = B.VSL_CD
AND    A.SKD_VOY_NO    = B.SKD_VOY_NO
AND    A.SKD_DIR_CD    = B.SKD_DIR_CD
AND    A.RLANE_CD      = B.RLANE_CD
AND    A.ACCT_YRMON    = C.ACCT_YRMON   (+)
AND    A.STL_VVD_SEQ   = C.STL_VVD_SEQ  (+)
AND    A.ACCT_YRMON    = D.ACCT_YRMON   (+)
AND    A.STL_VVD_SEQ   = D.STL_VVD_SEQ  (+)
AND    A.ACCT_YRMON    = E.ACCT_YRMON   (+)
AND    A.JO_CRR_CD     = E.JO_CRR_CD    (+)
AND    A.TRD_CD        = E.TRD_CD       (+)
AND    A.RLANE_CD      = E.RLANE_CD     (+)
AND    A.VSL_CD        = E.VSL_CD       (+)
AND    A.SKD_VOY_NO    = E.SKD_VOY_NO   (+)
AND    A.SKD_DIR_CD    = E.SKD_DIR_CD   (+)
AND    A.RLANE_CD      = E.RLANE_CD     (+)
AND    A.JO_STL_ITM_CD = E.JO_STL_ITM_CD(+)
AND    A.ACCT_YRMON BETWEEN REPLACE(@[acct_yrmon_fr],'-','') AND REPLACE(@[acct_yrmon_to],'-','')
#if (${trd_cd} != '')
AND    A.TRD_CD        = @[trd_cd]
#end        
#if (${rlane_cd} != '')
AND    A.RLANE_CD      = @[rlane_cd]
#end        
#if (${jo_crr_cd} != '')
AND    A.JO_CRR_CD     = @[jo_crr_cd]
#end        
#if (${jo_stl_itm_cd} != '')
AND    A.JO_STL_ITM_CD = @[jo_stl_itm_cd]
#end        
AND    A.JO_STL_CFM_CD = 'Y'
GROUP  BY
        A.TRD_CD
       ,A.RLANE_CD
       ,A.JO_CRR_CD
       ,A.VSL_CD
       ,A.SKD_VOY_NO
       ,A.SKD_DIR_CD
       ,B.REV_YRMON
       ,A.ACCT_YRMON
       ,A.JO_STL_ITM_CD			]]></sql>
			<params>
				<param name="acct_yrmon_fr" type="12" value="" out="N"/>
				<param name="acct_yrmon_to" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="jo_crr_cd" type="12" value="" out="N"/>
				<param name="jo_stl_itm_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
