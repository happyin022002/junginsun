<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ARInvoiceExRateMgtDBDAOSearch3rdExRateNotExistRSQL">
			<desc><![CDATA[Search3rdExRateNotExist]]></desc>
			<sql><![CDATA[
SELECT SUBSTR(MAX(RPAD(LEVEL, 16) || SYS_CONNECT_BY_PATH(AA.VVD_CD||' '||AA.BND, ' , ')), 20) VVD_LIST
FROM (
    SELECT A.FM_DT
          ,B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD VVD_CD
          ,DECODE(B.IO_BND_CD,'O','O/B','I/B') BND
          ,ROW_NUMBER() OVER(PARTITION BY A.FM_DT ORDER BY B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD) AS RN
      FROM INV_CUST_AND_DLY_XCH_RT A, INV_VVD_XCH_RT_DT B
     WHERE A.FM_DT = B.XCH_RT_DT
      AND A.AR_OFC_CD = B.AR_OFC_CD
      AND A.AR_OFC_CD IN ( @[multi_office_list] )
      AND A.FM_DT = @[fm_dt]
      AND NOT EXISTS (SELECT 'X' FROM INV_VVD_XCH_RT C
                      WHERE B.XCH_RT_DT = C.XCH_RT_DT
                       AND B.VSL_CD = C.VSL_CD
                       AND B.SKD_VOY_NO = C.SKD_VOY_NO
                       AND B.SKD_DIR_CD = C.SKD_DIR_CD
                       AND B.PORT_CD = C.PORT_CD
                       AND B.SVC_SCP_CD = C.SVC_SCP_CD
                       AND B.IO_BND_CD = C.IO_BND_CD
                       AND B.AR_OFC_CD = C.AR_OFC_CD)
      GROUP BY A.FM_DT, B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD, B.IO_BND_CD) AA
CONNECT BY PRIOR RN = RN - 1 AND PRIOR AA.FM_DT = AA.FM_DT
GROUP BY AA.FM_DT
ORDER BY AA.FM_DT			]]></sql>
			<params>
				<param name="multi_office_list" type="12" value="" out="N"/>
				<param name="fm_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
