<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivableEDISendDBDAOSearchChargeInfoByContainerRSQL">
			<desc><![CDATA[Search Charge Info By Container]]></desc>
			<sql><![CDATA[
#if (${rev_tp_cd} != 'M')
    #if (${inv_delt_div_cd} == 'N')
        SELECT ROW_NUMBER() OVER(ORDER BY CHG_CD, CURR_CD, PER_TP_CD, CNTR_NO) CHG_SEQ
             , CNTR_NO
             , CNTR_TPSZ_CD
             , CHG_CD
             , CURR_CD
             , PER_TP_CD
             , TRF_RT_AMT
             , RAT_AS_CNTR_QTY
             , CHG_AMT
             , '' CHG_REF_NO
			 , @[edi_hdr_seq] EDI_HDR_SEQ
			 , @[cre_usr_id] CRE_USR_ID
			 , @[upd_usr_id] UPD_USR_ID
			 , NVL((SELECT 'Y'
                	FROM   SCO_LU_HDR H,  SCO_LU_DTL D
                	WHERE  H.LU_TP_CD = D.LU_TP_CD
                	AND    H.LU_APPL_CD = 'SAR'
                	AND    D.LU_TP_CD = 'APC VAT CHARGE'
					AND    D.LU_CD = CHG_CD
                	AND    D.ENBL_FLG = 'Y'), 'N') TVA_FLG
        FROM (
                SELECT A.CNTR_NO
                     , A.CNTR_TPSZ_CD
                     , A.CHG_CD
                     , A.CURR_CD
                     , A.RAT_UT_CD PER_TP_CD
                     , A.CHG_UT_AMT TRF_RT_AMT
                     , A.RAT_AS_QTY RAT_AS_CNTR_QTY
                     , A.CHG_AMT
                FROM BKG_CNTR_RT A,
                     BKG_RATE B,
                     MDM_ORGANIZATION C,
                     (SELECT DISTINCT CHG_CD, CURR_CD, PER_TP_CD
                      FROM INV_AR_CHG
                      WHERE AR_IF_NO = @[ar_if_no]) D
                WHERE A.BKG_NO = B.BKG_NO
                AND A.BKG_NO = @[bkg_no]
                AND A.FRT_TERM_CD = DECODE(@[io_bnd_cd],'O','P','C')
                AND NVL(A.N3PTY_RCV_OFC_CD, DECODE(@[io_bnd_cd],'O',B.PPD_RCV_OFC_CD,B.CLT_OFC_CD)) = C.OFC_CD
                AND C.AR_OFC_CD = 'BUEBA'
                AND A.RAT_UT_CD NOT IN ('BL','PC')
				AND D.CHG_CD = A.CHG_CD
                AND D.CURR_CD = A.CURR_CD
                AND D.PER_TP_CD = A.RAT_UT_CD
                UNION ALL
                SELECT '' CNTR_NO
                     , '' CNTR_TPSZ_CD
                     , CHG_CD
                     , CURR_CD
                     , PER_TP_CD
                     , TRF_RT_AMT
                     , RAT_AS_CNTR_QTY
                     , CHG_AMT
                FROM INV_AR_CHG
                WHERE AR_IF_NO = @[ar_if_no]
                AND PER_TP_CD IN ('BL','PC')
        )
        WHERE CHG_AMT <> 0
        ORDER BY CHG_CD, CURR_CD, PER_TP_CD, CNTR_NO
    #else
        SELECT A.CHG_SEQ
             , A.CNTR_NO
             , A.CNTR_TPSZ_CD
             , A.CHG_CD
             , A.CURR_CD
             , A.PER_TP_CD
             , A.TRF_RT_AMT
             , A.RAT_AS_CNTR_QTY
             , A.CHG_AMT * (-1) CHG_AMT
             , A.CHG_REF_NO
			 , @[edi_hdr_seq] EDI_HDR_SEQ
			 , @[cre_usr_id] CRE_USR_ID
			 , @[upd_usr_id] UPD_USR_ID
			 , NVL((SELECT 'Y'
                	FROM   SCO_LU_HDR H,  SCO_LU_DTL D
                	WHERE  H.LU_TP_CD = D.LU_TP_CD
                	AND    H.LU_APPL_CD = 'SAR'
                	AND    D.LU_TP_CD = 'APC VAT CHARGE'
					AND    D.LU_CD = A.CHG_CD
                	AND    D.ENBL_FLG = 'Y'), 'N') TVA_FLG
        FROM INV_EDI_CHG A,
             INV_EDI_HDR B
        WHERE A.EDI_HDR_SEQ = B.EDI_HDR_SEQ 
        AND B.AR_IF_NO IN (SELECT MAX(AR_IF_NO)
                           FROM INV_AR_MN
                           WHERE BL_SRC_NO = @[bl_no]
                           AND AR_OFC_CD = 'BUEBA'
                           AND REV_TP_CD <> 'M'
                           AND NVL(INV_SPLIT_CD, 'M') IN ('M','C','E','X')  
                           AND BL_INV_CFM_DT IS NOT NULL
                           AND INV_DELT_DIV_CD = 'N' 
                           AND AR_IF_NO < @[ar_if_no])
        ORDER BY A.CHG_SEQ
    #end
#else
    #if (${rev_tp_src_cd} == 'MDM' || ${rev_tp_src_cd} == 'MDT')
        SELECT B.CHG_SEQ
             , B.TRF_NO CNTR_NO
             , (SELECT CNTR_TPSZ_CD 
                FROM INV_AR_IF_CNTR
                WHERE SRC_IF_DT = A.SRC_IF_DT
                AND SRC_IF_SEQ = A.SRC_IF_SEQ
                AND CNTR_NO = B.TRF_NO
                AND ROWNUM = 1) CNTR_TPSZ_CD
             , B.CHG_CD
             , B.CURR_CD
             , B.PER_TP_CD
             , B.TRF_RT_AMT
             , B.RAT_AS_CNTR_QTY
             , B.CHG_AMT
             , (SELECT Q.CHG_REF_NO
                FROM INV_EDI_HDR P,
                     INV_EDI_CHG Q
                WHERE P.EDI_HDR_SEQ = Q.EDI_HDR_SEQ
                AND P.EDI_TP_CD = 'APC'
                AND P.INV_NO IN (SELECT CR_INV_NO
                                 FROM DMT_INV_MN
                                 WHERE AR_IF_NO = @[ar_if_no]
                                 AND DMDT_INV_NO = @[inv_no]
                                 AND DMDT_AR_IF_CD = 'Y'
                                 AND DMDT_INV_STS_CD = 'C')
                AND Q.CHG_SEQ = B.CHG_SEQ) CHG_REF_NO
             , @[edi_hdr_seq] EDI_HDR_SEQ
             , @[cre_usr_id] CRE_USR_ID
             , @[upd_usr_id] UPD_USR_ID
             , NVL((SELECT 'Y'
                    FROM   SCO_LU_HDR H,  SCO_LU_DTL D
                    WHERE  H.LU_TP_CD = D.LU_TP_CD
                    AND    H.LU_APPL_CD = 'SAR'
                    AND    D.LU_TP_CD = 'APC VAT CHARGE'
                    AND    D.LU_CD = CHG_CD
                    AND    D.ENBL_FLG = 'Y'), 'N') TVA_FLG
        FROM INV_AR_IF_MN A,
             INV_AR_IF_CHG B
        WHERE A.SRC_IF_DT = B.SRC_IF_DT
        AND A.SRC_IF_SEQ = B.SRC_IF_SEQ
        AND A.AR_IF_NO = @[ar_if_no]
        ORDER BY B.CHG_SEQ
    #else
        SELECT CHG_SEQ
             , '' CNTR_NO
             , '' CNTR_TPSZ_CD
             , CHG_CD
             , CURR_CD
             , PER_TP_CD
             , TRF_RT_AMT
             , RAT_AS_CNTR_QTY
             , CHG_AMT
             , '' CHG_REF_NO
             , @[edi_hdr_seq] EDI_HDR_SEQ
             , @[cre_usr_id] CRE_USR_ID
             , @[upd_usr_id] UPD_USR_ID
             , NVL((SELECT 'Y'
                    FROM   SCO_LU_HDR H,  SCO_LU_DTL D
                    WHERE  H.LU_TP_CD = D.LU_TP_CD
                    AND    H.LU_APPL_CD = 'SAR'
                    AND    D.LU_TP_CD = 'APC VAT CHARGE'
                    AND    D.LU_CD = CHG_CD
                    AND    D.ENBL_FLG = 'Y'), 'N') TVA_FLG
        FROM INV_AR_CHG
        WHERE AR_IF_NO = @[ar_if_no]
        ORDER BY CHG_SEQ
    #end      
#end			]]></sql>
			<params>
				<param name="edi_hdr_seq" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="ar_if_no" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="inv_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
