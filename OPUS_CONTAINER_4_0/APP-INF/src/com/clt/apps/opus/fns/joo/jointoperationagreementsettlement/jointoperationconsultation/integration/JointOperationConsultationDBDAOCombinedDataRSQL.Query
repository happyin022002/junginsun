<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="JointOperationConsultationDBDAOCombinedDataRSQL">
			<desc><![CDATA[Combined된 data조회]]></desc>
			<sql><![CDATA[
SELECT 
      'R' AS IBFLAG
      ,A.ACCT_YRMON
      ,A.JO_CRR_CD
      ,A.RLANE_CD
      ,A.RE_DIVR_CD
      ,A.STL_VVD_SEQ
      ,A.STL_SEQ
      ,A.JO_STL_ITM_CD
      ,A.JO_STL_JB_CD
      ,A.LOCL_CURR_CD
      ,A.CMB_CFM_FLG
      ,A.UPD_USR_ID     
      ,A.R_VVD
      ,DECODE(A.R_BSA_QTY, 0, NULL, A.R_BSA_QTY) AS R_BSA_QTY
      ,DECODE(A.R_BSA_SLT_PRC, 0, NULL, A.R_BSA_SLT_PRC) AS R_BSA_SLT_PRC
      ,A.R_STL_LOCL_AMT
      ,A.E_VVD
      ,DECODE(A.E_BSA_QTY, 0, NULL, A.E_BSA_QTY) AS E_BSA_QTY
      ,DECODE(A.E_BSA_SLT_PRC, 0, NULL, A.E_BSA_SLT_PRC) AS E_BSA_SLT_PRC
      ,A.E_STL_LOCL_AMT
      ,A.STL_RMK
  FROM (
        SELECT
               A.ACCT_YRMON
              ,A.JO_CRR_CD
              ,A.RLANE_CD
              ,A.RE_DIVR_CD
              ,A.STL_VVD_SEQ
              ,A.STL_SEQ
              ,A.JO_STL_ITM_CD
              ,A.JO_STL_JB_CD
              ,A.LOCL_CURR_CD
              ,A.CMB_CFM_FLG
              ,A.UPD_USR_ID     
              ,DECODE(A.RE_DIVR_CD,'R',A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD||A.REV_DIR_CD,'') AS R_VVD
              ,DECODE(A.RE_DIVR_CD,'R',DECODE(A.STL_ADJ_FLG,'Y',B.BSA_QTY,CASE WHEN A.JO_STL_ITM_CD = 'R/F' AND A.JO_MNU_NM = 'R/F' THEN A.USD_SLT_BSA_QTY ELSE A.BSA_QTY END)) AS R_BSA_QTY
              ,DECODE(A.RE_DIVR_CD,'R',DECODE(A.STL_ADJ_FLG,'Y',B.BSA_SLT_PRC,CASE WHEN A.JO_STL_ITM_CD = 'R/F' AND A.JO_MNU_NM = 'R/F' THEN A.RF_SCG_PRC ELSE A.BSA_SLT_PRC END)) AS R_BSA_SLT_PRC
              ,DECODE(A.RE_DIVR_CD,'R',DECODE(A.STL_ADJ_FLG,'Y',B.STL_LOCL_AMT,A.STL_LOCL_AMT)) AS R_STL_LOCL_AMT
              ,DECODE(A.RE_DIVR_CD,'E',A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD||A.REV_DIR_CD,'') AS E_VVD
              ,DECODE(A.RE_DIVR_CD,'E',DECODE(A.STL_ADJ_FLG,'Y',B.BSA_QTY,CASE WHEN A.JO_STL_ITM_CD = 'R/F' AND A.JO_MNU_NM = 'R/F' THEN A.USD_SLT_BSA_QTY ELSE A.BSA_QTY END)) AS E_BSA_QTY
              ,DECODE(A.RE_DIVR_CD,'E',DECODE(A.STL_ADJ_FLG,'Y',B.BSA_SLT_PRC,CASE WHEN A.JO_STL_ITM_CD = 'R/F' AND A.JO_MNU_NM = 'R/F' THEN A.RF_SCG_PRC ELSE A.BSA_SLT_PRC END)) AS E_BSA_SLT_PRC
              ,DECODE(A.RE_DIVR_CD,'E',DECODE(A.STL_ADJ_FLG,'Y',B.STL_LOCL_AMT,A.STL_LOCL_AMT)) AS E_STL_LOCL_AMT
              ,SUBSTR(DECODE(A.STL_RMK,NULL,NULL,','||A.STL_RMK)||DECODE(A.FM_PORT_CD,NULL,NULL,DECODE(A.JO_MNU_NM,'RDR',DECODE(A.TO_PORT_CD, NULL,',RDR Port:'||A.FM_PORT_CD,','||A.FM_PORT_CD||'-'||A.TO_PORT_CD), ','||A.FM_PORT_CD||DECODE(A.TO_PORT_CD,NULL,NULL,'-'||A.TO_PORT_CD))) || DECODE(A.SAIL_DYS,NULL,NULL,',Sail Days:'||A.SAIL_DYS), 2) AS STL_RMK
			  ,A.REV_DIR_CD
              ,C.ORD_SEQ
        FROM   JOO_SETTLEMENT  A,
               JOO_STL_DTL     B,
               JOO_STL_ITM     C 
        WHERE  A.ACCT_YRMON  = B.ACCT_YRMON (+)
        AND    A.STL_VVD_SEQ = B.STL_VVD_SEQ(+)
        AND    A.STL_SEQ     = B.STL_SEQ    (+)
        AND    A.ACCT_YRMON = REPLACE(@[acct_yrmon],'-','')
        AND    A.JO_CRR_CD  = @[jo_crr_cd]
        AND   (A.ACCT_YRMON, A.STL_VVD_SEQ, A.STL_SEQ) IN (
               SELECT C.ACCT_YRMON, C.STL_VVD_SEQ, C.STL_SEQ
               FROM   JOO_STL_CMB_DTL C
               WHERE  C.ACCT_YRMON  = REPLACE(@[acct_yrmon],'-','')
               AND    C.JO_CRR_CD   = @[jo_crr_cd]
               AND    C.STL_CMB_SEQ = TO_NUMBER(@[stl_cmb_seq])
              )
        AND    A.CMB_CFM_FLG = 'Y'
        AND    A.JO_STL_ITM_CD = C.JO_STL_ITM_CD
      ) A
ORDER BY A.RLANE_CD, A.ORD_SEQ, A.REV_DIR_CD DESC, A.STL_VVD_SEQ, A.STL_SEQ			]]></sql>
			<params>
				<param name="acct_yrmon" type="12" value="" out="N"/>
				<param name="jo_crr_cd" type="12" value="" out="N"/>
				<param name="stl_cmb_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
