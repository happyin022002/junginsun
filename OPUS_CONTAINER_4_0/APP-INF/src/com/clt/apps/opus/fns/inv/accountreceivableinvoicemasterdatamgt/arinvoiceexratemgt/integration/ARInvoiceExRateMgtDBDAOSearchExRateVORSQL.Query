<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ARInvoiceExRateMgtDBDAOSearchExRateVORSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
SELECT DISTINCT
     A.CUST_CNT_CD CUST_CNT_CD
    ,A.CUST_SEQ CUST_SEQ
    ,DECODE(A.IO_BND_CD,'I','I/B','O','O/B') IO_BND_CD
    ,A.FM_DT FM_DT
    ,A.TO_DT TO_DT
    ,B.CURR_NM CURR_NM
    ,A.CHG_CURR_CD CHG_CURR_CD
    ,A.LOCL_CURR_CD LOCL_CURR_CD
    ,A.XCH_RT_TP_CD XCH_RT_TP_CD
    ,A.AR_OFC_CD AR_OFC_CD
    ,DECODE(D.XCH_RT_RVS_FLG,'Y',A.IVS_XCH_RT,A.INV_XCH_RT) INV_XCH_RT
    ,DECODE(D.XCH_RT_RVS_FLG,'Y',A.INV_XCH_RT,A.IVS_XCH_RT) IVS_XCH_RT
    ,A.CRE_USR_ID CRE_USR_ID
    ,A.CRE_DT    CRE_DT
    ,A.UPD_USR_ID UPD_USR_ID
    ,A.UPD_DT UPD_DT
    ,MAX(HIS.CNG_RMK) KEEP(DENSE_RANK FIRST ORDER BY HIS.HIS_SEQ DESC) AS CNG_RMK
    ,COUNT(DISTINCT CRT.VSL_CD) VVD_CNT 
FROM INV_CUST_AND_DLY_XCH_RT A
   , MDM_CURRENCY B
   , MDM_ORGANIZATION C 
   , INV_AR_STUP_OFC D
   , INV_DLY_XCH_RT_HIS HIS
   , INV_VVD_XCH_RT CRT
WHERE A.CHG_CURR_CD = B.CURR_CD
AND   A.AR_OFC_CD = C.OFC_CD
AND   A.AR_OFC_CD = D.AR_OFC_CD
#if (${io_bnd_cd} != '')
and	  A.IO_BND_CD = @[io_bnd_cd]
#end
AND   A.FM_DT <= REPLACE(@[to_dt],'-','')
AND   A.FM_DT >= REPLACE(@[fm_dt],'-','')
AND	  A.LOCL_CURR_CD = @[locl_curr_cd]
AND   A.CUST_CNT_CD ='XX'
AND   A.CUST_SEQ = 0
AND   A.AR_OFC_CD = D.AR_OFC_CD

AND   A.AR_OFC_CD       = HIS.AR_OFC_CD(+)
AND   A.FM_DT           = HIS.FM_DT(+)
AND   A.TO_DT           = HIS.TO_DT(+)
AND   A.IO_BND_CD       = HIS.IO_BND_CD(+)
AND   A.LOCL_CURR_CD    = HIS.LOCL_CURR_CD(+)
AND   A.CHG_CURR_CD     = HIS.CHG_CURR_CD(+)
      
AND   A.FM_DT 			= CRT.XCH_RT_DT(+)
AND   A.IO_BND_CD 		= CRT.IO_BND_CD(+)     
AND   A.LOCL_CURR_CD 	= CRT.LOCL_CURR_CD(+)  
AND   A.CHG_CURR_CD 	= CRT.CHG_CURR_CD (+)  
AND   A.AR_OFC_CD 		= CRT.AR_OFC_CD(+)     
#if (${multi_office_list} != '')
AND   A.AR_OFC_CD IN ( ${multi_office_list} )
#else
AND   NVL(A.XCH_RT_TP_CD,'V') = NVL(@[xch_rt_tp_cd],'V')
#end
GROUP BY  A.CUST_CNT_CD,A.CUST_SEQ,C.LOC_CD,A.IO_BND_CD,D.XCH_RT_RVS_FLG,B.CURR_NM,A.FM_DT,A.TO_DT,A.CHG_CURR_CD,A.LOCL_CURR_CD,A.XCH_RT_TP_CD,A.AR_OFC_CD,A.INV_XCH_RT,A.IVS_XCH_RT,A.CRE_USR_ID,A.CRE_DT,A.UPD_USR_ID,A.UPD_DT

ORDER BY A.AR_OFC_CD, A.FM_DT,A.TO_DT,IO_BND_CD,A.CHG_CURR_CD			]]></sql>
			<params>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="20091101" out="N"/>
				<param name="fm_dt" type="12" value="20080101" out="N"/>
				<param name="locl_curr_cd" type="12" value="" out="N"/>
				<param name="xch_rt_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
