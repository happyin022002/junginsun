<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingARCreationDBDAOsearchEffectiveDateRSQL">
			<desc><![CDATA[BookingARCreationDBDAOsearchEffectiveDateRSQL]]></desc>
			<sql><![CDATA[
select  DECODE( substr(replace(@[sail_dt],'-',''),1,6)||'01', new_eff_dt, replace(@[sail_dt],'-',''), new_eff_dt) EFF_DT
from (        
select nvl(MAX(decode(gubn,'OFC', new_eff_dt,'')), 
           nvl(MAX(decode(gubn,'RHQ', new_eff_dt,'')),'')) new_eff_dt     
from 
     (  SELECT 'OFC' gubn, MIN(EFF_YRMON)||'01' as new_eff_dt
        FROM   AP_PERIOD
        WHERE  SYS_DIV_CD = DECODE(@[rev_tp_cd],'B','10', 'C','10','M',decode(@[rev_src_cd], 'TH','11','33'),'X')
        AND    CLZ_STS_CD ='O'
        AND    OFC_CD = @[ofc_cd]
        AND    AR_AP_DIV_CD ='R'
        AND    EFF_YRMON >= substr( replace(@[sail_dt],'-',''),1,6)
        HAVING MIN(EFF_YRMON) IS NOT NULL 
         Union all
       SELECT 'RHQ' gubn, MIN(EFF_YRMON)||'01' as new_eff_dt
        FROM   AP_PERIOD
        WHERE  SYS_DIV_CD =DECODE(@[rev_tp_cd],'B','10', 'C','10','M',decode(@[rev_src_cd], 'TH','11','33'),'X')
        AND    CLZ_STS_CD ='O'
        AND    OFC_CD = (select AR_HD_QTR_OFC_CD
                from   MDM_ORGANIZATION
                where  ofc_cd = @[ofc_cd])
        AND    AR_AP_DIV_CD ='R'
        AND    EFF_YRMON >= substr( replace(@[sail_dt],'-',''),1,6)
        HAVING MIN(EFF_YRMON) IS NOT NULL ))			]]></sql>
			<params>
				<param name="sail_dt" type="12" value="" out="N"/>
				<param name="rev_tp_cd" type="12" value="" out="N"/>
				<param name="rev_src_cd" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
