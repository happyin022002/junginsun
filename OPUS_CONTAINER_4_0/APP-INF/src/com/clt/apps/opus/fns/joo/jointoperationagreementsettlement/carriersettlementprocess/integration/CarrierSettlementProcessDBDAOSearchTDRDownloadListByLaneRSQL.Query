<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CarrierSettlementProcessDBDAOSearchTDRDownloadListByLaneRSQL">
			<desc><![CDATA[History --------------------------------------------------------
2010.12.07 김상수 [CHM-201007318-01] JOO - TDR Inquiry 기능 보완 요청 - i-stowage 연계
                   1. 조회조건에 Carrier Code를 Multi Select 할 수 있는 멀티콤보 추가
                   2. Sheet에 컬럼 추가
                     (※ Data 조회 Logic 보완)
                     - 기존처럼  해당 VVD 와 Port를 선정할때  Upload Status가  N (증빙 가)일 경우
                        해당 정보(20’, 40’, 20HC, 40HC, 45, AK, RF, EMPTY)를 I-Stowage에서 조회
                     - Source 컬럼 추가
                        OPF : OPF 모듈에서  Data 조회
                        IST : I-Stowage에서 Data 조회
2010.12.24 김상수 [CHM-201007932-01] JOO- TDR Inquiry by VVD 기능 보완 요청 - Weight 반영
                   - TDR Inquiry by VVD 기능 보완 요청 - Weight 반영
[2015.07.21]Virtual Add Calling 처리. VSK_VSL_PORT_SKD.NVL(VT_ADD_CALL_FLG, 'N') = 'N'
]]></desc>
			<sql><![CDATA[
WITH VSL AS (SELECT VSL_CD
             , SKD_VOY_NO
             , SKD_DIR_CD
             , VPS_PORT_CD
             , CLPT_IND_SEQ
             , VPS_ETA_DT
             , VPS_ETD_DT
             , SLAN_CD
             , YD_CD
          FROM VSK_VSL_PORT_SKD
         WHERE SLAN_CD LIKE @[rlane_cd] || '%'
           AND ( (VPS_ETA_DT BETWEEN TO_DATE (REPLACE (@[pre_fr], '-', ''), 'YYYYMMDD') AND TO_DATE (REPLACE (@[pre_to], '-', ''), 'YYYYMMDD') + 0.99999)
                    OR VPS_ETA_DT IS NULL )
           AND TURN_PORT_IND_CD NOT IN ('D', 'V', 'F')
           AND NVL(VT_ADD_CALL_FLG, 'N') = 'N' /*2015.07.21 Add*/ 
)
SELECT OPR_CD
     , VVD
     , VSL_CD
     , SKD_VOY_NO
     , SKD_DIR_CD
     , VPS_PORT_CD
     , SLAN_CD
     , VPS_ETD_DT
     , ALL_TEU
     , ALL_WGT
     , GRAND_TTL_SLOT
     , GRAND_TTL_WGT
     , CASE WHEN GRAND_TTL_SLOT > ALL_TEU AND ALL_TEU > 0 THEN GRAND_TTL_SLOT - ALL_TEU
            ELSE 0
       END OVER_SLOT
     , CASE WHEN GRAND_TTL_WGT > ALL_WGT AND ALL_WGT > 0 THEN GRAND_TTL_WGT - ALL_WGT
            ELSE 0
       END OVER_WGT
     , HC_LD_20
     , HC_BSA_20
     , HC_LD_40
     , HC_BSA_40
     , HC_LD_45
     , HC_BSA_45
     , AK_UNIT
     , AK_VOID
     , RF_20_QTY
     , RF_40_QTY
     , MT_TEU
     , FULL_20
     , MT_20
     , FULL_40
     , MT_40
     , MT_WT
     , SOURCE
  FROM (SELECT OPR_CD
             , VVD
             , VSL_CD
             , SKD_VOY_NO
             , SKD_DIR_CD
             , VPS_PORT_CD
             , SLAN_CD
             , VPS_ETD_DT
             , ALL_TEU
             , ALL_WGT
             , FULL_20+MT_20+HC_LD_20+HC_BSA_20+((FULL_40+MT_40+HC_LD_40+HC_BSA_40+HC_LD_45+HC_BSA_45)*2)+AK_VOID AS GRAND_TTL_SLOT
             , GRAND_TTL_WGT
             , OVER_SLOT
             , OVER_WGT
             , HC_LD_20
             , HC_BSA_20
             , HC_LD_40
             , HC_BSA_40
             , HC_LD_45
             , HC_BSA_45
             , AK_UNIT
             , AK_VOID
             , RF_20_QTY
             , RF_40_QTY
             , MT_TEU
             , FULL_20
             , MT_20
             , FULL_40
             , MT_40
             , MT_WT
             , SOURCE
          FROM (SELECT OPR_CD
                     , VSL_CD || VOY_NO || DIR_CD VVD
                     , VSL_CD
                     , VOY_NO SKD_VOY_NO
                     , DIR_CD SKD_DIR_CD
                     , PORT_CD VPS_PORT_CD
                     , SLAN_CD
                     , VPS_ETD_DT
                     , SUM (ALL_TEU) ALL_TEU
                     , SUM (ALL_WGT) ALL_WGT
                     , SUM (GRAND_TTL_SLOT) GRAND_TTL_SLOT
                     , SUM (GRAND_TTL_WGT) GRAND_TTL_WGT
					 , 0 OVER_SLOT
					 , 0 OVER_WGT
                     , SUM (HC_LD_20) HC_LD_20
                     , SUM (HC_BSA_20) HC_BSA_20
                     , SUM (HC_LD_40) HC_LD_40
                     , SUM (HC_BSA_40) HC_BSA_40
                     , SUM (HC_LD_45) HC_LD_45
                     , SUM (HC_BSA_45) HC_BSA_45
                     , SUM (AK_UNIT) AK_UNIT
                     , SUM (AK_VOID) AK_VOID
                     , SUM (RF_20_QTY) RF_20_QTY
                     , SUM (RF_40_QTY) RF_40_QTY
                     , SUM (MT_TEU) MT_TEU
                     , SUM (FULL_20) FULL_20
                     , SUM (MT_20) MT_20
                     , SUM (FULL_40) FULL_40
                     , SUM (MT_40) MT_40
                     , SUM (MT_WT) MT_WT
                     , 'Bay Plan' SOURCE
                  FROM ( 
                        /* 20HC, 40HC, 45HC, F20, E20, F40, E40 */
                        SELECT NVL(B.OPR_CD, 'ZZZ') OPR_CD
                             , B.VSL_CD
                             , B.VOY_NO
                             , B.DIR_CD
                             , B.PORT_CD PORT_CD
                             , K.SLAN_CD
                             , TO_CHAR (K.VPS_ETD_DT, 'YYYY-MM-DD') VPS_ETD_DT
                             , 0 ALL_TEU
                             , 0 ALL_WGT
                             , 0 GRAND_TTL_SLOT
                             , SUM(B.WEIGHT) GRAND_TTL_WGT
                             , 0 OVER_SLOT
                             , 0 OVER_WGT
                             , SUM (DECODE (B.CNTR_SIZE || B.FE || MOD (B.BAY, 2), 'HF1', 1, 0)) HC_LD_20
                             , SUM (DECODE (B.CNTR_SIZE || B.FE || MOD (B.BAY, 2), 'HE1', 1, 0)) HC_BSA_20
                             , SUM (DECODE (B.CNTR_SIZE || B.FE || MOD (B.BAY, 2), 'HF0', 1, 0)) HC_LD_40
                             , SUM (DECODE (B.CNTR_SIZE || B.FE || MOD (B.BAY, 2), 'HE0', 1, 0)) HC_BSA_40
                             , SUM (DECODE (B.CNTR_SIZE || B.FE, 'LF', 1, 0)) HC_LD_45
                             , SUM (DECODE (B.CNTR_SIZE || B.FE, 'LE', 1, 0)) HC_BSA_45
                             , 0 AK_UNIT
                             , 0 AK_VOID
                             , 0 RF_20_QTY
                             , 0 RF_40_QTY
                             , 0 MT_TEU
                             , SUM (DECODE (B.CNTR_SIZE || B.FE, '2F', 1, 0)) FULL_20
                             , SUM (DECODE (B.CNTR_SIZE || B.FE, '2E', 1, 0)) MT_20
                             , SUM (DECODE (B.CNTR_SIZE || B.FE, '4F', 1, 0)) FULL_40
                             , SUM (DECODE (B.CNTR_SIZE || B.FE, '4E', 1, 0)) MT_40
                             , 0 MT_WT
                          FROM BAY_PLAN B
                             , VSL K
                         WHERE 1=1
                           AND K.VSL_CD = B.VSL_CD
                           AND K.SKD_VOY_NO = B.VOY_NO
                           AND K.SKD_DIR_CD = B.DIR_CD
                           AND K.VPS_PORT_CD = B.PORT_CD
                           AND K.CLPT_IND_SEQ = B.CALL_IND
                           AND B.PLAN_TYPE= 'F'
                           AND K.SLAN_CD LIKE @[rlane_cd] || '%'
                           AND K.SKD_DIR_CD LIKE @[skd_dir_cd] || '%' 
#if (${vvd} != '')
                           AND B.VSL_CD || B.VOY_NO || B.DIR_CD LIKE @[vvd] || '%' 
#end 
#if (${opr_cd} != '')
                           AND B.OPR_CD IN (${opr_cd}) 
#end
                         GROUP BY B.OPR_CD
                             , B.VSL_CD
                             , B.VOY_NO
                             , B.DIR_CD
                             , B.PORT_CD
                             , K.SLAN_CD
                             , TO_CHAR (K.VPS_ETD_DT, 'YYYY-MM-DD')
                         UNION ALL 
                        /* RF20, RF40 */
                        SELECT NVL(B.OPR_CD, 'ZZZ') OPR_CD
                             , B.VSL_CD
                             , B.VOY_NO
                             , B.DIR_CD
                             , B.POL PORT_CD
                             , K.SLAN_CD
                             , TO_CHAR (K.VPS_ETD_DT, 'YYYY-MM-DD') VPS_ETD_DT
                             , 0 ALL_TEU
                             , 0 ALL_WGT
                             , 0 GRAND_TTL_SLOT
                             , 0 GRAND_TTL_WGT
                             , 0 OVER_SLOT
                             , 0 OVER_WGT
                             , 0 HC_LD_20
                             , 0 HC_BSA_20
                             , 0 HC_LD_40
                             , 0 HC_BSA_40
                             , 0 HC_LD_45
                             , 0 HC_BSA_45
                             , 0 AK_UNIT
                             , 0 AK_VOID
                             , SUM (DECODE (MOD (B.BAY, 2), 1, 1)) RF_20_QTY
                             , SUM (DECODE (MOD (B.BAY, 2), 0, 1)) RF_40_QTY
                             , 0 MT_TEU
                             , 0 FULL_20
                             , 0 MT_20
                             , 0 FULL_40
                             , 0 MT_40
                             , 0 MT_WT
                          FROM BAY_PLAN B
                             , VSL K
                         WHERE 1=1
                           AND K.VSL_CD = B.VSL_CD
                           AND K.SKD_VOY_NO = B.VOY_NO
                           AND K.SKD_DIR_CD = B.DIR_CD
                           AND K.VPS_PORT_CD = B.PORT_CD
                           AND K.CLPT_IND_SEQ = B.CALL_IND
                           AND B.CARGO_TYPE = 'RF'
                           AND B.PLAN_TYPE = 'F'
                           AND B.POL = B.PORT_CD
                           AND B.PORT_CD = K.VPS_PORT_CD
                           AND K.SLAN_CD LIKE @[rlane_cd] || '%'
                           AND K.SKD_DIR_CD LIKE @[skd_dir_cd] || '%' 
#if (${vvd} != '')
                           AND B.VSL_CD || B.VOY_NO || B.DIR_CD LIKE @[vvd] || '%' 
#end 
#if (${opr_cd} != '')
                           AND B.OPR_CD IN (${opr_cd}) 
#end
                         GROUP BY B.OPR_CD
                             , B.VSL_CD
                             , B.VOY_NO
                             , B.DIR_CD
                             , B.POL
                             , K.SLAN_CD
                             , TO_CHAR (K.VPS_ETD_DT, 'YYYY-MM-DD')
                         UNION ALL 
                        /* empty */
                        SELECT NVL(B.OPR_CD, 'ZZZ') OPR_CD
                             , B.VSL_CD
                             , B.VOY_NO
                             , B.DIR_CD
                             , B.PORT_CD PORT_CD
                             , K.SLAN_CD
                             , TO_CHAR (K.VPS_ETD_DT, 'YYYY-MM-DD') VPS_ETD_DT
                             , 0 ALL_TEU
                             , 0 ALL_WGT
                             , 0 GRAND_TTL_SLOT
                             , 0 GRAND_TTL_WGT
                             , 0 OVER_SLOT
                             , 0 OVER_WGT
                             , 0 HC_LD_20
                             , 0 HC_BSA_20
                             , 0 HC_LD_40
                             , 0 HC_BSA_40
                             , 0 HC_LD_45
                             , 0 HC_BSA_45
                             , 0 AK_UNIT
                             , 0 AK_VOID
                             , 0 RF_20_QTY
                             , 0 RF_40_QTY
                             , SUM (DECODE (MOD (B.BAY, 2), 0, 2, 1)) MT_TEU
                             , 0 FULL_20
                             , 0 MT_20
                             , 0 FULL_40
                             , 0 MT_40
                             , SUM (B.WEIGHT) MT_WT
                          FROM BAY_PLAN B
                             , VSL K
                         WHERE 1=1
                           AND K.VSL_CD = B.VSL_CD
                           AND K.SKD_VOY_NO = B.VOY_NO
                           AND K.SKD_DIR_CD = B.DIR_CD
                           AND K.VPS_PORT_CD = B.PORT_CD
                           AND K.CLPT_IND_SEQ = B.CALL_IND
                           AND B.FE = 'E'
                           AND B.PLAN_TYPE = 'F'
                           AND K.SLAN_CD LIKE @[rlane_cd] || '%'
                           AND K.SKD_DIR_CD LIKE @[skd_dir_cd] || '%' 
#if (${vvd} != '')
                           AND B.VSL_CD || B.VOY_NO || B.DIR_CD LIKE @[vvd] || '%' 
#end 
#if (${opr_cd} != '')
                           AND B.OPR_CD IN (${opr_cd}) 
#end
                         GROUP BY B.OPR_CD
                             , B.VSL_CD
                             , B.VOY_NO
                             , B.DIR_CD
                             , B.PORT_CD
                             , K.SLAN_CD
                             , TO_CHAR (K.VPS_ETD_DT, 'YYYY-MM-DD')
                         UNION ALL 
                        /* 'AK' UNIT */
                        SELECT NVL(B.OPR_CD, 'ZZZ') OPR_CD
                             , B.VSL_CD
                             , B.VOY_NO
                             , B.DIR_CD
                             , B.PORT_CD PORT_CD
                             , K.SLAN_CD
                             , TO_CHAR (K.VPS_ETD_DT, 'YYYY-MM-DD') VPS_ETD_DT
                             , 0 ALL_TEU
                             , 0 ALL_WGT
                             , 0 GRAND_TTL_SLOT
                             , 0 GRAND_TTL_WGT
                             , 0 OVER_SLOT
                             , 0 OVER_WGT
                             , 0 HC_LD_20
                             , 0 HC_BSA_20
                             , 0 HC_LD_40
                             , 0 HC_BSA_40
                             , 0 HC_LD_45
                             , 0 HC_BSA_45
                             , COUNT (*) AK_UNIT
                             , 0 AK_VOID
                             , 0 RF_20_QTY
                             , 0 RF_40_QTY
                             , 0 MT_TEU
                             , 0 FULL_20
                             , 0 MT_20
                             , 0 FULL_40
                             , 0 MT_40
                             , 0 MT_WT
                          FROM BAY_PLAN B
                             , VSL K
                         WHERE 1=1
                           AND K.VSL_CD = B.VSL_CD
                           AND K.SKD_VOY_NO = B.VOY_NO
                           AND K.SKD_DIR_CD = B.DIR_CD
                           AND K.VPS_PORT_CD = B.PORT_CD
                           AND K.CLPT_IND_SEQ = B.CALL_IND
                           AND ( B.CARGO_TYPE IN ('AK', 'BB')
                                 OR ((B.ACT_SLOT>0 OR B.OVH_SLOT>0 OR B.OVP_SLOT>0 OR B.OVS_SLOT>0 OR B.OVF_SLOT>0 OR B.OVA_SLOT>0))
                               )
                           AND B.PLAN_TYPE = 'F'
                           AND K.SLAN_CD LIKE @[rlane_cd] || '%'
                           AND K.SKD_DIR_CD LIKE @[skd_dir_cd] || '%' 
#if (${vvd} != '')
                           AND B.VSL_CD || B.VOY_NO || B.DIR_CD LIKE @[vvd] || '%' 
#end 
#if (${opr_cd} != '')
                           AND B.OPR_CD IN (${opr_cd}) 
#end
                         GROUP BY B.OPR_CD
                             , B.VSL_CD
                             , B.VOY_NO
                             , B.DIR_CD
                             , B.PORT_CD
                             , K.SLAN_CD
                             , TO_CHAR (K.VPS_ETD_DT, 'YYYY-MM-DD')
                         UNION ALL 
                        /* 'AK' Void */
                        SELECT NVL(OPR_CD, 'ZZZ') OPR_CD
                             , VSL_CD
                             , VOY_NO
                             , DIR_CD
                             , PORT_CD
                             , SLAN_CD
                             , VPS_ETD_DT
                             , 0 ALL_TEU
                             , 0 ALL_WGT
                             , 0 GRAND_TTL_SLOT
                             , 0 GRAND_TTL_WGT
                             , 0 OVER_SLOT
                             , 0 OVER_WGT
                             , 0 HC_LD_20
                             , 0 HC_BSA_20
                             , 0 HC_LD_40
                             , 0 HC_BSA_40
                             , 0 HC_LD_45
                             , 0 HC_BSA_45
                             , 0 AK_UNIT
                             , SUM (CASE WHEN ACT_SLOT <> '' THEN TO_NUMBER(ACT_SLOT)
                                         WHEN X * Y * Z > 0 THEN (X + 1) * (Y + 1) * (Z + 1) * S - S
                                         WHEN X * Y > 0 THEN (X + 1) * (Y + 1) * S - S
                                         WHEN X * Z > 0 THEN (X + 1) * (Z + 1) - 1 + X * (S - 1)
                                         WHEN Y * Z > 0 THEN (Y + 1) * (Z + 1) - 1 + Y * (S - 1)
                                         WHEN X + Y > 0 THEN (X + Y + 1) * S - S
                                         WHEN Z > 0 THEN Z
                                         ELSE 0
                                       END) AS AK_VOID
                             , 0 RF_20_QTY
                             , 0 RF_40_QTY
                             , 0 MT_TEU
                             , 0 FULL_20
                             , 0 MT_20
                             , 0 FULL_40
                             , 0 MT_40
                             , 0 MT_WT
                          FROM (SELECT NVL(B.OPR_CD, 'ZZZ') OPR_CD
                                     , B.VSL_CD
                                     , B.VOY_NO
                                     , B.DIR_CD
                                     , B.PORT_CD
                                     , K.SLAN_CD
                                     , TO_CHAR (K.VPS_ETD_DT, 'YYYY-MM-DD') VPS_ETD_DT
                                     , NVL (B.OVP_SLOT, 0) + NVL (B.OVS_SLOT, 0) X
                                     , NVL (B.OVH_SLOT, 0) Y
                                     , NVL (B.OVA_SLOT, 0) + NVL (B.OVF_SLOT, 0) Z
                                     , (2 - MOD (B.BAY, 2)) S
                                     , ACT_SLOT
                                  FROM BAY_PLAN B
                                     , VSL K
                                 WHERE 1=1
                                   AND K.VSL_CD = B.VSL_CD
                                   AND K.SKD_VOY_NO = B.VOY_NO
                                   AND K.SKD_DIR_CD = B.DIR_CD
                                   AND K.VPS_PORT_CD = B.PORT_CD
                                   AND K.CLPT_IND_SEQ = B.CALL_IND
                                   AND ( B.CARGO_TYPE IN ('AK', 'BB')
                                           OR ((B.ACT_SLOT>0 OR B.OVH_SLOT>0 OR B.OVP_SLOT>0 OR B.OVS_SLOT>0 OR B.OVF_SLOT>0 OR B.OVA_SLOT>0))
                                       )
                                   AND B.PLAN_TYPE = 'F'
                                   AND K.SLAN_CD LIKE @[rlane_cd] || '%'
                                   AND K.SKD_DIR_CD LIKE @[skd_dir_cd] || '%' 
#if (${vvd} != '')
                                   AND B.VSL_CD || B.VOY_NO || B.DIR_CD LIKE @[vvd] || '%' 
#end 
#if (${opr_cd} != '')
                                   AND B.OPR_CD IN (${opr_cd}) 
#end 
                               )
                         GROUP BY OPR_CD
                             , VSL_CD
                             , VOY_NO
                             , DIR_CD
                             , PORT_CD
                             , SLAN_CD
                             , VPS_ETD_DT
                         UNION ALL 
                        /*Allocation TEU/WT*/
                        SELECT NVL(OPR_CD, 'ZZZ') OPR_CD
                             , VSL_CD
                             , VOY_NO
                             , DIR_CD
                             , PORT_CD
                             , SLAN_CD
                             , VPS_ETD_DT
                             , ALL_TEU
                             , ALL_WGT
                             , 0 GRAND_TTL_SLOT
                             , 0 GRAND_TTL_WGT
                             , 0 OVER_SLOT
                             , 0 OVER_WGT
                             , 0 HC_LD_20
                             , 0 HC_BSA_20
                             , 0 HC_LD_40
                             , 0 HC_BSA_40
                             , 0 HC_LD_45
                             , 0 HC_BSA_45
                             , 0 AK_UNIT
                             , 0 AK_VOID
                             , 0 RF_20_QTY
                             , 0 RF_40_QTY
                             , 0 MT_TEU
                             , 0 FULL_20
                             , 0 MT_20
                             , 0 FULL_40
                             , 0 MT_40
                             , 0 MT_WT
                          FROM (SELECT A.OPR_CD
                                     , A.VSL_CD
                                     , A.VOY_NO
                                     , A.DIR_CD
                                     , A.PORT_CD
                                     , A.CALL_IND
                                     , A.SLAN_CD
                                     , A.VPS_ETD_DT
                                     , NVL(SUM(C.ALL_TEU),0) AS ALL_TEU
                                     , NVL(SUM(C.ALL_WGT),0) AS ALL_WGT
                                  FROM (SELECT DISTINCT NVL(B.OPR_CD, 'ZZZ') OPR_CD
                                             , B.VSL_CD
                                             , B.VOY_NO
                                             , B.DIR_CD
                                             , B.PORT_CD
                                             , B.CALL_IND
                                             , K.SLAN_CD
                                             , TO_CHAR (K.VPS_ETD_DT, 'YYYY-MM-DD') VPS_ETD_DT
                                          FROM BAY_PLAN B
                                             , VSL K
                                         WHERE 1=1
                                           AND K.VSL_CD = B.VSL_CD
                                           AND K.SKD_VOY_NO = B.VOY_NO
                                           AND K.SKD_DIR_CD = B.DIR_CD
                                           AND K.VPS_PORT_CD = B.PORT_CD
                                           AND K.CLPT_IND_SEQ = B.CALL_IND
                                           AND B.PLAN_TYPE = 'F'
                                           AND K.SLAN_CD LIKE @[rlane_cd] || '%'
                                           AND K.SKD_DIR_CD LIKE @[skd_dir_cd] || '%' 
#if (${vvd} != '')
                                           AND B.VSL_CD || B.VOY_NO || B.DIR_CD LIKE @[vvd] || '%' 
#end 
#if (${opr_cd} != '')
                                           AND B.OPR_CD IN (${opr_cd}) 
#end 
                                       ) A
                                     , (SELECT H.VSL_CD
                                             , H.VOY_NO
                                             , H.DIR_CD
                                             , H.PORT_CD
                                             , H.CALL_IND
                                             , A.OPR_CD
                                             , NVL(SUM(A.BSA_SLOT),0) + NVL(SUM(A.SWAP_SLOT),0) + NVL(SUM(A.RELEASE_SLOT),0) AS ALL_TEU
                                             , NVL(SUM(A.BSA_WGT),0) + NVL(SUM(A.SWAP_WGT),0) + NVL(SUM(A.RELEASE_WGT),0) AS ALL_WGT
                                          FROM TDR_HEADER H
                                             , TDR_ALLOCATION A
                                             , VSL K
                                         WHERE H.VSL_CD = A.VSL_CD
                                           AND H.VOY_NO = A.VOY_NO
                                           AND H.DIR_CD = A.DIR_CD
                                           AND H.PORT_CD = A.PORT_CD
                                           AND H.CALL_IND = A.CALL_IND
                                           AND A.VSL_CD = K.VSL_CD
                                           AND A.VOY_NO = K.SKD_VOY_NO
                                           AND A.DIR_CD = K.SKD_DIR_CD
                                           AND A.PORT_CD = K.VPS_PORT_CD
                                           AND A.CALL_IND = K.CLPT_IND_SEQ
                                         GROUP BY H.VSL_CD
                                             , H.VOY_NO
                                             , H.DIR_CD
                                             , H.PORT_CD
                                             , H.CALL_IND
                                             , A.OPR_CD ) C
                                 WHERE 1=1
                                   AND A.VSL_CD = C.VSL_CD(+)
                                   AND A.VOY_NO = C.VOY_NO(+)
                                   AND A.DIR_CD = C.DIR_CD(+)
                                   AND A.PORT_CD = C.PORT_CD(+)
                                   AND A.CALL_IND = C.CALL_IND(+)
                                   AND A.OPR_CD = C.OPR_CD(+)
                                 GROUP BY A.OPR_CD
                                     , A.VSL_CD
                                     , A.VOY_NO
                                     , A.DIR_CD
                                     , A.PORT_CD
                                     , A.CALL_IND
                                     , A.SLAN_CD
                                     , A.VPS_ETD_DT ) )
                 GROUP BY OPR_CD
                     , VSL_CD
                     , VOY_NO
                     , DIR_CD
                     , PORT_CD
                     , SLAN_CD
                     , VPS_ETD_DT 
             ) A 
       ) A
 ORDER BY 2, 8, 6, 1			]]></sql>
			<params>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="pre_fr" type="12" value="" out="N"/>
				<param name="pre_to" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
