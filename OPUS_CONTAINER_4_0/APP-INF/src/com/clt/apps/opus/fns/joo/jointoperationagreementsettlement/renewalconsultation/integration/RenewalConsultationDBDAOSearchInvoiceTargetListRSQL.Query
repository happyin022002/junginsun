<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RenewalConsultationDBDAOSearchInvoiceTargetListRSQL">
			<desc><![CDATA[Invoice Target 조회.]]></desc>
			<sql><![CDATA[
SELECT STL.JO_CRR_CD
     , STL.RLANE_CD
     , STL.LOCL_CURR_CD
     , TO_CHAR(SYSDATE,'YYYYMM') AS ACCT_YRMON
     , SUM(STL.STL_REV_ACT_AMT) AS STL_REV_ACT_AMT
     , SUM(STL.STL_EXP_ACT_AMT) AS STL_EXP_ACT_AMT
     , ( SELECT MIN(CR.JO_CRR_CD||'^'||CR.CUST_CNT_CD||CUST_SEQ||'^'||CR.VNDR_SEQ)
           FROM JOO_CARRIER CR
          WHERE CR.DELT_FLG     = 'N'
            AND CR.JO_CRR_CD    = STL.JO_CRR_CD
            AND CR.RLANE_CD     = STL.RLANE_CD
        ) AS ACCTG_CRR_CD
     , STL.JO_CRR_CD || STL.RLANE_CD || STL.LOCL_CURR_CD AS DTL_GRP_KEY
  FROM (
        SELECT STL.JO_CRR_CD
             , STL.RLANE_CD
             , STL.LOCL_CURR_CD
             , DECODE(STL.RE_DIVR_CD, 'R', STL.ACT_AMT, NULL) AS STL_REV_ACT_AMT
             , DECODE(STL.RE_DIVR_CD, 'E', STL.ACT_AMT, NULL) AS STL_EXP_ACT_AMT
          FROM (
                SELECT STL.JO_CRR_CD
                     , STL.RLANE_CD
                     , STL.LOCL_CURR_CD
                     , STL.RE_DIVR_CD
                     , ROUND(STL.ACT_AMT, 2) AS ACT_AMT
                  FROM JOO_STL_TGT STL
                 WHERE 1=1
                   AND STL.STL_TGT_FLG      = 'Y'
                   AND NVL(STL.ACT_AMT, 0)  <> 0
                   AND STL.REV_YRMON        BETWEEN REPLACE(@[fr_rev_yrmon],'-') AND REPLACE(@[to_rev_yrmon],'-') /* Condition Target Revenue Month*/
#if (${trd_cd}!='')
                   /* Condition Trade */
                   AND EXISTS   (   SELECT 'X'
                                      FROM JOO_CARRIER CRR
                                     WHERE 1=1
                                       AND CRR.DELT_FLG         = 'N'
                                       AND CRR.JO_CRR_CD        = STL.JO_CRR_CD
                                       AND CRR.RLANE_CD         = STL.RLANE_CD
                                       AND CRR.TRD_CD           = @[trd_cd]
                                     )
#end
#if (${auth_ofc_cd}!='')
                   /* Condition Auth Office Cd */
                   AND EXISTS   (   SELECT 'X'
                                      FROM JOO_CRR_AUTH CA
                                     WHERE 1=1
                                       AND CA.DELT_FLG         = 'N'
                                       AND CA.JO_CRR_CD        = STL.JO_CRR_CD
                                       AND CA.RLANE_CD         = STL.RLANE_CD
                                       AND CA.AUTH_OFC_CD      = @[auth_ofc_cd]
                                     )
#end
#if (${re_divr_cd}!='')
                    AND STL.RE_DIVR_CD      = @[re_divr_cd]     /* Condition ALL, Revenue : R , Expense : E */
#end
#if (${jo_crr_cds} != '' && ${jo_crr_cds} != 'ALL')
                   /* Condition Items */
                   AND STL.JO_CRR_CD        IN ( #foreach($key IN ${jo_crr_cds})#if($velocityCount < $jo_crr_cds.size()) '$key', #else '$key' #end #end)
#end
           ) STL
   ) STL
GROUP BY STL.JO_CRR_CD
     , STL.RLANE_CD
     , STL.LOCL_CURR_CD
ORDER BY STL.JO_CRR_CD
     , STL.LOCL_CURR_CD
     , STL.RLANE_CD			]]></sql>
			<params>
				<param name="fr_rev_yrmon" type="12" value="" out="N"/>
				<param name="to_rev_yrmon" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="auth_ofc_cd" type="12" value="" out="N"/>
				<param name="re_divr_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
