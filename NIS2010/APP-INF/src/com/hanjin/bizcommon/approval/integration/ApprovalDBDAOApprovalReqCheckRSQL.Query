<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ApprovalDBDAOApprovalReqCheckRSQL">
			<desc><![CDATA[결재라인 새로 지정할 때 기존 Default 결재자들이 포함되어 있는지 체크]]></desc>
			<sql><![CDATA[
SELECT
CASE
WHEN
    NVL((
    SELECT DECODE(V.AP_DFLT_APRO_STEP_FLG,'Y','Y','N')
    FROM COM_AP_ACCT_VER V      
    WHERE V.AP_ACCT_VER_NO = (SELECT MAX(M.AP_ACCT_VER_NO) FROM COM_AP_ACCT_VER M WHERE NVL(M.CFM_FLG,'N') = 'Y') 
    ),'X') = 'Y'
THEN 
(
SELECT 
NVL((
SELECT 
CASE
WHEN COUNT(Z.APRO_USR_ID) = 0
THEN 'Y'
ELSE 'N'
END
FROM (
    SELECT 
    A.APRO_USR_ID
    FROM COM_APRO_ROUT_DFLT_DTL A, COM_USER B
    WHERE B.USE_FLG = 'Y'
    AND NVL(A.DELT_FLG, 'N') <> 'Y'
    AND A.APRO_USR_ID IN (B.USR_ID, B.EP_ID) --AND 1=2
    AND A.APRO_ROUT_SEQ = 
            (SELECT APRO_ROUT_SEQ
            FROM COM_APRO_ROUT_DFLT
            WHERE SUB_SYS_CD = DECODE(@[sub_sys_cd],'TLL','MNR',@[sub_sys_cd])
            AND OFC_CD     = @[ofc_cd])
    AND NOT EXISTS (
            SELECT 'X' FROM (SELECT NVL(EP_ID, USR_ID) USR_ID
                                     FROM COM_USER
                                    WHERE USR_ID IN (
                                    #foreach($key1 in ${aproUsrId})
									  #if($velocityCount < $aproUsrId.size()) 
         						     '${key1}', 
          							 #else 
         						     '${key1}'
         							  #end                                     
                                    #end
                                    )
                                      AND USE_FLG = 'Y' --AND 1=2
                                    UNION
                                   SELECT USR_ID
                                     FROM COM_USER
                                    WHERE EP_ID IN (
                                    #foreach($key1 in ${aproUsrId})
                                     #if($velocityCount < $aproUsrId.size()) 
         						     '${key1}', 
          							 #else 
         						     '${key1}'
         							  #end
                                    #end
                                    )
                                      AND USE_FLG = 'Y' --AND 1=2
                           ) S
                           WHERE S.USR_ID = A.APRO_USR_ID
    )   
)Z),'X') APRO_ROUT_CHK FROM DUAL
)
ELSE 'Y'
END
FROM DUAL			]]></sql>
			<params>
				<param name="sub_sys_cd" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
