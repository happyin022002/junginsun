<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContractNoticeMailSendDBDAOSearchNoticeMailReceiverRSQL">
			<desc><![CDATA[계약종료 90일전 Notice mail을 받을 대상자 조회]]></desc>
			<sql><![CDATA[
SELECT A.SYS_CD
      ,A.CTRT_OFC_CD
      ,A.OFC_TP_CD
      ,A.AGMT_MAPG_NO  AGMT_NO
      ,COM_NTC_USR_EML_CONCAT_FNC(A.SYS_CD, A.CTRT_OFC_CD, A.AGMT_NO) USR_EML_CTNT
  FROM COM_CTRT_USR_MGMT A
 WHERE 1=1
 AND SYS_CD NOT IN ('TRS','TES')     
 UNION ALL
 SELECT A.SYS_CD
      ,A.CTRT_OFC_CD
      ,A.OFC_TP_CD
      ,A.AGMT_MAPG_NO  AGMT_NO
      ,COM_NTC_USR_EML_CONCAT_FNC(A.SYS_CD, A.CTRT_OFC_CD, A.AGMT_NO) USR_EML_CTNT
  FROM COM_CTRT_USR_MGMT A
 WHERE 1=1
 AND SYS_CD = 'TRS'
 AND A.AGMT_MAPG_NO IN (select  A.AGMT_NO  FROM  COM_CTRT_NTC_INFO A WHERE A.SYS_CD ='TRS' AND A.EML_SND_FLG ='Y')  
 UNION ALL
 SELECT A.SYS_CD
      ,A.CTRT_OFC_CD
      ,A.OFC_TP_CD
      ,A.AGMT_MAPG_NO  AGMT_NO
      ,COM_NTC_USR_EML_CONCAT_FNC(A.SYS_CD, A.CTRT_OFC_CD, A.AGMT_NO) USR_EML_CTNT
  FROM COM_CTRT_USR_MGMT A
 WHERE 1=1
 AND SYS_CD = 'TRS'
 AND AGMT_NO ='ALL'
 UNION ALL
 SELECT A.SYS_CD
      ,A.CTRT_OFC_CD
      ,A.OFC_TP_CD
      ,A.AGMT_MAPG_NO  AGMT_NO
      ,COM_NTC_USR_EML_CONCAT_FNC(A.SYS_CD, A.CTRT_OFC_CD, A.AGMT_NO) USR_EML_CTNT
  FROM COM_CTRT_USR_MGMT A
 WHERE 1=1
 AND SYS_CD = 'TES'
 AND A.AGMT_MAPG_NO IN (select  AGMT_NO FROM   COM_CTRT_NTC_INFO WHERE SYS_CD ='TES' AND EML_SND_FLG ='Y')  -- 새로추가된 agreement No 발송
 UNION ALL
 SELECT A.SYS_CD
      ,A.CTRT_OFC_CD
      ,A.OFC_TP_CD
      ,A.AGMT_MAPG_NO  AGMT_NO
      ,COM_NTC_USR_EML_CONCAT_FNC(A.SYS_CD, A.CTRT_OFC_CD, A.AGMT_NO) USR_EML_CTNT
  FROM COM_CTRT_USR_MGMT A
 WHERE 1=1
 AND SYS_CD = 'TES'
 AND AGMT_NO ='ALL'			]]></sql>
			<params>
			</params>
		</query>
	</querys>
</sqls>
