<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ApprovalStepSendDBDAOGetAproStepInfoEAIformatRSQL">
			<desc><![CDATA[EAI 형식에 맞게 AproStep 상세 정보 조회]]></desc>
			<sql><![CDATA[
SELECT          
    COUNT(A.CSR_NO) OVER (PARTITION BY A.CSR_NO) TTL_ROW_KNT,
    ROWNUM              ROW_KNT,        
    A.CSR_NO            CSR_NO,          
    A.CSR_TP_CD         CSR_TP_CD,       
    A.SRC_CTNT          SRC_CTNT,        
    X.APRO_DT           APRO_DT,  
    X.APRO_OFC_CD       APRO_OFC_CD,
    X.APRO_USR_ID       APRO_USR_ID,
    ''                  ATTR_CTNT1,          
    ''                  ATTR_CTNT2,          
    ''                  ATTR_CTNT3,          
    ''                  ATTR_CTNT4,          
    ''                  ATTR_CTNT5
FROM AP_INV_HDR A, (
    SELECT 
    D.CSR_NO, H.CRNT_APRO_SEQ, R.APRO_RQST_SEQ,
    TO_CHAR(R.APRO_DT,'YYYYMMDD') APRO_DT, R.APRO_OFC_CD, R.APRO_USR_ID
    FROM COM_APRO_CSR_DTL D, COM_APRO_RQST_HDR H, COM_APRO_RQST_ROUT R
    WHERE 1=1
    AND D.APRO_RQST_NO = H.APRO_RQST_NO
    AND D.CSR_NO =  @[csr_no]
    --AND H.APRO_KND_CD = 'CSR'
    AND H.APSTS_CD = 'C'
    AND H.APRO_RQST_NO = R.APRO_RQST_NO
    AND R.APRO_RQST_SEQ = (
        SELECT MAX(X.APRO_RQST_SEQ)
        FROM COM_APRO_RQST_ROUT X
        WHERE 1=1
        AND X.APRO_RQST_NO = H.APRO_RQST_NO
    )
    ORDER BY D.CSR_NO, R.APRO_RQST_SEQ
) X
WHERE 1=1
AND A.CSR_NO = X.CSR_NO
AND A.CSR_NO = @[csr_no]
AND A.IF_FLG IS NOT NULL
AND A.IF_DT IS NOT NULL			]]></sql>
			<params>
				<param name="csr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
