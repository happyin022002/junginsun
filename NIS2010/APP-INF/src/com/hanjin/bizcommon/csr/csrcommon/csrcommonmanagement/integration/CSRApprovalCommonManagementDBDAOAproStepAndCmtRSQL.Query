<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CSRApprovalCommonManagementDBDAOAproStepAndCmtRSQL">
			<desc><![CDATA[Approval Step & Comments]]></desc>
			<sql><![CDATA[
SELECT 
A.APRO_RQST_NO
, A.APRO_RQST_SEQ
, A.APRO_USR_ID
, A.APRO_USR_NM
, A.APRO_OFC_CD
, A.APRO_CD
, A.APRO_DT
, A.APRO_RMK
, CASE 
  WHEN EXISTS (
    SELECT 'X'
    FROM COM_USER U
    WHERE NVL(U.USE_FLG,'N') = 'Y'
    AND U.USR_ID = @[login_usr_id]
    AND U.USR_ID = A.APRO_USR_ID
    --AND U.OFC_CD = A.APRO_OFC_CD
  )
  THEN 'Y'
  ELSE 'N'
  END EDITABLE_YN
, AP_COM_CHK_CURR_APRO_USR_FNC((SELECT D.CSR_NO FROM COM_APRO_CSR_DTL D WHERE D.APRO_RQST_NO = A.APRO_RQST_NO),@[login_usr_id]) CHK_CURR_APRO_USR_YN
FROM (
    SELECT 
    ROW_NUMBER() OVER (ORDER BY APRO_RQST_SEQ DESC) NO
    , APRO_RQST_NO
    , APRO_RQST_SEQ
    , APRO_USR_ID
    , APRO_USR_NM
    , APRO_OFC_CD
    , DECODE(NVL(APSTS_CD, ''), 'C', 'Approved', 'R', 'Disapproved', '') APRO_CD
    , TO_CHAR(APRO_DT, 'yyyy-mm-dd hh24:mi') APRO_DT
    , USR_CMT_CTNT APRO_RMK
    FROM COM_APRO_RQST_ROUT
    WHERE APRO_RQST_NO = @[apro_rqst_no]
    ORDER BY APRO_RQST_SEQ DESC
) A			]]></sql>
			<params>
				<param name="login_usr_id" type="12" value="" out="N"/>
				<param name="apro_rqst_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
