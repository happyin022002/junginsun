<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ScheduleReceiveManagementDBDAOUpdateCoastalSchedulebyEDICKYHUSQL">
			<desc><![CDATA[CKYH로부터 수신한 EDI Schedule 데이터를 Coastal Schedule에 반영]]></desc>
			<sql><![CDATA[
UPDATE  VSK_VSL_PORT_SKD   PPS
SET     PPS.UPD_USR_ID     = @[upd_usr_id]
WHERE   (PPS.VSL_CD,PPS.SKD_VOY_NO,PPS.SKD_DIR_CD,PPS.VPS_PORT_CD,PPS.CLPT_IND_SEQ)
        IN
        (
        --========================================================================
        SELECT  PS.VSL_CD,PS.SKD_VOY_NO,PS.SKD_DIR_CD,PS.VPS_PORT_CD,PS.CLPT_IND_SEQ
        FROM    VSK_VSL_PORT_SKD   PS
        WHERE   PS.VSL_CD          = @[vsl_cd_ctnt]
        AND     PS.SKD_VOY_NO      = @[skd_voy_no_ctnt]
        AND     PS.SKD_DIR_CD      = @[skd_dir_cd_ctnt]
        AND     PS.CLPT_IND_SEQ    = 1
        AND     PS.VPS_PORT_CD     IN (
                                      SELECT    PS.VPS_PORT_CD
                                      FROM      VSK_VSL_PORT_SKD          PS
                                             ,  VSK_VSL_SKD_XCH_EDI_DTL   D
                                      WHERE     1 = 1
                                      AND       PS.VSL_CD                 = D.VSL_CD_CTNT
                                      AND       PS.SKD_VOY_NO             = D.SKD_VOY_NO_CTNT
                                      AND       PS.SKD_DIR_CD             = D.SKD_DIR_CD_CTNT
                                      AND       DECODE(PS.VPS_PORT_CD,'USLGB','0','USLAX','0',PS.VPS_PORT_CD)
                                                                          = DECODE(D.VPS_PORT_CD_CTNT,'USLGB','0','USLAX','0',D.VPS_PORT_CD_CTNT)
                                      AND       PS.CLPT_IND_SEQ           = 1
                                      AND       D.SND_RCV_KND_CD          = 'R'
                                      AND       D.SKD_EDI_RCV_SEQ         = @[skd_edi_rcv_seq]

                                      --SELECT    D.VPS_PORT_CD_CTNT
                                      --FROM      VSK_VSL_SKD_XCH_EDI_DTL   D
                                      --WHERE     D.SND_RCV_KND_CD          = 'R'
                                      --AND       D.SKD_EDI_RCV_SEQ         = [skd_edi_rcv_seq]
                                      )

        UNION ALL


        SELECT  PS.VSL_CD,PS.SKD_VOY_NO,PS.SKD_DIR_CD,PS.VPS_PORT_CD,PS.CLPT_IND_SEQ
        FROM    VSK_VSL_PORT_SKD      PS
        WHERE   PS.VSL_CD             = @[vsl_cd_ctnt]
        AND     PS.TURN_SKD_VOY_NO    = @[skd_voy_no_ctnt]
        AND     PS.TURN_SKD_DIR_CD    = @[skd_dir_cd_ctnt]
        AND     PS.TURN_CLPT_IND_SEQ  = 1
        AND     PS.VPS_PORT_CD     	IN (
                                      	SELECT    PS.VPS_PORT_CD
                                      	FROM      VSK_VSL_PORT_SKD          PS
                                               ,  VSK_VSL_SKD_XCH_EDI_DTL   D
                                        WHERE     1 = 1
                                      	AND       PS.VSL_CD                 = D.VSL_CD_CTNT
                                      	AND       PS.SKD_VOY_NO             = D.SKD_VOY_NO_CTNT
                                      	AND       PS.SKD_DIR_CD             = D.SKD_DIR_CD_CTNT
                                      	AND       DECODE(PS.VPS_PORT_CD,'USLGB','0','USLAX','0',PS.VPS_PORT_CD)
                                                                          	= DECODE(D.VPS_PORT_CD_CTNT,'USLGB','0','USLAX','0',D.VPS_PORT_CD_CTNT)
                                      	AND       PS.CLPT_IND_SEQ           = 1
                                      	AND       D.SND_RCV_KND_CD          = 'R'
                                      	AND       D.SKD_EDI_RCV_SEQ         = @[skd_edi_rcv_seq]

                                      	--SELECT    D.VPS_PORT_CD_CTNT
                                      	--FROM      VSK_VSL_SKD_XCH_EDI_DTL   D
                                      	--WHERE     D.SND_RCV_KND_CD          = 'R'
                                      	--AND       D.SKD_EDI_RCV_SEQ         = [skd_edi_rcv_seq]
                                      )    
        --========================================================================
        )			]]></sql>
			<params>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="vsl_cd_ctnt" type="12" value="" out="N"/>
				<param name="skd_voy_no_ctnt" type="12" value="" out="N"/>
				<param name="skd_dir_cd_ctnt" type="12" value="" out="N"/>
				<param name="skd_edi_rcv_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
