<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PortTariffMgtBCDBDAOsearchBaseTariff2RSQL">
			<desc><![CDATA[select formula의 tariff조회]]></desc>
			<sql><![CDATA[
SELECT  T22.DP_NO AS SEQ,
T21.CURR_CD currency
,(
SELECT  PSO_OBJ_CD
FROM    PSO_OBJ_LIST
WHERE   OBJ_LIST_NO  = T22.OBJ_LIST_NO
) OBJECT
,T22.OBJ_LIST_NO AS object_code
,T22.OBJ_LIST_NO AS uom
,PSO_TRF_TP_CD AS rate_code
,T23.FM_VAL range_from, T23.TO_VAL  range_to , T23.TRF_RT_AMT rate_value
,T23.COND_NO AS Condition,  T21.FOML_NO AS FORMULA_NO, T22.pso_trf_tp_cd , T23.PORT_TRF_NO, T23.TRF_SEQ
FROM    (
SELECT  T1.CURR_CD, T2.PSO_CHG_TP_CD,T3.CHG_XPR_NO, T3.CHG_XPR_SEQ,T3.FOML_NO
,T4.ROW_NO AS ROW_NO
,MAX(DECODE(FOML_SEQ, 1, OBJ_LIST_NO)) AS OBJ_CD, MAX(DECODE(FOML_SEQ, 2, PSO_FOML_OPR_CD)) AS OPR, MAX(DECODE(FOML_SEQ, 3, OBJ_LIST_NO)) AS RATE
FROM    PSO_YD_CHG T1,  PSO_YD_CHG_XPR T2,  PSO_CHG_XPR_DTL T3, PSO_FOML_DTL T4,
(
select  t2.acct_cd, t2.lgs_cost_cd, lgs_cost_full_nm
from    pso_inv_ofc_cost t1, tes_lgs_cost t2
where   t1.lgs_cost_cd = t2.lgs_cost_cd
and     t1.ofc_cd      = @[ofc_cd]
and     t2.acct_cd          <> '999999'
and length(t2.LGS_COST_CD) > 4
order by 1
)  T5
WHERE   T1.YD_CHG_NO          = T2.YD_CHG_NO
AND     T1.YD_CHG_VER_SEQ   = T2.YD_CHG_VER_SEQ
AND     T1.LGS_COST_CD          = T5.lgs_cost_cd
--            AND     T1.LST_FLG          = 'Y'
#if( ${port_cd} == '' )
			AND     T1.YD_CD            = @[combo1]
#else
			AND     T1.YD_CD            = @[port_cd] || @[combo1]
#end
            AND     T1.VNDR_SEQ         = @[vndr_seq]
#if( ${acct_cd} == '')
            AND     T1.LGS_COST_CD      = @[combo3]
#else
			AND     T5.acct_cd         = @[acct_cd]
#end
 --           AND     SYSDATE BETWEEN T1.EFF_DT AND  T1.EXP_DT 
			AND     T1.YD_CHG_VER_SEQ   = @[combo4]
            --AND     T1.eff_dt = to_date( *from_date ,'YYYY-MM-DD')
            --AND     T1.exp_dt = to_date( *to_date ,'YYYY-MM-DD')           
AND     T2.CHG_XPR_NO       = T3.CHG_XPR_NO
AND     T3.FOML_NO          = T4.FOML_NO
GROUP BY T1.CURR_CD, T2.PSO_CHG_TP_CD,T3.CHG_XPR_NO, T3.CHG_XPR_SEQ,COND_NO, T3.FOML_NO,T4.ROW_NO
) T21, PSO_TARIFF T22, PSO_TRF_DTL T23
WHERE   T21.CHG_XPR_NO      = T22.CHG_XPR_NO
AND     T21.CHG_XPR_SEQ     = T22.CHG_XPR_SEQ
AND     T22.PORT_TRF_NO     = T23.PORT_TRF_NO
order by port_trf_no,trf_seq			]]></sql>
			<params>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="combo1" type="12" value="" out="N"/>
				<param name="port_cd" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
				<param name="combo3" type="12" value="" out="N"/>
				<param name="acct_cd" type="12" value="" out="N"/>
				<param name="combo4" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
