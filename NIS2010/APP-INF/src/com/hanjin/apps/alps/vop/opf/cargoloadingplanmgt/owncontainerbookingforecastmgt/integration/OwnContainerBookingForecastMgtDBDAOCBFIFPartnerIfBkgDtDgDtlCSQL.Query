<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OwnContainerBookingForecastMgtDBDAOCBFIFPartnerIfBkgDtDgDtlCSQL">
			<desc><![CDATA[Partner CLL 의 dg co-load수신]]></desc>
			<sql><![CDATA[
INSERT INTO  OPF_CGO_BKG_FCAST_DG_DTL (
VSL_CD,
SKD_VOY_NO,
SKD_DIR_CD,
YD_CD,
POL_CLPT_IND_SEQ,
CRR_CD,
POD_CD,
BLCK_STWG_CD,
CBF_SMRY_SEQ,
CBF_SMRY_DCGO_SEQ,
CNTR_TPSZ_CD,
IMDG_UN_NO,
IMDG_CLSS_CD,
MRN_POLUT_FLG,
IMDG_LMT_QTY_FLG,
CRE_USR_ID,
CRE_DT,
UPD_USR_ID,
UPD_DT )
SELECT VSL_CD, SKD_VOY_NO, SKD_DIR_CD, YD_CD, POL_CLPT_IND_SEQ, CRR_CD, POD_CD, BLCK_STWG_CD,
       CBF_SPCL_SMRY_SEQ, CBF_SMRY_DCGO_SEQ + ROWNUM , CNTR_TPSZ_CD, IMDG_UN_NO,
       IMDG_CLSS_CD,
       MRN_POLUT_FLG,
       IMDG_LMT_QTY_FLG, @[cre_usr_id],SYSDATE,@[upd_usr_id],SYSDATE
 FROM (
 SELECT Y.VSL_CD, Y.SKD_VOY_NO, Y.SKD_DIR_CD,   Y.YD_CD, Y.POL_CLPT_IND_SEQ, 
       Y.CRR_CD, Y.POD_CD,     Y.BLCK_STWG_CD, Y.CBF_SPCL_SMRY_SEQ, 
       Y.CNTR_TPSZ_CD,         Y.IMDG_UN_NO   ,Y.IMDG_CLSS_CD,
       Y.MRN_POLUT_FLG ,       Y.IMDG_LMT_QTY_FLG, Y.CNTR_NO,
          ( SELECT NVL(MAX(CBF_SMRY_DCGO_SEQ),0) 
                             FROM  OPF_CGO_BKG_FCAST_DG_DTL
                            WHERE  VSL_CD      =  @[vsl_cd]
                              AND  SKD_VOY_NO  =  @[skd_voy_no]
                              AND  SKD_DIR_CD  =  @[skd_dir_cd]
                              AND  YD_CD       =  @[pol_cd]
                              AND  POL_CLPT_IND_SEQ =  @[pol_clpt_ind_seq] ) AS CBF_SMRY_DCGO_SEQ
  FROM (
SELECT DISTINCT B.VSL_CD, B.SKD_VOY_NO, B.SKD_DIR_CD, B.YD_CD, B.POL_CLPT_IND_SEQ,
                B.CRR_CD, A.POD_CD, SUBSTR(A.POD_CD,3,3) BLCK_STWG_CD, 
                B.CBF_SPCL_SMRY_SEQ, 
                A.CNTR_TPSZ_CD, A.IMDG_UN_NO, A.IMDG_CLSS_CD, A.MRN_POLUT_FLG, A.IMDG_LMT_QTY_FLG, A.CNTR_NO
 FROM OPF_PRNR_EDI_CGO_BKG_FCAST A, OPF_CGO_BKG_FCAST_SPCL_SMRY B
WHERE A.VSL_CD           = B.VSL_CD
  AND A.SKD_VOY_NO       = B.SKD_VOY_NO
  AND A.SKD_DIR_CD       = B.SKD_DIR_CD
  AND A.YD_CD            = B.YD_CD
  AND A.POL_CLPT_IND_SEQ = B.POL_CLPT_IND_SEQ
  AND A.CRR_CD           = B.CRR_CD
  AND A.EDI_BL_NO        = B.BKG_NO
  AND A.VSL_CD           = @[vsl_cd]
  AND A.SKD_VOY_NO       = @[skd_voy_no]
  AND A.SKD_DIR_CD       = @[skd_dir_cd]
  AND A.YD_CD            = @[pol_cd]
  AND A.POL_CLPT_IND_SEQ = @[pol_clpt_ind_seq]
  AND A.UPLD_DT         IS NULL
  AND A.DCGO_FLG         = 'Y' ) Y ) 			]]></sql>
			<params>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pol_clpt_ind_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
