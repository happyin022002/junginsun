<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PortTariffMgtBCDBDAOSearchObjByYdChgRSQL">
			<desc><![CDATA[YD_CHG_NO, YD_CHG_VER_SEQ별로 Object를 조회한다.

-----------------------------------------------------------
history
2011.11.23 진마리아 CHM-201114406-01 Tariff Value Management 화면 로직 변경(EDIT_ENBL_FLG 추가)]]></desc>
			<sql><![CDATA[
SELECT Y.OBJ_LIST_NO
      ,Y.OBJ_LIST_NM
      ,NVL2(Z.OBJ_LIST_NO, 'Y', 'N') FLAG
      ,Z.DFLT_VAL REGULAR_VALUE
      ,${yd_chg_no} YD_CHG_NO
      ,${yd_chg_ver_seq} YD_CHG_VER_SEQ
      ,Y.EDIT_ENBL_FLG
FROM   (
        SELECT DISTINCT DECODE(Q.RNUM, 1, P.OBJ_LIST_NO, P.RT_OBJ_LIST_NO) OBJ_LIST_NO
        FROM   (SELECT BB.OBJ_LIST_NO
                      ,BB.RT_OBJ_LIST_NO    
                FROM   (SELECT D.FOML_NO
                              ,D.COND_NO
                        FROM   PSO_YD_CHG      A
                              ,PSO_YD_CHG_XPR  B
                              ,PSO_CHG_XPR     C
                              ,PSO_CHG_XPR_DTL D
                        WHERE  A.YD_CHG_NO = B.YD_CHG_NO
                        AND    A.YD_CHG_VER_SEQ = B.YD_CHG_VER_SEQ
                        AND    C.CHG_XPR_NO = B.CHG_XPR_NO
                        AND    C.CHG_XPR_NO = D.CHG_XPR_NO
                        AND    A.YD_CHG_NO = ${yd_chg_no}
                        AND    A.YD_CHG_VER_SEQ = ${yd_chg_ver_seq}) A
                      ,PSO_FORMULA B
                      ,PSO_FOML_DTL BB
                WHERE  1 = 1
                AND    A.FOML_NO = B.FOML_NO
                AND    B.FOML_NO = BB.FOML_NO
                AND    BB.OBJ_LIST_NO IS NOT NULL
               ) P
              ,(SELECT LEVEL RNUM
                FROM   DUAL
                CONNECT BY LEVEL <= 2
               ) Q  
        WHERE  DECODE(Q.RNUM, 1, P.OBJ_LIST_NO, P.RT_OBJ_LIST_NO) IS NOT NULL    

        UNION
        
        SELECT DECODE(Q.RNUM, 1, P.OBJ_LIST_NO, P.RT_OBJ_LIST_NO) OBJ_LIST_NO
        FROM   (SELECT CC.OBJ_LIST_NO
                      ,CC.RT_OBJ_LIST_NO
                FROM   (SELECT D.FOML_NO
                              ,D.COND_NO
                        FROM   PSO_YD_CHG      A
                              ,PSO_YD_CHG_XPR  B
                              ,PSO_CHG_XPR     C
                              ,PSO_CHG_XPR_DTL D
                        WHERE  A.YD_CHG_NO = B.YD_CHG_NO
                        AND    A.YD_CHG_VER_SEQ = B.YD_CHG_VER_SEQ
                        AND    C.CHG_XPR_NO = B.CHG_XPR_NO
                        AND    C.CHG_XPR_NO = D.CHG_XPR_NO
                        AND    A.YD_CHG_NO = ${yd_chg_no}
                        AND    A.YD_CHG_VER_SEQ = ${yd_chg_ver_seq}) A
                      ,PSO_CONDITION C
                      ,PSO_COND_DTL CC
                WHERE  1 = 1
                AND    A.COND_NO = C.COND_NO
                AND    C.COND_NO = CC.COND_NO
                AND    CC.OBJ_LIST_NO IS NOT NULL
                AND    CC.OBJ_LIST_NO != -1) P
              ,(SELECT LEVEL RNUM FROM DUAL CONNECT BY LEVEL <= 2) Q
        WHERE  DECODE(Q.RNUM, 1, P.OBJ_LIST_NO, P.RT_OBJ_LIST_NO) IS NOT NULL                           
       ) X
      ,PSO_OBJ_LIST Y
      ,PSO_YD_CHG_OBJ_LIST Z
WHERE  1 = 1
AND    X.OBJ_LIST_NO = Y.OBJ_LIST_NO
AND    X.OBJ_LIST_NO = Z.OBJ_LIST_NO(+)
AND    Z.YD_CHG_NO(+) = ${yd_chg_no}
AND    Z.YD_CHG_VER_SEQ(+) = ${yd_chg_ver_seq}
AND    Y.PSO_OBJ_LIST_TP_CD IN ('A', 'M')
ORDER  BY Y.OBJ_LIST_NM			]]></sql>
			<params>
			</params>
		</query>
	</querys>
</sqls>
