<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="VSKCodeFinderDBDAOsearchLaneDirListRSQL">
			<desc><![CDATA[Service Lane 리스트를 조회합니다.

History
2011.03.25 진마리아 CHM-201109579-01 Lane Code의 Direction 조회 칼럼 추가 요청
2011.10.11 진마리아 CHM-201112822-01 Lane Code inquiry내 trade 및 Sub trade, SKD 로 lane Code 정보를 조회 가능하도록 로직 수정]]></desc>
			<sql><![CDATA[
SELECT M.VSL_SLAN_CD,
       M.RLANE_CD,
       M.VSL_SLAN_NM,
       M.VSL_SVC_TP_CD,
       D.TRD_CD,
       D.SUB_TRD_CD,
       M.DIR_CD1,
       M.DIR_CD2
FROM (
        SELECT S.VSL_SLAN_CD,
               R.RLANE_CD,
               S.VSL_SLAN_NM,
               S.VSL_SVC_TP_CD,
               S.DIR_CD1,
               S.DIR_CD2
        FROM (
               SELECT
               	VSL_SLAN_CD,
               	VSL_SLAN_NM,
               	VSL_SVC_TP_CD,
                   MAX(DECODE (SEQ,'1',VSL_SLAN_DIR_CD,'')) DIR_CD1,
                   MAX(DECODE (SEQ,'2',VSL_SLAN_DIR_CD,'')) DIR_CD2
               FROM (
                   SELECT 
                   	M.VSL_SLAN_CD,
                   	M.VSL_SLAN_NM,
                   	M.VSL_SVC_TP_CD,
                   	D.VSL_SLAN_DIR_CD,
                   	D.VSL_SLAN_DIR_SEQ,
                   	ROW_NUMBER()  OVER(PARTITION BY D.VSL_SLAN_CD ORDER BY D.VSL_SLAN_DIR_SEQ) SEQ
                   FROM MDM_VSL_SVC_LANE M, MDM_VSL_SVC_LANE_DIR D
                   WHERE 1 = 1
                   AND M.VSL_SLAN_CD = D.VSL_SLAN_CD(+)
                  #if (${vsl_slan_cd} != '') 
                   AND M.VSL_SLAN_CD LIKE UPPER(@[vsl_slan_cd]) ||'%'
                  #end
                  #if (${vsl_slan_nm} != '') 
                   AND UPPER(M.VSL_SLAN_NM) LIKE '%' || UPPER(@[vsl_slan_nm]) || '%'
                  #end
                  #if (${fdr_div_cd} == 'TRUNK')
                   AND M.FDR_DIV_CD != 'O'
                  #elseif (${fdr_div_cd} != '')
                   AND M.FDR_DIV_CD = DECODE(@[fdr_div_cd], 'A', FDR_DIV_CD, @[fdr_div_cd])
                  #end
                  #if (${vsl_svc_tp_cd} != '')
                   AND M.VSL_SVC_TP_CD = @[vsl_svc_tp_cd]
                  #end
                  #if (${fm_dt} != '' && ${to_dt} != '')
                   AND M.VSL_SLAN_CD IN (
                                          SELECT T2.SLAN_CD
                                          FROM (
                                                 SELECT VSL_CD,
                                                        SKD_VOY_NO,
                                                        SKD_DIR_CD,
                                                        MIN(VPS_ETA_DT) MIN_DT,
                                                        MAX(VPS_ETD_DT) MAX_DT
                                                 FROM VSK_VSL_PORT_SKD
                                                 WHERE 1=1
                                                 AND NVL(SKD_CNG_STS_CD, 'X')<>'S'
                                                 GROUP BY VSL_CD, SKD_VOY_NO, SKD_DIR_CD
                                               ) T1, VSK_VSL_PORT_SKD T2
                                          WHERE 1=1
                                          AND (TO_DATE(@[fm_dt], 'YYYYMMDD') BETWEEN T1.MIN_DT AND T1.MAX_DT+0.99999 OR
                                               TO_DATE(@[to_dt], 'YYYYMMDD') BETWEEN T1.MIN_DT AND T1.MAX_DT+0.99999)
                                          AND T1.VSL_CD=T2.VSL_CD
                                          AND T1.SKD_VOY_NO=T2.SKD_VOY_NO
                                          AND T1.SKD_DIR_CD=T2.SKD_DIR_CD
                                        )
                  #end
                   AND M.VSL_TP_CD = 'C' /*컨테이너선*/
                   AND M.DELT_FLG = 'N'
                   AND D.DELT_FLG(+) = 'N'
                    )
               GROUP BY	VSL_SLAN_CD,
                       	VSL_SLAN_NM,
                       	VSL_SVC_TP_CD
               ORDER BY VSL_SLAN_CD
             ) S, MDM_REV_LANE R
        WHERE S.VSL_SLAN_CD = R.VSL_SLAN_CD(+)
        AND R.DELT_FLG(+) = 'N'
     ) M, MDM_DTL_REV_LANE D
WHERE M.RLANE_CD = D.RLANE_CD(+)
AND D.DELT_FLG(+) = 'N'
AND NVL(D.SUB_TRD_CD,'X')<>'IP'
#if (${trd_cd} != '') 
 AND D.TRD_CD = @[trd_cd]
#end
#if (${sub_trd_cd} != '') 
 AND D.SUB_TRD_CD = @[sub_trd_cd]
#end
GROUP BY M.VSL_SLAN_CD,
       M.RLANE_CD,
       M.VSL_SLAN_NM,
       M.VSL_SVC_TP_CD,
       D.TRD_CD,
       D.SUB_TRD_CD,
       M.DIR_CD1,
       M.DIR_CD2
ORDER BY M.VSL_SLAN_CD, M.RLANE_CD, D.TRD_CD, D.SUB_TRD_CD			]]></sql>
			<params>
				<param name="vsl_slan_cd" type="12" value="" out="N"/>
				<param name="vsl_slan_nm" type="12" value="" out="N"/>
				<param name="fdr_div_cd" type="12" value="" out="N"/>
				<param name="vsl_svc_tp_cd" type="12" value="" out="N"/>
				<param name="fm_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="sub_trd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
