<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralInvoiceAuditDBDaoDAOgetLoadedTeuLastPortRSQL">
			<desc><![CDATA[해당 VVD, Port의 이전 Port에서 선적된 CNTR TEU를 구한다.
=====================================================================
2011.03.28 진마리아 [선처리(SRM-201114694)] 사업계획 항비 로직 수정 요청]]></desc>
			<sql><![CDATA[
SELECT SUM(DECODE(H.CNTR_SIZE, '2', 1, 2) * H.QTY) TEU
FROM (SELECT PRE.VSL_CD, PRE.SKD_VOY_NO, PRE.SKD_DIR_CD, PRE.VPS_PORT_CD, PRE.CLPT_IND_SEQ, TG.VPS_PORT_CD NEXT_PORT
        FROM VSK_VSL_PORT_SKD PRE, VSK_VSL_PORT_SKD TG
       WHERE TG.VSL_CD       = SUBSTR(@[vvd], 1, 4)     --:vsl_cd
		 AND TG.SKD_VOY_NO   = SUBSTR(@[vvd], 5, 4)     --:skd_voy_no
		 AND TG.SKD_DIR_CD   = SUBSTR(@[vvd], 9, 1)        --:skd_dir_cd
		 AND TG.YD_CD        = @[yd_cd]  --:port_cd
		 AND PRE.VSL_CD = TG.VSL_CD
         AND PRE.SKD_VOY_NO = TG.SKD_VOY_NO
         AND PRE.SKD_DIR_CD = TG.SKD_DIR_CD
         AND PRE.CLPT_SEQ = TG.CLPT_SEQ - 1
     ) V, (SELECT VSL_CD, VOY_NO, DIR_CD, PORT_CD, CALL_IND, CNTR_SIZE, COUNT(*) QTY
            FROM BAY_PLAN
           WHERE FE = 'F'	-- Full CNTR만 대상으로 한다.
			 AND VSL_CD   = SUBSTR(@[vvd], 1, 4)     --:vsl_cd
		 	 AND VOY_NO   = SUBSTR(@[vvd], 5, 4)     --:skd_voy_no
		 	 AND DIR_CD   = SUBSTR(@[vvd], 9, 1)        --:skd_dir_cd
           GROUP BY VSL_CD, VOY_NO, DIR_CD, PORT_CD, CALL_IND, CNTR_SIZE) H
WHERE  V.VSL_CD       = H.VSL_CD
AND    V.SKD_VOY_NO   = H.VOY_NO
AND    V.SKD_DIR_CD   = H.DIR_CD
AND    V.VPS_PORT_CD  = H.PORT_CD
AND    V.CLPT_IND_SEQ = H.CALL_IND			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
