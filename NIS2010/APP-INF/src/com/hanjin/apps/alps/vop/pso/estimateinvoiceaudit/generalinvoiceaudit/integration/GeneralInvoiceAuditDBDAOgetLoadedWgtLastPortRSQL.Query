<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralInvoiceAuditDBDAOgetLoadedWgtLastPortRSQL">
			<desc><![CDATA[LAST PORT에서 ON-DECK LOADED WEIGHT 구하기 ( TIER 를 70이상으로 함)]]></desc>
			<sql><![CDATA[
WITH PRE_SKD AS (		
         SELECT  * 					
           FROM ( SELECT *					
                    #if (${budget_flag} == 'B') 
                     FROM VSK_BUD_VSL_PORT_SKD
                    #else 						
                     FROM VSK_VSL_PORT_SKD 
                    #end 					
                   WHERE  VPS_ETA_DT <	 ( SELECT MAX(VPS_ETA_DT) 				
                                            #if (${budget_flag} == 'B') 
                                             FROM VSK_BUD_VSL_PORT_SKD
                                            #else 						
                                             FROM VSK_VSL_PORT_SKD 
                                            #end 					
                                            WHERE VSL_CD     = SUBSTR(@[vvd], 1,4) 								
                                              AND SKD_VOY_NO = SUBSTR(@[vvd], 5,4) 				
                                              AND SKD_DIR_CD = SUBSTR(@[vvd], 9,1) 					
                                              AND YD_CD      = @[yd_cd] )					
                 AND TURN_PORT_IND_CD IN ('N','Y')					
                 AND VSL_CD  = SUBSTR(@[vvd], 1,4) 		
                 AND NVL(SKD_CNG_STS_CD,'X') <> 'S'			
                ORDER BY VPS_ETA_DT DESC					
                )					
          WHERE  ROWNUM =1	)				
      SELECT SUM(A.WEIGHT)					
        FROM BAY_PLAN	A, PRE_SKD B				
       WHERE A.VSL_CD    = B.VSL_CD					
		 AND A.VOY_NO    = B.SKD_VOY_NO			
		 AND A.DIR_CD    = B.SKD_DIR_CD			
		 AND A.PLAN_TYPE = 'F'			
         AND A.PORT_CD   = B.VPS_PORT_CD					
         AND A.CALL_IND  = B.CLPT_IND_SEQ					
         AND A.TIER      >= 70			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
