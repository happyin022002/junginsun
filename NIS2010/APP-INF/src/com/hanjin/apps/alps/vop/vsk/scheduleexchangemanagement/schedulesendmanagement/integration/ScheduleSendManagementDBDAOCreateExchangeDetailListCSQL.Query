<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ScheduleSendManagementDBDAOCreateExchangeDetailListCSQL">
			<desc><![CDATA[EDI Exchange Detail 데이터 생성]]></desc>
			<sql><![CDATA[
INSERT INTO  VSK_VSL_SKD_XCH_EDI_DTL   D
      (    D.SND_RCV_KND_CD
        ,  D.SKD_EDI_RCV_DT
        ,  D.SKD_EDI_RCV_SEQ
        ,  D.EDI_XCH_LOG_SEQ

        ,  D.VSL_CD_CTNT
        ,  D.SKD_VOY_NO_CTNT
        ,  D.SKD_DIR_CD_CTNT        
        ,  D.VPS_PORT_CD_CTNT

		-- ::2014-04-20:: --
		,  D.ALLN_PORT_CD_CTNT

        ,  D.VPS_PORT_NM
        ,  D.YD_CD_CTNT
        ,  D.CLPT_IND_SEQ_CTNT
        ,  D.CLPT_SEQ_CTNT
        ,  D.LOC_IND_CD_CTNT
        ,  D.CALL_YD_IND_SEQ_CTNT
        ,  D.VPS_ETA_DT_CTNT
        ,  D.VPS_ETB_DT_CTNT
        ,  D.VPS_ETD_DT_CTNT
        ,  D.ACT_ARR_DT_CTNT
        ,  D.ACT_BRTH_DT_CTNT
        ,  D.ACT_DEP_DT_CTNT
        ,  D.TURN_PORT_FLG_CTNT
        ,  D.TURN_PORT_IND_CD_CTNT
        ,  D.TURN_SKD_VOY_NO_CTNT
        ,  D.TURN_SKD_DIR_CD_CTNT
        ,  D.TURN_CLPT_IND_SEQ_CTNT
        ,  D.CRE_USR_ID
        ,  D.CRE_DT
        ,  D.UPD_USR_ID
        ,  D.UPD_DT

      )
SELECT    
           'S'  							/*  SND_RCV_KND_CD        */
        ,  TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD'),'YYYYMMDD')    	/*  SKD_EDI_RCV_DT              */
        ,  @[skd_edi_rcv_seq]             	/*  SKD_EDI_RCV_SEQ             */
        ,  edi_xch_log_seq.nextval        	/*  EDI_XCH_LOG_SEQ             */

        ,  PS.VSL_CD                     	/*  VSL_CD_CTNT                 */
        ,  PS.SKD_VOY_NO                 	/*  SKD_VOY_NO_CTNT             */
        ,  PS.SKD_DIR_CD                 	/*  SKD_DIR_CD_CTNT             */        
        ,  PS.VPS_PORT_CD                 	/*  VPS_PORT_CD_CTNT            */
		
		--	::2014-04-20:: --
		,	CASE	WHEN (SELECT C.ALLN_PORT_CD FROM VSK_VSL_CONV_PORT C WHERE C.ALLN_CO_CD = @[co_cd_ctnt] AND C.HJS_PORT_CD = PS.VPS_PORT_CD) IS NULL THEN PS.VPS_PORT_CD
				 	ELSE (SELECT C.ALLN_PORT_CD FROM VSK_VSL_CONV_PORT C WHERE C.ALLN_CO_CD = @[co_cd_ctnt] AND C.HJS_PORT_CD = PS.VPS_PORT_CD)
			END								/*  ALLN_PORT_CD_CTNT			*/	

        ,  ML.LOC_NM                      	/*  VPS_PORT_NM                 */
        ,  PS.YD_CD                       	/*  YD_CD_CTNT                  */
        ,  PS.CLPT_IND_SEQ                	/*  CLPT_IND_SEQ_CTNT           */
		   -- LOC_IND ==> 9:Port of Loading, 153:Port of Call (CLPT_SEQ:1), 11:Port of Discharge --
        ,  '1'                    			/*  CLPT_SEQ_CTNT               */
        ,  '153'  							/*  LOC_IND_CD_CTNT             */

        ,  PS.CALL_YD_IND_SEQ             	/*  CALL_YD_IND_SEQ_CTNT        */
        ,  TO_CHAR(PS.VPS_ETA_DT ,'YYYYMMDDHH24MI')  /*  VPS_ETA_DT_CTNT             */
        ,  TO_CHAR(PS.VPS_ETB_DT ,'YYYYMMDDHH24MI')  /*  VPS_ETB_DT_CTNT             */
        ,  TO_CHAR(PS.VPS_ETD_DT ,'YYYYMMDDHH24MI')  /*  VPS_ETD_DT_CTNT             */
        ,  TO_CHAR(AK.ACT_ARR_DT ,'YYYYMMDDHH24MI')  /*  ACT_ARR_DT_CTNT             */
        ,  TO_CHAR(AK.ACT_BRTH_DT,'YYYYMMDDHH24MI')  /*  ACT_BRTH_DT_CTNT            */
        ,  TO_CHAR(AK.ACT_DEP_DT ,'YYYYMMDDHH24MI')  /*  ACT_DEP_DT_CTNT             */
        ,  PS.TURN_PORT_FLG              	/*  TURN_PORT_FLG_CTNT          */
        ,  PS.TURN_PORT_IND_CD           	/*  TURN_PORT_IND_CD_CTNT       */
        ,  PS.TURN_SKD_VOY_NO            	/*  TURN_SKD_VOY_NO_CTNT        */
        ,  PS.TURN_SKD_DIR_CD            	/*  TURN_SKD_DIR_CD_CTNT        */
        ,  PS.TURN_CLPT_IND_SEQ          	/*  TURN_CLPT_IND_SEQ_CTNT      */
        ,  @[cre_usr_id]                 	/*  CRE_USR_ID                  */
        ,  SYSDATE                       	/*  CRE_DT                      */
        ,  @[upd_usr_id]                 	/*  UPD_USR_ID                  */
        ,  SYSDATE                       	/*  UPD_DT                      */

FROM       VSK_VSL_PORT_SKD                    PS
        ,  MDM_VSL_CNTR                        VC
        ,  MDM_LOCATION                        ML
        ,  VSK_ACT_PORT_SKD                    AK
WHERE      1 = 1
AND        PS.VSL_CD                           = VC.VSL_CD
AND        PS.VPS_PORT_CD                      = ML.LOC_CD
AND        PS.VSL_CD                           = AK.VSL_CD           (+)
AND        PS.SKD_VOY_NO                       = AK.SKD_VOY_NO       (+)
AND        PS.SKD_DIR_CD                       = AK.SKD_DIR_CD       (+)
AND        PS.VPS_PORT_CD                      = AK.VPS_PORT_CD      (+)
AND        PS.CLPT_IND_SEQ                     = AK.CLPT_IND_SEQ     (+)
AND        PS.VSL_CD                           = @[vsl_cd_ctnt]
AND        PS.SKD_VOY_NO                       = @[skd_voy_no_ctnt]
AND        PS.SKD_DIR_CD                       = @[skd_dir_cd_ctnt]			]]></sql>
			<params>
				<param name="skd_edi_rcv_seq" type="12" value="" out="N"/>
				<param name="co_cd_ctnt" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="vsl_cd_ctnt" type="12" value="" out="N"/>
				<param name="skd_voy_no_ctnt" type="12" value="" out="N"/>
				<param name="skd_dir_cd_ctnt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
