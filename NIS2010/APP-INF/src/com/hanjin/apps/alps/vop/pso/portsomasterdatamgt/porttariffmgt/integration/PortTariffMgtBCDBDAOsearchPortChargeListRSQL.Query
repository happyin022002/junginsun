<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PortTariffMgtBCDBDAOsearchPortChargeListRSQL">
			<desc><![CDATA[searchPortChargeList
CHM-201327648 : Surcharge, dicount  포함 account code 붉은색으로 표시
- Port tariff Inquiry(VOP_PSO_0036) 화면 가장 왼쪽 sheet에  Surcharge, dicount 포함하는 
  sd_rw_cnt 추가 
]]></desc>
			<sql><![CDATA[
SELECT  
        YD_CD,
        ACCT_CD,
        LGS_COST_CD,
        CURR_CD,
        VNDR_SEQ,
        VNDR_ABBR_NM,
        YD_CHG_VER_SEQ,
        UPD_MNU_NO,
        PSO_CHG_TP_CD,
        SD_RW_CNT,
        YEAR,
        PORT_CD,
        EFF_DT

FROM    (

        SELECT   C1.YD_CD,
                   T.ACCT_CD,
                   C1.LGS_COST_CD,
                   C1.CURR_CD,
                   C1.VNDR_SEQ,
                   --V.VNDR_ABBR_NM,
                   V.VNDR_LGL_ENG_NM VNDR_ABBR_NM,
                   --C1.YD_CHG_NO,
                   MAX (C1.YD_CHG_VER_SEQ) YD_CHG_VER_SEQ,
                   C3.UPD_MNU_NO,
                   C2.PSO_CHG_TP_CD   PSO_CHG_TP_CD,
                   COUNT(T.ACCT_CD) OVER (PARTITION BY C1.YD_CD,T.ACCT_CD,C1.VNDR_SEQ  ORDER BY C1.YD_CD,T.ACCT_CD,C1.VNDR_SEQ ) AS SD_RW_CNT,
                   '' YEAR,
                   '' PORT_CD
                  ,'' EFF_DT
            FROM   PSO_YD_CHG C1,
                   PSO_YD_CHG_XPR C2,
                   PSO_CHG_XPR C3,
                   TES_LGS_COST T,
                   MDM_VENDOR V
           WHERE       C1.YD_CHG_NO = C2.YD_CHG_NO
                   AND C1.YD_CHG_VER_SEQ = C2.YD_CHG_VER_SEQ
                   AND C2.CHG_XPR_NO = C3.CHG_XPR_NO
                  --AND C2.PSO_CHG_TP_CD = 'B'
                   AND T.LGS_COST_CD = C1.LGS_COST_CD
                   AND C1.VNDR_SEQ = V.VNDR_SEQ
                   --AND TO_CHAR (eff_dt, 'YYYY') = *year
                   AND    EFF_DT <= TO_DATE(@[year] || '1231', 'YYYYMMDD')
                   AND    EXP_DT >= TO_DATE(@[year] || '0101', 'YYYYMMDD')

        #if( ${port_cd}!='')           
        AND SUBSTR (C1.YD_CD, 1, 5) = @[port_cd]
        #end

        #if( ${yd_cd}!='')
                   AND SUBSTR (C1.YD_CD, 6) IN (#foreach( $key IN ${arr_yd_cd}) 
                                                    #if($velocityCount < $arr_yd_cd.size())
                                                        '$key',
                                                    #else
                                                        '$key'
                                                    #end
                                                #end)
        #end
        #if( ${acct_cd}!='' && ${acct_cd}!='All')  
                   AND T.ACCT_CD IN (#foreach( $key IN ${arr_acct_cd}) 
                                                    #if($velocityCount < $arr_acct_cd.size())
                                                        '$key',
                                                    #else
                                                        '$key'
                                                    #end
                                                 #end)
        #end            
        GROUP BY   C1.YD_CD,
                   T.ACCT_CD,
                   C1.LGS_COST_CD,
                   C3.UPD_MNU_NO,
                   --C1.YD_CHG_NO,
                   C1.VNDR_SEQ,
                   V.VNDR_LGL_ENG_NM,
                   C1.CURR_CD,
                   C2.PSO_CHG_TP_CD
        ORDER  BY ACCT_CD
                 ,LGS_COST_CD
                 ,C1.YD_CD
                 ,V.VNDR_LGL_ENG_NM
       ) A
    WHERE  1=1
    AND A.PSO_CHG_TP_CD = 'B'
    ORDER  BY ACCT_CD ,LGS_COST_CD ,YD_CD,VNDR_ABBR_NM			]]></sql>
			<params>
				<param name="year" type="12" value="" out="N"/>
				<param name="port_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
