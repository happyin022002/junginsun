<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PortTimePerformanceMgtDBDAOSearchPortTimeKPIListRSQL">
			<desc><![CDATA[해당 KPI 정보를 조회 한다.
History------------------------------------------------------------------------------------
2012.02.20 김민아 [CHM-201215901-01] Port Time Reduction project 개발 (2차)
2012.03.19 김민아 [CHM-201216890-01] Port Time Reduction project (2차) 수정사항 (Direction, 2nd Call추가)
2012.07.09 문동선 [CHM-201218855-01] Base line 입력화면 추가
2015.08.17 김기원 CHM-201537021  조직코드 변경
2016.04.28 Arie Im CHM-201641178 아프리카 대륙 구주지역본부/동서남아지역본부 구분 로직 추가]]></desc>
			<sql><![CDATA[
#if(${tab_chk}=='KPI'||${tab_chk}=='')
	SELECT  KPI_TGT_YR        
	      , SLAN_CD           
	      , VPS_PORT_CD       
	      , KPI_VER_SEQ       
	      , (SELECT  CASE WHEN NVL(ML.DELT_FLG,'N') <> 'N' OR ML.CALL_PORT_FLG <> 'Y' THEN ''
	                      ELSE (SELECT O.OFC_N3RD_LVL_CD FROM MAS_OFC_LVL O WHERE O.OFC_CD = ML.EQ_CTRL_OFC_CD AND O.OFC_APLY_TO_YRMON ='999912' AND O.OFC_LVL < 9)
--	                           CASE WHEN ML.CONTI_CD  IN ('E','F') AND ML.LOC_CD NOT IN('EGAIS','ZADUR','RUVVO')               THEN 'HAMRU'
--	                                WHEN ML.CONTI_CD  = 'M'                                                                    THEN 'NYCRA'
--                                    WHEN ML.CONTI_CD = 'A' AND ML.SCONTI_CD = 'AF' THEN  DECODE(ML.CNT_CD,'KR','SELIB','JP','TYOIB','SHARC')
--	                                WHEN (ML.CONTI_CD = 'A'        AND ML.SCONTI_CD <> 'AF') OR ML.LOC_CD IN ('EGAIS','ZADUR') THEN 'SINRS'
--									WHEN ML.CONTI_CD  IN ('E') AND ML.LOC_CD = 'RUVVO' THEN 'VVOIA'
--	                                ELSE ''
--	                           END      
	                 END           
	           FROM  MDM_LOCATION  ML
	          WHERE  ML.LOC_CD = VPS_PORT_CD
	        ) AS RHQ_CD
	      , TO_CHAR(FM_EFF_DT, 'YYYY-MM-DD') AS FM_EFF_DT        --05
	      , TO_CHAR(TO_EFF_DT, 'YYYY-MM-DD') AS TO_EFF_DT        
	      , TO_CHAR(FM_EFF_DT, 'YYYY')       AS FM_EFF_DT_YY
	      , TO_CHAR(FM_EFF_DT, 'MM-DD')      AS FM_EFF_DT_MD
	      , TO_CHAR(TO_EFF_DT, 'YYYY')       AS TO_EFF_DT_YY
	      , TO_CHAR(TO_EFF_DT, 'MM-DD')      AS TO_EFF_DT_MD
	      , DECODE(PORT_KPI_DIR_CD, 'A', '', PORT_KPI_DIR_CD) AS PORT_KPI_DIR_CD
	      , DECODE(CLPT_IND_SEQ, 2, 1, 0) AS CLPT_IND_SEQ_VIEW
	      , CLPT_IND_SEQ
	      , TTL_CNTR_MV_KNT   
	      , STM_IN_HRS        
	      , VSL_ARR_HRS       
	      , TML_OP_HRS         --10
	      , VSL_DEP_HRS       
	      , STM_OUT_HRS       
	      , PORT_STAY_HRS     
	      , GRS_TML_PROD_HRS  
	      , GRS_CRN_PROD_HRS   --15
	      , NET_CRN_PROD_HRS  
	      , TWN_LFT_HRS       
	      , DUL_CYC_HRS       
	      , RSTWG_HRS         
	      , CRE_USR_ID
	      , UPD_USR_ID
	      , '' AS CHK_VAL

	FROM    OPF_PORT_TM_KPI
	WHERE   1=1
	AND     KPI_TGT_YR        = @[kpi_tgt_yr]
	AND     KPI_VER_SEQ       = @[kpi_ver_seq]

	#if(${slan_cd} != '')
	AND     SLAN_CD           = @[slan_cd]        -- Service Lane Code 입력시에만 수행
	#end
	#if(${vps_port_cd} != '')
	AND     VPS_PORT_CD       = @[vps_port_cd]    -- Port Code 입력시에만 수행
	#end
	#if(${rhq_cd} != '')
	AND     VPS_PORT_CD       IN                  -- RHQ Code 입력시에만 수행
	        (
            SELECT  L.LOC_CD  
            FROM    MDM_LOCATION L, MAS_OFC_LVL O
            WHERE   L.EQ_CTRL_OFC_CD = O.OFC_CD
            AND     L.CALL_PORT_FLG = 'Y'
            AND     L.DELT_FLG      = 'N'
            AND     O.OFC_APLY_TO_YRMON ='999912'
            AND     O.OFC_LVL < 9
--	        AND     CASE WHEN CONTI_CD  IN ('E','F') AND LOC_CD NOT IN ('EGAIS','ZADUR','RUVVO')           THEN 'HAMRU'
--	                     WHEN CONTI_CD  = 'M'                                                              THEN 'NYCRA'
--                         WHEN CONTI_CD = 'A' AND SCONTI_CD = 'AF' THEN  DECODE(CNT_CD,'KR','SELIB','JP','TYOIB','SHARC')
--	                     WHEN (CONTI_CD = 'A'        AND SCONTI_CD <> 'AF') OR LOC_CD IN ('EGAIS','ZADUR') THEN 'SINRS'
--					     WHEN CONTI_CD  IN ('E') AND LOC_CD = 'RUVVO' THEN 'VVOIA'
--	                     ELSE ''
--	                END
            AND     O.OFC_N3RD_LVL_CD= @[rhq_cd]
	        )
	#end
#end
#if(${tab_chk}=='BSEL')
	SELECT  BSEL_YR      	AS KPI_TGT_YR  
	      , SLAN_CD           
          , VPS_PORT_CD       
          , BSEL_VER_SEQ    AS KPI_VER_SEQ   
          , (SELECT  CASE WHEN NVL(ML.DELT_FLG,'N') <> 'N' OR ML.CALL_PORT_FLG <> 'Y' THEN ''
                        ELSE (SELECT O.OFC_N3RD_LVL_CD FROM MAS_OFC_LVL O WHERE O.OFC_CD = ML.EQ_CTRL_OFC_CD AND O.OFC_APLY_TO_YRMON ='999912' AND O.OFC_LVL < 9)
--                             CASE WHEN ML.CONTI_CD  IN ('E','F') AND ML.LOC_CD NOT IN('EGAIS','ZADUR','RUVVO')               THEN 'HAMRU'
--                                  WHEN ML.CONTI_CD  = 'M'                                                                    THEN 'NYCRA'
--                                  WHEN ML.CONTI_CD = 'A' AND ML.SCONTI_CD = 'AF' THEN  DECODE(ML.CNT_CD,'KR','SELIB','JP','TYOIB','SHARC')
--                                  WHEN (ML.CONTI_CD = 'A'        AND ML.SCONTI_CD <> 'AF') OR ML.LOC_CD IN ('EGAIS','ZADUR') THEN 'SINRS'
--								  WHEN ML.CONTI_CD  IN ('E') AND ML.LOC_CD = 'RUVVO' THEN 'VVOIA'
--                                  ELSE ''
--                             END       
                   END           
             FROM  MDM_LOCATION  ML
            WHERE  ML.LOC_CD = VPS_PORT_CD
          ) AS RHQ_CD
          , TO_CHAR(FM_EFF_DT, 'YYYY-MM-DD') AS FM_EFF_DT        --05
          , TO_CHAR(TO_EFF_DT, 'YYYY-MM-DD') AS TO_EFF_DT        
          , TO_CHAR(FM_EFF_DT, 'YYYY')       AS FM_EFF_DT_YY
          , TO_CHAR(FM_EFF_DT, 'MM-DD')      AS FM_EFF_DT_MD
          , TO_CHAR(TO_EFF_DT, 'YYYY')       AS TO_EFF_DT_YY
          , TO_CHAR(TO_EFF_DT, 'MM-DD')      AS TO_EFF_DT_MD
          , DECODE(PORT_BSEL_DIR_CD, 'A', '', PORT_BSEL_DIR_CD) AS PORT_KPI_DIR_CD
          , DECODE(CLPT_IND_SEQ, 2, 1, 0) AS CLPT_IND_SEQ_VIEW
          , CLPT_IND_SEQ
          , TTL_CNTR_MV_KNT   
          , STM_IN_HRS        
          , VSL_ARR_HRS       
          , TML_OP_HRS         --10
          , VSL_DEP_HRS       
          , STM_OUT_HRS       
          , PORT_STAY_HRS     
          , GRS_TML_PROD_HRS  
          , GRS_CRN_PROD_HRS   --15
          , NET_CRN_PROD_HRS  
          , TWN_LFT_HRS       
          , DUL_CYC_HRS       
          , RSTWG_HRS         
          , CRE_USR_ID
          , UPD_USR_ID
          , '' AS CHK_VAL
    FROM    OPF_PORT_TM_BSEL
    WHERE   1=1
    AND     BSEL_YR           =  @[kpi_tgt_yr]
	AND     BSEL_VER_SEQ       = '1'			   -- Baseline has only 1
    #if(${slan_cd} != '')
    AND     SLAN_CD           =  @[slan_cd]        -- Service Lane Code 입력시에만 수행
    #end
    #if(${vps_port_cd} != '')
    AND     VPS_PORT_CD       =  @[vps_port_cd]    -- Port Code 입력시에만 수행
    #end
    #if(${rhq_cd} != '')
    AND     VPS_PORT_CD       IN                  -- RHQ Code 입력시에만 수행
            (
            SELECT  L.LOC_CD  
            FROM    MDM_LOCATION L, MAS_OFC_LVL O
            WHERE   L.EQ_CTRL_OFC_CD = O.OFC_CD
            AND     L.CALL_PORT_FLG = 'Y'
            AND     L.DELT_FLG      = 'N'
            AND     O.OFC_APLY_TO_YRMON ='999912'
            AND     O.OFC_LVL < 9   
--            AND     CASE WHEN CONTI_CD  IN ('E','F') AND LOC_CD NOT IN ('EGAIS','ZADUR','RUVVO')           THEN 'HAMRU'
--                         WHEN CONTI_CD  = 'M'                                                              THEN 'NYCRA'
--                         WHEN CONTI_CD = 'A' AND SCONTI_CD = 'AF' THEN  DECODE(CNT_CD,'KR','SELIB','JP','TYOIB','SHARC')
--                         WHEN (CONTI_CD = 'A'        AND SCONTI_CD <> 'AF') OR LOC_CD IN ('EGAIS','ZADUR') THEN 'SINRS'
--		 				 WHEN CONTI_CD  IN ('E') AND LOC_CD = 'RUVVO' THEN 'VVOIA'
--                         ELSE ''
--                    END
            AND     O.OFC_N3RD_LVL_CD= @[rhq_cd]
            )
    #end
#end			]]></sql>
			<params>
				<param name="kpi_tgt_yr" type="12" value="" out="N"/>
				<param name="kpi_ver_seq" type="12" value="" out="N"/>
				<param name="slan_cd" type="12" value="" out="N"/>
				<param name="vps_port_cd" type="12" value="" out="N"/>
				<param name="rhq_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
