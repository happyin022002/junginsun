<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OwnContainerBookingForecastMgtDBDAOCBFIFSummaryDiffListRSQL">
			<desc><![CDATA[CLL 과 BKG 정보의 DIFF LIST]]></desc>
			<sql><![CDATA[
SELECT SEQ, MIN(CNTR_NO) AS CNTR_NO ,            MIN(BKG_NO) AS BKG_NO,  
            MIN(POD_CD) AS POD_CD,               MIN(BLCK_STWG_CD) AS BLCK_STWG_CD,
            MIN(CNTR_TPSZ_CD) AS CNTR_TPSZ_CD , 
            MIN(MTY_BKG_CD) AS MTY_BKG_CD,       MIN(DG_FLG) AS DG_FLG, 
            MIN(AWK_FLG) AS AWK_FLG,             MIN(BB_FLG) AS BB_FLG, 
            MIN(BN_FLG) AS BN_FLG,               MIN(CNTR_NO2) AS CNTR_NO2, 
            MIN(BKG_NO2) AS BKG_NO2,             MIN(POD_CD2) AS POD_CD2, 
            MIN(BLCK_STWG_CD2) AS BLCK_STWG_CD2,
            MIN(CNTR_TPSZ_CD2) AS CNTR_TPSZ_CD2, MIN(MTY_BKG_CD2) AS MTY_BKG_CD2,
            MIN(DG_FLG2) AS DG_FLG2,             MIN(AWK_FLG2) AS AWK_FLG2, 
            MIN(BB_FLG2) AS BB_FLG2,             MIN(BN_FLG2) AS BN_FLG2
 FROM (
       SELECT ROWNUM AS SEQ,B.CNTR_NO, B.BKG_NO, B.POD_CD, OPF_BLCK_STWG_CD(@[vvd],@[yd_cd],@[pol_clpt_ind_seq],B.BKG_NO) BLCK_STWG_CD,
              B.CNTR_TPSZ_CD,  B.MTY_BKG_CD,
              CASE WHEN  ( SELECT COUNT(1)
                             FROM BKG_DG_CGO
                            WHERE BKG_NO  = B.BKG_NO
                              AND CNTR_NO = B.CNTR_NO ) = 0 THEN NULL 
                   ELSE 'Y'  END AS DG_FLG,
              CASE WHEN  ( SELECT COUNT(1)
                             FROM BKG_AWK_CGO
                            WHERE BKG_NO  = B.BKG_NO
                              AND CNTR_NO = B.CNTR_NO ) = 0 THEN NULL
                   ELSE 'Y' END AS AWK_FLG,
              CASE WHEN  ( SELECT COUNT(1)
                             FROM BKG_QTY_DTL
                            WHERE BKG_NO     = B.BKG_NO
                              AND BB_CGO_FLG = 'Y') = 0 THEN NULL
                   ELSE 'Y' END AS BB_FLG  ,
              CASE WHEN  ( SELECT COUNT(1)
                             FROM BKG_CONTAINER
                            WHERE BKG_NO      = B.BKG_NO
                              AND BDL_BTM_FLG ='Y' ) = 0 THEN NULL
              ELSE 'Y'  END AS BN_FLG ,
              NULL AS CNTR_NO2,     NULL AS BKG_NO2, NULL AS POD_CD2,  NULL AS BLCK_STWG_CD2,
              NULL AS CNTR_TPSZ_CD2,NULL AS MTY_BKG_CD2, NULL AS DG_FLG2, NULL AS AWK_FLG2, 
              NULL AS BB_FLG2,      NULL AS BN_FLG2     
       FROM (
               SELECT DISTINCT CNTR_NO  
                 FROM BKG_CSTMS_TML_KR_CLL
                WHERE VSL_CD                          = substr(@[vvd],1,4)
                  AND SKD_VOY_NO                      = substr(@[vvd],5,4)
                  AND SKD_DIR_CD                      = substr(@[vvd],9,1)
                  AND POL_CD                          = substr(@[yd_cd],1,5)
                  AND POL_YD_CD                       = substr(@[yd_cd],6,2)
                MINUS
                SELECT DISTINCT BCT.CNTR_NO
                  FROM BKG_VVD       VVD, 
                       BKG_BOOKING   BKG,
                       BKG_CONTAINER BCT
                 WHERE VVD.VSL_CD                          = substr(@[vvd],1,4)
                   AND VVD.SKD_VOY_NO                      = substr(@[vvd],5,4)
                   AND VVD.SKD_DIR_CD                      = substr(@[vvd],9,1)
                   AND VVD.POL_YD_CD||VVD.POL_CLPT_IND_SEQ = @[yd_cd]||@[pol_clpt_ind_seq]      
                   AND VVD.BKG_NO                          = BKG.BKG_NO
                   AND BKG.BKG_STS_CD                      <> 'X'
                   AND BKG.BKG_NO                          = BCT.BKG_NO ) A, BKG_CSTMS_TML_KR_CLL B
       WHERE  B.VSL_CD                          = substr(@[vvd],1,4)
         AND B.SKD_VOY_NO                       = substr(@[vvd],5,4)
         AND B.SKD_DIR_CD                       = substr(@[vvd],9,1)
         AND B.POL_CD                           = substr(@[yd_cd],1,5)
         AND B.POL_YD_CD                        = substr(@[yd_cd],6,2)
         AND A.CNTR_NO                          = B.CNTR_NO
   UNION ALL
    SELECT ROWNUM    AS SEQ,         NULL     AS CNTR_NO,     NULL     AS BKG_NO,  NULL    AS POD_CD, NULL AS BLCK_STWG_CD, 
           NULL      AS CNTR_TPSZ_CD,NULL     AS MTY_BKG_CD,  NULL     AS DG_FLG,  NULL    AS AWK_FLG, 
           NULL      AS BB_FLG,      NULL     AS BN_FLG,     
           A.CNTR_NO AS CNTR_NO2,    C.BKG_NO AS BKG_NO2,    C.POD_CD AS POD_CD2,  
           OPF_BLCK_STWG_CD(@[vvd],@[yd_cd],@[pol_clpt_ind_seq],C.BKG_NO) BLCK_STWG_CD2,
           D.CNTR_TPSZ_CD   AS CNTR_TPSZ_CD2, 
           C.BKG_CGO_TP_CD  AS MTY_BKG_CD2,
           CASE WHEN  ( SELECT COUNT(1)
                          FROM BKG_DG_CGO
                         WHERE BKG_NO  = C.BKG_NO
                           AND CNTR_NO = A.CNTR_NO ) = 0 THEN NULL
                ELSE 'Y'  END AS DG_FLG2,
           CASE WHEN  ( SELECT COUNT(1)
                          FROM BKG_AWK_CGO
                         WHERE BKG_NO  = C.BKG_NO
                           AND CNTR_NO = A.CNTR_NO ) = 0 THEN NULL
                ELSE 'Y'  END AS AWK_FLG2,
           CASE WHEN  ( SELECT COUNT(1)
                          FROM BKG_QTY_DTL
                         WHERE BKG_NO     = C.BKG_NO
                           AND BB_CGO_FLG = 'Y') = 0 THEN NULL
                ELSE 'Y'  END AS BB_FLG2  ,
           CASE WHEN  ( SELECT COUNT(1)
                          FROM BKG_CONTAINER
                         WHERE BKG_NO = C.BKG_NO
                           AND BDL_BTM_FLG ='Y' ) = 0 THEN NULL
                ELSE 'Y'  END AS BN_FLG2 
      FROM (
            SELECT DISTINCT BCT.CNTR_NO
              FROM BKG_VVD       VVD, 
                   BKG_BOOKING   BKG,
                   BKG_CONTAINER BCT
             WHERE VVD.VSL_CD                          = substr(@[vvd],1,4)
               AND VVD.SKD_VOY_NO                      = substr(@[vvd],5,4)
               AND VVD.SKD_DIR_CD                      = substr(@[vvd],9,1)
               AND VVD.POL_YD_CD||VVD.POL_CLPT_IND_SEQ = @[yd_cd]||@[pol_clpt_ind_seq]       
               AND VVD.BKG_NO                          = BKG.BKG_NO
               AND BKG.BKG_STS_CD                      <> 'X'
               AND BKG.BKG_NO                          = BCT.BKG_NO 
            MINUS
            SELECT DISTINCT CNTR_NO  
              FROM BKG_CSTMS_TML_KR_CLL
             WHERE VSL_CD                          = substr(@[vvd],1,4)
               AND SKD_VOY_NO                      = substr(@[vvd],5,4)
               AND SKD_DIR_CD                      = substr(@[vvd],9,1)
               AND POL_CD                          = substr(@[yd_cd],1,5)
               AND POL_YD_CD = substr(@[yd_cd],6,2) ) A, BKG_VVD B, BKG_BOOKING C, BKG_CONTAINER D
      WHERE B.VSL_CD                          = substr(@[vvd],1,4)
        AND B.SKD_VOY_NO                      = substr(@[vvd],5,4)
        AND B.SKD_DIR_CD                      = substr(@[vvd],9,1)
        AND B.POL_CD                          = substr(@[yd_cd],1,5)
        AND B.BKG_NO = C.BKG_NO
        AND C.BKG_NO = D.BKG_NO
        AND D.CNTR_NO = A.CNTR_NO ) 
  GROUP BY SEQ
  ORDER BY SEQ			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="pol_clpt_ind_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
