<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TerminalDepartureReportDBDAOLoadImportSGVORSQL">
			<desc><![CDATA[DESC Enter..

1. 2012.12.11 [CHM-201221836] 이수진 TOR: Load/Discharge Vol 을 Bkg data에서 Import시 source 변경
   1) Vol 산정 기준 : 기존 BKG 단위에서 CNTR 단위로 변경
   2) Weight 산정 기준 : 기존 Cargo 무게에서 Cargo 무게 + CNTR 무게 합으로 변경]]></desc>
			<sql><![CDATA[
SELECT 'SML' OPR_CD,
       POD_CD AS POD,
       SUM(DECODE(DCGO_FLG,'Y',DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),2,1,0),0))             DG_20_QTY,
       SUM(DECODE(DCGO_FLG,'Y',DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),2,CNTR_WGT,0),0))      DG_20_WGT,
       SUM(DECODE(DCGO_FLG,'Y',DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),2,0,1),0))             DG_40_QTY,
       SUM(DECODE(DCGO_FLG,'Y',DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),2,0,CNTR_WGT),0))      DG_40_WGT,
       SUM(DECODE(RC_FLG,'Y',DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),2,1,0),0))               RF_20_QTY,
       SUM(DECODE(RC_FLG,'Y',DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),2,CNTR_WGT,0),0))        RF_20_WGT,
       SUM(DECODE(RC_FLG,'Y',DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),2,0,1),0))               RF_40_QTY,
       SUM(DECODE(RC_FLG,'Y',DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),2,0,CNTR_WGT),0))        RF_40_WGT,
       SUM(DECODE(AWK_CGO_FLG,'Y',DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),2,1,0),0))          AK_20_QTY,
       SUM(DECODE(AWK_CGO_FLG,'Y',DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),2,CNTR_WGT,0),0))   AK_20_WGT,
       SUM(DECODE(AWK_CGO_FLG,'Y',DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),2,0,1),0))          AK_40_QTY,
       SUM(DECODE(AWK_CGO_FLG,'Y',DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),2,0,CNTR_WGT),0))   AK_40_WGT
FROM   (
    SELECT XX.POD_CD, XX.DCGO_FLG, XX.RC_FLG, XX.AWK_CGO_FLG, XX.CNTR_TPSZ_CD, XX.CNTR_NO
       ,   XX.CNTR_WGT + (SELECT C.CNTR_TPSZ_TARE_WGT FROM MDM_CNTR_TP_SZ C WHERE C.CNTR_TPSZ_CD = XX.CNTR_TPSZ_CD)  CNTR_WGT
    FROM   (
        SELECT V.POD_CD, C.DCGO_FLG, C.RC_FLG, C.AWK_CGO_FLG, C.CNTR_TPSZ_CD, C.CNTR_NO
           ,   SUM(DECODE(C.WGT_UT_CD,'KGS',C.CNTR_WGT,'LBS',C.CNTR_WGT*0.453599,C.CNTR_WGT)) CNTR_WGT 
        FROM   VSK_VSL_PORT_SKD S, BKG_VVD V, BKG_CONTAINER C, BKG_BOOKING B
        WHERE  S.VSL_CD       = @[vsl_cd]
        AND    S.SKD_VOY_NO   = @[voy_no]
        AND    S.SKD_DIR_CD   = @[dir_cd]
        AND    S.YD_CD        = @[yd_cd]
        AND    S.CLPT_IND_SEQ = @[clpt_ind_seq]
        AND    S.VSL_CD       = V.VSL_CD
        AND    S.SKD_VOY_NO   = V.SKD_VOY_NO
        AND    S.SKD_DIR_CD   = V.SKD_DIR_CD
        AND    S.VPS_PORT_CD  = V.POL_CD
        AND    S.CLPT_IND_SEQ = NVL(V.POL_CLPT_IND_SEQ,1)
        AND    V.BKG_NO     = C.BKG_NO
        AND    V.BKG_NO     = B.BKG_NO
        AND    NVL(B.BKG_STS_CD,'N') NOT IN ('X','A')
        AND    DECODE(C.DCGO_FLG,'Y','Y',DECODE(C.RC_FLG,'Y','Y',DECODE(C.AWK_CGO_FLG,'Y','Y','N'))) = 'Y'
        GROUP BY V.POD_CD, C.DCGO_FLG, C.RC_FLG, C.AWK_CGO_FLG, C.CNTR_TPSZ_CD, C.CNTR_NO
           ) XX
       )
GROUP BY POD_CD
ORDER BY POD_CD			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="voy_no" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="clpt_ind_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
