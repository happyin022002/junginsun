<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="VesselScheduleMgtDBDAOSearchTmnlReHdlCostRSQL">
			<desc><![CDATA[DESC Enter..]]></desc>
			<sql><![CDATA[
SELECT P.TML_CD AS YD_CD,
		P.VSL_SLAN_CD,
		ROUND(MAX(DECODE(SUBSTR(D.LGS_COST_CD,5,2),'TS',
		  DECODE(SUBSTR(D.LGS_COST_CD,1,2),'TP',DECODE(DECODE(NVL(D.IO_BND_CD,'N'),'S',
			DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D2',C.AGMT_RT,0),D.AGMT_UT_RT),0),0,
			  DECODE(NVL(D.IO_BND_CD,'N'),'O',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D2',C.AGMT_RT,0),D.AGMT_UT_RT),0),
			  DECODE(NVL(D.IO_BND_CD,'N'),'S',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D2',C.AGMT_RT,0),D.AGMT_UT_RT),0)),
		  DECODE(SUBSTR(D.LGS_COST_CD,1,2),'TM',DECODE(DECODE(NVL(D.IO_BND_CD,'N'),'S',
			DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D2',C.AGMT_RT,0),D.AGMT_UT_RT),0),0,
			  DECODE(NVL(D.IO_BND_CD,'N'),'O',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D2',C.AGMT_RT,0),D.AGMT_UT_RT),0),
			  DECODE(NVL(D.IO_BND_CD,'N'),'S',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D2',C.AGMT_RT,0),D.AGMT_UT_RT),0)),0) +
		  DECODE(SUBSTR(D.LGS_COST_CD,1,2),'SV',DECODE(DECODE(NVL(D.IO_BND_CD,'N'),'S',
			DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D2',C.AGMT_RT,0),D.AGMT_UT_RT),0),0,
			  DECODE(NVL(D.IO_BND_CD,'N'),'O',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D2',C.AGMT_RT,0),D.AGMT_UT_RT),0),
			  DECODE(NVL(D.IO_BND_CD,'N'),'S',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D2',C.AGMT_RT,0),D.AGMT_UT_RT),0)),0)),0)*2)) TS_D2,
		ROUND(MAX(DECODE(SUBSTR(D.LGS_COST_CD,5,2),'TS',
		  DECODE(SUBSTR(D.LGS_COST_CD,1,2),'TP',DECODE(DECODE(NVL(D.IO_BND_CD,'N'),'S',
			DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D4',C.AGMT_RT,0),D.AGMT_UT_RT),0),0,
			  DECODE(NVL(D.IO_BND_CD,'N'),'O',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D4',C.AGMT_RT,0),D.AGMT_UT_RT),0),
			  DECODE(NVL(D.IO_BND_CD,'N'),'S',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D4',C.AGMT_RT,0),D.AGMT_UT_RT),0)),
		  DECODE(SUBSTR(D.LGS_COST_CD,1,2),'TM',DECODE(DECODE(NVL(D.IO_BND_CD,'N'),'S',
			DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D4',C.AGMT_RT,0),D.AGMT_UT_RT),0),0,
			  DECODE(NVL(D.IO_BND_CD,'N'),'O',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D4',C.AGMT_RT,0),D.AGMT_UT_RT),0),
			  DECODE(NVL(D.IO_BND_CD,'N'),'S',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D4',C.AGMT_RT,0),D.AGMT_UT_RT),0)),0) +
		  DECODE(SUBSTR(D.LGS_COST_CD,1,2),'SV',DECODE(DECODE(NVL(D.IO_BND_CD,'N'),'S',
			DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D4',C.AGMT_RT,0),D.AGMT_UT_RT),0),0,
			  DECODE(NVL(D.IO_BND_CD,'N'),'O',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D4',C.AGMT_RT,0),D.AGMT_UT_RT),0),
			  DECODE(NVL(D.IO_BND_CD,'N'),'S',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D4',C.AGMT_RT,0),D.AGMT_UT_RT),0)),0)),0)*2)) TS_D4,
		ROUND(MAX(DECODE(SUBSTR(D.LGS_COST_CD,5,2),'FL',
		  DECODE(SUBSTR(D.LGS_COST_CD,1,2),'TP',DECODE(DECODE(NVL(D.IO_BND_CD,'N'),'S',
			DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D2',C.AGMT_RT,0),D.AGMT_UT_RT),0),0,
			  DECODE(NVL(D.IO_BND_CD,'N'),'O',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D2',C.AGMT_RT,0),D.AGMT_UT_RT),0),
			  DECODE(NVL(D.IO_BND_CD,'N'),'S',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D2',C.AGMT_RT,0),D.AGMT_UT_RT),0)),
		  DECODE(SUBSTR(D.LGS_COST_CD,1,2),'TM',DECODE(DECODE(NVL(D.IO_BND_CD,'N'),'S',
			DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D2',C.AGMT_RT,0),D.AGMT_UT_RT),0),0,
			  DECODE(NVL(D.IO_BND_CD,'N'),'O',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D2',C.AGMT_RT,0),D.AGMT_UT_RT),0),
			  DECODE(NVL(D.IO_BND_CD,'N'),'S',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D2',C.AGMT_RT,0),D.AGMT_UT_RT),0)),0) +
		  DECODE(SUBSTR(D.LGS_COST_CD,1,2),'SV',DECODE(DECODE(NVL(D.IO_BND_CD,'N'),'S',
			DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D2',C.AGMT_RT,0),D.AGMT_UT_RT),0),0,
			  DECODE(NVL(D.IO_BND_CD,'N'),'O',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D2',C.AGMT_RT,0),D.AGMT_UT_RT),0),
			  DECODE(NVL(D.IO_BND_CD,'N'),'S',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D2',C.AGMT_RT,0),D.AGMT_UT_RT),0)),0)),0))) TM_D2,
		ROUND(MAX(DECODE(SUBSTR(D.LGS_COST_CD,5,2),'FL',
		  DECODE(SUBSTR(D.LGS_COST_CD,1,2),'TP',DECODE(DECODE(NVL(D.IO_BND_CD,'N'),'S',
			DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D4',C.AGMT_RT,0),D.AGMT_UT_RT),0),0,
			  DECODE(NVL(D.IO_BND_CD,'N'),'O',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D4',C.AGMT_RT,0),D.AGMT_UT_RT),0),
			  DECODE(NVL(D.IO_BND_CD,'N'),'S',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D4',C.AGMT_RT,0),D.AGMT_UT_RT),0)),
		  DECODE(SUBSTR(D.LGS_COST_CD,1,2),'TM',DECODE(DECODE(NVL(D.IO_BND_CD,'N'),'S',
			DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D4',C.AGMT_RT,0),D.AGMT_UT_RT),0),0,
			  DECODE(NVL(D.IO_BND_CD,'N'),'O',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D4',C.AGMT_RT,0),D.AGMT_UT_RT),0),
			  DECODE(NVL(D.IO_BND_CD,'N'),'S',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D4',C.AGMT_RT,0),D.AGMT_UT_RT),0)),0) +
		  DECODE(SUBSTR(D.LGS_COST_CD,1,2),'SV',DECODE(DECODE(NVL(D.IO_BND_CD,'N'),'S',
			DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D4',C.AGMT_RT,0),D.AGMT_UT_RT),0),0,
			  DECODE(NVL(D.IO_BND_CD,'N'),'O',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D4',C.AGMT_RT,0),D.AGMT_UT_RT),0),
			  DECODE(NVL(D.IO_BND_CD,'N'),'S',
				DECODE(D.TML_AGMT_VOL_UT_CD,'C',DECODE(C.CNTR_TPSZ_CD,'D4',C.AGMT_RT,0),D.AGMT_UT_RT),0)),0)),0))) TM_D4,
		D.CURR_CD CURR_CD
 FROM   PRD_PORT_TML_MTX P, MDM_YARD V, TES_TML_AGMT_HDR H, TES_TML_AGMT_DTL D,
		TES_TML_AGMT_TP_SZ C, TES_TML_AGMT_DG_CGO_CLSS G, TES_TML_AGMT_APLY_DY A
 WHERE  P.CRR_CD          = 'SML'
 AND    P.VSL_SLAN_CD     = @[vsl_slan_cd]
 AND    P.TML_CD          = V.YD_CD
 AND    H.YD_CD           = P.TML_CD
 AND    H.VNDR_SEQ        = V.N1ST_VNDR_SEQ
 AND    H.TML_AGMT_STS_CD = 'C'                                                               
 AND    H.TML_AGMT_VER_NO = ( SELECT MAX(M.TML_AGMT_VER_NO)
							  FROM   TES_TML_AGMT_HDR M
							  WHERE  M.YD_CD           = P.TML_CD
							  AND    M.YD_CD           = @[yd_cd]
							  AND    M.VNDR_SEQ        = V.N1ST_VNDR_SEQ
							  AND    M.TML_AGMT_STS_CD = 'C'
							  AND    M.DELT_FLG        = 'N' )
 AND    H.TML_AGMT_OFC_CTY_CD = D.TML_AGMT_OFC_CTY_CD
 AND    H.TML_AGMT_SEQ        = D.TML_AGMT_SEQ
 AND    H.TML_AGMT_VER_NO     = D.TML_AGMT_VER_NO
 AND    D.LGS_COST_CD         IN ('TPNDTS','SVLDTS','TMNDTS','TPNDFL','SVLDFL','TMNDFL')
 AND    NVL(D.THRP_COST_CD_FLG,'N') <> 'Y'
 AND    TO_NUMBER(NVL(D.FM_TR_VOL_VAL,'1')) = 1 
 AND    NVL(D.LANE_CD,'N')    = DECODE(NVL(D.LANE_CD,'N'),'N','N','Sam','Sam','OTH','OTH',P.VSL_SLAN_CD)
 AND    NVL(D.IOC_CD,'N')     IN ('N','S','O')
 AND    NVL(D.IO_BND_CD,'N')  IN ('N','S','O')
 AND    NVL(D.TML_TRNS_MOD_CD,'N') = DECODE(NVL(D.TML_TRNS_MOD_CD,'N'),'N','N','S','S',D.TML_TRNS_MOD_CD)
 AND    D.TML_AGMT_OFC_CTY_CD = C.TML_AGMT_OFC_CTY_CD	(+)                                                             
 AND    D.TML_AGMT_SEQ        = C.TML_AGMT_SEQ			(+)                                                                           
 AND    D.TML_AGMT_VER_NO     = C.TML_AGMT_VER_NO		(+)                                                                     
 AND    D.TML_AGMT_DTL_SEQ    = C.TML_AGMT_DTL_SEQ		(+)                                                                   
 AND    DECODE(D.TML_AGMT_VOL_UT_CD,'C',C.CNTR_TPSZ_CD,'N') IN ('D2','D4','N')
 AND    D.TML_AGMT_OFC_CTY_CD = G.TML_AGMT_OFC_CTY_CD	(+)
 AND    D.TML_AGMT_SEQ        = G.TML_AGMT_SEQ			(+)
 AND    D.TML_AGMT_VER_NO     = G.TML_AGMT_VER_NO		(+)
 AND    DECODE(NVL(D.DCGO_APLY_TP_CD,'N'),'N','N',D.TML_AGMT_DTL_SEQ)                                                                        
		= DECODE(NVL(D.DCGO_APLY_TP_CD,'N'),'N','N',G.TML_AGMT_DTL_SEQ)
 AND    DECODE(NVL(D.DCGO_APLY_TP_CD,'N'),'N','N',G.DCGO_APLY_TP_CD) = DECODE(NVL(D.DCGO_APLY_TP_CD,'N'),'N','N','R')
 AND    DECODE(NVL(D.DCGO_APLY_TP_CD,'N'),'A',DECODE('N','N',G.DCGO_NON_CLSS_FLG,'N'),'S',DECODE('N','N',G.DCGO_NON_CLSS_FLG,'N'),'N')     
		= DECODE(NVL(D.DCGO_APLY_TP_CD,'N'),'A',DECODE('N','N','Y','N'),'S',DECODE('N','N','Y','N'),'N')
 AND    D.TML_AGMT_OFC_CTY_CD  = A.TML_AGMT_OFC_CTY_CD	(+)                                                                                    
 AND    D.TML_AGMT_SEQ         = A.TML_AGMT_SEQ			(+)                                                                                           
 AND    D.TML_AGMT_VER_NO      = A.TML_AGMT_VER_NO		(+)                                                                                        
 AND    D.TML_AGMT_DTL_SEQ     = A.TML_AGMT_DTL_SEQ		(+)
 GROUP BY P.TML_CD, P.VSL_SLAN_CD, D.CURR_CD			]]></sql>
			<params>
				<param name="vsl_slan_cd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
