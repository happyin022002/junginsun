<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OwnContainerBookingForecastMgtDBDAOCBFIFSummaryIfBkgDtDgCSQL">
			<desc><![CDATA[OwnContainerBookingForecastMgtDBDAOCBFIFSummaryIfBkgDtDg]]></desc>
			<sql><![CDATA[
INSERT INTO OPF_CGO_BKG_FCAST_SPCL_SMRY ( VSL_CD                            
                                        , SKD_VOY_NO                        
                                        , SKD_DIR_CD                        
                                        , YD_CD                             
                                        , POL_CLPT_IND_SEQ                  
                                        , CRR_CD                            
                                        , POD_CD                            
                                        , BLCK_STWG_CD                      
                                        , CBF_SPCL_SMRY_SEQ                 
                                        , CNTR_TPSZ_CD                      
                                        , DCGO_FLG                          
                                        , RC_FLG                            
                                        , AWK_CGO_FLG                                                        
                                        , IMDG_UN_NO                        
                                        , IMDG_CLSS_CD                      
                                        , MRN_POLUT_FLG                     
                                        , CNTR_QTY                          
                                        , STWG_CD                   
                                        , IMDG_LMT_QTY_FLG 
                                        , CRE_USR_ID       
                                        , CRE_DT           
                                        , UPD_USR_ID       
                                        , UPD_DT           
                                        , BKG_NO           
                                        , DG_CNTR_SEQ
                                        , PRCT_FLG 
                                        , FWRD_OVR_DIM_LEN
                                        , BKWD_OVR_DIM_LEN
                                        , HGT_OVR_DIM_LEN
                                        , LF_SD_OVR_DIM_LEN
                                        , RT_SD_OVR_DIM_LEN
                                        , BKG_REV_MCGO_FLG
                                        , IMDG_SUBS_RSK_LBL_CD )
 WITH NO_SPLIT AS (
     SELECT *
     FROM ( SELECT D.BKG_NO, D.CNTR_NO, D.CNTR_TPSZ_CD, D.IMDG_UN_NO, D.IMDG_CLSS_CD, D.IMDG_SUBS_RSK_LBL_CD1,
                   D.MRN_POLUT_FLG,  D.CARGO_TYPE, D.STWG_CD, D.DG_CNTR_SEQ, D.POD_CD, D.MLB, D.IMDG_LMT_QTY_FLG, D.PRCT_FLG,
                   D.MTY_FLG, D.FM_BKG_NO, D.CNTR_VOL_QTY,D.SEQ,
                   CASE WHEN D.CNTR_NO IS NOT NULL THEN   
                             COUNT(1) OVER(PARTITION BY D.CNTR_NO ) 
                        ELSE 
                             COUNT(1) OVER(PARTITION BY D.BKG_NO, D.DG_CNTR_SEQ ) 
                        END AS SCNT
 FROM (
       SELECT DISTINCT A.BKG_NO, A.CNTR_NO, A.CNTR_TPSZ_CD, A.IMDG_UN_NO, A.IMDG_CLSS_CD, IMDG_SUBS_RSK_LBL_CD1,
                       CASE WHEN (SELECT DISTINCT DECODE(MRN_POLUT_FLG,'Y','Y','N')  
                             FROM BKG_DG_CGO
                            WHERE BKG_NO        = A.BKG_NO
                              AND MRN_POLUT_FLG = 'Y'
                              AND DG_CNTR_SEQ   = A.DG_CNTR_SEQ
                              AND NVL(SPCL_CGO_APRO_CD,'X') <> 'C' ) = 'Y' THEN 'Y'
                             WHEN (  SELECT DISTINCT DECODE(MRN_POLUT_FLG,'Y','Y','N')
                                       FROM BKG_DG_CGO A1, BKG_BOOKING B1,  BKG_VVD C1
                                      WHERE A1.BKG_NO           = B1.BKG_NO 
                                        AND C1.VSL_CD           = @[vsl_cd]
                                        AND C1.SKD_VOY_NO       = @[skd_voy_no]
                                        AND C1.SKD_DIR_CD       = @[skd_dir_cd]
                                        AND C1.POL_CLPT_IND_SEQ =  @[pol_clpt_ind_seq]
                                        AND C1.POL_YD_CD        =  @[pol_cd]
                                        AND A1.BKG_NO           =  C1.BKG_NO
                                        AND A1.CNTR_TPSZ_CD     NOT LIKE 'Q%'
                                        AND A1.MRN_POLUT_FLG = 'Y'
                                        AND B1.BKG_STS_CD        <> 'X'  
                                        AND A1.CNTR_NO =  A.CNTR_NO
                                        #if(${bkg_sts_cd} != 'All')
				                        AND B1.BKG_STS_CD = @[bkg_sts_cd]
                                        AND NVL(A.SPCL_CGO_APRO_CD,'X') <> 'N'
				                        #end     
                                        AND NVL(A1.SPCL_CGO_APRO_CD,'X') <> 'C' ) = 'Y'  THEN  'Y'
                             ELSE 'N'
                             END AS MRN_POLUT_FLG,
                     CASE WHEN (SELECT NVL(COUNT(1),0) 
                                      FROM BKG_AWK_CGO 
                                     WHERE BKG_NO = B.BKG_NO
                                       AND CNTR_NO = A.CNTR_NO ) <> 0 THEN 'A'
                          WHEN (  SELECT NVL(COUNT(1),0)
                                    FROM BKG_RF_CGO
                                   WHERE BKG_NO = B.BKG_NO
                                     AND CNTR_NO = A.CNTR_NO ) <> 0 THEN 'R' 
                          ELSE NULL
                          END AS CARGO_TYPE,
                     NVL(B.STWG_CD,' ') STWG_CD, DG_CNTR_SEQ,
                     C.POD_CD,
                     OPF_BLCK_STWG_CD(C.VSL_CD||C.SKD_VOY_NO||C.SKD_DIR_CD, C.POL_YD_CD, C.POL_CLPT_IND_SEQ, B.BKG_NO) AS MLB, 
                     CASE WHEN( SELECT DISTINCT DECODE(IMDG_LMT_QTY_FLG,'N','N','Y')  
                                FROM BKG_DG_CGO
                               WHERE BKG_NO            = A.BKG_NO
                                 AND IMDG_LMT_QTY_FLG  = 'N' 
                                 AND DG_CNTR_SEQ       = A.DG_CNTR_SEQ 
                                 AND NVL(SPCL_CGO_APRO_CD,'X') <> 'C'  )  = 'N' THEN 'N'
                          WHEN (SELECT DISTINCT DECODE(IMDG_LMT_QTY_FLG,'N','N','Y')
                                       FROM BKG_DG_CGO A1, BKG_BOOKING B1,  BKG_VVD C1
                                      WHERE A1.BKG_NO           = B1.BKG_NO 
                                        AND C1.VSL_CD           = @[vsl_cd]
                                        AND C1.SKD_VOY_NO       = @[skd_voy_no]
                                        AND C1.SKD_DIR_CD       = @[skd_dir_cd]
                                        AND C1.POL_CLPT_IND_SEQ =  @[pol_clpt_ind_seq]
                                        AND C1.POL_YD_CD        =  @[pol_cd]
                                        AND A1.BKG_NO           =  C1.BKG_NO
                                        AND A1.CNTR_TPSZ_CD     NOT LIKE 'Q%'
                                        AND A1.IMDG_LMT_QTY_FLG = 'N' 
                                        AND B1.BKG_STS_CD        <> 'X'  
                                        AND A1.CNTR_NO =  A.CNTR_NO
                                         #if(${bkg_sts_cd} != 'All')
				                        AND B1.BKG_STS_CD = @[bkg_sts_cd]
                                        AND NVL(A.SPCL_CGO_APRO_CD,'X') <> 'N'
				                        #end 
                                        AND NVL(A1.SPCL_CGO_APRO_CD,'X') <> 'C' ) ='N'  THEN  'N'     
                            ELSE 'Y' 
                            END  AS IMDG_LMT_QTY_FLG  , 
                     B.PRCT_FLG, DECODE(B.BKG_CGO_TP_CD,'R','Y') MTY_FLG,
                     DECODE(A.CNTR_VOL_QTY ,1,NULL,B.BKG_NO) FM_BKG_NO,
                     A.CNTR_VOL_QTY,
                       CASE WHEN A.CNTR_NO IS NOT NULL THEN
                              RANK() OVER(PARTITION BY A.CNTR_NO ORDER BY A.BKG_NO, A.CNTR_NO,A.IMDG_UN_NO, A.IMDG_CLSS_CD, A.MRN_POLUT_FLG, A.IMDG_LMT_QTY_FLG, A.IMDG_SUBS_RSK_LBL_CD1, B.PRCT_FLG,B.STWG_CD, DECODE(B.BKG_CGO_TP_CD,'R','Y','N') )  --SEQ 
                            ELSE   
                              RANK() OVER(PARTITION BY A.BKG_NO, A.DG_CNTR_SEQ ORDER BY A.BKG_NO, A.DG_CNTR_SEQ,A.IMDG_UN_NO, A.IMDG_CLSS_CD, A.MRN_POLUT_FLG, A.IMDG_LMT_QTY_FLG, A.IMDG_SUBS_RSK_LBL_CD1, B.PRCT_FLG,B.STWG_CD, DECODE(B.BKG_CGO_TP_CD,'R','Y','N') )  --SEQ 
                            END AS SEQ  
                 FROM BKG_DG_CGO A, BKG_BOOKING B,  BKG_VVD C
                WHERE A.BKG_NO           = B.BKG_NO 
                  AND C.VSL_CD           = @[vsl_cd]
                  AND C.SKD_VOY_NO       = @[skd_voy_no]
                  AND C.SKD_DIR_CD       = @[skd_dir_cd]
                  AND C.POL_CLPT_IND_SEQ =  @[pol_clpt_ind_seq]
                  AND C.POL_YD_CD        =  @[pol_cd]
                  AND A.BKG_NO           =  C.BKG_NO
                  AND A.CNTR_TPSZ_CD     NOT LIKE 'Q%'
                  AND B.BKG_STS_CD        <> 'X' 
                  #if(${bkg_sts_cd} != 'All')
				   AND B.BKG_STS_CD = @[bkg_sts_cd]
                   AND NVL(A.SPCL_CGO_APRO_CD,'X') <> 'N'
				  #end                  
                   AND NVL(A.SPCL_CGO_APRO_CD,'X') <> 'C'   ) D
                  ) X --SPLIT없이 CO-LOAD인 경우 DCNT <> 1 AND SEQ  다수 CAIU8405516
          WHERE ( X.SCNT = 1 OR ( X.SCNT <> 1 AND X.SEQ = 1 ))  AND X.FM_BKG_NO IS NULL ) , 
     SPLIT_BKG AS (
       SELECT DISTINCT  DECODE(DCNT,1,NULL, FM_BKG_NO) FM_BKG_NO, CNTR_TPSZ_CD,CNTR_NO,IMDG_UN_NO, IMDG_CLSS_CD, MRN_POLUT_FLG, IMDG_LMT_QTY_FLG, IMDG_SUBS_RSK_LBL_CD1, 
              PRCT_FLG,MTY_FLG,CARGO_TYPE,POD_CD, MLB, DG_CNTR_SEQ,STWG_CD, DCNT, SEQ
          FROM (  
           SELECT D.CNTR_NO, D.CNTR_TPSZ_CD, D.IMDG_UN_NO, D.IMDG_CLSS_CD, D.IMDG_SUBS_RSK_LBL_CD1, D.MRN_POLUT_FLG, D.CARGO_TYPE,
                  D.STWG_CD,  
                  NVL(( SELECT MIN(DG_CNTR_SEQ)
                          FROM BKG_DG_CGO WHERE BKG_NO =  ( SELECT MIN(X.BKG_NO) 
                                                              FROM BKG_BOOKING X, BKG_DG_CGO Y
                                                             WHERE ( X.FM_BKG_NO = D.FM_BKG_NO OR X.BKG_NO = D.FM_BKG_NO )
                                                               AND   X.BKG_NO = Y.BKG_NO
                                                               AND   Y.CNTR_NO = D.CNTR_NO )
                                            AND CNTR_NO = D.CNTR_NO ),1)  AS DG_CNTR_SEQ, 
                  D.POD_CD, D.MLB, D.IMDG_LMT_QTY_FLG, D.PRCT_FLG,  D.MTY_FLG,
                  NVL(( SELECT MIN(X.BKG_NO) FROM BKG_BOOKING X, BKG_DG_CGO Y
                            WHERE (X.FM_BKG_NO = D.FM_BKG_NO OR X.BKG_NO = D.FM_BKG_NO )
                              AND X.BKG_NO = Y.BKG_NO
                              AND Y.CNTR_NO = D.CNTR_NO ),D.FM_BKG_NO) AS FM_BKG_NO, D.SEQ,
                  COUNT(1) OVER(PARTITION BY FM_BKG_NO, NVL(D.CNTR_NO,ROWNUM)) DCNT
            FROM (
                SELECT DISTINCT A.CNTR_NO, A.CNTR_TPSZ_CD, A.IMDG_UN_NO, A.IMDG_CLSS_CD, IMDG_SUBS_RSK_LBL_CD1,
                        CASE WHEN (SELECT DISTINCT DECODE(MRN_POLUT_FLG,'Y','Y','N')  
                             FROM BKG_DG_CGO
                            WHERE BKG_NO        = A.BKG_NO
                              AND MRN_POLUT_FLG = 'Y'
                              AND DG_CNTR_SEQ   = A.DG_CNTR_SEQ 
                              AND NVL(SPCL_CGO_APRO_CD,'X') <> 'C'  ) = 'Y' THEN 'Y'
                             WHEN (  SELECT DISTINCT DECODE(MRN_POLUT_FLG,'Y','Y','N')
                                       FROM BKG_DG_CGO A1, BKG_BOOKING B1,  BKG_VVD C1
                                      WHERE A1.BKG_NO           = B1.BKG_NO 
                                        AND C1.VSL_CD           = @[vsl_cd]
                                        AND C1.SKD_VOY_NO       = @[skd_voy_no]
                                        AND C1.SKD_DIR_CD       = @[skd_dir_cd]
                                        AND C1.POL_CLPT_IND_SEQ =  @[pol_clpt_ind_seq]
                                        AND C1.POL_YD_CD        =  @[pol_cd]
                                        AND A1.BKG_NO           =  C1.BKG_NO
                                        AND A1.CNTR_TPSZ_CD     NOT LIKE 'Q%'
                                        AND A1.MRN_POLUT_FLG = 'Y'
                                        AND B1.BKG_STS_CD        <> 'X'  
                                        AND A1.CNTR_NO =  A.CNTR_NO
                                        #if(${bkg_sts_cd} != 'All')
				                        AND B1.BKG_STS_CD = @[bkg_sts_cd]
                                        AND NVL(A1.SPCL_CGO_APRO_CD,'X') <> 'N'
				                        #end     
                                        AND NVL(A1.SPCL_CGO_APRO_CD,'X') <> 'C' ) = 'Y'  THEN  'Y'
                             ELSE 'N'
                           END AS MRN_POLUT_FLG, 
                            CASE WHEN (SELECT NVL(COUNT(1),0) 
                                      FROM BKG_AWK_CGO 
                                     WHERE BKG_NO = B.BKG_NO
                                       AND CNTR_NO = A.CNTR_NO ) <> 0 THEN 'A'
                                 WHEN ( SELECT NVL(COUNT(1),0)
                                         FROM BKG_RF_CGO
                                        WHERE BKG_NO = B.BKG_NO
                                          AND CNTR_NO = A.CNTR_NO ) <> 0 THEN 'R' 
                                 ELSE NULL
                                 END AS CARGO_TYPE,
                           NVL(B.STWG_CD,' ')  STWG_CD, C.POD_CD,
                           OPF_BLCK_STWG_CD(C.VSL_CD||C.SKD_VOY_NO||C.SKD_DIR_CD, C.POL_YD_CD, C.POL_CLPT_IND_SEQ, B.BKG_NO) AS MLB, 
                           CASE WHEN( SELECT DISTINCT DECODE(IMDG_LMT_QTY_FLG,'N','N','Y')  
                                        FROM BKG_DG_CGO
                                       WHERE BKG_NO            = A.BKG_NO
                                         AND IMDG_LMT_QTY_FLG  = 'N' 
                                         AND DG_CNTR_SEQ       = A.DG_CNTR_SEQ
                                         AND NVL(SPCL_CGO_APRO_CD,'X') <> 'C'  )  = 'N' THEN 'N'
                                WHEN (SELECT DISTINCT DECODE(IMDG_LMT_QTY_FLG,'N','N','Y')
                                       FROM BKG_DG_CGO A1, BKG_BOOKING B1,  BKG_VVD C1
                                      WHERE A1.BKG_NO           = B1.BKG_NO 
                                        AND C1.VSL_CD           = @[vsl_cd]
                                        AND C1.SKD_VOY_NO       = @[skd_voy_no]
                                        AND C1.SKD_DIR_CD       = @[skd_dir_cd]
                                        AND C1.POL_CLPT_IND_SEQ =  @[pol_clpt_ind_seq]
                                        AND C1.POL_YD_CD        =  @[pol_cd]
                                        AND A1.BKG_NO           =  C1.BKG_NO
                                        AND A1.CNTR_TPSZ_CD     NOT LIKE 'Q%'
                                        AND A1.IMDG_LMT_QTY_FLG = 'N' 
                                        AND B1.BKG_STS_CD        <> 'X'  
                                        AND A1.CNTR_NO =  A.CNTR_NO
                                         #if(${bkg_sts_cd} != 'All')
				                        AND B1.BKG_STS_CD = @[bkg_sts_cd]
                                        AND NVL(A1.SPCL_CGO_APRO_CD,'X') <> 'N'
				                        #end 
                                        AND NVL(A1.SPCL_CGO_APRO_CD,'X') <> 'C' ) ='N'  THEN  'N'     
                               ELSE 'Y' 
                               END  AS IMDG_LMT_QTY_FLG, B.PRCT_FLG, DECODE(B.BKG_CGO_TP_CD,'R','Y') MTY_FLG,
                        DECODE(A.CNTR_VOL_QTY ,1,NULL, NVL(B.FM_BKG_NO,B.BKG_NO)) FM_BKG_NO,
                        RANK() OVER(PARTITION BY A.CNTR_NO ORDER BY A.CNTR_NO,A.IMDG_UN_NO, A.IMDG_CLSS_CD, A.MRN_POLUT_FLG, A.IMDG_LMT_QTY_FLG, A.IMDG_SUBS_RSK_LBL_CD1, B.PRCT_FLG,B.STWG_CD, DECODE(B.BKG_CGO_TP_CD,'R','Y','N') ) SEQ 
                   FROM BKG_DG_CGO A, BKG_BOOKING B,  BKG_VVD C
                  WHERE A.BKG_NO           = B.BKG_NO 
                    AND C.VSL_CD           = @[vsl_cd]
                    AND C.SKD_VOY_NO       = @[skd_voy_no]
                    AND C.SKD_DIR_CD       = @[skd_dir_cd]
                    AND C.POL_CLPT_IND_SEQ = @[pol_clpt_ind_seq]
                    AND C.POL_YD_CD        = @[pol_cd]
                    AND A.BKG_NO           = C.BKG_NO
                    AND A.CNTR_TPSZ_CD     NOT LIKE 'Q%'
                    AND B.BKG_STS_CD        <> 'X' 
	                #if(${bkg_sts_cd} != 'All')
					AND B.BKG_STS_CD = @[bkg_sts_cd]
                    AND NVL(A.SPCL_CGO_APRO_CD,'X') <> 'N' 
					#end 
                    AND NVL(A.SPCL_CGO_APRO_CD,'X') <> 'C' ) D
		     ) X
         WHERE X.FM_BKG_NO IS NOT NULL  ) 
 
SELECT @[vsl_cd] ,@[skd_voy_no] , @[skd_dir_cd] ,  @[pol_cd] , @[pol_clpt_ind_seq], 'SML', BB.POD_CD, SUBSTR(BB.MLB,3,5), BB.CBF_SPCL_SMRY_SEQ+ROWNUM,
       BB.CNTR_TPSZ_CD, 'Y', DECODE(BB.CARGO_TYPE,'R','Y',NULL), DECODE(BB.CARGO_TYPE,'A','Y',NULL), 
       BB.IMDG_UN_NO, BB.IMDG_CLSS_CD, BB.MRN_POLUT_FLG, BB.CNTR_QTY, BB.STWG_CD ,   BB.IMDG_LMT_QTY_FLG, @[cre_usr_id],
       SYSDATE, @[upd_usr_id] , SYSDATE , BB.BKG_NO,BB.DG_CNTR_SEQ, BB.PRCT_FLG,
       BB.OVR_FWRD_LEN, BB.OVR_BKWD_LEN,BB.OVR_HGT,BB.OVR_LF_LEN, BB.OVR_RT_LEN, BB.MTY_FLG, BB.IMDG_SUBS_RSK_LBL_CD1
FROM (     
  SELECT AA.POD_CD, AA.MLB, AA.CNTR_TPSZ_CD, AA.IMDG_UN_NO, AA.IMDG_CLSS_CD, AA.MRN_POLUT_FLG, AA.CNTR_QTY, AA.BKG_NO,CARGO_TYPE, STWG_CD,IMDG_LMT_QTY_FLG,DG_CNTR_SEQ,
        AA.PRCT_FLG,  ( SELECT NVL(MAX(CBF_SPCL_SMRY_SEQ),0)
                    FROM OPF_CGO_BKG_FCAST_SPCL_SMRY
                    WHERE VSL_CD     = @[vsl_cd]
                    AND SKD_VOY_NO   = @[skd_voy_no]
                    AND SKD_DIR_CD   = @[skd_dir_cd]
                    AND YD_CD        = @[pol_cd]
                    AND POL_CLPT_IND_SEQ =   @[pol_clpt_ind_seq] ) AS CBF_SPCL_SMRY_SEQ  ,
         AA.OVR_FWRD_LEN, AA.OVR_BKWD_LEN,AA.OVR_HGT,AA.OVR_LF_LEN, AA.OVR_RT_LEN, AA.MTY_FLG,AA.IMDG_SUBS_RSK_LBL_CD1
 FROM ( 
   SELECT X.MLB, X.POD_CD, X.CNTR_TPSZ_CD, X.IMDG_UN_NO, X.IMDG_CLSS_CD, X.IMDG_SUBS_RSK_LBL_CD1, X.MRN_POLUT_FLG, X.IMDG_LMT_QTY_FLG, X.PRCT_FLG, 
          X.STWG_CD,X.CARGO_TYPE,X.OVR_FWRD_LEN, X.OVR_BKWD_LEN,X.OVR_HGT,X.OVR_LF_LEN, X.OVR_RT_LEN , X.MTY_FLG,  X.BKG_NO,  
          CASE WHEN X.BKG_NO IS NOT NULL THEN X.DG_CNTR_SEQ 
               ELSE NULL
          END DG_CNTR_SEQ,
          COUNT(1) CNTR_QTY
     FROM (  SELECT NULL BKG_NO, NULL CNTR_NO, CNTR_TPSZ_CD, IMDG_UN_NO, IMDG_CLSS_CD,IMDG_SUBS_RSK_LBL_CD1, MRN_POLUT_FLG, CARGO_TYPE, STWG_CD, DG_CNTR_SEQ, 
                    POD_CD, CNTR_VOL_QTY, MLB,IMDG_LMT_QTY_FLG,PRCT_FLG,NULL FM_BKG_NO, MTY_FLG,
                    NULL OVR_FWRD_LEN, NULL OVR_BKWD_LEN, NULL OVR_HGT, NULL OVR_LF_LEN, NULL OVR_RT_LEN
              FROM NO_SPLIT
             WHERE FM_BKG_NO IS NULL -- SPLIT 안된거, AWK CARGO가 아닌거, 
               AND NVL(CARGO_TYPE,'X') <> 'A'
               AND SCNT = 1
            UNION ALL
             SELECT NULL BKG_NO, NULL CNTR_NO, A.CNTR_TPSZ_CD, A.IMDG_UN_NO, A.IMDG_CLSS_CD,A.IMDG_SUBS_RSK_LBL_CD1, A.MRN_POLUT_FLG, A.CARGO_TYPE, A.STWG_CD, A.DG_CNTR_SEQ, 
                    A.POD_CD, A.CNTR_VOL_QTY, A.MLB,A.IMDG_LMT_QTY_FLG,A.PRCT_FLG,NULL FM_BKG_NO, MTY_FLG,
                    B.OVR_FWRD_LEN, B.OVR_BKWD_LEN,B.OVR_HGT,B.OVR_LF_LEN, B.OVR_RT_LEN 
               FROM NO_SPLIT A, BKG_AWK_CGO B
              WHERE A.FM_BKG_NO IS NULL -- SPLIT 안된거, AWK CARGO 인거
                AND NVL(A.CARGO_TYPE,'X') = 'A'
                AND A.BKG_NO = B.BKG_NO
                AND SCNT     = 1 
                AND NVL(A.CNTR_NO,'') = NVL(B.CNTR_NO,'')
                AND A.CNTR_TPSZ_CD    = B.CNTR_TPSZ_CD
             UNION ALL
             SELECT BKG_NO, CNTR_NO, CNTR_TPSZ_CD, IMDG_UN_NO, IMDG_CLSS_CD,IMDG_SUBS_RSK_LBL_CD1, MRN_POLUT_FLG, CARGO_TYPE, STWG_CD, DG_CNTR_SEQ, 
                    POD_CD, CNTR_VOL_QTY, MLB,IMDG_LMT_QTY_FLG,PRCT_FLG,NULL FM_BKG_NO, MTY_FLG,
                    NULL OVR_FWRD_LEN, NULL OVR_BKWD_LEN, NULL OVR_HGT, NULL OVR_LF_LEN, NULL OVR_RT_LEN
               FROM NO_SPLIT
              WHERE FM_BKG_NO IS NULL -- SPLIT 안된거, AWK CARGO가 아닌거, 
                AND NVL(CARGO_TYPE,'X') <> 'A'
                AND SCNT <> 1
             UNION ALL
            SELECT A.BKG_NO, A.CNTR_NO, A.CNTR_TPSZ_CD, A.IMDG_UN_NO, A.IMDG_CLSS_CD,A.IMDG_SUBS_RSK_LBL_CD1, A.MRN_POLUT_FLG, A.CARGO_TYPE, A.STWG_CD, A.DG_CNTR_SEQ,
                   A.POD_CD, A.CNTR_VOL_QTY,A.MLB,A.IMDG_LMT_QTY_FLG,A.PRCT_FLG,NULL FM_BKG_NO, MTY_FLG,
                   B.OVR_FWRD_LEN, B.OVR_BKWD_LEN,B.OVR_HGT,B.OVR_LF_LEN, B.OVR_RT_LEN 
              FROM NO_SPLIT A, BKG_AWK_CGO B
             WHERE A.FM_BKG_NO IS NULL -- SPLIT 안된거, AWK CARGO 인거
               AND NVL(A.CARGO_TYPE,'X') = 'A'
               AND A.BKG_NO = B.BKG_NO
               AND SCNT <> 1 
               AND NVL(A.CNTR_NO,'') = NVL(B.CNTR_NO,'')
               AND A.CNTR_TPSZ_CD    = B.CNTR_TPSZ_CD ) X
      GROUP BY X.MLB, X.POD_CD, X.CNTR_TPSZ_CD, X.IMDG_UN_NO, X.IMDG_CLSS_CD, X.IMDG_SUBS_RSK_LBL_CD1, X.MRN_POLUT_FLG, X.IMDG_LMT_QTY_FLG, X.PRCT_FLG, X.STWG_CD,X.CARGO_TYPE,
               X.OVR_FWRD_LEN, X.OVR_BKWD_LEN,X.OVR_HGT,X.OVR_LF_LEN, X.OVR_RT_LEN , X.MTY_FLG,X.BKG_NO,X.CNTR_NO  ,
               CASE WHEN X.BKG_NO IS NOT NULL THEN X.DG_CNTR_SEQ 
                    ELSE NULL
               END   
      UNION ALL  
    SELECT  YY.MLB, YY.POD_CD, YY.CNTR_TPSZ_CD, YY.IMDG_UN_NO, YY.IMDG_CLSS_CD, YY.IMDG_SUBS_RSK_LBL_CD1,
            NVL((SELECT DISTINCT DECODE(MRN_POLUT_FLG,'Y','Y','N')   
                   FROM SPLIT_BKG 
                  WHERE MLB          = YY.MLB 
                    AND POD_CD       = YY.POD_CD 
                    AND CNTR_TPSZ_CD = YY.CNTR_TPSZ_CD 
                    AND IMDG_UN_NO   = YY.IMDG_UN_NO 
                    AND IMDG_CLSS_CD = YY.IMDG_CLSS_CD 
                    AND NVL(IMDG_SUBS_RSK_LBL_CD1,'X') = NVL(YY.IMDG_SUBS_RSK_LBL_CD1,'X') 
                    AND MRN_POLUT_FLG           = 'Y'
                    AND NVL(PRCT_FLG,'X')       = NVL(YY.PRCT_FLG,'X') 
                    AND NVL(STWG_CD,'X')        = NVL(YY.STWG_CD,'X') 
                    AND NVL(CARGO_TYPE,'X')     = NVL(YY.CARGO_TYPE,'X') 
                    AND NVL(OVR_FWRD_LEN,0)     = NVL(YY.OVR_FWRD_LEN,0) 
                    AND NVL(OVR_BKWD_LEN,0)     = NVL(YY.OVR_BKWD_LEN,0) 
                    AND NVL(OVR_HGT,0)          = NVL(YY.OVR_HGT,0) 
                    AND NVL(OVR_LF_LEN,0)       = NVL(YY.OVR_LF_LEN,0) 
                    AND NVL(OVR_RT_LEN,0)       = NVL(YY.OVR_RT_LEN,0) 
                    AND NVL(MTY_FLG,'X')        = NVL(YY.MTY_FLG,'X') 
                    AND NVL(FM_BKG_NO,'X')      = NVL(YY.FM_BKG_NO,'X') ),'N' ) AS MRN_POLUT_FLG,
            NVL((SELECT  DISTINCT DECODE(IMDG_LMT_QTY_FLG,'N','N','Y')    
                   FROM SPLIT_BKG 
                  WHERE MLB          = YY.MLB 
                    AND POD_CD       = YY.POD_CD 
                    AND CNTR_TPSZ_CD = YY.CNTR_TPSZ_CD 
                    AND IMDG_UN_NO   = YY.IMDG_UN_NO 
                    AND IMDG_CLSS_CD = YY.IMDG_CLSS_CD 
                    AND NVL(IMDG_SUBS_RSK_LBL_CD1,'X') = NVL(YY.IMDG_SUBS_RSK_LBL_CD1,'X') 
                    AND IMDG_LMT_QTY_FLG = 'N'
                    AND NVL(PRCT_FLG,'X')       = NVL(YY.PRCT_FLG,'X') 
                    AND NVL(STWG_CD,'X')        = NVL(YY.STWG_CD,'X') 
                    AND NVL(CARGO_TYPE,'X')     = NVL(YY.CARGO_TYPE,'X') 
                    AND NVL(OVR_FWRD_LEN,0)     = NVL(YY.OVR_FWRD_LEN,0) 
                    AND NVL(OVR_BKWD_LEN,0)     = NVL(YY.OVR_BKWD_LEN,0) 
                    AND NVL(OVR_HGT,0)          = NVL(YY.OVR_HGT,0) 
                    AND NVL(OVR_LF_LEN,0)       = NVL(YY.OVR_LF_LEN,0) 
                    AND NVL(OVR_RT_LEN,0)       = NVL(YY.OVR_RT_LEN,0) 
                    AND NVL(MTY_FLG,'X')        = NVL(YY.MTY_FLG,'X') 
                    AND NVL(FM_BKG_NO,'X')      = NVL(YY.FM_BKG_NO,'X') ),'N' ) AS IMDG_LMT_QTY_FLG,
            YY.PRCT_FLG,YY.STWG_CD,YY.CARGO_TYPE,
            YY.OVR_FWRD_LEN, YY.OVR_BKWD_LEN,YY.OVR_HGT,YY.OVR_LF_LEN, YY.OVR_RT_LEN , YY.MTY_FLG, YY.FM_BKG_NO ,  YY.DG_CNTR_SEQ, SUM(CNTR_QTY)
     FROM (
     SELECT Z.MLB, Z.POD_CD, Z.CNTR_TPSZ_CD, Z.IMDG_UN_NO, Z.IMDG_CLSS_CD, Z.IMDG_SUBS_RSK_LBL_CD1, Z.MRN_POLUT_FLG, Z.IMDG_LMT_QTY_FLG, Z.PRCT_FLG,Z.STWG_CD,Z.CARGO_TYPE,
            Z.OVR_FWRD_LEN, Z.OVR_BKWD_LEN,Z.OVR_HGT,Z.OVR_LF_LEN, Z.OVR_RT_LEN , Z.MTY_FLG, Z.FM_BKG_NO ,  DG_CNTR_SEQ , 1 CNTR_QTY     
      FROM (    SELECT FM_BKG_NO, CNTR_NO, CNTR_TPSZ_CD,  IMDG_UN_NO, IMDG_CLSS_CD,  IMDG_SUBS_RSK_LBL_CD1,
                       CARGO_TYPE, STWG_CD  ,
                      CASE WHEN FM_BKG_NO IS NOT NULL THEN DG_CNTR_SEQ 
                           ELSE NULL
                           END DG_CNTR_SEQ ,POD_CD, NULL CNTR_VOL_QTY,MLB,
                       MRN_POLUT_FLG,    
                       IMDG_LMT_QTY_FLG, 
                       PRCT_FLG, MTY_FLG,
                       NULL OVR_FWRD_LEN, NULL OVR_BKWD_LEN, NULL OVR_HGT, NULL OVR_LF_LEN, NULL OVR_RT_LEN,DCNT, 'A1' CHK 
                  FROM SPLIT_BKG X
                 WHERE SEQ = 1
                   AND NVL(CARGO_TYPE,'X') <> 'A'
                 UNION ALL
                 SELECT X.FM_BKG_NO, X.CNTR_NO, X.CNTR_TPSZ_CD,  IMDG_UN_NO, IMDG_CLSS_CD,  IMDG_SUBS_RSK_LBL_CD1,
                        CARGO_TYPE, STWG_CD  ,
                          CASE WHEN FM_BKG_NO IS NOT NULL THEN DG_CNTR_SEQ 
                           ELSE NULL
                           END DG_CNTR_SEQ ,POD_CD, NULL CNTR_VOL_QTY,MLB,
                           MRN_POLUT_FLG,    
                           IMDG_LMT_QTY_FLG, 
                           PRCT_FLG, MTY_FLG,
                           Y.OVR_FWRD_LEN, Y.OVR_BKWD_LEN,Y.OVR_HGT,Y.OVR_LF_LEN, Y.OVR_RT_LEN , DCNT,'B1' CHK
                   FROM SPLIT_BKG X, BKG_AWK_CGO Y
                  WHERE SEQ = 1
                    AND NVL(X.CARGO_TYPE,'X') = 'A'
                    AND ( X.FM_BKG_NO = Y.BKG_NO OR  Y.BKG_NO IN ( SELECT BKG_NO FROM BKG_BOOKING WHERE FM_BKG_NO = X.FM_BKG_NO AND SPLIT_FLG ='Y'))
                    AND NVL(X.CNTR_NO,'') = NVL(Y.CNTR_NO,'')
                    AND X.CNTR_TPSZ_CD    = Y.CNTR_TPSZ_CD   ) Z ) YY
                   GROUP BY  
                    YY.MLB, YY.POD_CD, YY.CNTR_TPSZ_CD, YY.IMDG_UN_NO, YY.IMDG_CLSS_CD, YY.IMDG_SUBS_RSK_LBL_CD1, YY.MRN_POLUT_FLG, YY.IMDG_LMT_QTY_FLG, YY.PRCT_FLG,YY.STWG_CD,YY.CARGO_TYPE,
                    YY.OVR_FWRD_LEN, YY.OVR_BKWD_LEN,YY.OVR_HGT,YY.OVR_LF_LEN, YY.OVR_RT_LEN , YY.MTY_FLG, YY.FM_BKG_NO ,  YY.DG_CNTR_SEQ  ) AA ) BB			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="pol_clpt_ind_seq" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="bkg_sts_cd" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
