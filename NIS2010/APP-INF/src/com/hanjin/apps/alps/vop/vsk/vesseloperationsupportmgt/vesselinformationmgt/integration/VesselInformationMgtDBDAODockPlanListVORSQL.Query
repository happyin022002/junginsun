<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="VesselInformationMgtDBDAODockPlanListVORSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
SELECT VSL_CD,
       SCONTI_NM,
       DCK_LOC_CD,
       DCK_TGT_SKD,
       DCK_FM_DT,
       DCK_TO_DT,
       FLET_DCK_SVEY_TP_CD,
       FLET_DCK_STS_CD,
       USR_ID as UPD_USR_ID,
       UPD_DT
FROM   ( SELECT D.VSL_CD,
                R.SCONTI_NM,
                D.DCK_LOC_CD,
                CASE
                  WHEN MAX(TO_NUMBER(TO_CHAR(D.DCK_FM_DT,'MM'))) < 7
                  THEN '1st Half Year'
                  ELSE '2nd Half Year'
                END AS DCK_TGT_SKD,
                MAX(TO_CHAR(D.DCK_FM_DT, 'YYYY-MM-DD')) DCK_FM_DT,
                MAX(TO_CHAR(D.DCK_TO_DT, 'YYYY-MM-DD')) DCK_TO_DT,
                CASE D.FLET_DCK_SVEY_TP_CD
                  WHEN 'I' THEN 'Intermediate Class Survey'
                  WHEN 'D' THEN 'Docking Survey'
                  WHEN 'S' THEN 'Special Class Survey'
                  WHEN 'P' THEN 'Propeller Shaft Survey'
                  WHEN 'T' THEN 'Temporary Class Survey'
                  ELSE ''
                END AS FLET_DCK_SVEY_TP_CD,
                CASE D.FLET_DCK_STS_CD
                  WHEN 'C' THEN 'Completed'
                  WHEN 'E' THEN 'Estimated'
                  ELSE ''
                END AS FLET_DCK_STS_CD,
                MAX(D.UPD_USR_ID)                           USR_ID,
                MAX(TO_CHAR(D.UPD_DT,'YYYY-MM-DD HH24:MI')) UPD_DT
         FROM   FMS_DCK_SKD D, MDM_LOCATION L, MDM_SUBCONTINENT R
         WHERE  TO_CHAR(D.DCK_FM_DT,'YYYY') = @[year]
         #if (${vsl_cd} != '')
         AND    D.VSL_CD                 LIKE @[vsl_cd]||'%'
         #end
         AND    D.DCK_SEL_CD                = 'E'
         AND    D.DCK_LOC_CD                = L.LOC_CD(+)
         AND    L.SCONTI_CD                 = R.SCONTI_CD(+)
         GROUP BY D.VSL_CD, R.SCONTI_NM, D.DCK_LOC_CD, D.FLET_DCK_SVEY_TP_CD, D.FLET_DCK_STS_CD
         UNION ALL
         SELECT NVL(C.VSL_CD,NVL(E.VSL_CD,I.VSL_CD))                                        VSL_CD,
                NVL(C.DCK_RGN,NVL(E.DCK_RGN,I.DCK_RGN))                                     SCONTI_NM,
                NVL(C.DCK_PLC_DESC,NVL(E.DCK_PLC_DESC,I.DCK_PLC_DESC))                      DCK_LOC_CD,
                NVL(C.DCK_TGT_SKD,NVL(E.DCK_TGT_SKD,I.DCK_TGT_SKD))                         DCK_TGT_SKD,
                NVL(C.DCK_FM_DT,NVL(E.DCK_FM_DT,I.DCK_FM_DT))                               DCK_FM_DT,
                NVL(C.DCK_TO_DT,NVL(E.DCK_TO_DT,I.DCK_TO_DT))                               DCK_TO_DT,
                NVL(C.DCK_PLN_KND_DESC,NVL(E.DCK_PLN_KND_DESC,I.DCK_PLN_KND_DESC))          DCK_PLN_KND_DESC,
                NVL(C.FLET_DCK_SVEY_TP_CD,NVL(E.FLET_DCK_SVEY_TP_CD,I.FLET_DCK_SVEY_TP_CD)) FLET_DCK_SVEY_TP_CD,
                NVL(C.CRE_USR_ID,NVL(E.CRE_USR_ID,I.CRE_USR_ID))                            USR_ID,
                NVL(C.UPD_DT,NVL(E.UPD_DT,I.UPD_DT))                                        UPD_DT
         FROM   ( SELECT VSL_CD,
                         NULL DCK_RGN,
                         DCK_PLC_DESC,
                         CASE
                           WHEN TO_NUMBER(TO_CHAR(DCK_FM_DT,'MM')) < 7
                           THEN '1st Half Year'
                           ELSE '2nd Half Year'
                         END AS DCK_TGT_SKD,
                         TO_CHAR(DCK_FM_DT, 'YYYY-MM-DD') DCK_FM_DT,
                         TO_CHAR(DCK_TO_DT, 'YYYY-MM-DD') DCK_TO_DT,
                         DCK_PLN_KND_DESC,
                         'Initial Plan' FLET_DCK_SVEY_TP_CD,
                         CRE_USR_ID,
                         TO_CHAR(UPD_DT,'YYYY-MM-DD HH24:MI') UPD_DT
                  FROM   VSK_DCK_PLN
                  WHERE  TO_CHAR(DCK_FM_DT,'YYYY') = @[year]
                  #if (${vsl_cd} != '')
                  AND    VSL_CD                 LIKE @[vsl_cd]||'%'
                  #end
                  AND    DCK_PLN_PROC_CD = 'I' ) I,
                ( SELECT VSL_CD,
                         NULL DCK_RGN,
                         DCK_PLC_DESC,
                         CASE
                           WHEN TO_NUMBER(TO_CHAR(DCK_FM_DT,'MM')) < 7
                           THEN '1st Half Year'
                           ELSE '2nd Half Year'
                         END AS DCK_TGT_SKD,
                         TO_CHAR(DCK_FM_DT, 'YYYY-MM-DD') DCK_FM_DT,
                         TO_CHAR(DCK_TO_DT, 'YYYY-MM-DD') DCK_TO_DT,
                         DCK_PLN_KND_DESC,
                         'Execute Plan' FLET_DCK_SVEY_TP_CD,
                         CRE_USR_ID,
                         TO_CHAR(UPD_DT,'YYYY-MM-DD HH24:MI') UPD_DT
                  FROM   VSK_DCK_PLN
                  WHERE  TO_CHAR(DCK_FM_DT,'YYYY') = @[year]
                  #if (${vsl_cd} != '')
                  AND    VSL_CD                 LIKE @[vsl_cd]||'%'
                  #end
                  AND    DCK_PLN_PROC_CD = 'E' ) E,
                ( SELECT VSL_CD,
                         NULL DCK_RGN,
                         DCK_PLC_DESC,
                         CASE
                         WHEN TO_NUMBER(TO_CHAR(DCK_FM_DT,'MM')) < 7
                         THEN '1st Half Year'
                         ELSE '2nd Half Year'
                         END AS DCK_TGT_SKD,
                         TO_CHAR(DCK_FM_DT, 'YYYY-MM-DD') DCK_FM_DT,
                         TO_CHAR(DCK_TO_DT, 'YYYY-MM-DD') DCK_TO_DT,
                         DCK_PLN_KND_DESC,
                         'Completion' FLET_DCK_SVEY_TP_CD,
                         CRE_USR_ID,
                         TO_CHAR(UPD_DT,'YYYY-MM-DD HH24:MI') UPD_DT
                  FROM   VSK_DCK_PLN
                  WHERE  TO_CHAR(DCK_FM_DT,'YYYY') = @[year]
                  #if (${vsl_cd} != '')
                  AND    VSL_CD                 LIKE @[vsl_cd]||'%'
                  #end
                  AND    DCK_PLN_PROC_CD = 'C' ) C
         WHERE I.VSL_CD       = E.VSL_CD(+)
         AND   I.DCK_PLC_DESC = E.DCK_PLC_DESC(+)
         AND   I.VSL_CD       = C.VSL_CD(+)
         AND   I.DCK_PLC_DESC = C.DCK_PLC_DESC(+) )
ORDER BY VSL_CD, DCK_FM_DT, DCK_LOC_CD
			]]></sql>
			<params>
				<param name="year" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
