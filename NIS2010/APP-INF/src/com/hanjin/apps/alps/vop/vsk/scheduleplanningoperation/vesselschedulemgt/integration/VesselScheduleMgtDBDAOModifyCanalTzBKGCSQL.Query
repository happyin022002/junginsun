<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="VesselScheduleMgtDBDAOModifyCanalTzBKGCSQL">
			<desc><![CDATA[Canal Transit Booking 정보를 저장 및 업데이트]]></desc>
			<sql><![CDATA[
MERGE INTO VSK_CNL_TZ_BKG B
USING 
      (    
        SELECT   REPLACE(TO_CHAR(TO_DATE(@[start_date], 'YYYY-MM-DD'), 'YYYY-MM'), '-', '') AS CNL_TZ_BKG_YRMON
               , SUBSTR(@[vvd],1,4)     AS VSL_CD
               , SUBSTR(@[vvd],5,4)     AS SKD_VOY_NO
               , SUBSTR(@[vvd],9,1)     AS SKD_DIR_CD
               , @[vps_port_cd]         AS CNL_PORT_CD
               , DECODE(@[bound], 'North Bound', 'N', 'South Bound', 'S')        AS SVC_SCP_BND_CD
        FROM     DUAL
      )   X
ON    (
        B.CNL_TZ_BKG_YRMON  = X.CNL_TZ_BKG_YRMON
AND     B.VSL_CD            = X.VSL_CD
AND     B.SKD_VOY_NO        = X.SKD_VOY_NO
AND     B.SKD_DIR_CD        = X.SKD_DIR_CD
       )
    
WHEN MATCHED THEN 
  UPDATE SET 
    
	  CNL_TZ_BKG_PRD_CD        = @[cnl_tz_bkg_prd_cd]
	, CNL_TZ_BKG_PROC_STS_CD   = @[cnl_tz_bkg_proc_sts_cd]
    , CNL_BKG_TZ_DT            = TO_DATE(@[cnl_bkg_tz_dt], 'YYYY-MM-DD HH24:MI:SS')
    , CNL_OT_SVC_APRO_FLG      = @[cnl_ot_svc_apro_flg]
    , UPD_USR_ID               = @[usr_id]  
    , UPD_DT                   = SYSDATE
    , CNL_OT_SVC_ARR_DT        = TO_DATE(@[cnl_ot_svc_arr_dt], 'YYYY-MM-DD HH24:MI:SS')
    , CNL_BKG_AMT              = @[cnl_bkg_amt] 
    
WHEN NOT MATCHED THEN
  INSERT
  (
     CNL_TZ_BKG_YRMON
     , VSL_CD
     , SKD_VOY_NO
     , SKD_DIR_CD
     , CNL_PORT_CD
     , SVC_SCP_BND_CD
     , CNL_TZ_BKG_PRD_CD
     , CNL_TZ_BKG_PROC_STS_CD
     , CNL_BKG_TZ_DT
     , CNL_OT_SVC_APRO_FLG
     , CRE_USR_ID
     , CRE_DT
     , UPD_USR_ID
     , UPD_DT
     , CNL_OT_SVC_ARR_DT
     , CNL_BKG_AMT
  )
  VALUES
  (
	   REPLACE(TO_CHAR(TO_DATE(@[start_date], 'YYYY-MM-DD'), 'YYYY-MM'), '-', '')
     , SUBSTR(@[vvd],1,4)
     , SUBSTR(@[vvd],5,4)
     , SUBSTR(@[vvd],9,1)
     , @[vps_port_cd]
     , DECODE(@[bound], 'North Bound', 'N', 'South Bound', 'S')
     
     , @[cnl_tz_bkg_prd_cd]
     , @[cnl_tz_bkg_proc_sts_cd]
     , TO_DATE(@[cnl_bkg_tz_dt], 'YYYY-MM-DD HH24:MI:SS')
     , @[cnl_ot_svc_apro_flg]
    
     , @[usr_id]  
     , SYSDATE
	 , @[usr_id]   
     , SYSDATE
     , TO_DATE(@[cnl_ot_svc_arr_dt], 'YYYY-MM-DD HH24:MI:SS')
     , @[cnl_bkg_amt]

  )			]]></sql>
			<params>
				<param name="start_date" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="vps_port_cd" type="12" value="" out="N"/>
				<param name="bound" type="12" value="" out="N"/>
				<param name="cnl_tz_bkg_prd_cd" type="12" value="" out="N"/>
				<param name="cnl_tz_bkg_proc_sts_cd" type="12" value="" out="N"/>
				<param name="cnl_bkg_tz_dt" type="12" value="" out="N"/>
				<param name="cnl_ot_svc_apro_flg" type="12" value="" out="N"/>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="cnl_ot_svc_arr_dt" type="12" value="" out="N"/>
				<param name="cnl_bkg_amt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
