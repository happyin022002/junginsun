<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ProformaScheduleMgtDBDAOSearchNewPortExpenceRSQL">
			<desc><![CDATA[SearchNewPortExpence]]></desc>
			<sql><![CDATA[
SELECT  SUBSTR(YD_CD,6,7) AS YD_CD
        , PORT_ROTN_SEQ
        , SUM(CLASS01) AS SUM_CLASS01
        , SUM(CLASS02) AS SUM_CLASS02
        , SUM(CLASS03) AS SUM_CLASS03
        , ROUND((SUM(NVL(CLASS01,0))+SUM(NVL(CLASS02,0))+SUM(NVL(CLASS03,0)) ) / MAX(CLASS_CNT), 2) AS CLASS_AVG
        , SKD_DIR_CD
        , PORT_CD
        , CLPT_SEQ
FROM    (
        /* X02 : Start */
        SELECT  VSL_SLAN_CD
                , PF_SVC_TP_CD
                , T11.YD_CD AS YD_CD, PORT_ROTN_SEQ
                , VSL_CLASS
                , CLASS_CNT
                , SUM(DECODE(SEQ, 1, TTL_CHG_AMT)) CLASS01
                , SUM(DECODE(SEQ, 2, TTL_CHG_AMT)) CLASS02
                , SUM(DECODE(SEQ, 3, TTL_CHG_AMT)) CLASS03
                , SKD_DIR_CD
                , PORT_CD
                , CLPT_SEQ
        FROM    (
                /* X01 : Start */
                SELECT  VSL_SLAN_CD, PF_SVC_TP_CD
                        , YD_CD, PORT_ROTN_SEQ
                        , SEQ
                        , CASE WHEN (N1ST_VSL_CLSS_CD IS NULL OR N1ST_VSL_CLSS_CD = '0') THEN 0 ELSE 1 END +
                          CASE WHEN (N2ND_VSL_CLSS_CD IS NULL OR N2ND_VSL_CLSS_CD = '0') THEN 0 ELSE 1 END +
                          CASE WHEN (N3RD_VSL_CLSS_CD IS NULL OR N3RD_VSL_CLSS_CD = '0') THEN 0 ELSE 1 END
                          AS CLASS_CNT /* 투입된 VESSEL CLASS 종류를 COUNT*/
                        , DECODE(SEQ, 1, N1ST_VSL_CLSS_CD, 2, N2ND_VSL_CLSS_CD, 3, N3RD_VSL_CLSS_CD) AS VSL_CLASS
                        , SKD_DIR_CD,PORT_CD,CLPT_SEQ
                FROM    (
                	/* X00 : Start */
                        SELECT  SEQ, T01.VSL_SLAN_CD, T01.PF_SVC_TP_CD
                                ,T02.YD_CD, T02.PORT_ROTN_SEQ,               
                                DECODE(@[eventNav], 'R', N1ST_VSL_CLSS_CD,  @[n1st_vsl_clss_cd])  AS N1ST_VSL_CLSS_CD,
                                DECODE(@[eventNav], 'R', N1ST_VSL_CLSS_KNT, @[n1st_vsl_clss_knt]) AS N1ST_VSL_CLSS_KNT,
                                DECODE(@[eventNav], 'R', N2ND_VSL_CLSS_CD,  @[n2nd_vsl_clss_cd])  AS N2ND_VSL_CLSS_CD,
                                DECODE(@[eventNav], 'R', N2ND_VSL_CLSS_KNT, @[n2nd_vsl_clss_knt]) AS N2ND_VSL_CLSS_KNT,
                                DECODE(@[eventNav], 'R', N3RD_VSL_CLSS_CD,  @[n3rd_vsl_clss_cd])  AS N3RD_VSL_CLSS_CD,
                                DECODE(@[eventNav], 'R', N3RD_VSL_CLSS_KNT, @[n3rd_vsl_clss_knt]) AS N3RD_VSL_CLSS_KNT,
                                T02.SKD_DIR_CD,T02.PORT_CD,T02.CLPT_SEQ               
                        FROM    VSK_PF_SKD T01, VSK_PF_SKD_DTL T02
                                , (SELECT 1 SEQ FROM DUAL UNION ALL SELECT 2 FROM DUAL UNION ALL SELECT 3 FROM DUAL)                 
                        WHERE   T01.VSL_SLAN_CD     = T02.VSL_SLAN_CD
                        AND     T01.PF_SVC_TP_CD    = T02.PF_SVC_TP_CD
                        AND     T01.VSL_SLAN_CD     = @[vsl_slan_cd]
                        AND     T01.PF_SVC_TP_CD    = @[pf_svc_tp_cd]
                        AND     T02.TURN_PORT_IND_CD!= 'F'
                        /* X00 : End */
                        )
                /* X01 : End */
                ) T11, PSO_VSL_CLSS_TRF T12
        WHERE   1 = 1
        AND     T12.BSE_YR              (+) = @[slt_prc_wrk_yr]
        AND     T12.BSE_QTR_CD          (+) = @[bse_qtr_cd]
        AND     T12.CNTR_VSL_CLSS_CAPA  (+) = T11.VSL_CLASS
        AND     T12.YD_CD               (+) = T11.YD_CD
        GROUP BY VSL_SLAN_CD, PF_SVC_TP_CD, T11.YD_CD, PORT_ROTN_SEQ, VSL_CLASS, CLASS_CNT
                , SKD_DIR_CD, PORT_CD, CLPT_SEQ
        /* X02 : End */
        )
WHERE   1 = 1
GROUP BY YD_CD, PORT_ROTN_SEQ, SKD_DIR_CD, PORT_CD, CLPT_SEQ
ORDER BY PORT_ROTN_SEQ			]]></sql>
			<params>
				<param name="eventNav" type="12" value="" out="N"/>
				<param name="n1st_vsl_clss_cd" type="12" value="" out="N"/>
				<param name="n1st_vsl_clss_knt" type="12" value="" out="N"/>
				<param name="n2nd_vsl_clss_cd" type="12" value="" out="N"/>
				<param name="n2nd_vsl_clss_knt" type="12" value="" out="N"/>
				<param name="n3rd_vsl_clss_cd" type="12" value="" out="N"/>
				<param name="n3rd_vsl_clss_knt" type="12" value="" out="N"/>
				<param name="vsl_slan_cd" type="12" value="" out="N"/>
				<param name="pf_svc_tp_cd" type="12" value="" out="N"/>
				<param name="slt_prc_wrk_yr" type="12" value="" out="N"/>
				<param name="bse_qtr_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
