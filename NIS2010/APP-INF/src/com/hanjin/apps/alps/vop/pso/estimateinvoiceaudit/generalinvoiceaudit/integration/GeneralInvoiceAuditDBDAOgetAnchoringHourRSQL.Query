<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralInvoiceAuditDBDAOgetAnchoringHourRSQL">
			<desc><![CDATA[Tariff 비용 계산을 위해 해당 TDR 에서 Anchoring Hour을 구한다.
====================================================================
2011.04.05 CHM-201109983-01 진마리아 Anchoring Hours 로직을 시간 단위로 계산하도록 로직 수정
2014.03.06 CHM-201429135 이윤정 [PSO] Tariff simulation 로직 수정 - Achoring hour ( VSK_ACT_PORT_SKD 에 미존재 시 FCM_DEP_RPT 에서 조회)]]></desc>
			<sql><![CDATA[
SELECT NVL(DECODE(SIGN(VAL),-1, 0, VAL), 0) -- 없으면 무조건 0 처리 요청 받음
FROM (
    SELECT MAX(
               ROUND(
--                   (NVL(BFR_BRTH_ANK_OFF_DT - BFR_BRTH_ANK_DRP_DT,0)
--                  + NVL( AFT_UNBRTH_ANK_OFF_DT - AFT_UNBRTH_ANK_DRP_DT,0)) * 24, 2)
                   (NVL(NVL(T1.BFR_BRTH_ANK_OFF_DT,T2.BFR_BRTH_ANK_OFF_DT) - NVL(T1.BFR_BRTH_ANK_DRP_DT,T2.BFR_BRTH_ANK_DRP_DT),0)
                  + NVL(NVL(T1.AFT_UNBRTH_ANK_OFF_DT,T2.AFT_UNBRTH_ANK_OFF_DT) - NVL(T1.AFT_UNBRTH_ANK_DRP_DT,T2.AFT_UNBRTH_ANK_DRP_DT),0)) * 24, 2)

           ) VAL
    FROM VSK_ACT_PORT_SKD T1, FCM_DEP_RPT T2
    WHERE (T1.VSL_CD, T1.SKD_VOY_NO, T1.SKD_DIR_CD) IN (
                                                SELECT VSL_CD, 
                                                    DECODE(TURN_PORT_IND_CD, 'Y', SKD_VOY_NO, 'N', SKD_VOY_NO, TURN_SKD_VOY_NO) SKD_VOY_NO,
                                                    DECODE(TURN_PORT_IND_CD, 'Y', SKD_DIR_CD, 'N', SKD_DIR_CD, TURN_SKD_DIR_CD) SKD_DIR_CD
                                                FROM VSK_VSL_PORT_SKD
                                                WHERE VSL_CD = SUBSTR(@[vvd], 1, 4)
                                                AND SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
                                                AND SKD_DIR_CD = SUBSTR(@[vvd], 9)
                                                AND VPS_PORT_CD = SUBSTR(@[yd_cd], 1, 5))
    AND T1.VPS_PORT_CD = SUBSTR(@[yd_cd], 1, 5)
    AND	T1.VSL_CD		    = T2.VSL_CD		    (+)
    AND	T1.SKD_VOY_NO		= T2.SKD_VOY_NO		(+)
    AND	T1.SKD_DIR_CD		= T2.SKD_DIR_CD		(+)
    AND	T1.VPS_PORT_CD		= T2.DEP_PORT_CD	(+)
    AND	T1.CLPT_IND_SEQ		= T2.CLPT_IND_SEQ	(+)

)			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
