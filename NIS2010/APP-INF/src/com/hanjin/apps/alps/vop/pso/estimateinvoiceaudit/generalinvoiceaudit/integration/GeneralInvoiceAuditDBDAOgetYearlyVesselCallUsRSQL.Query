<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralInvoiceAuditDBDAOgetYearlyVesselCallUsRSQL">
			<desc><![CDATA[[CHM-201533647] 해당 년동안 해당 vessel이  미국내 port에 calling하는 횟수]]></desc>
			<sql><![CDATA[
select nvl(count(*),0)
#if (${budget_flag} == 'B') 
from vsk_bud_vsl_port_skd 
#else 
from vsk_vsl_port_skd 
#end
   where VSL_CD = substr(@[vvd], 1, 4)
   and vps_port_cd like substr(@[yd_cd], 1, 2)||'%'
   and NVL(SKD_CNG_STS_CD,'X') <> 'S'
   and vps_etb_dt <= (select max(vps_etb_dt)
                      #if (${budget_flag} == 'B') 
                      from vsk_bud_vsl_port_skd 
                      #else 
                      from vsk_vsl_port_skd 
                      #end
                      where VSL_CD = substr(@[vvd], 1, 4)
                      AND SKD_VOY_NO = substr(@[vvd], 5, 4)
                      AND SKD_DIR_CD = substr(@[vvd], 9)
                      and vps_port_cd = substr(@[yd_cd], 1, 5))
and TURN_PORT_IND_CD IN ('N','Y')
and to_char(vps_etb_dt,'YYYY') = (select max(to_char(vps_etb_dt,'YYYY'))
                                  #if (${budget_flag} == 'B') 
                                  from vsk_bud_vsl_port_skd 
                                  #else 
                                  from vsk_vsl_port_skd 
                                  #end
                                  where VSL_CD = substr(@[vvd], 1, 4)
                                  AND SKD_VOY_NO = substr(@[vvd], 5, 4)
                                  AND SKD_DIR_CD = substr(@[vvd], 9)
                                  and vps_port_cd = substr(@[yd_cd], 1, 5))			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
