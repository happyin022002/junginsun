<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralInvoiceAuditDBDAOSearchConvertedAmountOtherRSQL">
			<desc><![CDATA[USD 통화를 제외한 환율 변환 금액을 구하기 위함 ]]></desc>
			<sql><![CDATA[
SELECT AMT,  CASE WHEN AMT <> 0 THEN '1 '||@[curr_cd] ||' = '|| ROUND(@[amt] / AMT,2) ||' '|| @[bcurr_cd]
                  ELSE NULL  
             END,
       CASE WHEN AMT <> 0 THEN ROUND(@[amt] / AMT,2)
            ELSE NULL
            END 
FROM 
( 
  WITH AMT_USD AS (
   SELECT ROUND(@[amt] / A.USD_LOCL_XCH_RT, DP_USD) AMT
     FROM GL_MON_XCH_RT A ,(SELECT MAX(DECODE(B.CURR_CD, 'USD', B.DP_PRCS_KNT))  DP_USD
                              FROM MDM_CURRENCY  B
                             WHERE B.CURR_CD IN ( @[bcurr_cd], 'USD')) B 
    WHERE A.ACCT_XCH_RT_YRMON = SUBSTR(@[dt], 1, 6)
      AND A.ACCT_XCH_RT_LVL = 1  
      AND A.CURR_CD =  @[bcurr_cd]
    UNION ALL
    SELECT ROUND(@[amt] / A.USD_LOCL_XCH_RT, DP_USD) AMT
      FROM GL_MON_XCH_RT A,(SELECT MAX(DECODE(B.CURR_CD, 'USD', B.DP_PRCS_KNT)) DP_USD
                              FROM MDM_CURRENCY  B
                             WHERE B.CURR_CD IN ( @[bcurr_cd], 'USD')  ) B 
     WHERE A.ACCT_XCH_RT_YRMON = SUBSTR((SELECT MAX(ACCT_XCH_RT_YRMON) FROM GL_MON_XCH_RT), 1, 6)
       AND A.ACCT_XCH_RT_LVL = 1  
       AND A.CURR_CD = @[bcurr_cd] )

SELECT ROUND(C.AMT * A.USD_LOCL_XCH_RT, DP_LOCAL) AMT
  FROM GL_MON_XCH_RT A,(SELECT MAX(DECODE(B.CURR_CD, @[curr_cd], B.DP_PRCS_KNT)) DP_LOCAL 
                          FROM MDM_CURRENCY  B
                         WHERE B.CURR_CD IN (@[curr_cd], 'USD')) B , AMT_USD C
  WHERE A.ACCT_XCH_RT_YRMON = SUBSTR(@[dt], 1, 6)
    AND A.ACCT_XCH_RT_LVL = 1  
    AND A.CURR_CD = @[curr_cd]
UNION ALL
SELECT ROUND(C.AMT * A.USD_LOCL_XCH_RT, DP_LOCAL) AMT
  FROM GL_MON_XCH_RT A ,(SELECT MAX(DECODE(B.CURR_CD, @[curr_cd], B.DP_PRCS_KNT)) DP_LOCAL 
                           FROM MDM_CURRENCY  B
                          WHERE B.CURR_CD IN (@[curr_cd], 'USD') ) B ,AMT_USD C 
 WHERE A.ACCT_XCH_RT_YRMON = SUBSTR((SELECT MAX(ACCT_XCH_RT_YRMON) FROM GL_MON_XCH_RT), 1, 6)
   AND A.ACCT_XCH_RT_LVL = 1  
   AND A.CURR_CD = @[curr_cd] )			]]></sql>
			<params>
				<param name="curr_cd" type="12" value="" out="N"/>
				<param name="amt" type="12" value="" out="N"/>
				<param name="bcurr_cd" type="12" value="" out="N"/>
				<param name="dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
