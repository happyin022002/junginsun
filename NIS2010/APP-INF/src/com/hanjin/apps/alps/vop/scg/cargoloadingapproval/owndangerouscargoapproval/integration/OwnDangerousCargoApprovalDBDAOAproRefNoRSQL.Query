<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OwnDangerousCargoApprovalDBDAOAproRefNoRSQL">
			<desc><![CDATA[AproRefNo를 생성하는 화면]]></desc>
			<sql><![CDATA[
SELECT  DECODE(COUNT(A.BKG_NO), ( 
            SELECT COUNT(BKG_NO) FROM BKG_DG_CGO WHERE BKG_NO = A.BKG_NO ), (
                SELECT  'SML'||'POL'||TO_CHAR(SYSDATE, 'YYMMDD')||
                        DECODE(NVL(LENGTH(MAX(SUBSTR(APRO_REF_NO,13,15))+1),0),
                	        0, '001',
                            1, '00'||TO_CHAR(MAX(SUBSTR(APRO_REF_NO,13,15))+1),
                        	2, '0'||TO_CHAR(MAX(SUBSTR(APRO_REF_NO,13,15))+1),
                            3, TO_CHAR(MAX(SUBSTR(APRO_REF_NO,13,15))+1) 
                        )
                FROM SCG_AUTHORIZATION
                WHERE SUBSTR(APRO_REF_NO,1,12) = 'SML'||'POL'||TO_CHAR(SYSDATE, 'yymmdd')
                ), ''
        ) AS APRO_REF_NO 
FROM SCG_AUTHORIZATION A, SCG_VVD_APRO_RQST B
WHERE A.BKG_NO = B.BKG_NO 
AND A.SPCL_CGO_APRO_RQST_SEQ = B.SPCL_CGO_APRO_RQST_SEQ
AND A.VSL_PRE_PST_CD = B.VSL_PRE_PST_CD
AND A.VSL_SEQ = B.VSL_SEQ
AND A.BKG_NO = 'VLCZ1140042'
AND A.SPCL_CGO_APRO_RQST_SEQ = '1'
AND A.SPCL_CGO_AUTH_CD = 'Y'
GROUP BY A.BKG_NO			]]></sql>
			<params>
			</params>
		</query>
	</querys>
</sqls>
