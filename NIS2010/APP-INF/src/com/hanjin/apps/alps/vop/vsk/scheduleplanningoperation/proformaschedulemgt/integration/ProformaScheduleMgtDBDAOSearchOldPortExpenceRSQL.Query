<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ProformaScheduleMgtDBDAOSearchOldPortExpenceRSQL">
			<desc><![CDATA[SearchOldPortExpence]]></desc>
			<sql><![CDATA[
SELECT	MAX(SKD_DIR_CD		) AS SKD_DIR_CD
		, MAX(PORT_CD			) AS PORT_CD
		, MAX(SUBSTR(YD_CD, 6,2)) AS YD_CD
		, MAX(CLPT_SEQ			) AS CLPT_SEQ
		, PORT_ROTN_SEQ
		, MAX(SEQ) 				  AS CLASS_CNT
		, MAX(VSL_CLASS01		) AS VSL_CLASS01
		, MAX(N1ST_VSL_CLSS_KNT	) AS CLASS_CNT01		
		, MAX(VSL_CLASS02		) AS VSL_CLASS02
		, MAX(N2ND_VSL_CLSS_KNT	) AS CLASS_CNT02	
		, MAX(VSL_CLASS03		) AS VSL_CLASS03
		, MAX(N3RD_VSL_CLSS_KNT	) AS CLASS_CNT03
		, MAX(SUM_CLASS01		) AS SUM_CLASS01
		, MAX(SUM_CLASS02		) AS SUM_CLASS02
		, MAX(SUM_CLASS03		) AS SUM_CLASS03
		, SUM(NVL(SUM_CLASS01, 0) + NVL(SUM_CLASS02, 0) + NVL(SUM_CLASS03, 0)) / MAX(SEQ) AS CLASS_AVG
FROM	(
		SELECT  SEQ, VSL_CLSS_CD, SKD_DIR_CD, PORT_CD, CLPT_SEQ, PORT_ROTN_SEQ, YD_CD
				, MAX(DECODE(SEQ, 1, VSL_CLSS_CD	)) AS VSL_CLASS01
				, MAX(DECODE(SEQ, 1, VSL_CLSS_KNT	)) AS N1ST_VSL_CLSS_KNT
				, MAX(DECODE(SEQ, 1, PE_AMT			)) AS SUM_CLASS01
				, MAX(DECODE(SEQ, 2, VSL_CLSS_CD	)) AS VSL_CLASS02
				, MAX(DECODE(SEQ, 2, VSL_CLSS_KNT	)) AS N2ND_VSL_CLSS_KNT
				, MAX(DECODE(SEQ, 2, PE_AMT			)) AS SUM_CLASS02
				, MAX(DECODE(SEQ, 3, VSL_CLSS_CD	)) AS VSL_CLASS03
				, MAX(DECODE(SEQ, 3, VSL_CLSS_KNT	)) AS N3RD_VSL_CLSS_KNT
				, MAX(DECODE(SEQ, 3, PE_AMT			)) AS SUM_CLASS03
		FROM    (
				SELECT  /*+ INDEX (T XPKVSK_SLT_PRC_PORT_DTL) +*/
						T1.VSL_SLAN_CD, T1.PF_SVC_TP_CD, T2.PORT_CD, T2.SKD_DIR_CD
						, T2.YD_CD, T2.CLPT_SEQ
						, T2.PORT_ROTN_SEQ, T1.VSL_CLSS_CD, T2.PE_AMT, T1.VSL_CLSS_KNT
						, DENSE_RANK() OVER (ORDER BY T2.VSL_CLSS_CD) AS SEQ
				FROM    VSK_SLT_PRC_DTL T1, VSK_SLT_PRC_PORT_DTL T2
				WHERE   1                   = 1
				AND		T1.VSL_SLAN_CD		= T2.VSL_SLAN_CD
				AND		T1.PF_SVC_TP_CD		= T2.PF_SVC_TP_CD
				AND		T1.SLT_PRC_WRK_YR	= T2.SLT_PRC_WRK_YR
				AND		T1.BSE_QTR_CD		= T2.BSE_QTR_CD
				AND		T1.VSL_CLSS_CD		= T2.VSL_CLSS_CD
				AND     T1.VSL_SLAN_CD     = @[vsl_slan_cd]
				AND     T1.PF_SVC_TP_CD    = @[pf_svc_tp_cd]
				AND     T1.SLT_PRC_WRK_YR  = @[slt_prc_wrk_yr]
				AND     T1.BSE_QTR_CD      = @[bse_qtr_cd]
				)
		GROUP BY VSL_CLSS_CD, PORT_ROTN_SEQ, PORT_CD,YD_CD, SEQ,SKD_DIR_CD, CLPT_SEQ, PORT_ROTN_SEQ
		)
GROUP BY PORT_ROTN_SEQ
ORDER BY PORT_ROTN_SEQ			]]></sql>
			<params>
				<param name="vsl_slan_cd" type="12" value="" out="N"/>
				<param name="pf_svc_tp_cd" type="12" value="" out="N"/>
				<param name="slt_prc_wrk_yr" type="12" value="" out="N"/>
				<param name="bse_qtr_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
