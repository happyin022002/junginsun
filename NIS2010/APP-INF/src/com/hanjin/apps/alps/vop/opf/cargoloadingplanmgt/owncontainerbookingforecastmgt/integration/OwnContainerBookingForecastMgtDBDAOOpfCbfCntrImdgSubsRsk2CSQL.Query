<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OwnContainerBookingForecastMgtDBDAOOpfCbfCntrImdgSubsRsk2CSQL">
			<desc><![CDATA[OpfCbfCntrImdgSubsRsk2]]></desc>
			<sql><![CDATA[
INSERT INTO OPF_CBF_CNTR_IMDG_SUBS_RSK(
            VSL_CD
          , SKD_VOY_NO
          , SKD_DIR_CD
          , BKG_SHPR_OWNR_FLG
          , CRR_CD
          , YD_CD
          , POL_CLPT_IND_SEQ
          , CBF_SMRY_SEQ
          , IMDG_SUBS_RSK_LBL_CD
          , CRE_USR_ID
          , CRE_DT
          , UPD_USR_ID
          , UPD_DT)
   SELECT @[vsl_cd], 
          @[skd_voy_no], 
          @[skd_dir_cd], 
          'N', 
          @[crr_cd], 
          @[yd_cd],
          @[pol_clpt_ind_seq],
          #if (${cbf_smry_seq} != '')
          @[cbf_smry_seq],
          #else
          (SELECT /*+INDEX_DESC(X XPKOPF_CGO_BKG_FCAST_CNTR)*/
                  NVL (MAX (CBF_SMRY_SEQ), 1)
             FROM OPF_CGO_BKG_FCAST_CNTR X
            WHERE X.VSL_CD = @[vsl_cd]
              AND X.SKD_VOY_NO = @[skd_voy_no]
              AND X.SKD_DIR_CD = @[skd_dir_cd]
              AND X.BKG_SHPR_OWNR_FLG = 'N'
              AND X.CRR_CD = @[crr_cd]
              AND X.YD_CD = @[yd_cd]) + Z.RNUM - Z.RNUM CBF_SMRY_SEQ,
          #end
          SPLITVAL IMDG_SUBS_RSK_LBL_CD, 'SYSUSER' CRE_USR_ID, SYSDATE CRE_DT,
          'SYSUSER' UPD_USR_ID, SYSDATE UPD_DT
     FROM DUAL X,
          (SELECT B.RN RNUM, B.RN, B.RN, B.RN, B.RN, B.RN, B.RN,
                  SUBSTR ('/' || DECODE(@[imdg_subs_rsk_lbl_cd],'+','',@[imdg_subs_rsk_lbl_cd]) || '/',
                          INSTR ('/' || DECODE(@[imdg_subs_rsk_lbl_cd],'+','',@[imdg_subs_rsk_lbl_cd]) || '/', '/', 1, B.RN) + 1,
                            INSTR ('/' || DECODE(@[imdg_subs_rsk_lbl_cd],'+','',@[imdg_subs_rsk_lbl_cd]) || '/', '/', 1, B.RN + 1)
                          - INSTR ('/' || DECODE(@[imdg_subs_rsk_lbl_cd],'+','',@[imdg_subs_rsk_lbl_cd]) || '/', '/', 1, B.RN)
                          - 1
                         ) SPLITVAL,
                  B.RN, SYSDATE, B.RN, SYSDATE
             FROM (SELECT '/' || DECODE(@[imdg_subs_rsk_lbl_cd],'+','',@[imdg_subs_rsk_lbl_cd]) || '/' VAL
                     FROM DUAL) A,
                  (SELECT ROWNUM RN
                     FROM DICT) B
            WHERE   LENGTH ('/' || DECODE(@[imdg_subs_rsk_lbl_cd],'+','',@[imdg_subs_rsk_lbl_cd]) || '/')
                  - LENGTH (REPLACE ('/' || DECODE(@[imdg_subs_rsk_lbl_cd],'+','',@[imdg_subs_rsk_lbl_cd]) || '/', '/', ''))
                  - 1 >= B.RN) Z			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="crr_cd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="pol_clpt_ind_seq" type="12" value="" out="N"/>
				<param name="cbf_smry_seq" type="12" value="" out="N"/>
				<param name="imdg_subs_rsk_lbl_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
