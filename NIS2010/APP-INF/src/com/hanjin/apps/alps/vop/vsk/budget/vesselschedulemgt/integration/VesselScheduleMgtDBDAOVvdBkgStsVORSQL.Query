<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="VesselScheduleMgtDBDAOVvdBkgStsVORSQL">
			<desc><![CDATA[신규로 생성한 VVD에 대해서 이미 등록되여 사용 중인지 확인한다.

* History
* 2011.02.22 진마리아 CHM-201108456-01 사업계획용 스케줄 정보 노출 대응을 위한 시스템 업데이트건]]></desc>
			<sql><![CDATA[
/*
SimulationVvdCheckVO.java
SELECT 
'' VSL_CD
,'' SKD_VOY_NO
,'' START_DATE
,'' END_DATE
,'' VSL_CNT
,'' VOY_NO_TYPE
,'' SKD_DIR_CD_1
,'' SKD_DIR_CD_2
,'' DURATION
FROM DUAL
*/

SELECT      XX.LRS_KIND_CD
        ,   XX.VSL_SLAN_CD
        ,   XX.VSL_CD
        ,   XX.SKD_VOY_NO
        ,   XX.SKD_DIR_CD
        ,   CASE WHEN XX.LRS_KIND_CD = 'BUD' THEN XX.BKG_STATUS
                 ELSE 'Exist in LIVE'
            END  AS BKG_STATUS
        ,   XX.VIR_BKG_STATUS
        ,   TO_CHAR(XX.VPS_ETA_DT, 'YYYYMMDD') START_ETA
        ,   CASE WHEN XX.LRS_KIND_CD = 'LIVE' THEN  'YES'
                 ELSE 'YES'
            END  AS UPDATE_FLAG
        ,   XX.TURN_SKD_VOY_NO
        ,   XX.TURN_SKD_DIR_CD
        ,   XX.RUSE_PROHI_FLG
FROM        (
            SELECT    X.LRS_KIND_CD
                  ,   X.VSL_SLAN_CD
                  ,   X.VSL_CD
                  ,   X.SKD_VOY_NO
                  ,   X.SKD_DIR_CD
                  ,   X.BKG_STATUS
                  ,   X.VIR_BKG_STATUS
                  ,   X.VPS_ETA_DT
                  ----,   ROUND(VPS_ETA_DT - SYSDATE)
                  ,   X.TURN_SKD_VOY_NO
                  ,   X.TURN_SKD_DIR_CD
                  ,   X.RUSE_PROHI_FLG
                  ,   X.VSL_SLAN_DIR_SEQ 
                  ,   RANK() OVER (PARTITION BY X.VSL_CD, X.SKD_VOY_NO, X.SKD_DIR_CD ORDER BY X.LRS_SEQ DESC) AS VVD_DUP_KNT
            FROM      (
                      --====================================================================
                      SELECT    'BUD'           AS LRS_KIND_CD
                            ,   '1'             AS LRS_SEQ
                            ,   T1.VSL_SLAN_CD
                            ,   T1.VSL_CD
                            ,   T1.SKD_VOY_NO
                            ,   T1.SKD_DIR_CD
                            ,   'X' BKG_STATUS
                            ,   T1.SKD_STS_CD VIR_BKG_STATUS
                            ,   VPS_ETA_DT
                            ----,   ROUND(VPS_ETA_DT - SYSDATE)
                            ,   T2.TURN_SKD_VOY_NO
                            ,   T2.TURN_SKD_DIR_CD
                            ,   T1.RUSE_PROHI_FLG
                            ,   T3.VSL_SLAN_DIR_SEQ                  
                        FROM    VSK_BUD_VSL_SKD       T1
                             ,  VSK_BUD_VSL_PORT_SKD  T2
                             ,  MDM_VSL_SVC_LANE_DIR  T3
                        WHERE   1 = 1
                        AND     T1.VSL_CD             = T2.VSL_CD(+)
                        AND     T1.SKD_VOY_NO         = T2.SKD_VOY_NO(+)
                        AND     T1.SKD_DIR_CD         = T2.SKD_DIR_CD(+)
                        AND     T1.VSL_SLAN_CD        = T3.VSL_SLAN_CD
                        AND     T1.SKD_DIR_CD         = T3.VSL_SLAN_DIR_CD
                        AND     T2.CLPT_SEQ(+)        = 1
                        AND     (T1.VSL_CD, T1.SKD_VOY_NO, T1.SKD_DIR_CD) IN (
                        
#foreach(${param} in ${tgtVvd})
	#if($velocityCount < $tgtVvd.size())
		('${param.vslCd}', '${param.skdVoyNo}', '${param.skdDirCd}'),
	#else
		('${param.vslCd}', '${param.skdVoyNo}', '${param.skdDirCd}')
	#end
#end
                        )
                      -------------------------------------------------------------  

                      UNION ALL
                      
                      -------------------------------------------------------------              
                      SELECT    'LIVE'           AS LRS_KIND_CD
                            ,   '2'             AS LRS_SEQ                      
                            ,   VS.VSL_SLAN_CD
                            ,   VS.VSL_CD
                            ,   VS.SKD_VOY_NO
                            ,   VS.SKD_DIR_CD
                            ,   'X' BKG_STATUS
                            ,   VS.SKD_STS_CD VIR_BKG_STATUS
                            ,   VPS_ETA_DT
                            ----,   ROUND(VPS_ETA_DT - SYSDATE)
                            ,   PS.TURN_SKD_VOY_NO
                            ,   PS.TURN_SKD_DIR_CD
                            ,   VS.RUSE_PROHI_FLG
                            ,   SL.VSL_SLAN_DIR_SEQ
                        FROM    VSK_VSL_SKD       VS
                             ,  VSK_VSL_PORT_SKD  PS
                             ,  MDM_VSL_SVC_LANE_DIR  SL
                        WHERE   1 = 1
                        AND     VS.VSL_CD             = PS.VSL_CD(+)
                        AND     VS.SKD_VOY_NO         = PS.SKD_VOY_NO(+)
                        AND     VS.SKD_DIR_CD         = PS.SKD_DIR_CD(+)
                        AND     VS.VSL_SLAN_CD        = SL.VSL_SLAN_CD
                        AND     VS.SKD_DIR_CD         = SL.VSL_SLAN_DIR_CD
                        AND     PS.CLPT_SEQ(+)        = 1
                        AND     (VS.VSL_CD, VS.SKD_VOY_NO, VS.SKD_DIR_CD) IN (
                        
#foreach(${param} in ${tgtVvd})
	#if($velocityCount < $tgtVvd.size())
		('${param.vslCd}', '${param.skdVoyNo}', '${param.skdDirCd}'),
	#else
		('${param.vslCd}', '${param.skdVoyNo}', '${param.skdDirCd}')
	#end
#end
                        )
                      --====================================================================
                      ) X     

             
            ) XX
WHERE       XX.VVD_DUP_KNT = 1            
ORDER BY    XX.VSL_CD
      ,     XX.SKD_VOY_NO
      ,     XX.VSL_SLAN_DIR_SEQ
			]]></sql>
			<params>
			</params>
		</query>
	</querys>
</sqls>
