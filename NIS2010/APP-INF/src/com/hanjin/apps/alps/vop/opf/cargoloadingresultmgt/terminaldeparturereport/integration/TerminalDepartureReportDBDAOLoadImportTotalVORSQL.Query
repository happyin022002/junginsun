<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TerminalDepartureReportDBDAOLoadImportTotalVORSQL">
			<desc><![CDATA[-------------------------------------------------------------------------------------------------------------------
1. 2012.12.03 CHM-201221299-01 이혜민 신규 장비 R8,R9 을 40’HC으로 분류하여 CBF 및 COD 메뉴에 반영

2. 2012.12.11 [CHM-201221836] 이수진 TOR: Load/Discharge Vol 을 Bkg data에서 Import시 source 변경
   1) Vol 산정 기준 : 기존 BKG 단위에서 CNTR 단위로 변경
   2) Weight 산정 기준 : 기존 Cargo 무게에서 Cargo 무게 + CNTR 무게 합으로 변경]]></desc>
			<sql><![CDATA[
SELECT 'SML' OPR_CD
   ,   POD_CD
   ,   SUM(DECODE(BKG_CGO_TP_CD, 'F', DECODE(SUBSTR(CNTR_TPSZ_CD, 2, 1), '2', 1, NULL), NULL)) FULL_BO_20
   ,   SUM(DECODE(BKG_CGO_TP_CD, 'F', DECODE(SUBSTR(CNTR_TPSZ_CD, 2, 1), '3', 1, NULL), NULL)) FULL_BO_2H
   ,   SUM(DECODE(BKG_CGO_TP_CD, 'F', DECODE(SUBSTR(CNTR_TPSZ_CD, 2, 1), '4', 1, NULL), NULL)) FULL_BO_40
   ,   SUM(DECODE(BKG_CGO_TP_CD, 'F', DECODE(SUBSTR(CNTR_TPSZ_CD, 2, 1), '5', 1, CASE WHEN CNTR_TPSZ_CD IN ('R8', 'R9') THEN 1 ELSE NULL END), NULL)) FULL_BO_4H
   ,   SUM(DECODE(BKG_CGO_TP_CD, 'F', DECODE(SUBSTR(CNTR_TPSZ_CD, 2, 1), '7', 1, NULL), NULL)) FULL_BO_45
   ,   SUM(DECODE(BKG_CGO_TP_CD, 'F', DECODE(SUBSTR(CNTR_TPSZ_CD, 2, 1), 'X', 1, NULL), NULL)) FULL_BO_DX
   ,   SUM(DECODE(BKG_CGO_TP_CD, 'F', NULL, DECODE(SUBSTR(CNTR_TPSZ_CD, 2, 1), '2', 1, NULL))) ET_BO_20
   ,   SUM(DECODE(BKG_CGO_TP_CD, 'F', NULL, DECODE(SUBSTR(CNTR_TPSZ_CD, 2, 1), '3', 1, NULL))) ET_BO_2H
   ,   SUM(DECODE(BKG_CGO_TP_CD, 'F', NULL, DECODE(SUBSTR(CNTR_TPSZ_CD, 2, 1), '4', 1, NULL))) ET_BO_40
   ,   SUM(DECODE(BKG_CGO_TP_CD, 'F', NULL, DECODE(SUBSTR(CNTR_TPSZ_CD, 2, 1), '5', 1, CASE WHEN CNTR_TPSZ_CD IN ('R8', 'R9') THEN 1 ELSE NULL END))) ET_BO_4H
   ,   SUM(DECODE(BKG_CGO_TP_CD, 'F', NULL, DECODE(SUBSTR(CNTR_TPSZ_CD, 2, 1), '7', 1, NULL))) ET_BO_45
   ,   SUM(DECODE(BKG_CGO_TP_CD, 'F', NULL, DECODE(SUBSTR(CNTR_TPSZ_CD, 2, 1), 'X', 1, NULL))) ET_BO_DX
   ,   ROUND(SUM(DECODE(SUBSTR(CNTR_TPSZ_CD, 2, 1), '2', CNTR_WGT, NULL)) / 1000,  1)   WT_20
   ,   ROUND(SUM(DECODE(SUBSTR(CNTR_TPSZ_CD, 2, 1), '3', CNTR_WGT, NULL)) / 1000,  1)   WT_2H
   ,   ROUND(SUM(DECODE(SUBSTR(CNTR_TPSZ_CD, 2, 1), '4', CNTR_WGT, NULL)) / 1000,  1)   WT_40
   ,   ROUND(SUM(DECODE(SUBSTR(CNTR_TPSZ_CD, 2, 1), '5', CNTR_WGT, CASE WHEN CNTR_TPSZ_CD IN ('R8', 'R9') THEN CNTR_WGT ELSE NULL END)) / 1000,  1)   WT_4H
   ,   ROUND(SUM(DECODE(SUBSTR(CNTR_TPSZ_CD, 2, 1), '7', CNTR_WGT, NULL)) / 1000,  1)   WT_45
   ,   ROUND(SUM(DECODE(SUBSTR(CNTR_TPSZ_CD, 2, 1), 'X', CNTR_WGT, NULL)) / 1000,  1)   WT_DX
FROM   (

    SELECT XX.POD_CD, XX.BKG_CGO_TP_CD, XX.CNTR_TPSZ_CD, XX.CNTR_NO
       ,   XX.CNTR_WGT + (SELECT C.CNTR_TPSZ_TARE_WGT FROM MDM_CNTR_TP_SZ C WHERE C.CNTR_TPSZ_CD = XX.CNTR_TPSZ_CD)  CNTR_WGT
    FROM   (

        SELECT V.POD_CD, B.BKG_CGO_TP_CD, C.CNTR_TPSZ_CD, C.CNTR_NO
           ,   SUM(DECODE(C.WGT_UT_CD,'KGS',C.CNTR_WGT,'LBS',C.CNTR_WGT*0.453599,C.CNTR_WGT)) CNTR_WGT 
        FROM   VSK_VSL_PORT_SKD S, BKG_VVD V, BKG_CONTAINER C, BKG_BOOKING B, MDM_LOCATION L, MDM_LOCATION D
        WHERE  S.VSL_CD       = @[vsl_cd] 
        AND    S.SKD_VOY_NO   = @[voy_no] 
        AND    S.SKD_DIR_CD   = @[dir_cd] 
        AND    S.YD_CD        = @[yd_cd]
        AND    S.CLPT_IND_SEQ = @[clpt_ind_seq]
        AND    S.VSL_CD       = V.VSL_CD
        AND    S.SKD_VOY_NO   = V.SKD_VOY_NO
        AND    S.SKD_DIR_CD   = V.SKD_DIR_CD
        AND    S.VPS_PORT_CD  = V.POL_CD
        AND    S.CLPT_IND_SEQ = NVL(V.POL_CLPT_IND_SEQ,1)
        AND    V.BKG_NO     = C.BKG_NO
        AND    V.BKG_NO     = B.BKG_NO
        AND    NVL(B.BKG_STS_CD,'N') IN ('F', 'W', 'A')
        AND    V.POL_CD     = L.LOC_CD
        AND    V.POD_CD     = D.LOC_CD        
        #if (${status1} == 'LM') 
        AND    L.CONTI_CD   <> D.CONTI_CD
        #else 
        AND    L.CONTI_CD   = D.CONTI_CD
        #end
        GROUP BY V.POD_CD, B.BKG_CGO_TP_CD, C.CNTR_TPSZ_CD, C.CNTR_NO
           )XX
     )
       
GROUP BY POD_CD			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="voy_no" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="clpt_ind_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
