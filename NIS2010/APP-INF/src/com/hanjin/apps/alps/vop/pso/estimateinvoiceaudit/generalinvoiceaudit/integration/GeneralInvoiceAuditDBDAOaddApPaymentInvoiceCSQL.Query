<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralInvoiceAuditDBDAOaddApPaymentInvoiceCSQL">
			<desc><![CDATA[addApPaymentInvoice]]></desc>
			<sql><![CDATA[
INSERT INTO AP_PAY_INV
(
INV_RGST_NO,        --PUS20090100090
INV_SUB_SYS_CD,
INV_OFC_CD,
COST_OFC_CD,
VNDR_SEQ,
YD_CD,
INV_NO,
INV_ISS_DT,
INV_RCV_DT,
INV_EFF_DT,
INV_CFM_DT,
VNDR_TERM_NM,
PAY_DUE_DT,    
INV_CURR_CD,
INV_TTL_AMT,
INV_VAT_AMT,
INV_NET_AMT,
INV_DDCT_AMT,
TAX_RFND_FLG,--'N'
INV_AMT,
JO_FLG,--'N'
COM_VVD_FLG,--'N'
INV_RJCT_FLG,--'N'
INV_CXL_FLG,--'N'
EVID_HLD_FLG,--'N'
DELT_FLG,--'N'
CRE_USR_ID,
CRE_DT,
UPD_USR_ID,
UPD_DT
)
select 
    (	SELECT CASE
       		WHEN A.CNT = 0 THEN SUBSTR(@[cost_ofc_cd],1,3)||TO_CHAR(SYSDATE,'YYYYMM')||'00001'
       		ELSE SUBSTR(@[cost_ofc_cd],1,3)||RGST_NO
       	END  INV_RGST_NO
	FROM   ( SELECT COUNT(*) CNT
         	FROM   AP_PAY_INV
         	WHERE  SUBSTR(INV_RGST_NO,1,9) = SUBSTR(@[cost_ofc_cd],1,3)||TO_CHAR(SYSDATE,'YYYYMM') ) A,
       		( SELECT MAX(TO_NUMBER(SUBSTR(INV_RGST_NO,4,11)))+1 RGST_NO
         	FROM   AP_PAY_INV
         	WHERE  SUBSTR(INV_RGST_NO,1,9) = SUBSTR(@[cost_ofc_cd],1,3)||TO_CHAR(SYSDATE,'YYYYMM') ) B)
    'PSO',
    INV_OFC_CD,
    COST_OFC_CD,
    VNDR_SEQ,
    YD_CD,
    INV_NO,
    ISS_DT,
    ACPT_DT,
    EFF_DT,
    ACPT_DT,
    PAY_TERM_DYS,
    DUE_DT,       --iss + Term
    CURR_CD,
    TTL_LOCL_AMT,
    LOCL_TAX_AMT,
    LOCL_NET_AMT,
    LOCL_DDCT_AMT,
    'N',
    TTL_LOCL_AMT,
    'N',
    'N',
    'N',
    'N',
    'N',
    'N',
    'USERID',
    SYSDATE,
    'USERID',
    SYSDATE
FROM PSO_CHARGE
WHERE ISS_CTY_CD = @[iss_cty_cd]
and SO_SEQ = @[so_seq]			]]></sql>
			<params>
				<param name="cost_ofc_cd" type="12" value="" out="N"/>
				<param name="iss_cty_cd" type="12" value="" out="N"/>
				<param name="so_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
