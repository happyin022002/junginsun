<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="VesselScheduleMgtDBDAOSearchBunkerQtyBySpeedRSQL">
			<desc><![CDATA[Speed 변경에 따른 Bunker Qty 를 조회합니다.

History
2012.10.24 CHM-201220527-01 진마리아 Departure/Noon Report 데이터를 FCM 데이터와 I/F하도록 변경 요청]]></desc>
			<sql><![CDATA[
SELECT  (
            SELECT  ACT_PRC AS BNK_PRICE_BY_TON
            FROM    VSK_BNK_PRC T1,
                    (
                        SELECT  MAX(TO_CHAR(VPS_ETB_DT, 'YYYYMMDD') || DEP_PORT_CD ) CURR_PORT
                        FROM    FCM_DEP_RPT
                        WHERE   VSL_CD          = @[vsl_cd]
                        AND     TO_NUMBER(SPL_FOIL_ACT_WGT) > 0
                    )
            WHERE   1 = 1
            AND     PORT_CD             = SUBSTR(CURR_PORT, 9)
            AND     FOIL_DOIL_DIV_CD    = 'F'
            AND     EVNT_DT             = TO_DATE(SUBSTR(CURR_PORT, 1, 8), 'YYYYMMDD')
        ) AS BNK_UNIT_AMT
        , (
			SELECT  ROUND((FOC_HR / POWER(SPD_P, 3)) * POWER((@[spd] / (1 - (SLIP / 100))), 3) * 24, 1)
			FROM    (
						SELECT  T1.*,
								ROUND(((SPD_P - SPD_O)/SPD_P) * 100, 1)   AS SLIP,
								ROUND(BUNK_CONS / (DIST_O / SPD_O), 2)  AS FOC_HR
						FROM    (
									SELECT  /*+INDEX_DESC(T XPKVSK_NOON_RPT) */
											NXT_PORT_CD     AS NXT_PORT_CD,
											NXT_PORT_ETA_DT AS NXT_PORT_ETA_DT,
											NVGT_ML_DIST    AS DIST_O,
											ENG_ML_DIST     AS DIST_P,
											SAIL_AVG_SPD    AS SPD_O,
											ROUND(ENG_ML_DIST / (NVGT_ML_DIST / SAIL_AVG_SPD),1) AS SPD_P,
											ROUND(TO_NUMBER(VSK_REMOVE_NONE_NUMERIC_FNC(MN_FOIL_CSM_QTY)))    AS BUNK_CONS
									FROM    FCM_NOON_RPT T
									WHERE   VSL_CD      = @[vsl_cd]
									AND     ROWNUM      = 1
								) T1
					)
        ) AS BNK_UNIT_QTY
FROM    DUAL			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="spd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
