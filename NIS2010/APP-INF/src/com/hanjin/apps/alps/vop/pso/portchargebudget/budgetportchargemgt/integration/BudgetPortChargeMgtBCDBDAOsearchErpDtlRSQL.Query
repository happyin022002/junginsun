<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BudgetPortChargeMgtBCDBDAOsearchErpDtlRSQL">
			<desc><![CDATA[ERP로 I/F된 항비 상세 목록을 조회한다.
====================================
2011.04.25 CHM-201110288-01 진마리아 1월 조회시 전년도 12월 정보를 필터링하여 제외
2012.02.01 CHM-201215463-01 진마리아 추정 대상월과 생성월 관계에 대한 로직 수정
2014.06.13 CHM-201430702 이윤정 Vessel particular내 Desion capacity값이 보이도록 Down Excel내 칼럼 추가]]></desc>
			<sql><![CDATA[
SELECT 
 EXE_YRMON
,SYS_SRC_ID
,REV_YRMON
,ACCT_CD
,ESTM_SEQ_NO
,RLANE REV_LANE
,LOC_CD PORT
,RVVD REV_VVD
,DCAPA
,ESTM_AMT
,ACT_AMT
,ACCL_AMT
,'' CRE_USR_ID
,'' UPD_USR_ID
,'' sdt
,'' edt
,'' match_flag
 FROM (
    SELECT  EXE_YRMON, REV_YRMON,  ACCT_CD
            , (
                select RLANE_CD from AR_MST_REV_VVD A 
                where   A.VSL_CD     = G.VSL_CD
                AND     A.SKD_VOY_NO = G.SKD_VOY_NO
                AND     A.SKD_DIR_CD = G.SKD_DIR_CD
                AND     A.RLANE_DIR_CD = G.REV_DIR_CD
                and     rownum = 1
                ) RLANE
            , (
                SELECT CNTR_DZN_CAPA
                FROM  MDM_VSL_CNTR M
                WHERE M.VSL_CD = G.VSL_CD
                AND   M.DELT_FLG = 'N'
                ) DCAPA
            ,LOC_CD, VSL_CD||SKD_VOY_NO||SKD_DIR_CD||REV_DIR_CD RVVD, ESTM_AMT, ACT_AMT, ACCL_AMT, ESTM_SEQ_NO
			,SYS_SRC_ID
    FROM    GL_ESTM_IF_ERP G
    WHERE   1=1
    --AND G.EXE_YRMON LIKE TO_CHAR(SYSDATE, 'YYYY')||'%'
    #if( ${sdt} != '' )
    AND G.EXE_YRMON LIKE SUBSTR(REPLACE(@[edt], '-', ''),1,4)||'%'
    AND G.REV_YRMON BETWEEN replace(@[sdt], '-', '') AND replace(@[edt], '-', '')
	#end 
	#if( $acct_cd_list.size() > 0)
	AND G.ACCT_CD IN
	    (
			#foreach( $acct_cd in ${acct_cd_list} )
				#if($velocityCount < $acct_cd_list.size()) '$acct_cd', #else '$acct_cd' #end
			#end
		)
	#end
	AND     G.SYS_SRC_ID  = 'PSO'
    #if( ${match_flag} == 'match' )
    -- Matched
    AND     G.ACCL_AMT    = 0
	#end
    #if( ${match_flag} == 'unmatch' )
    -- UNMatched
    AND     G.ACCL_AMT    <> 0
	#end
)
ORDER BY EXE_YRMON, REV_YRMON,  ACCT_CD, RLANE, LOC_CD, RVVD			]]></sql>
			<params>
				<param name="edt" type="12" value="201405" out="N"/>
				<param name="sdt" type="12" value="201406" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
