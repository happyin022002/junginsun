<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OnTimeResultAnalysisDBDAOSearchRsltCngStsListRSQL">
			<desc><![CDATA[SearchRsltCngStsList]]></desc>
			<sql><![CDATA[
SELECT   MAX_SEQ, GROUP_FLG, VVD
        ,MAX(DECODE(T2.SEQ, 01, PORT)) AS PORT1
        ,MAX(DECODE(T2.SEQ, 01, STS))  AS STATE1
        ,MAX(DECODE(T2.SEQ, 02, PORT)) AS PORT2
        ,MAX(DECODE(T2.SEQ, 02, STS))  AS STATE2
        ,MAX(DECODE(T2.SEQ, 03, PORT)) AS PORT3
        ,MAX(DECODE(T2.SEQ, 03, STS))  AS STATE3
        ,MAX(DECODE(T2.SEQ, 04, PORT)) AS PORT4
        ,MAX(DECODE(T2.SEQ, 04, STS))  AS STATE4
        ,MAX(DECODE(T2.SEQ, 05, PORT)) AS PORT5
        ,MAX(DECODE(T2.SEQ, 05, STS))  AS STATE5
        ,MAX(DECODE(T2.SEQ, 06, PORT)) AS PORT6
        ,MAX(DECODE(T2.SEQ, 06, STS))  AS STATE6
        ,MAX(DECODE(T2.SEQ, 07, PORT)) AS PORT7
        ,MAX(DECODE(T2.SEQ, 07, STS))  AS STATE7
        ,MAX(DECODE(T2.SEQ, 08, PORT)) AS PORT8
        ,MAX(DECODE(T2.SEQ, 08, STS))  AS STATE8
        ,MAX(DECODE(T2.SEQ, 09, PORT)) AS PORT9
        ,MAX(DECODE(T2.SEQ, 09, STS))  AS STATE9
        ,MAX(DECODE(T2.SEQ, 10, PORT)) AS PORT10
        ,MAX(DECODE(T2.SEQ, 10, STS))  AS STATE10
        ,MAX(DECODE(T2.SEQ, 11, PORT)) AS PORT11
        ,MAX(DECODE(T2.SEQ, 11, STS))  AS STATE11
        ,MAX(DECODE(T2.SEQ, 12, PORT)) AS PORT12
        ,MAX(DECODE(T2.SEQ, 12, STS))  AS STATE12
        ,MAX(DECODE(T2.SEQ, 13, PORT)) AS PORT13
        ,MAX(DECODE(T2.SEQ, 13, STS))  AS STATE13
        ,MAX(DECODE(T2.SEQ, 14, PORT)) AS PORT14
        ,MAX(DECODE(T2.SEQ, 14, STS))  AS STATE14
        ,MAX(DECODE(T2.SEQ, 15, PORT)) AS PORT15
        ,MAX(DECODE(T2.SEQ, 15, STS))  AS STATE15
        ,MAX(DECODE(T2.SEQ, 16, PORT)) AS PORT16
        ,MAX(DECODE(T2.SEQ, 16, STS))  AS STATE16
        ,MAX(DECODE(T2.SEQ, 17, PORT)) AS PORT17
        ,MAX(DECODE(T2.SEQ, 17, STS))  AS STATE17
        ,MAX(DECODE(T2.SEQ, 18, PORT)) AS PORT18
        ,MAX(DECODE(T2.SEQ, 18, STS))  AS STATE18
        ,MAX(DECODE(T2.SEQ, 19, PORT)) AS PORT19
        ,MAX(DECODE(T2.SEQ, 19, STS))  AS STATE19
        ,MAX(DECODE(T2.SEQ, 20, PORT)) AS PORT20
        ,MAX(DECODE(T2.SEQ, 20, STS))  AS STATE20
FROM    (
        SELECT  GROUP_FLG, VVD, PORT, STS, SEQ
                ,((MAX(SEQ) OVER () * 2) + 2) MAX_SEQ
        FROM    (
                SELECT  
                        #if (${grp_flg} == 'L')
                            T1.SLAN_CD AS GROUP_FLG
                        #end
                        #if (${grp_flg} == 'P')
                            T1.VPS_PORT_CD AS GROUP_FLG
                        #end
                        #if (${grp_flg} == 'V')
                            T1.VSL_CD AS GROUP_FLG
                        #end
                       , T1.VSL_CD || T1.SKD_VOY_NO || T1.SKD_DIR_CD  VVD
                       , T1.VPS_PORT_CD PORT
                       ,(SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = @[intg_cd_id] AND INTG_CD_VAL_CTNT = SKD_CNG_STS_CD) STS
                       ,
                        #if (${grp_flg} == 'L')
                        ROW_NUMBER() OVER (PARTITION BY T1.SLAN_CD, T1.VSL_CD, T1.SKD_VOY_NO, T1.SKD_DIR_CD ORDER BY T1.CLPT_SEQ) AS SEQ
                        #end
                        #if (${grp_flg} == 'P')
                        ROW_NUMBER() OVER (PARTITION BY T1.VPS_PORT_CD, T1.VSL_CD, T1.SKD_VOY_NO, T1.SKD_DIR_CD ORDER BY T1.CLPT_SEQ) AS SEQ
                        #end
                        #if (${grp_flg} == 'V')
                        ROW_NUMBER() OVER (PARTITION BY T1.VSL_CD, T1.SKD_VOY_NO, T1.SKD_DIR_CD ORDER BY T1.CLPT_SEQ) AS SEQ
                        #end
                FROM    VSK_VSL_PORT_SKD T1, MDM_VSL_CNTR T2
                WHERE   1 = 1
                AND     T1.VSL_CD         = T2.VSL_CD
                AND     T1.SKD_CNG_STS_CD IN ('R', 'A', 'I', 'O', 'S')
                AND   ((DECODE(@[lane_grp], 'I', T1.SLAN_CD) = NVL(@[vsl_slan_cd], T1.SLAN_CD))  OR  (DECODE(@[lane_grp], 'G', T1.SLAN_CD) IN  (SELECT VSL_SLAN_CD FROM VSK_USR_LANE_GRP WHERE USR_ID = @[usr_id] AND LANE_GRP_NM = @[lane_grp_nm])))
                AND     T1.VPS_ETD_DT    >= TO_DATE(@[act_inp_fm_dt], 'YYYYMM') 
                AND     T1.VPS_ETD_DT    <= LAST_DAY(TO_DATE(@[act_inp_to_dt], 'YYYYMM')) + 0.99999
                AND     T1.VSL_CD        LIKE @[vsl_cd]        || '%'
                AND     T1.VPS_PORT_CD   LIKE @[vps_port_cd]   || '%'
                AND     T2.CRR_CD        LIKE @[crr_cd]        || '%'
                )
        ) T1, ( SELECT ST + LEVEL - 1 SEQ  FROM (SELECT 1 ST, 20 ED FROM DUAL) CONNECT BY LEVEL <= ED ) T2
WHERE   T1.SEQ     = T2.SEQ
GROUP BY GROUP_FLG, VVD, MAX_SEQ
ORDER BY GROUP_FLG, VVD, MAX_SEQ			]]></sql>
			<params>
				<param name="intg_cd_id" type="12" value="" out="N"/>
				<param name="lane_grp" type="12" value="" out="N"/>
				<param name="vsl_slan_cd" type="12" value="" out="N"/>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="lane_grp_nm" type="12" value="" out="N"/>
				<param name="act_inp_fm_dt" type="12" value="" out="N"/>
				<param name="act_inp_to_dt" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="vps_port_cd" type="12" value="" out="N"/>
				<param name="crr_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
