<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="VesselScheduleMgtDBDAOSearchVslSkdRepeatErpIfRSQL">
			<desc><![CDATA[]]></desc>
			<sql><![CDATA[
SELECT   	'N'	AS DELETED_VVD_YN
		,	PS.SKD_DIR_CD
		,	VS.VSL_SLAN_CD
		,	PS.VSL_CD||PS.SKD_VOY_NO||PS.SKD_DIR_CD AS VVD
		,	TO_CHAR(VS.CRE_DT, 'YYYY-MM-DD HH24:MI') AS CRE_DT
		,	PS.VPS_PORT_CD
		,	TO_CHAR(PS.VPS_ETA_DT, 'YYYY-MM-DD HH24:MI') AS VPS_ETA_DT
		,	TO_CHAR(PS.VPS_ETB_DT, 'YYYY-MM-DD HH24:MI') AS VPS_ETB_DT
		,	TO_CHAR(PS.VPS_ETD_DT, 'YYYY-MM-DD HH24:MI') AS VPS_ETD_DT
		,	TO_CHAR(VS.UPD_DT, 'YYYY-MM-DD HH24:MI') AS UPD_DT
		,	TO_CHAR(MAX(LL.UPD_DT), 'YYYY-MM-DD HH24:MI') AS IF_DT
		,	PS.VSL_CD
		,	PS.SKD_VOY_NO
  FROM 		VSK_VSL_SKD         VS
		,	VSK_VSL_PORT_SKD 	PS
		,	VSK_CUST_EDI_LOG 	LL
 WHERE 		1 = 1
   AND 		VS.VSL_CD 			= PS.VSL_CD
   AND 		VS.SKD_VOY_NO 		= PS.SKD_VOY_NO
   AND 		VS.SKD_DIR_CD 		= PS.SKD_DIR_CD
   AND 		VS.VSL_CD 			= LL.N1ST_VSL_CD(+)
   AND 		VS.SKD_VOY_NO 		= LL.N1ST_SKD_VOY_NO(+)
   AND 		VS.SKD_DIR_CD 		= LL.N1ST_SKD_DIR_CD(+)
   AND 		'FNS017-RESEND' 	= LL.CUST_TRD_PRNR_ID(+)
   AND 		PS.CLPT_SEQ 		= (	SELECT 	MIN(P.CLPT_SEQ)
                        			FROM 	VSK_VSL_PORT_SKD 			P
                       				WHERE 	P.VSL_CD 					= PS.VSL_CD
                         			AND 	P.SKD_VOY_NO 				= PS.SKD_VOY_NO
                         			AND 	P.SKD_DIR_CD 				= PS.SKD_DIR_CD
                         			AND 	P.TURN_PORT_IND_CD 			IN ('Y', 'N')
                         			AND 	NVL(P.SKD_CNG_STS_CD, '*') 	<> 'S'
								)
   AND 		EXISTS 				(	SELECT 	''
                 					FROM 	MDM_VSL_CNTR 	VC
                					WHERE 	VC.VSL_CD 		= VS.VSL_CD
                  					AND 	VC.VSL_CLSS_FLG <> 'T'
								)
   AND 		EXISTS 				(	SELECT 	''
                 					FROM 	AR_ROUT_RNK RK
                					WHERE 	SUBSTR(RK.RLANE_CD, 1, 3) 	= VS.VSL_SLAN_CD
                  					AND 	RK.DELT_FLG 				= 'N'
								)
#if (${vsl_slan_cd} != '')
  AND 		VS.VSL_SLAN_CD 		= @[vsl_slan_cd]
#end
#if (${vsl_cd} != '')
  AND 		VS.VSL_CD 			= @[vsl_cd]
#end
#if (${skd_voy_no} != '')
  AND 		VS.SKD_VOY_NO 		= @[skd_voy_no]
#end
#if (${skd_dir_cd} != '')
  AND 		VS.SKD_DIR_CD 		= @[skd_dir_cd]
#elseif (${skd_dir_cd} == '' && ${skd_dir_combo} != '')
  AND 		VS.SKD_DIR_CD 		= @[skd_dir_combo]
#end
#if (${date_fm} != '' && ${date_to} != '')
  AND 		VS.CRE_DT 				BETWEEN TO_DATE(@[date_fm], 'YYYY-MM-DD') 			AND TO_DATE(@[date_to], 'YYYY-MM-DD') + 0.99999
#end
#if (${first_port_etb_fm} != '' && ${first_port_etb_to} != '')
  AND 		VS.N1ST_PORT_BRTH_DT	BETWEEN TO_DATE(@[first_port_etb_fm], 'YYYY-MM-DD') AND TO_DATE(@[first_port_etb_to], 'YYYY-MM-DD') + 0.99999
#end
GROUP BY 	PS.SKD_DIR_CD
		,	VS.VSL_SLAN_CD
		,	PS.VSL_CD||PS.SKD_VOY_NO||PS.SKD_DIR_CD
		,	VS.CRE_DT
		,	PS.VPS_PORT_CD
		,	PS.VPS_ETA_DT
		,	PS.VPS_ETB_DT
		,	PS.VPS_ETD_DT
		,	VS.UPD_DT
		,	PS.VSL_CD
		,	PS.SKD_VOY_NO			]]></sql>
			<params>
				<param name="vsl_slan_cd" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="skd_dir_combo" type="12" value="" out="N"/>
				<param name="date_fm" type="12" value="" out="N"/>
				<param name="date_to" type="12" value="" out="N"/>
				<param name="first_port_etb_fm" type="12" value="" out="N"/>
				<param name="first_port_etb_to" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
