<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SimulationDBDAOSearchAvgCsmWgtPortPairRSQL">
			<desc><![CDATA[Search Average Consumption Weight between port pairs using FCM Departure Report.
=================================================================================]]></desc>
			<sql><![CDATA[
SELECT NVL(SUM((NVL(DEP_FOIL_WGT,0)+NVL(DEP_LOW_SULP_FOIL_WGT,0))-(NVL(NXT_ARR_FOIL_WGT,0)+NVL(NXT_ARR_LOW_SULP_FOIL_WGT,0)))/COUNT(*), 0) AVG_CSM_WGT
FROM (
    SELECT ROW_NUMBER() OVER(ORDER BY NXT_PORT_ETA_DT) SEQ
         , T1.VSL_CD
         , T1.SKD_VOY_NO
         , T1.SKD_DIR_CD
         , T1.DEP_PORT_CD
         , T1.NXT_PORT_CD
         , T1.NXT_PORT_ETA_DT
         , T1.DEP_FOIL_WGT
         , T1.DEP_LOW_SULP_FOIL_WGT
         , (SELECT ARR_FOIL_WGT
            FROM   FCM_DEP_RPT
            WHERE  1=1
            AND    T1.VSL_CD=VSL_CD
            AND    T1.SKD_VOY_NO=SKD_VOY_NO
            AND    T1.SKD_DIR_CD=SKD_DIR_CD
            AND    T1.NXT_PORT_CD=DEP_PORT_CD
            AND    T1.NXT_PORT_ETA_DT<NXT_PORT_ETA_DT
            AND    ROWNUM=1) NXT_ARR_FOIL_WGT
         , (SELECT ARR_LOW_SULP_FOIL_WGT
            FROM   FCM_DEP_RPT
            WHERE  1=1
            AND    T1.VSL_CD=VSL_CD
            AND    T1.SKD_VOY_NO=SKD_VOY_NO
            AND    T1.SKD_DIR_CD=SKD_DIR_CD
            AND    T1.NXT_PORT_CD=DEP_PORT_CD
            AND    T1.NXT_PORT_ETA_DT<NXT_PORT_ETA_DT
            AND    ROWNUM=1) NXT_ARR_LOW_SULP_FOIL_WGT
    FROM   FCM_DEP_RPT T1
    WHERE  1=1
    AND    VSL_CD=@[vsl_cd]
    AND    DEP_PORT_CD=@[dep_port_cd]
    AND    NXT_PORT_CD=@[nxt_port_cd]
)
WHERE SEQ<=3			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="dep_port_cd" type="12" value="" out="N"/>
				<param name="nxt_port_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
