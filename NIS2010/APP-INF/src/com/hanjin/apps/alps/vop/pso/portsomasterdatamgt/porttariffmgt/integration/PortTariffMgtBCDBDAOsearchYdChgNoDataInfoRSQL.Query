<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PortTariffMgtBCDBDAOsearchYdChgNoDataInfoRSQL">
			<desc><![CDATA[tariff copy하기 위한 정보 조회]]></desc>
			<sql><![CDATA[
WITH ACCT_LIST AS (
 SELECT B.ACCT_CD||RPAD(A.VNDR_SEQ,6,'*')||RPAD(A.YD_CHG_NO,10,'*')||RPAD(A.YD_CHG_VER_SEQ,3,'*') AS ACCT_VNDR, A.YD_CHG_VER_SEQ, YD_CHG_NO
   FROM PSO_YD_CHG A, TES_LGS_COST B
   WHERE A.YD_CD       = @[yd_cd]                                      
   -- AND A.LST_FLG         ='Y'
  --  AND SYSDATE BETWEEN A.EFF_DT AND A.EXP_DT 
    AND A.LGS_COST_CD   = B.LGS_COST_CD
     ) 
  SELECT  ACCT_CD,
          VNDR_SEQ,
          YD_CHG_NO, 
          YD_CHG_VER_SEQ, 
          LGS_COST_CD AS COST_CD,
          MIN(DECODE(X.PSO_CHG_TP_CD,'B','Y',NULL)) AS BASE,
          MIN(DECODE(X.PSO_CHG_TP_CD,'S','Y',NULL)) AS SURCHARGE,
          MIN(DECODE(X.PSO_CHG_TP_CD,'D','Y',NULL)) AS DISCOUNT,
          MAX(VNDR_LGL_ENG_NM) AS VNDR_NM,
          DECODE(MIN(X.CNT),0,NULL,'Y') AS REGULAR,
          ACCT_CD AS ACCT_CD2, 
          @[yd_cd] AS YD_CD,
          MIN(DECODE(X.PSO_CHG_TP_CD,'B','Y',NULL)) AS BASE2,
          MIN(DECODE(X.PSO_CHG_TP_CD,'S','Y',NULL)) AS SURCHARGE2,
          MIN(DECODE(X.PSO_CHG_TP_CD,'D','Y',NULL)) AS DISCOUNT2,
          DECODE(MIN(X.CNT),0,NULL,'Y') AS REGULAR2
 FROM (
SELECT DISTINCT B.PSO_CHG_TP_CD ,      
       C. ACCT_CD,  A.VNDR_SEQ,
       A.YD_CHG_NO, A.YD_CHG_VER_SEQ,  
       A.LGS_COST_CD,E.VNDR_LGL_ENG_NM,
       NVL(( SELECT COUNT(1) FROM PSO_YD_CHG_OBJ_LIST
              WHERE YD_CHG_NO      =  A.YD_CHG_NO
                AND YD_CHG_VER_SEQ = A.YD_CHG_VER_SEQ ),0) CNT
 FROM PSO_YD_CHG A, PSO_YD_CHG_XPR B, TES_LGS_COST C, ACCT_LIST D, MDM_VENDOR E
WHERE A.YD_CD           = @[yd_cd]                                       
  --AND A.LST_FLG         = 'Y'
  AND A.YD_CHG_NO       = B.YD_CHG_NO
  AND A.YD_CHG_VER_SEQ  = B.YD_CHG_VER_SEQ
  AND A.LGS_COST_CD     = C.LGS_COST_CD
  AND A.YD_CHG_NO       = D.YD_CHG_NO
  AND A.YD_CHG_VER_SEQ  = D.YD_CHG_VER_SEQ
  AND E.VNDR_SEQ        = A.VNDR_SEQ
  AND D.ACCT_VNDR  IN  ( #foreach( $key IN ${all_acct_vndr}) 
                                                   #if($velocityCount < $all_acct_vndr.size())
                                                        '$key',
                                                    #else
                                                        '$key'
                                                    #end
                                          #end 
                                           )
  AND SYSDATE BETWEEN A.EFF_DT AND A.EXP_DT ) X
 GROUP BY ACCT_CD,
          VNDR_SEQ,
          YD_CHG_NO, 
          YD_CHG_VER_SEQ, 
          LGS_COST_CD			]]></sql>
			<params>
				<param name="yd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
