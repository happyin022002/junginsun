<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RegionDepartureReportDBDAOsearchRDRSummaryListRSQL">
			<desc><![CDATA[RDR Summary 조회]]></desc>
			<sql><![CDATA[
SELECT 
 VSL_CD
,VOY_NO
,DIR_CD
,VVD
,REGION
,LANE
,OPR_CD
,TOT_ALLOC
,TOT_WGT
,TYPE
,HC20_QTY
,ADD_20
,HC40_QTY
,ADD_40
,BSA_45
,ADD_45
,ADD_AKBB
,POL
,POD
,VPS_DT
,(SELECT PLN_YR||'-'||PLN_WK FROM EQR_WK_PRD WHERE VPS_DT_ORG BETWEEN TO_DATE(WK_ST_DT,'YYYYMMDD') AND TO_DATE(WK_END_DT,'YYYYMMDD')) WEEK_NO
,F_20
,F_2H
,F_40
,F_4H
,F_45
,F_20+F_2H+F_40+F_4H+F_45 F_QTY
,F_20_W+F_2H_W+F_40_W+F_4H_W+F_45_W F_WEIGHT
,E_20
,E_2H
,E_40
,E_4H
,E_45
,E_20+E_2H+E_40+E_4H+E_45 E_QTY
,E_20_W+E_2H_W+E_40_W+E_4H_W+E_45_W E_WEIGHT
,F_20+F_2H+(F_40+F_4H+F_45)*2 F_TOTAL_TEU
,E_20+E_2H+(E_40+E_4H+E_45)*2 E_TOTAL_TEU
,ADD_20+ADD_40+ADD_45+ADD_AKBB DEAD_SLOT  --ADD SLOT
,F_20+F_2H+(F_40+F_4H+F_45)*2 + E_20+E_2H+(E_40+E_4H+E_45)*2 + ADD_20+ADD_40+ADD_45+ADD_AKBB GRAND_TOTAL
,F_20_W+F_2H_W+F_40_W+F_4H_W+F_45_W + E_20_W+E_2H_W+E_40_W+E_4H_W+E_45_W T_WEIGHT
FROM (

SELECT
         A.VSL_CD,A.VOY_NO,A.DIR_CD
		,A.VSL_CD||A.VOY_NO||A.DIR_CD VVD
        ,A.REGION
        ,F.SLAN_CD LANE
        ,B.OPR_CD
        ,MAX(NVL(B.BSA_SLOT,0)+NVL(B.RELEASE_SLOT,0)+NVL(B.SWAP_SLOT,0)) TOT_ALLOC
        ,MAX(NVL(B.BSA_WGT,0)+NVL(B.RELEASE_WGT,0)+NVL(B.SWAP_WGT,0)) TOT_WGT
        ,MAX(D.TYPE) TYPE
        ,MAX(NVL(C.HC20_QTY, 0)) HC20_QTY  --(BSA)
        ,MAX(DECODE(D.TYPE, '3', NVL(D.SLOT_QTY, 0), 0)) ADD_20   -- (ADD SLOT)
        ,MAX(NVL(C.HC_QTY, 0)) HC40_QTY
        ,MAX(DECODE(D.TYPE, 'H', NVL(D.SLOT_QTY, 0), 0)) ADD_40
        ,MAX(NVL(C.QTY_45, 0)) BSA_45
        ,MAX(DECODE(D.TYPE, 'L', NVL(D.SLOT_QTY, 0), 0)) ADD_45
		,MAX(DECODE(D.TYPE, 'A', NVL(D.SLOT_QTY, 0), 0)) ADD_AKBB
        ,E.POL
        ,E.POD_ISO as POD
        ,MAX(F.PF_ETD_DT) VPS_DT  --hidden
		,MAX(G.PF_ETD_DT) VPS_DT_ORG
--        ,E.CNTR_TYPE  --F/E
--        ,E.CNTR_SIZE
--        ,DECODE(E.CNTR_SIZE,'2','20','3','2H','4','40','H','4H','L','45') CNTR_SIZE
        ,MAX(DECODE(E.CNTR_TYPE,'F', DECODE(E.CNTR_SIZE,'2', NVL(E.QTY, 0), 0), 0)) F_20        
        ,MAX(DECODE(E.CNTR_TYPE,'F', DECODE(E.CNTR_SIZE,'3', NVL(E.QTY, 0), 0), 0)) F_2H
        ,MAX(DECODE(E.CNTR_TYPE,'F', DECODE(E.CNTR_SIZE,'4', NVL(E.QTY, 0), 0), 0)) F_40
        ,MAX(DECODE(E.CNTR_TYPE,'F', DECODE(E.CNTR_SIZE,'H', NVL(E.QTY, 0), 0), 0)) F_4H
        ,MAX(DECODE(E.CNTR_TYPE,'F', DECODE(E.CNTR_SIZE,'L', NVL(E.QTY, 0), 0), 0)) F_45        
        ,MAX(DECODE(E.CNTR_TYPE,'F', DECODE(E.CNTR_SIZE,'2', NVL(E.WEIGHT, 0), 0), 0)) F_20_W        
        ,MAX(DECODE(E.CNTR_TYPE,'F', DECODE(E.CNTR_SIZE,'3', NVL(E.WEIGHT, 0), 0), 0)) F_2H_W
        ,MAX(DECODE(E.CNTR_TYPE,'F', DECODE(E.CNTR_SIZE,'4', NVL(E.WEIGHT, 0), 0), 0)) F_40_W
        ,MAX(DECODE(E.CNTR_TYPE,'F', DECODE(E.CNTR_SIZE,'H', NVL(E.WEIGHT, 0), 0), 0)) F_4H_W
        ,MAX(DECODE(E.CNTR_TYPE,'F', DECODE(E.CNTR_SIZE,'L', NVL(E.WEIGHT, 0), 0), 0)) F_45_W        
        ,MAX(DECODE(E.CNTR_TYPE,'E', DECODE(E.CNTR_SIZE,'2', NVL(E.QTY, 0), 0), 0)) E_20        
        ,MAX(DECODE(E.CNTR_TYPE,'E', DECODE(E.CNTR_SIZE,'3', NVL(E.QTY, 0), 0), 0)) E_2H
        ,MAX(DECODE(E.CNTR_TYPE,'E', DECODE(E.CNTR_SIZE,'4', NVL(E.QTY, 0), 0), 0)) E_40
        ,MAX(DECODE(E.CNTR_TYPE,'E', DECODE(E.CNTR_SIZE,'H', NVL(E.QTY, 0), 0), 0)) E_4H
        ,MAX(DECODE(E.CNTR_TYPE,'E', DECODE(E.CNTR_SIZE,'L', NVL(E.QTY, 0), 0), 0)) E_45        
        ,MAX(DECODE(E.CNTR_TYPE,'E', DECODE(E.CNTR_SIZE,'2', NVL(E.WEIGHT, 0), 0), 0)) E_20_W        
        ,MAX(DECODE(E.CNTR_TYPE,'E', DECODE(E.CNTR_SIZE,'3', NVL(E.WEIGHT, 0), 0), 0)) E_2H_W
        ,MAX(DECODE(E.CNTR_TYPE,'E', DECODE(E.CNTR_SIZE,'4', NVL(E.WEIGHT, 0), 0), 0)) E_40_W
        ,MAX(DECODE(E.CNTR_TYPE,'E', DECODE(E.CNTR_SIZE,'H', NVL(E.WEIGHT, 0), 0), 0)) E_4H_W
        ,MAX(DECODE(E.CNTR_TYPE,'E', DECODE(E.CNTR_SIZE,'L', NVL(E.WEIGHT, 0), 0), 0)) E_45_W      
        FROM
         RDR_HEADER A
        ,RDR_ALLOCATION B
        ,RDR_BSA C
        ,RDR_UTILIZE D
        ,RDR_SUMMARY E
        ,VSK_VSL_PORT_SKD F 
	    ,(SELECT H.VSL_CD, H.VOY_NO, H.DIR_CD, H.REGION          -- Region의 마직 포트 PF ETD 가 VVD 선택의 기준
					,F.PF_ETD_DT   
            FROM RDR_HEADER H, 
           	     VSK_VSL_PORT_SKD F
        	#if (${fr_week_no} != '' && ${to_week_no} != '')
	        	 ,( 
	            	SELECT MIN(WK_ST_DT) WK_ST_DT, MAX(WK_END_DT) WK_END_DT
		          	  FROM EQR_WK_PRD 
		             WHERE PLN_YR||PLN_WK >= @[fr_week_no]  --'201323'  
		               AND PLN_YR||PLN_WK <= @[to_week_no]    --'201338'     
	    	     ) G
			#end
   	   WHERE  1=1
--	     AND H.VSL_CD  = 'HJUK'
--	     AND H.VOY_NO  = '0010'
--	     AND H.DIR_CD  = 'W'
--	     AND H.REGION  = 'A'
	     AND F.VSL_CD  = H.VSL_CD   
 	     AND F.SKD_VOY_NO = H.VOY_NO   
	     AND F.SKD_DIR_CD = H.DIR_CD
	     AND H.PORT_CD    = F.VPS_PORT_CD
     #if (${vsl_cd} != '' && ${voy_no} != '' && ${dir_cd} != '')
	     AND H.VSL_CD  = @[vsl_cd]  --'HNGE'  --'HJNL'
   	     AND H.VOY_NO  = @[voy_no]  --'0014'
         AND H.DIR_CD  = @[dir_cd]  -- 'W'
	 #end 
	 #if (${vsl_cd} != '' && ${voy_no} == '' && ${dir_cd} == '')
	     AND H.VSL_CD  = @[vsl_cd] 
	 #end 
	 #if (${region} != '')
    	 AND H.REGION  = @[region]  --'M'
	 #end        
	 #if (${slan_cd} != '')
         AND F.SLAN_CD = @[slan_cd]    --'PSX' 
	 #end
	 #if (${fr_week_no} != '' && ${to_week_no} != '') 
	     AND F.PF_ETD_DT BETWEEN  TO_DATE(G.WK_ST_DT,'YYYY-MM-DD') AND TO_DATE(G.WK_END_DT,'YYYY-MM-DD')+1 
  	 #elseif (${fr_dt} != '' && ${to_dt} != '')
   	     AND F.PF_ETD_DT BETWEEN  TO_DATE(@[fr_dt],'YYYY-MM-DD') AND TO_DATE(@[to_dt],'YYYY-MM-DD')+1
         #end 
       ) G     
        WHERE
            A.VSL_CD    =   B.VSL_CD
        AND A.VOY_NO    =   B.VOY_NO
        AND A.DIR_CD    =   B.DIR_CD
        AND A.REGION    =   B.REGION
        AND B.VSL_CD    =   C.VSL_CD(+)
        AND B.VOY_NO    =   C.VOY_NO(+)
        AND B.DIR_CD    =   C.DIR_CD(+)
        AND B.REGION    =   C.REGION(+)
        AND B.OPR_CD    =   C.OPR_CD(+)
        AND A.VSL_CD    =   D.VSL_CD(+)
        AND A.VOY_NO    =   D.VOY_NO(+)
        AND A.DIR_CD    =   D.DIR_CD(+)
        AND A.REGION    =   D.REGION(+)
        AND DECODE(D.OPR_CD, NULL, 'N', C.OPR_CD) = NVL(D.OPR_CD, 'N')    
        AND A.VSL_CD    =   E.VSL_CD
        AND A.VOY_NO    =   E.VOY_NO
        AND A.DIR_CD    =   E.DIR_CD
        AND A.REGION    =   E.REGION
        AND A.VSL_CD    =   G.VSL_CD
        AND A.VOY_NO    =   G.VOY_NO
        AND A.DIR_CD    =   G.DIR_CD
        AND A.REGION    =   G.REGION        
        AND F.VSL_CD       = A.VSL_CD   
        AND F.SKD_VOY_NO   = A.VOY_NO   
        AND F.SKD_DIR_CD   = A.DIR_CD   
        AND F.VPS_PORT_CD  = E.POD_ISO 
        AND B.OPR_CD    =   E.OPR_CD               
--        AND D.TYPE      IN  ('3','H','L')   -- HC20, HC40, 45
        #if (${vsl_cd} != '' && ${voy_no} != '' && ${dir_cd} != '')
	        AND A.VSL_CD  = @[vsl_cd]  --'HNGE'  --'HJNL'
    	    	AND A.VOY_NO  = @[voy_no]  --'0014'
        	AND A.DIR_CD  = @[dir_cd]  -- 'W'
        #end 
        #if (${vsl_cd} != '' && ${voy_no} == '' && ${dir_cd} == '')
        	AND A.VSL_CD  = @[vsl_cd] 
        #end 
        #if (${region} != '')
    	    AND A.REGION  = @[region]  --'M'
        #end 
        -- AND B.OPR_CD  =     
        #if (${slan_cd} != '')
	        AND F.SLAN_CD = @[slan_cd]    --'PSX' 
        #end       
        GROUP BY A.VSL_CD,A.VOY_NO,A.DIR_CD,A.REGION,F.SLAN_CD,B.OPR_CD,E.POL,E.POD_ISO,F.CLPT_SEQ
        ORDER BY A.VSL_CD,A.VOY_NO,A.DIR_CD,A.REGION,F.SLAN_CD,B.OPR_CD,E.POL,F.CLPT_SEQ
) AA
ORDER BY WEEK_NO,VSL_CD,VOY_NO,DIR_CD,REGION,LANE, OPR_CD,POL			]]></sql>
			<params>
				<param name="fr_week_no" type="12" value="" out="N"/>
				<param name="to_week_no" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="voy_no" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
				<param name="region" type="12" value="" out="N"/>
				<param name="slan_cd" type="12" value="" out="N"/>
				<param name="fr_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
