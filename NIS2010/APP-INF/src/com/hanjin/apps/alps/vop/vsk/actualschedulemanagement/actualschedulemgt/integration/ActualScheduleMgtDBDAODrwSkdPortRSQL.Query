<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ActualScheduleMgtDBDAODrwSkdPortRSQL">
			<desc><![CDATA[Drewry 노선 POD PORT estimate time 을 가지고 온다]]></desc>
			<sql><![CDATA[
SELECT distinct T2.VSL_CD
	, T2.SKD_VOY_NO
	, T2.SKD_DIR_CD 
	, T2.VPS_PORT_CD        AS POL_CD
	, T2.YD_CD              AS POL_YD_CD
	, T2.CLPT_IND_SEQ       AS POL_CLPT_IND_SEQ
	, T2.CLPT_SEQ           AS POL_CLPT_SEQ
	, T1.SLAN_CD		AS SLAN_CD
	, T1.VPS_PORT_CD	AS POD_CD
	, T1.YD_CD		AS POD_YD_CD
	, T1.CLPT_IND_SEQ	AS POD_CLPT_IND_SEQ
	, T1.CLPT_SEQ		AS POD_CLPT_SEQ
	, TO_CHAR(T1.VPS_ETA_DT,'YYYYMMDDHH24MI')     AS POD_VPS_ETA_DT
	, TO_CHAR(T1.VPS_ETB_DT,'YYYYMMDDHH24MI')     AS POD_VPS_ETB_DT	
	,@[cre_usr_id] as CRE_USR_ID 
	,@[upd_usr_id] as UPD_USR_ID
FROM ( 
		SELECT  VSL_CD ,SKD_VOY_NO ,SKD_DIR_CD ,CLPT_IND_SEQ ,CLPT_SEQ
		       ,VPS_PORT_CD ,YD_CD ,SLAN_CD ,VPS_ETA_DT ,VPS_ETB_DT 
		FROM VSK_VSL_PORT_SKD
		WHERE 1=1
		AND VSL_CD =  @[vsl_cd]
		AND SKD_VOY_NO =  @[skd_voy_no] 
		AND SKD_DIR_CD = @[skd_dir_cd]
		AND NVL(SKD_CNG_STS_CD,' ') <> 'S'
		AND CLPT_IND_SEQ = '1'
	) T1
   ,VSK_VSL_PORT_SKD T2
   ,MDM_LOCATION T3
   ,MDM_LOCATION T4
   ,MDM_VSL_SVC_LANE T6
WHERE 1=1
AND T1.VSL_CD = T2.VSL_CD
AND T2.VPS_PORT_CD = T3.LOC_CD
AND T1.VPS_PORT_CD = T4.LOC_CD
AND T3.CONTI_CD <> T4.CONTI_CD
AND TO_DATE(  @[act_dep_dt],'YYYYMMDDHH24MI')  < T1.VPS_ETA_DT
AND T2.VSL_CD =  @[vsl_cd]
AND T2.SKD_VOY_NO = @[skd_voy_no]
AND T2.SKD_DIR_CD = @[skd_dir_cd]
AND T2.CLPT_IND_SEQ = @[clpt_ind_seq]
AND  T2.VPS_PORT_CD  = (SELECT PORT_CD FROM VSK_DRW_TGT_PORT WHERE PORT_CD = @[vps_port_cd] )
AND  T1.VPS_PORT_CD IN (    SELECT PORT_CD
                                FROM VSK_DRW_TGT_PORT
                                WHERE 1=1
                                AND  PORT_CD <> @[vps_port_cd]
				AND  DELT_FLG = 'N' )
AND  T2.VSL_CD||T2.SKD_VOY_NO||T2.SKD_DIR_CD||T2.VPS_PORT_CD||T1.VPS_PORT_CD  NOT IN ( SELECT VSL_CD||SKD_VOY_NO||SKD_DIR_CD||POL_CD||POD_CD
                                                                                             FROM VSK_VSL_DRW_SKD)
AND  T2.SLAN_CD = T6.VSL_SLAN_CD 
AND  T6.FDR_DIV_CD <> 'O'			]]></sql>
			<params>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="act_dep_dt" type="12" value="" out="N"/>
				<param name="clpt_ind_seq" type="12" value="" out="N"/>
				<param name="vps_port_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
