<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EstimationReportDBDAOByVvdRSQL">
			<desc><![CDATA[대상/진행 항차 Report 생성]]></desc>
			<sql><![CDATA[
SELECT
	MAX(E.REV_YRMON) REV_YRMON,
	MAX(E.RLANE_CD) RLANE_CD,
	E.VSL_CD || E.SKD_VOY_NO || E.SKD_DIR_CD || E.REV_DIR_CD AS VVD,
	MAX(E.ESTM_VVD_TP_CD) ESTM_VVD_TP_CD,
	SUM(DECODE(P.ACCT_CD, '511911', 0, ESTM_AMT)) AS PORT_AMT, 
	SUM(DECODE(P.ACCT_CD, '511911', ESTM_AMT, 0)) AS CANAL_AMT, 
	SUM(ESTM_AMT) AS TOTAL_AMT

FROM GL_ESTM_REV_VVD E, GL_ESTM_IF_ERP P
WHERE 1=1
AND P.EXE_YRMON = ( SELECT MAX(EXE_YRMON) FROM GL_ESTM_IF_ERP WHERE SYS_SRC_ID = 'PSO')
#if (${estm_vvd_tp_cd} == '1') 
AND P.REV_YRMON = @[rev_yrmon] 
AND E.ESTM_VVD_TP_CD IN ('RV', 'BV') 
#else
AND P.REV_YRMON IN (SELECT  TO_CHAR(ADD_MONTHS(TO_DATE(@[rev_yrmon] ,'YYYYMM'),1),'YYYYMM')  FROM DUAL)
AND E.ESTM_VVD_TP_CD IN ('PV')  
#end
AND P.EXE_YRMON = ( SELECT MAX(EXE_YRMON) FROM GL_ESTM_IF_ERP WHERE SYS_SRC_ID = 'PSO')
AND P.REV_YRMON = E.REV_YRMON
AND E.EXE_YRMON = @[rev_yrmon] 
AND E.VSL_CD     = P.VSL_CD
AND E.SKD_VOY_NO = P.SKD_VOY_NO
AND E.SKD_DIR_CD = P.SKD_DIR_CD
AND E.REV_DIR_CD = P.REV_DIR_CD
--AND E.ESTM_VVD_TP_CD = P.ESTM_VVD_TP_CD
AND P.SYS_SRC_ID = 'PSO'
AND E.ESTM_IOC_DIV_CD = P.ESTM_IOC_DIV_CD
GROUP BY E.VSL_CD, E.SKD_VOY_NO, E.SKD_DIR_CD, E.REV_DIR_CD
ORDER BY RLANE_CD			]]></sql>
			<params>
				<param name="rev_yrmon" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
