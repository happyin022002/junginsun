<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OptimizeddistancemgtDBDAOSearchTargetVmsShortRSQL">
			<desc><![CDATA[VMS Short 클릭시 해당 값의 target이 되는 vsk_pasg_pln_rpt의 key정보를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT    P.VSL_CD
        , P.SKD_VOY_NO
        , P.SKD_DIR_CD
        , TO_CHAR (P.PASG_PLN_DT, 'YYYY-MM-DD HH24:MI') AS PASG_PLN_DT
        , P.DEP_PORT_CD
        , P.ARR_PORT_CD
        , TO_CHAR (V.VPS_ETA_DT, 'YYYY-MM-DD HH24:MI') AS VPS_ETA_DT    
FROM      VSK_PASG_PLN_RPT      P 
        , MDM_VSL_CNTR          VC
        , VSK_PORT_OPMZ_DIST    H
        , VSK_VSL_PORT_SKD      V
        ,( SELECT   PS.VSL_CD
                    ,PS.SKD_VOY_NO
                    ,PS.SKD_DIR_CD
                    ,PS.VPS_PORT_CD
                    ,PS.YD_CD
                    ,NVL(YG.YD_GRP_ID ,'All') as YD_GRP_ID
           FROM     VSK_VSL_PORT_SKD PS
                    , VSK_YD_GRP       YG
           WHERE    PS.YD_CD = YG.YD_CD(+) ) FM_PC        
        ,( SELECT   PS.VSL_CD
                    ,PS.SKD_VOY_NO
                    ,PS.SKD_DIR_CD
                    ,PS.VPS_PORT_CD
                    ,PS.YD_CD
                    ,NVL(YG.YD_GRP_ID,'All') as YD_GRP_ID
           FROM     VSK_VSL_PORT_SKD PS
                    , VSK_YD_GRP       YG
          WHERE PS.YD_CD = YG.YD_CD(+) ) TO_PC
WHERE 1=1
AND P.VSL_CD            = VC.VSL_CD
AND P.VSL_CD            = FM_PC.VSL_CD (+)
AND P.SKD_VOY_NO        = FM_PC.SKD_VOY_NO (+)
AND P.SKD_DIR_CD        = FM_PC.SKD_DIR_CD (+)
AND P.DEP_PORT_CD       = FM_PC.VPS_PORT_CD (+)
--AND FM_PC.YD_GRP_ID     = H.FM_YD_GRP_ID
AND P.VSL_CD            = TO_PC.VSL_CD (+)
AND P.SKD_VOY_NO        = TO_PC.SKD_VOY_NO (+)
AND P.SKD_DIR_CD        = TO_PC.SKD_DIR_CD (+)
AND P.ARR_PORT_CD       = TO_PC.VPS_PORT_CD (+)
--AND TO_PC.YD_GRP_ID     = H.TO_YD_GRP_ID
AND P.DEP_PORT_CD       = SUBSTR(H.FM_YD_CD,1,5) 
AND P.ARR_PORT_CD       = SUBSTR(H.TO_YD_CD,1,5)
AND P.VSL_CD            = V.VSL_CD (+)     
AND P.SKD_VOY_NO        = V.SKD_VOY_NO (+)  
AND P.SKD_DIR_CD        = V.SKD_DIR_CD (+) 
AND P.ARR_PORT_CD       = V.VPS_PORT_CD (+)
AND P.PORT_TO_PORT_MLG_DIST BETWEEN H.RNG_MIN_DIST AND DECODE(H.RNG_MAX_DIST,NULL,99999,0,99999,H.RNG_MAX_DIST)
AND P.PASG_PLN_DT BETWEEN TO_DATE(@[fm_date],'YYYY-MM-DD') AND TO_DATE(@[to_date],'YYYY-MM-DD')+0.99999

#if (${fm_port_cd} != '')
AND P.DEP_PORT_CD 			= @[fm_port_cd]
#end

#if (${sheet_fm_port_cd} != '')
AND P.DEP_PORT_CD 			= @[sheet_fm_port_cd]
#end

#if (${sheet_to_port_cd} != '')
AND P.ARR_PORT_CD 			= @[sheet_to_port_cd]
#end

#if (${vms_shtg_dist} != '')
AND P.PORT_TO_PORT_MLG_DIST = @[vms_shtg_dist]
#end

ORDER BY P.PASG_PLN_DT DESC			]]></sql>
			<params>
				<param name="fm_date" type="12" value="" out="N"/>
				<param name="to_date" type="12" value="" out="N"/>
				<param name="fm_port_cd" type="12" value="" out="N"/>
				<param name="sheet_fm_port_cd" type="12" value="" out="N"/>
				<param name="sheet_to_port_cd" type="12" value="" out="N"/>
				<param name="vms_shtg_dist" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
