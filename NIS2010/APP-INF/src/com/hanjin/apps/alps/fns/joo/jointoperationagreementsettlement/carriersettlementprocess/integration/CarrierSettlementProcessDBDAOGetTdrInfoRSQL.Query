<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CarrierSettlementProcessDBDAOGetTdrInfoRSQL">
			<desc><![CDATA[OUS TDR row add 후 VVD입력시에 기본정보와 단가를 가져온다.]]></desc>
			<sql><![CDATA[
SELECT
       A.ACCT_YRMON,
       A.STL_VVD_SEQ,
       A.TRD_CD,
       A.RLANE_CD,
       A.JO_CRR_CD,
       A.RE_DIVR_CD,
       A.JO_STL_ITM_CD,
       A.JO_MNU_NM,
       A.VSL_CD,
       A.SKD_VOY_NO,
       A.SKD_DIR_CD,
       A.REV_DIR_CD,
       A.STL_BZC_PORT_CD,
       TO_CHAR(A.BZC_PORT_ETA_DT,'YYYYMMDDHH24MISS') ETA_DT,
       A.UC_BSS_PORT_CD,
       TO_CHAR(A.UC_BSS_PORT_ETD_DT,'YYYYMMDDHH24MISS') AS UC_BSS_PORT_ETD_DT,
       B.LOCL_CURR_CD,
       -- 2010.03.25 PORT 가 있어야 하므로 FM_PORT_CD변경시 가져온다.
       0 AS FNL_HJS_BSA_QTY,
       0 AS FNL_BSA_WGT,
       NVL(C.BSA_PER_WGT,0) AS BSA_PER_WGT
FROM   JOO_STL_VVD  A,
       JOO_FINC_MTX B,
       (
       SELECT C.VSL_CD, C.SKD_VOY_NO, C.SKD_DIR_CD, C.RLANE_CD, C.TRD_CD, C.CRR_CD,
              SUM(C.CRR_BSA_CAPA) AS BSA_PER_WGT
         FROM BSA_VVD_OTR_CRR C
        WHERE C.CRR_CD     = @[jo_crr_cd] 
          AND C.TRD_CD     = @[trd_cd]
          AND C.RLANE_CD   = @[rlane_cd]
          AND C.VSL_CD     = @[vsl_cd]
          AND C.SKD_VOY_NO = @[skd_voy_no]
          AND C.SKD_DIR_CD = @[skd_dir_cd]
          AND C.BSA_OP_JB_CD = '008'
        GROUP BY C.VSL_CD, C.SKD_VOY_NO, C.SKD_DIR_CD, C.RLANE_CD, C.TRD_CD, C.CRR_CD
       ) C
WHERE  A.JO_CRR_CD     = B.JO_CRR_CD
AND    A.RLANE_CD      = B.RLANE_CD
AND    A.RE_DIVR_CD    = B.RE_DIVR_CD
AND    A.JO_STL_ITM_CD = B.JO_STL_ITM_CD
AND    A.VSL_CD        = C.VSL_CD    (+)
AND    A.SKD_VOY_NO    = C.SKD_VOY_NO(+)
AND    A.SKD_DIR_CD    = C.SKD_DIR_CD(+)
AND    A.RLANE_CD      = C.RLANE_CD  (+)
AND    A.JO_CRR_CD     = C.CRR_CD    (+)
AND    A.TRD_CD        = C.TRD_CD    (+)
AND    A.ACCT_YRMON    = REPLACE(@[acct_yrmon],'-','')
AND    A.JO_CRR_CD     = @[jo_crr_cd]
AND    A.RE_DIVR_CD    = @[re_divr_cd]
AND    A.TRD_CD        = @[trd_cd]
AND    A.RLANE_CD      = @[rlane_cd]
AND    A.JO_STL_ITM_CD = @[jo_stl_itm_cd]
AND    A.JO_MNU_NM    IN ('RDR','TDR')
AND    A.JO_STL_CFM_CD = 'Y'
AND    A.VSL_CD        = @[vsl_cd]
AND    A.SKD_VOY_NO    = @[skd_voy_no]
AND    A.SKD_DIR_CD    = @[skd_dir_cd]
AND    A.REV_DIR_CD    = @[rev_dir_cd]			]]></sql>
			<params>
				<param name="jo_crr_cd" type="12" value="EMC" out="N"/>
				<param name="trd_cd" type="12" value="TAS" out="N"/>
				<param name="rlane_cd" type="12" value="NTATA" out="N"/>
				<param name="vsl_cd" type="12" value="IRRE" out="N"/>
				<param name="skd_voy_no" type="12" value="0938" out="N"/>
				<param name="skd_dir_cd" type="12" value="E" out="N"/>
				<param name="acct_yrmon" type="12" value="200912" out="N"/>
				<param name="re_divr_cd" type="12" value="E" out="N"/>
				<param name="jo_stl_itm_cd" type="12" value="OUS" out="N"/>
				<param name="rev_dir_cd" type="12" value="E" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
