<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceIssueDBDAOModifySpndVatRgstSeqUSQL">
			<desc><![CDATA[CMBBB 인경우
현재 필터테이블에서 BL_NO 취득후
BL_NO에 해당하는  I/F NO의 커스터머 코드로 SPND_VAT_RGST_NO를 조회한 후
값이 존재할 경우 해당 BL의 INV_NO에 해당하는 SPND_RGST_SEQ를 조회한다.
한 BL에 해당하는 모든 INV_NO의 SPND_RGST_SEQ값이 존재하지 않을경우 
ISS테이블에 SEQ값을  UPDATE한다.]]></desc>
			<sql><![CDATA[
UPDATE INV_AR_ISS ISS
SET    ISS.SPND_VAT_RGST_SEQ = INV_AR_SPND_VAT_RGST_SEQ.NEXTVAL
WHERE  ISS.INV_SEQ = 1
AND    ISS.ISS_DT  = TO_CHAR(sysdate,'YYYYMMDD')
AND    ISS.INV_NO IN    (
                        SELECT  DISTINCT DTL.INV_NO
                        FROM    (
                                SELECT  MAIN.BL_SRC_NO
                                FROM    INV_AR_MN                   MAIN
                                       ,INV_AR_SPND_VAT_RGST_NO     SPND
                                       ,INV_AR_ISS_DTL              DTL
                                       ,INV_AR_ISS                  ISS
                                WHERE   MAIN.BL_SRC_NO IN (
                                                     SELECT  BL_SRC_NO
                                                     FROM    INV_AR_ISS_FTR
                                                     WHERE   INV_ISS_WRK_NO = @[wrk_no]
                                                     )
                                AND     MAIN.AR_OFC_CD       = @[ar_ofc_cd]
                                AND     MAIN.AR_IF_NO        = DTL.AR_IF_NO
                                AND     SPND.CUST_CNT_CD     = MAIN.ACT_CUST_CNT_CD (+)
                                AND     SPND.CUST_SEQ        = MAIN.ACT_CUST_SEQ (+)
                                AND     SPND.SPND_VAT_RGST_NO IS NOT NULL
                                AND     DTL.INV_NO           = ISS.INV_NO
                                GROUP BY MAIN.BL_SRC_NO 
                                HAVING  COUNT(ISS.SPND_VAT_RGST_SEQ) = 0
                                )                            SEQ_NULL_BL_NO
                                ,INV_AR_ISS_FTR              FTR
                                ,INV_AR_ISS_DTL              DTL
                        WHERE   1=1
                        AND     SEQ_NULL_BL_NO.BL_SRC_NO = FTR.BL_SRC_NO
                        AND     FTR.AR_IF_NO             = DTL.AR_IF_NO
						)			]]></sql>
			<params>
				<param name="wrk_no" type="12" value="" out="N"/>
				<param name="ar_ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
