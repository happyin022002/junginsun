<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CarrierSettlementProcessDBDAOAddRowOusRdrRSQL">
			<desc><![CDATA[Row Add로 VVD변경시 create에서 가져오는 모든 정보를 가져온다.]]></desc>
			<sql><![CDATA[
SELECT T.STL_BZC_PORT_CD
     , T.BZC_PORT_ETA_DT
     , TO_CHAR(T.BZC_PORT_ETA_DT,'YYYYMMDDHH24MISS') AS ETA_DT
     , T.UC_BSS_PORT_CD
     , TO_CHAR(T.UC_BSS_PORT_ETD_DT,'YYYYMMDDHH24MISS') AS UC_BSS_PORT_ETD_DT
     , 0 AS FNL_HJS_BSA_QTY
     , 0 AS FNL_BSA_WGT
     , T.BSA_PER_WGT
     , T.STL_VVD_SEQ
FROM (
        SELECT J.STL_VVD_SEQ, J.STL_BZC_PORT_CD, J.BZC_PORT_ETD_DT BZC_PORT_ETA_DT, J.UC_BSS_PORT_CD, J.UC_BSS_PORT_ETD_DT
             -- 2010.01.19 PER WEIGHT는 CARRIER MERGE하지말고 해당 선사것만 가져온다.
             , TRUNC(SUM(C.CRR_BSA_CAPA),2) BSA_PER_WGT
        FROM   JOO_STL_VVD     J
              ,BSA_VVD_OTR_CRR C 
        WHERE  J.ACCT_YRMON    = REPLACE(@[acct_yrmon],'-','')
        AND    J.TRD_CD        = @[trd_cd]
        AND    J.JO_CRR_CD     = @[jo_crr_cd]
        AND    J.RLANE_CD      = @[rlane_cd]
        AND    J.JO_STL_ITM_CD = @[jo_stl_itm_cd]
        -- OUS M/S 인 것을 제외하기 위함 => OTH에서 처리
        AND    J.JO_MNU_NM     IN ('RDR','TDR')
        AND    J.RE_DIVR_CD    = @[re_divr_cd]
        AND    J.VSL_CD        = @[vsl_cd]
        AND    J.SKD_VOY_NO    = @[skd_voy_no]
        AND    J.SKD_DIR_CD    = @[skd_dir_cd]
        AND    J.REV_DIR_CD    = @[rev_dir_cd]
        AND    J.JO_STL_CFM_CD = 'Y'
        AND    J.VSL_CD        = C.VSL_CD    (+)
        AND    J.SKD_VOY_NO    = C.SKD_VOY_NO(+)
        AND    J.SKD_DIR_CD    = C.SKD_DIR_CD(+)
        AND    J.RLANE_CD      = C.RLANE_CD  (+)
        AND    J.JO_CRR_CD     = C.CRR_CD    (+)
        AND    J.TRD_CD        = C.TRD_CD    (+)
        AND    C.BSA_OP_JB_CD(+) = '008'
        GROUP  BY J.STL_VVD_SEQ, J.STL_BZC_PORT_CD, J.BZC_PORT_ETD_DT, J.UC_BSS_PORT_CD, J.UC_BSS_PORT_ETD_DT
       )T			]]></sql>
			<params>
				<param name="acct_yrmon" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="jo_crr_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="jo_stl_itm_cd" type="12" value="" out="N"/>
				<param name="re_divr_cd" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="rev_dir_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
