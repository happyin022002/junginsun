<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ARInvoiceInquiryDBDAOSearchPCFStatusInfoRSQL">
			<desc><![CDATA[Search PCF Status Info]]></desc>
			<sql><![CDATA[
#if (${re_divr_cd} == 'R')	
    SELECT CHN_AGN_CD
         , VVD_CD
         , CNT1 , AMT1
         , CNT2 , AMT2
         , CNT3 , AMT3
         , CNT4 , AMT4
         , CNT5 , AMT5
         , CNT6 , AMT6
         , CNT7 , AMT7
         , CNT8 , AMT8
         , CNT1 + CNT2 + CNT3 + CNT4 + CNT5 + CNT6 + CNT7 + CNT8 AS TOT_CNT
         , AMT1 + AMT2 + AMT3 + AMT4 + AMT5 + AMT6 + AMT7 + AMT8 AS TOT_AMT
    FROM (
            SELECT A.CHN_AGN_CD
                 , B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD AS VVD_CD
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'D2'   , 1, 0)) AS CNT1
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'T2'   , 1, 0)) AS CNT2
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'AW2'  , 1, 0)) AS CNT3
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'D4/5' , 1, 0)) AS CNT4
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'T4/5' , 1, 0)) AS CNT5
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'AW45' , 1, 0)) AS CNT6
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'D7'   , 1, 0)) AS CNT7
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'DG7'  , 1, 0)) AS CNT8
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'D2'   , F.PCF_UT_AMT1, 0)) AS AMT1
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'T2'   , F.PCF_UT_AMT2, 0)) AS AMT2
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'AW2'  , F.PCF_UT_AMT3, 0)) AS AMT3
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'D4/5' , F.PCF_UT_AMT4, 0)) AS AMT4
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'T4/5' , F.PCF_UT_AMT5, 0)) AS AMT5
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'AW45' , F.PCF_UT_AMT6, 0)) AS AMT6
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'D7'   , F.PCF_UT_AMT7, 0)) AS AMT7
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'DG7'  , F.PCF_UT_AMT8, 0)) AS AMT8
            FROM BKG_BOOKING A
               , BKG_VVD B
               , BKG_CONTAINER C
               , VSK_ACT_PORT_SKD D
               , INV_PCF_CNTR_TP_SZ E
               , INV_PCF_REV_EXPN_AMT F
           #if (${vvd_cd} != '')	
               , (SELECT TRIM(COLUMN_VALUE) AS VVD FROM TABLE(BKG_SPLIT_FNC(@[vvd_cd], ',')) WHERE COLUMN_VALUE IS NOT NULL) G  
           #end
            WHERE A.BKG_NO = B.BKG_NO
            AND A.BKG_NO = C.BKG_NO
            AND B.VSL_CD = D.VSL_CD
            AND B.SKD_VOY_NO = D.SKD_VOY_NO
            AND B.SKD_DIR_CD = D.SKD_DIR_CD
            AND B.POL_CD = D.VPS_PORT_CD
            AND B.POL_CLPT_IND_SEQ = D.CLPT_IND_SEQ
        #if (${vvd_cd} != '')
            AND B.VSL_CD = SUBSTR(G.VVD, 1, 4)
            AND B.SKD_VOY_NO = SUBSTR(G.VVD, 5, 4)
            AND B.SKD_DIR_CD = SUBSTR(G.VVD, 9, 1)
        #end
            AND E.BKG_CNTR_TPSZ_CD = C.CNTR_TPSZ_CD
            AND E.RD_CGO_FLG = C.RD_CGO_FLG
            AND E.DCGO_FLG = C.DCGO_FLG
            AND F.PORT_CD = B.POL_CD
            AND A.CHN_AGN_CD IS NOT NULL
            AND B.VSL_PRE_PST_CD = 'T'
        #if (${pol_cd} != '')    
            AND B.POL_CD = @[pol_cd]
        #end
        #if (${chn_agn_cd} != '') 
            AND A.CHN_AGN_CD = @[chn_agn_cd]
        #end
            AND F.RE_DIVR_CD = @[re_divr_cd]
            AND TO_CHAR(D.ACT_DEP_DT, 'YYYYMMDD') BETWEEN REPLACE(@[fm_atd_dt],'-','') AND REPLACE(@[to_atd_dt],'-','')
            AND TO_CHAR(D.ACT_DEP_DT, 'YYYYMMDD') BETWEEN F.FM_EFF_DT AND F.TO_EFF_DT
            GROUP BY A.CHN_AGN_CD
                   , B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD
    )
    ORDER BY CHN_AGN_CD
           , VVD_CD
#else
    SELECT TMNL_CD
         , VVD_CD
         , CNT1 , AMT1
         , CNT2 , AMT2
         , CNT3 , AMT3
         , CNT4 , AMT4
         , CNT5 , AMT5
         , CNT6 , AMT6
         , CNT7 , AMT7
         , CNT8 , AMT8
         , CNT1 + CNT2 + CNT3 + CNT4 + CNT5 + CNT6 + CNT7 + CNT8 AS TOT_CNT
         , AMT1 + AMT2 + AMT3 + AMT4 + AMT5 + AMT6 + AMT7 + AMT8 AS TOT_AMT
    FROM (
            SELECT SUBSTR(B.POL_YD_CD, 6) AS TMNL_CD
                 , B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD AS VVD_CD
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'D2'   , 1, 0)) AS CNT1
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'T2'   , 1, 0)) AS CNT2
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'AW2'  , 1, 0)) AS CNT3
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'D4/5' , 1, 0)) AS CNT4
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'T4/5' , 1, 0)) AS CNT5
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'AW45' , 1, 0)) AS CNT6
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'D7'   , 1, 0)) AS CNT7
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'DG7'  , 1, 0)) AS CNT8
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'D2'   , F.PCF_UT_AMT1, 0)) AS AMT1
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'T2'   , F.PCF_UT_AMT2, 0)) AS AMT2
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'AW2'  , F.PCF_UT_AMT3, 0)) AS AMT3
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'D4/5' , F.PCF_UT_AMT4, 0)) AS AMT4
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'T4/5' , F.PCF_UT_AMT5, 0)) AS AMT5
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'AW45' , F.PCF_UT_AMT6, 0)) AS AMT6
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'D7'   , F.PCF_UT_AMT7, 0)) AS AMT7
                 , SUM(DECODE(E.PCF_CNTR_TPSZ_CD, 'DG7'  , F.PCF_UT_AMT8, 0)) AS AMT8
            FROM BKG_BOOKING A
               , BKG_VVD B
               , BKG_CONTAINER C
               , VSK_ACT_PORT_SKD D
               , INV_PCF_CNTR_TP_SZ E
               , INV_PCF_REV_EXPN_AMT F
           #if (${vvd_cd} != '')	
               , (SELECT TRIM(COLUMN_VALUE) AS VVD FROM TABLE(BKG_SPLIT_FNC(@[vvd_cd], ',')) WHERE COLUMN_VALUE IS NOT NULL) G  
           #end
            WHERE A.BKG_NO = B.BKG_NO
            AND A.BKG_NO = C.BKG_NO
            AND B.VSL_CD = D.VSL_CD
            AND B.SKD_VOY_NO = D.SKD_VOY_NO
            AND B.SKD_DIR_CD = D.SKD_DIR_CD
            AND B.POL_CD = D.VPS_PORT_CD
            AND B.POL_CLPT_IND_SEQ = D.CLPT_IND_SEQ
        #if (${vvd_cd} != '')
            AND B.VSL_CD = SUBSTR(G.VVD, 1, 4)
            AND B.SKD_VOY_NO = SUBSTR(G.VVD, 5, 4)
            AND B.SKD_DIR_CD = SUBSTR(G.VVD, 9, 1)
        #end
            AND E.BKG_CNTR_TPSZ_CD = C.CNTR_TPSZ_CD
            AND E.RD_CGO_FLG = C.RD_CGO_FLG
            AND E.DCGO_FLG = C.DCGO_FLG
            AND F.PORT_CD = B.POL_CD
            AND B.VSL_PRE_PST_CD = 'T'
        #if (${pol_cd} != '')    
            AND B.POL_CD = @[pol_cd]
        #end
        #if (${tmnl_cd} != '') 
            AND SUBSTR(B.POL_YD_CD, 6) = @[tmnl_cd]
        #end
            AND F.RE_DIVR_CD = @[re_divr_cd]
            AND TO_CHAR(D.ACT_DEP_DT, 'YYYYMMDD') BETWEEN REPLACE(@[fm_atd_dt],'-','') AND REPLACE(@[to_atd_dt],'-','')
            AND TO_CHAR(D.ACT_DEP_DT, 'YYYYMMDD') BETWEEN F.FM_EFF_DT AND F.TO_EFF_DT
            GROUP BY SUBSTR(B.POL_YD_CD, 6)
                   , B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD
    )
    ORDER BY TMNL_CD
           , VVD_CD
#end			]]></sql>
			<params>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="chn_agn_cd" type="12" value="" out="N"/>
				<param name="re_divr_cd" type="12" value="" out="N"/>
				<param name="fm_atd_dt" type="12" value="" out="N"/>
				<param name="to_atd_dt" type="12" value="" out="N"/>
				<param name="tmnl_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
