<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ARInvoiceInquiryDBDAOSearchGSTListByDateRSQL">
			<desc><![CDATA[RHQ를 조건으로 BOMBB Office 아닌 타  Office 의 채권 데이터중 Option에 따라서 I/F date or S/A date를 비교하여  "GST"CHarge 가 있는 대상을 조회하여 USD, INR Currnecy로 환산하여 보여줌.
USD, INR Currnecy환산금액은  채권데이터의  GL_EFF_DT기준 경리환율로 계산한다.]]></desc>
			<sql><![CDATA[
SELECT TB.AR_HD_QTR_OFC_CD,
  TB.AR_OFC_CD,
  TB.BL_SRC_NO,
  TB.SAIL_ARR_DT,
  TB.BL_INV_CFM_DT,
  TB.VVD,
  TB.POL_CD,
  TB.CURR_CD,
  ROUND(SUM(TB.USD_AMT),2) USD_AMT,
  TB.CUST_CODE,
  TB.CUST_LGL_ENG_NM,
  TB.BKG_NO,
  TB.BL_INV_IF_DT,
  TB.AR_IF_NO,
  TB.POD_CD,
  SUM(TB.CHG_AMT) CHG_AMT,
  ROUND(SUM(TB.INR_AMT),2) INR_AMT
FROM (
    SELECT C.AR_HD_QTR_OFC_CD,
      A.AR_OFC_CD,
      A.BL_SRC_NO,
      A.SAIL_ARR_DT,
      A.BL_INV_CFM_DT,
      A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD VVD,
      A.POL_CD,
      X.CURR_CD,
     ( X.CHG_AMT /( SELECT S1.USD_LOCL_XCH_RT 
                          FROM GL_MON_XCH_RT S1
                          WHERE S1.ACCT_XCH_RT_YRMON = SUBSTR(A.GL_EFF_DT, 0, 6)
                          AND S1.ACCT_XCH_RT_LVL = '1'
                          AND S1.CURR_CD = X.CURR_CD )) USD_AMT,
      A.ACT_CUST_CNT_CD||'-'||LPAD(A.ACT_CUST_SEQ, 6, '0') CUST_CODE,
      D.CUST_LGL_ENG_NM,
      A.BKG_NO,
      A.BL_INV_IF_DT,
      A.AR_IF_NO,
      A.POD_CD,
      X.CHG_AMT,
     (X.CHG_AMT / (
            SELECT (S1.USD_LOCL_XCH_RT/S2.USD_LOCL_XCH_RT) USD_LOCL_XCH_RT
            FROM GL_MON_XCH_RT S1,
                 GL_MON_XCH_RT S2
            WHERE S1.ACCT_XCH_RT_YRMON = SUBSTR(A.GL_EFF_DT, 0, 6)
              AND S1.ACCT_XCH_RT_LVL = '1'
              AND S1.CURR_CD = X.CURR_CD
              AND S2.ACCT_XCH_RT_YRMON = SUBSTR(A.GL_EFF_DT, 0, 6)
              AND S2.ACCT_XCH_RT_LVL = '1'
              AND S2.CURR_CD = 'INR' )) INR_AMT
    FROM (
        SELECT A.ROWID RID,
          B.CURR_CD,
          B.CHG_AMT,
          B.INV_XCH_RT,
          ROWNUM RNUM
        FROM INV_AR_MN A,
          INV_AR_CHG B
        WHERE A.AR_IF_NO = B.AR_IF_NO 
#if (${date_option} == 'G')									
      AND A.BL_INV_CFM_DT BETWEEN REPLACE(@[from_date], '-', '') AND REPLACE(@[to_date], '-', '')									
#elseif (${date_option} == 'I')									
      AND A.BL_INV_IF_DT BETWEEN REPLACE(@[from_date], '-', '') AND REPLACE(@[to_date], '-', '')									
#elseif (${date_option} == 'A')									
      AND A.SAIL_ARR_DT BETWEEN REPLACE(@[from_date], '-', '') AND REPLACE(@[to_date], '-', '')									
#end   
     
#if (${ar_hd_qtr_ofc_cd} != 'All')
          AND A.AR_OFC_CD IN (
            SELECT AR_OFC_CD
            FROM MDM_ORGANIZATION
            WHERE AR_HD_QTR_OFC_CD = @[ar_hd_qtr_ofc_cd]
              AND OFC_CD = AR_OFC_CD )
#end
          AND A.AR_OFC_CD <> 'BOMSC'
          AND B.CHG_CD = 'GST'
          AND NVL(A.INV_DELT_DIV_CD, 'N') <> 'Y'
          AND A.BL_INV_CFM_DT IS NOT NULL ) X,
      INV_AR_MN A,
      MDM_ORGANIZATION C,
      MDM_CUSTOMER D
    WHERE X.RID = A.ROWID
      AND A.AR_OFC_CD = C.OFC_CD
      AND A.ACT_CUST_CNT_CD = D.CUST_CNT_CD
      AND A.ACT_CUST_SEQ = D.CUST_SEQ
      AND C.AR_HD_QTR_OFC_CD = @[ar_hd_qtr_ofc_cd] ) TB
GROUP BY TB.AR_HD_QTR_OFC_CD, TB.AR_OFC_CD, TB.BL_SRC_NO, TB.SAIL_ARR_DT,TB.BL_INV_CFM_DT, TB.VVD, TB.POL_CD, TB.CURR_CD, TB.CUST_CODE, TB.CUST_LGL_ENG_NM, TB.BKG_NO, TB.BL_INV_IF_DT, TB.AR_IF_NO, TB.POD_CD			]]></sql>
			<params>
				<param name="from_date" type="12" value="" out="N"/>
				<param name="to_date" type="12" value="" out="N"/>
				<param name="ar_hd_qtr_ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
