<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ARInvoiceInquiryDBDAOSearchPopSGNBBInvoiceListByIssueDateRSQL">
			<desc><![CDATA[DESC Enter..]]></desc>
			<sql><![CDATA[
SELECT TB.BL_SRC_NO,
  TB.INV_NO,
  TB.ACT_INV_NO,
  TB.VVD,
  TB.INV_TYPE,
  TB.CUSTOMER,
  TB.ISS_DT,
  SUM(ST.LCL_AMT) LCL_AMT,
  TB.CRE_USR_ID
  --TB.UPD_DT
FROM (
    SELECT D.BL_SRC_NO,
      A.INV_NO,
      A.ACT_INV_NO,
      D.VSL_CD||D.SKD_VOY_NO||D.SKD_DIR_CD VVD,
      DECODE (SUBSTR(A.INV_NO, 0, 1), 'F', 'FRT', 'T', 'THC', 'H', 'DHF', 'D', 'DMR', 'R', 'M&R', 'M', 'MRI', 'S', 'SLF', 'C', 'CLN') INV_TYPE,
      D.ACT_CUST_CNT_CD||'-'||LPAD(D.ACT_CUST_SEQ, 6, '0') CUSTOMER,
      A.ISS_DT,
      A.CRE_USR_ID,
      A.UPD_DT
    FROM INV_AR_ISS A,
      INV_AR_ISS_DTL B,
      INV_AR_MN D
    WHERE A.INV_NO = B.INV_NO
      AND B.AR_IF_NO = D.AR_IF_NO
#if (${iss_fm_dt} != '')
  AND A.ISS_DT BETWEEN REPLACE(@[iss_fm_dt],'-','') AND REPLACE(@[iss_to_dt],'-','')
#end
  AND A.ISS_OFC_CD IN (
    SELECT OFC_CD
    FROM MDM_ORGANIZATION
    WHERE AR_OFC_CD = @[office])
  AND A.INV_SEQ = 1
  AND D.AR_OFC_CD = @[office]
  AND D.AR_IF_NO = (
    SELECT MAX(S1.AR_IF_NO)
    FROM INV_AR_MN S1,
      INV_AR_CHG S2,
      INV_AR_ISS_DTL S3
    WHERE S1.AR_IF_NO = S2.AR_IF_NO
      AND S2.AR_IF_NO = S3.AR_IF_NO
      AND S2.CHG_SEQ = S3.CHG_SEQ
      AND S1.AR_OFC_CD = D.AR_OFC_CD
      AND S1.BL_SRC_NO = D.BL_SRC_NO
      AND S3.INV_NO = A.INV_NO
      AND NVL(S1.INV_DELT_DIV_CD, 'N') <> 'Y')
#if (${bl_src_no} != '')
      AND D.BL_SRC_NO = @[bl_src_no]
#end
#if (${inv_no} != '')
      AND A.INV_NO = @[inv_no]
#end
#if (${act_inv_no} != '')
      AND A.ACT_INV_NO = @[act_inv_no]
#end
#if (${inv_type} != '' && ${inv_type} != ' ')
	AND (A.INV_NO = '111'
	#if (${inv_type1} == 'F')
      OR A.INV_NO LIKE 'F%'
	#end
	#if (${inv_type2} == 'T')
      OR A.INV_NO LIKE 'T%'
	#end
	#if (${inv_type3} == 'H')
      OR A.INV_NO LIKE 'H%'
	#end
	#if (${inv_type4} == 'D')
      OR A.INV_NO LIKE 'D%'
	#end
	#if (${inv_type5} == 'R')
      OR A.INV_NO LIKE 'R%'
	#end
	#if (${inv_type6} == 'M')
      OR A.INV_NO LIKE 'M%'
	#end
	#if (${inv_type7} == 'S')
      OR A.INV_NO LIKE 'S%'
	#end
	#if (${inv_type8} == 'C')
      OR A.INV_NO LIKE 'C%'
	#end
	)
#end
#if (${cust_cnt_cd} != '')
      AND D.ACT_CUST_CNT_CD = @[cust_cnt_cd]
#end
#if (${cust_seq} != '')
      AND D.ACT_CUST_SEQ = @[cust_seq]
#end
#if (${usr_id} != '')
      AND A.CRE_USR_ID = @[usr_id]
#end
      AND NVL(D.INV_DELT_DIV_CD, 'N') <> 'Y'
    GROUP BY D.BL_SRC_NO, A.INV_NO, A.ACT_INV_NO, D.VSL_CD, D.SKD_VOY_NO, D.SKD_DIR_CD, D.ACT_CUST_CNT_CD, D.ACT_CUST_SEQ, A.ISS_DT, A.CRE_USR_ID, A.UPD_DT ) TB,
  (
    SELECT A1.INV_NO,
      C1.BL_SRC_NO,
      SUM(D1.CHG_AMT) * D1.INV_XCH_RT LCL_AMT
    FROM INV_AR_ISS A1,
      INV_AR_ISS_DTL B1,
      INV_AR_MN C1,
      INV_AR_CHG D1
    WHERE A1.INV_NO = B1.INV_NO
      AND B1.AR_IF_NO = C1.AR_IF_NO
      AND B1.AR_IF_NO = D1.AR_IF_NO
      AND B1.CHG_SEQ = D1.CHG_SEQ
      AND C1.AR_IF_NO = D1.AR_IF_NO
#if (${iss_fm_dt} != '')
      AND A1.ISS_DT BETWEEN REPLACE(@[iss_fm_dt],'-','') AND REPLACE(@[iss_to_dt],'-','')
#end
      AND A1.ISS_OFC_CD IN (
        SELECT OFC_CD
        FROM MDM_ORGANIZATION
        WHERE AR_OFC_CD = @[office])
      AND A1.INV_SEQ = 1
      AND C1.AR_OFC_CD = @[office]
#if (${bl_src_no} != '')
      AND C1.BL_SRC_NO = @[bl_src_no]
#end
#if (${inv_no} != '')
      AND A1.INV_NO = @[inv_no]
#end
#if (${act_inv_no} != '')
      AND A1.ACT_INV_NO = @[act_inv_no]
#end
#if (${inv_type} != '' && ${inv_type} != ' ')
	AND (A1.INV_NO = '111'
	#if (${inv_type1} == 'F')
      OR A1.INV_NO LIKE 'F%'
	#end
	#if (${inv_type2} == 'T')
      OR A1.INV_NO LIKE 'T%'
	#end
	#if (${inv_type3} == 'H')
      OR A1.INV_NO LIKE 'H%'
	#end
	#if (${inv_type4} == 'D')
      OR A1.INV_NO LIKE 'D%'
	#end
	#if (${inv_type5} == 'R')
      OR A1.INV_NO LIKE 'R%'
	#end
	#if (${inv_type6} == 'M')
      OR A1.INV_NO LIKE 'M%'
	#end
	#if (${inv_type7} == 'S')
      OR A1.INV_NO LIKE 'S%'
	#end
	#if (${inv_type8} == 'C')
      OR A1.INV_NO LIKE 'C%'
	#end
	)
#end
#if (${cust_cnt_cd} != '')
      AND C1.ACT_CUST_CNT_CD = @[cust_cnt_cd]
#end
#if (${cust_seq} != '')
      AND C1.ACT_CUST_SEQ = @[cust_seq]
#end
#if (${usr_id} != '')
      AND A1.CRE_USR_ID = @[usr_id]
#end
    GROUP BY A1.ISS_DT, A1.INV_NO, A1.ACT_INV_NO, C1.BL_SRC_NO, C1.VSL_CD||C1.SKD_VOY_NO||C1.SKD_DIR_CD, C1.ACT_CUST_CNT_CD||'-'||LPAD(C1.ACT_CUST_SEQ, 6, '0'), D1.INV_XCH_RT) ST
WHERE TB.BL_SRC_NO = ST.BL_SRC_NO
  AND TB.INV_NO = ST.INV_NO
GROUP BY TB.BL_SRC_NO, TB.INV_NO, TB.ACT_INV_NO, TB.VVD, TB.INV_TYPE, TB.CUSTOMER, TB.ISS_DT, TB.CRE_USR_ID, TB.UPD_DT
ORDER BY TB.UPD_DT, TB.BL_SRC_NO, TB.INV_NO			]]></sql>
			<params>
				<param name="iss_fm_dt" type="12" value="" out="N"/>
				<param name="iss_to_dt" type="12" value="" out="N"/>
				<param name="office" type="12" value="" out="N"/>
				<param name="bl_src_no" type="12" value="" out="N"/>
				<param name="inv_no" type="12" value="" out="N"/>
				<param name="act_inv_no" type="12" value="" out="N"/>
				<param name="cust_cnt_cd" type="12" value="" out="N"/>
				<param name="cust_seq" type="12" value="" out="N"/>
				<param name="usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
