<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceIssueDBDAOSearchGIROMainRSQL">
			<desc><![CDATA[MDM_CUSTOMER, MDM_CR_CUST, MDM_CUST_ADDR, INV_AR_MN, INV_AR_CHG 테이블에서 select]]></desc>
			<sql><![CDATA[
SELECT BL_SRC_NO,
  GIRO_NO,
  ISS_DT,
  AR_OFC_CD,
  ACT_CUST_CNT_CD,
  ACT_CUST_SEQ,
  LOCL_NM,
  CUST_RGST_NO,
  LOCL_ADDR,
  OWNR_NM,
  BZCT_NM,
  VVD,
  SAIL_ARR_DT,
  DUE_DT,
  GIRO_RMK,
  INV_SPL_AMT,
  INV_TVA_AMT
FROM (
    SELECT T1.DATA_GB,
      T1.BL_SRC_NO,
      T1.GIRO_NO,
      T1.ISS_DT,
      T1.AR_OFC_CD,
      T1.ACT_CUST_CNT_CD,
      T1.ACT_CUST_SEQ,
      T1.LOCL_NM,
      T1.CUST_RGST_NO,
      T1.LOCL_ADDR,
      T1.OWNR_NM,
      T1.BZCT_NM,
      T1.VVD,
      T1.SAIL_ARR_DT,
      T1.DUE_DT,
      T1.GIRO_RMK,
      NVL(T2.INV_SPL_AMT,'0') INV_SPL_AMT,
      NVL(T2.INV_TVA_AMT,'0') INV_TVA_AMT
    FROM (
        SELECT '1' DATA_GB,
          A.BL_SRC_NO,
          A.GIRO_NO,
          TO_CHAR(TO_DATE(A.ISS_DT, 'YYYYMMDD'), 'YYYY-MM-DD') ISS_DT,
          A.AR_OFC_CD,
          A.ACT_CUST_CNT_CD,
          LPAD(A.ACT_CUST_SEQ, 6, '0') ACT_CUST_SEQ,
          B.LOCL_NM,
          DECODE(C.INDIV_CORP_DIV_CD, 'C', CASE WHEN LENGTH(C.CUST_RGST_NO) = 10 THEN SUBSTR(C.CUST_RGST_NO, 0, 3)||'-'||SUBSTR(C.CUST_RGST_NO, 4, 2)||'-'||SUBSTR(C.CUST_RGST_NO, 6, 5) ELSE C.CUST_RGST_NO END, 'P', CASE WHEN LENGTH(C.CUST_RGST_NO) = 13 THEN SUBSTR(C.CUST_RGST_NO, 0, 6) ||'-'||SUBSTR(C.CUST_RGST_NO, 7, 13) ELSE C.CUST_RGST_NO END) CUST_RGST_NO,
          B.LOCL_ADDR1||B.LOCL_ADDR2||B.LOCL_ADDR3||B.LOCL_ADDR4 LOCL_ADDR,
          B.OWNR_NM,
          B.BZCT_NM,
          A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD VVD,
          TO_CHAR(TO_DATE(A.SAIL_ARR_DT, 'YYYYMMDD'), 'YYYY-MM-DD') SAIL_ARR_DT,
          TO_CHAR(TO_DATE(A.DUE_DT, 'YYYYMMDD'), 'YYYY-MM-DD') DUE_DT,
          A.GIRO_RMK
        FROM INV_AR_GIRO A,
          MDM_CR_CUST B,
          MDM_CUSTOMER C
        WHERE A.ACT_CUST_CNT_CD = B.CUST_CNT_CD (+)
          AND A.ACT_CUST_SEQ = B.CUST_SEQ (+)
          AND A.ACT_CUST_CNT_CD = C.CUST_CNT_CD
          AND A.ACT_CUST_SEQ = C.CUST_SEQ
          AND A.GIRO_NO = (
            SELECT MIN(GIRO_NO)
            FROM INV_AR_GIRO
            WHERE BL_SRC_NO = @[bl_src_no]
              AND AR_OFC_CD = @[ar_ofc_cd]
              AND DELT_FLG = 'N')
          AND A.AR_OFC_CD = @[ar_ofc_cd]
          AND A.DELT_FLG = 'N'
        UNION ALL
        SELECT '2' DATA_GB,
          A.BL_SRC_NO,
          A.BL_SRC_NO||'01' GIRO_NO,
          TO_CHAR(SYSDATE, 'YYYY-MM-DD') ISS_DT,
          A.AR_OFC_CD,
          A.ACT_CUST_CNT_CD,
          LPAD(A.ACT_CUST_SEQ, 6, '0') ACT_CUST_SEQ,
          B.LOCL_NM,
          DECODE(C.INDIV_CORP_DIV_CD, 'C', CASE WHEN LENGTH(C.CUST_RGST_NO) = 10 THEN SUBSTR(C.CUST_RGST_NO, 0, 3)||'-'||SUBSTR(C.CUST_RGST_NO, 4, 2)||'-'||SUBSTR(C.CUST_RGST_NO, 6, 5) ELSE C.CUST_RGST_NO END, 'P', CASE WHEN LENGTH(C.CUST_RGST_NO) = 13 THEN SUBSTR(C.CUST_RGST_NO, 0, 6) ||'-'||SUBSTR(C.CUST_RGST_NO, 7, 13) ELSE C.CUST_RGST_NO END) CUST_RGST_NO,
          B.LOCL_ADDR1||B.LOCL_ADDR2||B.LOCL_ADDR3||B.LOCL_ADDR4 LOCL_ADDR,
          B.OWNR_NM,
          B.BZCT_NM,
          A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD VVD,
          TO_CHAR(TO_DATE(A.SAIL_ARR_DT, 'YYYYMMDD'), 'YYYY-MM-DD') SAIL_ARR_DT,
          TO_CHAR(TO_DATE(A.DUE_DT, 'YYYYMMDD'), 'YYYY-MM-DD') DUE_DT,
          '' GIRO_RMK
        FROM INV_AR_MN A,
          MDM_CR_CUST B,
          MDM_CUSTOMER C
        WHERE A.ACT_CUST_CNT_CD = B.CUST_CNT_CD (+)
          AND A.ACT_CUST_SEQ = B.CUST_SEQ (+)
          AND A.ACT_CUST_CNT_CD = C.CUST_CNT_CD
          AND A.ACT_CUST_SEQ = C.CUST_SEQ
          AND A.AR_IF_NO = (
            SELECT MAX(AR_IF_NO)
            FROM INV_AR_MN
            WHERE BL_SRC_NO = @[bl_src_no]
              AND AR_OFC_CD = @[ar_ofc_cd]
              AND NVL(INV_DELT_DIV_CD, 'N') <> 'Y')
          AND A.AR_OFC_CD = @[ar_ofc_cd]
          AND NVL(A.INV_DELT_DIV_CD, 'N') <> 'Y' ) T1,
      (
        SELECT BL_SRC_NO,
          SUM(SPL_AMT) INV_SPL_AMT,
          SUM(TVA_AMT) INV_TVA_AMT
        FROM (
            SELECT A.BL_SRC_NO,
              DECODE(B.CHG_CD, 'TVA', 0, ROUND(B.CHG_AMT * B.INV_XCH_RT, 0)) SPL_AMT,
              DECODE(B.CHG_CD, 'TVA', ROUND(B.CHG_AMT * B.INV_XCH_RT, 0), 0) TVA_AMT
            FROM INV_AR_MN A,
              INV_AR_CHG B
            WHERE A.AR_IF_NO = B.AR_IF_NO
              AND A.BL_SRC_NO = @[bl_src_no]
              AND A.AR_OFC_CD = @[ar_ofc_cd]
              AND NVL(A.INV_DELT_DIV_CD, 'N') <> 'Y'
              AND B.INV_CLR_FLG = 'N')
        GROUP BY BL_SRC_NO) T2
    WHERE T1.BL_SRC_NO = T2.BL_SRC_NO (+)
    ORDER BY DATA_GB)
WHERE ROWNUM = 1			]]></sql>
			<params>
				<param name="bl_src_no" type="12" value="" out="N"/>
				<param name="ar_ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
