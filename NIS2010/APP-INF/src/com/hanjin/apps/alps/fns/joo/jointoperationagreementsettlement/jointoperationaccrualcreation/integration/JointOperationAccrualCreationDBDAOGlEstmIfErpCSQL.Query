<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="JointOperationAccrualCreationDBDAOGlEstmIfErpCSQL">
			<desc><![CDATA[Estimation Insert]]></desc>
			<sql><![CDATA[
INSERT INTO GL_ESTM_IF_ERP (
	EXE_YRMON
,	SYS_SRC_ID
,	REV_YRMON
,	ACCT_CD
,	ESTM_SEQ_NO
,	AGMT_NO
,	WO_NO
,	BIZ_UT_ID
,	LOC_CD
,	VSL_CD
,	SKD_VOY_NO
,	SKD_DIR_CD
,	REV_DIR_CD
,	CNTR_TPSZ_CD
,	CNTR_QTY
,	BSA_SLT_QTY
,	CRR_CD
,	SLT_COST_AMT
,	CUST_CNT_CD
,	CUST_SEQ
,	VVD_DUR_NO
,	HIR_DT_AMT
,	ESTM_AMT
,	ACT_AMT
,	ACCL_AMT
,	ESTM_VVD_TP_CD
,	ESTM_IOC_DIV_CD
,	ESTM_VVD_HDR_ID
,	ESTM_BC_DIV_CD
,	OP_LSE_DIV_FLG
,	TTL_TRF_AMT
,	CRE_USR_ID
,	CRE_DT
,	UPD_USR_ID
,	UPD_DT
) 
    SELECT
        AA.EXE_YRMON
    ,	SYS_SRC_ID
    ,	AA.REV_YRMON
    ,	AA.ACCT_CD
    ,   ROWNUM AS ESTM_SEQ_NO
    ,	jo_stl_jb_cd     AS AGMT_NO
    ,	rlane_cd         AS WO_NO
    ,	jo_cntr_div_ctnt AS BIZ_UT_ID
    ,	LOC_CD
    ,	VSL_CD
    ,	SKD_VOY_NO
    ,	SKD_DIR_CD
    ,	REV_DIR_CD
    ,	NULL AS CNTR_TPSZ_CD
    ,	NULL AS CNTR_QTY
    ,	TO_NUMBER(REPLACE(bsa_qty,',','')) AS BSA_SLT_QTY
    ,	jo_crr_cd AS CRR_CD
    ,	TO_NUMBER(REPLACE(bsa_slt_prc,',','')) AS SLT_COST_AMT
    ,	CUST_CNT_CD
    ,	CUST_SEQ
    ,	NULL AS VVD_DUR_NO
    ,	NULL AS HIR_DT_AMT
    ,	ADJ_ESTM_AMT AS ESTM_AMT
    ,	ACT_AMT
    ,	ADJ_ACCL_AMT AS ACCL_AMT
    ,	ESTM_VVD_TP_CD
    ,	jo_ioc_div_cd   AS ESTM_IOC_DIV_CD
    ,	ESTM_VVD_HDR_ID
    ,	cntr_blk_div_cd AS ESTM_BC_DIV_CD
    ,	NULL AS OP_LSE_DIV_FLG
    ,	NULL AS TTL_TRF_AMT
    ,   @[cre_usr_id] 
    ,   SYSDATE
    ,   @[cre_usr_id]
    ,   SYSDATE
    FROM
    (
    SELECT IBFLAG
          ,EXE_YRMON
          ,REV_YRMON
          ,JO_CRR_CD
          ,TRD_CD
          ,VNDR_CUST_SEQ
          ,CUST_CNT_CD
          ,CUST_SEQ
          ,RE_DIVR_CD
          ,VVD
          ,VSL_CD
          ,SKD_VOY_NO
          ,SKD_DIR_CD
          ,REV_DIR_CD
          ,RLANE_CD
          ,JO_STL_JB_CD
          ,JO_STL_JB_NM
          ,BSA_QTY
          ,BSA_SLT_PRC
          ,ACCT_CD
          ,ESTM_AMT
          ,ACT_AMT
          ,ACCL_AMT
          ,DIFF_AMT
          ,ESTM_VVD_TP_CD
          ,JO_IOC_DIV_CD 
          ,ESTM_VVD_HDR_ID
          ,CNTR_BLK_DIV_CD
          ,SYS_SRC_ID
          ,LOC_CD
          ,JO_CNTR_DIV_CTNT
          ,ACCL_AMT_CORR_FLG
          ,ADJ_ESTM_FLG
          ,ADJ_BSA_QTY
          ,ADJ_BSA_SLT_PRC
          ,ADJ_ESTM_AMT
          ,ADJ_ACCL_AMT
          ,ADJ_RMK
          ,CRE_USR_ID
          ,UPD_USR_ID
          ,ESTM_ACT_SEQ
          ,ADJ_RSLT_CD
          ,ADJ_RLSE_RMK
      FROM (
            SELECT /*+INDEX(A XPKJOO_ESTM_ACT_RSLT)*/
                   ROWNUM AS RN 
                  ,'R' AS IBFLAG
                  ,A.EXE_YRMON
                  ,A.REV_YRMON
                  ,A.JO_CRR_CD
                  ,B.TRD_CD
                  ,CASE WHEN A.ACCT_CD LIKE '4%' THEN
                             B.CUST_CNT_CD||B.CUST_SEQ
                        WHEN A.ACCT_CD LIKE '5%' THEN
                             B.VNDR_SEQ||''
                   END AS VNDR_CUST_SEQ
                  ,CASE WHEN A.ACCT_CD LIKE '4%' THEN
                             B.CUST_CNT_CD
                        WHEN A.ACCT_CD LIKE '5%' THEN
                             ''
                   END AS CUST_CNT_CD
                  ,CASE WHEN A.ACCT_CD LIKE '4%' THEN
                             B.CUST_SEQ
                        WHEN A.ACCT_CD LIKE '5%' THEN
                             B.VNDR_SEQ
                   END AS CUST_SEQ
                  ,CASE WHEN A.ACCT_CD LIKE '4%' THEN
                             'R'
                        WHEN A.ACCT_CD LIKE '5%' THEN
                             'E'
                   END AS RE_DIVR_CD
                  ,A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD||A.REV_DIR_CD AS VVD
                  ,A.VSL_CD
                  ,A.SKD_VOY_NO
                  ,A.SKD_DIR_CD
                  ,A.REV_DIR_CD
                  ,A.RLANE_CD
                  ,A.JO_STL_JB_CD
                  ,C.NAME AS JO_STL_JB_NM
                  ,A.BSA_QTY
                  ,A.BSA_SLT_PRC
                  ,A.ACCT_CD
                  ,ROUND(A.ESTM_AMT,2) AS ESTM_AMT
                  ,ROUND(A.ACT_AMT, 2) AS ACT_AMT
                  ,ROUND(A.ACCL_AMT,2) AS ACCL_AMT
                  ,ROUND(A.ESTM_AMT,2) - ROUND(A.ACT_AMT,2) AS DIFF_AMT
                  ,A.ESTM_VVD_TP_CD
                  ,A.JO_IOC_DIV_CD
                  ,A.ESTM_VVD_HDR_ID
                  ,A.CNTR_BLK_DIV_CD
                  ,A.SYS_SRC_ID
                  ,A.LOC_CD
                  ,A.JO_CNTR_DIV_CTNT
                  ,A.ACCL_AMT_CORR_FLG
                  ,A.ADJ_ESTM_FLG
                  ,A.ADJ_BSA_QTY
                  ,A.ADJ_BSA_SLT_PRC
                  ,A.ADJ_ESTM_AMT
                  ,A.ADJ_ACCL_AMT
                  ,A.ADJ_RMK
                  ,A.CRE_USR_ID
                  ,A.UPD_USR_ID
                  ,A.ESTM_ACT_SEQ
                  ,A.ADJ_RSLT_CD
                  ,A.ADJ_RLSE_RMK
              FROM JOO_ESTM_ACT_RSLT A
                  ,JOO_CARRIER       B
                  ,(
                    SELECT A.INTG_CD_VAL_CTNT AS CODE
                          ,A.INTG_CD_VAL_DP_DESC AS NAME 
                      FROM COM_INTG_CD_DTL A 
                     WHERE A.INTG_CD_ID = 'CD01866'
                   ) C
             WHERE A.JO_CRR_CD = B.JO_CRR_CD
               AND A.RLANE_CD  = B.RLANE_CD
               AND A.JO_STL_JB_CD = C.CODE(+)
               AND A.EXE_YRMON = @[exe_yrmon]
               AND A.REV_YRMON = @[rev_yrmon]
               AND A.ACCT_CD = @[acct_cd]
             ORDER BY ACCT_CD, REV_YRMON, VVD
           )
    ) AA			]]></sql>
			<params>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="exe_yrmon" type="12" value="" out="N"/>
				<param name="rev_yrmon" type="12" value="" out="N"/>
				<param name="acct_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
