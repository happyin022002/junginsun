<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingARCreationDBDAOAddInvBkgIfFacChgCSQL">
			<desc><![CDATA[]]></desc>
			<sql><![CDATA[
INSERT INTO INV_BKG_IF_CHG												
(												
  BKG_NO ,												
  BKG_SEQ ,												
  CHG_SEQ ,												
  CHG_CD ,												
  CURR_CD ,												
  PER_TP_CD ,												
  TRF_RT_AMT ,												
  RAT_AS_CNTR_QTY ,												
  CHG_AMT ,												
  INV_XCH_RT ,												
  TRF_NO ,												
  OFC_CD ,												
  CUST_CNT_CD ,												
  CUST_SEQ ,												
  IO_BND_CD ,												
  N3RD_FLG ,												
  RCV_TERM_CD,                                                                                                                                                                                   												
  DE_TERM_CD,                                                                                                                                                                        												
  AUTO_RAT_CD,                                                                                                                                                                                 												
  ACT_CNT_CD,                                                                                                                                                                             												
  ACT_CUST_SEQ,												
  WHF_FLG,												
  CRE_USR_ID ,												
  CRE_DT ,												
  UPD_USR_ID ,												
  UPD_DT												
)												
SELECT FAC.BKG_NO,												
       @[bkg_seq],												
       NVL((SELECT MAX(NVL(CHG_SEQ,0))+1 FROM INV_BKG_IF_CHG												
         WHERE BKG_NO = @[bkg_no] AND BKG_SEQ = @[bkg_seq]),1),												
       'FAC', 												
       FAC.CURR_CD, 												
       'BL', 												
       ROUND(NVL(FAC.CRNT_AMT,0),2)*-1 , 												
       1, 												
       ROUND(NVL(FAC.CRNT_AMT,0),2)*-1,       												
       0,												
       '',												
       NVL(BKG.OFC_CD,@[ofc_cd]),												
       NVL(BKG.CUST_CNT_CD,@[cust_cnt_cd]),												
       NVL(BKG.CUST_SEQ,@[cust_seq]),												
       'O',												
       NVL(BKG.N3RD_FLG,'N'),												
       NVL(BKG.RCV_TERM_CD,''),                                                                                                                                                                                   												
       NVL(BKG.DE_TERM_CD,''),                                                                                                                                                                        												
       NVL(BKG.AUTO_RAT_CD,''),     												
       NVL(BKG.ACT_CNT_CD,''),                                                                                                                                                                             												
       NVL(BKG.ACT_CUST_SEQ,''),												
       NVL(BKG.WHF_FLG,'N'),												
       'FAC' CRE_USR_ID ,												
       SYSDATE ,												
       'FAC' UPD_USR_ID ,												
       SYSDATE												
  FROM ACM_FAC_COMM FAC,												
       INV_BKG_IF_CHG BKG												
 WHERE FAC.BKG_NO = BKG.BKG_NO(+)												
   AND FAC.SLS_OFC_CD = BKG.OFC_CD(+)												
   AND BKG.BKG_SEQ(+) = @[bkg_seq]												
   AND BKG.IO_BND_CD(+)  = 'O'												
   AND FAC.BKG_NO = @[bkg_no]												
   AND FAC.SLS_OFC_CD = @[ofc_cd]												
   AND FAC.FAC_STS_CD != 'CE'												
   AND FAC.CRE_USR_ID !='UNIT COST'												
   AND (FAC.BKG_NO, FAC.FAC_SEQ) = (SELECT /*+ INDEX_DESC(ACM_FAC_COMM, XPKACM_FAC_COMM)*/  C.BKG_NO,C.FAC_SEQ 												
                                      FROM ACM_FAC_COMM C 												
                                     WHERE C.BKG_NO = FAC.BKG_NO 												
                                       AND C.FAC_SEQ = FAC.FAC_SEQ AND ROWNUM = 1) 												
   AND NVL(FAC.CRNT_AMT,0) <> 0 												
   AND ROWNUM = 1			]]></sql>
			<params>
				<param name="bkg_seq" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="cust_cnt_cd" type="12" value="" out="N"/>
				<param name="cust_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
