/*=========================================================
*Copyright(c) 2016 CyberLogitec
*@FileName : CarrierSettlementProcessDBDAORobSummary5RSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2016.10.10
*@LastModifier : 
*@LastVersion : 1.0
* 2016.10.10 
* 1.0 Creation
=========================================================*/
package com.hanjin.apps.alps.fns.joo.jointoperationagreementsettlement.carriersettlementprocess.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.hanjin.framework.support.db.ISQLTemplate;

/**
 *
 * @author 
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class CarrierSettlementProcessDBDAORobSummary5RSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * Movement에서 POL, Movement POD(Movement에서 POD가 없을 경우, Booking에서 POL이 잘 못 된 경우, Movement에서 날짜 잘 못 된 경우 수정)
	  * </pre>
	  */
	public CarrierSettlementProcessDBDAORobSummary5RSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("pol_split_no",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("in_rc_flg",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("in_awk_cgo_flg",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("in_rd_cgo_flg",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("in_pol_yd_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("in_hot_de_flg",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("in_vvd_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("in_bb_cgo_flg",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("in_prct_flg",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("in_dcgo_flg",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("in_soc_flg",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("in_pol_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("in_hngr_flg",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.hanjin.apps.alps.fns.joo.jointoperationagreementsettlement.carriersettlementprocess.integration").append("\n"); 
		query.append("FileName : CarrierSettlementProcessDBDAORobSummary5RSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("WITH PRE_VVD AS (  " ).append("\n"); 
		query.append("	SELECT DISTINCT " ).append("\n"); 
		query.append("	   VSL_CD" ).append("\n"); 
		query.append("	  ,TURN_SKD_VOY_NO AS SKD_VOY_NO" ).append("\n"); 
		query.append("	  ,TURN_SKD_DIR_CD AS SKD_DIR_CD" ).append("\n"); 
		query.append("	FROM VSK_VSL_PORT_SKD" ).append("\n"); 
		query.append("	WHERE 1=1" ).append("\n"); 
		query.append("	AND LEVEL <= FLOOR(TO_NUMBER('3')/2)" ).append("\n"); 
		query.append("	AND (TURN_SKD_VOY_NO IS NOT NULL OR TURN_SKD_DIR_CD IS NOT NULL) START WITH VSL_CD = SUBSTR(@[in_vvd_cd],1,4)" ).append("\n"); 
		query.append("	AND SKD_VOY_NO = SUBSTR(@[in_vvd_cd],5,4)" ).append("\n"); 
		query.append("	AND SKD_DIR_CD = SUBSTR(@[in_vvd_cd],9,1)" ).append("\n"); 
		query.append("	AND TURN_PORT_IND_CD IN ('Y','N') CONNECT BY PRIOR TURN_SKD_VOY_NO = SKD_VOY_NO" ).append("\n"); 
		query.append("	AND PRIOR TURN_SKD_DIR_CD = SKD_DIR_CD" ).append("\n"); 
		query.append("	AND PRIOR VSL_CD = VSL_CD" ).append("\n"); 
		query.append("	AND TURN_PORT_IND_CD IN ('Y','N')" ).append("\n"); 
		query.append("	AND LEVEL <= FLOOR(TO_NUMBER('3')/2)" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", NEXT_VOY_NO_CNT AS (  " ).append("\n"); 
		query.append("		SELECT  " ).append("\n"); 
		query.append("		 COUNT(AA.SKD_VOY_NO) AS SKD_VOY_NO_CNT  " ).append("\n"); 
		query.append("		FROM  " ).append("\n"); 
		query.append("		(  " ).append("\n"); 
		query.append("				SELECT         " ).append("\n"); 
		query.append("				A.*  " ).append("\n"); 
		query.append("				FROM  " ).append("\n"); 
		query.append("				(  " ).append("\n"); 
		query.append("					SELECT  " ).append("\n"); 
		query.append("					VSL_CD, SKD_VOY_NO, SKD_DIR_CD, MAX(VPS_ETD_DT) AS VPS_ETD_DT  " ).append("\n"); 
		query.append("					FROM VSK_VSL_PORT_SKD  " ).append("\n"); 
		query.append("					WHERE VSL_CD = SUBSTR(@[in_vvd_cd],1,4)  " ).append("\n"); 
		query.append("					AND SKD_VOY_NO >= SUBSTR(@[in_vvd_cd],5,4)  " ).append("\n"); 
		query.append("					AND TURN_PORT_IND_CD IN ('Y','N')  " ).append("\n"); 
		query.append("					GROUP BY VSL_CD, SKD_VOY_NO, SKD_DIR_CD  " ).append("\n"); 
		query.append("				) A   " ).append("\n"); 
		query.append("				WHERE 1=1  " ).append("\n"); 
		query.append("				AND VPS_ETD_DT >=  ( SELECT MAX(VPS_ETD_DT)   " ).append("\n"); 
		query.append("									  FROM VSK_VSL_PORT_SKD  " ).append("\n"); 
		query.append("									  WHERE VSL_CD = SUBSTR(@[in_vvd_cd],1,4)  " ).append("\n"); 
		query.append("									  AND SKD_VOY_NO = SUBSTR(@[in_vvd_cd],5,4)  " ).append("\n"); 
		query.append("								  )                  " ).append("\n"); 
		query.append("				ORDER BY VPS_ETD_DT ASC  " ).append("\n"); 
		query.append("		) AA  " ).append("\n"); 
		query.append("		WHERE ROWNUM =1   " ).append("\n"); 
		query.append(")   " ).append("\n"); 
		query.append(",NEXT_VOY_NO AS (  " ).append("\n"); 
		query.append("	SELECT CASE WHEN (SELECT SKD_VOY_NO_CNT FROM NEXT_VOY_NO_CNT) > 0 THEN (  " ).append("\n"); 
		query.append("																			   SELECT  " ).append("\n"); 
		query.append("																				 AA.SKD_VOY_NO  " ).append("\n"); 
		query.append("																			   FROM  " ).append("\n"); 
		query.append("																			   (  " ).append("\n"); 
		query.append("																						SELECT         " ).append("\n"); 
		query.append("																						A.*  " ).append("\n"); 
		query.append("																						FROM  " ).append("\n"); 
		query.append("																						(  " ).append("\n"); 
		query.append("																							SELECT  " ).append("\n"); 
		query.append("																							VSL_CD, SKD_VOY_NO, SKD_DIR_CD, MAX(VPS_ETD_DT) AS VPS_ETD_DT  " ).append("\n"); 
		query.append("																							FROM VSK_VSL_PORT_SKD  " ).append("\n"); 
		query.append("																							WHERE VSL_CD = SUBSTR(@[in_vvd_cd],1,4)  " ).append("\n"); 
		query.append("																							AND SKD_VOY_NO >= SUBSTR(@[in_vvd_cd],5,4)  " ).append("\n"); 
		query.append("																							AND TURN_PORT_IND_CD IN ('Y','N')  " ).append("\n"); 
		query.append("																							GROUP BY VSL_CD, SKD_VOY_NO, SKD_DIR_CD  " ).append("\n"); 
		query.append("																						) A   " ).append("\n"); 
		query.append("																						WHERE 1=1  " ).append("\n"); 
		query.append("																						AND VPS_ETD_DT >=  ( SELECT MAX(VPS_ETD_DT)   " ).append("\n"); 
		query.append("																											  FROM VSK_VSL_PORT_SKD  " ).append("\n"); 
		query.append("																											  WHERE VSL_CD = SUBSTR(@[in_vvd_cd],1,4)  " ).append("\n"); 
		query.append("																											  AND SKD_VOY_NO = SUBSTR(@[in_vvd_cd],5,4)  " ).append("\n"); 
		query.append("																										  )                  " ).append("\n"); 
		query.append("																						ORDER BY VPS_ETD_DT ASC  " ).append("\n"); 
		query.append("																				) AA  " ).append("\n"); 
		query.append("																				WHERE ROWNUM =1    " ).append("\n"); 
		query.append("																			)  " ).append("\n"); 
		query.append("																			  " ).append("\n"); 
		query.append("				ELSE SUBSTR(@[in_vvd_cd],5,4)   " ).append("\n"); 
		query.append("				END SKD_VOY_NO  " ).append("\n"); 
		query.append("	FROM DUAL     " ).append("\n"); 
		query.append(")  " ).append("\n"); 
		query.append(", CTM_MOVEMENT2 AS (" ).append("\n"); 
		query.append("    SELECT *" ).append("\n"); 
		query.append("    FROM CTM_MOVEMENT A" ).append("\n"); 
		query.append("    WHERE 1=1" ).append("\n"); 
		query.append("    AND A.CRNT_VSL_CD = SUBSTR(@[in_vvd_cd],1,4)" ).append("\n"); 
		query.append("    AND (A.CRNT_SKD_VOY_NO >= SUBSTR(@[in_vvd_cd],5,4) AND A.CRNT_SKD_VOY_NO <= (SELECT SKD_VOY_NO FROM NEXT_VOY_NO))              " ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", JOO_CNTR_MVMT_EVNT_DT2 AS (" ).append("\n"); 
		query.append("    SELECT J.*" ).append("\n"); 
		query.append("    FROM CTM_MOVEMENT A, JOO_CNTR_MVMT_EVNT_DT J" ).append("\n"); 
		query.append("    WHERE 1=1" ).append("\n"); 
		query.append("    AND A.CRNT_VSL_CD = SUBSTR(@[in_vvd_cd],1,4)" ).append("\n"); 
		query.append("    AND (A.CRNT_SKD_VOY_NO >= SUBSTR(@[in_vvd_cd],5,4) AND A.CRNT_SKD_VOY_NO <= (SELECT SKD_VOY_NO FROM NEXT_VOY_NO))              " ).append("\n"); 
		query.append("    AND A.CNTR_NO = J.CNTR_NO" ).append("\n"); 
		query.append("    AND A.CNMV_YR = J.CNMV_YR" ).append("\n"); 
		query.append("    AND A.CNMV_ID_NO = J.CNMV_ID_NO" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", CTM_MOVEMENT3 AS (" ).append("\n"); 
		query.append("    SELECT *" ).append("\n"); 
		query.append("    FROM CTM_MOVEMENT A" ).append("\n"); 
		query.append("    WHERE 1=1" ).append("\n"); 
		query.append("    AND A.CRNT_VSL_CD       = (SELECT VSL_CD FROM PRE_VVD)" ).append("\n"); 
		query.append("    AND A.CRNT_SKD_VOY_NO   = (SELECT SKD_VOY_NO FROM PRE_VVD)" ).append("\n"); 
		query.append("    AND A.CRNT_SKD_DIR_CD   = (SELECT SKD_DIR_CD FROM PRE_VVD)" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", CTM_LIST AS (" ).append("\n"); 
		query.append("        SELECT" ).append("\n"); 
		query.append("		 SUBSTR(@[in_vvd_cd],1,4) 	 AS VSL_CD" ).append("\n"); 
		query.append("		,SUBSTR(@[in_vvd_cd],5,4)    AS	SKD_VOY_NO" ).append("\n"); 
		query.append("		,SUBSTR(@[in_vvd_cd],9,1)  	 AS SKD_DIR_CD    " ).append("\n"); 
		query.append("        ,AA.CNTR_NO" ).append("\n"); 
		query.append("        ,MAX(DECODE(AA.MVMT_STS_CD,'VL',AA.CNTR_TPSZ_CD,'')) AS CNTR_TPSZ_CD" ).append("\n"); 
		query.append("        ,MIN(DECODE(AA.MVMT_STS_CD,'VL',AA.CNMV_EVNT_DT,'')) AS CNMV_EVNT_DT_VL_MIN" ).append("\n"); 
		query.append("        ,NVL(MIN(DECODE(AA.MVMT_STS_CD,'VD',AA.CNMV_EVNT_DT,'')),TO_DATE('999912312359','YYYYMMDDHH24MISS')) AS CNMV_EVNT_DT_VD_MIN" ).append("\n"); 
		query.append("        ,MAX(DECODE(AA.MVMT_STS_CD,'VL',AA.CNMV_EVNT_DT,'')) AS CNMV_EVNT_DT_VL_MAX" ).append("\n"); 
		query.append("        ,NVL(MAX(DECODE(AA.MVMT_STS_CD,'VD',AA.CNMV_EVNT_DT,'')),TO_DATE('999912312359','YYYYMMDDHH24MISS')) AS CNMV_EVNT_DT_VD_MAX" ).append("\n"); 
		query.append("        ,MAX(DECODE(AA.MVMT_STS_CD,'VL',AA.BKG_NO,AA.BKG_NO)) AS BKG_NO" ).append("\n"); 
		query.append("        ,MAX(DECODE(AA.MVMT_STS_CD,'VL',AA.BL_NO,AA.BL_NO)) AS BL_NO         " ).append("\n"); 
		query.append("        ,MIN(DECODE(AA.MVMT_STS_CD,'VL',TO_CHAR(AA.CNMV_EVNT_DT,'YYYYMMDDHH24MISS') || AA.ORG_YD_CD,'')) AS POL2_MIN" ).append("\n"); 
		query.append("        ,MIN(DECODE(AA.MVMT_STS_CD,'VD',TO_CHAR(AA.CNMV_EVNT_DT,'YYYYMMDDHH24MISS') || AA.ORG_YD_CD,'')) AS POD2_MIN    " ).append("\n"); 
		query.append("        ,MAX(DECODE(AA.MVMT_STS_CD,'VL',TO_CHAR(AA.CNMV_EVNT_DT,'YYYYMMDDHH24MISS') || AA.ORG_YD_CD,'')) AS POL2_MAX" ).append("\n"); 
		query.append("        ,MAX(DECODE(AA.MVMT_STS_CD,'VD',TO_CHAR(AA.CNMV_EVNT_DT,'YYYYMMDDHH24MISS') || AA.ORG_YD_CD,'')) AS POD2_MAX    " ).append("\n"); 
		query.append("        ,MAX(AA.CNTR_WGT)       AS CNTR_WGT" ).append("\n"); 
		query.append("        ,MAX(AA.CNTR_VOL_QTY)   AS CNTR_VOL_QTY " ).append("\n"); 
		query.append("        ,MAX(AA.RCV_TERM_CD)  	AS RCV_TERM_CD " ).append("\n"); 
		query.append("        ,MAX(AA.DE_TERM_CD)   	AS DE_TERM_CD          " ).append("\n"); 
		query.append("        ,MAX(AA.DCGO_FLG)       AS DCGO_FLG" ).append("\n"); 
		query.append("        ,MAX(AA.RC_FLG)         AS RC_FLG" ).append("\n"); 
		query.append("        ,MAX(AA.AWK_CGO_FLG)    AS AWK_CGO_FLG" ).append("\n"); 
		query.append("        ,MAX(AA.RD_CGO_FLG)     AS RD_CGO_FLG         " ).append("\n"); 
		query.append("        ,MAX(AA.HNGR_FLG)       AS HNGR_FLG       " ).append("\n"); 
		query.append("        FROM" ).append("\n"); 
		query.append("        (" ).append("\n"); 
		query.append("            SELECT   A.CNTR_NO" ).append("\n"); 
		query.append("                    ,A.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                    ,A.MVMT_STS_CD" ).append("\n"); 
		query.append("                    ,A.CNMV_EVNT_DT" ).append("\n"); 
		query.append("                    ,A.CRNT_VSL_CD" ).append("\n"); 
		query.append("                    ,A.CRNT_SKD_VOY_NO" ).append("\n"); 
		query.append("                    ,A.CRNT_SKD_DIR_CD" ).append("\n"); 
		query.append("			        ,(SELECT BKG.BKG_NO FROM BKG_BOOKING BKG WHERE BKG.BKG_NO = A.BKG_NO AND NVL(BKG.BKG_STS_CD,' ') NOT IN ('X','A')) AS BKG_NO" ).append("\n"); 
		query.append("			        ,(SELECT BKG.BL_NO FROM BKG_BOOKING BKG WHERE BKG.BKG_NO = A.BKG_NO AND NVL(BKG.BKG_STS_CD,' ') NOT IN ('X','A')) AS BL_NO" ).append("\n"); 
		query.append("                    ,A.ORG_YD_CD" ).append("\n"); 
		query.append("                    ,CNTR.CNTR_WGT" ).append("\n"); 
		query.append("                    ,CNTR.CNTR_VOL_QTY     " ).append("\n"); 
		query.append("                    ,CNTR.RCV_TERM_CD" ).append("\n"); 
		query.append("                    ,CNTR.DE_TERM_CD                    " ).append("\n"); 
		query.append("                    ,CNTR.DCGO_FLG" ).append("\n"); 
		query.append("                    ,CNTR.RC_FLG" ).append("\n"); 
		query.append("                    ,CNTR.AWK_CGO_FLG" ).append("\n"); 
		query.append("                    ,CNTR.RD_CGO_FLG" ).append("\n"); 
		query.append("                    ,CNTR.HNGR_FLG  " ).append("\n"); 
		query.append("            FROM " ).append("\n"); 
		query.append("                (" ).append("\n"); 
		query.append("                    SELECT " ).append("\n"); 
		query.append("                         A.CNTR_NO" ).append("\n"); 
		query.append("                        ,A.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                        ,A.MVMT_STS_CD" ).append("\n"); 
		query.append("                        ,DECODE(J.CNMV_DT,NULL,A.CNMV_EVNT_DT,J.CNMV_DT) CNMV_EVNT_DT" ).append("\n"); 
		query.append("                        ,A.CRNT_VSL_CD" ).append("\n"); 
		query.append("                        ,A.CRNT_SKD_VOY_NO" ).append("\n"); 
		query.append("                        ,A.CRNT_SKD_DIR_CD" ).append("\n"); 
		query.append("                        ,CASE WHEN A.LST_BKG_NO IS NULL THEN A.BKG_NO" ).append("\n"); 
		query.append("                            WHEN SUBSTR(A.LST_BKG_NO, 1, 9) != SUBSTR(A.BKG_NO, 1, 9) THEN A.BKG_NO" ).append("\n"); 
		query.append("                         ELSE A.LST_BKG_NO" ).append("\n"); 
		query.append("                         END AS BKG_NO" ).append("\n"); 
		query.append("                        ,A.ORG_YD_CD" ).append("\n"); 
		query.append("                    FROM CTM_MOVEMENT2 A, JOO_CNTR_MVMT_EVNT_DT2 J" ).append("\n"); 
		query.append("                    WHERE 1=1" ).append("\n"); 
		query.append("                    AND A.CNTR_NO = J.CNTR_NO(+)" ).append("\n"); 
		query.append("                    AND A.CNMV_YR = J.CNMV_YR(+)" ).append("\n"); 
		query.append("                    AND A.CNMV_ID_NO = J.CNMV_ID_NO(+)                " ).append("\n"); 
		query.append("                ) A" ).append("\n"); 
		query.append("               , BKG_CONTAINER CNTR" ).append("\n"); 
		query.append("            WHERE 1=1 " ).append("\n"); 
		query.append("	#if (${in_dcgo_flg} == '' && ${in_rc_flg} == '' && ${in_awk_cgo_flg} == '' && ${in_bb_cgo_flg} == '' && ${in_stwg_cd} == '' && ${in_hot_de_flg} == '' && ${in_rd_cgo_flg} == '' && ${in_soc_flg} == '' && ${in_prct_flg} == '' && ${in_hngr_flg} == '')" ).append("\n"); 
		query.append("		AND '1' = '1'" ).append("\n"); 
		query.append("	#else" ).append("\n"); 
		query.append("		AND ( '1' = '2' " ).append("\n"); 
		query.append("		#if (${in_dcgo_flg} != '' ) " ).append("\n"); 
		query.append("			OR CNTR.DCGO_FLG = @[in_dcgo_flg]" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		#if (${in_rc_flg} != '' ) " ).append("\n"); 
		query.append("			OR CNTR.RC_FLG = @[in_rc_flg]" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		#if (${in_awk_cgo_flg} != '' ) " ).append("\n"); 
		query.append("			OR CNTR.AWK_CGO_FLG = @[in_awk_cgo_flg]" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		#if (${in_bb_cgo_flg} != '' ) " ).append("\n"); 
		query.append("			OR CNTR.BB_CGO_FLG = @[in_bb_cgo_flg]" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		#if (${in_stwg_cd} != '' ) " ).append("\n"); 
		query.append("			OR BKG.STWG_CD IS NOT NULL" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		#if (${in_hot_de_flg} != '' ) " ).append("\n"); 
		query.append("			OR BKG.HOT_DE_FLG = @[in_hot_de_flg]" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		#if (${in_rd_cgo_flg} != '' ) " ).append("\n"); 
		query.append("			OR CNTR.RD_CGO_FLG = @[in_rd_cgo_flg]" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		#if (${in_soc_flg} != '' ) " ).append("\n"); 
		query.append("			OR CNTR.SOC_FLG = @[in_soc_flg]" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		#if (${in_prct_flg} != '' ) " ).append("\n"); 
		query.append("			OR BKG.PRCT_FLG = @[in_prct_flg]" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		#if (${in_hngr_flg} != '' ) " ).append("\n"); 
		query.append("			OR CNTR.HNGR_FLG = @[in_hngr_flg]" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		)" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("            AND A.BKG_NO = CNTR.BKG_NO(+)" ).append("\n"); 
		query.append("            AND A.CNTR_NO = CNTR.CNTR_NO(+)  " ).append("\n"); 
		query.append("            UNION" ).append("\n"); 
		query.append("            SELECT   A.CNTR_NO" ).append("\n"); 
		query.append("                    ,A.CNTR_TPSZ_CD            " ).append("\n"); 
		query.append("                    ,A.MVMT_STS_CD" ).append("\n"); 
		query.append("                    ,A.CNMV_EVNT_DT" ).append("\n"); 
		query.append("                    ,A.CRNT_VSL_CD" ).append("\n"); 
		query.append("                    ,A.CRNT_SKD_VOY_NO" ).append("\n"); 
		query.append("                    ,A.CRNT_SKD_DIR_CD" ).append("\n"); 
		query.append("			        ,(SELECT BKG.BKG_NO FROM BKG_BOOKING BKG WHERE BKG.BKG_NO = A.BKG_NO AND NVL(BKG.BKG_STS_CD,' ') NOT IN ('X','A')) AS BKG_NO" ).append("\n"); 
		query.append("			        ,(SELECT BKG.BL_NO FROM BKG_BOOKING BKG WHERE BKG.BKG_NO = A.BKG_NO AND NVL(BKG.BKG_STS_CD,' ') NOT IN ('X','A')) AS BL_NO" ).append("\n"); 
		query.append("                    ,A.ORG_YD_CD" ).append("\n"); 
		query.append("                    ,CNTR.CNTR_WGT" ).append("\n"); 
		query.append("                    ,CNTR.CNTR_VOL_QTY     " ).append("\n"); 
		query.append("                    ,CNTR.RCV_TERM_CD" ).append("\n"); 
		query.append("                    ,CNTR.DE_TERM_CD                    " ).append("\n"); 
		query.append("                    ,CNTR.DCGO_FLG" ).append("\n"); 
		query.append("                    ,CNTR.RC_FLG" ).append("\n"); 
		query.append("                    ,CNTR.AWK_CGO_FLG" ).append("\n"); 
		query.append("                    ,CNTR.RD_CGO_FLG" ).append("\n"); 
		query.append("                    ,CNTR.HNGR_FLG  " ).append("\n"); 
		query.append("            FROM " ).append("\n"); 
		query.append("                (" ).append("\n"); 
		query.append("                    SELECT " ).append("\n"); 
		query.append("                         A.CNTR_NO" ).append("\n"); 
		query.append("                        ,A.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                        ,A.MVMT_STS_CD" ).append("\n"); 
		query.append("                        ,DECODE(J.CNMV_DT,NULL,A.CNMV_EVNT_DT,J.CNMV_DT) CNMV_EVNT_DT" ).append("\n"); 
		query.append("                        ,A.CRNT_VSL_CD" ).append("\n"); 
		query.append("                        ,A.CRNT_SKD_VOY_NO" ).append("\n"); 
		query.append("                        ,A.CRNT_SKD_DIR_CD" ).append("\n"); 
		query.append("                        ,CASE WHEN A.LST_BKG_NO IS NULL THEN A.BKG_NO" ).append("\n"); 
		query.append("                            WHEN SUBSTR(A.LST_BKG_NO, 1, 9) != SUBSTR(A.BKG_NO, 1, 9) THEN A.BKG_NO" ).append("\n"); 
		query.append("                         ELSE A.LST_BKG_NO" ).append("\n"); 
		query.append("                         END AS BKG_NO" ).append("\n"); 
		query.append("                        ,A.ORG_YD_CD" ).append("\n"); 
		query.append("                    FROM CTM_MOVEMENT3 A, JOO_CNTR_MVMT_EVNT_DT2 J" ).append("\n"); 
		query.append("                    WHERE 1=1" ).append("\n"); 
		query.append("                    AND A.CNTR_NO    = J.CNTR_NO(+)" ).append("\n"); 
		query.append("                    AND A.CNMV_YR    = J.CNMV_YR(+)" ).append("\n"); 
		query.append("                    AND A.CNMV_ID_NO = J.CNMV_ID_NO(+)                " ).append("\n"); 
		query.append("                ) A            " ).append("\n"); 
		query.append("                , BKG_CONTAINER CNTR" ).append("\n"); 
		query.append("            WHERE 1=1" ).append("\n"); 
		query.append("	#if (${in_dcgo_flg} == '' && ${in_rc_flg} == '' && ${in_awk_cgo_flg} == '' && ${in_bb_cgo_flg} == '' && ${in_stwg_cd} == '' && ${in_hot_de_flg} == '' && ${in_rd_cgo_flg} == '' && ${in_soc_flg} == '' && ${in_prct_flg} == '' && ${in_hngr_flg} == '')" ).append("\n"); 
		query.append("		AND '1' = '1'" ).append("\n"); 
		query.append("	#else" ).append("\n"); 
		query.append("		AND ( '1' = '2' " ).append("\n"); 
		query.append("		#if (${in_dcgo_flg} != '' ) " ).append("\n"); 
		query.append("			OR CNTR.DCGO_FLG = @[in_dcgo_flg]" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		#if (${in_rc_flg} != '' ) " ).append("\n"); 
		query.append("			OR CNTR.RC_FLG = @[in_rc_flg]" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		#if (${in_awk_cgo_flg} != '' ) " ).append("\n"); 
		query.append("			OR CNTR.AWK_CGO_FLG = @[in_awk_cgo_flg]" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		#if (${in_bb_cgo_flg} != '' ) " ).append("\n"); 
		query.append("			OR CNTR.BB_CGO_FLG = @[in_bb_cgo_flg]" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		#if (${in_stwg_cd} != '' ) " ).append("\n"); 
		query.append("			OR BKG.STWG_CD IS NOT NULL" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		#if (${in_hot_de_flg} != '' ) " ).append("\n"); 
		query.append("			OR BKG.HOT_DE_FLG = @[in_hot_de_flg]" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		#if (${in_rd_cgo_flg} != '' ) " ).append("\n"); 
		query.append("			OR CNTR.RD_CGO_FLG = @[in_rd_cgo_flg]" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		#if (${in_soc_flg} != '' ) " ).append("\n"); 
		query.append("			OR CNTR.SOC_FLG = @[in_soc_flg]" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		#if (${in_prct_flg} != '' ) " ).append("\n"); 
		query.append("			OR BKG.PRCT_FLG = @[in_prct_flg]" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		#if (${in_hngr_flg} != '' ) " ).append("\n"); 
		query.append("			OR CNTR.HNGR_FLG = @[in_hngr_flg]" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		)" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("            AND A.BKG_NO = CNTR.BKG_NO(+)" ).append("\n"); 
		query.append("            AND A.CNTR_NO = CNTR.CNTR_NO(+)    " ).append("\n"); 
		query.append("        ) AA    " ).append("\n"); 
		query.append("        GROUP BY AA.CNTR_NO" ).append("\n"); 
		query.append(")      " ).append("\n"); 
		query.append(",VPS_ETD AS (" ).append("\n"); 
		query.append("	SELECT T1.VPS_ETD_DT" ).append("\n"); 
		query.append("	FROM VSK_VSL_PORT_SKD T1" ).append("\n"); 
		query.append("	WHERE 1=1" ).append("\n"); 
		query.append("	AND T1.VSL_CD     = SUBSTR(@[in_vvd_cd],1,4)" ).append("\n"); 
		query.append("	AND T1.SKD_VOY_NO = SUBSTR(@[in_vvd_cd],5,4)" ).append("\n"); 
		query.append("	AND T1.SKD_DIR_CD = SUBSTR(@[in_vvd_cd],9,1)  " ).append("\n"); 
		query.append("	AND T1.VPS_PORT_CD = @[in_pol_cd]" ).append("\n"); 
		query.append("	AND T1.CLPT_IND_SEQ = @[pol_split_no]" ).append("\n"); 
		query.append("	AND T1.YD_CD = @[in_pol_cd] || @[in_pol_yd_cd]" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(",CTM_LIST1 AS (" ).append("\n"); 
		query.append("    SELECT " ).append("\n"); 
		query.append("     C.VSL_CD" ).append("\n"); 
		query.append("    ,C.SKD_VOY_NO" ).append("\n"); 
		query.append("    ,C.SKD_DIR_CD" ).append("\n"); 
		query.append("    ,C.CNTR_NO" ).append("\n"); 
		query.append("    ,C.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("    ,C.BKG_NO" ).append("\n"); 
		query.append("    ,C.BL_NO" ).append("\n"); 
		query.append("    ,CASE WHEN (SELECT VPS_ETD_DT FROM VPS_ETD) > CNMV_EVNT_DT_VL_MIN AND (SELECT VPS_ETD_DT FROM VPS_ETD) < CNMV_EVNT_DT_VD_MIN THEN POL2_MIN" ).append("\n"); 
		query.append("          WHEN (SELECT VPS_ETD_DT FROM VPS_ETD) > CNMV_EVNT_DT_VL_MAX AND (SELECT VPS_ETD_DT FROM VPS_ETD) < CNMV_EVNT_DT_VD_MAX THEN POL2_MAX" ).append("\n"); 
		query.append("          ELSE POL2_MIN" ).append("\n"); 
		query.append("          END POL2" ).append("\n"); 
		query.append("    ,CASE WHEN (SELECT VPS_ETD_DT FROM VPS_ETD) > CNMV_EVNT_DT_VL_MIN AND (SELECT VPS_ETD_DT FROM VPS_ETD) < CNMV_EVNT_DT_VD_MIN THEN POD2_MIN" ).append("\n"); 
		query.append("          WHEN (SELECT VPS_ETD_DT FROM VPS_ETD) > CNMV_EVNT_DT_VL_MAX AND (SELECT VPS_ETD_DT FROM VPS_ETD) < CNMV_EVNT_DT_VD_MAX THEN POD2_MAX" ).append("\n"); 
		query.append("          ELSE POD2_MIN" ).append("\n"); 
		query.append("          END POD2  " ).append("\n"); 
		query.append("    ,C.CNTR_WGT" ).append("\n"); 
		query.append("    ,C.CNTR_VOL_QTY     " ).append("\n"); 
		query.append("    ,C.RCV_TERM_CD" ).append("\n"); 
		query.append("    ,C.DE_TERM_CD                    " ).append("\n"); 
		query.append("    ,C.DCGO_FLG" ).append("\n"); 
		query.append("    ,C.RC_FLG" ).append("\n"); 
		query.append("    ,C.AWK_CGO_FLG" ).append("\n"); 
		query.append("    ,C.RD_CGO_FLG" ).append("\n"); 
		query.append("    ,C.HNGR_FLG " ).append("\n"); 
		query.append("    ,CASE WHEN (SELECT VPS_ETD_DT FROM VPS_ETD) > CNMV_EVNT_DT_VL_MIN AND (SELECT VPS_ETD_DT FROM VPS_ETD) < CNMV_EVNT_DT_VD_MIN THEN CNMV_EVNT_DT_VL_MIN" ).append("\n"); 
		query.append("          WHEN (SELECT VPS_ETD_DT FROM VPS_ETD) > CNMV_EVNT_DT_VL_MAX AND (SELECT VPS_ETD_DT FROM VPS_ETD) < CNMV_EVNT_DT_VD_MAX THEN CNMV_EVNT_DT_VL_MAX" ).append("\n"); 
		query.append("          ELSE CNMV_EVNT_DT_VL_MIN" ).append("\n"); 
		query.append("          END CNMV_EVNT_DT_VL" ).append("\n"); 
		query.append("    ,CASE WHEN (SELECT VPS_ETD_DT FROM VPS_ETD) > CNMV_EVNT_DT_VL_MIN AND (SELECT VPS_ETD_DT FROM VPS_ETD) < CNMV_EVNT_DT_VD_MIN THEN CNMV_EVNT_DT_VD_MIN" ).append("\n"); 
		query.append("          WHEN (SELECT VPS_ETD_DT FROM VPS_ETD) > CNMV_EVNT_DT_VL_MAX AND (SELECT VPS_ETD_DT FROM VPS_ETD) < CNMV_EVNT_DT_VD_MAX THEN CNMV_EVNT_DT_VD_MAX" ).append("\n"); 
		query.append("          ELSE CNMV_EVNT_DT_VL_MIN" ).append("\n"); 
		query.append("          END CNMV_EVNT_DT_VD     " ).append("\n"); 
		query.append("    FROM CTM_LIST C" ).append("\n"); 
		query.append(") " ).append("\n"); 
		query.append(", CTM_LIST2 AS (" ).append("\n"); 
		query.append("    SELECT  C.*" ).append("\n"); 
		query.append("			,SUBSTR(C.POL2,15,7) AS POL" ).append("\n"); 
		query.append("			,SUBSTR(C.POD2,15,7) AS POD" ).append("\n"); 
		query.append("    FROM CTM_LIST1 C" ).append("\n"); 
		query.append("    WHERE 1=1" ).append("\n"); 
		query.append("    AND TO_NUMBER(TO_CHAR(C.CNMV_EVNT_DT_VL,'YYYYMMDDHH24MISS')) <= TO_NUMBER((SELECT TO_CHAR(VPS_ETD_DT,'YYYYMMDDHH24MISS') FROM VPS_ETD))  " ).append("\n"); 
		query.append("    AND TO_NUMBER(TO_CHAR(C.CNMV_EVNT_DT_VD,'YYYYMMDDHH24MISS')) >= TO_NUMBER((SELECT TO_CHAR(VPS_ETD_DT,'YYYYMMDDHH24MISS') FROM VPS_ETD))   " ).append("\n"); 
		query.append(") " ).append("\n"); 
		query.append(", CTM_LIST3 AS (" ).append("\n"); 
		query.append("SELECT " ).append("\n"); 
		query.append("  C.VSL_CD" ).append("\n"); 
		query.append(" ,C.SKD_VOY_NO" ).append("\n"); 
		query.append(" ,C.SKD_DIR_CD" ).append("\n"); 
		query.append(" ,C.CNTR_NO" ).append("\n"); 
		query.append(" ,C.CNTR_TPSZ_CD" ).append("\n"); 
		query.append(" ,C.CNMV_EVNT_DT_VL" ).append("\n"); 
		query.append(" ,C.CNMV_EVNT_DT_VD" ).append("\n"); 
		query.append(" ,C.BKG_NO" ).append("\n"); 
		query.append(" ,C.BL_NO" ).append("\n"); 
		query.append(" ,C.POL" ).append("\n"); 
		query.append(" ,C.POD" ).append("\n"); 
		query.append(" ,C.CNTR_WGT" ).append("\n"); 
		query.append(" ,C.CNTR_VOL_QTY" ).append("\n"); 
		query.append(" ,C.RCV_TERM_CD" ).append("\n"); 
		query.append(" ,C.DE_TERM_CD" ).append("\n"); 
		query.append(" ,C.DCGO_FLG" ).append("\n"); 
		query.append(" ,C.RC_FLG" ).append("\n"); 
		query.append(" ,C.AWK_CGO_FLG" ).append("\n"); 
		query.append(" ,C.RD_CGO_FLG" ).append("\n"); 
		query.append(" ,C.HNGR_FLG" ).append("\n"); 
		query.append("    ,MAX(CASE WHEN TO_NUMBER(TO_CHAR(C.CNMV_EVNT_DT_VL,'YYYYMMDDHH24MISS')) >= TO_NUMBER(TO_CHAR(V.VPS_ETA_DT,'YYYYMMDDHH24MISS')) AND " ).append("\n"); 
		query.append("                   TO_NUMBER(TO_CHAR(C.CNMV_EVNT_DT_VL,'YYYYMMDDHH24MISS')) <= TO_NUMBER(TO_CHAR(V.VPS_ETD_DT,'YYYYMMDDHH24MISS')) " ).append("\n"); 
		query.append("      THEN V.CLPT_IND_SEQ" ).append("\n"); 
		query.append("      ELSE '0'" ).append("\n"); 
		query.append("      END) AS POL_CLPT_IND_SEQ " ).append("\n"); 
		query.append("FROM CTM_LIST2 C, VSK_VSL_PORT_SKD V" ).append("\n"); 
		query.append("WHERE 1=1" ).append("\n"); 
		query.append("AND C.VSL_CD = V.VSL_CD(+)" ).append("\n"); 
		query.append("AND C.SKD_VOY_NO = V.SKD_VOY_NO(+)" ).append("\n"); 
		query.append("AND C.SKD_DIR_CD = V.SKD_DIR_CD(+) " ).append("\n"); 
		query.append("AND C.POL = V.YD_CD(+)" ).append("\n"); 
		query.append("GROUP BY" ).append("\n"); 
		query.append("  C.VSL_CD" ).append("\n"); 
		query.append(" ,C.SKD_VOY_NO" ).append("\n"); 
		query.append(" ,C.SKD_DIR_CD" ).append("\n"); 
		query.append(" ,C.CNTR_NO" ).append("\n"); 
		query.append(" ,C.CNTR_TPSZ_CD" ).append("\n"); 
		query.append(" ,C.CNMV_EVNT_DT_VL" ).append("\n"); 
		query.append(" ,C.CNMV_EVNT_DT_VD" ).append("\n"); 
		query.append(" ,C.BKG_NO" ).append("\n"); 
		query.append(" ,C.BL_NO" ).append("\n"); 
		query.append(" ,C.POL" ).append("\n"); 
		query.append(" ,C.POD" ).append("\n"); 
		query.append(" ,C.CNTR_WGT" ).append("\n"); 
		query.append(" ,C.CNTR_VOL_QTY" ).append("\n"); 
		query.append(" ,C.RCV_TERM_CD" ).append("\n"); 
		query.append(" ,C.DE_TERM_CD" ).append("\n"); 
		query.append(" ,C.DCGO_FLG" ).append("\n"); 
		query.append(" ,C.RC_FLG" ).append("\n"); 
		query.append(" ,C.AWK_CGO_FLG" ).append("\n"); 
		query.append(" ,C.RD_CGO_FLG" ).append("\n"); 
		query.append(" ,C.HNGR_FLG" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", ROB_LIST AS (" ).append("\n"); 
		query.append("	SELECT	" ).append("\n"); 
		query.append("		CNTR_NO, " ).append("\n"); 
		query.append("		CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("		CNTR_WGT, " ).append("\n"); 
		query.append("		TO_CHAR(A_CNTR_WGT,'9,999,990.000') A_CNTR_WGT," ).append("\n"); 
		query.append("		ROUND((round(nvl(ACT_WGT, 0) * decode(substr(CNTR_TPSZ_CD, 2, 1), '2', 1, 2) / TOT, 2) + " ).append("\n"); 
		query.append("        NVL(CNTR_VOL_QTY, 1) * DECODE(NVL(MST_TARE,0), 0, DECODE(NVL(MDM_TARE,0), 0, 0, MDM_TARE), MST_TARE))/1000, 2) E_CNTR_WGT," ).append("\n"); 
		query.append("		POL_CD," ).append("\n"); 
		query.append("		POL_YD_CD," ).append("\n"); 
		query.append("		POD_CD," ).append("\n"); 
		query.append("		POD_YD_CD,        " ).append("\n"); 
		query.append("		A_POL_CD, " ).append("\n"); 
		query.append("		POL_NOD_CD," ).append("\n"); 
		query.append("		A_POD_CD,    " ).append("\n"); 
		query.append("		POD_NOD_CD,    " ).append("\n"); 
		query.append("		RCV_TERM_CD," ).append("\n"); 
		query.append("		DE_TERM_CD," ).append("\n"); 
		query.append("		TS_CD,	" ).append("\n"); 
		query.append("		BKG_CGO_TP_CD," ).append("\n"); 
		query.append("		HOT_DE_FLG," ).append("\n"); 
		query.append("		'' SPCL_CGO_DESC_TYPE," ).append("\n"); 
		query.append("		'' SPCL_CGO_DESC" ).append("\n"); 
		query.append("		,SLAN_CD" ).append("\n"); 
		query.append("		,DCGO_FLG" ).append("\n"); 
		query.append("		,RC_FLG" ).append("\n"); 
		query.append("		,AWK_CGO_FLG" ).append("\n"); 
		query.append("		,PRCT_FLG" ).append("\n"); 
		query.append("		,RD_CGO_FLG" ).append("\n"); 
		query.append("		,HNGR_FLG    " ).append("\n"); 
		query.append("		,VVD_CD" ).append("\n"); 
		query.append("		,BKG_NO" ).append("\n"); 
		query.append("		,POL_YD_CD2" ).append("\n"); 
		query.append("        ,POD_YD_CD2 " ).append("\n"); 
		query.append("        ,POL_CLPT_IND_SEQ         " ).append("\n"); 
		query.append("   	    ,POD_CLPT_IND_SEQ    " ).append("\n"); 
		query.append("	FROM (" ).append("\n"); 
		query.append("            SELECT      " ).append("\n"); 
		query.append("                 CTM.CNTR_NO" ).append("\n"); 
		query.append("                ,CTM.CNTR_TPSZ_CD            " ).append("\n"); 
		query.append("                ,CTM.CNTR_WGT  A_CNTR_WGT" ).append("\n"); 
		query.append("                ,ROUND(CTM.CNTR_WGT/1000,0) CNTR_WGT" ).append("\n"); 
		query.append("                ,DOC.ACT_WGT" ).append("\n"); 
		query.append("                ,(" ).append("\n"); 
		query.append("                    SELECT SUM(DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),'2',1,2)) TOT " ).append("\n"); 
		query.append("                    FROM BKG_CONTAINER BC" ).append("\n"); 
		query.append("                    WHERE BC.BKG_NO = BKG.BKG_NO" ).append("\n"); 
		query.append("                ) TOT" ).append("\n"); 
		query.append("                ,DECODE(NVL(CTM.CNTR_VOL_QTY, 0), 0, 1, CTM.CNTR_VOL_QTY) CNTR_VOL_QTY   " ).append("\n"); 
		query.append("                ,(SELECT NVL(SPEC.TARE_WGT, 0) MST_WGT" ).append("\n"); 
		query.append("			      FROM MST_CONTAINER MST," ).append("\n"); 
		query.append("				       MST_CNTR_SPEC SPEC" ).append("\n"); 
		query.append("			      WHERE MST.CNTR_NO = CTM.CNTR_NO" ).append("\n"); 
		query.append("			      AND MST.CNTR_SPEC_NO = SPEC.CNTR_SPEC_NO ) MST_TARE" ).append("\n"); 
		query.append("		        ,(SELECT NVL(MDM.CNTR_TPSZ_TARE_WGT, 0) MDM_WGT" ).append("\n"); 
		query.append("                  FROM MDM_CNTR_TP_SZ MDM         " ).append("\n"); 
		query.append("                  WHERE MDM.CNTR_TPSZ_CD = CTM.CNTR_TPSZ_CD  " ).append("\n"); 
		query.append("			    ) MDM_TARE            " ).append("\n"); 
		query.append("                ,SUBSTR(CTM.POL,1,5) AS POL_CD" ).append("\n"); 
		query.append("                ,SUBSTR(CTM.POL,6,2) AS POL_YD_CD" ).append("\n"); 
		query.append("                ,SUBSTR(CTM.POD,1,5) AS POD_CD" ).append("\n"); 
		query.append("                ,SUBSTR(CTM.POD,6,2) AS POD_YD_CD                        " ).append("\n"); 
		query.append("                ,'' AS A_POL_CD     /* BKG */      " ).append("\n"); 
		query.append("                ,'' AS POL_NOD_CD   /* BKG */      " ).append("\n"); 
		query.append("                ,'' AS A_POD_CD     /* BKG */      " ).append("\n"); 
		query.append("                ,'' AS POD_NOD_CD   /* BKG */          " ).append("\n"); 
		query.append("                ,CTM.RCV_TERM_CD        " ).append("\n"); 
		query.append("                ,CTM.DE_TERM_CD        " ).append("\n"); 
		query.append("                ,DECODE(BKG.POL_CD,SUBSTR(CTM.POL,1,5),'L','T') TS_CD " ).append("\n"); 
		query.append("                ,BKG.BKG_CGO_TP_CD" ).append("\n"); 
		query.append("                ,BKG.HOT_DE_FLG        " ).append("\n"); 
		query.append("				,(	SELECT SLAN_CD FROM BKG_VVD B" ).append("\n"); 
		query.append("					WHERE 1=1" ).append("\n"); 
		query.append("					AND B.VSL_CD = CTM.VSL_CD" ).append("\n"); 
		query.append("					AND B.SKD_VOY_NO = CTM.SKD_VOY_NO" ).append("\n"); 
		query.append("					AND B.SKD_DIR_CD = CTM.SKD_DIR_CD" ).append("\n"); 
		query.append("					AND ROWNUM = 1						" ).append("\n"); 
		query.append("				  ) AS SLAN_CD" ).append("\n"); 
		query.append("                ,CTM.DCGO_FLG" ).append("\n"); 
		query.append("                ,CTM.RC_FLG" ).append("\n"); 
		query.append("                ,CTM.AWK_CGO_FLG" ).append("\n"); 
		query.append("                ,BKG.PRCT_FLG   " ).append("\n"); 
		query.append("                ,CTM.RD_CGO_FLG RD_CGO_FLG         " ).append("\n"); 
		query.append("                ,CTM.HNGR_FLG" ).append("\n"); 
		query.append("                ,'' AS VVD_CD                 " ).append("\n"); 
		query.append("                ,CTM.BKG_NO" ).append("\n"); 
		query.append("                ,CTM.POL AS POL_YD_CD2  " ).append("\n"); 
		query.append("                ,CTM.POD AS POD_YD_CD2" ).append("\n"); 
		query.append("                ,CTM.BL_NO" ).append("\n"); 
		query.append("                ,'' AS VSL_SEQ " ).append("\n"); 
		query.append("                ,CTM.POL_CLPT_IND_SEQ " ).append("\n"); 
		query.append("                ,'' AS POD_CLPT_IND_SEQ  " ).append("\n"); 
		query.append("                ,CTM.CNMV_EVNT_DT_VL" ).append("\n"); 
		query.append("                ,CTM.CNMV_EVNT_DT_VD" ).append("\n"); 
		query.append("            FROM     CTM_LIST3 CTM" ).append("\n"); 
		query.append("                    ,BKG_BOOKING BKG" ).append("\n"); 
		query.append("                    ,BKG_BL_DOC DOC" ).append("\n"); 
		query.append("                    ,MDM_LOCATION MDM        " ).append("\n"); 
		query.append("            WHERE 1=1" ).append("\n"); 
		query.append("            AND CTM.BKG_NO = BKG.BKG_NO" ).append("\n"); 
		query.append("            AND BKG.BKG_STS_CD  <> 'S'	    " ).append("\n"); 
		query.append("            AND CTM.BKG_NO = DOC.BKG_NO	" ).append("\n"); 
		query.append("            AND NVL(BKG.BKG_STS_CD,' ') NOT IN ('X','A')	" ).append("\n"); 
		query.append("            AND MDM.LOC_CD = BKG.DEL_CD    " ).append("\n"); 
		query.append("	) TB1" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", ROB_LIST2 AS (" ).append("\n"); 
		query.append("SELECT " ).append("\n"); 
		query.append("     CNTR_NO" ).append("\n"); 
		query.append("    ,SUM(E_CNTR_WGT)    AS E_CNTR_WGT		/* E.WGT(T) SUM */" ).append("\n"); 
		query.append("    ,MAX(CNTR_TPSZ_CD)  AS CNTR_TPSZ_CD" ).append("\n"); 
		query.append("    ,MAX(BKG_CGO_TP_CD) AS BKG_CGO_TP_CD" ).append("\n"); 
		query.append("    ,MAX(AWK_CGO_FLG)   AS AWK_CGO_FLG    " ).append("\n"); 
		query.append("    ,MAX(POL_CD)	    AS POL_CD" ).append("\n"); 
		query.append("    ,MAX(POL_YD_CD)	    AS POL_YD_CD  " ).append("\n"); 
		query.append("    ,MAX(POL_CLPT_IND_SEQ)	    AS POL_CLPT_IND_SEQ  " ).append("\n"); 
		query.append("    ,MAX(RC_FLG)        AS RC_FLG" ).append("\n"); 
		query.append("    ,MAX(DCGO_FLG)      AS DCGO_FLG" ).append("\n"); 
		query.append("    ,MAX(SLAN_CD)       AS SLAN_CD" ).append("\n"); 
		query.append("FROM ROB_LIST R" ).append("\n"); 
		query.append("GROUP BY CNTR_NO" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", NEXT_VVD AS (" ).append("\n"); 
		query.append("SELECT" ).append("\n"); 
		query.append("     AA.VSL_CD" ).append("\n"); 
		query.append("    ,AA.SKD_VOY_NO" ).append("\n"); 
		query.append("    ,AA.SKD_DIR_CD" ).append("\n"); 
		query.append("    FROM" ).append("\n"); 
		query.append("    (" ).append("\n"); 
		query.append("            SELECT       " ).append("\n"); 
		query.append("            A.*" ).append("\n"); 
		query.append("            FROM" ).append("\n"); 
		query.append("            (" ).append("\n"); 
		query.append("                SELECT" ).append("\n"); 
		query.append("                VSL_CD, SKD_VOY_NO, SKD_DIR_CD, MAX(VPS_ETD_DT) AS VPS_ETD_DT" ).append("\n"); 
		query.append("                FROM VSK_VSL_PORT_SKD" ).append("\n"); 
		query.append("                WHERE VSL_CD = SUBSTR(@[in_vvd_cd],1,4)" ).append("\n"); 
		query.append("                AND SKD_VOY_NO >= SUBSTR(@[in_vvd_cd],5,4)" ).append("\n"); 
		query.append("                AND TURN_PORT_IND_CD IN ('Y','N')" ).append("\n"); 
		query.append("                GROUP BY VSL_CD, SKD_VOY_NO, SKD_DIR_CD" ).append("\n"); 
		query.append("            ) A " ).append("\n"); 
		query.append("            WHERE 1=1" ).append("\n"); 
		query.append("            AND VPS_ETD_DT >  ( SELECT MAX(VPS_ETD_DT) " ).append("\n"); 
		query.append("                                  FROM VSK_VSL_PORT_SKD" ).append("\n"); 
		query.append("                                  WHERE VSL_CD = SUBSTR(@[in_vvd_cd],1,4)" ).append("\n"); 
		query.append("                                  AND SKD_VOY_NO = SUBSTR(@[in_vvd_cd],5,4)" ).append("\n"); 
		query.append("                                  AND SKD_DIR_CD = SUBSTR(@[in_vvd_cd],9,1)" ).append("\n"); 
		query.append("                              )                " ).append("\n"); 
		query.append("            ORDER BY VPS_ETD_DT ASC" ).append("\n"); 
		query.append("    ) AA" ).append("\n"); 
		query.append("    WHERE ROWNUM =1    " ).append("\n"); 
		query.append("), CTM AS (" ).append("\n"); 
		query.append("    SELECT *" ).append("\n"); 
		query.append("    FROM CTM_MOVEMENT A  " ).append("\n"); 
		query.append("    WHERE 1=1" ).append("\n"); 
		query.append("    AND A.MVMT_STS_CD IN ('VL','VD')" ).append("\n"); 
		query.append("    AND (" ).append("\n"); 
		query.append("            (  A.CRNT_VSL_CD = (SELECT VSL_CD FROM PRE_VVD) AND A.CRNT_SKD_VOY_NO = (SELECT SKD_VOY_NO FROM PRE_VVD) AND A.CRNT_SKD_DIR_CD = (SELECT SKD_DIR_CD FROM PRE_VVD) )" ).append("\n"); 
		query.append("            OR" ).append("\n"); 
		query.append("            (  A.CRNT_VSL_CD = SUBSTR(@[in_vvd_cd],1,4) AND A.CRNT_SKD_VOY_NO = SUBSTR(@[in_vvd_cd],5,4) AND A.CRNT_SKD_DIR_CD = SUBSTR(@[in_vvd_cd],9,1) )        " ).append("\n"); 
		query.append("            OR        " ).append("\n"); 
		query.append("            (  A.CRNT_VSL_CD = (SELECT VSL_CD FROM NEXT_VVD) AND A.CRNT_SKD_VOY_NO = (SELECT SKD_VOY_NO FROM NEXT_VVD) AND A.CRNT_SKD_DIR_CD = (SELECT SKD_DIR_CD FROM NEXT_VVD) )" ).append("\n"); 
		query.append("        )  " ).append("\n"); 
		query.append("), MVMT_DT AS (" ).append("\n"); 
		query.append("    SELECT" ).append("\n"); 
		query.append("     AA.CNTR_NO, CNMV_YR, CNMV_ID_NO, MVMT_STS_CD, CNMV_EVNT_DT, ORG_YD_CD, CRNT_VSL_CD, CRNT_SKD_VOY_NO, CRNT_SKD_DIR_CD     " ).append("\n"); 
		query.append("    ,MAX(CLPT_IND_SEQ2) AS CLPT_IND_SEQ2" ).append("\n"); 
		query.append("    ,MAX(CLPT_IND_SEQ3) AS CLPT_IND_SEQ3" ).append("\n"); 
		query.append("    ,MAX(CNMV_DT) AS CNMV_DT" ).append("\n"); 
		query.append("    FROM" ).append("\n"); 
		query.append("    (" ).append("\n"); 
		query.append("        SELECT " ).append("\n"); 
		query.append("             A.CNTR_NO" ).append("\n"); 
		query.append("            ,A.CNMV_YR" ).append("\n"); 
		query.append("            ,A.CNMV_ID_NO" ).append("\n"); 
		query.append("            ,A.MVMT_STS_CD" ).append("\n"); 
		query.append("            ,A.CNMV_EVNT_DT" ).append("\n"); 
		query.append("            ,A.ORG_YD_CD" ).append("\n"); 
		query.append("            ,A.CRNT_VSL_CD" ).append("\n"); 
		query.append("            ,A.CRNT_SKD_VOY_NO" ).append("\n"); 
		query.append("            ,A.CRNT_SKD_DIR_CD" ).append("\n"); 
		query.append("            ,V.VPS_ETA_DT     " ).append("\n"); 
		query.append("            ,V.VPS_ETD_DT" ).append("\n"); 
		query.append("            ,V.CLPT_IND_SEQ" ).append("\n"); 
		query.append("            ,V.YD_CD        " ).append("\n"); 
		query.append("            ,(  CASE WHEN TO_NUMBER(TO_CHAR(A.CNMV_EVNT_DT,'YYYYMMDDHH24MISS')) >= TO_NUMBER(TO_CHAR(V.VPS_ETA_DT,'YYYYMMDDHH24MISS'))    AND " ).append("\n"); 
		query.append("                          TO_NUMBER(TO_CHAR(A.CNMV_EVNT_DT,'YYYYMMDDHH24MISS')) <= TO_NUMBER(TO_CHAR(V.VPS_ETD_DT,'YYYYMMDDHH24MISS')) " ).append("\n"); 
		query.append("                     THEN V.CLPT_IND_SEQ" ).append("\n"); 
		query.append("                     ELSE '0'" ).append("\n"); 
		query.append("                     END " ).append("\n"); 
		query.append("             ) CLPT_IND_SEQ2            " ).append("\n"); 
		query.append("            ,J.CLPT_IND_SEQ AS CLPT_IND_SEQ3" ).append("\n"); 
		query.append("            ,J.CNMV_DT" ).append("\n"); 
		query.append("        FROM CTM A, VSK_VSL_PORT_SKD V, JOO_CNTR_MVMT_EVNT_DT J" ).append("\n"); 
		query.append("        WHERE 1=1 " ).append("\n"); 
		query.append("        AND A.CNTR_NO = J.CNTR_NO(+)" ).append("\n"); 
		query.append("        AND A.CNMV_YR = J.CNMV_YR(+)" ).append("\n"); 
		query.append("        AND A.CNMV_ID_NO = J.CNMV_ID_NO(+)    " ).append("\n"); 
		query.append("        AND V.VSL_CD = A.CRNT_VSL_CD" ).append("\n"); 
		query.append("        AND V.SKD_VOY_NO = A.CRNT_SKD_VOY_NO" ).append("\n"); 
		query.append("        AND V.SKD_DIR_CD = A.CRNT_SKD_DIR_CD" ).append("\n"); 
		query.append("        AND V.VPS_PORT_CD = SUBSTR(A.ORG_YD_CD,1,5)" ).append("\n"); 
		query.append("        AND V.YD_CD = A.ORG_YD_CD     " ).append("\n"); 
		query.append("		     ) AA" ).append("\n"); 
		query.append("     WHERE 1=1" ).append("\n"); 
		query.append("     GROUP BY CNTR_NO, CNMV_YR, CNMV_ID_NO, MVMT_STS_CD, CNMV_EVNT_DT, ORG_YD_CD, CRNT_VSL_CD, CRNT_SKD_VOY_NO, CRNT_SKD_DIR_CD" ).append("\n"); 
		query.append("), MVMT_DT2 AS (  " ).append("\n"); 
		query.append("    SELECT DISTINCT" ).append("\n"); 
		query.append("         A.CNTR_NO" ).append("\n"); 
		query.append("        ,A.CNMV_YR" ).append("\n"); 
		query.append("        ,A.CNMV_ID_NO" ).append("\n"); 
		query.append("        ,A.MVMT_STS_CD" ).append("\n"); 
		query.append("        ,A.CNMV_EVNT_DT" ).append("\n"); 
		query.append("        ,A.ORG_YD_CD" ).append("\n"); 
		query.append("        ,A.CRNT_VSL_CD" ).append("\n"); 
		query.append("        ,A.CRNT_SKD_VOY_NO" ).append("\n"); 
		query.append("        ,A.CRNT_SKD_DIR_CD" ).append("\n"); 
		query.append("        ,A.CLPT_IND_SEQ2" ).append("\n"); 
		query.append("        ,A.CLPT_IND_SEQ3" ).append("\n"); 
		query.append("        ,DECODE(A.CLPT_IND_SEQ2,'0',CNMV_DT,A.CNMV_EVNT_DT) AS CNMV_DT" ).append("\n"); 
		query.append("    FROM MVMT_DT A" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", MVMT_DT3 AS (" ).append("\n"); 
		query.append("    SELECT CASE WHEN COUNT(1) = 0 THEN 'P'" ).append("\n"); 
		query.append("                ELSE 'NP'" ).append("\n"); 
		query.append("                END PASS" ).append("\n"); 
		query.append("    FROM MVMT_DT2 M" ).append("\n"); 
		query.append("    WHERE M.CNMV_DT IS NULL" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("SELECT" ).append("\n"); 
		query.append("     '1' AS sub_chk" ).append("\n"); 
		query.append("    ,JR.JO_BSA_TEU_QTY   AS ALL_TEU" ).append("\n"); 
		query.append("    ,JR.CGO_TON_WGT      AS ALL_WGT" ).append("\n"); 
		query.append("    ,'IST'  AS source" ).append("\n"); 
		query.append("    ,JR.jo_20ft_sub_teu_qty   " ).append("\n"); 
		query.append("    ,JR.jo_20ft_n1st_rto   " ).append("\n"); 
		query.append("    ,JR.jo_40ft_sub_teu_qty   " ).append("\n"); 
		query.append("    ,JR.jo_40ft_n1st_rto   " ).append("\n"); 
		query.append("    ,JR.jo_45ft_sub_teu_qty   " ).append("\n"); 
		query.append("    ,JR.Jo_45ft_n1st_rto   " ).append("\n"); 
		query.append("    ,JR.jo_45ft_n2nd_rto       " ).append("\n"); 
		query.append("    ,JR.jo_rnd_rule_lvl   " ).append("\n"); 
		query.append("    ,JR.JO_TON_TEU_QTY AS teu_qty" ).append("\n"); 
		query.append("    ,R.*" ).append("\n"); 
		query.append("    ,NVL((" ).append("\n"); 
		query.append("        SELECT SUM(B.OVR_VOID_SLT_QTY)" ).append("\n"); 
		query.append("        FROM   BKG_AWK_CGO B" ).append("\n"); 
		query.append("        WHERE 1=1" ).append("\n"); 
		query.append("        AND B.BKG_NO IN (SELECT BKG_NO FROM ROB_LIST)   " ).append("\n"); 
		query.append("    ),0)*2 AS ak_void  " ).append("\n"); 
		query.append("    ,(SELECT PASS FROM MVMT_DT3) AS PASS    " ).append("\n"); 
		query.append("FROM" ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("    SELECT " ).append("\n"); 
		query.append("         SUM(E_CNTR_WGT)  AS GRAND_TTL_WGT" ).append("\n"); 
		query.append("		,SUM(" ).append("\n"); 
		query.append("		CASE WHEN INSTR(R.CNTR_TPSZ_CD,'2') >0 AND (R.BKG_CGO_TP_CD='A' OR R.BKG_CGO_TP_CD='B' OR R.BKG_CGO_TP_CD='F') THEN 1 " ).append("\n"); 
		query.append("		     WHEN INSTR(R.CNTR_TPSZ_CD,'2') >0 AND (R.BKG_CGO_TP_CD='P' OR R.BKG_CGO_TP_CD='R') THEN 0" ).append("\n"); 
		query.append("		     ELSE 0 END                                     " ).append("\n"); 
		query.append("		) AS full_20" ).append("\n"); 
		query.append("		,SUM(" ).append("\n"); 
		query.append("		CASE WHEN INSTR(R.CNTR_TPSZ_CD,'2') >0 AND (R.BKG_CGO_TP_CD='A' OR R.BKG_CGO_TP_CD='B' OR R.BKG_CGO_TP_CD='F') THEN 0" ).append("\n"); 
		query.append("		     WHEN INSTR(R.CNTR_TPSZ_CD,'2') >0 AND (R.BKG_CGO_TP_CD='P' OR R.BKG_CGO_TP_CD='R') THEN 1" ).append("\n"); 
		query.append("		     ELSE 0 END                                                                 " ).append("\n"); 
		query.append("		) AS mt_20" ).append("\n"); 
		query.append("		,SUM(" ).append("\n"); 
		query.append("		CASE WHEN INSTR(R.CNTR_TPSZ_CD,'4') >0 AND (R.BKG_CGO_TP_CD='A' OR R.BKG_CGO_TP_CD='B' OR R.BKG_CGO_TP_CD='F') THEN 1 " ).append("\n"); 
		query.append("		     WHEN INSTR(R.CNTR_TPSZ_CD,'4') >0 AND (R.BKG_CGO_TP_CD='P' OR R.BKG_CGO_TP_CD='R') THEN 0" ).append("\n"); 
		query.append("		     ELSE 0 END                                                                 " ).append("\n"); 
		query.append("		) AS full_40" ).append("\n"); 
		query.append("		,SUM(" ).append("\n"); 
		query.append("		CASE WHEN INSTR(R.CNTR_TPSZ_CD,'4') >0 AND (R.BKG_CGO_TP_CD='A' OR R.BKG_CGO_TP_CD='B' OR R.BKG_CGO_TP_CD='F') THEN 0" ).append("\n"); 
		query.append("		     WHEN INSTR(R.CNTR_TPSZ_CD,'4') >0 AND (R.BKG_CGO_TP_CD='P' OR R.BKG_CGO_TP_CD='R') THEN 1" ).append("\n"); 
		query.append("		     ELSE 0 END                                                                 " ).append("\n"); 
		query.append("		) AS mt_40    " ).append("\n"); 
		query.append("		,SUM(" ).append("\n"); 
		query.append("		CASE WHEN INSTR(R.CNTR_TPSZ_CD,'3') >0 AND (R.BKG_CGO_TP_CD='A' OR R.BKG_CGO_TP_CD='B' OR R.BKG_CGO_TP_CD='F') THEN 1 " ).append("\n"); 
		query.append("		     WHEN INSTR(R.CNTR_TPSZ_CD,'3') >0 AND (R.BKG_CGO_TP_CD='P' OR R.BKG_CGO_TP_CD='R') THEN 0" ).append("\n"); 
		query.append("		     ELSE 0 END                                                                 " ).append("\n"); 
		query.append("		) AS hc_ld_20    " ).append("\n"); 
		query.append("		,SUM(" ).append("\n"); 
		query.append("		CASE WHEN INSTR(R.CNTR_TPSZ_CD,'3') >0 AND (R.BKG_CGO_TP_CD='A' OR R.BKG_CGO_TP_CD='B' OR R.BKG_CGO_TP_CD='F') THEN 0 " ).append("\n"); 
		query.append("		     WHEN INSTR(R.CNTR_TPSZ_CD,'3') >0 AND (R.BKG_CGO_TP_CD='P' OR R.BKG_CGO_TP_CD='R') THEN 1" ).append("\n"); 
		query.append("		     ELSE 0 END                                                                 " ).append("\n"); 
		query.append("		) AS hc_bsa_20        " ).append("\n"); 
		query.append("		,SUM(" ).append("\n"); 
		query.append("		CASE WHEN INSTR(R.CNTR_TPSZ_CD,'5') >0 AND (R.BKG_CGO_TP_CD='A' OR R.BKG_CGO_TP_CD='B' OR R.BKG_CGO_TP_CD='F') THEN 1 " ).append("\n"); 
		query.append("		     WHEN INSTR(R.CNTR_TPSZ_CD,'5') >0 AND (R.BKG_CGO_TP_CD='P' OR R.BKG_CGO_TP_CD='R') THEN 0" ).append("\n"); 
		query.append("             WHEN INSTR(R.CNTR_TPSZ_CD,'9') >0 AND (R.BKG_CGO_TP_CD='A' OR R.BKG_CGO_TP_CD='B' OR R.BKG_CGO_TP_CD='F') THEN 1 " ).append("\n"); 
		query.append("             WHEN INSTR(R.CNTR_TPSZ_CD,'9') >0 AND (R.BKG_CGO_TP_CD='P' OR R.BKG_CGO_TP_CD='R') THEN 0" ).append("\n"); 
		query.append("		     ELSE 0 END                                                                 " ).append("\n"); 
		query.append("		) AS hc_ld_40" ).append("\n"); 
		query.append("		,SUM(" ).append("\n"); 
		query.append("		CASE WHEN INSTR(R.CNTR_TPSZ_CD,'5') >0 AND (R.BKG_CGO_TP_CD='A' OR R.BKG_CGO_TP_CD='B' OR R.BKG_CGO_TP_CD='F') THEN 0" ).append("\n"); 
		query.append("		     WHEN INSTR(R.CNTR_TPSZ_CD,'5') >0 AND (R.BKG_CGO_TP_CD='P' OR R.BKG_CGO_TP_CD='R') THEN 1" ).append("\n"); 
		query.append("             WHEN INSTR(R.CNTR_TPSZ_CD,'9') >0 AND (R.BKG_CGO_TP_CD='A' OR R.BKG_CGO_TP_CD='B' OR R.BKG_CGO_TP_CD='F') THEN 0" ).append("\n"); 
		query.append("		     WHEN INSTR(R.CNTR_TPSZ_CD,'9') >0 AND (R.BKG_CGO_TP_CD='P' OR R.BKG_CGO_TP_CD='R') THEN 1             " ).append("\n"); 
		query.append("		     ELSE 0 END                                                                 " ).append("\n"); 
		query.append("		) AS hc_bsa_40            " ).append("\n"); 
		query.append("		,SUM(" ).append("\n"); 
		query.append("		CASE WHEN INSTR(R.CNTR_TPSZ_CD,'7') >0 AND (R.BKG_CGO_TP_CD='A' OR R.BKG_CGO_TP_CD='B' OR R.BKG_CGO_TP_CD='F') THEN 1 " ).append("\n"); 
		query.append("		     WHEN INSTR(R.CNTR_TPSZ_CD,'7') >0 AND (R.BKG_CGO_TP_CD='P' OR R.BKG_CGO_TP_CD='R') THEN 0" ).append("\n"); 
		query.append("		     ELSE 0 END                                                                 " ).append("\n"); 
		query.append("		) AS hc_ld_45    " ).append("\n"); 
		query.append("		,SUM(" ).append("\n"); 
		query.append("		CASE WHEN INSTR(R.CNTR_TPSZ_CD,'7') >0 AND (R.BKG_CGO_TP_CD='A' OR R.BKG_CGO_TP_CD='B' OR R.BKG_CGO_TP_CD='F') THEN 0" ).append("\n"); 
		query.append("		     WHEN INSTR(R.CNTR_TPSZ_CD,'7') >0 AND (R.BKG_CGO_TP_CD='P' OR R.BKG_CGO_TP_CD='R') THEN 1" ).append("\n"); 
		query.append("		     ELSE 0 END                                                                 " ).append("\n"); 
		query.append("		) AS hc_bsa_45     " ).append("\n"); 
		query.append("        ,SUM(DECODE(R.AWK_CGO_FLG,'Y',1,0)) AS ak_unit" ).append("\n"); 
		query.append("        --,'0' AS ak_void" ).append("\n"); 
		query.append("        ,SUM(" ).append("\n"); 
		query.append("            CASE WHEN INSTR(R.CNTR_TPSZ_CD, '2') > 0 AND DECODE(R.POL_CD || R.RC_FLG,@[in_pol_cd] || 'Y',1,0) = 1 THEN 1" ).append("\n"); 
		query.append("            ELSE 0 END" ).append("\n"); 
		query.append("         ) 	AS rf_20_qty" ).append("\n"); 
		query.append("        ,SUM(" ).append("\n"); 
		query.append("            CASE WHEN INSTR(R.CNTR_TPSZ_CD, '2') = 0 AND DECODE(R.POL_CD || R.RC_FLG,@[in_pol_cd] || 'Y',1,0) = 1 THEN 1" ).append("\n"); 
		query.append("            ELSE 0 END" ).append("\n"); 
		query.append("         ) 	AS rf_40_qty" ).append("\n"); 
		query.append("	    ,SUM(" ).append("\n"); 
		query.append("            CASE WHEN INSTR(R.CNTR_TPSZ_CD, '2') > 0 AND DECODE(R.RC_FLG,'Y',1,0) = 1 THEN 1" ).append("\n"); 
		query.append("            ELSE 0 END" ).append("\n"); 
		query.append("         ) AS rf_rdr_20" ).append("\n"); 
		query.append("	    ,SUM(" ).append("\n"); 
		query.append("            CASE WHEN INSTR(R.CNTR_TPSZ_CD, '2') = 0 AND DECODE(R.RC_FLG,'Y',1,0) = 1 THEN 1" ).append("\n"); 
		query.append("            ELSE 0 END" ).append("\n"); 
		query.append("        ) AS rf_rdr_40" ).append("\n"); 
		query.append("        ,SUM(" ).append("\n"); 
		query.append("            CASE WHEN INSTR(R.CNTR_TPSZ_CD, '2') > 0 AND DECODE(R.POL_CD || R.DCGO_FLG,@[in_pol_cd] || 'Y',1,0) = 1 THEN 1" ).append("\n"); 
		query.append("            ELSE 0 END" ).append("\n"); 
		query.append("         ) 	AS dg_20" ).append("\n"); 
		query.append("        ,SUM(" ).append("\n"); 
		query.append("            CASE WHEN INSTR(R.CNTR_TPSZ_CD, '2') = 0 AND DECODE(R.POL_CD || R.DCGO_FLG,@[in_pol_cd] || 'Y',1,0) = 1 THEN 1" ).append("\n"); 
		query.append("            ELSE 0 END" ).append("\n"); 
		query.append("         ) 	AS dg_40" ).append("\n"); 
		query.append("        ,'0' AS mt_teu" ).append("\n"); 
		query.append("        ,'0' AS mt_wt   " ).append("\n"); 
		query.append("        ,R.SLAN_CD" ).append("\n"); 
		query.append("    FROM ROB_LIST2 R" ).append("\n"); 
		query.append("    GROUP BY R.SLAN_CD" ).append("\n"); 
		query.append(") R, (SELECT * FROM JOO_ROB_RTO WHERE SKD_DIR_CD = SUBSTR(@[in_vvd_cd],9,1)) JR" ).append("\n"); 
		query.append("WHERE 1=1" ).append("\n"); 
		query.append("AND R.SLAN_CD = JR.SLAN_CD" ).append("\n"); 

	}
}