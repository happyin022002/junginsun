<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="JointOperationLetterDBDAOSearchInvoiceCombinedRSQL">
			<desc><![CDATA[DESC Enter..]]></desc>
			<sql><![CDATA[
SELECT 
        Z.ACCT_YRMON,
        Z.RLANE_CD,
        Z.JO_HJS_AMT,
        Z.JO_PRNR_AMT,   
        CASE WHEN Z.JO_HJS_AMT < Z.JO_PRNR_AMT THEN '('||TO_CHAR(Z.JO_BAL_AMT,'fm999,999,999,999,990.90')||')'  ELSE  TO_CHAR(Z.JO_BAL_AMT,'fm999,999,999,999,990.90') END JO_BAL_AMT_LBL,
        Z.JO_BAL_AMT,
        Z.JO_CRR_CD
        ,''STL_RMK
 FROM ( 
	SELECT 
         TO_CHAR( TO_DATE(A.ACCT_YRMON||'01', 'YYYYMMDD'), 'YYYY-MM' )ACCT_YRMON 
		,SUBSTR(A.RLANE_CD,0,3) AS RLANE_CD
		,SUM(NVL(DECODE(A.RE_DIVR_CD,'R',DECODE(A.STL_ADJ_FLG,'Y',B.STL_LOCL_AMT,A.STL_LOCL_AMT)),0)) AS JO_HJS_AMT
		,SUM(NVL(DECODE(A.RE_DIVR_CD,'E',DECODE(A.STL_ADJ_FLG,'Y',B.STL_LOCL_AMT,A.STL_LOCL_AMT)),0)) AS JO_PRNR_AMT
        ,ABS(SUM(NVL(DECODE(A.RE_DIVR_CD, 'R', DECODE(A.STL_ADJ_FLG, 'Y', B.STL_LOCL_AMT, A.STL_LOCL_AMT)), 0))
           - SUM(NVL(DECODE(A.RE_DIVR_CD, 'E', DECODE(A.STL_ADJ_FLG, 'Y', B.STL_LOCL_AMT, A.STL_LOCL_AMT)), 0))) AS JO_BAL_AMT
        ,A.JO_CRR_CD 
	FROM   JOO_SETTLEMENT  A,
	       JOO_STL_DTL     B,
           JOO_STL_CMB_DTL C
	WHERE  A.ACCT_YRMON  = B.ACCT_YRMON (+)
	AND    A.STL_VVD_SEQ = B.STL_VVD_SEQ(+)
	AND    A.STL_SEQ     = B.STL_SEQ    (+)

    AND    A.ACCT_YRMON  = C.ACCT_YRMON
    AND    A.RE_DIVR_CD  = C.RE_DIVR_CD
    AND    A.STL_SEQ     = C.STL_SEQ
    AND    A.STL_VVD_SEQ = C.STL_VVD_SEQ   
    AND    A.STL_LOCL_AMT<>0
	AND    A.ACCT_YRMON  = REPLACE(@[acct_yrmon],'-','')
	AND    A.JO_CRR_CD   = @[jo_crr_cd]
	AND    NVL(A.CMB_CFM_FLG,'N') = 'Y' 
 
		           #if (${stlcmbseq} != '') 
                   	AND   C.STL_CMB_SEQ  in ( 
	                #foreach($key IN ${stlcmbseq}) 
                        #if($velocityCount < $stlcmbseq.size()) 
                             '$key', 
                        #else 
                             '$key' 
                        #end 
                    #end 
                    )  
                  #end
 
    GROUP BY A.JO_CRR_CD,  A.ACCT_YRMON, A.RLANE_CD  
ORDER BY A.RLANE_CD 
  )Z			]]></sql>
			<params>
				<param name="acct_yrmon" type="12" value="" out="N"/>
				<param name="jo_crr_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
