<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ARInvoiceCorrectionDBDAOSearchDirectBillingInvoiceVORSQL">
			<desc><![CDATA[ARInvoiceCorrectionDBDAO::searchDirectBilling ( bilInputVo )]]></desc>
			<sql><![CDATA[
SELECT AR_OFC_CD
      ,BL_SRC_NO
      ,MN.INV_NO
      ,MN.ISS_DT
      ,TRNK_VSL_CD||TRNK_SKD_VOY_NO||TRNK_SKD_DIR_CD VVD
      ,IO_BND_CD
      ,SVC_SCP_CD
      ,SLAN_CD
      ,SAIL_ARR_DT
      ,ACT_CUST_CNT_CD||TO_CHAR(ACT_CUST_SEQ, 'FM099999') CUST_CD
      ,RFA_NO
      ,SC_NO
      ,POR_CD
      ,POL_CD
      ,POD_CD
      ,DEL_CD
      ,CHG_CD
      ,CURR_CD
      ,TRF_RT_AMT
      ,RAT_AS_CNTR_QTY
      ,PER_TP_CD
      ,CHG_AMT
      ,INV_XCH_RT
      ,CHG_AMT*INV_XCH_RT LOCL_AMT
      ,BKG_REF_NO
      ,INV_REF_NO
      ,CGO_MEAS_QTY
      ,CGO_WGT
      ,MIN(DECODE(CNTR_SEQ,1,CNTR_TPSZ_CD)) CNTR_TYP_1
      ,MIN(DECODE(CNTR_SEQ,1,  CNTR_NO))  CNTR_NO_1  
      ,MIN(DECODE(CNTR_SEQ,2,CNTR_TPSZ_CD)) CNTR_TYP_2
      ,MIN(DECODE(CNTR_SEQ,2,  CNTR_NO))  CNTR_NO_2
      ,MIN(DECODE(CNTR_SEQ,3,CNTR_TPSZ_CD)) CNTR_TYP_3
      ,MIN(DECODE(CNTR_SEQ,3,  CNTR_NO))  CNTR_NO_3 
      ,MIN(DECODE(CNTR_SEQ,4,CNTR_TPSZ_CD)) CNTR_TYP_4
      ,MIN(DECODE(CNTR_SEQ,4,  CNTR_NO))  CNTR_NO_4 
      ,MIN(DECODE(CNTR_SEQ,5,CNTR_TPSZ_CD)) CNTR_TYP_5
      ,MIN(DECODE(CNTR_SEQ,5,  CNTR_NO))  CNTR_NO_5 
      ,MIN(DECODE(CNTR_SEQ,6,CNTR_TPSZ_CD)) CNTR_TYP_6
      ,MIN(DECODE(CNTR_SEQ,6,  CNTR_NO))  CNTR_NO_6 
      ,MIN(DECODE(CNTR_SEQ,7,CNTR_TPSZ_CD)) CNTR_TYP_7
      ,MIN(DECODE(CNTR_SEQ,7,  CNTR_NO))  CNTR_NO_7 
      ,MIN(DECODE(CNTR_SEQ,8,CNTR_TPSZ_CD)) CNTR_TYP_8
      ,MIN(DECODE(CNTR_SEQ,8,  CNTR_NO))  CNTR_NO_8 
      ,MIN(DECODE(CNTR_SEQ,9,CNTR_TPSZ_CD)) CNTR_TYP_9
      ,MIN(DECODE(CNTR_SEQ,9,  CNTR_NO))  CNTR_NO_9 
      ,MIN(DECODE(CNTR_SEQ,10,CNTR_TPSZ_CD)) CNTR_TYP_10
      ,MIN(DECODE(CNTR_SEQ,10,  CNTR_NO))  CNTR_NO_10   
      ,MIN(DECODE(CNTR_SEQ,11,CNTR_TPSZ_CD)) CNTR_TYP_11
      ,MIN(DECODE(CNTR_SEQ,11,  CNTR_NO))  CNTR_NO_11  
      ,MIN(DECODE(CNTR_SEQ,12,CNTR_TPSZ_CD)) CNTR_TYP_12
      ,MIN(DECODE(CNTR_SEQ,12,  CNTR_NO))  CNTR_NO_12
      ,MIN(DECODE(CNTR_SEQ,13,CNTR_TPSZ_CD)) CNTR_TYP_13
      ,MIN(DECODE(CNTR_SEQ,13,  CNTR_NO))  CNTR_NO_13 
      ,MIN(DECODE(CNTR_SEQ,14,CNTR_TPSZ_CD)) CNTR_TYP_14
      ,MIN(DECODE(CNTR_SEQ,14,  CNTR_NO))  CNTR_NO_14 
      ,MIN(DECODE(CNTR_SEQ,15,CNTR_TPSZ_CD)) CNTR_TYP_15
      ,MIN(DECODE(CNTR_SEQ,15,  CNTR_NO))  CNTR_NO_15 
      ,MIN(DECODE(CNTR_SEQ,16,CNTR_TPSZ_CD)) CNTR_TYP_16
      ,MIN(DECODE(CNTR_SEQ,16,  CNTR_NO))  CNTR_NO_16 
      ,MIN(DECODE(CNTR_SEQ,17,CNTR_TPSZ_CD)) CNTR_TYP_17
      ,MIN(DECODE(CNTR_SEQ,17,  CNTR_NO))  CNTR_NO_17 
      ,MIN(DECODE(CNTR_SEQ,18,CNTR_TPSZ_CD)) CNTR_TYP_18
      ,MIN(DECODE(CNTR_SEQ,18,  CNTR_NO))  CNTR_NO_18 
      ,MIN(DECODE(CNTR_SEQ,19,CNTR_TPSZ_CD)) CNTR_TYP_19
      ,MIN(DECODE(CNTR_SEQ,19,  CNTR_NO))  CNTR_NO_19 
      ,MIN(DECODE(CNTR_SEQ,20,CNTR_TPSZ_CD)) CNTR_TYP_20
      ,MIN(DECODE(CNTR_SEQ,20,  CNTR_NO))  CNTR_NO_20   
      ,MIN(DECODE(CNTR_SEQ,21,CNTR_TPSZ_CD)) CNTR_TYP_21
      ,MIN(DECODE(CNTR_SEQ,21,  CNTR_NO))  CNTR_NO_21  
      ,MIN(DECODE(CNTR_SEQ,22,CNTR_TPSZ_CD)) CNTR_TYP_22
      ,MIN(DECODE(CNTR_SEQ,22,  CNTR_NO))  CNTR_NO_22
      ,MIN(DECODE(CNTR_SEQ,23,CNTR_TPSZ_CD)) CNTR_TYP_23
      ,MIN(DECODE(CNTR_SEQ,23,  CNTR_NO))  CNTR_NO_23 
      ,MIN(DECODE(CNTR_SEQ,24,CNTR_TPSZ_CD)) CNTR_TYP_24
      ,MIN(DECODE(CNTR_SEQ,24,  CNTR_NO))  CNTR_NO_24 
      ,MIN(DECODE(CNTR_SEQ,25,CNTR_TPSZ_CD)) CNTR_TYP_25
      ,MIN(DECODE(CNTR_SEQ,25,  CNTR_NO))  CNTR_NO_25 
      ,MIN(DECODE(CNTR_SEQ,26,CNTR_TPSZ_CD)) CNTR_TYP_26
      ,MIN(DECODE(CNTR_SEQ,26,  CNTR_NO))  CNTR_NO_26 
      ,MIN(DECODE(CNTR_SEQ,27,CNTR_TPSZ_CD)) CNTR_TYP_27
      ,MIN(DECODE(CNTR_SEQ,27,  CNTR_NO))  CNTR_NO_27 
      ,MIN(DECODE(CNTR_SEQ,28,CNTR_TPSZ_CD)) CNTR_TYP_28
      ,MIN(DECODE(CNTR_SEQ,28,  CNTR_NO))  CNTR_NO_28 
      ,MIN(DECODE(CNTR_SEQ,29,CNTR_TPSZ_CD)) CNTR_TYP_29
      ,MIN(DECODE(CNTR_SEQ,29,  CNTR_NO))  CNTR_NO_29 
      ,MIN(DECODE(CNTR_SEQ,30,SUBSTR(CNTR_TPSZ_CD_30,2))) CNTR_TYP_30
      ,MIN(DECODE(CNTR_SEQ,30,SUBSTR(CNTR_NO_30,2)))  CNTR_NO_30
  FROM INV_AR_MN MN,
       INV_AR_CHG CHG,
       INV_AR_CNTR CNTR,
       (SELECT A.AR_IF_NO      
              ,XMLAGG(XMLELEMENT(x,'/'||CNTR_TPSZ_CD||'') ORDER BY CNTR_SEQ).EXTRACT('//text()').GetStringVal() CNTR_TPSZ_CD_30 
              ,XMLAGG(XMLELEMENT(x,'/'||CNTR_NO||'') ORDER BY CNTR_SEQ).EXTRACT('//text()').GetStringVal() CNTR_NO_30          
          FROM INV_AR_MN A,
               INV_AR_CNTR E
         WHERE A.AR_IF_NO = E.AR_IF_NO(+)
		   AND NVL(A.INV_DELT_DIV_CD,'N') <> 'Y'    
           #if  (${ofc_cd} == 'ALL')
   		   AND A.AR_OFC_CD IN (SELECT AR_OFC_CD FROM MDM_ORGANIZATION WHERE AR_HD_QTR_OFC_CD = @[ar_hd_qtr_ofc_cd])
		   #else
   		   AND A.AR_OFC_CD = @[ofc_cd]
		   #end
           AND A.ACT_CUST_CNT_CD = @[act_cust_cnt_cd]
           AND A.ACT_CUST_SEQ = @[act_cust_seq]
#if (${dt_type} == 'I') 
           AND A.ISS_DT BETWEEN REPLACE(@[fm_dt],'-','') AND REPLACE(@[to_dt],'-','')
#elseif (${dt_type} == 'G') 
		   AND A.BL_INV_CFM_DT BETWEEN REPLACE(@[fm_dt],'-','') AND REPLACE(@[to_dt],'-','')
#else
           AND A.SAIL_ARR_DT BETWEEN REPLACE(@[fm_dt],'-','') AND REPLACE(@[to_dt],'-','')
#end
#if (${vvd_cd} != '') 
		   AND A.VSL_CD = SUBSTR(@[vvd_cd],0,4)
           AND A.SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4)
           AND A.SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)
#end
#if (${io_bnd_cd} != '') 
		   AND A.IO_BND_CD = @[io_bnd_cd]
#end
#if (${por_cd} != '') 
		   AND A.POR_CD = @[por_cd]
#end
#if (${pol_cd} != '') 
		   AND A.POL_CD = @[pol_cd]
#end
#if (${pod_cd} != '') 
		   AND A.POD_CD = @[pod_cd]
#end
#if (${del_cd} != '') 
		   AND A.DEL_CD = @[del_cd]
#end
#if (${iss_opt} != '') 
	#if (${iss_opt} == 'I') 
		   AND NVL(A.INV_ISS_FLG,'N') = 'Y'
	#else
		   AND NVL(A.INV_ISS_FLG,'N') = 'N'
	#end
#end
           AND A.INV_NO != 'SYS CLEAR'
		   AND E.CNTR_SEQ > 29
         GROUP BY A.AR_IF_NO) CNTR30    
 WHERE MN.AR_IF_NO = CHG.AR_IF_NO  
   AND MN.AR_IF_NO = CNTR.AR_IF_NO(+)  
   AND MN.AR_IF_NO = CNTR30.AR_IF_NO(+)
   AND NVL(MN.INV_DELT_DIV_CD,'N') <> 'Y'
#if  (${ofc_cd} == 'ALL')
   AND MN.AR_OFC_CD IN (SELECT AR_OFC_CD FROM MDM_ORGANIZATION WHERE AR_HD_QTR_OFC_CD = @[ar_hd_qtr_ofc_cd])
#else
   AND MN.AR_OFC_CD = @[ofc_cd]
#end
   AND MN.ACT_CUST_CNT_CD = @[act_cust_cnt_cd]
   AND MN.ACT_CUST_SEQ = @[act_cust_seq]
#if (${dt_type} == 'I') 
   AND MN.ISS_DT BETWEEN REPLACE(@[fm_dt],'-','') AND REPLACE(@[to_dt],'-','')
#elseif (${dt_type} == 'G') 
   AND MN.BL_INV_CFM_DT BETWEEN REPLACE(@[fm_dt],'-','') AND REPLACE(@[to_dt],'-','')
#else
   AND MN.SAIL_ARR_DT BETWEEN REPLACE(@[fm_dt],'-','') AND REPLACE(@[to_dt],'-','')
#end
#if (${vvd_cd} != '') 
   AND MN.VSL_CD = SUBSTR(@[vvd_cd],0,4)
   AND MN.SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4)
   AND MN.SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)
#end
#if (${io_bnd_cd} != '') 
   AND MN.IO_BND_CD = @[io_bnd_cd]
#end
#if (${por_cd} != '') 
   AND MN.POR_CD = @[por_cd]
#end
#if (${pol_cd} != '') 
   AND MN.POL_CD = @[pol_cd]
#end
#if (${pod_cd} != '') 
   AND MN.POD_CD = @[pod_cd]
#end
#if (${del_cd} != '') 
   AND MN.DEL_CD = @[del_cd]
#end
#if (${iss_opt} != '') 
	#if (${iss_opt} == 'I') 
		   AND NVL(MN.INV_ISS_FLG,'N') = 'Y'
	#else
		   AND NVL(MN.INV_ISS_FLG,'N') = 'N'
	#end
#end
	AND MN.INV_NO != 'SYS CLEAR'
 GROUP BY AR_OFC_CD
      ,BL_SRC_NO
      ,MN.INV_NO
      ,MN.ISS_DT
      ,TRNK_VSL_CD||TRNK_SKD_VOY_NO||TRNK_SKD_DIR_CD
      ,IO_BND_CD
      ,SVC_SCP_CD
      ,SLAN_CD
      ,SAIL_ARR_DT
      ,ACT_CUST_CNT_CD||TO_CHAR(ACT_CUST_SEQ, 'FM099999')
      ,RFA_NO
      ,SC_NO
      ,POR_CD
      ,POL_CD
      ,POD_CD
      ,DEL_CD
      ,CHG_CD
      ,CURR_CD
	  ,TRF_RT_AMT
      ,RAT_AS_CNTR_QTY
      ,PER_TP_CD
      ,CHG_AMT
      ,INV_XCH_RT
      ,CHG_AMT*INV_XCH_RT
      ,BKG_REF_NO
      ,INV_REF_NO
      ,CGO_MEAS_QTY
      ,CGO_WGT
      ,MN.AR_IF_NO			]]></sql>
			<params>
				<param name="ar_hd_qtr_ofc_cd" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="SIABS" out="N"/>
				<param name="act_cust_cnt_cd" type="12" value="" out="N"/>
				<param name="act_cust_seq" type="12" value="" out="N"/>
				<param name="fm_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="por_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
