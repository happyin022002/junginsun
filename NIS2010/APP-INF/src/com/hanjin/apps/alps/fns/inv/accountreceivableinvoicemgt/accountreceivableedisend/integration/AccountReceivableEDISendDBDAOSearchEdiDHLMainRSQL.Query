<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivableEDISendDBDAOSearchEdiDHLMainRSQL">
			<desc><![CDATA[SearchEdiDHLMain]]></desc>
			<sql><![CDATA[
SELECT A.INV_NO INV_NUMBER,
  NVL(A.ISS_DT, A.RISS_DT) INV_CREATION_DATE,
  C.ACT_CUST_CNT_CD || LPAD(TO_CHAR(C.ACT_CUST_SEQ), 6, '0') PT_CD,
  DECODE(C.CUST_CR_FLG, 'Y', DECODE(NVL(E.CUST_RLSE_CTRL_FLG, 'N'), 'Y', NVL(A.ISS_DT, A.RISS_DT), DECODE(NVL(E.INV_DUE_DT_DP_FLG, 'N'), 'Y', NVL(A.ISS_DT, A.RISS_DT), C.DUE_DT)), NVL(A.ISS_DT, A.RISS_DT)) INV_DUE_DATE,
  (SELECT K.INV_REF_NO
   FROM INV_AR_MN K
   WHERE K.AR_IF_NO = (SELECT SUBSTR(MAX(DECODE(V1.REV_TP_CD, 'M', '1', '2')||V1.AR_IF_NO), 2,11)
                       FROM INV_AR_MN V1, INV_AR_ISS_DTL V2
                       WHERE V1.AR_IF_NO = V2.AR_IF_NO AND V1.INV_REF_NO IS NOT NULL AND V2.INV_NO = A.INV_NO)
  ) EXT_CUST_REF,
  SUBSTR(NVL(E.LOCL_NM, D.CUST_LGL_ENG_NM),1,50) PT_NAME,
  NVL(E.LOCL_ADDR1 || E.LOCL_ADDR2 || E.LOCL_ADDR3 || E.LOCL_ADDR4, F.BZET_ADDR) PT_ADDRESS,
  SUBSTR(NVL(TRIM(E.LOCL_ADDR1),
    DECODE(TRIM(E.LOCL_ADDR1 || E.LOCL_ADDR2 || E.LOCL_ADDR3 || E.LOCL_ADDR4), '', 
      DECODE(C.ACT_CUST_CNT_CD, 'TB', DECODE(F.PRMRY_CHK_FLG, 'Y', 
        DECODE(TRIM(F.LOCL_ADDR1||F.LOCL_ADDR2||F.LOCL_ADDR3||F.LOCL_ADDR4), '', SUBSTR(F.BZET_ADDR, 1, 50), F.LOCL_ADDR1), ''),
          DECODE(F.PRMRY_CHK_FLG, 'Y', DECODE(SUBSTR(F.BZET_ADDR, 1, 50), '', '', SUBSTR(F.BZET_ADDR, 1, 50)), '')))), 1, 50
  ) PT_ADDRESS1,
  (SELECT SUBSTR(OFC_ENG_NM, INSTRB(OFC_ENG_NM, ',') + 1) FROM MDM_ORGANIZATION WHERE OFC_CD = @[ofc_cd]) PT_IFR_ADDRESS1,
  SUBSTR(NVL(TRIM(E.LOCL_ADDR2),
    DECODE(TRIM(E.LOCL_ADDR1 || E.LOCL_ADDR2 || E.LOCL_ADDR3 || E.LOCL_ADDR4),'',
      DECODE(C.ACT_CUST_CNT_CD,'TB',
        DECODE(F.PRMRY_CHK_FLG,'Y',DECODE(TRIM(F.LOCL_ADDR1||F.LOCL_ADDR2||F.LOCL_ADDR3||F.LOCL_ADDR4),'',SUBSTR(F.BZET_ADDR,51,100),F.LOCL_ADDR2),''),
          DECODE(F.PRMRY_CHK_FLG,'Y',DECODE(SUBSTR(F.BZET_ADDR,51,100),'','', SUBSTR(F.BZET_ADDR,51,100)),'')))), 1, 50
  ) PT_ADDRESS2,
  SUBSTR(NVL(TRIM(E.LOCL_ADDR3),
    DECODE(TRIM(E.LOCL_ADDR1 || E.LOCL_ADDR2 || E.LOCL_ADDR3 || E.LOCL_ADDR4),'',
      DECODE(C.ACT_CUST_CNT_CD,'TB',
        DECODE(F.PRMRY_CHK_FLG,'Y',DECODE(TRIM(F.LOCL_ADDR1||F.LOCL_ADDR2||F.LOCL_ADDR3||F.LOCL_ADDR4),'',SUBSTR(F.BZET_ADDR,101,150),F.LOCL_ADDR3),''),
          DECODE(F.PRMRY_CHK_FLG,'Y',DECODE(SUBSTR(F.BZET_ADDR,101,150),'','', SUBSTR(F.BZET_ADDR,101,150)),'')))), 1, 50
  ) PT_ADDRESS3,
  SUBSTR(NVL(TRIM(E.LOCL_ADDR4),
    DECODE(TRIM(E.LOCL_ADDR1 || E.LOCL_ADDR2 || E.LOCL_ADDR3 || E.LOCL_ADDR4),'',
      DECODE(C.ACT_CUST_CNT_CD,'TB',
        DECODE(F.PRMRY_CHK_FLG,'Y',DECODE(TRIM(F.LOCL_ADDR1||F.LOCL_ADDR2||F.LOCL_ADDR3||F.LOCL_ADDR4),'',SUBSTR(F.BZET_ADDR,151,200),F.LOCL_ADDR4)||DECODE(F.ZIP_CD,'','',', '||F.ZIP_CD)||DECODE(F.CTY_NM,'','',', '||F.CTY_NM),''),
          DECODE(F.PRMRY_CHK_FLG,'Y',SUBSTR(F.BZET_ADDR,151,200)||DECODE(F.ZIP_CD,'','','  '||F.ZIP_CD)||DECODE(F.CTY_NM,'','',', '||F.CTY_NM))))), 1, 50
  ) PT_ADDRESS4,
  D.CUST_RGST_NO PT_VAT_ID,
  G.VSL_ENG_NM FULL_VSL_NM,
  C.VSL_CD||C.SKD_VOY_NO||C.SKD_DIR_CD BKG_VVD,
  C.POR_CD BL_POR_CD,
  R.LOC_NM BL_POR_NM,
  C.POL_CD BL_POL_CD,
  H.LOC_NM BL_POL_NM,
  C.POD_CD BL_POD_CD,
  I.LOC_NM BL_POD_NM,
  C.DEL_CD BL_DEL_CD,
  DD.LOC_NM BL_DEL_NM,
  C.SAIL_DT POL_DATE,
  C.SAIL_ARR_DT POD_DATE,
  C.BL_SRC_NO BL_NO,
  C.BKG_NO BKG_NO,
  C.INV_RMK BKG_REMARK,
  C.IO_BND_CD FC_PAYAT
FROM INV_AR_ISS A,
  INV_AR_ISS_DTL B,
  INV_AR_MN C,
  MDM_CUSTOMER D,
  MDM_CR_CUST E,
  MDM_CUST_ADDR F,
  MDM_VSL_CNTR G,
  MDM_LOCATION H,
  MDM_LOCATION I,
  MDM_LOCATION R,
  MDM_LOCATION DD
WHERE A.INV_NO = B.INV_NO
  AND B.AR_IF_NO = C.AR_IF_NO
  AND C.ACT_CUST_CNT_CD = D.CUST_CNT_CD(+)
  AND C.ACT_CUST_SEQ = D.CUST_SEQ(+)
  AND C.ACT_CUST_CNT_CD = E.CUST_CNT_CD(+)
  AND C.ACT_CUST_SEQ = E.CUST_SEQ(+)
  AND C.ACT_CUST_CNT_CD = F.CUST_CNT_CD(+)
  AND C.ACT_CUST_SEQ = F.CUST_SEQ(+)
  AND F.PRMRY_CHK_FLG(+) = 'Y'
  AND C.VSL_CD = G.VSL_CD(+)
  AND C.POL_CD = H.LOC_CD(+)
  AND C.POD_CD = I.LOC_CD(+)
  AND C.POR_CD = R.LOC_CD(+)
  AND C.DEL_CD = DD.LOC_CD(+)
  AND A.INV_SEQ = (SELECT MAX(B.INV_SEQ) FROM INV_AR_ISS B
                   WHERE   B.INV_NO = A.INV_NO)
  AND C.AR_IF_NO = (SELECT DECODE(MAX(Z3.INV_DUP_FLG),'Y',SUBSTR(MAX(DECODE(Z2.REV_TP_CD, 'M', '1', '2')||Z1.AR_IF_NO), 2,11),MAX(Z1.AR_IF_NO))
                    FROM INV_AR_ISS_DTL Z1, INV_AR_MN Z2, INV_AR_STUP_OFC Z3 
                    WHERE Z1.AR_IF_NO = Z2.AR_IF_NO AND Z2.AR_OFC_CD = Z3.AR_OFC_CD(+) AND Z1.INV_NO = A.INV_NO)
  AND C.INV_DELT_DIV_CD <> 'Y'
  AND A.INV_NO = @[inv_no]
  AND ROWNUM = 1
ORDER BY A.INV_NO, C.AR_IF_NO DESC			]]></sql>
			<params>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="inv_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
