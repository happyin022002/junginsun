<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivableEDISendDBDAOSearchHPEDIMakefileRSQL">
			<desc><![CDATA[]]></desc>
			<sql><![CDATA[
SELECT RPAD('SMLM', 20, ' ')||RPAD('HP', 20, ' ')||RPAD('FREINV', 10, ' ')||'INV' AS HEADER
       , 'N' AS INV_TYPE --??
       , NVL(A.INV_NO, A.BL_SRC_NO) AS INV_NUM
       , A.BL_SRC_NO AS BL_NUM
       ,(SELECT DECODE(RATE.FRT_TERM_CD ,'P','PP','C','CC')
         FROM BKG_RATE RATE 
         WHERE  RATE.BKG_NO = A.BKG_NO )AS INV_PAY
        ,A.ISS_DT AS INV_DATE  --??
		,ROUND(NVL(SUM(C.CHG_AMT*C.INV_XCH_RT),0),2) AS INV_AMT
        ,NVL((SELECT NVL(MIN(TO_CHAR(MOV.CNMV_EVNT_DT,'YYYYMMDD')),'')  
            FROM CTM_MOVEMENT MOV
            WHERE MOV.BKG_NO(+) = A.BKG_NO
         --   AND   MOV.CNTR_NO(+) = :CNTR_NO
         --   AND   MOV.CNMV_CYC_NO(+) =:CNTR_MAX_CNMV_SEQ
            AND   MOV.MVMT_STS_CD (+) = 'ID' ),
			(SELECT TO_CHAR(VPS_ETA_DT,'YYYYMMDD') 
			   FROM VSK_VSL_PORT_SKD
              WHERE VSL_CD = A.TRNK_VSL_CD
  				AND SKD_VOY_NO = A.TRNK_SKD_VOY_NO
				AND SKD_DIR_CD = A.TRNK_SKD_DIR_CD
				AND VPS_PORT_CD = A.POD_CD
				AND CLPT_IND_SEQ = 1)) AS FINAL_ETA   ----??내용수정필요함.
        , (SELECT SUBSTR(CUST_REF_NO_CTNT,1,50) 
  		     FROM BKG_REFERENCE 
 			WHERE BKG_NO = A.BKG_NO
   			  AND BKG_REF_TP_CD = 'INCO'
			) AS INCO_TERM
        ,'SMLM' AS SCAC_CD
        ,'CO' AS COR_IND --??
        ,(SELECT TO_CHAR(MAX(CNTR.CGO_RCV_DT), 'YYYYMMDD') 
            FROM BKG_CONTAINER CNTR 
           WHERE CNTR.BKG_NO = A.BKG_NO ) AS CGO_RCV_DT
        ,(SELECT DECODE(BK.RCV_TERM_CD||BK.DE_TERM_CD, 'YY', 'PP', 'DY', 'DP', 'YD', 'PD', 'DD', 'DD') 
            FROM BKG_BOOKING BK WHERE BK.BKG_NO = A.BKG_NO)   AS TARIFF_SVC_CD
        ,(SELECT BKV.VSL_CD||BKV.SKD_VOY_NO||BKV.SKD_DIR_CD  
            FROM BKG_VVD BKV
           WHERE BKV.BKG_NO = A.BKG_NO AND BKV.VSL_PRE_PST_CD ='T' )  AS VVD
        ,( SELECT VC.LLOYD_NO 
          FROM  BKG_VVD BKV, MDM_VSL_CNTR VC
          WHERE BKV.BKG_NO = A.BKG_NO
          AND BKV.VSL_PRE_PST_CD ='T'
          AND BKV.VSL_CD =  VC.VSL_CD ) AS VSL_LLOYDCODE
        ,A.LOCL_CURR_CD AS CURRENCY_BILL_CD    --?? CHARGE 인지 LOCAL인지 확인필요함.
        ,A.BKG_NO --다른 SQL  변수로 사용
        ,A.AR_OFC_CD --다른 SQL  변수로 사용
        ,(SELECT SUBSTR(MAX(DECODE(MN.REV_TP_CD,'M','A','B')||MN.AR_IF_NO),2,11)
                       FROM INV_AR_MN MN
                      WHERE MN.BL_SRC_NO = A.BL_SRC_NO
                        AND MN.AR_OFC_CD = A.AR_OFC_CD
                        AND MN.INV_NO    = A.INV_NO
                        AND MN.INV_DELT_DIV_CD <> 'Y') AS MAX_IF_NO  --다른 SQL 변수로 사용
	   , DECODE((SELECT CONTI_CD FROM MDM_LOCATION WHERE LOC_CD = A.POR_CD),'E',
	               DECODE(SUBSTR(A.POD_CD,1,2), 'CZ', 'CZ680523179', 
				            DECODE(SUBSTR(A.DEL_CD,1,2),'CZ','CZ680523179', 
				                    DECODE((SELECT CONTI_CD FROM MDM_LOCATION WHERE LOC_CD = A.POL_CD),'E',
	                                       DECODE(SUBSTR(A.POD_CD,1,2), 'CZ', 'CZ680523179', 
				                                    DECODE(SUBSTR(A.DEL_CD,1,2),'CZ','CZ680523179','103760')),'103760'))),'103760') AS REF_4G                       
       ,'KR' AS REF_4L
       ,--(SELECT DECODE(A.IO_BND_CD, 'O', BKG.ORG_TRNS_MOD_CD ,'I',BKG.DEST_TRNS_MOD_CD )
         --FROM BKG_BOOKING BKG
         --WHERE BKG.BKG_NO = A.BKG_NO) 
         'O' AS REF_4M
	   , DECODE((SELECT ORG_TRNS_MOD_CD 
				   FROM BKG_BOOKING 
				  WHERE BKG_NO = A.BKG_NO), 'R', 'R', 'T', 'S', 'B','B','F','B','A','RS','U','BS','E','BS','') AS REF_V9_ORI
        , DECODE((SELECT DEST_TRNS_MOD_CD
				   FROM BKG_BOOKING 
				  WHERE BKG_NO = A.BKG_NO), 'R', 'R', 'T', 'S', 'B','B','F','B','A','RS','U','BS','E','BS','') AS REF_V9_DES
        ,DECODE(A.IO_BND_CD, 'O', 'O/B' ,'I','I/B' ) AS REF_8X
		,A.BL_SRC_NO AS REF_BM
        ,A.LOCL_CURR_CD AS REF_F2
        ,A.BL_SRC_NO AS REF_FR
		,MAX((SELECT DISTINCT 'SA' FROM INV_AR_CHG WHERE AR_IF_NO = A.AR_IF_NO AND CHG_CD IN ('DIV', 'ADF', 'DVC','BCC', 'BSF', 'MCF','ERC', 'EPS','DET','DMR','CLF','SOC', 'WTG', 'CUS', 'PRC'))) AS REF_PID 
        --,SUM(DECODE (C.TVA_FLG,'Y',C.CHG_AMT*C.INV_XCH_RT, 0)) AS REF_T2
		,ROUND(NVL(SUM(C.CHG_AMT*C.INV_XCH_RT),0),2) AS REF_T2
        ,(SELECT DECODE (CUST_CNT_CD||LPAD(TO_CHAR(CUST_SEQ),6,'0'),'NL004759','IPG' 
                                                                   ,'CZ002224','PSG'
                                                                   ,'NL001591','TSG'
                                                                   ,'GB018385','PSG'
                                                                   ,'DE000231','PSG'
                                                                   ,'CZ002340','PSG'
                                                                   ,'CZ001522','TSG'
                                                                   ,'NL005808','TSG'
                                                                   ,'NL005590','TSG')
                                                                   
 			FROM  BKG_CUSTOMER 
			WHERE BKG_NO = A.BKG_NO
  			AND BKG_CUST_TP_CD = 'C') AS REF_VC
        ,DECODE(A.SLS_OFC_CD, 'ANRSO', 'BE0877567908',
                              'FXTSC', '539041354',
                              'GOASC', '1680530993',
                              'LEHSC', 'FR46378429377',
                              'RTMSC', 'NL009634095B01',
                              'VLCSC', 'A-97671010',
							  'HAMSC', 'DE118623926',
							  'BUDSC', 'DE118623926',
							  'PRGSC', 'DE118623926',
							  'WRPSC', 'DE118623926',
                              'MXBBA', 'MEG050915FA0',
                              'TORSC', '83271 0867 RT0001',
                              'SELSC', '104-85-21890',
                              'PUSBS', '602-85-16741',
                              'PUSSC', '602-85-16741',
                              'TYOSC', '106041',
                              'OSASO', '106041',
                              'SINSC', 'M90361370G',
                              'BKKSC', '3032076159',
                              'SYDSC', 'ABN 19527041098',
                              'DACSC', '2011037128',
                              'MNLBA', '16-813-254-000','') AS REF_VX
        ,'ITEM OR CHARGE CHANGED' AS REF_8V
		,'EMEA' AS REF_ACB   
FROM INV_AR_ISS D,
     INV_AR_ISS_DTL B,
     INV_AR_CHG C,
     INV_AR_MN A
WHERE D.INV_NO =  @[inv_no] ----( 'HM1456359' ,'HM1457061' ) 
  AND D.INV_SEQ  = 1
  AND D.INV_NO  = B.INV_NO
  AND B.AR_IF_NO = C.AR_IF_NO
  AND B.CHG_SEQ  = C.CHG_SEQ
  AND B.AR_IF_NO = A.AR_IF_NO
GROUP BY A.INV_NO, A.BL_SRC_NO, A.BKG_NO, A.AR_OFC_CD, A.IO_BND_CD, A.SLS_OFC_CD, A.LOCL_CURR_CD, A.ISS_DT, A.POD_CD, A.DEL_CD, A.POR_CD, A.POL_CD
, A.TRNK_VSL_CD,  A.TRNK_SKD_VOY_NO, A.TRNK_SKD_DIR_CD			]]></sql>
			<params>
				<param name="inv_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
