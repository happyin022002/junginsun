<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SettlementProcessDBDAOSltHirTgtPageRSQL">
			<desc><![CDATA[정산 대상 페이지 개수 조회]]></desc>
			<sql><![CDATA[
SELECT
CEIL(COUNT(1)/TO_NUMBER(@[pagerows])) AS TOT_PAGE_CNT
FROM
(
				SELECT
			    	 A.REV_YRMON  
					,A.BSA_QTY
					,A.BSA_SLT_PRC
					,A.ACT_BSA_QTY
					,A.ACT_SLT_PRC
				FROM
				(
				SELECT J.REV_YRMON
					  ,J.BSA_QTY
					  ,J.BSA_SLT_PRC
					  ,J2.ACT_BSA_QTY
					  ,J2.ACT_SLT_PRC
				FROM ( SELECT J.*
					   FROM JOO_SLT_LIST J
					   WHERE 1=1
					   AND J.REV_YRMON BETWEEN REPLACE(@[rev_yrmon_fr],'-','') AND REPLACE(@[rev_yrmon_to],'-','')
					   #if (${re_divr_cd} != '')
					   AND J.ACCT_CD LIKE DECODE(@[re_divr_cd],'R','4','E','5')||'%'
					   #end
					   #if (${jo_crr_cd} != '')
					   AND J.CRR_CD = @[jo_crr_cd]
					   #end
					   #if (${trd_cd} != '')
					   AND J.TRD_CD    = @[trd_cd]
					   #end
					   #if (${rlane_cd} != '')
					   AND J.RLANE_CD  = @[rlane_cd]
					   #end
					   #if (${vvd} != '')
					   AND J.VSL_CD 	= substr(@[vvd],1,4) 
					   AND J.SKD_VOY_NO = substr(@[vvd],5,4)
					   AND J.SKD_DIR_CD = substr(@[vvd],9,1)
					   #end
					   #if (${acct_cd} != '')
					   AND J.ACCT_CD = @[acct_cd]
					   #end
					 ) J    
					 FULL OUTER JOIN 
					 ( SELECT J2.*, S.STL_LOCL_AMT
					   FROM JOO_SLT_TGT J2, JOO_STL_TGT S	--변경
					   WHERE 1=1
					   AND J2.REV_YRMON BETWEEN REPLACE(@[rev_yrmon_fr],'-','') AND REPLACE(@[rev_yrmon_to],'-','')					
					   #if (${re_divr_cd} != '')
					   AND J2.ACCT_CD LIKE DECODE(@[re_divr_cd],'R','4','E','5')||'%'
					   #end
					   #if (${jo_crr_cd} != '')
					   AND J2.CRR_CD = @[jo_crr_cd]
					   #end
					   #if (${trd_cd} != '')
					   AND J2.TRD_CD    = @[trd_cd]
					   #end
					   #if (${rlane_cd} != '')
					   AND J2.RLANE_CD  = @[rlane_cd]
					   #end
					   #if (${vvd} != '')
					   AND J2.VSL_CD 	= substr(@[vvd],1,4) 
					   AND J2.SKD_VOY_NO = substr(@[vvd],5,4)
					   AND J2.SKD_DIR_CD = substr(@[vvd],9,1)
					   #end
					   #if (${acct_cd} != '')
					   AND J2.ACCT_CD = @[acct_cd]
					   #end
					   AND J2.REV_YRMON = S.REV_YRMON(+)
					   AND J2.REV_YRMON_SEQ = S.REV_YRMON_SEQ(+)	                   	
					 ) J2
				ON ( J.TRD_CD    = J2.TRD_CD
				AND J.CRR_CD    = J2.CRR_CD
				AND J.RLANE_CD  = J2.RLANE_CD
				AND J.RE_DIVR_CD = J2.RE_DIVR_CD 
				AND J.VSL_CD     = J2.VSL_CD
				AND J.SKD_VOY_NO = J2.SKD_VOY_NO
				AND J.SKD_DIR_CD = J2.SKD_DIR_CD
				AND J.JO_STL_JB_CD = J2.JO_STL_JB_CD 
					)
			) A
			WHERE 1=1
			#if (${diff} != '')
			AND (NVL(A.BSA_QTY,0) != A.ACT_BSA_QTY OR NVL(A.BSA_SLT_PRC,0) != A.ACT_SLT_PRC)
			#end
)			]]></sql>
			<params>
				<param name="pagerows" type="12" value="" out="N"/>
				<param name="rev_yrmon_fr" type="12" value="" out="N"/>
				<param name="rev_yrmon_to" type="12" value="" out="N"/>
				<param name="re_divr_cd" type="12" value="" out="N"/>
				<param name="jo_crr_cd" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="acct_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
