<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CarrierSettlementProcessDBDAORobVvdListRSQL">
			<desc><![CDATA[ROB 컨테이너 조회시 ETD기준 VVD List를 조회]]></desc>
			<sql><![CDATA[
SELECT
 ROWNUM AS SEQ_NO
,AAAA.*
FROM
(
    SELECT
    AAA.*
    FROM
    (
SELECT
 MIN(AA.VVD || AA.VPS_ETD_DT) OVER (PARTITION BY AA.VVD) AS VVD_ETD_GROUP         
,AA.VVD
,AA.VSL_CD
,AA.SKD_VOY_NO
,AA.SKD_DIR_CD  
,AA.VPS_PORT_CD
,AA.TML_CD
,AA.SPLIT_NO
,AA.CLPT_SEQ
,AA.VPS_ETD_DT
,CASE WHEN V.RDR_FLG = 'Y' THEN 'R'
      WHEN V.RDR_FLG = 'N' THEN ''
      ELSE DECODE(AA.VPS_PORT_CD,H.PORT_CD,'R','')
      END AS RDR_FLG
FROM
(
		SELECT 
             (K.VSL_CD || K.SKD_VOY_NO || K.SKD_DIR_CD) AS VVD
            ,K.VSL_CD
            ,K.SKD_VOY_NO
            ,K.SKD_DIR_CD       
            ,SUBSTR(K.YD_CD,1,5) 	AS VPS_PORT_CD
            ,SUBSTR(K.YD_CD,6,2) 	AS TML_CD
            ,K.CLPT_IND_SEQ 		AS SPLIT_NO 
			,TO_CHAR(K.VPS_ETD_DT,'YYYYMMDDHH24MISS') AS VPS_ETD_DT
            ,K.CLPT_SEQ
            ,K.SLAN_CD            
            ,K.YD_CD 
        FROM VSK_VSL_PORT_SKD K
        WHERE 1=1   
        AND ( (K.VPS_ETD_DT BETWEEN TO_DATE (REPLACE (@[pre_fr],'-',''), 'YYYYMMDD')
                                AND TO_DATE (REPLACE (@[pre_to],'-',''), 'YYYYMMDD') + 0.99999) 
             OR K.VPS_ETD_DT IS NULL
            )             
       	AND K.SLAN_CD LIKE @[rlane_cd] || '%'    
		#if (${vvd} != '') 
		AND K.VSL_CD || K.SKD_VOY_NO || K.SKD_DIR_CD LIKE @[vvd] || '%' 
		#end
		#if (${skd_dir_cd} != '') 
		AND K.SKD_DIR_CD = @[skd_dir_cd]
		#end
        AND K.TURN_PORT_IND_CD NOT IN ('D','V','F')
        AND NVL(K.SKD_CNG_STS_CD, 'A') <>  'S'  
        ORDER BY VVD ASC, CLPT_SEQ ASC
) AA, RDR_HEADER H, JOO_RDR_PORT V
WHERE 1=1
AND AA.VSL_CD 		= H.VSL_CD(+)
AND AA.SKD_VOY_NO 	= H.VOY_NO(+)
AND AA.SKD_DIR_CD 	= H.DIR_CD(+)  
AND AA.VPS_PORT_CD 	= H.PORT_CD(+)
AND AA.VSL_CD       = V.VSL_CD(+)
AND AA.SKD_VOY_NO   = V.SKD_VOY_NO(+)
AND AA.SKD_DIR_CD   = V.SKD_DIR_CD(+)  
AND AA.VPS_PORT_CD  = V.VPS_PORT_CD(+)  
AND AA.SPLIT_NO     = V.CLPT_IND_SEQ(+)
AND AA.SLAN_CD      = V.SLAN_CD(+)
AND AA.YD_CD        = V.YD_CD(+)
#if (${rdr_flg} == 'R') 
AND DECODE(AA.VPS_PORT_CD,H.PORT_CD,'R','') = 'R'
#end
    ) AAA
    ORDER BY SUBSTR(VVD_ETD_GROUP, 10), VVD, VPS_ETD_DT, VPS_PORT_CD
) AAAA			]]></sql>
			<params>
				<param name="pre_fr" type="12" value="" out="N"/>
				<param name="pre_to" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
