<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CarrierSettlementProcessDBDAOStlDupChkRSQL">
			<desc><![CDATA[Settlement시 순수settlement만 Dup Check]]></desc>
			<sql><![CDATA[
SELECT 'Y' AS STL_DUP_FLG
FROM   DUAL
WHERE  EXISTS (
        SELECT 1 FROM (
         SELECT NVL(B.RVS_CMB_FLG,'N') AS RVS_CMB_FLG
         FROM   JOO_SETTLEMENT A,
                --2010.03.29 REVERSE된 DATA는 DUP CHK에서 제외함
                (
                SELECT
                       B.ACCT_YRMON
                      ,B.STL_VVD_SEQ
                      ,B.STL_SEQ
                      ,A.RVS_CMB_FLG
                FROM   JOO_STL_CMB     A,
                       JOO_STL_CMB_DTL B
                WHERE  A.ACCT_YRMON  = B.ACCT_YRMON
                AND    A.JO_CRR_CD   = B.JO_CRR_CD
                AND    A.STL_CMB_SEQ = B.STL_CMB_SEQ
                AND    A.RE_DIVR_CD  = B.RE_DIVR_CD
                AND    A.ACCT_YRMON  = REPLACE(@[acct_yrmon],'-','')
                AND    A.JO_CRR_CD   = @[jo_crr_cd]
                AND    A.RE_DIVR_CD  = @[re_divr_cd]
                ) B
         WHERE  A.ACCT_YRMON    = B.ACCT_YRMON (+)
         AND    A.STL_VVD_SEQ   = B.STL_VVD_SEQ(+)
         AND    A.STL_SEQ       = B.STL_SEQ    (+)
         AND    A.ACCT_YRMON    = REPLACE(@[acct_yrmon],'-','')
         AND    A.JO_CRR_CD     = @[jo_crr_cd]
         AND    A.RE_DIVR_CD    = @[re_divr_cd]
         AND    A.TRD_CD        = @[trd_cd]
         AND    A.RLANE_CD      = @[rlane_cd]
         AND    A.JO_STL_ITM_CD = @[jo_stl_itm_cd]
         AND    A.JO_MNU_NM     = @[jo_mnu_nm]
         AND    A.VSL_CD        = @[vsl_cd]
         AND    A.SKD_VOY_NO    = @[skd_voy_no]
         AND    A.SKD_DIR_CD    = @[skd_dir_cd]
         AND    A.REV_DIR_CD    = @[rev_dir_cd]
#if (${jo_stl_itm_cd} == 'R/F' && ${jo_mnu_nm} == 'R/F')
         AND    A.IOC_CD          = @[ioc_cd]
         AND    A.SCONTI_CD       = @[sconti_cd]
         AND    A.FM_PORT_CD      = @[fm_port_cd]
         AND    A.TO_PORT_CD      = @[to_port_cd]
         AND    A.USD_SLT_BSA_QTY = TO_NUMBER(@[usd_slt_bsa_qty])
         AND    A.STL_LOCL_AMT    = TO_NUMBER(@[stl_locl_amt])
#elseif (${jo_stl_itm_cd} == 'S/H' && ${jo_mnu_nm} == 'S/H')
         AND    A.JO_STL_JB_CD  = @[jo_stl_jb_cd]
         AND    A.BSA_QTY       = TO_NUMBER(@[bsa_qty])
         AND    A.STL_LOCL_AMT  = TO_NUMBER(@[stl_locl_amt])
#elseif (${jo_stl_itm_cd} == 'OUS' && ${jo_mnu_nm} == 'RDR')
         AND    A.IOC_CD          = @[ioc_cd]
         AND    A.SCONTI_CD       = @[sconti_cd]
         AND    A.USD_SLT_BSA_QTY = TO_NUMBER(@[usd_slt_bsa_qty])
         AND    A.USD_SLT_WGT     = TO_NUMBER(@[usd_slt_wgt])
         AND    A.STL_LOCL_AMT    = TO_NUMBER(@[stl_locl_amt])
#elseif (${jo_stl_itm_cd} == 'OUS' && ${jo_mnu_nm} == 'TDR')
         AND    A.FM_PORT_CD      = @[fm_port_cd]
         AND    A.TO_PORT_CD      = @[to_port_cd]
         AND    A.USD_SLT_BSA_QTY = TO_NUMBER(@[usd_slt_bsa_qty])
         AND    A.USD_SLT_WGT     = TO_NUMBER(@[usd_slt_wgt])
         AND    A.STL_LOCL_AMT    = TO_NUMBER(@[stl_locl_amt])
#elseif (${jo_stl_itm_cd} == 'S/H' && ${jo_mnu_nm} == 'M/S')
         AND    A.JO_STL_JB_CD  = @[jo_stl_jb_cd]
         AND    A.BSA_QTY       = TO_NUMBER(@[bsa_qty])
         AND    A.STL_LOCL_AMT  = TO_NUMBER(@[stl_locl_amt])
#elseif ((${jo_stl_itm_cd} == 'OUS' ||${jo_stl_itm_cd} == 'R/F') && ${jo_mnu_nm} == 'M/S')
         AND    A.BSA_QTY       = TO_NUMBER(@[bsa_qty])
         AND    A.STL_LOCL_AMT  = TO_NUMBER(@[stl_locl_amt])
#elseif (${jo_stl_itm_cd} == 'OTH' && ${jo_mnu_nm} == 'M/S')
#else
         AND    A.STL_LOCL_AMT  = TO_NUMBER(@[stl_locl_amt])
#end
         )
   WHERE RVS_CMB_FLG = 'N'
)			]]></sql>
			<params>
				<param name="acct_yrmon" type="12" value="" out="N"/>
				<param name="jo_crr_cd" type="12" value="" out="N"/>
				<param name="re_divr_cd" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="jo_stl_itm_cd" type="12" value="" out="N"/>
				<param name="jo_mnu_nm" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="rev_dir_cd" type="12" value="" out="N"/>
				<param name="ioc_cd" type="12" value="" out="N"/>
				<param name="sconti_cd" type="12" value="" out="N"/>
				<param name="fm_port_cd" type="12" value="" out="N"/>
				<param name="to_port_cd" type="12" value="" out="N"/>
				<param name="usd_slt_bsa_qty" type="12" value="" out="N"/>
				<param name="stl_locl_amt" type="12" value="" out="N"/>
				<param name="jo_stl_jb_cd" type="12" value="" out="N"/>
				<param name="bsa_qty" type="12" value="" out="N"/>
				<param name="usd_slt_wgt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
