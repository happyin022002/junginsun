<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TonnageTaxStandardProfitConclusionDBDAOErpIFByMonthlyStatusVORSQL">
			<desc><![CDATA[ERP I/F(Montly) status 조회]]></desc>
			<sql><![CDATA[
SELECT 
  CASE WHEN COUNT(A.CFM_FLG) = 0 THEN
     'Completed'
  ELSE
     'Processing'
  END                                                       STATUS

FROM 
(SELECT CFM_FLG
  FROM (      
          SELECT X.TRD_CD
                ,X.CODE             TONG_ITM_CD
                ,NVL(Y.CFM_FLG,'N') CFM_FLG
                ,X.SEQ
          FROM   (
                  SELECT *
                  FROM   (
                          SELECT 1 AS SEQ, 'NRT' CODE
                          FROM    DUAL
                          UNION
                          SELECT 3 AS SEQ, 'USE' CODE
                          FROM    DUAL
                          UNION
                          SELECT 2 AS SEQ, 'DYS' CODE
                          FROM    DUAL
                  ) A, 
                  (
                    SELECT TRD_CD
                    FROM ( 
                          SELECT DISTINCT(TRD_CD) TRD_CD
                          FROM TOT_PORT_STL_AMT
                          WHERE STL_YRMON = @[stl_yrmon]
                            AND TONG_STL_BAT_JB_SEQ = (SELECT MAX(TONG_STL_BAT_JB_SEQ) FROM TOT_PORT_STL_AMT WHERE STL_YRMON = @[stl_yrmon])
                          ORDER BY TRD_CD  
                          )                    
                  ) B
          ) X,
          (SELECT  TRD_CD
               ,   TONG_ITM_CD
               ,   CFM_FLG
           FROM TOT_STL_CFM 
           WHERE TONG_STL_BAT_JB_SEQ = (SELECT MAX(TONG_STL_BAT_JB_SEQ) FROM TOT_STL_CFM WHERE STL_YRMON = @[stl_yrmon])
             AND STL_YRMON = @[stl_yrmon]
           ) Y 
          WHERE X.CODE = Y.TONG_ITM_CD(+)
          AND   X.TRD_CD = Y.TRD_CD(+)        
    )
 ) A
WHERE A.CFM_FLG ='N'			]]></sql>
			<params>
				<param name="stl_yrmon" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
