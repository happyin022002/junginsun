<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ARInvoiceCorrectionDBDAOSearchInvoiceMainForExrateListRSQL">
			<desc><![CDATA[]]></desc>
			<sql><![CDATA[
#if (${run_opt} == 'N')
SELECT MN.AR_IF_NO,
       MN.INV_CUST_CNT_CD,  
       MN.INV_CUST_SEQ, 
       MN.AR_OFC_CD, 
       MN.LOCL_CURR_CD,
       MN.SAIL_DT,  
       MN.VSL_CD, 
       MN.SKD_VOY_NO, 
       MN.SKD_DIR_CD, 
       MN.IO_BND_CD, 
       MN.POL_CD, 
       MN.POD_CD,
       MN.BKG_NO, 
       MN.INV_SVC_SCP_CD SVC_SCP_CD,
	   MN.BL_INV_CFM_DT,
       'N' ISS_FLG,
       MN.ACT_CUST_CNT_CD,
       MN.ACT_CUST_SEQ,
       MN.SAIL_ARR_DT,
       MN.REV_TP_CD,
       MN.REV_SRC_CD,
       MN.BL_SRC_NO
  FROM INV_AR_MN MN
 WHERE MN.AR_OFC_CD IN (
				#foreach( $an_ofc in ${ofc_cd_list} )
					#if($velocityCount < $ofc_cd_list.size()) '$an_ofc', #else '$an_ofc' #end
				#end
				)   
   AND MN.BL_INV_IF_DT BETWEEN REPLACE(@[fm_if_dt],'-','') AND REPLACE(@[to_if_dt],'-','')
   AND NVL(MN.INV_DELT_DIV_CD,'N') <> 'Y'
   AND MN.BL_INV_CFM_DT IS NULL
  

#elseif (${run_opt} == 'V')

SELECT MN.AR_IF_NO,
       MN.INV_CUST_CNT_CD,  
       MN.INV_CUST_SEQ, 
       MN.AR_OFC_CD, 
       MN.LOCL_CURR_CD,
       MN.SAIL_DT,  
       MN.VSL_CD, 
       MN.SKD_VOY_NO, 
       MN.SKD_DIR_CD, 
       MN.IO_BND_CD, 
       MN.POL_CD, 
       MN.POD_CD,
       MN.BKG_NO, 
       MN.INV_SVC_SCP_CD SVC_SCP_CD,
       MN.BL_INV_CFM_DT,
       NVL(MN.INV_ISS_FLG,'N') ISS_FLG,
       MN.ACT_CUST_CNT_CD,
       MN.ACT_CUST_SEQ,
       MN.SAIL_ARR_DT,
	   MN.REV_TP_CD,
       MN.REV_SRC_CD,
       MN.BL_SRC_NO,
       OFC.OTS_SMRY_CD,
	   OFC.DMDT_AR_INV_ISS_FLG,
	   MN.INV_CLR_FLG     
  FROM INV_AR_MN MN,
       INV_AR_STUP_OFC OFC
 WHERE MN.AR_OFC_CD IN (
				#foreach( $an_ofc in ${ofc_cd_list} )
					#if($velocityCount < $ofc_cd_list.size()) '$an_ofc', #else '$an_ofc' #end
				#end
				)   
   AND MN.VSL_CD = SUBSTR(@[vvd],1,4)
   AND MN.SKD_VOY_NO= SUBSTR(@[vvd],5,4)
   AND MN.SKD_DIR_CD = SUBSTR(@[vvd],9,1)
   AND MN.AR_OFC_CD = OFC.AR_OFC_CD
   --AND NVL(MN.INV_CLR_FLG,'N') ='N'
   AND MN.XCH_RT_USD_TP_CD ='V'
   AND NVL(MN.INV_DELT_DIV_CD,'N') <> 'Y'
   AND EXISTS (SELECT 'X' 
               FROM INV_VVD_XCH_RT VVD, INV_AR_CHG CHG2
               WHERE VVD.VSL_CD     = MN.VSL_CD
               AND   VVD.SKD_VOY_NO = MN.SKD_VOY_NO
               AND   VVD.SKD_DIR_CD = MN.SKD_DIR_CD
               AND   VVD.IO_BND_CD  = MN.IO_BND_CD
               AND   VVD.PORT_CD    = DECODE(MN.IO_BND_CD,'O',MN.POL_CD,MN.POD_CD)
               AND   VVD.SVC_SCP_CD   = MN.INV_SVC_SCP_CD
               AND   VVD.LOCL_CURR_CD = MN.LOCL_CURR_CD
               AND   MN.AR_IF_NO = CHG2.AR_IF_NO
               AND   VVD.CHG_CURR_CD  = CHG2.CURR_CD
               AND   VVD.INV_XCH_RT <> NVL(CHG2.INV_XCH_RT,0)
               AND   VVD.INV_XCH_RT <> 0 )
#if (${io_bnd_cd} != '')
   AND MN.IO_BND_CD= @[io_bnd_cd]
#end
 UNION
SELECT MN.AR_IF_NO,
       MN.INV_CUST_CNT_CD,  
       MN.INV_CUST_SEQ, 
       MN.AR_OFC_CD, 
       MN.LOCL_CURR_CD,
       MN.SAIL_DT,  
       MN.VSL_CD, 
       MN.SKD_VOY_NO, 
       MN.SKD_DIR_CD, 
       MN.IO_BND_CD, 
       MN.POL_CD, 
       MN.POD_CD,
       MN.BKG_NO, 
       MN.INV_SVC_SCP_CD SVC_SCP_CD,
       MN.BL_INV_CFM_DT,
       NVL(MN.INV_ISS_FLG,'N') ISS_FLG,
       MN.ACT_CUST_CNT_CD,
       MN.ACT_CUST_SEQ,
       MN.SAIL_ARR_DT,
	   MN.REV_TP_CD,
       MN.REV_SRC_CD,
       MN.BL_SRC_NO,
	   OFC.OTS_SMRY_CD,
	   OFC.DMDT_AR_INV_ISS_FLG,
	   MN.INV_CLR_FLG      
  FROM INV_AR_MN MN,
       INV_AR_STUP_OFC OFC
 WHERE MN.AR_OFC_CD IN (
				#foreach( $an_ofc in ${ofc_cd_list} )
					#if($velocityCount < $ofc_cd_list.size()) '$an_ofc', #else '$an_ofc' #end
				#end
				)   
   AND MN.VSL_CD = SUBSTR(@[vvd],1,4)
   AND MN.SKD_VOY_NO= SUBSTR(@[vvd],5,4)
   AND MN.SKD_DIR_CD = SUBSTR(@[vvd],9,1)
   AND MN.AR_OFC_CD = OFC.AR_OFC_CD
   --AND NVL(MN.INV_CLR_FLG,'N') ='N'
   AND MN.XCH_RT_USD_TP_CD ='V'
   AND NVL(MN.INV_DELT_DIV_CD,'N') <> 'Y'
   AND EXISTS (SELECT 'X' 
               FROM INV_VVD_XCH_RT VVD
               WHERE VVD.VSL_CD     = MN.VSL_CD
               AND   VVD.SKD_VOY_NO = MN.SKD_VOY_NO
               AND   VVD.SKD_DIR_CD = MN.SKD_DIR_CD
               AND   VVD.IO_BND_CD  = MN.IO_BND_CD
               AND   VVD.PORT_CD    = DECODE(MN.IO_BND_CD,'O',MN.POL_CD,MN.POD_CD)
               AND   VVD.SVC_SCP_CD   = MN.INV_SVC_SCP_CD
               AND   VVD.LOCL_CURR_CD = MN.LOCL_CURR_CD
               AND   VVD.CHG_CURR_CD  = 'USD'
               AND   VVD.INV_XCH_RT <> NVL(MN.USD_XCH_RT,0)
               AND   VVD.INV_XCH_RT <> 0 )
#if (${io_bnd_cd} != '')
   AND MN.IO_BND_CD= @[io_bnd_cd]
#end

#elseif  (${run_opt} == 'C')
SELECT MN.AR_IF_NO,
       MN.INV_CUST_CNT_CD,  
       MN.INV_CUST_SEQ, 
       MN.AR_OFC_CD, 
       MN.LOCL_CURR_CD,
       MN.SAIL_DT,  
       MN.VSL_CD, 
       MN.SKD_VOY_NO, 
       MN.SKD_DIR_CD, 
       MN.IO_BND_CD, 
       MN.POL_CD, 
       MN.POD_CD,
       MN.BKG_NO, 
       MN.INV_SVC_SCP_CD SVC_SCP_CD,
       MN.BL_INV_CFM_DT,
       NVL(MN.INV_ISS_FLG,'N') ISS_FLG,
       MN.ACT_CUST_CNT_CD,
       MN.ACT_CUST_SEQ,
       MN.SAIL_ARR_DT,
       MN.REV_TP_CD,
       MN.REV_SRC_CD,
       MN.BL_SRC_NO,
	   OFC.OTS_SMRY_CD,
	   OFC.DMDT_AR_INV_ISS_FLG,
	   MN.INV_CLR_FLG           
  FROM INV_AR_MN MN,
       INV_AR_STUP_OFC OFC,
	   MDM_CR_CUST CU,
       BKG_BOOKING BO,
       BKG_BL_DOC BK,
       BKG_RATE RT
 WHERE MN.AR_OFC_CD IN (
				#foreach( $an_ofc in ${ofc_cd_list} )
					#if($velocityCount < $ofc_cd_list.size()) '$an_ofc', #else '$an_ofc' #end
				#end
				)   
   AND MN.INV_CUST_CNT_CD = @[inv_cust_cnt_cd]
   AND MN.INV_CUST_SEQ= @[inv_cust_seq]
   AND MN.AR_OFC_CD = OFC.AR_OFC_CD
   AND MN.INV_CUST_CNT_CD = CU.CUST_CNT_CD
   AND MN.INV_CUST_SEQ = CU.CUST_SEQ
   AND MN.BL_SRC_NO = BO.BL_NO(+)
   AND BO.BKG_NO = BK.BKG_NO(+)
   AND BO.BKG_NO = RT.BKG_NO(+)
   AND NVL(MN.INV_DELT_DIV_CD,'N') <> 'Y'
   AND MN.XCH_RT_USD_TP_CD ='I'
   AND DECODE(CU.CNG_INDIV_CD, 'B', TO_CHAR(BK.BL_OBRD_DT,'YYYYMMDD'), 'C', TO_CHAR(RT.RT_APLY_DT,'YYYYMMDD'), 'O', MN.SAIL_DT, MN.SAIL_ARR_DT ) BETWEEN REPLACE(@[fm_if_dt],'-','') AND REPLACE(@[to_if_dt],'-','') 
   AND (EXISTS (SELECT 'X' 
               FROM INV_CUST_AND_DLY_XCH_RT CUST, INV_AR_CHG CHG2
               WHERE CUST.CUST_CNT_CD = MN.INV_CUST_CNT_CD
               AND   CUST.CUST_SEQ     = MN.INV_CUST_SEQ
               AND   CUST.IO_BND_CD   = MN.IO_BND_CD
               AND	 XCH_RT_TP_CD = 'I'
               AND   DECODE(CU.CNG_INDIV_CD, 'B', TO_CHAR(BK.BL_OBRD_DT,'YYYYMMDD'), 'C', TO_CHAR(RT.RT_APLY_DT,'YYYYMMDD'), 'O', MN.SAIL_DT, MN.SAIL_ARR_DT ) between FM_DT and TO_DT
               AND   CUST.LOCL_CURR_CD = MN.LOCL_CURR_CD
               AND   MN.AR_IF_NO = CHG2.AR_IF_NO
               AND   CUST.CHG_CURR_CD  = CHG2.CURR_CD
               AND   CUST.INV_XCH_RT <> NVL(CHG2.INV_XCH_RT,0)
               AND   CUST.INV_XCH_RT <> 0 )
	OR EXISTS (SELECT 'X' 
               FROM INV_CUST_AND_DLY_XCH_RT CUST
               WHERE CUST.CUST_CNT_CD = MN.INV_CUST_CNT_CD
               AND   CUST.CUST_SEQ     = MN.INV_CUST_SEQ
               AND   CUST.IO_BND_CD   = MN.IO_BND_CD
               AND	 XCH_RT_TP_CD = 'I'
               AND   DECODE(CU.CNG_INDIV_CD, 'B', TO_CHAR(BK.BL_OBRD_DT,'YYYYMMDD'), 'C', TO_CHAR(RT.RT_APLY_DT,'YYYYMMDD'), 'O', MN.SAIL_DT, MN.SAIL_ARR_DT ) between FM_DT and TO_DT
               AND   CUST.LOCL_CURR_CD = MN.LOCL_CURR_CD
               AND   CUST.CHG_CURR_CD  = 'USD'
               AND   CUST.INV_XCH_RT <> NVL(MN.USD_XCH_RT,0)
               AND   CUST.INV_XCH_RT <> 0 ))

#elseif  (${run_opt} == 'B')
SELECT MN.AR_IF_NO,
       MN.INV_CUST_CNT_CD,  
       MN.INV_CUST_SEQ, 
       MN.AR_OFC_CD, 
       MN.LOCL_CURR_CD,
       MN.SAIL_DT,  
       MN.VSL_CD, 
       MN.SKD_VOY_NO, 
       MN.SKD_DIR_CD, 
       MN.IO_BND_CD, 
       MN.POL_CD, 
       MN.POD_CD,
       MN.BKG_NO, 
       MN.INV_SVC_SCP_CD SVC_SCP_CD,
       MN.BL_INV_CFM_DT,
       NVL(MN.INV_ISS_FLG,'N') ISS_FLG,
       MN.ACT_CUST_CNT_CD,
       MN.ACT_CUST_SEQ,
       MN.SAIL_ARR_DT,
       MN.REV_TP_CD,
       MN.REV_SRC_CD,
       MN.BL_SRC_NO,
	   OFC.OTS_SMRY_CD,
	   OFC.DMDT_AR_INV_ISS_FLG,
	   MN.INV_CLR_FLG           
  FROM INV_AR_MN MN,
       INV_AR_STUP_OFC OFC
 WHERE MN.AR_OFC_CD IN (
				#foreach( $an_ofc in ${ofc_cd_list} )
					#if($velocityCount < $ofc_cd_list.size()) '$an_ofc', #else '$an_ofc' #end
				#end
				)   
   AND MN.BL_SRC_NO = @[bl_src_no]
   AND MN.AR_OFC_CD = OFC.AR_OFC_CD
   --AND NVL(MN.INV_CLR_FLG,'N') ='N'
   AND MN.XCH_RT_USD_TP_CD ='V'
   AND NVL(MN.INV_DELT_DIV_CD,'N') <> 'Y'
   AND EXISTS (SELECT 'X' 
               FROM INV_VVD_XCH_RT VVD, INV_AR_CHG CHG2
               WHERE VVD.VSL_CD     = MN.VSL_CD
               AND   VVD.SKD_VOY_NO = MN.SKD_VOY_NO
               AND   VVD.SKD_DIR_CD = MN.SKD_DIR_CD
               AND   VVD.IO_BND_CD  = MN.IO_BND_CD
               AND   VVD.PORT_CD    = DECODE(MN.IO_BND_CD,'O',MN.POL_CD,MN.POD_CD)
               AND   VVD.SVC_SCP_CD   = MN.INV_SVC_SCP_CD
               AND   VVD.LOCL_CURR_CD = MN.LOCL_CURR_CD
               AND   MN.AR_IF_NO = CHG2.AR_IF_NO
               AND   VVD.CHG_CURR_CD  = CHG2.CURR_CD
               AND  (( VVD.INV_XCH_RT <> NVL(CHG2.INV_XCH_RT,0) AND   VVD.INV_XCH_RT <> 0 ) OR NVL(CHG2.INV_XCH_RT,0) = 0))
 UNION
SELECT MN.AR_IF_NO,
       MN.INV_CUST_CNT_CD,  
       MN.INV_CUST_SEQ, 
       MN.AR_OFC_CD, 
       MN.LOCL_CURR_CD,
       MN.SAIL_DT,  
       MN.VSL_CD, 
       MN.SKD_VOY_NO, 
       MN.SKD_DIR_CD, 
       MN.IO_BND_CD, 
       MN.POL_CD, 
       MN.POD_CD,
       MN.BKG_NO, 
       MN.INV_SVC_SCP_CD SVC_SCP_CD,
       MN.BL_INV_CFM_DT,
       NVL(MN.INV_ISS_FLG,'N') ISS_FLG,
       MN.ACT_CUST_CNT_CD,
       MN.ACT_CUST_SEQ,
       MN.SAIL_ARR_DT,
	   MN.REV_TP_CD,
       MN.REV_SRC_CD,
       MN.BL_SRC_NO,
	   OFC.OTS_SMRY_CD,
	   OFC.DMDT_AR_INV_ISS_FLG,
	   MN.INV_CLR_FLG           
  FROM INV_AR_MN MN,
       INV_AR_STUP_OFC OFC
 WHERE MN.AR_OFC_CD IN (
				#foreach( $an_ofc in ${ofc_cd_list} )
					#if($velocityCount < $ofc_cd_list.size()) '$an_ofc', #else '$an_ofc' #end
				#end
				)  
   AND MN.BL_SRC_NO = @[bl_src_no]
   AND MN.AR_OFC_CD = OFC.AR_OFC_CD
   --AND NVL(MN.INV_CLR_FLG,'N') ='N'
   AND MN.XCH_RT_USD_TP_CD ='V'
   AND NVL(MN.INV_DELT_DIV_CD,'N') <> 'Y'
   AND EXISTS (SELECT 'X' 
               FROM INV_VVD_XCH_RT VVD
               WHERE VVD.VSL_CD     = MN.VSL_CD
               AND   VVD.SKD_VOY_NO = MN.SKD_VOY_NO
               AND   VVD.SKD_DIR_CD = MN.SKD_DIR_CD
               AND   VVD.IO_BND_CD  = MN.IO_BND_CD
               AND   VVD.PORT_CD    = DECODE(MN.IO_BND_CD,'O',MN.POL_CD,MN.POD_CD)
               AND   VVD.SVC_SCP_CD   = MN.INV_SVC_SCP_CD
               AND   VVD.LOCL_CURR_CD = MN.LOCL_CURR_CD
               AND   VVD.CHG_CURR_CD  = 'USD'
               AND   VVD.INV_XCH_RT <> NVL(MN.USD_XCH_RT,0)
               AND   VVD.INV_XCH_RT <> 0 )
 UNION
SELECT MN.AR_IF_NO,
       MN.INV_CUST_CNT_CD,  
       MN.INV_CUST_SEQ, 
       MN.AR_OFC_CD, 
       MN.LOCL_CURR_CD,
       MN.SAIL_DT,  
       MN.VSL_CD, 
       MN.SKD_VOY_NO, 
       MN.SKD_DIR_CD, 
       MN.IO_BND_CD, 
       MN.POL_CD, 
       MN.POD_CD,
       MN.BKG_NO, 
       MN.INV_SVC_SCP_CD SVC_SCP_CD,
       MN.BL_INV_CFM_DT,
       NVL(MN.INV_ISS_FLG,'N') ISS_FLG,
       MN.ACT_CUST_CNT_CD,
       MN.ACT_CUST_SEQ,
       MN.SAIL_ARR_DT,
       MN.REV_TP_CD,
       MN.REV_SRC_CD,
       MN.BL_SRC_NO,
	   OFC.OTS_SMRY_CD,
	   OFC.DMDT_AR_INV_ISS_FLG,
	   MN.INV_CLR_FLG           
  FROM INV_AR_MN MN,
       INV_AR_STUP_OFC OFC
 WHERE MN.AR_OFC_CD IN (
				#foreach( $an_ofc in ${ofc_cd_list} )
					#if($velocityCount < $ofc_cd_list.size()) '$an_ofc', #else '$an_ofc' #end
				#end
				)   
   AND MN.BL_SRC_NO = @[bl_src_no]
   AND MN.AR_OFC_CD = OFC.AR_OFC_CD
   --AND NVL(MN.INV_CLR_FLG,'N') ='N'
   AND NVL(MN.INV_DELT_DIV_CD,'N') <> 'Y'
   AND MN.XCH_RT_USD_TP_CD ='I'
   AND EXISTS (SELECT 'X' 
               FROM INV_CUST_AND_DLY_XCH_RT CUST, INV_AR_CHG CHG2
               WHERE CUST.CUST_CNT_CD = MN.INV_CUST_CNT_CD
               AND   CUST.CUST_SEQ     = MN.INV_CUST_SEQ
               AND   CUST.IO_BND_CD   = MN.IO_BND_CD
               AND	 XCH_RT_TP_CD = 'I'
               AND   MN.XCH_RT_DT BETWEEN FM_DT AND TO_DT
               AND   CUST.LOCL_CURR_CD = MN.LOCL_CURR_CD
               AND   MN.AR_IF_NO = CHG2.AR_IF_NO
               AND   CUST.CHG_CURR_CD  = CHG2.CURR_CD
               AND   CUST.INV_XCH_RT <> NVL(CHG2.INV_XCH_RT,0)
               AND   CUST.INV_XCH_RT <> 0 )
 UNION
SELECT MN.AR_IF_NO,
       MN.INV_CUST_CNT_CD,  
       MN.INV_CUST_SEQ, 
       MN.AR_OFC_CD, 
       MN.LOCL_CURR_CD,
       MN.SAIL_DT,  
       MN.VSL_CD, 
       MN.SKD_VOY_NO, 
       MN.SKD_DIR_CD, 
       MN.IO_BND_CD, 
       MN.POL_CD, 
       MN.POD_CD,
       MN.BKG_NO, 
       MN.INV_SVC_SCP_CD SVC_SCP_CD,
       MN.BL_INV_CFM_DT,
       NVL(MN.INV_ISS_FLG,'N') ISS_FLG,
       MN.ACT_CUST_CNT_CD,
       MN.ACT_CUST_SEQ,
       MN.SAIL_ARR_DT,
       MN.REV_TP_CD,
       MN.REV_SRC_CD,
       MN.BL_SRC_NO,
	   OFC.OTS_SMRY_CD,
	   OFC.DMDT_AR_INV_ISS_FLG,
	   MN.INV_CLR_FLG           
  FROM INV_AR_MN MN,
       INV_AR_STUP_OFC OFC
 WHERE MN.AR_OFC_CD IN (
				#foreach( $an_ofc in ${ofc_cd_list} )
					#if($velocityCount < $ofc_cd_list.size()) '$an_ofc', #else '$an_ofc' #end
				#end
				)   
   AND MN.BL_SRC_NO = @[bl_src_no]
   AND MN.AR_OFC_CD = OFC.AR_OFC_CD
   --AND NVL(MN.INV_CLR_FLG,'N') ='N'
   AND NVL(MN.INV_DELT_DIV_CD,'N') <> 'Y'
   AND MN.XCH_RT_USD_TP_CD ='I'
   AND EXISTS (SELECT 'X' 
               FROM INV_CUST_AND_DLY_XCH_RT CUST
               WHERE CUST.CUST_CNT_CD = MN.INV_CUST_CNT_CD
               AND   CUST.CUST_SEQ     = MN.INV_CUST_SEQ
               AND   CUST.IO_BND_CD   = MN.IO_BND_CD
               AND	 XCH_RT_TP_CD = 'I'
               AND   MN.XCH_RT_DT BETWEEN FM_DT AND TO_DT
               AND   CUST.LOCL_CURR_CD = MN.LOCL_CURR_CD
               AND   CUST.CHG_CURR_CD  = 'USD'
               AND   CUST.INV_XCH_RT <> NVL(MN.USD_XCH_RT,0)
               AND   CUST.INV_XCH_RT <> 0 )

#elseif (${run_opt} == 'O')

SELECT MN.AR_IF_NO,
       MN.INV_CUST_CNT_CD,  
       MN.INV_CUST_SEQ, 
       MN.AR_OFC_CD, 
       MN.LOCL_CURR_CD,
       MN.SAIL_DT,  
       MN.VSL_CD, 
       MN.SKD_VOY_NO, 
       MN.SKD_DIR_CD, 
       MN.IO_BND_CD, 
       MN.POL_CD, 
       MN.POD_CD,
       MN.BKG_NO, 
       MN.INV_SVC_SCP_CD SVC_SCP_CD,
       MN.BL_INV_CFM_DT,
       NVL(MN.INV_ISS_FLG,'N') ISS_FLG,
       MN.ACT_CUST_CNT_CD,
       MN.ACT_CUST_SEQ,
       MN.SAIL_ARR_DT,
       MN.REV_TP_CD,
       MN.REV_SRC_CD,
       MN.BL_SRC_NO,
       OFC.OTS_SMRY_CD,
       OFC.DMDT_AR_INV_ISS_FLG,
       MN.INV_CLR_FLG,
       MN.INV_DELT_DIV_CD 
  FROM INV_AR_MN MN,
       INV_AR_STUP_OFC OFC
 WHERE MN.AR_IF_NO IN ( SELECT MAX(MN.AR_IF_NO)
                          FROM INV_AR_MN MN,
                               MDM_CR_CUST CU,
                               BKG_BL_DOC BK
                         WHERE MN.AR_OFC_CD IN (
                                        #foreach( $an_ofc in ${ofc_cd_list} )
                                            #if($velocityCount < $ofc_cd_list.size()) '$an_ofc', #else '$an_ofc' #end
                                        #end
                                        )   
                           AND MN.INV_CUST_CNT_CD = @[inv_cust_cnt_cd]
                           AND MN.INV_CUST_SEQ= @[inv_cust_seq]
                           AND MN.INV_CUST_CNT_CD = CU.CUST_CNT_CD
                           AND MN.INV_CUST_SEQ = CU.CUST_SEQ
                           AND MN.BKG_NO = BK.BKG_NO
                           AND NVL(MN.INV_DELT_DIV_CD,'N') <> 'Y'
                           AND MN.XCH_RT_USD_TP_CD ='I'
                           AND MN.REV_TP_CD <> 'M'
                           AND CU.CNG_INDIV_CD = 'B'
                           AND BK.BL_OBRD_DT BETWEEN TO_DATE(REPLACE(@[fm_if_dt],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_if_dt],'-',''),'YYYYMMDD')
                         GROUP BY MN.AR_OFC_CD, MN.BL_SRC_NO
                       )
   AND MN.USD_XCH_RT = 0
   AND MN.AR_OFC_CD = OFC.AR_OFC_CD

#elseif (${run_opt} == 'P')

SELECT MN.AR_IF_NO,
       MN.INV_CUST_CNT_CD,  
       MN.INV_CUST_SEQ, 
       MN.AR_OFC_CD, 
       MN.LOCL_CURR_CD,
       MN.SAIL_DT,  
       MN.VSL_CD, 
       MN.SKD_VOY_NO, 
       MN.SKD_DIR_CD, 
       MN.IO_BND_CD, 
       MN.POL_CD, 
       MN.POD_CD,
       MN.BKG_NO, 
       MN.INV_SVC_SCP_CD SVC_SCP_CD,
       MN.BL_INV_CFM_DT,
       NVL(MN.INV_ISS_FLG,'N') ISS_FLG,
       MN.ACT_CUST_CNT_CD,
       MN.ACT_CUST_SEQ,
       MN.SAIL_ARR_DT,
       MN.REV_TP_CD,
       MN.REV_SRC_CD,
       MN.BL_SRC_NO
  FROM INV_AR_MN MN
 WHERE MN.AR_OFC_CD IN (
                         #foreach( $an_ofc in ${ofc_cd_list} )
                             #if($velocityCount < $ofc_cd_list.size()) '$an_ofc', #else '$an_ofc' #end
                         #end
                       )   
   AND MN.BL_INV_IF_DT BETWEEN REPLACE(@[fm_if_dt],'-','') AND REPLACE(@[to_if_dt],'-','')
   AND NVL(MN.INV_DELT_DIV_CD,'N') <> 'Y'
   AND MN.XCH_RT_USD_TP_CD IN ('C','P')
   AND MN.USD_XCH_RT = 0
   AND MN.INV_ISS_FLG <> 'Y'
   AND MN.INV_CLR_FLG <> 'Y'

#end			]]></sql>
			<params>
				<param name="fm_if_dt" type="12" value="" out="N"/>
				<param name="to_if_dt" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="inv_cust_cnt_cd" type="12" value="" out="N"/>
				<param name="inv_cust_seq" type="12" value="" out="N"/>
				<param name="bl_src_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
