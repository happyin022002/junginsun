<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ARInvoiceExRateMgtDBDAOSearchPortListByBndVORSQL">
			<desc><![CDATA[   [] ARInvoiceExRateMgtDBDAO::searchPortListByBnd ( searchByBndVo )
in: SearchVVDPortVO
out: VVDandPortListVO[]]]></desc>
			<sql><![CDATA[
SELECT 	@[io_bnd_cd] IO_BND_CD,
		B.VPS_PORT_CD VPS_PORT_CD, 
		NVL((A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD),(B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD)) VVD_CD ,
		A.SVC_SCP_CD SVC_SCP_CD,
		DECODE(@[io_bnd_cd],'O','ETD','ETA') ETDA_CD,
		DECODE(@[io_bnd_cd],'I',TO_CHAR(B.VPS_ETA_DT,'yyyymmdd'),to_char(B.VPS_ETD_DT,'yyyymmdd')) ETDA_DT,
		A.INV_XCH_RT INV_XCH_RT,--2010-01-09 ivs_xch_rt
	    B.CLPT_SEQ,
		B.SLAN_CD
FROM VSK_VSL_PORT_SKD B,INV_VVD_XCH_RT A
WHERE A.VSL_CD(+) = B.VSL_CD
AND A.SKD_VOY_NO(+) = B.SKD_VOY_NO
AND A.SKD_DIR_CD(+) = B.SKD_DIR_CD
AND A.PORT_CD(+) = B.VPS_PORT_CD
AND NVL(B.SKD_CNG_STS_CD,'N') <>'S'
AND A.IO_BND_CD(+) = @[io_bnd_cd]
AND A.LOCL_CURR_CD(+) = @[locl_curr_cd]
AND A.CHG_CURR_CD(+) = 'USD'
#if ((${vps_port_cd} != 'ALL') && (${vps_port_cd} != ''))
AND B.VPS_PORT_CD = @[vps_port_cd]
#end
#if (${svc_scp_cd} != 'ALL') 
AND A.SVC_SCP_CD=@[svc_scp_cd]
#end
#if (${opt_type} == 'V') 
    AND B.VSL_CD = substr(@[vvd_cd],0,4)
    AND B.SKD_VOY_NO  = substr(@[vvd_cd],5,4)
    AND B.SKD_DIR_CD = substr(@[vvd_cd],9,1)	
	AND (B.CLPT_IND_SEQ,B.VSL_CD,B.SKD_VOY_NO,B.SKD_DIR_CD,B.VPS_PORT_CD) in (
						SELECT MIN(CLPT_IND_SEQ) CLPT_IND_SEQ,VSL_CD,SKD_VOY_NO,SKD_DIR_CD,VPS_PORT_CD FROM VSK_VSL_PORT_SKD
						  WHERE VPS_PORT_CD  LIKE (SELECT SUBSTR(LOC_CD,1,2) FROM MDM_ORGANIZATION WHERE OFC_CD =@[ofc_cd])||'%'
						 GROUP BY VSL_CD,SKD_VOY_NO,SKD_DIR_CD,VPS_PORT_CD )
#end
#if (${io_bnd_cd} == 'I') 
	AND B.VPS_ETA_DT BETWEEN TO_DATE(@[etda_dt],'YYYYMMDD') AND TO_DATE(@[etda_dt],'YYYYMMDD') + 0.99999 --20100126 
#else
	AND B.VPS_ETD_DT BETWEEN TO_DATE(@[etda_dt],'YYYYMMDD') AND TO_DATE(@[etda_dt],'YYYYMMDD') + 0.99999 --20100126 
#end
	AND VPS_PORT_CD  LIKE (SELECT SUBSTR(LOC_CD,1,2) FROM MDM_ORGANIZATION WHERE OFC_CD =@[ofc_cd])||'%'			]]></sql>
			<params>
				<param name="io_bnd_cd" type="12" value="I" out="N"/>
				<param name="locl_curr_cd" type="12" value="" out="N"/>
				<param name="vps_port_cd" type="12" value="" out="N"/>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="asdasdas" out="N"/>
				<param name="ofc_cd" type="12" value="SELBB" out="N"/>
				<param name="etda_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
