<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ARInvoiceInquiryDBDAOSearchARInvoiceMainRSQL">
			<desc><![CDATA[DESC Enter..]]></desc>
			<sql><![CDATA[
SELECT DISTINCT A.AR_IF_NO,
  DECODE(A.INV_SPLIT_CD, 'M', NULL, A.INV_SPLIT_CD ) INV_SPLIT_CD,
  A.BL_SRC_NO,
  A.BKG_NO,
  A.AR_OFC_CD,
  A.ACT_CUST_CNT_CD,
  LPAD(A.ACT_CUST_SEQ, 6, '0') ACT_CUST_SEQ,
  C.CUST_LGL_ENG_NM,
  C.CUST_RGST_NO,
  A.INV_CUST_CNT_CD,
  LPAD(A.INV_CUST_SEQ, 6, '0') INV_CUST_SEQ,
  D.CR_CURR_CD,
  D.CR_AMT,
  D.IB_CR_TERM_DYS,
  D.OB_CR_TERM_DYS,
  D.CR_CLT_OFC_CD,
  A.VSL_CD||A.SKD_VOY_NO||SKD_DIR_CD VVD,
  A.SVC_SCP_CD,
  DECODE(A.IO_BND_CD, 'I', 'I/B', 'O/B') IO_BND_CD,
  TO_CHAR(TO_DATE(A.SAIL_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') SAIL_DT,
  TO_CHAR(TO_DATE(A.SAIL_ARR_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') SAIL_ARR_DT,
  A.TRNK_VSL_CD||A.TRNK_SKD_VOY_NO||A.TRNK_SKD_DIR_CD TRUNK_VVD,
  A.SLAN_CD,
  A.POR_CD,
  A.POL_CD,
  A.POD_CD,
  A.DEL_CD,
  A.BKG_CORR_NO,
  TO_CHAR(A.BKG_CORR_DT, 'YYYY-MM-DD') BKG_CORR_DT,
  A.HJS_STF_CTNT,
  A.INV_REF_NO,
  A.BKG_REF_NO,
  A.SI_REF_NO,
  A.INV_RMK,
  A.REV_TP_CD,
  A.REV_SRC_CD,
  A.MST_BL_NO,
  A.RFA_NO,
  A.SC_NO,
  A.SREP_CD,
  TRIM(TO_CHAR(ROUND(A.CGO_WGT, 3), '999,999,999,999,999,990.999')) CGO_WGT,
  TRIM(TO_CHAR(ROUND(A.CGO_MEAS_QTY, 3), '999,999,999,999,999,990.999')) CGO_MEAS_QTY,
  A.WHF_DECL_NO,
  TO_CHAR(TO_DATE(A.WHF_DECL_CFM_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') WHF_DECL_CFM_DT,
  A.BKG_TEU_QTY,
  A.BKG_FEU_QTY,
  TO_CHAR(TO_DATE(A.BL_INV_IF_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') BL_INV_IF_DT,
  TO_CHAR(TO_DATE(A.BL_INV_CFM_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') BL_INV_CFM_DT,
  TO_CHAR(TO_DATE(A.GL_EFF_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') GL_EFF_DT,
  DECODE(A.INV_CLR_FLG, 
         'Y', 
         'SYS CLEAR', 
         NVL(DECODE(A.AR_OFC_CD, 
                    'SGNSC', 
                    (SELECT DISTINCT INV_NO FROM INV_AR_ISS_DTL WHERE AR_IF_NO = A.AR_IF_NO AND INV_NO LIKE 'F%' AND ROWNUM = 1),  -- AR_OFC_CD가 SGNSC인 경우는 FRT인 INV정보만 조회한다. (2009-12-16)
                    (SELECT MAX(INV_NO) FROM INV_AR_ISS_DTL WHERE AR_IF_NO = A.AR_IF_NO AND ROWNUM = 1)), 
         A.INV_SRC_NO)) INV_NO,
  DECODE(A.AR_OFC_CD, 
         'SGNSC', 
         (SELECT DISTINCT TO_CHAR(TO_DATE(S2.ISS_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') FROM INV_AR_ISS_DTL S1, INV_AR_ISS S2 WHERE S1.AR_IF_NO = A.AR_IF_NO AND S1.INV_NO LIKE 'F%' AND S1.INV_NO = S2.INV_NO AND S2.INV_SEQ = 1), 
         (SELECT TO_CHAR(TO_DATE(MAX(S2.ISS_DT), 'YYYY-MM-DD'), 'YYYY-MM-DD') FROM INV_AR_ISS_DTL S1, INV_AR_ISS S2 WHERE S1.AR_IF_NO = A.AR_IF_NO AND S1.INV_NO = S2.INV_NO AND S2.INV_SEQ = 1)) ISS_DT,
  TO_CHAR(TO_DATE(A.DUE_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') DUE_DT,
  A.FRT_FWRD_CNT_CD,
  A.FRT_FWRD_CUST_SEQ,
  TO_CHAR(A.USD_XCH_RT, 'FM9,999,999,990.999990') USD_XCH_RT
FROM INV_AR_MN A,
  MDM_CUSTOMER C,
  MDM_CR_CUST D
WHERE A.ACT_CUST_CNT_CD = C.CUST_CNT_CD (+)
  AND A.ACT_CUST_SEQ = C.CUST_SEQ (+)
  AND A.ACT_CUST_CNT_CD = D.CUST_CNT_CD (+)
  AND A.ACT_CUST_SEQ = D.CUST_SEQ (+)
  AND A.AR_IF_NO = @[ar_if_no]
  AND A.AR_OFC_CD IN (
    SELECT OFC_CD
    FROM MDM_ORGANIZATION
    WHERE AR_HD_QTR_OFC_CD = (
        SELECT AR_HD_QTR_OFC_CD
        FROM MDM_ORGANIZATION
        WHERE OFC_CD = (
            SELECT AR_OFC_CD
            FROM MDM_ORGANIZATION
            WHERE OFC_CD = @[ofc_cd]))
      AND OFC_CD = AR_OFC_CD )
  AND NVL(A.INV_DELT_DIV_CD, 'N') <> 'Y'			]]></sql>
			<params>
				<param name="ar_if_no" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
