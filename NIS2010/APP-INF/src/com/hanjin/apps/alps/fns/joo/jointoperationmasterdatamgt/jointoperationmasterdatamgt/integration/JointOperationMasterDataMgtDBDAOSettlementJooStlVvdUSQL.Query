<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="JointOperationMasterDataMgtDBDAOSettlementJooStlVvdUSQL">
			<desc><![CDATA[Settlement시 JOO_STL_VVD의 PROC_JB_FLG를 Y로 update한다.
settlement취소시 settlement내 마지막 하나까지 삭제된 경우 joo_stl_vvd의 proc_jb_flg를 N으로 update한다.]]></desc>
			<sql><![CDATA[
UPDATE JOO_STL_VVD X
SET    X.PROC_JB_FLG = 
             NVL((
                SELECT /*+INDEX(A XPKJOO_SETTLEMENT)*/ 
                      'Y' 
                FROM  JOO_SETTLEMENT A 
                WHERE A.ACCT_YRMON  = X.ACCT_YRMON 
                AND   A.STL_VVD_SEQ = X.STL_VVD_SEQ 
                AND   ROWNUM = 1),'N')
      ,X.UPD_DT      = SYSDATE
      ,X.UPD_USR_ID  = @[upd_usr_id]
WHERE X.ACCT_YRMON = REPLACE(@[acct_yrmon],'-','')
AND   X.STL_VVD_SEQ = @[stl_vvd_seq]
AND   NVL(X.PROC_JB_FLG,'N') !=
             NVL((
                SELECT /*+INDEX(A XPKJOO_SETTLEMENT)*/ 
                      'Y' 
                FROM  JOO_SETTLEMENT A 
                WHERE A.ACCT_YRMON  = X.ACCT_YRMON 
                AND   A.STL_VVD_SEQ = X.STL_VVD_SEQ 
                AND   ROWNUM = 1),'N')
			]]></sql>
			<params>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="acct_yrmon" type="12" value="" out="N"/>
				<param name="stl_vvd_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
