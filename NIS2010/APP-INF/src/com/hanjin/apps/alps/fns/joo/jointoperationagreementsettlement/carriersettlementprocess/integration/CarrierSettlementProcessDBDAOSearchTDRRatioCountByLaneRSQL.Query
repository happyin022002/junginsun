<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CarrierSettlementProcessDBDAOSearchTDRRatioCountByLaneRSQL">
			<desc><![CDATA[SearchTDRRatioCountByLane
1. Ticket No  : CHM-201322276
   개발자 : 이수진
   Ticket Title : [ALPS JOO] 모델링 표준에 맞게 처리 되도록 테이블 칼럼 변경 작업 및 기능 변경
   Description  :  JO_REP_CRR_CD_FLG => JO_REP_CRR_FLG으로 컬럼명 변경 작업]]></desc>
			<sql><![CDATA[
SELECT COUNT(*) CARRIER_CNT
FROM
(
       SELECT DISTINCT NVL(B.OPR_CD, 'ZZZ') OPR_CD,
              K.SLAN_CD
         FROM BAY_PLAN B,
              VSK_VSL_PORT_SKD K
        WHERE ( (K.VPS_ETD_DT BETWEEN TO_DATE (REPLACE (@[pre_fr], '-', ''), 'YYYYMMDD')
                         AND TO_DATE (REPLACE (@[pre_to], '-', ''), 'YYYYMMDD') + 0.99999) OR K.VPS_ETD_DT IS NULL)
          AND K.VSL_CD       = B.VSL_CD
          AND K.SKD_VOY_NO   = B.VOY_NO
          AND K.SKD_DIR_CD   = B.DIR_CD
          AND K.VPS_PORT_CD  = B.PORT_CD
          AND K.CLPT_IND_SEQ = B.CALL_IND
          AND B.PLAN_TYPE    = 'F'
          AND K.SLAN_CD LIKE @[rlane_cd] || '%'
          AND K.TURN_PORT_IND_CD NOT IN ('D', 'V', 'F')
) A, JOO_TDR_RTO B
WHERE A.SLAN_CD = B.RLANE_CD(+)
  AND A.OPR_CD = B.JO_CRR_CD(+)

#if(${opr_cd} !='')
       AND B.JO_CRR_CD IN (${opr_cd})
#end

  AND NVL(B.JO_REP_CRR_FLG, 'N') = 'Y'			]]></sql>
			<params>
				<param name="pre_fr" type="12" value="" out="N"/>
				<param name="pre_to" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
