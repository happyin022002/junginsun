<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivableEDISendDBDAOSearchSamsungEDIByBLRSQL">
			<desc><![CDATA[DESC Enter..]]></desc>
			<sql><![CDATA[
SELECT TB.BL_SRC_NO,												
(   SELECT CUST_REF_NO_CTNT 
  FROM BKG_REFERENCE
 WHERE BKG_NO = TB.BKG_NO
   AND BKG_REF_TP_CD ='ESRF'
   AND ROWNUM = 1 ) SR_INV_NO, 
  MAX(TB.CNTR_NO) CNTR_NO,												
  TB.POR_CD,												
  TB.POL_CD,												
  TB.POD_CD,												
  TB.DEL_CD,												
  (												
    SELECT SUM(RAT_AS_QTY)												
    FROM BKG_CHG_RT												
    WHERE BKG_NO = TB.BKG_NO												
      AND CHG_CD ='OFT'												
      AND CURR_CD = 'USD'												
      AND RAT_UT_CD IN ('D2', '20') ) INV_EDI_D2_QTY,												
  (												
    SELECT SUM(RAT_AS_QTY)												
    FROM BKG_CHG_RT												
    WHERE BKG_NO = TB.BKG_NO												
      AND CHG_CD ='OFT'												
      AND CURR_CD = 'USD'												
      AND RAT_UT_CD IN ('D4', '40') ) INV_EDI_D4_QTY,												
  (												
    SELECT SUM(RAT_AS_QTY)												
    FROM BKG_CHG_RT												
    WHERE BKG_NO = TB.BKG_NO												
      AND CHG_CD ='OFT'												
      AND CURR_CD = 'USD'												
      AND RAT_UT_CD = 'D5' ) INV_EDI_D5_QTY,												
  (												
    SELECT SUM(RAT_AS_QTY)												
    FROM BKG_CHG_RT												
    WHERE BKG_NO = TB.BKG_NO												
      AND CHG_CD ='OFT'												
      AND CURR_CD = 'USD'												
      AND RAT_UT_CD IN ('D7', '45') ) INV_EDI_D7_QTY,												
  (												
    SELECT SUM(RAT_AS_QTY)												
    FROM BKG_CHG_RT												
    WHERE BKG_NO = TB.BKG_NO												
      AND CHG_CD ='OFT'												
      AND CURR_CD = 'USD'												
      AND RAT_UT_CD NOT IN ('D2', '20', 'D4', '40', 'D5', 'D7', '45') ) INV_EDI_ETC_QTY,												
  TB.GRS_CNTR_WGT,												
  TB.GRS_CBM_CAPA,												
  SUM(TB.OFT_AMT) OFT_AMT,												
  SUM(TB.CMS_AMT) CMS_AMT,												
  SUM(TB.THC_AMT) THC_AMT,												
  SUM(TB.DHF_AMT) DHF_AMT,												
  SUM(TB.WHF_AMT) WHF_AMT,												
  SUM(TB.OTR_AMT) OTR_AMT,												
  --SUM(TB.CFR_AMT) CFR_AMT, -- 항목에서 삭제												
  --SUM(TB.BAF_AMT) BAF_AMT, -- 항목에서 삭제												
  SUM(TB.SLF_AMT) SLF_AMT,   -- 2011.05.23 추가												
  SUM(TB.OTH_AMT) OTH_AMT												
FROM(												
    SELECT A.BL_SRC_NO,												
      rtrim(XMLAGG(XMLELEMENT(C, CNTR_NO, '|') ORDER BY A.BL_SRC_NO, C.CNTR_NO).EXTRACT( '//text()'), '|') CNTR_NO,												
      A.BKG_NO,												
      A.POR_CD,												
      A.POL_CD,												
      A.POD_CD,												
      A.DEL_CD,												
      ROUND(A.CGO_WGT, 3) GRS_CNTR_WGT,												
      ROUND(A.CGO_MEAS_QTY, 3) GRS_CBM_CAPA,												
      SUM(DECODE(B.CHG_CD, 'OFT', DECODE(B.CURR_CD, 'USD', B.CHG_AMT, 0), 0)) OFT_AMT,												
      SUM(DECODE(B.CHG_CD, 'CMS', DECODE(B.CURR_CD, 'USD', B.CHG_AMT, 0), 0)) CMS_AMT,												
      SUM(DECODE(B.CHG_CD, 'OTH', B.CHG_AMT, 0)) * B.INV_XCH_RT THC_AMT,												
      SUM(DECODE(B.CHG_CD, 'DHF', B.CHG_AMT, 0)) * B.INV_XCH_RT DHF_AMT,												
      SUM(DECODE(B.CHG_CD, 'WHF', B.CHG_AMT, 0)) * B.INV_XCH_RT WHF_AMT,												
      SUM(DECODE(B.CHG_CD, 'O/F', DECODE(B.CURR_CD, 'USD', B.CHG_AMT, 0), 0)) OTR_AMT,												
      --SUM(DECODE(B.CHG_CD, 'CFR', B.CHG_AMT, 0)) * B.INV_XCH_RT CFR_AMT, -- 항목에서 삭제/OTHER에 추가												
      --SUM(DECODE(B.CHG_CD, 'BAF', B.CHG_AMT, 0)) * B.INV_XCH_RT BAF_AMT, -- 항목에서 삭제/OTHER에 추가												
      SUM(DECODE(B.CHG_CD, 'SLF', DECODE(B.CURR_CD, 'KRW', B.CHG_AMT, 0), 0)) SLF_AMT,     -- 2011.05.23 추가												
      SUM(DECODE(B.CHG_CD, 'OTH', 0, 'DHF', 0, 'WHF', 0, 'OFT', DECODE(B.CURR_CD, 'USD', 0, B.CHG_AMT), 'CMS', DECODE(B.CURR_CD, 'USD', 0, B.CHG_AMT), 'O/F', DECODE(B.CURR_CD, 'USD', 0, B.CHG_AMT), 'SLF', DECODE(B.CURR_CD, 'KRW', 0, B.CHG_AMT, B.CHG_AMT)) * B.INV_XCH_RT) OTH_AMT												
    FROM INV_AR_MN A,
      INV_AR_CHG B, BKG_CONTAINER C
    WHERE A.AR_IF_NO = B.AR_IF_NO
      AND A.BKG_NO = C.BKG_NO
      AND A.BL_SRC_NO = @[bl_src_no]
      AND A.AR_OFC_CD IN ( SELECT OFC_CD
                             FROM MDM_ORGANIZATION
                            WHERE AR_HD_QTR_OFC_CD IN ('SHARC','SELIB')
                              AND SUBSTR(LOC_CD, 1, 2) = 'KR'
                              AND DELT_FLG = 'N' )
      AND A.ACT_CUST_CNT_CD = @[act_cust_cnt_cd]
      AND A.ACT_CUST_SEQ = @[act_cust_seq]
      AND A.VSL_CD = @[vsl_cd]
      AND A.SKD_VOY_NO = @[skd_voy_no]
      AND A.SKD_DIR_CD = @[skd_dir_cd]
      AND NVL(A.INV_DELT_DIV_CD, 'N') <> 'Y'
      AND A.REV_TP_CD <> 'M'
      AND A.INV_TTL_LOCL_AMT > 0
      AND 'X' NOT IN (SELECT INV_DELT_DIV_CD
                        FROM INV_AR_MN
                       WHERE AR_IF_NO = (SELECT MAX(AR_IF_NO)
                                           FROM INV_AR_MN
                                          WHERE AR_OFC_CD IN ( SELECT OFC_CD
                                                                 FROM MDM_ORGANIZATION
                                                                WHERE AR_HD_QTR_OFC_CD IN ('SHARC','SELIB')
                                                                  AND SUBSTR(LOC_CD, 1, 2) = 'KR'
                                                                  AND DELT_FLG = 'N' )
                                            AND ACT_CUST_CNT_CD = @[act_cust_cnt_cd]
                                            AND ACT_CUST_SEQ = @[act_cust_seq]
                                            AND BL_SRC_NO = @[bl_src_no]
                                            AND VSL_CD = @[vsl_cd]
                                            AND SKD_VOY_NO = @[skd_voy_no]
                                            AND SKD_DIR_CD = @[skd_dir_cd]
                                            AND NVL(INV_DELT_DIV_CD, 'N') <> 'Y'
                                            AND REV_TP_CD <> 'M'
                                          --AND INV_TTL_LOCL_AMT > 0
                                          GROUP BY BL_SRC_NO )
                      )
    GROUP BY A.BL_SRC_NO, A.BKG_NO, A.POR_CD, A.POL_CD, A.POD_CD, A.DEL_CD, A.BKG_NO, A.CGO_WGT, A.CGO_MEAS_QTY, B.INV_XCH_RT) TB
GROUP BY TB.BL_SRC_NO, TB.BKG_NO, TB.POR_CD, TB.POL_CD, TB.POD_CD, TB.DEL_CD, TB.GRS_CNTR_WGT, TB.GRS_CBM_CAPA			]]></sql>
			<params>
				<param name="bl_src_no" type="12" value="" out="N"/>
				<param name="act_cust_cnt_cd" type="12" value="" out="N"/>
				<param name="act_cust_seq" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
