<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TonnageTaxOutputMasterDataMgtDBDAOLaneGroupVORSQL">
			<desc><![CDATA[Lane과 해당 Trade를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT T.STL_YRMON
        ,T.ERP_SLAN_CD
        ,T.VSL_SLAN_CD
        ,T.BSA_SLAN_CD
        ,T.LANE_RMK
        ,T.DELT_FLG
        ,T.CRE_DT
        ,T.CRE_USR_ID
        ,T.UPD_DT
        ,T.UPD_USR_ID
        ,T.OLD_TRD_CD1
        ,T.OLD_TRD_CD2
        ,T.OLD_TRD_CD3
        ,T.TRD_CD1
        ,T.TRD_CD2
        ,T.TRD_CD3
        ,T.TRD_CD1_SEQ
        ,T.TRD_CD2_SEQ
        ,T.TRD_CD3_SEQ
        ,T.TRD_CD
        ,T.LANE_SEQ
        ,T.STS_FLG
FROM (
				SELECT  @[stl_yrmon] STL_YRMON
				        ,T2.SLAN_CD  ERP_SLAN_CD
				        ,T1.VSL_SLAN_CD
				        ,T3.VSL_SLAN_CD BSA_SLAN_CD
				        ,T1.LANE_RMK
				        ,'N' DELT_FLG
				        ,TO_CHAR(T1.CRE_DT,'YYYYMMDD') CRE_DT
				        ,T1.CRE_USR_ID
				        ,TO_CHAR(T1.UPD_DT,'YYYYMMDD') UPD_DT
				        ,T1.UPD_USR_ID
				        ,T1.OLD_TRD_CD1
				        ,T1.OLD_TRD_CD2
				        ,T1.OLD_TRD_CD3
				        ,T1.TRD_CD1
				        ,T1.TRD_CD2
				        ,T1.TRD_CD3
				        ,T1.TRD_CD1_SEQ
				        ,T1.TRD_CD2_SEQ
				        ,T1.TRD_CD3_SEQ
				        ,T1.TRD_CD
				        ,T1.LANE_SEQ
				        ,'R' STS_FLG
				FROM (SELECT A.STL_YRMON
				            ,A.VSL_SLAN_CD
				            ,A.LANE_RMK
				            ,A.DELT_FLG
				            ,A.CRE_DT
				            ,A.CRE_USR_ID
				            ,A.UPD_DT
				            ,A.UPD_USR_ID
				            ,MAX(DECODE(ORD,1,TRD_CD)) OLD_TRD_CD1
				            ,MAX(DECODE(ORD,2,TRD_CD)) OLD_TRD_CD2
				            ,MAX(DECODE(ORD,3,TRD_CD)) OLD_TRD_CD3
				            ,MAX(DECODE(ORD,1,TRD_CD)) TRD_CD1
				            ,MAX(DECODE(ORD,2,TRD_CD)) TRD_CD2
				            ,MAX(DECODE(ORD,3,TRD_CD)) TRD_CD3
				            ,MAX(DECODE(ORD,1,LANE_SEQ)) TRD_CD1_SEQ
				            ,MAX(DECODE(ORD,2,LANE_SEQ)) TRD_CD2_SEQ
				            ,MAX(DECODE(ORD,3,LANE_SEQ)) TRD_CD3_SEQ
				            , '' TRD_CD
				            , '' LANE_SEQ
				            FROM (SELECT A.STL_YRMON
				                , A.VSL_SLAN_CD
				                , A.LANE_RMK
				                , A.DELT_FLG
				                , A.CRE_DT
				                , A.CRE_USR_ID
				                , A.UPD_DT
				                , A.UPD_USR_ID
				                , B.LANE_SEQ, B.TRD_CD
				                , ROW_NUMBER() OVER (PARTITION BY A.STL_YRMON,A.VSL_SLAN_CD ORDER BY B.LANE_SEQ) ORD
				                FROM TOT_LANE A, TOT_LANE_TRD B
				                WHERE  A.STL_YRMON = @[stl_yrmon]
				                AND A.DELT_FLG = 'N'
				                AND A.STL_YRMON = B.STL_YRMON(+)
				                AND A.VSL_SLAN_CD  = B.VSL_SLAN_CD(+)
				            ) A
				            GROUP BY A.STL_YRMON
				                    ,A.VSL_SLAN_CD
				                    ,A.LANE_RMK
				                    ,A.DELT_FLG
				                    ,A.CRE_DT
				                    ,A.CRE_USR_ID
				                    ,A.UPD_DT
				                    ,A.UPD_USR_ID
				            ) T1,
				            ( SELECT DISTINCT SLAN_CD SLAN_CD
				              FROM AR_ROUT_RNK
				              WHERE DELT_FLG ='N'
				            ) T2,
				            (SELECT VSL_SLAN_CD
				             FROM MDM_VSL_SVC_LANE
				             WHERE DELT_FLG = 'N'
				            ) T3
				WHERE T1.VSL_SLAN_CD = T2.SLAN_CD(+)
				 AND  T1.VSL_SLAN_CD = T3.VSL_SLAN_CD(+)
				
				UNION
				
				SELECT @[stl_yrmon] STL_YRMON
				        ,T4.SLAN_CD  ERP_SLAN_CD
				        ,''            VSL_SLAN_CD
				        ,T5.VSL_SLAN_CD BSA_SLAN_CD
				        ,'' LANE_RMK
				        ,'N' DELT_FLG
				        ,'' CRE_DT
				        ,'' CRE_USR_ID
				        ,'' UPD_DT
				        ,'' UPD_USR_ID
				        ,'' OLD_TRD_CD1
				        ,'' OLD_TRD_CD2
				        ,'' OLD_TRD_CD3
				        ,'' TRD_CD1
				        ,'' TRD_CD2
				        ,'' TRD_CD3
				        ,NULL TRD_CD1_SEQ
				        ,NULL TRD_CD2_SEQ
				        ,NULL TRD_CD3_SEQ
				        ,'' TRD_CD
				        ,'' LANE_SEQ
				        ,'I' STS_FLG
				FROM (SELECT DISTINCT SLAN_CD SLAN_CD
				      FROM AR_ROUT_RNK
				      WHERE DELT_FLG ='N'
				      ) T4,
				     (SELECT VSL_SLAN_CD
				      FROM MDM_VSL_SVC_LANE
				      WHERE DELT_FLG = 'N'
				     ) T5,
				     (SELECT COUNT(VSL_SLAN_CD) CNT
				      FROM TOT_LANE
				      WHERE DELT_FLG = 'N'
				        AND STL_YRMON = @[stl_yrmon]
				     ) T6
				WHERE T4.SLAN_CD NOT IN (SELECT VSL_SLAN_CD FROM TOT_LANE  WHERE DELT_FLG = 'N' AND STL_YRMON = @[stl_yrmon])
                AND  T4.SLAN_CD = T5.VSL_SLAN_CD(+)
				AND  T6.CNT > 0
    )T
ORDER BY T.VSL_SLAN_CD , T.ERP_SLAN_CD			]]></sql>
			<params>
				<param name="stl_yrmon" type="12" value="200901" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
