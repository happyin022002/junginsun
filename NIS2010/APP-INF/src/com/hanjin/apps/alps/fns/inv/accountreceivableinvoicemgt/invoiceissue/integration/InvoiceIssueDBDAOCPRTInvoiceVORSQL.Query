<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceIssueDBDAOCPRTInvoiceVORSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
SELECT	RPT_TMPLT_NM, FRT_TERM_CD
#foreach( ${key} in ${allcols}) 
	#if($key == 'INV004'||$key == 'INV008'||$key == 'INV047'||$key == 'INV062'||$key == 'INV064'||$key == 'INV066'||$key == 'INV067'||$key == 'INV068'||$key == 'INV080')
	,MAX($key) $key	
	#elseif($key == 'INV074'||$key == 'INV075'||$key == 'INV102'||$key == 'INV106'||$key == 'INV107'||$key == 'INV112'|| $key == 'INV131'||$key == 'INV141')
	,MAX($key) $key	
	#elseif($key == 'CHG001'||$key == 'CHG002'||$key == 'CHG003'||$key == 'CHG004'||$key == 'CHG005'||$key == 'CHG999') 
		,''
    #else
        ,$key 
	#end 
#end
#foreach( ${key} in ${allcols})
 #if( $key == 'CHG001'||$key == 'CHG002'||$key == 'CHG003'||$key == 'CHG004'||$key == 'CHG005'||$key == 'CHG999') 
 ,(DECODE (0
   #foreach( ${key} in ${allcols})
      #if($key == 'INV069')
         +1
      #else
	     +0
      #end
   #end
,0,  
    #if( $key == 'CHG001')
         MAX(CHG001_S),
    #elseif( $key == 'CHG002')
         MAX(CHG002_S),
    #elseif( $key == 'CHG003')
         MAX(CHG003_S),
    #elseif( $key == 'CHG004')
         MAX(CHG004_S),
    #elseif( $key == 'CHG005')
         MAX(CHG005_S),
    #elseif( $key == 'CHG999')
         MAX(INV102)-(MAX(CHG001_S)+ MAX(CHG002_S)+ MAX(CHG003_S)+ MAX(CHG004_S)+ MAX(CHG005_S)),
    #end
    #if( $key == 'CHG999')
         MAX(INV106)-(MAX(CHG001)+MAX(CHG002)+MAX(CHG003)+MAX(CHG004)+MAX(CHG005))  )) $key
    #else
         MAX($key)  )) $key
    #end
 #end
#end

FROM (
SELECT  @[rpt_tmplt_nm] RPT_TMPLT_NM
        ,MN5.BKG_NO        AS INV001
        /***  BKG MAIN  *********/
        ,MN5.BL_NO         AS INV002 
        ,MN5.SCAC_CD       AS INV003
        ,MN5.TOT_PCK_QTY   AS INV004
        ,MN5.TOT_PCK_TP    AS INV005
        ,MN5.ACT_WGT       AS INV006
        ,MN5.TOT_WGT_UT_CD AS INV007
        ,MN5.TOT_MEAS_QTY  AS INV008
        ,MN5.MEAS_UT_CD    AS INV009
        ,MN5.BKG_OFC_CD    AS INV010
        ,N.OBL_ISS_OFC_CD  AS INV011  
        ,MN5.RFA_NO  AS INV012
        ,MN5.SC_NO   AS INV013
        /*** CUSTOMER *********/
        ,DECODE(NVL(MN5.CONSIGNEE,'000000'),'000000',NULL,SUBSTR(MN5.CONSIGNEE,1,2)||'-'||SUBSTR(MN5.CONSIGNEE,3,6)) AS INV014
        ,MN5.CONSIGNEE_NM AS INV015
        ,DECODE(NVL(MN5.CN_GROUP_CUST,'000000'),'000000',NULL,SUBSTR(MN5.CN_GROUP_CUST,1,2)||'-'||SUBSTR(MN5.CN_GROUP_CUST,3,6)) AS INV016
        ,MN5.CN_GROUP_CUST_NM AS INV017
        ,DECODE(NVL(MN5.NOTIFY_PARTY,'000000'),'000000',NULL,SUBSTR(MN5.NOTIFY_PARTY,1,2)||'-'||SUBSTR(MN5.NOTIFY_PARTY,3,6)) AS INV018
        ,MN5.NOTIFY_PARTY_NM AS INV019
        ,DECODE(NVL(MN5.SHIPPER,'000000'),'000000',NULL,SUBSTR(MN5.SHIPPER,1,2)||'-'||SUBSTR(MN5.SHIPPER,3,6))  AS INV020
        ,MN5.SHIPPER_NM AS INV021
        ,MN5.SHIPPER_ADDR AS INV147
        ,MN5.FORWARDER_ADDR AS INV148
        ,MN5.ACTUAL_CUST_NM AS INV149
        ,MN5.BKG_CNTC_EMAIL  AS INV150
        ,MN5.BKG_CNTC_NM  AS INV151
        ,DECODE(NVL(MN5.SH_GROUP_CUST,'000000'),'000000',NULL,SUBSTR(MN5.SH_GROUP_CUST,1,2)||'-'||SUBSTR(MN5.SH_GROUP_CUST,3,6)) AS INV022
        ,(SELECT C5.CUST_LGL_ENG_NM 
         FROM   MDM_CUSTOMER C5 
         WHERE  C5.CUST_CNT_CD(+) = SUBSTR(MN5.SH_GROUP_CUST,1,2)
         AND    TO_NUMBER(C5.CUST_SEQ(+))    = TO_NUMBER(SUBSTR(MN5.SH_GROUP_CUST,3,6)) ) AS INV023
        ,(SELECT S.CUST_NM
          FROM   BKG_CUSTOMER S
          WHERE  S.BKG_NO = MN5.BKG_NO AND S.BKG_CUST_TP_CD = 'A' ) AS INV063
        /*** ROUTE CONDITION *********/
        ,MN5.POR_CD              AS INV024
        ,SUBSTR(MN5.POR_CD,1,2)  AS INV025
        ,(SELECT LOC1.LOC_NM FROM MDM_LOCATION LOC1  
          WHERE  MN5.POR_CD = LOC1.LOC_CD(+)) AS INV026
        ,MN5.POL_CD                           AS INV027
        ,(SELECT LOC2.LOC_NM FROM MDM_LOCATION LOC2  
          WHERE  MN5.POL_CD = LOC2.LOC_CD(+)) AS INV028
        ,MN5.PRE_RELAY_PORT                   AS INV029
        ,MN5.POD_CD                           AS INV030  
        ,(SELECT LOC3.LOC_NM FROM MDM_LOCATION LOC3  
          WHERE  MN5.POD_CD = LOC3.LOC_CD(+)) AS INV031
        ,MN5.POST_RELAY_PORT                  AS INV032
        ,(SELECT NVL(MAX(CO1.CUST_CONV_CD_CTNT), MN5.DEL_CD) 
          FROM  INV_CPRT_CD_CONV CO1  
          WHERE CO1.CPRT_CONV_TP_CD ='LOCATION'
          AND   CO1.HJS_CD_CTNT = MN5.DEL_CD
          AND   CO1.SC_NO  = NVL(MN5.SC_NO,'X') 
          AND   CO1.RFA_NO = NVL(MN5.RFA_NO,'X'))  AS INV033 
        ,SUBSTR(MN5.DEL_CD,1,2)                AS INV034
        ,(SELECT LOC4.STE_CD FROM MDM_LOCATION LOC4  
          WHERE  MN5.DEL_CD = LOC4.LOC_CD(+)) AS INV035 
        ,(SELECT LOC5.LOC_NM FROM MDM_LOCATION LOC5  
          WHERE  MN5.DEL_CD = LOC5.LOC_CD(+)) AS INV036 
        ,MN5.FNL_DEST_CD     AS INV037
        ,(SELECT NVL(MAX(CO2.CUST_CONV_CD_CTNT), MN5.RCV_TERM_CD)
          FROM INV_CPRT_CD_CONV CO2
          WHERE CO2.CPRT_CONV_TP_CD ='RECEIVINGTERM'
          AND CO2.HJS_CD_CTNT = MN5.RCV_TERM_CD
          AND CO2.SC_NO = NVL(MN5.SC_NO, 'X')
          AND CO2.RFA_NO = NVL(MN5.RFA_NO, 'X')) AS INV038
--        ,MN5.RCV_TERM_CD     AS INV038
        ,(SELECT NVL(MAX(CO2.CUST_CONV_CD_CTNT), MN5.DE_TERM_CD)
          FROM INV_CPRT_CD_CONV CO2
          WHERE CO2.CPRT_CONV_TP_CD ='DELIVERYTERM'
          AND CO2.HJS_CD_CTNT = MN5.DE_TERM_CD
          AND CO2.SC_NO = NVL(MN5.SC_NO, 'X')
          AND CO2.RFA_NO = NVL(MN5.RFA_NO, 'X')) AS INV039
--        ,MN5.DE_TERM_CD      AS INV039
        ,MN5.FNL_DEST_NM     AS INV040   
        ,(SELECT LOC6.EQ_CTRL_OFC_CD  FROM MDM_LOCATION LOC6  
          WHERE  MN5.DEL_CD = LOC6.LOC_CD(+)) AS INV041 
        ,MN5.DEST_TRNS_SVC_MOD_CD            AS INV042
        /***  VESSEL *********/
        ,MN5.T_VVD   AS INV043
        ,(SELECT VSL_ENG_NM||' '||SUBSTR(MN5.T_VVD,5,5)  FROM MDM_VSL_CNTR WHERE VSL_CD = SUBSTR(MN5.T_VVD,1,4)) AS INV044
        ,MN5.T_LANE  AS INV045
        ,MN5.FST_VVD AS INV046
        /*** DATE,TIME *********/
        , TO_CHAR(NVL(
          (SELECT /*+ INDEX_DESC (S XAK11CTM_MOVEMENT)*/
                  S.CNMV_EVNT_DT
           FROM   CTM_MOVEMENT S
           WHERE  1=1
           AND    S.CNTR_NO     (+) = MN5.CNTR_NO
           AND    S.CNMV_YR     (+) = MN5.CNMV_YR
           AND    S.CNMV_CYC_NO (+) = MN5.CNMV_CYC_NO
           AND    S.MVMT_STS_CD (+) = 'OC'
           AND    ROWNUM            = 1
           ), MN5.CGO_RCV_DT), 'YYYY-MM-DD') AS INV047
        ,TO_CHAR(TO_DATE(MN5.F_POL_ETA,'YYYYMMDD') ,'YYYY-MM-DD')  AS INV048
        ,TO_CHAR(TO_DATE(MN5.DUEDT,'YYYYMMDD') ,'YYYY-MM-DD')      AS INV049
        ,TO_CHAR(TO_DATE(MN5.F_POL_ETD,'YYYYMMDD') ,'YYYY-MM-DD')  AS INV050
        ,TO_CHAR(TO_DATE(MN5.T_POL_ETA,'YYYYMMDD') ,'YYYY-MM-DD')  AS INV051
        ,TO_CHAR(TO_DATE(MN5.T_POL_ETD,'YYYYMMDD') ,'YYYY-MM-DD')  AS INV052
        ,MN5.OBRD_DT    AS INV053
        ,TO_CHAR(N.OBL_ISS_DT,'YYYY-MM-DD')    AS INV054 
        ,TO_CHAR(TO_DATE(MN5.T_POD_ETA,'YYYYMMDD') ,'YYYY-MM-DD')  AS INV055
        ,(SELECT TO_CHAR(NVL(P.FAX_SND_DT, NVL(P.EML_SND_DT, '')),'YYYY-MM-DD') AN_SENT_DT
          FROM   BKG_ARR_NTC_DTL P
          WHERE  MN5.BKG_NO = P.BKG_NO(+)
          AND    P.BKG_CUST_TP_CD(+) ='C' 
          AND    P.CUST_CNTC_TP_CD(+) = 'C1'  )    AS INV056 
        ,TO_CHAR(TO_DATE(MN5.T_POD_ETD,'YYYYMMDD') ,'YYYY-MM-DD')   AS INV057
        ,TO_CHAR(TO_DATE(MN5.L_POD_ETA,'YYYYMMDD') ,'YYYY-MM-DD')  AS INV058
        ,TO_CHAR(TO_DATE(MN5.L_POD_ETD,'YYYYMMDD') ,'YYYY-MM-DD')  AS INV059
        ,TO_CHAR(W.CSTMS_CLR_LST_DT,'YYYY-MM-DD')  AS INV060 
        ,DECODE(TO_CHAR(O.DEL_ARR_DT,'YYYY-MM-DD'), NULL, DECODE(MN5.COP_DEL_ETA,'00000000', MN5.VSK_DEL_ETA, TO_CHAR(TO_DATE(MN5.COP_DEL_ETA,'YYYYMMDD'),'YYYY-MM-DD')),TO_CHAR(O.DEL_ARR_DT,'YYYY-MM-DD'))  AS INV061
        ,(SELECT /*+ INDEX_DESC(S XAK2CTM_MOVEMENT)*/
                 S.MVMT_STS_CD||' '|| NVL(TO_CHAR(S.CNMV_EVNT_DT,'YYYY-MM-DD'),'') 
          FROM   CTM_MOVEMENT S
          WHERE  S.BKG_NO     (+) = MN5.BKG_NO
          AND    S.CNTR_NO    (+) = MN5.CNTR_NO
          AND    S.CNMV_CYC_NO(+) = MN5.CNMV_CYC_NO
          AND    ROWNUM           = 1
         ) AS INV062
        ,(SELECT /*+ INDEX_DESC(S XAK11CTM_MOVEMENT) */
                 TO_CHAR(S.CNMV_EVNT_DT, 'YYYY-MM-DD')  
          FROM   CTM_MOVEMENT S
          WHERE  1=1
          AND    S.CNTR_NO     (+)  = MN5.CNTR_NO
          AND    S.CNMV_YR     (+)  = MN5.CNMV_YR      
          AND    S.CNMV_CYC_NO (+)  = MN5.CNMV_CYC_NO
          AND    S.MVMT_STS_CD (+)  = 'ID'
          AND    ROWNUM             = 1
         ) AS INV064
        ,TO_CHAR(O.PKUP_FREE_DT,'YYYY-MM-DD' ) AS INV065  
        ,(SELECT /*+ INDEX_DESC(S XAK11CTM_MOVEMENT) */
                 TO_CHAR(S.CNMV_EVNT_DT, 'YYYY-MM-DD')  
          FROM   CTM_MOVEMENT S
          WHERE  1=1
          AND    S.CNTR_NO     (+)  = MN5.CNTR_NO
          AND    S.CNMV_YR     (+)  = MN5.CNMV_YR      
          AND    S.CNMV_CYC_NO (+)  = MN5.CNMV_CYC_NO
          AND    S.MVMT_STS_CD (+)  = 'ID'
          AND    ROWNUM             = 1
         ) AS INV066 
        ,(SELECT /*+ INDEX_ASC(S XAK11CTM_MOVEMENT)*/
                 TO_CHAR(S.CNMV_EVNT_DT,'YYYY-MM-DD')  
          FROM   CTM_MOVEMENT S
          WHERE  1=1
          AND    S.CNTR_NO     (+) = MN5.CNTR_NO
          AND    S.CNMV_YR     (+) = MN5.CNMV_YR
          AND    S.CNMV_CYC_NO (+) = MN5.CNMV_CYC_NO
          AND    S.MVMT_STS_CD (+) = 'MT'
          AND    ROWNUM            = 1
         ) AS INV067
        ,(SELECT /*+ INDEX_ASC(S XAK11CTM_MOVEMENT)*/
                 TO_CHAR(S.CNMV_EVNT_DT,'YYYY-MM-DD')  
          FROM   CTM_MOVEMENT S
          WHERE  1=1
          AND    S.CNTR_NO     (+) = MN5.CNTR_NO
          AND    S.CNMV_YR     (+) = MN5.CNMV_YR
          AND    S.CNMV_CYC_NO (+) = MN5.CNMV_CYC_NO
          AND    S.MVMT_STS_CD (+) = 'IC'
          AND    ROWNUM            = 1   
         ) AS INV080
        /*** CONTAINER  INV068 - INV078 *********/
        ,MN5.MEAS_QTY      AS INV068
        ,MN5.CNTR_NO       AS INV069
        ,MN5.CNTR_PRT_FLG  AS INV070
        ,MN5.CNTR_SEAL_NO  AS INV071
        ,MN5.CNTR_SZ_CD    AS INV072
        ,(SELECT NVL(MAX(CO2.CUST_CONV_CD_CTNT), MN5.CNTR_TPSZ_CD) 
          FROM  INV_CPRT_CD_CONV CO2  
          WHERE CO2.CPRT_CONV_TP_CD ='CNTRTPSZ'
          AND   CO2.HJS_CD_CTNT = MN5.CNTR_TPSZ_CD 
          AND   CO2.SC_NO  = NVL(MN5.SC_NO,'X') 
          AND   CO2.RFA_NO = NVL(MN5.RFA_NO,'X')) AS INV073  
        ,MN5.CNTR_VOL_QTY  AS INV074
        ,MN5.PCK_QTY       AS INV075
        ,MN5.PCK_TP_CD     AS INV076
        ,MN5.CNTR_WGT      AS INV077
        ,MN5.WGT_UT_CD     AS INV078
        /***   CUSTOMER REF.  *********/
        ,(SELECT SUBSTR(U1.CUST_REF_NO_CTNT,1,50) FROM BKG_REFERENCE U1 
          WHERE MN5.BKG_NO = U1.BKG_NO(+)
          AND U1.BKG_REF_TP_CD='BKPO' AND ROWNUM=1) AS INV082  
        ,(SELECT SUBSTR(U2.CUST_REF_NO_CTNT,1,50) FROM BKG_REFERENCE U2 
          WHERE MN5.BKG_NO = U2.BKG_NO(+) 
          AND  MN5.CNTR_NO = U2.CNTR_NO(+) 
          AND U2.BKG_REF_TP_CD='CTPO' AND ROWNUM=1) AS INV083
        ,(SELECT V.PRT_NO FROM BKG_REF_DTL V 
          WHERE MN5.BKG_NO = V.BKG_NO(+)
          AND V.CUST_REF_TP_CD='HP' AND ROWNUM=1)  AS INV084
        ,(SELECT SUBSTR(U3.CUST_REF_NO_CTNT,1,50) FROM BKG_REFERENCE U3 
          WHERE MN5.BKG_NO = U3.BKG_NO(+)
          AND U3.BKG_REF_TP_CD='FINV' AND ROWNUM=1) AS INV085
        ,(SELECT SUBSTR(U4.CUST_REF_NO_CTNT,1,50) FROM BKG_REFERENCE U4 
          WHERE MN5.BKG_NO = U4.BKG_NO(+)
          AND U4.BKG_REF_TP_CD='EBRF' AND ROWNUM=1) AS INV086
        ,(SELECT SUBSTR(U5.CUST_REF_NO_CTNT,1,50) FROM BKG_REFERENCE U5
          WHERE MN5.BKG_NO = U5.BKG_NO(+)
          AND U5.BKG_REF_TP_CD='ESRF' AND ROWNUM=1) AS INV087
        ,(SELECT U6.CUST_NM FROM BKG_CUSTOMER U6
          WHERE MN5.BKG_NO = U6.BKG_NO(+)
          AND U6.BKG_CUST_TP_CD = 'E' AND ROWNUM=1) AS INV088
        /***  RATE   *********/
        ,''   AS INV090
        ,''   AS INV089
        ,''   AS INV091
        ,MN5.THR_CUST AS INV092
        ,''   AS INV093
        ,MN5.CNTR_CHG_CURR AS INV126
        ,''   AS INV094
        ,''   AS INV095 
        ,''   AS INV097
        ,''   AS INV100
        ,''   AS INV098
        ,''   AS INV099
        ,''   AS INV140
        ,MN5.AUD_STS_CD AS INV101
        ,MN5.GRP_CUR   AS INV103
        ,MN5.TOT_CURR_AMT   AS INV102
        ,DECODE(NVL(MN5.BILL_CUST,'000000'),'000000',NULL, SUBSTR(MN5.BILL_CUST,1,2)||'-'||SUBSTR(MN5.BILL_CUST,3,6)) AS INV104
        ,MN5.OTS_OFC   AS INV105
        ,MN5.CNTR_SUM  AS INV106
        ,SUM(CHG4.CHG_AMT) AS INV107
        ,MN5.CR_TERM   AS INV108
        ,MN5.OVER_DUE  AS INV109
        ,(SELECT DECODE(MN5.FRT_TERM_CD, 'C',W.FRT_CLT_FLG,  MIN(NVL(OT.OTS_STL_FLG,'N')))
          FROM   BKG_OUTSTANDING OT
          WHERE  OT.CLT_BL_NO = MN5.BL_NO AND OT.OFC_CD = MN5.OTS_OFC AND OT.OTS_BND_TP_CD='O')  AS INV110 
        ,MN5.FRT_TERM_CD 	 
        ,MN5.GL_EX     AS INV111
        ,MN5.LCL_TOT   AS INV112
        ,MN5.USD_TOT   AS INV141
        ,(SELECT NVL(MAX(CO3.CUST_CONV_CD_CTNT), MN5.CHG_CD) 
          FROM  INV_CPRT_CD_CONV CO3  
          WHERE CO3.CPRT_CONV_TP_CD ='CHARGE' 
          AND  CO3.HJS_CD_CTNT =MN5.CHG_CD
          AND  CO3.SC_NO  = NVL(MN5.SC_NO,'X') 
          AND  CO3.RFA_NO = NVL(MN5.RFA_NO,'X'))  AS INV096
        ,MN5.CHG_CURR      AS INV127
        ,MN5.CHG_RATED_AS  AS INV128
        ,MN5.CHG_RATE      AS INV129
        ,''                AS INV130
        ,MN5.CHG_SUM       AS INV131
        /***  RATE REP_CHGE *********/
        ,''       AS INV132
        ,''       AS INV133
        ,''       AS INV134
        ,''       AS INV135
        ,''       AS INV136
        ,''       AS INV137
        ,''       AS INV138
        ,''       AS INV139
        /*** COMMODITY *********/
        ,(SELECT NVL(MAX(CO4.CUST_CONV_CD_CTNT), MN5.CMDT_CD) 
          FROM  INV_CPRT_CD_CONV CO4  
          WHERE CO4.CPRT_CONV_TP_CD ='COMMODITY' 
          AND  CO4.HJS_CD_CTNT = MN5.CMDT_CD
          AND  CO4.SC_NO  = NVL(MN5.SC_NO,'X') 
          AND  CO4.RFA_NO = NVL(MN5.RFA_NO,'X')) AS INV113 
        ,(SELECT D.CMDT_NM   FROM MDM_COMMODITY D WHERE MN5.CMDT_CD = D.CMDT_CD(+)) AS INV114 
        ,MN5.CSTMS_DESC     AS INV115
        ,MN5.CNTR_SP_CGO_FG AS INV116
        ,(SELECT TO_CHAR(S.MK_DESC) FROM BKG_BL_MK_DESC S WHERE S.BKG_NO = MN5.BKG_NO AND S.MK_SEQ=1) AS INV079
        /***  I/B INFORM  *********/
        ,(SELECT M.RTN_YD_CD FROM BKG_PKUP_NTC M 
          WHERE M.BKG_NO = MN5.BKG_NO 
          AND  M.NTC_SEQ = (SELECT MAX(MM.NTC_SEQ) 
                            FROM BKG_PKUP_NTC MM 
                            WHERE MM.BKG_NO = MN5.BKG_NO)) AS INV117
        ,(SELECT HUB_LOC_CD FROM BKG_CSTMS_ADV_BL
          WHERE BL_NO =MN5.BL_NO    
          AND CNT_CD =SUBSTR(MN5.DEL_CD,1,2)) AS INV118  
        ,(SELECT MAX(DECODE(CNT_CD, 'UA', IBD_TRSP_NO, ''))
          FROM BKG_CSTMS_ADV_IBD
          WHERE  BL_NO= MN5.BL_NO AND CNT_CD ='UA' )   AS INV119  
        ,(SELECT MAX(DECODE(CNT_CD ,'US', TO_CHAR(IBD_TRSP_ISS_DT,'YYYY-MM-DD'), ''))
          FROM  BKG_CSTMS_ADV_IBD
          WHERE BL_NO=MN5.BL_NO AND CNT_CD ='US' ) AS INV120 
        ,(SELECT M1.PKUP_NO FROM BKG_PKUP_NTC M1 
          WHERE M1.BKG_NO = MN5.BKG_NO 
          AND M1.NTC_SEQ = (SELECT MAX(M2.NTC_SEQ) 
                           FROM BKG_PKUP_NTC M2 WHERE M2.BKG_NO = MN5.BKG_NO)) AS INV121
        ,(SELECT M3.PKUP_YD_CD FROM BKG_PKUP_NTC M3 
          WHERE M3.BKG_NO = MN5.BKG_NO 
          AND M3.NTC_SEQ = (SELECT MAX(M4.NTC_SEQ) 
                           FROM BKG_PKUP_NTC M4 WHERE M4.BKG_NO = MN5.BKG_NO)) AS INV122
        ,''    AS INV123
        ,W.OBL_RDEM_FLG    AS INV124
        ,W.CSTMS_CLR_CD    AS INV125
        ,''	AS INV081
        ,MN5.RT_APLY_DT AS INV142
        ,'' AS INV143 
        ,(SELECT MAX(TO_CHAR(BC.CGO_RCV_DT,'YYYY-MM-DD'))
          FROM BKG_CONTAINER BC 
          WHERE BC.BKG_NO = MN5.BKG_NO  ) AS INV144
        ,(SELECT SUBSTR(U7.CUST_REF_NO_CTNT,1,50) FROM BKG_REFERENCE U7
          WHERE MN5.BKG_NO = U7.BKG_NO(+)
          AND U7.BKG_REF_TP_CD='HPDP' AND ROWNUM=1) AS INV145 
        ,MN5.PRT_NO    AS INV146 
        ,MN5.CHG001
        ,MN5.CHG002
        ,MN5.CHG003
        ,MN5.CHG004
        ,MN5.CHG005
        ,MN5.CHG001_S
        ,MN5.CHG002_S
        ,MN5.CHG003_S
        ,MN5.CHG004_S
        ,MN5.CHG005_S
FROM    
(       
SELECT   MN4.BKG_NO
        /*  BKG MAIN */
        ,MN4.BL_NO
        ,MN4.RFA_NO
        ,MN4.SC_NO
        ,MN4.SCAC_CD 
        ,MN4.BKG_OFC_CD 
        ,MN4.POR_CD
        ,MN4.POD_CD
        ,MN4.POL_CD
        ,MN4.DEL_CD
        ,MN4.FNL_DEST_CD
        ,MN4.RCV_TERM_CD
        ,MN4.DE_TERM_CD
        ,MN4.DEST_TRNS_SVC_MOD_CD
        ,MN4.CMDT_CD
        ,MN4.FNL_DEST_NM
        ,MN4.TOT_PCK_QTY
        ,MN4.TOT_PCK_TP
        ,MN4.ACT_WGT
        ,MN4.TOT_WGT_UT_CD
        ,MN4.TOT_MEAS_QTY
        ,MN4.MEAS_UT_CD
        ,MN4.VSL_NM
        ,MN4.CSTMS_DESC
        /* CUSTOMER */   
        ,MN4.CONSIGNEE
        ,MN4.CN_GROUP_CUST
        ,MN4.NOTIFY_PARTY
        ,MN4.SHIPPER
        ,MN4.SH_GROUP_CUST
        ,MN4.CONSIGNEE_NM
        ,MN4.CN_GROUP_CUST_NM
        ,MN4.NOTIFY_PARTY_NM
        ,MN4.SHIPPER_NM
        ,MN4.SHIPPER_ADDR
        ,MN4.FORWARDER_ADDR
        ,MN4.ACTUAL_CUST_NM
        ,MN4.BKG_CNTC_EMAIL
        ,MN4.BKG_CNTC_NM
        /* ROUTE CONDITION */
        ,MN4.PRE_RELAY_PORT
        ,MN4.POST_RELAY_PORT
        ,MN4.T_VVD
        ,MN4.T_LANE
        ,MN4.FST_VVD
        /* DATE,TIME */
        ,MN4.OBRD_DT
        ,MN4.F_POL_ETA
        ,MN4.F_POL_ETD
        ,MN4.T_POL_ETA
        ,MN4.T_POL_ETD
        ,MN4.T_POD_ETA
        ,MN4.T_POD_ETD
        ,MN4.L_POD_ETA
        ,MN4.L_POD_ETD
        ,CNTR.CGO_RCV_DT
        ,MN4.DUEDT
        ,MN4.BILL_CUST
        ,MN4.THR_CUST
        ,MN4.OTS_OFC
        ,MN4.CR_TERM 
        ,MN4.GL_EX 
        ,MN4.LCL_TOT
        ,MN4.USD_TOT
        ,MN4.OVER_DUE
        ,MN4.AUD_STS_CD
        ,MN4.GRP_CUR
        ,DECODE(CHG3.CURR_CD, NULL, 0, MN4.TOT_CURR_AMT) AS TOT_CURR_AMT
        ,MN4.CHG_CD
        ,MN4.CHG_CURR
        ,MN4.CHG_RATED_AS
        ,MN4.CHG_RATE
        ,MN4.CHG_SUM
        ,MN4.FRT_TERM_CD
        ,CNTR.CNTR_NO, CNTR.CNMV_CYC_NO, CNTR.CNMV_YR ,CNTR.MEAS_QTY, CNTR.CNTR_PRT_FLG
        ,(SELECT CNTR_SEAL_NO
          FROM   BKG_CNTR_SEAL_NO
          WHERE  BKG_NO        =  MN4.BKG_NO
          AND    CNTR_NO       = CNTR.CNTR_NO 
          AND    CNTR_SEAL_SEQ = 1 ) AS CNTR_SEAL_NO
        ,(SELECT  DECODE(CNTR.CNTR_TPSZ_CD, 'D7','45',SUBSTR(SZ.CNTR_SZ_DESC, 1, 2))
          FROM    MDM_CNTR_SZ SZ, MDM_CNTR_TP_SZ TP
          WHERE   TP.CNTR_TPSZ_CD = CNTR.CNTR_TPSZ_CD
          AND     TP.CNTR_SZ_CD   = SZ.CNTR_SZ_CD)  AS CNTR_SZ_CD
        ,CNTR.CNTR_TPSZ_CD
        ,CNTR.CNTR_VOL_QTY
        ,CNTR.PCK_QTY
        ,CNTR.PCK_TP_CD
        ,CNTR.CNTR_WGT
        ,CNTR.WGT_UT_CD
        ,NVL(CNTR.DCGO_FLG, NVL(CNTR.RC_FLG,NVL(CNTR.BB_CGO_FLG,NVL(CNTR.AWK_CGO_FLG,'')))) AS CNTR_SP_CGO_FG
        ,CHG3.CURR_CD AS CNTR_CHG_CURR
        ,(SELECT NVL(SUM(CR.CHG_AMT),0)
          FROM   BKG_CNTR_RT CR 
          WHERE  CR.BKG_NO               = MN4.BKG_NO
          AND    CR.CNTR_NO              = CNTR.CNTR_NO
          AND    CR.CURR_CD              = MN4.GRP_CUR
          AND    CR.FRT_INCL_XCLD_DIV_CD ='N'
          AND    CR.FRT_TERM_CD          = MN4.FRT_TERM_CD  ) AS CNTR_SUM
        ,MN4.RT_APLY_DT
        ,MN4.COP_DEL_ETA
        ,MN4.VSK_DEL_ETA
        ,MN4.PRT_NO
        ,SUM(DECODE(CHG_T.FLG01, 'Y', DECODE(CHG_M.REP_CHG_CD, CHG_T.CHG01, CHG3.CHG_AMT, 0),
                                      DECODE(CHG3.CHG_CD, CHG_T.CHG01, CHG3.CHG_AMT, 0))) AS CHG001
        ,SUM(DECODE(CHG_T.FLG02, 'Y', DECODE(CHG_M.REP_CHG_CD, CHG_T.CHG02, CHG3.CHG_AMT, 0),
                                      DECODE(CHG3.CHG_CD, CHG_T.CHG02, CHG3.CHG_AMT, 0))) AS CHG002
        ,SUM(DECODE(CHG_T.FLG03, 'Y', DECODE(CHG_M.REP_CHG_CD, CHG_T.CHG03, CHG3.CHG_AMT, 0),
                                      DECODE(CHG3.CHG_CD, CHG_T.CHG03, CHG3.CHG_AMT, 0))) AS CHG003
        ,SUM(DECODE(CHG_T.FLG04, 'Y', DECODE(CHG_M.REP_CHG_CD, CHG_T.CHG04, CHG3.CHG_AMT, 0),
                                      DECODE(CHG3.CHG_CD, CHG_T.CHG04, CHG3.CHG_AMT, 0))) AS CHG004
        ,SUM(DECODE(CHG_T.FLG05, 'Y', DECODE(CHG_M.REP_CHG_CD, CHG_T.CHG05, CHG3.CHG_AMT, 0),
                                      DECODE(CHG3.CHG_CD, CHG_T.CHG05, CHG3.CHG_AMT, 0))) AS CHG005
        ,(SELECT NVL(SUM(RT.CHG_AMT),0)
          FROM   BKG_CHG_RT RT, MDM_CHARGE  MD
          WHERE  RT.BKG_NO                  = MN4.BKG_NO
          AND    RT.CURR_CD                 = MN4.GRP_CUR
          AND    RT.FRT_INCL_XCLD_DIV_CD(+) = 'N'
          AND    RT.FRT_TERM_CD         (+) = MN4.FRT_TERM_CD
#if (${frt_term_cd} != 'A')       
         AND RT.FRT_TERM_CD(+) = @[frt_term_cd]
#end         
         AND RT.CHG_CD  = MD.CHG_CD
         AND CHG_T.CHG01  = DECODE(CHG_T.FLG01, 'Y', MD.REP_CHG_CD, RT.CHG_CD ))  AS CHG001_S  
       ,(SELECT NVL(SUM(RT.CHG_AMT),0) FROM BKG_CHG_RT RT, MDM_CHARGE  MD
         WHERE  RT.BKG_NO                  = MN4.BKG_NO
         AND    RT.CURR_CD                 = MN4.GRP_CUR
         AND    RT.FRT_INCL_XCLD_DIV_CD(+) = 'N'
         AND    RT.FRT_TERM_CD         (+) = MN4.FRT_TERM_CD
#if (${frt_term_cd} != 'A')
         AND RT.FRT_TERM_CD(+) = @[frt_term_cd]
#end       
         AND RT.CHG_CD  = MD.CHG_CD
         AND CHG_T.CHG02  = DECODE(CHG_T.FLG02, 'Y', MD.REP_CHG_CD, RT.CHG_CD ))  AS CHG002_S  
       ,(SELECT NVL(SUM(RT.CHG_AMT),0)
         FROM   BKG_CHG_RT RT, MDM_CHARGE  MD
         WHERE  RT.BKG_NO                  = MN4.BKG_NO
         AND    RT.CURR_CD                 = MN4.GRP_CUR
         AND    RT.FRT_INCL_XCLD_DIV_CD (+)='N'
         AND    RT.FRT_TERM_CD          (+)= MN4.FRT_TERM_CD
#if (${frt_term_cd} != 'A')
         AND    RT.FRT_TERM_CD(+) = @[frt_term_cd]
#end
         AND    RT.CHG_CD    = MD.CHG_CD
         AND    CHG_T.CHG03  = DECODE(CHG_T.FLG03, 'Y', MD.REP_CHG_CD, RT.CHG_CD ))  AS CHG003_S
       ,(SELECT NVL(SUM(RT.CHG_AMT),0)
         FROM   BKG_CHG_RT RT, MDM_CHARGE  MD
         WHERE  RT.BKG_NO                  = MN4.BKG_NO
         AND    RT.CURR_CD                 = MN4.GRP_CUR
         AND    RT.FRT_INCL_XCLD_DIV_CD(+) = 'N'
         AND    RT.FRT_TERM_CD         (+) = MN4.FRT_TERM_CD
#if (${frt_term_cd} != 'A')
         AND    RT.FRT_TERM_CD(+) = @[frt_term_cd]
#end
         AND    RT.CHG_CD  = MD.CHG_CD
         AND    CHG_T.CHG04  = DECODE(CHG_T.FLG04, 'Y', MD.REP_CHG_CD, RT.CHG_CD ))  AS CHG004_S
        ,(SELECT NVL(SUM(RT.CHG_AMT),0) FROM BKG_CHG_RT RT, MDM_CHARGE  MD
         WHERE   RT.BKG_NO = MN4.BKG_NO
         AND     RT.CURR_CD  = MN4.GRP_CUR
         AND     RT.FRT_INCL_XCLD_DIV_CD(+) ='N'
         AND     RT.FRT_TERM_CD(+) = MN4.FRT_TERM_CD
#if (${frt_term_cd} != 'A')
         AND RT.FRT_TERM_CD(+) = @[frt_term_cd]
#end
         AND RT.CHG_CD  = MD.CHG_CD
         AND CHG_T.CHG05  = DECODE(CHG_T.FLG05, 'Y', MD.REP_CHG_CD, RT.CHG_CD))  AS CHG005_S
FROM
(SELECT   NVL(MAX(DECODE(SEQ, 1, CHG_CD)),'XXX') AS CHG01
        , NVL(MAX(DECODE(SEQ, 1, CPRT_CHG_GRP_FLG)),'N') AS FLG01
        , NVL(MAX(DECODE(SEQ, 2, CHG_CD)),'XXX') AS CHG02
        , NVL(MAX(DECODE(SEQ, 2, CPRT_CHG_GRP_FLG)),'N') AS FLG02
        , NVL(MAX(DECODE(SEQ, 3, CHG_CD)),'XXX') AS CHG03
        , NVL(MAX(DECODE(SEQ, 3, CPRT_CHG_GRP_FLG)),'N') AS FLG03
        , NVL(MAX(DECODE(SEQ, 4, CHG_CD)),'XXX') AS CHG04
        , NVL(MAX(DECODE(SEQ, 4, CPRT_CHG_GRP_FLG)),'N') AS FLG04
        , NVL(MAX(DECODE(SEQ, 5, CHG_CD)),'XXX') AS CHG05
        , NVL(MAX(DECODE(SEQ, 5, CPRT_CHG_GRP_FLG)),'N') AS FLG05
FROM    (
        SELECT  DP_SEQ, CHG_CD, cprt_chg_grp_flg
                , ROW_NUMBER() OVER ( ORDER BY CPRT_TP_CTNT,CPRT_VAL_CTNT,DP_SEQ) AS SEQ
        FROM    INV_CPRT_TMPLT_CHG
        WHERE   1=1
        AND     AR_OFC_CD       = @[ar_ofc_cd]
        AND     RPT_TMPLT_NM    = @[rpt_tmplt_nm]
#if (${sc_no} != '')
        AND     CPRT_TP_CTNT    = 'S'
        AND     CPRT_VAL_CTNT = @[sc_no]
#end
#if (${rfa_no} != '')
        AND     CPRT_TP_CTNT    = 'R'
        AND     CPRT_VAL_CTNT = @[rfa_no]
#end
       )
) CHG_T
,(
SELECT   MN3.BKG_NO
       /*  BKG MAIN */
        ,MN3.BL_NO
        ,MN3.RFA_NO
        ,MN3.SC_NO
        ,MN3.SCAC_CD 
        ,MN3.BKG_OFC_CD 
        ,MN3.POR_CD 
        ,MN3.POD_CD 
        ,MN3.POL_CD 
        ,MN3.DEL_CD 
        ,MN3.FNL_DEST_CD
        ,MN3.RCV_TERM_CD
        ,MN3.DE_TERM_CD
        ,MN3.DEST_TRNS_SVC_MOD_CD
        ,MN3.CMDT_CD
        ,MN3.FNL_DEST_NM
        ,MN3.TOT_PCK_QTY
        ,MN3.TOT_PCK_TP
        ,MN3.ACT_WGT
        ,MN3.TOT_WGT_UT_CD
        ,MN3.TOT_MEAS_QTY
        ,MN3.MEAS_UT_CD
        ,MN3.VSL_NM
        ,MN3.CSTMS_DESC
      /* CUSTOMER */
        ,MN3.CONSIGNEE
        ,MN3.CN_GROUP_CUST
        ,MN3.NOTIFY_PARTY
        ,MN3.SHIPPER
        ,MN3.SH_GROUP_CUST
        ,MN3.CONSIGNEE_NM
        ,MN3.CN_GROUP_CUST_NM
        ,MN3.NOTIFY_PARTY_NM
        ,MN3.SHIPPER_NM
        ,MN3.SHIPPER_ADDR
        ,MN3.FORWARDER_ADDR
        ,MN3.ACTUAL_CUST_NM
        ,MN3.BKG_CNTC_EMAIL
        ,MN3.BKG_CNTC_NM
       /* ROUTE CONDITION */
        ,MN3.PRE_RELAY_PORT
        ,MN3.POST_RELAY_PORT
        ,MN3.T_VVD
        ,MN3.T_LANE
        ,MN3.FST_VVD
       /* DATE,TIME */
        ,MN3.OBRD_DT
        ,MN3.F_POL_ETA
        ,MN3.F_POL_ETD
        ,MN3.T_POL_ETA
        ,MN3.T_POL_ETD
        ,MN3.T_POD_ETA
        ,MN3.T_POD_ETD
        ,MN3.L_POD_ETA
        ,MN3.L_POD_ETD
        ,MN3.DUEDT
        ,MN3.BILL_CUST
        ,MN3.THR_CUST
        ,MN3.OTS_OFC
        ,MN3.FRT_TERM_CD
        ,MN3.CR_TERM 
        ,MN3.GL_EX 
        ,MN3.LCL_TOT
        ,MN3.USD_TOT
        ,MN3.OVER_DUE
        ,MN3.AUD_STS_CD
        ,MN3.GRP_CUR
        ,MN3.TOT_CURR_AMT
        ,CHG2.CHG_CD
        ,CHG2.CURR_CD AS CHG_CURR
        ,CHG2.RAT_AS_QTY AS CHG_RATED_AS
        ,CHG2.CHG_UT_AMT AS CHG_RATE
        ,SUM(CHG2.CHG_AMT) AS CHG_SUM
        ,MN3.RT_APLY_DT
        ,MN3.COP_DEL_ETA
        ,MN3.VSK_DEL_ETA
        ,MN3.PRT_NO
FROM
(
SELECT   MN2.BKG_NO
       /*  BKG MAIN */
        ,MN2.BL_NO
        ,MN2.RFA_NO
        ,MN2.SC_NO
        ,MN2.SCAC_CD
        ,MN2.BKG_OFC_CD
        ,MN2.POR_CD
        ,MN2.POD_CD
        ,MN2.POL_CD
        ,MN2.DEL_CD
        ,MN2.FNL_DEST_CD
        ,MN2.RCV_TERM_CD
        ,MN2.DE_TERM_CD
        ,MN2.DEST_TRNS_SVC_MOD_CD
        ,MN2.CMDT_CD
        ,MN2.FNL_DEST_NM
        ,MN2.TOT_PCK_QTY
        ,MN2.TOT_PCK_TP
        ,MN2.ACT_WGT
        ,MN2.TOT_WGT_UT_CD
        ,MN2.TOT_MEAS_QTY
        ,MN2.MEAS_UT_CD
        ,MN2.VSL_NM
        ,MN2.CSTMS_DESC
      /* CUSTOMER */
        ,MN2.CONSIGNEE
        ,MN2.CN_GROUP_CUST
        ,MN2.NOTIFY_PARTY
        ,MN2.SHIPPER
        ,MN2.SH_GROUP_CUST
        ,MN2.CONSIGNEE_NM
        ,MN2.CN_GROUP_CUST_NM
        ,MN2.NOTIFY_PARTY_NM
        ,MN2.SHIPPER_NM
        ,MN2.SHIPPER_ADDR
        ,MN2.FORWARDER_ADDR
        ,MN2.ACTUAL_CUST_NM
        ,MN2.BKG_CNTC_EMAIL
        ,MN2.BKG_CNTC_NM
       /* ROUTE CONDITION */
        ,MN2.PRE_RELAY_PORT
        ,MN2.POST_RELAY_PORT
        ,MN2.T_VVD
        ,MN2.T_LANE
        ,MN2.FST_VVD
       /* DATE,TIME */
        ,MN2.OBRD_DT
        ,SUBSTR(MN2.F_POL_ETAETD,1,8)  AS F_POL_ETA
        ,SUBSTR(MN2.F_POL_ETAETD,9,8)  AS F_POL_ETD
        ,SUBSTR(MN2.T_POL_ETAETD,1,8)  AS T_POL_ETA
        ,SUBSTR(MN2.T_POL_ETAETD,9,8)  AS T_POL_ETD
        ,SUBSTR(MN2.T_POD_ETAETD,1,8)  AS T_POD_ETA
        ,SUBSTR(MN2.T_POD_ETAETD,9,8)  AS T_POD_ETD
      	,SUBSTR(MN2.L_POD_ETAETD,1,8)  AS L_POD_ETA
      	,SUBSTR(MN2.L_POD_ETAETD,9,8)  AS L_POD_ETD
        ,DECODE(CHG.FRT_TERM_CD, 'P', TO_CHAR(TO_DATE(SUBSTR(MN2.F_POL_ETAETD,9,8),'YYYYMMDD')  
                                             + DECODE(NVL(MN2.OB_CUST_CRTERM, 0),0, MN2.OB_OFC_CRTERM, MN2.OB_CUST_CRTERM ),'YYYYMMDD')
                                    , TO_CHAR((TO_DATE(SUBSTR(MN2.L_POD_ETAETD,1,8),'YYYYMMDD')  
                                             + DECODE(NVL(MN2.IB_CUST_CRTERM, 0),0, MN2.IB_OFC_CRTERM ,MN2.IB_CUST_CRTERM)),'YYYYMMDD')
                                             ) AS DUEDT
        ,DECODE(CHG.FRT_TERM_CD, 'P' ,MN2.PPD_CUST, MN2.CCT_CUST ) AS BILL_CUST
        ,MN2.THR_CUST
        ,DECODE(CHG.FRT_TERM_CD, 'P' ,MN2.PPD_OFC, MN2.CCT_OFC ) AS OTS_OFC
        ,DECODE(CHG.FRT_TERM_CD, 'P'  ,DECODE(NVL(MN2.OB_CUST_CRTERM, 0),0, MN2.OB_OFC_CRTERM, NVL(MN2.OB_CUST_CRTERM, 0))
                                      ,DECODE(NVL(MN2.IB_CUST_CRTERM, 0),0, MN2.IB_OFC_CRTERM, NVL(MN2.IB_CUST_CRTERM, 0))) AS CR_TERM 
                                    
        ,DECODE(CHG.FRT_TERM_CD, 'P'  ,(TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD'),'YYYYMMDD')
                                         - (TO_DATE(SUBSTR(MN2.F_POL_ETAETD,9,8),'YYYYMMDD')  
                                             + DECODE(NVL(MN2.OB_CUST_CRTERM, 0),0, MN2.OB_OFC_CRTERM, MN2.OB_CUST_CRTERM ))) 
                                      ,(TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD'),'YYYYMMDD')
                                         - (TO_DATE(SUBSTR(MN2.L_POD_ETAETD,1,8),'YYYYMMDD')  
                                             + DECODE(NVL(MN2.IB_CUST_CRTERM, 0),0, MN2.IB_OFC_CRTERM, MN2.IB_CUST_CRTERM )))) AS OVER_DUE
        ,DECODE( CHG.FRT_TERM_CD, 'P' ,MN2.GL_EX_PPD ,MN2.GL_EX_CCT     ) AS GL_EX
        ,DECODE( CHG.FRT_TERM_CD, 'P' ,MN2.LCL_TOT_PPD, MN2.LCL_TOT_CCT ) AS LCL_TOT
        ,DECODE( CHG.FRT_TERM_CD, 'P' ,MN2.USD_TOT_PPD, MN2.USD_TOT_CCT ) AS USD_TOT
        ,CHG.FRT_TERM_CD 
        ,MN2.AUD_STS_CD
        ,CHG.CURR_CD AS GRP_CUR 
        ,SUM(CHG.CHG_AMT) AS TOT_CURR_AMT 
        ,MN2.RT_APLY_DT
        ,MN2.COP_DEL_ETA
        ,MN2.VSK_DEL_ETA
        ,MN2.PRT_NO
FROM 
(
SELECT   MN.BKG_NO
        ,MN.BL_NO
        ,MN.RFA_NO
        ,MN.SC_NO
        ,MN.SCAC_CD 
        ,MN.BKG_OFC_CD 
        ,MN.POR_CD 
        ,MN.POD_CD 
        ,MN.POL_CD 
        ,MN.DEL_CD 
        ,MN.FNL_DEST_CD
        ,MN.RCV_TERM_CD
        ,MN.DE_TERM_CD
        ,MN.DEST_TRNS_SVC_MOD_CD
        ,MN.CMDT_CD
        ,MN.FNL_DEST_NM
        ,MN.TOT_PCK_QTY 
        ,MN.TOT_PCK_TP
        ,MN.ACT_WGT
        ,MN.TOT_WGT_UT_CD
        ,MN.TOT_MEAS_QTY
        ,MN.MEAS_UT_CD
        ,MN.VSL_NM
        ,MN.CSTMS_DESC
        ,MN.CONSIGNEE 
        ,MN.CN_GROUP_CUST
        ,MN.NOTIFY_PARTY
        ,MN.SHIPPER 
        ,MN.SH_GROUP_CUST
        ,MN.CONSIGNEE_NM
        ,MN.CN_GROUP_CUST_NM
        ,MN.NOTIFY_PARTY_NM
        ,MN.SHIPPER_NM
        ,MN.SHIPPER_ADDR
        ,MN.FORWARDER_ADDR
        ,MN.ACTUAL_CUST_NM
        ,MN.BKG_CNTC_EMAIL
        ,MN.BKG_CNTC_NM
        ,MN.PRE_RELAY_PORT
        ,MN.POST_RELAY_PORT
        ,MN.T_VVD   
        ,MN.T_LANE  
        ,MN.FST_VVD
        ,MN.OBRD_DT
        ,(SELECT TO_CHAR(V1.VPS_ETA_DT,'YYYYMMDD')||TO_CHAR(V1.VPS_ETD_DT,'YYYYMMDD') AS ETAETD
          FROM   VSK_VSL_PORT_SKD V1
          WHERE  V1.VSL_CD       = SUBSTR(MN.FST_VVD,1,4)
          AND    V1.SKD_VOY_NO   = SUBSTR(MN.FST_VVD,5,4)
          AND    V1.SKD_DIR_CD   = SUBSTR(MN.FST_VVD,9,1)
          AND    V1.VPS_PORT_CD  = MN.FST_POL
          AND    V1.CLPT_IND_SEQ = (SELECT MAX(V2.CLPT_IND_SEQ)
                                    FROM   VSK_VSL_PORT_SKD V2
                                    WHERE  V2.VSL_CD      = SUBSTR(MN.FST_VVD,1,4)
                                    AND    V2.SKD_VOY_NO  = SUBSTR(MN.FST_VVD,5,4)
                                    AND    V2.SKD_DIR_CD  = SUBSTR(MN.FST_VVD,9,1)
                                    AND    V2.VPS_PORT_CD = MN.FST_POL)
        ) AS F_POL_ETAETD
        
        ,MN.T_POL_ETAETD
        ,MN.T_POD_ETAETD
        ,(SELECT TO_CHAR(V3.VPS_ETA_DT,'YYYYMMDD')||TO_CHAR(V3.VPS_ETD_DT,'YYYYMMDD') AS ETAETD 
          FROM VSK_VSL_PORT_SKD V3
          WHERE   V3.VSL_CD = SUBSTR(MN.LST_VVD,1,4)
          AND     V3.SKD_VOY_NO = SUBSTR(MN.LST_VVD,5,4)
          AND     V3.SKD_DIR_CD = SUBSTR(MN.LST_VVD,9,1)
          AND     V3.VPS_PORT_CD = MN.LST_POD
          AND     V3.CLPT_IND_SEQ = (SELECT MAX(V4.CLPT_IND_SEQ)
                                     FROM   VSK_VSL_PORT_SKD V4
                                     WHERE  V4.VSL_CD     = SUBSTR(MN.LST_VVD,1,4)
                                     AND    V4.SKD_VOY_NO = SUBSTR(MN.LST_VVD,5,4)
                                     AND    V4.SKD_DIR_CD = SUBSTR(MN.LST_VVD,9,1)
                                     AND    V4.VPS_PORT_CD =  MN.LST_POD)
        ) AS L_POD_ETAETD  
      /*  RATE INV089 - INV112 */  
        ,MN.CCT_CUST 
        ,MN.THR_CUST
        ,MN.CCT_OFC 
        ,(SELECT NVL(MAX(CR.IB_CR_TERM_DYS),0) FROM MDM_CR_CUST CR
          WHERE CR.CUST_CNT_CD = SUBSTR(MN.CONSIGNEE,1,2)
          AND CR.CUST_SEQ      = SUBSTR(MN.CONSIGNEE,3,6)  )  AS IB_CUST_CRTERM  
        ,(SELECT M2.IB_CR_TERM_DYS 
          FROM  MDM_ORGANIZATION M1, MDM_ORGANIZATION M2
          WHERE  M1.OFC_CD = MN.CCT_OFC
          AND    M2.OFC_CD = M1.AR_OFC_CD)  AS IB_OFC_CRTERM
        ,MN.GL_EX_CCT  
        ,MN.LCL_TOT_CCT 
        ,MN.USD_TOT_CCT 
        ,MN.AUD_STS_CD
        ,MN.PPD_CUST 
        ,MN.PPD_OFC  
        ,(SELECT NVL(MAX(CR2.IB_CR_TERM_DYS),0) FROM MDM_CR_CUST CR2
          WHERE CR2.CUST_CNT_CD = SUBSTR(MN.SHIPPER,1,2)
          AND CR2.CUST_SEQ =  SUBSTR(MN.SHIPPER,3,6)  ) AS OB_CUST_CRTERM
        ,(SELECT M2.IB_CR_TERM_DYS 
          FROM   MDM_ORGANIZATION M1, MDM_ORGANIZATION M2
          WHERE  M1.OFC_CD = MN.PPD_OFC
          AND    M2.OFC_CD = M1.AR_OFC_CD)  AS OB_OFC_CRTERM
        ,MN.GL_EX_PPD  
        ,MN.LCL_TOT_PPD 
        ,MN.USD_TOT_PPD 
        ,MN.RT_APLY_DT 
        ,MN.COP_DEL_ETA  
        ,MN.VSK_DEL_ETA
        ,MN.PRT_NO
 FROM 
(
SELECT   A.BKG_NO
        ,A.BL_NO 
        ,A.SC_NO
        ,A.RFA_NO 
        ,'SMLM' AS SCAC_CD --- ,'HJSC' AS SCAC_CD
        ,A.BKG_OFC_CD
        ,A.POR_CD
        ,A.POD_CD 
        ,A.POL_CD
        ,A.DEL_CD 
        ,A.FNL_DEST_CD
        ,A.RCV_TERM_CD
        ,A.DE_TERM_CD
        ,A.DEST_TRNS_SVC_MOD_CD
        ,A.CMDT_CD
        ,B.FNL_DEST_NM
        ,B.PCK_QTY AS TOT_PCK_QTY
        ,B.PCK_TP_CD AS TOT_PCK_TP
        ,B.ACT_WGT
        ,B.WGT_UT_CD AS TOT_WGT_UT_CD
        ,B.MEAS_QTY  AS TOT_MEAS_QTY
        ,B.MEAS_UT_CD
        ,B.VSL_NM
        ,B.CSTMS_DESC
       /* CUSTOMER  */   
        ,( SELECT C1.CUST_CNT_CD||LPAD(TO_CHAR(C1.CUST_SEQ),6,'0')
           FROM   BKG_CUSTOMER C1
           WHERE  C1.BKG_NO = A.BKG_NO AND C1.BKG_CUST_TP_CD ='C' ) AS CONSIGNEE 
        ,( SELECT C1.CUST_NM
           FROM   BKG_CUSTOMER C1
           WHERE  C1.BKG_NO = A.BKG_NO AND C1.BKG_CUST_TP_CD ='C' ) AS CONSIGNEE_NM 
        ,(SELECT  SUBSTR(L1.CUST_GRP_ID,3,2)||SUBSTR(L1.CUST_GRP_ID,5,6)
          FROM    MDM_CUSTOMER L1, BKG_CUSTOMER C3
          WHERE   C3.BKG_NO = A.BKG_NO 
          AND     C3.CUST_CNT_CD = L1.CUST_CNT_CD 
          AND     C3.CUST_SEQ    = L1.CUST_SEQ
          AND     C3.BKG_CUST_TP_CD = 'C'  AND C3.BKG_NO=A.BKG_NO )  AS CN_GROUP_CUST 
        ,(SELECT  C3.CUST_NM
          FROM    MDM_CUSTOMER L1, BKG_CUSTOMER C3
          WHERE   C3.BKG_NO = A.BKG_NO 
          AND     C3.CUST_CNT_CD = L1.CUST_CNT_CD 
          AND     C3.CUST_SEQ    = L1.CUST_SEQ
          AND     C3.BKG_CUST_TP_CD = 'C'  AND C3.BKG_NO=A.BKG_NO )  AS CN_GROUP_CUST_NM  
        ,(SELECT  C5.CUST_CNT_CD||LPAD(TO_CHAR(C5.CUST_SEQ),6,'0')
          FROM    BKG_CUSTOMER C5
          WHERE C5.BKG_NO=A.BKG_NO AND C5.BKG_CUST_TP_CD ='N'  ) AS NOTIFY_PARTY  
        ,(SELECT C5.CUST_NM
          FROM BKG_CUSTOMER C5
          WHERE C5.BKG_NO=A.BKG_NO AND C5.BKG_CUST_TP_CD ='N'  ) AS NOTIFY_PARTY_NM   
        ,(SELECT C7.CUST_CNT_CD||LPAD(TO_CHAR(C7.CUST_SEQ),6,'0')
          FROM BKG_CUSTOMER C7
          WHERE C7.BKG_NO=A.BKG_NO AND C7.BKG_CUST_TP_CD ='S' )AS SHIPPER  
        ,(SELECT C7.CUST_NM
          FROM BKG_CUSTOMER C7
          WHERE C7.BKG_NO=A.BKG_NO AND C7.BKG_CUST_TP_CD ='S' )AS SHIPPER_NM  
        ,(SELECT SUBSTR(L3.CUST_GRP_ID,3,2)||SUBSTR(L3.CUST_GRP_ID,5,6)
          FROM   MDM_CUSTOMER L3, BKG_CUSTOMER C9
          WHERE  C9.BKG_NO         = A.BKG_NO  
          AND    C9.CUST_CNT_CD    = L3.CUST_CNT_CD 
          AND    C9.CUST_SEQ       = L3.CUST_SEQ
          AND    C9.BKG_CUST_TP_CD = 'S' ) AS SH_GROUP_CUST
        ,(SELECT C9.CUST_ADDR
          FROM BKG_CUSTOMER C9
          WHERE C9.BKG_NO=A.BKG_NO AND C9.BKG_CUST_TP_CD ='S' )AS SHIPPER_ADDR     
        ,(SELECT C9.CUST_NM
          FROM BKG_CUSTOMER C9
          WHERE C9.BKG_NO=A.BKG_NO AND C9.BKG_CUST_TP_CD ='F' )AS FORWARDER_ADDR
        ,(SELECT C9.CUST_NM
          FROM BKG_CUSTOMER C9
          WHERE C9.BKG_NO=A.BKG_NO AND C9.BKG_CUST_TP_CD ='E' )AS ACTUAL_CUST_NM
        ,(SELECT C10.CNTC_PSON_EML
          FROM BKG_CNTC_PSON C10
          WHERE C10.BKG_NO=A.BKG_NO AND C10.BKG_CNTC_PSON_TP_CD ='BK' )AS BKG_CNTC_EMAIL
        ,(SELECT C11.CNTC_PSON_NM
          FROM BKG_CNTC_PSON C11
          WHERE C11.BKG_NO=A.BKG_NO AND C11.BKG_CNTC_PSON_TP_CD ='BK' )AS BKG_CNTC_NM
  
       /* ROUTE CONDITION */
        ,(SELECT /*+ INDEX_DESC( K1 XPKBKG_VVD ) */ 
                 K1.POL_CD  
          FROM   BKG_VVD K1
          WHERE  K1.BKG_NO         = A.BKG_NO
          AND    K1.VSL_PRE_PST_CD = 'S'  AND ROWNUM = 1 )  AS PRE_RELAY_PORT 
        ,(SELECT /*+ INDEX( K2 XPKBKG_VVD ) */
                       K2.POL_CD
         FROM    BKG_VVD K2
         WHERE   K2.BKG_NO         = A.BKG_NO
         AND     K2.VSL_PRE_PST_CD = 'U' AND ROWNUM = 1 )   AS POST_RELAY_PORT  
                                                                                    
       /*  VESSEL  */
        ,(SELECT K3.VSL_CD||K3.SKD_VOY_NO||K3.SKD_DIR_CD  
          FROM BKG_VVD K3
          WHERE K3.BKG_NO = A.BKG_NO AND K3.VSL_PRE_PST_CD ='T' ) AS T_VVD   
        ,(SELECT K4.SLAN_CD FROM BKG_VVD K4
          WHERE K4.BKG_NO = A.BKG_NO AND K4.VSL_PRE_PST_CD ='T'  ) AS T_LANE 
        ,(SELECT /*+ INDEX( K5 XPKBKG_VVD ) */
                K5.VSL_CD||K5.SKD_VOY_NO||K5.SKD_DIR_CD 
          FROM  BKG_VVD K5
          WHERE K5.BKG_NO = A.BKG_NO  AND  ROWNUM = 1) AS FST_VVD    
       /* DATE,TIME */
        ,TO_CHAR(B.BL_OBRD_DT,'YYYY-MM-DD')  AS OBRD_DT   
        ,A.POL_CD  AS FST_POL 
        ,(SELECT TO_CHAR(KK.VPS_ETA_DT,'YYYYMMDD')||TO_CHAR(KK.VPS_ETD_DT,'YYYYMMDD') AS ETAETD 
          FROM VSK_VSL_PORT_SKD KK, BKG_VVD BB
          WHERE   KK.VSL_CD = BB.VSL_CD
          AND     KK.SKD_VOY_NO = BB.SKD_VOY_NO
          AND     KK.SKD_DIR_CD = BB.SKD_DIR_CD
          AND     KK.VPS_PORT_CD = BB.POL_CD
          AND     BB.VSL_PRE_PST_CD='T'
          AND     BB.BKG_NO = A.BKG_NO
          AND     KK.CLPT_IND_SEQ = (SELECT MAX(CLPT_IND_SEQ) FROM VSK_VSL_PORT_SKD
                                     WHERE  VSL_CD      = KK.VSL_CD
                                     AND    SKD_VOY_NO  = KK.SKD_VOY_NO
                                     AND    SKD_DIR_CD  = KK.SKD_DIR_CD
                                     AND    VPS_PORT_CD = KK.VPS_PORT_CD)
          ) AS T_POL_ETAETD     
        ,(SELECT TO_CHAR(KK1.VPS_ETA_DT,'YYYYMMDD')||TO_CHAR(KK1.VPS_ETD_DT,'YYYYMMDD') AS ETAETD 
          FROM VSK_VSL_PORT_SKD KK1, BKG_VVD BB1
          WHERE   KK1.VSL_CD         = BB1.VSL_CD
          AND     KK1.SKD_VOY_NO     = BB1.SKD_VOY_NO
          AND     KK1.SKD_DIR_CD     = BB1.SKD_DIR_CD
          AND     KK1.VPS_PORT_CD    = BB1.POD_CD
          AND     BB1.VSL_PRE_PST_CD = 'T'
          AND     BB1.BKG_NO         = A.BKG_NO
          AND     KK1.CLPT_IND_SEQ   = (SELECT MAX(CLPT_IND_SEQ)
                                        FROM   VSK_VSL_PORT_SKD
                                        WHERE  VSL_CD      = KK1.VSL_CD
                                        AND    SKD_VOY_NO  = KK1.SKD_VOY_NO
                                        AND    SKD_DIR_CD  = KK1.SKD_DIR_CD
                                        AND    VPS_PORT_CD = KK1.VPS_PORT_CD)
          ) AS T_POD_ETAETD           
        ,(SELECT /*+ INDEX_DESC( K6 XPKBKG_VVD ) */ 
                 K6.VSL_CD||K6.SKD_VOY_NO||K6.SKD_DIR_CD 
          FROM  BKG_VVD K6
          WHERE K6.BKG_NO = A.BKG_NO
          AND  ROWNUM = 1)     AS LST_VVD 
        ,A.POD_CD   AS LST_POD  
        ,(SELECT SUBSTR(MAX(DECODE(COPD.ACT_CD, 'FITRDO', '1', '0') || NVL(TO_CHAR(COPD.PLN_DT, 'YYYYMMDDHH24MISS'), '00000000000000')
                            || NVL(TO_CHAR(NVL(COPD.ACT_DT, COPD.ESTM_DT), 'YYYYMMDDHH24MISS'), '00000000000000')
                            || COPD.NOD_CD ), 2,8)
          FROM SCE_COP_HDR COPM  , SCE_COP_DTL COPD
          WHERE COPM.BKG_NO(+) = A.BKG_NO 
          AND COPD.COP_NO = COPM.COP_NO
          AND COPM.COP_STS_CD <> 'X'
          AND COPD.ACT_CD IN ('FITRDO', 'FUVMAD')  
         ) AS COP_DEL_ETA 
        ,(SELECT  TO_CHAR(VSKD.VPS_ETA_DT + DECODE(SUBSTR(A.POD_CD,1,2) , 'US', 2 , DECODE(A.POD_CD, A.DEL_CD, 1, 2)),'YYYY-MM-DD')  
          FROM BKG_VVD BVVD, VSK_VSL_PORT_SKD VSKD
          WHERE  BVVD.VSL_CD = VSKD.VSL_CD(+)  
          AND  BVVD.SKD_VOY_NO = VSKD.SKD_VOY_NO(+)
          AND  BVVD.SKD_DIR_CD = VSKD.SKD_DIR_CD(+)
          AND  BVVD.POD_CD = VSKD.VPS_PORT_CD(+)
          AND  BVVD.POD_CLPT_IND_SEQ = VSKD.CLPT_IND_SEQ(+)
          AND  A.BKG_NO = BVVD.BKG_NO
          AND  A.POD_CD = BVVD.POD_CD
          AND  ROWNUM = 1
          ) AS VSK_DEL_ETA         
        
      /*  RATE  INV089 - INV112 */  
        ,F.CLT_PAYR_CNT_CD||LPAD(TO_CHAR(F.CLT_PAYR_CUST_SEQ),6,'0') AS CCT_CUST   
        ,(SELECT N3PTY_CUST_CNT_CD||LPAD(TO_CHAR(N3PTY_CUST_SEQ),6,'0') FROM BKG_CHG_RT
          WHERE BKG_NO=A.BKG_NO 
          AND N3PTY_CUST_CNT_CD IS NOT NULL 
          AND N3PTY_CUST_SEQ IS NOT NULL AND ROWNUM=1) AS THR_CUST    
        ,F.CLT_OFC_CD   AS CCT_OFC        
        ,(SELECT GLM.USD_LOCL_XCH_RT 
          FROM BKG_CHG_RT R1, GL_MON_XCH_RT GLM
          WHERE R1.BKG_NO = A.BKG_NO
          AND R1.FRT_TERM_CD='C'
          AND R1.FRT_INCL_XCLD_DIV_CD ='N'
          AND GLM.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R1.CRE_DT,'YYYYMMDD'),1,6)
          AND GLM.ACCT_XCH_RT_LVL = '1'  
          AND GLM.CURR_CD =  (SELECT O2.AR_CURR_CD
                              FROM MDM_ORGANIZATION O1, MDM_ORGANIZATION O2
                              WHERE O1.OFC_CD =F.CLT_OFC_CD
                              AND  O2.OFC_CD = O1.AR_OFC_CD) 
          AND ROWNUM=1 )      AS GL_EX_CCT 
       ,(SELECT SUM(ROUND(R1.CHG_AMT*(GL2.USD_LOCL_XCH_RT/GL1.USD_LOCL_XCH_RT),2))    
         FROM BKG_CHG_RT R1, GL_MON_XCH_RT GL1, GL_MON_XCH_RT GL2 
         WHERE R1.BKG_NO = A.BKG_NO
         AND R1.FRT_TERM_CD='C'
         AND R1.FRT_INCL_XCLD_DIV_CD ='N'
         AND GL1.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R1.CRE_DT,'YYYYMMDD'),1,6)
         AND GL1.ACCT_XCH_RT_LVL = '1'  
         AND GL1.CURR_CD = R1.CURR_CD
         AND GL2.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R1.CRE_DT,'YYYYMMDD'),1,6)
         AND GL2.ACCT_XCH_RT_LVL = '1'  
         AND GL2.CURR_CD =  (SELECT O2.AR_CURR_CD
                             FROM MDM_ORGANIZATION O1, MDM_ORGANIZATION O2
                             WHERE O1.OFC_CD =F.CLT_OFC_CD
                             AND  O2.OFC_CD = O1.AR_OFC_CD)   ) AS LCL_TOT_CCT --INV099
        ,(SELECT SUM(ROUND(R1.CHG_AMT/GL1.USD_LOCL_XCH_RT,2))    
          FROM BKG_CHG_RT R1, GL_MON_XCH_RT GL1 
          WHERE R1.BKG_NO = A.BKG_NO
          AND R1.FRT_TERM_CD ='C'
          AND R1.FRT_INCL_XCLD_DIV_CD ='N'
          AND GL1.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R1.CRE_DT,'YYYYMMDD'),1,6)
          AND GL1.ACCT_XCH_RT_LVL = '1'  
          AND GL1.CURR_CD = R1.CURR_CD            ) AS USD_TOT_CCT 
        ,F.AUD_STS_CD  AS AUD_STS_CD  
        ,F.PPD_PAYR_CNT_CD||LPAD(TO_CHAR(F.PPD_PAYR_CUST_SEQ),6,'0') AS PPD_CUST
        ,F.PPD_RCV_OFC_CD   AS PPD_OFC    
        ,(SELECT GLM.USD_LOCL_XCH_RT 
          FROM BKG_CHG_RT R1, GL_MON_XCH_RT GLM
          WHERE R1.BKG_NO = A.BKG_NO
          AND R1.FRT_TERM_CD='P'
          AND  R1.FRT_INCL_XCLD_DIV_CD ='N'
          AND GLM.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R1.CRE_DT,'YYYYMMDD'),1,6)
          AND GLM.ACCT_XCH_RT_LVL = '1'  
          AND GLM.CURR_CD =  (SELECT O2.AR_CURR_CD
                              FROM MDM_ORGANIZATION O1, MDM_ORGANIZATION O2
                              WHERE O1.OFC_CD =F.PPD_RCV_OFC_CD
                              AND  O2.OFC_CD = O1.AR_OFC_CD )
          AND ROWNUM=1     )      AS GL_EX_PPD  
        ,(SELECT SUM(ROUND(R2.CHG_AMT*(GL4.USD_LOCL_XCH_RT/GL3.USD_LOCL_XCH_RT),2))    
          FROM BKG_CHG_RT R2, GL_MON_XCH_RT GL3, GL_MON_XCH_RT GL4
          WHERE R2.BKG_NO = A.BKG_NO
          AND   R2.FRT_TERM_CD ='P'
          AND   R2.FRT_INCL_XCLD_DIV_CD ='N'
          AND   GL3.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R2.CRE_DT,'YYYYMMDD'),1,6)
          AND   GL3.ACCT_XCH_RT_LVL = '1'  
          AND   GL3.CURR_CD = R2.CURR_CD
          AND   GL4.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R2.CRE_DT,'YYYYMMDD'),1,6)
          AND   GL4.ACCT_XCH_RT_LVL = '1'  
          AND   GL4.CURR_CD =  (SELECT O2.AR_CURR_CD
                                FROM MDM_ORGANIZATION O1, MDM_ORGANIZATION O2
                                WHERE O1.OFC_CD =F.PPD_RCV_OFC_CD
                                AND  O2.OFC_CD = O1.AR_OFC_CD)   ) AS LCL_TOT_PPD 

        ,(SELECT SUM(ROUND(R1.CHG_AMT/GL1.USD_LOCL_XCH_RT,2))    
          FROM BKG_CHG_RT R1, GL_MON_XCH_RT GL1 
          WHERE R1.BKG_NO = A.BKG_NO
          AND R1.FRT_TERM_CD='P'
          AND R1.FRT_INCL_XCLD_DIV_CD ='N'
          AND GL1.ACCT_XCH_RT_YRMON =  SUBSTR(TO_CHAR(R1.CRE_DT,'YYYYMMDD'),1,6)
          AND GL1.ACCT_XCH_RT_LVL = '1'  
          AND GL1.CURR_CD = R1.CURR_CD            ) AS USD_TOT_PPD 
        ,TO_CHAR(F.RT_APLY_DT,'YYYY-MM-DD') RT_APLY_DT 
        ,REPLACE(substr(xmlagg(xmlelement(a,';' || T.PRT_NO) order by T.PRT_NO).extract('//text()'), 2),';;','') PRT_NO
FROM   BKG_BOOKING A
      ,BKG_BL_DOC B
      ,BKG_RATE F
      , BKG_REF_DTL T
    #if (${cust_gb} == 'S' || ${cust_gb} == 'C' || ${cust_gb} == 'N')
		#if (${cust_cnt_cd} != '' && ${cust_seq} != '')
  	  ,BKG_CUSTOMER G 
  		#end
  	#end
  	#if (${date_gb} == '1STVVD' || ${date_gb} == 'ETA' || ${date_gb} == 'ETD')
      , BKG_VVD             T11
      , VSK_VSL_PORT_SKD    T12
  	#end
WHERE  1=1
AND  A.BKG_NO = B.BKG_NO(+)
AND  A.BKG_NO = F.BKG_NO(+)
AND  A.BKG_NO = T.BKG_NO(+)
AND  A.BKG_STS_CD IN ('F','S')
AND  A.BKG_CGO_TP_CD <> 'P'
#if (${sc_no} != '')
AND		A.SC_NO = @[sc_no]
#end
#if (${rfa_no} != '')
AND		A.RFA_NO = @[rfa_no]
#end
#if (${bkg_ofc_cd} != '')
AND		A.BKG_OFC_CD = @[bkg_ofc_cd]
#end
#if (${ob_sls_ofc_cd} != '')
AND		A.OB_SLS_OFC_CD = @[ob_sls_ofc_cd]
#end
#if (${cust_gb} == 'S')
	#if (${cust_cnt_cd} != '' && ${cust_seq} != '')
		AND A.BKG_NO = G.BKG_NO(+)
		AND G.BKG_CUST_TP_CD='S'
		AND G.Cust_Cnt_Cd =@[cust_cnt_cd]
		AND G.Cust_Seq = @[cust_seq]
	#end
#end
#if (${cust_gb} == 'C')
	#if (${cust_cnt_cd} != '' && ${cust_seq} != '')
		AND A.BKG_NO = G.BKG_NO(+)
		AND G.BKG_CUST_TP_CD='C'
		AND G.Cust_Cnt_Cd =@[cust_cnt_cd]
		AND G.Cust_Seq = @[cust_seq]
  	#end
#end
#if (${cust_gb} == 'N')
	#if (${cust_cnt_cd} != '' && ${cust_seq} != '')
		AND A.BKG_NO = G.BKG_NO(+)
		AND G.BKG_CUST_TP_CD='N'
		AND G.Cust_Cnt_Cd =@[cust_cnt_cd]
		AND G.Cust_Seq = @[cust_seq]
  	#end
#end
#if (${del_cd} != '')
AND  A.DEL_CD like @[del_cd]||'%'
#end
#if (${por_cd} != '')
AND  A.POR_CD like @[por_cd]||'%'
#end
#if (${pol_cd} != '')
AND  A.POL_CD like @[pol_cd]||'%'
#end
#if (${pod_cd} != '')
AND  A.POD_CD like @[pod_cd]||'%'
#end
#if (${date_gb} == '1STVVD')
AND     T11.BKG_NO  (+)      = A.BKG_NO
AND     T11.VSL_CD           = T12.VSL_CD
AND     T11.SKD_VOY_NO       = T12.SKD_VOY_NO
AND     T11.SKD_DIR_CD       = T12.SKD_DIR_CD
AND     T11.POL_CD           = T12.VPS_PORT_CD
AND     T11.POL_YD_CD        = T12.YD_CD
AND     T11.POL_CLPT_IND_SEQ = T12.CLPT_IND_SEQ
AND     T11.ROWID            =
        (
        SELECT  SUBSTR(MIN( S.VSL_PRE_PST_CD || LTRIM( TO_CHAR( S.VSL_SEQ , '000') )  || ROWID ), 5) -- 1st VVD
        FROM    BKG_VVD S
        WHERE   1=1
        AND     S.BKG_NO    = T11.BKG_NO
        )
AND     T12.VPS_ETD_DT BETWEEN TO_DATE(REPLACE(@[from_date],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999
AND		NVL(T12.SKD_CNG_STS_CD, ' ') <> 'S'
#end

#if (${date_gb} == 'ETD')
	#if (${from_date} != '' && ${to_date} != '')
AND     T11.BKG_NO  (+)      = A.BKG_NO
AND     T11.VSL_CD           = T12.VSL_CD
AND     T11.SKD_VOY_NO       = T12.SKD_VOY_NO
AND     T11.SKD_DIR_CD       = T12.SKD_DIR_CD
AND     T11.POL_CD           = T12.VPS_PORT_CD
AND     T11.POL_YD_CD        = T12.YD_CD
AND     T11.POL_CLPT_IND_SEQ = T12.CLPT_IND_SEQ
AND     T11.VSL_PRE_PST_CD   = 'T'
AND     T12.VPS_ETD_DT BETWEEN TO_DATE(REPLACE(@[from_date],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999
AND		NVL(T12.SKD_CNG_STS_CD, ' ') <> 'S'
	#end 
#end 
#if (${date_gb} == 'ETA')
	#if (${from_date} != '' && ${to_date} != '')
AND     T11.BKG_NO  (+)      = A.BKG_NO
AND     T11.VSL_CD           = T12.VSL_CD
AND     T11.SKD_VOY_NO       = T12.SKD_VOY_NO
AND     T11.SKD_DIR_CD       = T12.SKD_DIR_CD
AND     T11.POD_CD           = T12.VPS_PORT_CD
AND     T11.POD_YD_CD        = T12.YD_CD
AND     T11.POD_CLPT_IND_SEQ = T12.CLPT_IND_SEQ
AND     T11.VSL_PRE_PST_CD   = 'T'
AND     T12.VPS_ETA_DT BETWEEN TO_DATE(REPLACE(@[from_date],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999
AND		NVL(T12.SKD_CNG_STS_CD, ' ') <> 'S'
	#end 
#end

#if (${date_gb} == 'OBD')
	#if (${from_date} != '' && ${to_date} != '')
AND B.BL_OBRD_DT between to_date(REPLACE(@[from_date],'-',''),'YYYYMMDD') and to_date(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999
	#end 
#end 
#if (${date_gb} == 'PCD')
	#if (${from_date} != '' && ${to_date} != '')	
AND A.PORT_CLZ_DT  between to_date(REPLACE(@[from_date],'-',''),'YYYYMMDD') and to_date(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999
	#end 
#end 
#if (${date_gb} == 'BDR')
	#if (${from_date} != '' && ${to_date} != '')
AND B.BDR_DT  between to_date(REPLACE(@[from_date],'-',''),'YYYYMMDD') and to_date(REPLACE(@[to_date],'-',''),'YYYYMMDD')+0.99999
	#end 
#end 
GROUP BY A.BKG_NO       ,A.BL_NO 
        ,A.SC_NO        ,A.RFA_NO 
        ,SCAC_CD        ,A.BKG_OFC_CD
        ,A.POR_CD       ,A.POD_CD 
        ,A.POL_CD       ,A.DEL_CD 
        ,A.FNL_DEST_CD  ,A.RCV_TERM_CD
        ,A.DE_TERM_CD   ,A.DEST_TRNS_SVC_MOD_CD
        ,A.CMDT_CD      ,B.FNL_DEST_NM
        ,B.PCK_QTY      ,B.PCK_TP_CD
        ,B.ACT_WGT      ,B.WGT_UT_CD
        ,B.MEAS_QTY     ,B.MEAS_UT_CD
        ,B.VSL_NM       ,B.CSTMS_DESC
        ,B.BL_OBRD_DT   ,F.CLT_PAYR_CNT_CD||LPAD(TO_CHAR(F.CLT_PAYR_CUST_SEQ),6,'0') 
        ,F.CLT_OFC_CD   ,F.AUD_STS_CD
        ,F.PPD_PAYR_CNT_CD||LPAD(TO_CHAR(F.PPD_PAYR_CUST_SEQ),6,'0') 
        ,F.PPD_RCV_OFC_CD
        ,F.RT_APLY_DT
) MN
WHERE 1=1
#if (${cust_gb} == 'GS')
	#if (${cust_cnt_cd} != '' && ${cust_seq} != '')
AND MN.SH_GROUP_CUST = @[cust_cnt_cd] || @[cust_seq]
	#end 
#end 
#if (${cust_gb} == 'GC')
	#if (${cust_cnt_cd} != '' && ${cust_seq} != '')
AND MN.CN_GROUP_CUST = @[cust_cnt_cd] || @[cust_seq]
	#end 
#end 
#if (${date_gb} == 'ETD')
	#if (${from_date} != '' && ${to_date} != '')
AND SUBSTR(MN.T_POL_ETAETD, 9,8) between REPLACE(@[from_date],'-','') and REPLACE(@[to_date],'-','')
	#end 
#end 
#if (${date_gb} == 'ETA')
	#if (${from_date} != '' && ${to_date} != '')
AND SUBSTR(MN.T_POD_ETAETD, 1,8) between REPLACE(@[from_date],'-','') and REPLACE(@[to_date],'-','')
	#end 
#end 
#if (${vvd} != '')
and MN.T_VVD = @[vvd]
#end
)MN2  /* TOT Rate Per Currency */
,BKG_CHG_RT CHG
WHERE MN2.BKG_NO  = CHG.BKG_NO(+)
AND   CHG.FRT_INCL_XCLD_DIV_CD(+) ='N'
#if (${frt_term_cd} != 'A')
AND   CHG.FRT_TERM_CD(+) = @[frt_term_cd]
#end
GROUP BY  MN2.BKG_NO             ,MN2.BL_NO
         ,MN2.RFA_NO             ,MN2.SC_NO 
         ,MN2.SCAC_CD            ,MN2.BKG_OFC_CD 
         ,MN2.POR_CD             ,MN2.POD_CD 
         ,MN2.POL_CD             ,MN2.DEL_CD 
         ,MN2.FNL_DEST_CD        ,MN2.RCV_TERM_CD
         ,MN2.DE_TERM_CD         ,MN2.DEST_TRNS_SVC_MOD_CD
         ,MN2.CMDT_CD            ,MN2.FNL_DEST_NM
         ,MN2.TOT_PCK_QTY        ,MN2.TOT_PCK_TP
         ,MN2.ACT_WGT            ,MN2.TOT_WGT_UT_CD
         ,MN2.TOT_MEAS_QTY       ,MN2.MEAS_UT_CD
         ,MN2.VSL_NM             ,MN2.CSTMS_DESC
         ,MN2.CONSIGNEE          ,MN2.CN_GROUP_CUST
         ,MN2.NOTIFY_PARTY       ,MN2.SHIPPER
         ,MN2.SH_GROUP_CUST      ,MN2.CONSIGNEE_NM
         ,MN2.CN_GROUP_CUST_NM   ,MN2.NOTIFY_PARTY_NM
         ,MN2.SHIPPER_NM         ,MN2.SHIPPER_ADDR
         ,MN2.FORWARDER_ADDR     ,MN2.ACTUAL_CUST_NM
         ,MN2.BKG_CNTC_EMAIL     ,MN2.BKG_CNTC_NM 
         ,MN2.PRE_RELAY_PORT
         ,MN2.POST_RELAY_PORT    ,MN2.T_VVD
         ,MN2.T_LANE             ,MN2.FST_VVD      ,MN2.OBRD_DT
         ,SUBSTR(MN2.F_POL_ETAETD,1,8)  ,SUBSTR(MN2.F_POL_ETAETD,9,8)
         ,MN2.OB_CUST_CRTERM            ,MN2.OB_OFC_CRTERM
         ,SUBSTR(MN2.T_POL_ETAETD,1,8)  ,SUBSTR(MN2.T_POL_ETAETD,9,8)
         ,SUBSTR(MN2.T_POD_ETAETD,1,8)  ,SUBSTR(MN2.T_POD_ETAETD,9,8)
         ,SUBSTR(MN2.L_POD_ETAETD,1,8)	,SUBSTR(MN2.L_POD_ETAETD,9,8) 
         ,MN2.IB_CUST_CRTERM     ,MN2.IB_OFC_CRTERM
         ,MN2.CCT_CUST           ,MN2.THR_CUST      ,MN2.CCT_OFC      ,MN2.GL_EX_CCT 
         ,MN2.LCL_TOT_CCT        ,MN2.USD_TOT_CCT   ,MN2.AUD_STS_CD   ,MN2.PPD_CUST 
         ,MN2.PPD_OFC            ,MN2.GL_EX_PPD     ,MN2.LCL_TOT_PPD  ,MN2.USD_TOT_PPD 
         ,CHG.CURR_CD            ,MN2.RT_APLY_DT    ,MN2.COP_DEL_ETA  ,MN2.VSK_DEL_ETA
         ,CHG.FRT_TERM_CD        ,MN2.PRT_NO
)MN3
,BKG_CHG_RT CHG2
WHERE MN3.BKG_NO  = CHG2.BKG_NO(+)
AND   CHG2.FRT_INCL_XCLD_DIV_CD(+) ='N'
AND   MN3.FRT_TERM_CD = CHG2.FRT_TERM_CD(+)
#if (${frt_term_cd} != 'A')
AND   CHG2.FRT_TERM_CD(+) = @[frt_term_cd]
#end
AND   MN3.GRP_CUR = CHG2.CURR_CD(+)
GROUP BY   MN3.BKG_NO         ,MN3.BL_NO                ,MN3.RFA_NO            ,MN3.SC_NO
          ,MN3.SCAC_CD        ,MN3.BKG_OFC_CD           ,MN3.POR_CD            ,MN3.POD_CD 
          ,MN3.POL_CD         ,MN3.DEL_CD               ,MN3.FNL_DEST_CD       ,MN3.RCV_TERM_CD
          ,MN3.DE_TERM_CD     ,MN3.DEST_TRNS_SVC_MOD_CD ,MN3.CMDT_CD           ,MN3.FNL_DEST_NM
          ,MN3.TOT_PCK_QTY    ,MN3.TOT_PCK_TP           ,MN3.ACT_WGT           ,MN3.TOT_WGT_UT_CD
          ,MN3.TOT_MEAS_QTY   ,MN3.MEAS_UT_CD           ,MN3.VSL_NM            ,MN3.CSTMS_DESC
          ,MN3.CONSIGNEE      ,MN3.CN_GROUP_CUST        ,MN3.NOTIFY_PARTY      ,MN3.SHIPPER
          ,MN3.SH_GROUP_CUST  ,MN3.CONSIGNEE_NM   	    ,MN3.CN_GROUP_CUST_NM  ,MN3.NOTIFY_PARTY_NM
  	      ,MN3.SHIPPER_NM     ,MN3.SHIPPER_ADDR         ,MN3.FORWARDER_ADDR    ,MN3.ACTUAL_CUST_NM
          ,MN3.BKG_CNTC_EMAIL ,MN3.BKG_CNTC_NM          ,MN3.PRE_RELAY_PORT    ,MN3.POST_RELAY_PORT   ,MN3.T_VVD
          ,MN3.T_LANE         ,MN3.FST_VVD              ,MN3.OBRD_DT           ,MN3.F_POL_ETA
          ,MN3.F_POL_ETD      ,MN3.T_POL_ETA            ,MN3.T_POL_ETD
          ,MN3.T_POD_ETA      ,MN3.T_POD_ETD            ,MN3.L_POD_ETA         ,MN3.L_POD_ETD
          ,MN3.DUEDT          ,MN3.BILL_CUST            ,MN3.THR_CUST          ,MN3.OTS_OFC
          ,MN3.CR_TERM        ,MN3.GL_EX                ,MN3.LCL_TOT           ,MN3.USD_TOT  
          ,MN3.OVER_DUE       ,MN3.AUD_STS_CD           ,MN3.GRP_CUR           ,MN3.TOT_CURR_AMT 
          ,CHG2.CHG_CD        ,CHG2.CURR_CD             ,CHG2.RAT_AS_QTY       ,CHG2.CHG_UT_AMT 
          ,MN3.RT_APLY_DT     ,MN3.COP_DEL_ETA          ,MN3.VSK_DEL_ETA       ,MN3.FRT_TERM_CD
          ,MN3.PRT_NO
)MN4
,BKG_CONTAINER  CNTR
,BKG_CNTR_RT    CHG3
,MDM_CHARGE     CHG_M
WHERE MN4.BKG_NO      = CNTR.BKG_NO (+)
AND   MN4.BKG_NO      = CHG3.BKG_NO (+)
AND   MN4.GRP_CUR     = CHG3.CURR_CD(+)
AND   CHG3.FRT_INCL_XCLD_DIV_CD(+) ='N'
AND   MN4.FRT_TERM_CD = CHG3.FRT_TERM_CD(+)
#if (${frt_term_cd} != 'A')
AND   MN4.FRT_TERM_CD = @[frt_term_cd]
AND   CHG3.FRT_TERM_CD(+) = @[frt_term_cd]
#end
AND   CHG3.CHG_CD = CHG_M.CHG_CD (+)
AND   CNTR.CNTR_NO = NVL(CHG3.CNTR_NO,CNTR.CNTR_NO)
GROUP BY 
         MN4.BKG_NO         ,MN4.BL_NO            ,MN4.RFA_NO
        ,MN4.SC_NO          ,MN4.SCAC_CD          ,MN4.BKG_OFC_CD       ,MN4.POR_CD 
        ,MN4.POD_CD         ,MN4.POL_CD           ,MN4.DEL_CD           ,MN4.FNL_DEST_CD
        ,MN4.RCV_TERM_CD    ,MN4.DE_TERM_CD       ,MN4.DEST_TRNS_SVC_MOD_CD
        ,MN4.CMDT_CD        ,MN4.FNL_DEST_NM      ,MN4.TOT_PCK_QTY      ,MN4.TOT_PCK_TP
        ,MN4.ACT_WGT        ,MN4.TOT_WGT_UT_CD    ,MN4.TOT_MEAS_QTY
        ,MN4.MEAS_UT_CD     ,MN4.VSL_NM           ,MN4.CSTMS_DESC       ,MN4.CONSIGNEE
        ,MN4.CN_GROUP_CUST  ,MN4.NOTIFY_PARTY     ,MN4.SHIPPER          ,MN4.SH_GROUP_CUST
        ,MN4.CONSIGNEE_NM   ,MN4.CN_GROUP_CUST_NM ,MN4.NOTIFY_PARTY_NM  ,MN4.SHIPPER_NM
        ,MN4.SHIPPER_ADDR   ,MN4.FORWARDER_ADDR   ,MN4.ACTUAL_CUST_NM   ,MN4.BKG_CNTC_EMAIL
        ,MN4.BKG_CNTC_NM    ,MN4.PRE_RELAY_PORT   ,MN4.POST_RELAY_PORT
        ,MN4.T_VVD          ,MN4.T_LANE           ,MN4.FST_VVD          ,MN4.OBRD_DT
        ,MN4.F_POL_ETA      ,MN4.F_POL_ETD        ,MN4.T_POL_ETA
        ,MN4.T_POL_ETD      ,MN4.T_POD_ETA        ,MN4.T_POD_ETD        ,MN4.L_POD_ETA
        ,MN4.L_POD_ETD      ,CNTR.CGO_RCV_DT      ,MN4.DUEDT            ,MN4.BILL_CUST
        ,MN4.THR_CUST       ,MN4.OTS_OFC          ,MN4.CR_TERM          ,MN4.GL_EX
        ,MN4.LCL_TOT        ,MN4.USD_TOT          ,MN4.OVER_DUE         ,MN4.AUD_STS_CD 
        ,MN4.GRP_CUR        ,DECODE(CHG3.CURR_CD, NULL, 0, MN4.TOT_CURR_AMT),MN4.CHG_CD           ,MN4.CHG_CURR
        ,MN4.CHG_RATED_AS   ,MN4.CHG_RATE         ,MN4.CHG_SUM          ,CNTR.CNTR_NO             ,CNTR.CNMV_CYC_NO ,CNTR.CNMV_YR
        ,CNTR.MEAS_QTY      ,CNTR.CNTR_PRT_FLG    ,CNTR.CNTR_TPSZ_CD    ,CNTR.CNTR_VOL_QTY
        ,CNTR.PCK_QTY       ,CNTR.PCK_TP_CD       ,CNTR.CNTR_WGT        ,CNTR.WGT_UT_CD
        ,NVL(CNTR.DCGO_FLG, NVL(CNTR.RC_FLG,NVL(CNTR.BB_CGO_FLG,NVL(CNTR.AWK_CGO_FLG,'')))) 
        ,CHG3.CURR_CD       ,MN4.RT_APLY_DT       ,MN4.COP_DEL_ETA      ,MN4.VSK_DEL_ETA
        ,MN4.FRT_TERM_CD    ,MN4.PRT_NO
        ,CHG_T.FLG01  ,CHG_T.FLG02  ,CHG_T.FLG03   ,CHG_T.FLG04  ,CHG_T.FLG05
        ,CHG_T.CHG01  ,CHG_T.CHG02  ,CHG_T.CHG03   ,CHG_T.CHG04  ,CHG_T.CHG05

)MN5
,BKG_CNTR_RT CHG4
,BKG_BL_ISS N
,BKG_ARR_NTC O
,BKG_CGO_RLSE W 
WHERE MN5.BKG_NO  = CHG4.BKG_NO(+)
AND   MN5.GRP_CUR = CHG4.CURR_CD(+)
AND   MN5.CHG_CD  = CHG4.CHG_CD(+)
AND   MN5.CNTR_NO = CHG4.CNTR_NO(+) 
AND   CHG4.FRT_INCL_XCLD_DIV_CD(+) ='N'
AND   MN5.FRT_TERM_CD = CHG4.FRT_TERM_CD(+)
#if (${frt_term_cd} != 'A')
AND   CHG4.FRT_TERM_CD(+) = @[frt_term_cd]
#end
AND   MN5.BKG_NO  = N.BKG_NO(+)
AND   MN5.BKG_NO  = O.BKG_NO(+)
AND   MN5.BL_NO   = W.BL_NO(+)
GROUP BY 
         MN5.BKG_NO          ,MN5.BL_NO                ,MN5.RFA_NO           ,MN5.SC_NO
        ,MN5.SCAC_CD         ,MN5.BKG_OFC_CD           ,MN5.POR_CD           ,MN5.POD_CD 
        ,MN5.POL_CD          ,MN5.DEL_CD               ,MN5.FNL_DEST_CD      ,MN5.RCV_TERM_CD
        ,MN5.DE_TERM_CD      ,MN5.DEST_TRNS_SVC_MOD_CD ,MN5.CMDT_CD          ,MN5.FNL_DEST_NM
        ,MN5.TOT_PCK_QTY     ,MN5.TOT_PCK_TP           ,MN5.ACT_WGT          ,MN5.TOT_WGT_UT_CD
        ,MN5.TOT_MEAS_QTY    ,MN5.MEAS_UT_CD           ,MN5.VSL_NM           ,MN5.CSTMS_DESC
        ,MN5.CNTR_SP_CGO_FG  ,MN5.CONSIGNEE            ,MN5.CN_GROUP_CUST    ,MN5.NOTIFY_PARTY
        ,MN5.SHIPPER         ,MN5.SH_GROUP_CUST	       ,MN5.CONSIGNEE_NM	 ,MN5.CN_GROUP_CUST_NM
        ,MN5.NOTIFY_PARTY_NM ,MN5.SHIPPER_NM           ,MN5.SHIPPER_ADDR     ,MN5.FORWARDER_ADDR
        ,MN5.ACTUAL_CUST_NM  ,MN5.BKG_CNTC_EMAIL       ,MN5.BKG_CNTC_NM      ,MN5.PRE_RELAY_PORT   ,MN5.POST_RELAY_PORT
        ,MN5.T_VVD           ,MN5.T_LANE               ,MN5.FST_VVD          ,TO_CHAR(O.DEL_ARR_DT,'YYYY-MM-DD') 
        ,TO_CHAR(O.PKUP_FREE_DT,'YYYY-MM-DD')          ,MN5.OBRD_DT          ,MN5.F_POL_ETA               ,MN5.F_POL_ETD
        ,MN5.T_POL_ETA       ,MN5.T_POL_ETD            ,MN5.T_POD_ETA        ,MN5.T_POD_ETD
        ,MN5.L_POD_ETA       ,MN5.L_POD_ETD            ,MN5.CGO_RCV_DT       ,MN5.DUEDT
        ,MN5.BILL_CUST	     ,MN5.THR_CUST             ,MN5.OTS_OFC          ,MN5.CR_TERM 
        ,MN5.GL_EX           ,MN5.LCL_TOT              ,MN5.USD_TOT          ,MN5.OVER_DUE
        ,MN5.AUD_STS_CD      ,MN5.GRP_CUR              ,MN5.TOT_CURR_AMT     ,MN5.CHG_CD
        ,MN5.CHG_CURR        ,MN5.CHG_RATED_AS         ,MN5.CHG_RATE         ,MN5.CHG_SUM
        ,MN5.CNTR_NO         ,MN5.MEAS_QTY             ,MN5.CNTR_PRT_FLG     ,MN5.CNMV_CYC_NO           ,MN5.CNMV_YR
        ,MN5.CNTR_SEAL_NO    ,MN5.CNTR_SZ_CD           ,MN5.CNTR_TPSZ_CD     ,MN5.CNTR_VOL_QTY
        ,MN5.PCK_QTY         ,MN5.PCK_TP_CD            ,MN5.CNTR_WGT         ,MN5.WGT_UT_CD
        ,MN5.CNTR_CHG_CURR   ,MN5.CNTR_SUM             ,N.OBL_ISS_OFC_CD     ,TO_CHAR(N.OBL_ISS_DT,'YYYY-MM-DD')
        ,W.FRT_CLT_FLG       ,W.OBL_RDEM_FLG           ,W.CSTMS_CLR_CD       ,W.CSTMS_CLR_LST_DT
        ,MN5.RT_APLY_DT      ,MN5.COP_DEL_ETA          ,MN5.VSK_DEL_ETA      ,MN5.FRT_TERM_CD
        ,MN5.PRT_NO
        ,MN5.CHG001          ,MN5.CHG002               ,MN5.CHG003           ,MN5.CHG004                ,MN5.CHG005
        ,MN5.CHG001_S        ,MN5.CHG002_S             ,MN5.CHG003_S         ,MN5.CHG004_S              ,MN5.CHG005_S

ORDER BY MN5.BKG_NO ,MN5.GRP_CUR,MN5.CHG_CD ,MN5.CNTR_NO 
)
GROUP BY
RPT_TMPLT_NM, FRT_TERM_CD, INV002
#foreach( ${key} in ${allcols}) 
	#if($key == 'INV004'||$key == 'INV008'||$key == 'INV047'||$key == 'INV062'||$key == 'INV064'||$key == 'INV066'||$key == 'INV067'||$key == 'INV068'||$key == 'INV080')
	,''
	#elseif($key == 'INV074'||$key == 'INV075'||$key == 'INV112'||$key == 'INV141')
	,''
	#elseif($key == 'INV102'||$key == 'INV106'||$key == 'INV107'||$key == 'INV131')
	, INV103
	#elseif($key == 'CHG001'||$key == 'CHG002'||$key == 'CHG003'||$key == 'CHG004'||$key == 'CHG005'||$key == 'CHG999')
	, INV103
	#else
		,$key
	#end	
#end
ORDER BY INV002, FRT_TERM_CD			]]></sql>
			<params>
				<param name="rpt_tmplt_nm" type="12" value="" out="N"/>
				<param name="frt_term_cd" type="12" value="" out="N"/>
				<param name="ar_ofc_cd" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
				<param name="rfa_no" type="12" value="" out="N"/>
				<param name="bkg_ofc_cd" type="12" value="" out="N"/>
				<param name="ob_sls_ofc_cd" type="12" value="" out="N"/>
				<param name="cust_cnt_cd" type="12" value="" out="N"/>
				<param name="cust_seq" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
				<param name="por_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="from_date" type="12" value="" out="N"/>
				<param name="to_date" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
