<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="JointOperationMasterDataMgtDBDAOGetNextJoRefNoRSQL">
			<desc><![CDATA[DESC Enter..
2012.06.01 : 김상근[CHM-201218057-01]
Discription : Key 생성규칙변경(OFC+수입/비용 구분+TRADE+REV LANE+Direction(추가)+년월+일련번호(3자리)]]></desc>
			<sql><![CDATA[
SELECT JO_REF_NO
FROM   (
        SELECT JO_REF_NO, ROW_NUMBER() OVER (ORDER BY PRIORITY) RN
          FROM (
                SELECT /*+INDEX_DESC(A XPKJOO_BZC_AGMT)*/
                       1 AS PRIORITY,
                       @[ofc_cd]||'-'||@[re_divr_cd]||'-'||@[trd_cd]||'-'||@[rlane_cd]||'-'||@[skd_dir_cd]||'-'||TO_CHAR(SYSDATE,'RRMM')||'-'||LPAD(TO_NUMBER(SUBSTR(JO_REF_NO,-3))+1,3,'0') JO_REF_NO
                  FROM JOO_BZC_AGMT A
                 WHERE JO_REF_NO LIKE @[ofc_cd]||'-'||@[re_divr_cd]||'-'||@[trd_cd]||'-'||@[rlane_cd]||'-'||@[skd_dir_cd]||'-'||TO_CHAR(SYSDATE,'RRMM')||'-'||'%'
                   AND ROWNUM    = 1
                UNION ALL
                SELECT 
                       2 AS PRIORITY,
                       @[ofc_cd]||'-'||@[re_divr_cd]||'-'||@[trd_cd]||'-'||@[rlane_cd]||'-'||@[skd_dir_cd]||'-'||TO_CHAR(SYSDATE,'RRMM')||'-'||'001' JO_REF_NO
                  FROM DUAL
                )
       )
WHERE  RN = 1			]]></sql>
			<params>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="re_divr_cd" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
