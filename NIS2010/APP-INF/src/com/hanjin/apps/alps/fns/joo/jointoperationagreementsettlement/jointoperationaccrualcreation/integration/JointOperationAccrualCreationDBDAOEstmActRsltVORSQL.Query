<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="JointOperationAccrualCreationDBDAOEstmActRsltVORSQL">
			<desc><![CDATA[2011.06.30 [CHM-201111621-01]
개발자 : 이준범
제   목 : Esitmate Perfomance Creation 기능 보완 요청
내   용 : 항목 및 항목별 조회 조건 추가
           - Adjust, Adjusted BSA, Adjusted Slot Cost, Adjuest Estimated Cost, Adjuest Actual Cost, Remark
2011.07.28 [선조치]
개발자 : 이준범
제   목 : Esitmate Perfomance Creation 화면 Diff. 검색조건의 Logic 변경
내   용 : Diff 옵션에 대한 조회 조건 변경
            - Diff 체크 시 Adjusted Accrual Cost 값이 0인 경우만 제외하고 조회
2011.08.16 [CHM-201112783-01]
개발자 : 이준범
제   목 : Estimate Performance Creation 기능 보완 요청
내   용 : 1) Estimated Period 가 다른 경우도 Adjust 관련 Logic 을 적용 
            2) 검색조건에 Account, Type 신규 츄가]]></desc>
			<sql><![CDATA[
SELECT
AA.*
FROM
(
SELECT 
       ROWNUM AS SEQ_NO
      ,IBFLAG
      ,EXE_YRMON
      ,REV_YRMON
      ,JO_CRR_CD
      ,TRD_CD
      ,VNDR_CUST_SEQ
      ,CUST_CNT_CD
      ,CUST_SEQ
      ,RE_DIVR_CD
      ,VVD
      ,VSL_CD
      ,SKD_VOY_NO
      ,SKD_DIR_CD
      ,REV_DIR_CD
      ,RLANE_CD
      ,JO_STL_JB_CD
      ,JO_STL_JB_NM
      ,BSA_QTY
      ,BSA_SLT_PRC
      ,ACCT_CD
      ,ESTM_AMT
      ,ACT_AMT
      ,ACCL_AMT
      ,DIFF_AMT
      ,ESTM_VVD_TP_CD
      ,JO_IOC_DIV_CD 
      ,ESTM_VVD_HDR_ID
      ,CNTR_BLK_DIV_CD
      ,SYS_SRC_ID
      ,LOC_CD
      ,JO_CNTR_DIV_CTNT
      ,ACCL_AMT_CORR_FLG
	  ,NVL(ADJ_ESTM_FLG,'N') AS ADJ_ESTM_FLG
      ,ADJ_BSA_QTY
      ,ADJ_BSA_SLT_PRC
      ,ADJ_ESTM_AMT
      ,ADJ_ACCL_AMT
      ,ADJ_RMK
      ,CRE_USR_ID
      ,UPD_USR_ID
      ,ESTM_ACT_SEQ
      ,ADJ_RSLT_CD
      ,ADJ_RLSE_RMK
  FROM (
        SELECT /*+INDEX(A XPKJOO_ESTM_ACT_RSLT)*/
               'R' AS IBFLAG
              ,A.EXE_YRMON
              ,A.REV_YRMON
              ,A.JO_CRR_CD
              ,B.TRD_CD
              ,CASE WHEN A.ACCT_CD LIKE '4%' THEN
                         B.CUST_CNT_CD||B.CUST_SEQ
                    WHEN A.ACCT_CD LIKE '5%' THEN
                         B.VNDR_SEQ||''
               END AS VNDR_CUST_SEQ
              ,CASE WHEN A.ACCT_CD LIKE '4%' THEN
                         B.CUST_CNT_CD
                    WHEN A.ACCT_CD LIKE '5%' THEN
                         ''
               END AS CUST_CNT_CD
              ,CASE WHEN A.ACCT_CD LIKE '4%' THEN
                         B.CUST_SEQ
                    WHEN A.ACCT_CD LIKE '5%' THEN
                         B.VNDR_SEQ
               END AS CUST_SEQ
              ,CASE WHEN A.ACCT_CD LIKE '4%' THEN
                         'R'
                    WHEN A.ACCT_CD LIKE '5%' THEN
                         'E'
               END AS RE_DIVR_CD
              ,A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD||A.REV_DIR_CD AS VVD
              ,A.VSL_CD
              ,A.SKD_VOY_NO
              ,A.SKD_DIR_CD
              ,A.REV_DIR_CD
              ,A.RLANE_CD
              ,A.JO_STL_JB_CD
              ,C.NAME AS JO_STL_JB_NM
              ,A.BSA_QTY
              ,A.BSA_SLT_PRC
              ,A.ACCT_CD
              ,ROUND(A.ESTM_AMT,2) AS ESTM_AMT
              ,ROUND(A.ACT_AMT, 2) AS ACT_AMT
              ,ROUND(A.ACCL_AMT,2) AS ACCL_AMT
              ,ROUND(A.ESTM_AMT,2) - ROUND(A.ACT_AMT,2) AS DIFF_AMT
              ,A.ESTM_VVD_TP_CD
              ,A.JO_IOC_DIV_CD
              ,A.ESTM_VVD_HDR_ID
              ,A.CNTR_BLK_DIV_CD
              ,A.SYS_SRC_ID
              ,A.LOC_CD
              ,A.JO_CNTR_DIV_CTNT
              ,A.ACCL_AMT_CORR_FLG
              ,A.ADJ_ESTM_FLG
              ,A.ADJ_BSA_QTY
              ,A.ADJ_BSA_SLT_PRC
              ,A.ADJ_ESTM_AMT
              ,A.ADJ_ACCL_AMT
              ,A.ADJ_RMK
              ,A.CRE_USR_ID
              ,A.UPD_USR_ID
              ,A.ESTM_ACT_SEQ
              ,A.ADJ_RSLT_CD
	  		  ,A.ADJ_RLSE_RMK
          FROM JOO_ESTM_ACT_RSLT A
              ,JOO_CARRIER       B
              ,(
                SELECT A.INTG_CD_VAL_CTNT AS CODE
                      ,A.INTG_CD_VAL_DP_DESC AS NAME 
                  FROM COM_INTG_CD_DTL A 
                 WHERE A.INTG_CD_ID = 'CD01866'
               ) C
         WHERE A.JO_CRR_CD = B.JO_CRR_CD
           AND A.RLANE_CD  = B.RLANE_CD
           AND A.JO_STL_JB_CD = C.CODE(+)
           AND A.EXE_YRMON = REPLACE(@[exe_yrmon],'-','')
           #if (${re_divr_cd} != '')
           AND A.ACCT_CD LIKE DECODE(@[re_divr_cd],'R','4','E','5')||'%'
           #end
           #if (${jo_crr_cd} != '')
           AND A.JO_CRR_CD = @[jo_crr_cd]
           #end
           #if (${trd_cd} != '')
           AND B.TRD_CD    = @[trd_cd]
           #end
           #if (${rlane_cd} != '')
           AND A.RLANE_CD  = @[rlane_cd]
           #end
           #if (${vvd} != '')
           AND A.VSL_CD 	= substr(@[vvd],1,4) 
           AND A.SKD_VOY_NO = substr(@[vvd],5,4)
           AND A.SKD_DIR_CD = substr(@[vvd],9,1)
           AND A.REV_DIR_CD = substr(@[vvd],10,1)
           #end
           #if (${acct_cd} != '')
           AND A.ACCT_CD = @[acct_cd]
           #end
           #if (${estm_vvd_tp_cd} != '')
           AND A.ESTM_VVD_TP_CD = @[estm_vvd_tp_cd]
           #end
           #if (${diff} != '')
           AND NVL(A.ADJ_ACCL_AMT,0) <> 0
           #end
           #if (${adjust} != '')
           AND ADJ_ESTM_FLG = @[adjust]
           #end
           #if (${rev_yrmon_to} != '' && ${rev_yrmon_fr} != '')
		   AND A.REV_YRMON BETWEEN REPLACE(@[rev_yrmon_fr],'-','') AND REPLACE(@[rev_yrmon_to],'-','')
		   #end
		 ORDER BY ACCT_CD, REV_YRMON, VVD, ESTM_AMT
       ) A
 ) AA
 #if (${page_no} != '')
 WHERE SEQ_NO BETWEEN 1 + ((@[page_no]-1)*@[pagerows]) AND (@[page_no]*@[pagerows])
 #end			]]></sql>
			<params>
				<param name="exe_yrmon" type="12" value="" out="N"/>
				<param name="re_divr_cd" type="12" value="" out="N"/>
				<param name="jo_crr_cd" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="acct_cd" type="12" value="" out="N"/>
				<param name="estm_vvd_tp_cd" type="12" value="" out="N"/>
				<param name="adjust" type="12" value="" out="N"/>
				<param name="rev_yrmon_fr" type="12" value="" out="N"/>
				<param name="rev_yrmon_to" type="12" value="" out="N"/>
				<param name="page_no" type="12" value="" out="N"/>
				<param name="pagerows" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
