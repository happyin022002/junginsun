<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="JointOperationConsultationDBDAOSearchApproveJOOCeoYnRSQL">
			<desc><![CDATA[결재라인 중간단계에 CEO가 있는지 조회한다.]]></desc>
			<sql><![CDATA[
SELECT
        CASE WHEN SUM(DECODE(AP_COM_CHECK_CEO_YN_FNC(X.APRO_USR_ID),'N',0,1)) > 0 THEN 'N'
             ELSE 'Y'
             END AS CEO_YN
    FROM
    (
        SELECT 
              COUNT(R.APRO_RQST_SEQ) OVER (PARTITION BY R.APRO_RQST_NO) KNT
            , DENSE_RANK() OVER (PARTITION BY R.APRO_RQST_NO ORDER BY R.APRO_RQST_SEQ DESC) RNK
            , R.APRO_USR_ID
            , R.APRO_USR_NM
        FROM JOO_CSR A, COM_APRO_RQST_HDR H, COM_APRO_CSR_DTL D, COM_APRO_RQST_ROUT R 
    WHERE 1=1
    AND A.SLP_TP_CD||A.SLP_FUNC_CD||A.SLP_OFC_CD||SUBSTR(A.SLP_ISS_DT,3,8)||A.SLP_SER_NO = D.CSR_NO
    AND H.APRO_RQST_NO = D.APRO_RQST_NO
    AND H.APRO_RQST_NO = R.APRO_RQST_NO
    AND A.SLP_TP_CD||A.SLP_FUNC_CD||A.SLP_OFC_CD||SUBSTR(A.SLP_ISS_DT,3,8)||A.SLP_SER_NO = @[csr_no]
    ) X
    WHERE 1=1
    AND X.RNK <> 1			]]></sql>
			<params>
				<param name="csr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
