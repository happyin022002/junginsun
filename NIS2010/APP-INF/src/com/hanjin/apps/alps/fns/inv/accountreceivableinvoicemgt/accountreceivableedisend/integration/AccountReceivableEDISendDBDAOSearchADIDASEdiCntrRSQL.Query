<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivableEDISendDBDAOSearchADIDASEdiCntrRSQL">
			<desc><![CDATA[SearchADIDASEdiCntr]]></desc>
			<sql><![CDATA[
WITH AR_CNTR_INFO AS 
(
SELECT DISTINCT CNTR.CNTR_NO CNTR_NO, MAIN.BKG_NO BKG_NO,
  CNTR.CNTR_TPSZ_CD CNTR_TYPE,
  (SELECT CNTR_WGT FROM BKG_CONTAINER WHERE BKG_NO = MAIN.BKG_NO AND CNTR_NO = CNTR.CNTR_NO) AS CNTR_BL_WEIGHT,
  (SELECT MEAS_QTY FROM BKG_CONTAINER WHERE BKG_NO = MAIN.BKG_NO AND CNTR_NO = CNTR.CNTR_NO) AS CNTR_BL_VOLUME,
  (SELECT BKG_TRSP_MZD_CD FROM BKG_EUR_TRO WHERE BKG_NO = MAIN.BKG_NO AND IO_BND_CD = MAIN.IO_BND_CD AND CNTR_NO = CNTR.CNTR_NO AND CXL_FLG<>'Y')  AS CNTR_ONCARRIAGE_TRANSPORT_MODE 
FROM INV_AR_ISS_DTL DTL,
     INV_AR_CNTR CNTR,
     (SELECT DISTINCT BKG_NO,INV_NO,IO_BND_CD FROM INV_AR_MN 
     WHERE AR_IF_NO IN (SELECT  AR_IF_NO 
     FROM INV_AR_ISS_DTL 
     WHERE INV_NO = @[inv_no])) MAIN  --'HM2237446'  
WHERE DTL.AR_IF_NO = CNTR.AR_IF_NO
  AND DTL.INV_NO =  MAIN.INV_NO
  AND DTL.INV_NO = @[inv_no]
  AND DTL.CHG_SEQ = 1
)

SELECT A.CNTR_NO CNTR_NBR, A.CNTR_TYPE,A.CNTR_BL_WEIGHT, A.CNTR_BL_VOLUME, 
ROUND(1/(SELECT COUNT(*) FROM AR_CNTR_INFO),2) CNTR_RATIO,
'1'  AS BL_COUNT_PER_CNTR,
 TO_CHAR(D.FT_CMNC_DT,'YYYYMMDD')  AS CNTR_BASEDATE_DET_DEM,
 TO_CHAR(D.FT_END_DT,'YYYYMMDD')  AS CNTR_STARTDATE_DET_DEM,
 CNTR_ONCARRIAGE_TRANSPORT_MODE
FROM  AR_CNTR_INFO A, 
        (SELECT B.FT_CMNC_DT,B.FT_END_DT, B.CNTR_NO
        FROM AR_CNTR_INFO  E, DMT_CHG_CALC B, DMT_CHG_BKG_CNTR C
        WHERE 1=1
        AND B.CNTR_CYC_NO = C.CNTR_CYC_NO 
        AND B.SYS_AREA_GRP_ID = C.SYS_AREA_GRP_ID
        AND E.BKG_NO   = C.BKG_NO
        AND E.CNTR_NO  = C.CNTR_NO
        AND B.DMDT_TRF_CD = 'CTIC'
        AND NOT (B.DUL_TP_EXPT_FLG = 'Y'
        AND SUBSTR(B.DMDT_TRF_CD, 1, 1) = 'D')
        AND B.DMDT_CHG_LOC_DIV_CD <> 'SZP'
        ) D
WHERE A.CNTR_NO = D.CNTR_NO(+)			]]></sql>
			<params>
				<param name="inv_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
