<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceIssueDBDAOModifyIDASplitFlgUSQL">
			<desc><![CDATA[Modify IDA Split Flg]]></desc>
			<sql><![CDATA[
UPDATE INV_AR_MN
SET IDA_INV_SPLIT_FLG = 'Y'
WHERE AR_IF_NO IN (
        SELECT AR_IF_NO
        FROM INV_AR_MN A
        WHERE AR_OFC_CD = @[ar_ofc_cd]
        AND BL_SRC_NO  = @[bl_src_no]
        AND NVL(INV_DELT_DIV_CD,'N') <> 'Y'
        AND BL_INV_CFM_DT IS NOT NULL 
        AND (((EXISTS (SELECT 'X'
                        FROM INV_AR_MN
                        WHERE AR_OFC_CD = A.AR_OFC_CD
                        AND BL_SRC_NO = A.BL_SRC_NO
                        AND NVL(IDA_ISS_TP_CD, 'P') IN ('T','C','D')) 
                 OR EXISTS (SELECT 'X'
                        FROM INV_AR_MN
                        WHERE AR_OFC_CD = A.AR_OFC_CD
                        AND BL_SRC_NO = A.BL_SRC_NO
                        AND NVL(IDA_INV_SPLIT_FLG, 'N') = 'Y')
                 )
                AND INV_ISS_FLG = 'N'
                AND NVL(IDA_INV_SPLIT_FLG, 'N') = 'N')
            OR (NOT EXISTS (SELECT 'X'
                        FROM INV_AR_MN
                        WHERE AR_OFC_CD = A.AR_OFC_CD
                        AND BL_SRC_NO = A.BL_SRC_NO
                        AND NVL(IDA_ISS_TP_CD, 'P') IN ('T','C','D'))
                AND NOT EXISTS (SELECT 'X'
                        FROM INV_AR_MN
                        WHERE AR_OFC_CD = A.AR_OFC_CD
                        AND BL_SRC_NO = A.BL_SRC_NO
                        AND NVL(IDA_INV_SPLIT_FLG, 'N') = 'Y')
                 AND INV_CLR_FLG = 'N'))
             )			]]></sql>
			<params>
				<param name="ar_ofc_cd" type="12" value="" out="N"/>
				<param name="bl_src_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
