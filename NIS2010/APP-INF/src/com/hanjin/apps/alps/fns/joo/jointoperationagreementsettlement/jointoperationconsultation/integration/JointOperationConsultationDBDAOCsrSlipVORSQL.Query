<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="JointOperationConsultationDBDAOCsrSlipVORSQL">
			<desc><![CDATA[CHM-201641292 CSR List Inquiry 상 Payment date 표시 건 : AP CSR건에 대한 PAY_DT 표시항목 추가]]></desc>
			<sql><![CDATA[
SELECT
       A.APRO_FLG,
       A.SLP_TP_CD||A.SLP_FUNC_CD||A.SLP_OFC_CD||SUBSTR(A.SLP_ISS_DT,3)||A.SLP_SER_NO AS CSR_NO,
       A.CSR_OFFST_NO,
       A.SLP_ISS_DT,
       TO_CHAR(A.EFF_DT,'YYYYMMDD') AS EFF_DT,
       A.CSR_LOCL_CURR_CD,
       A.CSR_LOCL_AMT,
       B.USR_NM AS ISSUER,
       A.CSR_DESC,
	   A.CSR_LOCL_AMT / DECODE (A.CSR_LOCL_CURR_CD, 'USD', 1, (
           SELECT NVL(EX1.USD_LOCL_XCH_RT, 1)
                FROM GL_MON_XCH_RT EX1
           WHERE EX1.CURR_CD = A.CSR_LOCL_CURR_CD
           AND EX1.ACCT_XCH_RT_YRMON = TO_CHAR(A.EFF_DT, 'YYYYMM')
           AND EX1.ACCT_XCH_RT_LVL = '1' ) ) AS USD_LOCL_AMT,
       (
          SELECT CASE WHEN INV.RCV_ERR_FLG = 'E' THEN 'Cancelled'
                      WHEN INV.PAY_DT IS NULL AND INV.PAY_AMT = 0 THEN 'Paid Amount : 0'
                      WHEN INV.PAY_DT IS NOT NULL THEN TO_CHAR(TO_DATE(PAY_DT, 'YYYYMMDD'), 'YYYY-MM-DD')
                 ELSE ''
                 END PAY_DT
            FROM AP_INV_HDR INV
           WHERE INV.CSR_NO = A.SLP_TP_CD || A.SLP_FUNC_CD || A.SLP_OFC_CD || SUBSTR(A.SLP_ISS_DT, 3) || A.SLP_SER_NO
       ) PAY_DT
FROM   JOO_CSR  A,
       COM_USER B
WHERE  A.CRE_USR_ID  = B.USR_ID(+)
AND    A.CXL_FLG     = 'N'
#if (${re_divr_cd} != '')
	#if (${re_divr_cd} == 'R')
AND    A.SLP_TP_CD = '18'
	#elseif(${re_divr_cd} == 'E')
AND    A.SLP_TP_CD IN ('06', '02')
	#end
#end
#if (${crr_cd} != '')
AND   A.CSR_OFFST_NO LIKE @[crr_cd]||'%'
#end
#if (${csr_no} != '')
AND    A.SLP_TP_CD   = SUBSTR(@[csr_no], 1,2)
AND    A.SLP_FUNC_CD = SUBSTR(@[csr_no], 3,1)
AND    A.SLP_OFC_CD  = DECODE(LENGTH(@[csr_no]),20,SUBSTR(@[csr_no],4,6),SUBSTR(@[csr_no],4,5))
AND    A.SLP_ISS_DT  = TO_CHAR(TO_DATE(DECODE(LENGTH(@[csr_no]),20,SUBSTR(@[csr_no],10,6),SUBSTR(@[csr_no],9,6)),'RRMMDD'),'YYYYMMDD')
AND    A.SLP_SER_NO  = DECODE(LENGTH(@[csr_no]),20,SUBSTR(@[csr_no],16),SUBSTR(@[csr_no],15))
#else
#if (${gubun} == '0')
AND    A.SLP_ISS_DT  >= REPLACE(@[fr_dt],'-','')
AND    A.SLP_ISS_DT  <= REPLACE(@[to_dt],'-','')
#elseif(${gubun} == '1')
AND    A.EFF_DT  >= TO_DATE(REPLACE(@[fr_dt],'-',''),'YYYYMMDD')
AND    A.EFF_DT  <= TO_DATE(REPLACE(@[to_dt],'-',''),'YYYYMMDD')
#end
#if (${slp_ofc_cd} != '')
/* 20091208 SLP_OFC_CD -> SLP_ISS_OFC_CD 수정  => 20100201 다시 SLP_OFC_CD로 변경 => 20100219 SLP_OFC_CD, SLP_ISS_OFC_CD 중 하나 (박효숙차장)*/
AND   (A.SLP_OFC_CD = @[slp_ofc_cd] OR A.SLP_ISS_OFC_CD  = @[slp_ofc_cd])
#end
#end
ORDER BY 2			]]></sql>
			<params>
				<param name="crr_cd" type="12" value="" out="N"/>
				<param name="csr_no" type="12" value="" out="N"/>
				<param name="fr_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="slp_ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
