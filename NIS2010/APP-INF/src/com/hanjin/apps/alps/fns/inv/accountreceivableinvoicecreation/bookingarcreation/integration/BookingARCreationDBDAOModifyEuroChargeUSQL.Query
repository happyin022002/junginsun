<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingARCreationDBDAOModifyEuroChargeUSQL">
			<desc><![CDATA[]]></desc>
			<sql><![CDATA[
UPDATE INV_AR_CHG
   SET CHG_AMT = (SELECT ROUND(NVL(SUM(CURR_LOCL_AMT),0)*NVL(Y.INV_EURO_VAT_RT,0)/100, DP_PRCS_KNT ) 
                    FROM (SELECT A.CURR_CD, ROUND(SUM(CHG_AMT)*INV_XCH_RT , C.DP_PRCS_KNT ) CURR_LOCL_AMT, C.DP_PRCS_KNT
                            FROM INV_AR_CHG A,
                                 INV_AR_MN B,
                                 MDM_CURRENCY C
                           WHERE A.AR_IF_NO = @[ar_if_no]
                             AND A.AR_IF_NO = B.AR_IF_NO
                             AND C.CURR_CD = B.LOCL_CURR_CD
                           GROUP BY A.CURR_CD,A.INV_XCH_RT,C.DP_PRCS_KNT) X,
                           (SELECT INV_EURO_VAT_RT 
                              FROM INV_AR_EU_CNT_VAT
                             WHERE CNT_CD = @[cnt_cd]
                               AND NVL(DELT_FLG,'N') = 'N'
                               AND @[sail_arr_dt] BETWEEN INV_EURO_VAT_ST_DT AND NVL(INV_EURO_VAT_END_DT,'99991231')) Y
                    GROUP BY Y.INV_EURO_VAT_RT,DP_PRCS_KNT
                         )
      ,TRF_RT_AMT = (SELECT ROUND(NVL(SUM(CURR_LOCL_AMT),0)*NVL(Y.INV_EURO_VAT_RT,0)/100, DP_PRCS_KNT ) 
                    FROM (SELECT A.CURR_CD, ROUND(SUM(CHG_AMT)*INV_XCH_RT , C.DP_PRCS_KNT ) CURR_LOCL_AMT, C.DP_PRCS_KNT
                            FROM INV_AR_CHG A,
                                 INV_AR_MN B,
                                 MDM_CURRENCY C
                           WHERE A.AR_IF_NO = @[ar_if_no]
                             AND A.AR_IF_NO = B.AR_IF_NO
                             AND C.CURR_CD = B.LOCL_CURR_CD
                           GROUP BY A.CURR_CD,A.INV_XCH_RT,C.DP_PRCS_KNT) X,
                           (SELECT INV_EURO_VAT_RT 
                              FROM INV_AR_EU_CNT_VAT
                             WHERE CNT_CD = @[cnt_cd]
                               AND NVL(DELT_FLG,'N') = 'N'
                               AND @[sail_arr_dt] BETWEEN INV_EURO_VAT_ST_DT AND NVL(INV_EURO_VAT_END_DT,'99991231')) Y
                    GROUP BY Y.INV_EURO_VAT_RT,DP_PRCS_KNT
                         )
 WHERE AR_IF_NO = @[ar_if_no]
   AND CHG_CD   = 'IEV'			]]></sql>
			<params>
				<param name="ar_if_no" type="12" value="" out="N"/>
				<param name="cnt_cd" type="12" value="" out="N"/>
				<param name="sail_arr_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
