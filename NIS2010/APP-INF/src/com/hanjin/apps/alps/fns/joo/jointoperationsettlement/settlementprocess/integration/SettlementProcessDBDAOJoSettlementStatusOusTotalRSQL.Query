<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SettlementProcessDBDAOJoSettlementStatusOusTotalRSQL">
			<desc><![CDATA[미정산 VVD 조회]]></desc>
			<sql><![CDATA[
WITH ROB_LIST AS (
    SELECT
		 J.VSL_CD
		,J.SKD_VOY_NO
		,J.SKD_DIR_CD
		,J.VPS_PORT_CD
		,SUBSTR(J.YD_CD,6,2) AS TML_CD
		,J.CLPT_IND_SEQ
		,J.TRD_CD
		,'SML' AS CRR_CD             
		,J.RLANE_CD
		,J.RE_DIVR_CD
		,J.YD_CD
		,DECODE(J.ROB_ENBL_FLG,'Y','P','NP')	AS ROB_ENBL_FLG	
		,J.VPS_ETD_DT    
		,J.REV_DIR_CD
    FROM JOO_ROB_CNTR_SMRY J
        ,BSA_VVD_CRR_PERF A4    
    WHERE 1=1
	AND J.VPS_ETD_DT BETWEEN TO_DATE('201510','YYYYMM') AND ADD_MONTHS(TO_DATE(REPLACE(@[rev_yrmon],'-',''),'YYYYMM'),1)
    AND J.VSL_CD     = A4.VSL_CD(+) 
    AND J.SKD_VOY_NO = A4.SKD_VOY_NO(+) 
    AND J.SKD_DIR_CD = A4.SKD_DIR_CD(+) 
    AND J.TRD_CD     = A4.TRD_CD(+) 
    AND J.RLANE_CD   = A4.RLANE_CD(+) 
	AND A4.BSA_OP_JB_CD IN ('000','003','005')		--Exp
    AND A4.CRR_CD(+)  != 'SML' 
    AND A4.CRR_BSA_CAPA > 0   
	#if (${trd_cd}!= '')
		   AND   J.TRD_CD        =  @[trd_cd]  
	#end
	#if (${rlane_cd}!= '')
		   AND   J.RLANE_CD      =  @[rlane_cd]  
	#end
	#if (${jo_crr_cd}!= '')
		   AND   J.CRR_CD        =  @[jo_crr_cd]  
	#end
	#if (${re_divr_cd}!= '')
		   AND   J.RE_DIVR_CD    =  @[re_divr_cd]  
	#end
	#if (${skd_dir_cd}!= '')
		   AND   J.SKD_DIR_CD    =  @[skd_dir_cd]  
	#end
	#if (${vvd_cd}!= '')
		   AND   J.VSL_CD||J.SKD_VOY_NO||J.SKD_DIR_CD like @[vvd_cd]||'%'
	#end
), ROB_LIST4 AS (
    SELECT
         REV_YRMON
        ,NVL(A.STL_TGT_FLG,'0') AS STL_TGT_FLG
        ,NVL(A.STL_CLZ_FLG,'0')	AS STL_CLZ_FLG  
		,A.VPS_ETD_DT 
    FROM
    (
        SELECT 
	    	 J.REV_YRMON
            ,J.STL_TGT_FLG
            ,J.STL_CLZ_FLG
			,TO_CHAR(RL.VPS_ETD_DT,'YYYYMMDDHH24MISS') AS VPS_ETD_DT 
        FROM ROB_LIST RL, JOO_LODG_TGT J
        WHERE 1=1
        AND RL.TRD_CD = J.TRD_CD(+)
--        AND RL.CRR_CD = J.CRR_CD(+)
        AND RL.RLANE_CD = J.RLANE_CD(+)
        AND RL.VSL_CD = J.VSL_CD(+)
        AND RL.SKD_VOY_NO = J.SKD_VOY_NO(+)
        AND RL.SKD_DIR_CD = J.SKD_DIR_CD(+)
        AND RL.VPS_PORT_CD = J.VPS_PORT_CD(+)
        AND RL.YD_CD = J.YD_CD(+)
        AND RL.CLPT_IND_SEQ  = J.CLPT_IND_SEQ(+)
    ) A
)
SELECT
CEIL(COUNT(1)/TO_NUMBER(@[pagerows])) AS TOT_PAGE_CNT
FROM
(
    SELECT
      ROWNUM AS SEQ_NO
     ,A.*
    FROM
    (
        SELECT * FROM ROB_LIST4
        WHERE 1=1
        AND (STL_TGT_FLG = '0' AND STL_CLZ_FLG = '0')
    ) A
) AA			]]></sql>
			<params>
				<param name="rev_yrmon" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="jo_crr_cd" type="12" value="" out="N"/>
				<param name="re_divr_cd" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="pagerows" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
