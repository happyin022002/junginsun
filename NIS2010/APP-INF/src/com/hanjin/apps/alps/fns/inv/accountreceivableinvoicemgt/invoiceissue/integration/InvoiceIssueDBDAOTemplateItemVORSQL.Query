<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceIssueDBDAOTemplateItemVORSQL">
			<desc><![CDATA[TemplateItemVO]]></desc>
			<sql><![CDATA[
WITH T10 AS (
    SELECT   A.RPT_ITM_NM
            ,B.RPT_TMPLT_NM
            ,B.RPT_ITM_ID
            ,B.USR_DEF_NM
            ,B.ITM_SEQ
            ,B.RPT_AUTH_ID
    FROM    INV_CPRT_ITM A,INV_CPRT_TMPLT B
    WHERE   A.RPT_ITM_ID = B.RPT_ITM_ID
    AND     B.RPT_TMPLT_NM = @[rpt_tmplt_nm]
    AND     B.AR_OFC_CD     = @[ar_ofc_cd]
), T20 AS
(
    SELECT  ROW_NUMBER() OVER ( ORDER BY T2.DP_SEQ) AS NO
            ,900+ROW_NUMBER() OVER (ORDER BY T2.DP_SEQ) AS ITM_SEQ
            , T2.RPT_TMPLT_NM, T2.RPT_ITM_ID
            , '' AS RPT_ITM_NM
            , T2.CHG_CD AS USR_DEF_NM
            , T2.CPRT_TP_CTNT, T2.CPRT_VAL_CTNT, T2.CHG_CD, T1.RPT_AUTH_ID
    FROM    INV_CPRT_TMPLT T1, INV_CPRT_TMPLT_CHG T2
    WHERE   T1.AR_OFC_CD     = T2.AR_OFC_CD
    AND     T1.RPT_TMPLT_NM  = T2.RPT_TMPLT_NM
    AND     T1.RPT_ITM_ID    = T2.RPT_ITM_ID
    AND     T2.AR_OFC_CD     = @[ar_ofc_cd]
    AND     T2.RPT_TMPLT_NM  = @[rpt_tmplt_nm]
#if (${sc_no} != '')
    AND     T2.CPRT_TP_CTNT  = 'S'
    AND     T2.CPRT_VAL_CTNT = @[sc_no]
#end
#if (${rfa_no} != '')
    AND     T2.CPRT_TP_CTNT  = 'R'
    AND     T2.CPRT_VAL_CTNT = @[rfa_no]
#end
#if (${rfa_no} == '' && ${sc_no} == '')
    AND   1=2
#end
    AND     T2.RPT_ITM_ID    = 'INV143'    
)
SELECT  *
FROM    (
      SELECT  RPT_ITM_NM, RPT_TMPLT_NM, RPT_ITM_ID, USR_DEF_NM, ITM_SEQ, RPT_AUTH_ID
      FROM    T10
      WHERE   T10.RPT_ITM_ID  <> 'INV143'
      UNION ALL 
      SELECT  *
      FROM    (
              SELECT    'CHG' || LPAD(TO_CHAR(NO), 3, '0') AS RPT_ITM_NM, RPT_TMPLT_NM
                      , 'CHG' || LPAD(TO_CHAR(NO), 3, '0') AS RPT_ITM_ID
                      ,  USR_DEF_NM, ITM_SEQ, RPT_AUTH_ID
              FROM    T20
              UNION ALL
              SELECT   'CHG999' AS RPT_ITM_NM, RPT_TMPLT_NM
                      ,'CHG999' RPT_ITM_ID
                      ,'OTHER' AS USR_DEF_NM,  MAX(ITM_SEQ) + 1 as  ITM_SEQ, RPT_AUTH_ID
              FROM    T20  
              GROUP BY RPT_TMPLT_NM, RPT_AUTH_ID
              )        
ORDER BY ITM_SEQ
        )			]]></sql>
			<params>
				<param name="rpt_tmplt_nm" type="12" value="" out="N"/>
				<param name="ar_ofc_cd" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
				<param name="rfa_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
