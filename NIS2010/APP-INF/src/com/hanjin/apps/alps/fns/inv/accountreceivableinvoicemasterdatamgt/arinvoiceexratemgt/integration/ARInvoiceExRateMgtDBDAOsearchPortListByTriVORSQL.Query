<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ARInvoiceExRateMgtDBDAOsearchPortListByTriVORSQL">
			<desc><![CDATA[[] ARInvoiceExRateMgtDBDAO::searchPortListByVVD ( searchByVVDVo )]]></desc>
			<sql><![CDATA[
#if (${svr_id} != 'EUR') 
SELECT 	DISTINCT(T1.IO_BND_CD) IO_BND_CD,
		DECODE(T1.IO_BND_CD,'O',T1.POL_CD,T1.POD_CD) VPS_PORT_CD,
    	T1.VSL_CD||T1.SKD_VOY_NO||T1.SKD_DIR_CD VVD_CD ,
    	T1.SVC_SCP_CD SVC_SCP_CD,
		DECODE(T1.IO_BND_CD,'O','ETD','ETA') ETDA_CD,
    	T1.SAIL_ARR_DT ETDA_DT,
    	T3.INV_XCH_RT INV_XCH_RT, --2010-01-09 ivs_xch_rt 
        T1.SLAN_CD
FROM INV_AR_MN T1, INV_VVD_XCH_RT T3
WHERE --EXISTS(SELECT AR_IF_NO FROM INV_AR_CHG WHERE AR_IF_NO = T1.AR_IF_NO AND INV_XCH_RT=0)
T1.AR_OFC_CD = @[ofc_cd]
AND T3.VSL_CD(+) = T1.VSL_CD
AND T3.SKD_VOY_NO(+) = T1.SKD_VOY_NO
AND T3.SKD_DIR_CD(+) = T1.SKD_DIR_CD
AND DECODE(T1.IO_BND_CD,'O',T1.POL_CD,'I',T1.POD_CD) = T3.PORT_CD(+)
AND T3.LOCL_CURR_CD(+) = @[locl_curr_cd]
AND T3.CHG_CURR_CD(+) = 'USD'
AND T1.LOCL_CURR_CD = @[locl_curr_cd]
#if (${vps_port_cd} != 'ALL') 
AND DECODE(T1.IO_BND_CD,'O',T1.POL_CD,T1.POD_CD) = @[vps_port_cd]
#end
#if (${svc_scp_cd} != 'ALL') 
AND T1.INV_SVC_SCP_CD = @[svc_scp_cd]
#end

AND T1.SAIL_ARR_DT = @[etda_dt]

#if (${opt_type} == 'V') 
    AND T1.VSL_CD = substr(@[vvd_cd],0,4)
    AND T1.SKD_VOY_NO  = substr(@[vvd_cd],5,4)
    AND T1.SKD_DIR_CD = substr(@[vvd_cd],9,1)
#end

AND SUBSTR(DECODE(T1.IO_BND_CD,'O',T1.POL_CD,'I',T1.POD_CD),1,2)  <> (SELECT SUBSTR(LOC_CD,1,2) FROM MDM_ORGANIZATION WHERE OFC_CD = @[ofc_cd])
ORDER BY VVD_CD
#end

#if (${svr_id} == 'EUR') 
SELECT DISTINCT(T1.IO_BND_CD) IO_BND_CD,DECODE(T1.IO_BND_CD,'O',T1.POL_CD,T1.POD_CD) VPS_PORT_CD,
	   T1.VSL_CD||T1.SKD_VOY_NO||T1.SKD_DIR_CD VVD_CD ,
	   T1.SVC_SCP_CD,DECODE(T1.IO_BND_CD,'O','ETD','ETA') ETDA_CD,
	   T1.SAIL_ARR_DT ETDA_DT,
	   T3.INV_XCH_RT INV_XCH_RT, --2010-01-09 ivs_xch_rt 
	   T1.LOCL_CURR_CD,
       T1.SLAN_CD
  FROM INV_AR_MN T1, INV_VVD_XCH_RT T3
    WHERE --EXISTS(SELECT AR_IF_NO FROM INV_AR_CHG WHERE AR_IF_NO = T1.AR_IF_NO AND INV_XCH_RT=0)
    T1.AR_OFC_CD = @[ofc_cd]
 	AND T1.LOCL_CURR_CD = @[locl_curr_cd]
	AND T3.VSL_CD(+) = T1.VSL_CD
	AND T3.SKD_VOY_NO(+) = T1.SKD_VOY_NO
	AND T3.SKD_DIR_CD(+) = T1.SKD_DIR_CD
	AND DECODE(T1.IO_BND_CD,'O',T1.POL_CD,'I',T1.POD_CD) = T3.PORT_CD(+)
	AND T3.LOCL_CURR_CD(+) =  @[locl_curr_cd]
	AND T3.CHG_CURR_CD(+) = 'USD'

	#if (${vps_port_cd} != 'ALL')  
	AND DECODE(T1.IO_BND_CD,'O',T1.POL_CD,T1.POD_CD) = @[vps_port_cd]
	#end
	#if (${svc_scp_cd} != 'ALL') 
	AND T1.INV_SVC_SCP_CD = @[svc_scp_cd]
	#end
	AND T1.SAIL_ARR_DT = @[etda_dt]
	AND DECODE(T1.IO_BND_CD,'O',T1.POL_CD,'I',T1.POD_CD) NOT IN (SELECT LOC_CD FROM MDM_LOCATION  WHERE CONTI_CD = 'E')
	
	#if (${opt_type} == 'V') 
    AND T1.VSL_CD = substr(@[vvd_cd],0,4)
    AND T1.SKD_VOY_NO  = substr(@[vvd_cd],5,4)
    AND T1.SKD_DIR_CD = substr(@[vvd_cd],9,1)
    AND (T1.VSL_CD,T1.SKD_VOY_NO,T1.SKD_DIR_CD) in (
    SELECT VSL_CD,SKD_VOY_NO,SKD_DIR_CD FROM INV_AR_MN
    WHERE DECODE(IO_BND_CD,'O',POL_CD,'I',POD_CD) NOT IN (SELECT LOC_CD FROM MDM_LOCATION  WHERE CONTI_CD = 'E')
    GROUP BY VSL_CD,SKD_VOY_NO,SKD_DIR_CD)	
	#end
#end			]]></sql>
			<params>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="locl_curr_cd" type="12" value="" out="N"/>
				<param name="vps_port_cd" type="12" value="" out="N"/>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="etda_dt" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
