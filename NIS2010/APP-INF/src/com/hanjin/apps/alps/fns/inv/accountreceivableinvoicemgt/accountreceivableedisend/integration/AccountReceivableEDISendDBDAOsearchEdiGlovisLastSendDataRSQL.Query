<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivableEDISendDBDAOsearchEdiGlovisLastSendDataRSQL">
			<desc><![CDATA[청구 승인 상태인지 확인 하는 query]]></desc>
			<sql><![CDATA[
SELECT /*+INDEX_DESC(T XAK1INV_EDI_GLOVIS_HDR) */
       AR_IF_NO
       , IF_SEQ
       , BL_SRC_NO
       , GLOVIS_EDI_MSG_NO
       , INV_NO
       -- 최종 데이터가 청구 승인(A), 청구 반려(R), 접수 오류(F) 만을 확인한다.
       , (SELECT /*+INDEX_DESC(S XAK1INV_EDI_GLOVIS_HDR) */
                  NVL(MAX(RE_TP_CD), ' ') AS RE_TP_CD 
          FROM    INV_EDI_GLOVIS_HDR S 
          WHERE   S.BL_SRC_NO = T.BL_SRC_NO
          AND     S.RE_TP_CD  IN ('A', 'R', 'F')
          AND     ROWNUM      = 1) AS RE_TP_CD
       -- 전송 데이터 중에 청구 승인(A)을 받은 데이터가 있을  경우 리턴('Y') 받고 차액 전송할 수 있도록 한다.
       , (SELECT /*+INDEX_DESC(S XAK1INV_EDI_GLOVIS_HDR) */
                  DECODE(RE_TP_CD, 'A', 'Y', 'N')
          FROM    INV_EDI_GLOVIS_HDR S 
          WHERE   S.BL_SRC_NO = T.BL_SRC_NO
          AND     S.RE_TP_CD  = 'A'
          AND     ROWNUM      = 1) AS CXL_FLG
       -- A 청구 승인, R : 청구 반려
       -- 최종 Status가 청구 승인(A), 청구 반려(R), 접수 오류(F) 이거나, Cancel(Y)일 경우
       -- 다음 데이터는 Cancel 데이터를 만들지 않고 입력 받은 자신이 바로 생성되게 한다.
       -- 0 이면 Cancel 데이터 미생성, 1 이면 Cancel 데이터 생성
       , CASE WHEN (RE_TP_CD IN ('A', 'R', 'F') OR CXL_FLG = 'Y') THEN 0 ELSE 1 END INV_SEQ
FROM   INV_EDI_GLOVIS_HDR T
WHERE  BL_SRC_NO    = @[bl_src_no]
AND    ROWNUM         = 1			]]></sql>
			<params>
				<param name="bl_src_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
