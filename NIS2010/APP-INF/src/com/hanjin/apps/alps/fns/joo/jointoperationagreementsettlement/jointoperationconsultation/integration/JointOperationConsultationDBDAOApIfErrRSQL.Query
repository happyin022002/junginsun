<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="JointOperationConsultationDBDAOApIfErrRSQL">
			<desc><![CDATA[AP Interface Error List를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT 
       C.CSR_NO
      ,A.SLP_TP_CD
      ,A.SLP_FUNC_CD
      ,A.SLP_OFC_CD
      ,A.SLP_ISS_DT
      ,A.SLP_SER_NO
      ,A.VNDR_SEQ
      ,A.CUST_CNT_CD
      ,A.CUST_SEQ
      ,A.SLP_ISS_OFC_CD
      ,A.CSR_DESC
      ,A.CSR_LOCL_CURR_CD
      ,A.CSR_LOCL_AMT
      ,A.CSR_USD_AMT
      ,TO_CHAR(A.EFF_DT,'YYYYMMDD') AS EFF_DT
      ,A.EVID_TP_CD
      ,A.APRO_FLG
      ,TO_CHAR(A.APRO_DT,'YYYYMMDDHH24MISS') AS APRO_DT
      ,A.CXL_FLG
      ,A.CXL_DESC
      ,A.CSR_OFFST_NO
      ,A.DDCT_FLG
      ,A.DDCT_LOCL_AMT
      ,A.DDCT_DESC
      ,A.RQST_LOCL_AMT
      ,TO_CHAR(A.RQST_DT,'YYYYMMDD') AS RQST_DT
      ,A.CSR_TP_CD
      ,A.SLP_ISS_RGN_CD
      ,A.SLP_ISS_INTER_CO_CD
      ,A.RVS_CSR_FLG
      ,A.RJCT_CSR_FLG
      ,A.ORG_SLP_TP_CD
      ,A.ORG_SLP_FUNC_CD
      ,A.ORG_SLP_OFC_CD
      ,A.ORG_SLP_ISS_DT
      ,A.ORG_SLP_SER_NO
--2010.04.09 권상준 수석 
--      ,C.RCV_ERR_RSN
      ,DECODE(C.IF_FLG, 'E', C.IF_ERR_RSN, C.RCV_ERR_RSN) AS RCV_ERR_RSN
      ,B.ACCT_YRMON
      ,B.JO_CRR_CD
      ,B.STL_CMB_SEQ
      ,B.RE_DIVR_CD
      ,C.IF_FLG
      ,C.RCV_ERR_FLG
      ,DECODE(C.IF_FLG,'E','I/F Error','ERP Reject') AS IF_RCV_MSG
FROM   JOO_CSR     A,
       JOO_STL_CMB B,
       AP_INV_HDR  C
WHERE  A.SLP_TP_CD    = B.SLP_TP_CD
AND    A.SLP_FUNC_CD  = B.SLP_FUNC_CD
AND    A.SLP_OFC_CD   = B.SLP_OFC_CD
AND    A.SLP_ISS_DT   = B.SLP_ISS_DT
AND    A.SLP_SER_NO   = B.SLP_SER_NO
AND    A.SLP_TP_CD    = SUBSTR(C.CSR_NO,1,2)
AND    A.SLP_FUNC_CD  = SUBSTR(C.CSR_NO,3,1)
AND    A.SLP_OFC_CD   = DECODE(LENGTH(C.CSR_NO),20,SUBSTR(C.CSR_NO,4,6),SUBSTR(C.CSR_NO,4,5))
AND    A.SLP_ISS_DT   = TO_CHAR(TO_DATE(DECODE(LENGTH(C.CSR_NO),20,SUBSTR(C.CSR_NO,10,6),SUBSTR(C.CSR_NO,9,6)),'RRMMDD'),'YYYYMMDD')
AND    A.SLP_SER_NO   = DECODE(LENGTH(C.CSR_NO),20,SUBSTR(C.CSR_NO,16),SUBSTR(C.CSR_NO,15))
AND    A.APRO_FLG     = 'Y'
AND    A.RVS_CSR_FLG  = 'N'
AND    A.RJCT_CSR_FLG = 'N'
AND    B.RVS_CMB_FLG  = 'N'
AND    B.RJCT_CMB_FLG = 'N'
AND  ((C.IF_FLG       = 'Y' AND C.RCV_ERR_FLG  = 'E')
    OR C.IF_FLG       = 'E')
AND    A.SLP_TP_CD    = '06' --AP만
AND    A.SLP_ISS_OFC_CD = @[slp_ofc_cd]
#if (${csr_no} != '')
AND    C.CSR_NO       = @[csr_no]
#else
AND    A.EFF_DT BETWEEN TO_DATE(REPLACE(@[eff_dt_fr],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[eff_dt_to],'-',''),'YYYYMMDD')
#end
ORDER  BY C.CSR_NO			]]></sql>
			<params>
				<param name="slp_ofc_cd" type="12" value="" out="N"/>
				<param name="csr_no" type="12" value="" out="N"/>
				<param name="eff_dt_fr" type="12" value="" out="N"/>
				<param name="eff_dt_to" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
