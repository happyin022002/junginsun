<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ARInvoiceInquiryDBDAOSearchInvoiceDetailForAKLBARSQL">
			<desc><![CDATA[ARInvoiceInquiryDBDAO::SearchInvoiceDetailForAKLBA]]></desc>
			<sql><![CDATA[
SELECT MN.BL_INV_IF_DT,
       MN.BL_INV_CFM_DT,
       MN.BL_SRC_NO,
       MN.AR_IF_NO,
       MN.VSL_CD||MN.SKD_VOY_NO||MN.SKD_DIR_CD VVD,
      (
        SELECT 'Shpr Code -'||BC.CUST_CNT_CD || BC.CUST_SEQ|| ', Shpr Name -' || BC.CUST_NM ||', Shpr Addr- '|| BC.CUST_ADDR
        FROM   BKG_CUSTOMER BC
        WHERE  MN.BL_SRC_NO = BC.BKG_NO
        AND    BC.BKG_CUST_TP_CD ='S') SHPR,
      (
        SELECT 'Cnee Code -'||BC.CUST_CNT_CD || BC.CUST_SEQ|| ', Cnee Name -' || BC.CUST_NM ||', Cnee Addr- '|| BC.CUST_ADDR
        FROM   BKG_CUSTOMER BC
        WHERE  MN.BL_SRC_NO = BC.BKG_NO
        AND    BC.BKG_CUST_TP_CD ='C') CNEE,
      (
        SELECT 'Notify Code -'||BC.CUST_CNT_CD || BC.CUST_SEQ|| ', Notify Name -' || BC.CUST_NM ||', Notify Addr- '|| BC.CUST_ADDR
        FROM   BKG_CUSTOMER BC
        WHERE  MN.BL_SRC_NO = BC.BKG_NO
        AND    BC.BKG_CUST_TP_CD ='N') NOTIFY,
       MN.POR_CD,
       MN.POL_CD,
       MN.POD_CD,
       MN.DEL_CD,
       CHG.CHG_CD,
       CHG.CHG_FULL_NM,
       CHG.CURR_CD,
       CHG.TRF_RT_AMT,
       CHG.CHG_AMT/CHG.RAT_AS_CNTR_QTY CHG_AMT,
       CHG.INV_XCH_RT,
       MN.INV_TTL_LOCL_AMT,
      (
        SELECT WM_CONCAT(CNTR_NO)
        FROM   INV_AR_CNTR C
        WHERE  C.AR_IF_NO = MN.AR_IF_NO) CNTR_NO
FROM  INV_AR_MN  MN,
      INV_AR_CHG CHG
WHERE MN.AR_IF_NO IN ( 
                       SELECT G.AR_IF_NO
                       FROM   INV_AR_MN G
                       WHERE  G.BL_INV_CFM_DT BETWEEN REPLACE(@[fm_dt],'-','') AND REPLACE(@[to_dt],'-','')
                       AND    G.INV_DELT_DIV_CD = 'N'
                   #if (${ofc_cd} != '') 
                       AND    G.AR_OFC_CD = @[ofc_cd] 
                   #end
                   #if (${act_cust_cnt_cd} != '') 
                       AND    G.ACT_CUST_CNT_CD = NVL(@[act_cust_cnt_cd], '')
                   #end
                   #if (${act_cust_seq} != '') 
                       AND    G.ACT_CUST_SEQ = CASE WHEN REGEXP_INSTR(@[act_cust_seq], '[[:alpha:]]', 1, 1) = 0 THEN
                                                    TO_NUMBER(@[act_cust_seq])
                                               ELSE
                                                    -999999
                                               END 
                   #end
                   #if (${vvd_cd} != '') 
                       AND G.VSL_CD = SUBSTR(@[vvd_cd],0,4)
                       AND G.SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4)
                       AND G.SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)
                   #end
                   #if (${io_bnd_cd} != '') 
                       AND G.IO_BND_CD = @[io_bnd_cd]
                   #end
                   #if (${por_cd} != '') 
                       AND G.POR_CD = @[por_cd]
                   #end
                   #if (${pol_cd} != '') 
                       AND G.POL_CD = @[pol_cd]
                   #end
                   #if (${pod_cd} != '') 
                       AND G.POD_CD = @[pod_cd]
                   #end
                   #if (${del_cd} != '') 
                       AND G.DEL_CD = @[del_cd]
                   #end
                   #if (${iss_opt} != '') 
                   	#if (${iss_opt} == 'I') 
                       AND NVL(G.INV_ISS_FLG,'N') = 'Y'
                 	#else
                       AND NVL(G.INV_ISS_FLG,'N') = 'N'
                	#end
                   #end
                   #if (${svc_scp_cd} != '')
                   	#if (${svc_scp_cd} != 'ALL')
                       AND G.SVC_SCP_CD = @[svc_scp_cd]
                    #end
                   #end
                     )
AND   MN.AR_IF_NO = CHG.AR_IF_NO
ORDER BY MN.BL_INV_IF_DT, MN.BL_INV_CFM_DT, MN.BL_SRC_NO, MN.AR_IF_NO			]]></sql>
			<params>
				<param name="fm_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="act_cust_cnt_cd" type="12" value="" out="N"/>
				<param name="act_cust_seq" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="por_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
