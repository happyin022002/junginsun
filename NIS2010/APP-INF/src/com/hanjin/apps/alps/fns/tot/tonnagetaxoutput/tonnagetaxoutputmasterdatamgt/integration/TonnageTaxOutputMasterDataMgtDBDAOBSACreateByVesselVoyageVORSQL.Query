<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TonnageTaxOutputMasterDataMgtDBDAOBSACreateByVesselVoyageVORSQL">
			<desc><![CDATA[BAS Creation by Vessel Voyage 조회]]></desc>
			<sql><![CDATA[
SELECT
      A.TRD_CD
			, A.SLAN_CD
			, A.VSL_CD
			, A.SKD_VOY_NO
			, A.SKD_DIR_CD
			, A.NRT_WGT
			, A.INTL_TONG_CERTI_FLG
			, A.LDB_CAPA_QTY
			,(
			        SELECT MAX(T.LDB_CAPA_QTY)
			        FROM TOT_BSA T
			        WHERE
			        T.STL_YRMON = TO_CHAR(ADD_MONTHS(TO_DATE(@[stl_yrmon],'YYYYMM'),-1),'YYYYMM')
			        AND T.VSL_CD = A.VSL_CD
			    ) PREV_LDB_CAPA_QTY			
			, A.T_FNL                            FNL_HJS_BSA_CAPA
			, C_FNL                              FNL_HJS_COA_CAPA
			, C_FNL-A.T_FNL                      DIFF
			,	A.STL_YRMON
			,	A.TONG_STL_BAT_JB_SEQ
			,	A.MODI_FLG
             FROM
             (
                  SELECT T.TRD_CD, T.SLAN_CD, T.VSL_CD, T.SKD_VOY_NO, T.SKD_DIR_CD, T.NRT_WGT, T.INTL_TONG_CERTI_FLG
                  , T.LDB_CAPA_QTY, T.FNL_HJS_BSA_CAPA T_FNL, T.CRR_BSA_CAPA T_CRR, C.FNL_HJS_BSA_CAPA C_FNL, T.STL_YRMON, T.TONG_STL_BAT_JB_SEQ, T.MODI_FLG
                  FROM TOT_BSA T, BSA_VVD_MST C
                  WHERE 1=1
                     #if (${search_flg} == 'A') 
                         #if (${trd_cd} != 'ALL')
	                           AND T.TRD_CD = @[trd_cd]
 		                 #end
 
                     #end
                  AND T.TRD_CD = C.TRD_CD(+)
                  AND C.RLANE_CD(+) LIKE T.SLAN_CD||'%' 
                  AND T.VSL_CD = C.VSL_CD(+)
                  AND T.SKD_VOY_NO = C.SKD_VOY_NO(+)
                  AND T.SKD_DIR_CD = C.SKD_DIR_CD(+)
                  AND T.STL_YRMON = @[stl_yrmon] 
             ) A,  BSA_VVD_CRR_PERF B
            WHERE 1=1
			AND A.TRD_CD = B.TRD_CD(+)
			AND B.RLANE_CD(+) LIKE A.SLAN_CD||'%'
			AND A.VSL_CD = B.VSL_CD(+)
			AND A.SKD_VOY_NO = B.SKD_VOY_NO(+)
			AND A.SKD_DIR_CD = B.SKD_DIR_CD(+)
            AND B.BSA_OP_JB_CD(+) = '002'
            AND B.CRR_CD(+) = 'UAC'
            AND B.TRD_CD(+) = 'TPS'			]]></sql>
			<params>
				<param name="stl_yrmon" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
