<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CarrierSettlementProcessDBDAOReverseSettlementCreationCSQL">
			<desc><![CDATA[CSR REVERSE후에 SETTLEMENT삭제를 하려고 하면 FK 오류가 난다.
그러므로 REVERSE전표를 생성하면 새로운 SETTLEMENT데이터를 SELECT-INSERT로 강제생성해준다.]]></desc>
			<sql><![CDATA[
INSERT INTO JOO_SETTLEMENT (
        ACCT_YRMON
       ,STL_VVD_SEQ
       ,STL_SEQ
       ,TRD_CD
       ,RLANE_CD
       ,JO_CRR_CD
       ,RE_DIVR_CD
       ,JO_STL_ITM_CD
       ,JO_MNU_NM
       ,VSL_CD
       ,SKD_VOY_NO
       ,SKD_DIR_CD
       ,REV_DIR_CD
       ,STL_BZC_PORT_CD
       ,ETA_DT
       ,JO_STL_JB_CD
       ,BSA_QTY
       ,BSA_SLT_PRC
       ,LOCL_CURR_CD
       ,ADJ_BSA_QTY_LOCL_AMT
       ,ADJ_BSA_SLT_PRC_LOCL_AMT
       ,STL_LOCL_AMT
       ,STL_USD_AMT
       ,IOC_CD
       ,SCONTI_CD
       ,FNL_HJS_BSA_QTY
       ,FNL_BSA_WGT
       ,USD_SLT_BSA_QTY
       ,USD_SLT_WGT
       ,BSA_PER_WGT
       ,FM_PORT_CD
       ,TO_PORT_CD
       ,RF_SCG_STL_TP_CD
       ,RF_SCG_PRC
       ,UC_BSS_PORT_CD
       ,UC_BSS_PORT_ETD_DT
       ,STL_RMK
       ,CMB_CFM_FLG
       ,STL_TJ_NO
       ,STL_ADJ_FLG
       ,PRE_ACCT_YRMON
       ,PRE_STL_VVD_SEQ
       ,PRE_STL_SEQ
       ,STL_LST_FLG
       ,STL_ADJ_IRR_FLG
       ,STL_ADJ_IRR_RMK
       ,STL_DUP_FLG
       ,CRE_DT
       ,CRE_USR_ID
       ,UPD_DT
       ,UPD_USR_ID
)
SELECT
        A.ACCT_YRMON
       ,A.STL_VVD_SEQ
       ,TO_NUMBER(@[stl_cmb_seq]) AS STL_SEQ
       --,NVL((SELECT /*+INDEX_DESC(X XPKJOO_SETTLEMENT)*/ X.STL_SEQ + 1 FROM JOO_SETTLEMENT X WHERE X.ACCT_YRMON = A.ACCT_YRMON AND X.STL_VVD_SEQ = A.STL_VVD_SEQ AND ROWNUM = 1),1) AS STL_SEQ
       ,A.TRD_CD
       ,A.RLANE_CD
       ,A.JO_CRR_CD
       ,A.RE_DIVR_CD
       ,A.JO_STL_ITM_CD
       ,A.JO_MNU_NM
       ,A.VSL_CD
       ,A.SKD_VOY_NO
       ,A.SKD_DIR_CD
       ,A.REV_DIR_CD
       ,A.STL_BZC_PORT_CD
       ,A.ETA_DT
       ,A.JO_STL_JB_CD
       ,A.BSA_QTY
       ,TO_NUMBER(A.BSA_SLT_PRC) * -1
       ,A.LOCL_CURR_CD
       ,A.ADJ_BSA_QTY_LOCL_AMT
       ,A.ADJ_BSA_SLT_PRC_LOCL_AMT
       ,TO_NUMBER(A.STL_LOCL_AMT) * -1
       ,A.STL_USD_AMT
       ,A.IOC_CD
       ,A.SCONTI_CD
       ,A.FNL_HJS_BSA_QTY
       ,A.FNL_BSA_WGT
       ,A.USD_SLT_BSA_QTY
       ,A.USD_SLT_WGT
       ,A.BSA_PER_WGT
       ,A.FM_PORT_CD
       ,A.TO_PORT_CD
       ,A.RF_SCG_STL_TP_CD
       ,A.RF_SCG_PRC
       ,A.UC_BSS_PORT_CD
       ,A.UC_BSS_PORT_ETD_DT
       ,'REVERSE('||STL_RMK||')' AS STL_RMK
       ,'Y' AS CMB_CFM_FLG
       ,A.STL_TJ_NO
       ,A.STL_ADJ_FLG
       ,A.PRE_ACCT_YRMON
       ,A.PRE_STL_VVD_SEQ
       ,A.PRE_STL_SEQ
       ,A.STL_LST_FLG
       ,A.STL_ADJ_IRR_FLG
       ,A.STL_ADJ_IRR_RMK
       ,'Y' AS STL_DUP_FLG --COPY하는 것이므로 DUP이다.
       ,SYSDATE
       ,@[upd_usr_id]
       ,SYSDATE
       ,@[upd_usr_id]
FROM   JOO_SETTLEMENT  A
WHERE  A.ACCT_YRMON  = REPLACE(@[acct_yrmon],'-','')
AND    A.STL_VVD_SEQ = TO_NUMBER(@[stl_vvd_seq])
AND    A.STL_SEQ     = TO_NUMBER(@[stl_seq])			]]></sql>
			<params>
				<param name="stl_cmb_seq" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="acct_yrmon" type="12" value="" out="N"/>
				<param name="stl_vvd_seq" type="12" value="" out="N"/>
				<param name="stl_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
