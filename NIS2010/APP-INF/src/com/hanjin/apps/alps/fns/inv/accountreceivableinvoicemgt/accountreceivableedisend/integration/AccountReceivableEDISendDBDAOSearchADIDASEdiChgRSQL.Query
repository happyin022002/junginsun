<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccountReceivableEDISendDBDAOSearchADIDASEdiChgRSQL">
			<desc><![CDATA[SearchADIDASEdiChg]]></desc>
			<sql><![CDATA[
SELECT CHG.CHG_CD FC_TYPE,
  DECODE(CHG.CHG_CD, 'EQD', 'vente de container',
    DECODE(NVL(CHG.TTL_LSS_CFM_FLG, 'N'),
    'Y', 'valeur residuelle',
    TRIM(CHG.CHG_FULL_NM))) FC_TEXT,
  CHG.PER_TP_CD FC_PERTYPE,
  SUM(CASE WHEN CHG.CHG_AMT > 0
           THEN CHG.RAT_AS_CNTR_QTY
           ELSE CHG.RAT_AS_CNTR_QTY * -1
      END) FC_REVENUETON,
  CHG.TRF_RT_AMT FC_RATE,
  TO_CHAR(SUM(CHG.CHG_AMT)) FC_AMOUNT,
  CHG.CURR_CD FC_RATE_CURR,
  CHG.INV_XCH_RT FC_EXCHRATE,
  DECODE(CHG.TVA_FLG, 'Y', '1', '0') FC_VAT_IND,
  '' FC_REMARKS
FROM INV_AR_ISS_DTL DTL,
  INV_AR_CHG CHG
WHERE DTL.INV_NO = @[inv_no]
  AND CHG.AR_IF_NO = DTL.AR_IF_NO(+)
  AND CHG.CHG_SEQ = DTL.CHG_SEQ(+)
  AND CHG.CHG_CD NOT IN ('TVA', 'IEV')
GROUP BY TRIM(CHG.CHG_FULL_NM),
  CHG.PER_TP_CD,
  CHG.TRF_RT_AMT,
  CHG.CURR_CD,
  CHG.CHG_CD,
  CHG.INV_XCH_RT,
  CHG.TTL_LSS_CFM_FLG,
  DECODE(CHG.TVA_FLG, 'Y', '1', '0')
ORDER BY DECODE(CHG.CURR_CD,'USD','1','EUR','2','3'),
  CHG.CURR_CD,
  TRIM(CHG.CHG_FULL_NM)			]]></sql>
			<params>
				<param name="inv_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
