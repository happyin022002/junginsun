<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ARInvoiceInquiryDBDAOARInvoiceByBLNoVORSQL">
			<desc><![CDATA[DESC Enter..]]></desc>
			<sql><![CDATA[
SELECT A.BL_SRC_NO,
  A.BKG_NO,
  A.BL_TP_CD,
  A.AR_OFC_CD,
  A.ACT_CUST_CNT_CD,
  LPAD(A.ACT_CUST_SEQ, 6, '0') ACT_CUST_SEQ,
  B.CUST_LGL_ENG_NM,
  B.CUST_RGST_NO,
  A.REV_TP_CD,
  A.REV_SRC_CD,
  C.CR_CURR_CD,
  C.CR_AMT,
  C.IB_CR_TERM_DYS,
  C.OB_CR_TERM_DYS,
  C.CR_CLT_OFC_CD,
  A.VSL_CD||SKD_VOY_NO||A.SKD_DIR_CD VVD,
  A.SVC_SCP_CD,
  CASE WHEN A.IO_BND_CD = 'I' THEN 'I/B' ELSE 'O/B' END IO_BND_CD,
  TO_CHAR(TO_DATE(A.SAIL_ARR_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') SAIL_ARR_DT,
  A.TRNK_VSL_CD||A.TRNK_SKD_VOY_NO||A.TRNK_SKD_DIR_CD TRUNK_VVD,
  A.SLAN_CD,
  A.POR_CD,
  A.POL_CD,
  A.POD_CD,
  A.DEL_CD,
  NVL(A.MST_BL_NO, ' ') MST_BL_NO,
  A.RFA_NO,
  A.SC_NO,
  A.SREP_CD,
  TRIM(TO_CHAR(ROUND(A.CGO_WGT, 3), '999,999,999,999,999,990.999')) CGO_WGT,
  TRIM(TO_CHAR(ROUND(A.CGO_MEAS_QTY, 3), '999,999,999,999,999,990.999')) CGO_MEAS_QTY,
  A.WHF_DECL_NO,
  A.BKG_TEU_QTY,
  A.BKG_FEU_QTY,
  A.USD_XCH_RT,
  DECODE(A.XCH_RT_USD_TP_CD,'I','Indi.','') XCH_RT_USD_TP_CD,
  A.CTRT_OFC_CD,
  (
    SELECT SUM(CASE WHEN BL_INV_CFM_DT IS NOT NULL THEN 1 ELSE 0 END)
    FROM INV_AR_MN
    WHERE AR_IF_NO IN (
        SELECT AR_IF_NO
        FROM INV_AR_MN
        WHERE BL_SRC_NO = (
            SELECT DISTINCT BL_SRC_NO
            FROM INV_AR_MN
            WHERE AR_IF_NO = @[max_if_no]
              AND NVL(INV_DELT_DIV_CD, 'N') <> 'Y'  )
          AND NVL(INV_DELT_DIV_CD, 'N') <> 'Y')
      AND AR_OFC_CD = A.AR_OFC_CD
      AND NVL(INV_DELT_DIV_CD, 'N') <> 'Y' ) GOOD,
  (
    SELECT SUM(CASE WHEN BL_INV_CFM_DT IS NULL THEN 1 ELSE 0 END)
    FROM INV_AR_MN
    WHERE AR_IF_NO IN (
        SELECT AR_IF_NO
        FROM INV_AR_MN
        WHERE BL_SRC_NO = (
            SELECT DISTINCT BL_SRC_NO
            FROM INV_AR_MN
            WHERE AR_IF_NO = @[max_if_no]
              AND NVL(INV_DELT_DIV_CD, 'N') <> 'Y' )
          AND NVL(INV_DELT_DIV_CD, 'N') <> 'Y')
      AND AR_OFC_CD = A.AR_OFC_CD
      AND NVL(INV_DELT_DIV_CD,'N') <> 'Y' ) NOGOOD,
	RVS_CHG_FLG
FROM INV_AR_MN A,
  MDM_CUSTOMER B,
  MDM_CR_CUST C
WHERE A.ACT_CUST_CNT_CD = B.CUST_CNT_CD (+)
  AND A.ACT_CUST_SEQ = B.CUST_SEQ (+)
  AND A.ACT_CUST_CNT_CD = C.CUST_CNT_CD (+)
  AND A.ACT_CUST_SEQ = C.CUST_SEQ (+)
  AND A.AR_IF_NO = @[max_if_no]
  AND NVL(A.INV_DELT_DIV_CD, 'N') <> 'Y'			]]></sql>
			<params>
				<param name="max_if_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
