<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralARInvoiceCreationDBDAOsearchARInvoiceForERPRSQL">
			<desc><![CDATA[GeneralARInvoiceCreationDBDAOsearchARInvoiceForERPRSQL]]></desc>
			<sql><![CDATA[
SELECT 'FNS0120001' AS LIFID
     , TO_CHAR (SYSDATE, 'YYYYMMDDHH24MISS') || SUBSTR (TO_CHAR (1 - SUBSTR (DBMS_UTILITY.get_time, -2), '09'), -2) || '0' AS SEQ
     , C.TTL_CNT AS TOTAL_COUNT
     , B.AR_IF_CHG_SEQ AS ROW_COUNT
     , @[flag] AS FLAG
     --, A.AR_IF_NO MAIN_IF_NO
     --, DECODE(SIGN(TO_NUMBER(A.BL_INV_IF_DT) - TO_NUMBER('20100314')), -1, A.OLD_AR_IF_NO, A.AR_IF_NO) MAIN_IF_NO
     --, DECODE(SIGN(TO_NUMBER(A.BL_INV_IF_DT) - TO_NUMBER('20100314')), -1, DECODE(A.OLD_AR_IF_NO, '', A.AR_IF_NO, A.OLD_AR_IF_NO), A.AR_IF_NO) MAIN_IF_NO
     , DECODE(A.OLD_AR_IF_NO, '', A.AR_IF_NO, A.OLD_AR_IF_NO) MAIN_IF_NO
     , A2.AR_IF_SER_NO MAIN_IF_SER
     , A.BL_SRC_NO BL_NO
     , A.BL_TP_CD BL_NO_TP
     , A.BKG_NO BKG_NO
     , A2.AR_INV_SRC_CD SOURCE
     , A2.TJ_SRC_NM TRANS_TYP 
     --, D.INV_NO INV_NO 
     --, DECODE(B.INV_CLR_FLG, 'Y', 'SYS CLEAR',  D.INV_NO) INV_NO
     --, DECODE(B.INV_CLR_FLG, 'Y', 'SYS CLEAR',  NVL(D.INV_NO, A.INV_SRC_NO)) INV_NO
     --, DECODE(I.OTS_SMRY_CD, 'INV', D.INV_NO, DECODE(B.INV_CLR_FLG, 'Y', 'SYS CLEAR',  NVL(D.INV_NO, A.INV_SRC_NO))) INV_NO
     , DECODE(I.OTS_SMRY_CD, 'INV', DECODE(B.INV_CLR_FLG, 'Y', 'SYS CLEAR', A.INV_NO), A.INV_NO) INV_NO
     , A.BKG_CORR_NO CA_NO  
     , TO_CHAR(A.BKG_CORR_DT, 'YYYYMMDD') CA_DT 
     , F.AR_HD_QTR_OFC_CD RHQ
     , A2.ERP_IF_OFC_CD OFC
     , A.ACT_CUST_CNT_CD ACT_CNTRY_CD
     , LPAD(A.ACT_CUST_SEQ, 6, '0') ACT_CUST_CD
     , A.INV_CUST_CNT_CD INV_CNTRY_CD
     , LPAD(A.INV_CUST_SEQ, 6, '0') INV_CUST_CD
     , A.VSL_CD VSL
     , A.SKD_VOY_NO VOY
     , A.SKD_DIR_CD DIR
     , A.TRNK_VSL_CD||TRNK_SKD_VOY_NO||TRNK_SKD_DIR_CD T_VVD
     , A.REV_VSL_CD REV_VSL
     , A.REV_SKD_VOY_NO REV_VOY
     , A.REV_SKD_DIR_CD||REV_DIR_CD REV_DIR
     , A.SAIL_ARR_DT SA_DT
     , A.POR_CD POR
     , A.POL_CD POL
     , A.POD_CD POD
     , A.DEL_CD DEL
     , A.SVC_SCP_CD SCP
     --, A.INV_SVC_SCP_CD SCP
     , A.SLAN_CD LANE
     , A.IO_BND_CD BND
     , A.CUST_CR_FLG CREDIT_MK
     , A.SREP_CD SLSMAN_CD
     , A.DUE_DT DUE_DT
     , (SELECT SUM(DECODE(xx.CURR_CD, 'USD', xx.CHG_AMT, 0))
          FROM INV_AR_CHG XX
         WHERE XX.AR_IF_NO =  @[if_no]
           AND XX.AR_IF_SER_NO = A2.AR_IF_SER_NO ) USD_AMT  
     , (SELECT SUM(DECODE(xx.CURR_CD, 'USD', 0, xx.CHG_AMT))
          FROM INV_AR_CHG XX
         WHERE XX.AR_IF_NO =  @[if_no]
           AND XX.AR_IF_SER_NO = A2.AR_IF_SER_NO ) LCL_AMT  
     , A.WHF_DECL_NO WHF_DEC_NO
     , NULL CTT_DEC_NO
     , A.ZN_IOC_CD ZONE_IOC
     , A2.INV_ERP_IF_STS_CD IF_FLAG
     , A2.ERP_IF_DT ERP_IF_DT
     , A2.INV_COA_CO_CD INV_COA_COMPANY
     , A2.INV_COA_RGN_CD INV_COA_REGION
     , A2.INV_COA_CTR_CD INV_COA_CENTER
     , A2.INV_COA_ACCT_CD INV_COA_ACCOUNT
     , A2.INV_COA_INTER_CO_CD INV_COA_INTER_COMPANY
     , A2.INV_COA_VSL_CD||A2.INV_COA_VOY_NO||A2.INV_COA_SKD_DIR_CD||A2.INV_COA_REV_DIR_CD INV_COA_VVD
     , '000000' INV_COA_FUTURE1
     , '000000' INV_COA_FUTURE2
     , A.RLANE_CD REV_LANE
     --, A.SC_NO CONT_NO
     , (SELECT DECODE(SC_NO, NULL, DECODE(RFA_NO, NULL, TAA_NO, RFA_NO), SC_NO) 
        FROM   BKG_BOOKING
        WHERE  BKG_NO = A.BKG_NO) CONT_NO
     , A.CR_TERM_DYS CREDIT_TERM
     , A.SAIL_DT SAILING_DT
     , A2.ERP_IF_GL_DT GL_DT
     --, A.GL_EFF_DT GL_DT
    --, A.XCH_RT_USD_TP_CD EX_RATE_TYPE  2010.05.12 Currency별 구분처리
     , DECODE(A2.CURR_CD, A.LOCL_CURR_CD, A.XCH_RT_USD_TP_CD, 'USD', A.XCH_RT_USD_TP_CD, A.XCH_RT_N3RD_TP_CD) EX_RATE_TYPE
     , A.XCH_RT_DT EX_RATE_CUST_DATE
     , A.AP_AR_OFFST_NO SETOFF_NO  
     , A.INV_REF_NO CUST_REF_NO
     , SUBSTR(A.HJS_STF_CTNT,1,20) HJS_REF_NO
     , A.TAX_XCH_RT TAX_EX_RATE
     , A.AR_TAX_IND_CD TAX_IND
     , A.OBRD_DT ONBOARD_DT
     , LPAD(TO_CHAR(A.IF_SEQ), 5, '0') OBL_MK
     , A.AR_CTY_CD CTY_CD
     , A.SLS_OFC_CD SALES_OFC
     , HJSEAI_PKG.h_encode(SUBSTR(A.INV_RMK, 1, 50), 'ERP', 'HJSKOR') RMK
     , A2.CURR_CD CURR
     , A.UPD_USR_ID USER_ID
     , TO_CHAR(A.CRE_DT, 'YYYYMMDDHH24MISS') LOG_RGST_DT
     , TO_CHAR(A.UPD_DT, 'YYYYMMDDHH24MISS') LOG_UPDT_DT
     , A.ISS_DT ISS_DT
     , A.SLP_NO SLIP_NO
     , NULL JO_IND
     --, B.AR_IF_NO DTL_IF_NO
     --, DECODE(SIGN(TO_NUMBER(A.BL_INV_IF_DT) - TO_NUMBER('20100220')), -1, A.OLD_AR_IF_NO, A.AR_IF_NO) DTL_IF_NO
     , DECODE(A.OLD_AR_IF_NO, '', A.AR_IF_NO, A.OLD_AR_IF_NO) DTL_IF_NO
     , B.AR_IF_SER_NO DTL_IF_SER
     , B.AR_IF_CHG_SEQ CHG_SEQ
     , B.CHG_CD CHG_TYP
     , B.REP_CHG_CD REP_CHG_TYP
     , B.CURR_CD CHG_CUR
     , B.INV_REV_TP_SRC_CD REV_TYP
     , B.CHG_AMT CHG_AMT
     , 0 TAX_AMT
     , B.REV_COA_CO_CD REV_COA_COMPANY
     , B.REV_COA_RGN_CD REV_COA_REGION
     , B.REV_COA_CTR_CD REV_COA_CENTER
     , B.REV_COA_ACCT_CD REV_COA_ACCOUNT
     , B.REV_COA_INTER_CO_CD REV_COA_INTER_COMPANY
     , B.REV_COA_VSL_CD||B.REV_COA_VOY_NO||B.REV_COA_SKD_DIR_CD||B.REV_COA_DIR_CD REV_COA_VVD
     , '000000' REV_COA_FUTURE1
     , '000000' REV_COA_FUTURE2
     , B.CURR_CD ORI_CHG_CUR
     , B.CHG_AMT ORI_CHG_AMT
     , NULL REV_EFF_DT
     , B.PER_TP_CD PER_TYP
     , B.TRF_RT_AMT RATE
     , B.RAT_AS_CNTR_QTY RATED_AS
     , B.SOB_ID SOB_ID
     , B.CHG_FULL_NM CHG_FULL_NM
     , B.ACCT_CD ACCT
     , '' CNTR_NO
     , '' CNTR_TP_SZ
     , A.RFA_NO
     --, A.XCH_RT_N3RD_TP_CD THIRD_EX_RATE_TYPE 
     , '' THIRD_EX_RATE_TYPE 
     , A.WHF_DECL_CFM_DT WHF_DEC_DT
     , A.WHF_DECL_VSL_CD||A.WHF_DECL_VOY_NO||A.WHF_DECL_DIR_CD WHF_DEC_VVD
     , A.WHF_DECL_OFC_CD WHF_DEC_OFC
     , A.WHF_MRN_NO WHF_MRN_NO
     , A.WHF_NTC_NO WHF_NTC_NO
     , DECODE(A.WHF_FLG, 'Y', 'WHF I/F', 'C', 'WHF I/F CANCEL', 'N', '') WHF_FLAG
     , A.CSR_NO WHF_CSR_NO
     , A.CTRT_OFC_CD CTRT_OFC_CD
	 , DECODE(A.WHF_FLG, 'C', 'Y', 'N') WHF_DECL_CXL_FLG
     , A.SI_REF_NO  SI_REF_NO
	 ,(SELECT MAX(TO_CHAR(RT_APLY_DT,'YYYYMMDD')) FROM BKG_RATE WHERE BKG_NO = A.BKG_NO) AS RT_APLY_DT
	 , NVL(A.CR_INV_NO,'') CR_INV_NO 
  FROM INV_AR_MN A, INV_AR_AMT A2, INV_AR_CHG B,
        (SELECT AR_IF_SER_NO, COUNT(CHG_SEQ) TTL_CNT
           FROM INV_AR_CHG
          WHERE AR_IF_NO = @[if_no]
          GROUP BY AR_IF_SER_NO) C,
        MDM_ORGANIZATION F,
        (SELECT G.OTS_SMRY_CD OTS_SMRY_CD
           FROM INV_AR_STUP_OFC G , INV_AR_MN H
          WHERE H.AR_IF_NO = @[if_no]
            AND G.AR_OFC_CD = H.AR_OFC_CD) I
WHERE A.AR_IF_NO = @[if_no]
  AND A.AR_IF_NO = A2.AR_IF_NO
  AND A2.AR_IF_NO = B.AR_IF_NO
  AND A2.AR_IF_SER_NO = B.AR_IF_SER_NO
  AND B.AR_IF_SER_NO = C.AR_IF_SER_NO   
  --AND A.AR_OFC_CD = F.OFC_CD
  AND A2.ERP_IF_OFC_CD = F.OFC_CD
ORDER BY A.AR_IF_NO, A2.AR_IF_SER_NO, B.CHG_SEQ			]]></sql>
			<params>
				<param name="flag" type="12" value="C" out="N"/>
				<param name="if_no" type="12" value="KMTM1005086 " out="N"/>
			</params>
		</query>
	</querys>
</sqls>
