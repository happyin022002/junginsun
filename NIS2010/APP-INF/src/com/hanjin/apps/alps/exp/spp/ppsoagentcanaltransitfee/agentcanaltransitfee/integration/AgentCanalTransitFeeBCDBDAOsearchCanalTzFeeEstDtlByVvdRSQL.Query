<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AgentCanalTransitFeeBCDBDAOsearchCanalTzFeeEstDtlByVvdRSQL">
			<desc><![CDATA[searchCanalTzFeeEstDtlByVvd]]></desc>
			<sql><![CDATA[
SELECT 	nvl(B.VNDR_SEQ,@[vndr_seq]) VNDR_SEQ,  --100870
        nvl(B.PSO_BZTP_CD,5) PSO_BZTP_CD,
		nvl(B.VSL_CD,regexp_substr(@[vvd], '[[:alpha:]]+', 1, 1)) VSL_CD,  --'HJMT'
		nvl(B.SKD_VOY_NO,regexp_substr(@[vvd], '[(0-9)]+', 1, 1)) SKD_VOY_NO,  --'0142'
		nvl(B.SKD_DIR_CD,regexp_substr(@[vvd], '[[:alpha:]]+', 1, 2)) SKD_DIR_CD,  --'E' 
		nvl(B.YD_CD,@[yd_cd]) YD_CD,  --'EGSUZT1'
		nvl(B.CALL_SEQ,@[call_seq]) CALL_SEQ,  --1
		A.LGS_COST_CD,	    
		(
		SELECT LGS_COST_FULL_NM
		  FROM TES_LGS_COST X
		 WHERE X.LGS_COST_CD = A.LGS_COST_CD
		) LGS_COST_FULL_NM,
        nvl(B.RQST_AMT,0) RQST_AMT,
        nvl(B.DIFF_RMK,'') DIFF_RMK
FROM 	TES_LGS_COST A,
		(
		SELECT 	A.PSO_BZTP_CD,
		        A.VSL_CD,
				A.SKD_VOY_NO,
				A.SKD_DIR_CD,
				A.YD_CD,
				A.CALL_SEQ,
				A.VNDR_SEQ,
				B.LGS_COST_CD,
				B.RQST_AMT,
				B.DIFF_RMK
		FROM 
			    PSO_CNL_TZ_FEE A,
				PSO_CNL_TZ_FEE_DTL B
		WHERE 	A.VSL_CD = B.VSL_CD
		AND 	A.SKD_VOY_NO = B.SKD_VOY_NO
		AND 	A.SKD_DIR_CD = B.SKD_DIR_CD
		AND 	A.YD_CD = B.YD_CD
		AND 	A.CALL_SEQ = B.CALL_SEQ
        AND     A.BUD_SCNR_NO 		= B.BUD_SCNR_NO
        AND     A.PSO_BZTP_CD = 5
        AND 	A.VSL_CD = regexp_substr(@[vvd], '[[:alpha:]]+', 1, 1)  --'HJMT'
        AND 	A.SKD_VOY_NO = regexp_substr(@[vvd], '[(0-9)]+', 1, 1)  --'0142'
        AND 	A.SKD_DIR_CD = regexp_substr(@[vvd], '[[:alpha:]]+', 1, 2)  --'E'
        AND     A.YD_CD = @[yd_cd]  --'EGSUZT1'
        AND     A.CALL_SEQ = @[call_seq]  --1
        AND 	A.VNDR_SEQ = @[vndr_seq]  --100870
        AND 	A.CNL_TZ_BZTP_CD = 'E'	
        AND     A.BUD_SCNR_NO 		= '999912' 	
		) B
WHERE 	A.LGS_COST_CD = B.LGS_COST_CD(+)
AND 	A.LGS_COST_SUBJ_CD ='CN'
AND 	A.LGS_COST_CD_CLSS_LVL ='D'
AND     DECODE((select VSL_OWN_IND_CD from MDM_VSL_CNTR where VSL_CD = SUBSTR(@[vvd],0,4)),'O',a.LGS_COST_CD,'YYYY') <> 'CNOW'
ORDER BY LGS_COST_FULL_NM			]]></sql>
			<params>
				<param name="vndr_seq" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="call_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
