<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AgentCanalTransitFeeBCDBDAOsearchCanalTzInvAllowanceTEURSQL">
			<desc><![CDATA[searchCanalTzInvAllowanceTEU]]></desc>
			<sql><![CDATA[
SELECT 	A.VSL_CD,
		A.SKD_VOY_NO,
		A.SKD_DIR_CD,
		A.REV_YRMON,  --ADV Payment Rev. Month
		trim(to_char(
		(SELECT SUM(RQST_AMT) FROM PSO_CNL_TZ_FEE_DTL 
          WHERE PSO_BZTP_CD = A.PSO_BZTP_CD 
		    AND VSL_CD = A.VSL_CD
			AND SKD_VOY_NO = A.SKD_VOY_NO
			AND SKD_DIR_CD = A.SKD_DIR_CD
			AND YD_CD = A.YD_CD
			AND CALL_SEQ = A.CALL_SEQ
			AND BUD_SCNR_NO 		= '999912'
		 ),999999999999999.99)) 
		TTL_AMT,  --Invoice TTL Amount
		A.SCG_RT_AMT,  --Lmt Scg Amount
		DECODE(A.SUZ_NET_TONG_WGT,NULL,(
    		SELECT  B.SUZ_NET_TONG_WGT
    		FROM    PSO_CNL_TZ_FEE B
    		WHERE 	1=1
    		AND     B.PSO_BZTP_CD = 5
    		AND 	B.VSL_CD = regexp_substr(@[vvd], '[[:alpha:]]+', 1, 1) 
    		AND 	B.SKD_VOY_NO = regexp_substr(@[vvd], '[(0-9)]+', 1, 1)  --'0142'
    		AND 	B.SKD_DIR_CD = regexp_substr(@[vvd], '[[:alpha:]]+', 1, 2)  --'E'
    		AND     B.YD_CD = @[yd_cd]  --'EGSUZT1'
    		AND     B.CALL_SEQ =  (
        				SELECT MAX(CALL_SEQ)
        				FROM PSO_CNL_TZ_FEE
        				WHERE VSL_CD = regexp_substr(@[vvd], '[[:alpha:]]+', 1, 1)
          				AND SKD_VOY_NO = regexp_substr(@[vvd], '[(0-9)]+', 1, 1)
          				AND SKD_DIR_CD = regexp_substr(@[vvd], '[[:alpha:]]+', 1, 2)
          				AND PSO_BZTP_CD = 5
          				AND CNL_TZ_BZTP_CD= 'E'
          				AND NTC_YRMON = REPLACE(@[rev_yrmon], '-', '')
          				AND BUD_SCNR_NO = '999912' ) 
    		AND 	B.VNDR_SEQ = @[vndr_seq]  --100870
    		AND 	B.CNL_TZ_BZTP_CD = 'E'
    		AND 	B.BUD_SCNR_NO 	 = '999912'),A.SUZ_NET_TONG_WGT) SUZ_NET_TONG_WGT,  --SCNT
		A.LOCL_XCH_RT,  --SDR
		A.TR_VOL_VAL,  --Tier
	    A.CNL_TZ_PROC_STS_CD,
        B.CNTR_PNM_CAPA
FROM 	(
        SELECT  *
        FROM    PSO_CNL_TZ_FEE A
        WHERE 	1=1
        AND     A.PSO_BZTP_CD = 5
        AND 	A.VSL_CD = regexp_substr(@[vvd], '[[:alpha:]]+', 1, 1)  --'HJMT'
        AND 	A.SKD_VOY_NO = regexp_substr(@[vvd], '[(0-9)]+', 1, 1)  --'0142'
        AND 	A.SKD_DIR_CD = regexp_substr(@[vvd], '[[:alpha:]]+', 1, 2)  --'E'
        AND     A.YD_CD = @[yd_cd]  --'EGSUZT1'
        AND     A.CALL_SEQ = @[call_seq]  --1
        AND 	A.VNDR_SEQ = @[vndr_seq]  --100870
        AND 	A.CNL_TZ_BZTP_CD = 'I'
		AND 	A.BUD_SCNR_NO 		= '999912'
        ) A
		,(
		SELECT VSL_CD,
		       CNTR_PNM_CAPA  --Allowance TEU
		  FROM MDM_VSL_CNTR
		 WHERE VSL_CD = regexp_substr(@[vvd], '[[:alpha:]]+', 1, 1)  --'HJMT'
		) B
WHERE   1=1
AND     A.VSL_CD(+) = B.VSL_CD			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="rev_yrmon" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
				<param name="call_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
