<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RepairMgtDBDAOaddEstimateHDRDataFromTmpDataCSQL">
			<desc><![CDATA[addEstimateHDRDataFromTmpData]]></desc>
			<sql><![CDATA[
INSERT INTO MNR_RPR_RQST_HDR
(
         RQST_EQ_NO
       , RPR_RQST_SEQ
       , RPR_RQST_VER_NO
       , RPR_RQST_LST_VER_FLG
       , EQ_KND_CD
       , EQ_TPSZ_CD
       , VNDR_SEQ
       , RPR_STS_CD
       , RPR_DTL_STS_CD
       , RQST_REF_NO
       , MNR_INP_TP_CD
       , COST_OFC_CD
       , RQST_DT
       , RQST_USR_ID
       , MNR_MEAS_UT_CD
       , APRO_OFC_CD
       , APRO_DT
       , APRO_USR_ID
       , RPR_OFFH_FLG
       , RPR_RSLT_DT
       , CURR_CD
       , RPR_YD_CD
       , EQ_DMG_DT
       , EQ_DMG_TP_CD
       , RPR_WRK_TP_CD
       , MNR_EDI_NM
       , N3PTY_FLG
       , IF_TRC_SEQ
       , MNR_AGMT_AMT
       , MNR_WRK_AMT
       , N3PTY_BIL_TTL_AMT
       , DISP_FLG
       , DISP_NO
       , DISP_DTL_SEQ
       , FILE_SEQ
       , MNR_RPR_RMK
       , EDI_ID
       , MNR_ORD_OFC_CTY_CD
       , MNR_ORD_SEQ
       , AGMT_OFC_CTY_CD
       , AGMT_SEQ
       , AGMT_VER_NO
       , RPR_RQST_TMP_SEQ
       , RPR_RQST_TMP_VER_NO
       , MNR_WARR_FLG
       , RCT_RPR_FLG
       , CRE_USR_ID
       , CRE_DT
       , UPD_USR_ID
       , UPD_DT
)
SELECT   @[new_rqst_eq_no]
       , @[new_rpr_rqst_seq]
       , @[new_rpr_rqst_ver_no]
       , A.RPR_RQST_LST_VER_FLG
       , B.EQ_TYPE
       , B.EQ_TPSZ_CD
       , A.VNDR_SEQ
       , A.RPR_STS_CD
       , A.RPR_DTL_STS_CD
       , A.RQST_REF_NO
       , A.MNR_INP_TP_CD
       , A.COST_OFC_CD
       , A.RQST_DT
       , A.RQST_USR_ID
       , A.MNR_MEAS_UT_CD
       , A.APRO_OFC_CD
       , A.APRO_DT
       , A.APRO_USR_ID
       , A.RPR_OFFH_FLG
       , A.RPR_RSLT_DT
       , A.CURR_CD
       , A.RPR_YD_CD
       , A.EQ_DMG_DT
       , A.EQ_DMG_TP_CD
       , A.RPR_WRK_TP_CD
       , A.MNR_EDI_NM
       , A.N3PTY_FLG
       , A.IF_TRC_SEQ
       , A.MNR_LBR_AMT
       , A.MNR_TTL_AMT
       , ''
       , A.DISP_FLG
       , A.DISP_NO
       , A.DISP_DTL_SEQ
       , A.FILE_SEQ
       , A.MNR_RPR_RMK
       , A.EDI_ID
       , A.MNR_ORD_OFC_CTY_CD
       , A.MNR_ORD_SEQ
       , A.AGMT_OFC_CTY_CD
       , A.AGMT_SEQ
       , A.AGMT_VER_NO
       , A.RPR_RQST_TMP_SEQ
       , A.RPR_RQST_TMP_VER_NO
       , CASE WHEN (
                     SELECT   COUNT(*)
                     FROM     MNR_EQ_RNG_STS RS
                     WHERE    1 = 1
                     AND      RS.MNR_GRP_TP_CD = 'RPR'
                     AND      RS.LOT_EQ_PFX_CD = SUBSTRB(@[rqst_eq_no],1,4)
                     AND      RS.FM_SER_NO <= SUBSTRB(@[rqst_eq_no], 5, LENGTH(@[rqst_eq_no]) -1)
                     AND      RS.TO_SER_NO >= SUBSTRB(@[rqst_eq_no], 5, LENGTH(@[rqst_eq_no]) -1)
                     AND      SYSDATE BETWEEN RS.FM_WARR_DT AND RS.TO_WARR_DT + 0.99999
                     AND      ROWNUM = 1
                   ) > 0 THEN 'Y'
              ELSE 'N'
         END AS MNR_WARR_FLG
       , CASE WHEN (
                     SELECT   COUNT(1)
                     FROM     MNR_RPR_RQST_HDR EM
                     WHERE    1 = 1
                     AND      EM.RQST_EQ_NO = @[rqst_eq_no]
                     AND      EM.VNDR_SEQ = A.VNDR_SEQ
                     AND      EM.RPR_RQST_LST_VER_FLG = 'Y'
                     AND      EM.RPR_STS_CD <> 'HD'
                     AND      EM.RQST_DT >= TRUNC(SYSDATE) - 45
                     AND      ROWNUM = 1
                   ) > 0 THEN 'Y'
              ELSE 'N'
         END AS RCT_RPR_FLG
       , A.CRE_USR_ID
       , A.CRE_DT
       , A.UPD_USR_ID
       , A.UPD_DT
FROM     MNR_RPR_RQST_TMP_HDR A
       , MNR_EQ_STS_V B
WHERE    1 = 1
AND      A.RQST_EQ_NO = @[rqst_eq_no]
AND      A.RPR_RQST_TMP_SEQ = @[rpr_rqst_tmp_seq]
AND      A.RPR_RQST_TMP_VER_NO = @[rpr_rqst_tmp_ver_no]
AND      A.RQST_EQ_NO = B.EQ_NO			]]></sql>
			<params>
				<param name="new_rqst_eq_no" type="12" value="" out="N"/>
				<param name="new_rpr_rqst_seq" type="12" value="" out="N"/>
				<param name="new_rpr_rqst_ver_no" type="12" value="" out="N"/>
				<param name="rqst_eq_no" type="12" value="" out="N"/>
				<param name="rpr_rqst_tmp_seq" type="12" value="" out="N"/>
				<param name="rpr_rqst_tmp_ver_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
