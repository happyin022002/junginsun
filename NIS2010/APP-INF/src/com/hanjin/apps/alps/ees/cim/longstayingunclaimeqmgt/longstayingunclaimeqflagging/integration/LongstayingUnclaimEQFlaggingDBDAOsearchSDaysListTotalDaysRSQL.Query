<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="LongstayingUnclaimEQFlaggingDBDAOsearchSDaysListTotalDaysRSQL">
			<desc><![CDATA[조회시점에 체류하고 있는 컨테이너의 과거 MVMT History를 조회하여, 지역별, EQ TP&SZ로  MVMT Status 를 분류하여 체류   일수를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT
    A.LVL
    ,DECODE(A.LVL,'10','Total','11','',A.LOC_CD) LOC_CD
    ,DECODE(A.LVL,'01','Total','11','G.Total',A.CNTR_TPSZ_CD) CNTR_TPSZ_CD
    ,A.ACT_QTY
    ,A.TOTAL_QTY
    ,A.TOTAL_STAY_DAYS
    ,ROUND(A.TOTAL_STAY_DAYS/A.ACT_QTY,1) TOTAL_AVG
    ,A.QTY1
    ,A.STAY_DAYS1
    ,NVL(ROUND(A.STAY_DAYS1/DECODE(A.QTY1,0,NULL,A.QTY1),1),0) AVG1
    ,TO_CHAR(A.QTY1/A.TOTAL_QTY*100,'990.0')||'%' RATE1
    
    ,A.QTY2
    ,A.STAY_DAYS2
    ,NVL(ROUND(A.STAY_DAYS2/DECODE(A.QTY2,0,NULL,A.QTY2),1),0) AVG2
    ,TO_CHAR(A.QTY2/A.TOTAL_QTY*100,'990.0')||'%' RATE2
    ,A.QTY3
    ,A.STAY_DAYS3
    ,NVL(ROUND(A.STAY_DAYS3/DECODE(A.QTY3,0,NULL,A.QTY3),1),0) AVG3
    ,TO_CHAR(A.QTY3/A.TOTAL_QTY*100,'990.0')||'%' RATE3
    ,A.QTY4
    ,A.STAY_DAYS4
    ,NVL(ROUND(A.STAY_DAYS4/DECODE(A.QTY4,0,NULL,A.QTY4),1),0) AVG4
    ,TO_CHAR(A.QTY4/A.TOTAL_QTY*100,'990.0')||'%' RATE4
    ,A.QTY5
    ,A.STAY_DAYS5
    ,NVL(ROUND(A.STAY_DAYS5/DECODE(A.QTY5,0,NULL,A.QTY5),1),0) AVG5
    ,TO_CHAR(A.QTY5/A.TOTAL_QTY*100,'990.0')||'%' RATE5
    ,A.QTY6
    ,A.STAY_DAYS6
    ,NVL(ROUND(A.STAY_DAYS6/DECODE(A.QTY6,0,NULL,A.QTY6),1),0) AVG6
    ,TO_CHAR(A.QTY6/A.TOTAL_QTY*100,'990.0')||'%' RATE6
    ,A.QTY7
    ,A.STAY_DAYS7
    ,NVL(ROUND(A.STAY_DAYS7/DECODE(A.QTY7,0,NULL,A.QTY7),1),0) AVG7
    ,TO_CHAR(A.QTY7/A.TOTAL_QTY*100,'990.0')||'%' RATE7
    ,A.QTY8
    ,A.STAY_DAYS8
    ,NVL(ROUND(A.STAY_DAYS8/DECODE(A.QTY8,0,NULL,A.QTY8),1),0) AVG8
    ,TO_CHAR(A.QTY8/A.TOTAL_QTY*100,'990.0')||'%' RATE8

    ,A.QTY9
    ,A.STAY_DAYS9
    ,NVL(ROUND(A.STAY_DAYS9/DECODE(A.QTY9,0,NULL,A.QTY9),1),0) AVG9
    ,TO_CHAR(A.QTY9/A.TOTAL_QTY*100,'990.0')||'%' RATE9

    ,A.QTY10
    ,A.STAY_DAYS10
    ,NVL(ROUND(A.STAY_DAYS10/DECODE(A.QTY10,0,NULL,A.QTY10),1),0) AVG10
    ,TO_CHAR(A.QTY10/A.TOTAL_QTY*100,'990.0')||'%' RATE10

    ,A.QTY11
    ,A.STAY_DAYS11
    ,NVL(ROUND(A.STAY_DAYS11/DECODE(A.QTY11,0,NULL,A.QTY11),1),0) AVG11
    ,TO_CHAR(A.QTY11/A.TOTAL_QTY*100,'990.0')||'%' RATE11
    
    ,A.QTY12
    ,A.STAY_DAYS12
    ,NVL(ROUND(A.STAY_DAYS12/DECODE(A.QTY12,0,NULL,A.QTY12),1),0) AVG12
    ,TO_CHAR(A.QTY12/A.TOTAL_QTY*100,'990.0')||'%' RATE12    

    ,A.QTY13
    ,A.STAY_DAYS13
    ,NVL(ROUND(A.STAY_DAYS13/DECODE(A.QTY13,0,NULL,A.QTY13),1),0) AVG13
    ,TO_CHAR(A.QTY13/A.TOTAL_QTY*100,'990.0')||'%' RATE13

    ,A.QTY14
    ,A.STAY_DAYS14
    ,NVL(ROUND(A.STAY_DAYS14/DECODE(A.QTY14,0,NULL,A.QTY14),1),0) AVG14
    ,TO_CHAR(A.QTY14/A.TOTAL_QTY*100,'990.0')||'%' RATE14

    ,A.QTY15
    ,A.STAY_DAYS15
    ,NVL(ROUND(A.STAY_DAYS15/DECODE(A.QTY15,0,NULL,A.QTY15),1),0) AVG15
    ,TO_CHAR(A.QTY15/A.TOTAL_QTY*100,'990.0')||'%' RATE15
FROM
(
    SELECT
         GROUPING(A.LOC_CD)||GROUPING(A.CNTR_TPSZ_CD) LVL
        ,A.LOC_CD
        ,A.CNTR_TPSZ_CD
        ,NVL(SUM(TOTAL_STAY_DAYS),0) TOTAL_STAY_DAYS
        ,COUNT(A.ACT_QTY) ACT_QTY
        ,SUM(A.TOTAL_QTY) TOTAL_QTY
        ,SUM(TOTAL_STAY_DAYS)/COUNT(A.ACT_QTY)  TOTAL_AVG
        ,SUM(QTY1) QTY1
        ,SUM(STAY_DAYS1) STAY_DAYS1
    
        ,SUM(QTY2) QTY2
        ,SUM(STAY_DAYS2) STAY_DAYS2
    
        ,SUM(QTY3) QTY3
        ,SUM(STAY_DAYS3) STAY_DAYS3
    
        ,SUM(QTY4) QTY4
        ,SUM(STAY_DAYS4) STAY_DAYS4
    
        ,SUM(QTY5) QTY5
        ,SUM(STAY_DAYS5) STAY_DAYS5
    
        ,SUM(QTY6) QTY6
        ,SUM(STAY_DAYS6) STAY_DAYS6
    
        ,SUM(QTY7) QTY7
        ,SUM(STAY_DAYS7) STAY_DAYS7
    
        ,SUM(QTY8) QTY8
        ,SUM(STAY_DAYS8) STAY_DAYS8
        
        ,SUM(QTY9) QTY9
        ,SUM(STAY_DAYS9) STAY_DAYS9
    
        ,SUM(QTY10) QTY10
        ,SUM(STAY_DAYS10) STAY_DAYS10
    
        ,SUM(QTY11) QTY11
        ,SUM(STAY_DAYS11) STAY_DAYS11
    
        ,SUM(QTY12) QTY12
        ,SUM(STAY_DAYS12) STAY_DAYS12
    
        ,SUM(QTY13) QTY13
        ,SUM(STAY_DAYS13) STAY_DAYS13
    
        ,SUM(QTY14) QTY14
        ,SUM(STAY_DAYS14) STAY_DAYS14
    
        ,SUM(QTY15) QTY15
        ,SUM(STAY_DAYS15) STAY_DAYS15
    FROM
    (
        SELECT
             MAX(A.CNTR_NO) CNTR_NO
            ,MAX(A.LOC_CD) LOC_CD
            ,MAX(A.CNTR_TPSZ_CD) CNTR_TPSZ_CD
            ,NVL(SUM(STAY_DAYS),0) TOTAL_STAY_DAYS
            ,COUNT(DISTINCT A.CNTR_NO) ACT_QTY
            ,COUNT(A.CNTR_NO) TOTAL_QTY
            ,SUM(STAY_DAYS)/COUNT(DISTINCT A.CNTR_NO) TOTAL_AVG
            ,SUM(DECODE(A.MVMT_STS_CD,'IC',1,0)) QTY1
            ,SUM(DECODE(A.MVMT_STS_CD,'IC',STAY_DAYS,0)) STAY_DAYS1
        
            ,SUM(DECODE(A.MVMT_STS_CD,'ID',1,0)) QTY2
            ,SUM(DECODE(A.MVMT_STS_CD,'ID',STAY_DAYS,0)) STAY_DAYS2
        
            ,SUM(DECODE(A.MVMT_STS_CD,'MT',1,0)) QTY3
            ,SUM(DECODE(A.MVMT_STS_CD,'MT',STAY_DAYS,0)) STAY_DAYS3
        
            ,SUM(DECODE(A.MVMT_STS_CD,'OP',1,0)) QTY4
            ,SUM(DECODE(A.MVMT_STS_CD,'OP',STAY_DAYS,0)) STAY_DAYS4
        
            ,SUM(DECODE(A.MVMT_STS_CD,'OC',1,0)) QTY5
            ,SUM(DECODE(A.MVMT_STS_CD,'OC',STAY_DAYS,0)) STAY_DAYS5
        
            ,SUM(DECODE(A.MVMT_STS_CD,'TN',1,0)) QTY6
            ,SUM(DECODE(A.MVMT_STS_CD,'TN',STAY_DAYS,0)) STAY_DAYS6
        
            ,SUM(DECODE(A.MVMT_STS_CD,'EN',1,0)) QTY7
            ,SUM(DECODE(A.MVMT_STS_CD,'EN',STAY_DAYS,0)) STAY_DAYS7
        
            ,SUM(DECODE(A.MVMT_STS_CD,'TS',1,0)) QTY8
            ,SUM(DECODE(A.MVMT_STS_CD,'TS',STAY_DAYS,0)) STAY_DAYS8
            
            ,SUM(DECODE(A.MVMT_STS_CD,'CI',1,0)) QTY9
            ,SUM(DECODE(A.MVMT_STS_CD,'CI',STAY_DAYS,0)) STAY_DAYS9
        
            ,SUM(DECODE(A.MVMT_STS_CD,'CD',1,0)) QTY10
            ,SUM(DECODE(A.MVMT_STS_CD,'CD',STAY_DAYS,0)) STAY_DAYS10
        
            ,SUM(DECODE(A.MVMT_STS_CD,'CM',1,0)) QTY11
            ,SUM(DECODE(A.MVMT_STS_CD,'CM',STAY_DAYS,0)) STAY_DAYS11
        
            ,SUM(DECODE(A.MVMT_STS_CD,'CP',1,0)) QTY12
            ,SUM(DECODE(A.MVMT_STS_CD,'CP',STAY_DAYS,0)) STAY_DAYS12
        
            ,SUM(DECODE(A.MVMT_STS_CD,'CO',1,0)) QTY13
            ,SUM(DECODE(A.MVMT_STS_CD,'CO',STAY_DAYS,0)) STAY_DAYS13
        
            ,SUM(DECODE(A.MVMT_STS_CD,'CT',1,0)) QTY14
            ,SUM(DECODE(A.MVMT_STS_CD,'CT',STAY_DAYS,0)) STAY_DAYS14
        
            ,SUM(DECODE(A.MVMT_STS_CD,'CE',1,0)) QTY15
            ,SUM(DECODE(A.MVMT_STS_CD,'CE',STAY_DAYS,0)) STAY_DAYS15

        FROM 
        (
            SELECT
                 A.LOC_CD
                ,A.CNTR_NO
                ,A.CNTR_TPSZ_CD
                ,B.MVMT_STS_CD
                ,B.ORG_YD_CD
                ,CEIL(NVL(LEAD(B.CNMV_EVNT_DT,1) OVER(PARTITION BY B.CNTR_NO,B.CNMV_CYC_NO ORDER BY B.CNMV_YR,B.CNMV_SEQ,B.CNMV_SPLIT_NO),TO_DATE(@[rcc_date],'yyyy-MM-dd HH24:mi:SS')) - B.CNMV_EVNT_DT) STAY_DAYS
            FROM 
            (
                SELECT 
                	A.LOC_CD
                    ,A.CNTR_NO
                    ,A.CNTR_TPSZ_CD
                    ,A.CNMV_CYC_NO
                    ,A.CNMV_EVNT_DT
                FROM
                (
                    SELECT
    	                 DECODE(@[loc_type_code],'2',A.ECC_CD,'3',A.SCC_CD,'4',A.SCC_CD,A.CRNT_YD_CD) LOC_CD 
    	                ,A.CNTR_NO
    	                ,A.CNTR_TPSZ_CD
    	                ,A.CNMV_CYC_NO
		                ,(SELECT /*+ INDEX_DESC(B XAK11CTM_MOVEMENT) */
		                         MIN(CNMV_EVNT_DT) B
		                  FROM  CTM_MOVEMENT B 
		                  		#if (${loc_type_code} == '5')	--SCC
		                  			,MDM_LOCATION C
		                  		#elseif( ${loc_type_code} == '2' || ${loc_type_code} == '3'  || ${loc_type_code} == '4' )	--LCC,ECC
			                  	   ,MDM_LOCATION C
			                  	   ,MDM_EQ_ORZ_CHT D
		                  		#end
		                  WHERE A.CNTR_NO = B.CNTR_NO
		                  AND   A.CNMV_CYC_NO  = B.CNMV_CYC_NO
		                  AND   B.MVMT_STS_CD IN ('CM','CP','CI','CO','CD','CT','CE',  'IC', 'ID', 'MT', 'OP', 'OC', 'TN', 'EN', 'TS')
		                  #if (${loc_type_code} == '5')	  --ECC
		                  	  AND C.LOC_CD = SUBSTR(B.ORG_YD_CD, 1, 5)
		                  #elseif( ${loc_type_code} == '2' || ${loc_type_code} == '3'  || ${loc_type_code} == '4' )
	                          AND C.LOC_CD = SUBSTR(B.ORG_YD_CD, 1, 5)
	                          AND C.SCC_CD = D.SCC_CD
		                  #end
		                  
				          #if (${loc_type_code} == '2')
					      	  AND D.LCC_CD = @[loc_cd]
				          #elseif (${loc_type_code} == '3')
						      AND D.LCC_CD = @[loc_cd]
				          #elseif (${loc_type_code} == '4')
						      AND D.ECC_CD = @[loc_cd]
				          #elseif (${loc_type_code} == '5')
						      AND C.SCC_CD = @[loc_cd]
				          #elseif (${loc_type_code} == '6')
					      	  AND B.ORG_YD_CD = @[loc_cd]
				          #end 
		                  
		                ) CNMV_EVNT_DT
                    FROM  MST_CONTAINER A
                    WHERE A.ACIAC_DIV_CD = 'A'
                    AND   A.CNMV_STS_CD IN ( 'CD','CE','CI','CM','CO','CP','CT','CX', 'EN','IC','ID','MT','OC','OP','TN','TS','VD')
			        #if (${loc_type_code} == '2')
			        	AND A.LCC_CD =@[loc_cd]
			        #elseif (${loc_type_code} == '3')
			        	AND A.LCC_CD =@[loc_cd]
			        #elseif (${loc_type_code} == '4')
			            AND A.ECC_CD =@[loc_cd]
			        #elseif (${loc_type_code} == '5')
			            AND A.SCC_CD =@[loc_cd]
			        #elseif (${loc_type_code} == '6')
			            AND A.CRNT_YD_CD =@[loc_cd]
			        #end     
	
			        #if (${cntr_tpsz_cd} != '')
			        	AND A.CNTR_TPSZ_CD IN ( 
			        		  				 SELECT COLUMN_VALUE
			            	                 FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[cntr_tpsz_cd] ) AS listItemType ) 
			                	             FROM dual )
			        				        )
			        #end
			        #if (${dmg_flg} != '')
			        	AND A.DMG_FLG = @[dmg_flg]
			        #end  
			        #if (${cntr_use_co_cd} != '')
			        	AND A.CNTR_USE_CO_CD = @[cntr_use_co_cd]
			        #end  
			    	#if (${uclm_ls_div_cd} == 'E')
			        	AND NVL(A.UCLM_LS_DIV_CD,'X') <> 'U'
					#elseif(${uclm_ls_div_cd} == 'O')
			        	AND A.UCLM_LS_DIV_CD = 'U'
			        #end
			
			        #if (${lstm_cd} != '')
			        	AND A.LSTM_CD IN ( 
			        		  				 SELECT COLUMN_VALUE
			            	                 FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[lstm_cd] ) AS listItemType ) 
			                	             FROM dual )
			        				        )
			        #end 
			        #if (${soc_cd} != '')
			        	#if (${soc_cd} == '1')
			        		AND A.LSTM_CD <> 'SH'
			        	#else
			        		AND A.LSTM_CD = 'SH'
			        	#end
			        #end	     
			        
			        #if (${full_flg} != '')
						AND A.FULL_FLG=@[full_flg]
			        #end        
	
			        #if (${cnmv_sts_cd} != '')
			        	AND A.CNMV_STS_CD IN ( 
			        		  				 SELECT COLUMN_VALUE
			            	                 FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[cnmv_sts_cd] ) AS listItemType ) 
			                	             FROM dual )
			        				        )
			        #end  
    		    ) A
                WHERE  CEIL(TO_DATE(@[rcc_date],'yyyy-MM-dd HH24:mi:SS') - CNMV_EVNT_DT) >= @[over_stay_days]
            ) A,CTM_MOVEMENT B
            WHERE 1=1
            AND A.CNTR_NO = B.CNTR_NO
            AND A.CNMV_CYC_NO = B.CNMV_CYC_NO 
        ) A 
        WHERE 1=1
		AND   @[loc_cd]  =  #if (${loc_type_code} == '2')
		                        (SELECT LCC_CD FROM MDM_EQ_ORZ_CHT X, MDM_LOCATION Y
		                          WHERE Y.LOC_CD = SUBSTR(A.ORG_YD_CD, 1, 5)
		                          AND   Y.SCC_CD = X.SCC_CD)
		                    #elseif (${loc_type_code} == '3')
		                    	(SELECT LCC_CD FROM MDM_EQ_ORZ_CHT X, MDM_LOCATION Y 
		     	                 WHERE Y.LOC_CD = SUBSTR(A.ORG_YD_CD, 1, 5)
		    	                 AND   Y.SCC_CD = X.SCC_CD)
		                    #elseif (${loc_type_code} == '4')
		                    	(SELECT ECC_CD FROM MDM_EQ_ORZ_CHT X, MDM_LOCATION Y 
		    	                 WHERE Y.LOC_CD = SUBSTR(A.ORG_YD_CD, 1, 5)
		    	                 AND   Y.SCC_CD = X.SCC_CD)
		                    #elseif (${loc_type_code} == '5')
		                    	(SELECT SCC_CD FROM MDM_LOCATION Y 
		    	                 WHERE Y.LOC_CD = SUBSTR(A.ORG_YD_CD, 1, 5))        	                
		                    #elseif (${loc_type_code} == '6')
		             			A.ORG_YD_CD
		                    #end 		                             
        AND   A.MVMT_STS_CD IN ('CM','CP','CI','CO','CD','CT','CE',   'IC', 'ID', 'MT', 'OP', 'OC', 'TN', 'EN', 'TS')
        GROUP BY A.CNTR_NO
    ) A
    GROUP BY CUBE(A.LOC_CD,A.CNTR_TPSZ_CD)
    ORDER BY RANK() OVER (ORDER BY A.LOC_CD)
)A, MDM_CNTR_TP_SZ B
WHERE A.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD(+)
ORDER BY A.LOC_CD,B.RPT_DP_SEQ			]]></sql>
			<params>
				<param name="rcc_date" type="12" value="" out="N"/>
				<param name="loc_type_code" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="dmg_flg" type="12" value="" out="N"/>
				<param name="cntr_use_co_cd" type="12" value="" out="N"/>
				<param name="lstm_cd" type="12" value="" out="N"/>
				<param name="full_flg" type="12" value="" out="N"/>
				<param name="cnmv_sts_cd" type="12" value="" out="N"/>
				<param name="over_stay_days" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
