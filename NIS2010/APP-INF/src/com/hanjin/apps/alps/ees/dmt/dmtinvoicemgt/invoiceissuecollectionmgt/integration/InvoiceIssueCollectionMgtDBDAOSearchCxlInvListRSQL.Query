<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceIssueCollectionMgtDBDAOSearchCxlInvListRSQL">
			<desc><![CDATA[InvoiceIssueCollectionMgtDBDAOSearchCxlInvListRSQL]]></desc>
			<sql><![CDATA[
SELECT  DMDT_INV_NO
       ,CRE_OFC_CD
	   ,(
			SELECT  DECODE(COUNT(1), 0, 'N', 'Y')
			  FROM  DMT_HRD_CDG_CTNT
			 WHERE  HRD_CDG_ID = 'AUTO_AR_IF_OFC'
			   AND  ATTR_CTNT1 = T1.CRE_OFC_CD
		) AS AUTO_AR_IF_YN
       ,DMDT_AR_IF_CD
	   
  FROM  DMT_INV_MN T1
  
 WHERE  T1.DMDT_INV_NO  IN
		(
			SELECT  T4.DMDT_INV_NO

			  FROM  DMT_AFT_BKG_ADJ_RQST  		T1
				   ,DMT_AFT_BKG_ADJ_RQST_DTL	T2
				   ,DMT_AFT_BKG_CNTR			T3
				   ,DMT_CHG_CALC                T4
				   
			 WHERE  T1.AFT_EXPT_DAR_NO      = @[aft_expt_dar_no]
			   AND  T1.AFT_EXPT_DAR_NO      = T2.AFT_EXPT_DAR_NO
			   AND  T2.AFT_EXPT_DAR_NO	    = T3.AFT_EXPT_DAR_NO
			   AND  T2.AFT_EXPT_ADJ_SEQ     = T3.AFT_EXPT_ADJ_SEQ
			   -- 할인금액이 존재할 경우에만 적용함.
			   AND  (
						(T2.EACH_CNTR_FLG = 'N' AND (T2.DC_AMT != 0 OR T2.DC_RTO != 0))
					 OR (T2.EACH_CNTR_FLG = 'Y' AND (T3.CNTR_CHG_DC_AMT != 0 OR T3.CNTR_CHG_DC_RTO != 0))
					)
					
			   AND  T3.SYS_AREA_GRP_ID      =  T4.SYS_AREA_GRP_ID
			   AND  T3.CNTR_NO              =  T4.CNTR_NO
			   AND  T3.CNTR_CYC_NO          =  T4.CNTR_CYC_NO
			   AND  T3.DMDT_TRF_CD          =  T4.DMDT_TRF_CD
			   AND  T3.DMDT_CHG_LOC_DIV_CD  =  T4.DMDT_CHG_LOC_DIV_CD
			   AND  T3.CHG_SEQ              =  T4.CHG_SEQ
		)
   AND  DMDT_INV_STS_CD = 'I'			]]></sql>
			<params>
				<param name="aft_expt_dar_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
