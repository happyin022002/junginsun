<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChassisMgsetInvoiceDBDAOSearchZPPoolEstimateAmtDataRSQL">
			<desc><![CDATA[[EES_CGM_1225] NP(ZP) Pool Chassis Estimated Expense Input : Retrieve
]]></desc>
			<sql><![CDATA[
SELECT AA.MONTH AS MONTH ,
  AA.MONTH_NM AS MONTH_NM ,
  BB.ESTM_YRMON AS ESTM_YRMON ,
  EE.AGMT_OFC_CTY_CD ,
  EE.AGMT_SEQ ,
  @[chss_pool_tp_cd] AS CHSS_POOL_TP_CD ,
  @[chss_pool_cd] AS CHSS_POOL_CD ,
  'USD' AS CURR_CD ,
  NVL(BB.ESTM_AMT, 0) AS ESTM_AMT ,
  NVL(CC.INV_SMRY_AMT, 0) AS INV_SMRY_AMT ,
  BB.ESTM_AMT_FX_FLG AS ESTM_AMT_FX_FLG
FROM (
    SELECT @[year] || LPAD(ROWNUM, 2, '0') MONTH ,
      DECODE (ROWNUM, 1, 'Jan', 2, 'Feb', 3, 'Mar', 4, 'Apr', 5, 'MAY', 6, 'Jun' , 7, 'Jul', 8, 'Aug', 9, 'Sep', 10, 'Oct', 11, 'Nov', 12, 'Dec') MONTH_NM
    FROM DUAL A CONNECT BY LEVEL<='12') AA ,
   (
    SELECT B.ESTM_YRMON ,
      B.AGMT_OFC_CTY_CD ,
      B.AGMT_SEQ ,
      B.CHSS_POOL_TP_CD ,
      B.CHSS_POOL_CD ,
      B.CURR_CD ,
      NVL(B.ESTM_AMT, 0) ESTM_AMT ,
      B.ESTM_AMT_FX_FLG 
     FROM CGM_CHSS_POOL_EXPN_ESTM B
    WHERE B.ESTM_YRMON LIKE @[year] || '%'
      AND B.CHSS_POOL_TP_CD = @[chss_pool_tp_cd]
      AND B.CHSS_POOL_CD = @[chss_pool_cd]
    ) BB,
    (
    SELECT A.COST_YRMON, A.AGMT_OFC_CTY_CD, A.AGMT_SEQ, NVL(SUM(B.INV_TTL_AMT), 0) INV_SMRY_AMT 
    FROM CGM_PAY_INV A, AP_PAY_INV B, AP_INV_HDR C
    WHERE A.INV_RGST_NO = B.INV_RGST_NO 
    AND B.CSR_NO = C.CSR_NO
    AND B.DELT_FLG = 'N'
    AND A.CHSS_MGST_INV_KND_CD = @[chss_pool_tp_cd]
    AND A.COST_YRMON LIKE @[year] || '%'
    AND A.CHSS_POOL_CD = @[chss_pool_cd]
    AND B.INV_STS_CD IN ('D','P')
    GROUP BY  A.COST_YRMON,A.AGMT_OFC_CTY_CD, A.AGMT_SEQ 
    ) CC
    ,
    (SELECT AGMT_OFC_CTY_CD, AGMT_SEQ FROM CGM_AGREEMENT
    WHERE CHSS_POOL_CD = @[chss_pool_cd]
    AND AGMT_LSTM_CD = @[chss_pool_tp_cd]
    AND ROWNUM=1
    ) EE
WHERE AA.MONTH = BB.ESTM_YRMON (+)
AND AA.MONTH = CC.COST_YRMON(+)
ORDER BY AA.MONTH			]]></sql>
			<params>
				<param name="chss_pool_tp_cd" type="12" value="" out="N"/>
				<param name="chss_pool_cd" type="12" value="" out="N"/>
				<param name="year" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
