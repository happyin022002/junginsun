<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="LeasePlanDBDAOLongTermCNTRDeliveryPerformanceDetailRSQL">
			<desc><![CDATA[Long Term Lease Container  Delivery Performance Detail Search]]></desc>
			<sql><![CDATA[
SELECT ONHR.CNTR_NO
     , ONHR.CNTR_TPSZ_CD
     , ONHR.LSTM_CD
     , TO_CHAR(ONHR.ONHIRE_DT,'YYYY-MM-DD') AS ONHIRE_DT
     , ONHR.ONHIRE_LOC_CD
     , TO_CHAR(OFHR.CNTR_STS_EVNT_DT,'YYYY-MM-DD') AS OFFHIRE_DT
     , OFHR.YD_CD            AS OFFHIRE_LOC_CD
     , ROUND(OFHR.CNTR_STS_EVNT_DT - ONHR.ONHIRE_DT) - ONHR.FREE_DYS + 1 AS USED_DYS
     , ONHR.FREE_DYS 
     , ONHR.MIN_ONHIRE_DYS
FROM   (
         SELECT HS.CNTR_NO
              , CN.CNTR_TPSZ_CD
              , CN.LSTM_CD
              , HS.CNTR_STS_EVNT_DT  AS ONHIRE_DT
              , HS.YD_CD             AS ONHIRE_LOC_CD
              , HS.RNTL_CHG_FREE_DYS AS FREE_DYS
              , HS.CNTR_MIN_ONH_DYS  AS MIN_ONHIRE_DYS
              , HS.AGMT_CTY_CD
              , HS.AGMT_SEQ
              , HS.CNTR_STS_SEQ
         FROM   MST_CONTAINER CN
              , MST_CNTR_STS_HIS HS
         WHERE  1 = 1
#if (${de_mon} != "")
         AND    TO_CHAR(HS.CNTR_STS_EVNT_DT,'YYYYMM') = @[de_yr] || @[de_mon]
#else
         AND    TO_CHAR(HS.CNTR_STS_EVNT_DT,'YYYY') = @[de_yr]
#end
         AND    substr(nvl(HS.CNTR_STS_RMK, ' '), 1, 6) <> 'SELLOE'
         AND    HS.CNTR_LSTM_CNG_FLG <> 'Y'
         AND    HS.CNTR_STS_CD in ('LSI','DII')
#if (${onhire_loc_cd} != "")
         AND    HS.LCC_CD = @[onhire_loc_cd]
#else
         AND    HS.LCC_CD IN ( SELECT DISTINCT C.LCC_CD 
                               FROM   LSE_LONG_TERM_DE_PLN PLN
								    , MDM_EQ_ORZ_CHT C
							   WHERE  PLN.DEL_CD = C.SCC_CD
#if (${agmt_cty_cd} != "")
                               AND    PLN.AGMT_CTY_CD = @[agmt_cty_cd]
#end
#if (${agmt_seq} != "")
                               AND    PLN.AGMT_SEQ = @[agmt_seq]
#end
#if (${pln_yr} != "")
                               AND    PLN.PLN_YR = @[pln_yr]
#end
#if (${de_yr} != "")
                               AND    SUBSTR(PLN.DE_YRMON, 0, 4) = @[de_yr]
#end
                             )
#end
         AND    CN.CNTR_NO = HS.CNTR_NO
#if (${cntr_tpsz_cd} != "")
         AND    CN.CNTR_TPSZ_CD = @[cntr_tpsz_cd]
#end
#if (${agmt_seq} != "")
         AND    HS.AGMT_SEQ = @[agmt_seq]
#end
#if (${agmt_cty_cd} != "")
         AND    HS.AGMT_CTY_CD = @[agmt_cty_cd]
#end
       ) ONHR
     , MST_CNTR_STS_HIS OFHR
WHERE  ONHR.CNTR_NO = OFHR.CNTR_NO(+)
AND    ONHR.CNTR_STS_SEQ = OFHR.PRNR_STS_SEQ(+)			]]></sql>
			<params>
				<param name="de_yr" type="12" value="" out="N"/>
				<param name="de_mon" type="12" value="" out="N"/>
				<param name="onhire_loc_cd" type="12" value="" out="N"/>
				<param name="agmt_cty_cd" type="12" value="" out="N"/>
				<param name="agmt_seq" type="2" value="" out="N"/>
				<param name="pln_yr" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
