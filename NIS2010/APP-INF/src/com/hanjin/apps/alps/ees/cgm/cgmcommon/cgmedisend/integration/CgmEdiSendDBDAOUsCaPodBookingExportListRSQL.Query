<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CgmEdiSendDBDAOUsCaPodBookingExportListRSQL">
			<desc><![CDATA[오늘시점에서 어제 하루동안 생성된 bkg (export)  POL이 미주 및 캐나다 발]]></desc>
			<sql><![CDATA[
SELECT A.BKG_NO
      ,'XP' IE_IND
      ,'N' FINAL_IND
FROM BKG_BOOKING   A
    ,MDM_LOCATION  C
WHERE A.BKG_CRE_DT BETWEEN TO_DATE(TO_CHAR(SYSDATE-1, 'YYYYMMDD'),'YYYYMMDD')+0.0 AND TO_DATE(TO_CHAR(SYSDATE-1, 'YYYYMMDD'),'YYYYMMDD')+0.99999
AND   A.POL_CD = C.LOC_CD  
AND   C.CNT_CD IN ('US', 'CA') -- 미주 POL
AND   A.BKG_STS_CD <> 'X'
UNiON ALL
SELECT A.BKG_NO
      ,'XP' IE_IND
      ,'Y' FINAL_IND
FROM BKG_BOOKING A
WHERE A.BKG_NO IN
                   (
                       SELECT DISTINCT A.BKG_NO
                       FROM BKG_VVD A
                           ,(   -- 내일 ETA SKD 검색(US, CA 도착)
                                SELECT A.VSL_CD
                                      ,A.SKD_VOY_NO
                                      ,A.SKD_DIR_CD
                                      ,A.VPS_PORT_CD
                                      ,A.CLPT_IND_SEQ
                                FROM VSK_ACT_PORT_SKD A
                                    ,MDM_LOCATION C
                                WHERE A.VPS_PORT_CD = C.LOC_CD      
                                AND   A.ACT_DEP_DT BETWEEN TO_DATE(TO_CHAR(SYSDATE-1, 'YYYYMMDD'),'YYYYMMDD')+0.0 AND TO_DATE(TO_CHAR(SYSDATE-1, 'YYYYMMDD'),'YYYYMMDD')+0.99999
                                AND   C.CNT_CD IN ('US', 'CA')
                                AND   C.DELT_FLG = 'N'
                           ) B
                       WHERE A.VSL_CD           = B.VSL_CD
                       AND   A.SKD_VOY_NO       = B.SKD_VOY_NO
                       AND   A.SKD_DIR_CD       = B.SKD_DIR_CD
                       AND   A.POL_CLPT_IND_SEQ = B.CLPT_IND_SEQ
                       AND   A.POL_CD           = B.VPS_PORT_CD
                   )
AND A.BKG_STS_CD <> 'X'			]]></sql>
			<params>
			</params>
		</query>
	</querys>
</sqls>
