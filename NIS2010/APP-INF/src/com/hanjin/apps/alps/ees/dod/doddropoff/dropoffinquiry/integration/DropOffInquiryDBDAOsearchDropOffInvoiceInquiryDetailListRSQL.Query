<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DropOffInquiryDBDAOsearchDropOffInvoiceInquiryDetailListRSQL">
			<desc><![CDATA[DropOff Invoice Inquiry Detail List]]></desc>
			<sql><![CDATA[
SELECT G.TRO_IB_CFM_OFC_CD
     , G.BKG_NO
     , TO_CHAR(G.TRO_IB_CFM_DT, 'YYYY-MM-DD') TRO_IB_CFM_DT
     , G.CNTR_NO
     , G.CNTR_TPSZ_CD
     , G.DEL_CD
     , G.CNTR_RTN_YD_CD
     , TO_CHAR(G.CNTR_RTN_DT, 'YYYY-MM-DD') CNTR_RTN_DT
     , G.CUST_CNT_CD
     , G.CUST_SEQ
     , G.CUST_CNT_CD || LPAD(G.CUST_SEQ, 6, 0) CUSTOMER 
     , (SELECT SUBSTR(C.CUST_LGL_ENG_NM, 1, 50)
          FROM MDM_CUSTOMER C
         WHERE C.CUST_CNT_CD = G.CUST_CNT_CD
           AND C.CUST_SEQ = G.CUST_SEQ ) CUST_LGL_ENG_NM
     , G.SPCL_CUST_CNT_CD
     , G.SPCL_CUST_SEQ
     , G.SPCL_CUST_CNT_CD || LPAD(G.SPCL_CUST_SEQ, 6, 0) SPC_CUSTOMER
     , (SELECT SUBSTR(C.CUST_LGL_ENG_NM, 1, 50)
          FROM MDM_CUSTOMER C
         WHERE C.CUST_CNT_CD = G.SPCL_CUST_CNT_CD
           AND C.CUST_SEQ = G.SPCL_CUST_SEQ ) SPCL_CUST_LGL_ENG_NM
     , (SELECT F.RFA_NO
        FROM DOD_DRP_OFF_CHG_TRF F
        WHERE F.DRP_OFF_CHG_TRF_SEQ = G.DRP_OFF_CHG_TRF_SPCL_SEQ ) RFA_NO
     , (SELECT F.SC_NO
        FROM DOD_DRP_OFF_CHG_TRF F
        WHERE F.DRP_OFF_CHG_TRF_SEQ = G.DRP_OFF_CHG_TRF_SPCL_SEQ ) SC_NO
     , G.CURR_CD
     ,DECODE( NVL(G.GEN_TRF_AMT, 0), 0,
       (SELECT D.DRP_OFF_CHG_TRF_AMT
          FROM DOD_DRP_OFF_CHG_TRF D
         WHERE 1 = 1
           AND DECODE(D.DEL_CD, NULL, '1', D.DEL_CD) = DECODE(D.DEL_CD, NULL, '1', G.DEL_CD)
           AND D.CNTR_RTN_LOC_CD = SUBSTR(G.CNTR_RTN_YD_CD, 1, 5) -- To Be-RTN CY
           AND DECODE(D.CNTR_RTN_YD_SFX_CD, NULL, '1', D.CNTR_RTN_YD_SFX_CD) = DECODE(D.CNTR_RTN_YD_SFX_CD, NULL, '1', SUBSTR(G.CNTR_RTN_YD_CD, 6, 2)) -- To Be-RTN CY
           AND D.POL_CONTI_CD = SUBSTR(B.ORG_SCONTI_CD, 1, 1)
           AND D.CNTR_TPSZ_CD = G.CNTR_TPSZ_CD
           AND D.DRP_OFF_CHG_TRF_DIV_CD = 'G'
           AND D.DRP_OFF_CHG_TRF_CFM_FLG = 'Y'
           AND D.DRP_OFF_CHG_TRF_EXPT_FLG = 'N'
           AND B.POL_ETD_DT BETWEEN TO_DATE(D.DRP_OFF_CHG_TRF_EFF_DT, 'YYYYMMDD') + .0 AND TO_DATE(D.DRP_OFF_CHG_TRF_EXP_DT, 'YYYYMMDD') + .99999
           AND NVL(D.DEL_CD||D.CNTR_RTN_YD_SFX_CD, 1) = 
           		(SELECT NVL(MAX(D.DEL_CD)||MAX(D.CNTR_RTN_YD_SFX_CD), 1)
                        FROM DOD_DRP_OFF_CHG_TRF D
                 WHERE 1 = 1
                   AND DECODE(D.DEL_CD, NULL, '1', D.DEL_CD) = DECODE(D.DEL_CD, NULL, '1', B.POD_CD)
                   AND D.CNTR_RTN_LOC_CD = SUBSTR(G.CNTR_RTN_YD_CD, 1, 5) -- To Be-RTN CY
                   AND DECODE(D.CNTR_RTN_YD_SFX_CD, NULL, '1', D.CNTR_RTN_YD_SFX_CD) = DECODE(D.CNTR_RTN_YD_SFX_CD, NULL, '1', SUBSTR(G.CNTR_RTN_YD_CD, 6, 2)) -- To Be-RTN CY
                   AND D.POL_CONTI_CD = SUBSTR(B.ORG_SCONTI_CD, 1, 1)
                   AND D.CNTR_TPSZ_CD = G.CNTR_TPSZ_CD
                   AND D.DRP_OFF_CHG_TRF_DIV_CD = 'G'
                   AND D.DRP_OFF_CHG_TRF_CFM_FLG = 'Y'
                   AND D.DRP_OFF_CHG_TRF_EXPT_FLG = 'N'
                   AND B.POL_ETD_DT BETWEEN TO_DATE(D.DRP_OFF_CHG_TRF_EFF_DT, 'YYYYMMDD') + .0 AND TO_DATE(D.DRP_OFF_CHG_TRF_EXP_DT, 'YYYYMMDD') + .99999
                   )
                   
         ), G.GEN_TRF_AMT) GEN_TRF_AMT
     , G.SPCL_TRF_AMT
     , G.DC_AMT
     , G.TTL_AMT
     , G.SVC_FEE_AMT
     , TO_CHAR(G.UPD_DT, 'YYYY-MM-DD HH24:MI:SS') UPD_DT
     , G.UPD_USR_ID
     , (SELECT T.CXL_FLG
        FROM BKG_EUR_TRO T
        WHERE 1 = 1
          AND T.BKG_NO = G.BKG_NO
          AND T.CNTR_NO = G.CNTR_NO
          AND T.IO_BND_CD = 'I'
          AND T.TRO_SEQ = (SELECT MAX(TT.TRO_SEQ)
                            FROM BKG_EUR_TRO TT
                            WHERE TT.BKG_NO = T.BKG_NO
                              AND TT.CNTR_NO = T.CNTR_NO
                              AND TT.IO_BND_CD = 'I')
       ) CXL_FLG
  FROM DOD_DRP_OFF_CHG G, BKG_BOOKING B
 WHERE 1 = 1
   AND G.BKG_NO = @[s_bkg_no] --BKG_NO
   AND G.BKG_NO = B.BKG_NO
   AND G.DRP_OFF_CHG_MNL_FLG = DECODE(@[s_ind_cd], 'I', 'N', 'Y') --  INV : N,  MAN : Y			]]></sql>
			<params>
				<param name="s_bkg_no" type="12" value="" out="N"/>
				<param name="s_ind_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
