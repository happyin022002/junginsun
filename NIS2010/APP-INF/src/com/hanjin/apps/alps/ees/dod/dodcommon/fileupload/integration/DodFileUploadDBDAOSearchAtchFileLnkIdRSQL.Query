<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DodFileUploadDBDAOSearchAtchFileLnkIdRSQL">
			<desc><![CDATA[첨부파일 ID 조회]]></desc>
			<sql><![CDATA[
SELECT 
        CASE 
            WHEN (
                SELECT COUNT(D2.ATCH_FILE_LNK_ID) 
                  FROM DOD_DRP_OFF_CHG D2
                 WHERE 1=1
                   AND D2.BKG_NO = @[bkg_no]
                   AND D2.CNTR_NO = @[cntr_no]
                   AND D2.DRP_OFF_CHG_SEQ = @[drp_off_chg_seq]
                ) > 0 
            THEN 
                F.ATCH_FILE_LNK_ID
            ELSE (
                SELECT TO_CHAR(SYSDATE, 'YYYYMMDD')|| (SELECT LPAD(COUNT(1)+1,5,0) FROM (SELECT DISTINCT ATCH_FILE_LNK_ID FROM DOD_ATCH_FILE WHERE SUBSTR(ATCH_FILE_LNK_ID, 0, 8) = TO_CHAR(SYSDATE, 'YYYYMMDD')) A) 
                  FROM DUAL  
                )
        END ATCH_FILE_LNK_ID
   FROM DOD_DRP_OFF_CHG D, DOD_ATCH_FILE F
  WHERE 1=1
	AND D.BKG_NO = @[bkg_no]
    AND D.CNTR_NO = @[cntr_no]
    AND D.DRP_OFF_CHG_SEQ = @[drp_off_chg_seq]
    AND D.ATCH_FILE_LNK_ID = F.ATCH_FILE_LNK_ID(+)			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="drp_off_chg_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
