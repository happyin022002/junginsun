<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContainerMovementFinderDBDAOSearchMovementErrorListByMultiContainerRSQL">
			<desc><![CDATA[Edi 오류 건 조회.]]></desc>
			<sql><![CDATA[
SELECT BKG_NO,
  BL_NO,
  CALL_SGN_LLOYD,
  CALL_SGN_NO,
  LLOYD_NO,
  CHSS_NO,
  CNTR_FULL_STS_CD,
  CNTR_NO,
  CNTR_SEAL_NO,
  CNTR_TPSZ_CD,
  CRE_LOCL_DT,
  VVD_CD,
  CRNT_VSL_CD,
  CRNT_SKD_VOY_NO,
  CRNT_SKD_DIR_CD,
  DEST_YD_CD,
  POL_CD,
  POD_CD,
  EDI_BKG_NO,
  EDI_GATE_IO_CD,
  EDI_MVMT_STS_CD,
  EVNT_DT,
  EVNT_YD_CD,
  MVMT_EDI_MSG_AREA_CD,
  MVMT_EDI_MSG_SEQ,
  MVMT_EDI_MSG_TP_ID,
  MVMT_EDI_MSG_YRMONDY,
  MVMT_EDI_TP_CD,
  MVMT_EDI_RMK,
  CNMV_RMK,
  MVMT_EDI_RSLT_CD,
  MVMT_EDI_SGHT_CD,
  MVMT_TRSP_MOD_CD,
  RTY_KNT,
  VNDR_SEQ,
  MGST_NO,
  WBL_NO,
  PKUP_NO,
  LCC_CD,
  VGM,
  VGM_MZD_TP_CD,
  VGM_WGT_UT_CD,
  VGM_WGT_QTY,
  VGM_VRFY_DT,
  VGM_SIG_CTNT,
  VGM_REF_NO,
  VGM_WGT_PTY_CTNT,
  VGM_VRFY_ORD_CTNT
FROM (
   SELECT ROW_NUMBER() OVER (ORDER BY EVNT_DT) AS ROWNO,
     BKG_NO,
     BL_NO,
     CALL_SGN_LLOYD,
     CALL_SGN_NO,
     LLOYD_NO,
     CHSS_NO,
     CNTR_FULL_STS_CD,
     CNTR_NO,
     CNTR_SEAL_NO,
     CNTR_TPSZ_CD,
     CRE_LOCL_DT,
     VVD_CD,
     CRNT_VSL_CD,
     CRNT_SKD_VOY_NO,
     CRNT_SKD_DIR_CD,
     DEST_YD_CD,
     POL_CD,
     POD_CD,
     EDI_BKG_NO,
     EDI_GATE_IO_CD,
     EDI_MVMT_STS_CD,
     EVNT_DT,
     EVNT_YD_CD,
     MVMT_EDI_MSG_AREA_CD,
     MVMT_EDI_MSG_SEQ,
     MVMT_EDI_MSG_TP_ID,
     MVMT_EDI_MSG_YRMONDY,
     MVMT_EDI_TP_CD,
     MVMT_EDI_RMK,
     CNMV_RMK,
     MVMT_EDI_SGHT_CD,
     MVMT_TRSP_MOD_CD,
     MVMT_EDI_RSLT_CD,
     RTY_KNT,
     VNDR_SEQ,
     MGST_NO,
     WBL_NO,
     PKUP_NO,
     LCC_CD,
     VGM,
     VGM_MZD_TP_CD,
     VGM_WGT_UT_CD,
     VGM_WGT_QTY,
     VGM_VRFY_DT,
     VGM_SIG_CTNT,
     VGM_REF_NO,
     VGM_WGT_PTY_CTNT,
     VGM_VRFY_ORD_CTNT
   FROM (
      SELECT /*+ USE_NL(D B A) */
        D.BKG_NO,
        D.EDI_BL_NO AS BL_NO,
        NVL(D.CALL_SGN_NO, D.LLOYD_NO) AS CALL_SGN_LLOYD,
        D.CALL_SGN_NO AS CALL_SGN_NO,
        D.LLOYD_NO AS LLOYD_NO,
        D.CHSS_NO,
        D.CNTR_FULL_STS_CD,
        D.CNTR_NO,
        D.CNTR_SEAL_NO,
        D.CNTR_TPSZ_CD,
        TO_CHAR(D.CRE_LOCL_DT, 'YYYY-MM-DD HH24:MI') AS CRE_LOCL_DT,
        D.CRNT_VSL_CD||D.CRNT_SKD_VOY_NO||D.CRNT_SKD_DIR_CD AS VVD_CD,
        D.CRNT_VSL_CD,
        D.CRNT_SKD_VOY_NO,
        D.CRNT_SKD_DIR_CD,
        D.DEST_YD_CD,
        D.BKG_POL_CD AS POL_CD,
        D.BKG_POD_CD AS POD_CD,
        D.EDI_BKG_NO,
        D.EDI_GATE_IO_CD,
        D.EDI_MVMT_STS_CD,
        TO_CHAR(D.EVNT_DT, 'YYYY-MM-DD HH24:MI') AS EVNT_DT,
        D.EVNT_YD_CD,
        D.MVMT_EDI_MSG_AREA_CD,
        D.MVMT_EDI_MSG_SEQ,
        D.MVMT_EDI_MSG_TP_ID,
        D.MVMT_EDI_MSG_YRMONDY,
        D.MVMT_EDI_TP_CD,
        D.MVMT_EDI_RMK,
        D.CNMV_RMK,
        D.MVMT_EDI_SGHT_CD,
        D.MVMT_TRSP_MOD_CD,
        D.MVMT_EDI_RSLT_CD,
        D.RTY_KNT,
        D.VNDR_SEQ,
        D.MGST_NO,
        D.WBL_NO,
        D.PKUP_NO,
        A.LCC_CD,
        D.VGM_WGT_QTY || ' ' || D.VGM_WGT_UT_CD AS VGM,
        D.VGM_MZD_TP_CD,
        DECODE(D.VGM_WGT_UT_CD, 'KGM', 'KGS', D.VGM_WGT_UT_CD) AS VGM_WGT_UT_CD,
        D.VGM_WGT_QTY,
        D.VGM_VRFY_DT,
        D.VGM_SIG_CTNT,
        D.VGM_REF_NO,
        D.VGM_WGT_PTY_CTNT,
        D.VGM_VRFY_ORD_CTNT
      FROM CTM_MVMT_EDI_MSG D,
        MDM_LOCATION B,
        MDM_EQ_ORZ_CHT A
      WHERE 1 = 1
        AND D.MVMT_EDI_RSLT_CD <> 'Y'
        AND 1 = CASE WHEN D.MVMT_EDI_RSLT_CD <> 'N'
                            AND (D.MVMT_EDI_RMK LIKE 'Time gap between event and receiving date is%'
                                 OR D.MVMT_EDI_RMK LIKE 'The same data already%'
                                )
                       THEN 1
                     WHEN D.MVMT_EDI_RSLT_CD = 'N' THEN 1
                     ELSE 0
                END
        AND A.SCC_CD(+) = B.SCC_CD
        AND B.LOC_CD(+) = SUBSTR(D.EVNT_YD_CD, 0, 5)
#if (${cntr_no} != '')
        AND D.CNTR_NO IN (
  #foreach ($cntr_cd in ${cntr_no_list})
      #if ($velocityCount < $cntr_no_list.size()) '$cntr_cd', #else '$cntr_cd' #end
  #end
                         )
#end
#if (${divflag} == 1 || ${divflag} == 3)
        AND D.EVNT_DT BETWEEN TO_DATE (@[p_date1], 'YYYYMMDD') AND TO_DATE (@[p_date2], 'YYYYMMDD') + 0.99999
#else
        AND D.CRE_DT BETWEEN TO_DATE (@[p_date1], 'YYYYMMDD') AND TO_DATE (@[p_date2], 'YYYYMMDD') + 0.99999
#end
#if (${bkg_no} != '')
        AND D.EDI_BKG_NO = @[bkg_no]
#end
#if (${vvd_cd} != '')
        AND D.CRNT_VSL_CD || D.CRNT_SKD_VOY_NO || D.CRNT_SKD_DIR_CD = @[vvd_cd]
#end
#if (${vgm_wgt_qty} != '')
  #if (${vgm_wgt_qty} == 'Y')
        AND D.VGM_WGT_QTY IS NOT NULL
  #else
        AND D.VGM_WGT_QTY IS NULL
  #end
#end
#if (${org_yd_cd} != '')
    AND D.EVNT_YD_CD LIKE @[org_yd_cd] || '%'
#else
  #if (${rcc_cd} != '' && ${rcc_cd} != 'ALL')
    AND D.EVNT_YD_CD IN (SELECT YD_CD FROM MDM_YARD
                         WHERE LOC_CD IN (SELECT LOC_CD
                                          FROM MDM_LOCATION
                                          WHERE DELT_FLG <> 'Y'
                                            AND SCC_CD IN (SELECT SCC_CD FROM MDM_EQ_ORZ_CHT
                                                           WHERE DELT_FLG <> 'Y'
    #if (${lcc_cd} != '' && ${lcc_cd} != 'ALL')
                                                             AND LCC_CD IN (
      #foreach ($lcc_cd in ${lcc_cd_list})
        #if ($velocityCount < $lcc_cd_list.size()) '$lcc_cd', #else '$lcc_cd' #end
      #end
                                                                          )
    #elseif (${rcc_cd} != '' && ${rcc_cd} != 'ALL')
                                                             AND RCC_CD = @[rcc_cd]
    #end
                                                          )
                                         )
                        )
  #end
#end
#if (${cntr_tpsz_cd} != '')
    AND D.CNTR_TPSZ_CD IN (
  #foreach ($tpsz_cd in ${cntr_tpsz_cd_list})
    #if ($velocityCount < $cntr_tpsz_cd_list.size()) '$tpsz_cd', #else '$tpsz_cd' #end
  #end
                          )
#end
#if (${mvmt_sts_cd} != '')
    AND D.EDI_MVMT_STS_CD IN (
  #foreach ($status_cd in ${mvmt_sts_cd_list})
    #if ($velocityCount < $mvmt_sts_cd_list.size()) '$status_cd', #else '$status_cd' #end
  #end
                             )
#end
     )
  )
WHERE ROWNO BETWEEN ((1000 * (TO_NUMBER(@[pagerows]) - 1)) + 1) AND ((1000 * (TO_NUMBER(@[pagerows]) - 1)) + 1000)			]]></sql>
			<params>
				<param name="p_date1" type="12" value="" out="N"/>
				<param name="p_date2" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="org_yd_cd" type="12" value="" out="N"/>
				<param name="rcc_cd" type="12" value="" out="N"/>
				<param name="pagerows" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
