<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OnhireDomesticNewvanShceduleInputDBDAOSearchYearNewPlanRSQL">
			<desc><![CDATA[EQR_SCNR_NEW_VAN_LONG_TERM + EQR_NEW_VAN_LONG_TERM_PERF 테이블 데이터 조회]]></desc>
			<sql><![CDATA[
SELECT
    DECODE(B.NUM, 1, A.CO_CD, 		2, B.NAME , 3, A.CO_CD         ) CO_CD
    ,DECODE(B.NUM, 1, A.RCC_CD, 		2, ''     , 3, A.RCC_CD||' TTL') RCC_CD
    ,DECODE(B.NUM, 1, A.ECC_CD, 		2, ''     , 3, ''              ) ECC_CD
    ,DECODE(B.NUM, 1, A.CNTR_LSTM_CD,   2, ''     , 3, ''              ) CNTR_LSTM_CD
    ,DECODE(B.NUM, 1, A.CNTR_TPSZ_CD,   2, ''     , 3, ''              ) CNTR_TPSZ_CD
    ,DECODE(B.NUM, 1, A.VNDR_ABBR_NM,   2, ''     , 3, ''              ) VNDR_ABBR_NM_CD
    ,DECODE(B.NUM, 1, A.CODE ,  	    2, ''     , 3, ''              ) VNDR_SEQ_CD
    ,A.STATUS CNTR_DE_STS_CD
    ,SUM(A.TOTAL) TOTAL
    #if ($arrPerfixMonth.size() > 0)
        #foreach( $key in ${arrPerfixMonth})
            ,SUM(A.QTY${key}) S1_${key}_CNTR_VOL_QTY
        #end
    #end
    ,DECODE(B.NUM, 1, A.VNDR_CNT_CD,  2, ''       , 3, ''              ) VNDR_CNT_CD
    ,A.NUM NUM1
    ,B.NUM NUM2
FROM
(
    SELECT
    A.CO_CD
    ,A.CNTR_LSTM_CD
    ,A.CNTR_TPSZ_CD
    ,A.RCC_CD
    ,A.ECC_CD
    ,A.VNDR_ABBR_NM
    ,A.VNDR_CNT_CD
    ,A.VNDR_CNT_CD||A.VNDR_SEQ   CODE
    ,B.NUM
    ,B.STATUS
    ,SUM(DECODE(B.NUM, 1, A.QTY1, 2, A.QTY2, 3, A.QTY3, 4, QTY4)) TOTAL
    #if ($arrPerfixMonth.size() > 0)
        #foreach( $key in ${arrPerfixMonth})
            ,SUM(DECODE(A.MONTH, '$key', DECODE(B.NUM, 1, A.QTY1, 2, A.QTY2, 3, A.QTY3, 4, QTY4))) AS QTY${key}
        #end
    #end
    FROM
    (
        SELECT
            B.CO_CD,
            B.CNTR_LSTM_CD,
            B.CNTR_TPSZ_CD,
            C.RCC_CD,
            B.ECC_CD,
            B.VNDR_ABBR_NM,
            B.VNDR_CNT_CD,
            B.VNDR_SEQ,
            A.PLN_YR || A.PLN_MON AS MONTH,
            1 SEQ,
            SUM (B.CNTR_VOL_QTY) AS QTY1,
            0 QTY2,
            0 QTY3,
            0 QTY4
        FROM
            EQR_SCNR_NEW_VAN_LONG_TERM B,
            EQR_WK_PRD A,
            EQR_ECC_MST C
        WHERE
            B.PLN_YRMON BETWEEN @[fmPlnYrwk]  AND @[toPlnYrwk]
            AND   B.CNTR_DE_STS_CD = 'A'
            AND   B.ECC_CD = C.ECC_CD
            AND   A.PLN_YR || A.PLN_WK = B.PLN_YRMON
            AND   B.SCNR_ID = @[scnr_id]
            #if (${location} == 'R')
            AND C.RCC_CD IN(
              #foreach( $key in ${arrlocation})
                #if($velocityCount < $arrlocation.size())
                '$key',
                #else
                '$key'
                #end
              #end
              )
            #elseif (${location} == 'L')
            AND C.LCC_CD IN(
              #foreach( $key in ${arrlocation})
                #if($velocityCount < $arrlocation.size())
                '$key',
                #else
                '$key'
                #end
              #end
            )
            #elseif (${location} == 'E')
            AND B.ECC_CD IN(
              #foreach( $key in ${arrlocation})
                #if($velocityCount < $arrlocation.size())
                '$key',
                #else
                '$key'
                #end
              #end
            )
            #end
            #if ($arrtpszcd.size() > 0)
              AND B.CNTR_TPSZ_CD IN(
              #foreach( $key in ${arrtpszcd})
                #if($velocityCount < $arrtpszcd.size())
                '$key',
                #else
                '$key'
                #end
              #end
              )
            #end
            #if (${leaseterm} != '')
                AND B.CNTR_LSTM_CD =@[leaseterm]
            #end
            GROUP BY CO_CD,
            CNTR_LSTM_CD,
            CNTR_TPSZ_CD,
            C.RCC_CD,
            B.ECC_CD,
            VNDR_CNT_CD,
            VNDR_SEQ,
            A.PLN_YR || A.PLN_MON,
            VNDR_ABBR_NM
        UNION
        SELECT
            A.CO_CD,
            A.CNTR_LSTM_CD,
            A.CNTR_TPSZ_CD,
            C.RCC_CD,
            A.ECC_CD,
            A.VNDR_ABBR_NM,
            A.VNDR_CNT_CD,
            A.VNDR_SEQ,
            A.PERF_YRMON AS MONTH,
            2 SEQ,
            0 QTY1,
            MAX(A.CNTR_AUTH_QTY) AS QTY2,
            0 QTY3,
            0 QTY4
        FROM
            EQR_NEW_VAN_LONG_TERM_PERF A,
            EQR_SCNR_NEW_VAN_LONG_TERM B,
            EQR_ECC_MST C
        WHERE
            A.CO_CD        = B.CO_CD
            AND   A.ECC_CD       = B.ECC_CD
            AND   A.CNTR_LSTM_CD = B.CNTR_LSTM_CD
            AND   A.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD
            AND   A.VNDR_CNT_CD  = B.VNDR_CNT_CD
            AND   A.VNDR_SEQ     = B.VNDR_SEQ
            #if ($arrtpszcd.size() > 0 && $arrPerfixMonth.size() > 0)
                AND A.PERF_YRMON IN(
                #foreach($key in ${arrPerfixMonth})
                    #if($velocityCount < $arrPerfixMonth.size())
                    '$key',
                    #else
                    '$key'
                    #end
                #end
                )
            #end
            AND   B.CNTR_DE_STS_CD = 'A'
            AND   A.ECC_CD = C.ECC_CD
            AND   B.SCNR_ID =@[scnr_id]
            #if (${location} == 'R')
            AND C.RCC_CD IN(
              #foreach( $key in ${arrlocation})
                #if($velocityCount < $arrlocation.size())
                '$key',
                #else
                '$key'
                #end
              #end
              )
            #elseif (${location} == 'L')
            AND C.LCC_CD IN(
              #foreach( $key in ${arrlocation})
                #if($velocityCount < $arrlocation.size())
                '$key',
                #else
                '$key'
                #end
              #end
            )
            #elseif (${location} == 'E')
            AND B.ECC_CD IN(
              #foreach( $key in ${arrlocation})
                #if($velocityCount < $arrlocation.size())
                '$key',
                #else
                '$key'
                #end
              #end
            )
            #end
            #if ($arrtpszcd.size() > 0)
              AND B.CNTR_TPSZ_CD IN(
              #foreach( $key in ${arrtpszcd})
                #if($velocityCount < $arrtpszcd.size())
                '$key',
                #else
                '$key'
                #end
              #end
              )
            #end
            #if (${leaseterm} != '')
                AND B.CNTR_LSTM_CD =@[leaseterm]
            #end
        GROUP BY
            A.CO_CD,
            A.CNTR_LSTM_CD,
            A.CNTR_TPSZ_CD,
            C.RCC_CD,
            A.ECC_CD,
            A.VNDR_ABBR_NM,
            A.VNDR_CNT_CD,
            A.VNDR_SEQ,
            A.PERF_YRMON
        UNION
        SELECT
            A.CO_CD,
            A.CNTR_LSTM_CD,
            A.CNTR_TPSZ_CD,
            C.RCC_CD,
            A.ECC_CD,
            A.VNDR_ABBR_NM,
            A.VNDR_CNT_CD,
            A.VNDR_SEQ,
            A.PERF_YRMON AS MONTH,
            3 SEQ,
            0 QTY1,
            0 QTY2,
            MAX(A.CNTR_PKUP_QTY) AS QTY3,
            0 QTY4
        FROM
            EQR_NEW_VAN_LONG_TERM_PERF A,
            EQR_SCNR_NEW_VAN_LONG_TERM B,
            EQR_ECC_MST C
        WHERE
            A.CO_CD        = B.CO_CD
            AND   A.ECC_CD       = B.ECC_CD
            AND   A.CNTR_LSTM_CD = B.CNTR_LSTM_CD
            AND   A.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD
            AND   A.VNDR_CNT_CD  = B.VNDR_CNT_CD
            AND   A.VNDR_SEQ     = B.VNDR_SEQ
            #if ($arrtpszcd.size() > 0 && $arrPerfixMonth.size() > 0)
                AND A.PERF_YRMON IN(
                #foreach($key in ${arrPerfixMonth})
                    #if($velocityCount < $arrPerfixMonth.size())
                    '$key',
                    #else
                    '$key'
                    #end
                #end
                )
            #end
            AND   B.CNTR_DE_STS_CD = 'A'
            AND   A.ECC_CD = C.ECC_CD
            AND   B.SCNR_ID = @[scnr_id]
            #if (${location} == 'R')
            AND C.RCC_CD IN(
              #foreach( $key in ${arrlocation})
                #if($velocityCount < $arrlocation.size())
                '$key',
                #else
                '$key'
                #end
              #end
              )
            #elseif (${location} == 'L')
            AND C.LCC_CD IN(
              #foreach( $key in ${arrlocation})
                #if($velocityCount < $arrlocation.size())
                '$key',
                #else
                '$key'
                #end
              #end
            )
            #elseif (${location} == 'E')
            AND B.ECC_CD IN(
              #foreach( $key in ${arrlocation})
                #if($velocityCount < $arrlocation.size())
                '$key',
                #else
                '$key'
                #end
              #end
            )
            #end
            #if ($arrtpszcd.size() > 0)
              AND B.CNTR_TPSZ_CD IN(
              #foreach( $key in ${arrtpszcd})
                #if($velocityCount < $arrtpszcd.size())
                '$key',
                #else
                '$key'
                #end
              #end
              )
            #end
            #if (${leaseterm} != '')
                AND B.CNTR_LSTM_CD =@[leaseterm]
            #end
        GROUP BY
            A.CO_CD,
            A.CNTR_LSTM_CD,
            A.CNTR_TPSZ_CD,
            C.RCC_CD,
            A.ECC_CD,
            A.VNDR_ABBR_NM,
            A.VNDR_CNT_CD,
            A.VNDR_SEQ,
            A.PERF_YRMON
        UNION
        SELECT
            A.CO_CD,
            A.CNTR_LSTM_CD,
            A.CNTR_TPSZ_CD,
            C.RCC_CD,
            A.ECC_CD,
            A.VNDR_ABBR_NM,
            A.VNDR_CNT_CD,
            A.VNDR_SEQ,
            A.PERF_YRMON AS MONTH,
            4 SEQ,
            0 QTY1,
            0 QTY2,
            0 QTY3,
            MAX(A.CNTR_AUTH_QTY-A.CNTR_PKUP_QTY) AS QTY4
        FROM
            EQR_NEW_VAN_LONG_TERM_PERF A,
            EQR_SCNR_NEW_VAN_LONG_TERM B,
            EQR_ECC_MST C
        WHERE
            A.CO_CD        = B.CO_CD
            AND   A.ECC_CD       = B.ECC_CD
            AND   A.CNTR_LSTM_CD = B.CNTR_LSTM_CD
            AND   A.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD
            AND   A.VNDR_CNT_CD  = B.VNDR_CNT_CD
            AND   A.VNDR_SEQ     = B.VNDR_SEQ
            #if ($arrtpszcd.size() > 0 && $arrPerfixMonth.size() > 0)
                AND A.PERF_YRMON IN(
                #foreach($key in ${arrPerfixMonth})
                    #if($velocityCount < $arrPerfixMonth.size())
                    '$key',
                    #else
                    '$key'
                    #end
                #end
                )
            #end
            AND   B.CNTR_DE_STS_CD = 'A'
            AND   A.ECC_CD = C.ECC_CD
            AND   B.SCNR_ID =@[scnr_id]
            #if (${location} == 'R')
            AND C.RCC_CD IN(
              #foreach( $key in ${arrlocation})
                #if($velocityCount < $arrlocation.size())
                '$key',
                #else
                '$key'
                #end
              #end
              )
            #elseif (${location} == 'L')
            AND C.LCC_CD IN(
              #foreach( $key in ${arrlocation})
                #if($velocityCount < $arrlocation.size())
                '$key',
                #else
                '$key'
                #end
              #end
            )
            #elseif (${location} == 'E')
            AND B.ECC_CD IN(
              #foreach( $key in ${arrlocation})
                #if($velocityCount < $arrlocation.size())
                '$key',
                #else
                '$key'
                #end
              #end
            )
            #end
            #if ($arrtpszcd.size() > 0)
              AND B.CNTR_TPSZ_CD IN(
              #foreach( $key in ${arrtpszcd})
                #if($velocityCount < $arrtpszcd.size())
                '$key',
                #else
                '$key'
                #end
              #end
              )
            #end
            #if (${leaseterm} != '')
                AND B.CNTR_LSTM_CD =@[leaseterm]
            #end
        GROUP BY
            A.CO_CD,
            A.CNTR_LSTM_CD,
            A.CNTR_TPSZ_CD,
            C.RCC_CD,
            A.ECC_CD,
            A.VNDR_ABBR_NM,
            A.VNDR_CNT_CD,
            A.VNDR_SEQ,
            A.PERF_YRMON
    ) A,
    (
        SELECT 1 NUM, 'Manufactured' STATUS FROM DUAL
        UNION
        SELECT 2 NUM, 'Auth Vol.' STATUS FROM DUAL
        UNION
        SELECT 3 NUM, 'P/Up Vol.' STATUS FROM DUAL
        UNION
        SELECT 4 NUM, 'Balance' STATUS FROM DUAL
    ) B
    WHERE 1=1
    GROUP BY
        A.CO_CD,
        A.CNTR_LSTM_CD,
        A.CNTR_TPSZ_CD,
        A.RCC_CD,
        A.ECC_CD,
        A.VNDR_ABBR_NM,
        A.VNDR_CNT_CD,
        A.VNDR_CNT_CD|| A.VNDR_SEQ ,
        A.VNDR_SEQ,
        B.NUM,
        B.STATUS
) A,
(
    SELECT 1 NUM, ''      NAME FROM DUAL
    UNION
    SELECT 2 NUM, 'TOTAL' NAME FROM DUAL
    UNION
    SELECT 3 NUM, 'TTL'   NAME FROM DUAL
) B
GROUP BY
    DECODE(B.NUM, 1, A.CO_CD, 	     2, B.NAME  , 3, A.CO_CD )
    ,DECODE(B.NUM, 1, A.CNTR_LSTM_CD, 2, ''      , 3, '')
    ,DECODE(B.NUM, 1, A.CNTR_TPSZ_CD, 2, ''      , 3, '')
    ,DECODE(B.NUM, 1, A.RCC_CD, 	     2, ''      , 3, A.RCC_CD||' TTL')
    ,DECODE(B.NUM, 1, A.ECC_CD, 	     2, ''      , 3, '')
    ,DECODE(B.NUM, 1, A.VNDR_ABBR_NM, 2, ''      , 3, '')
    ,DECODE(B.NUM, 1, CODE, 	         2, ''      , 3, '')
    ,A.STATUS
    ,DECODE(B.NUM, 1, A.VNDR_CNT_CD,  2, ''       , 3, '')
    ,A.NUM
    ,B.NUM  -- NORMAL, SUB, GRAND TOTAL
ORDER BY 1, 2, 3, 4, 5, 6, 7, A.NUM			]]></sql>
			<params>
				<param name="fmPlnYrwk" type="12" value="" out="N"/>
				<param name="toPlnYrwk" type="12" value="" out="N"/>
				<param name="scnr_id" type="12" value="" out="N"/>
				<param name="leaseterm" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
