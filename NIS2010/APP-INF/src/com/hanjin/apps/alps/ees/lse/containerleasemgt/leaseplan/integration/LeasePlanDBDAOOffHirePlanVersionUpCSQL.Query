<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="LeasePlanDBDAOOffHirePlanVersionUpCSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
INSERT INTO LSE_OFFH_PLN (
       PLN_YR
     , PLN_SEQ
     , OFFH_VER_SEQ
     , OFFH_YRMON
     , OFFH_PLN_TP_CD
     , OFFH_LOC_TP_CD
     , OFFH_RGN_LOC_CD
     , CNTR_TPSZ_CD
     , OFFH_LOC_CD
     , OFFH_QTY
     , LSTM_CD
     , CRE_USR_ID
     , CRE_DT
     , UPD_USR_ID
     , UPD_DT )
SELECT A.PLN_YR
     , D.MAX_PLN_SEQ + ROWNUM AS PLN_SEQ
     , D.OFFH_VER_NEW_SEQ
     , A.OFFH_YRMON
     , A.OFFH_PLN_TP_CD
     , A.OFFH_LOC_TP_CD
     , A.OFFH_RGN_LOC_CD
     , A.CNTR_TPSZ_CD
     , A.OFFH_LOC_CD
     , A.OFFH_QTY
     , A.LSTM_CD
     , @[cre_usr_id]
     , SYSDATE
     , @[cre_usr_id]
     , SYSDATE
FROM   LSE_OFFH_PLN A
     , ( SELECT P.PLN_YR
              , P.OFFH_VER_MAX_SEQ
              , P.OFFH_VER_NEW_SEQ
              , NVL(MAX(C.PLN_SEQ),0) AS MAX_PLN_SEQ
         FROM   (
                  SELECT @[pln_yr] AS PLN_YR
                       , MAX(B.OFFH_VER_SEQ)   AS OFFH_VER_MAX_SEQ
                       , MAX(B.OFFH_VER_SEQ)+1 AS OFFH_VER_NEW_SEQ
                  FROM   LSE_OFFH_PLN B
                  WHERE  B.PLN_YR = @[pln_yr]
                  AND    B.OFFH_PLN_TP_CD = @[offh_pln_tp_cd]
                  AND    B.OFFH_LOC_TP_CD = @[offh_loc_tp_cd]
                ) P
              , LSE_OFFH_PLN C
         WHERE  C.PLN_YR(+) = P.PLN_YR
         AND    C.OFFH_VER_SEQ(+) = P.OFFH_VER_NEW_SEQ
         GROUP  BY P.PLN_YR, P.OFFH_VER_MAX_SEQ, P.OFFH_VER_NEW_SEQ
       ) D
WHERE  A.PLN_YR = D.PLN_YR
AND    A.OFFH_VER_SEQ = D.OFFH_VER_MAX_SEQ
AND    A.OFFH_PLN_TP_CD = @[offh_pln_tp_cd]
AND    A.OFFH_LOC_TP_CD = @[offh_loc_tp_cd]			]]></sql>
			<params>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="pln_yr" type="12" value="" out="N"/>
				<param name="offh_pln_tp_cd" type="12" value="" out="N"/>
				<param name="offh_loc_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
