<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InterfaceMgtDBDAOsearchInvArIfChgDataRSQL">
			<desc><![CDATA[InterfaceMgtDBDAOsearchInvArIfChgDataRSQL]]></desc>
			<sql><![CDATA[
SELECT 
    	'' AS UPD_DT,
    	1 AS SRC_IF_SEQ,
    	'XXX' AS REP_CHG_CD,
    	MRW.CURR_CD AS CURR_CD,
    	'BL' AS PER_TP_CD,
    	'CLARING_AR AND FA FOR RETIREMENT' AS CHG_FULL_NM,
    	'' AS CRE_DT,
#if (${cancel_yn} == 'Y')
		-1 * MRW.BZC_AMT AS TRF_RT_AMT,
#else
		MRW.BZC_AMT AS TRF_RT_AMT,
#end		
        TO_CHAR(GLOBALDATE_PKG.TIME_CONV_OFC_FNC(MNR_COMMON_PKG.MNR_GET_HOOFC_FNC(), SYSDATE, @[user_ofc_cd]), 'YYYYMMDD') AS SRC_IF_DT,
    	'1' AS CHG_SEQ,
    	'EQD' AS CHG_CD,
    	MRW.CRE_USR_ID AS CRE_USR_ID,
    	'' AS TRF_NO,
#if (${cancel_yn} == 'Y')
		-1 * MRW.BZC_AMT AS CHG_AMT,
#else
		MRW.BZC_AMT AS CHG_AMT,
#end
    	'1' AS RAT_AS_CNTR_QTY,
    	MRW.UPD_USR_ID AS UPD_USR_ID,
    	DECODE(MRW.VAT_AMT, 0, 'N', 'Y') AS TVA_FLG,
       ( SELECT MAX(DECODE(MRW.CURR_CD, MAR.AR_CURR_CD, 1, DECODE(MAR.AR_CURR_CD, A.CURR_CD, USD_LOCL_XCH_RT))) TO_USD_RT
    	 FROM GL_MON_XCH_RT A
    	 WHERE A.ACCT_XCH_RT_LVL   = 1
    	 AND   A.CURR_CD           IN (MRW.CURR_CD, MAR.AR_CURR_CD)
    	 AND   A.ACCT_XCH_RT_YRMON = TO_CHAR(GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[user_ofc_cd], SYSDATE, MNR_COMMON_PKG.MNR_GET_HOOFC_FNC()), 'YYYYMM')
    	 GROUP BY A.ACCT_XCH_RT_YRMON
    	) AS INV_XCH_RT,
    	'957112' AS CHG_RMK
FROM MNR_RCV_INV_WRK MRW, MDM_ORGANIZATION MAR
WHERE MRW.ISS_OFC_CD = MAR.OFC_CD
AND   MAR.AR_OFC_CD   = MAR.OFC_CD
AND   MRW.RCV_INV_SEQ = @[rcv_inv_seq]
AND   ROWNUM = 1	
UNION ALL
SELECT 
    	'' AS UPD_DT,
    	1 AS SRC_IF_SEQ,
    	'SLC' AS REP_CHG_CD,
    	MRW.CHG_CURR_CD AS CURR_CD,
    	'BL' AS PER_TP_CD,
    	'V.A.T RECEIVED' AS CHG_FULL_NM,
    	'' AS CRE_DT,
#if (${cancel_yn} == 'Y')
		-1 * MRW.VAT_AMT AS TRF_RT_AMT,
#else
		MRW.VAT_AMT AS TRF_RT_AMT,
#end		
        TO_CHAR(SYSDATE, 'YYYYMMDD') AS SRC_IF_DT,
    	'2' AS CHG_SEQ,
    	'TVA' AS CHG_CD,
    	MRW.CRE_USR_ID AS CRE_USR_ID,
    	'' AS TRF_NO,
#if (${cancel_yn} == 'Y')
		-1 * MRW.VAT_AMT AS CHG_AMT,
#else
		MRW.VAT_AMT AS CHG_AMT,
#end
    	'1' AS RAT_AS_CNTR_QTY,
    	MRW.UPD_USR_ID AS UPD_USR_ID,
    	'N' AS TVA_FLG,
        1   AS INV_XCH_RT,
    	'212111' AS CHG_RMK
FROM MNR_RCV_INV_WRK MRW, MDM_ORGANIZATION MAR
WHERE MRW.ISS_OFC_CD = MAR.OFC_CD
AND   MAR.AR_OFC_CD   = MAR.OFC_CD
AND   MRW.RCV_INV_SEQ = @[rcv_inv_seq]	
AND   MRW.VAT_AMT <> 0
AND   ROWNUM = 1			]]></sql>
			<params>
				<param name="user_ofc_cd" type="12" value="" out="N"/>
				<param name="rcv_inv_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
