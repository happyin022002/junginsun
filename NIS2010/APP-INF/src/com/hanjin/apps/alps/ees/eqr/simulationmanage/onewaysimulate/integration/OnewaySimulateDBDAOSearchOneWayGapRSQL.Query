<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OnewaySimulateDBDAOSearchOneWayGapRSQL">
			<desc><![CDATA[EQR_ONE_WY_OFFR에서 One Way Offer Gap 정보 검색
offer가 생성이 되기전 입력된 수량과 실제로 반영되어 보여지는 차를 구한다.]]></desc>
			<sql><![CDATA[
SELECT 	       
	#foreach( ${key} in ${cntrTpSzList}) 
		NVL( ${key.field2} - SUM(OFFER${key.field1}),0)    OFF${key.field1}
		#if( $velocityCount < $cntrTpSzList.size() )
			,   
		#end
	#end	                                                                                                                                                                                                                                                                                                                     
FROM 
	(                                                                                                                                                                                                                                                                                                                                                 
   		SELECT   
			FCAST_YRWK                                                                                                                                                                                                                                                                                                                                   
			, FM_ECC_CD
			, TO_ECC_CD    
			#foreach( ${key} in ${cntrTpSzList}) 
				, ROUND(NVL(${key.field1}/DECODE(${key.field1}SUM,0,NULL,${key.field1}SUM),0) * ${key.field2}  ,0)  OFFER${key.field1}  
			#end	                                                                                 
	 	FROM 
			(                                                                                                                              
	        	SELECT  
					FCAST_YRWK
					, FM_ECC_CD
					, TO_ECC_CD
					#foreach( ${key} in ${arrtpszcd})                                                                                                           
						, SUM(DECODE(CNTR_TPSZ_CD , '$key', CNTR_VOL_QTY)) ${key}                                                                       
					#end 
					#foreach( ${key} in ${arrtpszcd})
	   	 				, (
								SELECT 
									SUM(DECODE(CNTR_TPSZ_CD , '$key', CNTR_VOL_QTY)) 
           						FROM 
									EQR_OB_FCAST 
                					, (
										SELECT 
											ecc_cd 
										FROM 
											eqr_ecc_mst 
										WHERE 
											1 = 1
                         					#if (${fmecccd} != '') 
            									#if (${fmtype} == 'R')
                 									AND RCC_CD IN (${arrfmecccd}) 
												#end
            									#if (${fmtype} == 'L')
                 									AND LCC_CD IN (${arrfmecccd})
												#end
            									#if (${fmtype} == 'E')
                 									AND ECC_CD IN (${arrfmecccd})
												#end
		 				 					#end
                         			) c
                      				, (
										SELECT 
											ecc_cd 
										FROM 
											eqr_ecc_mst 
										WHERE 
											1 = 1 
                          					#if (${toecccd} != '') 
            									#if (${totype} == 'R')
                									AND RCC_CD IN (${arrtoecccd}) 
												#end
            									#if (${totype} == 'L')
                 									AND LCC_CD IN (${arrtoecccd})
												#end
            									#if (${totype} == 'E')
                 									AND ECC_CD IN (${arrtoecccd})
												#end
		  									#end
						 			) d   			 
           						WHERE  
									SCNR_ID = @[scnr_id] 
           							AND FCAST_YRWK  BETWEEN  @[fm_yrwk] AND  @[to_yrwk] 
           							AND fm_ecc_cd = c.ecc_cd 
									AND to_ecc_cd = d.ecc_cd 
          					) ${key}SUM
					#end
	  			FROM 
					(                                                                                                                
						SELECT 
							FCAST_YRWK
							, FM_ECC_CD
							, TO_ECC_CD
							, CNTR_TPSZ_CD
							, CNTR_VOL_QTY
							, ROW_NUMBER() OVER (PARTITION BY FCAST_YRWK, FM_ECC_CD , TO_ECC_CD , CNTR_TPSZ_CD  ORDER BY ROWNUM) RUMM       
						FROM 
							EQR_OB_FCAST                                                                                                                                                                                                                                                                                                                        
			  				, (
								SELECT 
									ecc_cd 
								FROM 
									eqr_ecc_mst 
								WHERE 
									1 = 1
                         			#if (${fmecccd} != '') 
            							#if (${fmtype} == 'R')
                 							AND RCC_CD IN (${arrfmecccd}) 
										#end
            							#if (${fmtype} == 'L')
                 							AND LCC_CD IN (${arrfmecccd})
										#end
            							#if (${fmtype} == 'E')
                 							AND ECC_CD IN (${arrfmecccd})
										#end
		 				 			#end
                         	) c
                      		, (
								SELECT 
									ecc_cd 
								FROM 
									eqr_ecc_mst 
								WHERE 
									1 = 1 
                          			#if (${toecccd} != '') 
            							#if (${totype} == 'R')
                							AND RCC_CD IN (${arrtoecccd}) 
										#end
            							#if (${totype} == 'L')
                 							AND LCC_CD IN (${arrtoecccd})
										#end
            							#if (${totype} == 'E')
                 							AND ECC_CD IN (${arrtoecccd})
										#end
		  							#end
						 	) d   			 	                                                                       
						WHERE 
							SCNR_ID = @[scnr_id]                                                                                                                                                                                                                                                                                                         
		    				AND FCAST_YRWK  BETWEEN  @[fm_yrwk]  AND @[to_yrwk]                                                                                                                                                                                                                                                          
		    				AND fm_ecc_cd = c.ecc_cd 
							AND to_ecc_cd = d.ecc_cd                            
		   			)	                                                                                                                                                                                                                                                                                                                                             
				GROUP BY 
					FCAST_YRWK
					, FM_ECC_CD
					, TO_ECC_CD                                                                                                                                                                                                                                                                                                                                
			)                                                                                                                                                                                                                                                                                                                                           
	)			]]></sql>
			<params>
				<param name="scnr_id" type="12" value="" out="N"/>
				<param name="fm_yrwk" type="12" value="" out="N"/>
				<param name="to_yrwk" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
