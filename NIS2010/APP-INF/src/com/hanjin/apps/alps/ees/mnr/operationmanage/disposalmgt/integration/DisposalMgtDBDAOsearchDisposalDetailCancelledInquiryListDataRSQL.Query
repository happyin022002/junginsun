<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DisposalMgtDBDAOsearchDisposalDetailCancelledInquiryListDataRSQL">
			<desc><![CDATA[DisposalMgtDBDAOsearchDisposalDetailCancelledInquiryListDataRSQL]]></desc>
			<sql><![CDATA[
SELECT
    E.MNR_CD_DESC AS DISP_TP_NM
    , A.INV_NO
    , (SELECT SUM(H.INV_AMT) AS TTL_AMT
        FROM                
            MNR_DISP_CXL_DTL H
        WHERE       
            H.RCV_INV_SEQ = A.RCV_INV_SEQ
            AND H.DISP_NO = B.DISP_NO
            AND H.CXL_INV_SEQ = B.CXL_INV_SEQ
        GROUP BY 
            H.DISP_NO
            , H.CXL_INV_SEQ    
    ) AS TTL_AMT
    , B.DISP_NO
    , B.CXL_INV_SEQ
    , B.EQ_NO
    , B.EQ_TPSZ_CD
    , B.DISP_RLSE_NO
    , C.CURR_CD
    , B.INV_AMT
    , MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(A.ISS_DT, 'YYYYMM'), C.CURR_CD, 'USD', B.INV_AMT) AS USD_TTL_AMT
    , TO_CHAR(C.RQST_DT, 'yyyy-mm-dd') AS RQST_DT     
    , TO_CHAR(B.DISP_SOLD_DT, 'yyyy-mm-dd') AS DISP_SOLD_DT      
    , TO_CHAR(A.INV_DUE_DT, 'yyyy-mm-dd') AS INV_DUE_DT  
    , B.MNR_DISP_DTL_RMK
	, F.DP_PRCS_KNT 
FROM 
    (SELECT DISTINCT(RCV_INV_SEQ), INV_DUE_DT, INV_NO, ISS_DT 
        FROM MNR_CXL_RCV_INV_WRK
        WHERE 		
		#if (${inv_no_list} != '')
    	    INV_NO IN (
			#foreach ($user_invNos IN ${invNos})
				#if($velocityCount < $invNos.size())
					'$user_invNos',
				#else
					'$user_invNos'
				#end
			#end
		) 
		#end	
	) A
    , (SELECT H.DISP_NO
            , MAX(DISP_TP_CD) AS DISP_TP_CD
            , MAX(CURR_CD) AS CURR_CD
            , MAX(RQST_DT) AS RQST_DT  
        FROM MNR_DISP_CXL_HDR H
            , (SELECT DISTINCT(RCV_INV_SEQ)
                FROM MNR_CXL_RCV_INV_WRK
                WHERE 
				#if (${inv_no_list} != '')
			        INV_NO IN (
					#foreach ($user_invNos IN ${invNos})
						#if($velocityCount < $invNos.size())
							'$user_invNos',
						#else
							'$user_invNos'
						#end
					#end
				) 
				#end
				) W
            , MNR_DISP_CXL_DTL D
        WHERE
            W.RCV_INV_SEQ = D.RCV_INV_SEQ
            AND H.DISP_NO = D.DISP_NO
        GROUP BY H.DISP_NO              
	) C
	,  MNR_DISP_CXL_DTL B, MNR_GEN_CD E, MDM_CURRENCY F
WHERE 
    A.RCV_INV_SEQ = B.RCV_INV_SEQ
    AND B.DISP_NO = C.DISP_NO
	AND C.CURR_CD = F.CURR_CD
	AND E.PRNT_CD_ID(+) = 'CD00035'
	AND C.DISP_TP_CD = E.MNR_CD_ID(+)
ORDER BY 
	B.DISP_NO
	, B.CXL_INV_SEQ
	, B.DISP_RLSE_NO			]]></sql>
			<params>
			</params>
		</query>
	</querys>
</sqls>
