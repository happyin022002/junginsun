<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RepoThresholdManageDBDAOSearchCntrFcastRLAThresholdRSQL">
			<desc><![CDATA[EQR_OB_FCAST_RED_LGT_ALT 테이블에서 데이터 조회]]></desc>
			<sql><![CDATA[
SELECT 
    RCC RCC_CD
    ,TYPE1_DESC
    ,TYPE2
    ,DECODE(
        TYPE2NUM, 1, ROUND(SUM(RLA)/
        DECODE((
#foreach( $key in ${tpszarr})
	#if($velocityCount == 1)
			DECODE(MAX(DECODE(TPSZ, '$key', RLA)), NULL, 0, 0, 0, 1)
	#else
			+ DECODE(MAX(DECODE(TPSZ, '$key', RLA)), NULL, 0, 0, 0, 1)
	#end
#end
		), 0, 1, 
#foreach( $key in ${tpszarr})
	#if($velocityCount == 1)
			DECODE(MAX(DECODE(TPSZ, '$key', RLA)), NULL, 0, 0, 0, 1)
	#else
			+ DECODE(MAX(DECODE(TPSZ, '$key', RLA)), NULL, 0, 0, 0, 1)
	#end
#end
		)
        , 2), 2, SUM(RLA)
    ) TOTAL
#foreach( $key in ${tpszarr}) 
    ,MAX(DECODE(TPSZ, '$key', RLA))  ${key}RLA
#end
    ,TYPE1_CODE RLA_TP_CD
    ,RCCNUM
    ,TYPE1NUM
    ,TYPE2NUM
FROM
(
    SELECT
        A.RCC RCC
        ,A.TYPE1_CODE TYPE1_CODE
        ,A.TYPE1_DESC TYPE1_DESC
        ,A.TYPE2 TYPE2
        ,NVL(DECODE(A.TYPE2, 'Ratio', B.RLA_RTO, 'Qty', B.RLA_QTY), 0) RLA
        ,B.CNTR_TPSZ_CD TPSZ
        ,A.RCCNUM
        ,A.TYPE1NUM
        ,A.TYPE2NUM
    FROM
    (
        SELECT
            A.INTG_CD_VAL_DP_DESC RCC
            ,B.INTG_CD_VAL_CTNT    TYPE1_CODE
            ,B.INTG_CD_VAL_DP_DESC TYPE1_DESC
            ,C.PARAM               TYPE2
            ,A.INTG_CD_VAL_DP_SEQ  RCCNUM
            ,B.NUM                 TYPE1NUM
            ,C.NUM                 TYPE2NUM
        FROM COM_INTG_CD_DTL A,
        (
            SELECT
                INTG_CD_VAL_CTNT,
                INTG_CD_VAL_DP_DESC,
                ROWNUM NUM
            FROM COM_INTG_CD_DTL
            WHERE 1=1
            AND   INTG_CD_ID = 'CD00256'
            ORDER BY INTG_CD_VAL_DP_SEQ
        ) B,
        (
        SELECT 'Ratio' PARAM, 1 NUM FROM DUAL
        UNION ALL
        SELECT 'Qty'   PARAM, 2 NUM FROM DUAL
        ) C
        WHERE 1=1
        AND   A.INTG_CD_ID = 'CD00255'
        ORDER BY A.INTG_CD_VAL_DP_SEQ,
        B.NUM,
        C.NUM
    ) A,
    EQR_OB_FCAST_RED_LGT_ALT B
    WHERE A.RCC        = B.RCC_CD(+)
    AND   A.TYPE1_CODE = B.RLA_TP_CD(+)
)
GROUP BY
    RCC
    ,TYPE1_CODE
    ,TYPE1_DESC
    ,TYPE2
    ,RCCNUM
    ,TYPE1NUM
    ,TYPE2NUM
ORDER BY RCCNUM, TYPE1NUM, TYPE2NUM			]]></sql>
			<params>
			</params>
		</query>
	</querys>
</sqls>
