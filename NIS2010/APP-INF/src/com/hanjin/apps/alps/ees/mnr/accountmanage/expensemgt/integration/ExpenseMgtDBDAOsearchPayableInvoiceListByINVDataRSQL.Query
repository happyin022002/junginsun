<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ExpenseMgtDBDAOsearchPayableInvoiceListByINVDataRSQL">
			<desc><![CDATA[ExpenseMgtDBDAOsearchPayableInvoiceListByINVDataRSQL
-- 2014.11 10만불 결제관련]]></desc>
			<sql><![CDATA[
SELECT   ORD.COST_OFC_CD
       , A.PAY_INV_SEQ
       , A.INV_NO WO_NO
       , A.MNR_INP_TP_CD AS WO_TYPE_CODE
       , D.MNR_CD_DESC AS WO_TYPE
       , MNR_COMMON_PKG.MNR_CONV_PARTNER_CD_FNC(A.ORD_VNDR_SEQ) AS VNDR_SEQ
       , ( SELECT VNDR_LGL_ENG_NM FROM MDM_VENDOR WHERE VNDR_SEQ = A.ORD_VNDR_SEQ ) AS VNDR_LGL_ENG_NM
       , MNR_COMMON_PKG.MNR_CONV_PARTNER_CD_FNC(A.MNR_PRNR_SEQ) AS MNR_PRNR_SEQ
       , V.VNDR_LGL_ENG_NM AS PAY_VNDR_LGL_ENG_NM
       , TO_CHAR(A.RCV_DT , 'YYYY-MM-DD') AS RCV_DT
       , TO_CHAR(A.EFF_DT , 'YYYY-MM-DD') AS EFF_DT
       , TO_CHAR(A.ISS_DT , 'YYYY-MM-DD') AS ISS_DT
       , TO_CHAR(A.CFM_DT , 'YYYY-MM-DD') AS CFM_DT
       , TO_CHAR(GLOBALDATE_PKG.TIME_CONV_OFC_FNC(MNR_COMMON_PKG.MNR_GET_HOOFC_FNC(), A.CRE_DT, @[user_ofc_cd]), 'YYYY-MM-DD') AS CRE_DT
       , A.BZC_AMT AS MNR_WRK_AMT
       , A.SLS_TAX_AMT
       , A.VAT_AMT
       , A.WHLD_TAX_AMT
       , A.TTL_AMT
       , A.MNR_INV_RMK
       , A.MNR_INV_STS_CD
       , (
           SELECT   MGC.MNR_CD_DESC
           FROM     MNR_GEN_CD MGC 
           WHERE    1 = 1
           AND      DECODE(A.MNR_INV_STS_CD, 'HC', API.INV_STS_CD,A.MNR_INV_STS_CD) = MGC.MNR_CD_ID 
           AND      MGC.PRNT_CD_ID IN ('CD00027', 'CD00042')
           AND      ROWNUM = 1
         ) AS MNR_INV_STS_NM
       , A.GEN_PAY_TERM_CD AS PAY_TERM_DYS
       , A.CURR_CD AS CURR_CD
       , A.ISS_OFC_CD
       , API.CSR_NO
       , A.INV_RGST_NO
       , E.DP_PRCS_KNT
       , FILE_SEQ
       , NVL(A.ENV_CHG_TAX, 0) AS ENV_CHG_TAX -- 인도지역의 SBC Tax
       , L.CNT_CD
       , V.IDA_SPCL_ECN_ZN_UT_FLG
       , CASE WHEN V.IDA_GST_RGST_NO IS NULL THEN 'N' ELSE 'Y' END AS IDA_GST_RGST_NO_FLG
       , V.IDA_GST_RGST_NO
       , (
           SELECT   S.IDA_STE_CD
           FROM     MDM_STATE S
                  , MDM_LOCATION L
           WHERE    1 = 1
           AND      S.CNT_CD = L.CNT_CD
           AND      S.STE_CD = L.STE_CD
           AND      L.LOC_CD = V.LOC_CD
         ) AS IDA_STE_CD
       , (
           SELECT   S.STE_NM
           FROM     MDM_STATE S
                  , MDM_LOCATION L
           WHERE    1 = 1
           AND      S.CNT_CD = L.CNT_CD
           AND      S.STE_CD = L.STE_CD
           AND      L.LOC_CD = V.LOC_CD
         ) AS IDA_STE_NM
FROM     MNR_PAY_INV_WRK A
       , MDM_VENDOR V
       , MNR_GEN_CD D
       , MDM_CURRENCY E
       , AP_PAY_INV API
       , (
           SELECT   DISTINCT B.PAY_INV_SEQ
                  , A.COST_OFC_CD
	       FROM     MNR_ORD_HDR A
                  , MNR_ORD_DTL B
		   WHERE    1 = 1
           AND      A.MNR_ORD_OFC_CTY_CD = B.MNR_ORD_OFC_CTY_CD 
		   AND      A.MNR_ORD_SEQ = B.MNR_ORD_SEQ
#if (${cost_ofc_cd} != '')
		   AND      A.COST_OFC_CD= @[cost_ofc_cd]
#end
		   AND      B.PAY_INV_SEQ > 1
         ) ORD
       , MDM_ORGANIZATION O
       , MDM_LOCATION L
WHERE    1 = 1
AND      A.MNR_PRNR_SEQ = V.VNDR_SEQ(+)
AND      A.MNR_GRP_TP_CD = 'RPR'
AND      D.PRNT_CD_ID(+)='CD00019'
AND      A.MNR_INP_TP_CD = D.MNR_CD_ID(+)
AND      A.CURR_CD = E.CURR_CD
AND	     A.PAY_INV_SEQ = ORD.PAY_INV_SEQ
AND      ORD.COST_OFC_CD = O.OFC_CD
AND      O.LOC_CD = L.LOC_CD

#if (${inv_ofc_cd} != '')
AND      A.ISS_OFC_CD = @[inv_ofc_cd]
#else
    #if (${cost_ofc_cd} == '')
AND      A.ISS_OFC_CD = @[user_ofc_cd]
    #end
#end

#if (${woNos} != '')
AND	     A.INV_NO IN
         (
    #foreach ($user_woNos IN ${woNos})
        #if($velocityCount < $woNos.size())
				'$user_woNos',
        #else
				'$user_woNos'
        #end
    #end			  
         )
#else
    #if (${input_date_type_code}=='R')
AND      A.RCV_DT BETWEEN TO_DATE(@[from_dt], 'YYYY-MM-DD') AND TO_DATE(@[to_dt], 'YYYY-MM-DD') + 0.99999
	#elseif (${input_date_type_code}=='C')
AND      A.UPD_DT BETWEEN GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[user_ofc_cd], TO_DATE(@[from_dt], 'YYYY-MM-DD'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC()) AND GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[user_ofc_cd], TO_DATE(@[to_dt], 'YYYY-MM-DD'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC())+ 0.99999
AND      A.INV_RGST_NO IS NOT NULL
	#elseif (${from_dt} != '' && ${to_dt} != '') 
AND      A.CRE_DT BETWEEN GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[user_ofc_cd], TO_DATE(@[from_dt], 'YYYY-MM-DD'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC()) AND GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[user_ofc_cd], TO_DATE(@[to_dt], 'YYYY-MM-DD'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC())+ 0.99999
	#end
#end

#if (${invNos} != '')
AND	     A.INV_NO IN
         (
    #foreach ($user_invNos IN ${invNos})
        #if($velocityCount < $invNos.size())
				'$user_invNos',
        #else
				'$user_invNos'
        #end
    #end			  
         )
#end

#if (${vndr_seq} != '') 
AND      A.ORD_VNDR_SEQ = TO_NUMBER(@[vndr_seq])
#end

#if (${input_type_code} != '') 
AND      A.MNR_INP_TP_CD= @[input_type_code]
#end

AND      API.INV_SUB_SYS_CD(+)='MNR'	
AND      A.INV_RGST_NO = API.INV_RGST_NO(+)

#if (${mnr_inv_sts_cd} != '') 
    #if (${InvStsLen} == '2') 
AND      A.MNR_INV_STS_CD= @[mnr_inv_sts_cd]
	#else
AND      API.INV_STS_CD = @[mnr_inv_sts_cd]
	#end
#end

#if (${csrNos} != '')
AND	     A.INV_RGST_NO IN
         (
           SELECT   API.INV_RGST_NO 
           FROM     AP_PAY_INV API 
           WHERE    1 = 1
           AND      API.INV_SUB_SYS_CD = 'MNR'
           AND      API.CSR_NO IN
                    ( 
    #foreach ($user_csrNos IN ${csrNos})
        #if($velocityCount < $csrNos.size())
                        '$user_csrNos',
        #else
                        '$user_csrNos'
        #end
    #end			  
                    )
         )
#end
#if (${inv_wo_no} != '')
AND	     A.PAY_INV_SEQ IN
         (
		   SELECT   B.PAY_INV_SEQ
		   FROM     MNR_ORD_HDR A
                  , MNR_ORD_DTL B
		   WHERE    1 = 1
           AND      A.MNR_ORD_OFC_CTY_CD = B.MNR_ORD_OFC_CTY_CD 
		   AND      A.MNR_ORD_SEQ = B.MNR_ORD_SEQ
		   AND      A.MNR_ORD_SEQ IN
                    (
    #foreach ($user_invWoNos IN ${invWoNos})
        #if($velocityCount < $invWoNos.size())
					$user_invWoNos,
        #else
					$user_invWoNos
        #end
    #end
                    )
         )
#end			]]></sql>
			<params>
				<param name="user_ofc_cd" type="12" value="" out="N"/>
				<param name="cost_ofc_cd" type="12" value="" out="N"/>
				<param name="inv_ofc_cd" type="12" value="" out="N"/>
				<param name="from_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
				<param name="input_type_code" type="12" value="" out="N"/>
				<param name="mnr_inv_sts_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
