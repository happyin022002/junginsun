<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="VslResidualSpaceManageDBDAOSearchBSInfoRSQL">
			<desc><![CDATA[EQR_SCNR_BSA_VVD + EQR_SCNR_BSA_PORT 테이블에서 scnr bsa 정보 조회]]></desc>
			<sql><![CDATA[
SELECT                                                   
    A.FM_YRWK FROM_YEAR_WEEK ,										    
    A.TO_YRWK TO_YEAR_WEEK ,										    
    A.CO_CD  COMPANY_CODE ,										    
    A.TRD_CD TRADE_CODE ,											
    -- 	    A.SUB_TRD_CD,										
    A.VSL_LANE_CD VESSL_LANE_CODE,										
    A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD  VVD,			
    A.VSL_SPC ,											
    A.VSL_WGT,											
    A.VSL_BSA_RF_SUB_SPC ,                               
    A.VSL_BSA_DRY_SUB_SPC ,                              
    A.SCNR_ID,											
    A.VSL_CD,											
    A.SKD_VOY_NO,										
    A.SKD_DIR_CD,										
    A.VSL_BSA_USD_FLG                                   
FROM 
    EQR_SCNR_BSA_VVD A ,								
    (
    SELECT 
        a.FM_YRWK
        , a.TO_YRWK
        , A.VVD
        , A.SCNR_ID
        , A.CO_CD  
    FROM                                                            
        (
        SELECT											
            FM_YRWK,										
            TO_YRWK,										
            VSL_CD||SKD_VOY_NO||SKD_DIR_CD  VVD,			
            SCNR_ID,										    
            CO_CD										    
        FROM 
            EQR_SCNR_BSA_PORT  						
        WHERE 
            SCNR_ID = @[scnrId]						
            AND FM_YRWK BETWEEN @[fmPln]  AND @[toPln]      
        #if(${fmEccCd} != '')
			AND VSL_PORT_CD IN (
			#foreach($key IN ${arrFmEccCd}) 
				#if($velocityCount < $arrFmEccCd.size()) 
					'$key', 
				#else 
					'$key' 
					#end 
			#end 
			)
		#end  
        #if(${vvd} != '')
			AND VSL_CD||SKD_VOY_NO||SKD_DIR_CD IN(
			#foreach($key IN ${arrvvd}) 
				#if($velocityCount < $arrvvd.size()) 
					'$key', 
				#else 
					'$key' 
					#end 
			#end 
			)
		#end
        #if(${cntrTpszCd} != '')
			AND CNTR_TPSZ_CD  IN(
			#foreach($key IN ${arrCntrTpszCd}) 
				#if($velocityCount < $arrCntrTpszCd.size()) 
					'$key', 
				#else 
					'$key' 
					#end 
			#end 
			)
		#end
        GROUP BY  
            FM_YRWK
            ,TO_YRWK
            ,VSL_CD||SKD_VOY_NO||SKD_DIR_CD
            , SCNR_ID
            , CO_CD
        ) a , 
        (
        SELECT											
            FM_YRWK,										
            TO_YRWK,										
            VSL_CD||SKD_VOY_NO||SKD_DIR_CD  VVD,			
            SCNR_ID,									    
            CO_CD										    
        FROM 
            EQR_SCNR_BSA_PORT  						
        WHERE             
            SCNR_ID = @[scnrId]						   
            AND TO_YRWK BETWEEN @[fmToPln]  AND @[toToPln] 
        #if(${toEccCd} != '')
			AND VSL_PORT_CD IN (
			#foreach($key IN ${arrToEccCd}) 
				#if($velocityCount < $arrToEccCd.size()) 
					'$key', 
				#else 
					'$key' 
					#end 
			#end 
			)
		#end 
        #if(${vvd} != '')
			AND VSL_CD||SKD_VOY_NO||SKD_DIR_CD IN(
			#foreach($key IN ${arrvvd}) 
				#if($velocityCount < $arrvvd.size()) 
					'$key', 
				#else 
					'$key' 
					#end 
			#end 
			)
		#end
        GROUP BY  
            FM_YRWK
            ,TO_YRWK
            ,VSL_CD||SKD_VOY_NO||SKD_DIR_CD
            , SCNR_ID
            , CO_CD
        ) b 
    WHERE   
        A.SCNR_ID = B.SCNR_ID					
        AND     A.VVD = B.VVD					
        AND     A.CO_CD = B.CO_CD	            
        AND     A.FM_YRWK = B.FM_YRWK			
        AND     A.TO_YRWK = B.TO_YRWK			
    
    ) B                                                         
WHERE 
    A.SCNR_ID = B.SCNR_ID                             
    AND A.FM_YRWK = B.FM_YRWK                         
    AND A.TO_YRWK = B.TO_YRWK                         
    AND A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD =B.VVD   
    AND A.CO_CD = B.CO_CD                   
#if(${lane} != '')
	AND A.VSL_LANE_CD IN(
	#foreach($key IN ${arrlane}) 
		#if($velocityCount < $arrlane.size()) 
			'$key', 
		#else 
			'$key' 
		#end 
	#end 
	)
#end			]]></sql>
			<params>
				<param name="scnrId" type="12" value="" out="N"/>
				<param name="fmPln" type="12" value="" out="N"/>
				<param name="toPln" type="12" value="" out="N"/>
				<param name="fmToPln" type="12" value="" out="N"/>
				<param name="toToPln" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
