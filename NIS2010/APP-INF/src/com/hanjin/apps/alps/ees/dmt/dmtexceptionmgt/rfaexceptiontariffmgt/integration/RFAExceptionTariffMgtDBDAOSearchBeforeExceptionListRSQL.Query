<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RFAExceptionTariffMgtDBDAOSearchBeforeExceptionListRSQL">
			<desc><![CDATA[DEM/DET Adjustment Request - Before Booking Request 에 등록된 정보를 조회하는 쿼리]]></desc>
			<sql><![CDATA[
SELECT  NEW.VIEW_VER_SEQ
	,	NEW.DMDT_TRF_CD
	,	NEW.EFF_DT
	,	NEW.EXP_DT
	,	NEW.DMDT_CNTR_CGO_TP_CD
	,	NEW.DMDT_CNTR_CGO_TP_TXT
	, 	NEW.CVRG_CMB_SEQ
	, 	NEW.VIEW_CVRG_CMB_SEQ
	, 	NEW.CVRG_CONTI_CD
	,	NEW.CVRG_CNT_CD
	, 	NEW.CVRG_RGN_CD
	, 	NEW.CVRG_STE_CD
	, 	NEW.CVRG_LOC_CD
	,	NEW.FT_USE_FLG
	,	NEW.ADD_DYS
	,	NEW.TTL_DYS
	,   NEW.XCLD_SAT_FLG
	,   NEW.XCLD_SUN_FLG
	,   NEW.XCLD_HOL_FLG
	,	NEW.ORG_DEST_MULTI
	,	NEW.CURR_ORG_DEST_MULTI
	,	NEW.ORG_DEST_CONTI_CD
	,	NEW.ORG_DEST_CNT_CD
	,	NEW.ORG_DEST_RGN_CD
	,	NEW.ORG_DEST_STE_CD
	,	NEW.ORG_DEST_LOC_CD
	,	NEW.RT_USE_FLG
	,	NEW.FNL_DEST_FLG
	,	NEW.FNL_DEST_CONTI_CD
	,	NEW.FNL_DEST_CNT_CD
	,	NEW.FNL_DEST_RGN_CD
	,	NEW.FNL_DEST_STE_CD
	,	NEW.FNL_DEST_LOC_CD
	,	NEW.CUST_CD
	,	NEW.CUST_NM
	,	NEW.REP_CMDT_CD
	,	NEW.EXPT_TRF_RMK
	,	NEW.FULL_EXPT_TRF_RMK
	,	NEW.RFA_EXPT_DAR_NO
	,	NEW.RFA_EXPT_MAPG_SEQ
	,	NEW.RFA_EXPT_VER_SEQ
	,	NEW.RFA_RQST_DTL_SEQ
	,	NEW.CURR_CD
	,	NEW.RT_CHK_FLG
	,	NEW.RT_CHK
	,	NEW.DMDT_EXPT_RQST_STS_CD
	,	NEW.RQST_OFC_CD
	,  DECODE(OLD.RFA_RQST_DTL_SEQ, null, 'Y','N') AS NEW_FLG
FROM 
(	 SELECT DECODE(A.DMDT_EXPT_RQST_STS_CD, 'A', LPAD(A.RFA_EXPT_VER_SEQ, 3, '0'), '') VIEW_VER_SEQ
      	,	B.DMDT_TRF_CD
      	,	TO_CHAR(B.EFF_DT, 'YYYY-MM-DD') EFF_DT
      	,	TO_CHAR(B.EXP_DT, 'YYYY-MM-DD') EXP_DT
      	,	B.DMDT_CNTR_TP_CD || ':' || B.DMDT_CGO_TP_CD DMDT_CNTR_CGO_TP_CD
      	,	E.INTG_CD_VAL_DP_DESC || ' - ' || F.INTG_CD_VAL_DP_DESC DMDT_CNTR_CGO_TP_TXT
      	, 	C.CVRG_CMB_SEQ
      	, 	C.CVRG_CMB_SEQ VIEW_CVRG_CMB_SEQ
      	, 	C.CVRG_CONTI_CD
      	,	C.CVRG_CNT_CD
      	, 	C.CVRG_RGN_CD
      	, 	C.CVRG_STE_CD
      	, 	C.CVRG_LOC_CD
      	,	DECODE(B.FT_USE_FLG,'Y','1','0') FT_USE_FLG
      	,	B.ADD_DYS
      	,	B.TTL_DYS
      	,   DECODE(B.XCLD_SAT_FLG,'Y','1','0') XCLD_SAT_FLG
      	,   DECODE(B.XCLD_SUN_FLG,'Y','1','0') XCLD_SUN_FLG
      	,   DECODE(B.XCLD_HOL_FLG,'Y','1','0') XCLD_HOL_FLG
      	,	C.ORG_DEST_MULTI
      	,	C.ORG_DEST_MULTI CURR_ORG_DEST_MULTI
      	,	C.ORG_DEST_CONTI_CD
      	,	C.ORG_DEST_CNT_CD
      	,	C.ORG_DEST_RGN_CD
      	,	C.ORG_DEST_STE_CD
      	,	C.ORG_DEST_LOC_CD
      	,	B.RT_USE_FLG
      	,	B.FNL_DEST_FLG
      	,	B.FNL_DEST_CONTI_CD
      	,	B.FNL_DEST_CNT_CD
      	,	B.FNL_DEST_RGN_CD
      	,	B.FNL_DEST_STE_CD
      	,	B.FNL_DEST_LOC_CD
      	,	B.ACT_CUST_CNT_CD || LPAD(B.ACT_CUST_SEQ, 6, '0') CUST_CD
      	,	D.CUST_LGL_ENG_NM CUST_NM
      	,	B.REP_CMDT_CD
      	,	SUBSTR(B.EXPT_TRF_RMK, 0, 20) EXPT_TRF_RMK
      	,	B.EXPT_TRF_RMK FULL_EXPT_TRF_RMK
      	,	B.RFA_EXPT_DAR_NO
      	,	B.RFA_EXPT_MAPG_SEQ
      	,	B.RFA_EXPT_VER_SEQ
      	,	B.RFA_RQST_DTL_SEQ
      	,	B.CURR_CD
      	,	B.RT_CHK_FLG
      	,	B.RT_CHK
      	,	A.DMDT_EXPT_RQST_STS_CD
      	,	A.RQST_OFC_CD
      
      FROM	DMT_RFA_EXPT_TRF A
      	,	( 	SELECT  *
      			FROM    ( 	SELECT  ROW_NUMBER() OVER 
      								(	PARTITION BY 
      											RFA_EXPT_DAR_NO
      										, 	RFA_EXPT_MAPG_SEQ
      										, 	RFA_EXPT_VER_SEQ
      										, 	RFA_RQST_DTL_SEQ
      										,	FNL_DEST_CONTI_CD
      										,	FNL_DEST_CNT_CD
      										,	FNL_DEST_RGN_CD
      										,	FNL_DEST_STE_CD
      										,	FNL_DEST_LOC_CD
      										ORDER BY 
      											RFA_EXPT_DAR_NO
      										, 	RFA_EXPT_MAPG_SEQ
      										, 	RFA_EXPT_VER_SEQ
      										, 	RFA_RQST_DTL_SEQ
      										, 	CVRG_CMB_SEQ
      									) AS IDX
      							,	RFA_EXPT_DAR_NO
      							,	RFA_EXPT_MAPG_SEQ
      							,	RFA_EXPT_VER_SEQ
      							,	RFA_RQST_DTL_SEQ
      							,	CVRG_CMB_SEQ
      							,	DMDT_TRF_CD
      							,	N1ST_CMNC_VER_SEQ
      							,	EFF_DT
      							,	EXP_DT
      							,	DMDT_CNTR_TP_CD
      							,	DMDT_CGO_TP_CD
      							,	REP_CMDT_CD
      							,	FT_USE_FLG
      							,	ADD_DYS
      							,	TTL_DYS
      							,	XCLD_SAT_FLG
      							,	XCLD_SUN_FLG
      							,	XCLD_HOL_FLG
      							,	RT_USE_FLG
      							,	CURR_CD
      							,	EXPT_TRF_RMK
      							,	ACT_CUST_CNT_CD
      							,	ACT_CUST_SEQ
      							,	FNL_DEST_FLG
      							,	FNL_DEST_CONTI_CD
      							,	FNL_DEST_CNT_CD
      							,	FNL_DEST_RGN_CD
      							,	FNL_DEST_STE_CD
      							,	FNL_DEST_LOC_CD
      							,	CRE_USR_ID
      							,	CRE_DT
      							,	CRE_OFC_CD
      							,	UPD_USR_ID
      							,	UPD_DT
      							,	UPD_OFC_CD
      							,	RT_CHK_FLG
      							,	CASE
      									WHEN RT_CHK_FLG = 'Y' THEN 'Y'
      									WHEN CURR_CD IS NOT NULL OR CURR_CD <> '' THEN 'Y'
      									WHEN (
      											SELECT	COUNT(*)
      											FROM	DMT_RFA_EXPT_RT
      											WHERE	RFA_EXPT_DAR_NO 	= A.RFA_EXPT_DAR_NO
      												AND	RFA_EXPT_MAPG_SEQ	= A.RFA_EXPT_MAPG_SEQ
      												AND RFA_EXPT_VER_SEQ	= A.RFA_EXPT_VER_SEQ
      												AND RFA_RQST_DTL_SEQ	= A.RFA_RQST_DTL_SEQ
      										) > 0 THEN 'Y' ELSE 'N'
      								END AS RT_CHK
      
      						FROM    DMT_RFA_EXPT_TRF_DTL A
                              WHERE   RFA_EXPT_DAR_NO 	= @[rfa_expt_dar_no]
      							AND	RFA_EXPT_MAPG_SEQ 	= @[rfa_expt_mapg_seq]
      							AND RFA_EXPT_VER_SEQ 	= @[rfa_expt_ver_seq]
      
      							#if(${rfa_rqst_dtl_seq} != '')
      							AND RFA_RQST_DTL_SEQ 	= @[rfa_rqst_dtl_seq]
      							#end
      					)
      			WHERE IDX = 1
      		) B
      	,	(
      			SELECT	
      					RFA_EXPT_DAR_NO
      				, 	RFA_EXPT_MAPG_SEQ
      				, 	RFA_EXPT_VER_SEQ
      				, 	RFA_RQST_DTL_SEQ
      				, 	CVRG_CMB_SEQ
      				, 	CVRG_CONTI_CD
      				, 	CVRG_CNT_CD
      				, 	CVRG_RGN_CD
      				, 	CVRG_STE_CD
      				, 	CVRG_LOC_CD
      				, 	CASE WHEN ORG_DEST_MULTI < 2 THEN 'S' ELSE 'M' END ORG_DEST_MULTI
              		, 	CASE WHEN ORG_DEST_MULTI < 2 THEN ORG_DEST_CONTI_CD ELSE '' END ORG_DEST_CONTI_CD
              		, 	CASE WHEN ORG_DEST_MULTI < 2 THEN ORG_DEST_CNT_CD ELSE '' END ORG_DEST_CNT_CD
              		, 	CASE WHEN ORG_DEST_MULTI < 2 THEN ORG_DEST_RGN_CD ELSE '' END ORG_DEST_RGN_CD
              		, 	CASE WHEN ORG_DEST_MULTI < 2 THEN ORG_DEST_STE_CD ELSE '' END ORG_DEST_STE_CD
              		, 	CASE WHEN ORG_DEST_MULTI < 2 THEN ORG_DEST_LOC_CD ELSE '' END ORG_DEST_LOC_CD
      
      				FROM	(
      							SELECT	COUNT(CVRG_CMB_SEQ) OVER 
      											(	PARTITION BY 
      													RFA_EXPT_DAR_NO
      												,	RFA_EXPT_MAPG_SEQ
      												,	RFA_EXPT_VER_SEQ
      												,	RFA_RQST_DTL_SEQ
      											) ORG_DEST_MULTI
      
      									, ROW_NUMBER () OVER 
      											(	PARTITION BY 
      													RFA_EXPT_DAR_NO
      												,	RFA_EXPT_MAPG_SEQ
      												,	RFA_EXPT_VER_SEQ
      												,	RFA_RQST_DTL_SEQ 
      												ORDER BY 
      													RFA_RQST_DTL_SEQ
      												,	CVRG_CMB_SEQ
      											) SEQ
                  								, RFA_EXPT_DAR_NO
      									, RFA_EXPT_MAPG_SEQ
      									, RFA_EXPT_VER_SEQ
      									, RFA_RQST_DTL_SEQ
      									, CVRG_CMB_SEQ
      									, CVRG_CONTI_CD
      									, CVRG_CNT_CD
      									, CVRG_RGN_CD
      									, CVRG_STE_CD
      									, CVRG_LOC_CD
      									, ORG_DEST_CONTI_CD
      									, ORG_DEST_CNT_CD
      									, ORG_DEST_RGN_CD
      									, ORG_DEST_STE_CD
      									, ORG_DEST_LOC_CD
              
          							FROM	DMT_RFA_EXPT_CVRG_CMB
          							WHERE	RFA_EXPT_DAR_NO 	= @[rfa_expt_dar_no] 
      									AND RFA_EXPT_MAPG_SEQ 	= @[rfa_expt_mapg_seq]
      									AND RFA_EXPT_VER_SEQ 	= @[rfa_expt_ver_seq]
      
      									#if(${rfa_rqst_dtl_seq} != '')
      									AND RFA_RQST_DTL_SEQ 	= @[rfa_rqst_dtl_seq]
      									#end
          					)
      				WHERE SEQ < 2
      		) C
      	,	MDM_CUSTOMER D
      	,	COM_INTG_CD_DTL E
      	,	COM_INTG_CD_DTL F
      
      WHERE	A.RFA_EXPT_DAR_NO 	= @[rfa_expt_dar_no]
      	AND	A.RFA_EXPT_MAPG_SEQ = @[rfa_expt_mapg_seq]
      	AND	A.RFA_EXPT_VER_SEQ 	= @[rfa_expt_ver_seq]
      
      	#if(${is_temp} == 'N')
      	AND A.DMDT_EXPT_RQST_STS_CD <> 'T'
      	#end
      
      	AND A.RFA_EXPT_DAR_NO 	= B.RFA_EXPT_DAR_NO
      	AND A.RFA_EXPT_MAPG_SEQ = B.RFA_EXPT_MAPG_SEQ
      	AND A.RFA_EXPT_VER_SEQ 	= B.RFA_EXPT_VER_SEQ
      	AND B.RFA_EXPT_DAR_NO 	= C.RFA_EXPT_DAR_NO
      	AND B.RFA_EXPT_MAPG_SEQ = C.RFA_EXPT_MAPG_SEQ
      	AND B.RFA_EXPT_VER_SEQ 	= C.RFA_EXPT_VER_SEQ
      	AND B.RFA_RQST_DTL_SEQ 	= C.RFA_RQST_DTL_SEQ
      	AND B.ACT_CUST_CNT_CD 	= D.CUST_CNT_CD(+)
      	AND B.ACT_CUST_SEQ 		= D.CUST_SEQ(+)
      	AND B.DMDT_CNTR_TP_CD 	= E.INTG_CD_VAL_CTNT
      	AND E.INTG_CD_ID 		= 'CD02053'
      	AND B.DMDT_CGO_TP_CD 	= F.INTG_CD_VAL_CTNT
      	AND F.INTG_CD_ID 		= 'CD01963'
) NEW,
(
      SELECT B.DMDT_TRF_CD
      	,	TO_CHAR(B.EFF_DT, 'YYYY-MM-DD') EFF_DT
      	,	TO_CHAR(B.EXP_DT, 'YYYY-MM-DD') EXP_DT
      	,	B.DMDT_CNTR_TP_CD || ':' || B.DMDT_CGO_TP_CD DMDT_CNTR_CGO_TP_CD
      	,	E.INTG_CD_VAL_DP_DESC || ' - ' || F.INTG_CD_VAL_DP_DESC DMDT_CNTR_CGO_TP_TXT
      	, 	C.CVRG_CMB_SEQ
      	, 	C.CVRG_CMB_SEQ VIEW_CVRG_CMB_SEQ
      	, 	C.CVRG_CONTI_CD
      	,	C.CVRG_CNT_CD
      	, 	C.CVRG_RGN_CD
      	, 	C.CVRG_STE_CD
      	, 	C.CVRG_LOC_CD
      	,	DECODE(B.FT_USE_FLG,'Y','1','0') FT_USE_FLG
      	,	B.ADD_DYS
      	,	B.TTL_DYS
      	,   DECODE(B.XCLD_SAT_FLG,'Y','1','0') XCLD_SAT_FLG
      	,   DECODE(B.XCLD_SUN_FLG,'Y','1','0') XCLD_SUN_FLG
      	,   DECODE(B.XCLD_HOL_FLG,'Y','1','0') XCLD_HOL_FLG
      	,	C.ORG_DEST_MULTI
      	,	C.ORG_DEST_MULTI CURR_ORG_DEST_MULTI
      	,	C.ORG_DEST_CONTI_CD
      	,	C.ORG_DEST_CNT_CD
      	,	C.ORG_DEST_RGN_CD
      	,	C.ORG_DEST_STE_CD
      	,	C.ORG_DEST_LOC_CD
      	,	B.RT_USE_FLG
      	,	B.FNL_DEST_FLG
      	,	B.FNL_DEST_CONTI_CD
      	,	B.FNL_DEST_CNT_CD
      	,	B.FNL_DEST_RGN_CD
      	,	B.FNL_DEST_STE_CD
      	,	B.FNL_DEST_LOC_CD
      	,	B.ACT_CUST_CNT_CD || LPAD(B.ACT_CUST_SEQ, 6, '0') CUST_CD
      	,	D.CUST_LGL_ENG_NM CUST_NM
      	,	B.REP_CMDT_CD
      	,	SUBSTR(B.EXPT_TRF_RMK, 0, 20) EXPT_TRF_RMK
      	,	B.EXPT_TRF_RMK FULL_EXPT_TRF_RMK
      	,	B.RFA_EXPT_DAR_NO
      	,	B.RFA_EXPT_MAPG_SEQ
      	,	B.RFA_RQST_DTL_SEQ
      	,	B.CURR_CD
      	,	B.RT_CHK_FLG
      	,	B.RT_CHK
      	,	A.RQST_OFC_CD
      
      FROM	DMT_RFA_EXPT_TRF A
      	,	( 	SELECT  *
      			FROM    ( 	SELECT  ROW_NUMBER() OVER 
      								(	PARTITION BY 
      											RFA_EXPT_DAR_NO
      										, 	RFA_EXPT_MAPG_SEQ
      										, 	RFA_EXPT_VER_SEQ
      										, 	RFA_RQST_DTL_SEQ
      										,	FNL_DEST_CONTI_CD
      										,	FNL_DEST_CNT_CD
      										,	FNL_DEST_RGN_CD
      										,	FNL_DEST_STE_CD
      										,	FNL_DEST_LOC_CD
      										ORDER BY 
      											RFA_EXPT_DAR_NO
      										, 	RFA_EXPT_MAPG_SEQ
      										, 	RFA_EXPT_VER_SEQ
      										, 	RFA_RQST_DTL_SEQ
      										, 	CVRG_CMB_SEQ
      									) AS IDX
      							,	RFA_EXPT_DAR_NO
      							,	RFA_EXPT_MAPG_SEQ
      							,	RFA_EXPT_VER_SEQ
      							,	RFA_RQST_DTL_SEQ
      							,	CVRG_CMB_SEQ
      							,	DMDT_TRF_CD
      							,	N1ST_CMNC_VER_SEQ
      							,	EFF_DT
      							,	EXP_DT
      							,	DMDT_CNTR_TP_CD
      							,	DMDT_CGO_TP_CD
      							,	REP_CMDT_CD
      							,	FT_USE_FLG
      							,	ADD_DYS
      							,	TTL_DYS
      							,	XCLD_SAT_FLG
      							,	XCLD_SUN_FLG
      							,	XCLD_HOL_FLG
      							,	RT_USE_FLG
      							,	CURR_CD
      							,	EXPT_TRF_RMK
      							,	ACT_CUST_CNT_CD
      							,	ACT_CUST_SEQ
      							,	FNL_DEST_FLG
      							,	FNL_DEST_CONTI_CD
      							,	FNL_DEST_CNT_CD
      							,	FNL_DEST_RGN_CD
      							,	FNL_DEST_STE_CD
      							,	FNL_DEST_LOC_CD
      							,	CRE_USR_ID
      							,	CRE_DT
      							,	CRE_OFC_CD
      							,	UPD_USR_ID
      							,	UPD_DT
      							,	UPD_OFC_CD
      							,	RT_CHK_FLG
      							,	CASE
      									WHEN RT_CHK_FLG = 'Y' THEN 'Y'
      									WHEN CURR_CD IS NOT NULL OR CURR_CD <> '' THEN 'Y'
      									WHEN (
      											SELECT	COUNT(*)
      											FROM	DMT_RFA_EXPT_RT
      											WHERE	RFA_EXPT_DAR_NO 	= A.RFA_EXPT_DAR_NO
      												AND	RFA_EXPT_MAPG_SEQ	= A.RFA_EXPT_MAPG_SEQ
      												AND RFA_EXPT_VER_SEQ	= A.RFA_EXPT_VER_SEQ
      												AND RFA_RQST_DTL_SEQ	= A.RFA_RQST_DTL_SEQ
      										) > 0 THEN 'Y' ELSE 'N'
      								END AS RT_CHK
      
      						FROM    DMT_RFA_EXPT_TRF_DTL A
                              WHERE   RFA_EXPT_DAR_NO 	= @[rfa_expt_dar_no]
      							AND	RFA_EXPT_MAPG_SEQ 	= @[rfa_expt_mapg_seq]
      							AND RFA_EXPT_VER_SEQ 	= @[rfa_expt_ver_seq]
      
      							#if(${rfa_rqst_dtl_seq} != '')
      							AND RFA_RQST_DTL_SEQ 	= @[rfa_rqst_dtl_seq]
      							#end
      					)
      			WHERE IDX = 1
      		) B
      	,	(
      			SELECT	
      					RFA_EXPT_DAR_NO
      				, 	RFA_EXPT_MAPG_SEQ
      				, 	RFA_EXPT_VER_SEQ
      				, 	RFA_RQST_DTL_SEQ
      				, 	CVRG_CMB_SEQ
      				, 	CVRG_CONTI_CD
      				, 	CVRG_CNT_CD
      				, 	CVRG_RGN_CD
      				, 	CVRG_STE_CD
      				, 	CVRG_LOC_CD
      				, 	CASE WHEN ORG_DEST_MULTI < 2 THEN 'S' ELSE 'M' END ORG_DEST_MULTI
              		, 	CASE WHEN ORG_DEST_MULTI < 2 THEN ORG_DEST_CONTI_CD ELSE '' END ORG_DEST_CONTI_CD
              		, 	CASE WHEN ORG_DEST_MULTI < 2 THEN ORG_DEST_CNT_CD ELSE '' END ORG_DEST_CNT_CD
              		, 	CASE WHEN ORG_DEST_MULTI < 2 THEN ORG_DEST_RGN_CD ELSE '' END ORG_DEST_RGN_CD
              		, 	CASE WHEN ORG_DEST_MULTI < 2 THEN ORG_DEST_STE_CD ELSE '' END ORG_DEST_STE_CD
              		, 	CASE WHEN ORG_DEST_MULTI < 2 THEN ORG_DEST_LOC_CD ELSE '' END ORG_DEST_LOC_CD
      
      				FROM	(
      							SELECT	COUNT(CVRG_CMB_SEQ) OVER 
      											(	PARTITION BY 
      													RFA_EXPT_DAR_NO
      												,	RFA_EXPT_MAPG_SEQ
      												,	RFA_EXPT_VER_SEQ
      												,	RFA_RQST_DTL_SEQ
      											) ORG_DEST_MULTI
      
      									, ROW_NUMBER () OVER 
      											(	PARTITION BY 
      													RFA_EXPT_DAR_NO
      												,	RFA_EXPT_MAPG_SEQ
      												,	RFA_EXPT_VER_SEQ
      												,	RFA_RQST_DTL_SEQ 
      												ORDER BY 
      													RFA_RQST_DTL_SEQ
      												,	CVRG_CMB_SEQ
      											) SEQ
                  								, RFA_EXPT_DAR_NO
      									, RFA_EXPT_MAPG_SEQ
      									, RFA_EXPT_VER_SEQ
      									, RFA_RQST_DTL_SEQ
      									, CVRG_CMB_SEQ
      									, CVRG_CONTI_CD
      									, CVRG_CNT_CD
      									, CVRG_RGN_CD
      									, CVRG_STE_CD
      									, CVRG_LOC_CD
      									, ORG_DEST_CONTI_CD
      									, ORG_DEST_CNT_CD
      									, ORG_DEST_RGN_CD
      									, ORG_DEST_STE_CD
      									, ORG_DEST_LOC_CD
              
          							FROM	DMT_RFA_EXPT_CVRG_CMB
          							WHERE	RFA_EXPT_DAR_NO 	= @[rfa_expt_dar_no] 
      									AND RFA_EXPT_MAPG_SEQ 	= @[rfa_expt_mapg_seq]
      									AND RFA_EXPT_VER_SEQ 	= @[rfa_expt_ver_seq]
      
      									#if(${rfa_rqst_dtl_seq} != '')
      									AND RFA_RQST_DTL_SEQ 	= @[rfa_rqst_dtl_seq]
      									#end
          					)
      				WHERE SEQ < 2
      		) C
      	,	MDM_CUSTOMER D
      	,	COM_INTG_CD_DTL E
      	,	COM_INTG_CD_DTL F
      
      WHERE	A.RFA_EXPT_DAR_NO 	= @[rfa_expt_dar_no]
      	AND	A.RFA_EXPT_MAPG_SEQ = @[rfa_expt_mapg_seq]
      	AND	A.RFA_EXPT_VER_SEQ 	= @[rfa_expt_ver_seq]
      
      	#if(${is_temp} == 'N')
      	AND A.DMDT_EXPT_RQST_STS_CD <> 'T'
      	#end
      
      	AND A.RFA_EXPT_DAR_NO 	= B.RFA_EXPT_DAR_NO
      	AND A.RFA_EXPT_MAPG_SEQ = B.RFA_EXPT_MAPG_SEQ
      	AND A.RFA_EXPT_VER_SEQ 	= B.RFA_EXPT_VER_SEQ
      	AND B.RFA_EXPT_DAR_NO 	= C.RFA_EXPT_DAR_NO
      	AND B.RFA_EXPT_MAPG_SEQ = C.RFA_EXPT_MAPG_SEQ
      	AND B.RFA_EXPT_VER_SEQ 	= C.RFA_EXPT_VER_SEQ
      	AND B.RFA_RQST_DTL_SEQ 	= C.RFA_RQST_DTL_SEQ
      	AND B.ACT_CUST_CNT_CD 	= D.CUST_CNT_CD(+)
      	AND B.ACT_CUST_SEQ 		= D.CUST_SEQ(+)
      	AND B.DMDT_CNTR_TP_CD 	= E.INTG_CD_VAL_CTNT
      	AND E.INTG_CD_ID 		= 'CD02053'
      	AND B.DMDT_CGO_TP_CD 	= F.INTG_CD_VAL_CTNT
      	AND F.INTG_CD_ID 		= 'CD01963'
      	
  INTERSECT
  
  SELECT 	B.DMDT_TRF_CD
      	,	TO_CHAR(B.EFF_DT, 'YYYY-MM-DD') EFF_DT
      	,	TO_CHAR(B.EXP_DT, 'YYYY-MM-DD') EXP_DT
      	,	B.DMDT_CNTR_TP_CD || ':' || B.DMDT_CGO_TP_CD DMDT_CNTR_CGO_TP_CD
      	,	E.INTG_CD_VAL_DP_DESC || ' - ' || F.INTG_CD_VAL_DP_DESC DMDT_CNTR_CGO_TP_TXT
      	, 	C.CVRG_CMB_SEQ
      	, 	C.CVRG_CMB_SEQ VIEW_CVRG_CMB_SEQ
      	, 	C.CVRG_CONTI_CD
      	,	C.CVRG_CNT_CD
      	, 	C.CVRG_RGN_CD
      	, 	C.CVRG_STE_CD
      	, 	C.CVRG_LOC_CD
      	,	DECODE(B.FT_USE_FLG,'Y','1','0') FT_USE_FLG
      	,	B.ADD_DYS
      	,	B.TTL_DYS
      	,   DECODE(B.XCLD_SAT_FLG,'Y','1','0') XCLD_SAT_FLG
      	,   DECODE(B.XCLD_SUN_FLG,'Y','1','0') XCLD_SUN_FLG
      	,   DECODE(B.XCLD_HOL_FLG,'Y','1','0') XCLD_HOL_FLG
      	,	C.ORG_DEST_MULTI
      	,	C.ORG_DEST_MULTI CURR_ORG_DEST_MULTI
      	,	C.ORG_DEST_CONTI_CD
      	,	C.ORG_DEST_CNT_CD
      	,	C.ORG_DEST_RGN_CD
      	,	C.ORG_DEST_STE_CD
      	,	C.ORG_DEST_LOC_CD
      	,	B.RT_USE_FLG
      	,	B.FNL_DEST_FLG
      	,	B.FNL_DEST_CONTI_CD
      	,	B.FNL_DEST_CNT_CD
      	,	B.FNL_DEST_RGN_CD
      	,	B.FNL_DEST_STE_CD
      	,	B.FNL_DEST_LOC_CD
      	,	B.ACT_CUST_CNT_CD || LPAD(B.ACT_CUST_SEQ, 6, '0') CUST_CD
      	,	D.CUST_LGL_ENG_NM CUST_NM
      	,	B.REP_CMDT_CD
      	,	SUBSTR(B.EXPT_TRF_RMK, 0, 20) EXPT_TRF_RMK
      	,	B.EXPT_TRF_RMK FULL_EXPT_TRF_RMK
      	,	B.RFA_EXPT_DAR_NO
      	,	B.RFA_EXPT_MAPG_SEQ
      	,	B.RFA_RQST_DTL_SEQ
      	,	B.CURR_CD
      	,	B.RT_CHK_FLG
      	,	B.RT_CHK
      	,	A.RQST_OFC_CD
      
      FROM	DMT_RFA_EXPT_TRF A
      	,	( 	SELECT  *
      			FROM    ( 	SELECT  ROW_NUMBER() OVER 
      								(	PARTITION BY 
      											RFA_EXPT_DAR_NO
      										, 	RFA_EXPT_MAPG_SEQ
      										, 	RFA_EXPT_VER_SEQ
      										, 	RFA_RQST_DTL_SEQ
      										,	FNL_DEST_CONTI_CD
      										,	FNL_DEST_CNT_CD
      										,	FNL_DEST_RGN_CD
      										,	FNL_DEST_STE_CD
      										,	FNL_DEST_LOC_CD
      										ORDER BY 
      											RFA_EXPT_DAR_NO
      										, 	RFA_EXPT_MAPG_SEQ
      										, 	RFA_EXPT_VER_SEQ
      										, 	RFA_RQST_DTL_SEQ
      										, 	CVRG_CMB_SEQ
      									) AS IDX
      							,	RFA_EXPT_DAR_NO
      							,	RFA_EXPT_MAPG_SEQ
      							,	RFA_EXPT_VER_SEQ
      							,	RFA_RQST_DTL_SEQ
      							,	CVRG_CMB_SEQ
      							,	DMDT_TRF_CD
      							,	N1ST_CMNC_VER_SEQ
      							,	EFF_DT
      							,	EXP_DT
      							,	DMDT_CNTR_TP_CD
      							,	DMDT_CGO_TP_CD
      							,	REP_CMDT_CD
      							,	FT_USE_FLG
      							,	ADD_DYS
      							,	TTL_DYS
      							,	XCLD_SAT_FLG
      							,	XCLD_SUN_FLG
      							,	XCLD_HOL_FLG
      							,	RT_USE_FLG
      							,	CURR_CD
      							,	EXPT_TRF_RMK
      							,	ACT_CUST_CNT_CD
      							,	ACT_CUST_SEQ
      							,	FNL_DEST_FLG
      							,	FNL_DEST_CONTI_CD
      							,	FNL_DEST_CNT_CD
      							,	FNL_DEST_RGN_CD
      							,	FNL_DEST_STE_CD
      							,	FNL_DEST_LOC_CD
      							,	CRE_USR_ID
      							,	CRE_DT
      							,	CRE_OFC_CD
      							,	UPD_USR_ID
      							,	UPD_DT
      							,	UPD_OFC_CD
      							,	RT_CHK_FLG
      							,	CASE
      									WHEN RT_CHK_FLG = 'Y' THEN 'Y'
      									WHEN CURR_CD IS NOT NULL OR CURR_CD <> '' THEN 'Y'
      									WHEN (
      											SELECT	COUNT(*)
      											FROM	DMT_RFA_EXPT_RT
      											WHERE	RFA_EXPT_DAR_NO 	= A.RFA_EXPT_DAR_NO
      												AND	RFA_EXPT_MAPG_SEQ	= A.RFA_EXPT_MAPG_SEQ
      												AND RFA_EXPT_VER_SEQ	= A.RFA_EXPT_VER_SEQ
      												AND RFA_RQST_DTL_SEQ	= A.RFA_RQST_DTL_SEQ
      										) > 0 THEN 'Y' ELSE 'N'
      								END AS RT_CHK
      
      						FROM    DMT_RFA_EXPT_TRF_DTL A
                              WHERE   RFA_EXPT_DAR_NO 	= @[rfa_expt_dar_no]
      							AND	RFA_EXPT_MAPG_SEQ 	= @[rfa_expt_mapg_seq]
      							AND RFA_EXPT_VER_SEQ 	= @[rfa_expt_ver_seq] - 1
      
      							#if(${rfa_rqst_dtl_seq} != '')
      							AND RFA_RQST_DTL_SEQ 	= @[rfa_rqst_dtl_seq]
      							#end
      					)
      			WHERE IDX = 1
      		) B
      	,	(
      			SELECT	
      					RFA_EXPT_DAR_NO
      				, 	RFA_EXPT_MAPG_SEQ
      				, 	RFA_EXPT_VER_SEQ
      				, 	RFA_RQST_DTL_SEQ
      				, 	CVRG_CMB_SEQ
      				, 	CVRG_CONTI_CD
      				, 	CVRG_CNT_CD
      				, 	CVRG_RGN_CD
      				, 	CVRG_STE_CD
      				, 	CVRG_LOC_CD
      				, 	CASE WHEN ORG_DEST_MULTI < 2 THEN 'S' ELSE 'M' END ORG_DEST_MULTI
              		, 	CASE WHEN ORG_DEST_MULTI < 2 THEN ORG_DEST_CONTI_CD ELSE '' END ORG_DEST_CONTI_CD
              		, 	CASE WHEN ORG_DEST_MULTI < 2 THEN ORG_DEST_CNT_CD ELSE '' END ORG_DEST_CNT_CD
              		, 	CASE WHEN ORG_DEST_MULTI < 2 THEN ORG_DEST_RGN_CD ELSE '' END ORG_DEST_RGN_CD
              		, 	CASE WHEN ORG_DEST_MULTI < 2 THEN ORG_DEST_STE_CD ELSE '' END ORG_DEST_STE_CD
              		, 	CASE WHEN ORG_DEST_MULTI < 2 THEN ORG_DEST_LOC_CD ELSE '' END ORG_DEST_LOC_CD
      
      				FROM	(
      							SELECT	COUNT(CVRG_CMB_SEQ) OVER 
      											(	PARTITION BY 
      													RFA_EXPT_DAR_NO
      												,	RFA_EXPT_MAPG_SEQ
      												,	RFA_EXPT_VER_SEQ
      												,	RFA_RQST_DTL_SEQ
      											) ORG_DEST_MULTI
      
      									, ROW_NUMBER () OVER 
      											(	PARTITION BY 
      													RFA_EXPT_DAR_NO
      												,	RFA_EXPT_MAPG_SEQ
      												,	RFA_EXPT_VER_SEQ
      												,	RFA_RQST_DTL_SEQ 
      												ORDER BY 
      													RFA_RQST_DTL_SEQ
      												,	CVRG_CMB_SEQ
      											) SEQ
                  								, RFA_EXPT_DAR_NO
      									, RFA_EXPT_MAPG_SEQ
      									, RFA_EXPT_VER_SEQ
      									, RFA_RQST_DTL_SEQ
      									, CVRG_CMB_SEQ
      									, CVRG_CONTI_CD
      									, CVRG_CNT_CD
      									, CVRG_RGN_CD
      									, CVRG_STE_CD
      									, CVRG_LOC_CD
      									, ORG_DEST_CONTI_CD
      									, ORG_DEST_CNT_CD
      									, ORG_DEST_RGN_CD
      									, ORG_DEST_STE_CD
      									, ORG_DEST_LOC_CD
              
          							FROM	DMT_RFA_EXPT_CVRG_CMB
          							WHERE	RFA_EXPT_DAR_NO 	= @[rfa_expt_dar_no] 
      									AND RFA_EXPT_MAPG_SEQ 	= @[rfa_expt_mapg_seq]
      									AND RFA_EXPT_VER_SEQ 	= @[rfa_expt_ver_seq] - 1
      
      									#if(${rfa_rqst_dtl_seq} != '')
      									AND RFA_RQST_DTL_SEQ 	= @[rfa_rqst_dtl_seq]
      									#end
          					)
      				WHERE SEQ < 2
      		) C
      	,	MDM_CUSTOMER D
      	,	COM_INTG_CD_DTL E
      	,	COM_INTG_CD_DTL F
      
      WHERE	A.RFA_EXPT_DAR_NO 	= @[rfa_expt_dar_no]
      	AND	A.RFA_EXPT_MAPG_SEQ = @[rfa_expt_mapg_seq]
      	AND	A.RFA_EXPT_VER_SEQ 	= @[rfa_expt_ver_seq] - 1
      
      	#if(${is_temp} == 'N')
      	AND A.DMDT_EXPT_RQST_STS_CD <> 'T'
      	#end
      
      	AND A.RFA_EXPT_DAR_NO 	= B.RFA_EXPT_DAR_NO
      	AND A.RFA_EXPT_MAPG_SEQ = B.RFA_EXPT_MAPG_SEQ
      	AND A.RFA_EXPT_VER_SEQ 	= B.RFA_EXPT_VER_SEQ
      	AND B.RFA_EXPT_DAR_NO 	= C.RFA_EXPT_DAR_NO
      	AND B.RFA_EXPT_MAPG_SEQ = C.RFA_EXPT_MAPG_SEQ
      	AND B.RFA_EXPT_VER_SEQ 	= C.RFA_EXPT_VER_SEQ
      	AND B.RFA_RQST_DTL_SEQ 	= C.RFA_RQST_DTL_SEQ
      	AND B.ACT_CUST_CNT_CD 	= D.CUST_CNT_CD(+)
      	AND B.ACT_CUST_SEQ 		= D.CUST_SEQ(+)
      	AND B.DMDT_CNTR_TP_CD 	= E.INTG_CD_VAL_CTNT
      	AND E.INTG_CD_ID 		= 'CD02053'
      	AND B.DMDT_CGO_TP_CD 	= F.INTG_CD_VAL_CTNT
      	AND F.INTG_CD_ID 		= 'CD01963'


) OLD
WHERE NEW.RFA_EXPT_DAR_NO = OLD.RFA_EXPT_DAR_NO(+)
AND   NEW.RFA_EXPT_MAPG_SEQ = OLD.RFA_EXPT_MAPG_SEQ(+)
AND   NEW.RFA_RQST_DTL_SEQ = OLD.RFA_RQST_DTL_SEQ(+)
ORDER BY NEW.RFA_EXPT_DAR_NO, NEW.RFA_EXPT_MAPG_SEQ, NEW.RFA_RQST_DTL_SEQ			]]></sql>
			<params>
				<param name="rfa_expt_dar_no" type="12" value="" out="N"/>
				<param name="rfa_expt_mapg_seq" type="12" value="" out="N"/>
				<param name="rfa_expt_ver_seq" type="12" value="" out="N"/>
				<param name="rfa_rqst_dtl_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
