<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CNTRInventoryReportDBDAOmodifyOptmStkFUSQL">
			<desc><![CDATA[2016-02-02
Equipment Management > CNTR Inventory > Inventory Status > Land Inventory > Land Inventory with Optimum Stock 수정]]></desc>
			<sql><![CDATA[
MERGE INTO CIM_OPTM_STK_SMRY OPS
USING ( SELECT 'F' OPTM_STK_MNG_TP_CD
              ,'A' DMG_FLG
              ,@[tp_cd] CNTR_TPSZ_CD
              ,@[loc_cd] ECC_CD
              ,@[qty1] CNTR_QTY
              ,@[upd_usr_id] UPD_USR_ID
              ,'99991231' TGT_MVMT_DT
              ,'XX' MVMT_STS_CD
              ,'' TGT_BSE_DT
              ,(SELECT MAX(TGT_YRWK) 
                  FROM CIM_OPTM_STK_SMRY
                 WHERE OPTM_STK_MNG_TP_CD = 'F'
                   AND DMG_FLG = 'A') TGT_YRWK
       FROM  DUAL ) TMP
ON (  OPS.OPTM_STK_MNG_TP_CD = TMP.OPTM_STK_MNG_TP_CD
  AND OPS.DMG_FLG = TMP.DMG_FLG
  AND OPS.CNTR_TPSZ_CD = TMP.CNTR_TPSZ_CD
  AND OPS.ECC_CD = TMP.ECC_CD
  AND OPS.TGT_YRWK = TMP.TGT_YRWK
) WHEN MATCHED THEN
  UPDATE
     SET OPS.CNTR_QTY   = TMP.CNTR_QTY
        ,OPS.UPD_USR_ID = TMP.UPD_USR_ID
        ,OPS.UPD_DT	  = SYSDATE
  WHEN NOT MATCHED THEN
  INSERT
  (OPS.OPTM_STK_MNG_TP_CD
  ,OPS.TGT_YRWK
  ,OPS.TGT_MVMT_DT
  ,OPS.ECC_CD
  ,OPS.CNTR_TPSZ_CD
  ,OPS.MVMT_STS_CD
  ,OPS.DMG_FLG
  ,OPS.CNTR_QTY
  ,OPS.TGT_BSE_DT
  ,OPS.CRE_USR_ID
  ,OPS.CRE_DT
  ,OPS.UPD_USR_ID
  ,OPS.UPD_DT
  )
  VALUES
  (TMP.OPTM_STK_MNG_TP_CD
  ,TMP.TGT_YRWK
  ,TMP.TGT_MVMT_DT
  ,TMP.ECC_CD
  ,TMP.CNTR_TPSZ_CD
  ,TMP.MVMT_STS_CD
  ,TMP.DMG_FLG
  ,TMP.CNTR_QTY
  ,TMP.TGT_BSE_DT
  ,TMP.UPD_USR_ID
  ,SYSDATE
  ,TMP.UPD_USR_ID
  ,SYSDATE
  )			]]></sql>
			<params>
				<param name="tp_cd" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="qty1" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
