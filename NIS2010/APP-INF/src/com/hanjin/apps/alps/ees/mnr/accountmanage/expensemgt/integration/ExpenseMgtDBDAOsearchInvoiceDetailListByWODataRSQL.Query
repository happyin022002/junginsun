<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ExpenseMgtDBDAOsearchInvoiceDetailListByWODataRSQL">
			<desc><![CDATA[ExpenseMgtDBDAOsearchInvoiceDetailListByWODataRSQL]]></desc>
			<sql><![CDATA[
SELECT   B.MNR_WO_TP_CD
       , B.EQ_KND_CD
       , B.COST_OFC_CD
       , B.CURR_CD
       , C.MNR_CD_DESC MNR_WO_TP
       , T.ATTR_CTNT2 AS IDA_SAC_CD
       , A.MNR_ORD_OFC_CTY_CD
       , A.MNR_ORD_SEQ
       , (A.MNR_ORD_OFC_CTY_CD || A.MNR_ORD_SEQ) AS WO_NO
       , A.ORD_DTL_SEQ
       , ( SELECT MNR_CD_DESC FROM MNR_GEN_CD WHERE PRNT_CD_ID = B.EQ_KND_CD||'G' AND MNR_CD_ID = B.COST_CD ) AS COST_CD
       , E.MNR_CD_DESC AS COST_DTL_CD
       , A.MNR_RT_TP_CD
       , A.MNR_EXPN_DTL_NM
       , A.EQ_NO
       , A.EQ_TPSZ_CD
       , A.RQST_REF_NO
       , A.SPR_PRT_UT_TP_NM
       , A.SPR_PRT_NO
       , A.SPR_PRT_NM
       , A.YD_CD
       , TO_CHAR(GLOBALDATE_PKG.TIME_CONV_OFC_FNC(MNR_COMMON_PKG.MNR_GET_HOOFC_FNC(), A.CRE_DT, @[user_ofc_cd]), 'yyyy-mm-dd') AS WO_DT
       , TO_CHAR(A.RPR_RSLT_DT, 'yyyy-mm-dd') AS RPR_RSLT_DT
       , A.RPR_QTY
       , A.SPR_PRT_UC_AMT
       , A.BZC_AMT
       , A.COST_AMT
       , A.SLS_TAX_AMT
       , A.N3PTY_FLG
       , A.N3PTY_BIL_TTL_AMT
       , (
           SELECT   IDA_CGST_RTO
           FROM     TABLE( INV_GET_IDA_GST_RTO_FNC( ( INV_GET_GST_DIV_CD_FNC( B.COST_OFC_CD, 'V', NULL, NULL, B.VNDR_SEQ, NULL ) ), T.ATTR_CTNT2 ) ) I
           WHERE    1 = 1
         ) AS IDA_CGST_RTO
       , (
           SELECT   I.IDA_SGST_RTO
           FROM     TABLE( INV_GET_IDA_GST_RTO_FNC( ( INV_GET_GST_DIV_CD_FNC( B.COST_OFC_CD, 'V', NULL, NULL, B.VNDR_SEQ, NULL ) ), T.ATTR_CTNT2 ) ) I
           WHERE    1 = 1
         ) AS IDA_SGST_RTO
       , (
           SELECT   I.IDA_IGST_RTO
           FROM     TABLE( INV_GET_IDA_GST_RTO_FNC( ( INV_GET_GST_DIV_CD_FNC( B.COST_OFC_CD, 'V', NULL, NULL, B.VNDR_SEQ, NULL ) ), T.ATTR_CTNT2 ) ) I
           WHERE    1 = 1
         ) AS IDA_IGST_RTO
       , (
           SELECT   I.IDA_UGST_RTO
           FROM     TABLE( INV_GET_IDA_GST_RTO_FNC( ( INV_GET_GST_DIV_CD_FNC( B.COST_OFC_CD, 'V', NULL, NULL, B.VNDR_SEQ, NULL ) ), T.ATTR_CTNT2 ) ) I
           WHERE    1 = 1
         ) AS IDA_UGST_RTO
#if (${curr_cd}==${target_curr_cd})
       , MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), B.CURR_CD, NVL(@[target_curr_cd],B.CURR_CD), A.COST_AMT) AS INV_AMT
       , (
           SELECT   ROUND( MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), B.CURR_CD, NVL(@[target_curr_cd],B.CURR_CD), A.COST_AMT) * I.IDA_SGST_RTO / 100, 2 )
           FROM     TABLE( INV_GET_IDA_GST_RTO_FNC( ( INV_GET_GST_DIV_CD_FNC( B.COST_OFC_CD, 'V', NULL, NULL, B.VNDR_SEQ, NULL ) ), T.ATTR_CTNT2 ) ) I
           WHERE    1 = 1
         ) AS IDA_CGST_AMT
       , (
           SELECT   ROUND( MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), B.CURR_CD, NVL(@[target_curr_cd],B.CURR_CD), A.COST_AMT) * I.IDA_SGST_RTO / 100, 2 )
           FROM     TABLE( INV_GET_IDA_GST_RTO_FNC( ( INV_GET_GST_DIV_CD_FNC( B.COST_OFC_CD, 'V', NULL, NULL, B.VNDR_SEQ, NULL ) ), T.ATTR_CTNT2 ) ) I
           WHERE    1 = 1
         ) AS IDA_SGST_AMT
       , (
           SELECT   ROUND( MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), B.CURR_CD, NVL(@[target_curr_cd],B.CURR_CD), A.COST_AMT) * I.IDA_IGST_RTO / 100, 2 )
           FROM     TABLE( INV_GET_IDA_GST_RTO_FNC( ( INV_GET_GST_DIV_CD_FNC( B.COST_OFC_CD, 'V', NULL, NULL, B.VNDR_SEQ, NULL ) ), T.ATTR_CTNT2 ) ) I
           WHERE    1 = 1
         ) AS IDA_IGST_AMT
       , (
           SELECT   ROUND( MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), B.CURR_CD, NVL(@[target_curr_cd],B.CURR_CD), A.COST_AMT) * I.IDA_UGST_RTO / 100, 2 )
           FROM     TABLE( INV_GET_IDA_GST_RTO_FNC( ( INV_GET_GST_DIV_CD_FNC( B.COST_OFC_CD, 'V', NULL, NULL, B.VNDR_SEQ, NULL ) ), T.ATTR_CTNT2 ) ) I
           WHERE    1 = 1
         ) AS IDA_UGST_AMT
#else
       , MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), @[curr_cd], NVL(@[target_curr_cd],@[curr_cd]), A.COST_AMT) AS INV_AMT
       , (
           SELECT   ROUND( MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), @[curr_cd], NVL(@[target_curr_cd],@[curr_cd]), A.COST_AMT) * I.IDA_SGST_RTO / 100, 2 )
           FROM     TABLE( INV_GET_IDA_GST_RTO_FNC( ( INV_GET_GST_DIV_CD_FNC( B.COST_OFC_CD, 'V', NULL, NULL, B.VNDR_SEQ, NULL ) ), T.ATTR_CTNT2 ) ) I
           WHERE    1 = 1
         ) AS IDA_CGST_AMT
       , (
           SELECT   ROUND( MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), @[curr_cd], NVL(@[target_curr_cd],@[curr_cd]), A.COST_AMT) * I.IDA_SGST_RTO / 100, 2 )
           FROM     TABLE( INV_GET_IDA_GST_RTO_FNC( ( INV_GET_GST_DIV_CD_FNC( B.COST_OFC_CD, 'V', NULL, NULL, B.VNDR_SEQ, NULL ) ), T.ATTR_CTNT2 ) ) I
           WHERE    1 = 1
         ) AS IDA_SGST_AMT
       , (
           SELECT   ROUND( MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), @[curr_cd], NVL(@[target_curr_cd],@[curr_cd]), A.COST_AMT) * I.IDA_IGST_RTO / 100, 2 )
           FROM     TABLE( INV_GET_IDA_GST_RTO_FNC( ( INV_GET_GST_DIV_CD_FNC( B.COST_OFC_CD, 'V', NULL, NULL, B.VNDR_SEQ, NULL ) ), T.ATTR_CTNT2 ) ) I
           WHERE    1 = 1
         ) AS IDA_IGST_AMT
       , (
           SELECT   ROUND( MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), @[curr_cd], NVL(@[target_curr_cd],@[curr_cd]), A.COST_AMT) * I.IDA_UGST_RTO / 100, 2 )
           FROM     TABLE( INV_GET_IDA_GST_RTO_FNC( ( INV_GET_GST_DIV_CD_FNC( B.COST_OFC_CD, 'V', NULL, NULL, B.VNDR_SEQ, NULL ) ), T.ATTR_CTNT2 ) ) I
           WHERE    1 = 1
         ) AS IDA_UGST_AMT
#end
       , ( SELECT DP_PRCS_KNT FROM MDM_CURRENCY WHERE CURR_CD = NVL(@[target_curr_cd],B.CURR_CD) ) AS DP_PRCS_KNT 
       , A.MNR_VRFY_TP_CD
       , A.ORD_DTL_RMK
       , A.INV_NO
       , A.FILE_SEQ
       , A.RPR_RQST_SEQ
       , A.RPR_RQST_VER_NO
       , A.PAY_INV_SEQ
       , DECODE(A.PAY_INV_SEQ, '', 'SS','AI') AS MNR_VRFY_TP_CD
       , F.RQST_REF_NO
       , L.CNT_CD
       , A.CRE_USR_ID
       , TO_CHAR(GLOBALDATE_PKG.TIME_CONV_OFC_FNC(MNR_COMMON_PKG.MNR_GET_HOOFC_FNC(), A.CRE_DT, @[user_ofc_cd]), 'yyyy-mm-dd') AS CRE_DT
       , A.UPD_USR_ID
       , TO_CHAR(GLOBALDATE_PKG.TIME_CONV_OFC_FNC(MNR_COMMON_PKG.MNR_GET_HOOFC_FNC(), A.UPD_DT, @[user_ofc_cd]), 'yyyy-mm-dd') AS UPD_DT
FROM     MNR_ORD_DTL A
       , MNR_ORD_HDR B
       , MNR_GEN_CD C
       , MNR_GEN_CD E
       , MNR_RPR_RQST_HDR F
       , MDM_ORGANIZATION O
       , MDM_LOCATION L
       , MNR_HRD_CDG_CTNT T
WHERE    1 = 1
AND      A.MNR_ORD_OFC_CTY_CD = B.MNR_ORD_OFC_CTY_CD
AND      A.MNR_ORD_SEQ = B.MNR_ORD_SEQ
AND      A.MNR_ORD_OFC_CTY_CD = F.MNR_ORD_OFC_CTY_CD(+)
AND      A.MNR_ORD_SEQ = F.MNR_ORD_SEQ(+)
AND      C.PRNT_CD_ID(+) = 'CD00020'
AND      B.MNR_WO_TP_CD = C.MNR_CD_ID(+)
AND      E.PRNT_CD_ID(+) = A.COST_CD
AND      A.ACCT_CD <> '511591'
AND      A.COST_DTL_CD = E.MNR_CD_ID(+)
AND      B.COST_OFC_CD = O.OFC_CD
AND      O.LOC_CD = L.LOC_CD
AND      A.COST_CD = T.ATTR_CTNT1(+)
AND      'MNR_INV_IDA' = T.HRD_CDG_ID(+)
AND	     A.MNR_ORD_OFC_CTY_CD IN
         (
	#foreach ($user_mnrOrdOfcCtyCds IN ${mnrOrdOfcCtyCds})
		#if($velocityCount < $mnrOrdOfcCtyCds.size())
			'$user_mnrOrdOfcCtyCds',
		#else
			'$user_mnrOrdOfcCtyCds'
		#end
	#end			  
         )
AND	     A.MNR_ORD_SEQ IN
         (
	#foreach ($user_woNos IN ${woNos})
		#if($velocityCount < $woNos.size())
			$user_woNos,
		#else
			$user_woNos
		#end
	#end			  
         )			]]></sql>
			<params>
				<param name="user_ofc_cd" type="12" value="" out="N"/>
				<param name="target_curr_cd" type="12" value="" out="N"/>
				<param name="curr_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
