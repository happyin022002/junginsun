<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CntrRepoPlanKpiAnalysisDBDAOSearchCntrPlanKPISummaryPrefRSQL">
			<desc><![CDATA[<EES_EQR_0071 컨테이너 이송 계획 KPI 요약 조회>
PORT별 재고대비 운송모드별 실행 KPI 데이터 조회 (Pref)

<Change History>
1	2009.09.21	Lee ByoungHun	최초작성]]></desc>
			<sql><![CDATA[
SELECT  
    RCC_CD ECC_CD
    ,REPO_PLN_ID
    ,'' UTILIZATION
    ,SUM(DECODE ( DIV , 'MTY' , CNTR_QTY )) / @[data0]   MTY
    ,SUM(DECODE ( DIV , 'ONH' , CNTR_QTY ))   ONHIRE
    ,SUM(DECODE ( DIV , 'OFH' , CNTR_QTY ))   OFFHIRE
    ,'' LF
    ,'' MB
    ,'' RCOST
FROM
(
    ----- [MTY] 조회주차의 첫날짜의 EQR_INVT_SNAP 조회 후 주차의 AVG
    SELECT 
        (
            SELECT 
                #if (${radioopr} == '0')
                    #if (${typeBy} == 'R')
                        A.RCC_CD
                    #elseif (${typeBy} == 'C')
                        A.CNT_CD
                    #elseif (${typeBy} == 'L')
                        A.LCC_CD
                    #else
                        A.ECC_CD
                    #end
                #else
                    RCC_CD
                #end
            FROM 
                EQR_ECC_MST A 
            WHERE 
                ECC_CD = T.ECC_CD
        ) RCC_CD
        , '' REPO_PLN_ID
        , SUM(T.CNTR_VOL_QTY) AS CNTR_QTY
        , 'MTY' DIV
    FROM 
        EQR_INVT_SNAP T
        #if (${type} != '' && $arrAtEccCd.size() > 0)
            , (SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
            #if (${type} == 'R')
                AND RCC_CD
            #elseif (${type} == 'L')
                AND LCC_CD
            #else
                AND ECC_CD
            #end
            IN(
                #foreach ($key in ${arrAtEccCd})
                    #if($velocityCount < $arrAtEccCd.size())
                    '$key',
                    #else
                    '$key'
                    #end
                #end
            ))C
        #end
    WHERE 
        T.SNAP_DT IN (
            #foreach ($key in ${arrMtyPerfStr})
                #if($velocityCount < $arrMtyPerfStr.size())
                '$key',
                #else
                '$key'
                #end
            #end
        )
        AND CNTR_TPSZ_CD IN(SELECT INTG_CD_VAL_CTNT FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD00244' )
        #if (${type} != '')
            AND (T.ECC_CD = C.ECC_CD)
        #end
        #if (${radiocomp} != '' && ${radiocomp} != 'B')
            #if (${radiocomp} == 'H')
                AND SUBSTR(CNTR_SYS_AREA_GRP_ID,0,1) <> 'S'
            #else
                AND SUBSTR(CNTR_SYS_AREA_GRP_ID,0,1) = 'S'
            #end
        #end
    GROUP BY 
        T.ECC_CD
        
    UNION ALL
    
    ----- [ONH]
    SELECT 
        (
            SELECT 
                #if (${radioopr} == '0')
                    #if (${typeBy} == 'R')
                        B.RCC_CD
                    #elseif (${typeBy} == 'C')
                        B.CNT_CD
                    #elseif (${typeBy} == 'L')
                        B.LCC_CD
                    #else
                        B.ECC_CD
                    #end
                #end
            FROM 
                MDM_EQ_ORZ_CHT A
                , EQR_ECC_MST B
            WHERE 
                SCC_CD = SUBSTR(T.TO_YD_CD,0,5) 
                AND A.ECC_CD = B.ECC_CD 
        ) RCC_CD
        , '' REPO_PLN_ID 
        , SUM(T.CNTR_QTY)  CNTR_QTY 
        , 'ONH' DIV
    FROM 
        EQR_ONF_HIR_EXE_PLN T
        #if (${type} != '' && $arrAtEccCd.size() > 0)
            , (SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
            #if (${type} == 'R')
                AND RCC_CD
            #elseif (${type} == 'L')
                AND LCC_CD
            #else
                AND ECC_CD
            #end
            IN(
                #foreach ($key in ${arrAtEccCd})
                    #if($velocityCount < $arrAtEccCd.size())
                    '$key',
                    #else
                    '$key'
                    #end
                #end
            ))C
        #end
    WHERE 
        T.ONF_HIR_DIV_CD = 'O'
        AND T.PLN_YRWK BETWEEN @[prefFrom] AND  @[prefTo]
        #if (${type} != '')
            AND (SUBSTR(T.TO_YD_CD,0,5) = C.ECC_CD)
        #end
        #if (${radiocomp} != '')
            #if (${radiocomp} == 'B')
                AND CO_CD IN ('H','S')
            #else
                AND CO_CD = @[radiocomp]
            #end
        #end
    GROUP BY 
        T.TO_YD_CD
        
    UNION ALL
    
    ----- [OFF]
    SELECT 
        (
            SELECT 
                #if (${radioopr} == '0')
                    #if (${typeBy} == 'R')
                        B.RCC_CD
                    #elseif (${typeBy} == 'C')
                        B.CNT_CD
                    #elseif (${typeBy} == 'L')
                        B.LCC_CD
                    #else
                        B.ECC_CD
                    #end
                #end
            FROM 
                MDM_EQ_ORZ_CHT A
                , EQR_ECC_MST B
            WHERE 
                SCC_CD = SUBSTR(T.FM_YD_CD,0,5) 
                AND A.ECC_CD = B.ECC_CD 
        ) RCC_CD
        , '' REPO_PLN_ID 
        , SUM(T.CNTR_QTY)  CNTR_QTY 
        , 'OFH' DIV
    FROM 
        EQR_ONF_HIR_EXE_PLN T
        #if (${type} != '' && $arrAtEccCd.size() > 0)
            , (SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
            #if (${type} == 'R')
                AND RCC_CD
            #elseif (${type} == 'L')
                AND LCC_CD
            #else
                AND ECC_CD
            #end
            IN(
                #foreach ($key in ${arrAtEccCd})
                    #if($velocityCount < $arrAtEccCd.size())
                    '$key',
                    #else
                    '$key'
                    #end
                #end
            ))C
        #end
    WHERE 
        T.ONF_HIR_DIV_CD = 'F'
        AND T.PLN_YRWK BETWEEN @[prefFrom] AND  @[prefTo]
        #if (${type} != '')
            AND (SUBSTR(T.FM_YD_CD,0,5) = C.ECC_CD)
        #end
        #if (${radiocomp} != '')
            #if (${radiocomp} == 'B')
                AND CO_CD IN ('H','S')
            #else
                AND CO_CD = @[radiocomp]
            #end
        #end
    GROUP BY 
        T.FM_YD_CD
)
WHERE 
    RCC_CD IS NOT NULL
GROUP BY 
    RCC_CD ,REPO_PLN_ID
ORDER BY 
    RCC_CD			]]></sql>
			<params>
				<param name="data0" type="12" value="" out="N"/>
				<param name="prefFrom" type="12" value="" out="N"/>
				<param name="prefTo" type="12" value="" out="N"/>
				<param name="radiocomp" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
