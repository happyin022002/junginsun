<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceIssueCollectionMgtDBDAOSearchManualInvoiceBySummaryListRSQL">
			<desc><![CDATA[INVOICE 생성 및 징수관리
EES_DMT_4006
Manual Invoice Report by Office]]></desc>
			<sql><![CDATA[
SELECT
		(
#if ( ${grpbyor} == '1' )
		OV.OFC_N3RD_LVL_CD		
#else
		I.CRE_OFC_CD
#end
        ) OFFICE
        , DECODE(I.DMDT_MNL_INV_RSN_CD, 'OTH', 'Other', R.INTG_CD_VAL_DP_DESC) REASON
        , COUNT ( I.DMDT_INV_NO ) TTLINVQTY
        , I.INV_CURR_CD CUR,
  SUM ( I.INV_CHG_AMT ) TTLBLLAMT ,
  SUM ( DECODE ( I.DMDT_TRF_CD , 'DMIF' , 1 , 0 ) ) DMIFINV ,
  SUM ( DECODE ( I.DMDT_TRF_CD , 'DMIF' , I.INV_CHG_AMT , 0 ) ) DMIFAMT ,
  SUM ( DECODE ( I.DMDT_TRF_CD , 'DTIC' , 1 , 0 ) ) DTICINV ,
  SUM ( DECODE ( I.DMDT_TRF_CD , 'DTIC' , I.INV_CHG_AMT , 0 ) ) DTICAMT ,
  SUM ( DECODE ( I.DMDT_TRF_CD , 'DMOF' , 1 , 0 ) ) DMOFINV ,
  SUM ( DECODE ( I.DMDT_TRF_CD , 'DMOF' , I.INV_CHG_AMT , 0 ) ) DMOFAMT ,
  SUM ( DECODE ( I.DMDT_TRF_CD , 'DTOC' , 1 , 0 ) ) DTOCINV ,
  SUM ( DECODE ( I.DMDT_TRF_CD , 'DTOC' , I.INV_CHG_AMT , 0 ) ) DTOCAMT ,
  SUM ( DECODE ( I.DMDT_TRF_CD , 'CTIC' , 1 , 0 ) ) CTICINV ,
  SUM ( DECODE ( I.DMDT_TRF_CD , 'CTIC' , I.INV_CHG_AMT , 0 ) ) CTICAMT ,
  SUM ( DECODE ( I.DMDT_TRF_CD , 'CTOC' , 1 , 0 ) ) CTOCINV ,
  SUM ( DECODE ( I.DMDT_TRF_CD , 'CTOC' , I.INV_CHG_AMT , 0 ) ) CTOCAMT 
		, I.DMDT_MNL_INV_RSN_CD AS REASONN
		, DECODE(I.DMDT_MNL_INV_RSN_CD, 'OTH', 9, R.INTG_CD_VAL_DP_SEQ) REASONSQ
FROM
        DMT_INV_MN        I
        , COM_INTG_CD_DTL R
        , DMT_OFC_LVL_V   OV
#if ( ${usr_rhq_ofc_cd} != 'SELHO' )
		, MDM_ORGANIZATION MO
#end
WHERE
        I.MNL_INP_FLG = 'Y'
AND     I.CRE_OFC_CD = OV.OFC_N8TH_LVL_CD
AND     I.DMDT_MNL_INV_RSN_CD = R.INTG_CD_VAL_CTNT
AND 	R.INTG_CD_ID = 'CD01975'
AND     I.CRE_DT BETWEEN TO_DATE( @[fm_dt] , 'YYYY-MM-DD' ) AND TO_DATE( @[to_dt] , 'YYYY-MM-DD' ) + 0.99999

#if ( ${usr_rhq_ofc_cd} != 'SELHO' )
AND     I.CRE_OFC_CD = MO.OFC_CD
AND     MO.AR_HD_QTR_OFC_CD = @[usr_rhq_ofc_cd]
#end

#if ( ${ofc_flg} == 'O' )

	#if ( ${office} != '' )
AND     I.CRE_OFC_CD IN (
    	#foreach( $cre_ofc_cd_p in ${tempISOFList}) 
        	#if($velocityCount < $tempISOFList.size()) 
           		'$cre_ofc_cd_p', 
        	#else 
           		'$cre_ofc_cd_p' 
        	#end 
    	#end
        )
	#end

#elseif ( ${ofc_flg} == 'R' && ${office} != 'All' ) -- ofc_flg == R

AND     (
            I.CRE_OFC_CD IN (
                            SELECT OFC_CD 
                            FROM   MDM_ORGANIZATION
                            START WITH OFC_CD = @[office]
                            CONNECT BY NOCYCLE PRIOR OFC_CD = PRNT_OFC_CD
                            )
        )

#end -- ofc_flg == R

#if ( ${reasoncd} != 'All' )
AND     I.DMDT_MNL_INV_RSN_CD = @[reasoncd]
#end

GROUP BY 
#if ( ${grpbyor} == '1' )
		OV.OFC_N3RD_LVL_CD		
#else
		I.CRE_OFC_CD
#end
        , DECODE(I.DMDT_MNL_INV_RSN_CD, 'OTH', 'Other', R.INTG_CD_VAL_DP_DESC)
		, DECODE(I.DMDT_MNL_INV_RSN_CD, 'OTH', 9, R.INTG_CD_VAL_DP_SEQ)
        , I.INV_CURR_CD
		, I.DMDT_MNL_INV_RSN_CD
ORDER BY 
#if ( ${grpbyor} == '1' )
		OV.OFC_N3RD_LVL_CD		
#else
		I.CRE_OFC_CD
#end
        , DECODE(I.DMDT_MNL_INV_RSN_CD, 'OTH', 9, R.INTG_CD_VAL_DP_SEQ)
        , I.INV_CURR_CD			]]></sql>
			<params>
				<param name="fm_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="usr_rhq_ofc_cd" type="12" value="" out="N"/>
				<param name="office" type="12" value="" out="N"/>
				<param name="reasoncd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
