<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DisposalMgtDBDAOsearchDisposalSoldListDataRSQL">
			<desc><![CDATA[Disposal Sold Creation 에서 Header 조회]]></desc>
			<sql><![CDATA[
SELECT A.DISP_NO
     , A.DISP_TP_CD
     , (SELECT MNR_CD_DP_DESC FROM MNR_GEN_CD WHERE PRNT_CD_ID = 'CD00035' AND MNR_CD_ID = A.DISP_TP_CD )  AS DISP_TP_NM
     , B.DISP_UT_TP_CD
     , (SELECT MNR_CD_DP_DESC FROM MNR_GEN_CD WHERE PRNT_CD_ID = 'CD00078' AND MNR_CD_ID = B.DISP_UT_TP_CD ) AS DISP_UT_TP_NM
     , TO_CHAR(A.APRO_DT,'YYYY-MM-DD')  AS APRO_DT
     , MNR_COMMON_PKG.MNR_CONV_PARTNER_CD_FNC(B.MNR_PRNR_SEQ, B.MNR_PRNR_CNT_CD) AS BUYER_CODE
     , E.MNR_PRNR_LGL_ENG_NM AS BUYER_NAME
     , B.SOLD_QTY
     , B.PENDING_QTY
     , B.TOTAL_QTY
     , A.EQ_KND_CD
	 , B.MNR_PRNR_CNT_CD
     , B.MNR_PRNR_SEQ
     , E.FAX_NO
     , E.MNR_PRNR_EML
  FROM MNR_DISP_HDR A
     , (SELECT C.DISP_NO
             , SUM(DECODE(D.DISP_SOLD_DT, NULL, 0, D.DISP_QTY)) AS SOLD_QTY
             , SUM(DECODE(D.DISP_SOLD_DT, NULL, D.DISP_QTY)) AS PENDING_QTY
             , SUM(D.DISP_QTY)  AS TOTAL_QTY
			 , D.MNR_PRNR_CNT_CD
			 , D.MNR_PRNR_SEQ  
 			 , D.MNR_PRNR_CNT_CD || D.MNR_PRNR_SEQ  AS BUYER_CODE 
             , D.DISP_UT_TP_CD
          FROM MNR_DISP_HDR C
             , MNR_DISP_DTL D
         WHERE C.DISP_NO = D.DISP_NO
           AND D.MNR_PRNR_CNT_CD IS NOT NULL 
           #if (${status} == 'S') 
           AND C.DISP_STS_CD = 'HE'
           #else 
           AND C.DISP_STS_CD IN( 'HC', 'HP')
           #end

		   #if (${eq_no} != '') 
           AND D.EQ_NO IN (
           	   #foreach ($user_eq_no IN ${eq_no})
  			       #if($velocityCount < $eq_no.size())
  				       '$user_eq_no',
  			       #else
  				       '$user_eq_no'
  			       #end
  		       #end			  
           )
           #end
         
		 GROUP BY C.DISP_NO,D.MNR_PRNR_CNT_CD,D.MNR_PRNR_SEQ,D.DISP_UT_TP_CD
       ) B
     , MNR_PARTNER E
 WHERE A.DISP_NO = B.DISP_NO
   AND A.RQST_OFC_CD = @[ofc_cd]
   AND B.MNR_PRNR_CNT_CD = E.MNR_PRNR_CNT_CD(+)
   AND B.MNR_PRNR_SEQ = E.MNR_PRNR_SEQ(+)
   AND E.MNR_GRP_TP_CD = 'DSP'

   #if (${status} == 'S') 
   AND A.DISP_STS_CD = 'HE'
   #else 
   AND A.DISP_STS_CD IN ( 'HC', 'HP')
   #end

   AND A.EQ_KND_CD = @[eq_knd_cd]
   AND A.APRO_DT BETWEEN GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[ofc_cd],TO_DATE(@[apro_dt_fr], 'YYYY-MM-DD'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC()) 
                     AND GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[ofc_cd],TO_DATE(@[apro_dt_to]||'23:59:59','YYYY-MM-DD HH24:MI:SS'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC())

   #if (${disp_no} != '') 
   AND A.DISP_NO IN ( 
  		#foreach ($user_disp_no IN ${disp_no})
  			#if($velocityCount < $disp_no.size())
  				'$user_disp_no',
  			#else
  				'$user_disp_no'
  			#end
  		#end			  
   )
   #end

   #if (${mnr_prnr_seq} != '') 
   AND B.MNR_PRNR_CNT_CD = @[mnr_prnr_cnt_cd]
   AND B.MNR_PRNR_SEQ = TO_NUMBER(@[mnr_prnr_seq])
   #end

 ORDER BY A.DISP_NO DESC			]]></sql>
			<params>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="eq_knd_cd" type="12" value="" out="N"/>
				<param name="apro_dt_fr" type="12" value="" out="N"/>
				<param name="apro_dt_to" type="12" value="" out="N"/>
				<param name="mnr_prnr_cnt_cd" type="12" value="" out="N"/>
				<param name="mnr_prnr_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
