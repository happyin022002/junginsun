/*=========================================================
*Copyright(c) 2015 CyberLogitec
*@FileName : WaiveReportDBDAOSearchWaveReportByOfficeListRSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2015.08.12
*@LastModifier : 김기태
*@LastVersion : 1.0
* 2015.08.12 김기태
* 1.0 Creation
=========================================================*/
package com.hanjin.apps.alps.ees.dmt.dmtperformanceanalysis.waivereport.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.hanjin.framework.support.db.ISQLTemplate;

/**
 *
 * @author Kitae Kim
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class WaiveReportDBDAOSearchWaveReportByOfficeListRSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * WAIVE REPORT
	  * EES_DMT_6009
	  * Waive Report by Office
	  * </pre>
	  */
	public WaiveReportDBDAOSearchWaveReportByOfficeListRSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("end_dt",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("ofc_cd2",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("curr_flg",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("grp_flg",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("ofc_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("ofc_flg2",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("start_dt",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("reqapp",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("dmdt_cntr_tp_cd",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.hanjin.apps.alps.ees.dmt.dmtperformanceanalysis.waivereport.integration").append("\n"); 
		query.append("FileName : WaiveReportDBDAOSearchWaveReportByOfficeListRSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("WITH AFT_BKG# AS (" ).append("\n"); 
		query.append("    SELECT DB.SC_NO, DB.RFA_NO," ).append("\n"); 
		query.append("           CASE" ).append("\n"); 
		query.append("               WHEN DB.SC_NO IS NOT NULL AND DB.RFA_NO IS NULL THEN 'S'" ).append("\n"); 
		query.append("               ELSE 'R'" ).append("\n"); 
		query.append("           END CTRT_TP," ).append("\n"); 
		query.append("           AFT_EXP.PROG_OFC_CD, AFT_EXP.AFT_EXPT_DAR_NO," ).append("\n"); 
		query.append("           DB.SYS_AREA_GRP_ID, DB.CNTR_NO, DB.CNTR_CYC_NO, AFT_EXP.DMDT_TRF_CD" ).append("\n"); 
		query.append("      FROM (" ).append("\n"); 
		query.append("--  AND :reqapp ='R'                 --------- 해당부분을 UNION ALL로 분기하여야 합니다. 해당부분로직검토 필요" ).append("\n"); 
		query.append("--  AND :ofc_flg2='O'            " ).append("\n"); 
		query.append("        SELECT /*+ LEADING(AM)   USE_NL(AM AD) */" ).append("\n"); 
		query.append("			DISTINCT	AM.AFT_EXPT_DAR_NO," ).append("\n"); 
		query.append("						AM.RQST_OFC_CD PROG_OFC_CD," ).append("\n"); 
		query.append("						AD.BKG_NO," ).append("\n"); 
		query.append("						AD.DMDT_TRF_CD" ).append("\n"); 
		query.append("        FROM DMT_AFT_BKG_ADJ_RQST AM," ).append("\n"); 
		query.append("          DMT_AFT_BKG_ADJ_RQST_DTL AD" ).append("\n"); 
		query.append("        WHERE 1 = 1" ).append("\n"); 
		query.append("#if ( ${ofc_cd2} != '' )" ).append("\n"); 
		query.append("          AND AM.RQST_OFC_CD IN (" ).append("\n"); 
		query.append("                                    #foreach( $waive_off_cd_p in ${tempWaiveOFFList}) " ).append("\n"); 
		query.append("                                        #if($velocityCount < $tempWaiveOFFList.size()) " ).append("\n"); 
		query.append("                                           '$waive_off_cd_p', " ).append("\n"); 
		query.append("                                        #else " ).append("\n"); 
		query.append("                                           '$waive_off_cd_p' " ).append("\n"); 
		query.append("                                        #end " ).append("\n"); 
		query.append("                                    #end" ).append("\n"); 
		query.append("                                )" ).append("\n"); 
		query.append("          AND @[reqapp] = 'R'" ).append("\n"); 
		query.append("          AND @[ofc_flg2] = 'O'" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("          AND AM.AFT_EXPT_DAR_NO = AD.AFT_EXPT_DAR_NO" ).append("\n"); 
		query.append("          AND AM.DMDT_EXPT_RQST_STS_CD = 'A'" ).append("\n"); 
		query.append("        UNION ALL" ).append("\n"); 
		query.append("--  AND :reqapp ='R'" ).append("\n"); 
		query.append("--  AND :ofc_flg2='R'    " ).append("\n"); 
		query.append("        SELECT /*+ INDEX( AM XAK2DMT_AFT_BKG_ADJ_RQST) USE_NL(AM AD)*/" ).append("\n"); 
		query.append("        	DISTINCT  AM.AFT_EXPT_DAR_NO," ).append("\n"); 
		query.append("			          AM.RQST_OFC_CD PROG_OFC_CD," ).append("\n"); 
		query.append("			          AD.BKG_NO," ).append("\n"); 
		query.append("			          AD.DMDT_TRF_CD" ).append("\n"); 
		query.append("        FROM DMT_AFT_BKG_ADJ_RQST AM," ).append("\n"); 
		query.append("          DMT_AFT_BKG_ADJ_RQST_DTL AD" ).append("\n"); 
		query.append("        WHERE 1 = 1" ).append("\n"); 
		query.append("#if ( ${ofc_cd2} != '' )" ).append("\n"); 
		query.append("          AND @[reqapp] = 'R'" ).append("\n"); 
		query.append("          AND @[ofc_flg2] = 'R'" ).append("\n"); 
		query.append("          AND @[ofc_cd2] <> 'All'" ).append("\n"); 
		query.append("          AND AM.RQST_OFC_CD IN (" ).append("\n"); 
		query.append("            SELECT OFC_CD" ).append("\n"); 
		query.append("            FROM MDM_ORGANIZATION START WITH OFC_CD IN (" ).append("\n"); 
		query.append("                                                            #foreach( $waive_off_cd_p in ${tempWaiveOFFList}) " ).append("\n"); 
		query.append("                                                                #if($velocityCount < $tempWaiveOFFList.size()) " ).append("\n"); 
		query.append("                                                                   '$waive_off_cd_p', " ).append("\n"); 
		query.append("                                                                #else " ).append("\n"); 
		query.append("                                                                   '$waive_off_cd_p' " ).append("\n"); 
		query.append("                                                                #end " ).append("\n"); 
		query.append("                                                            #end" ).append("\n"); 
		query.append("                                                       ) CONNECT BY NOCYCLE PRIOR OFC_CD = PRNT_OFC_CD)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("          AND AM.AFT_EXPT_DAR_NO = AD.AFT_EXPT_DAR_NO" ).append("\n"); 
		query.append("          AND AM.DMDT_EXPT_RQST_STS_CD = 'A'" ).append("\n"); 
		query.append("        UNION ALL" ).append("\n"); 
		query.append("--  AND :reqapp ='A'" ).append("\n"); 
		query.append("--  AND :ofc_flg2='O'    " ).append("\n"); 
		query.append("        SELECT /*+ LEADING(AM)   USE_NL(AM AD) opt_param('_OPTIMIZER_SKIP_SCAN_ENABLED','FALSE') */" ).append("\n"); 
		query.append("        	DISTINCT  AM.AFT_EXPT_DAR_NO," ).append("\n"); 
		query.append("			          AM.APRO_OFC_CD PROG_OFC_CD," ).append("\n"); 
		query.append("			          AD.BKG_NO," ).append("\n"); 
		query.append("			          AD.DMDT_TRF_CD" ).append("\n"); 
		query.append("        FROM DMT_AFT_BKG_ADJ_RQST AM," ).append("\n"); 
		query.append("          DMT_AFT_BKG_ADJ_RQST_DTL AD" ).append("\n"); 
		query.append("        WHERE 1 = 1" ).append("\n"); 
		query.append("#if ( ${ofc_cd2} != '' )" ).append("\n"); 
		query.append("          AND AM.APRO_OFC_CD IN (" ).append("\n"); 
		query.append("                                    #foreach( $waive_off_cd_p in ${tempWaiveOFFList}) " ).append("\n"); 
		query.append("                                        #if($velocityCount < $tempWaiveOFFList.size()) " ).append("\n"); 
		query.append("                                           '$waive_off_cd_p', " ).append("\n"); 
		query.append("                                        #else " ).append("\n"); 
		query.append("                                           '$waive_off_cd_p' " ).append("\n"); 
		query.append("                                        #end " ).append("\n"); 
		query.append("                                    #end" ).append("\n"); 
		query.append("                                )" ).append("\n"); 
		query.append("          AND @[reqapp] = 'A'" ).append("\n"); 
		query.append("          AND @[ofc_flg2] = 'O'" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("          AND AM.AFT_EXPT_DAR_NO = AD.AFT_EXPT_DAR_NO" ).append("\n"); 
		query.append("          AND AM.DMDT_EXPT_RQST_STS_CD = 'A'" ).append("\n"); 
		query.append("        UNION ALL" ).append("\n"); 
		query.append("--  AND :reqapp ='A'" ).append("\n"); 
		query.append("--  AND :ofc_flg2='R'    " ).append("\n"); 
		query.append("        SELECT /*+ INDEX( AM XAK2DMT_AFT_BKG_ADJ_RQST) USE_NL(AM AD)*/" ).append("\n"); 
		query.append("        	DISTINCT  AM.AFT_EXPT_DAR_NO," ).append("\n"); 
		query.append("			          AM.APRO_OFC_CD PROG_OFC_CD," ).append("\n"); 
		query.append("			          AD.BKG_NO," ).append("\n"); 
		query.append("			          AD.DMDT_TRF_CD" ).append("\n"); 
		query.append("        FROM DMT_AFT_BKG_ADJ_RQST AM," ).append("\n"); 
		query.append("          DMT_AFT_BKG_ADJ_RQST_DTL AD" ).append("\n"); 
		query.append("        WHERE 1 = 1" ).append("\n"); 
		query.append("#if ( ${ofc_cd2} != '' )" ).append("\n"); 
		query.append("          AND @[reqapp] = 'A'" ).append("\n"); 
		query.append("          AND @[ofc_flg2] = 'R'" ).append("\n"); 
		query.append("          AND @[ofc_cd2] <> 'All'" ).append("\n"); 
		query.append("          AND AM.APRO_OFC_CD IN (" ).append("\n"); 
		query.append("            SELECT OFC_CD" ).append("\n"); 
		query.append("            FROM MDM_ORGANIZATION START WITH OFC_CD IN (" ).append("\n"); 
		query.append("                                                            #foreach( $waive_off_cd_p in ${tempWaiveOFFList}) " ).append("\n"); 
		query.append("                                                                #if($velocityCount < $tempWaiveOFFList.size()) " ).append("\n"); 
		query.append("                                                                   '$waive_off_cd_p', " ).append("\n"); 
		query.append("                                                                #else " ).append("\n"); 
		query.append("                                                                   '$waive_off_cd_p' " ).append("\n"); 
		query.append("                                                                #end " ).append("\n"); 
		query.append("                                                            #end" ).append("\n"); 
		query.append("                                                       ) CONNECT BY NOCYCLE PRIOR OFC_CD = PRNT_OFC_CD)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("          AND AM.AFT_EXPT_DAR_NO = AD.AFT_EXPT_DAR_NO" ).append("\n"); 
		query.append("          AND AM.DMDT_EXPT_RQST_STS_CD = 'A') AFT_EXP  , DMT_CHG_BKG_CNTR DB" ).append("\n"); 
		query.append("    WHERE DB.BKG_NO        = AFT_EXP.BKG_NO" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("SELECT  DECODE(@[grp_flg], 'O', X.PROG_OFC_CD, 'R', OV.OFC_N3RD_LVL_CD) AS OFFICE," ).append("\n"); 
		query.append("        X.DMDT_TRF_CD AS TARIFF," ).append("\n"); 
		query.append("        X.SC_NO AS SCNO," ).append("\n"); 
		query.append("        X.RFA_NO AS RFANO," ).append("\n"); 
		query.append("        X.CUST_CNT_CD||LPAD(X.CUST_SEQ,6,'0') AS CUSCODE," ).append("\n"); 
		query.append("        (   SELECT  CUST_LGL_ENG_NM" ).append("\n"); 
		query.append("              FROM  MDM_CUSTOMER" ).append("\n"); 
		query.append("             WHERE  CUST_CNT_CD     = X.CUST_CNT_CD" ).append("\n"); 
		query.append("               AND  CUST_SEQ        = X.CUST_SEQ" ).append("\n"); 
		query.append("        )   AS CUSNAME," ).append("\n"); 
		query.append("        DECODE( @[curr_flg], 'U', 'USD', X.BZC_TRF_CURR_CD) AS CUR," ).append("\n"); 
		query.append("		X.BZC_TRF_CURR_CD AS LOCALCUR," ).append("\n"); 
		query.append("		NVL ( COUNT ( DISTINCT DECODE ( SIGN(X.ORG_CHG_AMT), 1, X.CNTR_NO)) , 0 ) AS CNTR1," ).append("\n"); 
		query.append("        NVL ( ROUND ( SUM ( DECODE( @[curr_flg], 'U', X.ORG_CHG_AMT  / F.USD_LOCL_XCH_RT, X.ORG_CHG_AMT  ) ), 2 ) , 0 ) AS AMT1," ).append("\n"); 
		query.append("        NVL ( COUNT ( DISTINCT DECODE ( SIGN(X.CMDT_EXPT_AMT), 1, X.CNTR_NO)) , 0 )  AS CNTR2," ).append("\n"); 
		query.append("        NVL ( ROUND ( SUM ( DECODE( @[curr_flg], 'U', NVL(X.CMDT_EXPT_AMT, 0) / F.USD_LOCL_XCH_RT, NVL(X.CMDT_EXPT_AMT, 0) ) ), 2 ) , 0 ) AS AMT2," ).append("\n"); 
		query.append("        NVL ( COUNT ( DISTINCT DECODE ( SIGN(X.SC_RFA_EXPT_AMT), 1, X.CNTR_NO)) , 0 )  AS CNTR3," ).append("\n"); 
		query.append("        NVL ( ROUND ( SUM ( DECODE( @[curr_flg], 'U', X.SC_RFA_EXPT_AMT / F.USD_LOCL_XCH_RT, X.SC_RFA_EXPT_AMT) ), 2 ) , 0 ) AS AMT3," ).append("\n"); 
		query.append("        NVL ( COUNT ( DISTINCT DECODE ( SIGN(X.AFT_EXPT_DC_AMT), 1, X.CNTR_NO)) , 0 )   AS CNTR4," ).append("\n"); 
		query.append("        NVL ( ROUND ( SUM ( DECODE( @[curr_flg], 'U', X.AFT_EXPT_DC_AMT  / F.USD_LOCL_XCH_RT, X.AFT_EXPT_DC_AMT  ) ), 2 ) , 0 ) AS AMT4," ).append("\n"); 
		query.append("        NVL ( COUNT ( DISTINCT DECODE ( SIGN(X.SC_RFA_EXPT_AMT), 1, X.CNTR_NO, DECODE( SIGN(X.AFT_EXPT_DC_AMT), 1, X.CNTR_NO))) , 0 ) AS CNTR5," ).append("\n"); 
		query.append("        NVL(ROUND ( SUM ( DECODE( @[curr_flg], 'U', X.SC_RFA_EXPT_AMT / F.USD_LOCL_XCH_RT, X.SC_RFA_EXPT_AMT) ), 2 ), 0)" ).append("\n"); 
		query.append("        + NVL(ROUND ( SUM ( DECODE( @[curr_flg], 'U', X.AFT_EXPT_DC_AMT  / F.USD_LOCL_XCH_RT, X.AFT_EXPT_DC_AMT  ) ), 2 ), 0) AS AMT5" ).append("\n"); 
		query.append("FROM    (" ).append("\n"); 
		query.append("        SELECT  /*+ USE_NL(SC CUST DC ) LEADING(SC) */" ).append("\n"); 
		query.append("                SC.SC_NO," ).append("\n"); 
		query.append("                '' RFA_NO," ).append("\n"); 
		query.append("                SC.PROP_NO," ).append("\n"); 
		query.append("                CUST.CUST_CNT_CD    CUST_CNT_CD," ).append("\n"); 
		query.append("                CUST.CUST_SEQ       CUST_SEQ," ).append("\n"); 
		query.append("                SC.PROG_OFC_CD    PROG_OFC_CD," ).append("\n"); 
		query.append("                DC.SYS_AREA_GRP_ID, DC.CNTR_NO, DC.CNTR_CYC_NO, DC.DMDT_TRF_CD," ).append("\n"); 
		query.append("                DC.BZC_TRF_CURR_CD, DC.ORG_CHG_AMT, DC.CMDT_EXPT_AMT, DC.SC_RFA_EXPT_AMT, " ).append("\n"); 
		query.append("                CASE WHEN DC.AFT_EXPT_DC_AMT > 0 THEN   (" ).append("\n"); 
		query.append("                                                            SELECT	DC.AFT_EXPT_DC_AMT" ).append("\n"); 
		query.append("                                                            FROM	DMT_AFT_BKG_ADJ_RQST AM" ).append("\n"); 
		query.append("                                                            WHERE" ).append("\n"); 
		query.append("                                                                    DECODE(@[reqapp], 'R', AM.RQST_OFC_CD, AM.APRO_OFC_CD) = SC.PROG_OFC_CD" ).append("\n"); 
		query.append("                                                            AND     AM.AFT_EXPT_DAR_NO = DC.AFT_EXPT_DAR_NO " ).append("\n"); 
		query.append("                                                        )" ).append("\n"); 
		query.append("                     WHEN DC.AFT_EXPT_DC_AMT = 0 THEN 0" ).append("\n"); 
		query.append("                END AS AFT_EXPT_DC_AMT" ).append("\n"); 
		query.append("                	, DC.TO_MVMT_DT" ).append("\n"); 
		query.append("          FROM  DMT_CHG_CALC	DC," ).append("\n"); 
		query.append("                (" ).append("\n"); 
		query.append("                SELECT	/*+ USE_NL(SC SCH SC_EXP)*/ " ).append("\n"); 
		query.append("                		PROP_NO, AMDT_SEQ, SC_NO, PROG_OFC_CD" ).append("\n"); 
		query.append("                  FROM (" ).append("\n"); 
		query.append("                        SELECT	/*+ USE_NL(SC SCH SC_EXP)*/" ).append("\n"); 
		query.append("                        		SCH.PROP_NO, SC.AMDT_SEQ, SCH.SC_NO, SC_EXP.PROG_OFC_CD  PROG_OFC_CD," ).append("\n"); 
		query.append("                               	DENSE_RANK() OVER(PARTITION BY SCH.SC_NO ORDER BY SC.AMDT_SEQ DESC) AMDT_SEQ_FILTER" ).append("\n"); 
		query.append("                          FROM (" ).append("\n"); 
		query.append("                                SELECT DISTINCT PROP_NO, PROG_OFC_CD" ).append("\n"); 
		query.append("                                  FROM DMT_SC_EXPT_VER_PROG" ).append("\n"); 
		query.append("                                 WHERE 1=1" ).append("\n"); 
		query.append("#if ( ${ofc_cd2} != '' )" ).append("\n"); 
		query.append("                                   AND (" ).append("\n"); 
		query.append("                                        (" ).append("\n"); 
		query.append("                                            @[ofc_flg2]   =   'O'" ).append("\n"); 
		query.append("                                            AND" ).append("\n"); 
		query.append("                                            PROG_OFC_CD IN (" ).append("\n"); 
		query.append("                                                #foreach( $waive_off_cd_p in ${tempWaiveOFFList}) " ).append("\n"); 
		query.append("                                                    #if($velocityCount < $tempWaiveOFFList.size()) " ).append("\n"); 
		query.append("                                                       '$waive_off_cd_p', " ).append("\n"); 
		query.append("                                                    #else " ).append("\n"); 
		query.append("                                                       '$waive_off_cd_p' " ).append("\n"); 
		query.append("                                                    #end " ).append("\n"); 
		query.append("                                                #end" ).append("\n"); 
		query.append("                                            )" ).append("\n"); 
		query.append("                                        )" ).append("\n"); 
		query.append("                                   OR   (" ).append("\n"); 
		query.append("                                            @[ofc_flg2]   =   'R'" ).append("\n"); 
		query.append("                                            AND" ).append("\n"); 
		query.append("                                            @[ofc_cd2] <> 'All'" ).append("\n"); 
		query.append("                                            AND" ).append("\n"); 
		query.append("                                            PROG_OFC_CD   IN  (" ).append("\n"); 
		query.append("                                                                SELECT OFC_CD" ).append("\n"); 
		query.append("                                                                FROM   MDM_ORGANIZATION" ).append("\n"); 
		query.append("                                                                START WITH OFC_CD IN (" ).append("\n"); 
		query.append("                                                                    #foreach( $waive_off_cd_p in ${tempWaiveOFFList}) " ).append("\n"); 
		query.append("                                                                        #if($velocityCount < $tempWaiveOFFList.size()) " ).append("\n"); 
		query.append("                                                                           '$waive_off_cd_p', " ).append("\n"); 
		query.append("                                                                        #else " ).append("\n"); 
		query.append("                                                                           '$waive_off_cd_p' " ).append("\n"); 
		query.append("                                                                        #end " ).append("\n"); 
		query.append("                                                                    #end" ).append("\n"); 
		query.append("                                                                )" ).append("\n"); 
		query.append("                                                                CONNECT BY NOCYCLE PRIOR OFC_CD = PRNT_OFC_CD" ).append("\n"); 
		query.append("                                                            )" ).append("\n"); 
		query.append("                                        )" ).append("\n"); 
		query.append("                                       )" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                                   AND DMDT_EXPT_VER_STS_CD = DECODE(@[reqapp], 'R', 'R', 'A', 'L')" ).append("\n"); 
		query.append("                               ) SC_EXP, PRI_SP_HDR SCH, PRI_SP_MN SC" ).append("\n"); 
		query.append("                         WHERE SC_EXP.PROP_NO = SCH.PROP_NO" ).append("\n"); 
		query.append("                           AND SCH.PROP_NO    = SC.PROP_NO" ).append("\n"); 
		query.append("                       )" ).append("\n"); 
		query.append("                 WHERE AMDT_SEQ_FILTER = 1" ).append("\n"); 
		query.append("               ) SC, PRI_SP_CTRT_PTY CUST" ).append("\n"); 
		query.append("         WHERE SC.PROP_NO  = CUST.PROP_NO" ).append("\n"); 
		query.append("           AND SC.AMDT_SEQ = CUST.AMDT_SEQ" ).append("\n"); 
		query.append("           AND CUST.PRC_CTRT_PTY_TP_CD = 'C'" ).append("\n"); 
		query.append("           AND DC.SC_NO = SC.SC_NO" ).append("\n"); 
		query.append("           AND DC.TO_MVMT_DT BETWEEN TO_DATE (REPLACE (@[start_dt], '-', ''), 'YYYYMMDD') + .0" ).append("\n"); 
		query.append("                             	 AND TO_DATE (REPLACE (@[end_dt], '-', ''), 'YYYYMMDD') + .99999" ).append("\n"); 
		query.append("--          AND DC.DMDT_TRF_CD IN ('DMIF', 'DTIC', 'DMOF', 'DTOC', 'CTIC', 'CTOC')" ).append("\n"); 
		query.append("			AND DC.DMDT_TRF_CD	IN	(" ).append("\n"); 
		query.append("					#foreach( $trf_cd in ${tempDMTTRFList} )" ).append("\n"); 
		query.append("						#if($velocityCount < $tempDMTTRFList.size()) '$trf_cd', #else '$trf_cd' #end" ).append("\n"); 
		query.append("					#end" ).append("\n"); 
		query.append("					)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("           AND DC.DMDT_CHG_STS_CD IN ('F', 'C', 'I', 'N')" ).append("\n"); 
		query.append("    	#if (${ofc_flg} == 'O')" ).append("\n"); 
		query.append("    		AND	DC.OFC_CD	IN (" ).append("\n"); 
		query.append("    			#foreach( $an_ofc in ${tempDEMDETOFFList} )" ).append("\n"); 
		query.append("    				#if($velocityCount < $tempDEMDETOFFList.size()) '$an_ofc', #else '$an_ofc' #end" ).append("\n"); 
		query.append("    			#end" ).append("\n"); 
		query.append("    			)" ).append("\n"); 
		query.append("    	#elseif (${ofc_flg} == 'R' && ${ofc_cd} != 'All')" ).append("\n"); 
		query.append("    		AND	DECODE(DC.OFC_RHQ_CD, 'NYCHQ', 'NYCRA', DC.OFC_RHQ_CD) = @[ofc_cd]" ).append("\n"); 
		query.append("    	#end" ).append("\n"); 
		query.append("			AND (DC.SC_RFA_EXPT_AMT > 0  OR DC.AFT_EXPT_DC_AMT > 0)" ).append("\n"); 
		query.append("--           AND DC.SC_NO = SC.SC_NO" ).append("\n"); 
		query.append("--           AND DC.SYS_AREA_GRP_ID =" ).append("\n"); 
		query.append("--                (SELECT SYS_AREA_GRP_ID" ).append("\n"); 
		query.append("--                   FROM COM_SYS_AREA_GRP_ID S, MDM_ORGANIZATION M" ).append("\n"); 
		query.append("--                  WHERE CNT_CD = SUBSTR (LOC_CD, 1, 2)" ).append("\n"); 
		query.append("--                    AND CO_IND_CD = 'H'" ).append("\n"); 
		query.append("--                    AND M.OFC_CD = DC.OFC_CD" ).append("\n"); 
		query.append("--                )" ).append("\n"); 
		query.append("			AND DC.DMDT_CHG_LOC_DIV_CD <> 'SZP'	-- 2010/03/19 추가" ).append("\n"); 
		query.append("			AND	-- 2010/03/25 추가" ).append("\n"); 
		query.append("			(" ).append("\n"); 
		query.append("			    (DC.DUL_TP_EXPT_FLG = 'Y' AND SUBSTR(DC.DMDT_TRF_CD, 1, 1) = 'C')" ).append("\n"); 
		query.append("			    OR        " ).append("\n"); 
		query.append("			    (DC.DUL_TP_EXPT_FLG = 'N')" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    UNION ALL" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        SELECT  /*+ USE_NL(REQ_APP DC ) LEADING(REQ_APP) */" ).append("\n"); 
		query.append("                '' SC_NO," ).append("\n"); 
		query.append("                REQ_APP.RFA_NO," ).append("\n"); 
		query.append("                REQ_APP.PROP_NO," ).append("\n"); 
		query.append("                REQ_APP.CTRT_CUST_CNT_CD    CUST_CNT_CD," ).append("\n"); 
		query.append("                REQ_APP.CTRT_CUST_SEQ       CUST_SEQ," ).append("\n"); 
		query.append("                REQ_APP.PROG_OFC_CD     PROG_OFC_CD," ).append("\n"); 
		query.append("                DC.SYS_AREA_GRP_ID, DC.CNTR_NO, DC.CNTR_CYC_NO, DC.DMDT_TRF_CD," ).append("\n"); 
		query.append("                DC.BZC_TRF_CURR_CD, DC.ORG_CHG_AMT, DC.CMDT_EXPT_AMT, DC.SC_RFA_EXPT_AMT, " ).append("\n"); 
		query.append("                CASE WHEN DC.AFT_EXPT_DC_AMT > 0 THEN   (" ).append("\n"); 
		query.append("                                                            SELECT" ).append("\n"); 
		query.append("                                                                    DC.AFT_EXPT_DC_AMT" ).append("\n"); 
		query.append("                                                            FROM" ).append("\n"); 
		query.append("                                                                    DMT_AFT_BKG_ADJ_RQST AM" ).append("\n"); 
		query.append("                                                            WHERE" ).append("\n"); 
		query.append("                                                                    DECODE(@[reqapp], 'R', AM.RQST_OFC_CD, AM.APRO_OFC_CD) = REQ_APP.PROG_OFC_CD" ).append("\n"); 
		query.append("                                                            AND     AM.AFT_EXPT_DAR_NO = DC.AFT_EXPT_DAR_NO " ).append("\n"); 
		query.append("                                                        )" ).append("\n"); 
		query.append("                     WHEN DC.AFT_EXPT_DC_AMT = 0 THEN 0" ).append("\n"); 
		query.append("                END AS AFT_EXPT_DC_AMT" ).append("\n"); 
		query.append("                , DC.TO_MVMT_DT" ).append("\n"); 
		query.append("          FROM  DMT_CHG_CALC	DC," ).append("\n"); 
		query.append("				(" ).append("\n"); 
		query.append("                	SELECT	/*+ USE_NL(RFA_EXP RFH RFA) */ RFH.RFA_NO, RFH.PROP_NO, RFA.CTRT_CUST_CNT_CD, RFA.CTRT_CUST_SEQ, RFA_EXP.PROG_OFC_CD, RFA_EXP.RFA_EXPT_DAR_NO," ).append("\n"); 
		query.append("                       		DENSE_RANK() OVER(PARTITION BY RFH.RFA_NO ORDER BY RFA.AMDT_SEQ DESC) AMDT_SEQ_FILTER" ).append("\n"); 
		query.append("                  	FROM (" ).append("\n"); 
		query.append("--  AND :reqapp ='R'   --------- 해당부분을 UNION ALL로 분기하여야 합니다. 해당부분로직검토 필요" ).append("\n"); 
		query.append("--  AND :ofc_flg2='O'            " ).append("\n"); 
		query.append("            SELECT DISTINCT PROP_NO," ).append("\n"); 
		query.append("              RFA_EXPT_DAR_NO ," ).append("\n"); 
		query.append("              --RQST_OFC_CD PROG_OFC_CD" ).append("\n"); 
		query.append("              DECODE(@[reqapp], 'R', RQST_OFC_CD, APRO_OFC_CD)  PROG_OFC_CD" ).append("\n"); 
		query.append("            FROM DMT_RFA_EXPT_TRF" ).append("\n"); 
		query.append("            WHERE 1 = 1" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if ( ${ofc_cd2} != '' )" ).append("\n"); 
		query.append("          AND RQST_OFC_CD IN (" ).append("\n"); 
		query.append("                                    #foreach( $waive_off_cd_p in ${tempWaiveOFFList}) " ).append("\n"); 
		query.append("                                        #if($velocityCount < $tempWaiveOFFList.size()) " ).append("\n"); 
		query.append("                                           '$waive_off_cd_p', " ).append("\n"); 
		query.append("                                        #else " ).append("\n"); 
		query.append("                                           '$waive_off_cd_p' " ).append("\n"); 
		query.append("                                        #end " ).append("\n"); 
		query.append("                                    #end" ).append("\n"); 
		query.append("                                )" ).append("\n"); 
		query.append("          AND @[reqapp] = 'R'" ).append("\n"); 
		query.append("          AND @[ofc_flg2] = 'O'" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            UNION ALL" ).append("\n"); 
		query.append("--  AND :reqapp ='R'" ).append("\n"); 
		query.append("--  AND :ofc_flg2='R'    " ).append("\n"); 
		query.append("            SELECT DISTINCT PROP_NO," ).append("\n"); 
		query.append("              RFA_EXPT_DAR_NO," ).append("\n"); 
		query.append("              -- RQST_OFC_CD PROG_OFC_CD" ).append("\n"); 
		query.append("              DECODE(@[reqapp], 'R', RQST_OFC_CD, APRO_OFC_CD)  PROG_OFC_CD" ).append("\n"); 
		query.append("            FROM DMT_RFA_EXPT_TRF" ).append("\n"); 
		query.append("            WHERE 1 = 1" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if ( ${ofc_cd2} != '' )" ).append("\n"); 
		query.append("          AND @[reqapp] = 'R'" ).append("\n"); 
		query.append("          AND @[ofc_flg2] = 'R'" ).append("\n"); 
		query.append("          AND @[ofc_cd2] <> 'All'" ).append("\n"); 
		query.append("          AND RQST_OFC_CD IN (" ).append("\n"); 
		query.append("            SELECT OFC_CD" ).append("\n"); 
		query.append("            FROM MDM_ORGANIZATION START WITH OFC_CD IN (" ).append("\n"); 
		query.append("                                                            #foreach( $waive_off_cd_p in ${tempWaiveOFFList}) " ).append("\n"); 
		query.append("                                                                #if($velocityCount < $tempWaiveOFFList.size()) " ).append("\n"); 
		query.append("                                                                   '$waive_off_cd_p', " ).append("\n"); 
		query.append("                                                                #else " ).append("\n"); 
		query.append("                                                                   '$waive_off_cd_p' " ).append("\n"); 
		query.append("                                                                #end " ).append("\n"); 
		query.append("                                                            #end" ).append("\n"); 
		query.append("                                                       ) CONNECT BY NOCYCLE PRIOR OFC_CD = PRNT_OFC_CD)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            UNION ALL" ).append("\n"); 
		query.append("--  AND :reqapp ='A'" ).append("\n"); 
		query.append("--  AND :ofc_flg2='O'    " ).append("\n"); 
		query.append("            SELECT DISTINCT PROP_NO," ).append("\n"); 
		query.append("              RFA_EXPT_DAR_NO," ).append("\n"); 
		query.append("              --RQST_OFC_CD PROG_OFC_CD" ).append("\n"); 
		query.append("              DECODE(@[reqapp], 'R', RQST_OFC_CD, APRO_OFC_CD)  PROG_OFC_CD" ).append("\n"); 
		query.append("            FROM DMT_RFA_EXPT_TRF" ).append("\n"); 
		query.append("            WHERE 1 = 1" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if ( ${ofc_cd2} != '' )" ).append("\n"); 
		query.append("          AND APRO_OFC_CD IN (" ).append("\n"); 
		query.append("                                    #foreach( $waive_off_cd_p in ${tempWaiveOFFList}) " ).append("\n"); 
		query.append("                                        #if($velocityCount < $tempWaiveOFFList.size()) " ).append("\n"); 
		query.append("                                           '$waive_off_cd_p', " ).append("\n"); 
		query.append("                                        #else " ).append("\n"); 
		query.append("                                           '$waive_off_cd_p' " ).append("\n"); 
		query.append("                                        #end " ).append("\n"); 
		query.append("                                    #end" ).append("\n"); 
		query.append("                                )" ).append("\n"); 
		query.append("          AND @[reqapp] = 'A'" ).append("\n"); 
		query.append("          AND @[ofc_flg2] = 'O'" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("            UNION ALL" ).append("\n"); 
		query.append("--  AND :reqapp ='A'" ).append("\n"); 
		query.append("--  AND :ofc_flg2='R'    " ).append("\n"); 
		query.append("            SELECT DISTINCT PROP_NO," ).append("\n"); 
		query.append("              RFA_EXPT_DAR_NO," ).append("\n"); 
		query.append("              --RQST_OFC_CD PROG_OFC_CD" ).append("\n"); 
		query.append("              DECODE(@[reqapp], 'R', RQST_OFC_CD, APRO_OFC_CD)  PROG_OFC_CD" ).append("\n"); 
		query.append("            FROM DMT_RFA_EXPT_TRF" ).append("\n"); 
		query.append("            WHERE 1 = 1" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if ( ${ofc_cd2} != '' )" ).append("\n"); 
		query.append("          AND @[reqapp] = 'A'" ).append("\n"); 
		query.append("          AND @[ofc_flg2] = 'R'" ).append("\n"); 
		query.append("          AND @[ofc_cd2] <> 'All'" ).append("\n"); 
		query.append("          AND APRO_OFC_CD IN (" ).append("\n"); 
		query.append("            SELECT OFC_CD" ).append("\n"); 
		query.append("            FROM MDM_ORGANIZATION START WITH OFC_CD IN (" ).append("\n"); 
		query.append("                                                            #foreach( $waive_off_cd_p in ${tempWaiveOFFList}) " ).append("\n"); 
		query.append("                                                                #if($velocityCount < $tempWaiveOFFList.size()) " ).append("\n"); 
		query.append("                                                                   '$waive_off_cd_p', " ).append("\n"); 
		query.append("                                                                #else " ).append("\n"); 
		query.append("                                                                   '$waive_off_cd_p' " ).append("\n"); 
		query.append("                                                                #end " ).append("\n"); 
		query.append("                                                            #end" ).append("\n"); 
		query.append("                                                       ) CONNECT BY NOCYCLE PRIOR OFC_CD = PRNT_OFC_CD)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append(") RFA_EXP , PRI_RP_HDR RFH, PRI_RP_MN RFA" ).append("\n"); 
		query.append("                 WHERE RFA_EXP.PROP_NO  = RFH.PROP_NO" ).append("\n"); 
		query.append("                   AND RFH.PROP_NO      = RFA.PROP_NO" ).append("\n"); 
		query.append("               )   REQ_APP" ).append("\n"); 
		query.append("         WHERE AMDT_SEQ_FILTER = 1" ).append("\n"); 
		query.append("           AND DC.TO_MVMT_DT BETWEEN TO_DATE (REPLACE (@[start_dt], '-', ''), 'YYYYMMDD') + .0" ).append("\n"); 
		query.append("                                       AND TO_DATE (REPLACE (@[end_dt], '-', ''), 'YYYYMMDD')" ).append("\n"); 
		query.append("                                           + .99999" ).append("\n"); 
		query.append("--           AND DC.DMDT_TRF_CD IN ('DMIF', 'DTIC', 'DMOF', 'DTOC', 'CTIC', 'CTOC')" ).append("\n"); 
		query.append("    	   AND DC.DMDT_TRF_CD	IN	(" ).append("\n"); 
		query.append("    					#foreach( $trf_cd in ${tempDMTTRFList} )" ).append("\n"); 
		query.append("    						#if($velocityCount < $tempDMTTRFList.size()) '$trf_cd', #else '$trf_cd' #end" ).append("\n"); 
		query.append("    					#end" ).append("\n"); 
		query.append("    					)" ).append("\n"); 
		query.append("               AND DC.DMDT_CHG_STS_CD IN ('F', 'C', 'I', 'N')" ).append("\n"); 
		query.append("        	#if (${ofc_flg} == 'O')" ).append("\n"); 
		query.append("        		AND	DC.OFC_CD	IN (" ).append("\n"); 
		query.append("        			#foreach( $an_ofc in ${tempDEMDETOFFList} )" ).append("\n"); 
		query.append("        				#if($velocityCount < $tempDEMDETOFFList.size()) '$an_ofc', #else '$an_ofc' #end" ).append("\n"); 
		query.append("        			#end" ).append("\n"); 
		query.append("        			)" ).append("\n"); 
		query.append("        	#elseif (${ofc_flg} == 'R' && ${ofc_cd} != 'All')" ).append("\n"); 
		query.append("        		AND	DECODE(DC.OFC_RHQ_CD, 'NYCHQ', 'NYCRA', DC.OFC_RHQ_CD) = @[ofc_cd]" ).append("\n"); 
		query.append("        	#end" ).append("\n"); 
		query.append("			AND (DC.SC_RFA_EXPT_AMT > 0  OR DC.AFT_EXPT_DC_AMT > 0)" ).append("\n"); 
		query.append("			AND DC.RFA_EXPT_DAR_NO   =  REQ_APP.RFA_EXPT_DAR_NO" ).append("\n"); 
		query.append("--           AND DC.SYS_AREA_GRP_ID =" ).append("\n"); 
		query.append("--                (SELECT SYS_AREA_GRP_ID" ).append("\n"); 
		query.append("--                   FROM COM_SYS_AREA_GRP_ID S, MDM_ORGANIZATION M" ).append("\n"); 
		query.append("--                  WHERE CNT_CD = SUBSTR (LOC_CD, 1, 2)" ).append("\n"); 
		query.append("--                    AND CO_IND_CD = 'H'" ).append("\n"); 
		query.append("--                    AND M.OFC_CD = DC.OFC_CD)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("			AND DC.DMDT_CHG_LOC_DIV_CD <> 'SZP'	-- 2010/03/19 추가" ).append("\n"); 
		query.append("			AND	-- 2010/03/25 추가" ).append("\n"); 
		query.append("			(" ).append("\n"); 
		query.append("			    (DC.DUL_TP_EXPT_FLG = 'Y' AND SUBSTR(DC.DMDT_TRF_CD, 1, 1) = 'C')" ).append("\n"); 
		query.append("			    OR        " ).append("\n"); 
		query.append("			    (DC.DUL_TP_EXPT_FLG = 'N')" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    UNION ALL" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        SELECT /*+ INDEX(DC XAK16DMT_CHG_CALC) */" ).append("\n"); 
		query.append("                AFT_BKG#.SC_NO," ).append("\n"); 
		query.append("                AFT_BKG#.RFA_NO," ).append("\n"); 
		query.append("                SC.PROP_NO," ).append("\n"); 
		query.append("                CUST.CUST_CNT_CD    CUST_CNT_CD," ).append("\n"); 
		query.append("                CUST.CUST_SEQ       CUST_SEQ," ).append("\n"); 
		query.append("                AFT_BKG#.PROG_OFC_CD     PROG_OFC_CD," ).append("\n"); 
		query.append("                DC.SYS_AREA_GRP_ID, DC.CNTR_NO, DC.CNTR_CYC_NO, DC.DMDT_TRF_CD," ).append("\n"); 
		query.append("                DC.BZC_TRF_CURR_CD, DC.ORG_CHG_AMT, DC.CMDT_EXPT_AMT, " ).append("\n"); 
		query.append("-- DC.SC_RFA_EXPT_AMT, " ).append("\n"); 
		query.append("          CASE" ).append("\n"); 
		query.append("            WHEN DC.SC_RFA_EXPT_AMT > 0 AND DC.SC_NO IS NOT NULL THEN " ).append("\n"); 
		query.append("            (" ).append("\n"); 
		query.append("                SELECT  DC.SC_RFA_EXPT_AMT" ).append("\n"); 
		query.append("                FROM    DMT_SC_EXPT_VER_PROG" ).append("\n"); 
		query.append("                        ,PRI_SP_HDR         P" ).append("\n"); 
		query.append("                WHERE 1=1" ).append("\n"); 
		query.append("#if ( ${ofc_cd2} != '' )" ).append("\n"); 
		query.append("                                   AND (" ).append("\n"); 
		query.append("                                        (" ).append("\n"); 
		query.append("                                            @[ofc_flg2]   =   'O'" ).append("\n"); 
		query.append("                                            AND" ).append("\n"); 
		query.append("                                            PROG_OFC_CD IN (" ).append("\n"); 
		query.append("                                                #foreach( $waive_off_cd_p in ${tempWaiveOFFList}) " ).append("\n"); 
		query.append("                                                    #if($velocityCount < $tempWaiveOFFList.size()) " ).append("\n"); 
		query.append("                                                       '$waive_off_cd_p', " ).append("\n"); 
		query.append("                                                    #else " ).append("\n"); 
		query.append("                                                       '$waive_off_cd_p' " ).append("\n"); 
		query.append("                                                    #end " ).append("\n"); 
		query.append("                                                #end" ).append("\n"); 
		query.append("                                            )" ).append("\n"); 
		query.append("                                        )" ).append("\n"); 
		query.append("                                   OR   (" ).append("\n"); 
		query.append("                                            @[ofc_flg2]   =   'R'" ).append("\n"); 
		query.append("                                            AND" ).append("\n"); 
		query.append("                                            @[ofc_cd2] <> 'All'" ).append("\n"); 
		query.append("                                            AND" ).append("\n"); 
		query.append("                                            PROG_OFC_CD   IN  (" ).append("\n"); 
		query.append("                                                                SELECT OFC_CD" ).append("\n"); 
		query.append("                                                                FROM   MDM_ORGANIZATION" ).append("\n"); 
		query.append("                                                                START WITH OFC_CD IN (" ).append("\n"); 
		query.append("                                                                    #foreach( $waive_off_cd_p in ${tempWaiveOFFList}) " ).append("\n"); 
		query.append("                                                                        #if($velocityCount < $tempWaiveOFFList.size()) " ).append("\n"); 
		query.append("                                                                           '$waive_off_cd_p', " ).append("\n"); 
		query.append("                                                                        #else " ).append("\n"); 
		query.append("                                                                           '$waive_off_cd_p' " ).append("\n"); 
		query.append("                                                                        #end " ).append("\n"); 
		query.append("                                                                    #end" ).append("\n"); 
		query.append("                                                                )" ).append("\n"); 
		query.append("                                                                CONNECT BY NOCYCLE PRIOR OFC_CD = PRNT_OFC_CD" ).append("\n"); 
		query.append("                                                            )" ).append("\n"); 
		query.append("                                        )" ).append("\n"); 
		query.append("                                       )" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                                   AND DMDT_EXPT_VER_STS_CD = DECODE(@[reqapp], 'R', 'R', 'A', 'L')" ).append("\n"); 
		query.append("                  and P.SC_NO         =   DC.SC_NO" ).append("\n"); 
		query.append("                  AND DMT_SC_EXPT_VER_PROG.PROP_NO = P.PROP_NO" ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("            WHEN  DC.SC_RFA_EXPT_AMT > 0 AND DC.RFA_EXPT_DAR_NO IS NOT NULL THEN " ).append("\n"); 
		query.append("            (" ).append("\n"); 
		query.append("                SELECT  DC.SC_RFA_EXPT_AMT" ).append("\n"); 
		query.append("                  FROM  DMT_RFA_EXPT_TRF" ).append("\n"); 
		query.append("                         WHERE (" ).append("\n"); 
		query.append("                                (" ).append("\n"); 
		query.append("                                    @[ofc_flg2]   =   'O'" ).append("\n"); 
		query.append("                                    AND" ).append("\n"); 
		query.append("                                    DECODE(@[reqapp], 'R', RQST_OFC_CD, APRO_OFC_CD) IN (" ).append("\n"); 
		query.append("                                                #foreach( $waive_off_cd_p in ${tempWaiveOFFList}) " ).append("\n"); 
		query.append("                                                    #if($velocityCount < $tempWaiveOFFList.size()) " ).append("\n"); 
		query.append("                                                       '$waive_off_cd_p', " ).append("\n"); 
		query.append("                                                    #else " ).append("\n"); 
		query.append("                                                       '$waive_off_cd_p' " ).append("\n"); 
		query.append("                                                    #end " ).append("\n"); 
		query.append("                                                #end" ).append("\n"); 
		query.append("                                            )" ).append("\n"); 
		query.append("                                )" ).append("\n"); 
		query.append("                          OR   (" ).append("\n"); 
		query.append("                                    @[ofc_flg2]   =   'R'" ).append("\n"); 
		query.append("                                    AND" ).append("\n"); 
		query.append("                                    @[ofc_cd2] <> 'A'" ).append("\n"); 
		query.append("                                    AND" ).append("\n"); 
		query.append("                                    DECODE(@[reqapp], 'R', RQST_OFC_CD, APRO_OFC_CD)   IN  (" ).append("\n"); 
		query.append("                                                        SELECT OFC_CD" ).append("\n"); 
		query.append("                                                        FROM   MDM_ORGANIZATION" ).append("\n"); 
		query.append("                                                        START WITH OFC_CD IN (" ).append("\n"); 
		query.append("                                                            #foreach( $waive_off_cd_p in ${tempWaiveOFFList}) " ).append("\n"); 
		query.append("                                                                #if($velocityCount < $tempWaiveOFFList.size()) " ).append("\n"); 
		query.append("                                                                   '$waive_off_cd_p', " ).append("\n"); 
		query.append("                                                                #else " ).append("\n"); 
		query.append("                                                                   '$waive_off_cd_p' " ).append("\n"); 
		query.append("                                                                #end " ).append("\n"); 
		query.append("                                                            #end" ).append("\n"); 
		query.append("                                                        )" ).append("\n"); 
		query.append("                                                        CONNECT BY NOCYCLE PRIOR OFC_CD = PRNT_OFC_CD" ).append("\n"); 
		query.append("                                                    )" ).append("\n"); 
		query.append("                                )" ).append("\n"); 
		query.append("                               )" ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("            WHEN DC.SC_RFA_EXPT_AMT = 0 THEN 0" ).append("\n"); 
		query.append("          END AS SC_RFA_EXPT_AMT ," ).append("\n"); 
		query.append("DC.AFT_EXPT_DC_AMT, DC.TO_MVMT_DT" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("          FROM  DMT_CHG_CALC        DC," ).append("\n"); 
		query.append("                AFT_BKG#," ).append("\n"); 
		query.append("                PRI_SP_CTRT_PTY CUST," ).append("\n"); 
		query.append("                PRI_SP_HDR       SCH," ).append("\n"); 
		query.append("                PRI_SP_MN        SC" ).append("\n"); 
		query.append("         WHERE DC.SYS_AREA_GRP_ID   = AFT_BKG#.SYS_AREA_GRP_ID" ).append("\n"); 
		query.append("           AND DC.CNTR_NO           = AFT_BKG#.CNTR_NO" ).append("\n"); 
		query.append("           AND DC.CNTR_CYC_NO       = AFT_BKG#.CNTR_CYC_NO" ).append("\n"); 
		query.append("           AND SC.PROP_NO  = CUST.PROP_NO" ).append("\n"); 
		query.append("           AND SC.AMDT_SEQ = CUST.AMDT_SEQ" ).append("\n"); 
		query.append("           AND CUST.PRC_CTRT_PTY_TP_CD = 'C'" ).append("\n"); 
		query.append("           AND DC.TO_MVMT_DT BETWEEN TO_DATE (REPLACE (@[start_dt], '-', ''), 'YYYYMMDD') + .0" ).append("\n"); 
		query.append("                                       AND TO_DATE (REPLACE (@[end_dt], '-', ''), 'YYYYMMDD')" ).append("\n"); 
		query.append("                                           + .99999" ).append("\n"); 
		query.append("           AND DC.DMDT_TRF_CD       = AFT_BKG#.DMDT_TRF_CD" ).append("\n"); 
		query.append("           AND SCH.PROP_NO          = SC.PROP_NO" ).append("\n"); 
		query.append("           AND SCH.SC_NO            = AFT_BKG#.SC_NO" ).append("\n"); 
		query.append("           AND SC.AMDT_SEQ          = (" ).append("\n"); 
		query.append("                                         SELECT MAX(AMDT_SEQ)" ).append("\n"); 
		query.append("                                         FROM   PRI_SP_MN" ).append("\n"); 
		query.append("                                         WHERE  PRI_SP_MN.PROP_NO          = SCH.PROP_NO" ).append("\n"); 
		query.append("                                      )" ).append("\n"); 
		query.append("           AND AFT_BKG#.CTRT_TP     = 'S'" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("--           AND DC.DMDT_TRF_CD IN ('DMIF', 'DTIC', 'DMOF', 'DTOC', 'CTIC', 'CTOC')" ).append("\n"); 
		query.append("            AND DC.DMDT_TRF_CD IN (" ).append("\n"); 
		query.append("             #foreach( $trf_cd in ${tempDMTTRFList} )" ).append("\n"); 
		query.append("              #if($velocityCount < $tempDMTTRFList.size()) '$trf_cd', #else '$trf_cd' #end" ).append("\n"); 
		query.append("             #end" ).append("\n"); 
		query.append("             )" ).append("\n"); 
		query.append("                   AND DC.DMDT_CHG_STS_CD IN ('F', 'C', 'I', 'N')" ).append("\n"); 
		query.append("             #if (${ofc_flg} == 'O')" ).append("\n"); 
		query.append("              AND DC.OFC_CD IN (" ).append("\n"); 
		query.append("               #foreach( $an_ofc in ${tempDEMDETOFFList} )" ).append("\n"); 
		query.append("                #if($velocityCount < $tempDEMDETOFFList.size()) '$an_ofc', #else '$an_ofc' #end" ).append("\n"); 
		query.append("               #end" ).append("\n"); 
		query.append("               )" ).append("\n"); 
		query.append("             #elseif (${ofc_flg} == 'R' && ${ofc_cd} != 'All')" ).append("\n"); 
		query.append("              AND DECODE(DC.OFC_RHQ_CD, 'NYCHQ', 'NYCRA', DC.OFC_RHQ_CD) = @[ofc_cd]" ).append("\n"); 
		query.append("             #end" ).append("\n"); 
		query.append("			AND DC.AFT_EXPT_DAR_NO   =  AFT_BKG#.AFT_EXPT_DAR_NO" ).append("\n"); 
		query.append("			AND (DC.SC_RFA_EXPT_AMT > 0  OR DC.AFT_EXPT_DC_AMT > 0)" ).append("\n"); 
		query.append("--           AND DC.SYS_AREA_GRP_ID =" ).append("\n"); 
		query.append("--                (SELECT SYS_AREA_GRP_ID" ).append("\n"); 
		query.append("--                   FROM COM_SYS_AREA_GRP_ID S, MDM_ORGANIZATION M" ).append("\n"); 
		query.append("--                  WHERE CNT_CD = SUBSTR (LOC_CD, 1, 2)" ).append("\n"); 
		query.append("--                    AND CO_IND_CD = 'H'" ).append("\n"); 
		query.append("--                    AND M.OFC_CD = DC.OFC_CD)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("			AND DC.DMDT_CHG_LOC_DIV_CD <> 'SZP'	-- 2010/03/19 추가" ).append("\n"); 
		query.append("			AND	-- 2010/03/25 추가" ).append("\n"); 
		query.append("			(" ).append("\n"); 
		query.append("			    (DC.DUL_TP_EXPT_FLG = 'Y' AND SUBSTR(DC.DMDT_TRF_CD, 1, 1) = 'C')" ).append("\n"); 
		query.append("			    OR        " ).append("\n"); 
		query.append("			    (DC.DUL_TP_EXPT_FLG = 'N')" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    UNION ALL" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        SELECT /*+ INDEX(DC XAK16DMT_CHG_CALC) */" ).append("\n"); 
		query.append("                AFT_BKG#.SC_NO," ).append("\n"); 
		query.append("                AFT_BKG#.RFA_NO," ).append("\n"); 
		query.append("                RFA.PROP_NO," ).append("\n"); 
		query.append("                RFA.CTRT_CUST_CNT_CD    CUST_CNT_CD," ).append("\n"); 
		query.append("                RFA.CTRT_CUST_SEQ       CUST_SEQ," ).append("\n"); 
		query.append("                AFT_BKG#.PROG_OFC_CD     PROG_OFC_CD," ).append("\n"); 
		query.append("                DC.SYS_AREA_GRP_ID, DC.CNTR_NO, DC.CNTR_CYC_NO, DC.DMDT_TRF_CD," ).append("\n"); 
		query.append("                DC.BZC_TRF_CURR_CD, DC.ORG_CHG_AMT, DC.CMDT_EXPT_AMT, " ).append("\n"); 
		query.append("-- DC.SC_RFA_EXPT_AMT, " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("-- //////////////////////////////// DAT_W030_튜닝요청및가이드(DMT)_20100106_10.doc 데이터확인 필요한 부분 시작" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("          CASE" ).append("\n"); 
		query.append("            WHEN DC.SC_RFA_EXPT_AMT > 0 AND DC.SC_NO IS NOT NULL THEN " ).append("\n"); 
		query.append("            (" ).append("\n"); 
		query.append("                SELECT  DC.SC_RFA_EXPT_AMT" ).append("\n"); 
		query.append("                FROM    DMT_SC_EXPT_VER_PROG" ).append("\n"); 
		query.append("                        ,PRI_SP_HDR         P" ).append("\n"); 
		query.append("                WHERE 1=1" ).append("\n"); 
		query.append("#if ( ${ofc_cd2} != '' )" ).append("\n"); 
		query.append("                                   AND (" ).append("\n"); 
		query.append("                                        (" ).append("\n"); 
		query.append("                                            @[ofc_flg2]   =   'O'" ).append("\n"); 
		query.append("                                            AND" ).append("\n"); 
		query.append("                                            PROG_OFC_CD IN (" ).append("\n"); 
		query.append("                                                #foreach( $waive_off_cd_p in ${tempWaiveOFFList}) " ).append("\n"); 
		query.append("                                                    #if($velocityCount < $tempWaiveOFFList.size()) " ).append("\n"); 
		query.append("                                                       '$waive_off_cd_p', " ).append("\n"); 
		query.append("                                                    #else " ).append("\n"); 
		query.append("                                                       '$waive_off_cd_p' " ).append("\n"); 
		query.append("                                                    #end " ).append("\n"); 
		query.append("                                                #end" ).append("\n"); 
		query.append("                                            )" ).append("\n"); 
		query.append("                                        )" ).append("\n"); 
		query.append("                                   OR   (" ).append("\n"); 
		query.append("                                            @[ofc_flg2]   =   'R'" ).append("\n"); 
		query.append("                                            AND" ).append("\n"); 
		query.append("                                            @[ofc_cd2] <> 'All'" ).append("\n"); 
		query.append("                                            AND" ).append("\n"); 
		query.append("                                            PROG_OFC_CD   IN  (" ).append("\n"); 
		query.append("                                                                SELECT OFC_CD" ).append("\n"); 
		query.append("                                                                FROM   MDM_ORGANIZATION" ).append("\n"); 
		query.append("                                                                START WITH OFC_CD IN (" ).append("\n"); 
		query.append("                                                                    #foreach( $waive_off_cd_p in ${tempWaiveOFFList}) " ).append("\n"); 
		query.append("                                                                        #if($velocityCount < $tempWaiveOFFList.size()) " ).append("\n"); 
		query.append("                                                                           '$waive_off_cd_p', " ).append("\n"); 
		query.append("                                                                        #else " ).append("\n"); 
		query.append("                                                                           '$waive_off_cd_p' " ).append("\n"); 
		query.append("                                                                        #end " ).append("\n"); 
		query.append("                                                                    #end" ).append("\n"); 
		query.append("                                                                )" ).append("\n"); 
		query.append("                                                                CONNECT BY NOCYCLE PRIOR OFC_CD = PRNT_OFC_CD" ).append("\n"); 
		query.append("                                                            )" ).append("\n"); 
		query.append("                                        )" ).append("\n"); 
		query.append("                                       )" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                                   AND DMDT_EXPT_VER_STS_CD = DECODE(@[reqapp], 'R', 'R', 'A', 'L')" ).append("\n"); 
		query.append("                  and P.SC_NO         =   DC.SC_NO" ).append("\n"); 
		query.append("                  AND DMT_SC_EXPT_VER_PROG.PROP_NO = P.PROP_NO" ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("            WHEN  DC.SC_RFA_EXPT_AMT > 0 AND DC.RFA_EXPT_DAR_NO IS NOT NULL THEN " ).append("\n"); 
		query.append("            (" ).append("\n"); 
		query.append("                SELECT  DC.SC_RFA_EXPT_AMT" ).append("\n"); 
		query.append("                  FROM  DMT_RFA_EXPT_TRF" ).append("\n"); 
		query.append("                 WHERE  (" ).append("\n"); 
		query.append("                                (" ).append("\n"); 
		query.append("                                    @[ofc_flg2]   =   'O'" ).append("\n"); 
		query.append("                                    AND" ).append("\n"); 
		query.append("                                    DECODE(@[reqapp], 'R', RQST_OFC_CD, APRO_OFC_CD) IN (" ).append("\n"); 
		query.append("                                                #foreach( $waive_off_cd_p in ${tempWaiveOFFList}) " ).append("\n"); 
		query.append("                                                    #if($velocityCount < $tempWaiveOFFList.size()) " ).append("\n"); 
		query.append("                                                       '$waive_off_cd_p', " ).append("\n"); 
		query.append("                                                    #else " ).append("\n"); 
		query.append("                                                       '$waive_off_cd_p' " ).append("\n"); 
		query.append("                                                    #end " ).append("\n"); 
		query.append("                                                #end" ).append("\n"); 
		query.append("                                            )" ).append("\n"); 
		query.append("                                )" ).append("\n"); 
		query.append("                          OR   (" ).append("\n"); 
		query.append("                                    @[ofc_flg2]   =   'R'" ).append("\n"); 
		query.append("                                    AND" ).append("\n"); 
		query.append("                                    @[ofc_cd2] <> 'A'" ).append("\n"); 
		query.append("                                    AND" ).append("\n"); 
		query.append("                                    DECODE(@[reqapp], 'R', RQST_OFC_CD, APRO_OFC_CD)   IN  (" ).append("\n"); 
		query.append("                                                        SELECT OFC_CD" ).append("\n"); 
		query.append("                                                        FROM   MDM_ORGANIZATION" ).append("\n"); 
		query.append("                                                        START WITH OFC_CD IN (" ).append("\n"); 
		query.append("                                                            #foreach( $waive_off_cd_p in ${tempWaiveOFFList}) " ).append("\n"); 
		query.append("                                                                #if($velocityCount < $tempWaiveOFFList.size()) " ).append("\n"); 
		query.append("                                                                   '$waive_off_cd_p', " ).append("\n"); 
		query.append("                                                                #else " ).append("\n"); 
		query.append("                                                                   '$waive_off_cd_p' " ).append("\n"); 
		query.append("                                                                #end " ).append("\n"); 
		query.append("                                                            #end" ).append("\n"); 
		query.append("                                                        )" ).append("\n"); 
		query.append("                                                        CONNECT BY NOCYCLE PRIOR OFC_CD = PRNT_OFC_CD" ).append("\n"); 
		query.append("                                                    )" ).append("\n"); 
		query.append("                                )" ).append("\n"); 
		query.append("                        )" ).append("\n"); 
		query.append("				AND DC.RFA_EXPT_DAR_NO = RFA_EXPT_DAR_NO   -- 20100122 추가 필요" ).append("\n"); 
		query.append("				AND DMDT_EXPT_RQST_STS_CD = 'A'	-- 20110414 [CHM-201110144-01]" ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("            WHEN DC.SC_RFA_EXPT_AMT = 0 THEN 0" ).append("\n"); 
		query.append("          END AS SC_RFA_EXPT_AMT ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("-- //////////////////////////////// DAT_W030_튜닝요청및가이드(DMT)_20100106_10.doc 데이터확인 필요한 부분 끝" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("DC.AFT_EXPT_DC_AMT, DC.TO_MVMT_DT" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("          FROM  DMT_CHG_CALC        DC," ).append("\n"); 
		query.append("                AFT_BKG#," ).append("\n"); 
		query.append("                PRI_RP_HDR       RFH," ).append("\n"); 
		query.append("                PRI_RP_MN        RFA" ).append("\n"); 
		query.append("         WHERE DC.SYS_AREA_GRP_ID   = AFT_BKG#.SYS_AREA_GRP_ID" ).append("\n"); 
		query.append("           AND DC.CNTR_NO           = AFT_BKG#.CNTR_NO" ).append("\n"); 
		query.append("           AND DC.CNTR_CYC_NO       = AFT_BKG#.CNTR_CYC_NO" ).append("\n"); 
		query.append("           AND DC.TO_MVMT_DT BETWEEN TO_DATE (REPLACE (@[start_dt], '-', ''), 'YYYYMMDD') + .0" ).append("\n"); 
		query.append("                                       AND TO_DATE (REPLACE (@[end_dt], '-', ''), 'YYYYMMDD')" ).append("\n"); 
		query.append("                                           + .99999" ).append("\n"); 
		query.append("           AND DC.DMDT_TRF_CD       = AFT_BKG#.DMDT_TRF_CD" ).append("\n"); 
		query.append("           AND RFH.PROP_NO          = RFA.PROP_NO" ).append("\n"); 
		query.append("           AND RFH.RFA_NO            = AFT_BKG#.RFA_NO" ).append("\n"); 
		query.append("           AND RFA.AMDT_SEQ          = (" ).append("\n"); 
		query.append("                                         SELECT MAX(AMDT_SEQ)" ).append("\n"); 
		query.append("                                         FROM   PRI_RP_MN" ).append("\n"); 
		query.append("                                         WHERE  PRI_RP_MN.PROP_NO          = RFH.PROP_NO" ).append("\n"); 
		query.append("                                      )" ).append("\n"); 
		query.append("           AND AFT_BKG#.CTRT_TP     = 'R'" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("--           AND DC.DMDT_TRF_CD IN ('DMIF', 'DTIC', 'DMOF', 'DTOC', 'CTIC', 'CTOC')" ).append("\n"); 
		query.append("            AND DC.DMDT_TRF_CD IN (" ).append("\n"); 
		query.append("             #foreach( $trf_cd in ${tempDMTTRFList} )" ).append("\n"); 
		query.append("              #if($velocityCount < $tempDMTTRFList.size()) '$trf_cd', #else '$trf_cd' #end" ).append("\n"); 
		query.append("             #end" ).append("\n"); 
		query.append("             )" ).append("\n"); 
		query.append("                   AND DC.DMDT_CHG_STS_CD IN ('F', 'C', 'I', 'N')" ).append("\n"); 
		query.append("             #if (${ofc_flg} == 'O')" ).append("\n"); 
		query.append("              AND DC.OFC_CD IN (" ).append("\n"); 
		query.append("               #foreach( $an_ofc in ${tempDEMDETOFFList} )" ).append("\n"); 
		query.append("                #if($velocityCount < $tempDEMDETOFFList.size()) '$an_ofc', #else '$an_ofc' #end" ).append("\n"); 
		query.append("               #end" ).append("\n"); 
		query.append("               )" ).append("\n"); 
		query.append("             #elseif (${ofc_flg} == 'R' && ${ofc_cd} != 'All')" ).append("\n"); 
		query.append("              AND DECODE(DC.OFC_RHQ_CD, 'NYCHQ', 'NYCRA', DC.OFC_RHQ_CD) = @[ofc_cd]" ).append("\n"); 
		query.append("             #end" ).append("\n"); 
		query.append("			AND DC.AFT_EXPT_DAR_NO   =  AFT_BKG#.AFT_EXPT_DAR_NO" ).append("\n"); 
		query.append("			AND (DC.SC_RFA_EXPT_AMT > 0  OR DC.AFT_EXPT_DC_AMT > 0)" ).append("\n"); 
		query.append("--           AND DC.SYS_AREA_GRP_ID =" ).append("\n"); 
		query.append("--                (SELECT SYS_AREA_GRP_ID" ).append("\n"); 
		query.append("--                   FROM COM_SYS_AREA_GRP_ID S, MDM_ORGANIZATION M" ).append("\n"); 
		query.append("--                  WHERE CNT_CD = SUBSTR (LOC_CD, 1, 2)" ).append("\n"); 
		query.append("--                    AND CO_IND_CD = 'H'" ).append("\n"); 
		query.append("--                    AND M.OFC_CD = DC.OFC_CD)" ).append("\n"); 
		query.append("			AND DC.DMDT_CHG_LOC_DIV_CD <> 'SZP'	-- 2010/03/19 추가" ).append("\n"); 
		query.append("			AND	-- 2010/03/25 추가" ).append("\n"); 
		query.append("			(" ).append("\n"); 
		query.append("			    (DC.DUL_TP_EXPT_FLG = 'Y' AND SUBSTR(DC.DMDT_TRF_CD, 1, 1) = 'C')" ).append("\n"); 
		query.append("			    OR        " ).append("\n"); 
		query.append("			    (DC.DUL_TP_EXPT_FLG = 'N')" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("        )   X," ).append("\n"); 
		query.append("        GL_MON_XCH_RT		F," ).append("\n"); 
		query.append("		DMT_CHG_BKG_CNTR    DB," ).append("\n"); 
		query.append("        (" ).append("\n"); 
		query.append("           SELECT   OFC_N3RD_LVL_CD ," ).append("\n"); 
		query.append("                    OFC_N8TH_LVL_CD" ).append("\n"); 
		query.append("           FROM     DMT_OFC_LVL_V" ).append("\n"); 
		query.append("        )   OV" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("WHERE   F.ACCT_XCH_RT_YRMON	=	TO_CHAR(X.TO_MVMT_DT,'YYYYMM')" ).append("\n"); 
		query.append("AND		F.ACCT_XCH_RT_LVL	=	'1'" ).append("\n"); 
		query.append("AND		F.CURR_CD          	=	X.BZC_TRF_CURR_CD" ).append("\n"); 
		query.append("AND     X.PROG_OFC_CD       =   OV.OFC_N8TH_LVL_CD" ).append("\n"); 
		query.append("AND     (X.SC_RFA_EXPT_AMT  >   0   OR  X.AFT_EXPT_DC_AMT > 0)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("AND     X.SYS_AREA_GRP_ID   =   DB.SYS_AREA_GRP_ID" ).append("\n"); 
		query.append("AND     X.CNTR_NO           =   DB.CNTR_NO" ).append("\n"); 
		query.append("AND     X.CNTR_CYC_NO       =   DB.CNTR_CYC_NO" ).append("\n"); 
		query.append("AND     DB.DMDT_CNTR_TP_CD  IN" ).append("\n"); 
		query.append("    (" ).append("\n"); 
		query.append("     SELECT 'D' FROM DUAL WHERE DECODE(@[dmdt_cntr_tp_cd], 'A', 'Y', 'D', 'Y', 'N') = 'Y'" ).append("\n"); 
		query.append("     UNION ALL" ).append("\n"); 
		query.append("     SELECT 'R' FROM DUAL WHERE DECODE(@[dmdt_cntr_tp_cd], 'A', 'Y', 'R', 'Y', 'N') = 'Y'" ).append("\n"); 
		query.append("     UNION ALL" ).append("\n"); 
		query.append("     SELECT 'F' FROM DUAL WHERE DECODE(@[dmdt_cntr_tp_cd], 'A', 'Y', 'S', 'Y', 'N') = 'Y'" ).append("\n"); 
		query.append("     UNION ALL" ).append("\n"); 
		query.append("     SELECT 'O' FROM DUAL WHERE DECODE(@[dmdt_cntr_tp_cd], 'A', 'Y', 'S', 'Y', 'N') = 'Y'" ).append("\n"); 
		query.append("     UNION ALL" ).append("\n"); 
		query.append("     SELECT 'T' FROM DUAL WHERE DECODE(@[dmdt_cntr_tp_cd], 'A', 'Y', 'S', 'Y', 'N') = 'Y'" ).append("\n"); 
		query.append("     UNION ALL" ).append("\n"); 
		query.append("     SELECT 'P' FROM DUAL WHERE DECODE(@[dmdt_cntr_tp_cd], 'A', 'Y', 'S', 'Y', 'N') = 'Y'" ).append("\n"); 
		query.append("     UNION ALL                  /* Sliding Open Top, Adjustable Flatrack 추가 - #add 2008.10.09 */" ).append("\n"); 
		query.append("     SELECT 'S' FROM DUAL WHERE DECODE(@[dmdt_cntr_tp_cd], 'A', 'Y', 'S', 'Y', 'N') = 'Y'" ).append("\n"); 
		query.append("     UNION ALL" ).append("\n"); 
		query.append("     SELECT 'A' FROM DUAL WHERE DECODE(@[dmdt_cntr_tp_cd], 'A', 'Y', 'S', 'Y', 'N') = 'Y'" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("GROUP BY DECODE(@[grp_flg], 'O', X.PROG_OFC_CD, 'R', OV.OFC_N3RD_LVL_CD)," ).append("\n"); 
		query.append("        X.DMDT_TRF_CD," ).append("\n"); 
		query.append("        X.SC_NO," ).append("\n"); 
		query.append("        X.RFA_NO," ).append("\n"); 
		query.append("        X.CUST_CNT_CD||X.CUST_SEQ," ).append("\n"); 
		query.append("        X.BZC_TRF_CURR_CD, X.CUST_CNT_CD, X.CUST_SEQ" ).append("\n"); 

	}
}