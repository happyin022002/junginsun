<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DisposalMgtDBDAOsearchDisposalSoldDTLByBuyerDataRSQL">
			<desc><![CDATA[searchDisposalSoldDTLByBuyerData]]></desc>
			<sql><![CDATA[
WITH LCC_LIST AS (
  SELECT MY.YD_CD,
    ML.LOC_CD,
    ME.LCC_CD
  FROM MDM_YARD MY,
    MDM_LOCATION ML,
    MDM_EQ_ORZ_CHT ME
  WHERE MY.LOC_CD = ML.LOC_CD
    AND ML.SCC_CD = ME.SCC_CD
    AND NVL(MY.DELT_FLG, 'N') = 'N'
)

SELECT A.DISP_TP_CD
     , (SELECT MNR_CD_DP_DESC FROM MNR_GEN_CD WHERE PRNT_CD_ID = 'CD00035' AND MNR_CD_ID = A.DISP_TP_CD )  AS DISP_TP_NM
     , B.EQ_NO
     , B.EQ_TPSZ_CD
     , A.CURR_CD
     , B.PART_AMT
     , B.DISP_RLSE_NO
     , TO_CHAR(B.DISP_SOLD_DT,'YYYY-MM-DD') DISP_SOLD_DT
	 , TO_CHAR(B.DISP_SOLD_DT,'YYYY-MM-DD') OLD_SOLD_DT
     , B.DISP_YD_CD
     , CASE
         WHEN A.EQ_KND_CD = 'U' 
         THEN 
			 DECODE((SELECT LCC_LIST.LCC_CD FROM LCC_LIST WHERE LCC_LIST.YD_CD = B.DISP_YD_CD),
                     C.LCC_CD, 'SAME LCC', 'NOT SAME')
         ELSE
	         DECODE((SELECT LCC_LIST.LCC_CD FROM LCC_LIST WHERE LCC_LIST.YD_CD = B.DISP_YD_CD),
    	            (SELECT LCC_LIST.LCC_CD FROM LCC_LIST WHERE LCC_LIST.YD_CD = D.CRNT_YD_CD), 'SAME LCC', 'NOT SAME')
       END LCC_DIFF_FLG
     , B.MNR_DISP_DTL_RMK
     , B.DISP_NO
     , B.DISP_QTY
     , B.DISP_DTL_SEQ
     , B.DISP_UT_TP_CD
     , B.DISP_TRKR_NM
     , B.DISP_UT_PRC
     , B.DISP_RSN_CD
     , B.PART_AMT
     , B.INV_AMT
     , B.FILE_SEQ
     , B.INV_NO
     , B.RCV_INV_SEQ
     , B.MNR_PRNR_CNT_CD
     , B.MNR_PRNR_SEQ
     , B.CRE_USR_ID
     , B.CRE_DT
     , DECODE(B.DISP_SOLD_DT,'','D','E') DISP_SOLD_DT_FLG
     , A.EQ_KND_CD
     , DECODE(B.EQ_NO,'','N',DECODE(B.DISP_RLSE_NO,'','Y','N')) DISP_RLSE_NO_FLG
     , B.EQ_NO  AS OLD_EQ_NO
     , B.EQ_TPSZ_CD  AS OLD_EQ_TPSZ_CD
     , B.DISP_YD_CD  AS OLD_EQ_DISP_YD_CD
  FROM MNR_DISP_HDR A
     , MNR_DISP_DTL B
     , MST_CONTAINER C
     , CGM_EQUIPMENT D
 WHERE A.DISP_NO = B.DISP_NO
   AND B.EQ_NO = C.CNTR_NO (+)
   AND B.EQ_NO = D.EQ_NO (+)
   AND A.DISP_NO = @[selected_disp_no]
   AND B.MNR_PRNR_CNT_CD = @[selected_mnr_prnr_cnt_cd]
   AND B.MNR_PRNR_SEQ    = @[selected_mnr_prnr_seq]			]]></sql>
			<params>
				<param name="selected_disp_no" type="12" value="" out="N"/>
				<param name="selected_mnr_prnr_cnt_cd" type="12" value="" out="N"/>
				<param name="selected_mnr_prnr_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
