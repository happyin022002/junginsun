<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChargeCalculationReportDBDAODeleteInquiryByDeleteDateRSQL">
			<desc><![CDATA[ChargeCalculationReportDBDAODeleteInquiryByDeleteDateRSQL]]></desc>
			<sql><![CDATA[
select  decode(@[grp_flg], 'R', T2.OFC_RHQ_CD, T2.OFC_CD) 	as OFC_CD
	   ,T1.DMDT_CHG_DELT_RSN_CD                          	as DELT_RSN_CD
	   ,T1.DMDT_CHG_DELT_SPEC_RSN_CD                          	as DELT_SPEC_RSN_CD
	   ,decode(T1.DMDT_CHG_DELT_RSN_CD, 'OTH', 'Other', T3.INTG_CD_VAL_DP_DESC) as DELT_RSN_DESC
	   ,T3.INTG_CD_VAL_DP_SEQ
	   ,sum(decode(T2.DMDT_TRF_CD, 'DMIF', 1, 0))    		as DMIF_SUM
	   ,sum(decode(T2.DMDT_TRF_CD, 'DMOF', 1, 0))    		as DMOF_SUM
	   ,sum(decode(T2.DMDT_TRF_CD, 'DTIC', 1, 0))    		as DTIC_SUM
	   ,sum(decode(T2.DMDT_TRF_CD, 'DTOC', 1, 0))    		as DTOC_SUM
	   ,sum(decode(T2.DMDT_TRF_CD, 'CTIC', 1, 0))    		as CTIC_SUM
	   ,sum(decode(T2.DMDT_TRF_CD, 'CTOC', 1, 0))    		as CTOC_SUM
	   ,count(1) 											as TTL_CNTR
	   
  from  DMT_CHG_DELT_RQST_APRO	T1 
       ,DMT_CHG_CALC            T2
	   ,COM_INTG_CD_DTL			T3
	   
 where  T1.DMDT_DELT_RQST_STS_CD in ('A', 'B', 'Q', 'H')	--// A:Approval(기존코드값 - TO-BE 사용되지 않음), B:BB Approval, Q:RHQ Approval, H:HO Approval
   and  T1.UPD_DT between to_date(replace(@[fm_dt], '-', ''), 'YYYYMMDD') and to_date(replace(@[to_dt], '-', ''), 'YYYYMMDD') + .99999
   and  T1.SYS_AREA_GRP_ID      = T2.SYS_AREA_GRP_ID
   and  T1.CNTR_NO              = T2.CNTR_NO
   and  T1.CNTR_CYC_NO          = T2.CNTR_CYC_NO
   and  T1.DMDT_TRF_CD          = T2.DMDT_TRF_CD
   and  T1.DMDT_CHG_LOC_DIV_CD  = T2.DMDT_CHG_LOC_DIV_CD
   and  T1.CHG_SEQ              = T2.CHG_SEQ
   and  T1.CHG_OFC_CD           = T2.OFC_CD
   and  T1.DELT_SEQ             =
		(
			select  max(DELT_SEQ)
			  from  DMT_CHG_DELT_RQST_APRO
			 where  SYS_AREA_GRP_ID 	 = T1.SYS_AREA_GRP_ID
			   and  CNTR_NO              = T1.CNTR_NO
			   and  CNTR_CYC_NO          = T1.CNTR_CYC_NO
			   and  DMDT_TRF_CD          = T1.DMDT_TRF_CD
			   and  DMDT_CHG_LOC_DIV_CD  = T1.DMDT_CHG_LOC_DIV_CD
			   and  CHG_SEQ              = T1.CHG_SEQ
			   and  CHG_OFC_CD           = T1.CHG_OFC_CD
		)   
   and  T2.DMDT_CHG_STS_CD      = 'D'
   
#if (${ofc_flg} == 'O')
   and  T2.OFC_CD in
		(
			#foreach( $an_ofc in ${ofc_cd_list} )
				#if($velocityCount < $ofc_cd_list.size()) '$an_ofc', #else '$an_ofc' #end
			#end
		)
#elseif (${ofc_flg} == 'R' && ${ofc_cd} != 'All') 
   and  T2.OFC_RHQ_CD = @[ofc_cd]
#end

#if (${del_cd} != 'All')
   and  T1.DMDT_CHG_DELT_RSN_CD = @[del_cd]
#if (${spec_cd} != 'All')
   and  T1.DMDT_CHG_DELT_SPEC_RSN_CD = @[spec_cd]
#end
#end
   
   and  T2.DMDT_CHG_LOC_DIV_CD <> 'SZP'	-- 2010/03/19 추가   
   and  T3.INTG_CD_ID           = 'CD01965'
   and  T1.DMDT_CHG_DELT_RSN_CD = T3.INTG_CD_VAL_CTNT   
   
group by decode(@[grp_flg], 'R', T2.OFC_RHQ_CD, T2.OFC_CD)
		,T1.DMDT_CHG_DELT_RSN_CD, T1.DMDT_CHG_DELT_SPEC_RSN_CD
		,decode(T1.DMDT_CHG_DELT_RSN_CD, 'OTH', 'Other', T3.INTG_CD_VAL_DP_DESC)
		,T3.INTG_CD_VAL_DP_SEQ
order by 1
		,T3.INTG_CD_VAL_DP_SEQ			]]></sql>
			<params>
				<param name="grp_flg" type="12" value="" out="N"/>
				<param name="fm_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
				<param name="spec_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
