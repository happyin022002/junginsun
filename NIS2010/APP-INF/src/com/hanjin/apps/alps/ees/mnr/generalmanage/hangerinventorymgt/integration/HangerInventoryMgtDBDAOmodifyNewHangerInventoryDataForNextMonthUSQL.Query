<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="HangerInventoryMgtDBDAOmodifyNewHangerInventoryDataForNextMonthUSQL">
			<desc><![CDATA[[EES_MNR_0113] Hangar Inventory List 데이터 수정시
이전달 정보를 수정시 이번달 FirstMonth 데이터를 수정
데이터가 없는경우 저번달 데이터를 토대로 새로운 데이터 생성]]></desc>
			<sql><![CDATA[
MERGE INTO MNR_HNGR_MON_INVT A
 USING DUAL
    ON ( A.INVT_YRMON = @[invt_yrmon] AND A.OFC_CD = @[ofc_cd] AND A.MNR_HNGR_BAR_TP_CD = @[intg_cd_val_ctnt])
  WHEN MATCHED THEN
    UPDATE SET INVT_QTY = (
                           SELECT NVL(INVT_QTY,0) 
                                + NVL(DE_HNGR_QTY,0)
                                - NVL(OB_HNGR_QTY,0)
                                - NVL(REPO_OUT_HNGR_QTY,0)
                                + NVL(RPR_HNGR_QTY,0)
                             FROM MNR_HNGR_MON_INVT
                            WHERE INVT_YRMON = TO_CHAR(ADD_MONTHS(TO_DATE(@[invt_yrmon] , 'YYYYMM'), -1), 'YYYYMM')
                              AND OFC_CD = @[ofc_cd] 
                              AND MNR_HNGR_BAR_TP_CD = @[intg_cd_val_ctnt]
                          )
             , UPD_DT = SYSDATE
             , UPD_USR_ID = @[upd_usr_id]
  WHEN NOT MATCHED THEN
    INSERT ( 
        INVT_YRMON
      , OFC_CD
      , MNR_HNGR_BAR_TP_CD
      , INVT_QTY
      , DE_HNGR_QTY
      , OB_HNGR_QTY
      , REPO_OUT_HNGR_QTY
      , RPR_HNGR_QTY
      , DISP_HNGR_QTY
      , INVT_RMK
      , CRE_USR_ID
      , CRE_DT
      , UPD_USR_ID
      , UPD_DT
    )
    VALUES (
        @[invt_yrmon]
      , @[ofc_cd]
      , @[intg_cd_val_ctnt]
      , (
          SELECT NVL(INVT_QTY,0) 
               + NVL(DE_HNGR_QTY,0)
               - NVL(OB_HNGR_QTY,0)
               - NVL(REPO_OUT_HNGR_QTY,0)
               + NVL(RPR_HNGR_QTY,0)
            FROM MNR_HNGR_MON_INVT
           WHERE INVT_YRMON = TO_CHAR(ADD_MONTHS(TO_DATE(@[invt_yrmon] , 'YYYYMM'), -1), 'YYYYMM')
             AND OFC_CD = @[ofc_cd] 
             AND MNR_HNGR_BAR_TP_CD = @[intg_cd_val_ctnt]
        )
      , 0
      , 0
      , 0
      , 0
      , 0
      , NULL
      , @[upd_usr_id]
      , SYSDATE
      , @[upd_usr_id]
      , SYSDATE
    )			]]></sql>
			<params>
				<param name="invt_yrmon" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="intg_cd_val_ctnt" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
