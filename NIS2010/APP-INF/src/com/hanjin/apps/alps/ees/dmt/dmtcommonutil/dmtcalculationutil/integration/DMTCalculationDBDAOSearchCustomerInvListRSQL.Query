<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DMTCalculationDBDAOSearchCustomerInvListRSQL">
			<desc><![CDATA[searchCustomerInvList]]></desc>
			<sql><![CDATA[
SELECT DECODE (A.DMDT_INV_STS_CD,'I','Y','N') AS DMDT_INV_STS_CD
      ,A.DMDT_AR_IF_CD
      ,TO_CHAR(C.FM_MVMT_DT, 'YYYYMMDD') AS FT_END_DT
 	  ,TO_CHAR(C.TO_MVMT_DT, 'YYYYMMDD') AS TO_MVMT_DT
      ,A.CHG_CURR_CD AS INV_CURR_CD
      ,B.CNTR_INV_AMT AS INV_CHG_AMT
      ,A.BKG_NO
      ,C.CNTR_NO
	  ,C.DMDT_TRF_CD
      ,CASE WHEN A.DMDT_AR_IF_CD = 'Y' THEN B.BIL_AMT ELSE 0 END AS BIL_AMT
  FROM DMT_INV_MN A
      ,DMT_INV_DTL B
      ,DMT_CHG_CALC C
 WHERE A.DMDT_INV_NO = B.DMDT_INV_NO
   AND A.CRE_OFC_CD = B.CRE_OFC_CD
   AND B.SYS_AREA_GRP_ID = C.SYS_AREA_GRP_ID
   AND B.CNTR_NO = C.CNTR_NO
   AND B.CNTR_CYC_NO = C.CNTR_CYC_NO
   AND B.DMDT_TRF_CD = C.DMDT_TRF_CD
   AND B.DMDT_CHG_LOC_DIV_CD = C.DMDT_CHG_LOC_DIV_CD
   AND B.CHG_SEQ = C.CHG_SEQ
   AND A.BKG_NO = @[bkg_no]
   AND (C.SYS_AREA_GRP_ID, C.CNTR_NO, C.CNTR_CYC_NO) IN (
                                       SELECT D.SYS_AREA_GRP_ID
                                             ,D.CNTR_NO
                                             ,D.CNTR_CYC_NO
                                         FROM DMT_CHG_BKG_CNTR D
                                        WHERE D.BKG_NO = @[bkg_no])
   AND C.CNTR_NO = @[cntr_no]
   AND C.DMDT_CHG_STS_CD IN ('F', 'C', 'I', 'L', 'N', 'U')
   AND (
        ( C.DMDT_TRF_CD = 'DMIF' AND C.DMDT_CHG_LOC_DIV_CD = 'POD' )
		OR 
        ( C.DMDT_TRF_CD = 'CTIC' AND C.DMDT_CHG_LOC_DIV_CD = 'DEL' )
       )			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
