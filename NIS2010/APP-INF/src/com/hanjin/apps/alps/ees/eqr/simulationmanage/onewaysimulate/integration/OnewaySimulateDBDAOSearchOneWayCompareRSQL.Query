<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OnewaySimulateDBDAOSearchOneWayCompareRSQL">
			<desc><![CDATA[PLAN ID별 실적에 대한 비교 조회 데이터]]></desc>
			<sql><![CDATA[
SELECT  
	PLN_YRWK AS FCAST_YRWK
	#foreach( ${key} in ${arrtpszcd})
		, MAX(DECODE ( FLAG ,'A' , AMT${key})) OLDMTYCOST${key}
	#end
	#foreach( ${key} in ${arrtpszcd})
 		, MAX(DECODE ( FLAG ,'B' , AMT${key})) NEWMTCOST${key} 
 		, MAX(DECODE ( FLAG ,'C' , AMT${key})) NEWOFCOST${key}
 		, NVL(MAX(DECODE ( FLAG ,'B' , AMT${key})),0) + NVL(MAX(DECODE ( FLAG ,'C' , AMT${key})),0) NEWTCOST${key}
	#end	 
	#foreach( ${key} in ${arrtpszcd})
    	, NVL(MAX(DECODE ( FLAG ,'A' , AMT${key})),0) - NVL(MAX(DECODE ( FLAG ,'B' , AMT${key})),0) DIFFCOST${key}
		, MAX(DECODE ( FLAG ,'B' , AMT${key})) DIFFMTCOST${key}                                                             	
		, NVL(MAX(DECODE ( FLAG ,'B' , AMT${key})),0) + NVL(MAX(DECODE ( FLAG ,'C' , AMT${key})),0) DIFFTCOST${key}	
	#end 
FROM 
	(
		SELECT  
			PLN_YRWK
	  		#foreach( ${key} in ${arrtpszcd})
				, SUM(DECODE ( CNTR_TPSZ_CD , '$key' , AMT)) AMT${key}
	  		#end 	
			, 'A' FLAG
	  	FROM 
			( 
				SELECT 
					A.PLN_YRWK
					, B.CNTR_TPSZ_CD
					, B.LODG_DCHG_COST_AMT  AMT 
			 	FROM 
					EQR_VSL_LODG_DCHG_PLN A
                  	, EQR_VSL_LODG_DCHG_PLN_QTY B
				    , (
						SELECT 
							ECC_CD 
						FROM 
							EQR_ECC_MST
						WHERE 
							1 = 1
                         	#if (${fmecccd} != '') 
            					#if (${fmtype} == 'R')
                 					AND RCC_CD IN (${arrfmecccd}) 
								#end
            					#if (${fmtype} == 'L')
                 					AND LCC_CD IN (${arrfmecccd})
								#end
            					#if (${fmtype} == 'E')
                 					AND ECC_CD IN (${arrfmecccd})
								#end
		 				 	#end
                   	) c
                  	, (
						SELECT 
							ECC_CD 
						FROM 
							EQR_ECC_MST
						WHERE 
							1 = 1 
                        	#if (${toecccd} != '') 
            					#if (${totype} == 'R')
                					AND RCC_CD IN (${arrtoecccd}) 
								#end
            					#if (${totype} == 'L')
                 					AND LCC_CD IN (${arrtoecccd})
								#end
            					#if (${totype} == 'E')
                 					AND ECC_CD IN (${arrtoecccd})
								#end
		  					#end
					) d 
				WHERE 
					A.REPO_PLN_ID = @[repo_pln_id] 
					AND TO_CHAR(A.FM_ETD_DT,'YYYYMMDD') BETWEEN (
																	SELECT 
																		WK_ST_DT 
																	FROM 
																		EQR_WK_PRD 
																	WHERE 
																		PLN_YR || PLN_WK = @[fm_yrwk]
																) AND (
																	SELECT 
																		WK_END_DT 
																	FROM 
																		EQR_WK_PRD 
																	WHERE 
																		PLN_YR || PLN_WK = @[to_yrwk]
					)
					AND TO_CHAR(A.TO_ETB_DT,'YYYYMMDD') BETWEEN (
																	SELECT 
																		WK_ST_DT 
																	FROM 
																		EQR_WK_PRD 
																	WHERE 
																		PLN_YR || PLN_WK = @[fm_to_yrwk]
																) AND (
																	SELECT 
																		WK_END_DT 
																	FROM 
																		EQR_WK_PRD 
																	WHERE 
																		PLN_YR || PLN_WK =@[to_to_yrwk]
					)
					#if (${tpszcd} != '') 
						AND B.CNTR_TPSZ_CD IN (${arrcntrtpzcd})
		    		#end
            		AND A.FM_ECC_CD = c.ECC_CD 
					AND A.TO_ECC_CD = d.ECC_CD
            		AND A.REPO_PLN_ID = B.REPO_PLN_ID
            		AND A.PLN_YRWK    = B.PLN_YRWK
            		AND A.PLN_SEQ     = B.PLN_SEQ
			UNION ALL  	
				SELECT 	
					A.PLN_YRWK 
					, B.CNTR_TPSZ_CD
					, B.TRSP_COST_AMT AMT 
				FROM  
					EQR_INLND_TRSP_PLN A
                 	, EQR_INLND_TRSP_PLN_QTY B
				 	, (
						SELECT 
							ECC_CD 
						FROM 
							EQR_ECC_MST 
						WHERE 
							1 = 1
                         	#if (${fmecccd} != '') 
            					#if (${fmtype} == 'R')
                 					AND RCC_CD IN (${arrfmecccd}) 
								#end
            					#if (${fmtype} == 'L')
                 					AND LCC_CD IN (${arrfmecccd})
								#end
            					#if (${fmtype} == 'E')
                 					AND ECC_CD IN (${arrfmecccd})
								#end
		 				 	#end
                	) c
                  	, (
						SELECT 
							ECC_CD 
						FROM 
							EQR_ECC_MST 
						WHERE 
							1 = 1 
                        	#if (${toecccd} != '') 
            					#if (${totype} == 'R')
                					AND RCC_CD IN (${arrtoecccd}) 
								#end
            					#if (${totype} == 'L')
                 					AND LCC_CD IN (${arrtoecccd})
								#end
            					#if (${totype} == 'E')
                 					AND ECC_CD IN (${arrtoecccd})
								#end
		  					#end
					) d 
				WHERE  
					A.REPO_PLN_ID = @[repo_pln_id]
					AND A.PLN_YRWK BETWEEN @[fm_yrwk] AND @[to_yrwk]
					AND A.TO_YRWK  BETWEEN @[fm_to_yrwk]  AND @[to_to_yrwk]
					#if (${tpszcd} != '') 
						AND B.CNTR_TPSZ_CD IN (${arrcntrtpzcd})
		    		#end
            		AND A.FM_ECC_CD = c.ECC_CD 
					AND A.TO_ECC_CD = d.ECC_CD
            		AND A.REPO_PLN_ID = B.REPO_PLN_ID
            		AND A.PLN_YRWK    = B.PLN_YRWK
            		AND A.PLN_SEQ     = B.PLN_SEQ
			UNION ALL 
				SELECT 	
					PLN.PLN_YRWK
					, QTY.CNTR_TPSZ_CD
					, QTY.ONF_HIR_COST_AMT   AMT
				FROM  
					EQR_ONF_HIR_PLN  PLN 
                  	, EQR_ONF_HIR_PLN_QTY QTY
				  	, (
						SELECT 
							ECC_CD 
						FROM 
							EQR_ECC_MST 
						WHERE 
							1 = 1 
                      		#if (${fmecccd} != '') 
            					#if (${fmtype} == 'R')
                 					AND RCC_CD IN (${arrfmecccd}) 
								#end
            					#if (${fmtype} == 'L')
                 					AND LCC_CD IN (${arrfmecccd})
								#end
            					#if (${fmtype} == 'E')
                 					AND ECC_CD IN (${arrfmecccd})
								#end
		 				 	#end
           			) c
				WHERE  
					PLN.REPO_PLN_ID = @[repo_pln_id]	
					AND PLN.PLN_YRWK BETWEEN @[fm_yrwk] AND  @[to_yrwk]
            		#if (${tpszcd} != '') 
						AND QTY.CNTR_TPSZ_CD IN (${arrcntrtpzcd})
		    		#end
					AND ( PLN.ECC_CD = c.ECC_CD OR PLN.ECC_CD = c.ECC_CD )
					AND PLN.REPO_PLN_ID = QTY.REPO_PLN_ID
            		AND PLN.PLN_YRWK    = QTY.PLN_YRWK
            		AND PLN.PLN_SEQ     = QTY.PLN_SEQ
			)
		GROUP BY 
			PLN_YRWK
	UNION ALL  
		( 
			SELECT    
				PLN_YRWK
				#foreach( ${key} in ${arrtpszcd})
					 , SUM(DECODE ( CNTR_TPSZ_CD , '$key' , AMT)) AMT${key}
				#end
				, 'B' FLAG   	
      		FROM 
				( 
					SELECT	
						A.PLN_YRWK
						, B.CNTR_TPSZ_CD
						, B.LODG_DCHG_COST_AMT  AMT 
			 		FROM 
						EQR_VSL_LODG_DCHG_PLN A
                 		, EQR_VSL_LODG_DCHG_PLN_QTY B
				 	 	, (
							SELECT 
								ECC_CD 
							FROM 
								EQR_ECC_MST 
							WHERE 
								1 = 1
                         		#if (${fmecccd} != '') 
            						#if (${fmtype} == 'R')
                 						AND RCC_CD IN (${arrfmecccd}) 
									#end
            						#if (${fmtype} == 'L')
                 						AND LCC_CD IN (${arrfmecccd})
									#end
            						#if (${fmtype} == 'E')
                 						AND ECC_CD IN (${arrfmecccd})
									#end
		 				 		#end
                   		) c
                  		, (
							SELECT 
								ECC_CD 
							FROM 
								EQR_ECC_MST 
							WHERE 
								1 = 1 
                        		#if (${toecccd} != '') 
            						#if (${totype} == 'R')
                						AND RCC_CD IN (${arrtoecccd}) 
									#end
            						#if (${totype} == 'L')
                 						AND LCC_CD IN (${arrtoecccd})
									#end
            						#if (${totype} == 'E')
                 						AND ECC_CD IN (${arrtoecccd})
									#end
		  						#end
						) d 
	        		WHERE 
						A.REPO_PLN_ID = @[new_repo_pln_id]
						AND TO_CHAR(A.FM_ETD_DT,'YYYYMMDD') BETWEEN	(
																		SELECT 
																			WK_ST_DT 
																		FROM 
																			EQR_WK_PRD 
																		WHERE 
																			PLN_YR || PLN_WK = @[fm_yrwk]
																	) AND (
																		SELECT 
																			WK_END_DT 
																		FROM 
																			EQR_WK_PRD 
																		WHERE 
																			PLN_YR || PLN_WK = @[to_yrwk]
						)
						AND TO_CHAR(A.TO_ETB_DT,'YYYYMMDD') BETWEEN	(
																		SELECT 
																			WK_ST_DT 
																		FROM 
																			EQR_WK_PRD 
																		WHERE 
																			PLN_YR || PLN_WK = @[fm_to_yrwk]
																	) AND (
																		SELECT 
																			WK_END_DT 
																		FROM 
																			EQR_WK_PRD 
																		WHERE 
																			PLN_YR || PLN_WK =@[to_to_yrwk] 
						)
 						#if (${tpszcd} != '') 
							AND B.CNTR_TPSZ_CD IN (${arrcntrtpzcd})
		    			#end                                                
	 	    			AND A.FM_ECC_CD = c.ECC_CD 
						AND A.TO_ECC_CD = d.ECC_CD 
            			AND A.REPO_PLN_ID = B.REPO_PLN_ID
            			AND A.PLN_YRWK    = B.PLN_YRWK
            			AND A.PLN_SEQ     = B.PLN_SEQ
				UNION ALL      
					SELECT 	
						A.PLN_YRWK
						, B.CNTR_TPSZ_CD
						, B.TRSP_COST_AMT AMT  
					FROM  
						EQR_INLND_TRSP_PLN A
                 		, EQR_INLND_TRSP_PLN_QTY B
				   		, (
							SELECT 
								ECC_CD 
							FROM 
								EQR_ECC_MST 
							WHERE 
								1 = 1
                         		#if (${fmecccd} != '') 
            						#if (${fmtype} == 'R')
                 						AND RCC_CD IN (${arrfmecccd}) 
									#end
            						#if (${fmtype} == 'L')
                 						AND LCC_CD IN (${arrfmecccd})
									#end
            						#if (${fmtype} == 'E')
                 						AND ECC_CD IN (${arrfmecccd})
									#end
		 				 		#end
              			) c
                  		, (
							SELECT 
								ECC_CD 
							FROM 
								EQR_ECC_MST 
							WHERE 
								1 = 1 
                        		#if (${toecccd} != '') 
            						#if (${totype} == 'R')
                						AND RCC_CD IN (${arrtoecccd}) 
									#end
            						#if (${totype} == 'L')
                 						AND LCC_CD IN (${arrtoecccd})
									#end
            						#if (${totype} == 'E')
                 						AND ECC_CD IN (${arrtoecccd})
									#end
		  						#end
						) d 
 					WHERE  
						A.REPO_PLN_ID = @[new_repo_pln_id]	
						AND A.PLN_YRWK BETWEEN @[fm_yrwk]  AND @[to_yrwk]	 
						AND A.TO_YRWK  BETWEEN @[fm_to_yrwk]  AND @[to_to_yrwk]    
						#if (${tpszcd} != '') 
							AND B.CNTR_TPSZ_CD IN (${arrcntrtpzcd})
		   				#end 		
            			AND A.FM_ECC_CD = c.ECC_CD 
						AND A.TO_ECC_CD = d.ECC_CD 
            			AND A.REPO_PLN_ID = B.REPO_PLN_ID
            			AND A.PLN_YRWK    = B.PLN_YRWK
            			AND A.PLN_SEQ     = B.PLN_SEQ
	        	UNION ALL 
					SELECT	
						PLN.PLN_YRWK
						, QTY.CNTR_TPSZ_CD
						, QTY.ONF_HIR_COST_AMT   AMT 
					FROM  
						EQR_ONF_HIR_PLN  PLN
                 		, EQR_ONF_HIR_PLN_QTY QTY
						, (
							SELECT 
								ECC_CD 
							FROM 
								EQR_ECC_MST 
							WHERE 
								1 = 1 
                      			#if (${fmecccd} != '') 
            						#if (${fmtype} == 'R')
                 						AND RCC_CD IN (${arrfmecccd}) 
									#end
            						#if (${fmtype} == 'L')
                 						AND LCC_CD IN (${arrfmecccd})
									#end
            						#if (${fmtype} == 'E')
                 						AND ECC_CD IN (${arrfmecccd})
									#end
		 				 		#end
             			) c
	  				WHERE  
						PLN.REPO_PLN_ID = @[new_repo_pln_id]
		 				AND PLN.PLN_YRWK BETWEEN @[fm_yrwk] AND  @[to_yrwk]
						#if (${tpszcd} != '') 
							AND QTY.CNTR_TPSZ_CD IN (${arrcntrtpzcd})
		    			#end 
						AND ( PLN.ECC_CD = c.ECC_CD OR PLN.ECC_CD = c.ECC_CD )
            			AND PLN.REPO_PLN_ID = QTY.REPO_PLN_ID
            			AND PLN.PLN_YRWK    = QTY.PLN_YRWK
            			AND PLN.PLN_SEQ     = QTY.PLN_SEQ
				)	
			GROUP BY 
				PLN_YRWK 
		)       
	UNION ALL 
		( 
			SELECT    
				PLN_YRWK 
				#foreach( ${key} in ${arrtpszcd})
					, SUM(DECODE ( CNTR_TPSZ_CD , '$key' , 0)) AMT${key}
				#end
				, 'C' FLAG
			FROM 
				( 	
					SELECT 	
						A.PLN_YRWK
						, B.CNTR_TPSZ_CD
						, B.LODG_DCHG_COST_AMT  AMT 	
		   			FROM 
						EQR_VSL_LODG_DCHG_PLN A
                		, EQR_VSL_LODG_DCHG_PLN_QTY B 	
					WHERE 
						A.REPO_PLN_ID = @[new_repo_pln_id]    	
						AND TO_CHAR(A.FM_ETD_DT,'YYYYMMDD') BETWEEN  (
																		SELECT 
																			WK_ST_DT 
																		FROM 
																			EQR_WK_PRD 
																		WHERE 
																			PLN_YR || PLN_WK = @[fm_yrwk]
																	) AND (
																		SELECT 
																			WK_END_DT 
																		FROM 
																			EQR_WK_PRD 
																		WHERE 
																			PLN_YR || PLN_WK = @[to_yrwk]
						) 	
						AND TO_CHAR(A.TO_ETB_DT,'YYYYMMDD') BETWEEN	(
																		SELECT 
																			WK_ST_DT 
																		FROM 
																			EQR_WK_PRD 
																		WHERE 
																			PLN_YR || PLN_WK = @[fm_to_yrwk]
																	) AND (
																		SELECT 
																			WK_END_DT 
																		FROM 
																			EQR_WK_PRD 
																		WHERE 
																			PLN_YR || PLN_WK =@[to_to_yrwk] 
						)
						#if (${tpszcd} != '') 
							AND B.CNTR_TPSZ_CD IN (${arrcntrtpzcd})
		    			#end 
            			AND A.REPO_PLN_ID = B.REPO_PLN_ID
            			AND A.PLN_YRWK    = B.PLN_YRWK
            			AND A.PLN_SEQ     = B.PLN_SEQ
				UNION ALL                                                                                                     
					SELECT 	
						A.PLN_YRWK
						, B.CNTR_TPSZ_CD
						, B.TRSP_COST_AMT      AMT 	
					FROM  
						EQR_INLND_TRSP_PLN A
                 		, EQR_INLND_TRSP_PLN_QTY B	
					WHERE  
						A.REPO_PLN_ID = @[new_repo_pln_id]	
						AND A.PLN_YRWK BETWEEN @[fm_yrwk]  AND @[to_yrwk]	
						AND A.TO_YRWK  BETWEEN @[fm_to_yrwk]  AND @[to_to_yrwk]
    					#if (${tpszcd} != '') 
							AND B.CNTR_TPSZ_CD IN (${arrcntrtpzcd})
		    			#end
            			AND A.REPO_PLN_ID = B.REPO_PLN_ID
            			AND A.PLN_YRWK    = B.PLN_YRWK
            			AND A.PLN_SEQ     = B.PLN_SEQ
 				UNION ALL	
					SELECT 	
						PLN.PLN_YRWK
						, QTY.CNTR_TPSZ_CD
						, QTY.ONF_HIR_COST_AMT   AMT 	
					FROM  
						EQR_ONF_HIR_PLN  PLN	
                 		, EQR_ONF_HIR_PLN_QTY QTY
					WHERE  
						PLN.REPO_PLN_ID = @[new_repo_pln_id]	
						AND PLN.PLN_YRWK BETWEEN @[fm_yrwk] AND  @[to_yrwk]	
						#if (${tpszcd} != '') 
							AND QTY.CNTR_TPSZ_CD IN (${arrcntrtpzcd})
		    			#end
            			AND PLN.REPO_PLN_ID = QTY.REPO_PLN_ID
            			AND PLN.PLN_YRWK    = QTY.PLN_YRWK
            			AND PLN.PLN_SEQ     = QTY.PLN_SEQ	
				)	
			GROUP BY PLN_YRWK 	
		)	
	) 	
GROUP BY 
	PLN_YRWK 	
ORDER BY 
	PLN_YRWK			]]></sql>
			<params>
				<param name="repo_pln_id" type="12" value="" out="N"/>
				<param name="fm_yrwk" type="12" value="" out="N"/>
				<param name="to_yrwk" type="12" value="" out="N"/>
				<param name="fm_to_yrwk" type="12" value="" out="N"/>
				<param name="to_to_yrwk" type="12" value="" out="N"/>
				<param name="new_repo_pln_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
