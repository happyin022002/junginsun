<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="LeasePlanDBDAOOffHirePlanByRCCDOLRSQL">
			<desc><![CDATA[Off-hire Plan by RCC 화면에서 DOL 조회

2011.06.13 나상보 [CHM-201111467-01] [LSE] MDM에 R9 등록에 따른 추가 업무 진행 요청]]></desc>
			<sql><![CDATA[
SELECT CASE WHEN OFFH_LOC_CD IS NULL THEN 0
            WHEN AGMT_NO IS NULL THEN 1
            ELSE 2
       END AS LEVEL_NO
     , OFFH_RGN_LOC_CD
     , NVL(OFFH_LOC_CD, ' ') AS OFFH_LOC_CD
     , NVL(AGMT_NO, ' ')     AS AGMT_NO
#foreach($key IN ${cntr_tpsz_cd_seq})
#set ($col_name='CNTR'+$velocityCount+'_QTY')
     , $col_name
#end
FROM   (
         SELECT @[loc_cd] AS OFFH_RGN_LOC_CD
#if ( ${loc_tp} == '1' )
              , C.LCC_CD AS OFFH_LOC_CD
#elseif ( ${loc_tp} == '2' )
              , C.SCC_CD AS OFFH_LOC_CD
#end
              , B.AGMT_CTY_CD || LPAD(B.AGMT_SEQ, 6, '0') AS AGMT_NO
#foreach($key IN ${cntr_tpsz_cd_seq})
#set ($col_name='CNTR'+$velocityCount+'_QTY')
              , SUM(DECODE(A.CNTR_TPSZ_CD, '$key', A.AGMT_CHG_VAL, 0)) AS $col_name
#end
         FROM   LSE_AGMT_RT    A
              ,(SELECT  A.AGMT_CTY_CD, A.AGMT_SEQ, A.LSTM_CD
                FROM    LSE_AGREEMENT A,
                        MST_CONTAINER B
                WHERE   A.AGMT_CTY_CD = B.AGMT_CTY_CD
                AND     A.AGMT_SEQ = B.AGMT_SEQ        
                AND    (B.ACIAC_DIV_CD = 'A' OR  (B.ACIAC_DIV_CD = 'I' 
                AND     B.CNTR_STS_CD IN('SBO','MUO','LST','SRO'))) 
                GROUP BY A.AGMT_CTY_CD, A.AGMT_SEQ, A.LSTM_CD
                ) B        
              , MDM_EQ_ORZ_CHT C
         WHERE  A.AGMT_CTY_CD = B.AGMT_CTY_CD
         AND    A.AGMT_SEQ = B.AGMT_SEQ
#if (${lstm_cd} != '')
         AND    B.LSTM_CD = @[lstm_cd]
#end
#if ( ${loc_tp} == '1' )
         AND    C.RCC_CD = @[loc_cd]
#elseif ( ${loc_tp} == '2' )
         AND    C.LCC_CD = @[loc_cd]
#end
         AND    A.CNTR_RNTL_CHG_TP_CD = 'DOCV'
         AND    A.LOC_CD = C.SCC_CD
         GROUP  BY ROLLUP (
#if ( ${loc_tp} == '1' )
                           C.LCC_CD
#elseif ( ${loc_tp} == '2' )
                           C.SCC_CD
#end
                         , B.AGMT_CTY_CD || LPAD(B.AGMT_SEQ, 6, '0')
                )
       )
ORDER  BY OFFH_RGN_LOC_CD, NVL(OFFH_LOC_CD, ' '), NVL(AGMT_NO, ' ')			]]></sql>
			<params>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="lstm_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
