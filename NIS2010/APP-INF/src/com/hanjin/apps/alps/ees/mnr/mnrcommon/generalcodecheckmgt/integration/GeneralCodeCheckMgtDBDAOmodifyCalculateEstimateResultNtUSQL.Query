<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralCodeCheckMgtDBDAOmodifyCalculateEstimateResultNtUSQL">
			<desc><![CDATA[modifyCalculateEstimateResultNt]]></desc>
			<sql><![CDATA[
UPDATE   MNR_DAT_VRFY B
SET      INP_MSG4 =
         (
           SELECT   DECODE(TRF_CHK_0||TRF_CHK_1||TRF_CHK_2||TRF_CHK_3||TRF_CHK_4, '00000', 'LN', '10000', 'LC', '11000', 'LR', '11000', 'LD','LZ')
           FROM     (
                      SELECT   TMP_DTL_SEQ AS AAAA
                             , NVL((
                                     SELECT   1 AS TRF_CHK_0
                                     FROM     MNR_AGMT_HDR MAH
                                     WHERE    1 = 1
                                     AND      A.INP_MSG35 = MAH.AGMT_OFC_CTY_CD
                                     AND      A.INP_MSG36 = MAH.AGMT_SEQ
                                     AND      MAH.AGMT_LST_VER_FLG = 'Y'
                                     AND      A.TMP_SEQ = @[tmp_seq]
                                     AND      A.INP_MSG4 = 'NT'
                                     AND      MAH.TRF_NO IS NOT NULL
                                     GROUP BY TMP_DTL_SEQ
                               ), 0) AS TRF_CHK_0
                             , NVL((
                                     SELECT   1 AS TRF_CHK_1
                                     FROM     MNR_AGMT_HDR MAH
                                            , MNR_RPR_TRF_DTL MRTD
                                     WHERE    1 = 1
                                     AND      A.INP_MSG35 = MAH.AGMT_OFC_CTY_CD
                                     AND      A.INP_MSG36 = MAH.AGMT_SEQ
                                     AND      MAH.AGMT_LST_VER_FLG = 'Y'
                                     AND      MAH.TRF_NO = MRTD.TRF_NO
                                     AND      SUBSTRB(A.INP_MSG19, 1, 3) = SUBSTR(MRTD.COST_GRP_CD, 1, 3)
                                     AND      A.INP_MSG2 = MRTD.EQ_CMPO_CD
                                     AND      A.TMP_SEQ = @[tmp_seq]
                                     AND      A.INP_MSG4 = 'NT'
                                     GROUP BY TMP_DTL_SEQ
                               ), 0) AS TRF_CHK_1
                             , NVL((
                                     SELECT   1 AS TRF_CHK_2
                                     FROM     MNR_AGMT_HDR MAH
                                            , MNR_RPR_TRF_DTL MRTD
                                     WHERE    1 = 1
                                     AND      A.INP_MSG35 = MAH.AGMT_OFC_CTY_CD
                                     AND      A.INP_MSG36 = MAH.AGMT_SEQ
                                     AND      MAH.AGMT_LST_VER_FLG = 'Y'
                                     AND      MAH.TRF_NO = MRTD.TRF_NO
                                     AND      SUBSTRB(A.INP_MSG19, 1, 3) = SUBSTR(MRTD.COST_GRP_CD, 1, 3)
                                     AND      A.INP_MSG2 = MRTD.EQ_CMPO_CD
                                     AND      A.INP_MSG5 = MRTD.EQ_RPR_CD
                                     AND      A.TMP_SEQ = @[tmp_seq]
                                     AND      A.INP_MSG4 = 'NT'
                                     GROUP BY TMP_DTL_SEQ
                               ), 0) AS TRF_CHK_2
                             , NVL((
                                     SELECT   1 AS TRF_CHK_2
                                     FROM     MNR_AGMT_HDR MAH
                                            , MNR_RPR_TRF_DTL MRTD
                                     WHERE    1 = 1
                                     AND      A.INP_MSG35 = MAH.AGMT_OFC_CTY_CD
                                     AND      A.INP_MSG36 = MAH.AGMT_SEQ
                                     AND      MAH.AGMT_LST_VER_FLG = 'Y'
                                     AND      MAH.TRF_NO = MRTD.TRF_NO
                                     AND      SUBSTRB(A.INP_MSG19, 1, 3) = SUBSTR(MRTD.COST_GRP_CD, 1, 3)
                                     AND      A.INP_MSG2 = MRTD.EQ_CMPO_CD
                                     AND      A.INP_MSG5 = MRTD.EQ_RPR_CD
                                     AND      A.TMP_SEQ = @[tmp_seq]
                                     AND      A.INP_MSG4 = 'NT'
                                     AND      NVL(RTRIM(A.INP_MSG7), 'XXXX') = NVL(RTRIM(MRTD.TRF_DIV_CD), 'XXXX')
                                     GROUP BY TMP_DTL_SEQ
                               ), 0) AS TRF_CHK_3
                             , 0 AS TRF_CHK_4
                      FROM     MNR_DAT_VRFY A
                      WHERE    1 = 1
                      AND      A.TMP_SEQ = @[tmp_seq]
                      AND      A.INP_MSG4 = 'NT'
                    )
           WHERE    1 = 1
           AND      B.TMP_DTL_SEQ = AAAA
           AND      B.TMP_SEQ = @[tmp_seq]
           AND      B.INP_MSG4 = 'NT'
         )
WHERE    1 = 1
AND      B.TMP_SEQ = @[tmp_seq]
AND      B.INP_MSG4 = 'NT'			]]></sql>
			<params>
				<param name="tmp_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
