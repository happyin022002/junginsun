<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContainerOnOffhireDBDAOSearchCntrMasterUpdateInquiryRSQL">
			<desc><![CDATA[SearchCntrMasterUpdateInquiry]]></desc>
			<sql><![CDATA[
WITH PPARAM
AS 
(SELECT /*+ INDEX( A XPKMST_CONTAINER) */
                 CNTR_NO 
                 FROM MST_CONTAINER A
                 WHERE 1 = 1
                 ##${cntr_no}
            #if(${noExit} == 'A')
        		#if (${chk_dgt} == '')
        		AND  A.CNTR_NO = @[cntr_no]
       			#end
        		#if (${chk_dgt} != '') 
        		AND  A.CNTR_NO = @[cntr_no] || @[chk_dgt]
        		#end 
    		#end
    	   #if(${noExit} == 'E')
        		#if (${chk_dgt} == '')
        		AND  A.CNTR_NO = MST_COMMON_PKG.MST_CNTR_NO_FNC(@[cntr_no])
        		#end
        		#if (${chk_dgt} != '') 
        		AND  A.CNTR_NO = @[cntr_no] || @[chk_dgt]
        		#end 
    	   #end 
                 AND CNMV_DT = (
                               SELECT MAX(CNMV_DT) 
                               FROM MST_CONTAINER 
                               WHERE 1 = 1
                               ##${cntr_no}
                              #if(${noExit} == 'A')
       							 #if (${chk_dgt} == '')
        					   AND  CNTR_NO = @[cntr_no]
        						 #end
        					   #if (${chk_dgt} != '') 
        					   AND  CNTR_NO = @[cntr_no] || @[chk_dgt]
        					   #end 
                           #end
    					   #if(${noExit} == 'E')
        						#if (${chk_dgt} == '')
       						   AND  CNTR_NO = MST_COMMON_PKG.MST_CNTR_NO_FNC(@[cntr_no])
        						#end
        						#if (${chk_dgt} != '') 
        						AND  CNTR_NO = @[cntr_no] || @[chk_dgt]
       					    	 #end 
   						 #end 
                               )
                 AND ROWNUM = 1 
)
    SELECT
        A.CNTR_NO,
        SUBSTR(A.CNTR_NO,11) CHK_DGT,
        DECODE(A.ACIAC_DIV_CD, 'I', 'Inactive','A','Active') ACIAC_DIV_CD,
        A.CNTR_TPSZ_CD,
        B.CNTR_TPSZ_ISO_CD,
        A.CNTR_MTRL_CD,
        E.TARE_WGT,
        E.CNTR_SPEC_NO,
        ROUND(TO_NUMBER(E.TARE_WGT) * 2.2046) TARE_WGT_LBS,
        A.LSTM_CD,
	    CASE WHEN A.ACIAC_DIV_CD = 'I' THEN 
	         CASE WHEN F.CNTR_STS_CD IN ('SBO', 'MUO', 'SBI', 'MUI') THEN (SELECT X.LSTM_CD 
	                                                                       FROM LSE_AGREEMENT X 
	                                                                       WHERE  F.AGMT_CTY_CD = X.AGMT_CTY_CD
                                                                           AND    F.AGMT_SEQ    = X.AGMT_SEQ)
	         ELSE A.LSTM_CD END
	    ELSE A.LSTM_CD END SUB_LSTM_CD,              
        (SELECT DECODE(INTG_CD_VAL_CTNT,'H','SM Line',INTG_CD_VAL_DP_DESC)
         FROM COM_INTG_CD_DTL
         WHERE INTG_CD_ID ='CD01020'
         AND INTG_CD_VAL_CTNT = A.CNTR_USE_CO_CD
        ) CNTR_USE_CO_CD,
        (SELECT DECODE(INTG_CD_VAL_CTNT,'H','SM Line',INTG_CD_VAL_DP_DESC)
         FROM COM_INTG_CD_DTL
         WHERE INTG_CD_ID ='CD01047'
         AND INTG_CD_VAL_CTNT = A.OWNR_CO_CD
        ) OWNR_CO_CD,
        A.MFTR_VNDR_SEQ VNDR_ABBR_NM,
        C.VNDR_ABBR_NM  VNDR_LGL_ENG_NM,
        TO_CHAR(A.MFT_DT, 'YYYY-MM-DD') MFT_DT,
        A.D2_PAYLD_FLG,
        A.RF_TP_CD
    FROM 
    MST_CONTAINER A,
    MDM_CNTR_TP_SZ B,
    (
        SELECT 
           BB.VNDR_ABBR_NM,
           BB.VNDR_LGL_ENG_NM,
           BB.VNDR_SEQ
        FROM
           MST_CONTAINER AA, 
           MDM_VENDOR BB,
           PPARAM P
        WHERE AA.CNTR_NO = P.CNTR_NO
        AND   AA.MFTR_VNDR_SEQ = BB.VNDR_SEQ
    ) C,
    (
        SELECT
          AA.VNDR_SEQ,
          BB.VNDR_LGL_ENG_NM
        FROM 
          MST_CONTAINER AA,
          MDM_VENDOR BB,
          PPARAM P
        WHERE AA.CNTR_NO    = P.CNTR_NO
        AND   AA.VNDR_SEQ   = BB.VNDR_SEQ
    ) D,
    (
        SELECT NVL(A.TARE_WGT, C.CNTR_TPSZ_TARE_WGT) TARE_WGT, A.CNTR_SPEC_NO 
        FROM
        (
        SELECT B.TARE_WGT, B.CNTR_TPSZ_CD, B.CNTR_SPEC_NO 
        FROM MST_CNTR_SPEC B, MST_CONTAINER C, PPARAM P
        WHERE 1 = 1 
        AND   C.CNTR_NO = P.CNTR_NO
        AND   C.CNTR_SPEC_NO = B.CNTR_SPEC_NO
        ) A, 
        (SELECT A.CNTR_TPSZ_TARE_WGT, A.CNTR_TPSZ_CD
         FROM MDM_CNTR_TP_SZ A, MST_CONTAINER C, PPARAM P
         WHERE  1 = 1
         AND   C.CNTR_NO = P.CNTR_NO
         AND   A.CNTR_TPSZ_CD = C.CNTR_TPSZ_CD
        ) C   
        WHERE
          A.CNTR_TPSZ_CD(+) = C.CNTR_TPSZ_CD
    ) E,
    MST_CNTR_STS_HIS F, 
    LSE_AGREEMENT G,
    (
        SELECT MAX(CNTR_STS_SEQ) MAX_STS_SEQ, A.CNTR_NO 
        FROM
        MST_CNTR_STS_HIS A,
        PPARAM P
        WHERE 1 = 1
        AND    A.CNTR_NO = P.CNTR_NO
        GROUP BY A.CNTR_NO
    ) H,
    PPARAM P   
    WHERE 1 = 1
    AND A.CNTR_NO = P.CNTR_NO
    AND H.CNTR_NO = A.CNTR_NO
    AND H.CNTR_NO     = F.CNTR_NO
    AND H.MAX_STS_SEQ = F.CNTR_STS_SEQ
    AND G.AGMT_CTY_CD = A.AGMT_CTY_CD
    AND G.AGMT_SEQ    = A.AGMT_SEQ
    AND B.CNTR_TPSZ_CD  =    A.CNTR_TPSZ_CD
    AND A.MFTR_VNDR_SEQ =    C.VNDR_SEQ(+)
    AND A.VNDR_SEQ      =    D.VNDR_SEQ(+)			]]></sql>
			<params>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="chk_dgt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
