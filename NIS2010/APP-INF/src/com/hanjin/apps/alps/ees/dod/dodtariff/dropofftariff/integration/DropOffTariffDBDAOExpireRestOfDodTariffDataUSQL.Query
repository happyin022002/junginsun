<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DropOffTariffDBDAOExpireRestOfDodTariffDataUSQL">
			<desc><![CDATA[DodTariff 만료 수정
-------------------------------------------------------------------------------------------------------
2015.12.04 박정민 : 기존 조건에서 Customer정보에 Customer Code가 다르게 입력될수도 있음
-------------------------------------------------------------------------------------------------------
]]></desc>
			<sql><![CDATA[
update DOD_DRP_OFF_CHG_TRF
   set 
       DRP_OFF_CHG_TRF_EXP_FLG = 'N',
	   DRP_OFF_CHG_TRF_EXP_DT = TO_CHAR(TO_DATE(@[drp_off_chg_trf_eff_dt], 'YYYYMMDD') - 1, 'YYYYMMDD'),
       UPD_USR_ID = @[upd_usr_id],
       UPD_DT = SYSDATE
 where 1=1
   and DRP_OFF_CHG_TRF_CNT_CD = @[drp_off_chg_trf_cnt_cd]
#if( ${del_cd} == '' )
   and DEL_CD is null
#else
   and DEL_CD = @[del_cd]
#end
   and CNTR_RTN_LOC_CD = @[cntr_rtn_loc_cd]
#if( ${cntr_rtn_yd_sfx_cd} == '' || ${cntr_rtn_yd_sfx_cd} == 'ALL')
   and CNTR_RTN_YD_SFX_CD is null
#else 
   and CNTR_RTN_YD_SFX_CD = @[cntr_rtn_yd_sfx_cd]
#end
#if( ${pol_conti_cd} == '' || ${pol_conti_cd} == 'ALL')
	   and POL_CONTI_CD is null
#else
	   and POL_CONTI_CD = @[pol_conti_cd]
#end
   and DRP_OFF_CHG_TRF_DIV_CD = @[drp_off_chg_trf_div_cd]
#if(${drp_off_chg_trf_div_cd} != 'G')
#if ( ${rfa_no} != '')
and RFA_NO = @[rfa_no]
#end
#if ( ${sc_no} != '')
and SC_NO = @[sc_no]
#end
#end
   and CNTR_TPSZ_CD = @[cntr_tpsz_cd]
   and drp_off_chg_trf_exp_flg != 'Y'
   and DRP_OFF_CHG_TRF_SEQ = (select  DRP_OFF_CHG_TRF_SEQ  from (
  SELECT DRP_OFF_CHG_TRF_SEQ, 
         row_number() over (ORDER BY B.DRP_OFF_CHG_TRF_EFF_DT desc, B.DRP_OFF_CHG_TRF_EXP_DT desc, B.DRP_OFF_CHG_TRF_CNT_CD desc, B.DEL_CD, B.CNTR_RTN_LOC_CD desc, B.DRP_OFF_CHG_TRF_SEQ DESC) as row_rank FROM DOD_DRP_OFF_CHG_TRF B
									where 1=1
									and DRP_OFF_CHG_TRF_CNT_CD = @[drp_off_chg_trf_cnt_cd]
                                #if( ${del_cd} == '' )
								   and DEL_CD is null
								#else
								   and DEL_CD = @[del_cd]
								#end
								   and CNTR_RTN_LOC_CD = @[cntr_rtn_loc_cd]
                                   and DRP_OFF_CHG_TRF_DIV_CD = @[drp_off_chg_trf_div_cd]
								#if( ${cntr_rtn_yd_sfx_cd} == '' || ${cntr_rtn_yd_sfx_cd} == 'ALL')
								   and CNTR_RTN_YD_SFX_CD is null
								#else 
								   and CNTR_RTN_YD_SFX_CD = @[cntr_rtn_yd_sfx_cd]
								#end
								#if( ${pol_conti_cd} == '' || ${pol_conti_cd} == 'ALL')
								   and POL_CONTI_CD is null
								#else
								   and POL_CONTI_CD = @[pol_conti_cd]
								#end
								   and CNTR_TPSZ_CD = @[cntr_tpsz_cd]
                               ) t
WHERE row_rank = 2
and rownum = 1)
#if(${spcl_cust_cnt_seq} != '')
   and SPCL_CUST_CNT_CD = SUBSTR(@[spcl_cust_cnt_seq], 0, 2)
   and SPCL_CUST_SEQ = SUBSTR(@[spcl_cust_cnt_seq], 3)
#else
   and SPCL_CUST_CNT_CD is null
   and SPCL_CUST_SEQ is null
#end			]]></sql>
			<params>
				<param name="drp_off_chg_trf_eff_dt" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="drp_off_chg_trf_cnt_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
				<param name="cntr_rtn_loc_cd" type="12" value="" out="N"/>
				<param name="cntr_rtn_yd_sfx_cd" type="12" value="" out="N"/>
				<param name="pol_conti_cd" type="12" value="" out="N"/>
				<param name="drp_off_chg_trf_div_cd" type="12" value="" out="N"/>
				<param name="rfa_no" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="spcl_cust_cnt_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
