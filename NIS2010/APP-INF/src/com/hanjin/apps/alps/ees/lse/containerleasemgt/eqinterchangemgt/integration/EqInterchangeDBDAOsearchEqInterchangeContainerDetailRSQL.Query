<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EqInterchangeDBDAOsearchEqInterchangeContainerDetailRSQL">
			<desc><![CDATA[EQ interchange pick-up/off-hire 장비의 상세내역을 조회합니다.]]></desc>
			<sql><![CDATA[
#if (${cntr_sts_cd} == 'OF')
SELECT /*+ ORDERED */
               ROWNUM seq_no,
               B.CNTR_NO,
               A.CNTR_TPSZ_CD,
               B.AGMT_CTY_CD||LPAD(B.AGMT_SEQ, 6, '0') AS lsi_agmt_no,
               C.REF_NO lsi_ref_no,
               A.CNMV_STS_CD,
               TO_CHAR(E.CNTR_STS_EVNT_DT,'YYYYMMDD') cntr_sts_evnt_dt,
               E.YD_CD,
               B.RNTL_CHG_FREE_DYS,
               TO_CHAR(B.CNTR_STS_EVNT_DT,'YYYYMMDD') cntr_rtn_evnt_dt,
               B.YD_CD rtn_yd_cd,
               ROUND(NVL(E.CNTR_STS_EVNT_DT, SYSDATE) - B.CNTR_STS_EVNT_DT) AS TTL_USE_DYS
               ,F.BKG_NO
               ,F.POL_CD
               ,F.POR_CD
               ,F.POD_CD
               ,F.DEL_CD
               ,F.POL_ETD_DT ETD_DT
               ,F.POD_ETA_DT ETA_DT
               ,F.VSL_CD || F.SKD_VOY_NO || F.SKD_DIR_CD VVD   
          FROM MST_CONTAINER A,
               MST_CNTR_STS_HIS B,
               LSE_AGREEMENT C,
               MDM_VENDOR D,
               MST_CNTR_STS_HIS E,
               (SELECT A.LSE_ITCHG_RQST_NO 
                      ,A.LSTM_CD
                      ,B.AGMT_SEQ
                      ,A.LR_VNDR_SEQ
                      ,(SELECT VNDR_LGL_ENG_NM  FROM MDM_VENDOR WHERE VNDR_SEQ = A.LR_VNDR_SEQ) vndr_abbr_nm
                      ,A.RCC_CD
                      ,A.LCC_CD
                      ,A.FM_LOC_CD
                      ,A.LSE_LOC_GRP_CD
                      ,A.TO_LOC_CD 
                      ,A.CNTR_TPSZ_CD 
                      ,B.LSE_ITCHG_AUTH_QTY
                      ,B.LSE_FREE_DYS
                      ,B.PKUP_UT_AMT
                      ,B.PKUP_CR_AMT
                      ,B.LSE_ITCHG_AUTH_NO
                      ,B.LSE_ITCHG_AUTH_SEQ
                      ,A.LSE_ITCHG_RQST_SEQ
                      ,B.CRE_DT CRE_DT
                FROM LSE_EQ_ITCHG_RQST A, LSE_EQ_ITCHG B
                WHERE A.LSE_ITCHG_AUTH_NO = B.LSE_ITCHG_AUTH_NO
                AND A.LSE_ITCHG_AUTH_SEQ = B.LSE_ITCHG_AUTH_SEQ
                AND B.LSE_ITCHG_AUTH_NO = @[auth_no]
                AND B.LSE_ITCHG_AUTH_SEQ = @[auth_seq]
                AND B.DELT_FLG = 'N'
                AND A.LSTM_CD ='OF'
                ) G ,
                BKG_BOOKING F
         WHERE A.CNTR_NO = B.CNTR_NO
           AND B.AGMT_CTY_CD = C.AGMT_CTY_CD
           AND B.AGMT_SEQ = C.AGMT_SEQ
           AND C.VNDR_SEQ = D.VNDR_SEQ
           AND G.LSE_ITCHG_AUTH_NO = B.LSE_ITCHG_AUTH_NO
           AND B.CNTR_STS_CD = 'LSI'
           AND A.HJS_CRE_FLG = 'N'
           AND B.CNTR_NO = E.CNTR_NO (+)
           AND B.CNTR_STS_SEQ = E.PRNR_STS_SEQ (+)
           AND C.LSTM_CD = 'OF'
           AND G.LSE_ITCHG_AUTH_SEQ = B.LSE_ITCHG_AUTH_SEQ
           AND A.BKG_NO = F.BKG_NO(+)
#elseif (${cntr_sts_cd} == 'SO')
SELECT /*+ ORDERED */
               ROWNUM seq_no,
               B.CNTR_NO,
               A.CNTR_TPSZ_CD,
               B.AGMT_CTY_CD||LPAD(B.AGMT_SEQ, 6, '0') AS lsi_agmt_no,
               C.REF_NO lsi_ref_no,
               A.CNMV_STS_CD,
               TO_CHAR(E.CNTR_STS_EVNT_DT,'YYYYMMDD') cntr_sts_evnt_dt,
               E.YD_CD,
               B.RNTL_CHG_FREE_DYS,
               TO_CHAR(B.CNTR_STS_EVNT_DT,'YYYYMMDD') cntr_rtn_evnt_dt,
               B.YD_CD rtn_yd_cd,
               ROUND(NVL(E.CNTR_STS_EVNT_DT, SYSDATE) - B.CNTR_STS_EVNT_DT) AS TTL_USE_DYS
          FROM MST_CONTAINER A,
               MST_CNTR_STS_HIS B,
               LSE_AGREEMENT C,
               MDM_VENDOR D,
               MST_CNTR_STS_HIS E,
               (SELECT A.LSE_ITCHG_RQST_NO 
                      ,A.LSTM_CD
                      ,B.AGMT_SEQ
                      ,A.LR_VNDR_SEQ
                      ,(SELECT VNDR_LGL_ENG_NM  FROM MDM_VENDOR WHERE VNDR_SEQ = A.LR_VNDR_SEQ) vndr_abbr_nm
                      ,A.RCC_CD
                      ,A.LCC_CD
                      ,A.FM_LOC_CD
                      ,A.LSE_LOC_GRP_CD
                      ,A.TO_LOC_CD 
                      ,A.CNTR_TPSZ_CD 
                      ,B.LSE_ITCHG_AUTH_QTY
                      ,B.LSE_FREE_DYS
                      ,B.PKUP_UT_AMT
                      ,B.PKUP_CR_AMT
                      ,B.LSE_ITCHG_AUTH_NO
                      ,B.LSE_ITCHG_AUTH_SEQ
                      ,A.LSE_ITCHG_RQST_SEQ
                      ,B.CRE_DT CRE_DT
                FROM LSE_EQ_ITCHG_RQST A, LSE_EQ_ITCHG B
                WHERE A.LSE_ITCHG_AUTH_NO = B.LSE_ITCHG_AUTH_NO
                AND A.LSE_ITCHG_AUTH_SEQ = B.LSE_ITCHG_AUTH_SEQ
                AND B.LSE_ITCHG_AUTH_NO = @[auth_no]
                AND B.LSE_ITCHG_AUTH_SEQ = @[auth_seq]
                AND B.DELT_FLG = 'N'
                AND A.LSTM_CD ='SO'
                ) G
         WHERE A.CNTR_NO = B.CNTR_NO
           AND B.AGMT_CTY_CD = C.AGMT_CTY_CD
           AND B.AGMT_SEQ = C.AGMT_SEQ
           AND C.VNDR_SEQ = D.VNDR_SEQ
           AND G.LSE_ITCHG_AUTH_NO = B.LSE_ITCHG_AUTH_NO
           AND B.CNTR_STS_CD = 'SBO'
           AND A.HJS_CRE_FLG = 'N'
           AND B.CNTR_NO = E.CNTR_NO (+)
           AND B.CNTR_STS_SEQ = E.PRNR_STS_SEQ (+)
           AND G.LSE_ITCHG_AUTH_SEQ = B.LSE_ITCHG_AUTH_SEQ
 
#end			]]></sql>
			<params>
				<param name="auth_no" type="12" value="" out="N"/>
				<param name="auth_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
