<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PlanMgtDBDAOsearchDisposalPlanHeaderDataRSQL">
			<desc><![CDATA[조회 - Disposal Planning Summary]]></desc>
			<sql><![CDATA[
SELECT A.MNR_PLN_SEQ
           , TO_CHAR(A.CRE_DT, 'YYYY-MM-DD') CRE_DT
           , A.CRE_USR_ID
           , A.MNR_PLN_FLG
           , A.MNR_PLN_OFC_CD
           , A.MNR_PLN_GRP_NO
           , B.CTRL_OFC_CD
           , B.CTRL_OFC_CD AS OFFICE

		   #foreach($key IN ${cntr_tpsz_cd_seqs})
               #set ($col_name1="CNTR"+$velocityCount+"_CHG_VAL")
           , SUM(DECODE(B.EQ_TPSZ_CD, '$key', B.EQ_QTY)) AS $col_name1
           #end

           , SUM(B.EQ_QTY) AS TOTAL
           , 'sheet1' AS SHEET_GUBN
	    FROM MNR_PLN_HDR A
		   , MNR_PLN_DTL B
	   WHERE A.MNR_PLN_SEQ = B.MNR_PLN_SEQ(+)
		 AND A.MNR_GRP_TP_CD = 'DSP'
		 AND B.CTRL_OFC_CD = @[mnr_pln_ofc_cd]
		 AND A.EQ_KND_CD = @[eq_knd_cd]
		 AND A.MNR_PLN_YR = @[mnr_pln_yr]
		 AND A.MNR_PLN_GRP_NO = @[mnr_pln_grp_no]

         #if (${mnr_office_level} == 'L2') 
         AND A.MNR_PLN_FLG = NVL((SELECT MNR_PLN_FLG FROM MNR_PLN_HDR
                                   WHERE MNR_GRP_TP_CD = 'DSP'
                                     AND EQ_KND_CD = @[eq_knd_cd]
                                     AND MNR_PLN_YR = @[mnr_pln_yr]
                                     AND MNR_PLN_GRP_NO = @[mnr_pln_grp_no]
                                     AND MNR_PLN_OFC_CD = @[mnr_pln_ofc_cd]), 'Y')
         #end

	   GROUP BY A.MNR_PLN_SEQ
           , TO_CHAR(A.CRE_DT, 'YYYY-MM-DD')
           , A.CRE_USR_ID
           , A.MNR_PLN_FLG
           , A.MNR_PLN_OFC_CD
           , A.MNR_PLN_GRP_NO
           , B.CTRL_OFC_CD			]]></sql>
			<params>
				<param name="mnr_pln_ofc_cd" type="12" value="" out="N"/>
				<param name="eq_knd_cd" type="12" value="" out="N"/>
				<param name="mnr_pln_yr" type="12" value="" out="N"/>
				<param name="mnr_pln_grp_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
