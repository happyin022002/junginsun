<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChassisMgsetInventoryDBDAOSearchCHSAssetsDetailListRSQL">
			<desc><![CDATA[SearchCHSAssetsDetailList]]></desc>
			<sql><![CDATA[
SELECT
    ROWNUM AS SEQ,
    B.VNDR_ABBR_NM,
    C.VNDR_SEQ AS MFTR_VNDR_SEQ,
    A.EQ_TPSZ_CD AS CNTR_TPSZ_CD,
    A.AGMT_LSTM_CD AS LSTM_CD,
    A.EQ_NO AS CNTR_NO,
    TO_CHAR(A.MFT_DT,'YYYY-MM-DD') AS MFT_DT,
    D.EQ_ASET_STS_CD AS CNTR_STS_CD,    
    (
        SELECT   EQ_LOT_NO 
        FROM CGM_EQ_LOT Z
        WHERE Z.EQ_PFX_CD  = SUBSTR(A.EQ_NO,0,4)
        AND   Z.FM_SER_NO <= TO_NUMBER(SUBSTR(A.EQ_NO,5,6)) 
        AND   Z.TO_SER_NO >= TO_NUMBER(SUBSTR(A.EQ_NO,5,6))                          
    ) AS LOT_NO,    
    F.RCC_CD,
    F.LCC_CD,
    A.CRNT_YD_CD,
    A.CHSS_MVMT_STS_CD AS CNMV_STS_CD,
    TO_CHAR(A.CHSS_MVMT_DT ,'YYYY-MM-DD') AS CNMV_DT,
    A.EQ_SPEC_NO
FROM CGM_EQUIPMENT A, 
     MDM_VENDOR B, 
     CGM_EQ_SPEC C,
     CGM_EQ_STS_HIS D,
     MDM_LOCATION E,
     MDM_EQ_ORZ_CHT F
WHERE 1=1
AND A.EQ_SPEC_NO = C.EQ_SPEC_NO(+)
AND C.VNDR_SEQ   = B.VNDR_SEQ(+)
AND A.EQ_NO      = D.EQ_NO
AND A.EQ_STS_SEQ = D.EQ_STS_SEQ
AND E.SCC_CD     = F.SCC_CD
AND A.CRNT_LOC_CD =  E.LOC_CD  
#if (${mftr_vndr_seq} != '') 
AND C.VNDR_SEQ = @[mftr_vndr_seq]        --Manufacturer-- 
#end
#if (${cntr_tpsz_cd} != '') 
    AND A.EQ_TPSZ_CD  IN ( 
		#foreach($cntrtpszcd in ${vel_tpsz_cd})  
			'$cntrtpszcd',  
			#end  
			'') 
#end
#if (${mnfr_yr} != '') 
AND A.MFT_DT >= TO_DATE(@[mnfr_yr] || '0101 000000','yyyymmdd HH24MISS') AND A.MFT_DT <= TO_DATE(@[mnfr_yr] || '1231 235959','yyyymmdd HH24MISS')
#else
AND A.MFT_DT IS NULL
#end
#if (${fm_prd} != '') 
AND A.MFT_DT >= TO_DATE(@[fm_prd],'YYYYMM') 
#end
#if (${to_prd} != '') 
AND A.MFT_DT <  ADD_MONTHS(TO_DATE(@[to_prd],'YYYYMM'),1)
#end
#if (${lstm_cd} == 'ALL') 
AND A.AGMT_LSTM_CD IN ('OW','LP','OL')
#else
AND A.AGMT_LSTM_CD = @[lstm_cd]
#end
AND DECODE(NVL(@[loc_tp_cd],'ALL'),'ALL','1','RCC',F.RCC_CD,'LCC',F.LCC_CD,'ECC',F.ECC_CD,'SCC',F.SCC_CD) = DECODE(NVL(@[loc_tp_cd],'ALL'),'ALL','1',@[loc_cd])    
#if (${cntr_pfx_cd} != '') 
AND A.EQ_NO LIKE @[cntr_pfx_cd] || '%'
#end
#if (${fm_ser_no} != '') 
AND TO_NUMBER(@[fm_ser_no]) <= TO_NUMBER(SUBSTR(A.EQ_NO,5,6)) 
#end
#if (${to_ser_no} != '') 
AND TO_NUMBER(SUBSTR(A.EQ_NO,5,6)) <= TO_NUMBER(@[to_ser_no])
#end			]]></sql>
			<params>
				<param name="mftr_vndr_seq" type="12" value="" out="N"/>
				<param name="mnfr_yr" type="12" value="" out="N"/>
				<param name="fm_prd" type="12" value="" out="N"/>
				<param name="to_prd" type="12" value="" out="N"/>
				<param name="lstm_cd" type="12" value="" out="N"/>
				<param name="loc_tp_cd" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="cntr_pfx_cd" type="12" value="" out="N"/>
				<param name="fm_ser_no" type="12" value="" out="N"/>
				<param name="to_ser_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
