<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChargeCalculationDBDAOChargeCalculationContainerVORSQL">
			<desc><![CDATA[ChargeCalculationContainerVO]]></desc>
			<sql><![CDATA[
SELECT  ( 
			SELECT  INTG_CD_VAL_DP_DESC 
              FROM  COM_INTG_CD_DTL 
             WHERE  INTG_CD_ID = 'CD03382' 
               AND  INTG_CD_VAL_CTNT = A.DMDT_DELT_RQST_STS_CD 
		) AS INACT_STS_NM
       , A.*
	   --// 2016.07.12 - DAR NO, DAR STATUS CODE 요청에 의해 추가
	   ,AFT_EXPT_DAR_NO
       ,DMDT_EXPT_RQST_STS_CD 
       ,DECODE(TRIM(DMDT_EXPT_RQST_STS_CD), NULL, NULL, '', NULL, DECODE(DMDT_EXPT_RQST_STS_CD, 'R', 'BLUE', 'J', 'RED', 'O', 'RED', 'A', 'BLACK', 'PINK')) DMDT_EXPT_RQST_STS_COLOR
	   ,CASE 
			WHEN DMDT_EXPT_RQST_STS_CD = 'O' THEN 
				(
					SELECT  DECODE(MAX(AFT_BKG_PATH_LVL), 1, 'SCO PIC ', 2, 'OFC O.Manager', 3, 'SSZ/BAG ', 4, 'RHQ PIC ', 5, 'RHQ MGR ', 6, 'HO PIC ', 7, 'HO MGR ', '') || 'Counter-Offer'
					  FROM  DMT_AFT_BKG_APRO_PATH
 			         WHERE  AFT_EXPT_DAR_NO = A.AFT_EXPT_DAR_NO
					   AND  DMDT_EXPT_RQST_STS_CD IS NOT NULL
	 		           AND  AFT_BKG_PATH_CPLS_FLG = 'Y'
				)
			ELSE 
				(
					SELECT  INTG_CD_VAL_DP_DESC 
			          FROM  COM_INTG_CD_DTL
		             WHERE  INTG_CD_ID = 'CD01971'
	    	           AND  INTG_CD_VAL_CTNT = DMDT_EXPT_RQST_STS_CD
				)
		END DMDT_EXPT_RQST_STS_CD_DESC
	   --// 2016.07.12 END
  FROM  (
			SELECT  C.SYS_AREA_GRP_ID SVR_ID
				   ,C.DMDT_CHG_STS_CD

				   --// 2016.07.12 - DAR NO, DAR STATUS CODE 요청에 의해 추가
				   ,(
						SELECT  AA.AFT_EXPT_DAR_NO
                          FROM  DMT_AFT_BKG_ADJ_RQST_DTL 	CC
                               ,DMT_AFT_BKG_CNTR 			BB
                               ,DMT_AFT_BKG_ADJ_RQST 		AA
                         WHERE  CC.BKG_NO              = B.BKG_NO
                           AND  CC.AFT_EXPT_DAR_NO     = BB.AFT_EXPT_DAR_NO
                           AND  CC.AFT_EXPT_ADJ_SEQ    = BB.AFT_EXPT_ADJ_SEQ
                           AND  CC.DMDT_TRF_CD         = C.DMDT_TRF_CD
                           AND  BB.SYS_AREA_GRP_ID     = C.SYS_AREA_GRP_ID
                           AND  BB.CNTR_NO             = C.CNTR_NO
                           AND  BB.CNTR_CYC_NO         = C.CNTR_CYC_NO
                           AND  BB.DMDT_TRF_CD         = C.DMDT_TRF_CD
                           AND  BB.DMDT_CHG_LOC_DIV_CD = C.DMDT_CHG_LOC_DIV_CD
                           AND  BB.CHG_SEQ             = C.CHG_SEQ
                           AND  AA.AFT_EXPT_DAR_NO     = BB.AFT_EXPT_DAR_NO
                           AND  AA.RQST_DT             = 
								(
									SELECT  MAX(RQST_DT)
                                      FROM  DMT_AFT_BKG_ADJ_RQST 		A1
                                           ,DMT_AFT_BKG_ADJ_RQST_DTL 	B1
									 WHERE  A1.AFT_EXPT_DAR_NO = B1.AFT_EXPT_DAR_NO
                                       AND  B1.BKG_NO = CC.BKG_NO
								)
						   AND  DMDT_EXPT_RQST_STS_CD != 'T'
					) AFT_EXPT_DAR_NO
				   ,(
						SELECT  DMDT_EXPT_RQST_STS_CD
                          FROM  DMT_AFT_BKG_ADJ_RQST_DTL 	CC
                               ,DMT_AFT_BKG_CNTR 			BB
                               ,DMT_AFT_BKG_ADJ_RQST 		AA
                         WHERE  CC.BKG_NO              = B.BKG_NO
                           AND  CC.AFT_EXPT_DAR_NO     = BB.AFT_EXPT_DAR_NO
                           AND  CC.AFT_EXPT_ADJ_SEQ    = BB.AFT_EXPT_ADJ_SEQ
                           AND  CC.DMDT_TRF_CD         = C.DMDT_TRF_CD
                           AND  BB.SYS_AREA_GRP_ID     = C.SYS_AREA_GRP_ID
                           AND  BB.CNTR_NO             = C.CNTR_NO
                           AND  BB.CNTR_CYC_NO         = C.CNTR_CYC_NO
                           AND  BB.DMDT_TRF_CD         = C.DMDT_TRF_CD
                           AND  BB.DMDT_CHG_LOC_DIV_CD = C.DMDT_CHG_LOC_DIV_CD
                           AND  BB.CHG_SEQ             = C.CHG_SEQ
                           AND  AA.AFT_EXPT_DAR_NO     = BB.AFT_EXPT_DAR_NO
                           AND  AA.RQST_DT             = 
								(
									SELECT  MAX(RQST_DT)
									  FROM  DMT_AFT_BKG_ADJ_RQST 		A1
                                           ,DMT_AFT_BKG_ADJ_RQST_DTL 	B1
                                 WHERE A1.AFT_EXPT_DAR_NO = B1.AFT_EXPT_DAR_NO
                                   AND B1.BKG_NO = CC.BKG_NO )
						   AND  DMDT_EXPT_RQST_STS_CD != 'T'
					) DMDT_EXPT_RQST_STS_CD
					--// 2016.07.12 END
				   ,(
						SELECT  INACT_RQST_NO
						  FROM  DMT_CHG_DELT_RQST_APRO DD
						 WHERE  DD.SYS_AREA_GRP_ID     = C.SYS_AREA_GRP_ID
						   AND	DD.CNTR_NO		       = C.CNTR_NO
						   AND	DD.CNTR_CYC_NO		   = C.CNTR_CYC_NO
						   AND	DD.DMDT_TRF_CD		   = C.DMDT_TRF_CD
						   AND	DD.DMDT_CHG_LOC_DIV_CD = C.DMDT_CHG_LOC_DIV_CD
						   AND	DD.CHG_SEQ			   = C.CHG_SEQ
						   AND  DD.CHG_OFC_CD          = C.OFC_CD
						   AND  DD.DELT_SEQ            = 
								( 
									SELECT  NVL(MAX(DS.DELT_SEQ), 0) 
									  FROM  DMT_CHG_DELT_RQST_APRO DS
									 WHERE  DS.SYS_AREA_GRP_ID     = DD.SYS_AREA_GRP_ID
									   AND  DS.CNTR_NO	           = DD.CNTR_NO
									   AND  DS.CNTR_CYC_NO	       = DD.CNTR_CYC_NO
									   AND  DS.DMDT_TRF_CD	       = DD.DMDT_TRF_CD
									   AND  DS.DMDT_CHG_LOC_DIV_CD = DD.DMDT_CHG_LOC_DIV_CD
									   AND  DS.CHG_SEQ		       = DD.CHG_SEQ
									   AND  DS.CHG_OFC_CD          = DD.CHG_OFC_CD   
									   AND  DS.DMDT_DELT_RQST_STS_CD != 'C'
								)  
					) AS INACT_RQST_NO
				   ,(
						SELECT  CASE 
									WHEN NVL(MAX(DD.DMDT_DELT_RQST_STS_CD), 'N') IN ('C','N') THEN 'N'
									WHEN 0 < MAX((	
												SELECT  COUNT(1)
												  FROM  DMT_CHG_DELT_PATH
												 WHERE  SYS_AREA_GRP_ID     = DD.SYS_AREA_GRP_ID
												   AND  CNTR_NO             = DD.CNTR_NO
												   AND  CNTR_CYC_NO         = DD.CNTR_CYC_NO
												   AND  DMDT_TRF_CD         = DD.DMDT_TRF_CD
												   AND  DMDT_CHG_LOC_DIV_CD = DD.DMDT_CHG_LOC_DIV_CD
												   AND  CHG_SEQ             = DD.CHG_SEQ
												   AND  CHG_OFC_CD          = DD.CHG_OFC_CD
												   AND  DELT_SEQ            = DD.DELT_SEQ
												   AND  CHG_DELT_PATH_LVL  >=
														(
															SELECT  MAX(CHG_DELT_PATH_LVL)
															  FROM  DMT_CHG_DELT_PATH 
															 WHERE  SYS_AREA_GRP_ID        = DD.SYS_AREA_GRP_ID
															   AND  CNTR_NO                = DD.CNTR_NO
															   AND  CNTR_CYC_NO            = DD.CNTR_CYC_NO
															   AND  DMDT_TRF_CD            = DD.DMDT_TRF_CD
															   AND  DMDT_CHG_LOC_DIV_CD    = DD.DMDT_CHG_LOC_DIV_CD
															   AND  CHG_SEQ                = DD.CHG_SEQ
															   AND  CHG_OFC_CD             = DD.CHG_OFC_CD
															   AND  DELT_SEQ               = DD.DELT_SEQ
															   AND  CHG_DELT_PATH_CPLS_FLG = 'Y'
														)
												   AND  CHG_DELT_STS_CD  = 'A'
											 )) THEN 'X'		--// Charge Deletion 요청 불가, Charge Deletion Cancel 불가
									ELSE MAX(DD.DMDT_DELT_RQST_STS_CD)
								END
									
						  FROM  DMT_CHG_DELT_RQST_APRO DD
						 WHERE  DD.SYS_AREA_GRP_ID     = C.SYS_AREA_GRP_ID
						   AND	DD.CNTR_NO		       = C.CNTR_NO
						   AND	DD.CNTR_CYC_NO		   = C.CNTR_CYC_NO
						   AND	DD.DMDT_TRF_CD		   = C.DMDT_TRF_CD
						   AND	DD.DMDT_CHG_LOC_DIV_CD = C.DMDT_CHG_LOC_DIV_CD
						   AND	DD.CHG_SEQ			   = C.CHG_SEQ
						   AND  DD.CHG_OFC_CD          = C.OFC_CD
						   AND  DD.DELT_SEQ            = 
								( 
									SELECT  NVL(MAX(DS.DELT_SEQ), 0) 
									  FROM  DMT_CHG_DELT_RQST_APRO DS
									 WHERE  DS.SYS_AREA_GRP_ID     = DD.SYS_AREA_GRP_ID
									   AND  DS.CNTR_NO	           = DD.CNTR_NO
									   AND  DS.CNTR_CYC_NO	       = DD.CNTR_CYC_NO
									   AND  DS.DMDT_TRF_CD	       = DD.DMDT_TRF_CD
									   AND  DS.DMDT_CHG_LOC_DIV_CD = DD.DMDT_CHG_LOC_DIV_CD
									   AND  DS.CHG_SEQ		       = DD.CHG_SEQ
									   AND  DS.CHG_OFC_CD          = DD.CHG_OFC_CD   
									   AND  DS.DMDT_DELT_RQST_STS_CD != 'C'
								)  
					) AS DMDT_DELT_RQST_STS_CD
				   ,C.CNTR_NO    
				   ,B.CNTR_TPSZ_CD
				   ,C.FM_MVMT_YD_CD
				   ,C.TO_MVMT_YD_CD
				   ,C.FM_MVMT_STS_CD
				   ,C.TO_MVMT_STS_CD
				   ,C.DMDT_TRF_CD
				   ,C.FT_DYS
				   ,C.FX_FT_OVR_DYS
				   -- 조건추가(S) 2013.12.13
				   ,TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD'), 'YYYYMMDD') - TO_DATE(TO_CHAR(NVL(C.TO_MVMT_DT, C.FT_END_DT), 'YYYYMMDD'), 'YYYYMMDD') AS OVR_DUE
				   -- 조건추가(E)
				   ,C.ORG_FT_OVR_DYS
				   ,TO_CHAR(C.FM_MVMT_DT, 'yyyymmdd') FM_MVMT_DT
				   ,TO_CHAR(C.TO_MVMT_DT, 'yyyymmdd') TO_MVMT_DT
				   ,TO_CHAR(C.FT_CMNC_DT, 'yyyymmdd') FT_CMNC_DT
				   ,TO_CHAR(C.FT_END_DT, 'yyyymmdd') FT_END_DT
				   ,C.BZC_TRF_CURR_CD
				   ,C.ORG_CHG_AMT
				   ,C.SC_RFA_EXPT_AMT    
				   ,C.AFT_EXPT_DC_AMT
				   ,C.BIL_AMT
				   ,B.BKG_NO
				   ,B.BL_NO
				   ,B.VSL_CD || B.SKD_VOY_NO || B.SKD_DIR_CD AS VVD_CD    
				   ,( 
						SELECT  V.VSL_SLAN_CD LANE   
						  FROM  VSK_VSL_SKD V
						 WHERE  B.VSL_CD	 = V.VSL_CD
						   AND  B.SKD_VOY_NO = V.SKD_VOY_NO
						   AND  B.SKD_DIR_CD = V.SKD_DIR_CD
				    ) AS LANE
				   ,B.POR_CD
				   ,B.POL_CD
				   ,B.POD_CD
				   ,B.DEL_CD
				   ,B.BKG_RCV_TERM_CD
				   ,B.BKG_DE_TERM_CD
				   ,B.SC_NO
				   ,B.RFA_NO
				   ,DECODE( BK.AGMT_ACT_CNT_CD||TRIM(TO_CHAR(BK.AGMT_ACT_CUST_SEQ, '000000')), '000000', NULL
				  		   ,BK.AGMT_ACT_CNT_CD||TRIM(TO_CHAR(BK.AGMT_ACT_CUST_SEQ, '000000')) ) AS ACUST	
				   ,DECODE(C.CHG_SEQ, 1, 'G', 'B') AS CHG_TYPE
				   ,NVL(C.UCLM_FLG, 'N')AS UCLM_FLG
				   ,C.CHG_SEQ
				   ,NVL(B.SOC_FLG, 'N') AS SOC_FLG
				   ,CASE
						WHEN C.DMDT_TRF_CD='DMIF' AND C.TO_MVMT_STS_CD='ID' THEN 'L'
						WHEN C.DMDT_TRF_CD='DMIF' AND C.TO_MVMT_STS_CD NOT IN ('ID','CS','DR') THEN 'I'
						WHEN C.DMDT_TRF_CD='DMOF' AND C.DMDT_CHG_LOC_DIV_CD <> 'POL' THEN 'L'
						WHEN C.DMDT_TRF_CD='DMOF' AND C.DMDT_CHG_LOC_DIV_CD='POL' THEN 'I'
				    END AS LI
				   ,(
						SELECT  NVL(HLG_TP_CD, 'N')
						  FROM  BKG_EUR_TRO
						 WHERE  BKG_NO			  = B.BKG_NO
						   AND  IO_BND_CD		  = SUBSTR(C.DMDT_TRF_CD, 3, 1)
						   AND  NVL(CXL_FLG, 'N') = 'N'
						   AND  CNTR_NO	          = C.CNTR_NO
						   AND  ROWNUM            = 1 
					) AS CH
				   ,(
						SELECT  'Y'
						  FROM  DUAL      
						 WHERE  EXISTS
								(
									SELECT  BDD.RLSE_STS_CD
									  FROM  BKG_DO     BDO
										   ,BKG_DO_DTL BDD
									 WHERE  BDO.BKG_NO        = BDD.BKG_NO
									   AND  BDO.BKG_NO        = B.BKG_NO
									   AND  BDD.RLSE_STS_CD IN ('R', 'I')
								)
					) AS D_O
				   ,(	
						SELECT  BDD.EVNT_OFC_CD
						  FROM  BKG_DO     BDO
							   ,BKG_DO_DTL BDD
						 WHERE  BDO.BKG_NO	= BDD.BKG_NO   
						   AND  BDO.BKG_NO	= B.BKG_NO   
						   AND  BDD.RLSE_STS_CD IN ('R', 'I')
						   AND  ROWNUM = 1 
					) AS RLSE_OFC
	               ,BR.CLT_OFC_CD
	               ,NVL(C.OFC_TRNS_FLG, 'N') AS OFC_TRNS_FLG
	               ,(
						SELECT  'C'
						  FROM  DUAL
						 WHERE  EXISTS
								(
									SELECT  1
									  FROM  BKG_ROLL_OVR R
									 WHERE  R.BKG_NO = B.BKG_NO    			
									   AND  R.ROLL_OVR_RSN_CD IN ('C', 'H')
								)
					) AS ROLL_OVR	
                   ,C.WEB_IND_FLG
                   ,C.CNTR_CYC_NO
                   ,C.DMDT_CHG_LOC_DIV_CD	
	               ,C.OFC_CD
	               ,C.OFC_RHQ_CD
				   ,(
						CASE 
							WHEN   (C.DMDT_TRF_CD IN ('DTIC', 'CTIC') AND SUBSTR(BK.DEL_CD,1,2) = 'US' AND BK.DE_TERM_CD = 'Y') 
								OR (C.DMDT_TRF_CD IN ('DTOC', 'CTOC') AND SUBSTR(BK.POR_CD,1,2) = 'US' AND BK.RCV_TERM_CD = 'Y') 
								THEN 
									(SELECT	LPAD(VNDR_SEQ,6,'0') AS VNDR_CD FROM	MDM_VENDOR WHERE	VNDR_SEQ = C.VNDR_SEQ AND	DELT_FLG <> 'Y')
                             
							ELSE 
								CASE 
									WHEN SUBSTR(C.DMDT_TRF_CD,3,1) = 'I' AND SUBSTR(BK.DEL_CD,1,2) IN ('US', 'CA') 
										THEN  
                                            NVL(( SELECT CUST_CNT_CD||LPAD(CUST_SEQ,6,'0') 
                                                                 FROM BKG_CUSTOMER 
                                                                WHERE BKG_NO = BK.BKG_NO 
                                                                  AND BKG_CUST_TP_CD = 'C'
																  AND CUST_CNT_CD IS NOT NULL AND CUST_SEQ IS NOT NULL),
                                                             ( SELECT CUST_CNT_CD||LPAD(CUST_SEQ,6,'0')
                                                                 FROM BKG_CUSTOMER 
                                                                WHERE BKG_NO = BK.BKG_NO 
                                                                  AND BKG_CUST_TP_CD = 'N'))
                                                                  
                                    WHEN SUBSTR(C.DMDT_TRF_CD,3,1) = 'O' AND SUBSTR(BK.POR_CD,1,2) IN ('US', 'CA') THEN  
                                            ( SELECT CUST_CNT_CD||LPAD(CUST_SEQ,6,'0') 
                                                                 FROM BKG_CUSTOMER 
                                                                WHERE BKG_NO = BK.BKG_NO 
                                                                  AND BKG_CUST_TP_CD = 'S')
      
                                    ELSE 
                                          NVL(
											   (SELECT ACT_CUST_CNT_CD || LPAD(ACT_CUST_SEQ, 6, '0')
													FROM INV_AR_MN AR
													WHERE BKG_NO = BK.BKG_NO
													AND IO_BND_CD = SUBSTR(C.DMDT_TRF_CD,3,1)
													AND AR_IF_NO = (SELECT MAX(AR_IF_NO)
																			FROM INV_AR_MN
																			WHERE BKG_NO = BK.BKG_NO
																			AND   IO_BND_CD = SUBSTR(C.DMDT_TRF_CD,3,1)
																	)
												), NVL(DECODE(C.ACT_CNT_CD, '00', '', C.ACT_CNT_CD)|| DECODE(C.ACT_CUST_SEQ,NULL,'',0,'',LPAD(C.ACT_CUST_SEQ, 6, '0')), '')
											)
                                    END
						END 
					) AS PAYER_CD
				   ,(
						CASE 
							WHEN   (C.DMDT_TRF_CD IN ('DTIC', 'CTIC') AND SUBSTR(BK.DEL_CD,1,2) = 'US' AND BK.DE_TERM_CD = 'Y') 
							    OR (C.DMDT_TRF_CD IN ('DTOC', 'CTOC') AND SUBSTR(BK.POR_CD,1,2) = 'US' AND BK.RCV_TERM_CD = 'Y') 
								THEN 
									(SELECT	VNDR_LGL_ENG_NM FROM MDM_VENDOR WHERE VNDR_SEQ = C.VNDR_SEQ AND DELT_FLG <> 'Y' AND ROWNUM = 1)
                             
							ELSE 
								CASE 
									WHEN SUBSTR(C.DMDT_TRF_CD,3,1) = 'I' AND SUBSTR(BK.DEL_CD,1,2) IN ('US', 'CA') 
										THEN  
                                            NVL(( SELECT CUST_LGL_ENG_NM
                                                                 FROM BKG_CUSTOMER A, MDM_CUSTOMER B
                                                                WHERE A.BKG_NO = BK.BKG_NO 
                                                                  AND A.BKG_CUST_TP_CD = 'C'
																  AND A.CUST_CNT_CD IS NOT NULL AND A.CUST_SEQ IS NOT NULL
                                                                  AND A.CUST_CNT_CD = B.CUST_CNT_CD
                                                                  AND A.CUST_SEQ = B.CUST_SEQ 
                                                                  AND ROWNUM = 1 ),
                                                             ( SELECT CUST_LGL_ENG_NM
                                                                 FROM BKG_CUSTOMER A, MDM_CUSTOMER B
                                                                WHERE A.BKG_NO = BK.BKG_NO 
                                                                  AND A.BKG_CUST_TP_CD = 'N'
                                                                  AND A.CUST_CNT_CD = B.CUST_CNT_CD
                                                                  AND A.CUST_SEQ = B.CUST_SEQ 
                                                                  AND ROWNUM = 1 ))
                                                                  
                                    WHEN SUBSTR(C.DMDT_TRF_CD,3,1) = 'O' AND SUBSTR(BK.POR_CD,1,2) IN ('US', 'CA') 
										THEN  
                                            ( SELECT CUST_LGL_ENG_NM
                                                                 FROM BKG_CUSTOMER A, MDM_CUSTOMER B
                                                                WHERE A.BKG_NO = BK.BKG_NO 
                                                                  AND A.BKG_CUST_TP_CD = 'S'
                                                                  AND A.CUST_CNT_CD = B.CUST_CNT_CD
                                                                  AND A.CUST_SEQ = B.CUST_SEQ 
                                                                  AND ROWNUM = 1 )
      
                                    ELSE 
                                          NVL((SELECT CUST_LGL_ENG_NM
											FROM MDM_CUSTOMER
                                            WHERE (CUST_SEQ, CUST_CNT_CD) = (
												SELECT ACT_CUST_SEQ, ACT_CUST_CNT_CD
												FROM INV_AR_MN AR
												WHERE BKG_NO = BK.BKG_NO
												AND IO_BND_CD = SUBSTR(C.DMDT_TRF_CD,3,1)
												AND AR_IF_NO = (
                                                	SELECT MAX(AR_IF_NO)
													FROM INV_AR_MN
													WHERE BKG_NO = BK.BKG_NO
													AND IO_BND_CD = SUBSTR(C.DMDT_TRF_CD,3,1)
												)
											)
											AND ROWNUM = 1
										), (SELECT CUST_LGL_ENG_NM
											FROM MDM_CUSTOMER
                                            WHERE CUST_CNT_CD = C.ACT_CNT_CD 
											AND CUST_SEQ = C.ACT_CUST_SEQ))
                                END
						END 
					) AS PAYER_NM
				   ,BS.CUST_CNT_CD || TRIM(TO_CHAR(BS.CUST_SEQ, '000000')) SHIPPER_CD 
				   ,REPLACE(BS.CUST_NM, CHR(13) || CHR(10), ' ') SHIPPER_NM   
				   ,DECODE(BC.CUST_CNT_CD || TRIM(TO_CHAR(BC.CUST_SEQ, '000000')), '000000', NULL, BC.CUST_CNT_CD || TRIM(TO_CHAR(BC.CUST_SEQ, '000000'))) CNEE_CD
				   ,REPLACE(BC.CUST_NM, CHR(13) || CHR(10), ' ') CNEE_NM
				   ,DECODE(BN.CUST_CNT_CD || TRIM(TO_CHAR(BN.CUST_SEQ, '000000')), '000000', NULL, BN.CUST_CNT_CD || TRIM(TO_CHAR(BN.CUST_SEQ, '000000'))) NTFY_CD
				   ,NVL(RTRIM(REPLACE(REPLACE(BN.CUST_NM, CHR(34), ''), CHR(13)||CHR(10), ' ')), '-') NTFY_NM
				  ,(
						SELECT  I.ACT_CUST_CNT_CD || TRIM(TO_CHAR(ACT_CUST_SEQ, '000000'))
						  FROM  INV_AR_MN I
						 WHERE  I.BKG_NO = B.BKG_NO
						   AND  I.IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
						   AND  AR_IF_NO = 
								(
									SELECT  MAX(AR_IF_NO) 
									  FROM  INV_AR_MN
									 WHERE  BKG_NO = B.BKG_NO
									   AND  IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
								)
						   AND  ROWNUM  = 1
					) AS AR_ACT_CD
				   ,(
						SELECT  MC.CUST_LGL_ENG_NM
						  FROM  MDM_CUSTOMER 	MC
							   ,INV_AR_MN 		I
						 WHERE  MC.CUST_CNT_CD = I.ACT_CUST_CNT_CD
						   AND  MC.CUST_SEQ    = I.ACT_CUST_SEQ
						   AND  I.BKG_NO       = B.BKG_NO
						   AND  I.IO_BND_CD    = SUBSTR(C.DMDT_TRF_CD, 3, 1)
						   AND  AR_IF_NO	   = 
								(
									SELECT	MAX(AR_IF_NO) 
									FROM	INV_AR_MN
									WHERE	BKG_NO = B.BKG_NO
									AND		IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
								)
						   AND  ROWNUM  = 1
					) AS AR_ACT_NM
				   ,DECODE(TRIM(TO_CHAR(C.VNDR_SEQ, '000000')), '000000', NULL, TRIM(TO_CHAR(C.VNDR_SEQ, '000000'))) AS SVC_PROVDR_CD
				   ,(
						SELECT  MV.VNDR_LGL_ENG_NM
						  FROM  MDM_VENDOR MV
						 WHERE  MV.VNDR_SEQ = C.VNDR_SEQ
					) AS SVC_PROVDR_NM
				   ,M.AR_CURR_CD
				   
			  FROM  DMT_CHG_BKG_CNTR   B
                   ,DMT_CHG_CALC       C
                   ,BKG_BOOKING        BK
                   ,BKG_RATE           BR
                   ,MDM_ORGANIZATION   M
                   ,BKG_CUSTOMER       BS
                   ,BKG_CUSTOMER       BC
                   ,BKG_CUSTOMER       BN
        
			 WHERE  B.SYS_AREA_GRP_ID = C.SYS_AREA_GRP_ID
               AND  B.CNTR_NO         = C.CNTR_NO
               AND  B.CNTR_CYC_NO     = C.CNTR_CYC_NO
               AND  B.BKG_NO          = BK.BKG_NO
               AND  B.BKG_NO		  = BR.BKG_NO(+)
               AND  C.OFC_CD          = M.OFC_CD
               AND  C.OFC_CD          = @[ofc_cd]
               AND  C.DMDT_TRF_CD   IN (
						#foreach( $trf_cd in ${trf_cd_list} )
							#if($velocityCount < $trf_cd_list.size()) '$trf_cd', #else '$trf_cd' #end
						#end
                    )
               AND  NOT (C.DUL_TP_EXPT_FLG = 'Y' AND SUBSTR(C.DMDT_TRF_CD, 1, 1) = 'D')
               AND  B.BKG_NO			 = BS.BKG_NO(+)
               AND  BS.BKG_CUST_TP_CD(+) = 'S'
               AND  B.BKG_NO             = BC.BKG_NO(+)
               AND  BC.BKG_CUST_TP_CD(+) = 'C'
               AND  B.BKG_NO             = BN.BKG_NO(+)
               AND  BN.BKG_CUST_TP_CD(+) = 'N'
               AND  C.DMDT_CHG_LOC_DIV_CD <> 'SZP'

			   #if (${dmdt_chg_sts_cd} != '') 
			   AND  (1 = 0
				   #foreach( $chg_sts_cd in ${chg_sts_cd_list} )	
					   #if (${cond_type} != 'date') ## && $chg_sts_cd != 'A')
							OR C.DMDT_CHG_STS_CD = '$chg_sts_cd'
					   #else
							#if ($chg_sts_cd == 'C' || $chg_sts_cd == 'F' || $chg_sts_cd == 'R')
								OR (C.DMDT_CHG_STS_CD = '$chg_sts_cd'
									AND C.TO_MVMT_DT BETWEEN TO_DATE(@[fm_mvmt_dt], 'yyyymmdd') 
														 AND TO_DATE(@[to_mvmt_dt], 'yyyymmdd') + 0.99999 )
							#elseif ($chg_sts_cd == 'L')
								OR (C.DMDT_CHG_STS_CD = 'L'
									AND C.FM_MVMT_DT BETWEEN TO_DATE(@[fm_mvmt_dt], 'yyyymmdd') 
														AND TO_DATE(@[to_mvmt_dt], 'yyyymmdd') + 0.99999 ) 
							#elseif ($chg_sts_cd == 'U')
								OR (C.DMDT_CHG_STS_CD = 'U'
									AND C.FM_MVMT_DT BETWEEN TO_DATE(@[fm_mvmt_dt], 'yyyymmdd') 
														AND TO_DATE(@[to_mvmt_dt], 'yyyymmdd') + 0.99999 ) 
							#elseif ($chg_sts_cd == 'E')
								OR (C.DMDT_CHG_STS_CD = 'E'
									AND ( (C.FM_MVMT_DT BETWEEN TO_DATE(@[fm_mvmt_dt], 'yyyymmdd') 
														AND TO_DATE(@[to_mvmt_dt], 'yyyymmdd') + 0.99999 )
										 OR (C.TO_MVMT_DT BETWEEN TO_DATE(@[fm_mvmt_dt], 'yyyymmdd') 
														AND TO_DATE(@[to_mvmt_dt], 'yyyymmdd') + 0.99999) ) )
							#elseif ($chg_sts_cd == 'T')
								OR C.DMDT_CHG_STS_CD = 'L' 
							#end
					   #end
				   #end
			        )
			   #end

			   #if (${chg_type} == 'G')
               AND  C.CHG_SEQ = 1
			   #elseif (${chg_type} == 'B') 
               AND  C.CHG_SEQ > 1
			   #end

			   #if (${fx_ft_ovr_dys} != '0') 
			   AND  C.FX_FT_OVR_DYS >= TO_NUMBER(@[fx_ft_ovr_dys])
			   #end

-- 조건추가(S) 2013.09.13
			   #if(${uclm_flg} != 'ALL')          
			   AND  NVL(C.UCLM_FLG, 'N') = @[uclm_flg]
			   #end
-- 조건추가(E)

			   #if (${cond_type} == 'date')
				   #if (${fm_mvmt_yd_cd} != '')
						##${fm_mvmt_yd_cd}
						#if ($fm_mvmt_yd_cd.length() == 5)
							AND SUBSTR(C.FM_MVMT_YD_CD, 1, 5) = @[fm_mvmt_yd_cd]
						#else
							AND C.FM_MVMT_YD_CD = @[fm_mvmt_yd_cd]
						#end
				   #elseif (${to_mvmt_yd_cd} != '')
						##${to_mvmt_yd_cd}
						#if ($to_mvmt_yd_cd.length() == 5)
							AND SUBSTR(C.TO_MVMT_YD_CD,1, 5) = @[to_mvmt_yd_cd]
						#else
							AND C.TO_MVMT_YD_CD = @[to_mvmt_yd_cd]
						#end
				   #end
			   #else
			   AND  C.DMDT_CHG_STS_CD NOT IN ('D','N','U','I')
			   #end

			   #if (${cond_type} == 'vvd_cd')
				   #if (${vvd_cd} != '')
				   AND  B.VSL_CD     = SUBSTR(@[vvd_cd],1,4) 
				   AND  B.SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4) 
				   AND  B.SKD_DIR_CD = SUBSTR(@[vvd_cd],9) 
				   #end
	
				   #if (${pod_cd} != '' || ${pol_cd} != '')
				   AND  (1=0
						#if (${pod_cd} != '')
						OR  B.POD_CD = @[pod_cd]
						#end
						#if (${pol_cd} != '')
						OR  B.POL_CD = @[pol_cd]
						#end
						)
				   #end

				   #if (${dem_type} == 'I') 
				   AND ((C.DMDT_TRF_CD='DMIF' AND C.TO_MVMT_STS_CD NOT IN ('ID','CS','DR'))
						OR (C.DMDT_TRF_CD='DMOF' AND C.DMDT_CHG_LOC_DIV_CD='POL')
						OR (C.DMDT_TRF_CD IN ('CTOC','CTIC','DTOC','DTIC'))
					   )
				   #elseif (${dem_type} == 'L') 
				   AND ((C.DMDT_TRF_CD='DMIF' AND C.TO_MVMT_STS_CD='ID')
						OR (C.DMDT_TRF_CD='DMOF' AND C.DMDT_CHG_LOC_DIV_CD<>'POL')
						OR (C.DMDT_TRF_CD IN ('CTOC','CTIC','DTOC','DTIC'))
					   )
				   #end
			   #end

			   #if (${cond_type} == 'cntr')
				   #if (${bkg_no} != '')	
				   AND B.BKG_NO IN (
						#foreach( $bkg_cd in ${bkg_no_list} )
							#if($velocityCount < $bkg_no_list.size()) '$bkg_cd', #else '$bkg_cd' #end
						#end
						)
				   #end

				   #if (${bl_no} != '')
				   AND B.BL_NO IN (
						#foreach( $bl_cd in ${bl_no_list} )
							#if($velocityCount < $bl_no_list.size()) '$bl_cd', #else '$bl_cd' #end
						#end
						)
				   #end

				   #if (${cntr_no} != '')
				   AND C.CNTR_NO IN (
						#foreach( $cntr_cd in ${cntr_no_list} )
							#if($velocityCount < $cntr_no_list.size()) '$cntr_cd', #else '$cntr_cd' #end
						#end
						)
				   #end
			   #end

			   #if (${cust_cd} != '')
				   #if (${cust_type} == '')
				   AND  (
								C.ACT_CNT_CD	= SUBSTR(@[cust_cd],1,2)
							AND C.ACT_CUST_SEQ	= LTRIM(SUBSTR(@[cust_cd],3),'0')
						OR		BS.CUST_CNT_CD	= SUBSTR(@[cust_cd],1,2)
							AND BS.CUST_SEQ		= LTRIM(SUBSTR(@[cust_cd],3),'0')
						OR		BC.CUST_CNT_CD	= SUBSTR(@[cust_cd],1,2)
							AND BC.CUST_SEQ		= LTRIM(SUBSTR(@[cust_cd],3),'0')
						OR 		BN.CUST_CNT_CD	= SUBSTR(@[cust_cd],1,2)
							AND BN.CUST_SEQ		= LTRIM(SUBSTR(@[cust_cd],3),'0')
						OR (
							EXISTS (
								SELECT  'X'
								  FROM  INV_AR_MN I
								 WHERE  I.BKG_NO	= B.BKG_NO
								   AND  I.IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
								   AND  AR_IF_NO	= 
										(
											SELECT  MAX(AR_IF_NO) 
											  FROM  INV_AR_MN
											 WHERE  BKG_NO = B.BKG_NO
											   AND  IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
										)
								   AND  ROWNUM  = 1
								   AND  I.ACT_CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
								   AND  I.ACT_CUST_SEQ    = LTRIM(SUBSTR(@[cust_cd],3),'0')
									)
						    )
						)
				   #elseif (${cust_type} == 'P')
				   AND C.ACT_CNT_CD   = SUBSTR(@[cust_cd],1,2)
				   AND C.ACT_CUST_SEQ = LTRIM(SUBSTR(@[cust_cd],3),'0')
				   #elseif (${cust_type} == 'S') 
				   AND  BS.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
				   AND  BS.CUST_SEQ    = LTRIM(SUBSTR(@[cust_cd],3),'0')
				   #elseif (${cust_type} == 'C') 
				   AND  BC.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
				   AND  BC.CUST_SEQ    = LTRIM(SUBSTR(@[cust_cd],3),'0')
				   #elseif (${cust_type} == 'N') 
				   AND  BN.CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
				   AND  BN.CUST_SEQ    = LTRIM(SUBSTR(@[cust_cd],3),'0')
				   #elseif (${cust_type} == 'A')		
				   AND  EXISTS 
						(
							SELECT  'X'
							  FROM  INV_AR_MN I
							 WHERE  I.BKG_NO	= B.BKG_NO
							   AND  I.IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
							   AND  AR_IF_NO	= 
									(
										SELECT  MAX(AR_IF_NO) 
										  FROM  INV_AR_MN
										 WHERE  BKG_NO = B.BKG_NO
										   AND  IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
									)
							   AND  ROWNUM  = 1
							   AND  I.ACT_CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
							   AND  I.ACT_CUST_SEQ    = LTRIM(SUBSTR(@[cust_cd],3),'0')
						)
				   #end
			   #end

			   #if (${svc_provdr} != '') 
			   AND  C.VNDR_SEQ = LTRIM(@[svc_provdr],'0')
			   #end

			   #if (${sc_no} != '') 
			   AND  B.SC_NO = @[sc_no]
			   #end

			   #if (${rfa_no} != '') 
			   AND  B.RFA_NO = @[rfa_no]
			   #end

			   #if (${inact_no} != '')
			   AND  EXISTS 
					( 
						SELECT  'X' 
						  FROM  DMT_CHG_DELT_RQST_APRO
					     WHERE  1=1
						   AND  INACT_RQST_NO IN (
							#foreach( $inact_no in ${inact_no_list} )
								#if($velocityCount < $inact_no_list.size()) '$inact_no', #else '$inact_no' #end
							#end
							)
						   AND  SYS_AREA_GRP_ID     = C.SYS_AREA_GRP_ID
						   AND  CNTR_NO             = C.CNTR_NO
						   AND  CNTR_CYC_NO         = C.CNTR_CYC_NO
						   AND  DMDT_TRF_CD         = C.DMDT_TRF_CD
						   AND  DMDT_CHG_LOC_DIV_CD = C.DMDT_CHG_LOC_DIV_CD
						   AND  CHG_SEQ             = C.CHG_SEQ
					)
			   #end

			ORDER BY B.CNTR_NO
		) A
 WHERE  1 = 1
 
   #if (${inact_sts_cd} != '')
   AND  A.DMDT_DELT_RQST_STS_CD IN (
		#foreach( $inact_sts_cd in ${inact_sts_cd_list} )
			#if($velocityCount < $inact_sts_cd_list.size()) '$inact_sts_cd', #else '$inact_sts_cd' #end
		#end
		)
   #end

--// 2016.07.12 - DAR NO, DAR STATUS CODE 요청에 의해 추가

   #if (${aft_dar_sts_cd_list} != '')
	   #if (${aft_dar_sts_all_flg} != '')
	   AND  (DMDT_EXPT_RQST_STS_CD IS NOT NULL AND DMDT_EXPT_RQST_STS_CD <>'T')
	   #else
	   AND ( 1=0
				#if (${aft_dar_sts_process_flg} != '')
				OR DMDT_EXPT_RQST_STS_CD NOT IN ('A', 'R', 'J', 'O', 'T')
				#end
				OR DMDT_EXPT_RQST_STS_CD IN (
				#foreach($aft_dar_sts_cd in ${aft_dar_sts_cd_list} )
					#if($velocityCount < $aft_dar_sts_cd_list.size())
						'$aft_dar_sts_cd', 
					#else 
						'$aft_dar_sts_cd' 
					#end
				#end
				)
			)
	   #end
   #end

--// 2016.07.12 END			]]></sql>
			<params>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="fm_mvmt_dt" type="12" value="" out="N"/>
				<param name="to_mvmt_dt" type="12" value="" out="N"/>
				<param name="fx_ft_ovr_dys" type="12" value="" out="N"/>
				<param name="uclm_flg" type="12" value="" out="N"/>
				<param name="fm_mvmt_yd_cd" type="12" value="" out="N"/>
				<param name="to_mvmt_yd_cd" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="cust_cd" type="12" value="" out="N"/>
				<param name="svc_provdr" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
				<param name="rfa_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
