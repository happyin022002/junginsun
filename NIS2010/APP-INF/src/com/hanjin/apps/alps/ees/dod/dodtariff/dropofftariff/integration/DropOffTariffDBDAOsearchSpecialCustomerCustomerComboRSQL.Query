<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DropOffTariffDBDAOsearchSpecialCustomerCustomerComboRSQL">
			<desc><![CDATA[Tariff Creation Special Customer TAB에서 RFA NO, SC NO에 종속된 Customer Combo Box 데이터 조회]]></desc>
			<sql><![CDATA[
SELECT A.CUST_CNT_CD || LPAD(A.CUST_SEQ, 6, '0') AS CUST_ID
     , (SELECT SUBSTR(M.CUST_LGL_ENG_NM, 0, 20) CUST_LGL_ENG_NM FROM MDM_CUSTOMER M WHERE M.CUST_CNT_CD = A.CUST_CNT_CD AND M.CUST_SEQ=A.CUST_SEQ) CUST_NM
#if(${rfa_no} != '')
      ,(SELECT /*+ DRIVING_SITE (MN) USE_NL(MN HDR CUST) */
            	        CUST.CUST_LGL_ENG_NM CTRT_PTY_NM
                FROM MDM_CUSTOMER CUST
              	   ,PRI_RP_MN MN
              	   ,PRI_RP_HDR HDR
               WHERE MN.CTRT_CUST_CNT_CD = CUST.CUST_CNT_CD
               AND MN.CTRT_CUST_SEQ    = CUST.CUST_SEQ
               AND CUST.DELT_FLG		= 'N'
               AND CNTR_DIV_FLG 		= 'Y' 
               AND MN.RFA_CTRT_TP_CD IN ('C','S')
               AND HDR.PROP_NO 	 	= MN.PROP_NO
               AND MN.AMDT_SEQ = ( SELECT /*+ INDEX_DESC(A XPKPRI_RP_MN)*/ AMDT_SEQ FROM PRI_RP_MN A WHERE MN.PROP_NO = PROP_NO AND ROWNUM = 1)
               AND HDR.RFA_NO = B.RFA_NO) CUST_NM2
#end
#if(${sc_no} != '')
      ,(SELECT /*+ DRIVING_SITE (MN) USE_NL(MN HDR CUST) */
                   CUST.CUST_LGL_ENG_NM CTRT_PTY_NM
              FROM MDM_CUSTOMER CUST
                ,PRI_SP_MN MN
                ,PRI_SP_HDR HDR
              WHERE MN.REAL_CUST_CNT_CD = CUST.CUST_CNT_CD
              AND MN.REAL_CUST_SEQ    = CUST.CUST_SEQ
              AND CUST.DELT_FLG		= 'N'
              AND CNTR_DIV_FLG 		= 'Y' 
              AND HDR.PROP_NO 	 	= MN.PROP_NO
              AND MN.AMDT_SEQ = ( SELECT /*+ INDEX_DESC(A XPKPRI_RP_MN)*/ AMDT_SEQ FROM PRI_SP_MN A WHERE MN.PROP_NO = PROP_NO AND ROWNUM = 1)
              AND HDR.SC_NO = B.SC_NO) CUST_NM2
#end

#if(${rfa_no} != '')
  FROM PRI_RP_SCP_RT_ACT_CUST A, PRI_RP_HDR B
 WHERE A.PROP_NO = B.PROP_NO
   AND B.RFA_NO = @[rfa_no]
   AND A.AMDT_SEQ = (SELECT MAX(C.AMDT_SEQ)
                      FROM  PRI_RP_PROG C
                      WHERE A.PROP_NO = C.PROP_NO
                        AND A.PRC_PROG_STS_CD = 'A')
#end
#if(${sc_no} != '')
  FROM PRI_SP_SCP_RT_ACT_CUST A, PRI_SP_HDR B
 WHERE A.PROP_NO = B.PROP_NO
   AND B.SC_NO = @[sc_no]
   AND A.AMDT_SEQ = (SELECT MAX(C.AMDT_SEQ)
                      FROM  PRI_SP_PROG C
                      WHERE A.PROP_NO = C.PROP_NO
                        AND A.PRC_PROG_STS_CD = 'A')
#end
   AND A.SRC_INFO_CD <> 'AD'
 ORDER BY A.CMDT_HDR_SEQ, A.ACT_CUST_SEQ			]]></sql>
			<params>
				<param name="rfa_no" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
