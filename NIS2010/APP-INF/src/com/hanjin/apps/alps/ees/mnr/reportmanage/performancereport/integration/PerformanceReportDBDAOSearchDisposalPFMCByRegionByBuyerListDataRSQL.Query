<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PerformanceReportDBDAOSearchDisposalPFMCByRegionByBuyerListDataRSQL">
			<desc><![CDATA[SearchDisposalPFMCByRegionByBuyerListDataRSQL]]></desc>
			<sql><![CDATA[
WITH PARAM 
AS (
    SELECT EQ_KIND,
           MAX(DECODE(RNK, 1, TPSZ)) TS01, MAX(DECODE(RNK, 2, TPSZ)) TS02, MAX(DECODE(RNK, 3, TPSZ)) TS03, MAX(DECODE(RNK, 4, TPSZ)) TS04, MAX(DECODE(RNK, 5, TPSZ)) TS05,
           MAX(DECODE(RNK, 6, TPSZ)) TS06, MAX(DECODE(RNK, 7, TPSZ)) TS07, MAX(DECODE(RNK, 8, TPSZ)) TS08, MAX(DECODE(RNK, 9, TPSZ)) TS09, MAX(DECODE(RNK, 10, TPSZ)) TS10,
           MAX(DECODE(RNK, 11, TPSZ)) TS11, MAX(DECODE(RNK, 12, TPSZ)) TS12, MAX(DECODE(RNK, 13, TPSZ)) TS13, MAX(DECODE(RNK, 14, TPSZ)) TS14, MAX(DECODE(RNK, 15, TPSZ)) TS15,
           MAX(DECODE(RNK, 16, TPSZ)) TS16, MAX(DECODE(RNK, 17, TPSZ)) TS17, MAX(DECODE(RNK, 18, TPSZ)) TS18, MAX(DECODE(RNK, 19, TPSZ)) TS19, MAX(DECODE(RNK, 20, TPSZ)) TS20,
           MAX(DECODE(RNK, 21, TPSZ)) TS21, MAX(DECODE(RNK, 22, TPSZ)) TS22, MAX(DECODE(RNK, 23, TPSZ)) TS23, MAX(DECODE(RNK, 24, TPSZ)) TS24, MAX(DECODE(RNK, 25, TPSZ)) TS25, 
           MAX(DECODE(RNK, 26, TPSZ)) TS26, MAX(DECODE(RNK, 27, TPSZ)) TS27, MAX(DECODE(RNK, 28, TPSZ)) TS28, MAX(DECODE(RNK, 29, TPSZ)) TS29, MAX(DECODE(RNK, 30, TPSZ)) TS30                     
    FROM (
             SELECT  EQ_KIND, TPSZ, ROW_NUMBER() OVER(ORDER BY EQ_KIND, DP_SEQ) RNK
             FROM
                   (
                        SELECT 'U' EQ_KIND,  A.CNTR_TPSZ_CD    TPSZ, A.RPT_DP_SEQ DP_SEQ
                        FROM MDM_CNTR_TP_SZ A
                        WHERE 'U' = @[eq_kind] 
                        UNION ALL
                        SELECT A.EQ_KND_CD EQ_KIND, A.EQ_TPSZ_CD    TPSZ, A.DP_SEQ DP_SEQ
                        FROM CGM_EQ_TP_SZ A
                        WHERE A.EQ_KND_CD = @[eq_kind] 
                    )                                           
   
         )       
    GROUP BY EQ_KIND
    ), DUMMY_COL AS (
       SELECT 'Q' DCOL FROM DUAL  --QTY
       UNION ALL
       SELECT 'S' DCOL FROM DUAL  --AMOUNT
       UNION ALL 
       SELECT 'Z' DCOL FROM DUAL  --AVG
    ), DISP_QTY AS(    
       SELECT  MNR_COMMON_PKG.MNR_CONV_PARTNER_CD_FNC(DD.MNR_PRNR_SEQ, DD.MNR_PRNR_CNT_CD) BUYER_CD,
               MAX(MP.MNR_PRNR_LGL_ENG_NM) BUYER_NM,
               DH.RQST_OFC_CD OFC_CD, 
			   DH.CURR_CD,
               C.DCOL, 
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS01, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS01, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS01, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS01, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS01_P, 
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS02, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS02, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS02, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS02, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS02_P, 
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS03, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS03, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS03, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS03, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS03_P,                                     
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS04, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS04, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS04, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS04, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS04_P,                                     
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS05, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS05, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS05, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS05, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS05_P, 
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS06, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS06, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS06, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS06, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS06_P,      
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS07, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS07, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS07, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS07, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS07_P,                   
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS08, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS08, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS08, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS08, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS08_P,                   
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS09, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS09, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS09, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS09, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS09_P,                  
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS10, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS10, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS10, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS10, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS10_P,  
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS11, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS11, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS11, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS11, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS11_P, 
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS12, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS12, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS12, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS12, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS12_P, 
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS13, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS13, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS13, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS13, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS13_P,                                     
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS14, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS14, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS14, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS14, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS14_P,                                     
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS15, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS15, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS15, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS15, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS15_P, 
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS16, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS16, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS16, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS16, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS16_P,      
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS17, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS17, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS17, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS17, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS17_P,                   
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS18, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS18, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS18, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS18, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS18_P,                   
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS19, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS19, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS19, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS19, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS19_P,                  
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS20, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS20, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS20, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS20, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS20_P,
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS21, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS21, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS21, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS21, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS21_P, 
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS22, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS22, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS22, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS22, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS22_P, 
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS23, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS23, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS23, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS23, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS23_P,                                     
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS24, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS24, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS24, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS24, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS24_P,                                     
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS25, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS25, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS25, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS25, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS25_P, 
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS26, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS26, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS26, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS26, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS26_P,      
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS27, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS27, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS27, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS27, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS27_P,                   
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS28, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS28, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS28, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS28, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS28_P,                   
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS29, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS29, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS29, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS29, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS29_P,                  
               CASE
               WHEN C.DCOL = 'Q' THEN SUM(DECODE(P.TS30, DD.EQ_TPSZ_CD, DD.DISP_QTY))
               WHEN C.DCOL = 'S' THEN 
                    SUM(DECODE(P.TS30, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))
               WHEN C.DCOL = 'Z' THEN 
                    ROUND(SUM(DECODE(P.TS30, DD.EQ_TPSZ_CD, MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(SYSDATE, 'YYYYMM'), DH.CURR_CD, 'USD', DD.PART_AMT)))/
                            SUM(DECODE(P.TS30, DD.EQ_TPSZ_CD, DD.DISP_QTY)), 2)
               END TS30_P                               
        FROM  PARAM P, DUMMY_COL C, MNR_DISP_HDR DH, MNR_DISP_DTL DD, MNR_PARTNER MP 
        WHERE DH.DISP_NO = DD.DISP_NO
        AND   DH.EQ_KND_CD = @[eq_kind] 
        AND   DH.APRO_DT BETWEEN TO_DATE(@[from_mon], 'yyyy-mm') AND ADD_MONTHS(TO_DATE(@[to_mon], 'yyyy-mm'), 1)  
		#if (${ofc_cd} != 'A') 
        AND   DH.RQST_OFC_CD = DECODE('ALL', 'ALL', DH.RQST_OFC_CD, @[ofc_cd]) 
		#end
        AND   DD.MNR_PRNR_CNT_CD = MP.MNR_PRNR_CNT_CD
        AND   DD.MNR_PRNR_SEQ    = MP.MNR_PRNR_SEQ
		#if (${buyer_code} != '')
        AND   DD.MNR_PRNR_CNT_CD = NVL(SUBSTR(@[buyer_code],0,2), DD.MNR_PRNR_CNT_CD)  
        AND   DD.MNR_PRNR_SEQ    = NVL(SUBSTR(@[buyer_code],3,8), DD.MNR_PRNR_SEQ)     
		#end
        GROUP BY MNR_COMMON_PKG.MNR_CONV_PARTNER_CD_FNC(DD.MNR_PRNR_SEQ, DD.MNR_PRNR_CNT_CD), DH.RQST_OFC_CD, DH.CURR_CD, C.DCOL
    )
SELECT  RHQ, BUYER_CD, BUYER_NM, OFC_CD, CURR_CD, DECODE(TYPE, 'Q', 'QTY', 'S', 'AMT', 'Z', 'AVG') TYPE,
                                         DECODE(TYPE, 'Q', '1', 'S', '2', 'Z', '3') TYPE2,
        DECODE(RHQ,'RHQ',
        'N' || '|'  || TS01_P || '|'  || 'N' || '|'  || TS02_P  || '|' || 	        
        'N' || '|'  || TS03_P || '|'  || 'N' || '|'  || TS04_P  || '|' ||	
        'N' || '|'  || TS05_P || '|'  || 'N' || '|'  || TS06_P  || '|' ||
        'N' || '|'  || TS07_P || '|'  || 'N' || '|'  || TS08_P  || '|' ||
        'N' || '|'  || TS09_P || '|'  || 'N' || '|'  || TS10_P  || '|' ||
        'N' || '|'  || TS11_P || '|'  || 'N' || '|'  || TS12_P  || '|' ||
        'N' || '|'  || TS13_P || '|'  || 'N' || '|'  || TS14_P  || '|' ||
        'N' || '|'  || TS15_P || '|'  || 'N' || '|'  || TS16_P  || '|' ||
        'N' || '|'  || TS17_P || '|'  || 'N' || '|'  || TS18_P  || '|' ||
        'N' || '|'  || TS19_P || '|'  || 'N' || '|'  || TS20_P  || '|' ||
        'N' || '|'  || TS21_P || '|'  || 'N' || '|'  || TS22_P  || '|' ||
        'N' || '|'  || TS23_P || '|'  || 'N' || '|'  || TS24_P  || '|' ||
        'N' || '|'  || TS25_P || '|'  || 'N' || '|'  || TS26_P  || '|' ||
        'N' || '|'  || TS27_P || '|'  || 'N' || '|'  || TS28_P  || '|' ||
        'N' || '|'  || TS29_P || '|'  || 'N' || '|'  || TS30_P, '')  AS TITLE,
        TS01_P, TS02_P, TS03_P, TS04_P, TS05_P,
        TS06_P, TS07_P, TS08_P, TS09_P, TS10_P,
        TS11_P, TS12_P, TS13_P, TS14_P, TS15_P,
        TS16_P, TS17_P, TS18_P, TS19_P, TS20_P,
        TS21_P, TS22_P, TS23_P, TS24_P, TS25_P,
        TS26_P, TS27_P, TS28_P, TS29_P, TS30_P                
FROM        
    (    
        SELECT 'RHQ' RHQ,  'BUYER' BUYER_CD, 'BUYER NM' BUYER_NM, 'OFFICE' OFC_CD,'CURR' CURR_CD, 'TYPE' TYPE,
              NVL(P.TS01,'N') TS01_P, NVL(P.TS02,'N') TS02_P,
              NVL(P.TS03,'N') TS03_P, NVL(P.TS04,'N') TS04_P,
              NVL(P.TS05,'N') TS05_P, NVL(P.TS06,'N') TS06_P,
              NVL(P.TS07,'N') TS07_P, NVL(P.TS08,'N') TS08_P,
              NVL(P.TS09,'N') TS09_P, NVL(P.TS10,'N') TS10_P,
              NVL(P.TS11,'N') TS11_P, NVL(P.TS12,'N') TS12_P,
              NVL(P.TS13,'N') TS13_P, NVL(P.TS14,'N') TS14_P,
              NVL(P.TS15,'N') TS15_P, NVL(P.TS16,'N') TS16_P,
              NVL(P.TS17,'N') TS17_P, NVL(P.TS18,'N') TS18_P,
              NVL(P.TS19,'N') TS19_P, NVL(P.TS20,'N') TS20_P,
              NVL(P.TS21,'N') TS21_P, NVL(P.TS22,'N') TS22_P,
              NVL(P.TS23,'N') TS23_P, NVL(P.TS24,'N') TS24_P,
              NVL(P.TS25,'N') TS25_P, NVL(P.TS26,'N') TS26_P,
              NVL(P.TS27,'N') TS27_P, NVL(P.TS28,'N') TS28_P,
              NVL(P.TS29,'N') TS29_P, NVL(P.TS30,'N') TS30_P                        
        FROM PARAM P
        UNION ALL        
        SELECT MNR_COMMON_PKG.MNR_GET_RHQ_OFC_FNC(DQ.OFC_CD) RHQ, 
               BUYER_CD, BUYER_NM,
               DQ.OFC_CD OFC_CD, DQ.CURR_CD, DQ.DCOL TYPE,
               TO_CHAR(DQ.TS01_P) TS01_P, TO_CHAR(DQ.TS02_P) TS02_P, TO_CHAR(DQ.TS03_P) TS03_P, TO_CHAR(DQ.TS04_P) TS04_P, TO_CHAR(DQ.TS05_P) TS05_P,
               TO_CHAR(DQ.TS06_P) TS06_P, TO_CHAR(DQ.TS07_P) TS07_P, TO_CHAR(DQ.TS08_P) TS08_P, TO_CHAR(DQ.TS09_P) TS09_P, TO_CHAR(DQ.TS10_P) TS10_P,
               TO_CHAR(DQ.TS11_P) TS11_P, TO_CHAR(DQ.TS12_P) TS12_P, TO_CHAR(DQ.TS13_P) TS13_P, TO_CHAR(DQ.TS14_P) TS14_P, TO_CHAR(DQ.TS15_P) TS15_P,
               TO_CHAR(DQ.TS16_P) TS16_P, TO_CHAR(DQ.TS17_P) TS17_P, TO_CHAR(DQ.TS18_P) TS18_P, TO_CHAR(DQ.TS19_P) TS19_P, TO_CHAR(DQ.TS20_P) TS20_P,
               TO_CHAR(DQ.TS21_P) TS21_P, TO_CHAR(DQ.TS22_P) TS22_P, TO_CHAR(DQ.TS23_P) TS23_P, TO_CHAR(DQ.TS24_P) TS24_P, TO_CHAR(DQ.TS25_P) TS25_P,
               TO_CHAR(DQ.TS26_P) TS26_P, TO_CHAR(DQ.TS27_P) TS27_P, TO_CHAR(DQ.TS28_P) TS28_P, TO_CHAR(DQ.TS29_P) TS29_P, TO_CHAR(DQ.TS30_P) TS30_P
        FROM  DISP_QTY DQ
        WHERE DQ.OFC_CD = DQ.OFC_CD
		#if (${rhq} != 'A') 
        AND   MNR_COMMON_PKG.MNR_GET_RHQ_OFC_FNC(DQ.OFC_CD) = DECODE('ALL', 'ALL', MNR_COMMON_PKG.MNR_GET_RHQ_OFC_FNC(DQ.OFC_CD), @[rhq])  
		#end
    ) 
ORDER BY TITLE, RHQ, BUYER_CD, BUYER_NM, OFC_CD, TYPE2			]]></sql>
			<params>
				<param name="eq_kind" type="12" value="" out="N"/>
				<param name="from_mon" type="12" value="" out="N"/>
				<param name="to_mon" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="buyer_code" type="12" value="" out="N"/>
				<param name="rhq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
