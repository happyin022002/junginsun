<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChargeCalculationDBDAOSearchChargeListByStatusRSQL">
			<desc><![CDATA[ChargeCalculationDBDAOChargeCalculationContainerVORSQL]]></desc>
			<sql><![CDATA[
SELECT   SVR_ID
       , DMDT_CHG_STS_CD
	   , AFT_EXPT_DAR_NO
       , DMDT_EXPT_RQST_STS_CD
       , DECODE(TRIM(DMDT_EXPT_RQST_STS_CD), NULL, NULL, '', NULL, DECODE(DMDT_EXPT_RQST_STS_CD, 'R', 'BLUE', 'J', 'RED', 'O', 'RED', 'A', 'BLACK', 'PINK')) DMDT_EXPT_RQST_STS_COLOR
	   , CASE WHEN DMDT_EXPT_RQST_STS_CD = 'O' THEN 
				   (SELECT DECODE(MAX(AFT_BKG_PATH_LVL), 1, 'SCO PIC ', 2, 'SSZ/BAG ', 3, 'RHQ PIC ', 4, 'RHQ MGR ', 5, 'HO PIC ', 6, 'HO MGR ', '') || 'Counter-Offer'
					  FROM DMT_AFT_BKG_APRO_PATH
 			         WHERE AFT_EXPT_DAR_NO = T.AFT_EXPT_DAR_NO
					   AND DMDT_EXPT_RQST_STS_CD IS NOT NULL
	 		           AND AFT_BKG_PATH_CPLS_FLG = 'Y')
			 ELSE  (SELECT INTG_CD_VAL_DP_DESC 
			          FROM COM_INTG_CD_DTL
		             WHERE INTG_CD_ID = 'CD01971'
	    	           AND INTG_CD_VAL_CTNT = DMDT_EXPT_RQST_STS_CD)
			 END DMDT_EXPT_RQST_STS_CD_DESC
	   , (
			SELECT  CASE 
						WHEN NVL(MAX(DD.DMDT_DELT_RQST_STS_CD), 'N') IN ('C', 'N') THEN 'N'
						WHEN 0 < MAX((	
									SELECT  COUNT(1)
									  FROM  DMT_CHG_DELT_PATH 
									 WHERE  SYS_AREA_GRP_ID     = DD.SYS_AREA_GRP_ID
									   AND  CNTR_NO             = DD.CNTR_NO
									   AND  CNTR_CYC_NO         = DD.CNTR_CYC_NO
									   AND  DMDT_TRF_CD         = DD.DMDT_TRF_CD
									   AND  DMDT_CHG_LOC_DIV_CD = DD.DMDT_CHG_LOC_DIV_CD
									   AND  CHG_SEQ             = DD.CHG_SEQ
									   AND  CHG_OFC_CD          = DD.CHG_OFC_CD
									   AND  DELT_SEQ            = DD.DELT_SEQ
									   AND  CHG_DELT_PATH_LVL  >=
											(
												SELECT  max(CHG_DELT_PATH_LVL)
												  FROM  DMT_CHG_DELT_PATH
												 WHERE  SYS_AREA_GRP_ID        = DD.SYS_AREA_GRP_ID
												   AND  CNTR_NO                = DD.CNTR_NO
												   AND  CNTR_CYC_NO            = DD.CNTR_CYC_NO
												   AND  DMDT_TRF_CD            = DD.DMDT_TRF_CD
												   AND  DMDT_CHG_LOC_DIV_CD    = DD.DMDT_CHG_LOC_DIV_CD
												   AND  CHG_SEQ                = DD.CHG_SEQ
												   AND  CHG_OFC_CD             = DD.CHG_OFC_CD
												   AND  DELT_SEQ               = DD.DELT_SEQ
												   AND  CHG_DELT_PATH_CPLS_FLG = 'Y'
											)
									   and  CHG_DELT_STS_CD = 'A'
								 )) THEN 'X'		--// Charge Deletion 요청 불가, Charge Deletion Cancel 불가
						ELSE MAX(DD.DMDT_DELT_RQST_STS_CD)
					END
						
			  FROM  DMT_CHG_DELT_RQST_APRO DD
			 WHERE  DD.SYS_AREA_GRP_ID     = T.SVR_ID
			   AND	DD.CNTR_NO		       = T.CNTR_NO
			   AND	DD.CNTR_CYC_NO		   = T.CNTR_CYC_NO
			   AND	DD.DMDT_TRF_CD		   = T.DMDT_TRF_CD
			   AND	DD.DMDT_CHG_LOC_DIV_CD = T.DMDT_CHG_LOC_DIV_CD
			   AND	DD.CHG_SEQ			   = T.CHG_SEQ
			   AND  DD.DELT_SEQ            = 
					( 
						SELECT  NVL(MAX(DS.DELT_SEQ), 0) 
						  FROM  DMT_CHG_DELT_RQST_APRO DS
						 WHERE  DS.SYS_AREA_GRP_ID     = DD.SYS_AREA_GRP_ID
						   AND  DS.CNTR_NO	           = DD.CNTR_NO
						   AND  DS.CNTR_CYC_NO	       = DD.CNTR_CYC_NO
						   AND  DS.DMDT_TRF_CD	       = DD.DMDT_TRF_CD
						   AND  DS.DMDT_CHG_LOC_DIV_CD = DD.DMDT_CHG_LOC_DIV_CD
						   AND  DS.CHG_SEQ		       = DD.CHG_SEQ
						   AND  DS.CHG_OFC_CD          = DD.CHG_OFC_CD  
						   AND  DS.DMDT_DELT_RQST_STS_CD != 'C'
					)  
		 ) AS DMDT_DELT_RQST_STS_CD

	   , (
			SELECT  ( SELECT INTG_CD_VAL_DP_DESC 
                        FROM COM_INTG_CD_DTL 
                       WHERE INTG_CD_ID = 'CD03382' 
                         AND INTG_CD_VAL_CTNT = DD.DMDT_DELT_RQST_STS_CD ) AS INACT_STS_NM
			  FROM  DMT_CHG_DELT_RQST_APRO DD
			 WHERE  DD.SYS_AREA_GRP_ID     = T.SVR_ID
			   AND	DD.CNTR_NO		       = T.CNTR_NO
			   AND	DD.CNTR_CYC_NO		   = T.CNTR_CYC_NO
			   AND	DD.DMDT_TRF_CD		   = T.DMDT_TRF_CD
			   AND	DD.DMDT_CHG_LOC_DIV_CD = T.DMDT_CHG_LOC_DIV_CD
			   AND	DD.CHG_SEQ			   = T.CHG_SEQ
			   AND  DD.DELT_SEQ            =
					( 
						SELECT  NVL(MAX(DS.DELT_SEQ), 0) 
						  FROM  DMT_CHG_DELT_RQST_APRO DS
						 WHERE  DS.SYS_AREA_GRP_ID     = DD.SYS_AREA_GRP_ID
						   AND  DS.CNTR_NO	           = DD.CNTR_NO
						   AND  DS.CNTR_CYC_NO	       = DD.CNTR_CYC_NO
						   AND  DS.DMDT_TRF_CD	       = DD.DMDT_TRF_CD
						   AND  DS.DMDT_CHG_LOC_DIV_CD = DD.DMDT_CHG_LOC_DIV_CD
						   AND  DS.CHG_SEQ		       = DD.CHG_SEQ
						   AND  DS.CHG_OFC_CD          = DD.CHG_OFC_CD  
						   AND  DS.DMDT_DELT_RQST_STS_CD != 'C'
					)  
		 ) AS INACT_STS_MN

	   , (
			SELECT  INACT_RQST_NO
			  FROM  DMT_CHG_DELT_RQST_APRO DD
			 WHERE  DD.SYS_AREA_GRP_ID     = T.SVR_ID
			   AND	DD.CNTR_NO		       = T.CNTR_NO
			   AND	DD.CNTR_CYC_NO		   = T.CNTR_CYC_NO
			   AND	DD.DMDT_TRF_CD		   = T.DMDT_TRF_CD
			   AND	DD.DMDT_CHG_LOC_DIV_CD = T.DMDT_CHG_LOC_DIV_CD
			   AND	DD.CHG_SEQ			   = T.CHG_SEQ
			   AND  DD.DELT_SEQ            =
					( 
						SELECT  NVL(MAX(DS.DELT_SEQ), 0) 
						  FROM  DMT_CHG_DELT_RQST_APRO DS
						 WHERE  DS.SYS_AREA_GRP_ID     = DD.SYS_AREA_GRP_ID
						   AND  DS.CNTR_NO	           = DD.CNTR_NO
						   AND  DS.CNTR_CYC_NO	       = DD.CNTR_CYC_NO
						   AND  DS.DMDT_TRF_CD	       = DD.DMDT_TRF_CD
						   AND  DS.DMDT_CHG_LOC_DIV_CD = DD.DMDT_CHG_LOC_DIV_CD
						   AND  DS.CHG_SEQ		       = DD.CHG_SEQ
						   AND  DS.CHG_OFC_CD          = DD.CHG_OFC_CD  
						   AND  DS.DMDT_DELT_RQST_STS_CD != 'C'
					)  
		 ) AS INACT_RQST_NO

       , CNTR_NO
       , CNTR_TPSZ_CD
       , OFC_CD
       , FM_MVMT_YD_CD
       , TO_MVMT_YD_CD
       , FM_MVMT_STS_CD
       , TO_MVMT_STS_CD
       , DMDT_TRF_CD
       , FT_DYS
       , FX_FT_OVR_DYS
	   -- 조건추가(S) 2013.12.13
       , OVR_DUE
	   -- 조건추가(E)
       , FM_MVMT_DT
       , TO_MVMT_DT
       , MT_DT
       , FT_CMNC_DT
       , FT_END_DT
       , BZC_TRF_CURR_CD
       , ORG_CHG_AMT
       , SC_RFA_EXPT_AMT
       , AFT_EXPT_DC_AMT
       , BIL_AMT
       , BKG_NO
       , BL_NO
       , VVD_CD
       , LANE
       , POR_CD
       , POL_CD
       , POD_CD
       , DEL_CD
       , BKG_RCV_TERM_CD
       , BKG_DE_TERM_CD
       , SC_NO
       , RFA_NO
       , ACUST
       , CHG_TYPE
       , CHG_SEQ
        , UCLM_FLG
#if (${bkg_info} != '')
       , SOC_FLG
       , LI
       , CH
       , D_O
       , RLSE_OFC
       , CLT_OFC_CD
#end
       , OFC_TRNS_FLG
       , ROLL_OVR
       , WEB_IND_FLG
       , CNTR_CYC_NO
       , DMDT_CHG_LOC_DIV_CD
#if (${corr_info} != '')
       , CORR_RMK
#end
       , DMDT_INV_NO
       , SUBSTR( DMT_INV_DATA, INSTR(DMT_INV_DATA, '|', 1, 1) + 1, INSTR(DMT_INV_DATA, '|', 1, 1+1) - INSTR(DMT_INV_DATA, '|', 1, 1) - 1) AS ISS_DT
       , SUBSTR( DMT_INV_DATA, INSTR(DMT_INV_DATA, '|', 1, 2) + 1, INSTR(DMT_INV_DATA, '|', 1, 2+1) - INSTR(DMT_INV_DATA, '|', 1, 2) - 1) AS INV_CURR_CD
       , SUBSTR( DMT_INV_DATA, INSTR(DMT_INV_DATA, '|', 1, 3) + 1, INSTR(DMT_INV_DATA, '|', 1, 3+1) - INSTR(DMT_INV_DATA, '|', 1, 3) - 1) AS INV_CHG_AMT
       , SUBSTR( DMT_INV_DATA, INSTR(DMT_INV_DATA, '|', 1, 4) + 1, INSTR(DMT_INV_DATA, '|', 1, 4+1) - INSTR(DMT_INV_DATA, '|', 1, 4) - 1) AS DMDT_AR_IF_CD
       , SUBSTR( DMT_INV_DATA, INSTR(DMT_INV_DATA, '|', 1, 5) + 1, INSTR(DMT_INV_DATA, '|', 1, 5+1) - INSTR(DMT_INV_DATA, '|', 1, 5) - 1) AS AR_IF_DT       -- 2012.11.26 Add
       , WEB_CRE_DT
       , WEB_MTY_DT
       , WEB_NTFY_PIC_NM
#if (${cust_info} != '')
       , PAYER_CD
       , PAYER_NM
       , SHIPPER_CD
       , SHIPPER_NM
       , CNEE_CD
       , CNEE_NM
       , NTFY_CD
       , NTFY_NM
       , AR_ACT_CD
       , AR_ACT_NM
       , SVC_PROVDR_CD
       , SVC_PROVDR_NM
#end
#if (${op_bkg_info} != '')
       , OP_BKG_NO
#end

#if (${us_ofc_yn} == 'Y')	-- 2014.09.17 Add
	   , CASE WHEN SUBSTR(DMDT_TRF_CD, 2, 3) = 'TIC' THEN X1_DT ELSE '' END AS X1_DT -- 2014.09.17 Add
	   , CASE WHEN SUBSTR(DMDT_TRF_CD, 2, 3) = 'TIC' THEN CD_DT ELSE '' END AS CD_DT -- 2014.09.17 Add
#else
	   ,'' AS X1_DT
	   ,'' AS CD_DT
#end
	   , BKG_CNTR_CYC_NO

FROM    (
        SELECT    C.SYS_AREA_GRP_ID AS SVR_ID
                , C.DMDT_CHG_STS_CD
                , (SELECT AA.AFT_EXPT_DAR_NO
                          FROM DMT_AFT_BKG_ADJ_RQST_DTL CC
                             , DMT_AFT_BKG_CNTR BB
                             , DMT_AFT_BKG_ADJ_RQST AA
                         WHERE 1=1
                           AND CC.BKG_NO = B.BKG_NO
                           AND CC.AFT_EXPT_DAR_NO = BB.AFT_EXPT_DAR_NO
                           AND CC.AFT_EXPT_ADJ_SEQ = BB.AFT_EXPT_ADJ_SEQ
                           AND CC.DMDT_TRF_CD = C.DMDT_TRF_CD
                           AND BB.SYS_AREA_GRP_ID = C.SYS_AREA_GRP_ID
                           AND BB.CNTR_NO = C.CNTR_NO
                           AND BB.CNTR_CYC_NO = C.CNTR_CYC_NO
                           AND BB.DMDT_TRF_CD = C.DMDT_TRF_CD
                           AND BB.DMDT_CHG_LOC_DIV_CD = C.DMDT_CHG_LOC_DIV_CD
                           AND BB.CHG_SEQ = C.CHG_SEQ
                           AND AA.AFT_EXPT_DAR_NO = BB.AFT_EXPT_DAR_NO
                           AND AA.RQST_DT = (SELECT MAX(RQST_DT)
                                  FROM DMT_AFT_BKG_ADJ_RQST A1
                                     , DMT_AFT_BKG_ADJ_RQST_DTL B1
                                 WHERE A1.AFT_EXPT_DAR_NO=B1.AFT_EXPT_DAR_NO
                                   AND B1.BKG_NO=CC.BKG_NO )
						   AND DMDT_EXPT_RQST_STS_CD != 'T'
                ) AFT_EXPT_DAR_NO
                , (SELECT DMDT_EXPT_RQST_STS_CD
                          FROM DMT_AFT_BKG_ADJ_RQST_DTL CC
                             , DMT_AFT_BKG_CNTR BB
                             , DMT_AFT_BKG_ADJ_RQST AA
                         WHERE 1=1
                           AND CC.BKG_NO = B.BKG_NO
                           AND CC.AFT_EXPT_DAR_NO = BB.AFT_EXPT_DAR_NO
                           AND CC.AFT_EXPT_ADJ_SEQ = BB.AFT_EXPT_ADJ_SEQ
                           AND CC.DMDT_TRF_CD = C.DMDT_TRF_CD
                           AND BB.SYS_AREA_GRP_ID = C.SYS_AREA_GRP_ID
                           AND BB.CNTR_NO = C.CNTR_NO
                           AND BB.CNTR_CYC_NO = C.CNTR_CYC_NO
                           AND BB.DMDT_TRF_CD = C.DMDT_TRF_CD
                           AND BB.DMDT_CHG_LOC_DIV_CD = C.DMDT_CHG_LOC_DIV_CD
                           AND BB.CHG_SEQ = C.CHG_SEQ
                           AND AA.AFT_EXPT_DAR_NO = BB.AFT_EXPT_DAR_NO
                           AND AA.RQST_DT = (SELECT MAX(RQST_DT)
                                  FROM DMT_AFT_BKG_ADJ_RQST A1
                                     , DMT_AFT_BKG_ADJ_RQST_DTL B1
                                 WHERE A1.AFT_EXPT_DAR_NO=B1.AFT_EXPT_DAR_NO
                                   AND B1.BKG_NO=CC.BKG_NO )
						   AND DMDT_EXPT_RQST_STS_CD != 'T'
                ) DMDT_EXPT_RQST_STS_CD
                , C.CNTR_NO    
                , B.CNTR_TPSZ_CD
                , C.OFC_CD
                , C.FM_MVMT_YD_CD
                , C.TO_MVMT_YD_CD
                , C.FM_MVMT_STS_CD
                , C.TO_MVMT_STS_CD
                , C.DMDT_TRF_CD
                , C.FT_DYS
                , C.FX_FT_OVR_DYS
				-- 조건추가(S) 2013.12.13
 				, TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD'), 'YYYYMMDD') - TO_DATE(TO_CHAR(NVL(C.TO_MVMT_DT, C.FT_END_DT), 'YYYYMMDD'), 'YYYYMMDD') AS OVR_DUE
                -- 조건추가(E)
				, TO_CHAR(C.FM_MVMT_DT, 'yyyymmdd') FM_MVMT_DT
                , TO_CHAR(C.TO_MVMT_DT, 'yyyymmdd') TO_MVMT_DT     
                , 
                (
                SELECT TO_CHAR(CM.CNMV_EVNT_DT, 'YYYYMMDD')
                FROM   CTM_MOVEMENT CM
                WHERE  CM.CNTR_NO     = C.CNTR_NO
                AND    CM.CNMV_CYC_NO = C.CNTR_CYC_NO
                AND    CM.MVMT_STS_CD = 'MT'
                AND    ROWNUM         = 1
                ) AS MT_DT
                , TO_CHAR(C.FT_CMNC_DT, 'yyyymmdd') FT_CMNC_DT
                , TO_CHAR(C.FT_END_DT, 'yyyymmdd') FT_END_DT
                , C.BZC_TRF_CURR_CD
                , C.ORG_CHG_AMT
                , C.SC_RFA_EXPT_AMT
                , C.AFT_EXPT_DC_AMT
                , C.BIL_AMT
                , B.BKG_NO
                , B.BL_NO
                , B.VSL_CD || B.SKD_VOY_NO || B.SKD_DIR_CD AS VVD_CD
                ,
                (
                SELECT  V.VSL_SLAN_CD
                FROM    VSK_VSL_SKD V
                WHERE   B.VSL_CD        = V.VSL_CD 
                AND     B.SKD_VOY_NO    = V.SKD_VOY_NO 
                AND     B.SKD_DIR_CD    = V.SKD_DIR_CD 
                )                                                                                                           AS LANE
                , B.POR_CD
                , B.POL_CD
                , B.POD_CD
                , B.DEL_CD
                , B.BKG_RCV_TERM_CD
                , B.BKG_DE_TERM_CD
                , B.SC_NO
                , B.RFA_NO
                , DECODE( BK.AGMT_ACT_CNT_CD||TRIM(TO_CHAR(BK.AGMT_ACT_CUST_SEQ, '000000')),'000000', NULL
                                                   , BK.AGMT_ACT_CNT_CD||TRIM(TO_CHAR(BK.AGMT_ACT_CUST_SEQ, '000000')) )    AS ACUST
                , DECODE(C.CHG_SEQ, 1, 'G', 'B') AS CHG_TYPE
                , C.CHG_SEQ
                , NVL(UCLM_FLG, 'N')                                                                                        AS UCLM_FLG
#if (${bkg_info} != '')
                , NVL(B.SOC_FLG, 'N') AS SOC_FLG
                ,
                CASE
                WHEN C.DMDT_TRF_CD='DMIF' AND C.TO_MVMT_STS_CD ='ID'                    THEN 'L'
                WHEN C.DMDT_TRF_CD='DMIF' AND C.TO_MVMT_STS_CD NOT IN ('ID','CS','DR')  THEN 'I'
                WHEN C.DMDT_TRF_CD='DMOF' AND C.DMDT_CHG_LOC_DIV_CD <> 'POL'            THEN 'L'
                WHEN C.DMDT_TRF_CD='DMOF' AND C.DMDT_CHG_LOC_DIV_CD ='POL'              THEN 'I'
                END                                                                                                         AS LI
                , 
                (
                SELECT  NVL(HLG_TP_CD, 'N')
                FROM    BKG_EUR_TRO
                WHERE   BKG_NO              = B.BKG_NO
                AND     IO_BND_CD           = SUBSTR(C.DMDT_TRF_CD, 3, 1)
                AND     NVL(CXL_FLG, 'N')   = 'N'
                AND     CNTR_NO             = C.CNTR_NO
                AND     ROWNUM              = 1
                )                                                                                                           AS CH
                ,
                (
                SELECT  'Y'
                FROM    DUAL      
                WHERE   EXISTS  (
                                SELECT  BDD.RLSE_STS_CD
                                FROM    BKG_DO     BDO,
                                        BKG_DO_DTL BDD
                                WHERE   BDO.BKG_NO        = BDD.BKG_NO
                                AND     BDO.BKG_NO        = B.BKG_NO
                                AND     BDD.RLSE_STS_CD IN ('R', 'I')
                                )
                )                                                                                                           AS D_O
                ,
                (
                SELECT  BDD.EVNT_OFC_CD
                FROM    BKG_DO     BDO,
                        BKG_DO_DTL BDD
                WHERE   BDO.BKG_NO      = BDD.BKG_NO   
                AND     BDO.BKG_NO      = B.BKG_NO   
                AND     BDD.RLSE_STS_CD IN ('R', 'I')
                AND     ROWNUM          =1
                )                                                                                                           AS RLSE_OFC
                , BR.CLT_OFC_CD
#end
                , NVL(C.OFC_TRNS_FLG, 'N')                                                                                  AS OFC_TRNS_FLG
                ,
                (
                SELECT  'C'
                FROM    DUAL
                WHERE   EXISTS  (
                                SELECT  1
                                FROM    BKG_ROLL_OVR R
                                WHERE   R.BKG_NO = B.BKG_NO
                                AND     R.ROLL_OVR_RSN_CD IN ( 'C','H' )
                                ) 
                )                                                                                                           AS ROLL_OVR
                , C.CNTR_CYC_NO
                , C.DMDT_CHG_LOC_DIV_CD
#if (${corr_info} != '')
                , C.CORR_RMK
#end
                , C.DMDT_INV_NO
                ,
                (
                SELECT  '|'|| TO_CHAR(IM.CRE_DT, 'YYYYMMDD') ||'|'|| IM.INV_CURR_CD ||'|'|| ID.CNTR_INV_AMT ||'|'|| IM.DMDT_AR_IF_CD ||'|'|| TO_CHAR(IM.AR_IF_DT, 'YYYYMMDD') ||'|'
                FROM    DMT_INV_MN  IM,
                        DMT_INV_DTL ID
                WHERE   1=1
                AND     IM.DMDT_INV_NO          = ID.DMDT_INV_NO
                AND     IM.CRE_OFC_CD           = ID.CRE_OFC_CD
                AND     IM.DMDT_INV_STS_CD      = 'I'
                AND     C.SYS_AREA_GRP_ID       = ID.SYS_AREA_GRP_ID
                AND     C.CNTR_NO               = ID.CNTR_NO
                AND     C.CNTR_CYC_NO           = ID.CNTR_CYC_NO
                AND     C.DMDT_TRF_CD           = ID.DMDT_TRF_CD
                AND     C.DMDT_CHG_LOC_DIV_CD   = ID.DMDT_CHG_LOC_DIV_CD
                AND     C.CHG_SEQ               = ID.CHG_SEQ 
                AND     ROWNUM                  = 1
                )                                                                                                           AS DMT_INV_DATA
                , C.WEB_IND_FLG
                , DECODE(C.WEB_IND_FLG, 'Y', TO_CHAR(NVL(C.WEB_MTY_DT, C.TO_MVMT_DT), 'YYYY-MM-DD'), TO_CHAR(C.WEB_MTY_DT, 'YYYY-MM-DD')) AS WEB_CRE_DT
                , DECODE(C.WEB_IND_FLG, 'Y', TO_CHAR(NVL(C.FT_END_DT, C.TO_MVMT_DT) + 7, 'YYYY-MM-DD'), TO_CHAR(C.FT_END_DT + 7, 'YYYY-MM-DD')) AS WEB_MTY_DT
                , C.WEB_NTFY_PIC_NM
#if (${cust_info} != '')
 
, (
            CASE WHEN (C.DMDT_TRF_CD IN ('DTIC', 'CTIC') AND SUBSTR(BK.DEL_CD,1,2) = 'US' AND BK.DE_TERM_CD = 'Y') 
                    OR (C.DMDT_TRF_CD IN ('DTOC', 'CTOC') AND SUBSTR(BK.POR_CD,1,2) = 'US' AND BK.RCV_TERM_CD = 'Y') 
                    THEN 
                        (SELECT	LPAD(VNDR_SEQ,6,'0') AS VNDR_CD FROM	MDM_VENDOR WHERE	VNDR_SEQ = C.VNDR_SEQ AND	DELT_FLG <> 'Y')
                             
                    ELSE CASE WHEN SUBSTR(C.DMDT_TRF_CD,3,1) = 'I' AND SUBSTR(BK.DEL_CD,1,2) IN ('US', 'CA') THEN  
                                            NVL(( SELECT CUST_CNT_CD||LPAD(CUST_SEQ,6,'0') 
                                                                 FROM BKG_CUSTOMER 
                                                                WHERE BKG_NO = BK.BKG_NO 
                                                                  AND BKG_CUST_TP_CD = 'C'
																  AND CUST_CNT_CD IS NOT NULL AND CUST_SEQ IS NOT NULL),
                                                             ( SELECT CUST_CNT_CD||LPAD(CUST_SEQ,6,'0')
                                                                 FROM BKG_CUSTOMER 
                                                                WHERE BKG_NO = BK.BKG_NO 
                                                                  AND BKG_CUST_TP_CD = 'N'))
                                                                  
                                    WHEN SUBSTR(C.DMDT_TRF_CD,3,1) = 'O' AND SUBSTR(BK.POR_CD,1,2) IN ('US', 'CA') THEN  
                                            ( SELECT CUST_CNT_CD||LPAD(CUST_SEQ,6,'0') 
                                                                 FROM BKG_CUSTOMER 
                                                                WHERE BKG_NO = BK.BKG_NO 
                                                                  AND BKG_CUST_TP_CD = 'S')
      
                                    ELSE 
                                          NVL(
											   (SELECT ACT_CUST_CNT_CD || LPAD(ACT_CUST_SEQ, 6, '0')
													FROM INV_AR_MN AR
													WHERE BKG_NO = BK.BKG_NO
													AND IO_BND_CD = SUBSTR(C.DMDT_TRF_CD,3,1)
													AND AR_IF_NO = (SELECT MAX(AR_IF_NO)
																			FROM INV_AR_MN
																			WHERE BKG_NO = BK.BKG_NO
																			AND   IO_BND_CD = SUBSTR(C.DMDT_TRF_CD,3,1)
																	)
												), NVL(DECODE(C.ACT_CNT_CD, '00', '', C.ACT_CNT_CD)|| DECODE(C.ACT_CUST_SEQ,NULL,'',0,'',LPAD(C.ACT_CUST_SEQ, 6, '0')), '')
											)
                                    END
                   END )	AS PAYER_CD
    , (
            CASE WHEN (C.DMDT_TRF_CD IN ('DTIC', 'CTIC') AND SUBSTR(BK.DEL_CD,1,2) = 'US' AND BK.DE_TERM_CD = 'Y') 
                    OR (C.DMDT_TRF_CD IN ('DTOC', 'CTOC') AND SUBSTR(BK.POR_CD,1,2) = 'US' AND BK.RCV_TERM_CD = 'Y') 
                    THEN 
                        (SELECT	VNDR_LGL_ENG_NM FROM MDM_VENDOR WHERE VNDR_SEQ = C.VNDR_SEQ AND DELT_FLG <> 'Y' AND ROWNUM = 1)
                             
                    ELSE CASE WHEN SUBSTR(C.DMDT_TRF_CD,3,1) = 'I' AND SUBSTR(BK.DEL_CD,1,2) IN ('US', 'CA') THEN  
                                            NVL(( SELECT CUST_LGL_ENG_NM
                                                                 FROM BKG_CUSTOMER A, MDM_CUSTOMER B
                                                                WHERE A.BKG_NO = BK.BKG_NO 
                                                                  AND A.BKG_CUST_TP_CD = 'C'
																  AND A.CUST_CNT_CD IS NOT NULL AND A.CUST_SEQ IS NOT NULL
                                                                  AND A.CUST_CNT_CD = B.CUST_CNT_CD
                                                                  AND A.CUST_SEQ = B.CUST_SEQ 
                                                                  AND ROWNUM = 1 ),
                                                             ( SELECT CUST_LGL_ENG_NM
                                                                 FROM BKG_CUSTOMER A, MDM_CUSTOMER B
                                                                WHERE A.BKG_NO = BK.BKG_NO 
                                                                  AND A.BKG_CUST_TP_CD = 'N'
                                                                  AND A.CUST_CNT_CD = B.CUST_CNT_CD
                                                                  AND A.CUST_SEQ = B.CUST_SEQ 
                                                                  AND ROWNUM = 1 ))
                                                                  
                                    WHEN SUBSTR(C.DMDT_TRF_CD,3,1) = 'O' AND SUBSTR(BK.POR_CD,1,2) IN ('US', 'CA') THEN  
                                            ( SELECT CUST_LGL_ENG_NM
                                                                 FROM BKG_CUSTOMER A, MDM_CUSTOMER B
                                                                WHERE A.BKG_NO = BK.BKG_NO 
                                                                  AND A.BKG_CUST_TP_CD = 'S'
                                                                  AND A.CUST_CNT_CD = B.CUST_CNT_CD
                                                                  AND A.CUST_SEQ = B.CUST_SEQ 
                                                                  AND ROWNUM = 1 )
      
                                    ELSE 
                                          NVL((SELECT CUST_LGL_ENG_NM
											FROM MDM_CUSTOMER
                                            WHERE (CUST_SEQ, CUST_CNT_CD) = (
												SELECT ACT_CUST_SEQ, ACT_CUST_CNT_CD
												FROM INV_AR_MN AR
												WHERE BKG_NO = BK.BKG_NO
												AND IO_BND_CD = SUBSTR(C.DMDT_TRF_CD,3,1)
												AND AR_IF_NO = (
                                                	SELECT MAX(AR_IF_NO)
													FROM INV_AR_MN
													WHERE BKG_NO = BK.BKG_NO
													AND IO_BND_CD = SUBSTR(C.DMDT_TRF_CD,3,1)
												)
											)
											AND ROWNUM = 1
										), (SELECT CUST_LGL_ENG_NM
											FROM MDM_CUSTOMER
                                            WHERE CUST_CNT_CD = C.ACT_CNT_CD 
											AND CUST_SEQ = C.ACT_CUST_SEQ))
                                    END
                   END )	AS PAYER_NM

                , BS.CUST_CNT_CD || TRIM(TO_CHAR(BS.CUST_SEQ, '000000'))                            AS SHIPPER_CD 
                , REPLACE(BS.CUST_NM, CHR(13) || CHR(10), ' ')                                      AS SHIPPER_NM   
                , DECODE(BC.CUST_CNT_CD || TRIM(TO_CHAR(BC.CUST_SEQ, '000000')), '000000', NULL, BC.CUST_CNT_CD || TRIM(TO_CHAR(BC.CUST_SEQ, '000000'))) AS CNEE_CD
                , REPLACE(BC.CUST_NM, CHR(13) || CHR(10), ' ')                                      AS CNEE_NM
                , DECODE(BN.CUST_CNT_CD || TRIM(TO_CHAR(BN.CUST_SEQ, '000000')), '000000', NULL, BN.CUST_CNT_CD || TRIM(TO_CHAR(BN.CUST_SEQ, '000000'))) AS NTFY_CD
                , NVL(RTRIM(REPLACE(REPLACE(BN.CUST_NM, CHR(34), ''), CHR(13)||CHR(10), ' ')), '-') AS NTFY_NM
                ,
                (
                SELECT  I.ACT_CUST_CNT_CD || TO_CHAR(I.ACT_CUST_SEQ, 'FM000000')
                FROM    INV_AR_MN I
                WHERE   I.BKG_NO    = B.BKG_NO
                AND     I.IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
                AND     AR_IF_NO    =   (
                                        SELECT  MAX(AR_IF_NO) 
                                        FROM    INV_AR_MN
                                        WHERE   BKG_NO      = B.BKG_NO
                                        AND     IO_BND_CD   = SUBSTR(C.DMDT_TRF_CD, 3, 1)
                                        )
                AND     ROWNUM      = 1
                )                                                                                                   AS AR_ACT_CD
                ,
                (
                SELECT  MC.CUST_LGL_ENG_NM
                FROM    MDM_CUSTOMER    MC,
                        INV_AR_MN       I
                WHERE   MC.CUST_CNT_CD  = I.ACT_CUST_CNT_CD
                AND     MC.CUST_SEQ     = I.ACT_CUST_SEQ
                AND     I.BKG_NO        = B.BKG_NO
                AND     I.IO_BND_CD     = SUBSTR(C.DMDT_TRF_CD, 3, 1)
                AND     AR_IF_NO        =   (
                                            SELECT  MAX(AR_IF_NO) 
                                            FROM    INV_AR_MN
                                            WHERE   BKG_NO      = B.BKG_NO
                                            AND     IO_BND_CD   = SUBSTR(C.DMDT_TRF_CD, 3, 1)
                                            )
                AND     ROWNUM  = 1
                )                                                                                                   AS AR_ACT_NM
                , DECODE(TRIM(TO_CHAR(C.VNDR_SEQ, '000000')), '000000', NULL, TRIM(TO_CHAR(C.VNDR_SEQ, '000000')))  AS SVC_PROVDR_CD     
                ,
                (
                SELECT  MV.VNDR_LGL_ENG_NM
                FROM    MDM_VENDOR MV
                WHERE   MV.VNDR_SEQ = C.VNDR_SEQ
                )                                                                                                   AS SVC_PROVDR_NM
#end
             , B.DMDT_BKG_CGO_TP_CD ||
                 CASE
                 WHEN B.DMDT_BKG_CGO_TP_CD= 'AWK' THEN
                     (
                     SELECT DECODE (SIGN (OVR_FWRD_LEN
                             + OVR_BKWD_LEN
                             + OVR_HGT
                             + OVR_LF_LEN
                             + OVR_RT_LEN)
                             , 0, 'I'
                             ,    'O'
                             )
                     FROM    BKG_AWK_CGO S
                     WHERE   1=1
                     AND     S.BKG_NO    = B.BKG_NO
                     AND     S.CNTR_NO   = B.CNTR_NO
                     )
                 ELSE
                     'A'
                 END                                                                                                AS DMDT_BKG_CGO_TP_CD_GUBUN
#if (${op_bkg_info} != '')
            ,
            CASE
            WHEN  ( SUBSTR ( C.DMDT_TRF_CD, 3, 1 ) = 'O' AND DMDT_CHG_STS_CD <> 'N' ) THEN
                (
                SELECT  /*+ INDEX_DESC( M XFN1CTM_MOVEMENT ) */
                        CASE
                        WHEN ( M.CNMV_CYC_NO <> C.CNTR_CYC_NO AND M.BKG_NO <> B.BKG_NO AND
                                (
                                SELECT  COUNT(*)
                                FROM    CTM_MOVEMENT S
                                WHERE   S.CNTR_NO       = M.CNTR_NO
                                AND     S.CNMV_CYC_NO   = M.CNMV_CYC_NO 
                                AND     S.MVMT_STS_CD   IN ( 'VL', 'MT')
                                ) = 0
                        ) THEN
                            M.BKG_NO
                        ELSE
                            B.BKG_NO
                        END
                FROM    CTM_MOVEMENT   M
                WHERE   1=1
                AND     M.MVMT_STS_CD    = 'OP'
                AND     M.CNTR_NO        = C.CNTR_NO
                AND     M.CNMV_YR || TO_CHAR(M.CNMV_SEQ, 'FM0000') || M.CNMV_SPLIT_NO < C.TO_MVMT_YR || TO_CHAR( C.TO_MVMT_SEQ, 'FM0000') || C.TO_MVMT_SPLIT_NO  
                AND     ROWNUM           = 1
                )
           ELSE
                    NULL
           END                                                                                                      AS OP_BKG_NO
#end

#if (${us_ofc_yn} == 'Y')	-- 2014.09.17 Add
		  ,T2.X1_DT
		  ,T2.CD_DT
#end

		  , ( SELECT CNMV_CYC_NO FROM BKG_CONTAINER WHERE BKG_NO = B.BKG_NO AND CNTR_NO = B.CNTR_NO AND ROWNUM = 1 ) AS BKG_CNTR_CYC_NO

        FROM      DMT_CHG_BKG_CNTR       B
                 , DMT_CHG_CALC          C
                 , BKG_BOOKING           BK
                 , BKG_RATE              BR
                 , BKG_CUSTOMER          BS
                 , BKG_CUSTOMER          BC
                 , BKG_CUSTOMER          BN
                 , DMT_INV_MN            T1

#if (${us_ofc_yn} == 'Y')	-- 2014.09.17 Add
				 , (
					SELECT  BKG_NO
                           ,CNTR_NO
                           ,MAX(X1_DT) as X1_DT
                           ,MAX(CD_DT) as CD_DT
				  	FROM  (
				            SELECT  BKG_NO, CNTR_NO, max(ACT_RCV_DT) as X1_DT, '' as CD_DT
				              FROM  EDI_214_MSG
				             WHERE  SHP_STS_CD = 'X1'
				            GROUP BY BKG_NO, CNTR_NO 

				            UNION ALL

				            SELECT  BKG_NO, CNTR_NO, '' as X1_DT, max(ACT_RCV_DT) as CD_DT
				              FROM  EDI_214_MSG
				             WHERE  SHP_STS_CD = 'CD'
				            GROUP BY BKG_NO, CNTR_NO 
				        )           
					GROUP BY BKG_NO, CNTR_NO
				   )                     T2
#end

         WHERE  1=1
         AND    B.SYS_AREA_GRP_ID    =   C.SYS_AREA_GRP_ID
         AND    B.CNTR_NO            =   C.CNTR_NO
         AND    B.CNTR_CYC_NO        =   C.CNTR_CYC_NO
         AND    B.BKG_NO             =   BK.BKG_NO
         AND    B.BKG_NO             =   BR.BKG_NO(+)
         AND    C.OFC_CD             IN (
                        #foreach( $ofc_cd in ${ofc_cd_list} )
                             #if($velocityCount < $ofc_cd_list.size()) '$ofc_cd', #else '$ofc_cd' #end
                        #end
                        )
         AND    C.DMDT_TRF_CD        IN (
                        #foreach( $trf_cd in ${trf_cd_list} )
                             #if($velocityCount < $trf_cd_list.size()) '$trf_cd', #else '$trf_cd' #end
                        #end
                        )
         AND    NOT (C.DUL_TP_EXPT_FLG  = 'Y' AND SUBSTR(C.DMDT_TRF_CD, 1, 1) = 'D')
         AND    C.DMDT_CHG_LOC_DIV_CD     <> 'SZP'
#if (${cs} == 'Y' || ${web_mt} == 'Y')
         AND    C.SYS_AREA_GRP_ID = 'USA'         
    #if (${cs} == 'Y')
        AND     C.TO_MVMT_STS_CD = 'CS'
    #end
    #if (${web_mt} == 'Y') 
        AND     C.WEB_IND_FLG = 'Y'
    #end
#end
        AND    B.BKG_NO             = BS.BKG_NO(+)
        AND    BS.BKG_CUST_TP_CD(+) = 'S'
        AND    B.BKG_NO             = BC.BKG_NO(+)
        AND    BC.BKG_CUST_TP_CD(+) = 'C'
        AND    B.BKG_NO             = BN.BKG_NO(+)
        AND    BN.BKG_CUST_TP_CD(+) = 'N'

#if (${us_ofc_yn} == 'Y')	-- 2014.09.17 Add
        AND    B.BKG_NO = T2.BKG_NO(+)
        AND    B.CNTR_NO = T2.CNTR_NO(+)
#end

#if (${cond_type} != 'date')
        AND     C.DMDT_CHG_STS_CD IN (
                    #foreach( $chg_sts_cd in ${chg_sts_cd_list} )
                         #if($velocityCount < $chg_sts_cd_list.size()) '$chg_sts_cd', #else '$chg_sts_cd' #end
                    #end
                )
         #else
             #if (${opt_date} == 'MVMT_DT')
        AND     (1=0
                   
                   #if($chg_sts_cd_list1.size() > 0)
                        OR (
                             C.DMDT_CHG_STS_CD IN (
                                  #foreach( $chg_sts_cd in ${chg_sts_cd_list1} )
                                       #if($velocityCount < $chg_sts_cd_list1.size()) '$chg_sts_cd', #else '$chg_sts_cd' #end
                                  #end
                             )
                             AND ( C.TO_MVMT_DT BETWEEN TO_DATE(@[fm_mvmt_dt], 'YYYYMMDD') 
                                                      AND TO_DATE(@[to_mvmt_dt], 'YYYYMMDD') + 0.99999 )
                        )
                   #end
                   
                   #if($chg_sts_cd_list2.size() > 0)
                        OR (
                             C.DMDT_CHG_STS_CD IN (
                                  #foreach( $chg_sts_cd in ${chg_sts_cd_list2} )
                                       #if($velocityCount < $chg_sts_cd_list2.size()) '$chg_sts_cd', #else '$chg_sts_cd' #end
                                  #end
                             )
                             AND ( C.FM_MVMT_DT BETWEEN TO_DATE(@[fm_mvmt_dt], 'YYYYMMDD') 
                                                      AND TO_DATE(@[to_mvmt_dt], 'YYYYMMDD') + 0.99999 )
                        )
                   #end
         
                 #if($chg_sts_cd_list3.size() > 0)
                        OR (
                             C.DMDT_CHG_STS_CD IN (
                                  #foreach( $chg_sts_cd in ${chg_sts_cd_list3} )
                                       #if($velocityCount < $chg_sts_cd_list3.size()) '$chg_sts_cd', #else '$chg_sts_cd' #end
                                  #end
                             )
                             AND (( C.FM_MVMT_DT BETWEEN TO_DATE(@[fm_mvmt_dt], 'YYYYMMDD') 
                                                      AND TO_DATE(@[to_mvmt_dt], 'YYYYMMDD') + 0.99999 )
                              OR (C.TO_MVMT_DT BETWEEN TO_DATE(@[fm_mvmt_dt], 'YYYYMMDD') 
                                                      AND TO_DATE(@[to_mvmt_dt], 'YYYYMMDD') + 0.99999 ))
                         )
                   #end
                   
                   #if (${all_long_stay_flg} == 'Y')
                        OR C.DMDT_CHG_STS_CD = 'L'
                   #end
              )
              #elseif (${opt_date} == 'APP_DT')
         AND     C.DMDT_CHG_STS_CD IN (
                        #foreach( $chg_sts_cd in ${chg_sts_cd_list} )
                             #if($velocityCount < $chg_sts_cd_list.size()) '$chg_sts_cd', #else '$chg_sts_cd' #end
                        #end
                   )

         AND     C.BZC_TRF_APLY_DT  BETWEEN TO_DATE(@[fm_bzc_trf_aply_dt], 'YYYYMMDD') 
                                    AND     TO_DATE(@[to_bzc_trf_aply_dt], 'YYYYMMDD') + 0.99999
             #end
         #end
         
#if (${chg_type} == 'G') 
        AND     C.CHG_SEQ = 1
#elseif (${chg_type} == 'B') 
        AND     C.CHG_SEQ > 1
#end
        AND     C.DMDT_INV_NO   = T1.DMDT_INV_NO (+)
#if(${dmdt_ar_if_cd} == 'Y')
        AND     NVL(T1.DMDT_AR_IF_CD, 'N') IN (@[dmdt_ar_if_cd], 'H')
#elseif(${dmdt_ar_if_cd} == 'N')
        AND     NVL(T1.DMDT_AR_IF_CD, 'N') =  @[dmdt_ar_if_cd]
#end
#if(${uclm_flg} != 'ALL')          
        AND     NVL(C.UCLM_FLG, 'N') =  @[uclm_flg]
#end
#if (${fx_ft_ovr_dys} != '0') 
        AND     C.FX_FT_OVR_DYS >= TO_NUMBER(@[fx_ft_ovr_dys])
#end  
#if (${cond_type} == 'date')
  #if (${fm_mvmt_yd_cd} != '')
       #if ($fm_mvmt_yd_cd.length() == 5)
        AND SUBSTR(C.FM_MVMT_YD_CD, 1, 5) = @[fm_mvmt_yd_cd]
       #else
        AND C.FM_MVMT_YD_CD LIKE @[fm_mvmt_yd_cd] || '%'    -- 2012.11.26 Modify
       #end
  #elseif (${to_mvmt_yd_cd} != '')
       #if ($to_mvmt_yd_cd.length() == 5)
        AND SUBSTR(C.TO_MVMT_YD_CD,1, 5) = @[to_mvmt_yd_cd]
       #else
        AND C.TO_MVMT_YD_CD LIKE @[to_mvmt_yd_cd] || '%'    -- 2012.11.26 Modify
       #end
  #end
#end
#if (${cond_type} == 'vvd_cd')
  #if (${vvd_cd} != '')
        AND     (           B.VSL_CD     = SUBSTR(@[vvd_cd],1,4) 
                        AND B.SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4) 
                        AND B.SKD_DIR_CD = SUBSTR(@[vvd_cd],9) 
                )
  #end
  #if (${pod_cd} != '' || ${pol_cd} != '')
          AND   (1=0
    #if (${pod_cd} != '')
               OR B.POD_CD = @[pod_cd]
    #end
    #if (${pol_cd} != '')
               OR B.POL_CD = @[pol_cd]
    #end
                )
  #end
  #if (${dem_type} == 'I') 
  AND (  (C.DMDT_TRF_CD='DMIF' AND C.TO_MVMT_STS_CD NOT IN ('ID','CS','DR'))
       OR (C.DMDT_TRF_CD='DMOF' AND C.DMDT_CHG_LOC_DIV_CD='POL')
       OR (C.DMDT_TRF_CD IN ('CTOC','CTIC','DTOC','DTIC'))
       )
  #elseif (${dem_type} == 'L') 
  AND ((C.DMDT_TRF_CD='DMIF' AND C.TO_MVMT_STS_CD='ID')
       OR (C.DMDT_TRF_CD='DMOF' AND C.DMDT_CHG_LOC_DIV_CD<>'POL')
       OR (C.DMDT_TRF_CD IN ('CTOC','CTIC','DTOC','DTIC'))
       )
  #end
#end
         
         #if (${cond_type} == 'cntr')
              #if (${bkg_no} != '')     
              AND B.BKG_NO IN (
                   #foreach( $bkg_cd in ${bkg_no_list} )
                        #if($velocityCount < $bkg_no_list.size()) '$bkg_cd', #else '$bkg_cd' #end
                   #end
                   )
              #end
         
              #if (${bl_no} != '')
              AND B.BL_NO IN (
                   #foreach( $bl_cd in ${bl_no_list} )
                        #if($velocityCount < $bl_no_list.size()) '$bl_cd', #else '$bl_cd' #end
                   #end
                   )
              #end
         
              #if (${cntr_no} != '')
              AND C.CNTR_NO IN (
                   #foreach( $cntr_cd in ${cntr_no_list} )
                        #if($velocityCount < $cntr_no_list.size()) '$cntr_cd', #else '$cntr_cd' #end
                   #end
                   )
              #end
         #end
         
#if (${cust_cd} != '')
    #if (${cust_type} == '')
        AND     (
                        C.ACT_CNT_CD     = SUBSTR(@[cust_cd],1,2)
                AND     C.ACT_CUST_SEQ     = LTRIM(SUBSTR(@[cust_cd],3), '0')
                OR      BS.CUST_CNT_CD     = SUBSTR(@[cust_cd],1,2)
                AND     BS.CUST_SEQ        = LTRIM(SUBSTR(@[cust_cd],3), '0')
                OR      BC.CUST_CNT_CD     = SUBSTR(@[cust_cd],1,2)
                AND     BC.CUST_SEQ        = LTRIM(SUBSTR(@[cust_cd],3),'0')
                OR      BN.CUST_CNT_CD     = SUBSTR(@[cust_cd],1,2)
                AND     BN.CUST_SEQ        = LTRIM(SUBSTR(@[cust_cd],3), '0')
                OR      (
                        EXISTS  (
                                SELECT  'X'
                                FROM    INV_AR_MN I
                                WHERE   I.BKG_NO     = B.BKG_NO
                                AND     I.IO_BND_CD  = SUBSTR(C.DMDT_TRF_CD, 3, 1)
                                AND     AR_IF_NO     =  (
                                                        SELECT  MAX(AR_IF_NO)
                                                        FROM    INV_AR_MN
                                                        WHERE   BKG_NO    = B.BKG_NO
                                                        AND     IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
                                                        )
                                AND     I.ACT_CUST_CNT_CD   = SUBSTR(@[cust_cd],1,2)
                                AND     I.ACT_CUST_SEQ      = LTRIM(SUBSTR(@[cust_cd],3),'0')
                                AND     ROWNUM  = 1
                                )
                        )
                )
    #elseif (${cust_type} == 'P')
        AND     C.ACT_CNT_CD        = SUBSTR(@[cust_cd],1,2)
        AND     C.ACT_CUST_SEQ      = LTRIM(SUBSTR(@[cust_cd],3),'0')
    #elseif (${cust_type} == 'S') 
        AND     BS.CUST_CNT_CD      = SUBSTR(@[cust_cd],1,2)
        AND     BS.CUST_SEQ         = LTRIM(SUBSTR(@[cust_cd],3),'0')
    #elseif (${cust_type} == 'C') 
        AND     BC.CUST_CNT_CD      = SUBSTR(@[cust_cd],1,2)
        AND     BC.CUST_SEQ         = LTRIM(SUBSTR(@[cust_cd],3),'0')
    #elseif (${cust_type} == 'N') 
        AND     BN.CUST_CNT_CD      = SUBSTR(@[cust_cd],1,2)
        AND     BN.CUST_SEQ         = LTRIM(SUBSTR(@[cust_cd],3),'0')
    #elseif (${cust_type} == 'A')
        AND     EXISTS  (
                        SELECT  'X'
                        FROM    INV_AR_MN I
                        WHERE   I.BKG_NO        = B.BKG_NO
                        AND     I.IO_BND_CD     = SUBSTR(C.DMDT_TRF_CD, 3, 1)
                        AND     AR_IF_NO        =   (
                                                    SELECT  MAX(AR_IF_NO) 
                                                    FROM    INV_AR_MN
                                                    WHERE   BKG_NO = B.BKG_NO
                                                    AND     IO_BND_CD = SUBSTR(C.DMDT_TRF_CD, 3, 1)
                                                    )
                        AND     I.ACT_CUST_CNT_CD   = SUBSTR(@[cust_cd],1,2)
                        AND     I.ACT_CUST_SEQ      = LTRIM(SUBSTR(@[cust_cd],3),'0')
                        AND     ROWNUM      = 1
                        )
    #end
#end         
#if (${svc_provdr} != '') 
        AND     C.VNDR_SEQ      = LTRIM(@[svc_provdr],'0')
#end

#if (${sc_no} != '') 
        AND     B.SC_NO         = @[sc_no]
#end

#if (${rfa_no} != '') 
        AND     B.RFA_NO        = @[rfa_no]
#end
#if (${dmdt_cntr_tp_cd_list} != '')
        AND     B.DMDT_CNTR_TP_CD   IN (
                #foreach($dmdt_cntr_tp_cd in ${dmdt_cntr_tp_cd_list} )
                    #if($velocityCount < $dmdt_cntr_tp_cd_list.size()) '$dmdt_cntr_tp_cd', #else '$dmdt_cntr_tp_cd' #end
                #end
        )
#end
#if (${bkg_rcv_term_cd_list} != '')
        AND     B.BKG_RCV_TERM_CD   IN (
                #foreach($bkg_rcv_term_cd in ${bkg_rcv_term_cd_list} )
                    #if($velocityCount < $bkg_rcv_term_cd_list.size()) '$bkg_rcv_term_cd', #else '$bkg_rcv_term_cd' #end
                #end
         )
#end
#if (${bkg_de_term_cd_list} != '')
        AND     B.BKG_DE_TERM_CD    IN (
                #foreach($bkg_de_term_cd in ${bkg_de_term_cd_list} )
                    #if($velocityCount < $bkg_de_term_cd_list.size()) '$bkg_de_term_cd', #else '$bkg_de_term_cd' #end
                #end
        )
#end
#if (${fm_mvmt_sts_cd_list} != '')
        AND NVL(C.FM_MVMT_STS_CD, 'N/A')    IN (
                #foreach($fm_mvmt_sts_cd in ${fm_mvmt_sts_cd_list} )
                     #if($velocityCount < $fm_mvmt_sts_cd_list.size()) '$fm_mvmt_sts_cd', #else '$fm_mvmt_sts_cd' #end
                #end
        )
#end
#if (${to_mvmt_sts_cd_list} != '')
        AND     NVL(C.TO_MVMT_STS_CD, 'N/A') IN (
                #foreach($to_mvmt_sts_cd in ${to_mvmt_sts_cd_list} )
                     #if($velocityCount < $to_mvmt_sts_cd_list.size()) '$to_mvmt_sts_cd', #else '$to_mvmt_sts_cd' #end
                #end
        )
#end  
#if (${ofc_trns_rhq_cng_flg} != 'ALL')
         AND   C.OFC_TRNS_RHQ_CNG_FLG = @[ofc_trns_rhq_cng_flg]
#end
        )            T
#if ( ( ${org_gubun_cd} != '') && (${fm_loc_cd} != '') )
        , MDM_LOCATION T1
#end
#if ( (${dest_gubun_cd} != '' ) && ( ${to_loc_cd} != ''))
        , MDM_LOCATION T2
#end

WHERE   1=1

#if (${org_gubun_cd} != '')
  #if ( (${org_gubun_cd} == 'CONTI_CD' || ${org_gubun_cd} == 'POL_CD') && (${fm_loc_cd} != '') )
AND     T.POL_CD        = T1.LOC_CD
  #elseif ( ( ${org_gubun_cd} == 'POR_CD') && (${fm_loc_cd} != '') )
AND    T.POR_CD  = T1.LOC_CD
  #end

  #if ( ${fm_loc_cd} != '')
     #if (${org_gubun_cd} == 'CONTI_CD')
AND    T1.CONTI_CD LIKE @[fm_loc_cd] || '%'
     #elseif (${org_gubun_cd} == 'POL_CD')
AND    T1.LOC_CD   LIKE @[fm_loc_cd] || '%'
     #elseif (${org_gubun_cd} == 'POR_CD')
AND    T1.LOC_CD   LIKE @[fm_loc_cd] || '%'
     #end
  #end
#end

#if (${dest_gubun_cd} != '' )
  #if ((${dest_gubun_cd} == 'CONTI_CD' || ${dest_gubun_cd} == 'POD_CD') && (${to_loc_cd} != '') )
AND    T.POD_CD     = T2.LOC_CD
  #elseif ( ( ${dest_gubun_cd} == 'DEL_CD') && (${to_loc_cd} != '') )
AND    T.DEL_CD     = T2.LOC_CD
  #end
  #if ( ${to_loc_cd} != '')
     #if (${dest_gubun_cd} == 'CONTI_CD')
AND     T2.CONTI_CD = @[to_loc_cd]
     #elseif (${dest_gubun_cd} == 'POD_CD')
AND     T2.LOC_CD   LIKE @[to_loc_cd] || '%'
     #elseif (${dest_gubun_cd} == 'DEL_CD')
AND     T2.LOC_CD   LIKE @[to_loc_cd] || '%'
     #end
  #end
#end

#if (${dmdt_bkg_cgo_tp_cd_list} != '')

AND     DMDT_BKG_CGO_TP_CD_GUBUN IN (
               #foreach($dmdt_bkg_cgo_tp_cd in ${dmdt_bkg_cgo_tp_cd_list} )
                    #if($velocityCount < $dmdt_bkg_cgo_tp_cd_list.size()) '$dmdt_bkg_cgo_tp_cd', #else '$dmdt_bkg_cgo_tp_cd' #end
               #end
               )
#end

#if (${inact_sts_cd} != '')

AND (
			SELECT  CASE 
						WHEN NVL(MAX(DD.DMDT_DELT_RQST_STS_CD), 'N') IN ('C', 'N') THEN 'N'
						WHEN 0 < MAX((	
									SELECT  COUNT(1)
									  FROM  DMT_CHG_DELT_PATH 
									 WHERE  SYS_AREA_GRP_ID     = DD.SYS_AREA_GRP_ID
									   AND  CNTR_NO             = DD.CNTR_NO
									   AND  CNTR_CYC_NO         = DD.CNTR_CYC_NO
									   AND  DMDT_TRF_CD         = DD.DMDT_TRF_CD
									   AND  DMDT_CHG_LOC_DIV_CD = DD.DMDT_CHG_LOC_DIV_CD
									   AND  CHG_SEQ             = DD.CHG_SEQ
									   AND  CHG_OFC_CD          = DD.CHG_OFC_CD
									   AND  DELT_SEQ            = DD.DELT_SEQ
									   AND  CHG_DELT_PATH_LVL  >=
											(
												SELECT  max(CHG_DELT_PATH_LVL)
												  FROM  DMT_CHG_DELT_PATH
												 WHERE  SYS_AREA_GRP_ID        = DD.SYS_AREA_GRP_ID
												   AND  CNTR_NO                = DD.CNTR_NO
												   AND  CNTR_CYC_NO            = DD.CNTR_CYC_NO
												   AND  DMDT_TRF_CD            = DD.DMDT_TRF_CD
												   AND  DMDT_CHG_LOC_DIV_CD    = DD.DMDT_CHG_LOC_DIV_CD
												   AND  CHG_SEQ                = DD.CHG_SEQ
												   AND  CHG_OFC_CD             = DD.CHG_OFC_CD
												   AND  DELT_SEQ               = DD.DELT_SEQ
												   AND  CHG_DELT_PATH_CPLS_FLG = 'Y'
											)
									   and  CHG_DELT_STS_CD = 'A'
								 )) THEN 'H'		--// Charge Deletion 요청 불가, Charge Deletion Cancel 불가
						ELSE MAX(DD.DMDT_DELT_RQST_STS_CD)
					END
						
			  FROM  DMT_CHG_DELT_RQST_APRO DD
			 WHERE  DD.SYS_AREA_GRP_ID     = T.SVR_ID
			   AND	DD.CNTR_NO		       = T.CNTR_NO
			   AND	DD.CNTR_CYC_NO		   = T.CNTR_CYC_NO
			   AND	DD.DMDT_TRF_CD		   = T.DMDT_TRF_CD
			   AND	DD.DMDT_CHG_LOC_DIV_CD = T.DMDT_CHG_LOC_DIV_CD
			   AND	DD.CHG_SEQ			   = T.CHG_SEQ
			   AND  DD.CHG_OFC_CD          = T.OFC_CD
			   AND  DD.DELT_SEQ            = 
					( 
						SELECT  NVL(MAX(DS.DELT_SEQ), 0) 
						  FROM  DMT_CHG_DELT_RQST_APRO DS
						 WHERE  DS.SYS_AREA_GRP_ID     = DD.SYS_AREA_GRP_ID
						   AND  DS.CNTR_NO	           = DD.CNTR_NO
						   AND  DS.CNTR_CYC_NO	       = DD.CNTR_CYC_NO
						   AND  DS.DMDT_TRF_CD	       = DD.DMDT_TRF_CD
						   AND  DS.DMDT_CHG_LOC_DIV_CD = DD.DMDT_CHG_LOC_DIV_CD
						   AND  DS.CHG_SEQ		       = DD.CHG_SEQ
						   AND  DS.CHG_OFC_CD          = DD.CHG_OFC_CD  
						   AND  DS.DMDT_DELT_RQST_STS_CD != 'C'
					)  
		 )IN (
               #foreach($inact_sts_cd in ${inact_sts_cd_list} )
                    #if($velocityCount < $inact_sts_cd_list.size()) '$inact_sts_cd', #else '$inact_sts_cd' #end
               #end
               )
#end

#if (${aft_dar_sts_cd_list} != '')
	#if (${aft_dar_sts_all_flg} != '')
		AND (DMDT_EXPT_RQST_STS_CD IS NOT NULL AND DMDT_EXPT_RQST_STS_CD <>'T')
	#else
		AND (1=0
		#if (${aft_dar_sts_process_flg} != '')
			OR DMDT_EXPT_RQST_STS_CD NOT IN ('A', 'R', 'J', 'O', 'T')
		#end
			OR DMDT_EXPT_RQST_STS_CD IN (
			#foreach($aft_dar_sts_cd in ${aft_dar_sts_cd_list} )
				#if($velocityCount < $aft_dar_sts_cd_list.size())
					'$aft_dar_sts_cd', 
				#else 
					'$aft_dar_sts_cd' 
				#end
			#end
			)
		)
	#end
#end

ORDER BY CNTR_NO, FM_MVMT_DT			]]></sql>
			<params>
				<param name="fm_mvmt_dt" type="12" value="1" out="N"/>
				<param name="to_mvmt_dt" type="12" value="1" out="N"/>
				<param name="fm_bzc_trf_aply_dt" type="12" value="1" out="N"/>
				<param name="to_bzc_trf_aply_dt" type="12" value="1" out="N"/>
				<param name="dmdt_ar_if_cd" type="12" value="1" out="N"/>
				<param name="uclm_flg" type="12" value="1" out="N"/>
				<param name="fx_ft_ovr_dys" type="12" value="1" out="N"/>
				<param name="fm_mvmt_yd_cd" type="12" value="1" out="N"/>
				<param name="to_mvmt_yd_cd" type="12" value="1" out="N"/>
				<param name="vvd_cd" type="12" value="1" out="N"/>
				<param name="pod_cd" type="12" value="1" out="N"/>
				<param name="pol_cd" type="12" value="1" out="N"/>
				<param name="cust_cd" type="12" value="1" out="N"/>
				<param name="svc_provdr" type="12" value="1" out="N"/>
				<param name="sc_no" type="12" value="1" out="N"/>
				<param name="rfa_no" type="12" value="1" out="N"/>
				<param name="ofc_trns_rhq_cng_flg" type="12" value="1" out="N"/>
				<param name="fm_loc_cd" type="12" value="1" out="N"/>
				<param name="to_loc_cd" type="12" value="1" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
