<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DMTCalculationDBDAOSearchBFRExceptionByGenerationRSQL">
			<desc><![CDATA[searchBFRExceptionByGeneration]]></desc>
			<sql><![CDATA[
SELECT RFA_EXPT_APRO_NO 	APPR_NO
      ,RFA_EXPT_DAR_NO 		DAR_NO
	  ,RFA_EXPT_MAPG_SEQ	MAPG_SEQ
	  ,RFA_EXPT_VER_SEQ		VER_SEQ	
      ,RFA_RQST_DTL_SEQ 	DTL_SEQ
	  ,CVRG_CMB_SEQ 		CMB_SEQ
      ,FT_USE_FLG 			FTIME_MK
      ,ADD_DYS 				ADD_DAY
      ,TTL_DYS 				TTL_DAY
      ,XCLD_SAT_FLG 		EXCL_SAT
      ,XCLD_SUN_FLG 		EXCL_SUN
      ,XCLD_HOL_FLG 		EXCL_HOLI
      ,RT_USE_FLG 			RATE_MK
      ,CURR_CD 				CUR_CD
  FROM (SELECT  /*+ USE_NL( P M D C ) NO_EXPAND  
                 INDEX( P  XUK1PRI_RP_HDR )  
                 INDEX_DESC( M  XAK1DMT_RFA_EXPT_TRF  )  
                 INDEX( D  XAK1DMT_RFA_EXPT_TRF_DTL) 
                 INDEX( C  XPKDMT_RFA_EXPT_CVRG_CMB )*/ 
				M.RFA_EXPT_APRO_NO
                ,D.RFA_EXPT_DAR_NO
				,D.RFA_EXPT_MAPG_SEQ
				,D.RFA_EXPT_VER_SEQ
                ,D.RFA_RQST_DTL_SEQ
				,D.CVRG_CMB_SEQ
                ,D.FT_USE_FLG
                ,D.ADD_DYS
                ,D.TTL_DYS
                ,D.XCLD_SAT_FLG
                ,D.XCLD_SUN_FLG
                ,D.XCLD_HOL_FLG
                ,D.RT_USE_FLG
                ,D.CURR_CD
            FROM DMT_RFA_EXPT_TRF_DTL 	D
                ,DMT_RFA_EXPT_TRF 		M
                ,DMT_RFA_EXPT_CVRG_CMB 	C
				,PRI_RP_HDR				P
           WHERE M.RFA_EXPT_DAR_NO 		= D.RFA_EXPT_DAR_NO
 			 AND M.RFA_EXPT_MAPG_SEQ 	= D.RFA_EXPT_MAPG_SEQ          
             AND M.RFA_EXPT_VER_SEQ 	= D.RFA_EXPT_VER_SEQ           
            
			 AND D.RFA_EXPT_DAR_NO 		= C.RFA_EXPT_DAR_NO
			 AND D.RFA_EXPT_MAPG_SEQ 	= C.RFA_EXPT_MAPG_SEQ          
             AND D.RFA_EXPT_VER_SEQ 	= C.RFA_EXPT_VER_SEQ           
             AND D.RFA_RQST_DTL_SEQ 	= C.RFA_RQST_DTL_SEQ
			 AND D.CVRG_CMB_SEQ			= C.CVRG_CMB_SEQ
            
			 AND D.EFF_DT 				<= TO_DATE (@[efft_dt], 'rrrrmmdd')
             AND D.EXP_DT 				>= TO_DATE (@[efft_dt], 'rrrrmmdd')
             AND M.DMDT_EXPT_RQST_STS_CD = 'A'
             AND M.RFA_EXPT_APRO_NO IS NOT NULL
			 AND M.PROP_NO 				= P.PROP_NO
			 AND P.RFA_NO 				= @[rfa_no]
             AND D.DMDT_TRF_CD 			= @[dmdt_trf_cd]
             AND D.DMDT_CNTR_TP_CD 		= @[cntr_tp]
             AND D.DMDT_CGO_TP_CD 		= @[cgo_tp]

#if (${io_bnd_cd} == 'I') 


	#if (${dmdt_trf_cd} == 'DMIF') 
		   AND (   C.CVRG_CONTI_CD = NVL(@[yrd_conti_cd], ' ')     OR C.CVRG_CONTI_CD = ' ')
		   AND (   C.CVRG_CNT_CD = NVL(@[yrd_cnt_cd]    , ' ')     OR C.CVRG_CNT_CD = ' ')
		   AND (   C.CVRG_RGN_CD = NVL(@[yrd_rgn_cd]    , ' ')     OR C.CVRG_RGN_CD = ' ')
		   AND (   C.CVRG_STE_CD = NVL(@[yrd_ste_cd]    , ' ')     OR C.CVRG_STE_CD = ' ')
		   AND (   C.CVRG_LOC_CD = NVL(@[yrd_loc_cd]    , ' ')     OR C.CVRG_LOC_CD = ' ')
		   AND (   C.ORG_DEST_CONTI_CD = NVL(@[por_conti_cd] , ' ')   OR C.ORG_DEST_CONTI_CD = ' ')
		   AND (   C.ORG_DEST_CNT_CD = NVL(@[por_cnt_cd]     , ' ')   OR C.ORG_DEST_CNT_CD = ' ')
		   AND (   C.ORG_DEST_RGN_CD = NVL(@[por_rgn_cd]     , ' ')   OR C.ORG_DEST_RGN_CD = ' ')
		   AND (   C.ORG_DEST_STE_CD = NVL(@[por_ste_cd]     , ' ')   OR C.ORG_DEST_STE_CD = ' ')
		   AND (   C.ORG_DEST_LOC_CD = NVL(@[por_loc_cd]     , ' ')   OR C.ORG_DEST_LOC_CD = ' ')

           -- 2010-06-14 수정
           AND (
				( 	   ( D.FNL_DEST_FLG = 'Y'	AND	( D.FNL_DEST_CNT_CD = NVL(@[del_cnt_cd]     , ' ') OR D.FNL_DEST_CNT_CD   = ' '))
				   AND ( D.FNL_DEST_FLG = 'Y'	AND	( D.FNL_DEST_RGN_CD = NVL(@[del_rgn_cd]     , ' ') OR D.FNL_DEST_RGN_CD   = ' '))
				   AND ( D.FNL_DEST_FLG = 'Y'	AND	( D.FNL_DEST_STE_CD = NVL(@[del_ste_cd]     , ' ') OR D.FNL_DEST_STE_CD   = ' '))
				   AND ( D.FNL_DEST_FLG = 'Y'	AND	( D.FNL_DEST_LOC_CD = NVL(@[del_loc_cd]     , ' ') OR D.FNL_DEST_LOC_CD   = ' '))
				)
				OR  NVL(D.FNL_DEST_FLG,'N') = 'N'
			)

	#elseif (${dmdt_trf_cd} == 'DTIC' || ${dmdt_trf_cd} == 'CTIC') 
		   AND (   C.CVRG_CONTI_CD = NVL(@[del_conti_cd] , ' ')   OR C.CVRG_CONTI_CD = ' ')
		   AND (   C.CVRG_CNT_CD = NVL(@[del_cnt_cd]     , ' ')   OR C.CVRG_CNT_CD = ' ')
		   AND (   C.CVRG_RGN_CD = NVL(@[del_rgn_cd]     , ' ')   OR C.CVRG_RGN_CD = ' ')
		   AND (   C.CVRG_STE_CD = NVL(@[del_ste_cd]     , ' ')   OR C.CVRG_STE_CD = ' ')
		   AND (   C.CVRG_LOC_CD = NVL(@[del_loc_cd]     , ' ')   OR C.CVRG_LOC_CD = ' ')
		   AND (   C.ORG_DEST_CONTI_CD = NVL(@[por_conti_cd] , ' ')   OR C.ORG_DEST_CONTI_CD = ' ')
		   AND (   C.ORG_DEST_CNT_CD = NVL(@[por_cnt_cd]     , ' ')   OR C.ORG_DEST_CNT_CD = ' ')
		   AND (   C.ORG_DEST_RGN_CD = NVL(@[por_rgn_cd]     , ' ')   OR C.ORG_DEST_RGN_CD = ' ')
		   AND (   C.ORG_DEST_STE_CD = NVL(@[por_ste_cd]     , ' ')   OR C.ORG_DEST_STE_CD = ' ')
		   AND (   C.ORG_DEST_LOC_CD = NVL(@[por_loc_cd]     , ' ')   OR C.ORG_DEST_LOC_CD = ' ')
	#end

#elseif (${io_bnd_cd} == 'O')

 	#if (${dmdt_trf_cd} == 'DMOF') 
			AND (   C.CVRG_CONTI_CD = NVL(@[yrd_conti_cd] , ' ')   OR C.CVRG_CONTI_CD = ' ')
			AND (   C.CVRG_CNT_CD = NVL(@[yrd_cnt_cd]     , ' ')   OR C.CVRG_CNT_CD = ' ')
			AND (   C.CVRG_RGN_CD = NVL(@[yrd_rgn_cd]     , ' ')   OR C.CVRG_RGN_CD = ' ')
			AND (   C.CVRG_STE_CD = NVL(@[yrd_ste_cd]     , ' ')   OR C.CVRG_STE_CD = ' ')
			AND (   C.CVRG_LOC_CD = NVL(@[yrd_loc_cd]     , ' ')   OR C.CVRG_LOC_CD = ' ')
			AND (   C.ORG_DEST_CONTI_CD = NVL(@[del_conti_cd] , ' ')   OR C.ORG_DEST_CONTI_CD = ' ')
			AND (   C.ORG_DEST_CNT_CD = NVL(@[del_cnt_cd]     , ' ')   OR C.ORG_DEST_CNT_CD = ' ')
			AND (   C.ORG_DEST_RGN_CD = NVL(@[del_rgn_cd]     , ' ')   OR C.ORG_DEST_RGN_CD = ' ')
			AND (   C.ORG_DEST_STE_CD = NVL(@[del_ste_cd]     , ' ')   OR C.ORG_DEST_STE_CD = ' ')
			AND (   C.ORG_DEST_LOC_CD = NVL(@[del_loc_cd]     , ' ')   OR C.ORG_DEST_LOC_CD = ' ')
			
			-- 2010-06-14 수정            
            AND (
				(     ( D.FNL_DEST_FLG = 'Y'	AND	( D.FNL_DEST_CNT_CD = NVL(@[por_cnt_cd]     , ' ') OR D.FNL_DEST_CNT_CD   = ' '))
				  AND ( D.FNL_DEST_FLG = 'Y'	AND	( D.FNL_DEST_RGN_CD = NVL(@[por_rgn_cd]     , ' ') OR D.FNL_DEST_RGN_CD   = ' '))
				  AND ( D.FNL_DEST_FLG = 'Y'	AND	( D.FNL_DEST_STE_CD = NVL(@[por_ste_cd]     , ' ') OR D.FNL_DEST_STE_CD   = ' '))
				  AND ( D.FNL_DEST_FLG = 'Y'	AND	( D.FNL_DEST_LOC_CD = NVL(@[por_loc_cd]     , ' ') OR D.FNL_DEST_LOC_CD   = ' '))
				)
				OR  NVL(D.FNL_DEST_FLG,'N') = 'N'
			)

	#elseif (${dmdt_trf_cd} == 'DTOC' || ${dmdt_trf_cd} == 'CTOC') 
			AND (   C.CVRG_CONTI_CD = NVL(@[por_conti_cd] , ' ')    OR C.CVRG_CONTI_CD = ' ')
			AND (   C.CVRG_CNT_CD = NVL(@[por_cnt_cd]     , ' ')    OR C.CVRG_CNT_CD = ' ')
			AND (   C.CVRG_RGN_CD = NVL(@[por_rgn_cd]     , ' ')    OR C.CVRG_RGN_CD = ' ')
			AND (   C.CVRG_STE_CD = NVL(@[por_ste_cd]     , ' ')    OR C.CVRG_STE_CD = ' ')
			AND (   C.CVRG_LOC_CD = NVL(@[por_loc_cd]     , ' ')    OR C.CVRG_LOC_CD = ' ')
			AND (   C.ORG_DEST_CONTI_CD = NVL(@[del_conti_cd] , ' ')   OR C.ORG_DEST_CONTI_CD = ' ')
			AND (   C.ORG_DEST_CNT_CD = NVL(@[del_cnt_cd]     , ' ')   OR C.ORG_DEST_CNT_CD = ' ')
			AND (   C.ORG_DEST_RGN_CD = NVL(@[del_rgn_cd]     , ' ')   OR C.ORG_DEST_RGN_CD = ' ')
			AND (   C.ORG_DEST_STE_CD = NVL(@[del_ste_cd]     , ' ')   OR C.ORG_DEST_STE_CD = ' ')
			AND (   C.ORG_DEST_LOC_CD = NVL(@[del_loc_cd]     , ' ')   OR C.ORG_DEST_LOC_CD = ' ')
	#end	

#end

			AND		(
						NVL(D.ACT_CUST_CNT_CD, ' ')	=	DECODE(D.ACT_CUST_CNT_CD, NULL, ' ', NVL(@[act_cust_cnt_cd], ' '))
					)
            AND		(
						NVL(D.ACT_CUST_SEQ, 0)	=	DECODE(D.ACT_CUST_SEQ, NULL, 0, NVL(@[act_cust_seq], 0))
					)
        ORDER BY M.APRO_DT DESC
                ,C.CVRG_CONTI_CD DESC
                ,C.CVRG_CNT_CD DESC
                ,C.CVRG_RGN_CD DESC
                ,C.CVRG_LOC_CD DESC
				,DECODE (D.ACT_CUST_CNT_CD , NULL, 2 , 1) ASC
				,DECODE (D.ACT_CUST_SEQ , NULL, 2 , 1) ASC
                ,C.ORG_DEST_CONTI_CD DESC
                ,C.ORG_DEST_CNT_CD DESC
                ,C.ORG_DEST_RGN_CD DESC
                ,C.ORG_DEST_LOC_CD DESC
				,D.FNL_DEST_CONTI_CD DESC
				,D.FNL_DEST_CNT_CD DESC
				,D.FNL_DEST_RGN_CD DESC    
				,D.FNL_DEST_STE_CD DESC
				,D.FNL_DEST_LOC_CD DESC
				
 )
 WHERE ROWNUM = 1			]]></sql>
			<params>
				<param name="efft_dt" type="12" value="" out="N"/>
				<param name="rfa_no" type="12" value="" out="N"/>
				<param name="dmdt_trf_cd" type="12" value="" out="N"/>
				<param name="cntr_tp" type="12" value="" out="N"/>
				<param name="cgo_tp" type="12" value="" out="N"/>
				<param name="yrd_conti_cd" type="12" value="" out="N"/>
				<param name="yrd_cnt_cd" type="12" value="" out="N"/>
				<param name="yrd_rgn_cd" type="12" value="" out="N"/>
				<param name="yrd_ste_cd" type="12" value="" out="N"/>
				<param name="yrd_loc_cd" type="12" value="" out="N"/>
				<param name="por_conti_cd" type="12" value="" out="N"/>
				<param name="por_cnt_cd" type="12" value="" out="N"/>
				<param name="por_rgn_cd" type="12" value="" out="N"/>
				<param name="por_ste_cd" type="12" value="" out="N"/>
				<param name="por_loc_cd" type="12" value="" out="N"/>
				<param name="del_cnt_cd" type="12" value="" out="N"/>
				<param name="del_rgn_cd" type="12" value="" out="N"/>
				<param name="del_ste_cd" type="12" value="" out="N"/>
				<param name="del_loc_cd" type="12" value="" out="N"/>
				<param name="del_conti_cd" type="12" value="" out="N"/>
				<param name="act_cust_cnt_cd" type="12" value="" out="N"/>
				<param name="act_cust_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
