<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EqInterchangeDBDAOOnewayLoadingPFMCListRSQL">
			<desc><![CDATA[두기민 2016-04-08 Oneway Loading PFMC 조회]]></desc>
			<sql><![CDATA[
SELECT * FROM
(SELECT  BAT.CNTR_NO
       ,BAT.CNTR_STS_SEQ
       ,BAT.CNMV_YR
       ,BAT.CNMV_ID_NO
       ,BAT.AGMT_CTY_CD
       ,BAT.AGMT_SEQ
       ,BAT.BKG_NO
       ,BAT.COST_ROUT_NO
       ,BAT.CNTR_TPSZ_CD
       ,VEN.VNDR_ABBR_NM LESSOR
       ,BAT.REF_NO
       ,BAT.LSTM_CD
       ,BAT.PRE_MVMT_STS_CD||'-'||BAT.MVMT_STS_CD MVMT
       ,TO_CHAR(BAT.PRE_CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') PRE_EVENTDATE
       ,TO_CHAR(BAT.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') CNMV_DT
       ,TO_CHAR(BAT.ONH_DT, 'YYYY-MM-DD') ONH_DT
       ,TO_CHAR(BAT.CNMV_EVNT_DT,'YYYYMMDDHH24MISS') CNTR_MV_DT
       ,BAT.ONH_YD_CD ONH_YD
       ,BAT.ONH_FREE_DYS FREE_DYS
       ,NVL(BAT.USD_DYS,'0') USING_DAYS
       ,BAT.SHPR_NM SHPR
       ,BAT.CNEE_NM CNEE
       ,BAT.OB_SLS_OFC_CD SLS_OFC
       ,BAT.POR_CD POR
       ,BAT.POL_CD POL
       ,BAT.POD_CD POD
       ,BAT.DEL_CD DEL
       ,DECODE(LOLF.DEL_DOL_YN,NULL,BAT.DEL_DOL_FLG,LOLF.DEL_DOL_YN) DEL_DOL
       ,BAT.POR_DOL_FLG POR_DOL
       ,TO_CHAR(BAT.POL_ETD_DT, 'YYYY-MM-DD') ETD_DT
       ,TO_CHAR(BAT.POD_ETA_DT, 'YYYY-MM-DD') ETA_DT
       ,BAT.TRD_CD TRD
       ,BAT.RLANE_CD R_LANE
       ,BAT.VVD
       ,BAT.LON
       ,BAT.PUC
       ,BAT.PCR
       ,BAT.LOF
       ,BAT.DOC
       ,BAT.DCR
       ,BAT.ORG_YD_CD
       ,BAT.MVMT_STS_CD
       ,BAT.CUST_TP_CD CUST_TP
       ,BAT.CUST_GRP_ID G_CUST_CD
       ,BAT.CUST_GRP_NM G_CUST_NM
       ,BAT.CNTR_DISP_FLG DISP_FLG
       ,BAT.LODG_RCC_CD RCC_CD
       ,BAT.LODG_LCC_CD LCC_CD
       ,BAT.LODG_ECC_CD ECC_CD
       ,BAT.LODG_SCC_CD SCC_CD
       ,DECODE(MBEDW.CNTR_NO,NULL,'N','Y') MST_IF
       ,DECODE(BAT.RFA_NO,NULL,BAT.SC_NO,BAT.RFA_NO) SC_RFA_NO
       ,DECODE(BAT.RFA_NO,NULL,DECODE(BAT.CUST_SEQ,NULL,BAT.REAL_CUST_CNT_CD||RPAD('0',6,BAT.REAL_CUST_SEQ),BAT.CUST_CNT_CD||RPAD('0',6,BAT.CUST_SEQ)),BAT.CTRT_CUST_CNT_CD||RPAD('0',6,BAT.CTRT_CUST_SEQ)) CUST_NO
       ,DECODE(BAT.RFA_NO,NULL,DECODE(BAT.CTRT_PTY_NM,NULL,BAT.REAL_CUST_NM,BAT.CTRT_PTY_NM),BAT.CUST_LGL_ENG_NM) CUST_NM
       ,(SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
              MM.MVMT_STS_CD
         FROM CTM_MOVEMENT MM
        WHERE MM.CNTR_NO = BAT.CNTR_NO
          AND MM.CTRT_SEQ = BAT.AGMT_SEQ  
          AND ROWNUM = 1) AS CRR_MVMT_STS_CD
      ,(SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
              TO_CHAR(MM.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI')
         FROM CTM_MOVEMENT MM
        WHERE MM.CNTR_NO = BAT.CNTR_NO
          AND MM.CTRT_SEQ = BAT.AGMT_SEQ  
          AND ROWNUM = 1) AS CRR_CNMV_EVNT_DT  
      ,(SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
              MM.ORG_YD_CD
         FROM CTM_MOVEMENT MM
        WHERE MM.CNTR_NO = BAT.CNTR_NO
          AND MM.CTRT_SEQ = BAT.AGMT_SEQ  
          AND ROWNUM = 1)  AS CRR_ORG_YD_CD  
  FROM LSE_ONEWAY_LODG_PERF_BAT BAT, MDM_VENDOR VEN, LSE_ONEWAY_LOAD_PFMC LOLF, MAS_OFFH_BKG_LIST MBEDW
 WHERE BAT.VNDR_SEQ = VEN.VNDR_SEQ
   AND BAT.CNTR_NO = LOLF.CNTR_NO(+)
   AND BAT.AGMT_SEQ = LOLF.AGMT_SEQ(+)
   AND BAT.LSTM_CD = LOLF.LSTM_CD(+)
   AND BAT.CNTR_TPSZ_CD = LOLF.CNTR_TPSZ_CD(+)
   AND BAT.BKG_NO = LOLF.BKG_NO(+)
   AND BAT.CNMV_EVNT_DT= LOLF.CNMV_DT(+)
   AND BAT.BKG_NO = MBEDW.BKG_NO(+)
   AND BAT.CNTR_NO = MBEDW.CNTR_NO(+)
#if (${period} == 'D')
    AND BAT.CNMV_EVNT_DT BETWEEN  TO_DATE(@[froms], 'YYYYMMDD') + .0 AND TO_DATE(@[tos], 'YYYYMMDD') + .99999
#elseif(${period} == 'M')
    AND BAT.CNMV_EVNT_DT BETWEEN  TO_DATE(@[froms], 'YYYYMM') + .0 AND TO_DATE(@[tos], 'YYYYMMDD') + .99999
#else
    AND BAT.CNMV_EVNT_DT	BETWEEN	( 
							SELECT TO_DATE(K.WK_ST_DT,'YYYYMMDD') + .0
							FROM   EQR_WK_PRD K
							WHERE  K.PLN_YR||K.PLN_WK = @[froms]
							)	
			AND				( 
							 SELECT TO_DATE(K.WK_END_DT,'YYYYMMDD') + .99999
							 FROM   EQR_WK_PRD K
							 WHERE  K.PLN_YR||K.PLN_WK = @[tos]
							) 
#end
#if (${mvmt} != '')
    AND SUBSTR(@[mvmt],3,2) = BAT.PRE_MVMT_STS_CD
#end
#if (${trd} != '')
    AND BAT.TRD_CD = @[trd]
#end
#if (${dpsl} != '')
    AND BAT.CNTR_DISP_FLG = 'Y'
#end
#if (${loc_tp} == 'OFC')
    AND BAT.OB_SLS_OFC_CD = @[loc_to]
#elseif(${loc_tp} == 'RCC')
    AND BAT.LODG_RCC_CD = @[loc_to]
#elseif(${loc_tp} == 'LCC')
    AND BAT.LODG_LCC_CD = @[loc_to]
#elseif(${loc_tp} == 'ECC')
    AND BAT.LODG_ECC_CD = @[loc_to]
#elseif(${loc_tp} == 'SCC')
    AND BAT.LODG_SCC_CD = @[loc_to]
#end
#if (${por_dol} != '')
 AND BAT.POR_DOL_FLG = @[por_dol]
#end
#if (${cntr_tpsz_cd_seq} != '')
AND BAT.CNTR_TPSZ_CD IN (
   	#foreach($key IN ${cntr_tpsz_cd_seq})
   		#if($velocityCount < $cntr_tpsz_cd_seq.size())
   			'$key',
   		#else
   			'$key'
   		#end
   	#end
        )
#end
)
WHERE 1=1
#if (${del_dol} != '')
  AND DEL_DOL = @[del_dol]
#end
#if (${if_flg} != '')
  AND MST_IF = @[if_flg]
#end			]]></sql>
			<params>
				<param name="froms" type="12" value="" out="N"/>
				<param name="tos" type="12" value="" out="N"/>
				<param name="mvmt" type="12" value="" out="N"/>
				<param name="trd" type="12" value="" out="N"/>
				<param name="loc_to" type="12" value="" out="N"/>
				<param name="por_dol" type="12" value="" out="N"/>
				<param name="del_dol" type="12" value="" out="N"/>
				<param name="if_flg" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
