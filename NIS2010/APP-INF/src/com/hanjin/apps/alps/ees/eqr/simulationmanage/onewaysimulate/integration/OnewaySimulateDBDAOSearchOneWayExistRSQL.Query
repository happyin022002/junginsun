<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OnewaySimulateDBDAOSearchOneWayExistRSQL">
			<desc><![CDATA[EQR_ONE_WY_OFFR에서 One Way Offer Exist 정보 검색]]></desc>
			<sql><![CDATA[
SELECT
	#foreach( ${key} in ${arrtpszcd})
		NVL(SUM(${key}),0)  OFFER${key}
		#if($velocityCount < $arrtpszcd.size())
	   		,
       	#end 
	#end                                                                                                         
FROM			                                                                                                                   
	( 
		SELECT  
			FCAST_YRWK
			, FM_ECC_CD
			, TO_ECC_CD                                                                                                          
			#foreach( ${key} in ${arrtpszcd})
	   	  		, MAX(DECODE(CNTR_TPSZ_CD , '$key', CNTR_QTY)) ${key}
			#end                                                                                 
  		FROM 
			(                                                                                                              
				SELECT 
					FCAST_YRWK
					, FM_ECC_CD
					, TO_ECC_CD
					, CNTR_TPSZ_CD
					, CNTR_QTY
					, ROW_NUMBER() OVER (PARTITION BY FCAST_YRWK, FM_ECC_CD , TO_ECC_CD , CNTR_TPSZ_CD  ORDER BY ROWNUM) RUMM           
	           	FROM 
					EQR_ONE_WY_OFFR                                                                                          
	    	      	, (
						SELECT 
							ECC_CD 
						FROM 
							EQR_ECC_MST 
						WHERE 
							1 = 1
                         	#if (${fmecccd} != '') 
            					#if (${fmtype} == 'R')
                 					AND RCC_CD IN (${arrfmecccd}) 
								#end
            					#if (${fmtype} == 'L')
                 					AND LCC_CD IN (${arrfmecccd})
								#end
            					#if (${fmtype} == 'E')
                 					AND ECC_CD IN (${arrfmecccd})
								#end
		 				 	#end
					) c
                   	, (
						SELECT 
							ECC_CD 
						FROM 
							EQR_ECC_MST 
						WHERE 
							1 = 1 
                          	#if (${toecccd} != '') 
            					#if (${totype} == 'R')
                					AND RCC_CD IN (${arrtoecccd}) 
								#end
            					#if (${totype} == 'L')
                 					AND LCC_CD IN (${arrtoecccd})
								#end
            					#if (${totype} == 'E')
                 					AND ECC_CD IN (${arrtoecccd})
								#end
		  					#end
					) d   			                                                                                       
				WHERE 
					REPO_PLN_ID = @[repo_pln_id]                                                                           
	            	AND FCAST_YRWK  BETWEEN @[fm_pln_yrwk]  AND @[to_pln_yrwk]
					AND FM_ECC_CD = C.ECC_CD
                    AND TO_ECC_CD = D.ECC_CD                                                    
			)	                                                                                                                  
	    					                                                                                                                    
 		GROUP BY 
			FCAST_YRWK
			, FM_ECC_CD
			, TO_ECC_CD                                                                                                      
	)			]]></sql>
			<params>
				<param name="repo_pln_id" type="12" value="" out="N"/>
				<param name="fm_pln_yrwk" type="12" value="" out="N"/>
				<param name="to_pln_yrwk" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
