<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RepairMgtDBDAOSearchAcepChkHeaderInfoRSQL">
			<desc><![CDATA[ACEP Check List Header Info 조회]]></desc>
			<sql><![CDATA[
SELECT   AM.ACEP_SEQ
       , NVL(AM.MNR_WO_TP_CD,'EST') AS MNR_WO_TP_CD
       , NVL(AM.EQ_NO,EM.RQST_EQ_NO) AS EQ_NO
       , NVL(AM.RPR_RQST_SEQ,EM.RPR_RQST_SEQ) AS RPR_RQST_SEQ
       , AM.MNR_ORD_OFC_CTY_CD
       , AM.MNR_ORD_SEQ
       , AM.ORD_DTL_SEQ
       , MC.CNTR_TPSZ_CD
       , TO_CHAR(MC.MFT_DT,'YYYY') AS MFT_DT
       , NVL(AM.INSP_YD_CD,EM.RPR_YD_CD) AS INSP_YD_CD
       , CASE WHEN AM.LST_INSP_DT IS NULL THEN
                   (
                     SELECT   /*+ INDEX_DESC(OD XAK6MNR_ORD_DTL) */
                              TO_CHAR(OD.RPR_RSLT_DT,'YYYYMMDD')
                     FROM     MNR_ORD_DTL OD
                     WHERE    1 = 1
                     AND      OD.EQ_NO = EM.RQST_EQ_NO
                     AND      OD.CRE_DT < NVL(EM.RPR_RSLT_DT, EM.CRE_DT)
                     AND      ROWNUM = 1
                   )
              ELSE AM.LST_INSP_DT
         END AS LST_INSP_DT
       , NVL(AM.INSP_DT,TO_CHAR(EM.RQST_DT,'YYYYMMDD')) AS INSP_DT
       , NVL(( SELECT USR_NM FROM COM_USER WHERE USR_ID = NVL(AM.CRE_USR_ID,EM.CRE_USR_ID) AND ROWNUM = 1 ), AM.CRE_USR_ID) AS CRE_USR_NM
FROM     MNR_RPR_RQST_HDR EM
       , MNR_ACEP_CHK_LIST_HDR AM
       , MST_CONTAINER MC
WHERE    1 = 1
AND      EM.RQST_EQ_NO = AM.EQ_NO(+)
AND      EM.RPR_RQST_SEQ = AM.RPR_RQST_SEQ(+)
AND      EM.RQST_EQ_NO = MC.CNTR_NO
AND      EM.RQST_EQ_NO = @[eq_no]
AND      EM.RPR_RQST_SEQ = @[rpr_rqst_seq]
AND      EM.RPR_RQST_LST_VER_FLG = 'Y'
UNION ALL
SELECT   AM.ACEP_SEQ
       , NVL(AM.MNR_WO_TP_CD,OM.MNR_WO_TP_CD) AS MNR_WO_TP_CD
       , NVL(AM.EQ_NO,OD.EQ_NO) AS EQ_NO
       , NULL AS RPR_RQST_SEQ
       , NVL(AM.MNR_ORD_OFC_CTY_CD,OD.MNR_ORD_OFC_CTY_CD) AS MNR_ORD_OFC_CTY_CD
       , NVL(AM.MNR_ORD_SEQ,OD.MNR_ORD_SEQ) AS MNR_ORD_SEQ
       , NVL(AM.ORD_DTL_SEQ,OD.ORD_DTL_SEQ) AS ORD_DTL_SEQ
       , MC.CNTR_TPSZ_CD
       , TO_CHAR(MC.MFT_DT,'YYYY') AS MFT_DT
       , NVL(AM.INSP_YD_CD,OD.YD_CD) AS INSP_YD_CD
       , CASE WHEN AM.LST_INSP_DT IS NULL THEN
                   (
                     SELECT   /*+ INDEX_DESC(BOD XAK6MNR_ORD_DTL) */
                              TO_CHAR(BOD.RPR_RSLT_DT,'YYYYMMDD')
                     FROM     MNR_ORD_DTL BOD
                     WHERE    1 = 1
                     AND      BOD.EQ_NO = OD.EQ_NO
                     AND      BOD.CRE_DT < NVL(OD.RPR_RSLT_DT, OD.CRE_DT)
                     AND      ROWNUM = 1
                   )
              ELSE AM.LST_INSP_DT
         END AS LST_INSP_DT
       , NVL(AM.INSP_DT,TO_CHAR(OD.RPR_RSLT_DT,'YYYYMMDD')) AS INSP_DT
       , ( SELECT USR_NM FROM COM_USER WHERE USR_ID = NVL(AM.CRE_USR_ID,OM.CRE_USR_ID) AND ROWNUM = 1 ) AS CRE_USR_NM
FROM     MNR_ORD_HDR OM
       , MNR_ORD_DTL OD
       , MNR_ACEP_CHK_LIST_HDR AM
       , MST_CONTAINER MC
WHERE    1 = 1
AND      OM.MNR_ORD_OFC_CTY_CD = OD.MNR_ORD_OFC_CTY_CD
AND      OM.MNR_ORD_SEQ = OD.MNR_ORD_SEQ
AND      OD.MNR_ORD_OFC_CTY_CD  = AM.MNR_ORD_OFC_CTY_CD (+)
AND      OD.MNR_ORD_SEQ = AM.MNR_ORD_SEQ(+)
AND      OD.ORD_DTL_SEQ  = AM.ORD_DTL_SEQ (+)
AND      OD.EQ_NO = MC.CNTR_NO
AND      OM.MNR_WO_TP_CD = 'SPL'
AND      OD.MNR_ORD_OFC_CTY_CD = @[mnr_ord_ofc_cty_cd]
AND      OD.MNR_ORD_SEQ = @[mnr_ord_seq]
AND      OD.ORD_DTL_SEQ = @[ord_dtl_seq]			]]></sql>
			<params>
				<param name="eq_no" type="12" value="" out="N"/>
				<param name="rpr_rqst_seq" type="12" value="" out="N"/>
				<param name="mnr_ord_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="mnr_ord_seq" type="12" value="" out="N"/>
				<param name="ord_dtl_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
