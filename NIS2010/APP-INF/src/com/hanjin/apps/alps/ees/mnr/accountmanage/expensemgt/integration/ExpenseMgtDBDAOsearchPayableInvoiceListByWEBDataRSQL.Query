<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ExpenseMgtDBDAOsearchPayableInvoiceListByWEBDataRSQL">
			<desc><![CDATA[ExpenseMgtDBDAOsearchPayableInvoiceListByWEBDataRSQL
-- 2014.11 10만불 결제관련]]></desc>
			<sql><![CDATA[
SELECT   A.PAY_INV_SEQ
       , A.INV_NO WO_NO
       , A.MNR_INP_TP_CD AS WO_TYPE_CODE
       , D.MNR_CD_DESC AS WO_TYPE
       , MNR_COMMON_PKG.MNR_CONV_PARTNER_CD_FNC(A.ORD_VNDR_SEQ) AS VNDR_SEQ
       , B.VNDR_LGL_ENG_NM
       , MNR_COMMON_PKG.MNR_CONV_PARTNER_CD_FNC(A.MNR_PRNR_SEQ) AS MNR_PRNR_SEQ
       , ( SELECT VNDR_LGL_ENG_NM FROM MDM_VENDOR WHERE VNDR_SEQ = A.MNR_PRNR_SEQ ) AS PAY_VNDR_LGL_ENG_NM
       , A.ISS_OFC_CD
       , TO_CHAR(A.RCV_DT , 'yyyy-mm-dd') AS RCV_DT
       , TO_CHAR(A.EFF_DT , 'yyyy-mm-dd') AS EFF_DT
       , TO_CHAR(A.ISS_DT , 'yyyy-mm-dd') AS ISS_DT
       , TO_CHAR(A.CFM_DT , 'yyyy-mm-dd') AS CFM_DT
       , TO_CHAR(GLOBALDATE_PKG.TIME_CONV_OFC_FNC(MNR_COMMON_PKG.MNR_GET_HOOFC_FNC(), A.CRE_DT, @[user_ofc_cd]), 'yyyy-mm-dd') AS CRE_DT
       , A.BZC_AMT AS MNR_WRK_AMT
       , A.SLS_TAX_AMT
       , A.VAT_AMT
       , A.WHLD_TAX_AMT
       , A.TTL_AMT
       , A.MNR_INV_RMK
       , A.MNR_INV_STS_CD
       , (
           SELECT   MGC.MNR_CD_DESC
           FROM     MNR_GEN_CD MGC 
           WHERE    1 = 1
           AND      DECODE(A.MNR_INV_STS_CD, 'HC', ( SELECT API.INV_STS_CD FROM  AP_PAY_INV API WHERE A.INV_RGST_NO = API.INV_RGST_NO AND API.INV_SUB_SYS_CD='MNR' AND ROWNUM = 1 ), A.MNR_INV_STS_CD) = MGC.MNR_CD_ID
           AND      MGC.PRNT_CD_ID IN ('CD00027', 'CD00042')
           AND      ROWNUM = 1
         ) AS MNR_INV_STS_NM
       , A.GEN_PAY_TERM_CD AS PAY_TERM_DYS
       , A.CURR_CD
       , E.DP_PRCS_KNT
       , A.FILE_SEQ
       , NVL(A.ENV_CHG_TAX, 0) AS ENV_CHG_TAX -- 인도지역의 SBC Tax
       , L.CNT_CD
FROM     MNR_PAY_INV_WRK A
       , MDM_VENDOR B
       , MNR_GEN_CD D
       , MDM_CURRENCY E
       , MDM_ORGANIZATION O
       , MDM_LOCATION L
WHERE    1 = 1
AND      A.ORD_VNDR_SEQ = B.VNDR_SEQ(+)
AND      A.MNR_INV_STS_CD = 'SR'
AND      D.PRNT_CD_ID(+)='CD00019'
AND      A.MNR_INP_TP_CD = D.MNR_CD_ID(+)
AND      A.CURR_CD = E.CURR_CD
AND      A.ISS_OFC_CD = O.OFC_CD
AND      O.LOC_CD = L.LOC_CD
AND      A.ISS_OFC_CD IN
         (
           SELECT   D.OFC_CD
           FROM     MNR_OFC_GEN_INFO D
           WHERE    1 = 1
           AND      D.UPPR_OFC_CD = @[user_ofc_cd]
           AND      D.MNR_GRP_TP_CD = 'OFC'
           AND      D.COST_CD       = 'RPRINV'
#if (${wo_ofc_cd} != 'ALL') 
           AND      D.OFC_CD = @[wo_ofc_cd]
#end
           UNION ALL
           SELECT   @[user_ofc_cd]
           FROM     DUAL
         )
#if (${woNos} != '')
AND	     A.INV_NO IN (
    #foreach ($user_woNos IN ${woNos})
        #if($velocityCount < $woNos.size())
				'$user_woNos',
        #else
				'$user_woNos'
        #end
    #end
	)
#else
AND      A.UPD_DT BETWEEN GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[user_ofc_cd], TO_DATE(@[from_dt], 'YYYY-MM-DD'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC()) AND GLOBALDATE_PKG.TIME_CONV_OFC_FNC(@[user_ofc_cd], TO_DATE(@[to_dt], 'YYYY-MM-DD'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC())+ 0.99999
#end
#if (${vndr_seq} != '') 
AND      A.ORD_VNDR_SEQ = TO_NUMBER(@[vndr_seq])
#end			]]></sql>
			<params>
				<param name="user_ofc_cd" type="12" value="" out="N"/>
				<param name="wo_ofc_cd" type="12" value="" out="N"/>
				<param name="from_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
