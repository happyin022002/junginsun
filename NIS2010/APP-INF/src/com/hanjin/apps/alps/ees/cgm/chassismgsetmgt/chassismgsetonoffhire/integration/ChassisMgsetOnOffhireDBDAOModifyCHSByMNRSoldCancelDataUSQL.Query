<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChassisMgsetOnOffhireDBDAOModifyCHSByMNRSoldCancelDataUSQL">
			<desc><![CDATA[* --------------------------------------------------------
* History
* 2012.01.13 김상수 [CHM-201215565-01] ALPS MNR-Disposal-SLD Management-> SLD Cancellation 보완 요청
*                                      - Disposal Sold Cancelation 화면에서 M.G.Set과 Chassis도 SLD Cancel 가능하도록 CGM연계로직 추가 
* --------------------------------------------------------]]></desc>
			<sql><![CDATA[
UPDATE CGM_EQUIPMENT
   SET (ACIAC_DIV_CD,
        EQ_STS_SEQ,
        CRNT_YD_CD,
        CRNT_LOC_CD,
        CHSS_MVMT_STS_CD,
        CHSS_MVMT_DT, 
        UPD_USR_ID,
        UPD_DT)
     = (SELECT A.ACIAC_DIV_CD,
               A.EQ_STS_SEQ,
               B.YD_CD,
               B.LOC_CD,
               B.MVMT_STS_CD,
               B.MVMT_DT,
               @[flag_user_id],
               SYSDATE
          FROM (SELECT /*+ INDEX_DESC (CGM_EQ_STS_HIS XPKCGM_EQ_STS_HIS) */
                       DECODE(EQ_ASET_STS_CD, 'LSO', 'I', 'SLD', 'I','LST', 'I','DIO', 'I','SBO', 'I','SCR', 'I','TLL', 'I', 'A') AS ACIAC_DIV_CD,
                       EQ_STS_SEQ
                  FROM CGM_EQ_STS_HIS
                 WHERE EQ_NO = @[eq_no]
                   AND ROWNUM = 1) A,
               (SELECT /*+ INDEX_DESC (CGM_CHSS_MVMT_HIS XPKCGM_CHSS_MVMT_HIS) */
                       YD_CD,
                       LOC_CD,
                       MVMT_STS_CD,
                       MVMT_DT
                  FROM CGM_CHSS_MVMT_HIS
                 WHERE CHSS_NO = @[eq_no]
                    AND ROWNUM = 1) B)
 WHERE EQ_NO = @[eq_no]			]]></sql>
			<params>
				<param name="flag_user_id" type="12" value="" out="N"/>
				<param name="eq_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
