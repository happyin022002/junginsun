<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContainerMovementMgtDBDAOsearchEventDateUpdateHistoryRSQL">
			<desc><![CDATA[searchEventDateUpdateHistory]]></desc>
			<sql><![CDATA[
SELECT   CMH.CNTR_NO
        ,CMH.CNMV_YR
        ,CMH.CNMV_ID_NO
        ,CMH.CNMV_UPD_HIS_SEQ
        ,CMH.CNTR_TPSZ_CD AS TP_SZ
        ,CMH.BKG_NO AS BKG_NO
        ,CMH.CRNT_VSL_CD||CMH.CRNT_SKD_VOY_NO||CMH.CRNT_SKD_DIR_CD AS VVD
        ,CMH.MVMT_STS_CD AS STS
        ,CMH.ORG_YD_CD
        ,TO_CHAR(CMH.PRE_CNMV_EVNT_DT, 'YYYY-MM-DD HH24:MI') AS PRE_CNMV_EVNT_DT
        ,TO_CHAR(CMH.CRNT_CNMV_EVNT_DT, 'YYYY-MM-DD HH24:MI') AS CRNT_CNMV_EVNT_DT
--        ,ROUND(CMH.CRNT_CNMV_EVNT_DT-CMH.PRE_CNMV_EVNT_DT, 0) AS GAP
		,ROUND( TO_DATE(TO_CHAR(CMH.CRNT_CNMV_EVNT_DT, 'YYYYMMDD'), 'YYYYMMDD') - TO_DATE(TO_CHAR(CMH.PRE_CNMV_EVNT_DT , 'YYYYMMDD'), 'YYYYMMDD'), 0) AS GAP
        ,TO_CHAR(CMH.CRE_LOCL_DT, 'YYYY-MM-DD HH24:MI') AS CRE_LOCL_DT
        ,TO_CHAR(CMH.UPD_LOCL_DT, 'YYYY-MM-DD HH24:MI') AS UPD_LOCL_DT
        ,CMH.MVMT_EDI_MSG_TP_ID
        ,DECODE(CMH.FCNTR_FLG, 'Y', 'F', 'N', 'M') FCNTR_FLG
        ,CMH.OFC_CD
        ,CU.USR_NM
        ,CMH.CNMV_RMK
FROM    CTM_MVMT_EVNT_DT_HIS    CMH
        ,COM_USER               CU
#if (${pe_co} == 'P')
        ,MST_CONTAINER          MC
        ,MDM_EQ_ORZ_CHT         ME
        ,MDM_LOCATION           ML
#end
#if (${pe_co} == 'C')
WHERE   CMH.CNTR_NO         =   @[p_cntrno]||@[check_digit]
#end
#if (${pe_co} == 'P')
WHERE   CMH.CRE_LOCL_DT BETWEEN TO_DATE(@[p_date1], 'YYYY-MM-DD') AND TO_DATE(@[p_date2], 'YYYY-MM-DD') + 0.999999
#end
#if (${location_gb} == 'L' && ${pe_co} == 'P')
AND     ME.LCC_CD           =   @[yd_cd_disp]
#end
#if (${location_gb} == 'E' && ${pe_co} == 'P')
AND     ME.ECC_CD           =   @[yd_cd_disp]
#end
#if (${location_gb} == 'S' && ${pe_co} == 'P')
AND     ME.SCC_CD           =   @[yd_cd_disp]
#end
#if (${location_gb} == 'R' && ${pe_co} == 'P')
AND     ME.RCC_CD           =   @[yd_cd_disp]
#end
#if (${pe_co} == 'P')
AND     ML.SCC_CD           =   ME.SCC_CD
AND     SUBSTR(CMH.ORG_YD_CD, 1, 5) = ML.LOC_CD
#end
#if (${location_gb} == 'Y' && ${pe_co} == 'P')
AND     CMH.ORG_YD_CD       =   @[yd_cd_disp]||@[p_yard2]
#end
#if (${status_cd} != '' && ${pe_co} == 'P') 
	AND CMH.MVMT_STS_CD IN (
		#foreach ($user_statusCds IN ${statusCds})
			#if($velocityCount < $statusCds.size())
				'$user_statusCds',
			#else
				'$user_statusCds'
			#end
		#end
	)
#end
#if (${pe_co} == 'P')
AND     CMH.CNTR_NO         =   MC.CNTR_NO
#end
#if (${soc_cd} == 'SH' && ${pe_co} == 'P')
AND     MC.LSTM_CD          <>  @[soc_cd]
#end
AND     CMH.CRE_USR_ID      =   CU.USR_ID
ORDER   BY CMH.CNTR_NO
        ,CMH.CNMV_YR
        ,CMH.CNMV_ID_NO
        ,CMH.CNMV_UPD_HIS_SEQ			]]></sql>
			<params>
				<param name="p_cntrno" type="12" value="" out="N"/>
				<param name="check_digit" type="12" value="" out="N"/>
				<param name="p_date1" type="12" value="" out="N"/>
				<param name="p_date2" type="12" value="" out="N"/>
				<param name="yd_cd_disp" type="12" value="" out="N"/>
				<param name="p_yard2" type="12" value="" out="N"/>
				<param name="soc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
