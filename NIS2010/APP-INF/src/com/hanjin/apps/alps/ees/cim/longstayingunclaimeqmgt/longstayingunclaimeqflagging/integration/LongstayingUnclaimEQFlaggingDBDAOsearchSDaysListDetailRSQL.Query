<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="LongstayingUnclaimEQFlaggingDBDAOsearchSDaysListDetailRSQL">
			<desc><![CDATA[Full/ MTY 장기체화 장비의 BKG 및 Movement 정보등을 컨테이너 번호별로 일괄적으로 조회한다.
2012.01.25 신자영 [CHM-201215785-01] CNTR STAYING DAYS 추가 개발]]></desc>
			<sql><![CDATA[
SELECT
         A.SUB_LOC_CD
        ,A.CRNT_YD_CD
        ,A.CNTR_NO
        ,A.CNTR_TPSZ_CD
        ,A.LSTM_CD
        ,A.CNMV_STS_CD
    	,A.FULL_FLG
        ,A.CNMV_DT
		,LTRIM(TO_CHAR(A.STAY_DAYS,'9,999')) STAY_DAYS
/*
		,DECODE(SUBSTR(A.FT_END_DYS,1,4),NULL,0,TO_NUMBER(SUBSTR(A.FT_END_DYS,1,4))) FT_DYS
		,SUBSTR(A.FT_END_DYS,5) FT_END_DT
		,TO_CHAR(A.STAY_DAYS-DECODE(SUBSTR(A.FT_END_DYS,1,4),NULL,0,TO_NUMBER(SUBSTR(A.FT_END_DYS,1,4))),'9,999') ACT_DYS	
*/
		,NVL(TO_NUMBER(SUBSTR(A.FT_END_DYS,11,4)),0) FT_DYS
	    ,SUBSTR(A.FT_END_DYS,1,10) FT_END_DT
	    ,CASE WHEN A.STAY_DAYS-NVL(TO_NUMBER(SUBSTR(A.FT_END_DYS,11,4)),0) >99999 THEN
			99999
		 ELSE
	 	    A.STAY_DAYS-NVL(TO_NUMBER(SUBSTR(A.FT_END_DYS,11,4)),0)
		 END  ACT_DYS 

        ,A.BKG_NO
        ,A.BL_NO
        ,SHPR                               
        ,CNEE                               
        ,NTFY     
    	,REP_CMDT_NM
        ,MK_DESC
    	,A.OB_SLS_OFC_CD
    	,A.OB_SREP_CD
		,DECODE(A.DMG_FLG,'Y',A.DMG_FLG,'') DMG_FLG
		,(SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL WHERE INTG_CD_ID='CD02012' AND INTG_CD_VAL_CTNT=A.CNTR_HNGR_RCK_CD) CNTR_HNGR_RCK_CD
    	,A.MNR_HNGR_BAR_TP_CD
    	,A.CNTR_HNGR_BAR_ATCH_KNT
		,DECODE(A.DISP_FLG,'Y',A.DISP_FLG,'') DISP_FLG
		,DECODE(A.IMDT_EXT_FLG,'Y',A.IMDT_EXT_FLG,'') IMDT_EXT_FLG
		,DECODE(A.UCLM_LS_FLG,'Y',A.UCLM_LS_FLG,'') UCLM_LS_FLG
		,DECODE(A.PLST_FLR_FLG,'Y',A.PLST_FLR_FLG,'') PLST_FLR_FLG
FROM
(
    SELECT
        DECODE(@[loc_type_code],'1',LCC_CD,'2',SCC_CD,'3',SCC_CD,'4',SCC_CD,'5',SCC_CD,'7',ECC_CD) SUB_LOC_CD
        ,A.CRNT_YD_CD
        ,A.CNTR_NO
        ,A.CNTR_TPSZ_CD
        ,A.LSTM_CD
        ,A.CNMV_STS_CD
    	,DECODE(A.FULL_FLG,'Y','F','M') FULL_FLG
        ,TO_CHAR(A.CNMV_DT,'YYYY-MM-DD') CNMV_DT
		,CEIL(TO_DATE(@[rcc_date],'yyyy-MM-dd HH24:mi:SS')- A.CNMV_DT ) STAY_DAYS
/*
        ,(
            SELECT  LTRIM(TO_CHAR(FT_DYS,'0000')) || TO_CHAR(FT_END_DT,'YYYY-MM-DD')
            FROM DMT_CHG_CALC E,DMT_CHG_BKG_CNTR F
            WHERE E.CNTR_NO = A.CNTR_NO
            AND E.SYS_AREA_GRP_ID  =  A.SYS_AREA_GRP_ID
            AND E.CNTR_CYC_NO = A. CNMV_CYC_NO
            AND E.CHG_SEQ = 1
            AND (DECODE(A.CNMV_STS_CD, 'IC','VD', A.CNMV_STS_CD) = E.FM_MVMT_STS_CD
                        OR  DECODE(A.CNMV_STS_CD,'IC','IC','') = E.FM_MVMT_STS_CD)
            AND E.DMDT_CHG_STS_CD <> 'E'
            AND F.CNTR_NO = E.CNTR_NO
            AND F.SYS_AREA_GRP_ID  =  E.SYS_AREA_GRP_ID
            AND F.CNTR_CYC_NO = E.CNTR_CYC_NO
            AND F.BKG_NO = A.BKG_NO    
       	 	AND ROWNUM =1
        ) FT_END_DYS
*/
		,(SELECT  MAX(NVL(TO_CHAR(FT_END_DT,'YYYY-MM-DD'),'1111-11-11')||LTRIM(TO_CHAR(FT_DYS,'0000')))
        FROM DMT_CHG_CALC E,DMT_CHG_BKG_CNTR F
        WHERE E.CNTR_NO = A.CNTR_NO
        AND E.SYS_AREA_GRP_ID  =  A.SYS_AREA_GRP_ID
        AND E.CNTR_CYC_NO = A. CNMV_CYC_NO
        AND E.CHG_SEQ = 1
        AND E.FM_MVMT_YD_CD = A.CRNT_YD_CD
        AND E.DMDT_CHG_STS_CD <> 'E'
        AND F.CNTR_NO = E.CNTR_NO
        AND F.SYS_AREA_GRP_ID  = E.SYS_AREA_GRP_ID
        AND F.CNTR_CYC_NO = E.CNTR_CYC_NO
        AND F.BKG_NO = A.BKG_NO
		AND A.CNMV_STS_CD NOT IN ('TS','MT')
		) FT_END_DYS 
        ,A.BKG_NO
        ,B.BL_NO
        ,(SELECT REPLACE(SUBSTR(W.CUST_NM,1,50),CHR(13)||chr(10),' ')
        FROM BKG_CUSTOMER W                                          
        WHERE A.BKG_NO = W.BKG_NO                                    
        AND W.BKG_CUST_TP_CD='S') SHPR                               
                                                                     
        ,(SELECT REPLACE(SUBSTR(W.CUST_NM,1,50),CHR(13)||chr(10),' ')
        FROM BKG_CUSTOMER W                                          
        WHERE A.BKG_NO = W.BKG_NO                                    
        AND W.BKG_CUST_TP_CD='C') CNEE                               
                                                                     
        ,(SELECT REPLACE(SUBSTR(W.CUST_NM,1,50),CHR(13)||chr(10),' ')
        FROM BKG_CUSTOMER W                                          
        WHERE A.BKG_NO = W.BKG_NO                                    
        AND W.BKG_CUST_TP_CD='N') NTFY     
    	,(SELECT D.REP_CMDT_NM FROM MDM_REP_CMDT D
    	   WHERE   B.REP_CMDT_CD = D.REP_CMDT_CD
    	) REP_CMDT_NM
        ,(SELECT REPLACE(X.MK_DESC,CHR(13)||chr(10),' ')
        FROM BKG_BL_MK_DESC X
        WHERE A.BKG_NO = X.BKG_NO) MK_DESC
    	,B.OB_SLS_OFC_CD
    	,B.OB_SREP_CD
    	,A.DMG_FLG
		,A.CNTR_HNGR_RCK_CD 
		,A.MNR_HNGR_BAR_TP_CD
    	,A.CNTR_HNGR_BAR_ATCH_KNT
    	,A.DISP_FLG
    	,A.IMDT_EXT_FLG
    	,DECODE(A.UCLM_LS_DIV_CD,'U','Y','N') UCLM_LS_FLG
    	,A.PLST_FLR_FLG
    FROM MST_CONTAINER A,BKG_BOOKING B
    WHERE A.ACIAC_DIV_CD='A'
    AND   A.CNMV_STS_CD NOT IN ('XX','VL')
    AND   A.BKG_NO =B.BKG_NO(+)
#if (${ofc_cd} != '')
    AND B.OB_SLS_OFC_CD =@[ofc_cd]    
#end  
#if (${cntr_yd_cd} != '')
    AND SUBSTR(A.CRNT_YD_CD,1,2) = @[cntr_yd_cd]    
#end  
#if (${cntrprefix} != '')
    AND SUBSTR(A.CNTR_NO,0,4) = @[cntrprefix]    
#end
#if (${cntr_hngr_rck_cd} == 'Y')
    AND (A.CNTR_HNGR_RCK_CD IS NOT NULL OR  A.CNTR_HNGR_BAR_ATCH_KNT > 0)   
#end
#if (${disp_flg} == 'Y')
   AND A.DISP_FLG = 'Y'
#end
#if (${d2_payld_flg} == 'Y')
   AND AND A.D2_PAYLD_FLG = 'Y'
#end   
    AND   A.CNTR_USE_CO_CD = @[cntr_use_co_cd]
    
    #if (${loc_type_code} == '1')
    	AND A.RCC_CD =@[loc_cd]
    #elseif (${loc_type_code} == '2')
    	AND A.LCC_CD =@[loc_cd]
    #elseif (${loc_type_code} == '3')
    	AND A.LCC_CD =@[loc_cd]
    #elseif (${loc_type_code} == '4')
        AND A.ECC_CD =@[loc_cd]
    #elseif (${loc_type_code} == '5')
        AND A.SCC_CD =@[loc_cd]
    #elseif (${loc_type_code} == '6')
        AND A.CRNT_YD_CD =@[loc_cd]
    #elseif (${loc_type_code} == '7')
        AND A.RCC_CD =@[loc_cd]
    #end     
    #if (${cntr_tpsz_cd} != '')
    	AND A.CNTR_TPSZ_CD IN ( 
    		  				 SELECT COLUMN_VALUE
        	                 FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[cntr_tpsz_cd] ) AS listItemType ) 
            	             FROM dual )
    				        )
    #end
    #if (${dmg_flg} != '')
    	AND A.DMG_FLG = @[dmg_flg]
    #end  
    
    #if (${cnmv_sts_cd} != '')
    	AND A.CNMV_STS_CD IN ( 
    		  				 SELECT COLUMN_VALUE
        	                 FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[cnmv_sts_cd] ) AS listItemType ) 
            	             FROM dual )
    				        )
    #end
    #if (${uclm_ls_div_cd} == 'E')
    	AND NVL(A.UCLM_LS_DIV_CD,'X') <> 'U'
    #elseif(${uclm_ls_div_cd} == 'O')
    	AND A.UCLM_LS_DIV_CD = 'U'
    #end
    
    #if (${full_flg} != '')
    	AND A.FULL_FLG = @[full_flg]
    #end        
    #if (${lstm_cd} != '')
    	AND A.LSTM_CD IN ( 
    		  				 SELECT COLUMN_VALUE
        	                 FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[lstm_cd] ) AS listItemType ) 
            	             FROM dual )
    				        )
    #end 
    #if (${soc_cd} != '')
    	#if (${soc_cd} == '1')
    		AND A.LSTM_CD <> 'SH'
    	#else
    		AND A.LSTM_CD = 'SH'
    	#end
    #end
    #if (${code_flg} != '')
      #if (${sub_loc_cd} != '')
    	  AND DECODE(@[code_flg],NULL,RCC_CD,'R',RCC_CD,'L',LCC_CD,'E',ECC_CD,'S',SCC_CD,'Y',CRNT_YD_CD) =@[sub_loc_cd]
      #end
    #else
      #if (${sub_loc_cd} != '')
    	  AND DECODE(@[loc_type_code],NULL,RCC_CD,'1',LCC_CD,'2',ECC_CD,'3',SCC_CD,'4',SCC_CD,'5',CRNT_YD_CD,'6',CRNT_YD_CD,'7',ECC_CD) =@[sub_loc_cd]
      #end
    #end

    #if (${sub_cntr_tpsz_cd} != '')
    	AND A.CNTR_TPSZ_CD IN ( 
    		  				 SELECT COLUMN_VALUE
        	                 FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[sub_cntr_tpsz_cd] ) AS listItemType ) 
            	             FROM dual )
    				        )
    #end
    #if (${sub_cnmv_sts_cd} != '')
    	AND A.CNMV_STS_CD IN ( 
    		  				 SELECT COLUMN_VALUE
        	                 FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[sub_cnmv_sts_cd] ) AS listItemType ) 
            	             FROM dual )
    				        )
    #end
        
) A
WHERE A.STAY_DAYS >= NVL(@[over_stay_days],0)
ORDER BY A.SUB_LOC_CD,A.CRNT_YD_CD,A.CNTR_NO,A.CNTR_TPSZ_CD,A.LSTM_CD,A.CNMV_STS_CD			]]></sql>
			<params>
				<param name="loc_type_code" type="12" value="" out="N"/>
				<param name="rcc_date" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="cntr_yd_cd" type="12" value="" out="N"/>
				<param name="cntrprefix" type="12" value="" out="N"/>
				<param name="cntr_use_co_cd" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="dmg_flg" type="12" value="" out="N"/>
				<param name="cnmv_sts_cd" type="12" value="" out="N"/>
				<param name="full_flg" type="12" value="" out="N"/>
				<param name="lstm_cd" type="12" value="" out="N"/>
				<param name="code_flg" type="12" value="" out="N"/>
				<param name="sub_loc_cd" type="12" value="" out="N"/>
				<param name="sub_cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="sub_cnmv_sts_cd" type="12" value="" out="N"/>
				<param name="over_stay_days" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
