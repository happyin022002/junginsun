<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CNTRInventoryReportDBDAOsearchLandInvtOptmStkListRSQL">
			<desc><![CDATA[2016-01-21
Equipment Management > CNTR Inventory > Inventory Status > Land Inventory > Land Inventory with Optimum Stock 조회]]></desc>
			<sql><![CDATA[
WITH TMP_EQ_ORZ_CHT AS
(SELECT 
   RCC_CD, LCC_CD, ECC_CD 
   FROM MDM_EQ_ORZ_CHT
#if (${loc_type_code} == '3' || ${loc_type_code} == '8')
   WHERE RCC_CD = @[loc_cd]
#elseif (${loc_type_code} == '4')
   WHERE LCC_CD = @[loc_cd]
#end
  GROUP BY  RCC_CD, LCC_CD, ECC_CD
)
, CRT_MT AS
(SELECT 
#if (${loc_type_code} == '3')
       LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
       ECC_CD
#else
	   RCC_CD
#end
       ,1 SEL_NO
       ,'Inventory (MT)' SEL_NM
#if (${tp_cd} == '1')
       ,TO_NUMBER((NVL(QTY1, 0) +NVL(QTY2, 0) +NVL(QTY3, 0) +NVL(QTY4, 0) +NVL(QTY5, 0) +NVL(QTY6, 0) +NVL(QTY7, 0) +NVL(O2, 0) +NVL(S2, 0) +NVL(O4, 0) +NVL(O5, 0) +NVL(S4, 0) +NVL(F2, 0) +NVL(F4, 0) +NVL(F5, 0) +NVL(A4, 0))) TOTAL_CNT
#elseif (${tp_cd} == '2')
       ,TO_NUMBER((NVL(QTY1, 0) +NVL(QTY2, 0) +NVL(QTY3, 0) +NVL(QTY4, 0))) TOTAL_CNT
#elseif (${tp_cd} == '3')
       ,TO_NUMBER((NVL(QTY5, 0) +NVL(QTY6, 0) +NVL(QTY7, 0))) TOTAL_CNT
#elseif (${tp_cd} == '4')
       ,TO_NUMBER((NVL(O2, 0) +NVL(S2, 0) +NVL(O4, 0) +NVL(O5, 0) +NVL(S4, 0) +NVL(F2, 0) +NVL(F4, 0) +NVL(F5, 0) +NVL(A4, 0))) TOTAL_CNT
#end       
       ,TO_NUMBER(QTY1) QTY1
       ,TO_NUMBER(QTY2) QTY2
       ,TO_NUMBER(QTY3) QTY3
       ,TO_NUMBER(QTY4) QTY4
       ,TO_NUMBER(QTY5) QTY5
       ,TO_NUMBER(QTY6) QTY6
       ,TO_NUMBER(QTY7) QTY7
       ,TO_NUMBER(O2 + S2) QTY8
       ,TO_NUMBER(O4 + O5 + S4) QTY9
       ,TO_NUMBER(F2) QTY10
       ,TO_NUMBER(F4 + F5 + A4) QTY11
  FROM  (SELECT  
#if (${loc_type_code} == '3')
                 LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
                 ECC_CD
#else
	             RCC_CD 
#end
                ,DECODE(INSTR(null, 'D2' ), 0, NULL, SUM(DECODE(CNTR_TPSZ_CD, 'D2' , VOL, 0))) QTY1 
                ,DECODE(INSTR(null, 'D4' ), 0, NULL, SUM(DECODE(CNTR_TPSZ_CD, 'D4' , VOL, 0))) QTY2 
                ,DECODE(INSTR(null, 'D5' ), 0, NULL, SUM(DECODE(CNTR_TPSZ_CD, 'D5' , VOL, 0))) QTY3 
                ,DECODE(INSTR(null, 'D7' ), 0, NULL, SUM(DECODE(CNTR_TPSZ_CD, 'D7' , VOL, 0))) QTY4 
                ,DECODE(INSTR(null, 'R2' ), 0, NULL, SUM(DECODE(CNTR_TPSZ_CD, 'R2' , VOL, 0))) QTY5 
                ,DECODE(INSTR(null, 'R5' ), 0, NULL, SUM(DECODE(CNTR_TPSZ_CD, 'R5' , VOL, 0))) QTY6 
                ,DECODE(INSTR(null, 'R9' ), 0, NULL, SUM(DECODE(CNTR_TPSZ_CD, 'R9' , VOL, 0))) QTY7 
                ,DECODE(INSTR(null, 'O2' ), 0, NULL, SUM(DECODE(CNTR_TPSZ_CD, 'O2' , VOL, 0))) O2 
                ,DECODE(INSTR(null, 'S2' ), 0, NULL, SUM(DECODE(CNTR_TPSZ_CD, 'S2' , VOL, 0))) S2 
                ,DECODE(INSTR(null, 'O4' ), 0, NULL, SUM(DECODE(CNTR_TPSZ_CD, 'O4' , VOL, 0))) O4 
                ,DECODE(INSTR(null, 'O5' ), 0, NULL, SUM(DECODE(CNTR_TPSZ_CD, 'O5' , VOL, 0))) O5 
                ,DECODE(INSTR(null, 'S4' ), 0, NULL, SUM(DECODE(CNTR_TPSZ_CD, 'S4' , VOL, 0))) S4 
                ,DECODE(INSTR(null, 'F2' ), 0, NULL, SUM(DECODE(CNTR_TPSZ_CD, 'F2' , VOL, 0))) F2 
                ,DECODE(INSTR(null, 'F4' ), 0, NULL, SUM(DECODE(CNTR_TPSZ_CD, 'F4' , VOL, 0))) F4 
                ,DECODE(INSTR(null, 'F5' ), 0, NULL, SUM(DECODE(CNTR_TPSZ_CD, 'F5' , VOL, 0))) F5 
                ,DECODE(INSTR(null, 'A4' ), 0, NULL, SUM(DECODE(CNTR_TPSZ_CD, 'A4' , VOL, 0))) A4 
          FROM (SELECT  
#if (${loc_type_code} == '3')
                        LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
                        ECC_CD
#else
	                    RCC_CD 
#end
                       ,CNMV_STS_CD
                       ,CNTR_TPSZ_CD
                       ,COUNT(1) VOL
                  FROM MST_CONTAINER
                 WHERE ACIAC_DIV_CD='A'
                   AND CNMV_STS_CD = 'MT'
                   AND CNTR_USE_CO_CD = 'H'
#if (${dmg_flg} != '')
	    	       AND DMG_FLG = @[dmg_flg]
#end 
#if (${loc_type_code} == '3' || ${loc_type_code} == '8')
                   AND RCC_CD = @[loc_cd]
#elseif (${loc_type_code} == '4')
                   AND LCC_CD = @[loc_cd]
#end
                   AND LSTM_CD <> 'SH'
                 GROUP BY 
#if (${loc_type_code} == '3')
                          LCC_CD,
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
                          ECC_CD,
#else
	                      RCC_CD, 
#end                          
                          CNMV_STS_CD ,
                          CNTR_TPSZ_CD) 
          GROUP BY 
#if (${loc_type_code} == '3')
            LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
            ECC_CD
#else
	        RCC_CD 
#end 
           )
 ORDER BY 
#if (${loc_type_code} == '3')
LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
ECC_CD
#else
RCC_CD 
#end 
)
, OPT_ST_T AS
(
SELECT  B.RCC_CD
        ,B.LCC_CD
        ,A.ECC_CD
        ,A.DMG_FLG
        ,DECODE(A.CNTR_TPSZ_CD,'D2',A.CNTR_QTY) D2
        ,DECODE(A.CNTR_TPSZ_CD,'D4',A.CNTR_QTY) D4
        ,DECODE(A.CNTR_TPSZ_CD,'D5',A.CNTR_QTY) D5
        ,DECODE(A.CNTR_TPSZ_CD,'D7',A.CNTR_QTY) D7
        ,DECODE(A.CNTR_TPSZ_CD,'R2',A.CNTR_QTY) R2
        ,DECODE(A.CNTR_TPSZ_CD,'R5',A.CNTR_QTY) R5
        ,DECODE(A.CNTR_TPSZ_CD,'R9',A.CNTR_QTY) R9
        ,DECODE(A.CNTR_TPSZ_CD,'O2',A.CNTR_QTY) O2
        ,DECODE(A.CNTR_TPSZ_CD,'S2',A.CNTR_QTY) S2
        ,DECODE(A.CNTR_TPSZ_CD,'O4',A.CNTR_QTY) O4
        ,DECODE(A.CNTR_TPSZ_CD,'O5',A.CNTR_QTY) O5
        ,DECODE(A.CNTR_TPSZ_CD,'S4',A.CNTR_QTY) S4
        ,DECODE(A.CNTR_TPSZ_CD,'F2',A.CNTR_QTY) F2
        ,DECODE(A.CNTR_TPSZ_CD,'F4',A.CNTR_QTY) F4
        ,DECODE(A.CNTR_TPSZ_CD,'F5',A.CNTR_QTY) F5
        ,DECODE(A.CNTR_TPSZ_CD,'A4',A.CNTR_QTY) A4
  FROM CIM_OPTM_STK_SMRY A,
       TMP_EQ_ORZ_CHT B
 WHERE OPTM_STK_MNG_TP_CD = 'M'
   AND A.ECC_CD = B.ECC_CD
   AND TGT_YRWK = (SELECT MAX(TGT_YRWK) 
                    FROM CIM_OPTM_STK_SMRY
                   WHERE OPTM_STK_MNG_TP_CD = 'M')
#if (${dmg_flg} == '')
   AND DMG_FLG = 'A'
#end  
#if (${dmg_flg} != '')
   AND DMG_FLG = @[dmg_flg]
#end
)
, OPT_ST_F AS
(
SELECT  B.RCC_CD
        ,B.LCC_CD
        ,A.ECC_CD
        ,A.DMG_FLG
        ,DECODE(A.CNTR_TPSZ_CD,'D2',A.CNTR_QTY) D2
        ,DECODE(A.CNTR_TPSZ_CD,'D4',A.CNTR_QTY) D4
        ,DECODE(A.CNTR_TPSZ_CD,'D5',A.CNTR_QTY) D5
        ,DECODE(A.CNTR_TPSZ_CD,'D7',A.CNTR_QTY) D7
        ,DECODE(A.CNTR_TPSZ_CD,'R2',A.CNTR_QTY) R2
        ,DECODE(A.CNTR_TPSZ_CD,'R5',A.CNTR_QTY) R5
        ,DECODE(A.CNTR_TPSZ_CD,'R9',A.CNTR_QTY) R9
        ,DECODE(A.CNTR_TPSZ_CD,'O2',A.CNTR_QTY) O2
        ,DECODE(A.CNTR_TPSZ_CD,'S2',A.CNTR_QTY) S2
        ,DECODE(A.CNTR_TPSZ_CD,'O4',A.CNTR_QTY) O4
        ,DECODE(A.CNTR_TPSZ_CD,'O5',A.CNTR_QTY) O5
        ,DECODE(A.CNTR_TPSZ_CD,'S4',A.CNTR_QTY) S4
        ,DECODE(A.CNTR_TPSZ_CD,'F2',A.CNTR_QTY) F2
        ,DECODE(A.CNTR_TPSZ_CD,'F4',A.CNTR_QTY) F4
        ,DECODE(A.CNTR_TPSZ_CD,'F5',A.CNTR_QTY) F5
        ,DECODE(A.CNTR_TPSZ_CD,'A4',A.CNTR_QTY) A4
  FROM CIM_OPTM_STK_SMRY A,
       TMP_EQ_ORZ_CHT B
 WHERE OPTM_STK_MNG_TP_CD = 'F'
   AND A.ECC_CD = B.ECC_CD
   AND TGT_YRWK = (SELECT MAX(TGT_YRWK) 
                    FROM CIM_OPTM_STK_SMRY
                   WHERE OPTM_STK_MNG_TP_CD = 'F')
#if (${dmg_flg} == '')
   AND DMG_FLG = 'A'
#end
#if (${dmg_flg} != '')
   AND DMG_FLG = @[dmg_flg]
#end    
)
, OPT_ST AS
(SELECT
#if (${loc_type_code} == '3')
       LCC_CD LOC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
       ECC_CD LOC_CD
#else
	   RCC_CD LOC_CD 
#end  
      ,SEL_NO
      ,SEL_NM DIVISION
      ,TOTAL_CNT
      ,QTY1
      ,QTY2
      ,QTY3
      ,QTY4
      ,QTY5
      ,QTY6
      ,QTY7
      ,QTY8
      ,QTY9
      ,QTY10
      ,QTY11
 FROM (
       SELECT 
           *
       FROM CRT_MT
       UNION ALL
       SELECT
#if (${loc_type_code} == '3')
              LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
              ECC_CD
#else
	          RCC_CD 
#end 
             ,2 SEL_NO
             ,'Optimum Stock (t-Dist)' SEL_NM
#if (${tp_cd} == '1')
             ,TO_NUMBER((NVL(D2, 0) +NVL(D4, 0) +NVL(D5, 0) +NVL(D7, 0) +NVL(R2, 0) +NVL(R5, 0) +NVL(R9, 0) +NVL(O2, 0) +NVL(O4, 0) +NVL(F2, 0) +NVL(F4, 0))) TOTAL_CNT
#elseif (${tp_cd} == '2')
             ,TO_NUMBER((NVL(D2, 0) +NVL(D4, 0) +NVL(D5, 0) +NVL(D7, 0))) TOTAL_CNT
#elseif (${tp_cd} == '3')
             ,TO_NUMBER((NVL(R2, 0) +NVL(R5, 0) +NVL(R9, 0))) TOTAL_CNT
#elseif (${tp_cd} == '4')
             ,TO_NUMBER((NVL(O2, 0) +NVL(O4, 0) +NVL(F2, 0) +NVL(F4, 0))) TOTAL_CNT
#end 
             ,TO_NUMBER(D2) QTY1
             ,TO_NUMBER(D4) QTY2
             ,TO_NUMBER(D5) QTY3
             ,TO_NUMBER(D7) QTY4
             ,TO_NUMBER(R2) QTY5
             ,TO_NUMBER(R5) QTY6
             ,TO_NUMBER(R9) QTY7
             ,TO_NUMBER(O2) QTY8
             ,TO_NUMBER(O4) QTY9
             ,TO_NUMBER(F2) QTY10
             ,TO_NUMBER(F4) QTY11
       FROM  
             (SELECT 
#if (${loc_type_code} == '3')
                     LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
                     ECC_CD
#else
	                 RCC_CD 
#end 
                    ,SUM(NVL(D2, 0)) D2
                    ,SUM(NVL(D4, 0)) D4
                    ,SUM(NVL(D5, 0)) D5
                    ,SUM(NVL(D7, 0)) D7
                    ,SUM(NVL(R2, 0)) R2
                    ,SUM(NVL(R5, 0)) R5
                    ,SUM(NVL(R9, 0)) R9
                    ,SUM(NVL(O2, 0)) + SUM(NVL(S2, 0)) O2
                    ,SUM(NVL(O4, 0)) + SUM(NVL(O5, 0)) + SUM(NVL(S4, 0)) O4
                    ,SUM(NVL(F2, 0)) F2
                    ,SUM(NVL(F4, 0)) + SUM(NVL(F5, 0)) + SUM(NVL(A4, 0)) F4
               FROM  OPT_ST_T
               GROUP BY 
#if (${loc_type_code} == '3')
                  LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
                  ECC_CD
#else
	              RCC_CD 
#end 
               )
       UNION ALL        
       SELECT
#if (${loc_type_code} == '3')
              LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
              ECC_CD
#else
	          RCC_CD 
#end 
             ,3 SEL_NO
             ,'Optimum Stock (Final)' SEL_NM
#if (${tp_cd} == '1')
             ,TO_NUMBER((NVL(D2, 0) +NVL(D4, 0) +NVL(D5, 0) +NVL(D7, 0) +NVL(R2, 0) +NVL(R5, 0) +NVL(R9, 0) +NVL(O2, 0) +NVL(O4, 0) +NVL(F2, 0) +NVL(F4, 0))) TOTAL_CNT
#elseif (${tp_cd} == '2')
             ,TO_NUMBER((NVL(D2, 0) +NVL(D4, 0) +NVL(D5, 0) +NVL(D7, 0))) TOTAL_CNT
#elseif (${tp_cd} == '3')
             ,TO_NUMBER((NVL(R2, 0) +NVL(R5, 0) +NVL(R9, 0))) TOTAL_CNT
#elseif (${tp_cd} == '4')
             ,TO_NUMBER((NVL(O2, 0) +NVL(O4, 0) +NVL(F2, 0) +NVL(F4, 0))) TOTAL_CNT
#end 
             ,TO_NUMBER(D2) QTY1
             ,TO_NUMBER(D4) QTY2
             ,TO_NUMBER(D5) QTY3
             ,TO_NUMBER(D7) QTY4
             ,TO_NUMBER(R2) QTY5
             ,TO_NUMBER(R5) QTY6
             ,TO_NUMBER(R9) QTY7
             ,TO_NUMBER(O2) QTY8
             ,TO_NUMBER(O4) QTY9
             ,TO_NUMBER(F2) QTY10
             ,TO_NUMBER(F4) QTY11
       FROM  
             (SELECT 
#if (${loc_type_code} == '3')
                     LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
                     ECC_CD
#else
	                 RCC_CD 
#end 
                    ,SUM(NVL(D2, 0)) D2
                    ,SUM(NVL(D4, 0)) D4
                    ,SUM(NVL(D5, 0)) D5
                    ,SUM(NVL(D7, 0)) D7
                    ,SUM(NVL(R2, 0)) R2
                    ,SUM(NVL(R5, 0)) R5
                    ,SUM(NVL(R9, 0)) R9
                    ,SUM(NVL(O2, 0)) + SUM(NVL(S2, 0)) O2
                    ,SUM(NVL(O4, 0)) + SUM(NVL(O5, 0)) + SUM(NVL(S4, 0)) O4
                    ,SUM(NVL(F2, 0)) F2
                    ,SUM(NVL(F4, 0)) + SUM(NVL(F5, 0)) + SUM(NVL(A4, 0)) F4
               FROM  OPT_ST_F
               GROUP BY 
#if (${loc_type_code} == '3')
                  LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
                  ECC_CD
#else
	              RCC_CD 
#end 
               )
       UNION ALL        
       SELECT
#if (${loc_type_code} == '3')
              A.LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
              A.ECC_CD
#else
	          A.RCC_CD
#end 
             ,4 SEL_NO
             ,'Diff. (Invt vs Optimum Final)' SEL_NM
#if (${tp_cd} == '1')
             ,TO_NUMBER(((NVL(A.QTY1, 0) -NVL(B.QTY1, 0))
              +(NVL(A.QTY2, 0) -NVL(B.QTY2, 0))
              +(NVL(A.QTY3, 0) -NVL(B.QTY3, 0))
              +(NVL(A.QTY4, 0) -NVL(B.QTY4, 0))
              +(NVL(A.QTY5, 0) -NVL(B.QTY5, 0))
              +(NVL(A.QTY6, 0) -NVL(B.QTY6, 0))
              +(NVL(A.QTY7, 0) -NVL(B.QTY7, 0))
              +(NVL(A.QTY8, 0) -NVL(B.QTY8, 0))
              +(NVL(A.QTY9, 0) -NVL(B.QTY9, 0))
              +(NVL(A.QTY10, 0) -NVL(B.QTY10, 0))
              +(NVL(A.QTY11, 0) -NVL(B.QTY11, 0)))) TOTAL_CNT
#elseif (${tp_cd} == '2')
             ,TO_NUMBER(((NVL(A.QTY1, 0) -NVL(B.QTY1, 0))
              +(NVL(A.QTY2, 0) -NVL(B.QTY2, 0))
              +(NVL(A.QTY3, 0) -NVL(B.QTY3, 0))
              +(NVL(A.QTY4, 0) -NVL(B.QTY4, 0)))) TOTAL_CNT
#elseif (${tp_cd} == '3')
             ,TO_NUMBER(((NVL(A.QTY5, 0) -NVL(B.QTY5, 0))
              +(NVL(A.QTY6, 0) -NVL(B.QTY6, 0))
              +(NVL(A.QTY7, 0) -NVL(B.QTY7, 0)))) TOTAL_CNT
#elseif (${tp_cd} == '4')
             ,TO_NUMBER(((NVL(A.QTY8, 0) -NVL(B.QTY8, 0))
              +(NVL(A.QTY9, 0) -NVL(B.QTY9, 0))
              +(NVL(A.QTY10, 0) -NVL(B.QTY10, 0))
              +(NVL(A.QTY11, 0) -NVL(B.QTY11, 0)))) TOTAL_CNT
#end
             ,TO_NUMBER(A.QTY1 - B.QTY1) QTY1
             ,TO_NUMBER(A.QTY2 - B.QTY2) QTY2
             ,TO_NUMBER(A.QTY3 - B.QTY3) QTY3
             ,TO_NUMBER(A.QTY4 - B.QTY4) QTY4
             ,TO_NUMBER(A.QTY5 - B.QTY5) QTY5
             ,TO_NUMBER(A.QTY6 - B.QTY6) QTY6
             ,TO_NUMBER(A.QTY7 - B.QTY7) QTY7
             ,TO_NUMBER(A.QTY8 - B.QTY8) QTY8
             ,TO_NUMBER(A.QTY9 - B.QTY9) QTY9
             ,TO_NUMBER(A.QTY10 - B.QTY10) QTY10
             ,TO_NUMBER(A.QTY11 - B.QTY11) QTY11
       FROM  CRT_MT A,
             (SELECT 
#if (${loc_type_code} == '3')
                     LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
                     ECC_CD
#else
	                 RCC_CD 
#end 
                    ,SUM(NVL(D2, 0)) QTY1
                    ,SUM(NVL(D4, 0)) QTY2
                    ,SUM(NVL(D5, 0)) QTY3
                    ,SUM(NVL(D7, 0)) QTY4
                    ,SUM(NVL(R2, 0)) QTY5
                    ,SUM(NVL(R5, 0)) QTY6
                    ,SUM(NVL(R9, 0)) QTY7
                    ,SUM(NVL(O2, 0)) + SUM(NVL(S2, 0)) QTY8
                    ,SUM(NVL(O4, 0)) + SUM(NVL(O5, 0)) + SUM(NVL(S4, 0)) QTY9
                    ,SUM(NVL(F2, 0)) QTY10
                    ,SUM(NVL(F4, 0)) + SUM(NVL(F5, 0)) + SUM(NVL(A4, 0)) QTY11
               FROM OPT_ST_F
               GROUP BY 
#if (${loc_type_code} == '3')
                  LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
                  ECC_CD
#else
	              RCC_CD 
#end 
             ) B
#if (${loc_type_code} == '3')
       WHERE A.LCC_CD = B.LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
       WHERE A.ECC_CD = B.ECC_CD
#else
	   WHERE A.RCC_CD = B.RCC_CD
#end 
       UNION ALL        
       SELECT
#if (${loc_type_code} == '3')
              A.LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
              A.ECC_CD
#else
	          A.RCC_CD
#end
             ,5 SEL_NO
             ,'Ratio (Invt/Optimum Final)' SEL_NM
#if (${tp_cd} == '1')
             ,ROUND((NVL(A.QTY1, 0)+NVL(A.QTY2, 0)+NVL(A.QTY3, 0)+NVL(A.QTY4, 0)+NVL(A.QTY5, 0)+NVL(A.QTY6, 0)+NVL(A.QTY7, 0)+NVL(A.QTY8, 0)+NVL(A.QTY9, 0)+NVL(A.QTY10, 0)+NVL(A.QTY11, 0))/
              (NULLIF((NVL(B.QTY1, 0)+NVL(B.QTY2, 0)+NVL(B.QTY3, 0)+NVL(B.QTY4, 0)+NVL(B.QTY5, 0)+NVL(B.QTY6, 0)+NVL(B.QTY7, 0)+NVL(B.QTY8, 0)+NVL(B.QTY9, 0)+NVL(B.QTY10, 0)+NVL(B.QTY11, 0)), 0)),1) TOTAL_CNT
#elseif (${tp_cd} == '2')
             ,ROUND((NVL(A.QTY1, 0)+NVL(A.QTY2, 0)+NVL(A.QTY3, 0)+NVL(A.QTY4, 0))/
              (NULLIF((NVL(B.QTY1, 0)+NVL(B.QTY2, 0)+NVL(B.QTY3, 0)+NVL(B.QTY4, 0)), 0)),1) TOTAL_CNT
#elseif (${tp_cd} == '3')
             ,ROUND((NVL(A.QTY5, 0)+NVL(A.QTY6, 0)+NVL(A.QTY7, 0))/
              (NULLIF((NVL(B.QTY5, 0)+NVL(B.QTY6, 0)+NVL(B.QTY7, 0)), 0)),1) TOTAL_CNT
#elseif (${tp_cd} == '4')
             ,ROUND((NVL(A.QTY8, 0)+NVL(A.QTY9, 0)+NVL(A.QTY10, 0)+NVL(A.QTY11, 0))/
              (NULLIF((NVL(B.QTY8, 0)+NVL(B.QTY9, 0)+NVL(B.QTY10, 0)+NVL(B.QTY11, 0)), 0)),1) TOTAL_CNT
#end
             ,NVL(TO_NUMBER(ROUND(A.QTY1 / NULLIF(B.QTY1, 0),1)), 0) QTY1
             ,NVL(TO_NUMBER(ROUND(A.QTY2 / NULLIF(B.QTY2, 0),1)), 0) QTY2
             ,NVL(TO_NUMBER(ROUND(A.QTY3 / NULLIF(B.QTY3, 0),1)), 0) QTY3
             ,NVL(TO_NUMBER(ROUND(A.QTY4 / NULLIF(B.QTY4, 0),1)), 0) QTY4
             ,NVL(TO_NUMBER(ROUND(A.QTY5 / NULLIF(B.QTY5, 0),1)), 0) QTY5
             ,NVL(TO_NUMBER(ROUND(A.QTY6 / NULLIF(B.QTY6, 0),1)), 0) QTY6
             ,NVL(TO_NUMBER(ROUND(A.QTY7 / NULLIF(B.QTY7, 0),1)), 0) QTY7
             ,NVL(TO_NUMBER(ROUND(A.QTY8 / NULLIF(B.QTY8, 0),1)), 0) QTY8
             ,NVL(TO_NUMBER(ROUND(A.QTY9 / NULLIF(B.QTY9, 0),1)), 0) QTY9
             ,NVL(TO_NUMBER(ROUND(A.QTY10 / NULLIF(B.QTY10, 0),1)), 0) QTY10
             ,NVL(TO_NUMBER(ROUND(A.QTY11 / NULLIF(B.QTY11, 0),1)), 0) QTY11
       FROM  CRT_MT A,
             (SELECT 
#if (${loc_type_code} == '3')
                     LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
                     ECC_CD
#else
	                 RCC_CD 
#end 
                    ,SUM(NVL(D2, 0)) QTY1
                    ,SUM(NVL(D4, 0)) QTY2
                    ,SUM(NVL(D5, 0)) QTY3
                    ,SUM(NVL(D7, 0)) QTY4
                    ,SUM(NVL(R2, 0)) QTY5
                    ,SUM(NVL(R5, 0)) QTY6
                    ,SUM(NVL(R9, 0)) QTY7
                    ,SUM(NVL(O2, 0)) + SUM(NVL(S2, 0)) QTY8
                    ,SUM(NVL(O4, 0)) + SUM(NVL(O5, 0)) + SUM(NVL(S4, 0)) QTY9
                    ,SUM(NVL(F2, 0)) QTY10
                    ,SUM(NVL(F4, 0)) + SUM(NVL(F5, 0)) + SUM(NVL(A4, 0)) QTY11
               FROM OPT_ST_F
               GROUP BY
#if (${loc_type_code} == '3')
                  LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
                  ECC_CD
#else
	              RCC_CD 
#end 
             ) B
#if (${loc_type_code} == '3')
       WHERE A.LCC_CD = B.LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
       WHERE A.ECC_CD = B.ECC_CD
#else
	   WHERE A.RCC_CD = B.RCC_CD
#end        
       UNION ALL        
       SELECT
#if (${loc_type_code} == '3')
              A.LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
              A.ECC_CD
#else
	          A.RCC_CD
#end
             ,6 SEL_NO
             ,'Signal' SEL_NM
#if (${tp_cd} == '1')
             ,ROUND((NVL(A.QTY1, 0)+NVL(A.QTY2, 0)+NVL(A.QTY3, 0)+NVL(A.QTY4, 0)+NVL(A.QTY5, 0)+NVL(A.QTY6, 0)+NVL(A.QTY7, 0)+NVL(A.QTY8, 0)+NVL(A.QTY9, 0)+NVL(A.QTY10, 0)+NVL(A.QTY11, 0))/
              (NULLIF((NVL(B.QTY1, 0)+NVL(B.QTY2, 0)+NVL(B.QTY3, 0)+NVL(B.QTY4, 0)+NVL(B.QTY5, 0)+NVL(B.QTY6, 0)+NVL(B.QTY7, 0)+NVL(B.QTY8, 0)+NVL(B.QTY9, 0)+NVL(B.QTY10, 0)+NVL(B.QTY11, 0)), 0)),1) TOTAL_CNT
#elseif (${tp_cd} == '2')
             ,ROUND((NVL(A.QTY1, 0)+NVL(A.QTY2, 0)+NVL(A.QTY3, 0)+NVL(A.QTY4, 0))/
              (NULLIF((NVL(B.QTY1, 0)+NVL(B.QTY2, 0)+NVL(B.QTY3, 0)+NVL(B.QTY4, 0)), 0)),1) TOTAL_CNT
#elseif (${tp_cd} == '3')
             ,ROUND((NVL(A.QTY5, 0)+NVL(A.QTY6, 0)+NVL(A.QTY7, 0))/
              (NULLIF((NVL(B.QTY5, 0)+NVL(B.QTY6, 0)+NVL(B.QTY7, 0)), 0)),1) TOTAL_CNT
#elseif (${tp_cd} == '4')
             ,ROUND((NVL(A.QTY8, 0)+NVL(A.QTY9, 0)+NVL(A.QTY10, 0)+NVL(A.QTY11, 0))/
              (NULLIF((NVL(B.QTY8, 0)+NVL(B.QTY9, 0)+NVL(B.QTY10, 0)+NVL(B.QTY11, 0)), 0)),1) TOTAL_CNT
#end
             ,NVL(TO_NUMBER(ROUND(A.QTY1 / NULLIF(B.QTY1, 0),1)), 0) QTY1
             ,NVL(TO_NUMBER(ROUND(A.QTY2 / NULLIF(B.QTY2, 0),1)), 0) QTY2
             ,NVL(TO_NUMBER(ROUND(A.QTY3 / NULLIF(B.QTY3, 0),1)), 0) QTY3
             ,NVL(TO_NUMBER(ROUND(A.QTY4 / NULLIF(B.QTY4, 0),1)), 0) QTY4
             ,NVL(TO_NUMBER(ROUND(A.QTY5 / NULLIF(B.QTY5, 0),1)), 0) QTY5
             ,NVL(TO_NUMBER(ROUND(A.QTY6 / NULLIF(B.QTY6, 0),1)), 0) QTY6
             ,NVL(TO_NUMBER(ROUND(A.QTY7 / NULLIF(B.QTY7, 0),1)), 0) QTY7
             ,NVL(TO_NUMBER(ROUND(A.QTY8 / NULLIF(B.QTY8, 0),1)), 0) QTY8
             ,NVL(TO_NUMBER(ROUND(A.QTY9 / NULLIF(B.QTY9, 0),1)), 0) QTY9
             ,NVL(TO_NUMBER(ROUND(A.QTY10 / NULLIF(B.QTY10, 0),1)), 0) QTY10
             ,NVL(TO_NUMBER(ROUND(A.QTY11 / NULLIF(B.QTY11, 0),1)), 0) QTY11
       FROM  CRT_MT A,
             (SELECT 
#if (${loc_type_code} == '3')
                     LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
                     ECC_CD
#else
	                 RCC_CD 
#end 
                    ,SUM(NVL(D2, 0)) QTY1
                    ,SUM(NVL(D4, 0)) QTY2
                    ,SUM(NVL(D5, 0)) QTY3
                    ,SUM(NVL(D7, 0)) QTY4
                    ,SUM(NVL(R2, 0)) QTY5
                    ,SUM(NVL(R5, 0)) QTY6
                    ,SUM(NVL(R9, 0)) QTY7
                    ,SUM(NVL(O2, 0)) + SUM(NVL(S2, 0)) QTY8
                    ,SUM(NVL(O4, 0)) + SUM(NVL(O5, 0)) + SUM(NVL(S4, 0)) QTY9
                    ,SUM(NVL(F2, 0)) QTY10
                    ,SUM(NVL(F4, 0)) + SUM(NVL(F5, 0)) + SUM(NVL(A4, 0)) QTY11
               FROM OPT_ST_F
               GROUP BY
#if (${loc_type_code} == '3')
                  LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
                  ECC_CD
#else
	              RCC_CD 
#end 
             ) B
#if (${loc_type_code} == '3')
       WHERE A.LCC_CD = B.LCC_CD
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
       WHERE A.ECC_CD = B.ECC_CD
#else
	   WHERE A.RCC_CD = B.RCC_CD
#end             
      )
#if (${loc_type_code} == '3')
 ORDER BY LCC_CD,SEL_NO
#elseif (${loc_type_code} == '8' || ${loc_type_code} == '4')
 ORDER BY ECC_CD,SEL_NO
#else
 ORDER BY RCC_CD,SEL_NO
#end 
 )
SELECT
       LOC_CD
      ,SEL_NO
      ,DIVISION
      ,TOTAL_CNT
#if (${tp_cd} == '1')
      ,QTY1
      ,QTY2
      ,QTY3
      ,QTY4
      ,QTY5
      ,QTY6
      ,QTY7
      ,QTY8
      ,QTY9
      ,QTY10
      ,QTY11
#elseif (${tp_cd} == '2')
      ,QTY1 QTY1
      ,QTY2 QTY2
      ,QTY3 QTY3
      ,QTY4 QTY4
#elseif (${tp_cd} == '3')
      ,QTY5 QTY1
      ,QTY6 QTY2
      ,QTY7 QTY3
#elseif (${tp_cd} == '4')
      ,QTY8 QTY1
      ,QTY9 QTY2
      ,QTY10 QTY3
      ,QTY11 QTY4
#end 
FROM
(SELECT *
  FROM OPT_ST
UNION ALL  
SELECT 
       'TOTAL' LOC_CD
      ,1 SEL_NO
      ,'Inventory (MT)' DIVISION
      ,SUM(DECODE(SEL_NO,1,TOTAL_CNT,0)) TOTAL_CNT 
      ,SUM(DECODE(SEL_NO,1,QTY1,0)) QTY1
      ,SUM(DECODE(SEL_NO,1,QTY2,0)) QTY2
      ,SUM(DECODE(SEL_NO,1,QTY3,0)) QTY3
      ,SUM(DECODE(SEL_NO,1,QTY4,0)) QTY4
      ,SUM(DECODE(SEL_NO,1,QTY5,0)) QTY5
      ,SUM(DECODE(SEL_NO,1,QTY6,0)) QTY6
      ,SUM(DECODE(SEL_NO,1,QTY7,0)) QTY7
      ,SUM(DECODE(SEL_NO,1,QTY8,0)) QTY8
      ,SUM(DECODE(SEL_NO,1,QTY9,0)) QTY9
      ,SUM(DECODE(SEL_NO,1,QTY10,0)) QTY10
      ,SUM(DECODE(SEL_NO,1,QTY11,0)) QTY11
  FROM OPT_ST
UNION ALL  
SELECT 
       'TOTAL' LOC_CD
      ,2 SEL_NO
      ,'Optimum Stock (t-Dist)' DIVISION
      ,SUM(DECODE(SEL_NO,2,TOTAL_CNT,0)) TOTAL_CNT 
      ,SUM(DECODE(SEL_NO,2,QTY1,0)) QTY1
      ,SUM(DECODE(SEL_NO,2,QTY2,0)) QTY2
      ,SUM(DECODE(SEL_NO,2,QTY3,0)) QTY3
      ,SUM(DECODE(SEL_NO,2,QTY4,0)) QTY4
      ,SUM(DECODE(SEL_NO,2,QTY5,0)) QTY5
      ,SUM(DECODE(SEL_NO,2,QTY6,0)) QTY6
      ,SUM(DECODE(SEL_NO,2,QTY7,0)) QTY7
      ,SUM(DECODE(SEL_NO,2,QTY8,0)) QTY8
      ,SUM(DECODE(SEL_NO,2,QTY9,0)) QTY9
      ,SUM(DECODE(SEL_NO,2,QTY10,0)) QTY10
      ,SUM(DECODE(SEL_NO,2,QTY11,0)) QTY11
  FROM OPT_ST
UNION ALL  
SELECT 
       'TOTAL' LOC_CD
      ,3 SEL_NO
      ,'Optimum Stock (Final)' DIVISION
      ,SUM(DECODE(SEL_NO,3,TOTAL_CNT,0)) TOTAL_CNT 
      ,SUM(DECODE(SEL_NO,3,QTY1,0)) QTY1
      ,SUM(DECODE(SEL_NO,3,QTY2,0)) QTY2
      ,SUM(DECODE(SEL_NO,3,QTY3,0)) QTY3
      ,SUM(DECODE(SEL_NO,3,QTY4,0)) QTY4
      ,SUM(DECODE(SEL_NO,3,QTY5,0)) QTY5
      ,SUM(DECODE(SEL_NO,3,QTY6,0)) QTY6
      ,SUM(DECODE(SEL_NO,3,QTY7,0)) QTY7
      ,SUM(DECODE(SEL_NO,3,QTY8,0)) QTY8
      ,SUM(DECODE(SEL_NO,3,QTY9,0)) QTY9
      ,SUM(DECODE(SEL_NO,3,QTY10,0)) QTY10
      ,SUM(DECODE(SEL_NO,3,QTY11,0)) QTY11
  FROM OPT_ST
UNION ALL  
SELECT 
       'TOTAL' LOC_CD
      ,4 SEL_NO
      ,'Diff. (Invt vs Optimum Final)' DIVISION
      ,SUM(DECODE(SEL_NO,4,TOTAL_CNT,0)) TOTAL_CNT 
      ,SUM(DECODE(SEL_NO,4,QTY1,0)) QTY1
      ,SUM(DECODE(SEL_NO,4,QTY2,0)) QTY2
      ,SUM(DECODE(SEL_NO,4,QTY3,0)) QTY3
      ,SUM(DECODE(SEL_NO,4,QTY4,0)) QTY4
      ,SUM(DECODE(SEL_NO,4,QTY5,0)) QTY5
      ,SUM(DECODE(SEL_NO,4,QTY6,0)) QTY6
      ,SUM(DECODE(SEL_NO,4,QTY7,0)) QTY7
      ,SUM(DECODE(SEL_NO,4,QTY8,0)) QTY8
      ,SUM(DECODE(SEL_NO,4,QTY9,0)) QTY9
      ,SUM(DECODE(SEL_NO,4,QTY10,0)) QTY10
      ,SUM(DECODE(SEL_NO,4,QTY11,0)) QTY11
  FROM OPT_ST
UNION ALL  
SELECT 
       DISTINCT 'TOTAL' LOC_CD
      ,5 SEL_NO
      ,'Ratio (Invt/Optimum Final)' DIVISION
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,TOTAL_CNT,0))/NULLIF(SUM(DECODE(SEL_NO,3,TOTAL_CNT,0)),0),1),0) TOTAL_CNT
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY1,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY1,0)),0),1),0) QTY1
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY2,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY2,0)),0),1),0) QTY2
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY3,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY3,0)),0),1),0) QTY3
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY4,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY4,0)),0),1),0) QTY4
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY5,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY5,0)),0),1),0) QTY5
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY6,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY6,0)),0),1),0) QTY6
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY7,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY7,0)),0),1),0) QTY7
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY8,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY8,0)),0),1),0) QTY8
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY9,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY9,0)),0),1),0) QTY9
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY10,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY10,0)),0),1),0) QTY10
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY11,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY11,0)),0),1),0) QTY11
  FROM OPT_ST
 UNION ALL  
SELECT 
       DISTINCT  'TOTAL' LOC_CD
      ,6 SEL_NO
      ,'Signal' DIVISION
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,TOTAL_CNT,0))/NULLIF(SUM(DECODE(SEL_NO,3,TOTAL_CNT,0)),0),1),0) TOTAL_CNT
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY1,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY1,0)),0),1),0) QTY1
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY2,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY2,0)),0),1),0) QTY2
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY3,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY3,0)),0),1),0) QTY3
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY4,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY4,0)),0),1),0) QTY4
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY5,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY5,0)),0),1),0) QTY5
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY6,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY6,0)),0),1),0) QTY6
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY7,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY7,0)),0),1),0) QTY7
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY8,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY8,0)),0),1),0) QTY8
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY9,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY9,0)),0),1),0) QTY9
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY10,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY10,0)),0),1),0) QTY10
      ,NVL(ROUND(SUM(DECODE(SEL_NO,1,QTY11,0))/NULLIF(SUM(DECODE(SEL_NO,3,QTY11,0)),0),1),0) QTY11
  FROM OPT_ST)			]]></sql>
			<params>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="dmg_flg" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
