<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DVFactorMgtDBDAOsearchContainerSealInquiryCountRSQL">
			<desc><![CDATA[--------------------------------------------------------
History
2011.11.29 김상수 [CHM-201114696-01] ALPS > MNR > Seal management creation 화면과 inquiry 화면 - Seal No의 prefix만 별도 컬럼으로 분리
                                                          - MNR_SEAL_PLN 테이블에 Serial Range 값을 분리하여 저장, 조회
                                                          - 해당 컬럼명을 사용하는 js및 쿼리, VO 전면수정]]></desc>
			<sql><![CDATA[
WITH LV_SEAL_NO AS
            (SELECT SEAL_NO_PFX_NM||DECODE(IS_CHR,1,LPAD(CNTR_SEAL_NO,LST_LEN,'0'),CNTR_SEAL_NO) AS CNTR_SEAL_NO
            FROM 
               (SELECT A.SEAL_NO_PFX_NM,(TO_NUMBER(A.N1ST_SER_RNG_SEAL_NO) + B.SEQ - 1) AS CNTR_SEAL_NO,
                       DECODE(SUBSTR(A.LST_SER_RNG_SEAL_NO,1,1),'0',1,0) IS_CHR,
                       LENGTH(A.LST_SER_RNG_SEAL_NO) LST_LEN
                  FROM (SELECT SEAL_NO_PFX_NM,
                               N1ST_SER_RNG_SEAL_NO,
                               LST_SER_RNG_SEAL_NO,
                               TO_NUMBER(LST_SER_RNG_SEAL_NO) - TO_NUMBER(N1ST_SER_RNG_SEAL_NO) + 1 AS PLN_QTY
                          FROM MNR_SEAL_PLN) A,
                   (SELECT LEVEL AS SEQ
                      FROM DUAL
                   CONNECT BY LEVEL <= (SELECT MAX(TO_NUMBER(LST_SER_RNG_SEAL_NO) - TO_NUMBER(N1ST_SER_RNG_SEAL_NO) + 1)
                                          FROM MNR_SEAL_PLN
                                         WHERE PLN_YRMON BETWEEN @[fr_yy]||@[fr_mm] AND @[to_yy]||@[to_mm])) B
             WHERE B.SEQ <= A.PLN_QTY)
             )

SELECT COUNT(*) AS OUT_QTY
  FROM (SELECT DISTINCT CNTR_SEAL_NO
          FROM BKG_CNTR_SEAL_NO
         WHERE CRE_DT BETWEEN TO_DATE(@[fr_yy]||@[fr_mm]||'01', 'YYYYMMDD') AND LAST_DAY(TO_DATE(@[to_yy]||@[to_mm]||'01', 'YYYYMMDD')) + 0.99999
         MINUS SELECT CNTR_SEAL_NO
                 FROM LV_SEAL_NO)			]]></sql>
			<params>
				<param name="fr_yy" type="12" value="" out="N"/>
				<param name="fr_mm" type="12" value="" out="N"/>
				<param name="to_yy" type="12" value="" out="N"/>
				<param name="to_mm" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
