<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="LongTxContainerMovementFinderDBDAOSearchEDIErrorSumListRSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
SELECT
#if (${data_radio} == 'RCC')
         RCC,
#elseif (${data_radio} == 'CN')
         RCC,
         CN,
#elseif (${data_radio} == 'LCC')
         RCC,
         CN,
         LCC,
#elseif (${data_radio} == 'LOC')
         RCC,
         CN,
         LCC,
         LOC,
#else
         RCC,
         CN,
         LCC,
         LOC,
         YARD,
#end
         SUM (CORR_ERR_CNT) AS CORR_ERR,
         ROUND (SUM (CORR_ERR_CNT) / SUM (TTL_CNT) * 100, 1) AS CORR_ERR_RATIO,
         SUM (TTL_CNT) - SUM (CORR_ERR_CNT) CORR_OK,
         ROUND ((SUM (TTL_CNT) - SUM (CORR_ERR_CNT)) / SUM (TTL_CNT) * 100, 1) AS CORR_OK_RATIO,
         SUM (TTL_CNT) AS CORR_TTL,
         SUM (INIT_ERR_CNT) AS INIT_ERR,
         ROUND (SUM (INIT_ERR_CNT) / SUM (TTL_CNT) * 100, 1) AS INIT_ERR_RATIO,
         SUM (TTL_CNT) - SUM (INIT_ERR_CNT) AS INIT_OK,
         ROUND ((SUM (TTL_CNT) - SUM (INIT_ERR_CNT)) / SUM (TTL_CNT) * 100, 1) AS INIT_OK_RATIO,
         SUM (TTL_CNT) AS INIT_TTL,
         @[p_date1] AS P_DATE1,
         @[p_date2] AS P_DATE2,
         @[source_radio] AS SOURCE_RADIO
    FROM (SELECT ME.RCC_CD AS RCC,
                 SUBSTR (EVNT_YD_CD, 0, 2) AS CN,
                 ME.LCC_CD AS LCC,
                 SUBSTR (EVNT_YD_CD, 0, 5) AS LOC,
                 EVNT_YD_CD AS YARD,
                 CASE
                    WHEN (RTY_KNT = 0 AND MVMT_EDI_RSLT_CD = 'N') OR (RTY_KNT > 0)
                       THEN 1
                    ELSE 0
                 END AS INIT_ERR_CNT,
                 CASE
                    WHEN (MVMT_EDI_RSLT_CD = 'N')
                       THEN 1
                    ELSE 0
                 END AS CORR_ERR_CNT,
                 CASE
                    WHEN (RTY_KNT = RTY_KNT)
                       THEN 1
                    ELSE 0
                 END AS TTL_CNT
            FROM CTM_MVMT_EDI_MSG,
                 MDM_LOCATION ML,
                 MDM_EQ_ORZ_CHT ME
           WHERE IDX_CRE_LOCL_DT BETWEEN REPLACE (@[p_date1], '-', '') AND REPLACE (@[p_date2], '-', '')
             AND MVMT_EDI_RSLT_CD IN ('Y', 'N')
#if (${rcc_cd} == '' || ${rcc_cd} == 'ALL')
             AND MVMT_EDI_MSG_AREA_CD IN ('USA', 'SWA', 'KOR', 'EUR', 'CHN')
#else
             AND MVMT_EDI_MSG_AREA_CD = (SELECT SYS_AREA_GRP_ID AS SVR_ID
                                           FROM COM_SYS_AREA_GRP_ID
                                          WHERE CNT_CD = SUBSTR (@[rcc_cd], 0, 2)
                                            AND SUBSTR (SYS_AREA_GRP_ID, 0, 1) != 'D')
             AND ME.RCC_CD = @[rcc_cd]
#end
#if (${lcc_cd} != '')
             AND ME.LCC_CD = @[lcc_cd]
#end
#if (${p_yard2} != '')
             AND EVNT_YD_CD = @[p_yard1]||@[p_yard2]
#elseif (${p_yard1} != '')
             AND EVNT_YD_CD LIKE @[p_yard1]||'%'
#end
#if (${source_radio} == 'DOM')
             AND SUBSTR (EDI_MVMT_STS_CD, 0, 1) = 'C'
#elseif (${source_radio} == 'ITN')
             AND SUBSTR (EDI_MVMT_STS_CD, 0, 1) != 'C'
#end
             AND ME.SCC_CD = ML.SCC_CD
             AND ML.LOC_CD = SUBSTR (EVNT_YD_CD, 0, 5)
/*             AND MVMT_EDI_RMK = DECODE (MVMT_EDI_RSLT_CD, 'Y', 'OK.PROCESSED', MVMT_EDI_RMK)*/
             )
#if (${data_radio} == 'RCC')
GROUP BY RCC
ORDER BY RCC
#elseif (${data_radio} == 'CN')
GROUP BY RCC, CN
ORDER BY RCC, CN
#elseif (${data_radio} == 'LCC')
GROUP BY RCC, CN, LCC
ORDER BY RCC, CN, LCC
#elseif (${data_radio} == 'LOC')
GROUP BY RCC, CN, LCC, LOC
ORDER BY RCC, CN, LCC, LOC
#else
GROUP BY RCC, CN, LCC, LOC, YARD
ORDER BY RCC, CN, LCC, LOC, YARD
#end			]]></sql>
			<params>
				<param name="p_date1" type="12" value="" out="N"/>
				<param name="p_date2" type="12" value="" out="N"/>
				<param name="source_radio" type="12" value="" out="N"/>
				<param name="rcc_cd" type="12" value="" out="N"/>
				<param name="lcc_cd" type="12" value="" out="N"/>
				<param name="p_yard1" type="12" value="" out="N"/>
				<param name="p_yard2" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
