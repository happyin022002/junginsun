<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChargeCalculationDBDAOSearchDualChargeTariffRSQL">
			<desc><![CDATA[ChargeCalculationDBDAOSearchDualChargeTariffRSQL]]></desc>
			<sql><![CDATA[
SELECT   C.SYS_AREA_GRP_ID AS SVR_ID
        ,C.CNTR_NO
        ,C.CNTR_CYC_NO
        ,C.DMDT_TRF_CD
        ,C.DMDT_CHG_LOC_DIV_CD
        ,C.CHG_SEQ
        ,C.DMDT_CHG_STS_CD
		,TO_CHAR(C.FM_MVMT_DT, 'YYYYMMDD') AS FM_MVMT_DT
		,TO_CHAR(C.TO_MVMT_DT, 'YYYYMMDD') AS TO_MVMT_DT
        ,C.FM_MVMT_STS_CD
        ,C.FM_MVMT_YD_CD
        ,C.TO_MVMT_STS_CD
        ,C.TO_MVMT_YD_CD
        ,C.CORR_RMK
		,C.WEB_IND_FLG
		,C.OFC_CD
		,C.OFC_RHQ_CD
        ,C.CUST_CNT_CD
        ,C.CUST_SEQ
        ,C.ACT_CNT_CD
        ,C.ACT_CUST_SEQ
        ,SUBSTR(C.DMDT_TRF_CD, 3, 1) AS IO_BND_CD        
        ,NVL(C.OFC_TRNS_FLG, 'N') OFC_TRNS_FLG
        ,TO_CHAR(C.WEB_MTY_DT, 'YYYYMMDD') AS WEB_MTY_DT
		,C.DUL_TP_EXPT_FLG
		,C.CXL_BKG_CHG_FLG
        ,B.BKG_NO
        ,B.BL_NO
		,B.CNTR_TPSZ_CD
        ,B.VSL_CD
        ,B.SKD_VOY_NO
        ,B.SKD_DIR_CD

FROM    DMT_CHG_BKG_CNTR    B,
		DMT_CHG_CALC        C

WHERE	C.SYS_AREA_GRP_ID	= @[svr_id]
AND		C.CNTR_NO			= @[cntr_no]
AND		C.CNTR_CYC_NO		= @[cntr_cyc_no]

#if (${dmdt_trf_cd} == 'CTOC')
AND (
        (		C.DMDT_TRF_CD           = 'DTOC'
        	AND C.DMDT_CHG_LOC_DIV_CD   = 'POR'
        )
        OR
        (		C.DMDT_TRF_CD           = 'DMOF'
        	AND C.DMDT_CHG_LOC_DIV_CD   = 'POL'
        )
        OR
        (		C.DMDT_TRF_CD           = 'DMOF'
        	AND C.DMDT_CHG_LOC_DIV_CD   = 'POR'
        )
    )

#elseif (${dmdt_trf_cd} == 'CTIC')
AND (   
        (		C.DMDT_TRF_CD           = 'DMIF'
        	AND C.DMDT_CHG_LOC_DIV_CD   = 'POD'
        )
        OR
        (		C.DMDT_TRF_CD           = 'DTIC'
        	AND C.DMDT_CHG_LOC_DIV_CD   = 'DEL'
        )
        OR
        (		C.DMDT_TRF_CD           = 'DMIF'
        	AND C.DMDT_CHG_LOC_DIV_CD   = 'DEL'
        )
    )
#end

AND		C.CHG_SEQ			= @[chg_seq]
AND		B.SYS_AREA_GRP_ID	= C.SYS_AREA_GRP_ID  
AND		B.CNTR_NO			= C.CNTR_NO
AND		B.CNTR_CYC_NO		= C.CNTR_CYC_NO


#if (${dmdt_trf_cd} == 'CTOC')
	ORDER BY C.DMDT_TRF_CD ASC, C.DMDT_CHG_LOC_DIV_CD ASC

#elseif (${dmdt_trf_cd} == 'CTIC')
	ORDER BY C.DMDT_TRF_CD DESC, C.DMDT_CHG_LOC_DIV_CD ASC
#end


			]]></sql>
			<params>
				<param name="svr_id" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="cntr_cyc_no" type="12" value="" out="N"/>
				<param name="chg_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
