<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceIssueCollectionMgtDBDAOModifyInvoiceAdjustAmountUSQL">
			<desc><![CDATA[DEM/DET Adjustment Request - After Booking Approval 에서 승인처리시 Charge Calculation 시 Invoice 를 계산된 결과로 갱신해주는 쿼리]]></desc>
			<sql><![CDATA[
UPDATE	DMT_INV_MN INV_MN
SET		INV_MN.AFT_INV_ADJ_AMT = 
		(
			SELECT	SUM(CHG_CALC.BIL_AMT)
			FROM	DMT_INV_DTL INV_DTL
				,	DMT_CHG_CALC CHG_CALC
			WHERE	INV_DTL.DMDT_INV_NO = INV_MN.DMDT_INV_NO
				AND	CHG_CALC.SYS_AREA_GRP_ID = INV_DTL.SYS_AREA_GRP_ID
				AND CHG_CALC.CNTR_NO = INV_DTL.CNTR_NO
				AND CHG_CALC.CNTR_CYC_NO = INV_DTL.CNTR_CYC_NO
				AND	CHG_CALC.DMDT_TRF_CD = INV_DTL.DMDT_TRF_CD
				AND CHG_CALC.DMDT_CHG_LOC_DIV_CD = INV_DTL.DMDT_CHG_LOC_DIV_CD
				AND CHG_CALC.CHG_SEQ = INV_DTL.CHG_SEQ
		)
WHERE	INV_MN.DMDT_INV_NO IN
		(
			SELECT	DISTINCT(INV_MN2.DMDT_INV_NO)
			FROM	DMT_AFT_BKG_ADJ_RQST_DTL ADJ_RQST_DTL
				,	DMT_INV_MN INV_MN2
			WHERE	ADJ_RQST_DTL.AFT_EXPT_DAR_NO = @[aft_expt_dar_no]
				AND	ADJ_RQST_DTL.DMDT_TRF_CD = INV_MN2.DMDT_TRF_CD
				AND ADJ_RQST_DTL.BKG_NO = INV_MN2.BKG_NO
				AND NVL(INV_MN2.DMDT_INV_STS_CD, 'I') = 'I'
		)			]]></sql>
			<params>
				<param name="aft_expt_dar_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
