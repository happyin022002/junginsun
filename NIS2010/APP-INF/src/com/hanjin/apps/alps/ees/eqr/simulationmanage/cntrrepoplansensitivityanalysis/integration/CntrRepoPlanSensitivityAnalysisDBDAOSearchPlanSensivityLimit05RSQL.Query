<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CntrRepoPlanSensitivityAnalysisDBDAOSearchPlanSensivityLimit05RSQL">
			<desc><![CDATA[Safety Stock 민감도조회]]></desc>
			<sql><![CDATA[
SELECT SUBSTR((SELECT PLN_YR||PLN_WK FROM EQR_WK_PRD WHERE WK_ST_DT >= B.SFSTK_DT AND WK_END_DT <= B.SFSTK_DT),1,4) || '-' || SUBSTR((SELECT PLN_YR||PLN_WK FROM EQR_WK_PRD WHERE WK_ST_DT >= B.SFSTK_DT AND WK_END_DT <= B.SFSTK_DT),5,2) WEEK        
	  , @[sens_typ] SENSITY                                                   	
	  , @[obj_txt] OBJ                                                    	
	  , '' LANE                                                       
	  , '' VVD                                                        
	  , B.ECC_CD FM_LOC                                             
	  , '' TO_LOC                                                     
	  , B.CNTR_TPSZ_CD ts_type                                                 
	  , SUM(SFSTK_VOL_QTY) CURR_LIMIT                                 
	  , SUM(SHDW_COST_AMT) SHADOW_PRC                                 
	  , SUM(RNG_MIN_QTY) LIMIT_LANG                                  
	  , SUM(RNG_MAX_QTY) LIMIT_LANG1                                 
FROM EQR_EQ_REPO_PLN A                                                 
     , EQR_SFT_STK_SHDW B                                              
     , (SELECT ECC_CD, LCC_CD, RCC_CD FROM EQR_ECC_MST) C	           	
     , EQR_ECC_SFT_STK  D                                              
WHERE A.REPO_PLN_ID = B.REPO_PLN_ID                                    
AND B.ECC_CD = C.ECC_CD                                          
AND A.REPO_PLN_ID = @[repo_pln_id]                                            
AND B.CNTR_TPSZ_CD IN (${arrtpszcd})                      		
AND B.SFSTK_DT BETWEEN (select WK_ST_DT from EQR_WK_PRD	where PLN_YR||PLN_WK = @[fmstartprd])  
     AND                                                                  
                       (select WK_END_DT from EQR_WK_PRD where PLN_YR||PLN_WK = @[fmendprd])  
AND D.ECC_CD = B.ECC_CD                                          
AND D.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD                              
#if (${fmecccd} != '') 
    #if (${fmtype} == 'R')
    AND C.RCC_CD IN (${arrfmecccd}) 
	#end
    #if (${fmtype} == 'L')
    AND C.LCC_CD IN (${arrfmecccd})
	#end
    #if (${fmtype} == 'E')
    AND C.ECC_CD IN (${arrfmecccd})
	#end
#end 
GROUP BY B.SFSTK_DT, B.ECC_CD, B.CNTR_TPSZ_CD                          
ORDER BY B.SFSTK_DT, B.ECC_CD, B.CNTR_TPSZ_CD			]]></sql>
			<params>
				<param name="sens_typ" type="12" value="" out="N"/>
				<param name="obj_txt" type="12" value="" out="N"/>
				<param name="repo_pln_id" type="12" value="" out="N"/>
				<param name="fmstartprd" type="12" value="" out="N"/>
				<param name="fmendprd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
