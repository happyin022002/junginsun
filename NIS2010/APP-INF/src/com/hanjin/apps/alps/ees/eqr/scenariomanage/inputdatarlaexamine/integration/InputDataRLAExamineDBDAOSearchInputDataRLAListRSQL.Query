<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InputDataRLAExamineDBDAOSearchInputDataRLAListRSQL">
			<desc><![CDATA[Input Data Red Light Alert (EES_EQR_003) 조회]]></desc>
			<sql><![CDATA[
#if (${datatype} == 'LNK' || ${datatype} == '')    	    	
		-- LINK INFO START
		SELECT 
			A.WEEK                                        				
    	    ,A.DATATYPE                                    				
        	,A.ALERTITEM                                   				
        	,A.DIV                                        				
        	,A.FM_ECC_CD                                   				
        	,A.TO_ECC_CD                                   				
        	,A.VVD 		                                   				
        	,A.VOL_TOTAL                            					
        	,A.AMT_TOTAL	
			#foreach( ${key} in ${tpszArr}) 
				,NVL(A.VOL_$key, 0)       
        		,NVL(A.AMT_$key, 0)
			#end	   
        	--      ,A.CHECKBOX                                       			
			#foreach( ${key} in ${tpszArr}) 
				,'F' VOL_FLAG$key       
        		,'F' AMT_FLAG$key
			#end        	
        	,A.SORTNUM                                        			
        	,A.DIVNUM                                        			
        	,@[scnrPlanID] SCNR_ID                            			

    	    FROM                                              				
    	    (                                              					
        	SELECT A.WEEK                                        				
        	      ,B.DATATYPE                                                 
        	      ,A.ALERTITEM                                                
        	      ,A.DIV                                                      
		
        	--      ,A.FM_ECC_CD                                                
        	#if(${fmtoat} == '1') 
        		#if(${fmTypeBy} != '') 
        			#if(${fmTypeBy} == 'C')       
						,(SELECT CNT_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
					#end
        			#if(${fmTypeBy} == 'E')       
						,(SELECT ECC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
					#end
        			#if(${fmTypeBy} == 'L')       
						,(SELECT LCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
					#end
        			#if(${fmTypeBy} == 'R')       
						,(SELECT RCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
					#end					
        		#end
        		--      ,A.TO_ECC_CD                                                
        		#if(${toTypeBy} != '') 
        			#if(${toTypeBy} == 'C')       
						,(SELECT CNT_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD
					#end 
        			#if(${toTypeBy} == 'E')       
						,(SELECT ECC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end 
        			#if(${toTypeBy} == 'L')       
						,(SELECT LCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end 
        			#if(${toTypeBy} == 'R')       
						,(SELECT RCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD
					#end 					
        		#end		
        	#else
        		#if(${atTypeBy} != '') 
        			#if(${atTypeBy} == 'C') 
        				,(SELECT CNT_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
        				,(SELECT CNT_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end
        			#if(${atTypeBy} == 'E')
        				,(SELECT ECC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
        				,(SELECT ECC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end
        			#if(${atTypeBy} == 'L')
        				,(SELECT LCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
        				,(SELECT LCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end
        			#if(${atTypeBy} == 'R')
        				,(SELECT RCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 								
						,(SELECT RCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 								
        			#end
        		#end
        	#end	
        	      ,A.VVD                                                      
			#foreach($key IN ${tpszArr}) 
				#if($velocityCount == 1) 
					,NVL(SUM(A.VOL_$key),0)
				#else 
					+NVL(SUM(A.VOL_$key),0)
				#end 
			#end 
        		VOL_TOTAL                       									
			#foreach($key IN ${tpszArr}) 
				#if($velocityCount == 1) 
					,NVL(SUM(A.AMT_$key),0)
				#else 
					+NVL(SUM(A.AMT_$key),0)
				#end 
			#end 
        		AMT_TOTAL                       									
        	#foreach($key IN ${tpszArr}) 	
        		,SUM(A.VOL_$key)     VOL_$key       
        		,SUM(A.AMT_$key)     AMT_$key       
        	#end
        	--      ,'' CHECKBOX                                       			
        		,A.SORTNUM                                        			
        		,A.DIVNUM                                        			
        	FROM                                                              
        	(		 
		        SELECT 
					SUBSTR(A.SCNR_ID, 5, 6) WEEK                                        
					,'LNK' DATACODE                                     
		       		,B.ITEMNAME ALERTITEM   							
		          	,C.DIVNAME DIV                                      
		            ,A.FM_ECC_CD                                        
		            ,A.TO_ECC_CD                                        
		            ,'' VVD                                             
		            ,null VOL_TOTAL                                       
		            ,SUM(A.LINKAMT) AMT_TOTAL                           
		    	#foreach($key IN ${tpszArr}) 
		    		,null VOL_$key                         
		    		,SUM(DECODE(SUBSTR('$key' , 2 , 1), 2, DECODE(A.TPSIZE, 20, LINKAMT), 4, DECODE(A.TPSIZE, 40, LINKAMT), DECODE(A.TPSIZE, 45, LINKAMT))) AMT_$key   
		    	#end		    
		              ,'1' SORTNUM                                        
		              ,A.TRSP_MOD_CD DIVNUM                               
		        FROM														
		        (                                                         
		          -- BELOW 
		            SELECT 
						A.SCNR_ID                                      
		          		,A.RCC_CD                                       
		            	,A.FM_ECC_CD                                    
		            	,A.TO_ECC_CD                                    
		            	,A.ITEM                                         
		            	,B.ALT_BSE_CD DIV                               
		            	,B.TPSIZE                                       
		            	,A.AMT LINKAMT                                  
		            	,B.AMT ALERTAMT                                 
		            	,A.TRSP_MOD_CD                                  
		            FROM	                                                
		            (	                                                    
		                -- LINK INFO      
    	                SELECT 
							DISTINCT A.SCNR_ID													
                          	,A.FM_ECC_CD                                
    	                	,A.TO_ECC_CD                                
    	                	,DECODE(A.TRSP_MOD_CD, 'W','WAT','T','TRK','R','RAL')  ITEM  
    	                	,C.TPSIZE TPSIZE                            
		                	,DECODE(C.TPSIZE, 20, A.TZ_20FT_COST_AMT, 40, A.TZ_40FT_COST_AMT, 45, A.TZ_45FT_COST_AMT) AMT 
    	                	,B.RCC_CD									
    	                	,A.TRSP_MOD_CD                              
                        FROM EQR_SCNR_ECC_LNK A,                          
                             MDM_EQ_ORZ_CHT B,                            
		                     (		                                    
		                       SELECT 20 TPSIZE FROM DUAL                 
		                	   UNION                                      
		                	   SELECT 40 TPSIZE FROM DUAL                 
		                	   UNION                                      
		                	   SELECT 45 TPSIZE FROM DUAL			        
		                     ) C		                                    
                        WHERE A.FM_ECC_CD = B.ECC_CD(+)			        
                        AND   A.SCNR_ID = @[scnrPlanID]	            
		            ) A,                                                  
		            (		                                                
		                -- RED LIGHT ALERT		                        
		                SELECT 
							RCC_CD                                     
		                    ,ALT_ITM_DIV_CD ITEM            			
		                	,ALT_BSE_CD                                 
		                	,CNTR_SZ_CD TPSIZE                          
		                	,NVL(ALT_COST_AMT,0) AMT                    
		                FROM EQR_INP_DAT_RED_LGT_ALT                      
		                WHERE  
							TO_CHAR(CNTR_SZ_CD) <> 'NA'                         
		                	AND    ALT_ITM_DIV_CD IN ('WAT','TRK','RAL')      
		                	AND    ALT_BSE_CD = 'B' -- BELOW	                
		            ) B                                                   
		            WHERE 
						A.RCC_CD = B.RCC_CD                             
		            	AND   A.ITEM   = B.ITEM                               
		            	AND   A.TPSIZE = B.TPSIZE                             
		            	AND   A.AMT < B.AMT -- BELOW	                        		     		
		    
		            -- OVER                  
		            UNION                                                 
		            SELECT 
						A.SCNR_ID                                      
		            	,A.RCC_CD                                       
		            	,A.FM_ECC_CD                                    
		            	,A.TO_ECC_CD                                    
		            	,A.ITEM                                         
		            	,B.ALT_BSE_CD DIV	                            
		            	,B.TPSIZE                                       
		            	,A.AMT                                          
		            	,B.AMT                                          
    	            	,A.TRSP_MOD_CD                              
		            FROM	                                                
		            (	                                                    
		                -- LINK INFO             
    	                SELECT 
							DISTINCT A.SCNR_ID													
                          	,A.FM_ECC_CD                                
    	                	,A.TO_ECC_CD                                
    	                 	,DECODE(A.TRSP_MOD_CD, 'W','WAT','T','TRK','R','RAL')  ITEM 
    	                	,C.TPSIZE TPSIZE                            
		                	,DECODE(C.TPSIZE, 20, A.TZ_20FT_COST_AMT, 40, A.TZ_40FT_COST_AMT, 45, A.TZ_45FT_COST_AMT) AMT 
    	                	,B.RCC_CD									
    	                	,A.TRSP_MOD_CD                              
                        FROM EQR_SCNR_ECC_LNK A,                          
                             MDM_EQ_ORZ_CHT B,                            
		                     (		                                    
		                       SELECT 20 TPSIZE FROM DUAL                 
		                	   UNION                                      
		                	   SELECT 40 TPSIZE FROM DUAL                 
		                	   UNION                                      
		                	   SELECT 45 TPSIZE FROM DUAL			        
		                     ) C		                                    
                        WHERE A.FM_ECC_CD = B.ECC_CD(+)			        
                        AND   A.SCNR_ID = @[scnrPlanID]	            
		            ) A,                                                  
		            (		                                                
		                -- RED LIGHT ALERT		                        
		                SELECT 
							RCC_CD                                     
		                	,ALT_ITM_DIV_CD ITEM            			
		                	,ALT_BSE_CD                                 
		                	,CNTR_SZ_CD TPSIZE                          
		                	,NVL(ALT_COST_AMT,0) AMT                    
		                FROM EQR_INP_DAT_RED_LGT_ALT                      
		                WHERE  
							TO_CHAR(CNTR_SZ_CD) <> 'NA'                         
		                	AND    ALT_ITM_DIV_CD IN ('WAT','TRK','RAL')      
		               		AND    ALT_BSE_CD = 'O' -- BELOW	                
		            ) B                                                   
		            WHERE 
						A.RCC_CD = B.RCC_CD                             
		            	AND   A.ITEM   = B.ITEM                               
		            	AND   A.TPSIZE = B.TPSIZE                             
		            	AND   A.AMT > B.AMT -- OVER	                         				    
		        ) A,                                                      
		        (															
		            SELECT 
						INTG_CD_VAL_CTNT ITEMCODE                      
		        		,INTG_CD_VAL_DESC ITEMNAME                      
		        	FROM COM_INTG_CD_DTL                                  
		        	WHERE INTG_CD_ID = 'CD00873'                          
		        ) B,                                                      
		        (                                                         
		        	SELECT 
						INTG_CD_VAL_CTNT DIVCODE                       
		        		,INTG_CD_VAL_DP_DESC DIVNAME                    
		        	FROM COM_INTG_CD_DTL                                  
		        	WHERE INTG_CD_ID = 'CD00876'                          
		        ) C                                                       
		        WHERE A.ITEM     = B.ITEMCODE                             
		        AND   A.DIV      = C.DIVCODE	
			-- FROM TO	                        
            #if(${fmtoat} == '1')  
            	#if(${fromStatus} != '')     
					AND   A.FM_ECC_CD IN (
					#if((${fmtoat}== '1' || ${fmtoat}== '2') && (${fromStatus} != '' || ${atStatus} != '')) 
    					#foreach($key IN ${fromeccArr}) 
							#if($velocityCount < $fromeccArr.size())
								'$key',
							#else
								'$key'
							#end
    					#end
					#end
					)	
				#end	 
            	#if(${toStatus} != '')       
					AND   A.TO_ECC_CD IN (
					#if(${fmtoat}== '1' && ${toStatus} != '') 
						#foreach($key IN ${toeccArr}) 
							#if($velocityCount < $toeccArr.size())
								'$key',
							#else
								'$key'
							#end
    					#end
					#end
					)
				#end 
			-- AT		 
            #else                    
            	#if(${atStatus} != '')       
					AND   
					(
  					A.FM_ECC_CD IN (
  					#if((${fmtoat}== '1' || ${fmtoat}== '2') && (${fromStatus} != '' || ${atStatus} != '')) 
      					#foreach($key IN ${fromeccArr}) 
  							#if($velocityCount < $fromeccArr.size())
  								'$key',
  							#else
  								'$key'
  							#end
      					#end
  					#end
  					) OR A.TO_ECC_CD IN (
  					#if((${fmtoat}== '1' || ${fmtoat}== '2') && (${fromStatus} != '' || ${atStatus} != '')) 
      					#foreach($key IN ${fromeccArr}) 
  							#if($velocityCount < $fromeccArr.size())
  								'$key',
  							#else
  								'$key'
  							#end
      					#end
  					#end
  					) 
					)
				#end          	
            #end   		    
		        GROUP BY SUBSTR(A.SCNR_ID, 5, 6)                          
		                ,B.ITEMNAME           							
		                ,C.DIVNAME                                        
		                ,A.FM_ECC_CD                                      
		                ,A.TO_ECC_CD                                      
		                ,A.TRSP_MOD_CD                                    
			) A,                                                          	
			(                                                                 
			    -- INPUT DATA TYPE                                            
			    SELECT INTG_CD_VAL_CTNT DATACODE                              
			          ,INTG_CD_VAL_DESC DATATYPE                              
			    FROM COM_INTG_CD_DTL                                          
			    WHERE INTG_CD_ID = 'CD00248'                                  
			) B                                                               
			WHERE A.DATACODE = B.DATACODE                                     
			GROUP BY A.WEEK                                                   
			        ,B.DATATYPE                                               
			        ,A.ALERTITEM                                              
			        ,A.DIV                                                    
			        ,A.FM_ECC_CD                                              
			        ,A.TO_ECC_CD                                              
			        ,A.VVD                                                    
			        ,A.SORTNUM                                                
			        ,A.DIVNUM                                                 
			ORDER BY 1,2,3,4                
			) A                                                               
    		-- LINK INFO END
	         
        #end
        
        
		-- ECC INFO               
		#if(${datatype} == '') 
			UNION ALL                    					
    	#end
    	#if(${datatype} == 'ECC' || ${datatype} == '')  
    		--ECC INFO START
    	    SELECT A.WEEK                                        				
    	    	,A.DATATYPE                                    				
    	    	,A.ALERTITEM                                   				
    	    	,A.DIV                                        				
    	    	,A.FM_ECC_CD                                   				
    	    	,A.TO_ECC_CD                                   				
    	    	,A.VVD 		                                   				
    	    	,A.VOL_TOTAL                            					
    	    	,A.AMT_TOTAL   
			#foreach( ${key} in ${tpszArr}) 
				,NVL(A.VOL_$key, 0)       
        		,NVL(A.AMT_$key, 0)
			#end	

        	--      ,A.CHECKBOX                                        			
			#foreach( ${key} in ${tpszArr}) 
				,'F' VOL_FLAG$key       
        		,'F' AMT_FLAG$key
			#end 
        		,A.SORTNUM  -- HIDDEN VALUE                        			
        		,A.ITEMCODE   -- HIDDEN VALUE                                 
        		,@[scnrPlanID] SCNR_ID                            			

    	    FROM                                              				
    	    (                                              					
        	    SELECT A.WEEK                                        			
        	          ,B.DATATYPE                                             
        	          ,A.ALERTITEM                                            
        	          ,A.DIV                                                  
		
        	--      ,A.FM_ECC_CD                                                
        	#if(${fmtoat} == '1') 
        		#if(${fmTypeBy} != '') 
        			#if(${fmTypeBy} == 'C')           
						,(SELECT CNT_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
					#end
        			#if(${fmTypeBy} == 'E')           
						,(SELECT ECC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD
        			#end
        			#if(${fmTypeBy} == 'L')           
						,(SELECT LCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
        			#end
        			#if(${fmTypeBy} == 'R')           
						,(SELECT RCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 	
					#end				
        		#end
        		--      ,A.TO_ECC_CD                                                
        		#if(${toTypeBy} != '') 
        			#if(${toTypeBy} == 'C')           
						,(SELECT CNT_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
					#end
        			#if(${toTypeBy} == 'E')           
						,(SELECT ECC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end
        			#if(${toTypeBy} == 'L')           
						,(SELECT LCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end
        			#if(${toTypeBy} == 'R')           
						,(SELECT RCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 	
					#end				
        		#end		
        	#else
        		#if(${atTypeBy} != '') 
        			#if(${atTypeBy} == 'C') 
        				,(SELECT CNT_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
        				,(SELECT CNT_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end
        			#if(${atTypeBy} == 'E') 
        				,(SELECT ECC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
        				,(SELECT ECC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end
        			#if(${atTypeBy} == 'L') 
        				,(SELECT LCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
        				,(SELECT LCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end
        			#if(${atTypeBy} == 'R') 
        				,(SELECT RCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 								
						,(SELECT RCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 								
        			#end
        		#end
        	#end	
        	        	,A.VVD                                                      
			#foreach($key IN ${tpszArr}) 
				#if($velocityCount == 1) 
					,NVL(SUM(A.VOL_$key),0)
				#else 
					+NVL(SUM(A.VOL_$key),0)
				#end 
			#end 
        		VOL_TOTAL                        									
			#foreach($key IN ${tpszArr}) 
				#if($velocityCount == 1) 
					,NVL(SUM(A.AMT_$key),0)
				#else 
					+NVL(SUM(A.AMT_$key),0)
				#end 
			#end 
        	 	AMT_TOTAL                       									
        
        	#foreach($key IN ${tpszArr})		
        		,SUM(A.VOL_$key)     VOL_$key   
        		,SUM(A.AMT_$key)     AMT_$key   
        	#end
        	--          ,'' CHECKBOX    			                    		
        		,A.SORTNUM     -- HIDDEN VALUE                          
        		,A.ITEMCODE      -- HIDDEN VALUE                          

        	FROM                                                          
        	    (		                                                            		  		   	    
            	SELECT SUBSTR(A.SCNR_ID, 5, 6) WEEK                       
                	,'ECC' DATATYPE                                     
                	,B.ITEMNAME ALERTITEM                               
                 	,C.DIVNAME DIV                                      
                  	,A.FM_ECC_CD                                        
                 	,A.TO_ECC_CD                                        
                 	,'' VVD                                             
                	,null VOL_TOTAL                                     
                 	,SUM(A.LINKAMT) AMT_TOTAL                           
            	#foreach($key IN ${tpszArr})
            		,null VOL_$key                        
            	    ,SUM(DECODE(SUBSTR('$key' , 2 , 1), 2, DECODE(A.TPSIZE, 20, LINKAMT), 4, DECODE(A.TPSIZE, 40, LINKAMT), DECODE(A.TPSIZE, 45, LINKAMT))) AMT_$key 
        		#end
		          	,'2' SORTNUM                                        
                 	,B.ITEMCODE                                         
                FROM                                 						
                (	                                                        
                        ------- BELOW --------------------------------------- 
                	SELECT 
						A.SCNR_ID                                      
                    	,A.RCC_CD                                       
                    	,A.ECC_CD FM_ECC_CD		                        
                      	,''       TO_ECC_CD                             
                    	,A.ITEMCODE                                     
                    	,B.ALT_BSE_CD DIV                               
                    	,B.TPSIZE                                       
                     	,A.AMT LINKAMT                                  
                       	,B.AMT ALERTAMT	                                
                	FROM                                                  
                    (                                                     
                	          -- Storage Cost, Steve Dorage, Handling Cost, Shuttling Cost -----    
                        SELECT 
							A.SCNR_ID                                   
                        	,A.ECC_CD                                   
                        	,B.ITEMCODE                                   
                        	,B.ITEMNAME                                   
                        	,A.TPSIZE              
                        	,DECODE(A.TPSIZE, 20, DECODE(B.ITEMCODE, 'STD', A.STV_20FT_COST_AMT,  
            			                                                 'STR', A.STO_20FT_COST_AMT,  
            			    	  									     'HND', A.HNDL_20FT_COST_AMT, 
            			    	  									     'SHT', A.STTL_20FT_COST_AMT  
            			    	  						  ),                                          
                	                              40, DECODE(B.ITEMCODE, 'STD', A.STV_40FT_COST_AMT,  
            			    	  			                             'STR', A.STO_40FT_COST_AMT,  
            			    	  									     'HND', A.HNDL_40FT_COST_AMT, 
            			    	  									     'SHT', A.STTL_40FT_COST_AMT  
            			    	  					      ),								          
                		          			      45, DECODE(B.ITEMCODE, 'STD', A.STV_45FT_COST_AMT,  
            			    	  			                             'STR', A.STO_45FT_COST_AMT,  
            			    	  				  					     'HND', A.HNDL_45FT_COST_AMT, 
            			    	  				  					     'SHT', A.STTL_45FT_COST_AMT  
                			    	  						  )                 
                			 ) AMT	                                    
                    	    ,A.RCC_CD					 	            
                		FROM                                                
                		(				                                    
                			SELECT 
								A.SCNR_ID                                
                		     	,A.ECC_CD                                 
                		      	,B.TPSIZE                                 
                		     	,A.STV_20FT_COST_AMT                      
                		      	,A.STV_40FT_COST_AMT                      
                		      	,A.STV_45FT_COST_AMT		                
                		      	,A.STO_20FT_COST_AMT			  	  		 
                		    	,A.STO_40FT_COST_AMT			  	  		 
                		      	,A.STO_45FT_COST_AMT	                    
                		      	,A.HNDL_20FT_COST_AMT			  		  			  
                		     	,A.HNDL_40FT_COST_AMT			  		  			  
                		      	,A.HNDL_45FT_COST_AMT		                
                		       	,A.STTL_20FT_COST_AMT	  		  	  		  
                		      	,A.STTL_40FT_COST_AMT	  		  	  		  
                		      	,A.STTL_45FT_COST_AMT	  		  	  		  
                		      	,A.RCC_CD                                 
                			FROM EQR_SCNR_ECC A,                            
                		    	(		                                    
                		         SELECT 20 TPSIZE FROM DUAL             
                		         UNION                                  
                		         SELECT 40 TPSIZE FROM DUAL             
                		         UNION                                  
                		         SELECT 45 TPSIZE FROM DUAL			    
                		        ) B					 			        
                		) A,                                                
                		(                                                   
                		 SELECT 
							INTG_CD_VAL_CTNT ITEMCODE                
                		    ,INTG_CD_VAL_DESC ITEMNAME                
                		 FROM COM_INTG_CD_DTL                            
                         WHERE 
							INTG_CD_ID = 'CD00873'                  
                		  	AND INTG_CD_VAL_CTNT IN ('STD', 'STR', 'HND', 'SHT')
                		) B                                                  
                		WHERE A.SCNR_ID = @[scnrPlanID]       
                        UNION                                             
                		      -- TRANSHIPMENT COST -------------------			
                		      SELECT A.SCNR_ID                                    
                		            ,A.ECC_CD                                     
                		      	    ,'TRS'  ITEMCODE                              
                		      	    ,'Transhipment Cost' ITEMNAME                 
                		      	    ,B.TPSIZE                                     
                		      	    ,ROUND(AVG(DECODE(B.TPSIZE, 20, A.TS_20FT_UC_AMT, 40, A.TS_40FT_UC_AMT, 45, A.TS_45FT_UC_AMT)),2) AMT  
                		      	    ,C.RCC_CD										
                		      FROM EQR_SCNR_TS_TML A,                             
                		      (		                                        
                		          SELECT 20 TPSIZE FROM DUAL                 
                			      UNION                                      
                			      SELECT 40 TPSIZE FROM DUAL                 
                			      UNION                                      
                			      SELECT 45 TPSIZE FROM DUAL			        
                		      ) B,                                           
                			  MDM_EQ_ORZ_CHT C                               
                		      WHERE A.SCNR_ID = @[scnrPlanID]	                
                		      AND   A.ECC_CD = C.ECC_CD                           
                		      GROUP BY A.SCNR_ID                                  
                		              ,A.ECC_CD	                                
                		      		  ,B.TPSIZE	                                
                		      		  ,C.RCC_CD                                   
                        ) A,                                                    
                	      (								                        
                              -- RED LIGHT ALERT		                        
                              SELECT RCC_CD                                     
                                    ,ALT_ITM_DIV_CD ITEMCODE                    
                              	  ,ALT_BSE_CD                                 
                              	  ,CNTR_SZ_CD TPSIZE                          
                              	  ,NVL(ALT_COST_AMT,0) AMT                    
                              FROM EQR_INP_DAT_RED_LGT_ALT                      
                              WHERE  TO_CHAR(CNTR_SZ_CD) <> 'NA'                         
                              AND    ALT_ITM_DIV_CD IN ('TRS','STD','STR','HND','SHT') 
                              AND    ALT_BSE_CD = 'B' -- BELOW		            
                	      ) B                                                     
                        WHERE A.RCC_CD  = B.RCC_CD                            
                        AND   A.ITEMCODE= B.ITEMCODE                          
                        AND   A.TPSIZE  = B.TPSIZE                            
                        AND   A.AMT < B.AMT -- BELOW                          
            
                        -- OVER
                	      UNION	                                                
                        SELECT A.SCNR_ID                                      
                              ,A.RCC_CD                                       
                        	    ,A.ECC_CD FM_ECC_CD		                        
                        	    ,''       TO_ECC_CD                             
                        	    ,A.ITEMCODE                                     
                        	    ,B.ALT_BSE_CD DIV                               
                        	    ,B.TPSIZE                                       
                        	    ,A.AMT LINKAMT                                  
                        	    ,B.AMT ALERTAMT	                                
                	      FROM                                                    
                        (                                                     
                	          -- Storage Cost, Steve Dorage, Handling Cost, Shuttling Cost
                            SELECT A.SCNR_ID                                  
                                  ,A.ECC_CD                                   
                    	            ,B.ITEMCODE                                 
                    	            ,B.ITEMNAME                                 
                    	            ,A.TPSIZE                                   
                    	            ,DECODE(A.TPSIZE, 20, DECODE(B.ITEMCODE, 'STD', A.STV_20FT_COST_AMT,   
                		    	                                             'STR', A.STO_20FT_COST_AMT,  
                		    											     'HND', A.HNDL_20FT_COST_AMT, 
                		    											     'SHT', A.STTL_20FT_COST_AMT  
                		    						  		  ),                                          
                    	                              40, DECODE(B.ITEMCODE, 'STD', A.STV_40FT_COST_AMT,  
                		    					                             'STR', A.STO_40FT_COST_AMT,  
                		    						  					     'HND', A.HNDL_40FT_COST_AMT, 
                		    						  					     'SHT', A.STTL_40FT_COST_AMT  
                		    						  	      ),								          
                    	    	    			      45, DECODE(B.ITEMCODE, 'STD', A.STV_45FT_COST_AMT,  
                		    					                             'STR', A.STO_45FT_COST_AMT,  
                		    						  					     'HND', A.HNDL_45FT_COST_AMT, 
                		    						  					     'SHT', A.STTL_45FT_COST_AMT  
                		    						  		  )                 
                		    	     ) AMT	                                    
                    	            ,A.RCC_CD					 	            
                		      FROM                                                
                		      (				                                    
                		          SELECT A.SCNR_ID                                
                		                ,A.ECC_CD                                 
                		          	    ,B.TPSIZE                                 
                		          	    ,A.STV_20FT_COST_AMT                      
                		          	    ,A.STV_40FT_COST_AMT                      
                		          	    ,A.STV_45FT_COST_AMT		                
                		          	    ,A.STO_20FT_COST_AMT			  	  		 
                		          	    ,A.STO_40FT_COST_AMT			  	  		
                		          	    ,A.STO_45FT_COST_AMT	                	
                		          	    ,A.HNDL_20FT_COST_AMT			  		 	
                		          	    ,A.HNDL_40FT_COST_AMT			  		  			  
                		          	    ,A.HNDL_45FT_COST_AMT		                
                		          	    ,A.STTL_20FT_COST_AMT	  		  	  		  
                		          	    ,A.STTL_40FT_COST_AMT	  		  	  		
                		          	    ,A.STTL_45FT_COST_AMT	  		  	  		 
                		          	    ,A.RCC_CD                                 
                		          FROM EQR_SCNR_ECC A,                            
                		               (		                                    
                		                 SELECT 20 TPSIZE FROM DUAL             
                		          	     UNION                                  
                		          	     SELECT 40 TPSIZE FROM DUAL             
                		          	     UNION                                  
                		          	     SELECT 45 TPSIZE FROM DUAL			    
                		               ) B					 			        
                		      ) A,                                                
                		      (                                                   
                		          SELECT INTG_CD_VAL_CTNT ITEMCODE                
                		      	        ,INTG_CD_VAL_DESC ITEMNAME                
                		      	  FROM COM_INTG_CD_DTL                            
                                WHERE INTG_CD_ID = 'CD00873'                  
                		      	  AND INTG_CD_VAL_CTNT IN ('STD', 'STR', 'HND', 'SHT')
                		      ) B                                                 
                		      WHERE A.SCNR_ID = @[scnrPlanID]			        
                            UNION                                             
                		      -- TRANSHIPMENT COST		
                		      SELECT A.SCNR_ID                                    
                		            ,A.ECC_CD                                     
                		      	    ,'TRS'  ITEMCODE                              
                		      	    ,'Transhipment Cost' ITEMNAME                 
                		      	    ,B.TPSIZE                                     
                		      	    ,ROUND(AVG(DECODE(B.TPSIZE, 20, A.TS_20FT_UC_AMT, 40, A.TS_40FT_UC_AMT, 45, A.TS_45FT_UC_AMT)),2) AMT 
                		      	    ,C.RCC_CD                                     
                		      FROM EQR_SCNR_TS_TML A,                             
                		           (		                                        
                		               SELECT 20 TPSIZE FROM DUAL                 
                		      	       UNION                                      
                		      	       SELECT 40 TPSIZE FROM DUAL                 
                		      	       UNION                                      
                		      	       SELECT 45 TPSIZE FROM DUAL			        
                		           ) B,                                           
                		      	 MDM_EQ_ORZ_CHT C                               
                		      WHERE A.SCNR_ID = @[scnrPlanID]               
                		      AND   A.ECC_CD = C.ECC_CD                           
                		      GROUP BY A.SCNR_ID                                  
                		              ,A.ECC_CD	                                
                		      		  ,B.TPSIZE	                                
                		      		  ,C.RCC_CD                                   
                        ) A,                                                  
                	      (								                        
                            -- RED LIGHT ALERT		                        
                            SELECT RCC_CD                                     
                                  ,ALT_ITM_DIV_CD ITEMCODE                    
                            	    ,ALT_BSE_CD                                 
                            	    ,CNTR_SZ_CD TPSIZE                          
                            	    ,NVL(ALT_COST_AMT,0) AMT                    
                            FROM EQR_INP_DAT_RED_LGT_ALT                      
                            WHERE  TO_CHAR(CNTR_SZ_CD) <> 'NA'                         
                            AND    ALT_ITM_DIV_CD IN ('TRS','STD','STR','HND','SHT')    
                            AND    ALT_BSE_CD = 'O' -- BELOW		            
                	      ) B                                                   
                        WHERE A.RCC_CD  = B.RCC_CD                            
                        AND   A.ITEMCODE= B.ITEMCODE                          
                        AND   A.TPSIZE  = B.TPSIZE                            
                        AND   A.AMT > B.AMT -- OVER	                                          
                    ) A,                                                      
                   (                                                         
                       SELECT INTG_CD_VAL_CTNT ITEMCODE                      
                   		   ,INTG_CD_VAL_DESC ITEMNAME                        
                   	 FROM COM_INTG_CD_DTL                                  
                       WHERE INTG_CD_ID = 'CD00873'                          
                   ) B,                                                      
                   (                                                         
                       SELECT INTG_CD_VAL_CTNT DIVCODE                       
                   		   ,INTG_CD_VAL_DP_DESC DIVNAME                      
                   	 FROM COM_INTG_CD_DTL                                  
                       WHERE INTG_CD_ID = 'CD00876'                          
                   ) C                                                       
                   WHERE A.ITEMCODE = B.ITEMCODE                             
                   AND   A.DIV      = C.DIVCODE 
			-- FROM TO                             
            #if(${fmtoat} == '1')  
            	#if(${fromStatus} != '')       
					 AND   A.FM_ECC_CD IN (
					#if((${fmtoat}== '1' || ${fmtoat}== '2') && (${fromStatus} != '' || ${atStatus} != '')) 
    					#foreach($key IN ${fromeccArr}) 
							#if($velocityCount < $fromeccArr.size())
								'$key',
							#else
								'$key'
							#end
    					#end
					#end
					)		
				#end	 
            	#if(${toStatus} != '')          
					AND   A.TO_ECC_CD IN (
					#if(${fmtoat}== '1' && ${toStatus} != '') 
						#foreach($key IN ${toeccArr}) 
							#if($velocityCount < $toeccArr.size())
								'$key',
							#else
								'$key'
							#end
    					#end
					#end
					)
				#end  		     
            #else                    
			-- AT
            	#if(${atStatus} != '')          
				AND   
				(					
					A.FM_ECC_CD IN (
					#if((${fmtoat}== '1' || ${fmtoat}== '2') && (${fromStatus} != '' || ${atStatus} != '')) 
    					#foreach($key IN ${fromeccArr}) 
							#if($velocityCount < $fromeccArr.size())
								'$key',
							#else
								'$key'
							#end
    					#end
					#end
					) OR A.TO_ECC_CD IN (
					#if((${fmtoat}== '1' || ${fmtoat}== '2') && (${fromStatus} != '' || ${atStatus} != '')) 
    					#foreach($key IN ${fromeccArr}) 
							#if($velocityCount < $fromeccArr.size())
								'$key',
							#else
								'$key'
							#end
    					#end
					#end
					)
				) 
				#end          	
            #end               
                   GROUP BY SUBSTR(A.SCNR_ID, 5, 6)                          
                           ,B.ITEMNAME                                       
                           ,C.DIVNAME                                        
                           ,A.FM_ECC_CD                                      
                           ,A.TO_ECC_CD                                      
                           ,B.ITEMCODE                                       
                   --ORDER BY 3,4,5,6                                        		
			    ) A,                                                         
			    (                                                            
			        -- INPUT DATA TYPE                                       
			        SELECT INTG_CD_VAL_CTNT DATACODE                         
			              ,INTG_CD_VAL_DESC DATATYPE                         
			        FROM COM_INTG_CD_DTL                                     
			        WHERE INTG_CD_ID = 'CD00248'                             
			    ) B                                                          
			    WHERE A.DATATYPE = B.DATACODE                                
			    GROUP BY A.WEEK                                              
			            ,B.DATATYPE                                          
			            ,A.ALERTITEM                                         
			            ,A.DIV                                               
			            ,A.FM_ECC_CD                                         
			            ,A.TO_ECC_CD                                         
			            ,A.VVD                                               
			            ,A.SORTNUM                                           
			            ,A.ITEMCODE                                          
			    ORDER BY 1,2,3,4                							   
			) A                                                              
			--------------- ECC INFO END ------------------------------      	                                               
    	#end

		-- ----------- VESSEL SKD ---------------------------------------------------------	
		#if(${datatype} == '') 
			UNION ALL                       			
    	#end
		#if(${datatype} == 'VSK' || ${datatype} == '')    		   	    	
			---------------- VESSEL SKD START ------------------------------    	
    	    SELECT A.WEEK                                        				
    	    	,A.DATATYPE                                    				
    	    	,A.ALERTITEM                                   				
    	    	,A.DIV                                        				
    	    	,A.FM_ECC_CD                                   				
    	    	,A.TO_ECC_CD                                   				
    	    	,A.VVD 		                                   				
    	    	,A.VOL_TOTAL                            					
    	    	,A.AMT_TOTAL     
			#foreach( ${key} in ${tpszArr}) 
				,A.VOL_$key       
        		,A.AMT_$key
			#end	 

        	--      ,A.CHECKBOX                                        			
			#foreach( ${key} in ${tpszArr}) 
				,'F' VOL_FLAG$key       
        		,'F' AMT_FLAG$key
			#end    
        		,A.SORTNUM                                        			
        		,A.DIVNUM                                        			
        		,@[scnrPlanID] SCNR_ID                            			

    	    FROM                                              				
    	    (                                              					
        	SELECT A.WEEK                                        				
        	      ,B.DATATYPE                                                 
        	      ,A.ALERTITEM                                                
        	      ,A.DIV                                                      
		
        	--      ,A.FM_ECC_CD                                                
        	#if(${fmtoat} == '1') 
        		#if(${fmTypeBy} != '')
        			#if(${fmTypeBy} == 'C')       
						,(SELECT CNT_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
					#end
        			#if(${fmTypeBy} == 'E')       
						,(SELECT ECC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
        			#end
        			#if(${fmTypeBy} == 'L')       
						,(SELECT LCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
        			#end
        			#if(${fmTypeBy} == 'R')       
						,(SELECT RCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 	
					#end				
        		#end
        		--      ,A.TO_ECC_CD                                                
        		#if(${toTypeBy} != '') 
        			#if(${toTypeBy} == 'C')       
						,(SELECT CNT_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
					#end
        			#if(${toTypeBy} == 'E')       
						,(SELECT ECC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end
        			#if(${toTypeBy} == 'L')       
						,(SELECT LCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end
        			#if(${toTypeBy} == 'R')       
						,(SELECT RCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
					#end					
        		#end		
        	#else
        		#if(${atTypeBy} != '')
        			#if(${atTypeBy} == 'C') 
        				,(SELECT CNT_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
        				,(SELECT CNT_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end
        			#if(${atTypeBy} == 'E')
        				,(SELECT ECC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
        				,(SELECT ECC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end
        			#if(${atTypeBy} == 'L')
        				,(SELECT LCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
        				,(SELECT LCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end
        			#if(${atTypeBy} == 'R')
        				,(SELECT RCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 								
						,(SELECT RCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 								
        			#end
        		#end
        	#end	
        	      ,A.VVD                                                       
			#foreach($key IN ${tpszArr}) 
				#if($velocityCount == 1) 
					,NVL(SUM(A.VOL_$key),0)
				#else 
					+NVL(SUM(A.VOL_$key),0)
				#end 
			#end 
        		VOL_TOTAL                       									
			#foreach($key IN ${tpszArr}) 
				#if($velocityCount == 1) 
					,NVL(SUM(A.AMT_$key),0)
				#else 
					+NVL(SUM(A.AMT_$key),0)
				#end 
			#end 
        		AMT_TOTAL                       									
        
        	#foreach($key IN ${tpszArr}) 	
        		      ,SUM(A.VOL_$key)     VOL_$key
        		      ,SUM(A.AMT_$key)     AMT_$key
        	#end
        	--      ,'' CHECKBOX                                       			
        	      ,A.SORTNUM                                        			
        	      ,A.DIVNUM                                        			

        	FROM                                                              
        	(		                                                            
            	SELECT 
					A.WEEK                                             
                  	,A.DATACODE                                         
                  	,A.ALERTITEM                                        
                	,A.DIV                                              
                 	,A.FM_ECC_CD                                        
                  	,A.TO_ECC_CD                                        
                  	,A.VVD                                              
                 	,null VOL_TOTAL                                       
                  	,null AMT_TOTAL                                       
            #foreach($key IN ${tpszArr})
            	  	,null VOL_$key                          
            	   	,null AMT_$key                          
        	#end
		        	,'3' SORTNUM                                        
        	     	,'' DIVNUM                                           
                FROM 														
                (                                                         
                    ------------  LANE NEW (B-A) ------------------------- 
                    SELECT DISTINCT SUBSTR(@[scnrPlanID],5 , 6) WEEK   
                    	,'VSK'    DATACODE                              
                    	,'Lane'   ALERTITEM                             
                    	,'new'    DIV                                   
                    	,''       FM_ECC_CD                             
                    	,''       TO_ECC_CD                             
                    	,VSL      VVD       							
                    FROM                                                  
                    (                                                     
                        SELECT DISTINCT VSL_CD||SKD_VOY_NO||SKD_DIR_CD VSL
                        FROM VSK_VSL_PORT_SKD                        		
            -- CSR NO. N200903060123 Split 01-EQR sked 기준 변경
--					  	  WHERE  VPS_ETA_DT BETWEEN (                                        	        
            		  	  WHERE  VPS_ETB_DT BETWEEN (                                        	
													    SELECT TO_DATE(WK_ST_DT,'YYYYMMDD')    	
													    FROM EQR_WK_PRD                        	
													    WHERE PLN_YR||PLN_WK = @[fromWeek]  	
												    )                                     		
						                    AND     (                                       	
						                                SELECT TO_DATE(WK_END_DT,'YYYYMMDD')   	
						                                FROM EQR_WK_PRD                        	
						                                WHERE PLN_YR||PLN_WK = @[toWeek]   	
						                            )                                        	
            		  	  --AND CLPT_IND_SEQ ='1'                      		            
                        MINUS                                        		
                    	  SELECT DISTINCT VSL_CD||SKD_VOY_NO||SKD_DIR_CD VSL
                        FROM EQR_SCNR_VSL_SKD                        		
                        WHERE SCNR_ID = @[scnrPlanID]          	
                        --AND   VSL_CALL_IND_CD = '1'                     		                	 
            -- CSR NO. N200903060123 Split 01-EQR sked 기준 변경
--					  	  AND   VSL_ETA_DT BETWEEN (                                        	        
            		  	  AND   VSL_ETB_DT BETWEEN (                                        	
													    SELECT TO_DATE(WK_ST_DT,'YYYYMMDD')    	
													    FROM EQR_WK_PRD                        	
													    WHERE PLN_YR||PLN_WK = @[fromWeek]
												    )                                     		
						                    AND     (                                       	
						                                SELECT TO_DATE(WK_END_DT,'YYYYMMDD')   	
						                                FROM EQR_WK_PRD                        	
						                                WHERE PLN_YR||PLN_WK = @[toWeek] 	
						                            )                                        	
                    )                                               		
                    UNION                                                 
                    ------------  LANE SKIP (A-B) ----------------------- 
                    SELECT DISTINCT SUBSTR(@[scnrPlanID],5 , 6) WEEK 
                    	,'VSK'    DATACODE                              
                    	,'Lane'   ALERTITEM                             
                    	,'new'    DIV                                   
                    	,''       FM_ECC_CD                             
                    	,''       TO_ECC_CD	                            
                    	,VSL      VVD       							
                    FROM                                                  
                    (                                                     
                    	SELECT DISTINCT VSL_CD||SKD_VOY_NO||SKD_DIR_CD VSL
                        FROM EQR_SCNR_VSL_SKD                        		
                        WHERE SCNR_ID = @[scnrPlanID]	            	
                        --AND   VSL_CALL_IND_CD = '1'                     		                	 
            -- CSR NO. N200903060123 Split 01-EQR sked 기준 변경
--					  	  AND   VSL_ETA_DT BETWEEN (                                        	        
            		  	  AND   VSL_ETB_DT BETWEEN (                                        	
													    SELECT TO_DATE(WK_ST_DT,'YYYYMMDD')    	
													    FROM EQR_WK_PRD                        	
													    WHERE PLN_YR||PLN_WK = @[fromWeek]  	
												    )                                     		
						                    AND     (                                       	
						                                SELECT TO_DATE(WK_END_DT,'YYYYMMDD')   	
						                                FROM EQR_WK_PRD                        	
						                                WHERE PLN_YR||PLN_WK = @[toWeek]    	
						                            )                                        	
                        MINUS                                        		
                        SELECT DISTINCT VSL_CD||SKD_VOY_NO||SKD_DIR_CD VSL
                        FROM VSK_VSL_PORT_SKD                        		
            -- CSR NO. N200903060123 Split 01-EQR sked 기준 변경
--					  	  WHERE  VPS_ETA_DT BETWEEN (                                        	        
            		  	  WHERE  VPS_ETB_DT BETWEEN (                                        	
													    SELECT TO_DATE(WK_ST_DT,'YYYYMMDD')    	
													    FROM EQR_WK_PRD                        	
													    WHERE PLN_YR||PLN_WK = @[fromWeek] 	
												    )                                     		
						                    AND     (                                       	
						                                SELECT TO_DATE(WK_END_DT,'YYYYMMDD')   	
						                                FROM EQR_WK_PRD                        	
						                                WHERE PLN_YR||PLN_WK = @[toWeek]    	
						                            )                                        	
            		  	  --AND CLPT_IND_SEQ ='1'                      		            
                    )                                               		
                    UNION	                                                
                    ------------  PORT ADD(B-A) -------------------------             
                    SELECT DISTINCT SUBSTR(@[scnrPlanID],5 , 6) WEEK                   
                    	,'VSK'    DATACODE                              
                    	,'Port'   ALERTITEM                             
                    	,'add'    DIV                                   
                   		,PORT     FM_ECC_CD                             
                    	,''       TO_ECC_CD                             
                    	,VVD                                            
                    FROM                                                  
                    (                                                     
                        SELECT VS.VSL_CD||VS.SKD_VOY_NO||VS.SKD_DIR_CD  VVD 
                              ,VS.VPS_PORT_CD  PORT                       
                        FROM VSK_VSL_PORT_SKD VS                          
                        WHERE (VSL_CD, SKD_VOY_NO, SKD_DIR_CD) IN         
                                         (                                                                            
                                            SELECT /*+ XAK1VSK_VSL_PORT_SKD */                                        
                                                   DISTINCT A.VSL_CD,A.SKD_VOY_NO,A.SKD_DIR_CD VVD                    
                                            FROM VSK_VSL_PORT_SKD A                                                   
            -- CSR NO. N200903060123 Split 01-EQR sked 기준 변경
--                                            WHERE  A.VPS_ETA_DT BETWEEN (                                             
                                            WHERE  A.VPS_ETB_DT BETWEEN (                                             
                                                                         SELECT TO_DATE(WK_ST_DT,'YYYYMMDD')    	    
                                										   FROM EQR_WK_PRD                        	    
                                										   WHERE PLN_YR||PLN_WK = @[fromWeek]  	    
                               										  )                                     	    
                             									AND       (                                       	    
                                      								   SELECT TO_DATE(WK_END_DT,'YYYYMMDD')   	    
                                      								   FROM EQR_WK_PRD                        	    
                                      								   WHERE PLN_YR||PLN_WK = @[toWeek]	    
                                     									  ) 								            
                            		 		  --AND A.CLPT_IND_SEQ ='1'	                                                
                                            AND NVL(SKD_CNG_STS_CD,'N') <> 'S'        		 						    
                            				  INTERSECT	        		 							                    
                                            SELECT DISTINCT A.VSL_CD                                                  
                                                  ,A.SKD_VOY_NO                                                       
                                                  ,A.SKD_DIR_CD VVD                                                   
                                            FROM EQR_SCNR_VSL_SKD A                                                   
                                            WHERE A.SCNR_ID = @[scnrPlanID]	 		                        
                                            --AND   A.VSL_CALL_IND_CD = '1'                                              
            -- CSR NO. N200903060123 Split 01-EQR sked 기준 변경
--                                            AND  A.VSL_ETA_DT BETWEEN (                                              
                                            AND  A.VSL_ETB_DT BETWEEN (                                              
                                                                        SELECT TO_DATE(WK_ST_DT,'YYYYMMDD')    	    
                                                                        FROM EQR_WK_PRD                        	    
                                                                        WHERE PLN_YR||PLN_WK = @[fromWeek]  	    
                                                                       )                                     	        
                                                               AND     (                                       	    
                                                                        SELECT TO_DATE(WK_END_DT,'YYYYMMDD')   	    
                                                                        FROM EQR_WK_PRD                        	    
                                                                        WHERE PLN_YR||PLN_WK = @[toWeek]    	    
                                                                       ) 								                                        
                                        )                                                                             
            -- CSR NO. N200903060123 Split 01-EQR sked 기준 변경
--                        AND  VS.VPS_ETA_DT BETWEEN (                                                                  
                        AND  VS.VPS_ETB_DT BETWEEN (                                                                  
                                                    SELECT TO_DATE(WK_ST_DT,'YYYYMMDD')    	                        
                                                    FROM EQR_WK_PRD                        	                        
                                                    WHERE PLN_YR||PLN_WK = @[fromWeek]	                        
                                                   )                                     	                            
                                           AND     (                                       	                        
                                                    SELECT TO_DATE(WK_END_DT,'YYYYMMDD')   	                        
                                                    FROM EQR_WK_PRD                        	                        
                                                    WHERE PLN_YR||PLN_WK = @[toWeek] 	                        
                                                   ) 								                                    
                        --AND VS.CLPT_IND_SEQ ='1'	                                                                    
                        AND NVL(VS.SKD_CNG_STS_CD,'N') <> 'S'  -- port skip                                               
                        MINUS                                                                                         
                        SELECT ES.VSL_CD||ES.SKD_VOY_NO||ES.SKD_DIR_CD VVD                                            
                             , ES.VSL_LOC_CD PORT                                                                     
                        FROM EQR_SCNR_VSL_SKD ES                                                                      
                        WHERE (VSL_CD, SKD_VOY_NO, SKD_DIR_CD) IN                                                     
                                         (                                                                            
                                             SELECT /*+ XAK1VSK_VSL_PORT_SKD */                                       
                                                    DISTINCT A.VSL_CD                                                 
                                                    ,A.SKD_VOY_NO                                                     
                                                    ,A.SKD_DIR_CD VVD                                                 
                                             FROM VSK_VSL_PORT_SKD A                                                  
            -- CSR NO. N200903060123 Split 01-EQR sked 기준 변경
--                                             WHERE  A.VPS_ETA_DT BETWEEN (                                            
                                             WHERE  A.VPS_ETB_DT BETWEEN (                                            
                                                                          SELECT TO_DATE(WK_ST_DT,'YYYYMMDD')    	    
                                                                          FROM EQR_WK_PRD                        	    
                                                                          WHERE PLN_YR||PLN_WK = @[fromWeek]	    
                                                                         )                                     	    
                                                                 AND     (                                       	    
                                                                          SELECT TO_DATE(WK_END_DT,'YYYYMMDD')   	    
                                                                          FROM EQR_WK_PRD                        	    
                                                                          WHERE PLN_YR||PLN_WK = @[toWeek]    	    
                                                                         ) 								            
                            		           --AND A.CLPT_IND_SEQ ='1'	                                                
                                             AND NVL(SKD_CNG_STS_CD,'N') <> 'S'        		 						    
                                             INTERSECT	        		 							                
                                             SELECT DISTINCT A.VSL_CD,A.SKD_VOY_NO                                    
                                                    ,A.SKD_DIR_CD VVD                                                 
                                             FROM EQR_SCNR_VSL_SKD A                                                  
                                             WHERE A.SCNR_ID = @[scnrPlanID]		 		                        
                                             --AND   A.VSL_CALL_IND_CD = '1'                                               
            -- CSR NO. N200903060123 Split 01-EQR sked 기준 변경
--                                             AND  A.VSL_ETA_DT BETWEEN (                                              
                                             AND  A.VSL_ETB_DT BETWEEN (                                              
                                                                        SELECT TO_DATE(WK_ST_DT,'YYYYMMDD')    	    
                                                                        FROM EQR_WK_PRD                        	    
                                                                        WHERE PLN_YR||PLN_WK = @[fromWeek]  	    
                                                                       )                                     	        
                                                               AND     (                                       	    
                                                                        SELECT TO_DATE(WK_END_DT,'YYYYMMDD')   	    
                                                                        FROM EQR_WK_PRD                        	    
                                                                        WHERE PLN_YR||PLN_WK = @[toWeek]    	    
                                                                       ) 								                                        
                                         )                                                                            
                        AND ES.SCNR_ID = @[scnrPlanID]		 		                                                
                        --AND ES.VSL_CALL_IND_CD = '1'                                                                     
            -- CSR NO. N200903060123 Split 01-EQR sked 기준 변경
--                        AND  ES.VSL_ETA_DT BETWEEN (                                                                  
                        AND  ES.VSL_ETB_DT BETWEEN (                                                                  
                                                    SELECT TO_DATE(WK_ST_DT,'YYYYMMDD')    	                        
                                                    FROM EQR_WK_PRD                        	                        
                                                    WHERE PLN_YR||PLN_WK = @[fromWeek]  	                        
                                                   )                                     	                            
                                           AND     (                                       	                        
                                                    SELECT TO_DATE(WK_END_DT,'YYYYMMDD')   	                        
                                                    FROM EQR_WK_PRD                        	                        
                                                    WHERE PLN_YR||PLN_WK = @[toWeek]    	                        
                                                   ) 								                                                
                    )                                                     
                    UNION                                                 
                    ------------  PORT SKIP(A-B) ----------------------   
                    SELECT DISTINCT SUBSTR(@[scnrPlanID],5 , 6) WEEK                   
                    	,'VSK'    DATACODE                              
                   		,'Port'   ALERTITEM                             
                     	,'skip'   DIV                                   
                    	,PORT     FM_ECC_CD                             
                    	,''       TO_ECC_CD                             
                    	,VVD                                            
                    FROM                                                  
                    (                                                     
                        SELECT ES.VSL_CD||ES.SKD_VOY_NO||ES.SKD_DIR_CD VVD                                            
                             , ES.VSL_LOC_CD PORT                                                                     
                        FROM EQR_SCNR_VSL_SKD ES                                                                      
                        WHERE (VSL_CD, SKD_VOY_NO, SKD_DIR_CD) IN                                                     
                                         (                                                                            
                                             SELECT /*+ XAK1VSK_VSL_PORT_SKD */                                       
                                                    DISTINCT A.VSL_CD                                                 
                                                    ,A.SKD_VOY_NO                                                     
                                                    ,A.SKD_DIR_CD VVD                                                 
                                             FROM VSK_VSL_PORT_SKD A                                                  
            -- CSR NO. N200903060123 Split 01-EQR sked 기준 변경
--                                             WHERE  A.VPS_ETA_DT BETWEEN (                                            
                                             WHERE  A.VPS_ETB_DT BETWEEN (                                            
                                                                          SELECT TO_DATE(WK_ST_DT,'YYYYMMDD')    	    
                                                                          FROM EQR_WK_PRD                        	    
                                                                          WHERE PLN_YR||PLN_WK = @[fromWeek]  	    
                                                                         )                                     	    
                                                                 AND     (                                       	    
                                                                          SELECT TO_DATE(WK_END_DT,'YYYYMMDD')   	    
                                                                          FROM EQR_WK_PRD                        	    
                                                                          WHERE PLN_YR||PLN_WK = @[toWeek]    	    
                                                                         ) 								            
                            		           --AND A.CLPT_IND_SEQ ='1'	                                            
                                             AND NVL(SKD_CNG_STS_CD,'N') <> 'S'        		 						    
                                             INTERSECT	        		 							                
                                             SELECT DISTINCT A.VSL_CD,A.SKD_VOY_NO                                    
                                                    ,A.SKD_DIR_CD VVD                                                 
                                             FROM EQR_SCNR_VSL_SKD A                                                  
                                             WHERE A.SCNR_ID = @[scnrPlanID]		 		                        
                                             --AND   A.VSL_CALL_IND_CD = '1'                                             
            -- CSR NO. N200903060123 Split 01-EQR sked 기준 변경
--                                             AND  A.VSL_ETA_DT BETWEEN (                                              
                                             AND  A.VSL_ETB_DT BETWEEN (                                              
                                                                        SELECT TO_DATE(WK_ST_DT,'YYYYMMDD')    	    
                                                                        FROM EQR_WK_PRD                        	    
                                                                        WHERE PLN_YR||PLN_WK = @[fromWeek]  	    
                                                                       )                                     	        
                                                               AND     (                                       	    
                                                                        SELECT TO_DATE(WK_END_DT,'YYYYMMDD')   	    
                                                                        FROM EQR_WK_PRD                        	    
                                                                        WHERE PLN_YR||PLN_WK = @[toWeek]    	    
                                                                       ) 								                            
                                         )                                                                            
                        AND ES.SCNR_ID = @[scnrPlanID]		 		                                                
                        --AND ES.VSL_CALL_IND_CD = '1'                                                                   
            -- CSR NO. N200903060123 Split 01-EQR sked 기준 변경
--                        AND  ES.VSL_ETA_DT BETWEEN (                                                                  
                        AND  ES.VSL_ETB_DT BETWEEN (                                                                  
                                                    SELECT TO_DATE(WK_ST_DT,'YYYYMMDD')    	                        
                                                    FROM EQR_WK_PRD                        	                        
                                                    WHERE PLN_YR||PLN_WK = @[fromWeek]                        
                                                   )                                     	                            
                                           AND     (                                       	                        
                                                    SELECT TO_DATE(WK_END_DT,'YYYYMMDD')   	                        
                                                    FROM EQR_WK_PRD                        	                        
                                                    WHERE PLN_YR||PLN_WK = @[toWeek]    	                        
                                                   ) 								                                                
                        MINUS                                             
                        SELECT VS.VSL_CD||VS.SKD_VOY_NO||VS.SKD_DIR_CD  VVD 
                              ,VS.VPS_PORT_CD  PORT                       
                        FROM VSK_VSL_PORT_SKD VS                          
                        WHERE (VSL_CD, SKD_VOY_NO, SKD_DIR_CD) IN         
                                         (                                                                            
                                            SELECT /*+ XAK1VSK_VSL_PORT_SKD */                                        
                                                   DISTINCT A.VSL_CD,A.SKD_VOY_NO,A.SKD_DIR_CD VVD                    
                                            FROM VSK_VSL_PORT_SKD A                                                   
            -- CSR NO. N200903060123 Split 01-EQR sked 기준 변경
--                                            WHERE  A.VPS_ETA_DT BETWEEN (                                             
                                            WHERE  A.VPS_ETB_DT BETWEEN (                                             
                                                                         SELECT TO_DATE(WK_ST_DT,'YYYYMMDD')    	    
                                										   FROM EQR_WK_PRD                        	    
                                										   WHERE PLN_YR||PLN_WK = @[fromWeek]	    
                               										  )                                     	    
                             									AND       (                                       	    
                                      								   SELECT TO_DATE(WK_END_DT,'YYYYMMDD')   	    
                                      								   FROM EQR_WK_PRD                        	    
                                      								   WHERE PLN_YR||PLN_WK = @[toWeek]    	    
                                     									  ) 								            
                            		 		  --AND A.CLPT_IND_SEQ ='1'	                                                
                                            AND NVL(SKD_CNG_STS_CD,'N') <> 'S'        		 						    
                            				  INTERSECT	        		 							                    
                                            SELECT DISTINCT A.VSL_CD                                                  
                                                  ,A.SKD_VOY_NO                                                       
                                                  ,A.SKD_DIR_CD VVD                                                   
                                            FROM EQR_SCNR_VSL_SKD A                                                   
                                            WHERE A.SCNR_ID = @[scnrPlanID]		 		                        
                                            --AND   A.VSL_CALL_IND_CD = '1'                                                
            -- CSR NO. N200903060123 Split 01-EQR sked 기준 변경
--                                            AND  A.VSL_ETA_DT BETWEEN (                                              
                                            AND  A.VSL_ETB_DT BETWEEN (                                              
                                                                        SELECT TO_DATE(WK_ST_DT,'YYYYMMDD')    	    
                                                                        FROM EQR_WK_PRD                        	    
                                                                        WHERE PLN_YR||PLN_WK = @[fromWeek]  	    
                                                                       )                                     	        
                                                               AND     (                                       	    
                                                                        SELECT TO_DATE(WK_END_DT,'YYYYMMDD')   	    
                                                                        FROM EQR_WK_PRD                        	    
                                                                        WHERE PLN_YR||PLN_WK = @[toWeek]    	    
                                                                       ) 								                            
                                        )                                                                             
            -- CSR NO. N200903060123 Split 01-EQR sked 기준 변경
--                        AND  VS.VPS_ETA_DT BETWEEN (                                                                  
                        AND  VS.VPS_ETB_DT BETWEEN (                                                                  
                                                    SELECT TO_DATE(WK_ST_DT,'YYYYMMDD')    	                        
                                                    FROM EQR_WK_PRD                        	                        
                                                    WHERE PLN_YR||PLN_WK = @[fromWeek]  	                        
                                                   )                                     	                            
                                           AND     (                                       	                        
                                                    SELECT TO_DATE(WK_END_DT,'YYYYMMDD')   	                        
                                                    FROM EQR_WK_PRD                        	                        
                                                    WHERE PLN_YR||PLN_WK = @[toWeek]    	                        
                                                   ) 								                                    
                        --AND VS.CLPT_IND_SEQ ='1'	                        
                        AND NVL(VS.SKD_CNG_STS_CD,'N') <> 'S'  -- port skip   
                    )                                                     
            
                ) A                                                       
            -- FROM TO
            #if(${fmtoat} == '1')
            	    WHERE   1=1                                            
            	#if(${fromStatus} != '')
                	AND   A.FM_ECC_CD IN (
					#if((${fmtoat}== '1' || ${fmtoat}== '2') && (${fromStatus} != '' || ${atStatus} != '')) 
    					#foreach($key IN ${fromeccArr}) 
							#if($velocityCount < $fromeccArr.size())
								'$key',
							#else
								'$key'
							#end
    					#end
					#end
					)	
				#end			 
            	#if(${toStatus} != '') 
                	AND   A.TO_ECC_CD IN (
					#if(${fmtoat}== '1' && ${toStatus} != '') 
						#foreach($key IN ${toeccArr}) 
							#if($velocityCount < $toeccArr.size())
								'$key',
							#else
								'$key'
							#end
    					#end
					#end
					)  
				#end 	
			-- AT	     
            #else                    
            	#if(${atStatus} != '') 
                	    WHERE (
							A.FM_ECC_CD IN (
								#if((${fmtoat}== '1' || ${fmtoat}== '2') && (${fromStatus} != '' || ${atStatus} != '')) 
    								#foreach($key IN ${fromeccArr}) 
										#if($velocityCount < $fromeccArr.size())
											'$key',
										#else
											'$key'
										#end
    								#end
								#end
							) OR  A.TO_ECC_CD IN (
								#if((${fmtoat}== '1' || ${fmtoat}== '2') && (${fromStatus} != '' || ${atStatus} != '')) 
    								#foreach($key IN ${fromeccArr}) 
										#if($velocityCount < $fromeccArr.size())
											'$key',
										#else
											'$key'
										#end
    								#end
								#end
							)
						) 
				#end         	
            #end                     

			) A,                                                          	
			(                                                                 
			    -- INPUT DATA TYPE                                            
			    SELECT INTG_CD_VAL_CTNT DATACODE                              
			          ,INTG_CD_VAL_DESC DATATYPE                              
			    FROM COM_INTG_CD_DTL                                          
			    WHERE INTG_CD_ID = 'CD00248'                                  
			) B                                                               
			WHERE A.DATACODE = B.DATACODE                                     
			GROUP BY A.WEEK                                                   
			        ,B.DATATYPE                                               
			        ,A.ALERTITEM                                              
			        ,A.DIV                                                    
			        ,A.FM_ECC_CD                                              
			        ,A.TO_ECC_CD                                              
			        ,A.VVD                                                    
			        ,A.SORTNUM                                                
			        ,A.DIVNUM                                                 
			ORDER BY 1,2,3,4                									
			) A                                                               

    		---------------- VESSEL SKD END   ------------------------------  
    	#end

		-- ----------- OB FORECAST ---------------------------------------------------------	
		#if(${datatype} == '' )     
			UNION ALL           
		#end            			
    	
    	#if(${datatype} =='OBF' || ${datatype} == '')     		   	    	
    		---------------- OB FORECAST START   --------------------------   
    	    SELECT 
				A.WEEK                                        				
    	    	,A.DATATYPE                                    				
    	    	,A.ALERTITEM                                   				
    	    	,A.DIV                                        				
    	    	,A.FM_ECC_CD                                   				
    	    	,A.TO_ECC_CD                                   				
    	    	,A.VVD 		                                   				
    	    	,A.VOL_TOTAL                            					
    	    	,A.AMT_TOTAL     
			#foreach( ${key} in ${tpszArr}) 
				,A.VOL_$key      
        		,A.AMT_$key
			#end	 

        	--      ,A.CHECKBOX                                       			
			#foreach( ${key} in ${tpszArr}) 
				,'F' VOL_FLAG$key       
        		,'F' AMT_FLAG$key
			#end    
        		,A.SORTNUM                                        			
        		,A.DIVNUM                                        			
        		,@[scnrPlanID] SCNR_ID                            			

    	    FROM                                              				
    	    (                                              					
        	SELECT A.WEEK                                        				
        	      ,B.DATATYPE                                                 
        	      ,A.ALERTITEM                                                
        	      ,A.DIV                                                      
		
        	--      ,A.FM_ECC_CD                                                
        	#if(${fmtoat} == '1')
        		#if(${fmTypeBy} != '')
        			#if(${fmTypeBy} == 'C')       
						,(SELECT CNT_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
					#end
        			#if(${fmTypeBy} == 'E')       
						,(SELECT ECC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
        			#end
        			#if(${fmTypeBy} == 'L')       
						,(SELECT LCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
        			#end
        			#if(${fmTypeBy} == 'R')       
						,(SELECT RCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD
					#end 					
        		#end
        		--      ,A.TO_ECC_CD                                                
        		#if(${toTypeBy} != '')
        			#if(${toTypeBy} == 'C')       
						,(SELECT CNT_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
					#end
        			#if(${toTypeBy} == 'E')       
						,(SELECT ECC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end
        			#if(${toTypeBy} == 'L')       
						,(SELECT LCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end
        			#if(${toTypeBy} == 'R')       
						,(SELECT RCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD
					#end 					
        		#end		
        	#else
        		#if(${atTypeBy} != '') 
        			#if(${atTypeBy} == 'C')
        				,(SELECT CNT_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
        				,(SELECT CNT_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end
        			#if(${atTypeBy} == 'E')
        				,(SELECT ECC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
        				,(SELECT ECC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end
        			#if(${atTypeBy} == 'L')
        				,(SELECT LCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 
        				,(SELECT LCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 
        			#end
        			#if(${atTypeBy} == 'R')
        				,(SELECT RCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.FM_ECC_CD)  FM_ECC_CD 								
						,(SELECT RCC_CD FROM EQR_ECC_MST WHERE ECC_CD = A.TO_ECC_CD)  TO_ECC_CD 								
        			#end
        		#end
        	#end	
        	      ,A.VVD                                                      
			#foreach($key IN ${tpszArr}) 
				#if($velocityCount == 1) 
					,NVL(SUM(A.VOL_$key),0)
				#else 
					+NVL(SUM(A.VOL_$key),0)
				#end 
			#end  
        		VOL_TOTAL                         									
			#foreach($key IN ${tpszArr}) 
				#if($velocityCount == 1) 
					,NVL(SUM(A.AMT_$key),0)
				#else 
					+NVL(SUM(A.AMT_$key),0)
				#end 
			#end 
        		AMT_TOTAL                       									
        
        	#foreach($key IN ${tpszArr})		
        		      ,SUM(A.VOL_$key)     VOL_$key     
        		      ,SUM(A.AMT_$key)     AMT_$key    
        	#end
        	--      ,'' CHECKBOX                                       			
        	      ,A.SORTNUM                                        			
        	      ,A.DIVNUM                                        			

        	FROM                                                              
        	(		                                                            
    		
            SELECT 
				SUBSTR(A.SCNR_ID, 5, 6) WEEK      						                     
            	,'OBF' DATACODE                                         
            	,C.CO_NAME ALERTITEM                                    
            	,B.NAME DIV                                             
             	,A.FM_ECC_CD                                            
            	,A.TO_ECC_CD                                            
            	,'' VVD                                                 
           		,SUM(DECODE(B.CODE, 1, A.QTY1, 2, A.QTY2) ) VOL_TOTAL                                                                                                                
            	,null AMT_TOTAL                                         
            #foreach($key IN ${tpszArr})
            	,SUM(DECODE(A.CNTR_TPSZ_CD, '$key', DECODE(B.CODE, 1, A.QTY1, 2, A.QTY2)) ) VOL_$key 	  
            	,null AMT_$key                            
        	#end 
            	,'4' SORTNUM                                            
	        	,B.CODE DIVNUM                                          
            FROM                                                          
            (                                                             
                -- DEMAND VOL ----------------------------------------    
                SELECT A.SCNR_ID                                          
                      ,A.FCAST_YRWK                                       
                	    ,A.CO_CD                                            
                	    ,A.FM_ECC_CD                                        
                	    ,A.TO_ECC_CD                                        
                	    ,A.CNTR_TPSZ_CD                                     
                	    ,SUM(A.CNTR_VOL_QTY) QTY1                           
            		    ,0 QTY2                                             
                	    ,1 SORTNUM                                          
                FROM EQR_OB_FCAST A,                                      
                    (                                                     
                        ---- AVG VOL (A >= B) -----------------------     
                        SELECT A.SCNR_ID                                  
                              ,A.FCAST_YRWK                               
                              ,A.CO_CD                                    
                              ,A.FM_ECC_CD                                
                              ,A.TO_ECC_CD                                
                              ,A.TPSIZE                                   
                              ,A.AVG_QTY                                  
                        	    ,B.RLA_QTY                                  
                        	    ,2 SORTNUM                                  
                        FROM                                              
                        (                                                 
                            -- AVG VOL ----------------.----------        
                            SELECT 
								@[scnrPlanID] SCNR_ID               
                            	, SUBSTR(@[scnrPlanID],5,6) FCAST_YRWK  
                            	,A.CO_CD                                
                            	,A.FM_ECC_CD                            
                            	,A.TO_ECC_CD                            
                            	,A.CNTR_TPSZ_CD TPSIZE                  
                            	,B.RCC_CD                               
                            	,NVL(SUM(A.CNTR_VOL_QTY)/4, 0) AVG_QTY  
                            FROM EQR_OB_FCAST A,                          
                                 MDM_EQ_ORZ_CHT B                         
                            WHERE A.FM_ECC_CD = B.ECC_CD	                
                            AND   A.SCNR_ID IN (                          
                                                SELECT SCNR_ID            
                                                FROM EQR_SCNR_MST         
                        		  			   	  WHERE SUBSTR(SCNR_ID, 12, 3) = '000'    
                        					      AND SUBSTR(SCNR_ID, 5, 6) < SUBSTR(@[scnrPlanID],5,6) 
                        						  AND ROWNUM < 5            
                                               )                          
                            AND   A.FCAST_YRWK IN (                       
                                                   SELECT SUBSTR(SCNR_ID, 5, 6)         
                                                   FROM EQR_SCNR_MST                    
                                                   WHERE SUBSTR(SCNR_ID, 12, 3) = '000' 
                                                   AND SUBSTR(SCNR_ID, 5, 6) < SUBSTR(@[scnrPlanID],5,6) 
                                                   AND ROWNUM < 5         
                        						  )                         
                            GROUP BY A.FCAST_YRWK                         
                            	    ,A.CO_CD                                
                            	    ,A.FM_ECC_CD                            
                            	    ,A.TO_ECC_CD	                        
                            		,A.CNTR_TPSZ_CD                         
                            		,B.RCC_CD                               
                        ) A,                                              
                        (		                                            
                            -- RLA 
                            SELECT RCC_CD                                 
                                  ,CNTR_TPSZ_CD TPSIZE                    
                            	    ,RLA_QTY                                
                            FROM EQR_OB_FCAST_RED_LGT_ALT                 
                            WHERE RLA_TP_CD = 'V'                         
                        ) B	                                            
                        WHERE A.RCC_CD = B.RCC_CD                                                                                                                                                                                                          
                        AND   A.TPSIZE = B.TPSIZE                                                                                                      
                        AND   A.AVG_QTY >= B.RLA_QTY                      
                    ) B                                                   
                WHERE B.CO_CD = A.CO_CD                                   
                AND   B.FM_ECC_CD = A.FM_ECC_CD                           
                AND   B.TO_ECC_CD = A.TO_ECC_CD                           
                AND   B.TPSIZE    = A.CNTR_TPSZ_CD                        
                AND   A.SCNR_ID = @[scnrPlanID]              
                AND   A.FCAST_YRWK = SUBSTR(@[scnrPlanID],5,6)     
                GROUP BY A.SCNR_ID                                        
                        ,A.FCAST_YRWK                                     
                	      ,A.CO_CD                                          
                	      ,A.FM_ECC_CD                                      
                	      ,A.TO_ECC_CD                                      
                	      ,A.CNTR_TPSZ_CD                                   
                UNION                                                     
                -- AVG VOL (A >= B)      
                SELECT A.SCNR_ID                                          
                      ,A.FCAST_YRWK                                       
                      ,A.CO_CD                                            
                      ,A.FM_ECC_CD                                        
                      ,A.TO_ECC_CD                                        
                      ,A.TPSIZE                                           
            		    ,0 QTY1                                             
                      ,A.AVG_QTY QTY2                                     
                	    ,2 SORTNUM                                          
                FROM                                                      
                (                                                         
                    -- AVG VOL         
                    SELECT @[scnrPlanID] SCNR_ID                       
                          ,SUBSTR(@[scnrPlanID],5,6) FCAST_YRWK    
                    	    ,A.CO_CD                                        
                    	    ,A.FM_ECC_CD                                    
                    	    ,A.TO_ECC_CD                                    
                    	    ,A.CNTR_TPSZ_CD TPSIZE                          
                    	    ,B.RCC_CD                                       
                    	    ,NVL(SUM(A.CNTR_VOL_QTY)/4, 0) AVG_QTY          
                    FROM EQR_OB_FCAST A,                                  
                         MDM_EQ_ORZ_CHT B                                 
                    WHERE A.FM_ECC_CD = B.ECC_CD	                        
                    AND   A.SCNR_ID IN (SELECT SCNR_ID                    
                                        FROM EQR_SCNR_MST                 
                		  			   	  WHERE SUBSTR(SCNR_ID, 12, 3) = '000'   
                					      AND SUBSTR(SCNR_ID, 5, 6) < SUBSTR(@[scnrPlanID],5,6)
                						  AND ROWNUM < 5                    
                                       )                                  
                    AND   A.FCAST_YRWK IN (SELECT SUBSTR(SCNR_ID, 5, 6)   
                                           FROM EQR_SCNR_MST              
                                           WHERE SUBSTR(SCNR_ID, 12, 3) = '000'  
                                           AND SUBSTR(SCNR_ID, 5, 6) < SUBSTR(@[scnrPlanID],5,6)
                                           AND ROWNUM < 5                 
                						  )                                 
                    GROUP BY A.FCAST_YRWK                                 
                    	      ,A.CO_CD                                      
                    	      ,A.FM_ECC_CD                                  
                    	      ,A.TO_ECC_CD	                                
                    		  ,A.CNTR_TPSZ_CD                               
                    		  ,B.RCC_CD                                     
                ) A,                                                      
                (		                                                    
                    -- RLA -------------------------------	            
                    SELECT RCC_CD                                         
                          ,CNTR_TPSZ_CD TPSIZE                            
                    	    ,RLA_QTY                                        
                    FROM EQR_OB_FCAST_RED_LGT_ALT                         
                    WHERE RLA_TP_CD = 'V'                                 
                ) B	                                                    
                WHERE A.RCC_CD = B.RCC_CD                                                                                                                                                                                                          
                AND   A.TPSIZE = B.TPSIZE                                                                                                      
                AND   A.AVG_QTY >= B.RLA_QTY                              
            ) A,                                                          
            (                                                             
                SELECT '1' CODE, 'Demand Vol' NAME FROM DUAL                
                UNION                                                     
                SELECT '2' CODE, 'Avg Vol Diff' NAME FROM DUAL              
            ) B,                                                          
            (                                                             
                SELECT INTG_CD_VAL_CTNT    CO_CD                          
            	        ,INTG_CD_VAL_DP_DESC CO_NAME                        
            	  FROM COM_INTG_CD_DTL                                      
                WHERE INTG_CD_ID = 'CD00264'                              
            ) C                                                           
            WHERE A.CO_CD = C.CO_CD                                       
            -- FROM TO
            #if(${fmtoat} == '1')
            	#if(${fromStatus} != '')
                	AND     A.FM_ECC_CD IN (
					#if((${fmtoat}== '1' || ${fmtoat}== '2') && (${fromStatus} != '' || ${atStatus} != '')) 
    					#foreach($key IN ${fromeccArr}) 
							#if($velocityCount < $fromeccArr.size())
								'$key',
							#else
								'$key'
							#end
    					#end
					#end
					)			
				#end	 
            	#if(${toStatus} != '') 
                	AND     A.TO_ECC_CD IN  (
					#if(${fmtoat}== '1' && ${toStatus} != '') 
						#foreach($key IN ${toeccArr}) 
							#if($velocityCount < $toeccArr.size())
								'$key',
							#else
								'$key'
							#end
    					#end
					#end
					)   
				#end		   
				     -- AT  
            #else                   
            	#if(${atStatus} != '') 
                	 AND    
					(
					A.FM_ECC_CD IN (
					#if((${fmtoat}== '1' || ${fmtoat}== '2') && (${fromStatus} != '' || ${atStatus} != '')) 
    					#foreach($key IN ${fromeccArr}) 
							#if($velocityCount < $fromeccArr.size())
								'$key',
							#else
								'$key'
							#end
    					#end
					#end
					) OR  A.TO_ECC_CD IN (
					#if((${fmtoat}== '1' || ${fmtoat}== '2') && (${fromStatus} != '' || ${atStatus} != '')) 
    					#foreach($key IN ${fromeccArr}) 
							#if($velocityCount < $fromeccArr.size())
								'$key',
							#else
								'$key'
							#end
    					#end
					#end
					)
					
					)
				#end          	
            #end                     
            
            GROUP BY SUBSTR(A.SCNR_ID, 5, 6)                              
            	      ,C.CO_NAME                                            
            	      ,B.NAME                                               
                    ,A.FM_ECC_CD                                          
                    ,A.TO_ECC_CD                                          
	        		  ,B.CODE                                               
            --ORDER BY 1,2,3,5,6,B.CODE       	                        
			) A,                                                          	
			(                                                                 
			    -- INPUT DATA TYPE                                            
			    SELECT INTG_CD_VAL_CTNT DATACODE                              
			          ,INTG_CD_VAL_DESC DATATYPE                              
			    FROM COM_INTG_CD_DTL                                          
			    WHERE INTG_CD_ID = 'CD00248'                                  
			) B                                                               
			WHERE A.DATACODE = B.DATACODE                                     
			GROUP BY A.WEEK                                                   
			        ,B.DATATYPE                                               
			        ,A.ALERTITEM                                              
			        ,A.DIV                                                    
			        ,A.FM_ECC_CD                                              
			        ,A.TO_ECC_CD                                              
			        ,A.VVD                                                    
			        ,A.SORTNUM                                                
			        ,A.DIVNUM                                                 
			ORDER BY 1, A.SORTNUM, 3, 5, 6, A.DIVNUM   						
			) A                                                               
			
			-- 20070603 정선희 과장님 요청사항으로 O/B Forecast 는 당분간 조회되면 안됨.	START		
			WHERE 1=0                                                         
			-- 20070603 정선희 과장님 요청사항으로 O/B Forecast 는 당분간 조회되면 안됨.	END
			
    		---------------- OB FORECAST END   ----------------------------   
    	#end			]]></sql>
			<params>
				<param name="scnrPlanID" type="12" value="" out="N"/>
				<param name="fromWeek" type="12" value="" out="N"/>
				<param name="toWeek" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
