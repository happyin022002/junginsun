<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="WriteOffMgtDBDAOsearchWriteOffRequestHeaderDataRSQL">
			<desc><![CDATA[2013-09-30 CHM-201326903 Write-off request 신청 office 기준 변경 요청 by Jonghee HAN]]></desc>
			<sql><![CDATA[
SELECT DISTINCT
       MTLRH.TTL_LSS_NO,
       MTLRH.RESPB_OFC_CD,
       TO_CHAR(MTLRH.RQST_DT, 'YYYY-MM-DD') RQST_DT,
       (SELECT MNR_CD_DP_DESC FROM MNR_GEN_CD WHERE PRNT_CD_ID = 'TR' AND MNR_CD_ID = MTLRH.TTL_LSS_RSN_CD) TTL_LSS_RSN_CD,
       (SELECT MNR_CD_DP_DESC FROM MNR_GEN_CD WHERE PRNT_CD_ID = 'TRD' AND MNR_CD_ID = MTLRH.TTL_LSS_DTL_RSN_CD) TTL_LSS_DTL_RSN_CD,
       TO_CHAR(MTLRH.TTL_LSS_DT, 'YYYY-MM-DD') TTL_LSS_DT,
       MTLRD.WRTF_NO,
	   MTLRH.FILE_SEQ,
	   MTLRH.MNR_STS_REF_NO 
  FROM MNR_TTL_LSS_RQST_HDR MTLRH, MNR_TTL_LSS_RQST_DTL MTLRD
 WHERE 1 = 1
   AND MTLRH.TTL_LSS_NO = MTLRD.TTL_LSS_NO
   AND MTLRH.TTL_LSS_STS_CD = 'HA'
   AND MTLRD.MNR_INV_TP_CD = 'DV'
   AND ROWNUM = 1
#if (${ttl_lss_no} != '')
   AND MTLRH.TTL_LSS_NO = @[ttl_lss_no]
#end 
#if (${in_rqst_eq_no} != '')
   AND MTLRH.TTL_LSS_NO IN (SELECT DISTINCT TTL_LSS_NO 
							  FROM MNR_TTL_LSS_RQST_DTL 
							 WHERE RQST_EQ_NO = @[in_rqst_eq_no]
							#if(${eq_knd_cd} != ''&&${eq_knd_cd} != 'ALL')
							   AND EQ_KND_CD = @[eq_knd_cd]
							#end
							)
#end
   AND MTLRH.RESPB_OFC_CD = @[in_rqst_ofc_cd]			]]></sql>
			<params>
				<param name="ttl_lss_no" type="12" value="" out="N"/>
				<param name="in_rqst_eq_no" type="12" value="" out="N"/>
				<param name="eq_knd_cd" type="12" value="" out="N"/>
				<param name="in_rqst_ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
