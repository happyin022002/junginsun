<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChargeCalculationDBDAOSearchBookingChargeOBRSQL">
			<desc><![CDATA[1) 해당 BKG의 Shipper code와 DMT의 Payer Code와 같은 경우
2) DMT type : DTOC, DMOF
3) Status : I
4) AR interface : No
5) TOTAL USD AMT]]></desc>
			<sql><![CDATA[
SELECT NVL(SUM(ROUND(B.INV_CHG_AMT/F1.USD_LOCL_XCH_RT* CASE WHEN C1.CURR_CD = NULL THEN 1
                                                             ELSE F2.USD_LOCL_XCH_RT END, 2)),0)||' '||NVL(C1.CURR_CD,'USD') AS INV_AMT_USD
FROM DMT_INV_MN B, BKG_CUSTOMER BC, GL_MON_XCH_RT F1, MDM_COUNTRY C1, GL_MON_XCH_RT F2
 WHERE 1=1 
   AND B.DMDT_TRF_CD IN ( 'DTOC', 'DMOF','CTOC' )
   AND NVL(B.PRG_FLG,'N') = 'N'
   AND BC.BKG_NO = @[bkg_no]
   AND BC.BKG_CUST_TP_CD = 'S'
   AND B.ACT_PAYR_CNT_CD = BC.CUST_CNT_CD
   AND B.ACT_PAYR_SEQ = BC.CUST_SEQ
   AND F1.ACCT_XCH_RT_YRMON    =   TO_CHAR(B.CRE_DT, 'YYYYMM')
   AND F1.ACCT_XCH_RT_LVL      =   1
   AND F1.CURR_CD              =   B.INV_CURR_CD 
   AND B.DMDT_AR_IF_CD = 'N'
   AND BC.CUST_CNT_CD = C1.CNT_CD
   AND F2.ACCT_XCH_RT_YRMON    =   TO_CHAR(B.CRE_DT, 'YYYYMM')
   AND F2.ACCT_XCH_RT_LVL      =   1
   AND F2.CURR_CD              =   NVL(C1.CURR_CD,'USD')
   AND ( (B.DMDT_INV_STS_CD = 'I') OR (B.DMDT_INV_STS_CD = 'C' AND B.CR_INV_NO IS NOT NULL))
GROUP BY C1.CURR_CD			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
