<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ApprovalStepMgtDBDAOsearchApprovalStepRankListDataRSQL">
			<desc><![CDATA[---------------------------------------------------------------------------------------------------------------
2013-10-28 Created by Jonghee HAN Write Off Approval Route Manager Selection
2014-02-26 Jonghee HAN Live malfunction fixed
---------------------------------------------------------------------------------------------------------------]]></desc>
			<sql><![CDATA[
WITH OFC_STEP AS (SELECT A.OFC_CD, A.APRO_STEP_SEQ, A.OFC_TP_CD, A.MNR_APRO_JB_CD, A.APRO_USR_ID, B.USR_NM, B.OFC_CD USR_OFC_CD
                    FROM MNR_APRO_STEP A, COM_USER B
                   WHERE A.APRO_USR_ID = B.USR_ID)
SELECT OFC_TP_CD, OFC_CD, 
       MIN(DECODE(NO, 1, USR_OFC_CD)) PIC1_OFC, MIN(DECODE(NO, 1, APRO_USR_ID)) PIC1_USR_ID, MIN(DECODE(NO, 1, APRO_USR_ID)) PRE_PIC1_USR_ID, MIN(DECODE(NO, 1, USR_NM)) PIC1_NM,
       MIN(DECODE(NO, 2, USR_OFC_CD)) PIC2_OFC, MIN(DECODE(NO, 2, APRO_USR_ID)) PIC2_USR_ID, MIN(DECODE(NO, 2, APRO_USR_ID)) PRE_PIC2_USR_ID, MIN(DECODE(NO, 2, USR_NM)) PIC2_NM,
       MIN(DECODE(NO, 3, USR_OFC_CD)) PIC3_OFC, MIN(DECODE(NO, 3, APRO_USR_ID)) PIC3_USR_ID, MIN(DECODE(NO, 3, APRO_USR_ID)) PRE_PIC3_USR_ID, MIN(DECODE(NO, 3, USR_NM)) PIC3_NM,
       MIN(DECODE(NO, 4, USR_OFC_CD)) PIC4_OFC, MIN(DECODE(NO, 4, APRO_USR_ID)) PIC4_USR_ID, MIN(DECODE(NO, 4, APRO_USR_ID)) PRE_PIC4_USR_ID, MIN(DECODE(NO, 4, USR_NM)) PIC4_NM
  FROM (SELECT ROW_NUMBER() OVER(PARTITION BY OFC_CD ORDER BY APRO_STEP_SEQ) NO, 
               OFC_CD, APRO_STEP_SEQ, OFC_TP_CD, MNR_APRO_JB_CD, APRO_USR_ID, USR_OFC_CD, USR_NM
          FROM OFC_STEP)
 WHERE 1 = 1
   AND OFC_TP_CD = 'BB'
   AND OFC_CD LIKE DECODE(@[ofc_cd], ( SELECT MNR_CD_ID FROM MNR_GEN_CD WHERE PRNT_CD_ID = 'HOOFC' ), '%', 'A', '%', @[ofc_cd])
GROUP BY OFC_TP_CD, OFC_CD
UNION ALL
SELECT OFC_TP_CD, OFC_CD, 
       MIN(DECODE(NO, 1, USR_OFC_CD)) PIC1_OFC, MIN(DECODE(NO, 1, APRO_USR_ID)) PIC1_USR_ID, MIN(DECODE(NO, 1, APRO_USR_ID)) PRE_PIC1_USR_ID, MIN(DECODE(NO, 1, USR_NM)) PIC1_NM,
       MIN(DECODE(NO, 2, USR_OFC_CD)) PIC2_OFC, MIN(DECODE(NO, 2, APRO_USR_ID)) PIC2_USR_ID, MIN(DECODE(NO, 2, APRO_USR_ID)) PRE_PIC2_USR_ID, MIN(DECODE(NO, 2, USR_NM)) PIC2_NM,
       MIN(DECODE(NO, 3, USR_OFC_CD)) PIC3_OFC, MIN(DECODE(NO, 3, APRO_USR_ID)) PIC3_USR_ID, MIN(DECODE(NO, 3, APRO_USR_ID)) PRE_PIC3_USR_ID, MIN(DECODE(NO, 3, USR_NM)) PIC3_NM,
       MIN(DECODE(NO, 4, USR_OFC_CD)) PIC4_OFC, MIN(DECODE(NO, 4, APRO_USR_ID)) PIC4_USR_ID, MIN(DECODE(NO, 4, APRO_USR_ID)) PRE_PIC4_USR_ID, MIN(DECODE(NO, 4, USR_NM)) PIC4_NM
  FROM (SELECT ROW_NUMBER() OVER(PARTITION BY OFC_CD ORDER BY APRO_STEP_SEQ) NO, 
               OFC_CD, APRO_STEP_SEQ, OFC_TP_CD, MNR_APRO_JB_CD, APRO_USR_ID, USR_OFC_CD, USR_NM
          FROM OFC_STEP)
 WHERE 1 = 1
   AND OFC_TP_CD = 'HQ'
   AND OFC_CD LIKE DECODE(@[ofc_cd], ( SELECT MNR_CD_ID FROM MNR_GEN_CD WHERE PRNT_CD_ID = 'HOOFC' ), '%', 'A', '%', @[ofc_cd])
GROUP BY OFC_TP_CD, OFC_CD
UNION ALL
SELECT OFC_TP_CD, OFC_CD, 
       MIN(DECODE(NO, 1, USR_OFC_CD)) PIC1_OFC, MIN(DECODE(NO, 1, APRO_USR_ID)) PIC1_USR_ID, MIN(DECODE(NO, 1, APRO_USR_ID)) PRE_PIC1_USR_ID, MIN(DECODE(NO, 1, USR_NM)) PIC1_NM,
       MIN(DECODE(NO, 2, USR_OFC_CD)) PIC2_OFC, MIN(DECODE(NO, 2, APRO_USR_ID)) PIC2_USR_ID, MIN(DECODE(NO, 2, APRO_USR_ID)) PRE_PIC2_USR_ID, MIN(DECODE(NO, 2, USR_NM)) PIC2_NM,
       MIN(DECODE(NO, 3, USR_OFC_CD)) PIC3_OFC, MIN(DECODE(NO, 3, APRO_USR_ID)) PIC3_USR_ID, MIN(DECODE(NO, 3, APRO_USR_ID)) PRE_PIC3_USR_ID, MIN(DECODE(NO, 3, USR_NM)) PIC3_NM,
       MIN(DECODE(NO, 4, USR_OFC_CD)) PIC4_OFC, MIN(DECODE(NO, 4, APRO_USR_ID)) PIC4_USR_ID, MIN(DECODE(NO, 4, APRO_USR_ID)) PRE_PIC4_USR_ID, MIN(DECODE(NO, 4, USR_NM)) PIC4_NM
  FROM (SELECT ROW_NUMBER() OVER(PARTITION BY OFC_CD ORDER BY APRO_STEP_SEQ) NO, 
               OFC_CD, APRO_STEP_SEQ, OFC_TP_CD, MNR_APRO_JB_CD, APRO_USR_ID, USR_OFC_CD, USR_NM
          FROM OFC_STEP)
 WHERE 1 = 1
   AND OFC_TP_CD = 'HO'
   AND OFC_CD LIKE DECODE(@[ofc_cd], ( SELECT MNR_CD_ID FROM MNR_GEN_CD WHERE PRNT_CD_ID = 'HOOFC' ), '%', 'A', '%', @[ofc_cd])
GROUP BY OFC_TP_CD, OFC_CD			]]></sql>
			<params>
				<param name="ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
