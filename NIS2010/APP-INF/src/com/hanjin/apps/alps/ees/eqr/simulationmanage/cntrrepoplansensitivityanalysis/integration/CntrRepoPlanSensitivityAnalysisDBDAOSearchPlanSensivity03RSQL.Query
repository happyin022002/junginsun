<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CntrRepoPlanSensitivityAnalysisDBDAOSearchPlanSensivity03RSQL">
			<desc><![CDATA[Trshipment 민감도 조회]]></desc>
			<sql><![CDATA[
SELECT SUBSTR(A.PLN_YRWK,1,4) || '-' || SUBSTR(A.PLN_YRWK,5,2) WEEK 
		, @[sens_typ] SENSITY 
		, @[obj_txt] OBJ 
		, A.ECC_CD TO_LOC 
	--	, '' TO_LOC 
		, CNTR_TPSZ_CD TS_TYPE
		, SUM(CNTR_QTY) VOL
		, (SELECT ROUND(AMT / QTY) 
		FROM ( SELECT 	A.ECC_CD ,
          				SUM(DECODE(C.CNTR_TPSZ_CD, '2'
                               , STO_20FT_COST_AMT 
                               , '4', STO_40FT_COST_AMT
                               , '5', STO_40FT_COST_AMT 
                               , '7', STO_45FT_COST_AMT)) AMT ,
          				COUNT(DECODE(C.CNTR_TPSZ_CD, '2'
                              , STO_20FT_COST_AMT 
                              , '4', STO_40FT_COST_AMT 
                              , '5', STO_40FT_COST_AMT 
                              , '7', STO_45FT_COST_AMT)) QTY
        FROM EQR_ECC_MST A,
          EQR_TS_TML B,
          (SELECT ECC_CD, 
                  SUBSTR(CNTR_TPSZ_CD, 2, 2) CNTR_TPSZ_CD
           FROM EQR_LDIS_TS_PLN 
           GROUP BY ECC_CD,
                    SUBSTR(CNTR_TPSZ_CD, 2, 2) ) C
        WHERE B.ECC_CD = A.ECC_CD
          AND C.ECC_CD = A.ECC_CD
          AND A.TS_DIV_FLG = 'Y'
        GROUP BY A.ECC_CD
				) 
		WHERE ECC_CD = A.ECC_CD )   CURR_COST 
		, TS_RNG_MIN_QTY COST_RANGE 
		, TS_RNG_MAX_QTY COST_RANGE1 
		FROM EQR_LDIS_TS_PLN A 
		, (SELECT ECC_CD, LCC_CD, RCC_CD FROM EQR_ECC_MST) B 
		, EQR_CNTR_HNDL_COST_RNG C 
		WHERE A.REPO_PLN_ID = @[repo_pln_id] 
		AND A.ECC_CD = B.ECC_CD 
		AND A.REPO_PLN_ID  = C.REPO_PLN_ID 
		AND A.ECC_CD 	  = C.ECC_CD 
		AND A.CNTR_TPSZ_CD = C.CNTR_SZ_CD 
		AND A.PLN_YRWK     = C.PLN_YRWK 
		AND CNTR_TPSZ_CD IN (${arrtpszcd}) 
		AND A.PLN_YRWK BETWEEN @[fmstartprd] AND @[fmendprd] 
		#if (${fmecccd} != '') 
		#if (${fmtype} == 'R') 
		AND B.RCC_CD IN (${arrfmecccd}) 
		#end 
		#if (${fmtype} == 'L') 
		AND B.LCC_CD IN (${arrfmecccd}) 
		#end 
		#if (${fmtype} == 'E') 
		AND B.ECC_CD IN (${arrfmecccd}) 
		#end 
		#end 
		GROUP BY A.PLN_YRWK, A.ECC_CD, CNTR_TPSZ_CD, TS_RNG_MIN_QTY, TS_RNG_MAX_QTY 
		ORDER BY A.PLN_YRWK, A.ECC_CD, CNTR_TPSZ_CD			]]></sql>
			<params>
				<param name="sens_typ" type="12" value="" out="N"/>
				<param name="obj_txt" type="12" value="" out="N"/>
				<param name="repo_pln_id" type="12" value="" out="N"/>
				<param name="fmstartprd" type="12" value="" out="N"/>
				<param name="fmendprd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
