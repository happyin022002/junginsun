<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCExceptionTariffMgtDBDAOSearchMultiCoverageBySCRSQL">
			<desc><![CDATA[S/C별 DEM/DET 등록된 특별 계약 내용 중 Multi Coverage 정보데이터를 조회하는 쿼리]]></desc>
			<sql><![CDATA[
SELECT	NEW.PROP_NO
	,	NEW.SC_EXPT_VER_SEQ
	,	NEW.SC_EXPT_GRP_SEQ
	,	NEW.CVRG_SEQ
	,	NEW.CNT_CD
	,	NEW.RGN_CD
	,	NEW.STE_CD
	,	NEW.LOC_CD
	,	NEW.CRE_USR_ID
	,	NEW.CRE_DT
	,	NEW.UPD_USR_ID
	,	NEW.UPD_DT
	,   DECODE(OLD.SC_EXPT_GRP_SEQ, null, 'Y','N') AS NEW_FLG
FROM(
      SELECT B.PROP_NO
      	,	B.SC_EXPT_VER_SEQ
      	,	B.SC_EXPT_GRP_SEQ
      	,	B.CVRG_SEQ
      	,	B.CNT_CD
      	,	B.RGN_CD
      	,	B.STE_CD
      	,	B.LOC_CD
      	,	B.CRE_USR_ID
      	,	B.CRE_DT
      	,	B.UPD_USR_ID
      	,	B.UPD_DT
      
      FROM	(
                SELECT PROP_NO, SC_EXPT_VER_SEQ, SC_EXPT_GRP_SEQ
                FROM   DMT_SC_EXPT_CVRG
      			WHERE  PROP_NO 		= @[prop_no]
      			AND SC_EXPT_VER_SEQ = @[sc_expt_ver_seq]
      			AND SC_EXPT_GRP_SEQ = @[sc_expt_grp_seq]
                GROUP BY PROP_NO, SC_EXPT_VER_SEQ, SC_EXPT_GRP_SEQ
                HAVING COUNT(PROP_NO) > 1
      		) A
      	, 	DMT_SC_EXPT_CVRG B
      		
      WHERE	A.PROP_NO 			= B.PROP_NO
      	AND A.SC_EXPT_VER_SEQ 	= B.SC_EXPT_VER_SEQ
      	AND A.SC_EXPT_GRP_SEQ 	= B.SC_EXPT_GRP_SEQ
) NEW,
(
  SELECT	B.PROP_NO
       	,	B.SC_EXPT_GRP_SEQ
      	,	B.CVRG_SEQ
      	,	B.CNT_CD
      	,	B.RGN_CD
      	,	B.STE_CD
      	,	B.LOC_CD
     
      FROM	(
                SELECT  PROP_NO, SC_EXPT_VER_SEQ, SC_EXPT_GRP_SEQ
                FROM    DMT_SC_EXPT_CVRG
      			WHERE	PROP_NO 	= @[prop_no]
      			AND SC_EXPT_VER_SEQ = @[sc_expt_ver_seq]
      			AND SC_EXPT_GRP_SEQ = @[sc_expt_grp_seq]
                GROUP BY PROP_NO, SC_EXPT_VER_SEQ, SC_EXPT_GRP_SEQ
                HAVING COUNT(PROP_NO) > 1
      		) A
      	, 	DMT_SC_EXPT_CVRG B
      WHERE	A.PROP_NO 			= B.PROP_NO
      	AND A.SC_EXPT_VER_SEQ 	= B.SC_EXPT_VER_SEQ
      	AND A.SC_EXPT_GRP_SEQ 	= B.SC_EXPT_GRP_SEQ
  INTERSECT    	
  SELECT	B.PROP_NO
      	,	B.SC_EXPT_GRP_SEQ
      	,	B.CVRG_SEQ
      	,	B.CNT_CD
      	,	B.RGN_CD
      	,	B.STE_CD
      	,	B.LOC_CD
      FROM	(
               SELECT PROP_NO, SC_EXPT_VER_SEQ, SC_EXPT_GRP_SEQ
               FROM   DMT_SC_EXPT_CVRG
      		   WHERE  PROP_NO 	   = @[prop_no]
      		   AND SC_EXPT_VER_SEQ = @[sc_expt_ver_seq]-1
      		   AND SC_EXPT_GRP_SEQ = @[sc_expt_grp_seq]
               GROUP BY PROP_NO, SC_EXPT_VER_SEQ, SC_EXPT_GRP_SEQ
               HAVING COUNT(PROP_NO) > 1
      		) A
      	, 	DMT_SC_EXPT_CVRG B
       WHERE A.PROP_NO 			= B.PROP_NO
      	AND A.SC_EXPT_VER_SEQ 	= B.SC_EXPT_VER_SEQ
      	AND A.SC_EXPT_GRP_SEQ 	= B.SC_EXPT_GRP_SEQ
) OLD 
WHERE NEW.PROP_NO = OLD.PROP_NO(+)
 AND  NEW.SC_EXPT_GRP_SEQ =  OLD.SC_EXPT_GRP_SEQ(+)
 AND  NEW.CVRG_SEQ =  OLD.CVRG_SEQ(+)
ORDER BY NEW.SC_EXPT_GRP_SEQ, NEW.CVRG_SEQ			]]></sql>
			<params>
				<param name="prop_no" type="12" value="" out="N"/>
				<param name="sc_expt_ver_seq" type="12" value="" out="N"/>
				<param name="sc_expt_grp_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
