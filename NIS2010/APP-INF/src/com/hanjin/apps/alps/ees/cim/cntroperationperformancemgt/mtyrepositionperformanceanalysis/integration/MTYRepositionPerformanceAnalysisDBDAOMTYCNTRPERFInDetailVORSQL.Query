<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MTYRepositionPerformanceAnalysisDBDAOMTYCNTRPERFInDetailVORSQL">
			<desc><![CDATA[Movement Premance by CY 조회 쿼리
2010.09.02 남궁진호 [CHM-201005671-01]- 두개의 MVMT STS를 조회하는 경우 이전 이후 MVMT EVENT DATE 를  모두 보여주도록 수정함
  , EVENTDATE -> PRE-EVENT_DATE,POST_EVENT_DATE추가
2010.09.15 이병훈 [CHM-201005995-01] - ''Movement Performance by CY''의 BKG 데이터 I/F 로직 변경
2011.04.07 나상보 [CHM-201109997-01] - [CIM] Movement Performance by CY 기능 보완. SC_RFA_NO_TAA, SHPR, CNEE 추가
2011.06.03 신자영 [CHM-201111319-01] - [CIM] Movement Performance by CY의 Detail탭 조건 보완 요청
2011.11.21 신자영 [CHM-201114577-01] - MVMT BY CY 기능 보완
2012.02.22 신자영 [CHM-201216310-01] mvmt pfmc by cy 기능 보완
2012.05.23 신자영 [CHM-201217983-01] MVMT PFMC BY CY 기능에 검색 가능 MVMT 추가
2013.02.08 이영두 [CHM-201322887-01] MG 조건 NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' ) 조건 삭제
2013.07.30 이영두 [CHM-201325984] MVMT PFMC에 MO(MTY REPO OUT) 추가
2014.04.30 김창영 [CHM-201429600] Movement performance by CY Tab별 조회조건 추가]]></desc>
			<sql><![CDATA[
#if (${mtymvmt} == 'MTIDMG' || ${mtymvmt} == 'MTVDVD-MT' || ${mtymvmt} == 'MTOPOP-MT' || ${mtymvmt} == 'VLMTMT-VL' 
|| ${mtymvmt} == 'MTOCOC-MT' || ${mtymvmt} == 'OCIDID-OC'|| ${mtymvmt} == 'MTIDID-MT' ||${mtymvmt} == 'OPMTMT-OP'||${mtymvmt} == 'TNMTMT-TN'||
${mtymvmt} == 'ENMTMT-EN'||${mtymvmt} == 'IDICIC-ID'||${mtymvmt} == 'ENICIC-EN'||${mtymvmt} == 'TNICIC-TN')
#if (${mtymvmt} != 'MTOPOP-MT')
WITH MVMT AS(
#end
  SELECT  /*+ index( m xie6ctm_movement ) */
        M.CNMV_CO_CD AS company,
        M.CNTR_NO AS cntrNo,
        M.CNTR_TPSZ_CD AS tpsz,
        SUBSTR(@[mtymvmt],5) AS mvmt, 
        M.ORG_YD_CD AS yard ,
#if (${mtymvmt} != 'MTIDMG')
      (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
              TO_CHAR(MM.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI')  /*  PRE_MVMT_EVNT_DT */
         FROM CTM_MOVEMENT MM
        WHERE MM.CNTR_NO = M.CNTR_NO
          AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
              M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
          AND MM.MVMT_STS_CD = SUBSTR(@[mtymvmt],3,2)
          AND ROWNUM = 1) AS PRE_EVENTDATE,
        TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS POST_EVENTDATE,
#else
        TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS PRE_EVENTDATE,
        '' AS POST_EVENTDATE,
#end
        M.MVMT_CRE_TP_CD AS autoFlag,
        
#if (${mtymvmt} != 'MTOPOP-MT')        
        B.SLAN_CD AS lane,
#else
     (SELECT   /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ BB.SLAN_CD
         FROM CTM_MOVEMENT MM, BKG_BOOKING   BB
        WHERE MM.CNTR_NO = M.CNTR_NO
          AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
              M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
          AND MM.MVMT_STS_CD = SUBSTR('MTOPOP-MT',3,2)
          AND MM.BKG_NO    = BB.BKG_NO
          AND ROWNUM = 1) AS lane,
#end
     
        M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS tVvd,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
        (SELECT M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD
           FROM MDM_VSL_CNTR C
          WHERE M.CRNT_VSL_CD = C.VSL_CD
            AND C.FDR_DIV_CD  = 'O' 
        ) AS FVVD,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */

#if (${mtymvmt} != 'MTOPOP-MT')
        M.BKG_NO AS bkgNo,
        B.POR_CD as por,  /* POR CODE */
        B.POL_CD AS pol,
        B.POD_CD AS pod,
        B.DEL_CD AS del,  /* DEL CODE */
        B.PRE_RLY_PORT_CD,
        B.PST_RLY_PORT_CD,
		B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		(SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,

#else
     (SELECT   /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ BB.BKG_NO
         FROM CTM_MOVEMENT MM, BKG_BOOKING   BB
        WHERE MM.CNTR_NO = M.CNTR_NO
          AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
              M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
          AND MM.MVMT_STS_CD = SUBSTR('MTOPOP-MT',3,2)
          AND MM.BKG_NO    = BB.BKG_NO
          AND ROWNUM = 1) AS bkgNo,

      (SELECT  /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ BB.POR_CD 
         FROM CTM_MOVEMENT MM, BKG_BOOKING   BB
        WHERE MM.CNTR_NO = M.CNTR_NO
          AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
              M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
          AND MM.MVMT_STS_CD = SUBSTR('MTOPOP-MT',3,2)
          AND MM.BKG_NO    = BB.BKG_NO
          AND ROWNUM = 1) AS por,
 
       (SELECT  /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ BB.POL_CD 
         FROM CTM_MOVEMENT MM, BKG_BOOKING   BB
        WHERE MM.CNTR_NO = M.CNTR_NO
          AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
              M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
          AND MM.MVMT_STS_CD = SUBSTR('MTOPOP-MT',3,2)
          AND MM.BKG_NO    = BB.BKG_NO
          AND ROWNUM = 1) AS pol,
 
         (SELECT  /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ BB.POD_CD 
         FROM CTM_MOVEMENT MM, BKG_BOOKING   BB
        WHERE MM.CNTR_NO = M.CNTR_NO
          AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
              M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
          AND MM.MVMT_STS_CD = SUBSTR('MTOPOP-MT',3,2)
          AND MM.BKG_NO    = BB.BKG_NO
          AND ROWNUM = 1) AS pod, 
          
        (SELECT  /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ BB.DEL_CD 
         FROM CTM_MOVEMENT MM, BKG_BOOKING   BB
        WHERE MM.CNTR_NO = M.CNTR_NO
          AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
              M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
          AND MM.MVMT_STS_CD = SUBSTR('MTOPOP-MT',3,2)
          AND MM.BKG_NO    = BB.BKG_NO
          AND ROWNUM = 1) AS del,
(SELECT   /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ 
          REPLACE(SUBSTR(CC.CUST_NM,1,50),CHR(13)||CHR(10),' ')
         FROM CTM_MOVEMENT MM, BKG_BOOKING   BB, BKG_CUSTOMER CC
        WHERE MM.CNTR_NO = M.CNTR_NO
          AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
              M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
          AND MM.MVMT_STS_CD = SUBSTR('MTOPOP-MT',3,2)
          AND MM.BKG_NO    = BB.BKG_NO
          AND BB.BKG_NO    = CC.BKG_NO
          AND CC.BKG_CUST_TP_CD = 'S'
          AND ROWNUM = 1) AS SHPR,
(SELECT   /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ 
          REPLACE(SUBSTR(CC.CUST_NM,1,50),CHR(13)||CHR(10),' ')
         FROM CTM_MOVEMENT MM, BKG_BOOKING   BB, BKG_CUSTOMER CC
        WHERE MM.CNTR_NO = M.CNTR_NO
          AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
              M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
          AND MM.MVMT_STS_CD = SUBSTR('MTOPOP-MT',3,2)
          AND MM.BKG_NO    = BB.BKG_NO
          AND BB.BKG_NO    = CC.BKG_NO
          AND CC.BKG_CUST_TP_CD = 'C'
          AND ROWNUM = 1) AS CNEE,

#end

        M.CNTR_DMG_FLG AS damage,
        M.CNTR_DISP_FLG AS disposal,
        M.IMDT_EXT_FLG AS imdtExit ,
        M.CNTR_HNGR_RCK_FLG AS hngrRack,
        C.CNTR_HNGR_BAR_ATCH_KNT AS HNGRBARKNT,

#if (${mtymvmt} != 'MTOPOP-MT')
		B.RCV_TERM_CD AS rcvterm,
		B.DE_TERM_CD AS determ
#else
		'' AS rcvterm,
		'' AS determ
#end
		,(SELECT C.VNDR_SEQ
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_SEQ
        ,(SELECT C.VNDR_ABBR_NM
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_ABBR_NM
        ,C.LSTM_CD

   FROM CTM_MOVEMENT    M,
        MST_CONTAINER   C

#if (${mtymvmt} != 'MTOPOP-MT')
        ,BKG_BOOKING     B
#end
        
#if(${period} == 'D' || ${period} == 'M')
  WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#end
#if (${mtymvmt} != '')
    AND M.MVMT_STS_CD = SUBSTR(@[mtymvmt],0,2)
#end
    AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
    AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${lstmcd} != '')
    AND C.LSTM_CD  IN (
    #foreach($cntrlstmcd in ${vel_lstm_cd})
      '$cntrlstmcd',
      #end
      '')
#end
#if (${soc} == 'E')
    AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
    AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end

#if (${mtymvmt} != 'MTOPOP-MT')
    AND M.BKG_NO    = B.BKG_NO(+)
#end

/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
#if (${vvd_tp} == 'T' && ${vvd_nm} != '')
			AND M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD = @[vvd_nm]
#end
#if (${vvd_tp} == 'O' && ${vvd_nm} != '')
			AND M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD = @[vvd_nm]
			AND 'OK' = (SELECT 'OK'
						  FROM MDM_VSL_CNTR C
						 WHERE M.CRNT_VSL_CD = C.VSL_CD
						   AND C.FDR_DIV_CD  = 'O'
						   AND C.DELT_FLG = 'N'
					   )
#end
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */

#if (${inquiryLevel} == 'Y')
    AND M.ORG_YD_CD = @[location]
#else
    AND M.ORG_YD_CD IN (
                        SELECT  /*+ ORDERED USE_NL( G L Y )  */
                               Y.YD_CD
                          FROM MDM_EQ_ORZ_CHT G,
                               MDM_LOCATION L,
                               MDM_YARD Y
                         WHERE Y.LOC_CD = L.LOC_CD
                           AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                           AND G.SCC_CD = @[location]     /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                           AND G.LCC_CD = @[location]   /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                           AND G.ECC_CD = @[location]   /* inquiryLevel = 'ECC'*/
#elseif(${inquiryLevel} == 'R')
                           AND G.RCC_CD = @[location]   /* inquiryLevel = 'RCC'*/
#end
                        )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
    AND SUBSTR(@[mtymvmt],3,2)  = (
                                    SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                                           MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                                      FROM CTM_MOVEMENT MM
                                     WHERE MM.CNTR_NO = M.CNTR_NO
                                       AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                                           M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                                       AND ROWNUM = 1
                                  )
   /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
#if (${mtymvmt} != 'MTOPOP-MT')
)
SELECT A.*				
	  ,PRE.VSL_CD||PRE.SKD_VOY_NO||PRE.SKD_DIR_CD PRE_VVD_CD			
	  ,PST.VSL_CD||PST.SKD_VOY_NO||PST.SKD_DIR_CD PST_VVD_CD	
 FROM MVMT A, BKG_VVD PRE, BKG_VVD PST
WHERE 1=1
  AND A.bkgNo = PRE.BKG_NO(+)
  AND 'S' = PRE.VSL_PRE_PST_CD(+)					
  AND A.PRE_RLY_PORT_CD= PRE.POD_CD(+)					
  AND A.bkgNo = PST.BKG_NO(+)					
  AND A.PST_RLY_PORT_CD= PST.POL_CD(+)					
  AND 'U' = PST.VSL_PRE_PST_CD(+)
#end

#elseif(${mtymvmt} == 'VDMTVL')
WITH MVMT AS(
SELECT A.*
       ,(SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ 
                TO_CHAR(MM.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI')  /*  PRE_MVMT_EVNT_DT */
           FROM CTM_MOVEMENT MM
          WHERE MM.CNTR_NO = A.CNTRNO
            AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                A.PRE_CNMV_YR||TO_CHAR(A.PRE_CNMV_SEQ,'0000')||A.PRE_CNMV_SPLIT_NO
            AND ROWNUM = 1) AS PRE_EVENTDATE 
  FROM (SELECT  /*+ index( m xie6ctm_movement ) */
               (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                      MM.CNMV_YR  
                 FROM CTM_MOVEMENT MM
			    WHERE MM.CNTR_NO = M.CNTR_NO  
				  AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <         
					  M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                  AND ROWNUM = 1
                 ) PRE_CNMV_YR,     
               (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
					  MM.CNMV_SEQ  
		         FROM CTM_MOVEMENT MM
				WHERE MM.CNTR_NO = M.CNTR_NO  
				  AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <         
					  M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                  AND ROWNUM = 1
                 ) PRE_CNMV_SEQ,   
               (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
		              MM.CNMV_SPLIT_NO  
                 FROM CTM_MOVEMENT MM
				WHERE MM.CNTR_NO = M.CNTR_NO  
				  AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <         
					  M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                  AND ROWNUM = 1     
			     ) PRE_CNMV_SPLIT_NO,
               M.CNMV_CO_CD AS company,
               M.CNTR_NO AS cntrNo,
               M.CNTR_TPSZ_CD AS tpsz,
               'VD-MT-VL' AS mvmt, 
               M.ORG_YD_CD AS yard ,
               TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS POST_EVENTDATE,
               M.MVMT_CRE_TP_CD AS autoFlag,
               B.SLAN_CD AS lane,
               M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS tVvd,
               /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
               (SELECT M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD
                  FROM MDM_VSL_CNTR C
                 WHERE M.CRNT_VSL_CD = C.VSL_CD
                   AND C.FDR_DIV_CD  = 'O' 
               ) AS FVVD,
               /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */
               M.BKG_NO AS bkgNo,
               B.POR_CD as por,  /* POR CODE */
               B.POL_CD AS pol,
               B.POD_CD AS pod,
               B.DEL_CD AS del,  /* DEL CODE */
               B.PRE_RLY_PORT_CD,
               B.PST_RLY_PORT_CD,  
		       B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		      (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  SHPR
                 FROM BKG_CUSTOMER C
                WHERE B.BKG_NO = C.BKG_NO
                  AND C.BKG_CUST_TP_CD = 'S'
               ) SHPR,
              (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  CNEE
                 FROM BKG_CUSTOMER C
                WHERE B.BKG_NO = C.BKG_NO
                 AND C.BKG_CUST_TP_CD = 'C'
               ) CNEE,
              M.CNTR_DMG_FLG AS damage,
              M.CNTR_DISP_FLG AS disposal,
              M.IMDT_EXT_FLG AS imdtExit ,
              M.CNTR_HNGR_RCK_FLG AS hngrRack,
              C.CNTR_HNGR_BAR_ATCH_KNT AS HNGRBARKNT,
		      B.RCV_TERM_CD AS rcvterm,
		      B.DE_TERM_CD AS determ,
		     (SELECT C.VNDR_SEQ
		        FROM MDM_VENDOR C
		      WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
              ) VNDR_SEQ,
             (SELECT C.VNDR_ABBR_NM
		        FROM MDM_VENDOR C
		       WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
              ) VNDR_ABBR_NM,
              C.LSTM_CD
        FROM CTM_MOVEMENT M,
             MST_CONTAINER C,
             BKG_BOOKING B
#if(${period} == 'D' || ${period} == 'M')
       WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#end
         AND M.MVMT_STS_CD = 'VL'
         AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
         AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
            '$cntrtpszcd',
      #end
            '')
#end
#if (${lstmcd} != '')
         AND C.LSTM_CD  IN (
    #foreach($cntrlstmcd in ${vel_lstm_cd})
            '$cntrlstmcd',
      #end
            '')
#end
#if (${soc} == 'E')
        AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
        AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end
        AND M.BKG_NO    = B.BKG_NO(+)
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
#if (${vvd_tp} == 'T' && ${vvd_nm} != '')
	    AND M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD = @[vvd_nm]
#end
#if (${vvd_tp} == 'O' && ${vvd_nm} != '')
	    AND M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD = @[vvd_nm]
		AND 'OK' = (SELECT 'OK'
					  FROM MDM_VSL_CNTR C
					 WHERE M.CRNT_VSL_CD = C.VSL_CD
					   AND C.FDR_DIV_CD  = 'O'
					   AND C.DELT_FLG = 'N'
					)
#end
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */

#if (${inquiryLevel} == 'Y')
        AND M.ORG_YD_CD = @[location]
#else
        AND M.ORG_YD_CD IN (SELECT  /*+ ORDERED USE_NL( G L Y )  */
                                    Y.YD_CD
                              FROM MDM_EQ_ORZ_CHT G,
                                   MDM_LOCATION L,
                                   MDM_YARD Y
                             WHERE Y.LOC_CD = L.LOC_CD
                               AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                               AND G.SCC_CD = @[location]     /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                               AND G.LCC_CD = @[location]   /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                               AND G.ECC_CD = @[location]   /* inquiryLevel = 'ECC'*/
#elseif(${inquiryLevel} == 'R')
                               AND G.RCC_CD = @[location]   /* inquiryLevel = 'RCC'*/
#end
                        )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
        AND 'MT'  = (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                            MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                       FROM CTM_MOVEMENT MM
                      WHERE MM.CNTR_NO = M.CNTR_NO
                        AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                            M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                        AND ROWNUM = 1
                     )
   /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
) A
WHERE  'VD'  = (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ 
                       MM.MVMT_STS_CD  
                  FROM CTM_MOVEMENT MM
                 WHERE MM.CNTR_NO = A.CNTRNO
                   AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                       A.PRE_CNMV_YR||TO_CHAR(A.PRE_CNMV_SEQ,'0000')||A.PRE_CNMV_SPLIT_NO
                   AND ROWNUM = 1)
)
SELECT A.*				
	  ,PRE.VSL_CD||PRE.SKD_VOY_NO||PRE.SKD_DIR_CD PRE_VVD_CD			
	  ,PST.VSL_CD||PST.SKD_VOY_NO||PST.SKD_DIR_CD PST_VVD_CD	
 FROM MVMT A, BKG_VVD PRE, BKG_VVD PST
WHERE 1=1
  AND A.bkgNo = PRE.BKG_NO(+)
  AND 'S' = PRE.VSL_PRE_PST_CD(+)					
  AND A.PRE_RLY_PORT_CD= PRE.POD_CD(+)					
  AND A.bkgNo = PST.BKG_NO(+)					
  AND A.PST_RLY_PORT_CD= PST.POL_CD(+)					
  AND 'U' = PST.VSL_PRE_PST_CD(+)
#elseif(${mtymvmt} == 'VDMTTNENMTVL')
WITH MVMT AS(
SELECT AAA.*
       ,(SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */ 
                TO_CHAR(MM.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI')  /*  PRE_MVMT_EVNT_DT */
           FROM CTM_MOVEMENT MM
          WHERE MM.CNTR_NO = AAA.CNTRNO
            AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                AAA.AAPRE_CNMV_YR||TO_CHAR(AAA.AAPRE_CNMV_SEQ,'0000')||AAA.AAPRE_CNMV_SPLIT_NO
            AND ROWNUM = 1) AS PRE_EVENTDATE 
  FROM (SELECT  (SELECT  /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                       MM.CNMV_YR  
                 FROM CTM_MOVEMENT MM
			    WHERE MM.CNTR_NO = AA.CNTRNO  
				  AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <         
					  AA.APRE_CNMV_YR||TO_CHAR(AA.APRE_CNMV_SEQ,'0000')||AA.APRE_CNMV_SPLIT_NO
                  AND ROWNUM = 1
                 ) AAPRE_CNMV_YR,     
               (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */  
					  MM.CNMV_SEQ  
		         FROM CTM_MOVEMENT MM
				WHERE MM.CNTR_NO = AA.CNTRNO  
				  AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <         
					   AA.APRE_CNMV_YR||TO_CHAR(AA.APRE_CNMV_SEQ,'0000')||AA.APRE_CNMV_SPLIT_NO
                  AND ROWNUM = 1
                 ) AAPRE_CNMV_SEQ,   
               (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */  
		              MM.CNMV_SPLIT_NO  
                 FROM CTM_MOVEMENT MM
				WHERE MM.CNTR_NO = AA.CNTRNO  
				  AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <         
					  AA.PRE_CNMV_YR||TO_CHAR(AA.PRE_CNMV_SEQ,'0000')||AA.PRE_CNMV_SPLIT_NO
                  AND ROWNUM = 1     
			     ) AAPRE_CNMV_SPLIT_NO,
                 AA.*
           FROM (SELECT (SELECT  /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */   
                                 MM.CNMV_YR  
                           FROM CTM_MOVEMENT MM
			              WHERE MM.CNTR_NO = A.CNTRNO  
				            AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <         
					            A.PRE_CNMV_YR||TO_CHAR(A.PRE_CNMV_SEQ,'0000')||A.PRE_CNMV_SPLIT_NO
                            AND ROWNUM = 1
                         ) APRE_CNMV_YR,     
                        (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */  
					            MM.CNMV_SEQ  
		                   FROM CTM_MOVEMENT MM
				          WHERE MM.CNTR_NO = A.CNTRNO  
				            AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <         
					            A.PRE_CNMV_YR||TO_CHAR(A.PRE_CNMV_SEQ,'0000')||A.PRE_CNMV_SPLIT_NO
                            AND ROWNUM = 1
                         ) APRE_CNMV_SEQ,   
                        (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */  
		                        MM.CNMV_SPLIT_NO  
                           FROM CTM_MOVEMENT MM
				          WHERE MM.CNTR_NO = A.CNTRNO  
				            AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <         
					            A.PRE_CNMV_YR||TO_CHAR(A.PRE_CNMV_SEQ,'0000')||A.PRE_CNMV_SPLIT_NO
                            AND ROWNUM = 1     
			            ) APRE_CNMV_SPLIT_NO,
                        A.*
                  FROM (SELECT  /*+ index( m xie6ctm_movement ) */
                              (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                                      MM.CNMV_YR  
                                 FROM CTM_MOVEMENT MM
			                    WHERE MM.CNTR_NO = M.CNTR_NO  
				                  AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <         
					                  M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                                  AND ROWNUM = 1
                              ) PRE_CNMV_YR,     
                             (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
					                 MM.CNMV_SEQ  
		                        FROM CTM_MOVEMENT MM
				               WHERE MM.CNTR_NO = M.CNTR_NO  
				                 AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <         
					                 M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                                 AND ROWNUM = 1
                              ) PRE_CNMV_SEQ,   
                             (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
		                             MM.CNMV_SPLIT_NO  
                                FROM CTM_MOVEMENT MM
				               WHERE MM.CNTR_NO = M.CNTR_NO  
				                 AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <         
					                 M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                                 AND ROWNUM = 1     
			                  ) PRE_CNMV_SPLIT_NO,
                              M.CNMV_CO_CD AS company,
                              M.CNTR_NO AS cntrNo,
                              M.CNTR_TPSZ_CD AS tpsz,
                              'VD-MT-(TN or EN)-MT-VL' AS mvmt, 
                              M.ORG_YD_CD AS yard ,
                              TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS POST_EVENTDATE,
                              M.MVMT_CRE_TP_CD AS autoFlag,
                              B.SLAN_CD AS lane,
                              M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS tVvd,
               /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
                              (SELECT M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD
                                 FROM MDM_VSL_CNTR C
                                WHERE M.CRNT_VSL_CD = C.VSL_CD
                                  AND C.FDR_DIV_CD  = 'O' 
                               ) AS FVVD,
               /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */
                              M.BKG_NO AS bkgNo,
                              B.POR_CD as por,  /* POR CODE */
                              B.POL_CD AS pol,
                              B.POD_CD AS pod,
                              B.DEL_CD AS del,  /* DEL CODE */
                              B.PRE_RLY_PORT_CD,
                              B.PST_RLY_PORT_CD, 
		                      B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		                      (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  SHPR
                                 FROM BKG_CUSTOMER C
                                WHERE B.BKG_NO = C.BKG_NO
                                  AND C.BKG_CUST_TP_CD = 'S'
                               ) SHPR,
                              (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  CNEE
                                 FROM BKG_CUSTOMER C
                                WHERE B.BKG_NO = C.BKG_NO
                                  AND C.BKG_CUST_TP_CD = 'C'
                               ) CNEE,
                              M.CNTR_DMG_FLG AS damage,
                              M.CNTR_DISP_FLG AS disposal,
                              M.IMDT_EXT_FLG AS imdtExit ,
                              M.CNTR_HNGR_RCK_FLG AS hngrRack,
                              C.CNTR_HNGR_BAR_ATCH_KNT AS HNGRBARKNT,
		                      B.RCV_TERM_CD AS rcvterm,
		                      B.DE_TERM_CD AS determ,
		                      (SELECT C.VNDR_SEQ
		                         FROM MDM_VENDOR C
		                        WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
                               ) VNDR_SEQ,
                              (SELECT C.VNDR_ABBR_NM
		                         FROM MDM_VENDOR C
		                        WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
                               ) VNDR_ABBR_NM,
                              C.LSTM_CD
                         FROM CTM_MOVEMENT M,
                              MST_CONTAINER C,
                              BKG_BOOKING B
#if(${period} == 'D' || ${period} == 'M')
                        WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#end
                          AND M.MVMT_STS_CD = 'VL'
                          AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
                          AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
                                                  '$cntrtpszcd',
      #end
                                                  '')
#end
#if (${lstmcd} != '')
                          AND C.LSTM_CD  IN (
    #foreach($cntrlstmcd in ${vel_lstm_cd})
                                              '$cntrlstmcd',
      #end
                                             '')
#end
#if (${soc} == 'E')
                         AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
                         AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end
                         AND M.BKG_NO    = B.BKG_NO(+)
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
#if (${vvd_tp} == 'T' && ${vvd_nm} != '')
	                     AND M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD = @[vvd_nm]
#end
#if (${vvd_tp} == 'O' && ${vvd_nm} != '')
	                     AND M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD = @[vvd_nm]
		                 AND 'OK' = (SELECT 'OK'
					                   FROM MDM_VSL_CNTR C
					                  WHERE M.CRNT_VSL_CD = C.VSL_CD
					                    AND C.FDR_DIV_CD  = 'O'
					                    AND C.DELT_FLG = 'N'
					                 )
#end
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */

#if (${inquiryLevel} == 'Y')
                         AND M.ORG_YD_CD = @[location]
#else
                         AND M.ORG_YD_CD IN (SELECT /*+ ORDERED USE_NL( G L Y )  */
                                                    Y.YD_CD
                                               FROM MDM_EQ_ORZ_CHT G,
                                                    MDM_LOCATION L,
                                                    MDM_YARD Y
                                              WHERE Y.LOC_CD = L.LOC_CD
                                                AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                                                AND G.SCC_CD = @[location]     /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                                                AND G.LCC_CD = @[location]   /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                                                AND G.ECC_CD = @[location]   /* inquiryLevel = 'ECC'*/
#elseif(${inquiryLevel} == 'R')
                                                AND G.RCC_CD = @[location]   /* inquiryLevel = 'RCC'*/
#end
                                               )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
                        AND 'MT'  = (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                                            MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                                       FROM CTM_MOVEMENT MM
                                      WHERE MM.CNTR_NO = M.CNTR_NO
                                        AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                                            M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                        AND ROWNUM = 1
                     )
   /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
                     ) A
              WHERE 1=1 
                AND ('TN' = (SELECT  /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */  
                                    MM.MVMT_STS_CD  
                               FROM CTM_MOVEMENT MM
                              WHERE MM.CNTR_NO = A.CNTRNO
                                AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                                    A.PRE_CNMV_YR||TO_CHAR(A.PRE_CNMV_SEQ,'0000')||A.PRE_CNMV_SPLIT_NO
                                AND ROWNUM = 1)
                      OR
                     'EN' = (SELECT  /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */  
                                    MM.MVMT_STS_CD  
                               FROM CTM_MOVEMENT MM
                              WHERE MM.CNTR_NO = A.CNTRNO
                                AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                                    A.PRE_CNMV_YR||TO_CHAR(A.PRE_CNMV_SEQ,'0000')||A.PRE_CNMV_SPLIT_NO
                                AND ROWNUM = 1)
                      )            
               ) AA
          WHERE 1=1 
             AND 'MT'  = (SELECT  /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */  
                                  MM.MVMT_STS_CD  
                            FROM CTM_MOVEMENT MM
                           WHERE MM.CNTR_NO = AA.CNTRNO
                             AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                                 AA.APRE_CNMV_YR||TO_CHAR(AA.APRE_CNMV_SEQ,'0000')||AA.APRE_CNMV_SPLIT_NO
                             AND ROWNUM = 1)
         ) AAA
    WHERE 1=1
      AND 'VD'  = (SELECT  /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */  
                           MM.MVMT_STS_CD  
                     FROM CTM_MOVEMENT MM
                    WHERE MM.CNTR_NO = AAA.CNTRNO
                      AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                          AAA.AAPRE_CNMV_YR||TO_CHAR(AAA.AAPRE_CNMV_SEQ,'0000')||AAA.AAPRE_CNMV_SPLIT_NO
                      AND ROWNUM = 1)
)
SELECT A.*				
	  ,PRE.VSL_CD||PRE.SKD_VOY_NO||PRE.SKD_DIR_CD PRE_VVD_CD			
	  ,PST.VSL_CD||PST.SKD_VOY_NO||PST.SKD_DIR_CD PST_VVD_CD	
 FROM MVMT A, BKG_VVD PRE, BKG_VVD PST
WHERE 1=1
  AND A.bkgNo = PRE.BKG_NO(+)
  AND 'S' = PRE.VSL_PRE_PST_CD(+)					
  AND A.PRE_RLY_PORT_CD= PRE.POD_CD(+)					
  AND A.bkgNo = PST.BKG_NO(+)					
  AND A.PST_RLY_PORT_CD= PST.POL_CD(+)					
  AND 'U' = PST.VSL_PRE_PST_CD(+)
#elseif(${mtymvmt} == 'MP')
WITH MVMT AS(
  SELECT  /*+ INDEX( M XIE6CTM_MOVEMENT ) */
         COMPANY,
         CNTRNO,
         TPSZ,
         MVMT,
         YARD,
         TO_CHAR(EVENTDATE,'YYYY-MM-DD HH24:MI') AS PRE_EVENTDATE,
         ''  AS POST_EVENTDATE,
         AUTOFLAG,
         LANE,
         TVVD,
         FVVD,
         BKGNO,
         POR,
         POL,
         POD,
         DEL,
         PRE_RLY_PORT_CD,
         PST_RLY_PORT_CD,
         DAMAGE,
         DISPOSAL,
         IMDTEXIT,
         HNGRRACK,
         HNGRBARKNT,
		 SC_RFA_NO_TAA,
		 SHPR,
 		 CNEE,
		 RCVTERM,
		 DETERM,
         VNDR_SEQ,
         VNDR_ABBR_NM,
         LSTM_CD
  FROM
      (
        SELECT  /*+ INDEX( M XIE6CTM_MOVEMENT ) */
               M.CNMV_CO_CD AS COMPANY,
               M.CNTR_NO AS CNTRNO,
               M.CNTR_TPSZ_CD AS TPSZ,
               'MP' AS MVMT,
               M.ORG_YD_CD AS YARD ,
               M.CNMV_EVNT_DT AS EVENTDATE,
               M.MVMT_CRE_TP_CD AS AUTOFLAG,
               B.SLAN_CD AS LANE,
               M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS TVVD,
               /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
               (SELECT M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD
                  FROM MDM_VSL_CNTR C
                 WHERE M.CRNT_VSL_CD = C.VSL_CD
                   AND C.FDR_DIV_CD  = 'O' 
               ) AS FVVD,
               /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */
               M.BKG_NO AS BKGNO,
               B.POR_CD as POR, /* POR CODE */
               B.POL_CD AS POL,
               B.POD_CD AS POD,
               B.DEL_CD AS DEL, /* DEL CODE */
               B.PRE_RLY_PORT_CD,
               B.PST_RLY_PORT_CD,
               M.CNTR_DMG_FLG AS DAMAGE,
               M.CNTR_DISP_FLG AS DISPOSAL,
               M.IMDT_EXT_FLG AS IMDTEXIT ,
               M.CNTR_HNGR_RCK_FLG AS HNGRRACK,
               C.CNTR_HNGR_BAR_ATCH_KNT AS HNGRBARKNT,
	  		   B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
			   (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE, 
		B.RCV_TERM_CD AS RCVTERM,
		B.DE_TERM_CD AS DETERM
        ,(SELECT C.VNDR_SEQ
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_SEQ
        ,(SELECT C.VNDR_ABBR_NM
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_ABBR_NM
        ,C.LSTM_CD
          FROM CTM_MOVEMENT    M,
               MST_CONTAINER   C,
               BKG_BOOKING     B
#if(${period} == 'D' || ${period} == 'M')
         WHERE M.CNMV_EVNT_DT BETWEEN   TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#end
#if (${mtymvmt} != '')
           AND M.MVMT_STS_CD = 'MT'
#end
           AND M.CNTR_NO    = C.CNTR_NO
#if (${tpsz} != '')
           AND M.CNTR_TPSZ_CD  IN (
      #foreach($cntrtpszcd in ${vel_tpsz_cd})
        '$cntrtpszcd',
        #end
        '')
#end
#if (${lstmcd} != '')
    AND C.LSTM_CD  IN (
    #foreach($cntrlstmcd in ${vel_lstm_cd})
      '$cntrlstmcd',
      #end
      '')
#end
#if (${soc} == 'E')
           AND NVL(C.LSTM_CD, '  ') <> 'SH'
#elseif(${soc} == 'O')
           AND NVL(C.LSTM_CD, '  ') = 'SH'
#end
           AND NVL(M.MVMT_CRE_TP_CD,' ') NOT IN ( 'C','L' )
           
#if (${mtymvmt} != 'MTOPOP-MT')
           AND M.BKG_NO = B.BKG_NO(+)
#end

/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
#if (${vvd_tp} == 'T' && ${vvd_nm} != '')
			AND M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD = @[vvd_nm]
#end
#if (${vvd_tp} == 'O' && ${vvd_nm} != '')
			AND M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD = @[vvd_nm]
			AND 'OK' = (SELECT 'OK'
						  FROM MDM_VSL_CNTR C
						 WHERE M.CRNT_VSL_CD = C.VSL_CD
						   AND C.FDR_DIV_CD  = 'O'
						   AND C.DELT_FLG = 'N'
					   )
#end
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */

#if (${inquiryLevel} == 'Y')
           AND M.ORG_YD_CD = @[location]
#else
           AND M.ORG_YD_CD IN (
                               SELECT /*+ ORDERED USE_NL( G L Y )  */
                                      Y.YD_CD
                                 FROM MDM_EQ_ORZ_CHT G,
                                      MDM_LOCATION L,
                                      MDM_YARD Y
                                WHERE Y.LOC_CD = L.LOC_CD
                                  AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                                  AND G.SCC_CD = @[location]    /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                                  AND G.LCC_CD = @[location]    /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                                  AND G.ECC_CD = @[location]    /* inquiryLevel = 'ECC'*/
#elseif(${inquiryLevel} == 'R')
                                  AND G.RCC_CD = @[location]    /* inquiryLevel = 'RCC'*/
#end
                               )
#end
      /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
          AND 'XX'  = (
                        SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                              MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                          FROM CTM_MOVEMENT MM
                         WHERE MM.CNTR_NO = M.CNTR_NO
                           AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                               M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                           AND ROWNUM = 1
                      )
      /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
UNION ALL
  SELECT /*+ INDEX( M XIE6CTM_MOVEMENT ) */
         M.CNMV_CO_CD AS COMPANY,
         M.CNTR_NO AS CNTRNO,
         M.CNTR_TPSZ_CD AS TPSZ,
         'MP' AS MVMT,
         M.ORG_YD_CD AS YARD ,
         M.CNMV_EVNT_DT AS EVENTDATE,
         M.MVMT_CRE_TP_CD AS AUTOFLAG,
         B.SLAN_CD AS LANE,
         M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS TVVD,
         /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
         (SELECT M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD
            FROM MDM_VSL_CNTR C
           WHERE M.CRNT_VSL_CD = C.VSL_CD
             AND C.FDR_DIV_CD  = 'O' 
         ) AS FVVD,
         /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */
         M.BKG_NO AS BKGNO,
         B.POR_CD as POR, /* POR CODE */
         B.POL_CD AS POL,
         B.POD_CD AS POD,
         B.DEL_CD AS DEL, /* DEL CODE */
         B.PRE_RLY_PORT_CD,
         B.PST_RLY_PORT_CD,
         M.CNTR_DMG_FLG AS DAMAGE,
         M.CNTR_DISP_FLG AS DISPOSAL,
         M.IMDT_EXT_FLG AS IMDTEXIT ,
         M.CNTR_HNGR_RCK_FLG AS HNGRRACK,
         C.CNTR_HNGR_BAR_ATCH_KNT AS HNGRBARKNT,
		 B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		 (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		B.RCV_TERM_CD AS RCVTERM,
		B.DE_TERM_CD AS DETERM
        ,(SELECT C.VNDR_SEQ
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_SEQ
        ,(SELECT C.VNDR_ABBR_NM
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_ABBR_NM
        ,C.LSTM_CD
    FROM CTM_MOVEMENT    M,
         MST_CONTAINER   C,
         BKG_BOOKING     B
#if(${period} == 'D' || ${period} == 'M')
   WHERE M.CNMV_EVNT_DT BETWEEN   TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#end
#if (${mtymvmt} != '')
     AND M.MVMT_STS_CD = 'MT'
#end
     AND M.CNTR_NO    = C.CNTR_NO
#if (${tpsz} != '')
     AND M.CNTR_TPSZ_CD  IN (
      #foreach($cntrtpszcd in ${vel_tpsz_cd})
        '$cntrtpszcd',
        #end
        '')
#end
#if (${lstmcd} != '')
    AND C.LSTM_CD  IN (
    #foreach($cntrlstmcd in ${vel_lstm_cd})
      '$cntrlstmcd',
      #end
      '')
#end
#if (${soc} == 'E')
     AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc  */
#elseif(${soc} == 'O')
     AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc */
#end
     AND NVL(M.MVMT_CRE_TP_CD,' ') NOT IN ( 'C','L' )
     AND M.CNMV_CYC_NO    = 1
     AND M.BKG_NO = B.BKG_NO(+)

/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
#if (${vvd_tp} == 'T' && ${vvd_nm} != '')
	AND M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD = @[vvd_nm]
#end
#if (${vvd_tp} == 'O' && ${vvd_nm} != '')
	AND M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD = @[vvd_nm]
	AND 'OK' = (SELECT 'OK'
				  FROM MDM_VSL_CNTR C
				 WHERE M.CRNT_VSL_CD = C.VSL_CD
				   AND C.FDR_DIV_CD  = 'O'
				   AND C.DELT_FLG = 'N'
			   )
#end
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */

#if (${inquiryLevel} == 'Y')
     AND M.ORG_YD_CD = @[location]
#else
     AND M.ORG_YD_CD IN (
                         SELECT /*+ ORDERED USE_NL( G L Y )  */
                               Y.YD_CD
                          FROM MDM_EQ_ORZ_CHT G,
                               MDM_LOCATION L,
                               MDM_YARD Y
                         WHERE Y.LOC_CD = L.LOC_CD
                           AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                           AND G.SCC_CD = @[location]
#elseif(${inquiryLevel} == 'L')
                           AND G.LCC_CD = @[location]
#elseif(${inquiryLevel} == 'E')
                           AND G.ECC_CD = @[location]
#elseif(${inquiryLevel} == 'R')
                           AND G.RCC_CD = @[location]
#end
                        )
#end
      )
)
SELECT A.*				
	  ,PRE.VSL_CD||PRE.SKD_VOY_NO||PRE.SKD_DIR_CD PRE_VVD_CD			
	  ,PST.VSL_CD||PST.SKD_VOY_NO||PST.SKD_DIR_CD PST_VVD_CD	
 FROM MVMT A, BKG_VVD PRE, BKG_VVD PST
WHERE 1=1
  AND A.bkgNo = PRE.BKG_NO(+)
  AND 'S' = PRE.VSL_PRE_PST_CD(+)					
  AND A.PRE_RLY_PORT_CD= PRE.POD_CD(+)					
  AND A.bkgNo = PST.BKG_NO(+)					
  AND A.PST_RLY_PORT_CD= PST.POL_CD(+)					
  AND 'U' = PST.VSL_PRE_PST_CD(+)
#elseif(${mtymvmt} == 'MR')
WITH MVMT AS(
  SELECT  /*+ INDEX( M XIE6CTM_MOVEMENT ) */
         COMPANY,
         CNTRNO,
         TPSZ,
         MVMT,
         YARD,
         TO_CHAR(EVENTDATE,'YYYY-MM-DD HH24:MI') AS PRE_EVENTDATE,
         ''  AS POST_EVENTDATE,
         AUTOFLAG,
         LANE,
         TVVD,
         FVVD,
         BKGNO,
         POR,
         POL,
         POD,
         DEL,
         PRE_RLY_PORT_CD,
         PST_RLY_PORT_CD, 
         DAMAGE,
         DISPOSAL,
         IMDTEXIT,
         HNGRRACK,
         HNGRBARKNT,
		 SC_RFA_NO_TAA,
		 SHPR,
 		 CNEE, 
		 RCVTERM,
		 DETERM
         ,VNDR_SEQ
        ,VNDR_ABBR_NM
        ,LSTM_CD
   FROM (
         SELECT /*+ INDEX( M XIE6CTM_MOVEMENT ) */
                M.CNMV_CO_CD AS COMPANY,
                M.CNTR_NO AS CNTRNO,
                M.CNTR_TPSZ_CD AS TPSZ,
                'MR' AS MVMT,
                M.ORG_YD_CD AS YARD ,
                M.CNMV_EVNT_DT AS EVENTDATE,
                M.MVMT_CRE_TP_CD AS AUTOFLAG,
                B.SLAN_CD AS LANE,
                M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS TVVD,
                /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
                (SELECT M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD
                   FROM MDM_VSL_CNTR C
                  WHERE M.CRNT_VSL_CD = C.VSL_CD
                    AND C.FDR_DIV_CD  = 'O' 
                ) AS FVVD,
                /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */
                M.BKG_NO AS BKGNO,
                B.POR_CD as POR,  /* POR CODE */
                B.POL_CD AS POL,
                B.POD_CD AS POD,
                B.DEL_CD AS DEL,  /* DEL CODE */
                B.PRE_RLY_PORT_CD,
                B.PST_RLY_PORT_CD,
                M.CNTR_DMG_FLG AS DAMAGE,
                M.CNTR_DISP_FLG AS DISPOSAL,
                M.IMDT_EXT_FLG AS IMDTEXIT ,
                M.CNTR_HNGR_RCK_FLG AS HNGRRACK,
                C.CNTR_HNGR_BAR_ATCH_KNT AS HNGRBARKNT,
		 		B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		  	 	(SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		B.RCV_TERM_CD AS RCVTERM,
		B.DE_TERM_CD AS DETERM
        ,(SELECT C.VNDR_SEQ
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_SEQ
        ,(SELECT C.VNDR_ABBR_NM
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_ABBR_NM
        ,C.LSTM_CD
           FROM CTM_MOVEMENT      M,
                CIM_TP_SZ_DP_SEQ  S,
                MST_CONTAINER     C,
                BKG_BOOKING       B
#if (${period} == 'D' || ${period} == 'M')
          WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#end
#if (${mtymvmt} != '')
            AND M.MVMT_STS_CD = 'MT'
#end
            AND M.CNTR_TPSZ_CD = S.CNTR_TPSZ_CD
            AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
            AND M.CNTR_TPSZ_CD  IN (
      #foreach($cntrtpszcd in ${vel_tpsz_cd})
        '$cntrtpszcd',
        #end
        '')
#end
#if (${lstmcd} != '')
    AND C.LSTM_CD  IN (
    #foreach($cntrlstmcd in ${vel_lstm_cd})
      '$cntrlstmcd',
      #end
      '')
#end
#if (${soc} == 'E')
            AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
            AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end
            AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
            AND M.BKG_NO = B.BKG_NO(+)

/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
#if (${vvd_tp} == 'T' && ${vvd_nm} != '')
			AND M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD = @[vvd_nm]
#end
#if (${vvd_tp} == 'O' && ${vvd_nm} != '')
			AND M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD = @[vvd_nm]
			AND 'OK' = (SELECT 'OK'
						  FROM MDM_VSL_CNTR C
						 WHERE M.CRNT_VSL_CD = C.VSL_CD
						   AND C.FDR_DIV_CD  = 'O'
						   AND C.DELT_FLG = 'N'
					   )
#end
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */

#if (${inquiryLevel} == 'Y')
            AND M.ORG_YD_CD = @[location]
#else
            AND M.ORG_YD_CD IN (
                                SELECT  /*+ ORDERED USE_NL( G L Y )  */
                                       Y.YD_CD
                                  FROM MDM_EQ_ORZ_CHT G,
                                       MDM_LOCATION L,
                                       MDM_YARD Y
                                 WHERE Y.LOC_CD = L.LOC_CD
                                   AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                                   AND G.SCC_CD = @[location]     /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                                   AND G.LCC_CD = @[location]   /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                                   AND G.ECC_CD = @[location]   /* inquiryLevel = 'ECC'*/
#elseif(${inquiryLevel} == 'R')
                                   AND G.RCC_CD = @[location]   /* inquiryLevel = 'RCC'*/
#end
                                )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
            AND 'OK'  = (
                         SELECT /*+ ORDERED USE_NL(MM LL GG) INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
#if (${inquiryLevel} == 'S')
                                DECODE(GG.SCC_CD,@[location],'NO',
#elseif(${inquiryLevel} == 'L')
                                DECODE(GG.LCC_CD,@[location],'NO',
#elseif(${inquiryLevel} == 'E')
                                DECODE(GG.ECC_CD,@[location],'NO',
#elseif(${inquiryLevel} == 'R')
                                DECODE(GG.RCC_CD,@[location],'NO',
#elseif(${inquiryLevel} == 'Y')
                                DECODE(MM.ORG_YD_CD,@[location],'NO',
#end
                                DECODE(MM.MVMT_STS_CD,'EN','OK',
                                DECODE(MM.MVMT_STS_CD,'TN','OK','NO')))
                          --    MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                           FROM CTM_MOVEMENT  MM,
                                MDM_LOCATION  LL,
                                MDM_EQ_ORZ_CHT  GG
                          WHERE MM.CNTR_NO = M.CNTR_NO
                            AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                                M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                            AND SUBSTR(MM.ORG_YD_CD, 1, 5)  = LL.LOC_CD
                            AND LL.SCC_CD = GG.SCC_CD
                            AND ROWNUM    = 1
                         )
      /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
  )
)
SELECT A.*				
	  ,PRE.VSL_CD||PRE.SKD_VOY_NO||PRE.SKD_DIR_CD PRE_VVD_CD			
	  ,PST.VSL_CD||PST.SKD_VOY_NO||PST.SKD_DIR_CD PST_VVD_CD	
 FROM MVMT A, BKG_VVD PRE, BKG_VVD PST
WHERE 1=1
  AND A.bkgNo = PRE.BKG_NO(+)
  AND 'S' = PRE.VSL_PRE_PST_CD(+)					
  AND A.PRE_RLY_PORT_CD= PRE.POD_CD(+)					
  AND A.bkgNo = PST.BKG_NO(+)					
  AND A.PST_RLY_PORT_CD= PST.POL_CD(+)					
  AND 'U' = PST.VSL_PRE_PST_CD(+)

#elseif(${mtymvmt} == 'MO')
WITH MVMT AS(
  SELECT  /*+ INDEX( M XIE6CTM_MOVEMENT ) */
         COMPANY,
    CNTRNO,
    TPSZ,
    MVMT,
    YARD,
    TO_CHAR(EVENTDATE,'YYYY-MM-DD HH24:MI') AS PRE_EVENTDATE,
    ''  AS POST_EVENTDATE,
    AUTOFLAG,
    LANE,
    TVVD,
    FVVD,
    BKGNO,
    POR,
    POL,
    POD,
    DEL,
    PRE_RLY_PORT_CD,
    PST_RLY_PORT_CD, 
    DAMAGE,
    DISPOSAL,
    IMDTEXIT,
    HNGRRACK,
    HNGRBARKNT,
    SC_RFA_NO_TAA,
    SHPR,
    CNEE,
    RCVTERM,
    DETERM
    ,VNDR_SEQ
    ,VNDR_ABBR_NM
    ,LSTM_CD
FROM (
      SELECT 
          M.CNMV_CO_CD AS COMPANY,
          M.CNTR_NO AS CNTRNO,
          M.CNTR_TPSZ_CD AS TPSZ,
          'MO' AS MVMT,
          M.ORG_YD_CD AS YARD ,
          M.CNMV_EVNT_DT AS EVENTDATE,
          M.MVMT_CRE_TP_CD AS AUTOFLAG,
          B.SLAN_CD AS LANE,
          M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS TVVD,
          /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
          (SELECT M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD
             FROM MDM_VSL_CNTR C
            WHERE M.CRNT_VSL_CD = C.VSL_CD
              AND C.FDR_DIV_CD  = 'O' 
          ) AS FVVD,
          /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */
          M.BKG_NO AS BKGNO,
          B.POR_CD as POR,  
          B.POL_CD AS POL,
          B.POD_CD AS POD,
          B.DEL_CD AS DEL,
          B.PRE_RLY_PORT_CD,
          B.PST_RLY_PORT_CD,  
          M.CNTR_DMG_FLG AS DAMAGE,
          M.CNTR_DISP_FLG AS DISPOSAL,
          M.IMDT_EXT_FLG AS IMDTEXIT ,
          M.CNTR_HNGR_RCK_FLG AS HNGRRACK,
          C.CNTR_HNGR_BAR_ATCH_KNT AS HNGRBARKNT,
          B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
          (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  SHPR
          FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
          AND    C.BKG_CUST_TP_CD = 'S'
          ) SHPR,
          (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  CNEE
          FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
          AND    C.BKG_CUST_TP_CD = 'C'
          ) CNEE,
          B.RCV_TERM_CD AS RCVTERM,
          B.DE_TERM_CD AS DETERM
          ,(SELECT C.VNDR_SEQ
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_SEQ
        ,(SELECT C.VNDR_ABBR_NM
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_ABBR_NM
        ,C.LSTM_CD
      FROM CTM_MOVEMENT      M,
          CIM_TP_SZ_DP_SEQ  S,
          MST_CONTAINER     C,
          BKG_BOOKING       B

#if (${period} == 'D' || ${period} == 'M')
          WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#end
#if (${mtymvmt} != '')
            AND M.MVMT_STS_CD IN ('TN', 'EN')
#end
            AND M.CNTR_TPSZ_CD = S.CNTR_TPSZ_CD
            AND M.CNTR_NO = C.CNTR_NO
            AND M.FCNTR_FLG = 'N'
#if (${tpsz} != '')
            AND M.CNTR_TPSZ_CD  IN (
      #foreach($cntrtpszcd in ${vel_tpsz_cd})
        '$cntrtpszcd',
        #end
        '')
#end
#if (${lstmcd} != '')
    AND C.LSTM_CD  IN (
    #foreach($cntrlstmcd in ${vel_lstm_cd})
      '$cntrlstmcd',
      #end
      '')
#end
#if (${soc} == 'E')
            AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
            AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end
            AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
            AND M.BKG_NO = B.BKG_NO(+)

/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
#if (${vvd_tp} == 'T' && ${vvd_nm} != '')
			AND M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD = @[vvd_nm]
#end
#if (${vvd_tp} == 'O' && ${vvd_nm} != '')
			AND M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD = @[vvd_nm]
			AND 'OK' = (SELECT 'OK'
						  FROM MDM_VSL_CNTR C
						 WHERE M.CRNT_VSL_CD = C.VSL_CD
						   AND C.FDR_DIV_CD  = 'O'
						   AND C.DELT_FLG = 'N'
					   )
#end
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */

#if (${inquiryLevel} == 'Y')
            AND M.ORG_YD_CD = @[location]
#else
            AND M.ORG_YD_CD IN (
                                SELECT  /*+ ORDERED USE_NL( G L Y )  */
                                       Y.YD_CD
                                  FROM MDM_EQ_ORZ_CHT G,
                                       MDM_LOCATION L,
                                       MDM_YARD Y
                                 WHERE Y.LOC_CD = L.LOC_CD
                                   AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                                   AND G.SCC_CD = @[location]     /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                                   AND G.LCC_CD = @[location]   /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                                   AND G.ECC_CD = @[location]   /* inquiryLevel = 'ECC'*/
#elseif(${inquiryLevel} == 'R')
                                   AND G.RCC_CD = @[location]   /* inquiryLevel = 'RCC'*/
#end
                                )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic */
            AND 'OK'  = (
                         SELECT /*+ ORDERED USE_NL(MM LL GG) INDEX_ASC ( MM XFN1CTM_MOVEMENT ) */
#if (${inquiryLevel} == 'S')
                                DECODE(GG.SCC_CD,@[location],'NO',
#elseif(${inquiryLevel} == 'L')
                                DECODE(GG.LCC_CD,@[location],'NO',
#elseif(${inquiryLevel} == 'E')
                                DECODE(GG.ECC_CD,@[location],'NO',
#elseif(${inquiryLevel} == 'R')
                                DECODE(GG.RCC_CD,@[location],'NO',
#elseif(${inquiryLevel} == 'Y')
                                DECODE(MM.ORG_YD_CD,@[location],'NO',
#end
                                DECODE(M.MVMT_STS_CD,'EN','OK',
                DECODE(M.MVMT_STS_CD,'TN','OK','NO')))
            FROM CTM_MOVEMENT  MM,
                MDM_LOCATION  LL,
                MDM_EQ_ORZ_CHT  GG
            WHERE MM.CNTR_NO = M.CNTR_NO
            AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO >
                M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
            AND SUBSTR(MM.ORG_YD_CD, 1, 5)  = LL.LOC_CD
            AND LL.SCC_CD = GG.SCC_CD
            AND MM.MVMT_STS_CD = 'MT'        
            AND MM.CNMV_CYC_NO = M.CNMV_CYC_NO
            AND	MM.FCNTR_FLG = 'N'
            AND ROWNUM    = 1 
                         )
      /* <---------------- 2010.05.13 Pre MVMT STS Check Logic  */

     
  )
)
SELECT A.*				
	  ,PRE.VSL_CD||PRE.SKD_VOY_NO||PRE.SKD_DIR_CD PRE_VVD_CD			
	  ,PST.VSL_CD||PST.SKD_VOY_NO||PST.SKD_DIR_CD PST_VVD_CD	
 FROM MVMT A, BKG_VVD PRE, BKG_VVD PST
WHERE 1=1
  AND A.bkgNo = PRE.BKG_NO(+)
  AND 'S' = PRE.VSL_PRE_PST_CD(+)					
  AND A.PRE_RLY_PORT_CD= PRE.POD_CD(+)					
  AND A.bkgNo = PST.BKG_NO(+)					
  AND A.PST_RLY_PORT_CD= PST.POL_CD(+)					
  AND 'U' = PST.VSL_PRE_PST_CD(+)

#elseif(${mtymvmt} == 'MT')
WITH MVMT AS(
  SELECT  /*+ index( m xie6ctm_movement ) */
         M.CNMV_CO_CD AS company,
         M.CNTR_NO AS cntrNo,
         M.CNTR_TPSZ_CD AS tpsz,
         'MG' AS mvmt,
         M.ORG_YD_CD AS yard ,
         TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS PRE_EVENTDATE,
         '' AS POST_EVENTDATE,
         M.MVMT_CRE_TP_CD AS autoFlag,
         B.SLAN_CD AS lane,
         M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS tVvd,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
        (SELECT M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD
           FROM MDM_VSL_CNTR C
          WHERE M.CRNT_VSL_CD = C.VSL_CD
            AND C.FDR_DIV_CD  = 'O' 
        )fVvd,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */
         M.BKG_NO AS bkgNo,
         B.POR_CD as por, /* POR CODE */
         B.POL_CD AS pol,
         B.POD_CD AS pod,
         B.DEL_CD AS del, /* DEL CODE */
         B.PRE_RLY_PORT_CD,
         B.PST_RLY_PORT_CD,
         M.CNTR_DMG_FLG AS damage,
         M.CNTR_DISP_FLG AS disposal,
         M.IMDT_EXT_FLG AS imdtExit ,
         M.CNTR_HNGR_RCK_FLG AS hngrRack,
         C.CNTR_HNGR_BAR_ATCH_KNT AS HNGRBARKNT,
 		 B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		 (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		B.RCV_TERM_CD AS rcvTerm,
		B.DE_TERM_CD AS deTerm
        ,(SELECT C.VNDR_SEQ
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_SEQ
        ,(SELECT C.VNDR_ABBR_NM
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_ABBR_NM
        ,C.LSTM_CD
    FROM CTM_MOVEMENT     M,
         MST_CONTAINER    C,
         BKG_BOOKING      B
#if(${period} == 'D' || ${period} == 'M')
   WHERE M.CNMV_EVNT_DT BETWEEN   TO_DATE( @[from], 'YYYYMMDD') + .0
     AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#end
#if (${mtymvmt} != '')
     AND M.MVMT_STS_CD = 'MT'
#end
     AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
     AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${lstmcd} != '')
    AND C.LSTM_CD  IN (
    #foreach($cntrlstmcd in ${vel_lstm_cd})
      '$cntrlstmcd',
      #end
      '')
#end
#if (${soc} == 'E')
     AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc  */
#elseif(${soc} == 'O')
     AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc */
#end
     AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
     AND M.BKG_NO   = B.BKG_NO(+)

/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
#if (${vvd_tp} == 'T' && ${vvd_nm} != '')
	AND M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD = @[vvd_nm]
#end
#if (${vvd_tp} == 'O' && ${vvd_nm} != '')
	AND M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD = @[vvd_nm]
	AND 'OK' = (SELECT 'OK'
				  FROM MDM_VSL_CNTR C
				 WHERE M.CRNT_VSL_CD = C.VSL_CD
				   AND C.FDR_DIV_CD  = 'O'
				   AND C.DELT_FLG = 'N'
			   )
#end
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */

#if (${inquiryLevel} == 'Y')
     AND M.ORG_YD_CD = @[location]
#else
     AND M.ORG_YD_CD IN (
                         SELECT /*+ ORDERED USE_NL( G L Y )  */
                                Y.YD_CD
                           FROM MDM_EQ_ORZ_CHT G,
                                MDM_LOCATION L,
                                MDM_YARD Y
                          WHERE Y.LOC_CD = L.LOC_CD
                            AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                            AND G.SCC_CD = @[location] /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                            AND G.LCC_CD = @[location]    /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                            AND G.ECC_CD = @[location]    /* inquiryLevel = 'ECC'*/
#elseif(${inquiryLevel} == 'R')
                            AND G.RCC_CD = @[location]    /* inquiryLevel = 'RCC'*/
#end
                      )
    #end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
    AND   'ID'  = (
                   SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                           MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                     FROM CTM_MOVEMENT MM
                    WHERE MM.CNTR_NO = M.CNTR_NO
                      AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                          M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                      AND ROWNUM = 1
                  )
    /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
UNION ALL
  SELECT  /*+ INDEX( M XIE6CTM_MOVEMENT ) */
         M.CNMV_CO_CD AS COMPANY,
         M.CNTR_NO AS CNTRNO,
         M.CNTR_TPSZ_CD AS TPSZ,
         'MP' AS MVMT,
         M.ORG_YD_CD AS YARD ,
         TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS PRE_EVENTDATE,
         '' AS POST_EVENTDATE,
         M.MVMT_CRE_TP_CD AS AUTOFLAG,
         B.SLAN_CD AS LANE,
         M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS TVVD,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
        (SELECT M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD
           FROM MDM_VSL_CNTR C
          WHERE M.CRNT_VSL_CD = C.VSL_CD
            AND C.FDR_DIV_CD  = 'O' 
        )fVvd,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */
         M.BKG_NO AS BKGNO,
         B.POR_CD as POR, /* POR CODE */
         B.POL_CD AS POL,
         B.POD_CD AS POD,
         B.DEL_CD AS DEL, /* DEL CODE */
         B.PRE_RLY_PORT_CD,
         B.PST_RLY_PORT_CD,
         M.CNTR_DMG_FLG AS DAMAGE,
         M.CNTR_DISP_FLG AS DISPOSAL,
         M.IMDT_EXT_FLG AS IMDTEXIT ,
         M.CNTR_HNGR_RCK_FLG AS HNGRRACK,
         C.CNTR_HNGR_BAR_ATCH_KNT AS HNGRBARKNT,
 		 B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		 (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		B.RCV_TERM_CD AS RCVTERM,
		B.DE_TERM_CD AS DETERM
        ,(SELECT C.VNDR_SEQ
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_SEQ
        ,(SELECT C.VNDR_ABBR_NM
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_ABBR_NM
        ,C.LSTM_CD
    FROM CTM_MOVEMENT    M,
         MST_CONTAINER   C,
         BKG_BOOKING     B
#if(${period} == 'D' || ${period} == 'M')
   WHERE M.CNMV_EVNT_DT BETWEEN   TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#end
#if (${mtymvmt} != '')
     AND M.MVMT_STS_CD = 'MT'
#end
     AND M.CNTR_NO    = C.CNTR_NO
#if (${tpsz} != '')
     AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${lstmcd} != '')
    AND C.LSTM_CD  IN (
    #foreach($cntrlstmcd in ${vel_lstm_cd})
      '$cntrlstmcd',
      #end
      '')
#end
#if (${soc} == 'E')
     AND NVL(C.LSTM_CD, '  ') <> 'SH'
#elseif(${soc} == 'O')
     AND NVL(C.LSTM_CD, '  ') = 'SH'
#end
     AND NVL(M.MVMT_CRE_TP_CD,' ') NOT IN ( 'C','L' )
     AND M.BKG_NO = B.BKG_NO(+)

/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
#if (${vvd_tp} == 'T' && ${vvd_nm} != '')
	AND M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD = @[vvd_nm]
#end
#if (${vvd_tp} == 'O' && ${vvd_nm} != '')
	AND M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD = @[vvd_nm]
	AND 'OK' = (SELECT 'OK'
				  FROM MDM_VSL_CNTR C
				 WHERE M.CRNT_VSL_CD = C.VSL_CD
				   AND C.FDR_DIV_CD  = 'O'
				   AND C.DELT_FLG = 'N'
			   )
#end
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */

#if (${inquiryLevel} == 'Y')
     AND M.ORG_YD_CD = @[location]
#else
     AND M.ORG_YD_CD IN (
                         SELECT   /*+ ORDERED USE_NL( G L Y )  */
                                Y.YD_CD
                           FROM MDM_EQ_ORZ_CHT G,
                                MDM_LOCATION L,
                                MDM_YARD Y
                          WHERE Y.LOC_CD = L.LOC_CD
                            AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                            AND G.SCC_CD = @[location] /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                            AND G.LCC_CD = @[location] /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                            AND G.ECC_CD = @[location] /* inquiryLevel = 'ECC'*/
#elseif(${inquiryLevel} == 'R')
                            AND G.RCC_CD = @[location] /* inquiryLevel = 'RCC'*/
#end
                        )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
     AND 'XX' = (
                  SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                        MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                    FROM CTM_MOVEMENT MM
                   WHERE MM.CNTR_NO = M.CNTR_NO
                     AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                         M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                     AND ROWNUM = 1
                )
    /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
UNION ALL
  SELECT  /*+ INDEX( M XIE6CTM_MOVEMENT ) */
        M.CNMV_CO_CD AS COMPANY,
        M.CNTR_NO AS CNTRNO,
        M.CNTR_TPSZ_CD AS TPSZ,
        'MP' AS MVMT,
        M.ORG_YD_CD AS YARD ,
        TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS PRE_EVENTDATE,
        '' AS POST_EVENTDATE,
        M.MVMT_CRE_TP_CD AS AUTOFLAG,
        B.SLAN_CD AS LANE,
        M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS TVVD,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
        (SELECT M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD
           FROM MDM_VSL_CNTR C
          WHERE M.CRNT_VSL_CD = C.VSL_CD
            AND C.FDR_DIV_CD  = 'O' 
        )fVvd,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */
        M.BKG_NO AS BKGNO,
        B.POR_CD as POR,  /* POR CODE */
        B.POL_CD AS POL,
        B.POD_CD AS POD,
        B.DEL_CD AS DEL,  /* DEL CODE */
        B.PRE_RLY_PORT_CD,
        B.PST_RLY_PORT_CD,
        M.CNTR_DMG_FLG AS DAMAGE,
        M.CNTR_DISP_FLG AS DISPOSAL,
        M.IMDT_EXT_FLG AS IMDTEXIT ,
        M.CNTR_HNGR_RCK_FLG AS HNGRRACK,
        C.CNTR_HNGR_BAR_ATCH_KNT AS HNGRBARKNT,
 		B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		(SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		B.RCV_TERM_CD AS RCVTERM,
		B.DE_TERM_CD AS DETERM
        ,(SELECT C.VNDR_SEQ
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_SEQ
        ,(SELECT C.VNDR_ABBR_NM
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_ABBR_NM
        ,C.LSTM_CD
   FROM CTM_MOVEMENT    M,
        MST_CONTAINER   C,
        BKG_BOOKING     B

#if(${period} == 'D' || ${period} == 'M')
  WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#end
#if (${mtymvmt} != '')
    AND M.MVMT_STS_CD = 'MT'
#end
    AND M.CNTR_NO   = C.CNTR_NO
#if (${tpsz} != '')
    AND  M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${lstmcd} != '')
    AND C.LSTM_CD  IN (
    #foreach($cntrlstmcd in ${vel_lstm_cd})
      '$cntrlstmcd',
      #end
      '')
#end
#if (${soc} == 'E')
    AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
    AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end
    AND NVL(M.MVMT_CRE_TP_CD,' ') NOT IN ( 'C','L' )
    AND M.CNMV_CYC_NO   = 1
    AND M.BKG_NO = B.BKG_NO(+)

/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
#if (${vvd_tp} == 'T' && ${vvd_nm} != '')
	AND M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD = @[vvd_nm]
#end
#if (${vvd_tp} == 'O' && ${vvd_nm} != '')
	AND M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD = @[vvd_nm]
	AND 'OK' = (SELECT 'OK'
				  FROM MDM_VSL_CNTR C
				 WHERE M.CRNT_VSL_CD = C.VSL_CD
				   AND C.FDR_DIV_CD  = 'O'
				   AND C.DELT_FLG = 'N'
			   )
#end
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */

#if (${inquiryLevel} == 'Y')
    AND M.ORG_YD_CD = @[location]
#else
    AND M.ORG_YD_CD IN (
                        SELECT  /*+ ORDERED USE_NL( G L Y )  */
                               Y.YD_CD
                          FROM MDM_EQ_ORZ_CHT G,
                               MDM_LOCATION L,
                               MDM_YARD Y
                         WHERE Y.LOC_CD = L.LOC_CD
                           AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                           AND G.SCC_CD = @[location]
#elseif(${inquiryLevel} == 'L')
                           AND G.LCC_CD = @[location]
#elseif(${inquiryLevel} == 'E')
                           AND G.ECC_CD = @[location]
#elseif(${inquiryLevel} == 'R')
                           AND G.RCC_CD = @[location]
#end
                       )
#end
UNION ALL
  SELECT  /*+ INDEX( M XIE6CTM_MOVEMENT ) */
        M.CNMV_CO_CD AS COMPANY,
        M.CNTR_NO AS CNTRNO,
        M.CNTR_TPSZ_CD AS TPSZ,
        'MR' AS MVMT,
        M.ORG_YD_CD AS YARD ,
        TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS PRE_EVENTDATE,
        '' AS POST_EVENTDATE,
        M.MVMT_CRE_TP_CD AS AUTOFLAG,
        B.SLAN_CD AS LANE,
        M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS TVVD,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
        (SELECT M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD
           FROM MDM_VSL_CNTR C
          WHERE M.CRNT_VSL_CD = C.VSL_CD
            AND C.FDR_DIV_CD  = 'O' 
        )fVvd,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */
        M.BKG_NO AS BKGNO,
        B.POR_CD as POR,  /* POR CODE */
        B.POL_CD AS POL,
        B.POD_CD AS POD,
        B.DEL_CD AS DEL,  /* DEL CODE */
        B.PRE_RLY_PORT_CD,
        B.PST_RLY_PORT_CD,
        M.CNTR_DMG_FLG AS DAMAGE,
        M.CNTR_DISP_FLG AS DISPOSAL,
        M.IMDT_EXT_FLG AS IMDTEXIT ,
        M.CNTR_HNGR_RCK_FLG AS HNGRRACK,
        C.CNTR_HNGR_BAR_ATCH_KNT AS HNGRBARKNT,
 		B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		(SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		B.RCV_TERM_CD AS RCVTERM,
		B.DE_TERM_CD AS DETERM
        ,(SELECT C.VNDR_SEQ
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_SEQ
        ,(SELECT C.VNDR_ABBR_NM
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_ABBR_NM
        ,C.LSTM_CD
   FROM CTM_MOVEMENT      M,
        CIM_TP_SZ_DP_SEQ  S,
        MST_CONTAINER     C,
        BKG_BOOKING       B
#if (${period} == 'D' || ${period} == 'M')
  WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#end
#if (${mtymvmt} != '')
    AND M.MVMT_STS_CD = 'MT'
#end
    AND M.CNTR_TPSZ_CD = S.CNTR_TPSZ_CD
    AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
    AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${lstmcd} != '')
    AND C.LSTM_CD  IN (
    #foreach($cntrlstmcd in ${vel_lstm_cd})
      '$cntrlstmcd',
      #end
      '')
#end
#if (${soc} == 'E')
    AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
    AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end
    AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
    AND M.BKG_NO = B.BKG_NO(+)

/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
#if (${vvd_tp} == 'T' && ${vvd_nm} != '')
	AND M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD = @[vvd_nm]
#end
#if (${vvd_tp} == 'O' && ${vvd_nm} != '')
	AND M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD = @[vvd_nm]
	AND 'OK' = (SELECT 'OK'
				  FROM MDM_VSL_CNTR C
				 WHERE M.CRNT_VSL_CD = C.VSL_CD
				   AND C.FDR_DIV_CD  = 'O'
				   AND C.DELT_FLG = 'N'
			   )
#end
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */

#if (${inquiryLevel} == 'Y')
    AND M.ORG_YD_CD = @[location]
#else
    AND M.ORG_YD_CD IN (
                        SELECT  /*+ ORDERED USE_NL( G L Y )  */
                               Y.YD_CD
                          FROM MDM_EQ_ORZ_CHT G,
                               MDM_LOCATION L,
                               MDM_YARD Y
                         WHERE Y.LOC_CD = L.LOC_CD
                           AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
     AND G.SCC_CD = @[location]     /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
     AND G.LCC_CD = @[location]   /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
     AND G.ECC_CD = @[location]   /* inquiryLevel = 'ECC'*/
#elseif(${inquiryLevel} == 'R')
     AND G.RCC_CD = @[location]   /* inquiryLevel = 'RCC'*/
#end
                       )
#end
      /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
     AND 'OK' = (
                 SELECT /*+ ORDERED USE_NL(MM LL GG) INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
#if (${inquiryLevel} == 'S')
                        DECODE(GG.SCC_CD,@[location],'NO',
#elseif(${inquiryLevel} == 'L')
                        DECODE(GG.LCC_CD,@[location],'NO',
#elseif(${inquiryLevel} == 'E')
                        DECODE(GG.ECC_CD,@[location],'NO',
#elseif(${inquiryLevel} == 'R')
                        DECODE(GG.RCC_CD,@[location],'NO',
#elseif(${inquiryLevel} == 'Y')
                        DECODE(MM.ORG_YD_CD,@[location],'NO',
#end
                        DECODE(MM.MVMT_STS_CD,'EN','OK',
                        DECODE(MM.MVMT_STS_CD,'TN','OK','NO')))

                  --    MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                  FROM CTM_MOVEMENT MM,
                       MDM_LOCATION LL,
                       MDM_EQ_ORZ_CHT GG
                 WHERE MM.CNTR_NO = M.CNTR_NO
                   AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                       M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                   AND SUBSTR(MM.ORG_YD_CD, 1, 5) = LL.LOC_CD
                   AND LL.SCC_CD  = GG.SCC_CD
                   AND ROWNUM   = 1
                  )
    /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
UNION ALL
  SELECT  /*+ index( m xie6ctm_movement ) */
         M.CNMV_CO_CD AS company,
         M.CNTR_NO AS cntrNo,
         M.CNTR_TPSZ_CD AS tpsz,
         'VD-MT' AS mvmt,
         M.ORG_YD_CD AS yard ,
         (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                 TO_CHAR(MM.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI')  /*  PRE_MVMT_EVNT_DT */
            FROM CTM_MOVEMENT MM
           WHERE MM.CNTR_NO = M.CNTR_NO
             AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                 M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
             AND MM.MVMT_STS_CD = 'VD'
             AND ROWNUM = 1) AS PRE_EVENTDATE,
         TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS POST_EVENTDATE,
         M.MVMT_CRE_TP_CD AS autoFlag,
         B.SLAN_CD AS lane,
         M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS tVvd,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
        (SELECT M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD
           FROM MDM_VSL_CNTR C
          WHERE M.CRNT_VSL_CD = C.VSL_CD
            AND C.FDR_DIV_CD  = 'O' 
        )fVvd,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */
         M.BKG_NO AS bkgNo,
         B.POR_CD as por, /* POR CODE */
         B.POL_CD AS pol,
         B.POD_CD AS pod,
         B.DEL_CD AS del, /* DEL CODE */
         B.PRE_RLY_PORT_CD,
         B.PST_RLY_PORT_CD,
         M.CNTR_DMG_FLG AS damage,
         M.CNTR_DISP_FLG AS disposal,
         M.IMDT_EXT_FLG AS imdtExit ,
         M.CNTR_HNGR_RCK_FLG AS hngrRack,
         C.CNTR_HNGR_BAR_ATCH_KNT AS HNGRBARKNT,
 		 B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		 (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		B.RCV_TERM_CD AS RCVTERM,
		B.DE_TERM_CD AS DETERM
        ,(SELECT C.VNDR_SEQ
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_SEQ
        ,(SELECT C.VNDR_ABBR_NM
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_ABBR_NM
        ,C.LSTM_CD
   FROM CTM_MOVEMENT    M,
        MST_CONTAINER   C,
        BKG_BOOKING     B
#if(${period} == 'D' || ${period} == 'M')
   WHERE M.CNMV_EVNT_DT BETWEEN   TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#end
#if (${mtymvmt} != '')
     AND M.MVMT_STS_CD = 'MT'
#end
     AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
     AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${lstmcd} != '')
    AND C.LSTM_CD  IN (
    #foreach($cntrlstmcd in ${vel_lstm_cd})
      '$cntrlstmcd',
      #end
      '')
#end
#if (${soc} == 'E')
     AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc  */
#elseif(${soc} == 'O')
     AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc */
#end
  --AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
     AND M.BKG_NO   = B.BKG_NO(+)

/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
#if (${vvd_tp} == 'T' && ${vvd_nm} != '')
	AND M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD = @[vvd_nm]
#end
#if (${vvd_tp} == 'O' && ${vvd_nm} != '')
	AND M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD = @[vvd_nm]
	AND 'OK' = (SELECT 'OK'
				  FROM MDM_VSL_CNTR C
				 WHERE M.CRNT_VSL_CD = C.VSL_CD
				   AND C.FDR_DIV_CD  = 'O'
				   AND C.DELT_FLG = 'N'
			   )
#end
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */

#if (${inquiryLevel} == 'Y')
     AND M.ORG_YD_CD = @[location]
#else
     AND M.ORG_YD_CD IN (
                         SELECT /*+ ORDERED USE_NL( G L Y )  */
                                Y.YD_CD
                           FROM MDM_EQ_ORZ_CHT G,
                                MDM_LOCATION L,
                                MDM_YARD Y
                          WHERE Y.LOC_CD = L.LOC_CD
                            AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                            AND G.SCC_CD = @[location]    /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                            AND G.LCC_CD = @[location]    /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                            AND G.ECC_CD = @[location]    /* inquiryLevel = 'ECC'*/
#elseif(${inquiryLevel} == 'R')
                            AND G.RCC_CD = @[location]    /* inquiryLevel = 'RCC'*/
#end
                         )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
     AND 'VD' = (
                  SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                        MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                    FROM CTM_MOVEMENT MM
                   WHERE MM.CNTR_NO = M.CNTR_NO
                     AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                         M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                     AND ROWNUM = 1
                )
    /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
)
SELECT A.*				
	  ,PRE.VSL_CD||PRE.SKD_VOY_NO||PRE.SKD_DIR_CD PRE_VVD_CD			
	  ,PST.VSL_CD||PST.SKD_VOY_NO||PST.SKD_DIR_CD PST_VVD_CD	
 FROM MVMT A, BKG_VVD PRE, BKG_VVD PST
WHERE 1=1
  AND A.bkgNo = PRE.BKG_NO(+)
  AND 'S' = PRE.VSL_PRE_PST_CD(+)					
  AND A.PRE_RLY_PORT_CD= PRE.POD_CD(+)					
  AND A.bkgNo = PST.BKG_NO(+)					
  AND A.PST_RLY_PORT_CD= PST.POL_CD(+)					
  AND 'U' = PST.VSL_PRE_PST_CD(+)
#elseif(${mtymvmt} == 'VL')
WITH MVMT AS(
  SELECT  /*+ index( m xie6ctm_movement ) */
         M.CNMV_CO_CD AS company,
         M.CNTR_NO AS cntrNo,
         M.CNTR_TPSZ_CD AS tpsz,
         'OC-VL' AS mvmt,
         M.ORG_YD_CD AS yard ,
        (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                TO_CHAR(MM.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI')  /*  pre_mvmt_evnt_dt */
           FROM CTM_MOVEMENT MM
          WHERE MM.CNTR_NO = M.CNTR_NO
            AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
            AND MM.MVMT_STS_CD = 'OC'
            AND ROWNUM = 1) AS PRE_EVENTDATE,
         TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS POST_EVENTDATE,
         M.MVMT_CRE_TP_CD AS autoFlag,
         B.SLAN_CD AS lane,
         M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS tVvd,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
        (SELECT M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD
           FROM MDM_VSL_CNTR C
          WHERE M.CRNT_VSL_CD = C.VSL_CD
            AND C.FDR_DIV_CD  = 'O' 
        )fVvd,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */
         M.BKG_NO AS bkgNo,
         B.POR_CD as por, /* POR CODE */
         B.POL_CD AS pol,
         B.POD_CD AS pod,
         B.DEL_CD AS del, /* DEL CODE */
         B.PRE_RLY_PORT_CD,
         B.PST_RLY_PORT_CD,
         M.CNTR_DMG_FLG AS damage,
         M.CNTR_DISP_FLG AS disposal,
         M.IMDT_EXT_FLG AS imdtExit ,
         M.CNTR_HNGR_RCK_FLG AS hngrRack,
         C.CNTR_HNGR_BAR_ATCH_KNT AS HNGRBARKNT,
 		 B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		(SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		B.RCV_TERM_CD AS RCVTERM,
		B.DE_TERM_CD AS DETERM
        ,(SELECT C.VNDR_SEQ
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_SEQ
        ,(SELECT C.VNDR_ABBR_NM
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_ABBR_NM
        ,C.LSTM_CD
   FROM CTM_MOVEMENT    M,
        MST_CONTAINER   C,
        BKG_BOOKING     B
#if(${period} == 'D' || ${period} == 'M')
  WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0
    AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#end
#if (${mtymvmt} != '')
    AND M.MVMT_STS_CD = 'VL'
#end
    AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
    AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${lstmcd} != '')
    AND C.LSTM_CD  IN (
    #foreach($cntrlstmcd in ${vel_lstm_cd})
      '$cntrlstmcd',
      #end
      '')
#end
#if (${soc} == 'E')
    AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
    AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end

#if (${mtymvmt} == 'MTIDMG')
    AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
#end

    AND M.BKG_NO    = B.BKG_NO(+)

/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
#if (${vvd_tp} == 'T' && ${vvd_nm} != '')
	AND M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD = @[vvd_nm]
#end
#if (${vvd_tp} == 'O' && ${vvd_nm} != '')
	AND M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD = @[vvd_nm]
	AND 'OK' = (SELECT 'OK'
				  FROM MDM_VSL_CNTR C
				 WHERE M.CRNT_VSL_CD = C.VSL_CD
				   AND C.FDR_DIV_CD  = 'O'
				   AND C.DELT_FLG = 'N'
			   )
#end
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */

#if (${inquiryLevel} == 'Y')
    AND M.ORG_YD_CD = @[location]
#else
    AND M.ORG_YD_CD IN (
                        SELECT  /*+ ORDERED USE_NL( G L Y )  */
                              Y.YD_CD
                          FROM MDM_EQ_ORZ_CHT G,
                               MDM_LOCATION L,
                               MDM_YARD Y
                         WHERE Y.LOC_CD = L.LOC_CD
                           AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                           AND G.SCC_CD = @[location]   /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                           AND G.LCC_CD = @[location]   /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                           AND G.ECC_CD = @[location]   /* inquiryLevel = 'ECC'*/
#elseif(${inquiryLevel} == 'R')
                           AND G.RCC_CD = @[location]   /* inquiryLevel = 'RCC'*/
#end
                        )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
    AND 'OC'  = (
                 SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                        MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                   FROM CTM_MOVEMENT MM
                  WHERE MM.CNTR_NO = M.CNTR_NO
                    AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                        M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                    AND ROWNUM = 1
                )
    /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */

#if (${bound} == 'N')
    AND M.OB_CNTR_FLG = 'N'   /* 'N':Inbound, 'Y':Outbound */
#elseif(${bound} == 'Y')
    AND M.OB_CNTR_FLG = 'Y'   /* 'N':Inbound, 'Y':Outbound */
#end

UNION ALL
  SELECT  /*+ index( m xie6ctm_movement ) */
         M.CNMV_CO_CD AS company,
         M.CNTR_NO AS cntrNo,
         M.CNTR_TPSZ_CD AS tpsz,
         'TS-VL' AS mvmt,
         M.ORG_YD_CD AS yard ,
         (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                 TO_CHAR(MM.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI')  /*  pre_mvmt_evnt_dt */
            FROM CTM_MOVEMENT MM
           WHERE MM.CNTR_NO = M.CNTR_NO
             AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                 M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
             AND MM.MVMT_STS_CD = 'TS'
             AND ROWNUM = 1) AS PRE_EVENTDATE,
         TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS POST_EVENTDATE,
         M.MVMT_CRE_TP_CD AS autoFlag,
         B.SLAN_CD AS lane,
         M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS tVvd,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
        (SELECT M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD
           FROM MDM_VSL_CNTR C
          WHERE M.CRNT_VSL_CD = C.VSL_CD
            AND C.FDR_DIV_CD  = 'O' 
        )fVvd,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */
         M.BKG_NO AS bkgNo,
         B.POR_CD as por, /* POR CODE */
         B.POL_CD AS pol,
         B.POD_CD AS pod,
         B.DEL_CD AS del, /* DEL CODE */
         B.PRE_RLY_PORT_CD,
         B.PST_RLY_PORT_CD,
         M.CNTR_DMG_FLG AS damage,
         M.CNTR_DISP_FLG AS disposal,
         M.IMDT_EXT_FLG AS imdtExit ,
         M.CNTR_HNGR_RCK_FLG AS hngrRack,
         C.CNTR_HNGR_BAR_ATCH_KNT AS HNGRBARKNT,
 		 B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		 (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		B.RCV_TERM_CD AS RCVTERM,
		B.DE_TERM_CD AS DETERM
        ,(SELECT C.VNDR_SEQ
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_SEQ
        ,(SELECT C.VNDR_ABBR_NM
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_ABBR_NM
        ,C.LSTM_CD
   FROM CTM_MOVEMENT    M,
        MST_CONTAINER   C,
        BKG_BOOKING     B
#if(${period} == 'D' || ${period} == 'M')
  WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0
    AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#end
#if (${mtymvmt} != '')
    AND M.MVMT_STS_CD = 'VL'
#end
    AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
    AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${lstmcd} != '')
    AND C.LSTM_CD  IN (
    #foreach($cntrlstmcd in ${vel_lstm_cd})
      '$cntrlstmcd',
      #end
      '')
#end
#if (${soc} == 'E')
    AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
    AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end

#if (${mtymvmt} == 'MTIDMG')
    AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
#end

    AND M.BKG_NO    = B.BKG_NO(+)

/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
#if (${vvd_tp} == 'T' && ${vvd_nm} != '')
	AND M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD = @[vvd_nm]
#end
#if (${vvd_tp} == 'O' && ${vvd_nm} != '')
	AND M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD = @[vvd_nm]
	AND 'OK' = (SELECT 'OK'
				  FROM MDM_VSL_CNTR C
				 WHERE M.CRNT_VSL_CD = C.VSL_CD
				   AND C.FDR_DIV_CD  = 'O'
				   AND C.DELT_FLG = 'N'
			   )
#end
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */

#if (${inquiryLevel} == 'Y')
    AND M.ORG_YD_CD = @[location]
#else
    AND M.ORG_YD_CD IN (
                        SELECT /*+ ORDERED USE_NL( G L Y )  */
                               Y.YD_CD
                          FROM MDM_EQ_ORZ_CHT G,
                               MDM_LOCATION L,
                               MDM_YARD Y
                         WHERE Y.LOC_CD = L.LOC_CD
                           AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                           AND G.SCC_CD = @[location]     /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                           AND G.LCC_CD = @[location]   /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                           AND G.ECC_CD = @[location]   /* inquiryLevel = 'ECC'*/
#elseif(${inquiryLevel} == 'R')
                           AND G.RCC_CD = @[location]   /* inquiryLevel = 'RCC'*/
#end
                       )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
    AND 'TS'  = (
                 SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                        MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                  FROM CTM_MOVEMENT MM
                 WHERE MM.CNTR_NO = M.CNTR_NO
                   AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                       M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                   AND ROWNUM = 1
                )
    /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */

#if (${bound} == 'N')
    AND M.OB_CNTR_FLG = 'N'   /* 'N':Inbound, 'Y':Outbound */
#elseif(${bound} == 'Y')
    AND M.OB_CNTR_FLG = 'Y'   /* 'N':Inbound, 'Y':Outbound */
#end
)
SELECT A.*				
	  ,PRE.VSL_CD||PRE.SKD_VOY_NO||PRE.SKD_DIR_CD PRE_VVD_CD			
	  ,PST.VSL_CD||PST.SKD_VOY_NO||PST.SKD_DIR_CD PST_VVD_CD	
 FROM MVMT A, BKG_VVD PRE, BKG_VVD PST
WHERE 1=1
  AND A.bkgNo = PRE.BKG_NO(+)
  AND 'S' = PRE.VSL_PRE_PST_CD(+)					
  AND A.PRE_RLY_PORT_CD= PRE.POD_CD(+)					
  AND A.bkgNo = PST.BKG_NO(+)					
  AND A.PST_RLY_PORT_CD= PST.POL_CD(+)					
  AND 'U' = PST.VSL_PRE_PST_CD(+)
#elseif(${mtymvmt} == 'VD')
WITH MVMT AS(
  SELECT /*+ index( m xie6ctm_movement ) */
        M.CNMV_CO_CD AS company,
        M.CNTR_NO AS cntrNo,
        M.CNTR_TPSZ_CD AS tpsz,
        'VD-IC' AS mvmt,
        M.ORG_YD_CD AS yard ,
        (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                    TO_CHAR(MM.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI')  /*  pre_mvmt_evnt_dt */
             FROM CTM_MOVEMENT MM
             WHERE MM.CNTR_NO = M.CNTR_NO
               AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                     M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
               AND MM.MVMT_STS_CD = 'VD'
               AND ROWNUM = 1) AS PRE_EVENTDATE,
        TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS POST_EVENTDATE,
        M.MVMT_CRE_TP_CD AS autoFlag,
        B.SLAN_CD AS lane,
        M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS tVvd,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
        (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
              MM.CRNT_VSL_CD||MM.CRNT_SKD_VOY_NO||MM.CRNT_SKD_DIR_CD
          FROM CTM_MOVEMENT MM, MDM_VSL_CNTR C
         WHERE MM.CNTR_NO = M.CNTR_NO
           AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
               M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
           AND MM.MVMT_STS_CD = 'VD' 
           AND MM.CRNT_VSL_CD = C.VSL_CD
           AND C.FDR_DIV_CD  = 'O' 
           AND ROWNUM = 1
        )fVvd,      
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */
        M.BKG_NO AS bkgNo,
        B.POR_CD as por,  /* POR CODE */
        B.POL_CD AS pol,
        B.POD_CD AS pod,
        B.DEL_CD AS del,  /* DEL CODE */
        B.PRE_RLY_PORT_CD,
        B.PST_RLY_PORT_CD,
        M.CNTR_DMG_FLG AS damage,
        M.CNTR_DISP_FLG AS disposal,
        M.IMDT_EXT_FLG AS imdtExit ,
        M.CNTR_HNGR_RCK_FLG AS hngrRack,
        C.CNTR_HNGR_BAR_ATCH_KNT AS HNGRBARKNT,
 		B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		(SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		B.RCV_TERM_CD AS RCVTERM,
		B.DE_TERM_CD AS DETERM
        ,(SELECT C.VNDR_SEQ
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_SEQ
        ,(SELECT C.VNDR_ABBR_NM
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_ABBR_NM
        ,C.LSTM_CD
   FROM CTM_MOVEMENT    M,
        MST_CONTAINER   C,
        BKG_BOOKING     B
#if(${period} == 'D' || ${period} == 'M')
  WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#end
#if (${mtymvmt} != '')
    AND M.MVMT_STS_CD = 'IC'
#end
    AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
    AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${lstmcd} != '')
    AND C.LSTM_CD  IN (
    #foreach($cntrlstmcd in ${vel_lstm_cd})
      '$cntrlstmcd',
      #end
      '')
#end
#if (${soc} == 'E')
    AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
    AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end

#if (${mtymvmt} == 'MTIDMG')
    AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
#end

    AND M.BKG_NO    = B.BKG_NO(+)

/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
#if (${vvd_tp} == 'T' && ${vvd_nm} != '')
	AND M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD = @[vvd_nm]
#end
#if (${vvd_tp} == 'O' && ${vvd_nm} != '')
  AND @[vvd_nm] =     (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                               MM.CRNT_VSL_CD||MM.CRNT_SKD_VOY_NO||MM.CRNT_SKD_DIR_CD
                          FROM CTM_MOVEMENT MM, MDM_VSL_CNTR C
                         WHERE MM.CNTR_NO = M.CNTR_NO
                           AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                               M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                           AND MM.MVMT_STS_CD = 'VD' 
                           AND MM.CRNT_VSL_CD = C.VSL_CD
                           AND C.FDR_DIV_CD  = 'O' 
                           AND ROWNUM = 1
                        )
#end
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */

#if (${inquiryLevel} == 'Y')
    AND M.ORG_YD_CD = @[location]
#else
    AND M.ORG_YD_CD IN (
                        SELECT /*+ ORDERED USE_NL( G L Y )  */
                               Y.YD_CD
                          FROM MDM_EQ_ORZ_CHT G,
                               MDM_LOCATION L,
                               MDM_YARD Y
                         WHERE Y.LOC_CD = L.LOC_CD
                           AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                           AND G.SCC_CD = @[location]     /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                           AND G.LCC_CD = @[location]   /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                           AND G.ECC_CD = @[location]   /* inquiryLevel = 'ECC'*/
#elseif(${inquiryLevel} == 'R')
                           AND G.RCC_CD = @[location]   /* inquiryLevel = 'RCC'*/
#end
                      )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
    AND 'VD'  = (
                  SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                        MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                    FROM CTM_MOVEMENT MM
                   WHERE MM.CNTR_NO = M.CNTR_NO
                     AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                         M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                     AND ROWNUM = 1
                )
    /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */

#if (${bound} == 'N')
    AND M.OB_CNTR_FLG = 'N'   /* 'N':Inbound, 'Y':Outbound */
#elseif(${bound} == 'Y')
    AND M.OB_CNTR_FLG = 'Y'   /* 'N':Inbound, 'Y':Outbound */
#end

UNION ALL
  SELECT  /*+ index( m xie6ctm_movement ) */
        M.CNMV_CO_CD AS company,
        M.CNTR_NO AS cntrNo,
        M.CNTR_TPSZ_CD AS tpsz,
        'VD-TS' AS mvmt,
        M.ORG_YD_CD AS yard ,
        (SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                TO_CHAR(MM.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI')  /*  pre_mvmt_evnt_dt */
           FROM CTM_MOVEMENT MM
          WHERE MM.CNTR_NO = M.CNTR_NO
            AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
            AND MM.MVMT_STS_CD = 'VD'
            AND ROWNUM = 1) AS PRE_EVENTDATE,
        TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS POST_EVENTDATE,
        M.MVMT_CRE_TP_CD AS autoFlag,
        B.SLAN_CD AS lane,
        M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS tVvd,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
        (SELECT M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD
           FROM MDM_VSL_CNTR C
          WHERE M.CRNT_VSL_CD = C.VSL_CD
            AND C.FDR_DIV_CD  = 'O' 
        )fVvd,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */
        M.BKG_NO AS bkgNo,
        B.POR_CD as por,  /* POR CODE */
        B.POL_CD AS pol,
        B.POD_CD AS pod,
        B.DEL_CD AS del,  /* DEL CODE */
        B.PRE_RLY_PORT_CD,
        B.PST_RLY_PORT_CD,
        M.CNTR_DMG_FLG AS damage,
        M.CNTR_DISP_FLG AS disposal,
        M.IMDT_EXT_FLG AS imdtExit ,
        M.CNTR_HNGR_RCK_FLG AS hngrRack,
        C.CNTR_HNGR_BAR_ATCH_KNT AS HNGRBARKNT,
 		B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		(SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		B.RCV_TERM_CD AS RCVTERM,
		B.DE_TERM_CD AS DETERM
        ,(SELECT C.VNDR_SEQ
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_SEQ
        ,(SELECT C.VNDR_ABBR_NM
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_ABBR_NM
        ,C.LSTM_CD
   FROM CTM_MOVEMENT    M,
        MST_CONTAINER   C,
        BKG_BOOKING     B
#if(${period} == 'D' || ${period} == 'M')
  WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#end
#if (${mtymvmt} != '')
    AND M.MVMT_STS_CD = 'TS'
#end
    AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
    AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${lstmcd} != '')
    AND C.LSTM_CD  IN (
    #foreach($cntrlstmcd in ${vel_lstm_cd})
      '$cntrlstmcd',
      #end
      '')
#end
#if (${soc} == 'E')
    AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
    AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end

#if (${mtymvmt} == 'MTIDMG')
    AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
#end

    AND M.BKG_NO    = B.BKG_NO(+)

/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
#if (${vvd_tp} == 'T' && ${vvd_nm} != '')
	AND M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD = @[vvd_nm]
#end
#if (${vvd_tp} == 'O' && ${vvd_nm} != '')
	AND M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD = @[vvd_nm]
	AND 'OK' = (SELECT 'OK'
				  FROM MDM_VSL_CNTR C
				 WHERE M.CRNT_VSL_CD = C.VSL_CD
				   AND C.FDR_DIV_CD  = 'O'
				   AND C.DELT_FLG = 'N'
			   )
#end
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */

#if (${inquiryLevel} == 'Y')
    AND M.ORG_YD_CD = @[location]
#else
    AND M.ORG_YD_CD IN (
                        SELECT /*+ ORDERED USE_NL( G L Y )  */
                               Y.YD_CD
                          FROM MDM_EQ_ORZ_CHT G,
                               MDM_LOCATION L,
                               MDM_YARD Y
                         WHERE Y.LOC_CD = L.LOC_CD
                           AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                           AND G.SCC_CD = @[location]     /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                           AND G.LCC_CD = @[location]   /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                           AND G.ECC_CD = @[location]   /* inquiryLevel = 'ECC'*/
#elseif(${inquiryLevel} == 'R')
                           AND G.RCC_CD = @[location]   /* inquiryLevel = 'RCC'*/
#end
                        )
#end
    /* ----------------> 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */
    AND 'VD'  = (
                 SELECT /*+ INDEX_DESC ( MM XFN1CTM_MOVEMENT ) */
                        MM.MVMT_STS_CD  /*  pre_mvmt_sts_cd   */
                   FROM CTM_MOVEMENT MM
                  WHERE MM.CNTR_NO = M.CNTR_NO
                    AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO <
                        M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                    AND ROWNUM = 1
                )
    /* <---------------- 2010.05.13 Pre MVMT STS Check Logic ??????????????????????????????????????????????????????????????????????????? */

  #if (${bound} == 'N')
    AND M.OB_CNTR_FLG = 'N'   /* 'N':Inbound, 'Y':Outbound */
  #elseif(${bound} == 'Y')
    AND M.OB_CNTR_FLG = 'Y'   /* 'N':Inbound, 'Y':Outbound */
  #end
)
SELECT A.*				
	  ,PRE.VSL_CD||PRE.SKD_VOY_NO||PRE.SKD_DIR_CD PRE_VVD_CD			
	  ,PST.VSL_CD||PST.SKD_VOY_NO||PST.SKD_DIR_CD PST_VVD_CD	
 FROM MVMT A, BKG_VVD PRE, BKG_VVD PST
WHERE 1=1
  AND A.bkgNo = PRE.BKG_NO(+)
  AND 'S' = PRE.VSL_PRE_PST_CD(+)					
  AND A.PRE_RLY_PORT_CD= PRE.POD_CD(+)					
  AND A.bkgNo = PST.BKG_NO(+)					
  AND A.PST_RLY_PORT_CD= PST.POL_CD(+)					
  AND 'U' = PST.VSL_PRE_PST_CD(+)
#else
WITH MVMT AS(
  SELECT  /*+ index( m xie6ctm_movement ) */
        M.CNMV_CO_CD AS company,
        M.CNTR_NO AS cntrNo,
        M.CNTR_TPSZ_CD AS tpsz,
        SUBSTR(@[mtymvmt],0,2) AS mvmt,
        M.ORG_YD_CD AS yard ,
        TO_CHAR(M.CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI') AS PRE_EVENTDATE,
        '' AS POST_EVENTDATE,
        M.MVMT_CRE_TP_CD AS autoFlag,
        B.SLAN_CD AS lane,
        M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD AS tVvd,
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */

        
        #if (${mtymvmt} == 'OP' || ${mtymvmt} == 'OC')
          (SELECT /*+ INDEX_ASC( MM XFN1CTM_MOVEMENT ) */
                  MM.CRNT_VSL_CD||MM.CRNT_SKD_VOY_NO||MM.CRNT_SKD_DIR_CD
           FROM CTM_MOVEMENT MM, MDM_VSL_CNTR C
           WHERE MM.CNTR_NO = M.CNTR_NO
            AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO >
               M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
            AND MM.MVMT_STS_CD = 'VL' 
            AND MM.CRNT_VSL_CD = C.VSL_CD
            AND C.FDR_DIV_CD  = 'O' 
            AND ROWNUM = 1
          )fVvd, 
        #else
           (SELECT M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD
            FROM MDM_VSL_CNTR C
            WHERE M.CRNT_VSL_CD = C.VSL_CD
            AND C.FDR_DIV_CD  = 'O' 
            )fVvd,
        #end

        
        /* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */
        M.BKG_NO AS bkgNo,
        B.POR_CD AS por,  /* POR CODE */
        B.POL_CD AS pol,
        B.POD_CD AS pod,
        B.DEL_CD AS del,  /* DEL CODE */
        B.PRE_RLY_PORT_CD,
        B.PST_RLY_PORT_CD,
        M.CNTR_DMG_FLG AS damage,
        M.CNTR_DISP_FLG AS disposal,
        M.IMDT_EXT_FLG AS imdtExit ,
        M.CNTR_HNGR_RCK_FLG AS hngrRack,
        C.CNTR_HNGR_BAR_ATCH_KNT AS HNGRBARKNT,
 		B.SC_NO||' '||B.RFA_NO||' '||B.TAA_NO  SC_RFA_NO_TAA,
		(SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  SHPR
           FROM   BKG_CUSTOMER C
          WHERE  B.BKG_NO         = C.BKG_NO
            AND    C.BKG_CUST_TP_CD = 'S'
        ) SHPR,
        (SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')  CNEE
           FROM   BKG_CUSTOMER C
           WHERE  B.BKG_NO         = C.BKG_NO
           AND    C.BKG_CUST_TP_CD = 'C'
        ) CNEE,
		B.RCV_TERM_CD AS RCVTERM,
		B.DE_TERM_CD AS DETERM
        ,(SELECT C.VNDR_SEQ
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_SEQ
        ,(SELECT C.VNDR_ABBR_NM
		  FROM MDM_VENDOR C
		  WHERE M.VNDR_SEQ = C.VNDR_SEQ(+)
          ) VNDR_ABBR_NM
        ,C.LSTM_CD
   FROM CTM_MOVEMENT    M,
        MST_CONTAINER   C,
        BKG_BOOKING     B
#if(${period} == 'D' || ${period} == 'M')
  WHERE M.CNMV_EVNT_DT BETWEEN  TO_DATE( @[from], 'YYYYMMDD') + .0 AND TO_DATE( @[to], 'YYYYMMDD') + .99999
#end
#if (${mtymvmt} != '')
    AND M.MVMT_STS_CD = SUBSTR(@[mtymvmt],0,2)
#end

#if (${mtymvmt} == 'ENF' || ${mtymvmt} == 'TNF' || ${mtymvmt} == 'ENM' || ${mtymvmt} == 'TNM')
 #if (${mtymvmt} == 'ENF' || ${mtymvmt} == 'TNF')
    AND M.FCNTR_FLG = 'Y'
 #else
    AND M.FCNTR_FLG = 'N'
 #end
#end
    AND M.CNTR_NO = C.CNTR_NO
#if (${tpsz} != '')
    AND M.CNTR_TPSZ_CD  IN (
    #foreach($cntrtpszcd in ${vel_tpsz_cd})
      '$cntrtpszcd',
      #end
      '')
#end
#if (${lstmcd} != '')
    AND C.LSTM_CD  IN (
    #foreach($cntrlstmcd in ${vel_lstm_cd})
      '$cntrlstmcd',
      #end
      '')
#end
#if (${soc} == 'E')
    AND NVL(C.LSTM_CD, '  ') <> 'SH' /* soc */
#elseif(${soc} == 'O')
    AND NVL(C.LSTM_CD, '  ') = 'SH' /* soc  */
#end
  --AND NVL(M.MVMT_CRE_TP_CD, '  ') NOT IN ( 'C','L' )
    AND M.BKG_NO    = B.BKG_NO(+)
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (S) */
#if (${vvd_tp} == 'T' && ${vvd_nm} != '')
	AND M.TRNK_VSL_CD||M.TRNK_SKD_VOY_NO||M.TRNK_SKD_DIR_CD = @[vvd_nm]
#end
#if (${vvd_tp} == 'O' && ${vvd_nm} != '')
        
      #if (${mtymvmt} == 'OP' || ${mtymvmt} == 'OC')
         AND @[vvd_nm] = 
              (SELECT /*+ INDEX_ASC( MM XFN1CTM_MOVEMENT ) */
                      MM.CRNT_VSL_CD||MM.CRNT_SKD_VOY_NO||MM.CRNT_SKD_DIR_CD
               FROM CTM_MOVEMENT MM, MDM_VSL_CNTR C
               WHERE MM.CNTR_NO = M.CNTR_NO
                AND MM.CNMV_YR || TO_CHAR(MM.CNMV_SEQ, '0000') ||MM.CNMV_SPLIT_NO >
                   M.CNMV_YR||TO_CHAR(M.CNMV_SEQ,'0000')||M.CNMV_SPLIT_NO
                AND MM.MVMT_STS_CD = 'VL' 
                AND MM.CRNT_VSL_CD = C.VSL_CD
                AND C.FDR_DIV_CD  = 'O' 
                AND ROWNUM = 1
              )
        #else
	        AND M.CRNT_VSL_CD||M.CRNT_SKD_VOY_NO||M.CRNT_SKD_DIR_CD = @[vvd_nm]
	        AND 'OK' = (SELECT 'OK'
          				     FROM MDM_VSL_CNTR C
          				     WHERE M.CRNT_VSL_CD = C.VSL_CD
          				     AND C.FDR_DIV_CD  = 'O'
          				     AND C.DELT_FLG = 'N'
            		      )
        #end
              
#end
/* ----------------> 2014.05.08 by Chang Young Kim (AA Young Du Lee) : VVD Type & Name Condition Add (E) */
#if (${inquiryLevel} == 'Y')
    AND M.ORG_YD_CD = @[location]
#else
    AND M.ORG_YD_CD IN (
                        SELECT /*+ ORDERED USE_NL( G L Y )  */
                               Y.YD_CD
                          FROM MDM_EQ_ORZ_CHT G,
                               MDM_LOCATION L,
                               MDM_YARD Y
                         WHERE Y.LOC_CD = L.LOC_CD
                           AND L.SCC_CD = G.SCC_CD
#if (${inquiryLevel} == 'S')
                           AND G.SCC_CD = @[location]    /* inquiryLevel = 'SCC'*/
#elseif(${inquiryLevel} == 'L')
                           AND G.LCC_CD = @[location]    /* inquiryLevel = 'LCC'*/
#elseif(${inquiryLevel} == 'E')
                           AND G.ECC_CD = @[location]    /* inquiryLevel = 'ECC'*/
#elseif(${inquiryLevel} == 'R')
                           AND G.RCC_CD = @[location]    /* inquiryLevel = 'RCC'*/
#end
                       )
#end

#if (${bound} == 'N')
    AND M.OB_CNTR_FLG = 'N'   /* 'N':Inbound, 'Y':Outbound */
#elseif(${bound} == 'Y')
    AND M.OB_CNTR_FLG = 'Y'   /* 'N':Inbound, 'Y':Outbound */
#end
)
SELECT A.*				
	  ,PRE.VSL_CD||PRE.SKD_VOY_NO||PRE.SKD_DIR_CD PRE_VVD_CD			
	  ,PST.VSL_CD||PST.SKD_VOY_NO||PST.SKD_DIR_CD PST_VVD_CD	
 FROM MVMT A, BKG_VVD PRE, BKG_VVD PST
WHERE 1=1
  AND A.bkgNo = PRE.BKG_NO(+)
  AND 'S' = PRE.VSL_PRE_PST_CD(+)					
  AND A.PRE_RLY_PORT_CD= PRE.POD_CD(+)					
  AND A.bkgNo = PST.BKG_NO(+)					
  AND A.PST_RLY_PORT_CD= PST.POL_CD(+)					
  AND 'U' = PST.VSL_PRE_PST_CD(+)
#end			]]></sql>
			<params>
				<param name="mtymvmt" type="12" value="MT" out="N"/>
				<param name="from" type="12" value="20091201" out="N"/>
				<param name="to" type="12" value="20091231" out="N"/>
				<param name="vvd_nm" type="12" value="" out="N"/>
				<param name="location" type="12" value="KRPUS" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
