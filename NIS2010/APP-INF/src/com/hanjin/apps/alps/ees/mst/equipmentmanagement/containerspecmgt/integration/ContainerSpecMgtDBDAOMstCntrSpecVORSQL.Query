<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContainerSpecMgtDBDAOMstCntrSpecVORSQL">
			<desc><![CDATA[[CHM-201111999] 나상보 [MST] ALPS-CNTR Master-Master->Specification Inquiry 보완
]]></desc>
			<sql><![CDATA[
#if(${own_cntr_flg} == 'Y')
SELECT SPEC.CNTR_SPEC_NO
     , MST_COMMON_PKG.MST_AGMT_NO_CONV_FNC(LOT.AGMT_CTY_CD, LOT.AGMT_SEQ) AS AGMT_NO
     , (SELECT LSTM_CD
        FROM   LSE_AGREEMENT L
        WHERE  LOT.AGMT_CTY_CD = L.AGMT_CTY_CD
        AND    LOT.AGMT_SEQ    = L.AGMT_SEQ
       ) AS LSTM_CD
     , LOT.FCTRY_SPEC_NO
     , DECODE(LOT.LOT_PLN_YR,NULL,NULL,LOT.LOT_PLN_YR||'-'||LOT.LOT_LOC_CD||'-'||LOT.CNTR_TPSZ_CD||'-'||LTRIM(TO_CHAR(LOT.LOT_SEQ,'000'))) LOT_NO
     , SPEC.CNTR_TPSZ_CD
     , MDM.VNDR_SEQ
     , MDM.VNDR_ABBR_NM
     , SPEC.CNTR_MTRL_CD
     , DECODE(LOT.LOT_PLN_YR,NULL,NULL,LOT.LOT_CNTR_PFX_CD||TO_CHAR(LOT.FM_SER_NO,'000000')||' -'||TO_CHAR(LOT.TO_SER_NO,'000000')) SER_RANGE
     , TO_NUMBER(LTRIM(TO_CHAR(LOT.TO_SER_NO,'000000'))) -
       TO_NUMBER(LTRIM(TO_CHAR(LOT.FM_SER_NO,'000000'))) + 1 AS TTL_LOT_QTY
     , (SELECT /*+ INDEX(A XPKMST_CONTAINER) */ COUNT(1) - SUM(
                DECODE(A.CNTR_STS_CD,'SLD',1,0) +
                DECODE(A.CNTR_STS_CD,'TLL',1,0) +
                DECODE(A.CNTR_STS_CD,'DON',1,0) +
                DECODE(A.CNTR_STS_CD,'SCR',1,0) )
        FROM    MST_CONTAINER A
        WHERE   1=1
        AND     A.CNTR_NO BETWEEN LOT.LOT_CNTR_PFX_CD||LTRIM(TO_CHAR(LOT.FM_SER_NO,'000000')) || '0'
                          AND     LOT.LOT_CNTR_PFX_CD||LTRIM(TO_CHAR(LOT.TO_SER_NO,'000000')) || '9'
        AND     A.OWNR_CO_CD   = 'H'
        AND     A.LSTM_CD IN ('OW','LP','OL')
     ) AS TTL_ACT_QTY
     , (SELECT S.INTG_CD_VAL_DP_DESC
        FROM   COM_INTG_CD_DTL S
        WHERE  S.INTG_CD_VAL_CTNT = LOT.RF_TP_CD
        AND    S.INTG_CD_ID       = 'CD01085'
     ) AS RF_TP_CD
     , NVL2(CNTR_HNGR_RCK_CD, 'Y', 'N') AS CNTR_HNGR_RCK_FLG
     , PLST_FLR_FLG
     ,(SELECT NVL(VNDR_ABBR_NM, VNDR_LGL_ENG_NM) FROM MDM_VENDOR WHERE VNDR_SEQ = LOT.RF_MKR_SEQ) AS RF_MKR_SEQ
     , LOT.RF_MDL_NM
     , LOT.RF_RFR_NO
     , LOT.MIN_TEMP || DECODE(LOT.MIN_TEMP, NULL, '',' ~ ') || LOT.MAX_TEMP AS MAX_TEMP
     , SPEC.LOD_CAPA
     , SPEC.CNTR_GRS_WGT
     , SPEC.TARE_WGT
     , SPEC.XTER_LEN
     , SPEC.XTER_WDT
     , SPEC.XTER_HGT
     , SPEC.INTER_LEN
     , SPEC.INTER_WDT
     , SPEC.INTER_HGT
     , SPEC.OPN_DOR_WDT
     , SPEC.OPN_DOR_HGT
     , SPEC.RC_LDB_CAPA
     , SPEC.RC_LDB_HGT
     , SPEC.TNK_CAPA
FROM  MST_CNTR_SPEC SPEC,  MST_CNTR_LOT LOT, MDM_VENDOR MDM
WHERE 1=1
AND   LOT.CNTR_SPEC_NO(+) = SPEC.CNTR_SPEC_NO
AND   SPEC.VNDR_SEQ       = MDM.VNDR_SEQ  (+)
AND   SPEC.OWN_CNTR_FLG = 'Y'
#if(${from_spec_yr} != '')
AND   SPEC.SPEC_YR >= @[from_spec_yr]
#end
#if(${to_spec_yr} != '')
AND   SPEC.SPEC_YR <= @[to_spec_yr]
#end
#if(${cntr_tpsz_cd} != '' && ${cntr_tpsz_cd} != 'ALL')
AND   SPEC.CNTR_TPSZ_CD = @[cntr_tpsz_cd]
#end
#if(${agmt_no} != '')
AND   LOT.AGMT_CTY_CD = SUBSTR(@[agmt_no],1,3)
AND   LOT.AGMT_SEQ = TO_NUMBER(SUBSTR(@[agmt_no],4))
#end
ORDER BY SPEC.CNTR_SPEC_NO DESC
#end
#if(${own_cntr_flg} == 'N')
SELECT  SPEC.CNTR_SPEC_NO
      , MST_COMMON_PKG.MST_AGMT_NO_CONV_FNC(LSE.AGMT_CTY_CD, LSE.AGMT_SEQ) AS AGMT_NO
      , LSE2.LSTM_CD
      , SPEC.CNTR_TPSZ_CD
      , MDM.VNDR_SEQ
      , MDM.VNDR_ABBR_NM
      , SPEC.CNTR_MTRL_CD
      , '' RF_MKR_SEQ
      , '' RF_MDL_NM
      , '' RF_RFR_NO
      , '' MIN_TEMP
      , '' MAX_TEMP
      , SPEC.LOD_CAPA
      , SPEC.CNTR_GRS_WGT
      , SPEC.TARE_WGT
      , SPEC.XTER_LEN
      , SPEC.XTER_WDT
      , SPEC.XTER_HGT
      , SPEC.INTER_LEN
      , SPEC.INTER_WDT
      , SPEC.INTER_HGT
      , SPEC.OPN_DOR_WDT
      , SPEC.OPN_DOR_HGT
      , SPEC.RC_LDB_CAPA
      , SPEC.RC_LDB_HGT
      , SPEC.TNK_CAPA
FROM  MST_CNTR_SPEC SPEC
    , LSE_AGMT_RT   LSE
    , MDM_VENDOR    MDM
    , LSE_AGREEMENT LSE2
WHERE 1=1
AND   SPEC.CNTR_SPEC_NO = LSE.CNTR_SPEC_NO       (+)
AND   'KRSEL'           = LSE.LOC_CD             (+)
AND   SPEC.CNTR_TPSZ_CD = LSE.CNTR_TPSZ_CD       (+)
AND   'GENV'            = LSE.CNTR_RNTL_CHG_TP_CD(+)
AND   LSE.AGMT_CTY_CD   = LSE2.AGMT_CTY_CD       (+)
AND   LSE.AGMT_SEQ      = LSE2.AGMT_SEQ          (+)
AND   SPEC.VNDR_SEQ     = MDM.VNDR_SEQ           (+)
AND   SPEC.OWN_CNTR_FLG = 'N'
#if(${from_spec_yr} != '')
AND   SPEC.SPEC_YR     >= @[from_spec_yr]
#end
#if(${to_spec_yr} != '')
AND   SPEC.SPEC_YR    <= @[to_spec_yr]
#end
#if(${cntr_tpsz_cd} != '' && ${cntr_tpsz_cd} != 'ALL')
AND   SPEC.CNTR_TPSZ_CD = @[cntr_tpsz_cd]
#end
#if(${agmt_no} != '')
AND   LSE.AGMT_CTY_CD   = SUBSTR(@[agmt_no],1,3)
AND   LSE.AGMT_SEQ      = TO_NUMBER(SUBSTR(@[agmt_no],4))
#end
ORDER BY SPEC.CNTR_SPEC_NO DESC
#end			]]></sql>
			<params>
				<param name="from_spec_yr" type="12" value="" out="N"/>
				<param name="to_spec_yr" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="agmt_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
