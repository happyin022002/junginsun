<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChargeCalculationDBDAOSCExceptionTariffVORSQL">
			<desc><![CDATA[S/C Exception Tariff의 Free Time일수 및 주말, 공휴일 포함 여부를 조회한다]]></desc>
			<sql><![CDATA[
SELECT 
	(	SELECT PROG_OFC_CD
		FROM	DMT_SC_EXPT_VER_PROG    VP
		WHERE	D.PROP_NO			=	VP.PROP_NO
		AND	D.SC_EXPT_VER_SEQ		=	VP.SC_EXPT_VER_SEQ
		AND	VP.DMDT_EXPT_VER_STS_CD	=  'R'
		AND	ROWNUM = 1
	)	AS  RQST_OFC_CD
	,(	SELECT USR_NM
		FROM COM_USER
		WHERE USR_ID = (SELECT PROG_USR_ID
						FROM	DMT_SC_EXPT_VER_PROG    VP
						WHERE	D.PROP_NO			=	VP.PROP_NO
						AND	D.SC_EXPT_VER_SEQ		=	VP.SC_EXPT_VER_SEQ
						AND	VP.DMDT_EXPT_VER_STS_CD	=  'R'
						AND	ROWNUM = 1
           				)
	) RQST_USR_NM
	,(	SELECT PROG_OFC_CD
		FROM	DMT_SC_EXPT_VER_PROG    VP
		WHERE	D.PROP_NO				=	VP.PROP_NO
		AND	D.SC_EXPT_VER_SEQ			=	VP.SC_EXPT_VER_SEQ
		AND   VP.DMDT_EXPT_VER_STS_CD	=  'L'
		AND   ROWNUM =  1
	) APRO_OFC_CD
	,(	SELECT USR_NM
		FROM COM_USER
		WHERE USR_ID = (SELECT	PROG_USR_ID
						FROM	DMT_SC_EXPT_VER_PROG    VP
						WHERE	D.PROP_NO			=	VP.PROP_NO
						AND	D.SC_EXPT_VER_SEQ		=	VP.SC_EXPT_VER_SEQ
						AND	VP.DMDT_EXPT_VER_STS_CD	=  'L'
						AND	ROWNUM =  1
           				)
	) APRO_USR_NM
	,P.SC_NO		AS SC_APVL_NO
	--,D.FT_ADD_DYS	AS ADD_DYS
	--,F.FT_DYS		AS TTL_DYS	-- TOTAL DAY
	,DECODE(D.FT_ADD_FLG, 'Y', D.FT_ADD_DYS) AS ADD_DYS 
	,CASE
	WHEN NVL(D.FT_ADD_FLG, 'N') = 'N' AND NVL(D.FT_ADJ_FLG, 'N') = 'N' THEN
		D.FT_ADD_DYS
	WHEN D.FT_ADD_FLG = 'N' AND D.FT_ADJ_FLG = 'Y' THEN
		F.FT_DYS 
	END AS TTL_DYS -- TOTAL DAY
	,D.XCLD_SAT_FLG
	,D.XCLD_SUN_FLG
	,D.XCLD_HOL_FLG
	,D.CURR_CD
	,DECODE( SUBSTR(@[cntr_tpsz_cd], 2, 1),
					'2', R.CNTR_20FT_RT_AMT,
					'4', R.CNTR_40FT_RT_AMT,
					'5', R.CNTR_HC_RT_AMT,
					'7', R.CNTR_45FT_RT_AMT,
                    '8', R.CNTR_R9_RT_AMT,
                    '9', R.CNTR_R9_RT_AMT   ) CNTR_FT_RT_AMT
	,P.PROP_NO
	,'' SC_RFA_EXPT_APLY_DT
	,'' SC_RFA_EXPT_OVR_DYS
	,'' SC_RFA_EXPT_AMT
	,'' BZC_TRF_CURR_CD

FROM	DMT_SC_EXPT_VER		M,
		DMT_SC_EXPT_GRP     D,
		DMT_SC_EXPT_RT_ADJ  R,
		DMT_SC_EXPT_FREE_TM F,
		PRI_SP_HDR			P

WHERE	D.PROP_NO			=	P.PROP_NO
AND		D.SC_EXPT_VER_SEQ	=	@[sc_expt_ver_seq]
AND		D.SC_EXPT_GRP_SEQ	=	@[sc_expt_grp_seq]
AND		D.PROP_NO			=	M.PROP_NO
AND		D.SC_EXPT_VER_SEQ	=	M.SC_EXPT_VER_SEQ
AND     M.DELT_FLG			=   'N'
AND 	M.PROP_NO			=	P.PROP_NO
AND     P.SC_NO				=	TRIM(@[sc_no])
AND		D.PROP_NO			=	R.PROP_NO        (+)
AND		D.SC_EXPT_VER_SEQ	=	R.SC_EXPT_VER_SEQ(+)
AND     D.SC_EXPT_GRP_SEQ	=	R.SC_EXPT_GRP_SEQ(+)
AND     R.RT_SEQ (+)		=	1
AND		D.PROP_NO			=	F.PROP_NO        (+)
AND		D.SC_EXPT_VER_SEQ	=	F.SC_EXPT_VER_SEQ(+)
AND     D.SC_EXPT_GRP_SEQ	=	F.SC_EXPT_GRP_SEQ(+)
AND     F.FT_SEQ (+)		=	1			]]></sql>
			<params>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="sc_expt_ver_seq" type="12" value="" out="N"/>
				<param name="sc_expt_grp_seq" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
