<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChassisMgsetInvoiceDBDAOaddCHSCpsLeaseInvoiceDataCSQL">
			<desc><![CDATA[2013.06.26 조경완 [CHM-201324911-01] ALPS-CHSS-COPS 기능 Trouble Shooting을 위한 CSR]]></desc>
			<sql><![CDATA[
INSERT INTO CGM_LSE_INV_TMP (
	INV_NO
	,INV_REF_NO
	,INV_EQ_NO
	,INV_CUST_EQ_NO
	,INV_EQ_ONH_DT
	,INV_EQ_ONH_LOC_NM
	,INV_EQ_OFFH_DT
	,INV_EQ_OFFH_LOC_NM
	,INV_BIL_ST_DT
	,INV_BIL_END_DT
	,INV_LSE_USE_DYS
	,INV_LSE_RT_AMT
	,INV_LSE_CHG_AMT
	,INV_TAX_AMT
	,INV_CR_AMT
	,CHG_CD
	,VRFY_SCS_FLG
	,CRE_USR_ID
	,UPD_USR_ID
	,COST_YRMON
	,EQ_KND_CD
	,CHG_CRE_SEQ
    ,INV_CHG_TP_NM
    ,CRE_DT
    ,UPD_DT
	,INV_BKG_NO
	,INV_BIL_UT_DYS
	,INV_CUST_EQ_TPSZ_NM
    ,INV_YD_CD
	,TAX_SMRY_AMT
	,INV_SMRY_AMT
	,VRFY_RSLT_DESC
	,INV_GATE_ACT_ID
	,INV_BIL_MOD_RMK
	,EQ_NO
) VALUES (
     @[inv_no]               
    ,@[inv_ref_no]           
    ,@[inv_eq_no]            
	,CASE WHEN @[inv_cust_eq_no] IS NULL THEN (SELECT MAX(B.CNTR_NO) CNTR_NO
                                        FROM  CGM_CHSS_MVMT_HIS B
                                        WHERE  @[inv_eq_no] = B.CHSS_NO
                                        AND  TRUNC(B.MVMT_DT)= TO_DATE(SUBSTR(TRIM(@[inv_eq_onh_dt]),1,8),'YYYYMMDD')
                                        AND  UPPER(@[inv_chg_tp_nm]) = 'PER DIEM'
                                        AND  B.GATE_IO_CD ='O'
                                        AND  B.CNTR_NO IS NOT NULL
                                        AND  B.MVMT_STS_CD IN('CD','CE','CP','EN','ID','OP','TN')
                                        HAVING COUNT(*) = 1)
			ELSE MST_COMMON_PKG.MST_CNTR_CHK_DGT_FNC(@[inv_cust_eq_no]) END 
    ,TO_DATE(SUBSTR(TRIM(@[inv_eq_onh_dt]),1,8),'YYYYMMDD')        
    ,@[inv_eq_onh_loc_nm]    
    ,TO_DATE(SUBSTR(TRIM(@[inv_eq_offh_dt]),1,8),'YYYYMMDD')          
    ,@[inv_eq_offh_loc_nm]   
    ,TO_DATE(SUBSTR(TRIM(@[inv_bil_st_dt]),1,8),'YYYYMMDD')           
    ,TO_DATE(SUBSTR(TRIM(@[inv_bil_end_dt]),1,8),'YYYYMMDD')          
    ,@[inv_lse_use_dys]
    ,NVL(@[inv_lse_rt_amt] , 0)
    ,NVL(@[inv_lse_chg_amt], 0)
    ,NVL(@[inv_tax_amt], 0)*100
    ,NVL(@[inv_cr_amt], 0)
    ,DECODE(UPPER(@[inv_chg_tp_nm]),'PER DIEM','PDM','ON TERMINAL','ONT', 'ON STREET', 'PDM')
    ,@[vrfy_scs_flg]
    ,@[cre_usr_id]
    ,@[upd_usr_id]
    ,@[cost_yrmon]
    ,@[eq_knd_cd]
    ,@[chg_cre_seq]
    ,@[inv_chg_tp_nm]
    ,sysdate
    ,sysdate
	,@[inv_bkg_no]
	,NVL(@[inv_bil_ut_dys], 0)
	,SUBSTR(TRIM(@[inv_cust_eq_tpsz_nm]), 1, 2)
	,NVL((SELECT  MAX(A.YD_CD)
            FROM  CGM_AGMT_CPS_COND A
            WHERE A.AGMT_OFC_CTY_CD = @[agmt_ofc_cty_cd]
            AND   A.AGMT_SEQ        = @[agmt_seq]
            AND   A.AGMT_VER_NO     = @[agmt_ver_no]
            AND   A.LR_LOC_NM       = @[inv_eq_onh_loc_nm]
			HAVING COUNT(*) = 1 
					),(SELECT MAX(A.YD_CD) --수정
                            FROM  CGM_AGMT_CPS_COND A
                            WHERE A.AGMT_OFC_CTY_CD = @[agmt_ofc_cty_cd]
                            AND   A.AGMT_SEQ        = @[agmt_seq]
                            AND   A.AGMT_VER_NO     = @[agmt_ver_no]
                            AND   A.LR_LOC_NM LIKE '%'||@[inv_eq_onh_loc_nm]||'%'
                            AND   INSTRB(A.LR_LOC_NM,',') > 0
                            AND   LENGTH(A.LR_LOC_NM)> 30
                            HAVING COUNT(*) = 1 
                            )
        )
	,NVL(@[tax_smry_amt], 0)
	,NVL(@[inv_lse_chg_amt], 0) + NVL(@[tax_smry_amt], 0)
	,(SELECT B.BKG_NO||RPAD(NVL(B.SC_NO,' '),9,' ')||NVL(B.CTRT_CUST_CNT_CD, '  ')||RPAD(LTRIM(TO_CHAR(NVL(B.CTRT_CUST_SEQ,0),'000000')),6,' ')
                        FROM  BKG_BOOKING B,BKG_CONTAINER C
                        WHERE B.BKG_NO =  @[inv_bkg_no]
                        AND   C.BKG_NO =  @[inv_bkg_no]
                        AND   C.CNTR_NO = MST_COMMON_PKG.MST_CNTR_CHK_DGT_FNC(@[inv_cust_eq_no]))
	,@[inv_gate_act_id]
	,@[inv_bil_mod_rmk]
	,@[inv_cust_eq_no]
)			]]></sql>
			<params>
				<param name="inv_no" type="12" value="" out="N"/>
				<param name="inv_ref_no" type="12" value="" out="N"/>
				<param name="inv_eq_no" type="12" value="" out="N"/>
				<param name="inv_cust_eq_no" type="12" value="" out="N"/>
				<param name="inv_eq_onh_dt" type="12" value="" out="N"/>
				<param name="inv_chg_tp_nm" type="12" value="" out="N"/>
				<param name="inv_eq_onh_loc_nm" type="12" value="" out="N"/>
				<param name="inv_eq_offh_dt" type="12" value="" out="N"/>
				<param name="inv_eq_offh_loc_nm" type="12" value="" out="N"/>
				<param name="inv_bil_st_dt" type="12" value="" out="N"/>
				<param name="inv_bil_end_dt" type="12" value="" out="N"/>
				<param name="inv_lse_use_dys" type="12" value="" out="N"/>
				<param name="inv_lse_rt_amt" type="12" value="" out="N"/>
				<param name="inv_lse_chg_amt" type="12" value="" out="N"/>
				<param name="inv_tax_amt" type="12" value="" out="N"/>
				<param name="inv_cr_amt" type="12" value="" out="N"/>
				<param name="vrfy_scs_flg" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="cost_yrmon" type="12" value="" out="N"/>
				<param name="eq_knd_cd" type="12" value="" out="N"/>
				<param name="chg_cre_seq" type="12" value="" out="N"/>
				<param name="inv_bkg_no" type="12" value="" out="N"/>
				<param name="inv_bil_ut_dys" type="12" value="" out="N"/>
				<param name="inv_cust_eq_tpsz_nm" type="12" value="" out="N"/>
				<param name="agmt_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="agmt_seq" type="12" value="" out="N"/>
				<param name="agmt_ver_no" type="12" value="" out="N"/>
				<param name="tax_smry_amt" type="12" value="" out="N"/>
				<param name="inv_gate_act_id" type="12" value="" out="N"/>
				<param name="inv_bil_mod_rmk" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
