<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChargeCalculationDBDAOmergeDmtExceptionChargeCalculationUSQL">
			<desc><![CDATA[mergeDmtExceptionChargeCalculation]]></desc>
			<sql><![CDATA[
#if (${dmdt_chg_sts_cd} == 'D')
    UPDATE  DMT_EXPT_CHG_CALC
    SET     BKG_QTY               = 0
            , INCUR_QTY             = 0
            , INCUR_CNTR_TEU_KNT    = 0
            , EXPT_QTY              = 0
            , EXPT_CNTR_TEU_KNT     = 0
            , INCUR_AMT             = 0
            , EXPT_FT_AMT           = 0
            , EXPT_TRF_RT_ADJ_AMT   = 0
            , EXPT_DYS              = 0
            , EXPT_COST_AMT         = 0
            , UPD_DT                = NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(SYSDATE), SYSDATE)
            , UPD_USR_ID            = @[upd_usr_id]
            , UPD_OFC_CD            = @[upd_ofc_cd]
    WHERE   BKG_NO              = @[bkg_no]
    AND     CNTR_NO             = @[cntr_no]
    AND     CNTR_CYC_NO         = @[cntr_cyc_no]
    AND     DMDT_TRF_CD         = @[dmdt_trf_cd]
    AND     DMDT_CHG_LOC_DIV_CD = @[dmdt_chg_loc_div_cd]
    AND     CHG_SEQ             = @[chg_seq]
#else
    MERGE INTO DMT_EXPT_CHG_CALC
      USING DUAL
      ON (      BKG_NO              = @[bkg_no]
         AND    CNTR_NO             = @[cntr_no]
         AND    CNTR_CYC_NO         = @[cntr_cyc_no]
         AND    DMDT_TRF_CD         = @[dmdt_trf_cd]
         AND    DMDT_CHG_LOC_DIV_CD = @[dmdt_chg_loc_div_cd]
         AND    CHG_SEQ             = @[chg_seq]
         )
      WHEN MATCHED THEN
        UPDATE
          SET BKG_QTY               = @[bkg_qty]
            , INCUR_QTY             = @[incur_qty]
            , INCUR_CNTR_TEU_KNT    = @[incur_cntr_teu_knt]
            , EXPT_QTY              = @[expt_qty]
            , EXPT_CNTR_TEU_KNT     = @[expt_cntr_teu_knt]
            , INCUR_AMT             = @[incur_amt]
            , EXPT_FT_AMT           = @[expt_ft_amt]
            , EXPT_TRF_RT_ADJ_AMT   = @[expt_trf_rt_adj_amt]
            , EXPT_DYS              = CASE WHEN TO_NUMBER(@[expt_dys]) < 0 THEN 0 ELSE TO_NUMBER(@[expt_dys]) END
            , EXPT_COST_AMT         = @[expt_cost_amt]
            , DMDT_BZC_FT_END_DT    = TO_DATE(@[dmdt_bzc_ft_end_dt], 'YYYYMMDDHH24MI')
            , YD_CD                 = @[yd_cd]
            , YD_EXPT_COST_SEQ      = @[yd_expt_cost_seq]
            , EXPT_FT_END_DT        = TO_DATE(@[expt_ft_end_dt], 'YYYYMMDDHH24MI')
            , UPD_DT                = NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(SYSDATE), SYSDATE)
            , UPD_USR_ID            = @[upd_usr_id]
            , UPD_OFC_CD            = @[upd_ofc_cd]
            , CNTR_TPSZ_CD          = @[cntr_tpsz_cd]
      WHEN NOT MATCHED THEN
        INSERT (
            BKG_NO
          , CNTR_NO
          , CNTR_CYC_NO
          , DMDT_TRF_CD
          , DMDT_CHG_LOC_DIV_CD
          , CHG_SEQ
          , BKG_QTY
          , INCUR_QTY
          , INCUR_CNTR_TEU_KNT
          , EXPT_QTY
          , EXPT_CNTR_TEU_KNT
          , INCUR_AMT
          , EXPT_FT_AMT
          , EXPT_TRF_RT_ADJ_AMT
          , EXPT_DYS
          , EXPT_COST_AMT
          , DMDT_BZC_FT_END_DT
          , YD_CD
          , YD_EXPT_COST_SEQ
          , EXPT_FT_END_DT
          , CRE_USR_ID
          , CRE_DT
          , CRE_OFC_CD
          , UPD_USR_ID
          , UPD_DT
          , UPD_OFC_CD
          , CNTR_TPSZ_CD )
        VALUES (
            @[bkg_no]
          , @[cntr_no]
          , @[cntr_cyc_no]
          , @[dmdt_trf_cd]
          , @[dmdt_chg_loc_div_cd]
          , @[chg_seq]
          , @[bkg_qty]
          , @[incur_qty]
          , @[incur_cntr_teu_knt]
          , @[expt_qty]
          , @[expt_cntr_teu_knt]
          , @[incur_amt]
          , @[expt_ft_amt]
          , @[expt_trf_rt_adj_amt]
          , CASE WHEN TO_NUMBER(@[expt_dys]) < 0 THEN 0 ELSE TO_NUMBER(@[expt_dys]) END
          , @[expt_cost_amt]
          , TO_DATE (@[dmdt_bzc_ft_end_dt], 'YYYYMMDDHH24MI')
          , @[yd_cd]
          , @[yd_expt_cost_seq]
          , TO_DATE (@[expt_ft_end_dt], 'YYYYMMDDHH24MI')
          , @[upd_usr_id]
          , NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(SYSDATE), SYSDATE)
          , @[upd_ofc_cd]
          , @[upd_usr_id]
          , NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(SYSDATE), SYSDATE)
          , @[upd_ofc_cd]
          , @[cntr_tpsz_cd]
       )
#end			]]></sql>
			<params>
				<param name="upd_usr_id" type="12" value="1" out="N"/>
				<param name="upd_ofc_cd" type="12" value="1" out="N"/>
				<param name="bkg_no" type="12" value="1" out="N"/>
				<param name="cntr_no" type="12" value="1" out="N"/>
				<param name="cntr_cyc_no" type="12" value="1" out="N"/>
				<param name="dmdt_trf_cd" type="12" value="1" out="N"/>
				<param name="dmdt_chg_loc_div_cd" type="12" value="1" out="N"/>
				<param name="chg_seq" type="12" value="1" out="N"/>
				<param name="bkg_qty" type="12" value="1" out="N"/>
				<param name="incur_qty" type="12" value="1" out="N"/>
				<param name="incur_cntr_teu_knt" type="12" value="1" out="N"/>
				<param name="expt_qty" type="12" value="1" out="N"/>
				<param name="expt_cntr_teu_knt" type="12" value="1" out="N"/>
				<param name="incur_amt" type="12" value="1" out="N"/>
				<param name="expt_ft_amt" type="12" value="1" out="N"/>
				<param name="expt_trf_rt_adj_amt" type="12" value="1" out="N"/>
				<param name="expt_dys" type="12" value="1" out="N"/>
				<param name="expt_cost_amt" type="12" value="1" out="N"/>
				<param name="dmdt_bzc_ft_end_dt" type="12" value="1" out="N"/>
				<param name="yd_cd" type="12" value="1" out="N"/>
				<param name="yd_expt_cost_seq" type="12" value="1" out="N"/>
				<param name="expt_ft_end_dt" type="12" value="1" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="1" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
