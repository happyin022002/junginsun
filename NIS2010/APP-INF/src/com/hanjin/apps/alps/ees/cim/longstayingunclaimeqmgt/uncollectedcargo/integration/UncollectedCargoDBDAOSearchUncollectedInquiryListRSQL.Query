<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UncollectedCargoDBDAOSearchUncollectedInquiryListRSQL">
			<desc><![CDATA[UC Inquiry 리스트 조회 ]]></desc>
			<sql><![CDATA[
SELECT	ROWNUM AS RNUM
	, UC_CS_NO
	, UC_STS_CD
	, HNDL_RHQ_CD
	, HNDL_BRNC_CD
	, KNTR_RHQ_CD
	, KNTR_BRNC_CD
	, VVD
	, BL_NO
	, CNTR_NO
    , (SELECT CNTR_TPSZ_CD FROM MST_CONTAINER WHERE CNTR_NO = AA.CNTR_NO) AS CNTR_TPSZ_CD
	, SHPR
	, CNEE
	, NOTI
	, POL_CD
	, POL_ETD
	, POD_CD
	, POD_ETA
	, CNEE_UC_DT
	, UC_CLZ_DT
    , CRE_DT
	, UC_DYS
	, ROUND(NVL(TO_DATE(UC_CLZ_DT,'YYYYMMDD'),SYSDATE) - POD_ETA,0) AS DAYS_FROM_DISC
	, UC_DCHG_DYS
	, UC_DISP_OPT_CD
	, OTS_OTR_COST_AMT
	, OTS_RCVR_AMT
	, NET_LOSS
	, UC_CGO_N1ST_NTC_DT
	, UC_CGO_N2ND_NTC_DT
	, UC_CGO_N3RD_NTC_DT
	, UC_CGO_FNL_NTC_DT
	, UC_PICLB_CD
	, OTS_INSUR_CVR_AMT
	, HNDL_UPD_ID
	, UC_RSN_CD
	, CMDT
    , FACT_FND_ACT_DESC
    , HNDL_OFC_OPIN_DESC
    , KNTR_OFC_OPIN_DESC
    , UC_CGO_RHQ_MM_DESC
    , UC_CGO_HO_MM_DESC
    , UPD_DT 
FROM(	SELECT	
		  CGO.UC_CS_NO
		, CGO.UC_STS_CD
		, CGO.HNDL_RHQ_CD
		, CGO.HNDL_BRNC_CD
		, CGO.KNTR_RHQ_CD
		, CGO.KNTR_BRNC_CD
		, BKG.VSL_CD||BKG.SKD_VOY_NO||BKG.SKD_DIR_CD VVD
		, DTL.BL_NO
		, CNTR.CNTR_NO
        , ( SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')
             FROM   BKG_CUSTOMER C
             WHERE  BKG.BKG_NO         = C.BKG_NO
             AND    C.BKG_CUST_TP_CD = 'S'
           ) SHPR
        , ( SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')
             FROM   BKG_CUSTOMER C
             WHERE  BKG.BKG_NO         = C.BKG_NO
             AND    C.BKG_CUST_TP_CD = 'C'
           ) CNEE        
         , ( SELECT REPLACE(SUBSTR(C.CUST_NM,1,50),CHR(13)||CHR(10),' ')
             FROM   BKG_CUSTOMER C
             WHERE  BKG.BKG_NO         = C.BKG_NO
             AND    C.BKG_CUST_TP_CD = 'N'
           ) NOTI        
        , (
             SELECT  MIN(bb.pol_cd)
             FROM    bkg_vvd bb, bkg_booking kk, vsk_vsl_port_skd vv
             WHERE   1 = 1
                     AND kk.bl_no = BKG.bl_no
                     AND kk.bkg_no = bb.bkg_no
                     AND kk.pol_cd = bb.pol_cd
                     AND bb.vsl_cd = vv.vsl_cd
                     AND bb.skd_voy_no = vv.skd_voy_no
                     AND bb.skd_dir_cd = vv.skd_dir_cd
                     AND bb.pol_cd = vv.vps_port_cd
          ) pol_cd
       , (
             SELECT  MIN(vv.vps_etd_dt)
             FROM    bkg_vvd bb, bkg_booking kk, vsk_vsl_port_skd vv
             WHERE   1 = 1
                     AND kk.bl_no = BKG.bl_no
                     AND kk.bkg_no = bb.bkg_no
                     AND kk.pol_cd = bb.pol_cd
                     AND bb.vsl_cd = vv.vsl_cd
                     AND bb.skd_voy_no = vv.skd_voy_no
                     AND bb.skd_dir_cd = vv.skd_dir_cd
                     AND bb.pol_cd = vv.vps_port_cd
          ) pol_etd
       , ( 
            SELECT  MIN(bb.pod_cd)
            FROM    bkg_vvd bb, bkg_booking kk, vsk_vsl_port_skd vv
            WHERE   1 = 1
                    AND kk.bl_no = BKG.bl_no
                    AND kk.bkg_no = bb.bkg_no
                    AND kk.pod_cd = bb.pod_cd
                    AND bb.vsl_cd = vv.vsl_cd
                    AND bb.skd_voy_no = vv.skd_voy_no
                    AND bb.skd_dir_cd = vv.skd_dir_cd
                    AND bb.pod_cd = vv.vps_port_cd
          ) pod_cd
        , ( 
            SELECT  MIN(vv.vps_eta_dt)
            FROM    bkg_vvd bb, bkg_booking kk, vsk_vsl_port_skd vv
            WHERE   1 = 1
                    AND kk.bl_no = BKG.bl_no
                    AND kk.bkg_no = bb.bkg_no
                    AND kk.pod_cd = bb.pod_cd
                    AND bb.vsl_cd = vv.vsl_cd
                    AND bb.skd_voy_no = vv.skd_voy_no
                    AND bb.skd_dir_cd = vv.skd_dir_cd
                    AND bb.pod_cd = vv.vps_port_cd
          ) pod_eta        
		, CGO.CNEE_UC_DT
		, CGO.UC_CLZ_DT
		, CGO.CRE_DT
		, NVL(TO_DATE(CGO.UC_CLZ_DT,'YYYYMMDD'), TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD'),'YYYYMMDD')) - TO_DATE(CGO.CNEE_UC_DT,'YYYYMMDD') UC_DYS
		, UC_DCHG_DYS
		, DTL.UC_DISP_OPT_CD
		, (NVL(DTL.OTS_OFT_AMT,0) + NVL(DTL.OTS_OTR_AMT,0) + NVL(DTL.OTS_DMDT_AMT,0) + NVL(DTL.OTS_STO_AMT,0) + NVL(DTL.OTS_OTR_COST_AMT,0)) AS OTS_OTR_COST_AMT
		, DTL.OTS_RCVR_AMT
		, (NVL(DTL.OTS_OFT_AMT,0) + NVL(DTL.OTS_OTR_AMT,0) + NVL(DTL.OTS_DMDT_AMT,0) + NVL(DTL.OTS_STO_AMT,0) + NVL(DTL.OTS_OTR_COST_AMT,0)) - NVL(DTL.OTS_RCVR_AMT,0) AS NET_LOSS
		, DTL.UC_CGO_N1ST_NTC_DT
		, DTL.UC_CGO_N2ND_NTC_DT
		, DTL.UC_CGO_N3RD_NTC_DT
		, DTL.UC_CGO_FNL_NTC_DT
		, DTL.UC_PICLB_CD
		, DTL.OTS_INSUR_CVR_AMT
		, CGO.HNDL_HDLR_USR_ID HNDL_UPD_ID
		, DTL.UC_RSN_CD
        , ( SELECT C.CMDT_NM 
             FROM MDM_COMMODITY C 
             WHERE C.CMDT_CD = BKG.CMDT_CD
           ) CMDT  
        , SUBSTR (DTL.FACT_FND_ACT_DESC, 1, 3900) FACT_FND_ACT_DESC
        , DTL.HNDL_OFC_OPIN_DESC
        , DTL.KNTR_OFC_OPIN_DESC
        , DTL.UC_CGO_RHQ_MM_DESC
        , DTL.UC_CGO_HO_MM_DESC   
        , TO_CHAR(CGO.UPD_DT, 'YYYY-MM-DD') UPD_DT      
	FROM CIM_UC_CGO CGO
	    , CIM_UC_CGO_DTL DTL
	    , CIM_UC_CGO_CNTR CNTR
	    , BKG_BOOKING BKG
	WHERE CGO.UC_CS_NO = DTL.UC_CS_NO
	AND DTL.UC_CS_NO = CNTR.UC_CS_NO(+)
	AND DTL.BL_NO = CNTR.BL_NO(+)
	AND DTL.BL_NO = BKG.BL_NO(+)
   ORDER BY CGO.UC_CS_NO
) AA
WHERE 1=1
#if (${s_retrieve_gb} == 'A' )  
	#if (${s_uc_cs_no} != '' )
	    AND UC_CS_NO = @[s_uc_cs_no]    -- UC Case No
	#end
	#if (${s_bl_no} != '' )
	    AND BL_NO = @[s_bl_no]          -- B/L No
	#end
	#if (${s_cntr_no} != '' )
	    AND CNTR_NO = @[s_cntr_no]      -- CNTR NO
	#end
#end
#if (${s_retrieve_gb} == 'B' )  
	#if (${s_uc_sts_cd} != '' )   
	    AND UC_STS_CD = @[s_uc_sts_cd]    -- UC Status
	#end
	#if (${s_uc_rsn_cd} != '' )
	    AND uc_rsn_cd = @[s_uc_rsn_cd]    -- UC Type
	#end
	#if (${s_uc_disp_opt_cd} != '' )
	    AND UC_DISP_OPT_CD = @[s_uc_disp_opt_cd]  -- Disposal
	#end
	#if (${s_hndl_rhq_cd} != '' )
	    AND HNDL_RHQ_CD = @[s_hndl_rhq_cd]  -- Handling RHQ
	#end
	#if (${s_kntr_rhq_cd} != '' )
	    AND KNTR_RHQ_CD = @[s_kntr_rhq_cd]  -- Counter RHQ
	#end
	#if (${s_hndl_brnc_cd} != '' )
	    AND HNDL_BRNC_CD = @[s_hndl_brnc_cd]    -- Handling OFC
	#end
	#if (${s_kntr_brnc_cd} != '' )
	    AND KNTR_BRNC_CD = @[s_kntr_brnc_cd]    -- Counter OFC
	#end
	#if (${s_pol_cd} != '' )
	    AND POL_CD = @[s_pol_cd]    -- POL
	#end
	#if (${s_pod_cd} != '' )
	    AND POD_CD = @[s_pod_cd]    -- POD
	#end
	#if (${s_cnee_uc_dt_fr} != '' && ${s_cnee_uc_dt_to} != '' )
	      #if (${s_cnee_uc_dt_gb} == 'A') -- UC Date
	      	AND CNEE_UC_DT BETWEEN @[s_cnee_uc_dt_fr] AND @[s_cnee_uc_dt_to]
	      #end	
	      #if (${s_cnee_uc_dt_gb} == 'B') -- Close Date
	      	AND UC_CLZ_DT BETWEEN @[s_cnee_uc_dt_fr] AND @[s_cnee_uc_dt_to]
	      #end	
	      #if (${s_cnee_uc_dt_gb} == 'C') -- Creation Date
	      	AND TO_CHAR(CRE_DT,'YYYYMMDD') BETWEEN @[s_cnee_uc_dt_fr] AND @[s_cnee_uc_dt_to]
	      #end	
	      #if (${s_cnee_uc_dt_gb} == 'D') -- POL Date
	      	AND TO_CHAR(POL_ETD,'YYYYMMDD') BETWEEN @[s_cnee_uc_dt_fr] AND @[s_cnee_uc_dt_to]
	      #end	
	      #if (${s_cnee_uc_dt_gb} == 'E') -- POD Date
	      	AND TO_CHAR(POD_ETA,'YYYYMMDD') BETWEEN @[s_cnee_uc_dt_fr] AND @[s_cnee_uc_dt_to]
	      #end	
	#end
	#if (${s_uc_dys_fr} != '' && ${s_uc_dys_to} != '' )
	      #if (${s_uc_dys_gb} == 'A') -- UC Days
	      	AND UC_DYS  BETWEEN @[s_uc_dys_fr] AND @[s_uc_dys_to]
	      #end	
	      #if (${s_uc_dys_gb} == 'B') -- Days from Disc
	      	AND ROUND(SYSDATE - POD_ETA,0) BETWEEN @[s_uc_dys_fr] AND @[s_uc_dys_to]
	      #end	
	#end
	
#end			]]></sql>
			<params>
				<param name="s_uc_cs_no" type="12" value="" out="N"/>
				<param name="s_bl_no" type="12" value="" out="N"/>
				<param name="s_cntr_no" type="12" value="" out="N"/>
				<param name="s_uc_sts_cd" type="12" value="" out="N"/>
				<param name="s_uc_rsn_cd" type="12" value="" out="N"/>
				<param name="s_uc_disp_opt_cd" type="12" value="" out="N"/>
				<param name="s_hndl_rhq_cd" type="12" value="" out="N"/>
				<param name="s_kntr_rhq_cd" type="12" value="" out="N"/>
				<param name="s_hndl_brnc_cd" type="12" value="" out="N"/>
				<param name="s_kntr_brnc_cd" type="12" value="" out="N"/>
				<param name="s_pol_cd" type="12" value="" out="N"/>
				<param name="s_pod_cd" type="12" value="" out="N"/>
				<param name="s_cnee_uc_dt_fr" type="12" value="" out="N"/>
				<param name="s_cnee_uc_dt_to" type="12" value="" out="N"/>
				<param name="s_uc_dys_fr" type="12" value="" out="N"/>
				<param name="s_uc_dys_to" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
