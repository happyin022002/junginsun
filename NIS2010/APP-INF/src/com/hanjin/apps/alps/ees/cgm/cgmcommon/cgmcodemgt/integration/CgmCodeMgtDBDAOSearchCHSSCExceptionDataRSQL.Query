<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CgmCodeMgtDBDAOSearchCHSSCExceptionDataRSQL">
			<desc><![CDATA[DESC Enter..
-------------------------------------------------------------------------------------------------------------------------------------------
[자체 CSR] 2014-01-22 Jonghee HAN Row copy 및 Data Update시 Eff_dt, Exp_dt가 IBSheet내에 저장되지 않게 Coding에 되어 있어 해당 Data가 누락되는 현상 복구
-------------------------------------------------------------------------------------------------------------------------------------------]]></desc>
			<sql><![CDATA[
WITH LV_PARM AS (
    SELECT @[prop_no] PROP_NO,
      @[sc_expt_ver_seq] SC_EXPT_VER_SEQ
    FROM DUAL ) ,
  LV_CURR_LIST AS (
    SELECT 'C' STS,
      LOC_CD,
      CUST_CNT_CD,
      CUST_SEQ,
      CHSS_CNTR_CGO_TP_CD,
      CMDT_CD,
      USA_SC_EXPT_RMK,
      EFF_DT,
      EXP_DT,
	  A.SC_EXPT_VER_SEQ,
	  A.SC_EXPT_GRP_SEQ,
	  A.PROP_NO,
      A.FT_DYS
    FROM CGM_SC_EXPT_LIST A,
      LV_PARM P
    WHERE A.PROP_NO = P.PROP_NO
      AND A.SC_EXPT_VER_SEQ = P.SC_EXPT_VER_SEQ ) ,
  LV_OLD_LIST AS (
    SELECT 'O' STS,
      LOC_CD,
      CUST_CNT_CD,
      CUST_SEQ,
      CHSS_CNTR_CGO_TP_CD,
      CMDT_CD,
      USA_SC_EXPT_RMK,
      EFF_DT,
      EXP_DT,
	  A.SC_EXPT_VER_SEQ,
	  A.SC_EXPT_GRP_SEQ,
	  A.PROP_NO,
      A.FT_DYS
    FROM CGM_SC_EXPT_LIST A,
      LV_PARM P
    WHERE A.PROP_NO = P.PROP_NO
      AND A.SC_EXPT_VER_SEQ = P.SC_EXPT_VER_SEQ-1 )
SELECT TO_CHAR(A.EFF_DT, 'YYYY-MM-DD') EFF_DT,
  TO_CHAR(A.EXP_DT, 'YYYY-MM-DD') EXP_DT,
  A.STS,
  A.LOC_CD,
  A.CUST_CNT_CD,
  A.CUST_SEQ,
  A.CHSS_CNTR_CGO_TP_CD,
  A.CMDT_CD,
  A.USA_SC_EXPT_RMK,
  REPLACE((A.CUST_CNT_CD || TO_CHAR(A.CUST_SEQ, '000000')), ' ', '') CUST_CD,
  (SELECT CUST_LGL_ENG_NM FROM MDM_CUSTOMER WHERE CUST_CNT_CD = A.CUST_CNT_CD AND CUST_SEQ = A.CUST_SEQ) CUST_NM,
  (SELECT CMDT_NM FROM MDM_COMMODITY WHERE CMDT_CD = A.CMDT_CD AND DELT_FLG = 'N') CMDT_NM,
  NVL((
        SELECT 'E'
        FROM LV_OLD_LIST B
        WHERE A.LOC_CD = B.LOC_CD
          AND NVL(A.CUST_CNT_CD, 'X') = NVL(B.CUST_CNT_CD, 'X')
          AND NVL(A.CUST_SEQ, 0) = NVL(B.CUST_SEQ, 0)
          AND NVL(A.CHSS_CNTR_CGO_TP_CD, 'X') = NVL(B.CHSS_CNTR_CGO_TP_CD, 'X')
          AND NVL(A.CMDT_CD, 'X') = NVL(B.CMDT_CD, 'X') ), 'I') CUD_FLG,
	A.SC_EXPT_VER_SEQ,
	A.SC_EXPT_GRP_SEQ,
	A.PROP_NO,
    A.FT_DYS
FROM LV_CURR_LIST A
UNION ALL
SELECT TO_CHAR(A.EFF_DT, 'YYYY-MM-DD') EFF_DT,
  TO_CHAR(A.EXP_DT, 'YYYY-MM-DD') EXP_DT,
  A.STS,
  A.LOC_CD,
  A.CUST_CNT_CD,
  A.CUST_SEQ,
  A.CHSS_CNTR_CGO_TP_CD,
  A.CMDT_CD,
  A.USA_SC_EXPT_RMK,
  REPLACE((A.CUST_CNT_CD || TO_CHAR(A.CUST_SEQ, '000000')), ' ', '') CUST_CD,
  (SELECT CUST_LGL_ENG_NM FROM MDM_CUSTOMER WHERE CUST_CNT_CD = A.CUST_CNT_CD AND CUST_SEQ = A.CUST_SEQ) CUST_NM,
  (SELECT CMDT_NM FROM MDM_COMMODITY WHERE CMDT_CD = A.CMDT_CD AND DELT_FLG = 'N') CMDT_NM,
  'D' CUD_FLG,
   A.SC_EXPT_VER_SEQ,
   A.SC_EXPT_GRP_SEQ,
   A.PROP_NO,
   A.FT_DYS
FROM LV_OLD_LIST A,
  LV_CURR_LIST B
WHERE A.LOC_CD = B.LOC_CD(+)
  AND NVL(A.CUST_CNT_CD, 'X') = NVL(B.CUST_CNT_CD(+), 'X')
  AND NVL(A.CUST_SEQ, 0) = NVL(B.CUST_SEQ(+), 0)
  AND NVL(A.CHSS_CNTR_CGO_TP_CD, 'X') = NVL(B.CHSS_CNTR_CGO_TP_CD(+), 'X')
  AND NVL(A.CMDT_CD, 'X')= NVL(B.CMDT_CD(+), 'X')
  AND B.LOC_CD IS NULL
ORDER BY STS, LOC_CD, CUST_CNT_CD, CUST_SEQ, CHSS_CNTR_CGO_TP_CD, CMDT_CD			]]></sql>
			<params>
				<param name="prop_no" type="12" value="" out="N"/>
				<param name="sc_expt_ver_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
