<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AssetsAuditMgtDBDAOSearchAssetsSmryOwnListRSQL">
			<desc><![CDATA[SearchAssetsSmryOwnList]]></desc>
			<sql><![CDATA[
SELECT A.MFT_DT,
  A.CNTR_TPSZ_CD,
  A.LSTM_CD,
  A.CTRT_QTY,
  A.SLD_QTY,
  A.TLL_QTY,
  A.DON_QTY,
  A.SCR_QTY,
  A.CTRT_QTY - (A.SLD_QTY + A.TLL_QTY + A.DON_QTY + A.SCR_QTY) AS ASET_QTY,
  A.LST_QTY,
  A.SBO_QTY,
  A.MUO_QTY,
  A.LSO_QTY,
  A.DIO_QTY,
  A.CTRT_QTY - (A.SLD_QTY + A.TLL_QTY + A.DON_QTY + A.SCR_QTY) - (A.LST_QTY + A.SBO_QTY + A.MUO_QTY + A.LSO_QTY + A.DIO_QTY) AS ACT_QTY,
  NVL(@[cntr_pfx_cd],'') CNTR_PFX_CD,
  NVL(@[fm_ser_no],'') FM_SER_NO,
  NVL(@[to_ser_no],'') TO_SER_NO,
  NVL(@[mftr_vndr_seq],'') MFTR_VNDR_SEQ,
  NVL(@[loc_tp_cd],'') LOC_TP_CD,
  NVL(@[loc_cd],'') LOC_CD
FROM 
( 
    SELECT 
        A.MFT_DT,
        A.CNTR_TPSZ_CD,
        A.LSTM_CD,
        COUNT(A.CTRT_QTY) AS CTRT_QTY,
        SUM(A.SLD_QTY) AS SLD_QTY,
        SUM(A.TLL_QTY) AS TLL_QTY,
        SUM(A.DON_QTY) AS DON_QTY,
        SUM(A.SCR_QTY) AS SCR_QTY,
        SUM(A.LST_QTY) AS LST_QTY,
        SUM(A.SBO_QTY) AS SBO_QTY,
        SUM(A.MUO_QTY) AS MUO_QTY,   
        SUM(A.LSO_QTY) AS LSO_QTY,
        SUM(A.DIO_QTY) AS DIO_QTY 
    FROM 
    (
	    SELECT 
	        A.CNTR_NO,
	        TO_CHAR(A.MFT_DT,'YYYY') AS MFT_DT, 
	        A.CNTR_TPSZ_CD,
	        A.LSTM_CD,
	        A.CNTR_NO AS CTRT_QTY,
	        DECODE(A.CNTR_STS_CD,'SLD',1,0) AS SLD_QTY,
	        DECODE(A.CNTR_STS_CD,'TLL',1,0) AS TLL_QTY,
	        DECODE(A.CNTR_STS_CD,'DON',1,0) AS DON_QTY,
	        DECODE(A.CNTR_STS_CD,'SCR',1,0) AS SCR_QTY,           
	        DECODE(A.CNTR_STS_CD,'LST',1,0) AS LST_QTY,
	        DECODE(A.CNTR_STS_CD,'SBO',1,0) AS SBO_QTY,
	        DECODE(A.CNTR_STS_CD,'MUO',1,0) AS MUO_QTY,
	        DECODE(A.CNTR_STS_CD,'LSO',1,0) AS LSO_QTY, 
	        DECODE(A.CNTR_STS_CD,'DIO',1,0) AS DIO_QTY        
	    FROM MST_CONTAINER A
	    WHERE 1=1
	    AND A.OWNR_CO_CD = 'H'
		#if (${fm_prd} != '') 
	    AND A.MFT_DT >= TO_DATE(NVL(@[fm_prd],''),'YYYYMM') 
		#end
		#if (${to_prd} != '') 
	    AND A.MFT_DT <  ADD_MONTHS(TO_DATE(NVL(@[to_prd],''),'YYYYMM'),1)
		#end
	    AND DECODE(NVL(@[loc_tp_cd],''),'ALL','1','RCC',A.RCC_CD,'LCC',A.LCC_CD,'ECC',A.ECC_CD,'SCC',A.SCC_CD) = DECODE(NVL(@[loc_tp_cd],''),'ALL','1',NVL(@[loc_cd],''))    
		#if (${cntr_pfx_cd} != '') 
	    AND A.CNTR_NO LIKE NVL(@[cntr_pfx_cd],'') || '%'
		#end
		#if (${fm_ser_no} != '') 
	    AND TO_NUMBER(NVL(@[fm_ser_no],'')) <= TO_NUMBER(SUBSTR(A.CNTR_NO,5,6)) 
		#end
		#if (${to_ser_no} != '') 
	    AND TO_NUMBER(SUBSTR(A.CNTR_NO,5,6)) <= TO_NUMBER(NVL(@[to_ser_no],''))
		#end
		#if (${lstm_cd} == 'ALL')
		AND A.LSTM_CD IN ('OW','LP','OL')
		#else
		AND A.LSTM_CD = NVL(@[lstm_cd],'')
		#end
	    #if (${cntr_tpsz_cd} != '' && ${cntr_tpsz_cd} != 'ALL') 
	    AND A.CNTR_TPSZ_CD  IN ( 
			#foreach($cntrtpszcd in ${vel_tpsz_cd})  
				'$cntrtpszcd',  
				#end  
				'') 
		#end
		#if (${mftr_vndr_seq} != '') 
	    AND A.MFTR_VNDR_SEQ = NVL(@[mftr_vndr_seq],'')
		#end
	  ) A
    GROUP BY A.MFT_DT, A.CNTR_TPSZ_CD, A.LSTM_CD
) A
ORDER BY MFT_DT			]]></sql>
			<params>
				<param name="cntr_pfx_cd" type="12" value="" out="N"/>
				<param name="fm_ser_no" type="12" value="" out="N"/>
				<param name="to_ser_no" type="12" value="" out="N"/>
				<param name="mftr_vndr_seq" type="12" value="" out="N"/>
				<param name="loc_tp_cd" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="fm_prd" type="12" value="" out="N"/>
				<param name="to_prd" type="12" value="" out="N"/>
				<param name="lstm_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
