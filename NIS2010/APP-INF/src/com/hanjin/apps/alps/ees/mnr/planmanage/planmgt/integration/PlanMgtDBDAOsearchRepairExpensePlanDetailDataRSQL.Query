<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PlanMgtDBDAOsearchRepairExpensePlanDetailDataRSQL">
			<desc><![CDATA[----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Repair Expense Plan - M & R Budget Detail Data 조회
2014-06-16 BY JUSTIN HAN CSR ID : CHM-201430738, TITLE ALPS MNR-General Performance에서 Local Currency-> USD로 변환하는 로직 수정 요청
                  SELOPB로 조회시 HQ에서 수립한 BB 예산이 추가로 조회되어 문제 발생
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------]]></desc>
			<sql><![CDATA[
SELECT    B.MNR_PLN_SEQ                         
        , A.MNR_PLN_DTL_SEQ                     
        , B.MNR_PLN_YR                          
        , A.CTRL_OFC_CD                         
        , B.MNR_PLN_OFC_CD                      
        , B.CRE_USR_ID                          
        , To_CHAR(B.UPD_DT, 'YYYY-MM-DD') AS CRE_DT                          
        , A.ACCT_CD                             
        , A.MNR_PLN_AMT
        , A.OFC_TP_CD
        , NVL((SELECT A.MNR_PLN_FLG FROM MNR_PLN_HDR A WHERE A.MNR_GRP_TP_CD = 'RPR' AND A.MNR_PLN_YR = @[mnr_pln_yr] AND A.MNR_PLN_OFC_CD = @[mnr_pln_ofc_cd] AND ROWNUM = 1), 'N') MNR_PLN_FLG                     
        , A.CTRL_OFC_CD AS MNR_PLN_OFC_HDR_CD
        , A.OFC_TP_CD   AS OFC_TP_HDR_CD
        , A.MNR_PLN_SEQ AS MNR_PLN_HDR_SEQ         
   FROM MNR_PLN_DTL A, (SELECT MNR_PLN_SEQ, MNR_PLN_GRP_NO, MNR_PLN_OFC_CD, MNR_PLN_YR, UPD_DT, CRE_USR_ID
						  FROM MNR_PLN_HDR
						 WHERE 1=1
						   AND MNR_PLN_YR     = @[mnr_pln_yr]		   
                        #if(${mnr_pln_ofc_cd} != 'SELCON')
                           AND MNR_PLN_OFC_CD = @[mnr_pln_ofc_cd]
                        #end                        
                        ) B
						 
   WHERE 1=1
     AND A.MNR_PLN_SEQ = B.MNR_PLN_SEQ   
  #if(${mnr_pln_ofc_cd} == 'SELCON')
     AND A.CTRL_OFC_CD = B.MNR_PLN_OFC_CD
	 AND A.OFC_TP_CD = 'HQ'
  #else
	 AND A.OFC_TP_CD = 'BB'
  #end
  #if (${mnr_ofc_cd} != ''&& ${mnr_ofc_cd} != 'ALL')
     AND A.CTRL_OFC_CD = @[mnr_ofc_cd]
  #end
UNION ALL
SELECT    B.MNR_PLN_SEQ                         
        , A.MNR_PLN_DTL_SEQ                     
        , B.MNR_PLN_YR                          
        , A.CTRL_OFC_CD                         
        , B.MNR_PLN_OFC_CD                      
        , B.CRE_USR_ID                          
        , To_CHAR(B.UPD_DT, 'YYYY-MM-DD') AS CRE_DT                          
        , A.ACCT_CD                             
        , A.MNR_PLN_AMT
        , A.OFC_TP_CD 
        , NVL((SELECT A.MNR_PLN_FLG FROM MNR_PLN_HDR A WHERE A.MNR_GRP_TP_CD = 'RPR' AND A.MNR_PLN_YR = @[mnr_pln_yr] AND A.MNR_PLN_OFC_CD = @[mnr_pln_ofc_cd] AND ROWNUM = 1), 'N') MNR_PLN_FLG                     
        , A.CTRL_OFC_CD AS MNR_PLN_OFC_HDR_CD
        , A.OFC_TP_CD   AS OFC_TP_HDR_CD
        , A.MNR_PLN_SEQ AS MNR_PLN_HDR_SEQ        
   FROM MNR_PLN_DTL A, (SELECT MNR_PLN_SEQ, MNR_PLN_GRP_NO, MNR_PLN_OFC_CD, MNR_PLN_YR, UPD_DT, CRE_USR_ID
						  FROM MNR_PLN_HDR
						 WHERE 1=1
						   AND MNR_PLN_YR     = @[mnr_pln_yr]
                        #if(${mnr_pln_ofc_cd} != 'SELCON')
                           AND MNR_PLN_OFC_CD = @[mnr_pln_ofc_cd]
                        #end
                        ) B
   WHERE 1=1
     AND A.MNR_PLN_SEQ = B.MNR_PLN_SEQ
     AND A.OFC_TP_CD = 'BB'   
  #if(${mnr_pln_ofc_cd} == 'SELCON')
     AND A.CTRL_OFC_CD = @[mnr_pln_ofc_cd]
  #end	   
  #if (${mnr_ofc_cd} != ''&& ${mnr_ofc_cd} != 'ALL')
     AND A.CTRL_OFC_CD = @[mnr_ofc_cd]
  #end
ORDER BY 1, 5, 2, 4			]]></sql>
			<params>
				<param name="mnr_pln_yr" type="12" value="" out="N"/>
				<param name="mnr_pln_ofc_cd" type="12" value="" out="N"/>
				<param name="mnr_ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
