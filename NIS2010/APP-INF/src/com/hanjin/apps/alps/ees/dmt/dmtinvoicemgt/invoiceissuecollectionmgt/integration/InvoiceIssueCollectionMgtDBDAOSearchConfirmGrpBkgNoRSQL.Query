<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceIssueCollectionMgtDBDAOSearchConfirmGrpBkgNoRSQL">
			<desc><![CDATA[InvoiceIssueCollectionMgtDBDAOSearchConfirmGrpBkgNoRSQL]]></desc>
			<sql><![CDATA[
select  BKG_NO, DMDT_TRF_CD, POR_CD, DEL_CD
  from  (
			select  A.BKG_NO, B.DMDT_TRF_CD, A.POR_CD, A.DEL_CD, B.FM_MVMT_DT
			  from  DMT_CHG_BKG_CNTR 		A
				   ,DMT_CHG_CALC 			B

				   ,DMT_CHG_DELT_RQST_APRO 	R
				   
			 where  A.SYS_AREA_GRP_ID = B.SYS_AREA_GRP_ID
               and  A.CNTR_NO         = B.CNTR_NO
			   and  A.CNTR_CYC_NO     = B.CNTR_CYC_NO
			   and  B.CNTR_NO 		  = R.CNTR_NO(+)
			   and  B.CNTR_CYC_NO 	  = R.CNTR_CYC_NO(+)
			   and  B.SYS_AREA_GRP_ID = R.SYS_AREA_GRP_ID(+)
			   and  B.DMDT_TRF_CD     = R.DMDT_TRF_CD(+)

			and  B.OFC_CD 			= @[s_ofc_cd]
			and  B.DMDT_CHG_STS_CD 	= 'C'
			#if (${s_dmdt_trf_cd} != '')
			and B.DMDT_TRF_CD in 
				(
					#foreach( $dmdt_trf_no in ${dmdt_trf_cd_list}) 
						#if($velocityCount < $dmdt_trf_cd_list.size()) 
						   '$dmdt_trf_no', 
						#else 
						   '$dmdt_trf_no' 
						#end 
					#end
				)
			#end
			#if (${s_cont_type} == 'date') 
			and to_char(B.CFM_DT,'YYYYMMDD') between @[fm_cfm_dt] and @[to_cfm_dt]
			#elseif (${s_cont_type} == 'cntr') 
				#if (${s_bkg_no} != '')	
					and A.BKG_NO in 
						(
							#foreach( $bkg_cd in ${bkg_no_list} )
								#if($velocityCount < $bkg_no_list.size()) 
									'$bkg_cd', 
								#else 
									'$bkg_cd' 
								#end
							#end
						)
				#end
				#if (${s_bl_no} != '')	
					and A.BL_NO in 
						(
							#foreach( $bl_cd in ${bl_no_list} )
								#if($velocityCount < $bl_no_list.size()) 
									'$bl_cd', 
								#else 
									'$bl_cd' 
								#end
							#end
						)
				#end
				#if (${s_cntr_no} != '')	
					and A.CNTR_NO in 
						(
							#foreach( $cntr_cd in ${cntr_no_list} )
								#if($velocityCount < $cntr_no_list.size()) 
									'$cntr_cd', 
								#else 
									'$cntr_cd' 
								#end
							#end
						)
				#end
			#end
			#if (${s_chg_type} == 'G') 
			and B.CHG_SEQ = 1
			#elseif (${s_chg_type} == 'B') 
			and B.CHG_SEQ <> 1
			#end
			#if (${s_cust_cd} != '') 
				#if (${s_cust_gubun} == '1')
			and LPAD(B.ACT_CUST_SEQ,6,'0') = LPAD(@[s_cust_cd],6,'0')
				#elseif (${s_cust_gubun} == '2') 
			and B.ACT_CNT_CD = SUBSTR(@[s_cust_cd],1,2)
			and LPAD(B.ACT_CUST_SEQ,6,'0') = SUBSTR(@[s_cust_cd],3)
				#end
			#end
			#if (${s_sc_no} != '') 
			and A.SC_NO = @[s_sc_no]
			#end
			#if (${rfa_no} != '') 
			and A.RFA_NO = @[rfa_no]
			#end
		## 조건 추가(2010.01.12)
			and ((B.DUL_TP_EXPT_FLG= 'Y' and SUBSTR(B.DMDT_TRF_CD,1,1)  = 'C') or (B.DUL_TP_EXPT_FLG ='N'))
			ORDER by B.FM_MVMT_DT DESC
		)
WHERE ROWNUM = 1			]]></sql>
			<params>
				<param name="s_ofc_cd" type="12" value="" out="N"/>
				<param name="fm_cfm_dt" type="12" value="" out="N"/>
				<param name="to_cfm_dt" type="12" value="" out="N"/>
				<param name="s_cust_cd" type="12" value="" out="N"/>
				<param name="s_sc_no" type="12" value="" out="N"/>
				<param name="rfa_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
