<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EQMatchBackNLoadFactorMgtDBDAOSearchCargoFlowMapDetailRSQL">
			<desc><![CDATA[SearchCargoFlowMapDetail]]></desc>
			<sql><![CDATA[
SELECT 
      B.CNTR_NO
	 ,B.CNTR_TPSZ_CD
     ,C.LSTM_CD
     ,B.MVMT_STS_CD
     ,TO_CHAR(B.CNMV_EVNT_DT2,'YYYY-MM-DD HH24:MI:SS') AS CNMV_EVNT_DT
     ,B.ORG_YD_CD
     ,B.BKG_NO
     ,B.POR_CD
     ,B.POL_CD
     ,B.POD_CD
     ,B.DEL_CD
     ,TO_CHAR(B.POD_ETA_DT,'YYYY-MM-DD HH24:MI:SS') AS ETA_DT
     ,B.CRNT_VSL_CD||B.CRNT_SKD_VOY_NO||B.CRNT_SKD_DIR_CD AS VVD
FROM
	(
	    SELECT 
	     A.CNTR_NO
	    ,A.TGT_MVMT_DT
	    FROM CIM_BKG_MTCH_BAK A
	    ,(    
		    SELECT L1.LOC_CD
		    FROM MDM_LOCATION    L1
			    ,MDM_EQ_ORZ_CHT  O1
		    WHERE 1=1
		    AND L1.SCC_CD = O1.SCC_CD
/* FROM LOC */
#if (${inquiryWise1} == 'R')
			AND O1.RCC_CD = @[from_loc]
#elseif (${inquiryWise1} == 'L')
			AND O1.LCC_CD = @[from_loc]
#elseif (${inquiryWise1} == 'E')
			AND O1.ECC_CD = @[from_loc]
#elseif (${inquiryWise1} == 'S')
			AND O1.SCC_CD = @[from_loc]
#elseif (${inquiryWise1} == 'C')
			AND SUBSTR(O1.SCC_CD,1,2) = @[from_loc]
#elseif (${inquiryWise1} == 'P')
			AND L1.LOC_CD = @[from_loc]
#end
	    ) O1,
	    (
    	    SELECT L2.LOC_CD
	        FROM MDM_LOCATION   L2
	    	    ,MDM_EQ_ORZ_CHT O2
	        WHERE 1=1
	        AND L2.SCC_CD = O2.SCC_CD
/* TO LOC */
#if (${inquiryWise2} == 'R')
			AND O2.RCC_CD = @[to_loc]
#elseif (${inquiryWise2} == 'L')
			AND O2.LCC_CD = @[to_loc]
#elseif (${inquiryWise2} == 'E')
			AND O2.ECC_CD = @[to_loc]
#elseif (${inquiryWise2} == 'S')
			AND O2.SCC_CD = @[to_loc]
#elseif (${inquiryWise2} == 'C')
			AND SUBSTR(O2.SCC_CD,1,2) = @[to_loc]
#elseif (${inquiryWise2} == 'P')
			AND L2.LOC_CD = @[to_loc]
#end
	    ) O2
	    WHERE 1=1
#if (${period} == 'W')
	    AND A.TGT_YRWK BETWEEN @[fromz] AND @[toz]   
#elseif (${period} == 'M')
        AND A.TGT_MVMT_DT BETWEEN @[fromz] AND @[toz]	
#end
#if ( ${inquiryWise1} == 'P')
	  	AND A.CNTR_PERF_LOC_DIV_CD = 'POL'
#else
      	AND A.CNTR_PERF_LOC_DIV_CD = 'POR'
#end
/* TYPE SIZE */
      	AND A.CNTR_TPSZ_CD = @[tp_sz_loc]
/* soc */
#if (${soc} == 'E')
	  	AND  A.SOC_FLG  = 'N'
#end
#if (${soc} == 'O')
	  	AND  A.SOC_FLG  = 'Y'
#end
    	AND A.LOC_CD = O1.LOC_CD
	    AND A.TO_LOC_CD = O2.LOC_CD
	) A
    ,(
         SELECT 
              B.CNTR_NO
             ,B.CNTR_TPSZ_CD
             ,B.MVMT_STS_CD
             ,B.CNMV_EVNT_DT CNMV_EVNT_DT2
             ,B.ORG_YD_CD
             ,B.BKG_NO
             ,D.POR_CD
             ,D.POL_CD
             ,D.POD_CD
             ,D.DEL_CD
             ,D.POD_ETA_DT 
             ,B.CRNT_VSL_CD
             ,B.CRNT_SKD_VOY_NO
             ,B.CRNT_SKD_DIR_CD
             ,TO_CHAR(B.CNMV_EVNT_DT, 'YYYYMMDD') AS CNMV_EVNT_DT
         FROM
             CTM_MOVEMENT     B
            ,BKG_BOOKING      D            
         WHERE 1=1
         AND B.MVMT_STS_CD = 'VL'
         AND B.BKG_NO = D.BKG_NO         
     ) B   
    ,MST_CONTAINER    C     
WHERE 1=1
AND A.CNTR_NO = B.CNTR_NO
AND A.CNTR_NO = C.CNTR_NO
AND A.TGT_MVMT_DT = B.CNMV_EVNT_DT			]]></sql>
			<params>
				<param name="from_loc" type="12" value="" out="N"/>
				<param name="to_loc" type="12" value="" out="N"/>
				<param name="fromz" type="12" value="" out="N"/>
				<param name="toz" type="12" value="" out="N"/>
				<param name="tp_sz_loc" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
