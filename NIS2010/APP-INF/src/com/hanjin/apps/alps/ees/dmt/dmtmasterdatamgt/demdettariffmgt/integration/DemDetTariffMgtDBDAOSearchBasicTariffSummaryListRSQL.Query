<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DemDetTariffMgtDBDAOSearchBasicTariffSummaryListRSQL">
			<desc><![CDATA[Tariff Group 생성 이력  관리]]></desc>
			<sql><![CDATA[
SELECT  A.CVRG_CNT_CD
        , CASE WHEN TRIM(A.CVRG_YD_CD) IS NULL THEN
        	(CASE WHEN TRIM(A.CVRG_LOC_CD) IS NULL THEN
        		(CASE WHEN TRIM(A.CVRG_STE_CD) IS NULL THEN
        			(CASE WHEN TRIM(A.CVRG_RGN_CD) IS NULL THEN A.CVRG_CNT_CD ELSE A.CVRG_RGN_CD END)
        		ELSE A.CVRG_STE_CD
        		END)
        	ELSE A.CVRG_LOC_CD
        	END)
          ELSE A.CVRG_YD_CD
          END                                                                                               AS COVRG
        , A.DMDT_TRF_CD
        , CASE WHEN TRIM(A.ORG_DEST_LOC_CD) IS NULL THEN 
        	(CASE WHEN TRIM(A.ORG_DEST_STE_CD) IS NULL THEN
        		(CASE WHEN TRIM(A.ORG_DEST_RGN_CD) IS NULL THEN 
        			(CASE WHEN TRIM(A.ORG_DEST_CNT_CD) IS NULL THEN A.ORG_DEST_CONTI_CD ELSE A.ORG_DEST_CNT_CD END)
        		ELSE A.ORG_DEST_RGN_CD
        		END)
        	ELSE A.ORG_DEST_STE_CD
        	END)
          ELSE A.ORG_DEST_LOC_CD
          END                                                                                               AS ORG_DEST
        , B.DMDT_DE_TERM_CD
        , (
          SELECT  S.INTG_CD_VAL_DP_DESC
          FROM    COM_INTG_CD_DTL S
          WHERE   S.INTG_CD_ID        = 'CD03257'
          AND     S.INTG_CD_VAL_CTNT  = B.DMDT_DE_TERM_CD
          )                                                                                                 AS DMDT_DE_TERM_NM
        , CASE WHEN B.DMDT_TRF_GRP_TP_CD = 'N' THEN 'Exempted'
              ELSE B.DMDT_BZC_TRF_GRP_NM END                                                                AS DMDT_BZC_TRF_GRP_NM
        , TO_CHAR(B.EFF_DT,'YYYY-MM-DD')                                                                    AS EFF_DT
        , TO_CHAR(B.EXP_DT,'YYYY-MM-DD')                                                                    AS EXP_DT
        , (
          SELECT COUNT(*)
          FROM  DMT_TRF_CMB C 
          WHERE C.SYS_AREA_GRP_ID   = B.SYS_AREA_GRP_ID
          AND   C.DMDT_TRF_CD       = B.DMDT_TRF_CD
          AND   C.TRF_SEQ           = B.TRF_SEQ
          AND   C.DMDT_DE_TERM_CD   = B.DMDT_DE_TERM_CD
          AND   C.TRF_GRP_SEQ       = B.TRF_GRP_SEQ
          )                                                                                                 AS CNTR_CGO_CNT
        , (
          SELECT TO_CHAR(H.CRE_DT, 'YYYY-MM-DD')
          FROM   DMT_TRF_GRP_CFM_HIS H
          WHERE  H.SYS_AREA_GRP_ID  = B.SYS_AREA_GRP_ID
          AND    H.DMDT_TRF_CD      = B.DMDT_TRF_CD
          AND    H.TRF_SEQ          = B.TRF_SEQ
          AND    H.DMDT_DE_TERM_CD  = B.DMDT_DE_TERM_CD
          AND    H.TRF_GRP_SEQ      = B.TRF_GRP_SEQ
          AND    (H.RGN_CFM_SEQ||H.GRP_CFM_SEQ) = (
                                                  SELECT MAX(RGN_CFM_SEQ||GRP_CFM_SEQ)
                                                  FROM  DMT_TRF_GRP_CFM_HIS
                                                  WHERE SYS_AREA_GRP_ID     = H.SYS_AREA_GRP_ID
                                                  AND   DMDT_TRF_CD         = H.DMDT_TRF_CD
                                                  AND   TRF_SEQ             = H.TRF_SEQ
                                                  AND   DMDT_DE_TERM_CD     = H.DMDT_DE_TERM_CD
                                                  AND   TRF_GRP_SEQ         = H.TRF_GRP_SEQ
                                                  )
          )                                                                                                 AS CRE_DT
        , (
          SELECT CRE_OFC_CD 
          FROM   DMT_TRF_GRP_CFM_HIS H
          WHERE  H.SYS_AREA_GRP_ID     = B.SYS_AREA_GRP_ID
          AND    H.DMDT_TRF_CD         = B.DMDT_TRF_CD
          AND    H.TRF_SEQ             = B.TRF_SEQ
          AND    H.DMDT_DE_TERM_CD     = B.DMDT_DE_TERM_CD
          AND    H.TRF_GRP_SEQ         = B.TRF_GRP_SEQ
          AND    (H.RGN_CFM_SEQ||H.GRP_CFM_SEQ) = (
                                                  SELECT MAX(RGN_CFM_SEQ||GRP_CFM_SEQ)
                                                  FROM   DMT_TRF_GRP_CFM_HIS
                                                  WHERE  SYS_AREA_GRP_ID   = H.SYS_AREA_GRP_ID
                                                  AND    DMDT_TRF_CD       = H.DMDT_TRF_CD
                                                  AND    TRF_SEQ           = H.TRF_SEQ
                                                  AND    DMDT_DE_TERM_CD   = H.DMDT_DE_TERM_CD
                                                  AND    TRF_GRP_SEQ       = H.TRF_GRP_SEQ
                                                  )
          )                                                                                                 AS CRE_OFC_CD 
        , (
          SELECT (SELECT USR_NM FROM COM_USER WHERE USR_ID = H.CRE_USR_ID) 
          FROM  DMT_TRF_GRP_CFM_HIS H
          WHERE H.SYS_AREA_GRP_ID   = B.SYS_AREA_GRP_ID
          AND   H.DMDT_TRF_CD       = B.DMDT_TRF_CD
          AND   H.TRF_SEQ           = B.TRF_SEQ
          AND   H.DMDT_DE_TERM_CD   = B.DMDT_DE_TERM_CD
          AND   H.TRF_GRP_SEQ       = B.TRF_GRP_SEQ
          AND   (H.RGN_CFM_SEQ||H.GRP_CFM_SEQ) = (
                                                 SELECT MAX(RGN_CFM_SEQ||GRP_CFM_SEQ)
                                                 FROM   DMT_TRF_GRP_CFM_HIS
                                                 WHERE  SYS_AREA_GRP_ID = H.SYS_AREA_GRP_ID
                                                 AND    DMDT_TRF_CD     = H.DMDT_TRF_CD
                                                 AND    TRF_SEQ         = H.TRF_SEQ
                                                 AND    DMDT_DE_TERM_CD = H.DMDT_DE_TERM_CD
                                                 AND    TRF_GRP_SEQ     = H.TRF_GRP_SEQ
                                                 )
            )                                                                                           AS CRE_USR_NM 
        , DECODE(B.EXP_DT, NULL, '', TO_CHAR(B.UPD_DT, 'YYYY-MM-DD'))                                   AS UPD_DT
        , DECODE(B.EXP_DT, NULL, '', B.UPD_OFC_CD)                                                      AS UPD_OFC_CD
        , DECODE(B.EXP_DT, NULL, '', (SELECT USR_NM FROM COM_USER WHERE USR_ID=B.UPD_USR_ID) )          AS UPD_USR_NM
		, CASE WHEN TO_CHAR(EXP_DT,'YYYYMMDD') <= TO_CHAR(SYSDATE,'YYYYMMDD') THEN 'Y'
      	  ELSE 'N'
		  END                                                                                             AS EXPIRE_CHK
FROM    DMT_TRF_RGN A, 
        DMT_TRF_GRP B
WHERE   A.SYS_AREA_GRP_ID   = B.SYS_AREA_GRP_ID
AND     A.DMDT_TRF_CD       = B.DMDT_TRF_CD
AND     A.TRF_SEQ           = B.TRF_SEQ
AND     B.CFM_FLG           = 'Y'
AND     A.SUTH_CHN_USE_FLG  = 'N'
#if (${dmdt_de_term_cd} != 'A')
AND     B.DMDT_DE_TERM_CD   = @[dmdt_de_term_cd]
#end

#if (${svr_id} == '')
	#if (${cnt_cd} != '')
AND     A.CVRG_CNT_CD       = @[cnt_cd]
	#end
#elseif (${svr_id} == 'KOR' || ${svr_id} == 'JPN' || ${svr_id} == 'VVO')
	#if (${cnt_cd} == '')
AND     A.CVRG_CNT_CD       = DECODE(@[svr_id], 'KOR', 'KR', 'JPN', 'JP', 'VVO', 'RU')
	#else
AND     A.CVRG_CNT_CD       = @[cnt_cd]
	#end
#else
	#if (${cnt_cd} == '')
AND     A.SYS_AREA_GRP_ID   = @[svr_id]
	#else
AND     A.CVRG_CNT_CD       = @[cnt_cd]
	#end
#end

#if (${conti_cd} != '') 
AND A.ORG_DEST_CONTI_CD = @[conti_cd]
#end
#if (${dmdt_trf_cd_in} == 'Y')
AND     A.DMDT_TRF_CD IN (
    #foreach( $dmdt_trf_cd in ${dmdt_trf_cd_list}) 
        #if($velocityCount < $dmdt_trf_cd_list.size()) 
           '$dmdt_trf_cd', 
        #else 
           '$dmdt_trf_cd' 
        #end 
    #end
    )
#end
#if (${dmdt_trf_grp_tp_cd1} != '')
AND ( B.DMDT_TRF_GRP_TP_CD = @[dmdt_trf_grp_tp_cd1]
    #if (${dmdt_trf_grp_tp_cd2} != '')
		OR B.DMDT_TRF_GRP_TP_CD = @[dmdt_trf_grp_tp_cd2] 
    #end
	)
#else
    #if (${dmdt_trf_grp_tp_cd2} != '')
		AND B.DMDT_TRF_GRP_TP_CD = @[dmdt_trf_grp_tp_cd2]
    #end
#end
#if (${validity1} != '')
AND ( TO_CHAR(EFF_DT,'YYYYMMDD') <= TO_CHAR(SYSDATE,'YYYYMMDD')
      AND NVL(TO_CHAR(EXP_DT,'YYYYMMDD'),'99991231') >= TO_CHAR(SYSDATE,'YYYYMMDD')
    #if (${validity2} != '')
		OR (TO_CHAR(EFF_DT,'YYYYMMDD') > TO_CHAR(SYSDATE,'YYYYMMDD')
            AND NVL(TO_CHAR(EXP_DT,'YYYYMMDD'),'99991231') >= TO_CHAR(SYSDATE,'YYYYMMDD'))
        #if (${validity3} != '')
			OR (TO_CHAR(EXP_DT,'YYYYMMDD') <= TO_CHAR(SYSDATE,'YYYYMMDD'))
		#end
	#else
        #if (${validity3} != '')
			OR (TO_CHAR(EXP_DT,'YYYYMMDD') <= TO_CHAR(SYSDATE,'YYYYMMDD'))
		#end
    #end
	)
#else
AND (
    #if (${validity2} != '')
		TO_CHAR(EFF_DT,'YYYYMMDD') > TO_CHAR(SYSDATE,'YYYYMMDD')
        AND NVL(TO_CHAR(EXP_DT,'YYYYMMDD'),'99991231') >= TO_CHAR(SYSDATE,'YYYYMMDD')
		#if (${validity3} != '')
			OR (TO_CHAR(EXP_DT,'YYYYMMDD') <= TO_CHAR(SYSDATE,'YYYYMMDD'))
		#end
	#else
		TO_CHAR(EXP_DT,'YYYYMMDD') <= TO_CHAR(SYSDATE,'YYYYMMDD')
    #end
	)
#end
ORDER BY A.CVRG_CNT_CD, LENGTH(COVRG), COVRG, A.DMDT_TRF_CD, LENGTH(ORG_DEST), ORG_DEST, B.DMDT_DE_TERM_CD, B.DMDT_BZC_TRF_GRP_NM, EXP_DT			]]></sql>
			<params>
				<param name="dmdt_de_term_cd" type="12" value="" out="N"/>
				<param name="cnt_cd" type="12" value="" out="N"/>
				<param name="svr_id" type="12" value="CHN" out="N"/>
				<param name="conti_cd" type="12" value="" out="N"/>
				<param name="dmdt_trf_grp_tp_cd1" type="12" value="" out="N"/>
				<param name="dmdt_trf_grp_tp_cd2" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
