<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AssetsAuditMgtDBDAOSearchAssetsDetailLeaseListRSQL">
			<desc><![CDATA[SearchAssetsDetailLeaseList]]></desc>
			<sql><![CDATA[
SELECT  ROW_NUMBER() OVER (ORDER BY T01.CNTR_NO)          AS SEQ
      , (
        SELECT  VNDR_ABBR_NM 
        FROM    MDM_VENDOR S
        WHERE   S.VNDR_SEQ = T01.MFTR_VNDR_SEQ
        )                                                 AS VNDR_ABBR_NM
      , T01.MFTR_VNDR_SEQ
      , T01.CNTR_TPSZ_CD
      , T01.LSTM_CD
      , T01.CNTR_NO
      , TO_CHAR(T01.MFT_DT,'YYYY-MM-DD')                  AS MFT_DT 
      , T01.CNTR_STS_CD
      , '' AS LOT_NO
      , T01.RCC_CD
      , T01.LCC_CD
      , T01.SCC_CD
      , T01.CRNT_YD_CD
      , T01.CNMV_STS_CD
      , TO_CHAR(T01.CNMV_DT,'YYYY-MM-DD')                 AS CNMV_DT
      , T01.RF_MDL_NM
      , (
        SELECT  NVL(S.VNDR_ABBR_NM, S.VNDR_LGL_ENG_NM) 
        FROM    MDM_VENDOR S
        WHERE   S.VNDR_SEQ = T01.RF_MKR_SEQ
        )                                                  AS RF_MKR_SEQ
      , CASE WHEN T01.CNTR_STS_CD IN ('LSO', 'SBO', 'DIO', 'MUO', 'LST', 'SRO', 'SLD', 'SCR', 'DON', 'TLL') THEN
            (
            SELECT  /*+INDEX_DESC(S XAK1MST_CNTR_STS_HIS) */
                    TRUNC(S.CNTR_STS_EVNT_DT) + 1
            FROM    MST_CNTR_STS_HIS S
            WHERE   S.CNTR_NO       = T01.CNTR_NO
            AND     S.CNTR_STS_SEQ  = T01.LST_STS_SEQ
            AND     ROWNUM          = 1
            )
        ELSE
              TRUNC(SYSDATE) +1
        END   - TRUNC(T01.ONH_DT)                            AS USING_DAYS
FROM    (
        SELECT  T1.*
               , CNTR_STS_CD AS CUR_STS_CD
               , CASE WHEN CNTR_STS_CD IN ('SBI', 'LSO','TLL','SCR', 'SLD', 'SBO','DIO','MUO','LST') THEN 'LSI' ELSE CNTR_STS_CD END AS PRE_STS_CD
        FROM    MST_CONTAINER T1
        WHERE   1=1
        AND     T1.OWNR_CO_CD   = 'H'
        AND     T1.CNTR_TPSZ_CD = @[sel_cntr_tpsz_cd]
        AND     T1.LSTM_CD      = @[sel_lstm_cd]
        AND     DECODE(NVL(@[sel_loc_tp_cd], 'ALL'), 'ALL', '1', 'RCC', T1.RCC_CD,'LCC', T1.LCC_CD, 'ECC', T1.ECC_CD, 'SCC', T1.SCC_CD)
              = DECODE(NVL(@[sel_loc_tp_cd], 'ALL'), 'ALL', '1', @[sel_loc_cd])
     #if (${sel_mnfr_yr} != '') 
             AND     T1.MFT_DT >= TO_DATE(@[sel_mnfr_yr] || '0101 000000','yyyymmdd HH24MISS') AND T1.MFT_DT <= TO_DATE(@[sel_mnfr_yr] || '1231 235959','yyyymmdd HH24MISS')
     #else
             AND     T1.MFT_DT IS NULL
     #end
     #if (${sel_fm_prd} != '') 
             AND     T1.MFT_DT >= TO_DATE(@[sel_fm_prd],'YYYYMM') 
     #end
     #if (${sel_to_prd} != '') 
             AND     T1.MFT_DT <  ADD_MONTHS(TO_DATE(@[sel_to_prd],'YYYYMM'),1)
     #end
     AND DECODE(NVL(@[loc_tp_cd],''),'ALL','1','RCC',T1.RCC_CD,'LCC',T1.LCC_CD,'ECC',T1.ECC_CD,'SCC',T1.SCC_CD) = DECODE(NVL(@[loc_tp_cd],''),'ALL','1',NVL(@[loc_cd],''))
     #if (${sel_cntr_pfx_cd} != '') 
             AND    T1.CNTR_NO LIKE @[sel_cntr_pfx_cd] || '%'
     #end
     #if (${sel_fm_ser_no} != '') 
             AND    TO_NUMBER(@[sel_fm_ser_no]) <= TO_NUMBER(SUBSTR(T1.CNTR_NO,5,6)) 
     #end
     #if (${sel_to_ser_no} != '') 
             AND    TO_NUMBER(SUBSTR(T1.CNTR_NO,5,6)) <= TO_NUMBER(@[sel_to_ser_no])
     #end
     #if (${sel_mftr_vndr_seq} != '') 
         AND     T1.MFTR_VNDR_SEQ = @[sel_mftr_vndr_seq]        --Manufacturer-- 
                #end
        ) T01
WHERE   1=1
#if (${sel_col_nm} != 'ASE' && ${sel_col_nm} != 'ACT')
AND     CASE WHEN @[sel_col_nm] IN ( 'LSI', 'MUI', 'DII', 'FND' ) THEN
                  T01.PRE_STS_CD
             WHEN @[sel_col_nm] IN ( 'LSO', 'TLL', 'SBO', 'DIO', 'MUO', 'LST', 'SCR', 'SLD' ) THEN
                  T01.CUR_STS_CD
        END
        =
        CASE WHEN @[sel_col_nm] = 'LSI' THEN
             'LSI'
             WHEN @[sel_col_nm] = 'MUI' THEN
             'MUI'
             WHEN @[sel_col_nm] = 'DII' THEN
             'DII'
             WHEN @[sel_col_nm] = 'FND' THEN
             'FND'
             WHEN @[sel_col_nm] = 'LSO' THEN
             'LSO'
             WHEN @[sel_col_nm] = 'TLL' THEN
             'TLL'
             WHEN @[sel_col_nm] = 'SBO' THEN
             'SBO'
             WHEN @[sel_col_nm] = 'DIO' THEN
             'DIO'
             WHEN @[sel_col_nm] = 'MUO' THEN
             'MUO'
             WHEN @[sel_col_nm] = 'LST' THEN
             'LST'
             WHEN @[sel_col_nm] = 'SCR' THEN
             'SCR'
             WHEN @[sel_col_nm] = 'SLD' THEN
             'SLD'
        END
#end
#if (${sel_col_nm} == 'ASE')
AND     T01.PRE_STS_CD IN ( 'LSI', 'MUI', 'DII', 'FND' )
#end
#if (${sel_col_nm} == 'ACT')
AND     NOT EXISTS (SELECT 'X' FROM DUAL WHERE T01.CUR_STS_CD IN ('LSO', 'TLL', 'SBO', 'DIO', 'MUO', 'LST', 'SCR', 'SLD'))
#end
AND  @[sel_col_nm] = @[sel_col_nm]			]]></sql>
			<params>
				<param name="sel_cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="sel_lstm_cd" type="12" value="" out="N"/>
				<param name="sel_loc_tp_cd" type="12" value="" out="N"/>
				<param name="sel_loc_cd" type="12" value="" out="N"/>
				<param name="sel_mnfr_yr" type="12" value="" out="N"/>
				<param name="sel_fm_prd" type="12" value="" out="N"/>
				<param name="sel_to_prd" type="12" value="" out="N"/>
				<param name="loc_tp_cd" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="sel_cntr_pfx_cd" type="12" value="" out="N"/>
				<param name="sel_fm_ser_no" type="12" value="" out="N"/>
				<param name="sel_to_ser_no" type="12" value="" out="N"/>
				<param name="sel_mftr_vndr_seq" type="12" value="" out="N"/>
				<param name="sel_col_nm" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
