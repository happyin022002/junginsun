<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RepairMgtDBDAOAddAutoAcepChkHeaderCSQL">
			<desc><![CDATA[Acep Check List Header Auto Insert]]></desc>
			<sql><![CDATA[
INSERT INTO MNR_ACEP_CHK_LIST_HDR
(
         ACEP_SEQ
       , MNR_WO_TP_CD
       , EQ_NO
       , RPR_RQST_SEQ
       , MNR_ORD_OFC_CTY_CD
       , MNR_ORD_SEQ
       , ORD_DTL_SEQ
       , INSP_YD_CD
       , LST_INSP_DT
       , INSP_DT
       , CRE_USR_ID
       , CRE_DT
       , UPD_USR_ID
       , UPD_DT
)

#if (${mnr_wo_tp_cd} == 'EST')

SELECT   @[acep_seq] AS ACEP_SEQ
       , @[mnr_wo_tp_cd] AS MNR_WO_TP_CD
       , EM.RQST_EQ_NO
       , EM.RPR_RQST_SEQ
       , NULL AS MNR_ORD_OFC_CTY_CD
       , NULL AS MNR_ORD_SEQ
       , NULL AS ORD_DTL_SEQ
       , EM.RPR_YD_CD AS INSP_YD_CD
       , (
           SELECT   /*+ INDEX_DESC(OD XAK6MNR_ORD_DTL) */
                    TO_CHAR(OD.RPR_RSLT_DT,'YYYYMMDD')
           FROM     MNR_ORD_DTL OD
           WHERE    1 = 1
           AND      OD.EQ_NO = EM.RQST_EQ_NO
           AND      OD.CRE_DT < NVL(EM.RPR_RSLT_DT, EM.CRE_DT)
           AND      ROWNUM = 1
         ) AS LST_INSP_DT
       , TO_CHAR(RQST_DT,'YYYYMMDD') AS INSP_DT
       , @[cre_usr_id] AS CRE_USR_ID
       , SYSDATE
       , @[upd_usr_id] AS UPD_USR_ID
       , SYSDATE
FROM     MNR_RPR_RQST_HDR EM
WHERE    1 = 1
AND      EM.RQST_EQ_NO = @[eq_no]
AND      EM.RPR_RQST_SEQ = @[rpr_rqst_seq]
AND      EM.RPR_RQST_LST_VER_FLG = 'Y'
AND      ROWNUM = 1

#else

SELECT   @[acep_seq] AS ACEP_SEQ
       , OM.MNR_WO_TP_CD
       , OD.EQ_NO
       , NULL AS RPR_RQST_SEQ
       , OD.MNR_ORD_OFC_CTY_CD
       , OD.MNR_ORD_SEQ
       , OD.ORD_DTL_SEQ
       , OD.YD_CD AS INSP_YD_CD
       , (
           SELECT   /*+ INDEX_DESC(OD XAK6MNR_ORD_DTL) */
                    TO_CHAR(BD.RPR_RSLT_DT,'YYYYMMDD')
           FROM     MNR_ORD_DTL BD
           WHERE    1 = 1
           AND      BD.EQ_NO = OD.EQ_NO
           AND      BD.CRE_DT < TRUNC(SYSDATE)
           AND      ROWNUM = 1
         ) AS LST_INSP_DT
       , TO_CHAR(OD.RPR_RSLT_DT,'YYYYMMDD') AS INSP_DT
       , OD.CRE_USR_ID
       , SYSDATE
       , OD.UPD_USR_ID
       , SYSDATE
FROM     MNR_ORD_DTL OD
       , MNR_ORD_HDR OM
WHERE    1 = 1
AND      OD.MNR_ORD_OFC_CTY_CD = OM.MNR_ORD_OFC_CTY_CD
AND      OD.MNR_ORD_SEQ = OM.MNR_ORD_SEQ
AND      OM.MNR_WO_TP_CD IN ('SPL')
AND      OD.MNR_ORD_OFC_CTY_CD = @[mnr_ord_ofc_cty_cd]
AND      OD.MNR_ORD_SEQ = @[mnr_ord_seq]
AND      OD.ORD_DTL_SEQ = @[ord_dtl_seq]

#end			]]></sql>
			<params>
				<param name="acep_seq" type="12" value="" out="N"/>
				<param name="mnr_wo_tp_cd" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="eq_no" type="12" value="" out="N"/>
				<param name="rpr_rqst_seq" type="12" value="" out="N"/>
				<param name="mnr_ord_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="mnr_ord_seq" type="12" value="" out="N"/>
				<param name="ord_dtl_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
