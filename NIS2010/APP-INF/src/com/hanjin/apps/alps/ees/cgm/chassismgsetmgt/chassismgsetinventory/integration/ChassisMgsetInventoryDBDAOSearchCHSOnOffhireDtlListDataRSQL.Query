<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChassisMgsetInventoryDBDAOSearchCHSOnOffhireDtlListDataRSQL">
			<desc><![CDATA[ChassisMgsetInventoryDBDAOSearchCHSOnOffhireDtlListDataRSQL]]></desc>
			<sql><![CDATA[
#if(${program_id}== '1010')
	SELECT /* distinct */
		A.EQ_NO,
		A.EQ_TPSZ_CD,
		A.AGMT_LSTM_CD,
		A.AGMT_OFC_CTY_CD || LPAD(A.AGMT_SEQ, 6, '0') AS AGMT_NO,
		B.VNDR_ABBR_NM,
		A.CHSS_MVMT_STS_CD,
		D.LCC_CD,
		C.SCC_CD,
		E.STS_EVNT_YD_CD CRNT_YD_CD,
		A.ONH_DT,
		A.CHSS_MVMT_DT,
		TRUNC(SYSDATE - A.CHSS_MVMT_DT,0) AS LSDAYS
	FROM     
		CGM_EQUIPMENT A,
		MDM_VENDOR B,
		MDM_LOCATION C,
		MDM_EQ_ORZ_CHT D,
		CGM_EQ_STS_HIS E,
		CGM_AGREEMENT F
	WHERE A.VNDR_SEQ = B.VNDR_SEQ
		  AND E.STS_EVNT_LOC_CD = C.LOC_CD
		  AND C.SCC_CD = D.SCC_CD
		  AND C.DELT_FLG = 'N'
		  AND D.DELT_FLG = 'N'
		  AND A.AGMT_OFC_CTY_CD = F.AGMT_OFC_CTY_CD
		  AND A.AGMT_SEQ = F.AGMT_SEQ
          AND F.LST_VER_FLG ='Y'
		  AND A.EQ_KND_CD =  @[eq_knd_cd]
		  AND A.EQ_NO = E.EQ_NO
		  AND E.STS_EVNT_DT >= TO_DATE(@[sts_evnt_dt_fr],'YYYY-MM-DD')  --
		  AND E.STS_EVNT_DT <  TO_DATE(@[sts_evnt_dt_to],'YYYY-MM-DD')+1  --   
		  AND E.EQ_ASET_STS_CD = @[eq_aset_sts_cd]
		  AND E.TERM_CNG_SEQ IS NULL
	#if (${crnt_yd_cd} != '') 
		  AND E.STS_EVNT_YD_CD = @[crnt_yd_cd]  
	#end  

	 #if ( ${location} == 'R' ) 
	   AND  D.RCC_CD = @[scc_cd]
	#elseif ( ${location} == 'L' )
	   AND  D.LCC_CD = @[scc_cd]
	#elseif ( ${location} == 'S' )
	  AND   D.SCC_CD = @[scc_cd]
	#end

	#if (${eq_tpsz_cd} != '') 
		AND A.EQ_TPSZ_CD = @[eq_tpsz_cd]
	#end
	#if (${sts_evnt_loc_cd} != '') 
		AND E.STS_EVNT_LOC_CD  = @[sts_evnt_loc_cd] 
	#end

	#if (${agmt_lstm_cd} != '' && ${agmt_lstm_cd} != 'ALL') 
		AND A.AGMT_LSTM_CD  = @[agmt_lstm_cd] 
	#end

	#if (${s_agmt_lstm_cd} != '')
		AND A.AGMT_LSTM_CD IN ($s_agmt_lstm_cd)
	#end

	#if (  ${vndr_seq} != '' )
	   #if (${kind} == 'L' )
		   AND	F.VNDR_SEQ IN ($vndr_seq)
	   #elseif ( ${kind} == 'A' )
		   AND  (F.AGMT_OFC_CTY_CD,F.AGMT_SEQ ) IN ($vndr_seq)       
	   #end
	#end
#elseif ( ${program_id}== '1019' )
#if ( ${eq_aset_sts_cd} == 'LST')
SELECT AAA.EQ_NO,
	   AAA.EQ_TPSZ_CD,
	   AAA.AGMT_LSTM_CD,
	   AAA.AGMT_NO,
	   AAA.VNDR_ABBR_NM,
	   AAA.CHSS_MVMT_STS_CD,
	   AAA.LCC_CD,
	   AAA.SCC_CD,
	   AAA.CRNT_YD_CD,
	   AAA.ONH_DT,
	   AAA.CHSS_MVMT_DT,
	   AAA.LSDAYS
FROM (
			SELECT /* distinct */
				A.EQ_NO,
				A.EQ_TPSZ_CD,
				A.AGMT_LSTM_CD,
				A.AGMT_OFC_CTY_CD || LPAD(A.AGMT_SEQ, 6, '0') AS AGMT_NO,
				D.VNDR_ABBR_NM,
				A.CHSS_MVMT_STS_CD,
				BB.LCC_CD,
				AA.SCC_CD,
				B.STS_EVNT_YD_CD CRNT_YD_CD,
				A.ONH_DT,
				A.CHSS_MVMT_DT,
				TRUNC(SYSDATE - A.CHSS_MVMT_DT,0) AS LSDAYS,
 				CASE WHEN LAG ( B.EQ_ASET_STS_CD ) OVER (PARTITION BY  B.EQ_NO ORDER BY B.EQ_NO,B.STS_EVNT_DT,B.EQ_STS_SEQ )  = 'LST' AND  B.EQ_ASET_STS_CD = 'FND' THEN NULL
					ELSE  B.EQ_ASET_STS_CD
			  	END EVENT_KNT

			FROM CGM_EQUIPMENT A
			,CGM_EQ_STS_HIS B
	 
			,MDM_VENDOR D
			,MDM_LOCATION AA
			,MDM_EQ_ORZ_CHT BB
		WHERE  A.EQ_KND_CD = 'Z'  
		AND A.EQ_NO = B.EQ_NO 
		AND A.VNDR_SEQ = D.VNDR_SEQ
	#if ( ${eq_aset_sts_cd} != '')
		AND B.STS_EVNT_DT >= TO_DATE(@[sts_evnt_dt_fr],'YYYY-MM-DD')
		AND B.STS_EVNT_DT <  TO_DATE(@[sts_evnt_dt_to] ,'YYYY-MM-DD')+1
	#end
		AND  AA.SCC_CD = BB.SCC_CD
		AND  AA.DELT_FLG = 'N'
		AND  BB.DELT_FLG = 'N'
		AND B.STS_EVNT_LOC_CD = AA.LOC_CD
	#if ( ${eq_aset_sts_cd} == 'LST')
		 
		AND B.EQ_ASET_STS_CD IN  ('LST','FND' )
	#end

	#if ( ${eq_aset_sts_cd} == 'FND')
		AND B.EQ_ASET_STS_CD =  @[eq_aset_sts_cd]  

	#end

	#if ( ${eq_aset_sts_cd} == '')
		AND A.EQ_NO = B.EQ_NO
		AND A.EQ_STS_SEQ = B.EQ_STS_SEQ
		AND B.EQ_ASET_STS_CD =  'LST' 
	#end

		#if (${eq_tpsz_cd} != '') 
			AND A.EQ_TPSZ_CD = @[eq_tpsz_cd]
		#end

		#if (${agmt_lstm_cd} != '' && ${agmt_lstm_cd} != 'ALL') 
			AND A.AGMT_LSTM_CD  = @[agmt_lstm_cd] 
		#end

		#if ( ${sts_evnt_yd_cd} != '' )
		   AND B.STS_EVNT_YD_CD = @[sts_evnt_yd_cd] 
		#end

		#if (${crnt_yd_cd} != '') 
			  AND B.STS_EVNT_YD_CD = @[crnt_yd_cd]  
		#end  

	#if (  ${vndr_seq} != '' )
		   AND	A.VNDR_SEQ IN ($vndr_seq)
	#end 

	#if (${sts_evnt_loc_cd} != '')  
		#if ( ${location} == 'C' )
			AND  BB.RCC_CD = @[sts_evnt_loc_cd]
		#elseif ( ${location} == 'R' )
			AND  BB.LCC_CD = @[sts_evnt_loc_cd]
		#elseif ( ${location} == 'L' )
			AND   BB.SCC_CD = @[sts_evnt_loc_cd]
		#end
	#end
    #if (${scc_cd} != '')  
        #if ( ${location} == 'R' ) 
	       AND  BB.RCC_CD = @[scc_cd]
	    #elseif ( ${location} == 'L' )
	       AND  BB.LCC_CD = @[scc_cd]
	    #elseif ( ${location} == 'S' )
	      AND   BB.SCC_CD = @[scc_cd]
	    #end
    #end
	) AAA
	WHERE AAA.EVENT_KNT IS NOT NULL
#else
			SELECT /* distinct */
				A.EQ_NO,
				A.EQ_TPSZ_CD,
				A.AGMT_LSTM_CD,
				A.AGMT_OFC_CTY_CD || LPAD(A.AGMT_SEQ, 6, '0') AS AGMT_NO,
				D.VNDR_ABBR_NM,
				A.CHSS_MVMT_STS_CD,
				BB.LCC_CD,
				AA.SCC_CD,
				B.STS_EVNT_YD_CD CRNT_YD_CD,
				A.ONH_DT,
				A.CHSS_MVMT_DT,
				TRUNC(SYSDATE - A.CHSS_MVMT_DT,0) AS LSDAYS
			FROM CGM_EQUIPMENT A
			,CGM_EQ_STS_HIS B
	 
			,MDM_VENDOR D
			,MDM_LOCATION AA
			,MDM_EQ_ORZ_CHT BB
		WHERE  A.EQ_KND_CD = 'Z'  
		AND A.EQ_NO = B.EQ_NO 
		AND A.VNDR_SEQ = D.VNDR_SEQ
	#if ( ${eq_aset_sts_cd} != '')
		AND B.STS_EVNT_DT >= TO_DATE(@[sts_evnt_dt_fr],'YYYY-MM-DD')
		AND B.STS_EVNT_DT <  TO_DATE(@[sts_evnt_dt_to] ,'YYYY-MM-DD')+1
	#end
		AND  AA.SCC_CD = BB.SCC_CD
		AND  AA.DELT_FLG = 'N'
		AND  BB.DELT_FLG = 'N'
		AND B.STS_EVNT_LOC_CD = AA.LOC_CD
	#if ( ${eq_aset_sts_cd} == 'LST')
		 
		AND B.EQ_ASET_STS_CD IN  ('LST','FND' )
	#end

	#if ( ${eq_aset_sts_cd} == 'FND')
		AND B.EQ_ASET_STS_CD =  @[eq_aset_sts_cd]  

	#end

	#if ( ${eq_aset_sts_cd} == '')
		AND A.EQ_NO = B.EQ_NO
		AND A.EQ_STS_SEQ = B.EQ_STS_SEQ
		AND B.EQ_ASET_STS_CD =  'LST' 
	#end

		#if (${eq_tpsz_cd} != '') 
			AND A.EQ_TPSZ_CD = @[eq_tpsz_cd]
		#end

		#if (${agmt_lstm_cd} != '' && ${agmt_lstm_cd} != 'ALL') 
			AND A.AGMT_LSTM_CD  = @[agmt_lstm_cd] 
		#end

		#if ( ${sts_evnt_yd_cd} != '' )
		   AND B.STS_EVNT_YD_CD = @[sts_evnt_yd_cd] 
		#end

		#if (${crnt_yd_cd} != '') 
			  AND B.STS_EVNT_YD_CD = @[crnt_yd_cd]  
		#end  

	#if (  ${vndr_seq} != '' )
		   AND	A.VNDR_SEQ IN ($vndr_seq)
	#end 

	#if (${sts_evnt_loc_cd} != '')  
		#if ( ${location} == 'C' )
			AND  BB.RCC_CD = @[sts_evnt_loc_cd]
		#elseif ( ${location} == 'R' )
			AND  BB.LCC_CD = @[sts_evnt_loc_cd]
		#elseif ( ${location} == 'L' )
			AND   BB.SCC_CD = @[sts_evnt_loc_cd]
		#end
	#end

    #if (${scc_cd} != '')  
        #if ( ${location} == 'R' ) 
	       AND  BB.RCC_CD = @[scc_cd]
	    #elseif ( ${location} == 'L' )
	       AND  BB.LCC_CD = @[scc_cd]
	    #elseif ( ${location} == 'S' )
	      AND   BB.SCC_CD = @[scc_cd]
	    #end
    #end
#end	
	
#end			]]></sql>
			<params>
				<param name="eq_knd_cd" type="12" value="" out="N"/>
				<param name="sts_evnt_dt_fr" type="12" value="" out="N"/>
				<param name="sts_evnt_dt_to" type="12" value="" out="N"/>
				<param name="eq_aset_sts_cd" type="12" value="" out="N"/>
				<param name="crnt_yd_cd" type="12" value="" out="N"/>
				<param name="scc_cd" type="12" value="" out="N"/>
				<param name="eq_tpsz_cd" type="12" value="" out="N"/>
				<param name="sts_evnt_loc_cd" type="12" value="" out="N"/>
				<param name="agmt_lstm_cd" type="12" value="" out="N"/>
				<param name="sts_evnt_yd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
