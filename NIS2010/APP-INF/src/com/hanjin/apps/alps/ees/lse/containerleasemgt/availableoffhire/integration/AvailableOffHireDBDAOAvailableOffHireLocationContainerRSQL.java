/*=========================================================
*Copyright(c) 2017 CyberLogitec
*@FileName : AvailableOffHireDBDAOAvailableOffHireLocationContainerRSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2017.01.18
*@LastModifier : 
*@LastVersion : 1.0
* 2017.01.18 
* 1.0 Creation
=========================================================*/
package com.hanjin.apps.alps.ees.lse.containerleasemgt.availableoffhire.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.hanjin.framework.support.db.ISQLTemplate;

/**
 *
 * @author 
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class AvailableOffHireDBDAOAvailableOffHireLocationContainerRSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * 지역별 지정된 반납대상 장비의 내역을 조회합니다.
	  * </pre>
	  */
	public AvailableOffHireDBDAOAvailableOffHireLocationContainerRSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("end_estm_dt",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("cnmv_sts_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("vndr_seq",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("loc_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("vvd_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("str_estm_dt",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("agmt_seq",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("loc_tp",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("agmt_cty_cd",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.hanjin.apps.alps.ees.lse.containerleasemgt.availableoffhire.integration").append("\n"); 
		query.append("FileName : AvailableOffHireDBDAOAvailableOffHireLocationContainerRSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("WITH PARAM AS ( " ).append("\n"); 
		query.append("    SELECT  @[loc_tp]        AS P_LOC_TP, " ).append("\n"); 
		query.append("            @[loc_cd]        AS P_LOC_CD,  " ).append("\n"); 
		query.append("            @[vvd_cd]        AS P_VVD_CD," ).append("\n"); 
		query.append("            @[str_estm_dt]   AS P_STR_ESTM_DT," ).append("\n"); 
		query.append("            @[end_estm_dt]   AS P_END_ESTM_DT," ).append("\n"); 
		query.append("            @[cnmv_sts_cd]   AS P_CNMV_STS_CD," ).append("\n"); 
		query.append("            @[agmt_cty_cd]   AS P_AGMT_CTY_CD," ).append("\n"); 
		query.append("            @[agmt_seq]      AS P_AGMT_SEQ," ).append("\n"); 
		query.append("            @[vndr_seq]      AS P_VNDR_SEQ" ).append("\n"); 
		query.append("    FROM    DUAL" ).append("\n"); 
		query.append("--), TEMP_DROP01 AS (" ).append("\n"); 
		query.append("--SELECT  SCC_CD AS T_SCC_CD" ).append("\n"); 
		query.append("--      , AGMT_CTY_CD AS T_AGMT_CTY_CD" ).append("\n"); 
		query.append("--      , AGMT_SEQ AS T_AGMT_SEQ" ).append("\n"); 
		query.append("--      , CNTR_TPSZ_CD AS T_CNTR_TPSZ_CD" ).append("\n"); 
		query.append("--FROM    (" ).append("\n"); 
		query.append("--        SELECT  SCC_CD," ).append("\n"); 
		query.append("--        AGMT_CTY_CD," ).append("\n"); 
		query.append("--        AGMT_SEQ," ).append("\n"); 
		query.append("--        CNTR_TPSZ_CD" ).append("\n"); 
		query.append("--        FROM MST_CONTAINER" ).append("\n"); 
		query.append("--        WHERE ACIAC_DIV_CD ='A'" ).append("\n"); 
		query.append("--        AND DECODE([loc_tp],'2',SCC_CD, '1',LCC_CD ,'0',RCC_CD) = [loc_cd]" ).append("\n"); 
		query.append("--        AND  (SCC_CD , AGMT_SEQ , AGMT_CTY_CD , CNTR_TPSZ_CD) IN (" ).append("\n"); 
		query.append("--               SELECT LSE_RT.LOC_CD," ).append("\n"); 
		query.append("--          LSE.AGMT_SEQ AGMT_SEQ," ).append("\n"); 
		query.append("--          LSE.AGMT_CTY_CD," ).append("\n"); 
		query.append("--          LSE_RT.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("--        FROM LSE_AGMT_RT LSE_RT ," ).append("\n"); 
		query.append("--          LSE_AGREEMENT LSE" ).append("\n"); 
		query.append("--          WHERE LSE_RT.CNTR_RNTL_CHG_TP_CD = 'DOCV'" ).append("\n"); 
		query.append("--          AND LSE_RT.AGMT_SEQ = LSE.AGMT_SEQ" ).append("\n"); 
		query.append("--          AND LSE_RT.AGMT_CTY_CD = LSE.AGMT_CTY_CD" ).append("\n"); 
		query.append("--          AND LSE.AGMT_LST_VER_SEQ = NVL(null, LSE.AGMT_LST_VER_SEQ)" ).append("\n"); 
		query.append("--          AND LSE_RT.LOC_CD IN (" ).append("\n"); 
		query.append("--            SELECT SCC_CD FROM MDM_EQ_ORZ_CHT" ).append("\n"); 
		query.append("--            WHERE DECODE([loc_tp],'2',SCC_CD, '1',LCC_CD ,'0',RCC_CD) = [loc_cd]" ).append("\n"); 
		query.append("--          )" ).append("\n"); 
		query.append("--        GROUP BY LSE_RT.LOC_CD, LSE.AGMT_SEQ, LSE.AGMT_CTY_CD, LSE_RT.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("--        )" ).append("\n"); 
		query.append("--        GROUP BY SCC_CD , AGMT_CTY_CD, AGMT_SEQ , CNTR_TPSZ_CD" ).append("\n"); 
		query.append("--        )" ).append("\n"); 
		query.append("--), TEMP_DROP02 AS (" ).append("\n"); 
		query.append("--  SELECT LSE_RT.LOC_CD loc_cd," ).append("\n"); 
		query.append("--          LSE.AGMT_SEQ AGMT_SEQ," ).append("\n"); 
		query.append("--          LSE.AGMT_CTY_CD AGMT_CTY_CD," ).append("\n"); 
		query.append("--          LSE_RT.CNTR_TPSZ_CD CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                   " ).append("\n"); 
		query.append("--        FROM LSE_AGMT_RT LSE_RT ," ).append("\n"); 
		query.append("--          LSE_AGREEMENT LSE" ).append("\n"); 
		query.append("--          WHERE LSE_RT.CNTR_RNTL_CHG_TP_CD = 'DOCV'" ).append("\n"); 
		query.append("--          AND LSE_RT.AGMT_SEQ = LSE.AGMT_SEQ" ).append("\n"); 
		query.append("--          AND LSE_RT.AGMT_CTY_CD = LSE.AGMT_CTY_CD" ).append("\n"); 
		query.append("--          AND LSE.AGMT_LST_VER_SEQ = NVL(null, LSE.AGMT_LST_VER_SEQ)" ).append("\n"); 
		query.append("--          AND LSE_RT.LOC_CD IN (" ).append("\n"); 
		query.append("--             SELECT SCC_CD FROM MDM_EQ_ORZ_CHT" ).append("\n"); 
		query.append("--             WHERE DECODE([loc_tp],'2',SCC_CD, '1',LCC_CD ,'0',RCC_CD) = [loc_cd]" ).append("\n"); 
		query.append("--             )" ).append("\n"); 
		query.append("--          GROUP BY LSE_RT.LOC_CD, LSE.AGMT_SEQ, LSE.AGMT_CTY_CD, LSE_RT.CNTR_TPSZ_CD" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("SELECT A1.* " ).append("\n"); 
		query.append("      , DECODE(A1.FULL_FLG,'F',A2.SO_NO,'') SO_NO" ).append("\n"); 
		query.append("      , DECODE(A1.FULL_FLG,'F',A2.WO_NO,'') WO_NO" ).append("\n"); 
		query.append("      , DECODE(A1.FULL_FLG,'F',A2.VNDR_TP_CD, '') VNDR_TP" ).append("\n"); 
		query.append("      , DECODE(A1.FULL_FLG,'F',SUBSTR(A2.INV_VNDR_INFO, 1, INSTR(A2.INV_VNDR_INFO, '$', 1, 1) - 1),'') AS VNDR_CD" ).append("\n"); 
		query.append("      , DECODE(A1.FULL_FLG,'F',SUBSTR(A2.INV_VNDR_INFO, INSTR(A2.INV_VNDR_INFO, '$', 1, 1) + 1, INSTR(A2.INV_VNDR_INFO, '$', 1, 2) - INSTR(A2.INV_VNDR_INFO, '$', 1, 1) - 1),'') AS VNDR_NM " ).append("\n"); 
		query.append("FROM (" ).append("\n"); 
		query.append("  SELECT  T01.CNTR_NO ," ).append("\n"); 
		query.append("          T01.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("          T01.LSTM_CD , " ).append("\n"); 
		query.append("          T01.AGMT_CTY_CD||LPAD(T01.AGMT_SEQ, 6, '0') AS AGMT_NO," ).append("\n"); 
		query.append("          T01.REF_NO ," ).append("\n"); 
		query.append("          T01.VNDR_ABBR_NM ," ).append("\n"); 
		query.append("          T01.VNDR_SEQ ," ).append("\n"); 
		query.append("          T01.CRNT_YD_CD , " ).append("\n"); 
		query.append("          T01.CNMV_STS_CD AS CNMV_STS_CD," ).append("\n"); 
		query.append("          DECODE(T01.FULL_FLG,'Y','F','M') AS FULL_FLG," ).append("\n"); 
		query.append("          TO_CHAR(T01.CNMV_DT, 'YYYYMMDD') AS CNMV_DT , " ).append("\n"); 
		query.append("          T01.BKG_NO ," ).append("\n"); 
		query.append("          (SELECT me.lcc_cd FROM mdm_eq_orz_cht me, mdm_location ml " ).append("\n"); 
		query.append("                            WHERE ml.loc_cd = T01.POR_CD and ml.scc_cd = me.scc_cd) LCC_CD," ).append("\n"); 
		query.append("          T01.POR_CD," ).append("\n"); 
		query.append("          T01.POL_CD," ).append("\n"); 
		query.append("          T01.POD_CD ," ).append("\n"); 
		query.append("          T01.DEL_CD," ).append("\n"); 
		query.append("          T01.DE_TERM" ).append("\n"); 
		query.append("       ,  MST_LOC_FNC(T01.DEL_CD,'SCC') DEL_SCC" ).append("\n"); 
		query.append("       ,  T01.MT_RTN_YD" ).append("\n"); 
		query.append("       ,  MST_LOC_FNC(T01.MT_RTN_YD,'SCC') MT_RTN_SCC" ).append("\n"); 
		query.append("       ,  (SELECT DISTINCT 'Y' FROM LSE_AGMT_RT " ).append("\n"); 
		query.append("           WHERE AGMT_SEQ = T01.AGMT_SEQ AND AGMT_CTY_CD = T01.AGMT_CTY_CD" ).append("\n"); 
		query.append("             AND CNTR_RNTL_CHG_TP_CD = 'DOCV' AND CNTR_TPSZ_CD = T01.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("             AND LOC_CD = MST_LOC_FNC(T01.DEL_CD,'SCC')) DEL_DOL" ).append("\n"); 
		query.append("       ,  (SELECT DISTINCT 'Y' FROM LSE_AGMT_RT " ).append("\n"); 
		query.append("           WHERE AGMT_SEQ = T01.AGMT_SEQ AND AGMT_CTY_CD = T01.AGMT_CTY_CD" ).append("\n"); 
		query.append("             AND CNTR_RNTL_CHG_TP_CD = 'DOCV' AND CNTR_TPSZ_CD = T01.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("             AND LOC_CD = MST_LOC_FNC(T01.MT_RTN_YD,'SCC')) MT_RTN_DOL" ).append("\n"); 
		query.append("       ,  DECODE(T01.FULL_FLG,'Y','',(SELECT DISTINCT 'Y' FROM LSE_AGMT_RT " ).append("\n"); 
		query.append("           WHERE AGMT_SEQ = T01.AGMT_SEQ AND AGMT_CTY_CD = T01.AGMT_CTY_CD" ).append("\n"); 
		query.append("             AND CNTR_RNTL_CHG_TP_CD = 'DOCV' AND CNTR_TPSZ_CD = T01.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("             AND LOC_CD = MST_LOC_FNC(T01.CRNT_YD_CD,'SCC'))) CURR_YD_DOL" ).append("\n"); 
		query.append("       ,  TO_CHAR(T01.VPS_ETD_DT, 'YYYYMMDD HH:MM:SS')  AS POL_ETD" ).append("\n"); 
		query.append("       ,  TO_CHAR(T01.VPS_ETA_DT, 'YYYYMMDD HH:MM:SS')  AS POD_ETA" ).append("\n"); 
		query.append("       , T01.VSL_CD || T01.SKD_VOY_NO || T01.SKD_DIR_CD AS VVD_CD" ).append("\n"); 
		query.append("FROM    (" ).append("\n"); 
		query.append("        SELECT  T1.CNTR_NO, " ).append("\n"); 
		query.append("                T1.CNTR_TPSZ_CD," ).append("\n"); 
		query.append("                T1.LSTM_CD," ).append("\n"); 
		query.append("                T1.AGMT_CTY_CD, T1.AGMT_SEQ," ).append("\n"); 
		query.append("                T2.REF_NO," ).append("\n"); 
		query.append("                T10.VNDR_ABBR_NM," ).append("\n"); 
		query.append("                T10.VNDR_SEQ," ).append("\n"); 
		query.append("                T1.CRNT_YD_CD," ).append("\n"); 
		query.append("                T1.CNMV_STS_CD," ).append("\n"); 
		query.append("                T1.FULL_FLG," ).append("\n"); 
		query.append("                T1.CNMV_DT," ).append("\n"); 
		query.append("                NULL AS BKG_NO," ).append("\n"); 
		query.append("                NULL AS POR_CD," ).append("\n"); 
		query.append("                NULL AS POL_CD," ).append("\n"); 
		query.append("                NULL AS POD_CD," ).append("\n"); 
		query.append("                NULL AS DEL_CD," ).append("\n"); 
		query.append("                NULL AS DE_TERM," ).append("\n"); 
		query.append("                NULL AS MT_RTN_YD," ).append("\n"); 
		query.append("                T1.VSL_CD," ).append("\n"); 
		query.append("                T1.SKD_VOY_NO," ).append("\n"); 
		query.append("                T1.SKD_DIR_CD," ).append("\n"); 
		query.append("                NULL AS  VPS_ETD_DT," ).append("\n"); 
		query.append("                NULL AS  VPS_ETA_DT  " ).append("\n"); 
		query.append("        FROM    PARAM               P" ).append("\n"); 
		query.append("              , MST_CONTAINER       T1" ).append("\n"); 
		query.append("              , LSE_AGREEMENT       T2" ).append("\n"); 
		query.append("              , MDM_VENDOR          T10" ).append("\n"); 
		query.append(" --             , TEMP_DROP01         T11" ).append("\n"); 
		query.append("        WHERE   1=1" ).append("\n"); 
		query.append("        AND     T1.AGMT_CTY_CD  = T2.AGMT_CTY_CD" ).append("\n"); 
		query.append("        AND     T1.AGMT_SEQ     = T2.AGMT_SEQ" ).append("\n"); 
		query.append("        AND     T1.ACIAC_DIV_CD = 'A'" ).append("\n"); 
		query.append("        AND     T1.CNMV_STS_CD  IN ('EN', 'MT', 'TN')" ).append("\n"); 
		query.append("        AND     T1.LSTM_CD      IN ('OF', 'MI', 'LT', 'SI', 'ST')" ).append("\n"); 
		query.append("        AND     CASE WHEN T1.CNMV_STS_CD = 'MT' THEN" ).append("\n"); 
		query.append("                          1" ).append("\n"); 
		query.append("                     WHEN T1.CNMV_STS_CD IN ('EN', 'TN' ) THEN" ).append("\n"); 
		query.append("                          1" ).append("\n"); 
		query.append("                     END" ).append("\n"); 
		query.append("               =" ).append("\n"); 
		query.append("                CASE WHEN T1.CNMV_STS_CD = 'MT' THEN" ).append("\n"); 
		query.append("                          1" ).append("\n"); 
		query.append("                     WHEN T1.CNMV_STS_CD IN ('EN', 'TN' ) THEN" ).append("\n"); 
		query.append("                           CASE WHEN (T1.BKG_NO IS NULL OR T1.BKG_NO LIKE 'PSEUDO%')  " ).append("\n"); 
		query.append("                           THEN       1  " ).append("\n"); 
		query.append("                           ELSE       0                                                              " ).append("\n"); 
		query.append("                           END" ).append("\n"); 
		query.append("                     END" ).append("\n"); 
		query.append("        AND     DECODE(T1.LSTM_CD, 'ST', T1.ONH_DT + NVL(T1.MIN_ONH_DYS,0),  T1.ONH_DT ) < SYSDATE" ).append("\n"); 
		query.append("       -- AND     DECODE(T1.LSTM_CD, 'LT', T2.LST_EXP_DT                    , SYSDATE - 1) < SYSDATE" ).append("\n"); 
		query.append("        AND     DECODE(T1.LSTM_CD, 'LT', DECODE(NVL(T1.MIN_ONH_DYS,0), 0, T2.LST_EXP_DT, T1.ONH_DT + NVL(T1.MIN_ONH_DYS,0)),SYSDATE -1) < SYSDATE" ).append("\n"); 
		query.append("        AND     CASE WHEN P_LOC_TP = '0' THEN T1.RCC_CD" ).append("\n"); 
		query.append("                     WHEN P_LOC_TP = '1' THEN T1.LCC_CD" ).append("\n"); 
		query.append("                     WHEN P_LOC_TP = '2' THEN T1.SCC_CD END =  P_LOC_CD" ).append("\n"); 
		query.append("        AND      T2.VNDR_SEQ      = T10.VNDR_SEQ" ).append("\n"); 
		query.append(" --       AND      T1.SCC_CD        = T11.T_SCC_CD" ).append("\n"); 
		query.append(" --       AND      T1.AGMT_CTY_CD   = T11.T_AGMT_CTY_CD" ).append("\n"); 
		query.append(" --       AND      T1.AGMT_SEQ      = T11.T_AGMT_SEQ" ).append("\n"); 
		query.append(" --       AND      T1.CNTR_TPSZ_CD  = T11.T_CNTR_TPSZ_CD" ).append("\n"); 
		query.append("#if (${lstm_cd} != '')" ).append("\n"); 
		query.append("        AND     T1.LSTM_CD IN ( " ).append("\n"); 
		query.append("    #foreach($key IN ${lstm_cd_seq})" ).append("\n"); 
		query.append("      #if($velocityCount < $lstm_cd_seq.size())" ).append("\n"); 
		query.append("       '$key'," ).append("\n"); 
		query.append("      #else" ).append("\n"); 
		query.append("       '$key'" ).append("\n"); 
		query.append("      #end" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("             )" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${cnmv_sts_cd} != '')" ).append("\n"); 
		query.append("        AND     T1.CNMV_STS_CD IN (" ).append("\n"); 
		query.append("    #foreach($key IN ${cnmv_sts_cd_seq})" ).append("\n"); 
		query.append("      #if($velocityCount < $cnmv_sts_cd_seq.size())" ).append("\n"); 
		query.append("       '$key'," ).append("\n"); 
		query.append("      #else" ).append("\n"); 
		query.append("       '$key'" ).append("\n"); 
		query.append("      #end" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("             )" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${agmt_seq} != '')" ).append("\n"); 
		query.append("        AND     T1.AGMT_CTY_CD = P_AGMT_CTY_CD" ).append("\n"); 
		query.append("        AND     T1.AGMT_SEQ    = P_AGMT_SEQ" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${vndr_seq} != '')" ).append("\n"); 
		query.append("        AND     T10.VNDR_SEQ    = P_VNDR_SEQ" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("       UNION ALL" ).append("\n"); 
		query.append("       SELECT      CNTR_NO, " ).append("\n"); 
		query.append("                CNTR_TPSZ_CD," ).append("\n"); 
		query.append("                LSTM_CD," ).append("\n"); 
		query.append("                AGMT_CTY_CD," ).append("\n"); 
		query.append("                AGMT_SEQ," ).append("\n"); 
		query.append("                REF_NO," ).append("\n"); 
		query.append("                VNDR_ABBR_NM," ).append("\n"); 
		query.append("                VNDR_SEQ," ).append("\n"); 
		query.append("                CRNT_YD_CD," ).append("\n"); 
		query.append("                CNMV_STS_CD," ).append("\n"); 
		query.append("                FULL_FLG," ).append("\n"); 
		query.append("                CNMV_DT," ).append("\n"); 
		query.append("                BKG_NO," ).append("\n"); 
		query.append("                POR_CD," ).append("\n"); 
		query.append("                POL_CD," ).append("\n"); 
		query.append("                POD_CD," ).append("\n"); 
		query.append("                DEL_CD," ).append("\n"); 
		query.append("                DE_TERM," ).append("\n"); 
		query.append("                MT_RTN_YD," ).append("\n"); 
		query.append("                VSL_CD, SKD_VOY_NO, SKD_DIR_CD, " ).append("\n"); 
		query.append("                VPS_ETD_DT," ).append("\n"); 
		query.append("                VPS_ETA_DT   " ).append("\n"); 
		query.append("   FROM (" ).append("\n"); 
		query.append("        SELECT  T1.CNTR_NO, " ).append("\n"); 
		query.append("                T1.CNTR_TPSZ_CD," ).append("\n"); 
		query.append("                T1.LSTM_CD," ).append("\n"); 
		query.append("                T1.AGMT_CTY_CD," ).append("\n"); 
		query.append("                T1.AGMT_SEQ," ).append("\n"); 
		query.append("                T3.REF_NO," ).append("\n"); 
		query.append("                T10.VNDR_ABBR_NM," ).append("\n"); 
		query.append("                T10.VNDR_SEQ," ).append("\n"); 
		query.append("                T1.CRNT_YD_CD," ).append("\n"); 
		query.append("                T1.CNMV_STS_CD," ).append("\n"); 
		query.append("                T1.FULL_FLG," ).append("\n"); 
		query.append("                T1.CNMV_DT," ).append("\n"); 
		query.append("                T2.BKG_NO," ).append("\n"); 
		query.append("                T2.POR_CD," ).append("\n"); 
		query.append("                T2.POL_CD," ).append("\n"); 
		query.append("                T2.POD_CD," ).append("\n"); 
		query.append("                T2.DEL_CD," ).append("\n"); 
		query.append("                T2.DE_TERM_CD DE_TERM," ).append("\n"); 
		query.append("           --     T2.MTY_RTN_YD_CD MT_RTN_YD," ).append("\n"); 
		query.append("               (SELECT NOD_CD FROM SCE_COP_HDR CH, SCE_COP_DTL CD" ).append("\n"); 
		query.append("                 WHERE COP_STS_CD <> 'X'" ).append("\n"); 
		query.append("                   AND CH.BKG_NO = T2.BKG_NO" ).append("\n"); 
		query.append("                   AND T1.CNTR_NO = CH.CNTR_NO" ).append("\n"); 
		query.append("                   AND CH.COP_NO = CD.COP_NO" ).append("\n"); 
		query.append("                   AND CD.ACT_CD = 'MITYAD') MT_RTN_YD," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                T1.VSL_CD, T1.SKD_VOY_NO, T1.SKD_DIR_CD  " ).append("\n"); 
		query.append("                , (" ).append("\n"); 
		query.append("         		SELECT  /*+ INDEX (S01 XPKBKG_VVD) */" ).append("\n"); 
		query.append("                		 S02.VPS_ETD_DT" ).append("\n"); 
		query.append("         		FROM    BKG_VVD  S01        " ).append("\n"); 
		query.append("               			, VSK_VSL_PORT_SKD S02" ).append("\n"); 
		query.append("        		 WHERE   1= 1" ).append("\n"); 
		query.append("        		 AND     S01.BKG_NO           = T2.BKG_NO" ).append("\n"); 
		query.append("        		 AND     S01.VSL_CD           = S02.VSL_CD      (+)" ).append("\n"); 
		query.append("        		 AND     S01.SKD_VOY_NO       = S02.SKD_VOY_NO  (+)" ).append("\n"); 
		query.append("         		 AND     S01.SKD_DIR_CD       = S02.SKD_DIR_CD  (+)" ).append("\n"); 
		query.append("         		 AND     S01.POL_CD           = S02.VPS_PORT_CD (+)" ).append("\n"); 
		query.append("        		 AND     S01.POL_CLPT_IND_SEQ = S02.CLPT_IND_SEQ(+)" ).append("\n"); 
		query.append("        		 AND     ROWNUM               = 1" ).append("\n"); 
		query.append("        		 ) AS VPS_ETD_DT" ).append("\n"); 
		query.append("     			 , (" ).append("\n"); 
		query.append("        		 SELECT  /*+ INDEX_DESC (S01 XPKBKG_VVD) */" ).append("\n"); 
		query.append("                		 S02.VPS_ETA_DT" ).append("\n"); 
		query.append("         		 FROM    BKG_VVD          S01" ).append("\n"); 
		query.append("              			 , VSK_VSL_PORT_SKD S02" ).append("\n"); 
		query.append("        		 WHERE   1= 1" ).append("\n"); 
		query.append("        		 AND     S01.BKG_NO           = T2.BKG_NO" ).append("\n"); 
		query.append("        		 AND     S01.VSL_CD           = S02.VSL_CD      (+)" ).append("\n"); 
		query.append("        		 AND     S01.SKD_VOY_NO       = S02.SKD_VOY_NO  (+)" ).append("\n"); 
		query.append("        		 AND     S01.SKD_DIR_CD       = S02.SKD_DIR_CD  (+)" ).append("\n"); 
		query.append("        		 AND     S01.POD_CD           = S02.VPS_PORT_CD (+)" ).append("\n"); 
		query.append("        		 AND     S01.POD_CLPT_IND_SEQ = S02.CLPT_IND_SEQ(+)" ).append("\n"); 
		query.append("        		 AND     ROWNUM               = 1" ).append("\n"); 
		query.append("        		 ) AS VPS_ETA_DT        " ).append("\n"); 
		query.append("        FROM    PARAM               P" ).append("\n"); 
		query.append("              , MST_CONTAINER       T1" ).append("\n"); 
		query.append("              , BKG_BOOKING         T2" ).append("\n"); 
		query.append("              , LSE_AGREEMENT       T3" ).append("\n"); 
		query.append("              , MDM_LOCATION        T8" ).append("\n"); 
		query.append("              , MDM_EQ_ORZ_CHT      T9" ).append("\n"); 
		query.append("              , MDM_VENDOR          T10" ).append("\n"); 
		query.append(" --             , TEMP_DROP01         T11" ).append("\n"); 
		query.append("        WHERE   1 = 1" ).append("\n"); 
		query.append("        AND     T1.BKG_NO        = T2.BKG_NO" ).append("\n"); 
		query.append("        AND     T1.AGMT_CTY_CD   = T3.AGMT_CTY_CD" ).append("\n"); 
		query.append("        AND     T1.AGMT_SEQ      = T3.AGMT_SEQ" ).append("\n"); 
		query.append("        AND     DECODE(T1.LSTM_CD, 'ST', T1.ONH_DT + NVL(T1.MIN_ONH_DYS,0),  T1.ONH_DT ) < SYSDATE" ).append("\n"); 
		query.append("       -- AND     DECODE(T1.LSTM_CD, 'LT', T3.LST_EXP_DT                    , SYSDATE - 1) < SYSDATE" ).append("\n"); 
		query.append("        AND     DECODE(T1.LSTM_CD, 'LT', DECODE(NVL(T1.MIN_ONH_DYS,0), 0, T3.LST_EXP_DT, T1.ONH_DT + NVL(T1.MIN_ONH_DYS,0)),SYSDATE -1) < SYSDATE" ).append("\n"); 
		query.append("        AND     T8.LOC_CD        = SUBSTR(T2.MTY_RTN_YD_CD, 1, 5)                          " ).append("\n"); 
		query.append("        AND     T8.SCC_CD        = T9.SCC_CD" ).append("\n"); 
		query.append("        AND     T1.ACIAC_DIV_CD  = 'A'" ).append("\n"); 
		query.append("        AND     T1.CNMV_STS_CD IN ('IC', 'ID', 'EN', 'TN')" ).append("\n"); 
		query.append("        AND     T1.LSTM_CD     IN ('OF', 'MI', 'LT', 'SI', 'ST')" ).append("\n"); 
		query.append("        AND     CASE WHEN P_LOC_TP = '0' THEN T9.RCC_CD" ).append("\n"); 
		query.append("                     WHEN P_LOC_TP = '1' THEN T9.LCC_CD" ).append("\n"); 
		query.append("                     WHEN P_LOC_TP = '2' THEN T9.SCC_CD END    = P_LOC_CD" ).append("\n"); 
		query.append("        AND     CASE WHEN T1.CNMV_STS_CD IN ('IC', 'ID')                           THEN 'Y'" ).append("\n"); 
		query.append("                     WHEN T1.CNMV_STS_CD IN ('EN', 'TN') AND T1.FULL_FLG = 'N'     THEN 'Y'" ).append("\n"); 
		query.append("                     WHEN T1.CNMV_STS_CD IN ('EN', 'TN') AND T1.FULL_FLG = 'Y'     THEN " ).append("\n"); 
		query.append("                          (" ).append("\n"); 
		query.append("                          SELECT  DECODE(S.OB_CNTR_FLG, 'N', 'Y', 'N') " ).append("\n"); 
		query.append("                          FROM    CTM_MOVEMENT    S" ).append("\n"); 
		query.append("                          WHERE   T1.CNTR_NO      = S.CNTR_NO" ).append("\n"); 
		query.append("                          AND     T1.CNMV_STS_CD  = S.MVMT_STS_CD" ).append("\n"); 
		query.append("                          AND     T1.CNMV_YR      = S.CNMV_YR" ).append("\n"); 
		query.append("                          AND     T1.CNMV_ID_NO   = S.CNMV_ID_NO" ).append("\n"); 
		query.append("                          )" ).append("\n"); 
		query.append("                     END  = 'Y'" ).append("\n"); 
		query.append("        AND      T3.VNDR_SEQ      = T10.VNDR_SEQ" ).append("\n"); 
		query.append(" --       AND      T9.SCC_CD        = T11.T_SCC_CD" ).append("\n"); 
		query.append(" --       AND      T1.AGMT_CTY_CD   = T11.T_AGMT_CTY_CD" ).append("\n"); 
		query.append(" --       AND      T1.AGMT_SEQ      = T11.T_AGMT_SEQ" ).append("\n"); 
		query.append(" --       AND      T1.CNTR_TPSZ_CD  = T11.T_CNTR_TPSZ_CD" ).append("\n"); 
		query.append("        AND      T2.DEL_CD     IN (      " ).append("\n"); 
		query.append("            SELECT LOC_CD" ).append("\n"); 
		query.append("            FROM  MDM_LOCATION" ).append("\n"); 
		query.append("            WHERE SCC_CD IN (SELECT SCC_CD FROM MDM_EQ_ORZ_CHT" ).append("\n"); 
		query.append("                             WHERE DECODE(@[loc_tp],'2',SCC_CD, '1',LCC_CD ,'0',RCC_CD) = @[loc_cd]" ).append("\n"); 
		query.append("           )" ).append("\n"); 
		query.append("      )" ).append("\n"); 
		query.append("#if (${lstm_cd} != '')" ).append("\n"); 
		query.append("        AND     T1.LSTM_CD IN (" ).append("\n"); 
		query.append("   #foreach($key IN ${lstm_cd_seq})" ).append("\n"); 
		query.append("     #if($velocityCount < $lstm_cd_seq.size())" ).append("\n"); 
		query.append("       '$key'," ).append("\n"); 
		query.append("     #else" ).append("\n"); 
		query.append("       '$key'" ).append("\n"); 
		query.append("     #end" ).append("\n"); 
		query.append("   #end" ).append("\n"); 
		query.append("                      )" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${cnmv_sts_cd} != '')" ).append("\n"); 
		query.append("        AND     T1.CNMV_STS_CD IN (" ).append("\n"); 
		query.append("    #foreach($key IN ${cnmv_sts_cd_seq})" ).append("\n"); 
		query.append("      #if($velocityCount < $cnmv_sts_cd_seq.size())" ).append("\n"); 
		query.append("        '$key'," ).append("\n"); 
		query.append("      #else" ).append("\n"); 
		query.append("        '$key'" ).append("\n"); 
		query.append("      #end" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${agmt_seq} != '')" ).append("\n"); 
		query.append("        AND     T1.AGMT_CTY_CD = P_AGMT_CTY_CD" ).append("\n"); 
		query.append("        AND     T1.AGMT_SEQ    = P_AGMT_SEQ" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${vndr_seq} != '')" ).append("\n"); 
		query.append("        AND     T10.VNDR_SEQ    = P_VNDR_SEQ" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("   )" ).append("\n"); 
		query.append("  WHERE 1=1 " ).append("\n"); 
		query.append("-- 20160119 add" ).append("\n"); 
		query.append("  AND cnmv_DT BETWEEN TO_DATE(REPLACE(@[str_estm_dt],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[end_estm_dt],'-',''),'YYYYMMDD') --SYSDATE" ).append("\n"); 
		query.append("-- 20160105 Add start" ).append("\n"); 
		query.append("       UNION ALL" ).append("\n"); 
		query.append("       SELECT   CNTR_NO, " ).append("\n"); 
		query.append("                CNTR_TPSZ_CD," ).append("\n"); 
		query.append("                LSTM_CD," ).append("\n"); 
		query.append("                AGMT_CTY_CD," ).append("\n"); 
		query.append("                AGMT_SEQ," ).append("\n"); 
		query.append("                REF_NO," ).append("\n"); 
		query.append("                VNDR_ABBR_NM," ).append("\n"); 
		query.append("                VNDR_SEQ," ).append("\n"); 
		query.append("                CRNT_YD_CD," ).append("\n"); 
		query.append("                CNMV_STS_CD," ).append("\n"); 
		query.append("                FULL_FLG," ).append("\n"); 
		query.append("                CNMV_DT," ).append("\n"); 
		query.append("                BKG_NO," ).append("\n"); 
		query.append("                POR_CD," ).append("\n"); 
		query.append("                POL_CD," ).append("\n"); 
		query.append("                POD_CD," ).append("\n"); 
		query.append("                DEL_CD," ).append("\n"); 
		query.append("                DE_TERM," ).append("\n"); 
		query.append("                MT_RTN_YD," ).append("\n"); 
		query.append("                VSL_CD, SKD_VOY_NO, SKD_DIR_CD, " ).append("\n"); 
		query.append("                VPS_ETD_DT," ).append("\n"); 
		query.append("                VPS_ETA_DT   " ).append("\n"); 
		query.append("   FROM (" ).append("\n"); 
		query.append("        SELECT  T1.CNTR_NO, " ).append("\n"); 
		query.append("                T1.CNTR_TPSZ_CD," ).append("\n"); 
		query.append("                T1.LSTM_CD," ).append("\n"); 
		query.append("                T1.AGMT_CTY_CD," ).append("\n"); 
		query.append("                T1.AGMT_SEQ," ).append("\n"); 
		query.append("                T3.REF_NO," ).append("\n"); 
		query.append("                T10.VNDR_ABBR_NM," ).append("\n"); 
		query.append("                T10.VNDR_SEQ," ).append("\n"); 
		query.append("                T1.CRNT_YD_CD," ).append("\n"); 
		query.append("                T1.CNMV_STS_CD," ).append("\n"); 
		query.append("                T1.FULL_FLG," ).append("\n"); 
		query.append("                T1.CNMV_DT," ).append("\n"); 
		query.append("                T2.BKG_NO," ).append("\n"); 
		query.append("                T2.POR_CD," ).append("\n"); 
		query.append("                T2.POL_CD," ).append("\n"); 
		query.append("                T2.POD_CD," ).append("\n"); 
		query.append("                T2.DEL_CD," ).append("\n"); 
		query.append("                T2.DE_TERM_CD DE_TERM," ).append("\n"); 
		query.append("            --    T2.MTY_RTN_YD_CD MT_RTN_YD," ).append("\n"); 
		query.append("               (SELECT NOD_CD FROM SCE_COP_HDR CH, SCE_COP_DTL CD" ).append("\n"); 
		query.append("                 WHERE COP_STS_CD <> 'X'" ).append("\n"); 
		query.append("                   AND CH.BKG_NO = T2.BKG_NO" ).append("\n"); 
		query.append("                   AND T1.CNTR_NO = CH.CNTR_NO" ).append("\n"); 
		query.append("                   AND CH.COP_NO = CD.COP_NO" ).append("\n"); 
		query.append("                   AND CD.ACT_CD = 'MITYAD') MT_RTN_YD," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                T1.VSL_CD, T1.SKD_VOY_NO, T1.SKD_DIR_CD  " ).append("\n"); 
		query.append("                , (" ).append("\n"); 
		query.append("         		SELECT  /*+ INDEX (S01 XPKBKG_VVD) */" ).append("\n"); 
		query.append("                		 S02.VPS_ETD_DT" ).append("\n"); 
		query.append("         		FROM    BKG_VVD  S01        " ).append("\n"); 
		query.append("               			, VSK_VSL_PORT_SKD S02" ).append("\n"); 
		query.append("        		 WHERE   1= 1" ).append("\n"); 
		query.append("        		 AND     S01.BKG_NO           = T2.BKG_NO" ).append("\n"); 
		query.append("        		 AND     S01.VSL_CD           = S02.VSL_CD      (+)" ).append("\n"); 
		query.append("        		 AND     S01.SKD_VOY_NO       = S02.SKD_VOY_NO  (+)" ).append("\n"); 
		query.append("         		 AND     S01.SKD_DIR_CD       = S02.SKD_DIR_CD  (+)" ).append("\n"); 
		query.append("         		 AND     S01.POL_CD           = S02.VPS_PORT_CD (+)" ).append("\n"); 
		query.append("        		 AND     S01.POL_CLPT_IND_SEQ = S02.CLPT_IND_SEQ(+)" ).append("\n"); 
		query.append("        		 AND     ROWNUM               = 1" ).append("\n"); 
		query.append("        		 ) AS VPS_ETD_DT" ).append("\n"); 
		query.append("     			 , (" ).append("\n"); 
		query.append("        		 SELECT  /*+ INDEX_DESC (S01 XPKBKG_VVD) */" ).append("\n"); 
		query.append("                		 S02.VPS_ETA_DT" ).append("\n"); 
		query.append("         		 FROM    BKG_VVD          S01" ).append("\n"); 
		query.append("              			 , VSK_VSL_PORT_SKD S02" ).append("\n"); 
		query.append("        		 WHERE   1= 1" ).append("\n"); 
		query.append("        		 AND     S01.BKG_NO           = T2.BKG_NO" ).append("\n"); 
		query.append("        		 AND     S01.VSL_CD           = S02.VSL_CD      (+)" ).append("\n"); 
		query.append("        		 AND     S01.SKD_VOY_NO       = S02.SKD_VOY_NO  (+)" ).append("\n"); 
		query.append("        		 AND     S01.SKD_DIR_CD       = S02.SKD_DIR_CD  (+)" ).append("\n"); 
		query.append("        		 AND     S01.POD_CD           = S02.VPS_PORT_CD (+)" ).append("\n"); 
		query.append("        		 AND     S01.POD_CLPT_IND_SEQ = S02.CLPT_IND_SEQ(+)" ).append("\n"); 
		query.append("        		 AND     ROWNUM               = 1" ).append("\n"); 
		query.append("        		 ) AS VPS_ETA_DT        " ).append("\n"); 
		query.append("        FROM    PARAM               P" ).append("\n"); 
		query.append("              , MST_CONTAINER       T1" ).append("\n"); 
		query.append("              , BKG_BOOKING         T2" ).append("\n"); 
		query.append("              , LSE_AGREEMENT       T3" ).append("\n"); 
		query.append("              , MDM_LOCATION        T8" ).append("\n"); 
		query.append("              , MDM_EQ_ORZ_CHT      T9" ).append("\n"); 
		query.append("              , MDM_VENDOR          T10" ).append("\n"); 
		query.append("     --         , TEMP_DROP01         T11" ).append("\n"); 
		query.append("        WHERE   1 = 1" ).append("\n"); 
		query.append("        AND     T1.BKG_NO        = T2.BKG_NO" ).append("\n"); 
		query.append("        AND     T1.AGMT_CTY_CD   = T3.AGMT_CTY_CD" ).append("\n"); 
		query.append("        AND     T1.AGMT_SEQ      = T3.AGMT_SEQ" ).append("\n"); 
		query.append("        AND     DECODE(T1.LSTM_CD, 'ST', T1.ONH_DT + NVL(T1.MIN_ONH_DYS,0),  T1.ONH_DT ) < SYSDATE" ).append("\n"); 
		query.append("       -- AND     DECODE(T1.LSTM_CD, 'LT', T3.LST_EXP_DT                    , SYSDATE - 1) < SYSDATE" ).append("\n"); 
		query.append("        AND     DECODE(T1.LSTM_CD, 'LT', DECODE(NVL(T1.MIN_ONH_DYS,0), 0, T3.LST_EXP_DT, T1.ONH_DT + NVL(T1.MIN_ONH_DYS,0)),SYSDATE -1) < SYSDATE" ).append("\n"); 
		query.append("        AND     T8.LOC_CD        = SUBSTR(T2.MTY_RTN_YD_CD, 1, 5)                          " ).append("\n"); 
		query.append("        AND     T8.SCC_CD        = T9.SCC_CD" ).append("\n"); 
		query.append("        AND     T1.ACIAC_DIV_CD  = 'A'" ).append("\n"); 
		query.append("        AND     T1.CNMV_STS_CD IN ('IC', 'ID', 'EN', 'TN')" ).append("\n"); 
		query.append("        AND     T1.LSTM_CD     IN ('OF', 'MI', 'LT', 'SI', 'ST')" ).append("\n"); 
		query.append("        AND     CASE WHEN P_LOC_TP = '0' THEN T9.RCC_CD" ).append("\n"); 
		query.append("                     WHEN P_LOC_TP = '1' THEN T9.LCC_CD" ).append("\n"); 
		query.append("                     WHEN P_LOC_TP = '2' THEN T9.SCC_CD END    = P_LOC_CD" ).append("\n"); 
		query.append("        AND     CASE WHEN T1.CNMV_STS_CD IN ('IC', 'ID')                           THEN 'Y'" ).append("\n"); 
		query.append("                     WHEN T1.CNMV_STS_CD IN ('EN', 'TN') AND T1.FULL_FLG = 'N'     THEN 'Y'" ).append("\n"); 
		query.append("                     WHEN T1.CNMV_STS_CD IN ('EN', 'TN') AND T1.FULL_FLG = 'Y'     THEN " ).append("\n"); 
		query.append("                          (" ).append("\n"); 
		query.append("                          SELECT  DECODE(S.OB_CNTR_FLG, 'N', 'Y', 'N') " ).append("\n"); 
		query.append("                          FROM    CTM_MOVEMENT    S" ).append("\n"); 
		query.append("                          WHERE   T1.CNTR_NO      = S.CNTR_NO" ).append("\n"); 
		query.append("                          AND     T1.CNMV_STS_CD  = S.MVMT_STS_CD" ).append("\n"); 
		query.append("                          AND     T1.CNMV_YR      = S.CNMV_YR" ).append("\n"); 
		query.append("                          AND     T1.CNMV_ID_NO   = S.CNMV_ID_NO" ).append("\n"); 
		query.append("                          )" ).append("\n"); 
		query.append("                     END  = 'Y'" ).append("\n"); 
		query.append("        AND      T3.VNDR_SEQ      = T10.VNDR_SEQ" ).append("\n"); 
		query.append("   --     AND      T9.SCC_CD        = T11.T_SCC_CD" ).append("\n"); 
		query.append("   --     AND      T1.AGMT_CTY_CD   = T11.T_AGMT_CTY_CD" ).append("\n"); 
		query.append("   --     AND      T1.AGMT_SEQ      = T11.T_AGMT_SEQ" ).append("\n"); 
		query.append("   --     AND      T1.CNTR_TPSZ_CD  = T11.T_CNTR_TPSZ_CD" ).append("\n"); 
		query.append("        AND      (SELECT Substr(NOD_CD,1,5)" ).append("\n"); 
		query.append("                   FROM SCE_COP_HDR H, SCE_COP_DTL DT" ).append("\n"); 
		query.append("                  WHERE COP_STS_CD <> 'X' " ).append("\n"); 
		query.append("                   AND H.BKG_NO = T2.BKG_NO" ).append("\n"); 
		query.append("                   AND T1.CNTR_NO = H.CNTR_NO " ).append("\n"); 
		query.append("                   AND H.COP_NO = DT.COP_NO" ).append("\n"); 
		query.append("                   AND DT.ACT_CD = 'MITYAD' --'FITZAD'" ).append("\n"); 
		query.append("                   AND EXISTS (SELECT 1 FROM SCE_COP_HDR H1, SCE_COP_DTL DT1" ).append("\n"); 
		query.append("                                   WHERE COP_STS_CD <> 'X' " ).append("\n"); 
		query.append("                                     AND H1.COP_NO = H.COP_NO" ).append("\n"); 
		query.append("                                     AND H1.COP_NO = DT1.COP_NO" ).append("\n"); 
		query.append("                                     AND dt1.act_cd = 'FITZAD')" ).append("\n"); 
		query.append("               ) IN (SELECT LOC_CD" ).append("\n"); 
		query.append("                       FROM  MDM_LOCATION" ).append("\n"); 
		query.append("                       WHERE SCC_CD IN (SELECT SCC_CD FROM MDM_EQ_ORZ_CHT" ).append("\n"); 
		query.append("                                   WHERE DECODE(@[loc_tp],'2',SCC_CD, '1',LCC_CD ,'0',RCC_CD) = @[loc_cd]" ).append("\n"); 
		query.append("               )" ).append("\n"); 
		query.append("	)" ).append("\n"); 
		query.append("#if (${lstm_cd} != '')" ).append("\n"); 
		query.append("        AND     T1.LSTM_CD IN (" ).append("\n"); 
		query.append("   #foreach($key IN ${lstm_cd_seq})" ).append("\n"); 
		query.append("     #if($velocityCount < $lstm_cd_seq.size())" ).append("\n"); 
		query.append("       '$key'," ).append("\n"); 
		query.append("     #else" ).append("\n"); 
		query.append("       '$key'" ).append("\n"); 
		query.append("     #end" ).append("\n"); 
		query.append("   #end" ).append("\n"); 
		query.append("                      )" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${cnmv_sts_cd} != '')" ).append("\n"); 
		query.append("        AND     T1.CNMV_STS_CD IN (" ).append("\n"); 
		query.append("    #foreach($key IN ${cnmv_sts_cd_seq})" ).append("\n"); 
		query.append("      #if($velocityCount < $cnmv_sts_cd_seq.size())" ).append("\n"); 
		query.append("        '$key'," ).append("\n"); 
		query.append("      #else" ).append("\n"); 
		query.append("        '$key'" ).append("\n"); 
		query.append("      #end" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${agmt_seq} != '')" ).append("\n"); 
		query.append("        AND     T1.AGMT_CTY_CD = P_AGMT_CTY_CD" ).append("\n"); 
		query.append("        AND     T1.AGMT_SEQ    = P_AGMT_SEQ" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${vndr_seq} != '')" ).append("\n"); 
		query.append("        AND     T10.VNDR_SEQ    = P_VNDR_SEQ" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("   )" ).append("\n"); 
		query.append("  WHERE 1=1 " ).append("\n"); 
		query.append("-- 20160119 add" ).append("\n"); 
		query.append("  AND cnmv_DT BETWEEN TO_DATE(REPLACE(@[str_estm_dt],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[end_estm_dt],'-',''),'YYYYMMDD') --SYSDATE" ).append("\n"); 
		query.append("-- 20160105 Add end " ).append("\n"); 
		query.append("     UNION ALL" ).append("\n"); 
		query.append("      SELECT   T1.CNTR_NO, " ).append("\n"); 
		query.append("                T1.CNTR_TPSZ_CD," ).append("\n"); 
		query.append("                T1.LSTM_CD," ).append("\n"); 
		query.append("                T1.AGMT_CTY_CD," ).append("\n"); 
		query.append("                T1.AGMT_SEQ," ).append("\n"); 
		query.append("                T6.REF_NO," ).append("\n"); 
		query.append("                T10.VNDR_ABBR_NM," ).append("\n"); 
		query.append("                T10.VNDR_SEQ," ).append("\n"); 
		query.append("                T1.CRNT_YD_CD," ).append("\n"); 
		query.append("                T1.CNMV_STS_CD," ).append("\n"); 
		query.append("                T1.FULL_FLG," ).append("\n"); 
		query.append("                T1.CNMV_DT," ).append("\n"); 
		query.append("                T2.BKG_NO," ).append("\n"); 
		query.append("                T2.POR_CD," ).append("\n"); 
		query.append("                T2.POL_CD," ).append("\n"); 
		query.append("                T2.POD_CD," ).append("\n"); 
		query.append("                T2.DEL_CD," ).append("\n"); 
		query.append("                T2.DE_TERM_CD DE_TERM," ).append("\n"); 
		query.append("                T2.MTY_RTN_YD_CD MT_RTN_YD," ).append("\n"); 
		query.append("                T2.VSL_CD, T2.SKD_VOY_NO, T2.SKD_DIR_CD," ).append("\n"); 
		query.append("                T5.VPS_ETD_DT," ).append("\n"); 
		query.append("                T5.VPS_ETA_DT " ).append("\n"); 
		query.append("        FROM    PARAM               P" ).append("\n"); 
		query.append("              , MST_CONTAINER       T1" ).append("\n"); 
		query.append("              , BKG_BOOKING         T2" ).append("\n"); 
		query.append("              , BKG_VVD             T3" ).append("\n"); 
		query.append("              , VSK_VSL_SKD         T4" ).append("\n"); 
		query.append("              , VSK_VSL_PORT_SKD    T5" ).append("\n"); 
		query.append("              , LSE_AGREEMENT       T6" ).append("\n"); 
		query.append("              , MDM_LOCATION        T8" ).append("\n"); 
		query.append("              , MDM_EQ_ORZ_CHT      T9" ).append("\n"); 
		query.append("              , MDM_VENDOR          T10" ).append("\n"); 
		query.append("--              , TEMP_DROP02         T11" ).append("\n"); 
		query.append("        WHERE   1 = 1" ).append("\n"); 
		query.append("        AND     T1.BKG_NO           = T2.BKG_NO" ).append("\n"); 
		query.append("        AND     T1.ACIAC_DIV_CD     = 'A'" ).append("\n"); 
		query.append("        AND     T1.CNMV_STS_CD IN ('OC', 'VL')" ).append("\n"); 
		query.append("        AND     T1.LSTM_CD     IN ('OF', 'MI', 'LT', 'SI', 'ST')" ).append("\n"); 
		query.append("        AND     T1.AGMT_CTY_CD      = T6.AGMT_CTY_CD" ).append("\n"); 
		query.append("        AND     T1.AGMT_SEQ         = T6.AGMT_SEQ" ).append("\n"); 
		query.append("        AND     DECODE(T1.LSTM_CD, 'ST', T1.ONH_DT + NVL(T1.MIN_ONH_DYS,0),  T1.ONH_DT ) < SYSDATE" ).append("\n"); 
		query.append("       -- AND     DECODE(T1.LSTM_CD, 'LT', T6.LST_EXP_DT                    , SYSDATE - 1) < SYSDATE" ).append("\n"); 
		query.append("        AND     DECODE(T1.LSTM_CD, 'LT', DECODE(NVL(T1.MIN_ONH_DYS,0), 0, T6.LST_EXP_DT, T1.ONH_DT + NVL(T1.MIN_ONH_DYS,0)),SYSDATE -1) < SYSDATE" ).append("\n"); 
		query.append("        AND     T2.BKG_NO           = T3.BKG_NO" ).append("\n"); 
		query.append("        AND     T1.CRNT_YD_CD       = T3.POL_YD_CD" ).append("\n"); 
		query.append("        AND     T3.VSL_CD           = T4.VSL_CD" ).append("\n"); 
		query.append("        AND     T3.SKD_VOY_NO       = T4.SKD_VOY_NO" ).append("\n"); 
		query.append("        AND     T3.SKD_DIR_CD       = T4.SKD_DIR_CD" ).append("\n"); 
		query.append("        AND     T4.VSL_CD           = T5.VSL_CD" ).append("\n"); 
		query.append("        AND     T4.SKD_VOY_NO       = T5.SKD_VOY_NO" ).append("\n"); 
		query.append("        AND     T4.SKD_DIR_CD       = T5.SKD_DIR_CD" ).append("\n"); 
		query.append("        AND     T3.POD_CD           = T5.VPS_PORT_CD" ).append("\n"); 
		query.append("        AND     T3.POD_CLPT_IND_SEQ = T5.CLPT_IND_SEQ" ).append("\n"); 
		query.append("        AND     'S'                <> NVL(T5.SKD_CNG_STS_CD, 'N')" ).append("\n"); 
		query.append("        AND     T2.DEL_CD           = T8.LOC_CD" ).append("\n"); 
		query.append("        AND     T8.SCC_CD           = T9.SCC_CD" ).append("\n"); 
		query.append("        AND     T6.VNDR_SEQ         = T10.VNDR_SEQ" ).append("\n"); 
		query.append(" --       AND     T2.DEL_CD           = T11.loc_cd" ).append("\n"); 
		query.append(" --       AND     T1.AGMT_CTY_CD      = T11.AGMT_CTY_CD" ).append("\n"); 
		query.append(" --       AND     T1.AGMT_SEQ         = T11.AGMT_SEQ" ).append("\n"); 
		query.append(" --       AND     T1.CNTR_TPSZ_CD     = T11.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("        AND     T2.DEL_CD     IN (      " ).append("\n"); 
		query.append("            SELECT LOC_CD" ).append("\n"); 
		query.append("            FROM  MDM_LOCATION" ).append("\n"); 
		query.append("            WHERE SCC_CD IN (SELECT SCC_CD FROM MDM_EQ_ORZ_CHT" ).append("\n"); 
		query.append("                             WHERE DECODE(@[loc_tp],'2',SCC_CD, '1',LCC_CD ,'0',RCC_CD) = @[loc_cd]" ).append("\n"); 
		query.append("           )" ).append("\n"); 
		query.append("      )" ).append("\n"); 
		query.append("#if (${str_estm_dt} != '' && ${end_estm_dt} != '')" ).append("\n"); 
		query.append("        AND     T1.cnmv_DT BETWEEN TO_DATE( REPLACE(P_STR_ESTM_DT, '-',''),'YYYYMMDD') AND TO_DATE( REPLACE(P_END_ESTM_DT, '-',''), 'YYYYMMDD') " ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${vvd_cd} != '')" ).append("\n"); 
		query.append("        AND     T4.VSL_CD           = SUBSTR(P_VVD_CD, 1, 4)" ).append("\n"); 
		query.append("        AND     T4.SKD_VOY_NO       = SUBSTR(P_VVD_CD, 5, 4)" ).append("\n"); 
		query.append("        AND     T4.SKD_DIR_CD       = SUBSTR(P_VVD_CD, 9, 1)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${lstm_cd} != '')" ).append("\n"); 
		query.append("        AND     T1.LSTM_CD IN (" ).append("\n"); 
		query.append(" #foreach($key IN ${lstm_cd_seq})" ).append("\n"); 
		query.append("   #if($velocityCount < $lstm_cd_seq.size())" ).append("\n"); 
		query.append("        '$key'," ).append("\n"); 
		query.append("   #else" ).append("\n"); 
		query.append("        '$key'" ).append("\n"); 
		query.append("   #end" ).append("\n"); 
		query.append(" #end" ).append("\n"); 
		query.append("                      )" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${cnmv_sts_cd} != '')" ).append("\n"); 
		query.append("        AND     T1.CNMV_STS_CD IN (" ).append("\n"); 
		query.append("    #foreach($key IN ${cnmv_sts_cd_seq})" ).append("\n"); 
		query.append("      #if($velocityCount < $cnmv_sts_cd_seq.size())" ).append("\n"); 
		query.append("        '$key'," ).append("\n"); 
		query.append("      #else" ).append("\n"); 
		query.append("        '$key'" ).append("\n"); 
		query.append("      #end" ).append("\n"); 
		query.append("    #end                    " ).append("\n"); 
		query.append("     )" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${agmt_seq} != '')" ).append("\n"); 
		query.append("        AND     T1.AGMT_CTY_CD = P_AGMT_CTY_CD" ).append("\n"); 
		query.append("        AND     T1.AGMT_SEQ    = P_AGMT_SEQ" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${vndr_seq} != '')" ).append("\n"); 
		query.append("        AND     T10.VNDR_SEQ    = P_VNDR_SEQ" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("  UNION ALL" ).append("\n"); 
		query.append("       SELECT   CNTR_NO, " ).append("\n"); 
		query.append("                CNTR_TPSZ_CD," ).append("\n"); 
		query.append("                LSTM_CD," ).append("\n"); 
		query.append("                AGMT_CTY_CD," ).append("\n"); 
		query.append("                AGMT_SEQ," ).append("\n"); 
		query.append("                REF_NO," ).append("\n"); 
		query.append("                VNDR_ABBR_NM," ).append("\n"); 
		query.append("                VNDR_SEQ," ).append("\n"); 
		query.append("                CRNT_YD_CD," ).append("\n"); 
		query.append("                CNMV_STS_CD," ).append("\n"); 
		query.append("                FULL_FLG," ).append("\n"); 
		query.append("                CNMV_EVNT_DT," ).append("\n"); 
		query.append("                BKG_NO," ).append("\n"); 
		query.append("                POR_CD," ).append("\n"); 
		query.append("                POL_CD," ).append("\n"); 
		query.append("                POD_CD," ).append("\n"); 
		query.append("                DEL_CD," ).append("\n"); 
		query.append("                DE_TERM," ).append("\n"); 
		query.append("                MT_RTN_YD," ).append("\n"); 
		query.append("                VSL_CD," ).append("\n"); 
		query.append("                SKD_VOY_NO," ).append("\n"); 
		query.append("                SKD_DIR_CD," ).append("\n"); 
		query.append("                VPS_ETD_DT," ).append("\n"); 
		query.append("                VPS_ETA_DT   " ).append("\n"); 
		query.append(" FROM ( " ).append("\n"); 
		query.append("                SELECT  T1.CNTR_NO, " ).append("\n"); 
		query.append("                        T1.CNTR_TPSZ_CD," ).append("\n"); 
		query.append("                        T1.LSTM_CD," ).append("\n"); 
		query.append("                        T1.AGMT_CTY_CD, T1.AGMT_SEQ," ).append("\n"); 
		query.append("                        T3.REF_NO," ).append("\n"); 
		query.append("                        (SELECT VNDR_ABBR_NM FROM MDM_VENDOR" ).append("\n"); 
		query.append("                         WHERE VNDR_SEQ = T1.VNDR_SEQ) VNDR_ABBR_NM," ).append("\n"); 
		query.append("                        T1.VNDR_SEQ," ).append("\n"); 
		query.append("                        T1.CRNT_YD_CD," ).append("\n"); 
		query.append("                        T1.CNMV_STS_CD," ).append("\n"); 
		query.append("                        T1.FULL_FLG," ).append("\n"); 
		query.append("                        T2.CNMV_EVNT_DT," ).append("\n"); 
		query.append("                        T2.BKG_NO," ).append("\n"); 
		query.append("                        T4.POR_CD," ).append("\n"); 
		query.append("                        T4.POL_CD," ).append("\n"); 
		query.append("                        T4.POD_CD," ).append("\n"); 
		query.append("                        T4.DEL_CD," ).append("\n"); 
		query.append("                        T4.DE_TERM_CD DE_TERM," ).append("\n"); 
		query.append("                        T4.MTY_RTN_YD_CD MT_RTN_YD," ).append("\n"); 
		query.append("                        T4.VSL_CD," ).append("\n"); 
		query.append("                        T4.SKD_VOY_NO," ).append("\n"); 
		query.append("                        T4.SKD_DIR_CD," ).append("\n"); 
		query.append("                      (" ).append("\n"); 
		query.append("        				 SELECT  /*+ INDEX (S01 XPKBKG_VVD) */" ).append("\n"); 
		query.append("                				 S02.VPS_ETD_DT" ).append("\n"); 
		query.append("         				 FROM    BKG_VVD  S01        " ).append("\n"); 
		query.append("              					 , VSK_VSL_PORT_SKD S02" ).append("\n"); 
		query.append("         				WHERE   1= 1" ).append("\n"); 
		query.append("        				 AND     S01.BKG_NO           = T2.BKG_NO" ).append("\n"); 
		query.append("        				 AND     S01.VSL_CD           = S02.VSL_CD      (+)" ).append("\n"); 
		query.append("        				 AND     S01.SKD_VOY_NO       = S02.SKD_VOY_NO  (+)" ).append("\n"); 
		query.append("        				 AND     S01.SKD_DIR_CD       = S02.SKD_DIR_CD  (+)" ).append("\n"); 
		query.append("        				 AND     S01.POL_CD           = S02.VPS_PORT_CD (+)" ).append("\n"); 
		query.append("        				 AND     S01.POL_CLPT_IND_SEQ = S02.CLPT_IND_SEQ(+)" ).append("\n"); 
		query.append("        				 AND     ROWNUM               = 1" ).append("\n"); 
		query.append("        			 ) AS VPS_ETD_DT" ).append("\n"); 
		query.append("     				 , (" ).append("\n"); 
		query.append("        				 SELECT  /*+ INDEX_DESC (S01 XPKBKG_VVD) */" ).append("\n"); 
		query.append("               					  S02.VPS_ETA_DT" ).append("\n"); 
		query.append("        				 FROM    	BKG_VVD          S01" ).append("\n"); 
		query.append("              					 , VSK_VSL_PORT_SKD S02" ).append("\n"); 
		query.append("         				WHERE   1= 1" ).append("\n"); 
		query.append("        				 AND     S01.BKG_NO           = T2.BKG_NO" ).append("\n"); 
		query.append("        				 AND     S01.VSL_CD           = S02.VSL_CD      (+)" ).append("\n"); 
		query.append("        				 AND     S01.SKD_VOY_NO       = S02.SKD_VOY_NO  (+)" ).append("\n"); 
		query.append("        				 AND     S01.SKD_DIR_CD       = S02.SKD_DIR_CD  (+)" ).append("\n"); 
		query.append("        				 AND     S01.POD_CD           = S02.VPS_PORT_CD (+)" ).append("\n"); 
		query.append("        				 AND     S01.POD_CLPT_IND_SEQ = S02.CLPT_IND_SEQ(+)" ).append("\n"); 
		query.append("        				 AND     ROWNUM               = 1" ).append("\n"); 
		query.append("        				 ) AS VPS_ETA_DT   " ).append("\n"); 
		query.append("        FROM  MST_CONTAINER T1, (" ).append("\n"); 
		query.append("           SELECT " ).append("\n"); 
		query.append("            LA.OFF_SEQ, LA.AGMT_CTY_CD , LA.AGMT_SEQ , LA.CNTR_NO , LA.OFFH_YD_CD , " ).append("\n"); 
		query.append("            LA.MTY_RTN_YD_CD , LA.VNDR_SEQ , LA.LSTM_CD , LA.CNTR_TPSZ_CD," ).append("\n"); 
		query.append("             MAX(BC.CNMV_EVNT_DT) CNMV_EVNT_DT," ).append("\n"); 
		query.append("            (SELECT MIN(BKG_NO) FROM BKG_CONTAINER " ).append("\n"); 
		query.append("                           WHERE  CNTR_NO = LA.CNTR_NO  " ).append("\n"); 
		query.append("                           AND CNMV_EVNT_DT = (SELECT MAX(CNMV_EVNT_DT) FROM BKG_CONTAINER WHERE CNTR_NO = LA.cntr_no)" ).append("\n"); 
		query.append("            ) BKG_NO" ).append("\n"); 
		query.append("            FROM (" ).append("\n"); 
		query.append("                SELECT MAX(OFFH_SEQ) OFF_SEQ" ).append("\n"); 
		query.append("                 ,AGMT_CTY_CD " ).append("\n"); 
		query.append("                 ,AGMT_SEQ " ).append("\n"); 
		query.append("                 ,CNTR_NO " ).append("\n"); 
		query.append("                 ,OFFH_YD_CD " ).append("\n"); 
		query.append("                 ,MTY_RTN_YD_CD " ).append("\n"); 
		query.append("                 ,VNDR_SEQ " ).append("\n"); 
		query.append("                 ,LSTM_CD " ).append("\n"); 
		query.append("                 ,CNTR_TPSZ_CD " ).append("\n"); 
		query.append("                 FROM LSE_AVAL_OFFH " ).append("\n"); 
		query.append("                 WHERE SUBSTR(OFFH_YD_CD,1,5) IN ( SELECT LOC_CD" ).append("\n"); 
		query.append("            								         FROM  MDM_LOCATION" ).append("\n"); 
		query.append("           											 WHERE SCC_CD IN (SELECT SCC_CD FROM MDM_EQ_ORZ_CHT" ).append("\n"); 
		query.append("                                                        WHERE DECODE(@[loc_tp],'2',SCC_CD, '1',LCC_CD ,'0',RCC_CD) = @[loc_cd]" ).append("\n"); 
		query.append("                                                            )" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("#if(${str_estm_dt} != '')" ).append("\n"); 
		query.append("                 AND OFFH_DUE_DT BETWEEN REPLACE(@[str_estm_dt],'-','') AND REPLACE(@[end_estm_dt],'-','') --SYSDATE" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                 GROUP BY AGMT_CTY_CD ,AGMT_SEQ ,CNTR_NO , OFFH_YD_CD , MTY_RTN_YD_CD , VNDR_SEQ , LSTM_CD , CNTR_TPSZ_CD" ).append("\n"); 
		query.append("                 ) LA, BKG_CONTAINER BC" ).append("\n"); 
		query.append("            WHERE LA.CNTR_NO = BC.CNTR_NO" ).append("\n"); 
		query.append("            GROUP BY LA.OFF_SEQ, LA.AGMT_CTY_CD , LA.AGMT_SEQ , LA.CNTR_NO , LA.OFFH_YD_CD , LA.MTY_RTN_YD_CD , LA.VNDR_SEQ , LA.LSTM_CD , LA.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("            )T2    , LSE_AGREEMENT T3, BKG_BOOKING T4" ).append("\n"); 
		query.append("        WHERE T1.CNTR_NO = T2.CNTR_NO" ).append("\n"); 
		query.append("        AND   T1.AGMT_CTY_CD = T2.AGMT_CTY_CD" ).append("\n"); 
		query.append("        AND   T1.AGMT_SEQ = T2.AGMT_SEQ" ).append("\n"); 
		query.append("        AND   T1.CNTR_TPSZ_CD    = T2.CNTR_TPSZ_CD" ).append("\n"); 
		query.append("        AND   T3.VNDR_SEQ = T2.VNDR_SEQ" ).append("\n"); 
		query.append("        AND   T3.AGMT_CTY_CD = T2.AGMT_CTY_CD" ).append("\n"); 
		query.append("        AND   T3.AGMT_SEQ = T2.AGMT_SEQ" ).append("\n"); 
		query.append("        AND   T2.BKG_NO   = T4.BKG_NO(+)" ).append("\n"); 
		query.append("        AND   T3.AGMT_SEQ = T2.AGMT_SEQ" ).append("\n"); 
		query.append("      )" ).append("\n"); 
		query.append("     WHERE 1=1 " ).append("\n"); 
		query.append("      #if (${str_estm_dt} != '' && ${end_estm_dt} != '')" ).append("\n"); 
		query.append("     AND  CNMV_EVNT_DT BETWEEN TO_DATE( REPLACE(@[str_estm_dt], '-',''),'YYYYMMDD') AND TO_DATE( REPLACE(@[end_estm_dt], '-',''), 'YYYYMMDD')" ).append("\n"); 
		query.append("     #end" ).append("\n"); 
		query.append("   )     T01" ).append("\n"); 
		query.append("WHERE 1=1" ).append("\n"); 
		query.append("#if (${lstm_cd} != '')" ).append("\n"); 
		query.append("        AND     T01.LSTM_CD IN (" ).append("\n"); 
		query.append(" #foreach($key IN ${lstm_cd_seq})" ).append("\n"); 
		query.append("   #if($velocityCount < $lstm_cd_seq.size())" ).append("\n"); 
		query.append("        '$key'," ).append("\n"); 
		query.append("   #else" ).append("\n"); 
		query.append("        '$key'" ).append("\n"); 
		query.append("   #end" ).append("\n"); 
		query.append(" #end" ).append("\n"); 
		query.append("                      )" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${cnmv_sts_cd} != '')" ).append("\n"); 
		query.append("        AND     T01.CNMV_STS_CD IN (" ).append("\n"); 
		query.append("    #foreach($key IN ${cnmv_sts_cd_seq})" ).append("\n"); 
		query.append("      #if($velocityCount < $cnmv_sts_cd_seq.size())" ).append("\n"); 
		query.append("        '$key'," ).append("\n"); 
		query.append("      #else" ).append("\n"); 
		query.append("        '$key'" ).append("\n"); 
		query.append("      #end" ).append("\n"); 
		query.append("    #end                    " ).append("\n"); 
		query.append("     )" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${vvd_cd} != '')" ).append("\n"); 
		query.append("        AND     T01.VSL_CD           = SUBSTR(@[vvd_cd], 1, 4)" ).append("\n"); 
		query.append("        AND     T01.SKD_VOY_NO       = SUBSTR(@[vvd_cd], 5, 4)" ).append("\n"); 
		query.append("        AND     T01.SKD_DIR_CD       = SUBSTR(@[vvd_cd], 9, 1)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${agmt_seq} != '')" ).append("\n"); 
		query.append("        AND     T01.AGMT_CTY_CD = 'HHO'" ).append("\n"); 
		query.append("        AND     T01.AGMT_SEQ    = @[agmt_seq]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${vndr_seq} != '')" ).append("\n"); 
		query.append("        AND     T01.VNDR_SEQ    = @[vndr_seq]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("GROUP BY T01.CNTR_NO ,   T01.CNTR_TPSZ_CD,  T01.LSTM_CD ,  T01.AGMT_CTY_CD ,T01.AGMT_SEQ,T01.REF_NO , T01.VNDR_ABBR_NM , T01.VNDR_SEQ , T01.CRNT_YD_CD ,  T01.CNMV_STS_CD ,T01.FULL_FLG," ).append("\n"); 
		query.append("          T01.CNMV_DT,   T01.BKG_NO , T01.POR_CD,  T01.POL_CD, T01.POD_CD , T01.DEL_CD, T01.DE_TERM, T01.MT_RTN_YD ,T01.VSL_CD , T01.SKD_VOY_NO , T01.SKD_DIR_CD ,T01.VPS_ETD_DT ,T01.VPS_ETA_DT" ).append("\n"); 
		query.append(") A1," ).append("\n"); 
		query.append("-- S/O Data Get 20160201" ).append("\n"); 
		query.append("(SELECT SO.TRSP_SO_OFC_CTY_CD || SO.TRSP_SO_SEQ AS SO_NO" ).append("\n"); 
		query.append("      ,WO.TRSP_WO_OFC_CTY_CD || WO.TRSP_WO_SEQ AS WO_NO" ).append("\n"); 
		query.append("      ,DECODE (SO.CUST_NOMI_TRKR_FLG,'Y', 'CNT','SML') AS VNDR_TP_CD" ).append("\n"); 
		query.append("      ,(SELECT IVDR.VNDR_SEQ ||'$'|| NVL(IVDR.VNDR_ABBR_NM, ' ') ||'$'||" ).append("\n"); 
		query.append("                (SELECT PVNDR.VNDR_SEQ ||'$'|| NVL(PVNDR.VNDR_ABBR_NM, ' ')" ).append("\n"); 
		query.append("                  FROM MDM_VENDOR PVNDR" ).append("\n"); 
		query.append("                  WHERE PVNDR.VNDR_SEQ = IVDR.PRNT_VNDR_SEQ )" ).append("\n"); 
		query.append("          FROM MDM_VENDOR IVDR" ).append("\n"); 
		query.append("          WHERE IVDR.VNDR_SEQ = CASE WHEN SO.HJL_NO IS NOT NULL " ).append("\n"); 
		query.append("                                     THEN (SELECT HJL_VNDR_SEQ FROM TRS_TRSP_HJL_SVC_ORD " ).append("\n"); 
		query.append("                                           WHERE TRSP_SO_OFC_CTY_CD = SO.TRSP_SO_OFC_CTY_CD AND TRSP_SO_SEQ = SO.TRSP_SO_SEQ)" ).append("\n"); 
		query.append("                                     ELSE SO.VNDR_SEQ" ).append("\n"); 
		query.append("                                END ) AS INV_VNDR_INFO" ).append("\n"); 
		query.append("      , SO.BKG_NO" ).append("\n"); 
		query.append("      , SO.EQ_NO" ).append("\n"); 
		query.append("    FROM TRS_TRSP_SVC_ORD SO" ).append("\n"); 
		query.append("        ,TRS_TRSP_WRK_ORD WO" ).append("\n"); 
		query.append("   WHERE SO.TRSP_WO_OFC_CTY_CD = WO.TRSP_WO_OFC_CTY_CD(+)" ).append("\n"); 
		query.append("     AND SO.TRSP_WO_SEQ = WO.TRSP_WO_SEQ(+)" ).append("\n"); 
		query.append("     AND SO.EQ_KND_CD = 'U'              " ).append("\n"); 
		query.append("     AND SO.TRSP_BND_CD = 'I'" ).append("\n"); 
		query.append(") A2 " ).append("\n"); 
		query.append("WHERE 1=1" ).append("\n"); 
		query.append("AND A1.BKG_NO = A2.BKG_NO(+)" ).append("\n"); 
		query.append("AND A1.CNTR_NO = A2.EQ_NO(+)" ).append("\n"); 
		query.append("#if (${dol_tp} == 'E')" ).append("\n"); 
		query.append("     AND     (A1.DEL_DOL = 'Y' OR A1.MT_RTN_DOL = 'Y' OR A1.CURR_YD_DOL = 'Y')" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${dol_tp} == 'N')" ).append("\n"); 
		query.append("     AND     (NVL(A1.DEL_DOL,'N') = 'N' AND NVL(A1.MT_RTN_DOL,'N') = 'N' AND NVL(A1.CURR_YD_DOL,'N') = 'N')" ).append("\n"); 
		query.append("#end" ).append("\n"); 

	}
}