<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CntrRepoPlanKpiAnalysisDBDAOSearchKPIVesselUtilizationRSQL">
			<desc><![CDATA[VESSEL 활용도 조회]]></desc>
			<sql><![CDATA[
SELECT ''
       , DECODE(A.CO_CD,'H','SML','SEN')
       , A.PORT
       , A.RCC
       , A.TRD 
       , A.LANE
       , A.VSL 
       , TO_CHAR(C.VPS_ETD_DT,'YYYY-MM-DD') VPS_ETD_DT                                                                                                                                                                                                                                                                                                                                         
       ,(SELECT PLN_YR||PLN_WK FROM EQR_WK_PRD WHERE TO_CHAR(C.VPS_ETD_DT,'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT) YRWK                                                                                                                                                                                                                                                                                                                        
       , SUM(A.F_LO_20), SUM(A.F_LO_40), SUM(A.F_LO_HC), SUM(A.F_LO_45)                                                                                                                                                                                                                                                                                                                                                                            
       , SUM(A.F_LO_20 + A.F_LO_40 + A.F_LO_HC + A.F_LO_45) F_LO_BOX                                                                                                                                                                                                                                                                                                                                                                               
       , SUM(A.E_LO_20), SUM(A.E_LO_40), SUM(A.E_LO_HC), SUM(A.E_LO_45)                                                                                                                                                                                                                                                                                                                                                                            
       , SUM(A.E_LO_20 + A.E_LO_40 + A.E_LO_HC + A.E_LO_45) E_LO_BOX                                                                                                                                                                                                                                                                                                                                                                               
       , SUM(A.F_LO_20 + A.F_LO_40 + A.F_LO_HC + A.F_LO_45 + A.E_LO_20 + A.E_LO_40 + A.E_LO_HC + A.E_LO_45) LO_BOX                                                                                                                                                                                                                                                                                                                                 
       , SUM(A.F_LO_TEU + A.E_LO_TEU) LO_TEU                                                                                                                                                                                                                                                                                                                                                                                                       
       , SUM(A.F_DS_20), SUM(A.F_DS_40), SUM(A.F_DS_HC), SUM(A.F_DS_45)                                                                                                                                                                                                                                                                                                                                                                            
       , SUM(A.F_DS_20 + A.F_DS_40 + A.F_DS_HC + A.F_DS_45) F_DS_BOX                                                                                                                                                                                                                                                                                                                                                                               
       , SUM(A.E_DS_20), SUM(A.E_DS_40), SUM(A.E_DS_HC), SUM(A.E_DS_45)                                                                                                                                                                                                                                                                                                                                                                            
       , SUM(A.E_DS_20 + A.E_DS_40 + A.E_DS_HC + A.E_DS_45) E_DS_BOX                                                                                                                                                                                                                                                                                                                                                                               
       , SUM(A.F_DS_20 + A.F_DS_40 + A.F_DS_HC + A.F_DS_45 + A.E_DS_20 + A.E_DS_40 + A.E_DS_HC + A.E_DS_45) DS_BOX                                                                                                                                                                                                                                                                                                                                 
       , SUM(A.F_DS_TEU + A.E_DS_TEU) DS_TEU                                                                                                                                                                                                                                                                                                                                                                                                       
       , SUM(A.F_ON_20), SUM(A.F_ON_40), SUM(A.F_ON_HC), SUM(A.F_ON_45),SUM(A.F_TEU)                                                                                                                                                                                                                                                                                                                                                               
       , SUM(A.E_ON_20), SUM(A.E_ON_40), SUM(A.E_ON_HC), SUM(A.E_ON_45),SUM(A.E_TEU)                                                                                                                                                                                                                                                                                                                                                               
       , SUM(A.F_ON_20 + A.F_ON_40 + A.F_ON_HC + A.F_ON_45 + A.E_ON_20 + A.E_ON_40 + A.E_ON_HC + A.E_ON_45) BOX                                                                                                                                                                                                                                                                                                                                    
       , SUM(A.ON_TTL_TEU)                                                                                                                                                                                                                                                                                                                                                                                                                         
       , SUM(BSA_SPACE), SUM(BSA_WGT)                                                                                                                                                                                                                                                                                                                                                                                                              
       , SUM(B.DEAD_SLOT) , SUM(B.WEIGHT_TOTAL)* 0.001                                                                                                                                                                                                                                                                                                                                                                                                    
       , SUM(BSA_SPACE) - (SUM(A.ON_TTL_TEU)  + SUM(B.DEAD_SLOT)) RESD_SPACE                                                                                                                                                                                                                                                                                                                                                                       
       , ROUND(SUM(A.F_LO_TEU)/ DECODE(SUM(BSA_SPACE),0,1,SUM(BSA_SPACE)),1) VSL_UF_SPACE                                                                                                                                                                                                                                                                                                                                                          
       , ROUND((SUM(A.F_LO_TEU) + SUM(A.E_LO_TEU) )/ DECODE(SUM(BSA_SPACE),0,1,SUM(BSA_SPACE)),1) VSL_TOT_SPACE                                                                                                                                                                                                                                                                                                                                    
       , ROUND(((SUM(B.WEIGHT_TOTAL)* 0.001)/DECODE(SUM(BSA_WGT),0,1,SUM(BSA_WGT)))*100,1) VSL_WGT_TTL                                                                                                                                                                                                                                                                                                                                                                                                                 
       , DECODE(SUM(A.F_LO_20 + A.F_LO_40 + A.F_LO_HC + A.F_LO_45 + A.E_LO_20 + A.E_LO_40 + A.E_LO_HC + A.E_LO_45),                                                                                                                                                                                                                                                                                                                               
      	        GREATEST(SUM(A.F_LO_20 + A.F_LO_40 + A.F_LO_HC + A.F_LO_45 + A.E_LO_20 + A.E_LO_40 + A.E_LO_HC + A.E_LO_45),                                                                                                                                                                                                                                                                                                                         
      	        SUM(A.F_DS_20 + A.F_DS_40 + A.F_DS_HC + A.F_DS_45 + A.E_DS_20 + A.E_DS_40 + A.E_DS_HC + A.E_DS_45)),                                                                                                                                                                                                                                                                                                                            
      	        '-'|| (GREATEST(SUM(A.F_LO_20 + A.F_LO_40 + A.F_LO_HC + A.F_LO_45 + A.E_LO_20 + A.E_LO_40 + A.E_LO_HC + A.E_LO_45),                                                                                                                                                                                                                                                                                                     
      	        SUM(A.F_DS_20 + A.F_DS_40 + A.F_DS_HC + A.F_DS_45 + A.E_DS_20 + A.E_DS_40 + A.E_DS_HC + A.E_DS_45))                                                                                                                                                                                                                                                                                                            
      	        /DECODE( LEAST(SUM(A.F_LO_20 + A.F_LO_40 + A.F_LO_HC + A.F_LO_45 + A.E_LO_20 + A.E_LO_40 + A.E_LO_HC + A.E_LO_45),                                                                                                                                                                                                                                                                                                      
      	        SUM(A.F_DS_20 + A.F_DS_40 + A.F_DS_HC + A.F_DS_45 + A.E_DS_20 + A.E_DS_40 + A.E_DS_HC + A.E_DS_45)),0,1,                                                                                                                                                                                                                                                                                                       
      	        LEAST(SUM(A.F_LO_20 + A.F_LO_40 + A.F_LO_HC + A.F_LO_45 + A.E_LO_20 + A.E_LO_40 + A.E_LO_HC + A.E_LO_45),                                                                                                                                                                                                                                                                                                            
      	        SUM(A.F_DS_20 + A.F_DS_40 + A.F_DS_HC + A.F_DS_45 + A.E_DS_20 + A.E_DS_40 + A.E_DS_HC + A.E_DS_45)))),                                                                                                                                                                                                                                                                                                         
      	        (GREATEST(SUM(A.F_LO_20 + A.F_LO_40 + A.F_LO_HC + A.F_LO_45 + A.E_LO_20 + A.E_LO_40 + A.E_LO_HC + A.E_LO_45),                                                                                                                                                                                                                                                                                                           
      	        SUM(A.F_DS_20 + A.F_DS_40 + A.F_DS_HC + A.F_DS_45 + A.E_DS_20 + A.E_DS_40 + A.E_DS_HC + A.E_DS_45)))                                                                                                                                                                                                                                                                                                               
      	        /DECODE(LEAST(SUM(A.F_LO_20 + A.F_LO_40 + A.F_LO_HC + A.F_LO_45 + A.E_LO_20 + A.E_LO_40 + A.E_LO_HC + A.E_LO_45),                                                                                                                                                                                                                                                                                               
      	        SUM(A.F_DS_20 + A.F_DS_40 + A.F_DS_HC + A.F_DS_45 + A.E_DS_20 + A.E_DS_40 + A.E_DS_HC + A.E_DS_45)),0,1,                                                                                                                                                                                                                                                                                                      
      	        LEAST(SUM(A.F_LO_20 + A.F_LO_40 + A.F_LO_HC + A.F_LO_45 + A.E_LO_20 + A.E_LO_40 + A.E_LO_HC + A.E_LO_45),                                                                                                                                                                                                                                                                                                    
      	        SUM(A.F_DS_20 + A.F_DS_40 + A.F_DS_HC + A.F_DS_45 + A.E_DS_20 + A.E_DS_40 + A.E_DS_HC + A.E_DS_45))))MATCH_BACK                                                                                                                                                                                                                                                                                           
FROM( SELECT  CO_CD
              , PORT
              , RCC
              , TRD
              , VSL  
              , VOY
              , DIR
              , LANE
              , STUP_FLG
              , CLPT_SEQ                                                                                                                                                                                                                                                                                                                                                              
              , SUM(F_LO_20) F_LO_20 , SUM(F_LO_40) F_LO_40 , SUM(F_LO_HC) F_LO_HC , SUM(F_LO_45) F_LO_45 , SUM(F_LO_TEU) F_LO_TEU                                                                                                                                                                                                                                                                                                                       
              , SUM(E_LO_20) E_LO_20 , SUM(E_LO_40) E_LO_40 , SUM(E_LO_HC) E_LO_HC , SUM(E_LO_45) E_LO_45 , SUM(E_LO_TEU) E_LO_TEU                                                                                                                                                                                                                                                                                                                       
              , SUM(F_DS_20) F_DS_20 , SUM(F_DS_40) F_DS_40 , SUM(F_DS_HC) F_DS_HC , SUM(F_DS_45) F_DS_45 , SUM(F_DS_TEU) F_DS_TEU                                                                                                                                                                                                                                                                                                                       
              , SUM(E_DS_20) E_DS_20 , SUM(E_DS_40) E_DS_40 , SUM(E_DS_HC) E_DS_HC , SUM(E_DS_45) E_DS_45 , SUM(E_DS_TEU) E_DS_TEU                                                                                                                                                                                                                                                                                                                       
              , SUM(F_ON_20) F_ON_20 , SUM(F_ON_40) F_ON_40 , SUM(F_ON_HC) F_ON_HC , SUM(F_ON_45) F_ON_45 , SUM(F_TEU) F_TEU                                                                                                                                                                                                                                                                                                                             
              , SUM(E_ON_20) E_ON_20 , SUM(E_ON_40) E_ON_40 , SUM(E_ON_HC) E_ON_HC , SUM(E_ON_45) E_ON_45 , SUM(E_TEU) E_TEU                                                                                                                                                                                                                                                                                                                             
              , SUM(ON_TTL_TEU) ON_TTL_TEU , SUM(BSA_SPACE) BSA_SPACE, SUM(BSA_WGT) BSA_WGT  
    ---LOADING ----                                                                                                                                                                                                                                                                                                                                                                      
      FROM ( SELECT /*+ USE_HASH(ML) USE_HASH(MO) */                                                                                                                                                                                                                                                                                                                                                                                                
                      SP.CO_CD
                    , SL.VPS_PORT_CD PORT
                    , (SELECT DISTINCT RCC_CD  
                       FROM MDM_EQ_ORZ_CHT  
                       WHERE ECC_CD = SL.VPS_PORT_CD) RCC 
                    , MD.TRD TRD
                    , SP.VSL_CD  VSL
                    , SP.SKD_VOY_NO VOY
                    , SP.SKD_DIR_CD DIR
                    , SP.VSL_SLAN_CD LANE                                                                                                                                                                                                                                                                                                                                                             
                    , CL.STUP_FLG STUP_FLG
                    , CLPT_SEQ CLPT_SEQ                                                                                                                                                                                                                                                                                                                                                                                            
                    ,NVL(SUM(DECODE(CNTR_FULL_FLG,'Y',DECODE(CNTR_TPSZ_CD , 'D2', CNTR_QTY 					                                                                                                                                                                                                                                                                                                                                                      
                       	 	 	                                              , 'R2', CNTR_QTY					                                                                                                                                                                                                                                                                                                                                                                                          
                         	 		                                            , 'O2', CNTR_QTY					                                                                                                                                                                                                                                                                                                                                                                                        
                       	 		                                              , 'F2', CNTR_QTY, 0),0)),0) F_LO_20	                                                                                                                                                                                                                                                                                                                                                                              
                    ,NVL(SUM(DECODE(CNTR_FULL_FLG,'Y',DECODE(CNTR_TPSZ_CD , 'D4', CNTR_QTY   				                                                                                                                                                                                                                                                                                                                                                      
           			                                                          , 'O4', CNTR_QTY	  				                                                                                                                                                                                                                                                                                                                                                                                        
           			                                                          , 'F5', CNTR_QTY	  				                                                                                                                                                                                                                                                                                                                                                                                        
            				                                                      , 'F4', CNTR_QTY , 0),0)),0) F_LO_40	                                                                                                                                                                                                                                                                                                                                                                                
                    ,NVL(SUM(DECODE(CNTR_FULL_FLG,'Y',DECODE(CNTR_TPSZ_CD , 'D5', CNTR_QTY   				                                                                                                                                                                                                                                                                                                                                                      
                           	                                              , 'R5', CNTR_QTY , 0),0)),0) F_LO_HC			                                                                                                                                                                                                                                                                                                                                                                      
                    ,NVL(SUM(DECODE(CNTR_FULL_FLG,'Y',DECODE(CNTR_TPSZ_CD , 'D7', CNTR_QTY , 0),0)),0) F_LO_45                                                                                                                                                                                                                                                                                                                                            
                    ,NVL(SUM(DECODE(CNTR_FULL_FLG,'Y',DECODE(CNTR_TPSZ_CD,'D2', CNTR_QTY*1,                                                                                                                                                                                                                                                                                                                                                               
                                                                          'D4', CNTR_QTY*2,                                                                                                                                                                                                                                                                                                                                                                    
                                                                          'D5', CNTR_QTY*2,                                                                                                                                                                                                                                                                                                                                                                    
                                                                          'D7', CNTR_QTY*2.5,                                                                                                                                                                                                                                                                                                                                                                  
                                                                          'O2', CNTR_QTY*1,                                                                                                                                                                                                                                                                                                                                                                    
                                                                          'O4', CNTR_QTY*2,                                                                                                                                                                                                                                                                                                                                                                    
                                                                          'R2', CNTR_QTY*1,                                                                                                                                                                                                                                                                                                                                                                    
                                                                          'R5', CNTR_QTY*2,                                                                                                                                                                                                                                                                                                                                                                    
                                                                          'F2', CNTR_QTY*1,                                                                                                                                                                                                                                                                                                                                                                    
                                                                          'F5', CNTR_QTY*2,                                                                                                                                                                                                                    
                                                                          'F4', CNTR_QTY*2, 0),0)),0) F_LO_TEU                                                                                                                                                                                                                                                                                                                                                 
                    ,NVL(SUM(DECODE(CNTR_FULL_FLG,'N',DECODE(CNTR_TPSZ_CD , 'D2', CNTR_QTY 					                                                                                                                                                                                                                                                                                                                                                      
                       	 	 	                                          , 'R2', CNTR_QTY					                                                                                                                                                                                                                                                                                                                                                                                          
                         	 		                                      , 'O2', CNTR_QTY					                                                                                                                                                                                                                                                                                                                                                                                        
                       	 		                                          , 'F2', CNTR_QTY , 0),0)),0) E_LO_20	                                                                                                                                                                                                                                                                                                                                                                              
                    ,NVL(SUM(DECODE(CNTR_FULL_FLG,'N',DECODE(CNTR_TPSZ_CD , 'D4', CNTR_QTY   				                                                                                                                                                                                                                                                                                                                                                      
           			                                                      , 'O4', CNTR_QTY	  				                                                                                                                                                                                                                                                                                                                                                                                        
           			                                                      , 'F5', CNTR_QTY	  				                                                                                                                                                                                                                                                                                                                                                                                        
            				                                              , 'F4', CNTR_QTY , 0),0)),0) E_LO_40	                                                                                                                                                                                                                                                                                                                                                                                
                    ,NVL(SUM(DECODE(CNTR_FULL_FLG,'N',DECODE(CNTR_TPSZ_CD , 'D5', CNTR_QTY   				                                                                                                                                                                                                                                                                                                                                                      
                           	                                              , 'R5', CNTR_QTY , 0),0)),0) E_LO_HC			                                                                                                                                                                                                                                                                                                                                                                      
                    ,NVL(SUM(DECODE(CNTR_FULL_FLG,'N',DECODE(CNTR_TPSZ_CD , 'D7', CNTR_QTY , 0),0)),0) E_LO_45                                                                                                                                                                                                                                                                                                                                            
                    ,NVL(SUM(DECODE(CNTR_FULL_FLG,'N',CNTR_QTY * (SELECT TEU_FCTR_RT FROM EQR_ENG_INP_TEU_EQV TE WHERE SP.CNTR_TPSZ_CD = TE.CNTR_TPSZ_CD  AND TE.TEU_CMPU_TP_CD ='EB'),0)), 0) E_LO_TEU                                                                                                                                                                                                                                                   
                    , 0 F_DS_20
                    , 0 F_DS_40
                    , 0 F_DS_HC
                    , 0 F_DS_45
                    , 0 F_DS_TEU                                                                                                                                                                                                                                                                                                                                                                                
                    , 0 E_DS_20
                    , 0 E_DS_40
                    , 0 E_DS_HC
                    , 0 E_DS_45
                    , 0 E_DS_TEU                                                                                                                                                                                                                                                                                                                                                                                
                    , 0 F_ON_20
                    , 0 F_ON_40
                    , 0 F_ON_HC
                    , 0 F_ON_45
                    , 0 F_TEU                                                                                                                                                                                                                                                                                                                                                                                   
                    , 0 E_ON_20
                    , 0 E_ON_40
                    , 0 E_ON_HC
                    , 0 E_ON_45
                    , 0 E_TEU
                    , 0 ON_TTL_TEU                                                                                                                                                                                                                                                                                                                                                                     
                    ,DECODE(CL.STUP_FLG,'Y', NVL((SELECT SUM(PORT_BSA_CAPA)                                                                                                                                                                                                                                                                                                                                                                                                  
                                                  FROM   BSA_VVD_PORT_DWN                                                                                                                                                                                                                                                                                                                                                                                                     
                                                  WHERE  VSL_CD       = SP.VSL_CD                                                                                                                                                                                                                                                                                                                                                                                                 
                                                  AND    SKD_VOY_NO   = SP.SKD_VOY_NO                                                                                                                                                                                                                                                                                                                                                                                             
                                                  AND    SKD_DIR_CD   = SP.SKD_DIR_CD                                                                                                                                                                                                                                                                                                                                                                                             
                                                  AND    PORT_CD      = SL.VPS_PORT_CD                                                                                                                                                                                                                                                                                                                                                                                            
                                                  AND    TRD_CD       = MD.TRD 
                                                #if (${vvd} !="")
                                                  AND VSL_CD ||SKD_VOY_NO || SKD_DIR_CD IN(${vvd})
                                                #end                                                                                                                                                                                                                                                                                                                                                                                                          
                                                  AND    BSA_OP_JB_CD = '007'                                                                                                                                                                                                                                                                                                                                                                                                     
                                                  AND    CRR_CD IN ('SEN','SML')                                                                                                                                                                                                                                                                                                                                                                                                  
                                                ),0)                                                                                                                                                                                                                                                                                                                                                                                                                              
                                           , NVL((SELECT SUM(SPC_CTRL_SLT_CAPA)                                                                                                                                                                                                                                                                                                                                                                                                  
                                                 FROM   BSA_VVD_OTR_CRR                                                                                                                                                                                                                                                                                                                                                                                                      
                                                 WHERE  VSL_CD       = SP.VSL_CD                                                                                                                                                                                                                                                                                                                                                                                                 
                                                 AND    SKD_VOY_NO   = SP.SKD_VOY_NO                                                                                                                                                                                                                                                                                                                                                                                             
                                                 AND    SKD_DIR_CD   = SP.SKD_DIR_CD                                                                                                                                                                                                                                                                                                                                                                                             
                                                 AND    TRD_CD       = MD.TRD
                                                #if(${vvd} !="")
                                                 AND VSL_CD ||SKD_VOY_NO || SKD_DIR_CD IN(${vvd})
                                                #end                                                                                                                                                                                                                                                                                                                                                                                                         
                                                 AND    BSA_OP_JB_CD = '007'                                                                                                                                                                                                                                                                                                                                                                                                     
                                                 AND    CRR_CD IN ('SEN','SML')                                                                                                                                                                                                                                                                                                                                                                                                  
                                                ) ,0)
                           ) BSA_SPACE                                                                                                                                                                                                                                                                                                                                                                                                                   
                    ,DECODE(CL.STUP_FLG,'Y', NVL(( SELECT SUM(PORT_BSA_CAPA)                                                                                                                                                                                                                                                                                                                                                                                                          
                                                    FROM  BSA_VVD_PORT_DWN                                                                                                                                                                                                                                                                                                                                                                                                     
                                                    WHERE  VSL_CD       = SP.VSL_CD                                                                                                                                                                                                                                                                                                                                                                                                 
                                                    AND    SKD_VOY_NO   = SP.SKD_VOY_NO                                                                                                                                                                                                                                                                                                                                                                                             
                                                    AND    SKD_DIR_CD   = SP.SKD_DIR_CD                                                                                                                                                                                                                                                                                                                                                                                             
                                                    AND    PORT_CD      = SL.VPS_PORT_CD                                                                                                                                                                                                                                                                                                                                                                                            
                                                    AND    TRD_CD       = MD.TRD
                                                #if (${vvd} !="")
                                                    AND VSL_CD ||SKD_VOY_NO || SKD_DIR_CD IN(${vvd})
                                                #end                                                                                                                                                                                                                                                                                                                                                                                                    
                                                    AND    BSA_OP_JB_CD = '016'                                                                                                                                                                                                                                                                                                                                                                                                     
                                                    AND    CRR_CD IN ('SEN','SML')                                                                                                                                                                                                                                                                                                                                                                                                  
                                                  ) ,0)                                                                                                                                                                                                                                                                                                                                                                                                                              
                                            ,NVL(( SELECT DECODE(SUM(DECODE(BSA_OP_JB_CD, '007', CRR_BSA_CAPA)),0,0,ROUND(SUM(DECODE(BSA_OP_JB_CD, '009', CRR_BSA_CAPA )) / (SUM(DECODE(BSA_OP_JB_CD, '007',  CRR_BSA_CAPA ))) *                                                                                                                                                                                                                                                              
                                                                 SUM(DECODE(BSA_OP_JB_CD, '007', SPC_CTRL_SLT_CAPA))*1000 ,2))  CRR_BSA_CAPA                                                                                                                                                                                                                                                                                                                                                        
                                                   FROM   BSA_VVD_OTR_CRR                                                                                                                                                                                                                                                                                                                                                                                                      
                                                   WHERE  VSL_CD       = SP.VSL_CD                                                                                                                                                                                                                                                                                                                                                                                                 
                                                   AND    SKD_VOY_NO   = SP.SKD_VOY_NO                                                                                                                                                                                                                                                                                                                                                                                             
                                                   AND    SKD_DIR_CD   = SP.SKD_DIR_CD                                                                                                                                                                                                                                                                                                                                                                                             
                                                   AND    TRD_CD       = MD.TRD
                                                #if (${vvd} !="")
                                                   AND VSL_CD ||SKD_VOY_NO || SKD_DIR_CD IN(${vvd})
                                                #end                                                                                                                                                                                                                                                                                                                                                                                                    
                                                   AND    BSA_OP_JB_CD = '009'                                                                                                                                                                                                                                                                                                                                                                                                     
                                                   AND    CRR_CD IN ('SEN','SML')                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                               
                            ) ,0)) BSA_WGT                                                                                                                                                                                                                                                                                                                                                                                                                     
             FROM EQR_SEA_INVT_SNAP_POL SP
                , VSK_VSL_PORT_SKD SL 
                , MDM_LOCATION ML
                , MDM_LOCATION MO                                                                                                                                                                                                                                                                                                                                                 
                , COA_LANE_RGST CL
                , COA_MON_VVD CM 
                ,( SELECT DISTINCT RLANE_CD LANE
                         , VSL_SLAN_DIR_CD DIR
                         , FM_CONTI_CD CONTI
                         , TO_CONTI_CD CONTI1
                         , TRD_CD TRD                                                                                                                                                                                                                                                                                                                              
                  FROM MDM_DTL_REV_LANE A                                                                                                                                                                                                                                                                                                                                                                                                            
                  WHERE   A.DELT_FLG ='N'                                                                                                                                                                                                                                                                                                                                                                                                            
                  AND SUB_TRD_CD NOT IN ('IP')                                                                                                                                                                                                                                                                                                                                                                                                       
                 ) MD                                                                                                                                                                                                                                                                                                                                                                                                                                   
             WHERE  SNAP_DT =  TO_CHAR((SL.VPS_ETD_DT+0.99999) +1,'YYYYMMDD')                                                                                                                                                                                                                                                                                                                                                                                  
             AND SL.VPS_ETD_DT 
             BETWEEN                                                                                                                                                                                                                                                                                                                                                                                                              
              (SELECT TO_DATE(WK_ST_DT,'YYYYMMDD') FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fr_week])  		                                                                                                                                                                                                                                                                                                                                                
             AND
             (SELECT TO_DATE(WK_END_DT,'YYYYMMDD') FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[to_week])                                                                                                                                                                                                                                                                                                                                              
             AND SP.VSL_CD           = SL.VSL_CD                                                                                                                                                                                                                                                                                                                                                                                                    
             AND SP.SKD_VOY_NO       = SL.SKD_VOY_NO                                                                                                                                                                                                                                                                                                                                                                                                
             AND SP.SKD_DIR_CD       = SL.SKD_DIR_CD                                                                                                                                                                                                                                                                                                                                                                                                
             AND SP.VSL_SLAN_CD      = SL.SLAN_CD                                                                                                                                                                                                                                                                                                                                                                                                   
             AND SP.FM_ECC_CD        = SL.VPS_PORT_CD                                                                                                                                                                                                                                                                                                                                                                                               
             AND SP.SKD_DIR_CD       = MD.DIR                                                                                                                                                                                                                                                                                                                                                                                                       
             AND SL.VPS_PORT_CD      = ML.LOC_CD                                                                                                                                                                                                                                                                                                                                                                                                    
             AND DECODE(SUBSTR(MD.LANE,1,3),'MIX',DECODE(ML.CONTI_CD,'F','E',ML.CONTI_CD),  ML.CONTI_CD)  = MD.CONTI                                                                                                                                                                                                                                                                                                                                                                                                                      
             AND DECODE(SUBSTR(MD.LANE,1,3),'MIX',DECODE(MO.CONTI_CD,'F','E',MO.CONTI_CD), MO.CONTI_CD)  = MD.CONTI1                                                                                                                                                                                                                                                                                                                                                                                                                 
             AND SP.TO_ECC_CD  = MO.LOC_CD                                                                                                                                                                                                                                                                                                                                                                                                          
             AND MD.LANE = CL.RLANE_CD                                                                                                                                                                                                                                                                                                                                                                                                              
             AND MD.DIR = CL.DIR_CD                                                                                                                                                                                                                                                                                                                                                                                                                 
             AND MD.TRD = CL.TRD_CD                                                                                                                                                                                                                                                                                                                                                                                                                 
             AND MD.LANE = CM.RLANE_CD                                                                                                                                                                                                                                                                                                                                                                                                              
             AND MD.TRD = CM.TRD_CD                                                                                                                                                                                                                                                                                                                                                                                                                 
             AND SP.VSL_CD      = CM.VSL_CD                                                                                                                                                                                                                                                                                                                                                                                                         
             AND SP.SKD_VOY_NO  = CM.SKD_VOY_NO                                                                                                                                                                                                                                                                                                                                                                                                     
             AND SP.SKD_DIR_CD  = CM.DIR_CD                                                                                                                                                                                                                                                                                                                                                                                                         
             AND SUBSTR(MD.LANE,1,3)     = SL.SLAN_CD                                                                                                                                                                                                                                                                                                                                                                                               
             AND CL.VSL_LANE_TP_CD IN ('SC','JO')                                                                                                                                                                                                                                                                                                                                                                                                   
             AND  NVL(CM.DELT_FLG,'N') <> 'Y'
         #if (${vvd} !="")
             AND SP.VSL_CD ||SP.SKD_VOY_NO || SP.SKD_DIR_CD IN(${vvd})
         #end                                                                                                                                                                                                                                                                                                                                                                                                          
              GROUP BY  SP.CO_CD
                        , SL.VPS_PORT_CD
                        , MD.TRD
                        , SP.VSL_CD
                        , SP.SKD_VOY_NO
                        , SP.SKD_DIR_CD
                        , SP.VSL_SLAN_CD
                        , CL.STUP_FLG 
                        , CLPT_SEQ                                                                                                                                                                                                                                                                                                                                                                      
          ---DISCHARGING                                                                                                                                                                                                                                                                                                                                                                                                                         
          UNION ALL                                                                                                                                                                                                                                                                                                                                                                                                                              
          SELECT /*+ USE_HASH(ML) USE_HASH(MO) */                                                                                                                                                                                                                                                                                                                                                                                               
                    SP.CO_CD
                  , SL.VPS_PORT_CD PORT
                  , (SELECT DISTINCT RCC_CD  
                     FROM MDM_EQ_ORZ_CHT  
                     WHERE ECC_CD = SL.VPS_PORT_CD) RCC
                  , MD.TRD TRD
                  , SP.VSL_CD  VSL
                  , SP.SKD_VOY_NO VOY
                  , SP.SKD_DIR_CD DIR
                  , SP.VSL_SLAN_CD LANE                                                                                                                                                                                                                                                                                                                                                             
                  , CL.STUP_FLG STUP_FLG                                                                                                                                                                                                                                                                                                                                                                                                                
                  , CLPT_SEQ CLPT_SEQ                                                                                                                                                                                                                                                                                                                                                                                                                    
                  , 0 F_LO_20
                  , 0 F_LO_40
                  , 0 F_LO_HC
                  , 0 F_LO_45
                  , 0 F_LO_TEU                                                                                                                                                                                                                                                                                                                                                                               
                  , 0 E_LO_20
                  , 0 E_LO_40
                  , 0 E_LO_HC
                  , 0 E_LO_45
                  , 0 E_LO_TEU                                                                                                                                                                                                                                                                                                                                                                               
                  , NVL(SUM(DECODE(CNTR_FULL_FLG,'Y',DECODE(CNTR_TPSZ_CD , 'D2', CNTR_QTY 					                                                                                                                                                                                                                                                                                                                                                    
                       	 	 	                                             , 'R2', CNTR_QTY					                                                                                                                                                                                                                                                                                                                                                                                        
                         	 	  	                                         , 'O2', CNTR_QTY					                                                                                                                                                                                                                                                                                                                                                                                    
                       	 		                                             , 'F2', CNTR_QTY, 0),0)),0) F_DS_20	                                                                                                                                                                                                                                                                                                                                                                              
                  , NVL(SUM(DECODE(CNTR_FULL_FLG,'Y',DECODE(CNTR_TPSZ_CD , 'D4', CNTR_QTY   				                                                                                                                                                                                                                                                                                                                                                    
           			                                                         , 'O4', CNTR_QTY	  				                                                                                                                                                                                                                                                                                                                                                                                        
           			                                                         , 'F5', CNTR_QTY	  				                                                                                                                                                                                                                                                                                                                                                                                        
            				                                                     , 'F4', CNTR_QTY , 0),0)),0) F_DS_40	                                                                                                                                                                                                                                                                                                                                                                              
                  ,NVL(SUM(DECODE(CNTR_FULL_FLG,'Y',DECODE(CNTR_TPSZ_CD  , 'D5', CNTR_QTY   				                                                                                                                                                                                                                                                                                                                                                      
                           	                                             , 'R5', CNTR_QTY , 0),0)),0) F_DS_HC			                                                                                                                                                                                                                                                                                                                                                                      
                  ,NVL(SUM(DECODE(CNTR_FULL_FLG,'Y',DECODE(CNTR_TPSZ_CD  , 'D7', CNTR_QTY , 0),0)),0) F_DS_45                                                                                                                                                                                                                                                                                                                                            
                  ,NVL(SUM(DECODE(CNTR_FULL_FLG,'Y',DECODE(CNTR_TPSZ_CD,'D2', CNTR_QTY*1,                                                                                                                                                                                                                                                                                                                                                               
                                                                        'D4', CNTR_QTY*2,                                                                                                                                                                                                                                                                                                                                                                    
                                                                        'D5', CNTR_QTY*2,                                                                                                                                                                                                                                                                                                                                                                    
                                                                        'D7', CNTR_QTY*2.5,                                                                                                                                                                                                                                                                                                                                                                  
                                                                        'O2', CNTR_QTY*1,                                                                                                                                                                                                                                                                                                                                                                    
                                                                        'O4', CNTR_QTY*2,                                                                                                                                                                                                                                                                                                                                                                    
                                                                        'R2', CNTR_QTY*1,                                                                                                                                                                                                                                                                                                                                                                    
                                                                        'R5', CNTR_QTY*2,                                                                                                                                                                                                                                                                                                                                                                    
                                                                        'F2', CNTR_QTY*1,                                                                                                                                                                                                                                                                                                                                                                    
                                                                        'F5', CNTR_QTY*2,                                                                                                                                                                                                                    
                                                                        'F4', CNTR_QTY*2, 0),0)),0) F_DS_TEU                                                                                                                                                                                                                                                  
                  ,NVL(SUM(DECODE(CNTR_FULL_FLG,'N',DECODE(CNTR_TPSZ_CD , 'D2', CNTR_QTY 					                                                                                                                                                                                                                                                                                                                                                      
                       	 	 	                                            , 'R2', CNTR_QTY	 
                       	 	 	                                            , 'O2', CNTR_QTY 
                       	 	 	                                            , 'F2', CNTR_QTY , 0),0)),0) E_DS_20	                                                                                                                                                                                                                                                                                                                                        
                  ,NVL(SUM(DECODE(CNTR_FULL_FLG,'N',DECODE(CNTR_TPSZ_CD , 'D4', CNTR_QTY   				                                                                                                                                                                                                                                                                                                                                                      
            			                                                      , 'O4', CNTR_QTY	 
            			                                                      , 'F4', CNTR_QTY 
            			                                                      , 'F5', CNTR_QTY, 0),0)),0) E_DS_40	                                                                                                                                                                                                                                                                                                                                                          
                  ,NVL(SUM(DECODE(CNTR_FULL_FLG,'N',DECODE(CNTR_TPSZ_CD , 'D5', CNTR_QTY 
                                                                        , 'R5', CNTR_QTY , 0),0)),0) E_DS_HC			                                                                                                                                                                                                                                                                                                                      
                  ,NVL(SUM(DECODE(CNTR_FULL_FLG,'N',DECODE(CNTR_TPSZ_CD , 'D7', CNTR_QTY , 0),0)),0) E_DS_45                                                                                                                                                                                                                                                                                                                                            
                  ,NVL(SUM(DECODE(CNTR_FULL_FLG,'N', CNTR_QTY * (SELECT TEU_FCTR_RT FROM EQR_ENG_INP_TEU_EQV TE WHERE SP.CNTR_TPSZ_CD = TE.CNTR_TPSZ_CD  AND TE.TEU_CMPU_TP_CD ='EB'),0)), 0) E_DS_TEU                                                                                                                                                                                                                                                  
                  , 0 F_ON_20
                  , 0 F_ON_40
                  , 0 F_ON_HC
                  , 0 F_ON_45
                  , 0 F_TEU                                                                                                                                                                                                                                                                                                                                                                                   
                  , 0 E_ON_20
                  , 0 E_ON_40
                  , 0 E_ON_HC
                  , 0 E_ON_45
                  , 0 E_TEU
                  , 0 ON_TTL_TEU                                                                                                                                                                                                                                                                                                                                                                     
                  , 0 BSA_SPACE
                  , 0 BSA_WGT                                                                                                                                                                                                                                                                                                                                                                                                                
          FROM EQR_SEA_INVT_SNAP_POL SP
              , VSK_VSL_PORT_SKD SL 
              , MDM_LOCATION ML                                                                                                                                                                                                                                                                                                                                                                   
              , MDM_LOCATION MO                                                                                                                                                                                                                                                                                                                                                                                                                     
              , COA_LANE_RGST CL
              , COA_MON_VVD CM
              , (SELECT DISTINCT RLANE_CD LANE
                          , VSL_SLAN_DIR_CD DIR
                          , FM_CONTI_CD CONTI
                          , TO_CONTI_CD CONTI1
                          ,TRD_CD TRD                                                                                                                                                                                                                                                                                                                              
                 FROM MDM_DTL_REV_LANE A                                                                                                                                                                                                                                                                                                                                                                                                            
                 WHERE   A.DELT_FLG ='N'                                                                                                                                                                                                                                                                                                                                                                                                            
                 AND SUB_TRD_CD NOT IN ('IP')                                                                                                                                                                                                                                                                                                                                                                                                       
                ) MD                                                                                                                                                                                                                                                                                                                                                                                                                                   
          WHERE  SNAP_DT =  TO_CHAR((SL.VPS_ETA_DT+0.99999) ,'YYYYMMDD')                                                                                                                                                                                                                                                                                                                                                                         
          AND SL.VPS_ETA_DT 
              BETWEEN                                                                                                                                                                                                                                                                                                                                                                                                              
               (SELECT TO_DATE(WK_ST_DT,'YYYYMMDD') FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fr_week])  		                                                                                                                                                                                                                                                                                                                                                
              AND	
               (SELECT TO_DATE(WK_END_DT,'YYYYMMDD') FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[to_week])                                                                                                                                                                                                                                                                                                                                              
          AND SP.VSL_CD           = SL.VSL_CD                                                                                                                                                                                                                                                                                                                                                                                                    
          AND SP.SKD_VOY_NO       = SL.SKD_VOY_NO                                                                                                                                                                                                                                                                                                                                                                                                
          AND SP.SKD_DIR_CD       = SL.SKD_DIR_CD                                                                                                                                                                                                                                                                                                                                                                                                
          AND SP.VSL_SLAN_CD      = SL.SLAN_CD                                                                                                                                                                                                                                                                                                                                                                                                   
          AND SP.TO_ECC_CD        = SL.VPS_PORT_CD                                                                                                                                                                                                                                                                                                                                                                                               
          AND SP.SKD_DIR_CD       = MD.DIR                                                                                                                                                                                                                                                                                                                                                                                                       
          AND SL.VPS_PORT_CD      = ML.LOC_CD                                                                                                                                                                                                                                                                                                                                                                                                    
          AND DECODE(SUBSTR(MD.LANE,1,3),'MIX',DECODE(ML.CONTI_CD,'F','E',ML.CONTI_CD), ML.CONTI_CD) = MD.CONTI                                                                                                                                                                                                                                                                                                                                                                                                                      
          AND DECODE(SUBSTR(MD.LANE,1,3),'MIX',DECODE(MO.CONTI_CD,'F','E',MO.CONTI_CD), MO.CONTI_CD) = MD.CONTI1                                                                                                                                                                                                                                                                                                                                                                                                                 
          AND SP.TO_ECC_CD  = MO.LOC_CD                                                                                                                                                                                                                                                                                                                                                                                                          
          AND MD.LANE = CL.RLANE_CD                                                                                                                                                                                                                                                                                                                                                                                                              
          AND MD.DIR = CL.DIR_CD                                                                                                                                                                                                                                                                                                                                                                                                                 
          AND MD.TRD = CL.TRD_CD                                                                                                                                                                                                                                                                                                                                                                                                                 
          AND MD.LANE = CM.RLANE_CD                                                                                                                                                                                                                                                                                                                                                                                                             
          AND MD.TRD = CM.TRD_CD                                                                                                                                                                                                                                                                                                                                                                                                                 
          AND SP.VSL_CD      = CM.VSL_CD                                                                                                                                                                                                                                                                                                                                                                                                         
          AND SP.SKD_VOY_NO  = CM.SKD_VOY_NO                                                                                                                                                                                                                                                                                                                                                                                                     
          AND SP.SKD_DIR_CD  = CM.DIR_CD                                                                                                                                                                                                                                                                                                                                                                                                         
          AND CL.VSL_LANE_TP_CD IN ('SC','JO')                                                                                                                                                                                                                                                                                                                                                                                                   
          AND SUBSTR(MD.LANE,1,3)     = SL.SLAN_CD                                                                                                                                                                                                                                                                                                                                                                                               
          AND  NVL(CM.DELT_FLG,'N') <> 'Y' 
       #if (${vvd} !="")
          AND SP.VSL_CD ||SP.SKD_VOY_NO || SP.SKD_DIR_CD IN(${vvd})
         #end                                                                                                                                                                                                                                                                                                                                                                                                         
          GROUP BY   SP.CO_CD
                   , SL.VPS_PORT_CD
                   , MD.TRD
                   , SP.VSL_CD
                   , SP.SKD_VOY_NO
                   , SP.SKD_DIR_CD
                   , SP.VSL_SLAN_CD
                   , CL.STUP_FLG 
                   , CLPT_SEQ                                                                                                                                                                                                                                                                                                                                                                              
          UNION ALL                                                                                                                                                                                                                                                                                                                                                                                                                              
          -- ON BOARD --                                                                                                                                                                                                                                                                                                                                                                                                                         
          SELECT  AA.CO_CD
                , BB.VPS_PORT_CD PORT
                , (SELECT DISTINCT RCC_CD  FROM MDM_EQ_ORZ_CHT  WHERE ECC_CD = BB.VPS_PORT_CD) RCC
                , AA.TRD TRD
                , AA.VSL VSL
                , AA.VOY VOY
                , AA.DIR DIR
                , AA.LANE LANE
                , AA.STUP_FLG STUP_FLG
                , BB.CLPT_SEQ CLPT_SEQ                                                                                                                                                                                                                                                                                                                                       
                , 0 F_LO_20
                , 0 F_LO_40
                , 0 F_LO_HC
                , 0 F_LO_45
                , 0 F_LO_TEU                                                                                                                                                                                                                                                                                                                                                                            
                , 0 E_LO_20
                , 0 E_LO_40
                , 0 E_LO_HC
                , 0 E_LO_45
                , 0 E_LO_TEU                                                                                                                                                                                                                                                                                                                                                                            
                , 0 F_DS_20
                , 0 F_DS_40
                , 0 F_DS_HC
                , 0 F_DS_45
                , 0 F_DS_TEU                                                                                                                                                                                                                                                                                                                                                                            
                , 0 E_DS_20
                , 0 E_DS_40
                , 0 E_DS_HC
                , 0 E_DS_45
                , 0 E_DS_TEU                                                                                                                                                                                                                                                                                                                                                                            
                , SUM(AA.F_ON_20) F_ON_20
                , SUM(AA.F_ON_40) F_ON_40
                , SUM(AA.F_ON_HC) F_ON_HC
                , SUM(AA.F_ON_45) F_ON_45
                , SUM(AA.F_TEU) F_TEU                                                                                                                                                                                                                                                                                                           
                , SUM(AA.E_ON_20) E_ON_20
                , SUM(AA.E_ON_40) E_ON_40
                , SUM(AA.E_ON_HC) E_ON_HC
                , SUM(AA.E_ON_45) E_ON_45
                , SUM(AA.E_TEU) E_TEU                                                                                                                                                                                                                                                                                                           
                , SUM(AA.E_TEU + AA.F_TEU) ON_TTL_TEU                                                                                                                                                                                                                                                                                                                                                                                                     
                , 0 BSA_SPACE, 0 BSA_WGT                                                                                                                                                                                                                                                                                                                                                                                                            
          FROM (SELECT /*+ USE_HASH(ML) USE_HASH(MO) FULL(SP) */ 
                     SP.CO_CD
                     , SP.VSL_CD VSL
                     , SP.SKD_VOY_NO VOY
                     , SP.SKD_DIR_CD DIR
                     , SP.FM_ECC_CD FM_LOC
                     , MAX(SL.CLPT_SEQ) FM_SEQ
                     , SP.TO_ECC_CD TO_LOC
                     , MIN(SD.CLPT_SEQ) TO_SEQ                                                                                                                                                                                                                                                                                                                                                                                
                     , SP.VSL_SLAN_CD LANE                                                                                                                                                                                                                                                                                                                                                                                                         
                     , MD.TRD TRD                                                                                                                                                                                                                                                                                                                                                                                                                  
                     , CL.STUP_FLG STUP_FLG                                                                                                                                                                                                                                                                                                                                                                                                        
                     ,NVL(SUM(DECODE(CNTR_FULL_FLG,'Y',DECODE(CNTR_TPSZ_CD , 'D2', CNTR_QTY                                                                                                                                                                                                                                                                                                                                                                                    
                              	 	 	                                       , 'R2', CNTR_QTY					                                                                                                                                                                                                                                                                                                                                                                                  
                                 	 	                                       , 'O2', CNTR_QTY					                                                                                                                                                                                                                                                                                                                                                                            
                               	 		                                       , 'F2', CNTR_QTY, 0),0)),0) F_ON_20	                                                                                                                                                                                                                                                                                                                                                                    
                     ,NVL(SUM(DECODE(CNTR_FULL_FLG,'Y',DECODE(CNTR_TPSZ_CD , 'D4', CNTR_QTY   				                                                                                                                                                                                                                                                                                                                                                                          
                   			                                                   , 'O4', CNTR_QTY	  				                                                                                                                                                                                                                                                                                                                                                                              
                   			                                                   , 'F5', CNTR_QTY	  				                                                                                                                                                                                                                                                                                                                                                                              
                    				                                               , 'F4', CNTR_QTY , 0),0)),0) F_ON_40	                                                                                                                                                                                                                                                                                                                                                                      
                    ,NVL(SUM(DECODE(CNTR_FULL_FLG,'Y',DECODE(CNTR_TPSZ_CD  , 'D5', CNTR_QTY   				                                                                                                                                                                                                                                                                                                                                                                          
                                   	                                       , 'R5', CNTR_QTY , 0),0)),0) F_ON_HC			                                                                                                                                                                                                                                                                                                                                                            
                    ,NVL(SUM(DECODE(CNTR_FULL_FLG,'Y',DECODE(CNTR_TPSZ_CD  , 'D7', CNTR_QTY , 0),0)),0) F_ON_45                                                                                                                                                                                                                                                                                                                                    
                    ,NVL(SUM(DECODE(CNTR_FULL_FLG,'Y',DECODE(CNTR_TPSZ_CD,'D2', CNTR_QTY*1,                                                                                                                                                                                                                                                                                                                                                              
                                                                          'D4', CNTR_QTY*2,                                                                                                                                                                                                                                                                                                                                                                    
                                                                          'D5', CNTR_QTY*2,                                                                                                                                                                                                                                                                                                                                                                    
                                                                          'D7', CNTR_QTY*2.5,                                                                                                                                                                                                                                                                                                                                                                  
                                                                          'O2', CNTR_QTY*1,                                                                                                                                                                                                                                                                                                                                                                    
                                                                          'O4', CNTR_QTY*2,                                                                                                                                                                                                                                                                                                                                                                    
                                                                          'R2', CNTR_QTY*1,                                                                                                                                                                                                                                                                                                                                                                    
                                                                          'R5', CNTR_QTY*2,                                                                                                                                                                                                                                                                                                                                                                    
                                                                          'F2', CNTR_QTY*1,                                                                                                                                                                                                                                                                                                                                                                    
                                                                          'F5', CNTR_QTY*2,                                                                                                                                                                                                                    
                                                                          'F4', CNTR_QTY*2, 0),0)),0) F_TEU                                                                                                                                                                                                                                             
                   ,NVL(SUM(DECODE(CNTR_FULL_FLG,'N',DECODE(CNTR_TPSZ_CD , 'D2', CNTR_QTY 					                                                                                                                                                                                                                                                                                                                                              
                               	 	 	                                     , 'R2', CNTR_QTY					                                                                                                                                                                                                                                                                                                                                                                                
                                 	 		                                   , 'O2', CNTR_QTY					                                                                                                                                                                                                                                                                                                                                                                              
                               	 		                                     , 'F2', CNTR_QTY , 0),0)),0) E_ON_20	                                                                                                                                                                                                                                                                                                                                                                    
                   ,NVL(SUM(DECODE(CNTR_FULL_FLG,'N',DECODE(CNTR_TPSZ_CD , 'D4', CNTR_QTY   				                                                                                                                                                                                                                                                                                                                                              
                                                                         , 'O4', CNTR_QTY	  				                                                                                                                                                                                                                                                                                                                                                                                
           			                                                         , 'F5', CNTR_QTY	  				                                                                                                                                                                                                                                                                                                                                                                                        
                    				                                             , 'F4', CNTR_QTY , 0),0)),0) E_ON_40	                                                                                                                                                                                                                                                                                                                                                                        
                   ,NVL(SUM(DECODE(CNTR_FULL_FLG,'N',DECODE(CNTR_TPSZ_CD , 'D5', CNTR_QTY   				                                                                                                                                                                                                                                                                                                                                              
                                   	                                     , 'R5', CNTR_QTY , 0),0)),0) E_ON_HC			                                                                                                                                                                                                                                                                                                                                                              
                   ,NVL(SUM(DECODE(CNTR_FULL_FLG,'N',DECODE(CNTR_TPSZ_CD , 'D7', CNTR_QTY , 0),0)),0) E_ON_45                                                                                                                                                                                                                                                                                                                                    
                   ,NVL(SUM(DECODE(CNTR_FULL_FLG,'N', CNTR_QTY * (SELECT TEU_FCTR_RT FROM EQR_ENG_INP_TEU_EQV TE WHERE SP.CNTR_TPSZ_CD = TE.CNTR_TPSZ_CD  AND TE.TEU_CMPU_TP_CD ='EB'),0)), 0) E_TEU                                                                                                                                                                                                                                             
                   ,NVL(SUM(CNTR_QTY * (SELECT TEU_FCTR_RT FROM EQR_ENG_INP_TEU_EQV TE WHERE SP.CNTR_TPSZ_CD = TE.CNTR_TPSZ_CD  AND TE.TEU_CMPU_TP_CD ='EB')), 0) ON_TTL_TEU                                                                                                                                                                                                                                                                     
               FROM EQR_SEA_INVT_SNAP_POL SP
                   , VSK_VSL_PORT_SKD SL
                   , VSK_VSL_PORT_SKD SD
                   , MDM_LOCATION ML 
                   , MDM_LOCATION MO
                   , COA_LANE_RGST CL
                   , COA_MON_VVD CM
                   , (SELECT DISTINCT RLANE_CD LANE
                               , VSL_SLAN_DIR_CD DIR
                               , FM_CONTI_CD CONTI
                               , TO_CONTI_CD CONTI1
                               , TRD_CD TRD                                                                                                                                                                                                                                                                                                                           
                      FROM MDM_DTL_REV_LANE A                                                                                                                                                                                                                                                                                                                                                                                                        
                      WHERE   A.DELT_FLG ='N'                                                                                                                                                                                                                                                                                                                                                                                                        
                      AND SUB_TRD_CD NOT IN ('IP')                                                                                                                                                                                                                                                                                                                                                                                                   
                     ) MD                                                                                                                                                                                                                                                                                                                                                                                                                               
              WHERE  SNAP_DT =  TO_CHAR((SL.VPS_ETD_DT+0.99999) +1,'YYYYMMDD')                                                                                                                                                                                                                                                                                                                                                                   
              AND SL.VPS_ETD_DT 
              BETWEEN                                                                                                                                                                                                                                                                                                                                                                                                          
                  (SELECT TO_DATE(WK_ST_DT,'YYYYMMDD') FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fr_week])  		                                                                                                                                                                                                                                                                                                                                          
              AND	
                  (SELECT TO_DATE(WK_END_DT,'YYYYMMDD') FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[to_week])                                                                                                                                                                                                                                                                                                                                        
              AND SP.VSL_CD           = SL.VSL_CD                                                                                                                                                                                                                                                                                                                                                                                                
              AND SP.SKD_VOY_NO       = SL.SKD_VOY_NO                                                                                                                                                                                                                                                                                                                                                                                            
              AND SP.SKD_DIR_CD       = SL.SKD_DIR_CD                                                                                                                                                                                                                                                                                                                                                                                            
              AND SP.FM_ECC_CD        = SL.VPS_PORT_CD                                                                                                                                                                                                                                                                                                                                                                                           
              AND SP.VSL_CD           = SD.VSL_CD                                                                                                                                                                                                                                                                                                                                                                                                
              AND SP.SKD_VOY_NO       = SD.SKD_VOY_NO                                                                                                                                                                                                                                                                                                                                                                                            
              AND SP.SKD_DIR_CD       = SD.SKD_DIR_CD                                                                                                                                                                                                                                                                                                                                                                                            
              AND SP.TO_ECC_CD        = SD.VPS_PORT_CD                                                                                                                                                                                                                                                                                                                                                                                           
              AND SP.SKD_DIR_CD       = MD.DIR                                                                                                                                                                                                                                                                                                                                                                                                   
              AND SL.SKD_DIR_CD       = MD.DIR                                                                                                                                                                                                                                                                                                                                                                                                   
              AND SP.FM_ECC_CD        = ML.LOC_CD                                                                                                                                                                                                                                                                                                                                                                                                
              AND SP.TO_ECC_CD        = MO.LOC_CD                                                                                                                                                                                                                                                                                                                                                                                                
              AND DECODE(SUBSTR(MD.LANE,1,3),'MIX',DECODE(ML.CONTI_CD,'F','E',ML.CONTI_CD), ML.CONTI_CD)  = MD.CONTI                                                                                                                                                                                                                                                                                                                                                                                                              
              AND DECODE(SUBSTR(MD.LANE,1,3),'MIX',DECODE(MO.CONTI_CD,'F','E',MO.CONTI_CD), MO.CONTI_CD)  = MD.CONTI1                                                                                                                                                                                                                                                                                                                                                                                                             
              AND MD.LANE = CL.RLANE_CD                                                                                                                                                                                                                                                                                                                                                                                                          
              AND MD.DIR = CL.DIR_CD                                                                                                                                                                                                                                                                                                                                                                                                             
              AND MD.TRD = CL.TRD_CD                                                                                                                                                                                                                                                                                                                                                                                                             
              AND MD.LANE = CM.RLANE_CD                                                                                                                                                                                                                                                                                                                                                                                                       
              AND MD.TRD = CM.TRD_CD                                                                                                                                                                                                                                                                                                                                                                                                                 
              AND SP.VSL_CD      = CM.VSL_CD                                                                                                                                                                                                                                                                                                                                                                                                         
              AND SP.SKD_VOY_NO  = CM.SKD_VOY_NO                                                                                                                                                                                                                                                                                                                                                                                                     
              AND SP.SKD_DIR_CD  = CM.DIR_CD                                                                                                                                                                                                                                                                                                                                                                                                         
              AND CL.VSL_LANE_TP_CD IN ('SC','JO')                                                                                                                                                                                                                                                                                                                                                                                               
              AND SUBSTR(MD.LANE,1,3) = SP.VSL_SLAN_CD                                                                                                                                                                                                                                                                                                                                                                                           
              AND  NVL(CM.DELT_FLG,'N') <> 'Y'
         #if (${vvd} !="")
              AND SP.VSL_CD ||SP.SKD_VOY_NO || SP.SKD_DIR_CD IN(${vvd})
         #end                                                                                                                                                                                                                                                                                                                                                                                                          
             GROUP BY  SP.CO_CD
                      , SP.VSL_CD
                      , SP.SKD_VOY_NO
                      , SP.SKD_DIR_CD
                      , SP.FM_ECC_CD
                      , SP.TO_ECC_CD 
                      , SP.VSL_SLAN_CD
                      , MD.TRD 
                      , CL.STUP_FLG                                                                                                                                                                                                                                                                                                                 
          )AA
          , VSK_VSL_PORT_SKD BB                                                                                                                                                                                                                                                                                                                                                                                                               
          WHERE BB.VPS_ETD_DT 
          BETWEEN                                                                                                                                                                                                                                                                                                                                                                                                            
             (SELECT TO_DATE(WK_ST_DT,'YYYYMMDD') FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fr_week])  		                                                                                                                                                                                                                                                                                                                                                
          AND	
             (SELECT TO_DATE(WK_END_DT,'YYYYMMDD') FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[to_week])                                                                                                                                                                                                                                                                                                                                               
          AND AA.VSL = BB.VSL_CD                                                                                                                                                                                                                                                                                                                                                                                                                 
          AND AA.VOY = BB.SKD_VOY_NO                                                                                                                                                                                                                                                                                                                                                                                                             
          AND AA.DIR = BB.SKD_DIR_CD                                                                                                                                                                                                                                                                                                                                                                                                             
          AND AA.FM_SEQ <= BB.CLPT_SEQ                                                                                                                                                                                                                                                                                                                                                                                                           
          AND BB.CLPT_SEQ < AA.TO_SEQ                                                                                                                                                                                                                                                                                                                                                                                                            
          AND BB.VPS_PORT_CD NOT IN ('EGSUZ','PAPAC')                                                                                                                                                                                                                                                                                                                                                                                            
          AND nvl(BB.SKD_CNG_STS_CD, 'S') <> 'S'                                                                                                                                                                                                                                                                                                                                                                                                     
          GROUP BY   AA.CO_CD 
                   , BB.VPS_PORT_CD
                   , AA.TRD 
                   , AA.VSL
                   , AA.VOY
                   , AA.DIR
                   , AA.LANE
                   , AA.STUP_FLG
                   , BB.CLPT_SEQ                                                                                                                                                                                                                                                                                                                                           
    )                                                                                                                                                                                                                                                                                                                                                                                                                                          
    GROUP BY CO_CD
             , PORT
             , RCC
             , TRD
             , VSL
             , VOY
             , DIR
             , LANE
             , STUP_FLG
             , CLPT_SEQ                                                                                                                                                                                                                                                                                                                                                                   
  ) A                                                                                                                                                                                                                                                                                                                                                                                                                                            
  , ( SELECT  VSL
             , VOY
             , DIR
             , POL
             , SUM(DEAD_SLOT) DEAD_SLOT
             , SUM(NVL(CNTR_WGT,0)) WEIGHT_TOTAL                                                                                                                                                                                                                                                                                                                                                    
      FROM ( SELECT /*+ INDEX(BK XAK4BKG_BOOKING) */ 
                    BV.VSL_CD VSL
                    , BV.SKD_VOY_NO VOY
                    , BV.SKD_DIR_CD DIR
                    , BV.POL_CD POL                                                                                                                                                                                                                                                                                                                         
          	        ,NVL(DECODE(BK.BKG_CGO_TP_CD,'F',(DECODE(BC.CNTR_TPSZ_CD,'D5',1,'R5',1,0)),                                                                                                                                                                                                                                                                                                                                                           
          	                                     'P',(DECODE(BC.CNTR_TPSZ_CD,'D5',1,'R5',1,0)),                                                                                                                                                                                                                                                                                                                                                           
          	                                         (DECODE(BC.AWK_CGO_FLG,'Y',1,0))),0) DEAD_SLOT                                                                                                                                                                                                                                                                                                                                             
          	        ,BC.CNTR_WGT CNTR_WGT                                                                                                                                                                                                                                                                                                                                                                                                                 
             FROM BKG_VVD BV, BKG_BOOKING BK, BKG_CONTAINER BC, VSK_VSL_PORT_SKD VS                                                                                                                                                                                                                                                                                                                                                            
             WHERE  VS.VPS_ETD_DT
             BETWEEN                                                                                                                                                                                                                                                                                                                                                                                                           
                   (SELECT TO_DATE(WK_ST_DT,'YYYYMMDD') FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fr_week])  		                                                                                                                                                                                                                                                                                                                                            
             AND
                   (SELECT TO_DATE(WK_END_DT,'YYYYMMDD') FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[to_week])                                                                                                                                                                                                                                                                                                                                           
             AND BV.VSL_CD     = BK.VSL_CD 								                                                                                                                                                                                                                                                                                                                                                                                          
             AND BV.SKD_VOY_NO   = BK.SKD_VOY_NO						                                                                                                                                                                                                                                                                                                                                                                                        
             AND BV.SKD_DIR_CD   = BK.SKD_DIR_CD 	                                                                                                                                                                                                                                                                                                                                                                                                  
             AND BV.POL_CD   = BK.POL_CD                                                                                                                                                                                                                                                                                                                                                                                                        
             AND BV.BKG_NO       = BK.BKG_NO 								                                                                                                                                                                                                                                                                                                                                                                                        
             AND BV.BKG_NO       = BC.BKG_NO 								                                                                                                                                                                                                                                                                                                                                                                                        
             AND BV.VSL_CD       = VS.VSL_CD 								                                                                                                                                                                                                                                                                                                                                                                                        
             AND BV.SKD_VOY_NO   = VS.SKD_VOY_NO 						                                                                                                                                                                                                                                                                                                                                                                                        
             AND BV.SKD_DIR_CD   = VS.SKD_DIR_CD                                                                                                                                                                                                                                                                                                                                                                                                    
             AND BV.SLAN_CD      = VS.SLAN_CD                                                                                                                                                                                                                                                                                                                                                                                                       
             AND BK.BKG_STS_CD IN ('F','S')                                                                                                                                                                                                                                                                                                                                                                                                         
             AND BV.POL_CD       = VS.VPS_PORT_CD
            #if (${vvd} !="")
             AND BV.VSL_CD ||BV.SKD_VOY_NO || BV.SKD_DIR_CD IN(${vvd})
            #end                                                                                                                                                                                                                                                                                                                                                                                                      
      )                                                                                                                                                                                                                                                                                                                                                                                                                                         
       GROUP BY  VSL
                , VOY
                , DIR
                , POL                                                                                                                                                                                                                                                                                                                                                                                                              
  ) B, VSK_VSL_PORT_SKD C                                                                                                                                                                                                                                                                                                                                                                                                                        
  WHERE  C.VPS_ETD_DT 
  BETWEEN                                                                                                                                                                                                                                                                                                                                                                                                                    
     (SELECT TO_DATE(WK_ST_DT,'YYYYMMDD') FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fr_week])  		                                                                                                                                                                                                                                                                                                                                                    
  AND
    	(SELECT TO_DATE(WK_END_DT,'YYYYMMDD') FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[to_week])                                                                                                                                                                                                                                                                                                                                                   
  AND A.VSL   = B.VSL(+)                                                                                                                                                                                                                                                                                                                                                                                                                         
  AND A.PORT  = B.POL(+)                                                                                                                                                                                                                                                                                                                                                                                                                         
  AND A.VSL   = C.VSL_CD                                                                                                                                                                                                                                                                                                                                                                                                                         
  AND A.PORT  = C.VPS_PORT_CD                                                                                                                                                                                                                                                                                                                                                                                                                    
  AND A.CLPT_SEQ = C.CLPT_SEQ                                                                                                                                                                                                                                                                                                                                                                                                                    
  AND C.VPS_PORT_CD NOT IN ('EGSUZ','PAPAC')                                                                                                                                                                                                                                                                                                                                                                                                     
  AND NVL(C.SKD_CNG_STS_CD, 'S') <> 'S'
  
#if (${loccd} != "")
  #if(${loctype} == "R")
  AND A.PORT IN (SELECT ECC_CD FROM EQR_ECC_MST WHERE RCC_CD IN (${loccd}))  
  #end
  #if(${loctype} == "L")
  AND A.PORT IN (SELECT ECC_CD FROM EQR_ECC_MST WHERE LCC_CD IN (${loccd}))  
  #end
  #if(${loctype} == "E")
  AND A.PORT IN (${loccd})  
  #end
#end
#if (${lane} !="")
  AND A.LANE IN(${lane})
#end 
#if (${trade} !="")
  AND A.TRD IN(${trade})
#end                                                                                                                                                                                                                                                                                                                                                                                                                
 GROUP BY  A.CO_CD
           , A.PORT
           , A.RCC
           , A.TRD
           , A.VSL
           , A.STUP_FLG
           , A.LANE
           , C.VPS_ETD_DT			]]></sql>
			<params>
				<param name="fr_week" type="12" value="" out="N"/>
				<param name="to_week" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
