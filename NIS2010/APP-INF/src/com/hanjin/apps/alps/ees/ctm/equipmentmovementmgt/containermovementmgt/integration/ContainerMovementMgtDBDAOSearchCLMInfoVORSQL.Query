<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContainerMovementMgtDBDAOSearchCLMInfoVORSQL">
			<desc><![CDATA[Ticket No : CHM-201108835-01
개발자 : 나상보
Title : bkg/mvmt vl/vd unmatch inquiry 화면 logic 추가
Description :    1.Cancel된 mt bkg 조회되지 않도록 수정

* 2011.05.24 나상보 [CHM-201110981] [CTM] Hitchment B/L의 HCMT_CMB_FLG 건 VL 처리 logic 추가]]></desc>
			<sql><![CDATA[
#if (${p_status} == 'VL')
        SELECT DISTINCT SUBSTR(CO.CNTR_NO,0,10) CNTR_NO, SUBSTR(CO.CNTR_NO, 11,1) CHECK_DIGIT, 
               CO.CNTR_TPSZ_CD, CO.CNMV_STS_CD PREV_STS_CD, @[p_yard1] || @[p_yard2] ORG_YD_CD, '' BKG_NO, 
               '' RCV_TERM_CD, @[p_date0] MVMT_EVNT_DT, @[p_status] MVMT_STS_CD, SUBSTR(@[p_vvd], 0 ,4) CRNT_VSL_CD,
               SUBSTR(@[p_vvd], 5 ,4) CRNT_SKD_VOY_NO, SUBSTR(@[p_vvd], 9,1) CRNT_SKD_DIR_CD, @[p_pol] POL_CD, 
               @[p_pod] POD_CD, @[p_date0] CNMV_EVNT_DT
                   FROM BKG_VVD BV,
                        BKG_CONTAINER BC,
                        BKG_BOOKING BO,
                        MST_CONTAINER CO,
                        BKG_VVD BV2
                  WHERE 1 = 1
        #if (${p_vvd} != '')
                    AND BV.VSL_CD = SUBSTR(@[p_vvd], 0,4)
                    AND BV.SKD_VOY_NO = SUBSTR(@[p_vvd], 5,4)
                    AND BV.SKD_DIR_CD = SUBSTR(@[p_vvd], 9,1)
        #end
        #if (${p_pol} != '')
                    AND BV.POL_CD = @[p_pol]
        #end
        #if (${p_pod} != '')
                    AND BV.POD_CD = @[p_pod]
        #end
                    AND BV.BKG_NO = BC.BKG_NO
                    AND BC.BKG_NO = BO.BKG_NO
                    AND BV2.BKG_NO(+) = BV.BKG_NO
--                    AND NVL (SUBSTR (BO.BKG_STS_CD, 0, 1), '') <> 'X'
					AND DECODE(BO.HCMT_CMB_FLG, 'Y', ' ', NVL (SUBSTR (BO.BKG_STS_CD, 0, 1), ' ')) <> 'X'
                    AND NVL (SUBSTR (BO.BKG_STS_CD, 0, 1), ' ') <> 'S'
                    AND BC.CNTR_NO = CO.CNTR_NO
                    AND ASCII (BV2.VSL_PRE_PST_CD(+)) * 10 + TO_NUMBER (BV2.VSL_SEQ(+)) <
                                ASCII (BV.VSL_PRE_PST_CD) * 10
                                + TO_NUMBER (BV.VSL_SEQ)
        #if (${p_type1} != '')
                    AND DECODE (NVL (BO.BKG_CGO_TP_CD, ' '), 'P', 'M', 'M', 'M', 'F') IN (@[p_type1])
        #end
        #if (${p_type2} != '')
                    AND DECODE (BV2.VSL_PRE_PST_CD, NULL, 'N', 'Y') IN (@[p_type2])
        #end
        MINUS
        SELECT DISTINCT SUBSTR(CT.CNTR_NO,0,10) CNTR_NO, SUBSTR(CT.CNTR_NO, 11,1) CHECK_DIGIT, CT.CNTR_TPSZ_CD, CO.CNMV_STS_CD, @[p_yard1] || @[p_yard2] ORG_YD_CD, 
               '' BKG_NO, '' BKG_RCV_TERM_CD, @[p_date0] MVMT_EVNT_DT, @[p_status] MVMT_STS_CD, SUBSTR(@[p_vvd], 0 ,4) CRNT_VSL_CD,
               SUBSTR(@[p_vvd], 5 ,4) CRNT_SKD_VOY_NO, SUBSTR(@[p_vvd], 9,1) CRNT_SKD_DIR_CD, @[p_pol] POL_CD, 
               @[p_pod] POD_CD, @[p_date0] CNMV_EVNT_DT
                   FROM CTM_MOVEMENT CT, MST_CONTAINER CO
                  WHERE 1 = 1
        #if (${p_vvd} != '')
                    AND CT.CRNT_VSL_CD = SUBSTR(@[p_vvd], 0,4)
                    AND CT.CRNT_SKD_VOY_NO = SUBSTR(@[p_vvd], 5,4)
                    AND CT.CRNT_SKD_DIR_CD = SUBSTR(@[p_vvd], 9,1)
        #end
                    AND CT.MVMT_STS_CD   = @[p_status]
        #if (${p_pol} != '')
                    AND SUBSTR (CT.ORG_YD_CD, 1, 5) = @[p_pol]
        #end
          AND CT.CNTR_NO = CO.CNTR_NO
        ORDER BY CNTR_NO
#else
	SELECT DISTINCT SUBSTR(CM.CNTR_NO,0,10) CNTR_NO, SUBSTR(CM.CNTR_NO, 11,1) CHECK_DIGIT, 
           CM.CNTR_TPSZ_CD, CO.CNMV_STS_CD PREV_STS_CD, @[p_yard1] || @[p_yard2] ORG_YD_CD, '' BKG_NO, '' RCV_TERM_CD, 
           @[p_date0] MVMT_EVNT_DT,  @[p_status] MVMT_STS_CD, SUBSTR(@[p_vvd], 0 ,4) CRNT_VSL_CD,
               SUBSTR(@[p_vvd], 5 ,4) CRNT_SKD_VOY_NO, SUBSTR(@[p_vvd], 9,1) CRNT_SKD_DIR_CD, @[p_pol] POL_CD, 
               @[p_pod] POD_CD, @[p_date0] CNMV_EVNT_DT
		   FROM BKG_VVD BV, BKG_CONTAINER BC, BKG_BOOKING BO, CTM_MOVEMENT CM, MST_CONTAINER CO
		  WHERE 1 = 1
        #if (${p_vvd} != '')
                    AND BV.VSL_CD = SUBSTR(@[p_vvd], 0,4)
                    AND BV.SKD_VOY_NO = SUBSTR(@[p_vvd], 5,4)
                    AND BV.SKD_DIR_CD = SUBSTR(@[p_vvd], 9,1)
        #end
        #if (${p_pol} != '')
                    AND BV.POL_CD = @[p_pol]
        #else
                    AND BV.POL_CD = SUBSTR (CM.ORG_YD_CD, 1, 5)
        #end
        #if (${p_pod} != '')
                    AND BV.POD_CD = @[p_pod]
        #end
		    AND BV.BKG_NO = BC.BKG_NO
		    AND BC.BKG_NO = BO.BKG_NO
		    AND NVL (BO.BKG_STS_CD, ' ') <> 'X'
		    AND NVL (BO.BKG_STS_CD, ' ') <> 'S'
		    AND BC.CNTR_NO = CM.CNTR_NO
		    AND CM.MVMT_STS_CD =  'VL'
            AND BC.CNTR_NO = CO.CNTR_NO
        #if (${p_type1} != '')
                    AND DECODE (NVL (BO.BKG_CGO_TP_CD, ' '), 'P', 'M', 'M', 'M', 'F') IN (@[p_type1])
        #end
        #if (${p_type2} != '')
                    AND DECODE (BV.VSL_PRE_PST_CD, NULL, 'N', 'Y') IN (@[p_type2])
        #end
			AND BO.POD_CD <> 'XXXXX'

	MINUS
	SELECT DISTINCT SUBSTR(CT.CNTR_NO,0,10) CNTR_NO, SUBSTR(CT.CNTR_NO, 11,1) CHECK_DIGIT, CT.CNTR_TPSZ_CD, CO.CNMV_STS_CD, @[p_yard1] || @[p_yard2] ORG_YD_CD, '' BKG_NO, '' BKG_RCV_TERM_CD, @[p_date0] MVMT_EVNT_DT, @[p_status] MVMT_STS_CD, SUBSTR(@[p_vvd], 0 ,4) CRNT_VSL_CD,
               SUBSTR(@[p_vvd], 5 ,4) CRNT_SKD_VOY_NO, SUBSTR(@[p_vvd], 9,1) CRNT_SKD_DIR_CD, @[p_pol] POL_CD, 
               @[p_pod] POD_CD, @[p_date0] MVMT_EVNT_DT
		   FROM CTM_MOVEMENT CT, MST_CONTAINER CO
		  WHERE 1 = 1
        #if (${p_vvd} != '')
                    AND CT.CRNT_VSL_CD = SUBSTR(@[p_vvd], 0,4)
                    AND CT.CRNT_SKD_VOY_NO = SUBSTR(@[p_vvd], 5,4)
                    AND CT.CRNT_SKD_DIR_CD = SUBSTR(@[p_vvd], 9,1)
        #end
                    AND CT.MVMT_STS_CD   =  @[p_status]
        #if (${p_pod} != '')
                    AND SUBSTR (CT.ORG_YD_CD, 1, 5) = @[p_pod]
        #end
          AND CT.CNTR_NO = CO.CNTR_NO
        ORDER BY CNTR_NO
#end			]]></sql>
			<params>
				<param name="p_yard1" type="12" value="" out="N"/>
				<param name="p_yard2" type="12" value="" out="N"/>
				<param name="p_date0" type="12" value="" out="N"/>
				<param name="p_status" type="12" value="" out="N"/>
				<param name="p_vvd" type="12" value="" out="N"/>
				<param name="p_pol" type="12" value="" out="N"/>
				<param name="p_pod" type="12" value="" out="N"/>
				<param name="p_type1" type="12" value="" out="N"/>
				<param name="p_type2" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
