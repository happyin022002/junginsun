<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CntrForecastManageDBDAOSearchCntrTurnTimeInfoRSQL">
			<desc><![CDATA[EQR_SCNR_ECC_TURN_TM 테이블 데이터 조회]]></desc>
			<sql><![CDATA[
SELECT     
    MAX(DECODE ( RUMM , 1 ,CO_CD)) CO_CD 						  			
	, MAX(DECODE ( RUMM , 1 ,FM_ECC_CD)) FM_ECC_CD						  
 	, MAX(DECODE ( RUMM , 1 ,TO_ECC_CD)) TO_ECC_CD  
-- project_name : 신규 장비(F5-40ft H/C Flat rack) 발주에 따른 NIS 상에 F5 등록
-- CSR No : R200903240002 - Cntr Tpsz 자동화, modified by Haeng-ji, Lee(2009.04.03)
    , ROUND(SUM(TT_RTO_DYS)/DECODE(( 	
		#foreach( ${key} in ${tpsz}) 
			#if(${key} == '02')
				DECODE(NVL(MAX(DECODE(CNTR_TPSZ_CD, '${key}', TT_RTO_DYS)),0) 
					 + NVL(MAX(DECODE(CNTR_TPSZ_CD, 'S2', TT_RTO_DYS)),0), NULL, 0, 0, 0, 1) 
			#elseif(${key} == 'O4')
				DECODE(NVL(MAX(DECODE(CNTR_TPSZ_CD, '${key}', TT_RTO_DYS)),0) 
					 + NVL(MAX(DECODE(CNTR_TPSZ_CD, 'S4', TT_RTO_DYS)),0), NULL, 0, 0, 0, 1)
			#elseif(${key} == 'F2')
				DECODE(NVL(MAX(DECODE(CNTR_TPSZ_CD, '${key}', TT_RTO_DYS)),0) 
					 + NVL(MAX(DECODE(CNTR_TPSZ_CD, 'A2', TT_RTO_DYS)),0), NULL, 0, 0, 0, 1) 
			#elseif(${key} == 'F4')
				DECODE(NVL(MAX(DECODE(CNTR_TPSZ_CD, '${key}', TT_RTO_DYS)),0) 
                	 + NVL(MAX(DECODE(CNTR_TPSZ_CD, 'A4', TT_RTO_DYS)),0) 
 					 + NVL(MAX(DECODE(CNTR_TPSZ_CD, 'F5', TT_RTO_DYS)),0), NULL, 0, 0, 0, 1) 
			#else
				DECODE(MAX(DECODE(CNTR_TPSZ_CD, '${key}', TT_RTO_DYS)), NULL, 0, 0, 0, 1) 
			#end

			#if($velocityCount < $tpsz.size() ) 
				+
			#end
		#end									  
            
		)
		, 0
		, 1
		, 
		#foreach( ${key} in ${tpsz})
			#if(${key} == '02')
				DECODE(NVL(MAX(DECODE(CNTR_TPSZ_CD, '${key}', TT_RTO_DYS)),0) 
					  + NVL(MAX(DECODE(CNTR_TPSZ_CD, 'S2', TT_RTO_DYS)),0), NULL, 0, 0, 0, 1) 
			#elseif(${key} == 'O4')
				DECODE(NVL(MAX(DECODE(CNTR_TPSZ_CD, '${key}', TT_RTO_DYS)),0) 
					 + NVL(MAX(DECODE(CNTR_TPSZ_CD, 'S4', TT_RTO_DYS)),0), NULL, 0, 0, 0, 1) 
			#elseif(${key} == 'F2')
				DECODE(NVL(MAX(DECODE(CNTR_TPSZ_CD, '${key}', TT_RTO_DYS)),0) 
					 + NVL(MAX(DECODE(CNTR_TPSZ_CD, 'A2', TT_RTO_DYS)),0), NULL, 0, 0, 0, 1) 
			#elseif(${key} == 'F4')
				DECODE(NVL(MAX(DECODE(CNTR_TPSZ_CD, '${key}', TT_RTO_DYS)),0) 
					 + NVL(MAX(DECODE(CNTR_TPSZ_CD, 'A4', TT_RTO_DYS)),0) 
					 + NVL(MAX(DECODE(CNTR_TPSZ_CD, 'F5', TT_RTO_DYS)),0), NULL, 0, 0, 0, 1) 
			#else
				DECODE(MAX(DECODE(CNTR_TPSZ_CD, '${key}', TT_RTO_DYS)), NULL, 0, 0, 0, 1) 
			#end

			#if($velocityCount < $tpsz.size() ) 
				+
			#end
		#end		
				) 
		, 2
	) AVG 
     	        
	#if(${tpsztype} != '')	
    	#foreach( ${key} in ${tpsz})
        	#if(${key} == 'O2')
				,NVL(MAX(DECODE(CNTR_TPSZ_CD, '${key}', TT_RTO_DYS )),0) 
				+ NVL(MAX(DECODE(CNTR_TPSZ_CD, 'S2', TT_RTO_DYS)),0)  ${key}TT_RTO_DYS  
			#elseif(${key} == 'O4')
				,NVL(MAX(DECODE(CNTR_TPSZ_CD, '${key}', TT_RTO_DYS )),0) 
				+ NVL(MAX(DECODE(CNTR_TPSZ_CD, 'S4', TT_RTO_DYS)),0)   ${key}TT_RTO_DYS
			#elseif(${key} == 'F2')
				,NVL(MAX(DECODE(CNTR_TPSZ_CD, '${key}', TT_RTO_DYS )),0) 
				+ NVL(MAX(DECODE(CNTR_TPSZ_CD, 'A2', TT_RTO_DYS)),0)   ${key}TT_RTO_DYS 
			#elseif(${key} == 'F4')
--		     		    	 project_name : 신규 장비(F5-40ft H/C Flat rack) 발주에 따른 NIS 상에 F5 등록  
				,NVL(MAX(DECODE(CNTR_TPSZ_CD, '${key}', TT_RTO_DYS )),0) 
				+ NVL(MAX(DECODE(CNTR_TPSZ_CD, 'F5', TT_RTO_DYS)),0) 
				+ NVL(MAX(DECODE(CNTR_TPSZ_CD, 'A4', TT_RTO_DYS)),0)   ${key}TT_RTO_DYS 
			#else
				,MAX(DECODE(CNTR_TPSZ_CD, '${key}', TT_RTO_DYS ))   ${key}TT_RTO_DYS 	
			#end
		#end    
	#end
	,IO_BND_CD   
	,SCNR_ID  
FROM                                      
    (                       							                                                    
    SELECT 										 
        A.SCNR_ID,							
        A.CO_CD,
        A.FM_ECC_CD,						
        A.TO_ECC_CD,						
        A.CNTR_TPSZ_CD,						
        A.IO_BND_CD ,						
        A.TT_RTO_DYS,	
        ROW_NUMBER() OVER (PARTITION BY CO_CD,FM_ECC_CD ,TO_ECC_CD ,IO_BND_CD ,CNTR_TPSZ_CD ORDER BY ROWNUM) RUMM	
    FROM 
        EQR_SCNR_ECC_TURN_TM  A
        , EQR_ECC_MST B	
    WHERE  
        A.SCNR_ID = @[scnrId] 	
        AND  A.FM_ECC_CD = B.ECC_CD 	
	#if (${tpsztype} != '')
	    AND A.CNTR_TPSZ_CD IN(
			#foreach( ${key} in ${tpsz})
				#if($velocityCount < $tpsz.size() ) 
					'${key}',
				#else
					'${key}'
				#end
			#end
		)
	#end
	
	#if(${location} == 'R') --LOCATION 타입이 RCC 일때 
		AND B.RCC_CD IN (
			#foreach( ${key} in ${locationArr})
				#if($velocityCount < $locationArr.size() ) 
					'${key}',
				#else
					'${key}'
				#end
			#end
	  	)
	  		
	#elseif(${location} == 'L')   	--LOCATION 타입이 LCC 일때 
		AND B.LCC_CD IN (
			#foreach( ${key} in ${locationArr})
				#if($velocityCount < $locationArr.size() ) 
					'${key}',
				#else
					'${key}'
				#end
			#end
		)
	  		
	#elseif(${location} == 'E') 	--LOCATION 타입이 ECC 일때 
		AND B.ECC_CD IN (
			#foreach( ${key} in ${locationArr})
				#if($velocityCount < $locationArr.size() ) 
					'${key}',
				#else
					'${key}'
				#end
			#end
		)
	#end
		AND A.IO_BND_CD = @[bound]
    ) C 	
GROUP BY 
    RUMM
    , FM_ECC_CD 
    , TO_ECC_CD 
    , IO_BND_CD 
    , SCNR_ID 	
	, CO_CD
ORDER by 
    FM_ECC_CD  ASC			]]></sql>
			<params>
				<param name="scnrId" type="12" value="" out="N"/>
				<param name="bound" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
