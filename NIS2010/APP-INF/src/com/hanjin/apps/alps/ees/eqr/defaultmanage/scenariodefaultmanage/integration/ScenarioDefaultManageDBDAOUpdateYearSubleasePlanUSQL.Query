<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ScenarioDefaultManageDBDAOUpdateYearSubleasePlanUSQL">
			<desc><![CDATA[eqr_sublease  테이블 데이터 수정]]></desc>
			<sql><![CDATA[
UPDATE EQR_SUBLEASE
SET CNTR_VOL_QTY = CNTR_VOL_QTY + (
    SELECT (@[rsCount]-SUM(CNTR_VOL_QTY))QTY 
    FROM EQR_SUBLEASE A 
    WHERE A.PLN_YRWK = @[yrWk]
    AND FM_ECC_CD IN (SELECT ECC_CD FROM EQR_ECC_MST WHERE RCC_CD = @[rccCd] )
)
WHERE PLN_YRWK = @[yrWk]
AND FM_ECC_CD = (
    SELECT FM_ECC_CD 
    FROM EQR_SLSE_PERF A 
    WHERE SLSE_RTO = (
        SELECT MAX(SLSE_RTO)SLSE_RTO 
        FROM EQR_SLSE_PERF
        WHERE FM_ECC_CD IN (SELECT ECC_CD FROM EQR_ECC_MST WHERE RCC_CD = @[rccCd] )
    )
)
AND TO_ECC_CD = (
    SELECT TO_ECC_CD 
    FROM EQR_SLSE_PERF A 
    WHERE SLSE_RTO = (
        SELECT MAX(SLSE_RTO)SLSE_RTO 
        FROM EQR_SLSE_PERF
        WHERE FM_ECC_CD IN (SELECT ECC_CD FROM EQR_ECC_MST WHERE RCC_CD = @[rccCd] )
    )
)
AND CNTR_TPSZ_CD = (
    SELECT CNTR_TPSZ_CD 
    FROM EQR_SLSE_PERF A 
    WHERE SLSE_RTO = (
        SELECT MAX(SLSE_RTO)SLSE_RTO 
        FROM EQR_SLSE_PERF
        WHERE FM_ECC_CD IN (SELECT ECC_CD FROM EQR_ECC_MST WHERE RCC_CD = @[rccCd] )
    )
)
AND FM_ECC_CD IN (SELECT ECC_CD FROM EQR_ECC_MST WHERE RCC_CD = @[rccCd] )			]]></sql>
			<params>
				<param name="rsCount" type="6" value="" out="N"/>
				<param name="yrWk" type="12" value="" out="N"/>
				<param name="rccCd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
