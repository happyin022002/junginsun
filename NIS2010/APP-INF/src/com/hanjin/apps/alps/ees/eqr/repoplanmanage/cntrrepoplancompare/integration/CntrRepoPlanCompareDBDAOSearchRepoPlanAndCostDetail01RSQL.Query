<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CntrRepoPlanCompareDBDAOSearchRepoPlanAndCostDetail01RSQL">
			<desc><![CDATA[PlanID 선택시]]></desc>
			<sql><![CDATA[
SELECT PLN_YRWK,
       TRSP_MOD_CD ,
       FM_ECC_CD,
       TO_ECC_CD,
       SUM(OLDPLN_TOTQTY),
       SUM(OLDPLN_TOTAMT),
       SUM(NEWPLN_TOTQTY),
       SUM(NEWPLN_TOTAMT),
       SUM(DIFFPLN_TOTQTY),
       SUM(DIFFPLN_TOTAMT),
 #foreach( ${key} in ${arrtpszcd})
	   #if($velocityCount < $arrtpszcd.size())
	    SUM(OLDPLN_QTY_${key}),                                                                      
        SUM(OLDPLN_AMT_${key}),                                                                      
        SUM(NEWPLN_QTY_${key}),                                                                      
        SUM(NEWPLN_AMT_${key}),                                                                      
        SUM(DIFFPLN_QTY_${key}),
        SUM(DIFFPLN_AMT_${key}), 
 	   #else
 	    SUM(OLDPLN_QTY_${key}),                                                                      
        SUM(OLDPLN_AMT_${key}),                                                                      
        SUM(NEWPLN_QTY_${key}),                                                                      
        SUM(NEWPLN_AMT_${key}),                                                                      
        SUM(DIFFPLN_QTY_${key}),
        SUM(DIFFPLN_AMT_${key})
       #end
 #end
FROM (
SELECT PLN_YRWK,                                                                           
       TRSP_MOD_CD, 
      #if (${fmtoat} == '1')
       (SELECT                                                
             #if (${fmtypeby} == 'R')                              
             RCC_CD                                                
             #elseif (${fmtypeby} == 'C')                          
             CNT_CD                                                
             #elseif (${fmtypeby} == 'L')                          
             LCC_CD                                                
             #elseif (${fmtypeby} == 'E' || ${fmtypeby} == '')     
             ECC_CD                                                
             #end                                                  
       FROM EQR_ECC_MST WHERE FM_ECC_CD = ECC_CD) FM_ECC_CD, 
      (SELECT                                               
             #if (${totypeby} == 'R')                              
             RCC_CD                                                
             #elseif (${totypeby} == 'C')                          
             CNT_CD                                                
             #elseif (${totypeby} == 'L')                          
             LCC_CD                                                
             #elseif (${totypeby} == 'E' || ${totypeby} == '')     
             ECC_CD                                                   
             #end                                                  
        FROM EQR_ECC_MST WHERE TO_ECC_CD = ECC_CD) TO_ECC_CD,
      #else
                                                                        
	    (SELECT                                                
             #if (${attypeby} == 'R')                              
             RCC_CD                                                
             #elseif (${attypeby} == 'C')                          
             CNT_CD                                                
             #elseif (${attypeby} == 'L')                          
             LCC_CD                                                
             #elseif (${attypeby} == 'E' || ${attypeby} == '')     
             ECC_CD                                                
             #end                                                  
       FROM EQR_ECC_MST WHERE FM_ECC_CD = ECC_CD) FM_ECC_CD, 
      (SELECT                                               
             #if (${attypeby} == 'R')                              
             RCC_CD                                                
             #elseif (${attypeby} == 'C')                          
             CNT_CD                                                
             #elseif (${attypeby} == 'L')                          
             LCC_CD                                                
             #elseif (${attypeby} == 'E' || ${attypeby} == '')     
             ECC_CD                                                   
             #end                                                  
        FROM EQR_ECC_MST WHERE TO_ECC_CD = ECC_CD) TO_ECC_CD, 
     #end
     #if (${fmtoat} == '1')   
           -- FM_TO 일때 
          #foreach( ${key} in ${arrtpszcd})
	          #if($velocityCount < $arrtpszcd.size())
	              NVL(MAX(DECODE(FLG ,'A', OLDQTY${key})),0)  + 
 	          #else
 	              NVL(MAX(DECODE(FLG ,'A', OLDQTY${key})),0)   OLDPLN_TOTQTY,
	          #end
          #end
         #foreach( ${key} in ${arrtpszcd})
	          #if($velocityCount < $arrtpszcd.size())
	              NVL(MAX(DECODE(FLG ,'A', OLDAMT${key})),0)  + 
 	          #else
 	              NVL(MAX(DECODE(FLG ,'A', OLDAMT${key})),0)   OLDPLN_TOTAMT,
	          #end
          #end
         #foreach( ${key} in ${arrtpszcd})
	          #if($velocityCount < $arrtpszcd.size())
	              NVL(MAX(DECODE(FLG ,'B', OLDQTY${key})),0)  + 
 	          #else
 	              NVL(MAX(DECODE(FLG ,'B', OLDQTY${key})),0)  NEWPLN_TOTQTY,
	          #end
          #end
          #foreach( ${key} in ${arrtpszcd})
	          #if($velocityCount < $arrtpszcd.size())
	              NVL(MAX(DECODE(FLG ,'B', OLDAMT${key})),0)  + 
 	          #else
 	              NVL(MAX(DECODE(FLG ,'B', OLDAMT${key})),0)  NEWPLN_TOTAMT,
	          #end
          #end
          #foreach( ${key} in ${arrtpszcd})
	          #if($velocityCount < $arrtpszcd.size())
	              NVL(MAX(DECODE(FLG ,'A', OLDQTY${key})),0) - NVL(MAX(DECODE(FLG ,'B', OLDQTY${key})),0)  +
 	          #else
 	              NVL(MAX(DECODE(FLG ,'A', OLDQTY${key})),0) - NVL(MAX(DECODE(FLG ,'B', OLDQTY${key})),0)  DIFFPLN_TOTQTY,
	          #end
          #end       
          #foreach( ${key} in ${arrtpszcd})
	          #if($velocityCount < $arrtpszcd.size())
	              NVL(MAX(DECODE(FLG ,'A', OLDAMT${key})),0)  - NVL(MAX(DECODE(FLG ,'B', OLDAMT${key})),0)  + 
 	          #else
 	              NVL(MAX(DECODE(FLG ,'A', OLDAMT${key})),0)  - NVL(MAX(DECODE(FLG ,'B', OLDAMT${key})),0)  DIFFPLN_TOTAMT,
	          #end
          #end
          #foreach( ${key} in ${arrtpszcd})
	          #if($velocityCount < $arrtpszcd.size())
	              MAX(DECODE(FLG ,'A', OLDQTY${key}))  OLDPLN_QTY_${key},                                                                      
                MAX(DECODE(FLG ,'A', OLDAMT${key}))  OLDPLN_AMT_${key},                                                                      
                MAX(DECODE(FLG ,'B', OLDQTY${key}))  NEWPLN_QTY_${key},                                                                      
                MAX(DECODE(FLG ,'B', OLDAMT${key}))  NEWPLN_AMT_${key},                                                                      
                NVL(MAX(DECODE(FLG ,'A', OLDQTY${key})),0) - NVL(MAX(DECODE(FLG ,'B', OLDQTY${key})),0)  DIFFPLN_QTY_${key},
                NVL(MAX(DECODE(FLG ,'A', OLDAMT${key})),0) - NVL(MAX(DECODE(FLG ,'B', OLDAMT${key})),0)  DIFFPLN_AMT_${key}, 
 	          #else
 	              MAX(DECODE(FLG ,'A', OLDQTY${key}))  OLDPLN_QTY_${key},                                                                      
                MAX(DECODE(FLG ,'A', OLDAMT${key}))  OLDPLN_AMT_${key},                                                                      
                MAX(DECODE(FLG ,'B', OLDQTY${key}))  NEWPLN_QTY_${key},                                                                      
                MAX(DECODE(FLG ,'B', OLDAMT${key}))  NEWPLN_AMT_${key},                                                                      
                NVL(MAX(DECODE(FLG ,'A', OLDQTY${key})),0) - NVL(MAX(DECODE(FLG ,'B', OLDQTY${key})),0)  DIFFPLN_QTY_${key},
                NVL(MAX(DECODE(FLG ,'A', OLDAMT${key})),0) - NVL(MAX(DECODE(FLG ,'B', OLDAMT${key})),0)  DIFFPLN_AMT_${key}
              
	          #end
          #end        
             -- FM_TO 일때 끝    
    #else
             -- AT 일때 시작
             #foreach( ${key} in ${arrtpszcd})
	            #if($velocityCount < $arrtpszcd.size())
	                NVL(MAX(DECODE(FLG ,'A', OLDQTY${key})),0)  + 
 	            #else
 	                NVL(MAX(DECODE(FLG ,'A', OLDQTY${key})),0)   OLDPLN_TOTQTY,
	            #end
            #end
           #foreach( ${key} in ${arrtpszcd})
	            #if($velocityCount < $arrtpszcd.size())
	                NVL(MAX(DECODE(FLG ,'A', OLDAMT${key})),0)  + 
 	            #else
 	                NVL(MAX(DECODE(FLG ,'A', OLDAMT${key})),0)   OLDPLN_TOTAMT,
	            #end
            #end
           #foreach( ${key} in ${arrtpszcd})
	            #if($velocityCount < $arrtpszcd.size())
	                NVL(MAX(DECODE(FLG ,'B', OLDQTY${key})),0)  + 
 	            #else
 	                NVL(MAX(DECODE(FLG ,'B', OLDQTY${key})),0)  NEWPLN_TOTQTY,
	            #end
            #end
            #foreach( ${key} in ${arrtpszcd})
	            #if($velocityCount < $arrtpszcd.size())
	                NVL(MAX(DECODE(FLG ,'B', OLDAMT${key})),0)  + 
 	            #else
 	                NVL(MAX(DECODE(FLG ,'B', OLDAMT${key})),0)  NEWPLN_TOTAMT,
	            #end
            #end
            #foreach( ${key} in ${arrtpszcd})
	            #if($velocityCount < $arrtpszcd.size())
	                NVL(MAX(DECODE(FLG ,'A', OLDQTY${key})),0) - NVL(MAX(DECODE(FLG ,'B', OLDQTY${key})),0)  +
 	            #else
 	                NVL(MAX(DECODE(FLG ,'A', OLDQTY${key})),0) - NVL(MAX(DECODE(FLG ,'B', OLDQTY${key})),0)  DIFFPLN_TOTQTY,
	            #end
            #end       
            #foreach( ${key} in ${arrtpszcd})
	            #if($velocityCount < $arrtpszcd.size())
	                NVL(MAX(DECODE(FLG ,'A', OLDAMT${key})),0)  - NVL(MAX(DECODE(FLG ,'B', OLDAMT${key})),0)  + 
 	            #else
 	                NVL(MAX(DECODE(FLG ,'A', OLDAMT${key})),0)  - NVL(MAX(DECODE(FLG ,'B', OLDAMT${key})),0)  DIFFPLN_TOTAMT,
	            #end
            #end
            #foreach( ${key} in ${arrtpszcd})
	            #if($velocityCount < $arrtpszcd.size())
	                MAX(DECODE(FLG ,'A', OLDQTY${key}))  OLDPLN_QTY_${key},                                                                      
                  MAX(DECODE(FLG ,'A', OLDAMT${key}))  OLDPLN_AMT_${key},                                                                      
                  MAX(DECODE(FLG ,'B', OLDQTY${key}))  NEWPLN_QTY_${key},                                                                      
                  MAX(DECODE(FLG ,'B', OLDAMT${key}))  NEWPLN_AMT_${key},                                                                      
                  NVL(MAX(DECODE(FLG ,'A', OLDQTY${key})),0) - NVL(MAX(DECODE(FLG ,'B', OLDQTY${key})),0)  DIFFPLN_QTY_${key},
                  NVL(MAX(DECODE(FLG ,'A', OLDAMT${key})),0) - NVL(MAX(DECODE(FLG ,'B', OLDAMT${key})),0)  DIFFPLN_AMT_${key}, 
 	            #else
 	                MAX(DECODE(FLG ,'A', OLDQTY${key}))  OLDPLN_QTY_${key},                                                                      
                  MAX(DECODE(FLG ,'A', OLDAMT${key}))  OLDPLN_AMT_${key},                                                                      
                  MAX(DECODE(FLG ,'B', OLDQTY${key}))  NEWPLN_QTY_${key},                                                                      
                  MAX(DECODE(FLG ,'B', OLDAMT${key}))  NEWPLN_AMT_${key},                                                                      
                  NVL(MAX(DECODE(FLG ,'A', OLDQTY${key})),0) - NVL(MAX(DECODE(FLG ,'B', OLDQTY${key})),0)  DIFFPLN_QTY_${key},
                  NVL(MAX(DECODE(FLG ,'A', OLDAMT${key})),0) - NVL(MAX(DECODE(FLG ,'B', OLDAMT${key})),0)  DIFFPLN_AMT_${key}
                
	            #end
            #end
       #end  
 FROM                                                            
     (                                                           
        SELECT REPO_PLN_ID,                                     
		           PLN_YRWK,                                         
				       TRSP_MOD_CD,                                      
				       FM_ECC_CD,		                                  
               TO_ECC_CD,
         #if (${fmtoat} == '1')
            #foreach( ${key} in ${arrtpszcd})
              SUM(DECODE(CNTR_TPSZ_CD , '${key}', QTY )) OLDQTY${key},
              SUM(DECODE(CNTR_TPSZ_CD , '${key}', AMT )) OLDAMT${key},
            #end
         #else        
            #foreach( ${key} in ${arrtpszcd})
              MAX(DECODE(CNTR_TPSZ_CD , '${key}', QTY )) OLDQTY${key},
              MAX(DECODE(CNTR_TPSZ_CD , '${key}', AMT )) OLDAMT${key},
            #end
         #end                                        
				'A' FLG                                                                     
		 FROM(		                                                                        
		        ----------------------	EQR_VSL_LODG_DCHG_PLN   --------------------------	
            SELECT PLN.REPO_PLN_ID,                                                   
					       PLN.PLN_YRWK ,                                                     
                 TRSP_MOD_CD ,                                                  
                 FM_ECC_CD ,                                                    
                 TO_ECC_CD ,                                                    
                 QTY.CNTR_TPSZ_CD ,                                                 
                 QTY.CNTR_QTY QTY ,                                                 
                 QTY.LODG_DCHG_COST_AMT  AMT                                        
          FROM EQR_VSL_LODG_DCHG_PLN PLN 
              ,EQR_VSL_LODG_DCHG_PLN_QTY QTY 
          #if (${fmtoat} == '1')                                     
              ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                  #if (${fmecccd} != '')                                                       
                       #if (${fmtype} == 'R')             
                             AND RCC_CD IN (${arrfmecccd}) 
                       #end                               
                        #if (${fmtype} == 'L')             
                             AND LCC_CD IN (${arrfmecccd}) 
                       #end                               
                        #if (${fmtype} == 'E')             
                             AND ECC_CD IN (${arrfmecccd}) 
                       #end                               
                  #end                                     
               ) c
              , (SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1 
                   #if (${toecccd} != '') 
                        #if (${totype} == 'R')
                             AND RCC_CD IN (${arrtoecccd}) 
                			  #end
                        #if (${totype} == 'L')
                             AND LCC_CD IN (${arrtoecccd})
                			  #end
                        #if (${totype} == 'E')
                             AND ECC_CD IN (${arrtoecccd})
                			  #end
                	 #end
               ) d 
          #else
            , ( SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
		               #if (${atecccd} != '') 
                        #if (${attype} == 'R')
                             AND RCC_CD IN (${arratecccd}) 
			                  #end
                        #if (${attype} == 'L')
                             AND LCC_CD IN (${arratecccd})
			                  #end
                        #if (${attype} == 'E')
                             AND ECC_CD IN (${arratecccd})
			                  #end
		               #end
               ) c
          #end                                            
          WHERE PLN.REPO_PLN_ID = @[repo_pln_id]                                                
	        #if (${fmtoat} == '1')                                   
          AND FM_ECC_CD = C.ECC_CD AND TO_ECC_CD = D.ECC_CD
          #else
          AND (FM_ECC_CD = C.ECC_CD OR TO_ECC_CD = C.ECC_CD) 
          #end 
          #if(${item} != '') 
          AND PLN.TRSP_MOD_CD IN (${arritem})
          #end
          #if(${lane} != '')
				  AND PLN.VSL_LANE_CD IN (${arrlane})
				  #end
				   #if(${vvd} != '')
				  AND PLN.VSL_CD||SKD_VOY_NO||SKD_DIR_CD IN(${arrvvd})
				  #end  
          #if (${fmtoat} == '1')
            #if(${fmplnwk} !='')
                AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN                                  
                  (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fm_yrwk]  )             
                  AND                                                                        
                  (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[to_yrwk]  )
            #end
            #if(${fmtoplnwk} != '')             
                  AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN                                  
                    (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fm_to_yrwk]   )             
                    AND                                                                        
                    (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[to_to_yrwk]  )
            #end
          #else
          AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN                                  
            (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[at_fm_yrwk]  )             
            AND                                                                        
            (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[at_to_yrwk]  )             
          AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN                                  
            (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[at_fm_yrwk]   )             
            AND                                                                        
            (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[at_to_yrwk]  )
          #end
          #if(${arroddtpsz} !='')                                           
          AND CNTR_TPSZ_CD IN(${arroddtpsz})
          #end  
          AND PLN.REPO_PLN_ID = QTY.REPO_PLN_ID
          AND PLN.PLN_YRWK  = QTY.PLN_YRWK
          AND PLN.PLN_SEQ   = QTY.PLN_SEQ                                                
   	UNION ALL                                                                                   
					----------------------	EQR_INLND_TRSP_PLN   --------------------------		                
					SELECT PLN.REPO_PLN_ID,                                                                       
                 PLN.PLN_YRWK,                                                                           
                 TRSP_MOD_CD,                                                                        
                 FM_ECC_CD,                                                                          
                 TO_ECC_CD,                                                                          
                 CNTR_TPSZ_CD,                                                                       
                 CNTR_QTY  QTY,                                                                      
                 TRSP_COST_AMT AMT		                                                            
          FROM   EQR_INLND_TRSP_PLN  PLN
                ,EQR_INLND_TRSP_PLN_QTY  QTY
          #if (${fmtoat} == '1')                                     
              ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                  #if (${fmecccd} != '')                                                       
                       #if (${fmtype} == 'R')             
                             AND RCC_CD IN (${arrfmecccd}) 
                       #end                               
                        #if (${fmtype} == 'L')             
                             AND LCC_CD IN (${arrfmecccd}) 
                       #end                               
                        #if (${fmtype} == 'E')             
                             AND ECC_CD IN (${arrfmecccd}) 
                       #end                               
                  #end                                     
               ) c
              , (SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1 
                   #if (${toecccd} != '') 
                        #if (${totype} == 'R')
                             AND RCC_CD IN (${arrtoecccd}) 
                			  #end
                        #if (${totype} == 'L')
                             AND LCC_CD IN (${arrtoecccd})
                			  #end
                        #if (${totype} == 'E')
                             AND ECC_CD IN (${arrtoecccd})
                			  #end
                	 #end
               ) d 
          #else
            , ( SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
		               #if (${atecccd} != '') 
                        	#if (${attype} == 'R')
                             AND RCC_CD IN (${arratecccd}) 
			                  #end
                        	 #if (${attype} == 'L')
                             AND LCC_CD IN (${arratecccd})
			                  #end
                        #if (${attype} == 'E')
                             AND ECC_CD IN (${arratecccd})
			                  #end
		               #end
               ) c
          #end                                            
	        WHERE  PLN.REPO_PLN_ID = @[repo_pln_id]		                                                                
          #if (${fmtoat} == '1')                                                                                  
          AND FM_ECC_CD = C.ECC_CD AND TO_ECC_CD = D.ECC_CD
          #else
          AND (FM_ECC_CD = C.ECC_CD OR TO_ECC_CD = C.ECC_CD) 
          #end
          #if(${item} != '') 
          AND PLN.TRSP_MOD_CD IN (${arritem})
          #end
          #if (${fmtoat} == '1')
            #if(${fmplnwk} !='')  
                AND PLN.PLN_YRWK BETWEEN @[fm_yrwk] AND @[to_yrwk]
            #end
            #if(${fmtoplnwk} != '')	                                                    
                AND PLN.TO_YRWK  BETWEEN @[fm_to_yrwk] AND @[to_to_yrwk]
            #end
          #else
          AND PLN.PLN_YRWK BETWEEN @[at_fm_yrwk] AND @[at_to_yrwk]
          AND PLN.TO_YRWK  BETWEEN @[at_fm_yrwk] AND @[at_to_yrwk]
          #end
          #if(${arroddtpsz} !='')                                           
          AND CNTR_TPSZ_CD IN(${arroddtpsz})
          #end                                                       
          AND PLN.REPO_PLN_ID = QTY.REPO_PLN_ID
          AND PLN.PLN_YRWK   = QTY.PLN_YRWK
          AND PLN.PLN_SEQ    = QTY.PLN_SEQ  
					                                                                                          
    UNION ALL                                                                                    
			SELECT PLN.REPO_PLN_ID,                                                                       
                 PLN.PLN_YRWK,                                                                          
						     ONF_HIR_DIV_CD,		                                                               
                 DECODE(ONF_HIR_DIV_CD ,'F', PLN.ECC_CD) FM_ECC_CD,                                 
                 DECODE(ONF_HIR_DIV_CD ,'O', PLN.ECC_CD) TO_ECC_CD,                                 
                 QTY.CNTR_TPSZ_CD,		                                                               
                 QTY.CNTR_QTY QTY,			                                                           
                 QTY.ONF_HIR_COST_AMT AMT                                                               
          FROM   EQR_ONF_HIR_PLN	 PLN
                ,EQR_ONF_HIR_PLN_QTY QTY
          #if (${fmtoat} == '1')                                                    
                , ( SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1 
             		     #if (${fmecccd} != '')                       
                           #if (${fmtype} == 'R')                  
                                AND RCC_CD IN (${arrfmecccd},${arrtoecccd})      
             			         #end                                   
                           #if (${fmtype} == 'L')                  
                                AND LCC_CD IN (${arrfmecccd},${arrtoecccd})      
             			         #end                                   
                           #if (${fmtype} == 'E')                  
                                AND ECC_CD IN (${arrfmecccd},${arrtoecccd})      
             			         #end                                   
             		      #end                                         
                   ) C   
          --     , ( SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1 
          --   		     #if ( ${toecccd} != '')                       
          --                 #if (${totype} == 'R')                  
          --                      AND RCC_CD IN ( ${arrtoecccd})      
          --   			         #end                                   
          --                 #if (${totype} == 'L')                  
          --                      AND LCC_CD IN ( ${arrtoecccd})      
          --   			         #end                                   
          --                 #if (${totype} == 'E')                  
          --                      AND ECC_CD IN ( ${arrtoecccd})      
          --   			         #end                                   
          --   		      #end                                         
          --         ) D                                            
          #else                                               
                 , ( SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1 
             		     #if (${atecccd} != '')                       
                          #if (${attype} == 'R')                  
                               AND RCC_CD IN (${arratecccd})      
             			        #end                                   
                          #if (${attype} == 'L')                  
                               AND LCC_CD IN (${arratecccd})      
             			        #end                                   
                          #if (${attype} == 'E')                  
                               AND ECC_CD IN (${arratecccd})      
             			        #end                                    
             		     #end                                          
                  ) c                                            
         #end                                                
         WHERE  PLN.REPO_PLN_ID = @[repo_pln_id]		                                                           
         #if (${fmtoat} == '1')                                                                               
	       AND PLN.ECC_CD = C.ECC_CD AND PLN.ECC_CD = C.ECC_CD
	       #else
	       AND (PLN.ECC_CD = C.ECC_CD OR PLN.ECC_CD = C.ECC_CD)
	       #end
	       #if(${item} != '') 
          AND PLN.ONF_HIR_DIV_CD IN (${arritem})
         #end 
         #if (${fmtoat} == '1')
	       AND PLN.PLN_YRWK BETWEEN @[fm_yrwk] AND  @[to_yrwk]	                                                           
	       #else
	       AND PLN.PLN_YRWK BETWEEN @[at_fm_yrwk] AND @[at_to_yrwk]
	       #end
	       #if(${arroddtpsz} !='')                                           
         AND CNTR_TPSZ_CD IN(${arroddtpsz})
         #end
         AND PLN.REPO_PLN_ID =  QTY.REPO_PLN_ID
         AND PLN.PLN_YRWK    =  QTY.PLN_YRWK
         AND PLN.PLN_SEQ     =  QTY.PLN_SEQ                                      
				)                                                                                              
     GROUP BY REPO_PLN_ID , PLN_YRWK, TRSP_MOD_CD , FM_ECC_CD ,TO_ECC_CD	
  UNION ALL                                                                                               
	                                                                                                         
	     SELECT REPO_PLN_ID,                                     
		          PLN_YRWK,                                        
				      TRSP_MOD_CD,                                     
				      FM_ECC_CD,		                                 
              TO_ECC_CD,                                       
				 #if (${fmtoat} == '1')
                 #if (${arrtpszcd} !='')
                   #foreach( ${key} in ${arrtpszcd})
               	    SUM(DECODE(CNTR_TPSZ_CD , '${key}', QTY )) OLDQTY${key},
                    SUM(DECODE(CNTR_TPSZ_CD , '${key}', AMT )) OLDAMT${key},
               	   #end
                 #end 
	       #else
	              #if (${arrtpszcd} !='')
                   #foreach( ${key} in ${arrtpszcd})
               	    MAX(DECODE(CNTR_TPSZ_CD , '${key}', QTY )) OLDQTY${key},
                    MAX(DECODE(CNTR_TPSZ_CD , '${key}', AMT )) OLDAMT${key},
                   #end
                 #end
	       #end 
				'B' FLG                                                                             
		 FROM(		                                                                                
		        ----------------------	EQR_VSL_LODG_DCHG_PLN   --------------------------	        
            SELECT PLN.REPO_PLN_ID,                                                   
					       PLN.PLN_YRWK ,                                                     
                 TRSP_MOD_CD ,                                                  
                 FM_ECC_CD ,                                                    
                 TO_ECC_CD ,                                                    
                 QTY.CNTR_TPSZ_CD ,                                                 
                 QTY.CNTR_QTY QTY ,                                                 
                 QTY.LODG_DCHG_COST_AMT  AMT                                        
          FROM EQR_VSL_LODG_DCHG_PLN PLN 
              ,EQR_VSL_LODG_DCHG_PLN_QTY QTY 
          #if (${fmtoat} == '1')                                     
              ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                  #if (${fmecccd} != '')                                                       
                       #if (${fmtype} == 'R')             
                             AND RCC_CD IN (${arrfmecccd}) 
                       #end                               
                        #if (${fmtype} == 'L')             
                             AND LCC_CD IN (${arrfmecccd}) 
                       #end                               
                        #if (${fmtype} == 'E')             
                             AND ECC_CD IN (${arrfmecccd}) 
                       #end                               
                  #end                                     
               ) c
              , (SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1 
                   #if (${toecccd} != '') 
                        #if (${totype} == 'R')
                             AND RCC_CD IN (${arrtoecccd}) 
                			  #end
                        #if (${totype} == 'L')
                             AND LCC_CD IN (${arrtoecccd})
                			  #end
                        #if (${totype} == 'E')
                             AND ECC_CD IN (${arrtoecccd})
                			  #end
                	 #end
               ) d 
          #else
            , ( SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
		               #if (${atecccd} != '') 
                        #if (${attype} == 'R')
                             AND RCC_CD IN (${arratecccd}) 
			                  #end
                        #if (${attype} == 'L')
                             AND LCC_CD IN (${arratecccd})
			                  #end
                        #if (${attype} == 'E')
                             AND ECC_CD IN (${arratecccd})
			                  #end
		               #end
               ) c
          #end                                            
          WHERE PLN.REPO_PLN_ID = @[plan_id]                                                
	        #if (${fmtoat} == '1')                                   
          AND FM_ECC_CD = C.ECC_CD AND TO_ECC_CD = D.ECC_CD
          #else
          AND (FM_ECC_CD = C.ECC_CD OR TO_ECC_CD = C.ECC_CD) 
          #end 
          #if(${item} != '') 
          AND PLN.TRSP_MOD_CD IN (${arritem})
          #end
          #if(${lane} != '')
				  AND PLN.VSL_LANE_CD IN (${arrlane})
				  #end
				   #if(${vvd} != '')
				  AND PLN.VSL_CD||SKD_VOY_NO||SKD_DIR_CD IN(${arrvvd})
				  #end  
          #if (${fmtoat} == '1')
            #if(${fmplnwk} !='')
                AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN                                  
                  (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fm_yrwk]  )             
                  AND                                                                        
                  (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[to_yrwk]  )
            #end
            #if(${fmtoplnwk} != '')             
                  AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN                                  
                    (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fm_to_yrwk]   )             
                    AND                                                                        
                    (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[to_to_yrwk]  )
            #end
          #else
          AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN                                  
            (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[at_fm_yrwk]  )             
            AND                                                                        
            (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[at_to_yrwk]  )             
          AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN                                  
            (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[at_fm_yrwk]   )             
            AND                                                                        
            (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[at_to_yrwk]  )
          #end
          #if(${arroddtpsz} !='')                                           
          AND CNTR_TPSZ_CD IN(${arroddtpsz})
          #end  
          AND PLN.REPO_PLN_ID = QTY.REPO_PLN_ID
          AND PLN.PLN_YRWK  = QTY.PLN_YRWK
          AND PLN.PLN_SEQ   = QTY.PLN_SEQ                                                
                                            
    UNION ALL                                                                       
					----------------------	EQR_INLND_TRSP_PLN   --------------------------	
							SELECT PLN.REPO_PLN_ID,                                                                       
                 PLN.PLN_YRWK,                                                                           
                 TRSP_MOD_CD,                                                                        
                 FM_ECC_CD,                                                                          
                 TO_ECC_CD,                                                                          
                 CNTR_TPSZ_CD,                                                                       
                 CNTR_QTY  QTY,                                                                      
                 TRSP_COST_AMT AMT		                                                            
          FROM   EQR_INLND_TRSP_PLN  PLN
                ,EQR_INLND_TRSP_PLN_QTY  QTY
          #if (${fmtoat} == '1')                                     
              ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                  #if (${fmecccd} != '')                                                       
                       #if (${fmtype} == 'R')             
                             AND RCC_CD IN (${arrfmecccd}) 
                       #end                               
                        #if (${fmtype} == 'L')             
                             AND LCC_CD IN (${arrfmecccd}) 
                       #end                               
                        #if (${fmtype} == 'E')             
                             AND ECC_CD IN (${arrfmecccd}) 
                       #end                               
                  #end                                     
               ) c
              , (SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1 
                   #if (${toecccd} != '') 
                        #if (${totype} == 'R')
                             AND RCC_CD IN (${arrtoecccd}) 
                			  #end
                        #if (${totype} == 'L')
                             AND LCC_CD IN (${arrtoecccd})
                			  #end
                        #if (${totype} == 'E')
                             AND ECC_CD IN (${arrtoecccd})
                			  #end
                	 #end
               ) d 
          #else
            , ( SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
		               #if (${atecccd} != '') 
                        	#if (${attype} == 'R')
                             AND RCC_CD IN (${arratecccd}) 
			                  #end
                        	 #if (${attype} == 'L')
                             AND LCC_CD IN (${arratecccd})
			                  #end
                        #if (${attype} == 'E')
                             AND ECC_CD IN (${arratecccd})
			                  #end
		               #end
               ) c
          #end                                            
	        WHERE  PLN.REPO_PLN_ID = @[plan_id]		                                                                
          #if (${fmtoat} == '1')                                                                                  
          AND FM_ECC_CD = C.ECC_CD AND TO_ECC_CD = D.ECC_CD
          #else
          AND (FM_ECC_CD = C.ECC_CD OR TO_ECC_CD = C.ECC_CD) 
          #end
          #if(${item} != '') 
          AND PLN.TRSP_MOD_CD IN (${arritem})
          #end
          #if (${fmtoat} == '1')
            #if(${fmplnwk} !='')  
                AND PLN.PLN_YRWK BETWEEN @[fm_yrwk] AND @[to_yrwk]
            #end
            #if(${fmtoplnwk} != '')	                                                    
                AND PLN.TO_YRWK  BETWEEN @[fm_to_yrwk] AND @[to_to_yrwk]
            #end
          #else
          AND PLN.PLN_YRWK BETWEEN @[at_fm_yrwk] AND @[at_to_yrwk]
          AND PLN.TO_YRWK  BETWEEN @[at_fm_yrwk] AND @[at_to_yrwk]
          #end
          #if(${arroddtpsz} !='')                                           
          AND CNTR_TPSZ_CD IN(${arroddtpsz})
          #end                                                       
          AND PLN.REPO_PLN_ID = QTY.REPO_PLN_ID
          AND PLN.PLN_YRWK   = QTY.PLN_YRWK
          AND PLN.PLN_SEQ    = QTY.PLN_SEQ 	    
	UNION ALL 
	        		SELECT PLN.REPO_PLN_ID,                                                                       
                 PLN.PLN_YRWK,                                                                          
						     ONF_HIR_DIV_CD,		                                                               
                 DECODE(ONF_HIR_DIV_CD ,'F', PLN.ECC_CD) FM_ECC_CD,                                 
                 DECODE(ONF_HIR_DIV_CD ,'O', PLN.ECC_CD) TO_ECC_CD,                                 
                 QTY.CNTR_TPSZ_CD,		                                                               
                 QTY.CNTR_QTY QTY,			                                                           
                 QTY.ONF_HIR_COST_AMT AMT                                                               
          FROM   EQR_ONF_HIR_PLN	 PLN
                ,EQR_ONF_HIR_PLN_QTY QTY
          #if (${fmtoat} == '1')                                                    
                , ( SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1 
             		     #if (${fmecccd} != '')                       
                           #if (${fmtype} == 'R')                  
                                AND RCC_CD IN (${arrfmecccd},${arrtoecccd})      
             			         #end                                   
                           #if (${fmtype} == 'L')                  
                                AND LCC_CD IN (${arrfmecccd},${arrtoecccd})      
             			         #end                                   
                           #if (${fmtype} == 'E')                  
                                AND ECC_CD IN (${arrfmecccd},${arrtoecccd})      
             			         #end                                   
             		      #end                                         
                   ) C   
            --   , ( SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1 
            -- 		     #if ( ${toecccd} != '')                       
             --              #if (${totype} == 'R')                  
             --                   AND RCC_CD IN ( ${arrtoecccd})      
             --			         #end                                   
             --              #if (${totype} == 'L')                  
             --                   AND LCC_CD IN ( ${arrtoecccd})      
             --			         #end                                   
             --              #if (${totype} == 'E')                  
              --                  AND ECC_CD IN ( ${arrtoecccd})      
             --			         #end                                   
             --		      #end                                         
              --     ) D                                            
          #else                                               
                 , ( SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1 
             		     #if (${atecccd} != '')                       
                          #if (${attype} == 'R')                  
                               AND RCC_CD IN (${arratecccd})      
             			        #end                                   
                          #if (${attype} == 'L')                  
                               AND LCC_CD IN (${arratecccd})      
             			        #end                                   
                          #if (${attype} == 'E')                  
                               AND ECC_CD IN (${arratecccd})      
             			        #end                                    
             		     #end                                          
                  ) c                                            
         #end                                                
         WHERE  PLN.REPO_PLN_ID = @[plan_id]		                                                           
         #if (${fmtoat} == '1')                                                                               
	       AND PLN.ECC_CD = C.ECC_CD AND PLN.ECC_CD = C.ECC_CD
	       #else
	       AND (PLN.ECC_CD = C.ECC_CD OR PLN.ECC_CD = C.ECC_CD)
	       #end
	       #if(${item} != '') 
          AND PLN.ONF_HIR_DIV_CD IN (${arritem})
         #end 
         #if (${fmtoat} == '1')
	       AND PLN.PLN_YRWK BETWEEN @[fm_yrwk] AND  @[to_yrwk]	                                                           
	       #else
	       AND PLN.PLN_YRWK BETWEEN @[at_fm_yrwk] AND @[at_to_yrwk]
	       #end
	       #if(${arroddtpsz} !='')                                           
         AND CNTR_TPSZ_CD IN(${arroddtpsz})
         #end
         AND PLN.REPO_PLN_ID =  QTY.REPO_PLN_ID
         AND PLN.PLN_YRWK    =  QTY.PLN_YRWK
         AND PLN.PLN_SEQ     =  QTY.PLN_SEQ                                      
				)                                                                                   
			GROUP BY REPO_PLN_ID , PLN_YRWK, TRSP_MOD_CD , FM_ECC_CD ,TO_ECC_CD	                    
	                                                                                               
	 )                                                                                              
	 GROUP BY PLN_YRWK ,TRSP_MOD_CD ,FM_ECC_CD ,TO_ECC_CD                                            
	 ORDER BY PLN_YRWK ,TRSP_MOD_CD ,FM_ECC_CD ,TO_ECC_CD ASC
)
     GROUP BY PLN_YRWK,TRSP_MOD_CD ,FM_ECC_CD ,TO_ECC_CD                                                         
	 ORDER BY PLN_YRWK ,TRSP_MOD_CD ,FM_ECC_CD ,TO_ECC_CD  ASC			]]></sql>
			<params>
				<param name="repo_pln_id" type="12" value="" out="N"/>
				<param name="fm_yrwk" type="12" value="" out="N"/>
				<param name="to_yrwk" type="12" value="" out="N"/>
				<param name="fm_to_yrwk" type="12" value="" out="N"/>
				<param name="to_to_yrwk" type="12" value="" out="N"/>
				<param name="at_fm_yrwk" type="12" value="" out="N"/>
				<param name="at_to_yrwk" type="12" value="" out="N"/>
				<param name="plan_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
