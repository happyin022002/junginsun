<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceIssueCollectionMgtDBDAOSearchManualInvoiceChargeDataRSQL">
			<desc><![CDATA[Charge 정보를 조회하는 쿼리]]></desc>
			<sql><![CDATA[
SELECT	T1.BKG_NO
        , T1.SYS_AREA_GRP_ID
        , T1.CNTR_NO
        , T1.CNTR_CYC_NO
        , T1.CNTR_TPSZ_CD
        , T1.SC_NO
        , TO_CHAR(T2.FM_MVMT_DT, 'YYYY-MM-DD') AS FM_MVMT_DT
        , TO_CHAR(T2.TO_MVMT_DT, 'YYYY-MM-DD') AS TO_MVMT_DT
        , TO_CHAR(DECODE(NVL(T2.FT_CMNC_DT, ''), '', T2.FM_MVMT_DT, T2.FT_CMNC_DT), 'YYYY-MM-DD') AS FT_CMNC_DT
        , TO_CHAR(T2.FT_END_DT, 'YYYY-MM-DD') AS FT_END_DT
        , T2.FT_DYS
        , T2.BZC_TRF_CURR_CD
        , T2.VNDR_SEQ
        , T3.VNDR_LGL_ENG_NM AS VNDR_NM
        , T2.ACT_CNT_CD || LPAD(T2.ACT_CUST_SEQ, 6, '0') AS ACT_PAYR_CUST_CD
        ,
        (
        SELECT  B.CUST_LGL_ENG_NM
        FROM    DMT_CHG_CALC    A, 
                MDM_CUSTOMER    B
        WHERE   SYS_AREA_GRP_ID         = T2.SYS_AREA_GRP_ID
        AND     A.CNTR_NO               = T2.CNTR_NO
        AND     A.CNTR_CYC_NO           = T2.CNTR_CYC_NO
        AND     A.DMDT_TRF_CD           = T2.DMDT_TRF_CD
        AND     A.DMDT_CHG_LOC_DIV_CD   = T2.DMDT_CHG_LOC_DIV_CD
        AND     A.CHG_SEQ               = T2.CHG_SEQ
        AND     A.ACT_CNT_CD            = B.CUST_CNT_CD
        AND     A.ACT_CUST_SEQ          = B.CUST_SEQ
        ) AS ACT_PAYR_CUST_NM
        ,
        (
        SELECT B.VNDR_LGL_ENG_NM
        FROM   DMT_CHG_CALC A, MDM_VENDOR B
        WHERE  SYS_AREA_GRP_ID         = T2.SYS_AREA_GRP_ID
        AND    A.CNTR_NO               = T2.CNTR_NO
        AND    A.CNTR_CYC_NO           = T2.CNTR_CYC_NO
        AND    A.DMDT_TRF_CD           = T2.DMDT_TRF_CD
        AND    A.DMDT_CHG_LOC_DIV_CD   = T2.DMDT_CHG_LOC_DIV_CD
        AND    A.CHG_SEQ               = T2.CHG_SEQ
        AND    A.ACT_CUST_SEQ          = B.VNDR_SEQ
        AND    A.ACT_CNT_CD            = B.VNDR_CNT_CD
        )                                       AS ACT_PAYR_VNDR_NM
        , T2.DMDT_TRF_APLY_TP_CD 
        , T2.OFC_TRNS_FLG
        , T2.DMDT_TRF_CD
        , T2.DMDT_CHG_LOC_DIV_CD
        , T2.CHG_SEQ
        , T2.BZC_TRF_SEQ
        , NVL(T2.BZC_DMDT_DE_TERM_CD, 'N')        AS BZC_DMDT_DE_TERM_CD
        , T2.BZC_TRF_GRP_SEQ
        , T2.FX_FT_OVR_DYS
        , T2.ORG_FT_OVR_DYS
        , T2.RFA_EXPT_DAR_NO
        , T2.RFA_EXPT_MAPG_SEQ
        , T2.RFA_EXPT_VER_SEQ
        , T2.RFA_RQST_DTL_SEQ
        , T2.SC_EXPT_VER_SEQ
        , T2.SC_EXPT_GRP_SEQ
        , T2.FM_MVMT_YD_CD
        , TO_CHAR(T2.BZC_TRF_APLY_DT    , 'YYYY-MM-DD')    AS BZC_TRF_APLY_DT
        , TO_CHAR(T2.SC_RFA_EXPT_APLY_DT, 'YYYY-MM-DD')    AS SC_RFA_EXPT_APLY_DT
FROM	DMT_CHG_BKG_CNTR T1,
	    DMT_CHG_CALC     T2,
	    MDM_VENDOR       T3
WHERE   1=1
AND     T1.BKG_NO          = @[BKG_NO]
AND     T1.SYS_AREA_GRP_ID =
        (
	    SELECT  SYS_AREA_GRP_ID
	    FROM    COM_SYS_AREA_GRP_ID
	    WHERE   CNT_CD = 
			(
			CASE 
			WHEN SUBSTR(@[DMDT_TRF_CD], 2, 1) = 'M' AND SUBSTR(@[DMDT_TRF_CD], 3, 1) = 'I' THEN
                 SUBSTR(T1.POD_CD, 0, 2)
			WHEN SUBSTR(@[DMDT_TRF_CD], 2, 1) = 'M' AND SUBSTR(@[DMDT_TRF_CD], 3, 1) = 'O' THEN
                 SUBSTR(T1.POL_CD, 0, 2)
			WHEN SUBSTR(@[DMDT_TRF_CD], 2, 1) = 'T' AND SUBSTR(@[DMDT_TRF_CD], 3, 1) = 'I' THEN
                 SUBSTR(T1.DEL_CD, 0, 2)
			WHEN SUBSTR(@[DMDT_TRF_CD], 2, 1) = 'T' AND SUBSTR(@[DMDT_TRF_CD], 3, 1) = 'O' THEN
            SUBSTR(T1.POR_CD, 0, 2)
			END    
			)
        AND CO_IND_CD = 'H'
        )
AND     T1.SYS_AREA_GRP_ID  = T2.SYS_AREA_GRP_ID
AND     T1.CNTR_NO          = T2.CNTR_NO
AND     T1.CNTR_CYC_NO      = T2.CNTR_CYC_NO
AND     T2.DMDT_TRF_CD      = @[DMDT_TRF_CD]
AND     T2.DMDT_CHG_LOC_DIV_CD <> 'TSP'
AND     T2.DMDT_CHG_STS_CD IN ('D', 'E')
AND     T2.VNDR_SEQ         = T3.VNDR_SEQ(+)
AND     T2.VNDR_CNT_CD      = T3.VNDR_CNT_CD(+)
ORDER BY T2.CNTR_NO			]]></sql>
			<params>
				<param name="BKG_NO" type="12" value="" out="N"/>
				<param name="DMDT_TRF_CD" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
