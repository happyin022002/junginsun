<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContainerMovementMgtDBDAOGetAutoCreStsListRSQL">
			<desc><![CDATA[자동 생성 된 Movement 내역을 조회한다]]></desc>
			<sql><![CDATA[
SELECT STS_CD,
       CNTR_NO,
       BKG_NO,
       TP_SZ,
       YD_CD,
       TO_CHAR (TAR_DATE, 'YYYY-MM-DD HH24:MI') AS TAR_DATE,
       TO_CHAR (CRE_DT, 'YYYY-MM-DD HH24:MI') AS CRE_DT,
       PRE_STS,
       PRE_YD_CD,
       TO_CHAR (PRE_EVNT_DT, 'YYYY-MM-DD HH24:MI') AS PRE_EVNT_DT,
       DECODE (MVMT_CRE_TP_CD, 'A', 'N', 'Y') AS MVMT_CRE_TP_CD,
       CNMV_YR,
       CNMV_ID,
       TO_CHAR (TAR_DATE, 'YYYY-MM-DD HH24:MI') AS EVENT_DT,
	   CNMV_RMK,
 	   CNMV_SEQ,
       CNMV_SPLIT_NO,
	   FCNTR_FLG,
       BKG_CGO_TP_CD,
       MVMT_EDI_TP_CD,
	   VNDR_SEQ,
	   CNMV_CYC_NO,
	   IMDT_EXT_FLG,
       CRNT_VSL_CD,
       CRNT_SKD_DIR_CD,
       CRNT_SKD_VOY_NO,
       MVMT_EDI_MSG_TP_ID
  FROM (SELECT STS_CD,
               CNTR_NO,
               BKG_NO,
               TP_SZ,
               YD_CD,
               TAR_DATE,
               CRE_DT,
               LAG (STS_CD, 1) OVER (PARTITION BY CNTR_NO ORDER BY CNMV_YR, CNMV_SEQ, CNMV_SPLIT_NO) AS PRE_STS,
               LAG (YD_CD, 1) OVER (PARTITION BY CNTR_NO ORDER BY CNMV_YR, CNMV_SEQ, CNMV_SPLIT_NO) AS PRE_YD_CD,
               LAG (TAR_DATE, 1) OVER (PARTITION BY CNTR_NO ORDER BY CNMV_YR, CNMV_SEQ, CNMV_SPLIT_NO) AS PRE_EVNT_DT,
               MVMT_CRE_TP_CD,
               CNMV_YR,
               CNMV_ID,
			   CNMV_RMK,
			   CNMV_SEQ,
               CNMV_SPLIT_NO,
			   FCNTR_FLG,
               BKG_CGO_TP_CD,
               MVMT_EDI_TP_CD,
			   VNDR_SEQ,
		 	   CNMV_CYC_NO,
			   IMDT_EXT_FLG,
               CRNT_VSL_CD,
               CRNT_SKD_DIR_CD,
               CRNT_SKD_VOY_NO,
			   MVMT_EDI_MSG_TP_ID
          FROM (SELECT DISTINCT /*+ INDEX(A XAK11CTM_MOVEMENT) */
                       A.MVMT_STS_CD AS STS_CD,
                       A.CNTR_NO AS CNTR_NO,
                       A.CNTR_TPSZ_CD AS TP_SZ,
                       A.BKG_NO,
                       A.ORG_YD_CD AS YD_CD,
                       A.CNMV_EVNT_DT AS TAR_DATE,
                       A.CRE_LOCL_DT AS CRE_DT,
                       A.MVMT_CRE_TP_CD AS MVMT_CRE_TP_CD,
                       A.CNMV_YR AS CNMV_YR,
                       A.CNMV_ID_NO AS CNMV_ID,
                       A.CNMV_SEQ,
                       A.CNMV_SPLIT_NO,
					   A.CNMV_RMK,
				       DECODE (A.FCNTR_FLG, 'Y', 'F', 'M') AS FCNTR_FLG,
                       A.BKG_CGO_TP_CD,
                       A.MVMT_EDI_TP_CD,
				       A.VNDR_SEQ,
		 		       A.CNMV_CYC_NO,
				       A.IMDT_EXT_FLG,
                       A.CRNT_VSL_CD,
                       A.CRNT_SKD_DIR_CD,
                       A.CRNT_SKD_VOY_NO,
					   A.MVMT_EDI_MSG_TP_ID
                  FROM CTM_MOVEMENT A,
                       (SELECT CNTR_NO,
                               CNMV_YR AA,
                               CNMV_SEQ BB,
                               CNMV_SPLIT_NO CC,
                               CNMV_CYC_NO CYC_NO
                          FROM CTM_MOVEMENT
                         WHERE CNMV_EVNT_DT BETWEEN TO_DATE (@[p_date1], 'YYYY-MM-DD') AND TO_DATE (@[p_date2], 'YYYY-MM-DD') + .99999 
#if (${loc_type} == '1')
                           AND ORG_YD_CD IN (SELECT /*+ ORDERED USE_NL(E L Y) */
                                                    Y.YD_CD
                                               FROM MDM_EQ_ORZ_CHT E,
                                                    MDM_LOCATION L,
                                                    MDM_YARD Y
                                              WHERE E.LCC_CD = @[loc_cd]
                                                AND E.SCC_CD = L.SCC_CD
                                                AND Y.LOC_CD = L.LOC_CD)
#else
                           AND ORG_YD_CD IN (SELECT YD_CD
                                               FROM MDM_YARD
                                              WHERE YD_CD LIKE @[loc_cd]||'%')
#end
#if (${sts_cd} != '')
                           AND MVMT_STS_CD IN (${sts_cd})
#end
#if (${cre_tp_cd} != '')
                           AND MVMT_CRE_TP_CD = @[cre_tp_cd]
#end
                       ) B
                 WHERE A.CNTR_NO = B.CNTR_NO
                   AND A.CNMV_CYC_NO IN (B.CYC_NO, B.CYC_NO - 1)
                   AND A.CNMV_YR||TO_CHAR (A.CNMV_SEQ, '0000')||A.CNMV_SPLIT_NO <= B.AA||TO_CHAR (B.BB, '0000')||B.CC) TT)
 WHERE TAR_DATE BETWEEN TO_DATE (@[p_date1], 'YYYY-MM-DD') AND TO_DATE (@[p_date2], 'YYYY-MM-DD') + .99999
#if (${cre_tp_cd} != '')
   AND MVMT_CRE_TP_CD = @[cre_tp_cd]
#end			]]></sql>
			<params>
				<param name="p_date1" type="12" value="" out="N"/>
				<param name="p_date2" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="cre_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
