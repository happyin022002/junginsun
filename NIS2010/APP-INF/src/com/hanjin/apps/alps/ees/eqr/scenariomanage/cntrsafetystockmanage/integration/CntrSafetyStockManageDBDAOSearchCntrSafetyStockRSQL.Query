<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CntrSafetyStockManageDBDAOSearchCntrSafetyStockRSQL">
			<desc><![CDATA[EES_EQR_0026 - Safty Stock 조회]]></desc>
			<sql><![CDATA[
SELECT	MAX(DECODE ( rumm , 1 ,ECC_CD)) ECC_CD 
	#foreach( $key in ${arrtpsz}) 
		,MAX(DECODE ( CNTR_TPSZ_CD , '$key' , SFSTK_LVL_CD ))    ${key}SFSTK_LVL_CD 
		,MAX(DECODE ( CNTR_TPSZ_CD , '$key' , SFSTK_VOL_QTY))    ${key}SFSTK_VOL_QTY 
	#end 
		,SCNR_ID 
		,MAX(DECODE(CRE_DT,UPD_DT,'N','Y')) AS TIMEGAP 
		,MAX(TO_CHAR(CRE_DT,'YYYYMMDD')) AS CRE_DT
		,MAX(TO_CHAR(UPD_DT,'YYYYMMDD')) AS UPD_DT
FROM	( 
		SELECT	SCNR_ID 
			,ECC_CD 
			,CNTR_TPSZ_CD 
			,SFSTK_LVL_CD 
			,SFSTK_VOL_QTY 
			,UPD_USR_ID 
			,UPD_DT 
			,CRE_DT 
			,ROW_NUMBER() OVER (PARTITION BY ECC_CD,CNTR_TPSZ_CD ORDER BY ROWNUM) rumm 
		FROM	EQR_SCNR_ECC_SFT_STK 
		WHERE	SCNR_ID = @[scnr_id] 
		#if (${level_cd} != '') 
			AND SFSTK_LVL_CD = @[level_cd] 
		#end 
		 
		
		#if(${status} != '')  
			AND	ECC_CD IN ( 
					SELECT	DISTINCT(ECC_CD) ECC_CD 
					FROM	MDM_EQ_ORZ_CHT 
					WHERE	${status} IN ( 
					#foreach( ${key} in ${arrlocation}) 
						#if($velocityCount < $arrlocation.size()) 
							'$key', 
						#else 
							'$key' 
						#end 
					#end 
							) 
				)
		#end 
		 
		#if ( $arrtpsz.size() > 0 ) 
			AND	CNTR_TPSZ_CD IN ( 
			#foreach( ${key} in ${arrtpsz}) 
				#if($velocityCount < $arrtpsz.size()) 
					'$key', 
				#else 
					'$key' 
				#end 
			#end 
		) 
		#end 
		) 
GROUP BY	RUMM 
		,	ECC_CD 
		,	SCNR_ID			]]></sql>
			<params>
				<param name="scnr_id" type="12" value="" out="N"/>
				<param name="level_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
