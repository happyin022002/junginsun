<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AssetsAuditMgtDBDAOSearchAssetsDepreciatedAmtListDataRSQL">
			<desc><![CDATA[ALPS & FA 시스템에 Type/Size 별 대수, 잔존 가치 합, 평균값을 조회]]></desc>
			<sql><![CDATA[
SELECT DECODE(GRP, 1, 'G.TTL', NVL(EQ_TPSZ_CD, 'FA Olny')) AS EQ_TPSZ_CD ,
       ALPS_QTY,
       ROUND(ALPS_AMT) AS ALPS_AMT,
       DECODE(ALPS_QTY, 0, 0, ROUND((ALPS_AMT/ALPS_QTY), 1)) AS ALPS_AVG ,
       FA_QTY ,
       ROUND(FA_AMT ) AS FA_AMT ,
       DECODE(FA_QTY , 0, 0, ROUND((FA_AMT /FA_QTY ), 1)) AS FA_AVG
  FROM ( 
#if (${eq_type} == 'U')
        SELECT T1.EQ_TPSZ_CD ,
               SUM(DECODE(EQ_FA_AUD_RSLT_CD, 'F', 0, 1 )) AS ALPS_QTY ,
               SUM(DECODE(EQ_FA_AUD_RSLT_CD, 'F', 0, NVL(T3.DPC_VAL_AMT, 0))) AS ALPS_AMT ,
               SUM(DECODE(EQ_FA_AUD_RSLT_CD, 'M', 0, 1 )) AS FA_QTY ,
               SUM(DECODE(EQ_FA_AUD_RSLT_CD, 'M', 0, NVL(T4.DPC_VAL_AMT, 0))) AS FA_AMT ,
               GROUPING(T1.EQ_TPSZ_CD) AS GRP
          FROM MST_EQ_ASET_AUD_RSLT T1,
               MDM_CNTR_TP_SZ T2,
               MST_EQ_ASET_MST T3,
               MST_EQ_ASET_FA T4
         WHERE 1=1
           AND T1.EQ_TPSZ_CD = T2.CNTR_TPSZ_CD (+)
           AND T1.JB_EXE_YRMON = T3.JB_EXE_YRMON (+)
           AND T1.VER_NO = T3.VER_NO (+)
           AND T1.EQ_KND_CD = T3.EQ_KND_CD (+)
           AND T1.EQ_NO = SUBSTR(T3.EQ_NO(+), 1, 10)
           AND T1.JB_EXE_YRMON = T4.JB_EXE_YRMON (+)
           AND T1.VER_NO = T4.VER_NO (+)
           AND T1.EQ_KND_CD = T4.EQ_KND_CD (+)
           AND T1.EQ_NO = SUBSTR(T4.EQ_NO(+), 1, 10)
           AND T1.JB_EXE_YRMON = REPLACE(NVL(@[yr_mon],'0'),'-','') -- :JB_EXE_YRMON
           AND T1.VER_NO = @[ver_no] -- :VER_NO
           AND T1.EQ_KND_CD = @[eq_type] -- :eq_type
         GROUP BY GROUPING SETS((T1.EQ_TPSZ_CD,
                               RPT_DP_SEQ), ())
         ORDER BY RPT_DP_SEQ, GRP 
#else
        SELECT T1.EQ_TPSZ_CD ,
               SUM(DECODE(EQ_FA_AUD_RSLT_CD, 'F', 0, 1 )) AS ALPS_QTY ,
               SUM(DECODE(EQ_FA_AUD_RSLT_CD, 'F', 0, NVL(T3.DPC_VAL_AMT, 0))) AS ALPS_AMT ,
               SUM(DECODE(EQ_FA_AUD_RSLT_CD, 'M', 0, 1 )) AS FA_QTY ,
               SUM(DECODE(EQ_FA_AUD_RSLT_CD, 'M', 0, NVL(T4.DPC_VAL_AMT, 0))) AS FA_AMT ,
               GROUPING(T1.EQ_TPSZ_CD) AS GRP
          FROM MST_EQ_ASET_AUD_RSLT T1,
               CGM_EQ_TP_SZ T2,
               MST_EQ_ASET_MST T3,
               MST_EQ_ASET_FA T4
         WHERE 1=1
           AND T1.EQ_TPSZ_CD = T2.EQ_TPSZ_CD (+)
           AND T1.JB_EXE_YRMON = T3.JB_EXE_YRMON (+)
           AND T1.VER_NO = T3.VER_NO (+)
           AND T1.EQ_KND_CD = T3.EQ_KND_CD (+)
           AND T1.EQ_NO = SUBSTR(T3.EQ_NO(+), 1, 10)
           AND T1.JB_EXE_YRMON = T4.JB_EXE_YRMON (+)
           AND T1.VER_NO = T4.VER_NO (+)
           AND T1.EQ_KND_CD = T4.EQ_KND_CD (+)
           AND T1.EQ_NO = SUBSTR(T4.EQ_NO(+), 1, 10)
           AND T1.JB_EXE_YRMON = REPLACE(NVL(@[yr_mon],'0'),'-','') -- :JB_EXE_YRMON
           AND T1.VER_NO = @[ver_no] -- :VER_NO
           AND T1.EQ_KND_CD = @[eq_type] -- :eq_type        
         GROUP BY GROUPING SETS((T1.EQ_TPSZ_CD,
                               DP_SEQ), ())
         ORDER BY DP_SEQ, GRP 
#end         
)			]]></sql>
			<params>
				<param name="yr_mon" type="12" value="" out="N"/>
				<param name="ver_no" type="12" value="" out="N"/>
				<param name="eq_type" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
