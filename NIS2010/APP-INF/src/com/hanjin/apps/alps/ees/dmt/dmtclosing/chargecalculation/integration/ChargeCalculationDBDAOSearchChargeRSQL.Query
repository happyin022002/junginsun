<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChargeCalculationDBDAOSearchChargeRSQL">
			<desc><![CDATA[ChargeCalculationDBDAOSearchChargeRSQL]]></desc>
			<sql><![CDATA[
SELECT A.cntr_cyc_no||'|'||A.dmdt_chg_loc_div_cd||'|'||A.CHG_SEQ||'|'||A.OFC_CD||'|'||A.SYS_AREA_GRP_ID
       ||'|'||TO_CHAR(A.FM_MVMT_DT,'YYYYMMDD')
       ||'|'||TO_CHAR(A.TO_MVMT_DT,'YYYYMMDD')
       ||'|'||TO_CHAR(A.FT_CMNC_DT,'YYYYMMDD')
       ||'|'||TO_CHAR(A.FT_END_DT,'YYYYMMDD')
       ||'|'||A.BIL_AMT
	   ||'|'||
       ( SELECT COUNT(*) FROM DMT_CHG_DELT_RQST_APRO T1
          WHERE 1=1
            AND  T1.SYS_AREA_GRP_ID       = A.SYS_AREA_GRP_ID
            AND  T1.CNTR_NO               = A.CNTR_NO
            AND  T1.CNTR_CYC_NO           = A.CNTR_CYC_NO
            and  T1.DMDT_TRF_CD           = A.DMDT_TRF_CD
            and  T1.DMDT_CHG_LOC_DIV_CD   = A.DMDT_CHG_LOC_DIV_CD
            and  T1.CHG_SEQ               = A.CHG_SEQ 
            AND  T1.DMDT_DELT_RQST_STS_CD IN ( 'R','A' ))
		||'|'||A.FM_MVMT_YD_CD
		||'|'||A.TO_MVMT_YD_CD
		||'|'||A.OFC_CD
		||'|'||A.FM_MVMT_STS_CD
		||'|'||A.TO_MVMT_STS_CD
		||'|'||A.ORG_CHG_AMT
       AS rtnValue
 FROM DMT_CHG_CALC A, DMT_CHG_BKG_CNTR B
WHERE 1=1
AND A.SYS_AREA_GRP_ID = B.SYS_AREA_GRP_ID
AND A.CNTR_NO = B.CNTR_NO
AND A.CNTR_CYC_NO = B.CNTR_CYC_NO
AND B.BKG_NO = @[bkg_no]
AND A.DMDT_TRF_CD = @[dmdt_trf_cd]
AND A.CNTR_NO = @[cntr_no]
AND NOT (A.DUL_TP_EXPT_FLG  = 'Y' AND SUBSTR(A.DMDT_TRF_CD, 1, 1) = 'D')
AND A.DMDT_CHG_LOC_DIV_CD NOT IN ('TSP', 'SZP')
AND A.CHG_SEQ = DECODE(@[chg_type],'G',1, ( SELECT MAX(CHG_SEQ)
                                         FROM DMT_CHG_CALC AA, DMT_CHG_BKG_CNTR BB
                                        WHERE 1=1
                                        AND AA.SYS_AREA_GRP_ID = BB.SYS_AREA_GRP_ID
                                        AND AA.CNTR_NO = BB.CNTR_NO
                                        AND AA.CNTR_CYC_NO = BB.CNTR_CYC_NO
                                        AND BB.BKG_NO = @[bkg_no]
                                        AND AA.DMDT_TRF_CD = @[dmdt_trf_cd]
                                        AND AA.CNTR_NO = @[cntr_no]
                                        AND AA.CHG_SEQ != 1 ))			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="dmdt_trf_cd" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="chg_type" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
