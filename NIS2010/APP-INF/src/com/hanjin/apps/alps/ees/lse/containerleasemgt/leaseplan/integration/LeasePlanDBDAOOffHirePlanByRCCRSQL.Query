<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="LeasePlanDBDAOOffHirePlanByRCCRSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
SELECT *
FROM   (
         SELECT 1 AS ORD_SEQ
              , F.PLN_YR
              , F.OFFH_RGN_LOC_CD
              , F.OFFH_LOC_TP_CD
              , 'Target' AS OFFH_LOC_CD
              , F.OFFH_YRMON
#foreach($key IN ${cntr_tpsz_cd_seq})
#set ($col_name="CNTR"+$velocityCount+"_QTY")
              , SUM(DECODE(F.CNTR_TPSZ_CD, '$key', F.OFFH_QTY, 0)) AS $col_name
#end
         FROM   (
                  SELECT A.PLN_YR
                       , A.OFFH_RGN_LOC_CD
                       , A.OFFH_LOC_TP_CD
                       , M.OFFH_VER_SEQ
                       , A.OFFH_YRMON
                       , A.CNTR_TPSZ_CD
                       , A.OFFH_QTY
                  FROM   LSE_OFFH_PLN A
                       , ( SELECT MAX(A.OFFH_VER_SEQ) AS OFFH_VER_SEQ
                           FROM   LSE_OFFH_PLN A
                           WHERE  A.OFFH_RGN_LOC_CD = @[offh_rgn_loc_cd]
                           AND    A.OFFH_LOC_TP_CD = 'H'
                           AND    A.OFFH_PLN_TP_CD = 'O'
                           AND    A.OFFH_YRMON = @[offh_yrmon]
                           AND    A.PLN_YR = @[pln_yr]
                         ) M
                  WHERE  A.OFFH_RGN_LOC_CD = @[offh_rgn_loc_cd]
                  AND    A.OFFH_LOC_TP_CD = 'H'
                  AND    A.OFFH_PLN_TP_CD = 'O'
                  AND    A.OFFH_VER_SEQ = M.OFFH_VER_SEQ
                  AND    A.OFFH_YRMON = @[offh_yrmon]
                  AND    A.PLN_YR = @[pln_yr]
                ) F
         GROUP  BY F.PLN_YR
                 , F.OFFH_RGN_LOC_CD
                 , F.OFFH_LOC_TP_CD
                 , F.OFFH_YRMON
         UNION ALL
         SELECT 2 AS ORD_SEQ
              , '${pln_yr}'          AS PLN_YR
              , '${offh_rgn_loc_cd}' AS OFFH_RGN_LOC_CD
              , 'R'                  AS OFFH_LOC_TP_CD
              , 'Difference'         AS OFFH_LOC_CD
              , '${offh_yrmon}'      AS OFFH_YRMON
#foreach($key IN ${cntr_tpsz_cd_seq})
#set ($col_name="CNTR"+$velocityCount+"_QTY")
              , NULL AS $col_name
#end
         FROM   DUAL
         UNION ALL
         SELECT 3 AS ORD_SEQ
              , NVL(F.PLN_YR, '${pln_yr}') AS PLN_YR
              , NVL(F.OFFH_RGN_LOC_CD, '${offh_rgn_loc_cd}') AS OFFH_RGN_LOC_CD
              , NVL(F.OFFH_LOC_TP_CD, 'R') AS OFFH_LOC_TP_CD
              , G.LCC_CD AS OFFH_LOC_CD
              , NVL(F.OFFH_YRMON, '${offh_yrmon}') AS OFFH_YRMON
#foreach($key IN ${cntr_tpsz_cd_seq})
#set ($col_name="CNTR"+$velocityCount+"_QTY")
              , SUM(DECODE(F.CNTR_TPSZ_CD, '$key', F.OFFH_QTY, 0)) AS $col_name
#end
         FROM   (
                  SELECT A.PLN_YR
                       , A.OFFH_RGN_LOC_CD
                       , A.OFFH_LOC_TP_CD
                       , A.OFFH_LOC_CD
                       , MAX(A.OFFH_VER_SEQ)
                       , A.OFFH_YRMON
                       , A.CNTR_TPSZ_CD
                       , A.OFFH_QTY
                  FROM   LSE_OFFH_PLN A
                  WHERE  A.OFFH_RGN_LOC_CD = @[offh_rgn_loc_cd]
                  AND    A.OFFH_LOC_TP_CD = 'R'
                  AND    A.OFFH_PLN_TP_CD = 'O'
                  AND    A.OFFH_YRMON = @[offh_yrmon]
                  AND    A.PLN_YR = @[pln_yr]
                  GROUP  BY A.PLN_YR
                          , A.OFFH_RGN_LOC_CD
                          , A.OFFH_LOC_TP_CD
                          , A.OFFH_LOC_CD
                          , A.OFFH_YRMON
                          , A.CNTR_TPSZ_CD
                          , A.OFFH_QTY
                ) F
              , (
                  SELECT DISTINCT A.LCC_CD
                  FROM   MDM_EQ_ORZ_CHT A
                  WHERE  A.RCC_CD = @[offh_rgn_loc_cd]
                  AND    A.DELT_FLG = 'N'
                ) G
         WHERE  F.OFFH_LOC_CD (+)= G.LCC_CD
         GROUP  BY F.PLN_YR
                 , F.OFFH_RGN_LOC_CD
                 , F.OFFH_LOC_TP_CD
                 , G.LCC_CD
                 , F.OFFH_YRMON
       ) AA
ORDER  BY AA.ORD_SEQ
        , AA.OFFH_LOC_TP_CD
        , AA.OFFH_LOC_CD			]]></sql>
			<params>
				<param name="offh_rgn_loc_cd" type="12" value="" out="N"/>
				<param name="offh_yrmon" type="12" value="" out="N"/>
				<param name="pln_yr" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
