<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CntrRepoPlanSensitivityAnalysisDBDAOSearchPlanSensivity04RSQL">
			<desc><![CDATA[Storage 민김도 조회]]></desc>
			<sql><![CDATA[
SELECT 	B.WEEK
		, B.SENS_TYP SENSITY
        , B.OBJ_TXT  OBJ
        , B.FM_ECC_CD FM_LOC
        , B.TO_ECC_CD  TO_LOC
        , B.CNTR_TPSZ_CD TS_TYPE
        , B.CNTR_QTY VOL
        , B.CURR_COST 	CURR_COST	
		, E.STO_RNG_MIN_QTY COST_RANGE
        , E.STO_RNG_MAX_QTY	COST_RANGE1													 		
 FROM ( SELECT SUBSTR(PLN_YRWK,1,4) || '-' || SUBSTR(PLN_YRWK,5,2) WEEK,REPO_PLN_ID
               , PLN_YRWK        				
			   , @[sens_typ] SENS_TYP                                                                       					
			   , @[obj_txt] OBJ_TXT                                                                        					
		       , FM_ECC_CD                                                                							
		       , '' TO_ECC_CD                                                           							
		       , CNTR_TPSZ_CD                                                                      				
		       , SUM(CNTR_QTY) CNTR_QTY                                                            				
		       , (select DECODE(SUBSTR(CNTR_TPSZ_CD,2,2) , '2', STO_20FT_COST_AMT                                  
				                                         , '4', STO_40FT_COST_AMT                                    
				                                         , '5', STO_40FT_COST_AMT                                  
				                                         , '7', STO_45FT_COST_AMT)  FROM EQR_ECC_MST               
				  WHERE ECC_CD = FM_ECC_CD ) CURR_COST                      
		FROM ( SELECT  /*+ LEADING(N) FULL(N) FULL(M) */ REPO_PLN_ID
                      , PLN_YRWK                                                       				
				      , FM_ECC_CD
                      , FM_DT
                      , FM_WK                                                   				
				      , TO_DT
                      , TO_WK                                                   							
				      , CNTR_TPSZ_CD
                      , CNTR_QTY																	
			   FROM ( SELECT   A.REPO_PLN_ID
                             , A.PLN_YRWK                                             				
				             , B.FM_ECC_CD
                             , B.FM_ETD_DT
                             , TO_CHAR(B.FM_ETD_DT, 'YYYYMMDD') FM_DT        				
				             ,  B.TO_ETB_DT
                             , TO_CHAR(B.TO_ETB_DT, 'YYYYMMDD') TO_DT    								
				             , F.CNTR_TPSZ_CD
                             , F.CNTR_QTY														
				       FROM EQR_INLND_TRSP_PLN A                                                     				
				             , EQR_VSL_LODG_DCHG_PLN B                                             				
				             , (SELECT ECC_CD, LCC_CD, RCC_CD FROM EQR_ECC_MST) C	                				
				             , (SELECT ECC_CD, LCC_CD, RCC_CD FROM EQR_ECC_MST) D
                             , EQR_VSL_LODG_DCHG_PLN_QTY F
                             , EQR_INLND_TRSP_PLN_QTY G 	                				
				       WHERE A.REPO_PLN_ID = B.REPO_PLN_ID                                        				
				       AND A.FM_ECC_CD = B.FM_ECC_CD                                                        
				       AND B.FM_ECC_CD = C.ECC_CD                                           				
				       AND B.TO_ECC_CD = D.ECC_CD                                           				
				       AND B.REPO_PLN_ID = @[repo_pln_id] 
				       AND F.CNTR_TPSZ_CD IN (${arrtpszcd})	
                       AND B.REPO_PLN_ID = F.REPO_PLN_ID
                       AND B.PLN_YRWK    = F.PLN_YRWK
                       AND B.PLN_SEQ     = F.PLN_SEQ
                       AND A.REPO_PLN_ID = G.REPO_PLN_ID
                       AND A.PLN_YRWK    = G.PLN_YRWK
                       AND A.PLN_SEQ     = G.PLN_SEQ
                  #if (${fmecccd} != '') 
            		   #if (${fmtype} == 'R')
                	   AND C.RCC_CD IN (${arrfmecccd}) 
					   #end
            		   #if (${fmtype} == 'L')
                	   AND C.LCC_CD IN (${arrfmecccd})
						#end
            			#if (${fmtype} == 'E')
                	   AND C.ECC_CD IN (${arrfmecccd})
						#end
		 		#end                					
			     #if (${toecccd} != '') 
            		#if (${totype} == 'R')
               		  AND D.RCC_CD IN (${arrtoecccd}) 
					#end
            	    #if (${totype} == 'L')
                	  AND D.LCC_CD IN (${arrtoecccd})
					#end
            		#if (${totype} == 'E')
                	AND D.ECC_CD IN (${arrtoecccd})
					#end
		  		 #end      
			 ) L                                                                            				
             , (SELECT PLN_YR || PLN_WK FM_WK, WK_ST_DT, WK_END_DT FROM EQR_WK_PRD) M       				
             , (SELECT PLN_YR || PLN_WK TO_WK, WK_ST_DT, WK_END_DT FROM EQR_WK_PRD) N       				
       WHERE L.FM_DT BETWEEN M.WK_ST_DT AND M.WK_END_DT													
	   AND L.TO_DT BETWEEN N.WK_ST_DT AND N.WK_END_DT												
	   AND M.FM_WK BETWEEN @[fmstartprd] AND @[fmendprd]                                     							    
	 )                                                                                      				
	 GROUP BY REPO_PLN_ID, PLN_YRWK, FM_ECC_CD, CNTR_TPSZ_CD									    			
  ) B, EQR_CNTR_HNDL_COST_RNG E										   										
WHERE B.REPO_PLN_ID  = E.REPO_PLN_ID										   								
AND B.FM_ECC_CD 	  = E.ECC_CD										   									
AND B.CNTR_TPSZ_CD = E.CNTR_SZ_CD										   								
AND B.PLN_YRWK     = E.PLN_YRWK										   									
ORDER BY B.PLN_YRWK, B.FM_ECC_CD, B.CNTR_TPSZ_CD			]]></sql>
			<params>
				<param name="sens_typ" type="12" value="" out="N"/>
				<param name="obj_txt" type="12" value="" out="N"/>
				<param name="repo_pln_id" type="12" value="" out="N"/>
				<param name="fmstartprd" type="12" value="" out="N"/>
				<param name="fmendprd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
