<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CntrRepoExecutionFeedbackExamineDBDAOSearchCntrRepoExecutionFeedbackRSQL">
			<desc><![CDATA[<EES_EQR_0063 컨테이너 이송실행 실적 및 Feedback 조회>
plan - execution 의 자동제어 내용 조회

<Change History>
1	2009.10.09	Lee ByoungHun	최초작성]]></desc>
			<sql><![CDATA[
SELECT /*+ CHOOSE */
    DECODE(
        B.NUM, 1, A.
        #if (${weeklymonthly} == '1')
            PLN_YRWK
        #elseif (${weeklymonthly} == '2')
            PLN_MON
        #end
        , 2, B.NAME,  3, A.
        #if (${weeklymonthly} == '1')
            PLN_YRWK
        #elseif (${weeklymonthly} == '2')
            PLN_MON
        #end
        ||' '||B.NAME
    ) PLN_YRWK
    ,DECODE(B.NUM, 1, A.FM_ECC_CD, 	2, '',      3, '')                      FM_ECC_CD
    ,DECODE(B.NUM, 1, A.TO_ECC_CD, 	2, '',      3, '')                      TO_ECC_CD
    ,DECODE(B.NUM, 1, A.TRSP_MOD_CD, 2, A.TRSP_MOD_CD,  3, A.TRSP_MOD_CD)    TRSP_MOD_CD
    ,NVL(SUM(A.PLAN_VOL), 0)        PLAN_VOL
    ,NVL(SUM(A.PLAN_COST), 0)       PLAN_COST
    ,NVL(SUM(A.EXECULTION_VOL), 0)  EXECULTION_VOL
    ,NVL(SUM(A.EXECULTION_COST), 0) EXECULTION_COST
    ,NVL(SUM(A.WO_VOL), 0)          WO_VOL
    ,NVL(SUM(A.WO_COST), 0)         WO_COST
    #if (${ratiovol} == 'R')
        ,ROUND(NVL(DECODE(NVL(SUM(A.PLAN_VOL  ), 0), 0, 0, (NVL(SUM(A.EXECULTION_VOL ), 0) / NVL(SUM(A.PLAN_VOL       ), 0) )*100), 0), 2) ADHERENCE_VOL
        ,ROUND(NVL(DECODE(NVL(SUM(A.PLAN_COST ), 0), 0, 0, (NVL(SUM(A.EXECULTION_COST), 0) / NVL(SUM(A.PLAN_COST      ), 0) )    ), 0), 2) ADHERENCE_COST
        ,ROUND(NVL(DECODE(NVL(SUM(A.PLAN_VOL  ), 0), 0, 0, (NVL(SUM(A.WO_VOL         ), 0) / NVL(SUM(A.PLAN_VOL       ), 0) )*100), 0), 2) PLAN_WO_VOL
        ,ROUND(NVL(DECODE(NVL(SUM(A.PLAN_COST ), 0), 0, 0, (NVL(SUM(A.WO_COST        ), 0) / NVL(SUM(A.PLAN_COST      ), 0) )    ), 0), 2) PLAN_WO_COST
        ,ROUND(NVL(DECODE(NVL(SUM(A.EXECULTION_VOL  ), 0), 0, 0, (NVL(SUM(A.WO_VOL         ), 0) / NVL(SUM(A.EXECULTION_VOL ), 0) )*100), 0), 2) WO_ISSUED_VOL
        ,ROUND(NVL(DECODE(NVL(SUM(A.EXECULTION_COST ), 0), 0, 0, (NVL(SUM(A.WO_COST        ), 0) / NVL(SUM(A.EXECULTION_COST), 0) )    ), 0), 2) WO_ISSUED_COST
    #elseif (${ratiovol} == 'V')
        ,ROUND(NVL(SUM(A.PLAN_VOL),  0)       - NVL(SUM(A.EXECULTION_VOL), 0), 2)  ADHERENCE_VOL
        ,ROUND(NVL(SUM(A.PLAN_COST), 0)       - NVL(SUM(A.EXECULTION_COST), 0), 2) ADHERENCE_COST
        ,ROUND(NVL(SUM(A.PLAN_VOL),  0)       - NVL(SUM(A.WO_VOL ), 0), 2)         PLAN_WO_VOL
        ,ROUND(NVL(SUM(A.PLAN_COST), 0)       - NVL(SUM(A.WO_COST), 0), 2)         PLAN_WO_COST
        ,ROUND(NVL(SUM(A.EXECULTION_VOL), 0)  - NVL(SUM(A.WO_VOL ), 0), 2)         WO_ISSUED_VOL
        ,ROUND(NVL(SUM(A.EXECULTION_COST), 0) - NVL(SUM(A.WO_COST), 0), 2)         WO_ISSUED_COST
    #end
    #if (${frequency} == 'F')
        ,SUM(A.FEEDBACK_KEY_TOTAL) FEEDBACK_KEY_TOTAL
        ,SUM(A.FEEDBACK_KEY01    ) FEEDBACK_KEY01
        ,SUM(A.FEEDBACK_KEY02    ) FEEDBACK_KEY02
        ,SUM(A.FEEDBACK_KEY03    ) FEEDBACK_KEY03
        ,SUM(A.FEEDBACK_KEY04    ) FEEDBACK_KEY04
        ,SUM(A.FEEDBACK_KEY05    ) FEEDBACK_KEY05
        ,SUM(A.FEEDBACK_KEY06    ) FEEDBACK_KEY06
        ,SUM(A.FEEDBACK_KEY07    ) FEEDBACK_KEY07
        ,SUM(A.FEEDBACK_KEY08    ) FEEDBACK_KEY08
        ,SUM(A.FEEDBACK_KEY99    ) FEEDBACK_KEY99
    #end
    #if (${fmtypeby} == 'R')
        ,'RCC_CD'
    #elseif (${fmtypeby} == 'C')
        ,'CNT_CD'
    #elseif (${fmtypeby} == 'L')
        ,'LCC_CD'
    #else
        ,'ECC_CD'
    #end
    #if (${totypeby} == 'R')
        ,'RCC_CD'
    #elseif (${totypeby} == 'C')
        ,'CNT_CD'
    #elseif (${totypeby} == 'L')
        ,'LCC_CD'
    #else
        ,'ECC_CD'
    #end
    ,'${ratiovol}'
    ,'${weeklymonthly}'
    ,'${fmPlnSYrWk}'
    ,'${fmPlnEYrWk}'
    ,'${toPlnSYrWk}'
    ,'${toPlnEYrWk}'
    ,'${adherence}'
    ,'${weeklymonthly}'
    ,'${frequency}'
    ,ITEMCD
FROM
(
    SELECT
        X.
        #if (${weeklymonthly} == '1')
            PLN_YRWK
        #elseif (${weeklymonthly} == '2')
            PLN_MON
        #end
        #if (${item} == 'O' || ${item} == 'F')
            ,MAX(X.FM_ECC_CD) FM_ECC_CD
            ,MAX(X.TO_ECC_CD) TO_ECC_CD
        #else
            ,X.FM_ECC_CD FM_ECC_CD
            ,X.TO_ECC_CD TO_ECC_CD
        #end
        ,(SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD00253' AND INTG_CD_VAL_CTNT = X.TRSP_MOD_CD) TRSP_MOD_CD
        ,SUM(DECODE(X.FLAG, '1', VOL,  '')) PLAN_VOL
        ,SUM(DECODE(X.FLAG, '1', COST, '')) PLAN_COST
        ,SUM(DECODE(X.FLAG, '2', VOL,  '')) EXECULTION_VOL
        ,SUM(DECODE(X.FLAG, '2', COST, '')) EXECULTION_COST
        ,SUM(DECODE(X.FLAG, '3', VOL,  '')) WO_VOL
        ,SUM(DECODE(X.FLAG, '3', COST, '')) WO_COST
        #if (${ratiovol} == 'R')
            ,ROUND(SUM(DECODE(X.FLAG, '2', VOL,  '')) / DECODE(SUM(DECODE(X.FLAG, '1', VOL,  '')), 0, '', SUM(DECODE(X.FLAG, '1', VOL,  '')))*100,2) ADHERENCE_VOL
            ,ROUND(SUM(DECODE(X.FLAG, '2', COST, '')) / DECODE(SUM(DECODE(X.FLAG, '1', COST, '')), 0, '', SUM(DECODE(X.FLAG, '1', COST, ''))),2)     ADHERENCE_COST
            ,ROUND(SUM(DECODE(X.FLAG, '3', VOL,  '')) / DECODE(SUM(DECODE(X.FLAG, '2', VOL,  '')), 0, '', SUM(DECODE(X.FLAG, '2', VOL,  '')))*100,2) WO_ISSUED_VOL
            ,ROUND(SUM(DECODE(X.FLAG, '3', COST, '')) / DECODE(SUM(DECODE(X.FLAG, '2', COST, '')), 0, '', SUM(DECODE(X.FLAG, '2', COST, ''))),2)     WO_ISSUED_COST
        #elseif (${ratiovol} == 'V')
            ,SUM(DECODE(X.FLAG, '1', VOL,  0)) - SUM(DECODE(X.FLAG, '2', VOL,  0)) ADHERENCE_VOL
            ,SUM(DECODE(X.FLAG, '1', COST, 0)) - SUM(DECODE(X.FLAG, '2', COST, 0)) ADHERENCE_COST
            ,SUM(DECODE(X.FLAG, '2', VOL,  0)) - SUM(DECODE(X.FLAG, '3', VOL,  0)) WO_ISSUED_VOL
            ,SUM(DECODE(X.FLAG, '2', COST, 0)) - SUM(DECODE(X.FLAG, '3', COST, 0)) WO_ISSUED_COST
        #end
        #if (${frequency} == 'F')
            ,SUM(DECODE(X.FLAG, '4', VOL, 0))  FEEDBACK_KEY_TOTAL
            ,SUM(DECODE(X.FLAG, '4', DECODE(X.FEEDBACK_KEY ,'01',VOL), 0))  FEEDBACK_KEY01
            ,SUM(DECODE(X.FLAG, '4', DECODE(X.FEEDBACK_KEY ,'02',VOL), 0))  FEEDBACK_KEY02
            ,SUM(DECODE(X.FLAG, '4', DECODE(X.FEEDBACK_KEY ,'03',VOL), 0))  FEEDBACK_KEY03
            ,SUM(DECODE(X.FLAG, '4', DECODE(X.FEEDBACK_KEY ,'04',VOL), 0))  FEEDBACK_KEY04
            ,SUM(DECODE(X.FLAG, '4', DECODE(X.FEEDBACK_KEY ,'05',VOL), 0))  FEEDBACK_KEY05
            ,SUM(DECODE(X.FLAG, '4', DECODE(X.FEEDBACK_KEY ,'06',VOL), 0))  FEEDBACK_KEY06
            ,SUM(DECODE(X.FLAG, '4', DECODE(X.FEEDBACK_KEY ,'07',VOL), 0))  FEEDBACK_KEY07
            ,SUM(DECODE(X.FLAG, '4', DECODE(X.FEEDBACK_KEY ,'08',VOL), 0))  FEEDBACK_KEY08
            ,SUM(DECODE(X.FLAG, '4', DECODE(X.FEEDBACK_KEY ,'99',VOL), 0))  FEEDBACK_KEY99
        #end
        #if (${fmtypeby} == 'R')
            ,'RCC_CD'
        #elseif (${fmtypeby} == 'C')
            ,'CNT_CD'
        #elseif (${fmtypeby} == 'L')
            ,'LCC_CD'
        #else
            ,'ECC_CD'
        #end
        #if (${totypeby} == 'R')
            ,'RCC_CD'
        #elseif (${totypeby} == 'C')
            ,'CNT_CD'
        #elseif (${totypeby} == 'L')
            ,'LCC_CD'
        #else
            ,'ECC_CD'
        #end
        ,'${ratiovol}'
        ,'${weeklymonthly}'
        ,'${fmPlnSYrWk}'
        ,'${fmPlnEYrWk}'
        ,'${toPlnSYrWk}'
        ,'${toPlnEYrWk}'
        ,'${adherence}'
        ,'${weeklymonthly}'
        ,'${frequency}'
        ,X.TRSP_MOD_CD ITEMCD
    FROM (
        #if (${item} == '')
            #if (${lane} == '')
                -- ITEM = T.VVD ------------------------------------------------------------------------------------------------
                -- Plan ID 1
                #if(${weeklymonthly} == '1')
                    SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_YRWK
                #else
                    SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_MON
                #end
                    ,'' CO_CD
                    ,(
                        SELECT
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST
                        WHERE FM_ECC_CD = ECC_CD
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST
                            WHERE TO_ECC_CD = ECC_CD
                        ) TO_ECC_CD
                    #end
                    ,TRSP_MOD_CD
                    ,SUM(CNTR_QTY) VOL
                    ,SUM(LODG_DCHG_COST_AMT) COST
                    ,'' FEEDBACK_KEY
                    ,'1' FLAG
                FROM
                    EQR_VSL_LODG_DCHG_PLN A
                    ,EQR_VSL_LODG_DCHG_PLN_QTY Q
                    ,EQR_EQ_REPO_PLN B
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND LCC_CD
                        #else
                            AND ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND RCC_CD
                        #elseif (${totype} == 'L')
                            AND LCC_CD
                        #else
                            AND ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND A.REPO_PLN_ID = B.REPO_PLN_ID
                    AND FM_ECC_CD = C.ECC_CD AND TO_ECC_CD = D.ECC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    AND PAST_REPO_PLN_FLG NOT IN('Y')
                    AND B.REPO_PLN_DTRB_FLG ='Y'       -- 새로 추가된 조건
                    AND SUBSTR(A.REPO_PLN_ID,5,6) = A.PLN_YRWK
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${fmPlnSYrWk} != '')
                        AND TO_CHAR (FM_ETD_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_CHAR (TO_ETB_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                    #end
                GROUP BY
                    A.FM_ETD_DT, FM_ECC_CD, TO_ECC_CD, TRSP_MOD_CD
                
                -- 새로 추가된 개념(20080610)
                -- CSR NO : N200805150003
                -- modified by shin yongchan - 20080602
                UNION ALL
                #if(${weeklymonthly} == '1')
                    SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_WK  PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_YRWK
                #else
                    SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_MON
                #end
                    ,'' CO_CD
                    ,(
                        SELECT
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST
                        WHERE FM_ECC_CD = ECC_CD
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST
                             WHERE TO_ECC_CD = ECC_CD
                        ) TO_ECC_CD
                    #end
                    ,TRSP_MOD_CD
                    ,SUM(CNTR_QTY) VOL
                    ,SUM(LODG_DCHG_COST_AMT) COST
                    ,'' FEEDBACK_KEY
                    ,'1' FLAG
                FROM
                    EQR_VSL_LODG_DCHG_PLN A
                    , EQR_VSL_LODG_DCHG_PLN_QTY Q
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND LCC_CD
                        #else
                            AND ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND RCC_CD
                        #elseif (${totype} == 'L')
                            AND LCC_CD
                        #else
                            AND ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND PAST_REPO_PLN_FLG NOT IN ('Y')
                    AND FM_ECC_CD = C.ECC_CD AND TO_ECC_CD = D.ECC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    AND SUBSTR(A.REPO_PLN_ID,5,6) <> A.PLN_YRWK
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${fmPlnSYrWk} != '')
                        AND TO_CHAR (FM_ETD_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_CHAR (TO_ETB_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                    #end
                    AND (A.REPO_PLN_ID, A.VSL_LANE_CD, A.VSL_CD, A.SKD_VOY_NO, A.SKD_DIR_CD, A.FM_ECC_CD, A.TO_ECC_CD ) IN
                    (
                        SELECT
                            REPO_PLN_ID
                            , LANE
                            , VSL
                            , VOY
                            , DIR
                            , FM_ECC
                            , TO_ECC
                        FROM
                        (
                            SELECT
                                DISTINCT A.REPO_PLN_ID REPO_PLN_ID
                                , A.VSL_LANE_CD LANE
                                , A.VSL_CD VSL
                                , A.SKD_VOY_NO VOY
                                , A.SKD_DIR_CD DIR
                                , (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SUBSTR(A.FM_YD_CD,1,5) = SCC_CD) FM_ECC
                                , (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SUBSTR(A.TO_YD_CD,1,5) = SCC_CD) TO_ECC
                                , A.FM_ETD_DT
                                , A.TO_ETB_DT
                            FROM
                                EQR_VSL_LODG_DCHG_EXE_PLN A
                                ,EQR_VSL_EXE_PLN_QTY Q
                                #if (${weeklymonthly} == '2')
                                    ,EQR_WK_PRD E
                                #end
                                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                #if ($arrFmEccCd.size() > 0)
                                    #if (${fmtype} == 'R')
                                        AND B.RCC_CD
                                    #elseif (${fmtype} == 'L')
                                        AND B.LCC_CD
                                    #else
                                        AND B.ECC_CD
                                    #end
                                    IN(
                                    #foreach ($key in ${arrFmEccCd})
                                        #if($velocityCount < $arrFmEccCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )) C
                                #else
                                    ) C
                                #end
                                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                #if ($arrToEccCd.size() > 0)
                                    #if (${totype} == 'R')
                                        AND B.RCC_CD
                                    #elseif (${totype} == 'L')
                                        AND B.LCC_CD
                                    #else
                                        AND B.ECC_CD
                                    #end
                                    IN(
                                    #foreach ($key in ${arrToEccCd})
                                        #if($velocityCount < $arrToEccCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )) D
                                #else
                                    ) D
                                #end
                            WHERE
                                1=1
                                AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                                AND A.PLN_YRWK = Q.PLN_YRWK
                                AND A.PLN_SEQ = Q.PLN_SEQ
                                AND A.REF_ID = Q.REF_ID
                                AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                                #if (${weeklymonthly} == '2')
                                    AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                                #end
                                #if ($arrOddtpszCd.size() > 0)
                                    AND Q.CNTR_TPSZ_CD IN(
                                    #foreach ($key in ${arrOddtpszCd})
                                        #if($velocityCount < $arrOddtpszCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )
                                #end
                                #if ($arrLane.size() > 0)
                                    AND VSL_LANE_CD IN(
                                    #foreach ($key in ${arrLane})
                                        #if($velocityCount < $arrLane.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )
                                #end
                                #if (${item} == 'O' || ${item} == 'F')
                                    AND ONF_HIR_DIV_CD = @[item]
                                #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                                    AND A.TRSP_MOD_CD = @[item]
                                #end
                                #if (${feedback} == 'on')
                                    AND REPO_PLN_FB_RSN_CD IS NOT NULL
                                #end
                                #if (${fmPlnSYrWk} != '')
                                    AND TO_CHAR (FM_ETD_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                                #end
                                #if (${toPlnSYrWk} != '')
                                    AND TO_CHAR (TO_ETB_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                                #end
                                AND A.PLN_YRWK =  (SELECT PLN_YR||PLN_WK FROM EQR_WK_PRD WHERE TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT )
                                AND REPO_MTY_BKG_FLG ='Y'
                        )
                    )
                GROUP BY
                    A.FM_ETD_DT, FM_ECC_CD, TO_ECC_CD, TRSP_MOD_CD

                UNION ALL

                -- ITEM = On-Hire(O)  ------------------------------------------------------------------
                -- Plan ID 2
                SELECT
                    #if (${weeklymonthly} == '1')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||SUBSTR(A.PLN_YRWK,5,6) PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                    #end
                    ,'' CO_CD
                    ,(
                        SELECT
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST
                        WHERE DECODE(ONF_HIR_DIV_CD , 'O', A.ECC_CD,'F',A.ECC_CD) = ECC_CD
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT
                            #if (${fmtypeby} == 'R')
                                RCC_CD
                            #elseif (${fmtypeby} == 'C')
                                CNT_CD
                            #elseif (${fmtypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST
                            WHERE DECODE(ONF_HIR_DIV_CD , 'O', A.ECC_CD,'F',A.ECC_CD) = ECC_CD
                        ) TO_ECC_CD
                    #end
                    ,ONF_HIR_DIV_CD TRSP_MOD_CD
                    ,SUM(CNTR_QTY)   VOL
                    ,SUM(ONF_HIR_COST_AMT) COST
                    ,''  FEEDBACK_KEY
                    ,'1' FLAG
                -- CSRNO : N200712050007 추가
                FROM
                    EQR_ONF_HIR_PLN A
                    , EQR_ONF_HIR_PLN_QTY Q
                    , EQR_EQ_REPO_PLN B
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND LCC_CD
                        #else
                            AND ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                WHERE
                    A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND A.REPO_PLN_ID = B.REPO_PLN_ID
                    AND A.ECC_CD = C.ECC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    AND A.ONF_HIR_DIV_CD    IN ('O','F')
                    AND B.REPO_PLN_DTRB_FLG ='Y'                  -- 새로 추가된 조건
                    AND SUBSTR(A.REPO_PLN_ID,5,6) = A.PLN_YRWK	-- 새로 추가된 조건
                    #if (${fmPlnSYrWk} != '')
                        AND A.PLN_YRWK BETWEEN @[fmPlnSYrWk] AND @[fmPlnEYrWk]
                    #end
                GROUP BY
                    #if (${weeklymonthly} == '1')
                        A.PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        A.PLN_YRWK, PLN_MON
                    #end
                    , A.ECC_CD
                    , ONF_HIR_DIV_CD
                
                -- 새로 추가된 개념(20080610)
                -- CSR NO : N200805150003
                -- modified by shin yongchan - 20080602
                UNION ALL
                SELECT
                    #if (${weeklymonthly} == '1')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||SUBSTR(A.PLN_YRWK,5,6) PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                    #end
                    ,'' CO_CD
                    ,(
                        SELECT
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST
                        WHERE DECODE(ONF_HIR_DIV_CD , 'O', A.ECC_CD,'F',A.ECC_CD) = ECC_CD
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT
                            #if (${fmtypeby} == 'R')
                                RCC_CD
                            #elseif (${fmtypeby} == 'C')
                                CNT_CD
                            #elseif (${fmtypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST
                            WHERE DECODE(ONF_HIR_DIV_CD , 'O', A.ECC_CD,'F',A.ECC_CD) = ECC_CD
                        ) TO_ECC_CD
                    #end
                    ,ONF_HIR_DIV_CD TRSP_MOD_CD
                    ,SUM(CNTR_QTY)   VOL
                    ,SUM(ONF_HIR_COST_AMT) COST
                    ,''  FEEDBACK_KEY
                    ,'1' FLAG
                FROM
                    EQR_ONF_HIR_PLN A
                    ,EQR_ONF_HIR_PLN_QTY Q
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND LCC_CD
                        #else
                            AND ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                WHERE
                    1=1
                    AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND A.ECC_CD = C.ECC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    AND A.ONF_HIR_DIV_CD    IN ('O','F')
                    AND SUBSTR(A.REPO_PLN_ID,5,6) <> A.PLN_YRWK	-- 새로 추가된 조건
                    #if (${fmPlnSYrWk} != '')
                        AND A.PLN_YRWK BETWEEN @[fmPlnSYrWk] AND @[fmPlnEYrWk]
                    #end
                    -- EXE 테이블과의 조인
                    AND (A.REPO_PLN_ID, A.ONF_HIR_DIV_CD, A.ECC_CD ) IN
                    (
                        SELECT
                            REPO_PLN_ID
                            , ONF_HIR_DIV_CD
                            , FM_ECC
                        FROM
                        (
                            SELECT
                                DISTINCT A.REPO_PLN_ID REPO_PLN_ID
                                , A.ONF_HIR_DIV_CD
                                , (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SUBSTR(A.FM_YD_CD,1,5) = SCC_CD) FM_ECC
                            FROM
                                EQR_ONF_HIR_EXE_PLN A
                                , EQR_ONF_HIR_EXE_PLN_QTY Q
                                , EQR_REPO_EXE_SO_IF B
                                #if (${weeklymonthly} == '2')
                                    ,EQR_WK_PRD E
                                #end
                                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                #if ($arrFmEccCd.size() > 0)
                                    #if (${fmtype} == 'R')
                                        AND B.RCC_CD
                                    #elseif (${fmtype} == 'L')
                                        AND B.LCC_CD
                                    #else
                                        AND B.ECC_CD
                                    #end
                                    IN(
                                    #foreach ($key in ${arrFmEccCd})
                                        #if($velocityCount < $arrFmEccCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )) C
                                #else
                                    ) C
                                #end
                            WHERE
                                A.REPO_PLN_ID = Q.REPO_PLN_ID
                                AND A.PLN_YRWK = Q.PLN_YRWK
                                AND A.PLN_SEQ = Q.PLN_SEQ
                                AND A.REF_ID = Q.REF_ID
                                AND A.ONF_HIR_DIV_CD IN ('O','F')
                                AND A.REPO_PLN_ID = B.REPO_PLN_ID
                                AND A.PLN_YRWK = B.PLN_YRWK
                                AND A.REF_ID   = B.REF_ID
                                AND Q.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD
                                AND B.WO_EXE_FLG ='Y' -- 중요함
                                AND SUBSTR(A.TO_YD_CD ,0,5) = C.SCC_CD
                                #if (${weeklymonthly} == '2')
                                    AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                                #end
                                #if ($arrOddtpszCd.size() > 0)
                                    AND Q.CNTR_TPSZ_CD IN(
                                    #foreach ($key in ${arrOddtpszCd})
                                        #if($velocityCount < $arrOddtpszCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )
                                #end
                                #if (${feedback} == 'on')
                                    AND REPO_PLN_FB_RSN_CD IS NOT NULL
                                #end
                                #if (${fmPlnSYrWk} != '')
                                    AND A.FM_LOC_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                                #end
                                AND A.PLN_YRWK = (SELECT PLN_YR||PLN_WK FROM EQR_WK_PRD WHERE FM_LOC_DT BETWEEN WK_ST_DT AND WK_END_DT )
                        )
                    )
                GROUP BY
                    #if (${weeklymonthly} == '1')
                        A.PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        A.PLN_YRWK, PLN_MON
                    #end
                    , A.ECC_CD
                    , ONF_HIR_DIV_CD

                UNION ALL

                -- ITEM = Rail(R), Truck(T), Water(W)  -------------------------------------------------
                -- Plan ID 3
                SELECT
                    #if (${weeklymonthly} == '1')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||SUBSTR(A.PLN_YRWK,5,6) PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                    #end
                    ,'' CO_CD
                    ,(
                        SELECT
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST
                        WHERE FM_ECC_CD = ECC_CD
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST
                            WHERE TO_ECC_CD = ECC_CD
                        ) TO_ECC_CD
                    #end
                    ,TRSP_MOD_CD
                    ,SUM(CNTR_QTY) VOL
                    ,SUM(TRSP_COST_AMT) COST
                    ,''  FEEDBACK_KEY
                    ,'1' FLAG
                FROM
                    EQR_INLND_TRSP_PLN A
                    , EQR_INLND_TRSP_PLN_QTY Q
                    , EQR_EQ_REPO_PLN B
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND LCC_CD
                        #else
                            AND ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND RCC_CD
                        #elseif (${totype} == 'L')
                            AND LCC_CD
                        #else
                            AND ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND A.REPO_PLN_ID = B.REPO_PLN_ID
                    AND FM_ECC_CD = C.ECC_CD AND TO_ECC_CD = D.ECC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${item} == 'O' || ${item} == 'F')
                        AND ONF_HIR_DIV_CD = @[item]
                    #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                        AND A.TRSP_MOD_CD = @[item]
                    #end
                    AND A.PAST_REPO_PLN_FLG NOT IN('Y')
                    AND B.REPO_PLN_DTRB_FLG ='Y'       -- 새로 추가된 조건
                    AND SUBSTR(A.REPO_PLN_ID,5,6) = A.PLN_YRWK
                    #if (${fmPlnSYrWk} != '')
                        AND FM_YRWK BETWEEN @[fmPlnSYrWk] AND @[fmPlnEYrWk]
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_YRWK BETWEEN @[toPlnSYrWk] AND @[toPlnEYrWk]
                    #end
                GROUP BY
                    #if (${weeklymonthly} == '1')
                        A.PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        A.PLN_YRWK, PLN_MON
                    #end
                    , FM_ECC_CD
                    , TO_ECC_CD
                    , TRSP_MOD_CD
                
                -- 새로 추가된 개념(20080610)
                -- CSR NO : N200805150003
                -- modified by shin yongchan - 20080602
                UNION ALL
                SELECT
                    #if (${weeklymonthly} == '1')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||SUBSTR(A.PLN_YRWK,5,6) PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                    #end
                    ,'' CO_CD
                    ,(
                        SELECT
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST
                        WHERE FM_ECC_CD = ECC_CD
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST
                            WHERE TO_ECC_CD = ECC_CD
                        ) TO_ECC_CD
                    #end
                    ,TRSP_MOD_CD
                    ,SUM(CNTR_QTY) VOL
                    ,SUM(TRSP_COST_AMT) COST
                    ,''  FEEDBACK_KEY
                    ,'1' FLAG
                FROM
                    EQR_INLND_TRSP_PLN A
                    , EQR_INLND_TRSP_PLN_QTY Q
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND LCC_CD
                        #else
                            AND ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND RCC_CD
                        #elseif (${totype} == 'L')
                            AND LCC_CD
                        #else
                            AND ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND A.PAST_REPO_PLN_FLG NOT IN('Y')
                    AND FM_ECC_CD = C.ECC_CD AND TO_ECC_CD = D.ECC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${item} == 'O' || ${item} == 'F')
                        AND ONF_HIR_DIV_CD = @[item]
                    #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                        AND A.TRSP_MOD_CD = @[item]
                    #end
                    AND SUBSTR(A.REPO_PLN_ID,5,6) <> A.PLN_YRWK
                    #if (${fmPlnSYrWk} != '')
                        AND FM_YRWK BETWEEN @[fmPlnSYrWk] AND @[fmPlnEYrWk]
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_YRWK BETWEEN @[toPlnSYrWk] AND @[toPlnEYrWk]
                    #end
                    -- EXE 테이블과의 조인
                    AND (A.REPO_PLN_ID, A.FM_ECC_CD, A.TO_ECC_CD, A.TRSP_MOD_CD ) IN
                    (
                        SELECT
                            REPO_PLN_ID
                            , FM_ECC
                            , TO_ECC
                            , TRSP_MOD_CD
                        FROM
                        (
                            SELECT
                                DISTINCT A.REPO_PLN_ID REPO_PLN_ID,
                                (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SUBSTR(A.FM_YD_CD,1,5) = SCC_CD) FM_ECC,
                                (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SUBSTR(A.TO_YD_CD,1,5) = SCC_CD) TO_ECC,
                                A.TRSP_MOD_CD
                            FROM
                                EQR_INLND_TRSP_EXE_PLN A
                                , EQR_INLND_TRSP_EXE_PLN_QTY Q
                                #if (${weeklymonthly} == '2')
                                    ,EQR_WK_PRD E
                                #end
                                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                #if ($arrFmEccCd.size() > 0)
                                    #if (${fmtype} == 'R')
                                        AND B.RCC_CD
                                    #elseif (${fmtype} == 'L')
                                        AND B.LCC_CD
                                    #else
                                        AND B.ECC_CD
                                    #end
                                    IN(
                                    #foreach ($key in ${arrFmEccCd})
                                        #if($velocityCount < $arrFmEccCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )) C
                                #else
                                    ) C
                                #end
                                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                #if ($arrToEccCd.size() > 0)
                                    #if (${totype} == 'R')
                                        AND B.RCC_CD
                                    #elseif (${totype} == 'L')
                                        AND B.LCC_CD
                                    #else
                                        AND B.ECC_CD
                                    #end
                                    IN(
                                    #foreach ($key in ${arrToEccCd})
                                        #if($velocityCount < $arrToEccCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )) D
                                #else
                                    ) D
                                #end
                            WHERE
                                1=1
                                AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                                AND A.PLN_YRWK = Q.PLN_YRWK
                                AND A.PLN_SEQ = Q.PLN_SEQ
                                AND A.REF_ID = Q.REF_ID
                                AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                                #if (${weeklymonthly} == '2')
                                    AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                                #end
                                #if ($arrOddtpszCd.size() > 0)
                                    AND Q.CNTR_TPSZ_CD IN(
                                    #foreach ($key in ${arrOddtpszCd})
                                        #if($velocityCount < $arrOddtpszCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )
                                #end
                                #if ($arrLane.size() > 0)
                                    AND VSL_LANE_CD IN(
                                    #foreach ($key in ${arrLane})
                                        #if($velocityCount < $arrLane.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )
                                #end
                                #if (${item} == 'O' || ${item} == 'F')
                                    AND ONF_HIR_DIV_CD = @[item]
                                #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                                    AND A.TRSP_MOD_CD = @[item]
                                #end
                                #if (${feedback} == 'on')
                                    AND REPO_PLN_FB_RSN_CD IS NOT NULL
                                #end
                                #if (${fmPlnSYrWk} != '')
                                    AND TO_CHAR (FM_ETD_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                                #end
                                #if (${toPlnSYrWk} != '')
                                    AND TO_CHAR (TO_ETA_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                                #end
                                AND A.PLN_YRWK =  (SELECT PLN_YR||PLN_WK FROM EQR_WK_PRD WHERE TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT )
                                AND REPO_MTY_BKG_FLG ='Y' -- 중요함
                
                            UNION ALL
                
                            SELECT
                                DISTINCT
                                A.REPO_PLN_ID REPO_PLN_ID,
                                (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SUBSTR(A.FM_YD_CD,1,5) = SCC_CD) FM_ECC,
                                (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SUBSTR(A.TO_YD_CD,1,5) = SCC_CD) TO_ECC,
                                A.TRSP_MOD_CD
                            FROM
                                EQR_INLND_TRSP_EXE_PLN A
                                , EQR_INLND_TRSP_EXE_PLN_QTY Q
                                , EQR_REPO_EXE_SO_IF B
                                #if (${weeklymonthly} == '2')
                                    ,EQR_WK_PRD E
                                #end
                                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                #if ($arrFmEccCd.size() > 0)
                                    #if (${fmtype} == 'R')
                                        AND B.RCC_CD
                                    #elseif (${fmtype} == 'L')
                                        AND B.LCC_CD
                                    #else
                                        AND B.ECC_CD
                                    #end
                                    IN(
                                    #foreach ($key in ${arrFmEccCd})
                                        #if($velocityCount < $arrFmEccCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )) C
                                #else
                                    ) C
                                #end
                                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                #if ($arrToEccCd.size() > 0)
                                    #if (${totype} == 'R')
                                        AND B.RCC_CD
                                    #elseif (${totype} == 'L')
                                        AND B.LCC_CD
                                    #else
                                        AND B.ECC_CD
                                    #end
                                    IN(
                                    #foreach ($key in ${arrToEccCd})
                                        #if($velocityCount < $arrToEccCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )) D
                                #else
                                    ) D
                                #end
                            WHERE
                                A.REPO_PLN_ID = Q.REPO_PLN_ID
                                AND A.PLN_YRWK = Q.PLN_YRWK
                                AND A.PLN_SEQ = Q.PLN_SEQ
                                AND A.REF_ID = Q.REF_ID
                                AND A.REPO_PLN_ID = B.REPO_PLN_ID
                                AND A.PLN_YRWK = B.PLN_YRWK
                                AND A.REF_ID   = B.REF_ID
                                AND Q.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD
                                AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                                #if (${weeklymonthly} == '2')
                                    AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                                #end
                                #if ($arrOddtpszCd.size() > 0)
                                    AND Q.CNTR_TPSZ_CD IN(
                                    #foreach ($key in ${arrOddtpszCd})
                                        #if($velocityCount < $arrOddtpszCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )
                                #end
                                #if ($arrLane.size() > 0)
                                    AND VSL_LANE_CD IN(
                                    #foreach ($key in ${arrLane})
                                        #if($velocityCount < $arrLane.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )
                                #end
                                #if (${item} == 'O' || ${item} == 'F')
                                    AND ONF_HIR_DIV_CD = @[item]
                                #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                                    AND A.TRSP_MOD_CD = @[item]
                                #end
                                #if (${feedback} == 'on')
                                    AND REPO_PLN_FB_RSN_CD IS NOT NULL
                                #end
                                #if (${fmPlnSYrWk} != '')
                                    AND TO_CHAR (FM_ETD_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                                #end
                                #if (${toPlnSYrWk} != '')
                                    AND TO_CHAR (TO_ETA_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                                #end
                                AND A.PLN_YRWK =  (SELECT PLN_YR||PLN_WK FROM EQR_WK_PRD WHERE TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT )
                                AND B.WO_EXE_FLG ='Y' -- 중요함
                        )
                    )
                GROUP BY
                    #if (${weeklymonthly} == '1')
                        A.PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        A.PLN_YRWK, PLN_MON
                    #end
                    , FM_ECC_CD
                    , TO_ECC_CD
                    , TRSP_MOD_CD

                UNION ALL

                #if (${adherence} == 'O')
                    ------------- ORG ONLY
                    #if (${weeklymonthly} == '1')
                        SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_YRWK
                    #else
                        SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_MON
                    #end
                        ,A.CO_CD
                        ,(
                            SELECT B.
                            #if (${fmtypeby} == 'R')
                                RCC_CD
                            #elseif (${fmtypeby} == 'C')
                                CNT_CD
                            #elseif (${fmtypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(A.FM_YD_CD ,0,5)
                        ) FM_ECC_CD
                        ,'ALL' TO_ECC_CD
                        ,A.TRSP_MOD_CD
                        --,DECODE(A.MTY_BKG_NO_SPLIT, '  ', B.CNTR_QTY, 0) VOL
                        ,DECODE(A.SPLIT_REPO_PLN_FLG, 'N', B.CNTR_QTY, 0) VOL
                        ,A.LODG_DCHG_COST_AMT COST
                        ,A.REPO_PLN_FB_RSN_CD FEEDBACK_KEY
                        ,'2' FLAG
                    FROM
                        (
                            SELECT
                                A.PLN_YRWK
                                , A.CO_CD
                                , A.TRSP_MOD_CD
                                , A.VSL_LANE_CD
                                , A.VSL_CD
                                , A.SKD_VOY_NO
                                , A.SKD_DIR_CD
                                , A.FM_YD_CD
                                , A.FM_ETD_DT
                                , A.TO_YD_CD
                                , A.TO_ETB_DT
                                , A.EQ_REPO_PURP_CD
                                , A.REPO_MTY_BKG_FLG
                                , A.REPO_PLN_FB_RSN_CD
                                , A.REPO_PLN_FB_RMK
                                , A.MTY_BKG_NO
                                , A.SPLIT_REPO_PLN_FLG
                                , A.PAST_REPO_PLN_FLG
                                , Q.CNTR_TPSZ_CD
                                , Q.CNTR_QTY
                                , Q.LODG_DCHG_COST_AMT
                                , Q.PLN_UC_AMT
                                , Q.LODG_PORT_UC_AMT
                                , Q.DCHG_PORT_UC_AMT
                            FROM
                                EQR_VSL_LODG_DCHG_EXE_PLN A
                                , EQR_VSL_EXE_PLN_QTY Q
                            WHERE
                                A.REPO_PLN_ID = Q.REPO_PLN_ID
                                AND A.PLN_YRWK = Q.PLN_YRWK
                                AND A.PLN_SEQ = Q.PLN_SEQ
                                AND A.REF_ID = Q.REF_ID
                        ) A
                        ,(
                            -- original booking vol 집계
                            SELECT
                                DISTINCT A.MTY_BKG_NO
                                ,Q.CNTR_TPSZ_CD
                                ,SUM(Q.CNTR_QTY) CNTR_QTY
                            FROM
                                EQR_VSL_LODG_DCHG_EXE_PLN A
                                ,EQR_VSL_EXE_PLN_QTY Q
                                ,(
                                    SELECT
                                        DISTINCT MTY_BKG_NO
                                    FROM
                                        EQR_VSL_LODG_DCHG_EXE_PLN A
                                        ,EQR_VSL_EXE_PLN_QTY Q
                                        #if (${weeklymonthly} == '2')
                                            ,EQR_WK_PRD E
                                        #end
                                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                        #if ($arrFmEccCd.size() > 0)
                                            #if (${fmtype} == 'R')
                                                AND B.RCC_CD
                                            #elseif (${fmtype} == 'L')
                                                AND B.LCC_CD
                                            #else
                                                AND B.ECC_CD
                                            #end
                                            IN(
                                            #foreach ($key in ${arrFmEccCd})
                                                #if($velocityCount < $arrFmEccCd.size())
                                                '$key',
                                                #else
                                                '$key'
                                                #end
                                            #end
                                            )) C
                                        #else
                                            ) C
                                        #end
                                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                        #if ($arrToEccCd.size() > 0)
                                            #if (${totype} == 'R')
                                                AND B.RCC_CD
                                            #elseif (${totype} == 'L')
                                                AND B.LCC_CD
                                            #else
                                                AND B.ECC_CD
                                            #end
                                            IN(
                                            #foreach ($key in ${arrToEccCd})
                                                #if($velocityCount < $arrToEccCd.size())
                                                '$key',
                                                #else
                                                '$key'
                                                #end
                                            #end
                                            )) D
                                        #else
                                            ) D
                                        #end
                                    WHERE
                                        A.REPO_PLN_ID = Q.REPO_PLN_ID
                                        AND A.PLN_YRWK = Q.PLN_YRWK
                                        AND A.PLN_SEQ = Q.PLN_SEQ
                                        AND A.REF_ID = Q.REF_ID
                                        AND A.REPO_MTY_BKG_FLG = 'Y'
                                        AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                                        #if (${weeklymonthly} == '2')
                                            AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                                        #end
                                        #if ($arrOddtpszCd.size() > 0)
                                            AND Q.CNTR_TPSZ_CD IN(
                                            #foreach ($key in ${arrOddtpszCd})
                                                #if($velocityCount < $arrOddtpszCd.size())
                                                '$key',
                                                #else
                                                '$key'
                                                #end
                                            #end
                                            )
                                        #end
                                        #if ($arrLane.size() > 0)
                                            AND VSL_LANE_CD IN(
                                            #foreach ($key in ${arrLane})
                                                #if($velocityCount < $arrLane.size())
                                                '$key',
                                                #else
                                                '$key'
                                                #end
                                            #end
                                            )
                                        #end
                                        #if (${item} == 'O' || ${item} == 'F')
                                            AND ONF_HIR_DIV_CD = @[item]
                                        #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                                            AND A.TRSP_MOD_CD = @[item]
                                        #end
                                        #if (${feedback} == 'on')
                                            AND REPO_PLN_FB_RSN_CD IS NOT NULL
                                        #end
                                        --AND   TRIM(A.MTY_BKG_NO_SPLIT) IS NULL
                                        AND A.SPLIT_REPO_PLN_FLG = 'N'
                                        #if(${fmPlnSYrWk} != '')
                                            AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                                        #end
                                        #if(${toPlnSYrWk} != '')
                                            AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                                        #end
                                ) B
                            WHERE 
                                A.REPO_PLN_ID = Q.REPO_PLN_ID
                                AND A.PLN_YRWK = Q.PLN_YRWK
                                AND A.PLN_SEQ = Q.PLN_SEQ
                                AND A.REF_ID = Q.REF_ID
                                AND A.MTY_BKG_NO = B.MTY_BKG_NO
                            GROUP BY A.MTY_BKG_NO ,Q.CNTR_TPSZ_CD
                        ) B
                        #if (${weeklymonthly} == '2')
                            ,EQR_WK_PRD E
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrFmEccCd.size() > 0)
                            #if (${fmtype} == 'R')
                                AND B.RCC_CD
                            #elseif (${fmtype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrFmEccCd})
                                #if($velocityCount < $arrFmEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) C
                        #else
                            ) C
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrToEccCd.size() > 0)
                            #if (${totype} == 'R')
                                AND B.RCC_CD
                            #elseif (${totype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrToEccCd})
                                #if($velocityCount < $arrToEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) D
                        #else
                            ) D
                        #end
                    WHERE
                        A.MTY_BKG_NO   = B.MTY_BKG_NO(+)
                        AND A.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD(+)
                        AND A.MTY_BKG_NO IS NOT NULL
                        AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                        #if (${weeklymonthly} == '2')
                            AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                        #end
                        #if ($arrOddtpszCd.size() > 0)
                            AND A.CNTR_TPSZ_CD IN(
                            #foreach ($key in ${arrOddtpszCd})
                                #if($velocityCount < $arrOddtpszCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if ($arrLane.size() > 0)
                            AND VSL_LANE_CD IN(
                            #foreach ($key in ${arrLane})
                                #if($velocityCount < $arrLane.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if (${item} == 'O' || ${item} == 'F')
                            AND ONF_HIR_DIV_CD = @[item]
                        #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                            AND A.TRSP_MOD_CD = @[item]
                        #end
                        #if (${feedback} == 'on')
                            AND REPO_PLN_FB_RSN_CD IS NOT NULL
                        #end
                        #if (${fmPlnSYrWk} != '')
                            AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                        #end
                        #if (${toPlnSYrWk} != '')
                            AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                        #end
                #else
                    #if (${weeklymonthly} == '1')
                        SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_YRWK
                    #else
                        SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_MON
                    #end
                        ,A.CO_CD
                        ,(
                            SELECT B.
                            #if (${fmtypeby} == 'R')
                                RCC_CD
                            #elseif (${fmtypeby} == 'C')
                                CNT_CD
                            #elseif (${fmtypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(A.FM_YD_CD ,0,5)
                        ) FM_ECC_CD
                        ,(
                            SELECT B.
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(A.TO_YD_CD ,0,5)
                        ) TO_ECC_CD
                        ,A.TRSP_MOD_CD
                        ,Q.CNTR_QTY VOL
                        ,Q.LODG_DCHG_COST_AMT COST
                        ,A.REPO_PLN_FB_RSN_CD FEEDBACK_KEY
                        ,'2' FLAG
                    FROM
                        EQR_VSL_LODG_DCHG_EXE_PLN A
                        , EQR_VSL_EXE_PLN_QTY Q
                        #if (${weeklymonthly} == '2')
                            ,EQR_WK_PRD E
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrFmEccCd.size() > 0)
                            #if (${fmtype} == 'R')
                                AND B.RCC_CD
                            #elseif (${fmtype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrFmEccCd})
                                #if($velocityCount < $arrFmEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) C
                        #else
                            ) C
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrToEccCd.size() > 0)
                            #if (${totype} == 'R')
                                AND B.RCC_CD
                            #elseif (${totype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrToEccCd})
                                #if($velocityCount < $arrToEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) D
                        #else
                            ) D
                        #end
                    WHERE
                        1=1
                        AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                        AND A.PLN_YRWK = Q.PLN_YRWK
                        AND A.PLN_SEQ = Q.PLN_SEQ
                        AND A.REF_ID = Q.REF_ID
                        AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                        #if (${weeklymonthly} == '2')
                            AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                        #end
                        #if ($arrOddtpszCd.size() > 0)
                            AND Q.CNTR_TPSZ_CD IN(
                            #foreach ($key in ${arrOddtpszCd})
                                #if($velocityCount < $arrOddtpszCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if ($arrLane.size() > 0)
                            AND VSL_LANE_CD IN(
                            #foreach ($key in ${arrLane})
                                #if($velocityCount < $arrLane.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if (${item} == 'O' || ${item} == 'F')
                            AND ONF_HIR_DIV_CD = @[item]
                        #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                            AND A.TRSP_MOD_CD = @[item]
                        #end
                        #if (${feedback} == 'on')
                            AND REPO_PLN_FB_RSN_CD IS NOT NULL
                        #end
                        AND   A.MTY_BKG_NO IS NOT NULL
                        AND   Q.CNTR_QTY > 0
                        #if (${fmPlnSYrWk} != '')
                            AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                        #end
                        #if(${toPlnSYrWk} != '')
                            AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                        #end
                #end

                UNION ALL

                -- ITEM = On-Hire(O)
                -- Execultion 2
                SELECT
                    #if (${weeklymonthly} == '1')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||SUBSTR(A.PLN_YRWK,5,6) PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                    #end
                    ,CO_CD
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD
                        AND   C.SCC_CD = CASE WHEN A.ONF_HIR_DIV_CD ='O' THEN SUBSTR(TO_YD_CD ,0,5)
                        WHEN A.ONF_HIR_DIV_CD ='F' THEN SUBSTR(FM_YD_CD ,0,5) END
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT B.
                            #if (${fmtypeby} == 'R')
                                RCC_CD
                            #elseif (${fmtypeby} == 'C')
                                CNT_CD
                            #elseif (${fmtypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD
                            AND   C.SCC_CD = CASE WHEN A.ONF_HIR_DIV_CD ='O' THEN SUBSTR(TO_YD_CD ,0,5)
                            WHEN A.ONF_HIR_DIV_CD ='F' THEN SUBSTR(FM_YD_CD ,0,5) END
                        ) TO_ECC_CD
                    #end
                    ,ONF_HIR_DIV_CD TRSP_MOD_CD
                    ,CNTR_QTY VOL
                    ,ONF_HIR_COST_AMT COST
                    ,REPO_PLN_FB_RSN_CD FEEDBACK_KEY
                    ,'2' FLAG
                FROM
                    EQR_ONF_HIR_EXE_PLN A
                    , EQR_ONF_HIR_EXE_PLN_QTY Q
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND B.RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                WHERE
                    A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND A.REF_ID = Q.REF_ID
                    AND A.ONF_HIR_DIV_CD IN ('O','F')
                    AND CASE WHEN A.ONF_HIR_DIV_CD ='O' THEN SUBSTR(TO_YD_CD ,0,5)
                    WHEN A.ONF_HIR_DIV_CD ='F' THEN SUBSTR(FM_YD_CD ,0,5) END = C.SCC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${feedback} == 'on')
                        AND REPO_PLN_FB_RSN_CD IS NOT NULL
                    #end
                    AND CNTR_QTY <> 0
                    #if (${fmPlnSYrWk} != '')
                        AND FM_LOC_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end

                UNION ALL

                -- ITEM = Rail(R), Truck(T), Water(W)
                -- Execultion 3
                SELECT
                    #if (${weeklymonthly} == '1')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||SUBSTR(A.PLN_YRWK,5,6) PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                    #end
                    ,CO_CD
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(FM_YD_CD ,0,5)
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT B.
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                        ) TO_ECC_CD
                    #end
                    ,TRSP_MOD_CD
                    ,CNTR_QTY VOL
                    ,TRSP_COST_AMT COST
                    ,REPO_PLN_FB_RSN_CD    FEEDBACK_KEY
                    ,'2' FLAG
                FROM
                    EQR_INLND_TRSP_EXE_PLN A
                    , EQR_INLND_TRSP_EXE_PLN_QTY Q
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND B.RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND B.RCC_CD
                        #elseif (${totype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    1=1
                    AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND A.REF_ID = Q.REF_ID
                    AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${item} == 'O' || ${item} == 'F')
                        AND ONF_HIR_DIV_CD = @[item]
                    #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                        AND A.TRSP_MOD_CD = @[item]
                    #end
                    #if (${feedback} == 'on')
                        AND REPO_PLN_FB_RSN_CD IS NOT NULL
                    #end
                    AND CNTR_QTY <> 0
                    AND PAST_REPO_PLN_FLG NOT IN ('Y')
                    #if (${fmPlnSYrWk} != '')
                        AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_CHAR(TO_ETA_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                    #end

                UNION ALL

                -- ITEM = Shuttle(S)
                -- Execultion 4
                SELECT
                    #if (${weeklymonthly} == '1')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||SUBSTR(A.PLN_YRWK,5,6) PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                    #end
                    ,CO_CD
                    ,(
                        SELECT
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM MDM_EQ_ORZ_CHT
                        WHERE SCC_CD = SUBSTR(FM_YD_CD ,0,5)
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM MDM_EQ_ORZ_CHT
                            WHERE SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                        ) TO_ECC_CD
                    #end
                    ,'S' TRSP_MOD_CD
                    ,CNTR_QTY VOL
                    ,TRSP_COST_AMT COST
                    ,'' FEEDBACK_KEY
                    ,'2' FLAG
                FROM
                    EQR_ECC_INTER_EXE_PLN A
                    , EQR_ECC_INTER_EXE_PLN_QTY Q
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND B.RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND B.RCC_CD
                        #elseif (${totype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    1=1
                    AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.REF_ID = Q.REF_ID
                    AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${fmPlnSYrWk} != '')
                        AND A.PLN_YRWK BETWEEN @[fmPlnSYrWk] AND @[fmPlnEYrWk]
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND A.PLN_YRWK BETWEEN @[fmPlnSYrWk] AND @[fmPlnEYrWk]
                    #end

                UNION ALL

                -- ITEM = Rail(R), Truck(T), Water(W), Shuttle(S) ------------------------------------------------
                -- W/O 1
                SELECT
                    #if (${weeklymonthly} == '1')
                        SUBSTR(PLN_YRWK,0,4)||'-'||SUBSTR(PLN_YRWK,5,6) PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        SUBSTR(PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                    #end
                    ,CO_CD
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(FM_YD_CD ,0,5)
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT B.
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                        ) TO_ECC_CD
                    #end
                    ,SO_IF_DIV_CD TRSP_MOD_CD
                    ,COUNT(CNTR_TPSZ_CD) VOL
                    ,SUM(REPO_COST_AMT) COST
                    ,''  FEEDBACK_KEY
                    ,'3' FLAG
                FROM
                    EQR_REPO_EXE_SO_IF A
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND B.RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND B.RCC_CD
                        #elseif (${totype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE 1=1
                    AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    AND WO_EXE_FLG = 'Y'
                    #if ($arrOddtpszCd.size() > 0)
                        AND A.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${item} == '')
                        AND SO_IF_DIV_CD IN('R','T','W','S')
                    #else
                        AND SO_IF_DIV_CD = @[item]
                    #end
                    AND PAST_REPO_PLN_FLG NOT IN ('Y')
                    #if (${fmPlnSYrWk} != '')
                        AND FM_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                    #end
                GROUP BY
                    #if (${weeklymonthly} == '1')
                        PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        PLN_YRWK, PLN_MON
                    #end
                    , CO_CD
                    , FM_YD_CD
                    , TO_YD_CD
                    , SO_IF_DIV_CD

                UNION ALL

                -- ITEM = On-Hire(O)
                -- W/O 1
                SELECT
                    #if (${weeklymonthly} == '1')
                        SUBSTR(PLN_YRWK,0,4)||'-'||SUBSTR(PLN_YRWK,5,6) PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        SUBSTR(PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                    #end
                    ,CO_CD
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD =
                        CASE WHEN SO_IF_DIV_CD = 'O' THEN SUBSTR(TO_YD_CD ,0,5)
                        WHEN SO_IF_DIV_CD = 'F' THEN SUBSTR(FM_YD_CD ,0,5) END
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT B.
                            #if (${fmtypeby} == 'R')
                                RCC_CD
                            #elseif (${fmtypeby} == 'C')
                                CNT_CD
                            #elseif (${fmtypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD =
                            CASE WHEN SO_IF_DIV_CD = 'O' THEN SUBSTR(TO_YD_CD ,0,5)
                            WHEN SO_IF_DIV_CD = 'F' THEN SUBSTR(FM_YD_CD ,0,5) END
                        ) TO_ECC_CD
                    #end
                    ,SO_IF_DIV_CD TRSP_MOD_CD
                    ,COUNT(CNTR_TPSZ_CD) VOL
                    ,SUM(REPO_COST_AMT) COST
                    ,''  FEEDBACK_KEY
                    ,'3' FLAG
                FROM
                    EQR_REPO_EXE_SO_IF A
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND B.RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                WHERE
                    SO_IF_DIV_CD IN ('O','F')
                    AND CASE WHEN SO_IF_DIV_CD = 'O' THEN SUBSTR(TO_YD_CD ,0,5)
                    WHEN SO_IF_DIV_CD = 'F' THEN SUBSTR(FM_YD_CD ,0,5) END = C.SCC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    AND WO_EXE_FLG   = 'Y'
                    #if ($arrOddtpszCd.size() > 0)
                        AND A.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${fmPlnSYrWk} != '')
                        AND FM_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
                GROUP BY
                    #if (${weeklymonthly} == '1')
                        PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        PLN_YRWK, PLN_MON
                    #end
                    , CO_CD,FM_YD_CD
                    , TO_YD_CD
                    , SO_IF_DIV_CD
                    , CNTR_TPSZ_CD

                UNION ALL

                -- ITEM = On-Hire(O)  RUN_SO
                -- w/o 1
                SELECT
                    #if (${weeklymonthly} == '1')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||SUBSTR(A.PLN_YRWK,5,6) PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                    #end
                    ,CO_CD
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                    ) FM_ECC_CD
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                    ) TO_ECC_CD
                    ,ONF_HIR_DIV_CD TRSP_MOD_CD
                    ,CNTR_QTY  VOL
                    ,ONF_HIR_COST_AMT
                    ,''  FEEDBACK_KEY
                    ,'3' FLAG
                FROM
                    EQR_ONF_HIR_EXE_PLN A
                    , EQR_ONF_HIR_EXE_PLN_QTY Q
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND B.RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                WHERE
                    A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND A.REF_ID = Q.REF_ID
                    AND ONF_HIR_DIV_CD IN ('O','F')
                    AND CASE WHEN ONF_HIR_DIV_CD = 'O' THEN SUBSTR(TO_YD_CD, 0,5)
                    WHEN ONF_HIR_DIV_CD = 'F' THEN SUBSTR(FM_YD_CD, 0,5) END = C.SCC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    AND NON_SO_ISS_FLG ='Y'
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${fmPlnSYrWk} != '')
                        AND FM_LOC_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end

                UNION ALL

                #if (${adherence} == 'O')
                    -- ITEM = T.VVD
                    -- W/O 2
                    ------------- ORG ONLY
                    #if (${weeklymonthly} == '1')
                        SELECT
                            (
                                SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                                FROM EQR_WK_PRD
                                WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                            )  PLN_YRWK
                    #else
                        SELECT
                            (
                                SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                                FROM EQR_WK_PRD
                                WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                            )  PLN_MON
                    #end
                        ,A.CO_CD
                        ,(
                            SELECT B.
                            #if (${fmtypeby} == 'R')
                                RCC_CD
                            #elseif (${fmtypeby} == 'C')
                                CNT_CD
                            #elseif (${fmtypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(A.FM_YD_CD ,0,5)
                        ) FM_ECC_CD
                        ,'ALL' TO_ECC_CD
                        ,A.TRSP_MOD_CD
                        --,DECODE(A.MTY_BKG_NO_SPLIT, '  ', B.CNTR_QTY, 0) VOL
                        ,DECODE(A.SPLIT_REPO_PLN_FLG, 'N', B.CNTR_QTY, 0) VOL
                        ,A.LODG_DCHG_COST_AMT COST
                        ,'' FEEDBACK_KEY
                        ,'3' FLAG    -- W/O FLAG
                    FROM
                        (
                            SELECT
                                A.PLN_YRWK
                                , A.CO_CD
                                , A.TRSP_MOD_CD
                                , A.VSL_LANE_CD
                                , A.VSL_CD
                                , A.SKD_VOY_NO
                                , A.SKD_DIR_CD
                                , A.FM_YD_CD
                                , A.FM_ETD_DT
                                , A.TO_YD_CD
                                , A.TO_ETB_DT
                                , A.EQ_REPO_PURP_CD
                                , A.REPO_MTY_BKG_FLG
                                , A.REPO_PLN_FB_RSN_CD
                                , A.REPO_PLN_FB_RMK
                                , A.MTY_BKG_NO
                                , A.SPLIT_REPO_PLN_FLG
                                , A.PAST_REPO_PLN_FLG
                                , Q.CNTR_TPSZ_CD
                                , Q.CNTR_QTY
                                , Q.LODG_DCHG_COST_AMT
                                , Q.PLN_UC_AMT
                                , Q.LODG_PORT_UC_AMT
                                , Q.DCHG_PORT_UC_AMT
                            FROM
                                EQR_VSL_LODG_DCHG_EXE_PLN A
                                , EQR_VSL_EXE_PLN_QTY Q
                            WHERE
                                A.REPO_PLN_ID = Q.REPO_PLN_ID
                                AND A.PLN_YRWK = Q.PLN_YRWK
                                AND A.PLN_SEQ = Q.PLN_SEQ
                                AND A.REF_ID = Q.REF_ID
                        ) A
                        ,(
                            -- original booking vol 집계
                            SELECT
                                DISTINCT A.MTY_BKG_NO
                                ,Q.CNTR_TPSZ_CD
                                ,SUM(Q.CNTR_QTY) CNTR_QTY
                            FROM
                                EQR_VSL_LODG_DCHG_EXE_PLN A
                                , EQR_VSL_EXE_PLN_QTY Q
                                ,(
                                    SELECT
                                        DISTINCT MTY_BKG_NO
                                    FROM
                                        EQR_VSL_LODG_DCHG_EXE_PLN A
                                        , EQR_VSL_EXE_PLN_QTY Q
                                        #if (${weeklymonthly} == '2')
                                            ,EQR_WK_PRD E
                                        #end
                                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                        #if ($arrFmEccCd.size() > 0)
                                            #if (${fmtype} == 'R')
                                                AND B.RCC_CD
                                            #elseif (${fmtype} == 'L')
                                                AND B.LCC_CD
                                            #else
                                                AND B.ECC_CD
                                            #end
                                            IN(
                                            #foreach ($key in ${arrFmEccCd})
                                                #if($velocityCount < $arrFmEccCd.size())
                                                '$key',
                                                #else
                                                '$key'
                                                #end
                                            #end
                                            )) C
                                        #else
                                            ) C
                                        #end
                                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                        #if ($arrToEccCd.size() > 0)
                                            #if (${totype} == 'R')
                                                AND B.RCC_CD
                                            #elseif (${totype} == 'L')
                                                AND B.LCC_CD
                                            #else
                                                AND B.ECC_CD
                                            #end
                                            IN(
                                            #foreach ($key in ${arrToEccCd})
                                                #if($velocityCount < $arrToEccCd.size())
                                                '$key',
                                                #else
                                                '$key'
                                                #end
                                            #end
                                            )) D
                                        #else
                                            ) D
                                        #end
                                    WHERE
                                        A.REPO_PLN_ID = Q.REPO_PLN_ID
                                        AND A.PLN_YRWK = Q.PLN_YRWK
                                        AND A.PLN_SEQ = Q.PLN_SEQ
                                        AND A.REF_ID = Q.REF_ID
                                        AND A.REPO_MTY_BKG_FLG = 'Y'
                                        AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                                        #if (${weeklymonthly} == '2')
                                            AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                                        #end
                                        #if ($arrOddtpszCd.size() > 0)
                                            AND Q.CNTR_TPSZ_CD IN(
                                            #foreach ($key in ${arrOddtpszCd})
                                                #if($velocityCount < $arrOddtpszCd.size())
                                                '$key',
                                                #else
                                                '$key'
                                                #end
                                            #end
                                            )
                                        #end
                                        #if ($arrLane.size() > 0)
                                            AND VSL_LANE_CD IN(
                                            #foreach ($key in ${arrLane})
                                                #if($velocityCount < $arrLane.size())
                                                '$key',
                                                #else
                                                '$key'
                                                #end
                                            #end
                                            )
                                        #end
                                        #if (${item} == 'O' || ${item} == 'F')
                                            AND ONF_HIR_DIV_CD = @[item]
                                        #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                                            AND A.TRSP_MOD_CD = @[item]
                                        #end
                                        #if (${feedback} == 'on')
                                            AND REPO_PLN_FB_RSN_CD IS NOT NULL
                                        #end
                                        --AND   TRIM(A.MTY_BKG_NO_SPLIT) IS NULL
                                        AND A.SPLIT_REPO_PLN_FLG = 'N'
                                        #if (${fmPlnSYrWk} != '')
                                            AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                                        #end
                                        #if (${toPlnSYrWk} != '')
                                            AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                                        #end
                                ) B
                            WHERE 
                                A.REPO_PLN_ID = Q.REPO_PLN_ID
                                AND A.PLN_YRWK = Q.PLN_YRWK
                                AND A.PLN_SEQ = Q.PLN_SEQ
                                AND A.REF_ID = Q.REF_ID
                                AND A.MTY_BKG_NO = B.MTY_BKG_NO
                            GROUP BY A.MTY_BKG_NO ,Q.CNTR_TPSZ_CD
                        ) B
                        #if (${weeklymonthly} == '2')
                            ,EQR_WK_PRD E
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrFmEccCd.size() > 0)
                            #if (${fmtype} == 'R')
                                AND B.RCC_CD
                            #elseif (${fmtype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrFmEccCd})
                                #if($velocityCount < $arrFmEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) C
                        #else
                            ) C
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrToEccCd.size() > 0)
                            #if (${totype} == 'R')
                                AND B.RCC_CD
                            #elseif (${totype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrToEccCd})
                                #if($velocityCount < $arrToEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) D
                        #else
                            ) D
                        #end
                    WHERE
                        A.MTY_BKG_NO   = B.MTY_BKG_NO(+)
                        AND A.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD(+)
                        AND A.MTY_BKG_NO IS NOT NULL
                        AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                        #if (${weeklymonthly} == '2')
                            AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                        #end
                        #if ($arrOddtpszCd.size() > 0)
                            AND A.CNTR_TPSZ_CD IN(
                            #foreach ($key in ${arrOddtpszCd})
                                #if($velocityCount < $arrOddtpszCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if ($arrLane.size() > 0)
                            AND VSL_LANE_CD IN(
                            #foreach ($key in ${arrLane})
                                #if($velocityCount < $arrLane.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if (${item} == 'O' || ${item} == 'F')
                            AND ONF_HIR_DIV_CD = @[item]
                        #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                            AND A.TRSP_MOD_CD = @[item]
                        #end
                        #if (${feedback} == 'on')
                            AND REPO_PLN_FB_RSN_CD IS NOT NULL
                        #end
                        #if (${fmPlnSYrWk} != '')
                            AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                        #end
                        #if (${toPlnSYrWk} != '')
                            AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                        #end
                #else
                    -- ITEM = T.VVD
                    -- W/O 2
                    #if (${weeklymonthly} == '1')
                        SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_YRWK
                    #else
                        SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_MON
                    #end
                        ,A.CO_CD
                        ,(
                            SELECT B.
                            #if (${fmtypeby} == 'R')
                                RCC_CD
                            #elseif (${fmtypeby} == 'C')
                                CNT_CD
                            #elseif (${fmtypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(A.FM_YD_CD ,0,5)
                        ) FM_ECC_CD
                        ,(
                            SELECT B.
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(A.TO_YD_CD ,0,5)
                        ) TO_ECC_CD
                        ,A.TRSP_MOD_CD
                        ,Q.CNTR_QTY VOL
                        ,Q.LODG_DCHG_COST_AMT COST
                        ,'' FEEDBACK_KEY
                        ,'3' FLAG
                    FROM
                        EQR_VSL_LODG_DCHG_EXE_PLN A
                        , EQR_VSL_EXE_PLN_QTY Q
                        #if (${weeklymonthly} == '2')
                            ,EQR_WK_PRD E
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrFmEccCd.size() > 0)
                            #if (${fmtype} == 'R')
                                AND B.RCC_CD
                            #elseif (${fmtype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrFmEccCd})
                                #if($velocityCount < $arrFmEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) C
                        #else
                            ) C
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrToEccCd.size() > 0)
                            #if (${totype} == 'R')
                                AND B.RCC_CD
                            #elseif (${totype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrToEccCd})
                                #if($velocityCount < $arrToEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) D
                        #else
                            ) D
                        #end
                    WHERE
                        1=1
                        AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                        AND A.PLN_YRWK = Q.PLN_YRWK
                        AND A.PLN_SEQ = Q.PLN_SEQ
                        AND A.REF_ID = Q.REF_ID
                        AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                        #if (${weeklymonthly} == '2')
                            AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                        #end
                        #if ($arrOddtpszCd.size() > 0)
                            AND Q.CNTR_TPSZ_CD IN(
                            #foreach ($key in ${arrOddtpszCd})
                                #if($velocityCount < $arrOddtpszCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if ($arrLane.size() > 0)
                            AND VSL_LANE_CD IN(
                            #foreach ($key in ${arrLane})
                                #if($velocityCount < $arrLane.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if (${item} == 'O' || ${item} == 'F')
                            AND ONF_HIR_DIV_CD = @[item]
                        #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                            AND A.TRSP_MOD_CD = @[item]
                        #end
                        #if (${feedback} == 'on')
                            AND REPO_PLN_FB_RSN_CD IS NOT NULL
                        #end
                        AND   A.MTY_BKG_NO IS NOT NULL
                        AND   Q.CNTR_QTY > 0
                        #if (${fmPlnSYrWk} != '')
                            AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                        #end
                        #if (${toPlnSYrWk} != '')
                            AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                        #end
                #end

                UNION ALL

                ---------------------- FEEDBACK -------------------------------
                -- VESSEL FEEDBACK
                SELECT
                    A.
                    #if (${weeklymonthly} == '1')
                        PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        PLN_MON
                    #end
                    ,A.CO_CD
                    ,A.FM_ECC_CD
                    ,A.TO_ECC_CD
                    ,A.TRSP_MOD_CD
                    ,SUM(A.RSN_COUNT) VOL
                    ,0 COST
                    ,A.REPO_PLN_FB_RSN_CD FEEDBACK_KEY
                    ,'4' FLAG
                FROM
                (
                    SELECT
                        DISTINCT A.REF_ID
                        ,A.CO_CD
                        ,A.TRSP_MOD_CD
                        #if (${weeklymonthly} == '1')
                            ,(
                                SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                                FROM EQR_WK_PRD
                                WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                            )  PLN_YRWK
                        #else
                            ,(
                                SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                                FROM EQR_WK_PRD
                                WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                            )  PLN_MON
                        #end
                        ,(
                            SELECT B.
                            #if (${fmtypeby} == 'R')
                                RCC_CD
                            #elseif (${fmtypeby} == 'C')
                                CNT_CD
                            #elseif (${fmtypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(FM_YD_CD ,0,5)
                        ) FM_ECC_CD
                        #if (${adherence} == 'O')
                            ,'ALL' TO_ECC_CD
                        #else
                            ,(
                                SELECT B.
                                #if (${totypeby} == 'R')
                                    RCC_CD
                                #elseif (${totypeby} == 'C')
                                    CNT_CD
                                #elseif (${totypeby} == 'L')
                                    LCC_CD
                                #else
                                    ECC_CD
                                #end
                                FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                                WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                            ) TO_ECC_CD
                        #end
                        ,A.MTY_BKG_NO
                        --,A.MTY_BKG_NO_SPLIT
                        ,A.REPO_PLN_FB_RSN_CD
                        ,1 RSN_COUNT
                    FROM
                        EQR_VSL_LODG_DCHG_EXE_PLN A
                        , EQR_VSL_EXE_PLN_QTY Q
                        #if (${weeklymonthly} == '2')
                            ,EQR_WK_PRD E
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrFmEccCd.size() > 0)
                            #if (${fmtype} == 'R')
                                AND B.RCC_CD
                            #elseif (${fmtype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrFmEccCd})
                                #if($velocityCount < $arrFmEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) C
                        #else
                            ) C
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrToEccCd.size() > 0)
                            #if (${totype} == 'R')
                                AND B.RCC_CD
                            #elseif (${totype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrToEccCd})
                                #if($velocityCount < $arrToEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) D
                        #else
                            ) D
                        #end
                    WHERE
                        1=1
                        AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                        AND A.PLN_YRWK = Q.PLN_YRWK
                        AND A.PLN_SEQ = Q.PLN_SEQ
                        AND A.REF_ID = Q.REF_ID
                        AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                        #if (${weeklymonthly} == '2')
                            AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                        #end
                        #if ($arrOddtpszCd.size() > 0)
                            AND Q.CNTR_TPSZ_CD IN(
                            #foreach ($key in ${arrOddtpszCd})
                                #if($velocityCount < $arrOddtpszCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if ($arrLane.size() > 0)
                            AND VSL_LANE_CD IN(
                            #foreach ($key in ${arrLane})
                                #if($velocityCount < $arrLane.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if (${item} == 'O' || ${item} == 'F')
                            AND ONF_HIR_DIV_CD = @[item]
                        #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                            AND A.TRSP_MOD_CD = @[item]
                        #end
                        #if (${feedback} == 'on')
                            AND REPO_PLN_FB_RSN_CD IS NOT NULL
                        #end
                        AND   A.MTY_BKG_NO IS NOT NULL
                        --AND   TRIM(A.MTY_BKG_NO_SPLIT) IS NULL
                        AND   SPLIT_REPO_PLN_FLG = 'N'
                        AND   A.REPO_PLN_FB_RSN_CD IS NOT NULL
                        #if (${fmPlnSYrWk} != '')
                            AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                            AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                        #end
                        #if (${toPlnSYrWk} != '')
                            AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                            AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                        #end
                ) A
                GROUP BY
                    A.
                    #if (${weeklymonthly} == '1')
                        PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        PLN_MON
                    #end
                    ,A.CO_CD
                    ,A.FM_ECC_CD
                    ,A.TO_ECC_CD
                    ,A.TRSP_MOD_CD
                    ,A.REPO_PLN_FB_RSN_CD

                UNION ALL

                -- INLAND FEEDBACK
                SELECT
                    A.
                    #if (${weeklymonthly} == '1')
                        PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        PLN_MON
                    #end
                    ,A.CO_CD
                    ,A.FM_ECC_CD
                    ,A.TO_ECC_CD
                    ,A.TRSP_MOD_CD
                    ,SUM(A.RSN_COUNT) VOL
                    ,0 COST
                    ,A.REPO_PLN_FB_RSN_CD FEEDBACK_KEY
                    ,'4' FLAG
                FROM
                (
                    SELECT
                        DISTINCT A.REF_ID
                        ,A.CO_CD
                        ,A.TRSP_MOD_CD
                        #if (${weeklymonthly} == '1')
                            ,(
                                SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                                FROM EQR_WK_PRD
                                WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                            )  PLN_YRWK
                        #else
                            ,(
                                SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                                FROM EQR_WK_PRD
                                WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                            )  PLN_MON
                        #end
                        ,(
                            SELECT B.
                            #if (${fmtypeby} == 'R')
                                RCC_CD
                            #elseif (${fmtypeby} == 'C')
                                CNT_CD
                            #elseif (${fmtypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(FM_YD_CD ,0,5)
                        ) FM_ECC_CD
                        #if (${adherence} == 'O')
                            ,'ALL' TO_ECC_CD
                        #else
                            ,(
                                SELECT B.
                                #if (${totypeby} == 'R')
                                    RCC_CD
                                #elseif (${totypeby} == 'C')
                                    CNT_CD
                                #elseif (${totypeby} == 'L')
                                    LCC_CD
                                #else
                                    ECC_CD
                                #end
                                FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                                WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                            ) TO_ECC_CD
                        #end
                        ,A.MTY_BKG_NO
                        --,A.MTY_BKG_NO_SPLIT
                        ,A.REPO_PLN_FB_RSN_CD
                        ,1 RSN_COUNT
                    FROM
                        EQR_INLND_TRSP_EXE_PLN A
                        , EQR_INLND_TRSP_EXE_PLN_QTY Q
                        #if (${weeklymonthly} == '2')
                            ,EQR_WK_PRD E
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrFmEccCd.size() > 0)
                            #if (${fmtype} == 'R')
                                AND B.RCC_CD
                            #elseif (${fmtype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrFmEccCd})
                                #if($velocityCount < $arrFmEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) C
                        #else
                            ) C
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrToEccCd.size() > 0)
                            #if (${totype} == 'R')
                                AND B.RCC_CD
                            #elseif (${totype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrToEccCd})
                                #if($velocityCount < $arrToEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) D
                        #else
                            ) D
                        #end
                    WHERE
                        1=1
                        AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                        AND A.PLN_YRWK = Q.PLN_YRWK
                        AND A.PLN_SEQ = Q.PLN_SEQ
                        AND A.REF_ID = Q.REF_ID
                        AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                        #if (${weeklymonthly} == '2')
                            AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                        #end
                        #if ($arrOddtpszCd.size() > 0)
                            AND Q.CNTR_TPSZ_CD IN(
                            #foreach ($key in ${arrOddtpszCd})
                                #if($velocityCount < $arrOddtpszCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if ($arrLane.size() > 0)
                            AND VSL_LANE_CD IN(
                            #foreach ($key in ${arrLane})
                                #if($velocityCount < $arrLane.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if (${item} == 'O' || ${item} == 'F')
                            AND ONF_HIR_DIV_CD = @[item]
                        #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                            AND A.TRSP_MOD_CD = @[item]
                        #end
                        #if (${feedback} == 'on')
                            AND REPO_PLN_FB_RSN_CD IS NOT NULL
                        #end
                        AND CNTR_QTY <> 0
                        AND PAST_REPO_PLN_FLG NOT IN ('Y')
                        #if (${fmPlnSYrWk} != '')
                            AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                            AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                        #end
                        #if (${toPlnSYrWk} != '')
                            AND TO_CHAR(TO_ETA_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                            AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                        #end
                ) A
                GROUP BY
                    A.
                    #if (${weeklymonthly} == '1')
                        PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        PLN_MON
                    #end
                    ,A.CO_CD
                    ,A.FM_ECC_CD
                    ,A.TO_ECC_CD
                    ,A.TRSP_MOD_CD
                    ,A.REPO_PLN_FB_RSN_CD

                UNION ALL

                -- ON-OFF HIRE FEEDBACK
                SELECT
                    A.
                    #if (${weeklymonthly} == '1')
                        PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        PLN_MON
                    #end
                    ,A.CO_CD
                    ,A.FM_ECC_CD
                    ,A.TO_ECC_CD
                    ,A.TRSP_MOD_CD
                    ,SUM(A.RSN_COUNT) VOL
                    ,0 COST
                    ,A.REPO_PLN_FB_RSN_CD FEEDBACK_KEY
                    ,'4' FLAG
                FROM
                (
                    SELECT
                        DISTINCT A.REF_ID
                        ,A.CO_CD
                        ,A.ONF_HIR_DIV_CD TRSP_MOD_CD
                        #if (${weeklymonthly} == '1')
                            ,(
                                SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                                FROM EQR_WK_PRD
                                WHERE A.FM_LOC_DT BETWEEN WK_ST_DT AND WK_END_DT
                            )  PLN_YRWK
                        #else
                            ,(
                                SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                                FROM EQR_WK_PRD
                                WHERE A.FM_LOC_DT BETWEEN WK_ST_DT AND WK_END_DT
                            )  PLN_MON
                        #end
                        ,(
                            SELECT B.
                            #if (${fmtypeby} == 'R')
                                RCC_CD
                            #elseif (${fmtypeby} == 'C')
                                CNT_CD
                            #elseif (${fmtypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(FM_YD_CD ,0,5)
                        ) FM_ECC_CD
                        #if (${adherence} == 'O')
                            ,'ALL' TO_ECC_CD
                        #else
                            ,(
                                SELECT B.
                                #if (${totypeby} == 'R')
                                    RCC_CD
                                #elseif (${totypeby} == 'C')
                                    CNT_CD
                                #elseif (${totypeby} == 'L')
                                    LCC_CD
                                #else
                                    ECC_CD
                                #end
                                FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                                WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                            ) TO_ECC_CD
                        #end
                        ,A.REPO_PLN_FB_RSN_CD
                        ,1 RSN_COUNT
                    FROM
                        EQR_ONF_HIR_EXE_PLN A
                        , EQR_ONF_HIR_EXE_PLN_QTY Q
                        #if (${weeklymonthly} == '2')
                            ,EQR_WK_PRD E
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrFmEccCd.size() > 0)
                            #if (${fmtype} == 'R')
                                AND B.RCC_CD
                            #elseif (${fmtype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrFmEccCd})
                                #if($velocityCount < $arrFmEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) C
                        #else
                            ) C
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrToEccCd.size() > 0)
                            #if (${totype} == 'R')
                                AND B.RCC_CD
                            #elseif (${totype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrToEccCd})
                                #if($velocityCount < $arrToEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) D
                        #else
                            ) D
                        #end
                    WHERE
                        1=1
                        AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                        AND A.PLN_YRWK = Q.PLN_YRWK
                        AND A.PLN_SEQ = Q.PLN_SEQ
                        AND A.REF_ID = Q.REF_ID
                        AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                        #if (${weeklymonthly} == '2')
                            AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                        #end
                        #if ($arrOddtpszCd.size() > 0)
                            AND Q.CNTR_TPSZ_CD IN(
                            #foreach ($key in ${arrOddtpszCd})
                                #if($velocityCount < $arrOddtpszCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if ($arrLane.size() > 0)
                            AND VSL_LANE_CD IN(
                            #foreach ($key in ${arrLane})
                                #if($velocityCount < $arrLane.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if (${item} == 'O' || ${item} == 'F')
                            AND ONF_HIR_DIV_CD = @[item]
                        #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                            AND A.TRSP_MOD_CD = @[item]
                        #end
                        #if (${feedback} == 'on')
                            AND REPO_PLN_FB_RSN_CD IS NOT NULL
                        #end
                        #if (${fmPlnSYrWk} != '')
                            AND FM_LOC_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                            AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                        #end
                ) A
                GROUP BY
                    A.
                    #if (${weeklymonthly} == '1')
                        PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        PLN_MON
                    #end
                    ,A.CO_CD
                    ,A.FM_ECC_CD
                    ,A.TO_ECC_CD
                    ,A.TRSP_MOD_CD
                    ,A.REPO_PLN_FB_RSN_CD
            #else
                -- ITEM = T.VVD ------------------------------------------------------------------------------------------------
                -- Plan ID 1
                #if(${weeklymonthly} == '1')
                    SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_YRWK
                #else
                    SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_MON
                #end
                    ,'' CO_CD
                    ,(
                        SELECT
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST
                        WHERE FM_ECC_CD = ECC_CD
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST
                            WHERE TO_ECC_CD = ECC_CD
                        ) TO_ECC_CD
                    #end
                    ,TRSP_MOD_CD
                    ,SUM(CNTR_QTY) VOL
                    ,SUM(LODG_DCHG_COST_AMT) COST
                    ,'' FEEDBACK_KEY
                    ,'1' FLAG
                FROM
                    EQR_VSL_LODG_DCHG_PLN A
                    ,EQR_VSL_LODG_DCHG_PLN_QTY Q
                    ,EQR_EQ_REPO_PLN B
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND LCC_CD
                        #else
                            AND ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND RCC_CD
                        #elseif (${totype} == 'L')
                            AND LCC_CD
                        #else
                            AND ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND A.REPO_PLN_ID = B.REPO_PLN_ID
                    AND FM_ECC_CD = C.ECC_CD AND TO_ECC_CD = D.ECC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    AND PAST_REPO_PLN_FLG NOT IN('Y')
                    AND B.REPO_PLN_DTRB_FLG ='Y'       -- 새로 추가된 조건
                    AND SUBSTR(A.REPO_PLN_ID,5,6) = A.PLN_YRWK
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${fmPlnSYrWk} != '')
                        AND TO_CHAR (FM_ETD_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_CHAR (TO_ETB_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                    #end
                GROUP BY
                    A.FM_ETD_DT, FM_ECC_CD, TO_ECC_CD, TRSP_MOD_CD
                
                -- 새로 추가된 개념(20080610)
                -- CSR NO : N200805150003
                -- modified by shin yongchan - 20080602
                UNION ALL
                #if(${weeklymonthly} == '1')
                    SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_WK  PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_YRWK
                #else
                    SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_MON
                #end
                    ,'' CO_CD
                    ,(
                        SELECT
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST
                        WHERE FM_ECC_CD = ECC_CD
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST
                             WHERE TO_ECC_CD = ECC_CD
                        ) TO_ECC_CD
                    #end
                    ,TRSP_MOD_CD
                    ,SUM(CNTR_QTY) VOL
                    ,SUM(LODG_DCHG_COST_AMT) COST
                    ,'' FEEDBACK_KEY
                    ,'1' FLAG
                FROM
                    EQR_VSL_LODG_DCHG_PLN A
                    , EQR_VSL_LODG_DCHG_PLN_QTY Q
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND LCC_CD
                        #else
                            AND ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND RCC_CD
                        #elseif (${totype} == 'L')
                            AND LCC_CD
                        #else
                            AND ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND PAST_REPO_PLN_FLG NOT IN ('Y')
                    AND FM_ECC_CD = C.ECC_CD AND TO_ECC_CD = D.ECC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    AND SUBSTR(A.REPO_PLN_ID,5,6) <> A.PLN_YRWK
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${fmPlnSYrWk} != '')
                        AND TO_CHAR (FM_ETD_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_CHAR (TO_ETB_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                    #end
                    AND (A.REPO_PLN_ID, A.VSL_LANE_CD, A.VSL_CD, A.SKD_VOY_NO, A.SKD_DIR_CD, A.FM_ECC_CD, A.TO_ECC_CD ) IN
                    (
                        SELECT
                            REPO_PLN_ID
                            , LANE
                            , VSL
                            , VOY
                            , DIR
                            , FM_ECC
                            , TO_ECC
                        FROM
                        (
                            SELECT
                                DISTINCT A.REPO_PLN_ID REPO_PLN_ID
                                , A.VSL_LANE_CD LANE
                                , A.VSL_CD VSL
                                , A.SKD_VOY_NO VOY
                                , A.SKD_DIR_CD DIR
                                , (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SUBSTR(A.FM_YD_CD,1,5) = SCC_CD) FM_ECC
                                , (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SUBSTR(A.TO_YD_CD,1,5) = SCC_CD) TO_ECC
                                , A.FM_ETD_DT
                                , A.TO_ETB_DT
                            FROM
                                EQR_VSL_LODG_DCHG_EXE_PLN A
                                ,EQR_VSL_EXE_PLN_QTY Q
                                #if (${weeklymonthly} == '2')
                                    ,EQR_WK_PRD E
                                #end
                                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                #if ($arrFmEccCd.size() > 0)
                                    #if (${fmtype} == 'R')
                                        AND B.RCC_CD
                                    #elseif (${fmtype} == 'L')
                                        AND B.LCC_CD
                                    #else
                                        AND B.ECC_CD
                                    #end
                                    IN(
                                    #foreach ($key in ${arrFmEccCd})
                                        #if($velocityCount < $arrFmEccCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )) C
                                #else
                                    ) C
                                #end
                                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                #if ($arrToEccCd.size() > 0)
                                    #if (${totype} == 'R')
                                        AND B.RCC_CD
                                    #elseif (${totype} == 'L')
                                        AND B.LCC_CD
                                    #else
                                        AND B.ECC_CD
                                    #end
                                    IN(
                                    #foreach ($key in ${arrToEccCd})
                                        #if($velocityCount < $arrToEccCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )) D
                                #else
                                    ) D
                                #end
                            WHERE
                                1=1
                                AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                                AND A.PLN_YRWK = Q.PLN_YRWK
                                AND A.PLN_SEQ = Q.PLN_SEQ
                                AND A.REF_ID = Q.REF_ID
                                AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                                #if (${weeklymonthly} == '2')
                                    AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                                #end
                                #if ($arrOddtpszCd.size() > 0)
                                    AND Q.CNTR_TPSZ_CD IN(
                                    #foreach ($key in ${arrOddtpszCd})
                                        #if($velocityCount < $arrOddtpszCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )
                                #end
                                #if ($arrLane.size() > 0)
                                    AND VSL_LANE_CD IN(
                                    #foreach ($key in ${arrLane})
                                        #if($velocityCount < $arrLane.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )
                                #end
                                #if (${item} == 'O' || ${item} == 'F')
                                    AND ONF_HIR_DIV_CD = @[item]
                                #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                                    AND A.TRSP_MOD_CD = @[item]
                                #end
                                #if (${feedback} == 'on')
                                    AND REPO_PLN_FB_RSN_CD IS NOT NULL
                                #end
                                #if (${fmPlnSYrWk} != '')
                                    AND TO_CHAR (FM_ETD_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                                #end
                                #if (${toPlnSYrWk} != '')
                                    AND TO_CHAR (TO_ETB_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                                #end
                                AND A.PLN_YRWK =  (SELECT PLN_YR||PLN_WK FROM EQR_WK_PRD WHERE TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT )
                                AND REPO_MTY_BKG_FLG ='Y'
                        )
                    )
                GROUP BY
                    A.FM_ETD_DT, FM_ECC_CD, TO_ECC_CD, TRSP_MOD_CD

                UNION ALL

                #if (${adherence} == 'O')
                    ------------- ORG ONLY
                    #if (${weeklymonthly} == '1')
                        SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_YRWK
                    #else
                        SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_MON
                    #end
                        ,A.CO_CD
                        ,(
                            SELECT B.
                            #if (${fmtypeby} == 'R')
                                RCC_CD
                            #elseif (${fmtypeby} == 'C')
                                CNT_CD
                            #elseif (${fmtypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(A.FM_YD_CD ,0,5)
                        ) FM_ECC_CD
                        ,'ALL' TO_ECC_CD
                        ,A.TRSP_MOD_CD
                        --,DECODE(A.MTY_BKG_NO_SPLIT, '  ', B.CNTR_QTY, 0) VOL
                        ,DECODE(A.SPLIT_REPO_PLN_FLG, 'N', B.CNTR_QTY, 0) VOL
                        ,A.LODG_DCHG_COST_AMT COST
                        ,A.REPO_PLN_FB_RSN_CD FEEDBACK_KEY
                        ,'2' FLAG
                    FROM
                        (
                            SELECT
                                A.PLN_YRWK
                                , A.CO_CD
                                , A.TRSP_MOD_CD
                                , A.VSL_LANE_CD
                                , A.VSL_CD
                                , A.SKD_VOY_NO
                                , A.SKD_DIR_CD
                                , A.FM_YD_CD
                                , A.FM_ETD_DT
                                , A.TO_YD_CD
                                , A.TO_ETB_DT
                                , A.EQ_REPO_PURP_CD
                                , A.REPO_MTY_BKG_FLG
                                , A.REPO_PLN_FB_RSN_CD
                                , A.REPO_PLN_FB_RMK
                                , A.MTY_BKG_NO
                                , A.SPLIT_REPO_PLN_FLG
                                , A.PAST_REPO_PLN_FLG
                                , Q.CNTR_TPSZ_CD
                                , Q.CNTR_QTY
                                , Q.LODG_DCHG_COST_AMT
                                , Q.PLN_UC_AMT
                                , Q.LODG_PORT_UC_AMT
                                , Q.DCHG_PORT_UC_AMT
                            FROM
                                EQR_VSL_LODG_DCHG_EXE_PLN A
                                , EQR_VSL_EXE_PLN_QTY Q
                            WHERE
                                A.REPO_PLN_ID = Q.REPO_PLN_ID
                                AND A.PLN_YRWK = Q.PLN_YRWK
                                AND A.PLN_SEQ = Q.PLN_SEQ
                                AND A.REF_ID = Q.REF_ID
                        ) A
                        ,(
                            -- original booking vol 집계
                            SELECT
                                DISTINCT A.MTY_BKG_NO
                                ,Q.CNTR_TPSZ_CD
                                ,SUM(Q.CNTR_QTY) CNTR_QTY
                            FROM
                                EQR_VSL_LODG_DCHG_EXE_PLN A
                                ,EQR_VSL_EXE_PLN_QTY Q
                                ,(
                                    SELECT
                                        DISTINCT MTY_BKG_NO
                                    FROM
                                        EQR_VSL_LODG_DCHG_EXE_PLN A
                                        ,EQR_VSL_EXE_PLN_QTY Q
                                        #if (${weeklymonthly} == '2')
                                            ,EQR_WK_PRD E
                                        #end
                                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                        #if ($arrFmEccCd.size() > 0)
                                            #if (${fmtype} == 'R')
                                                AND B.RCC_CD
                                            #elseif (${fmtype} == 'L')
                                                AND B.LCC_CD
                                            #else
                                                AND B.ECC_CD
                                            #end
                                            IN(
                                            #foreach ($key in ${arrFmEccCd})
                                                #if($velocityCount < $arrFmEccCd.size())
                                                '$key',
                                                #else
                                                '$key'
                                                #end
                                            #end
                                            )) C
                                        #else
                                            ) C
                                        #end
                                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                        #if ($arrToEccCd.size() > 0)
                                            #if (${totype} == 'R')
                                                AND B.RCC_CD
                                            #elseif (${totype} == 'L')
                                                AND B.LCC_CD
                                            #else
                                                AND B.ECC_CD
                                            #end
                                            IN(
                                            #foreach ($key in ${arrToEccCd})
                                                #if($velocityCount < $arrToEccCd.size())
                                                '$key',
                                                #else
                                                '$key'
                                                #end
                                            #end
                                            )) D
                                        #else
                                            ) D
                                        #end
                                    WHERE
                                        A.REPO_PLN_ID = Q.REPO_PLN_ID
                                        AND A.PLN_YRWK = Q.PLN_YRWK
                                        AND A.PLN_SEQ = Q.PLN_SEQ
                                        AND A.REF_ID = Q.REF_ID
                                        AND A.REPO_MTY_BKG_FLG = 'Y'
                                        AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                                        #if (${weeklymonthly} == '2')
                                            AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                                        #end
                                        #if ($arrOddtpszCd.size() > 0)
                                            AND Q.CNTR_TPSZ_CD IN(
                                            #foreach ($key in ${arrOddtpszCd})
                                                #if($velocityCount < $arrOddtpszCd.size())
                                                '$key',
                                                #else
                                                '$key'
                                                #end
                                            #end
                                            )
                                        #end
                                        #if ($arrLane.size() > 0)
                                            AND VSL_LANE_CD IN(
                                            #foreach ($key in ${arrLane})
                                                #if($velocityCount < $arrLane.size())
                                                '$key',
                                                #else
                                                '$key'
                                                #end
                                            #end
                                            )
                                        #end
                                        #if (${item} == 'O' || ${item} == 'F')
                                            AND ONF_HIR_DIV_CD = @[item]
                                        #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                                            AND A.TRSP_MOD_CD = @[item]
                                        #end
                                        #if (${feedback} == 'on')
                                            AND REPO_PLN_FB_RSN_CD IS NOT NULL
                                        #end
                                        --AND   TRIM(A.MTY_BKG_NO_SPLIT) IS NULL
                                        AND A.SPLIT_REPO_PLN_FLG = 'N'
                                        #if(${fmPlnSYrWk} != '')
                                            AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                                        #end
                                        #if(${toPlnSYrWk} != '')
                                            AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                                        #end
                                ) B
                            WHERE 
                                A.REPO_PLN_ID = Q.REPO_PLN_ID
                                AND A.PLN_YRWK = Q.PLN_YRWK
                                AND A.PLN_SEQ = Q.PLN_SEQ
                                AND A.REF_ID = Q.REF_ID
                                AND A.MTY_BKG_NO = B.MTY_BKG_NO
                            GROUP BY A.MTY_BKG_NO ,Q.CNTR_TPSZ_CD
                        ) B
                        #if (${weeklymonthly} == '2')
                            ,EQR_WK_PRD E
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrFmEccCd.size() > 0)
                            #if (${fmtype} == 'R')
                                AND B.RCC_CD
                            #elseif (${fmtype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrFmEccCd})
                                #if($velocityCount < $arrFmEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) C
                        #else
                            ) C
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrToEccCd.size() > 0)
                            #if (${totype} == 'R')
                                AND B.RCC_CD
                            #elseif (${totype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrToEccCd})
                                #if($velocityCount < $arrToEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) D
                        #else
                            ) D
                        #end
                    WHERE
                        A.MTY_BKG_NO   = B.MTY_BKG_NO(+)
                        AND A.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD(+)
                        AND A.MTY_BKG_NO IS NOT NULL
                        AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                        #if (${weeklymonthly} == '2')
                            AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                        #end
                        #if ($arrOddtpszCd.size() > 0)
                            AND A.CNTR_TPSZ_CD IN(
                            #foreach ($key in ${arrOddtpszCd})
                                #if($velocityCount < $arrOddtpszCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if ($arrLane.size() > 0)
                            AND VSL_LANE_CD IN(
                            #foreach ($key in ${arrLane})
                                #if($velocityCount < $arrLane.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if (${item} == 'O' || ${item} == 'F')
                            AND ONF_HIR_DIV_CD = @[item]
                        #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                            AND A.TRSP_MOD_CD = @[item]
                        #end
                        #if (${feedback} == 'on')
                            AND REPO_PLN_FB_RSN_CD IS NOT NULL
                        #end
                        #if (${fmPlnSYrWk} != '')
                            AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                        #end
                        #if (${toPlnSYrWk} != '')
                            AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                        #end
                #else
                    #if (${weeklymonthly} == '1')
                        SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_YRWK
                    #else
                        SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_MON
                    #end
                        ,A.CO_CD
                        ,(
                            SELECT B.
                            #if (${fmtypeby} == 'R')
                                RCC_CD
                            #elseif (${fmtypeby} == 'C')
                                CNT_CD
                            #elseif (${fmtypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(A.FM_YD_CD ,0,5)
                        ) FM_ECC_CD
                        ,(
                            SELECT B.
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(A.TO_YD_CD ,0,5)
                        ) TO_ECC_CD
                        ,A.TRSP_MOD_CD
                        ,Q.CNTR_QTY VOL
                        ,Q.LODG_DCHG_COST_AMT COST
                        ,A.REPO_PLN_FB_RSN_CD FEEDBACK_KEY
                        ,'2' FLAG
                    FROM
                        EQR_VSL_LODG_DCHG_EXE_PLN A
                        , EQR_VSL_EXE_PLN_QTY Q
                        #if (${weeklymonthly} == '2')
                            ,EQR_WK_PRD E
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrFmEccCd.size() > 0)
                            #if (${fmtype} == 'R')
                                AND B.RCC_CD
                            #elseif (${fmtype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrFmEccCd})
                                #if($velocityCount < $arrFmEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) C
                        #else
                            ) C
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrToEccCd.size() > 0)
                            #if (${totype} == 'R')
                                AND B.RCC_CD
                            #elseif (${totype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrToEccCd})
                                #if($velocityCount < $arrToEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) D
                        #else
                            ) D
                        #end
                    WHERE
                        1=1
                        AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                        AND A.PLN_YRWK = Q.PLN_YRWK
                        AND A.PLN_SEQ = Q.PLN_SEQ
                        AND A.REF_ID = Q.REF_ID
                        AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                        #if (${weeklymonthly} == '2')
                            AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                        #end
                        #if ($arrOddtpszCd.size() > 0)
                            AND Q.CNTR_TPSZ_CD IN(
                            #foreach ($key in ${arrOddtpszCd})
                                #if($velocityCount < $arrOddtpszCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if ($arrLane.size() > 0)
                            AND VSL_LANE_CD IN(
                            #foreach ($key in ${arrLane})
                                #if($velocityCount < $arrLane.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if (${item} == 'O' || ${item} == 'F')
                            AND ONF_HIR_DIV_CD = @[item]
                        #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                            AND A.TRSP_MOD_CD = @[item]
                        #end
                        #if (${feedback} == 'on')
                            AND REPO_PLN_FB_RSN_CD IS NOT NULL
                        #end
                        AND   A.MTY_BKG_NO IS NOT NULL
                        AND   Q.CNTR_QTY > 0
                        #if (${fmPlnSYrWk} != '')
                            AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                        #end
                        #if(${toPlnSYrWk} != '')
                            AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                        #end
                #end

                UNION ALL

                -- ITEM = Rail(R), Truck(T), Water(W)
                -- Execultion 3
                SELECT
                    #if (${weeklymonthly} == '1')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||SUBSTR(A.PLN_YRWK,5,6) PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                    #end
                    ,CO_CD
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(FM_YD_CD ,0,5)
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT B.
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                        ) TO_ECC_CD
                    #end
                    ,TRSP_MOD_CD
                    ,CNTR_QTY VOL
                    ,TRSP_COST_AMT COST
                    ,REPO_PLN_FB_RSN_CD    FEEDBACK_KEY
                    ,'2' FLAG
                FROM
                    EQR_INLND_TRSP_EXE_PLN A
                    , EQR_INLND_TRSP_EXE_PLN_QTY Q
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND B.RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND B.RCC_CD
                        #elseif (${totype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    1=1
                    AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND A.REF_ID = Q.REF_ID
                    AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${item} == 'O' || ${item} == 'F')
                        AND ONF_HIR_DIV_CD = @[item]
                    #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                        AND A.TRSP_MOD_CD = @[item]
                    #end
                    #if (${feedback} == 'on')
                        AND REPO_PLN_FB_RSN_CD IS NOT NULL
                    #end
                    AND CNTR_QTY <> 0
                    AND PAST_REPO_PLN_FLG NOT IN ('Y')
                    #if (${fmPlnSYrWk} != '')
                        AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_CHAR(TO_ETA_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                    #end

                UNION ALL

                -- ITEM = Rail(R), Truck(T), Water(W), Shuttle(S) ------------------------------------------------
                -- W/O 1
                SELECT
                    #if (${weeklymonthly} == '1')
                        SUBSTR(PLN_YRWK,0,4)||'-'||SUBSTR(PLN_YRWK,5,6) PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        SUBSTR(PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                    #end
                    ,CO_CD
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(FM_YD_CD ,0,5)
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT B.
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                        ) TO_ECC_CD
                    #end
                    ,SO_IF_DIV_CD TRSP_MOD_CD
                    ,COUNT(CNTR_TPSZ_CD) VOL
                    ,SUM(REPO_COST_AMT) COST
                    ,''  FEEDBACK_KEY
                    ,'3' FLAG
                FROM
                    EQR_REPO_EXE_SO_IF A
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND B.RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND B.RCC_CD
                        #elseif (${totype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE 1=1
                    AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    AND WO_EXE_FLG = 'Y'
                    #if ($arrOddtpszCd.size() > 0)
                        AND A.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${item} == '')
                        AND SO_IF_DIV_CD IN('R','T','W','S')
                    #else
                        AND SO_IF_DIV_CD = @[item]
                    #end
                    AND PAST_REPO_PLN_FLG NOT IN ('Y')
                    #if (${fmPlnSYrWk} != '')
                        AND FM_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                    #end
                GROUP BY
                    #if (${weeklymonthly} == '1')
                        PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        PLN_YRWK, PLN_MON
                    #end
                    , CO_CD
                    , FM_YD_CD
                    , TO_YD_CD
                    , SO_IF_DIV_CD

                UNION ALL

                #if (${adherence} == 'O')
                    -- ITEM = T.VVD
                    -- W/O 2
                    ------------- ORG ONLY
                    #if (${weeklymonthly} == '1')
                        SELECT
                            (
                                SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                                FROM EQR_WK_PRD
                                WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                            )  PLN_YRWK
                    #else
                        SELECT
                            (
                                SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                                FROM EQR_WK_PRD
                                WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                            )  PLN_MON
                    #end
                        ,A.CO_CD
                        ,(
                            SELECT B.
                            #if (${fmtypeby} == 'R')
                                RCC_CD
                            #elseif (${fmtypeby} == 'C')
                                CNT_CD
                            #elseif (${fmtypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(A.FM_YD_CD ,0,5)
                        ) FM_ECC_CD
                        ,'ALL' TO_ECC_CD
                        ,A.TRSP_MOD_CD
                        --,DECODE(A.MTY_BKG_NO_SPLIT, '  ', B.CNTR_QTY, 0) VOL
                        ,DECODE(A.SPLIT_REPO_PLN_FLG, 'N', B.CNTR_QTY, 0) VOL
                        ,A.LODG_DCHG_COST_AMT COST
                        ,'' FEEDBACK_KEY
                        ,'3' FLAG    -- W/O FLAG
                    FROM
                        (
                            SELECT
                                A.PLN_YRWK
                                , A.CO_CD
                                , A.TRSP_MOD_CD
                                , A.VSL_LANE_CD
                                , A.VSL_CD
                                , A.SKD_VOY_NO
                                , A.SKD_DIR_CD
                                , A.FM_YD_CD
                                , A.FM_ETD_DT
                                , A.TO_YD_CD
                                , A.TO_ETB_DT
                                , A.EQ_REPO_PURP_CD
                                , A.REPO_MTY_BKG_FLG
                                , A.REPO_PLN_FB_RSN_CD
                                , A.REPO_PLN_FB_RMK
                                , A.MTY_BKG_NO
                                , A.SPLIT_REPO_PLN_FLG
                                , A.PAST_REPO_PLN_FLG
                                , Q.CNTR_TPSZ_CD
                                , Q.CNTR_QTY
                                , Q.LODG_DCHG_COST_AMT
                                , Q.PLN_UC_AMT
                                , Q.LODG_PORT_UC_AMT
                                , Q.DCHG_PORT_UC_AMT
                            FROM
                                EQR_VSL_LODG_DCHG_EXE_PLN A
                                , EQR_VSL_EXE_PLN_QTY Q
                            WHERE
                                A.REPO_PLN_ID = Q.REPO_PLN_ID
                                AND A.PLN_YRWK = Q.PLN_YRWK
                                AND A.PLN_SEQ = Q.PLN_SEQ
                                AND A.REF_ID = Q.REF_ID
                        ) A
                        ,(
                            -- original booking vol 집계
                            SELECT
                                DISTINCT A.MTY_BKG_NO
                                ,Q.CNTR_TPSZ_CD
                                ,SUM(Q.CNTR_QTY) CNTR_QTY
                            FROM
                                EQR_VSL_LODG_DCHG_EXE_PLN A
                                , EQR_VSL_EXE_PLN_QTY Q
                                ,(
                                    SELECT
                                        DISTINCT MTY_BKG_NO
                                    FROM
                                        EQR_VSL_LODG_DCHG_EXE_PLN A
                                        , EQR_VSL_EXE_PLN_QTY Q
                                        #if (${weeklymonthly} == '2')
                                            ,EQR_WK_PRD E
                                        #end
                                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                        #if ($arrFmEccCd.size() > 0)
                                            #if (${fmtype} == 'R')
                                                AND B.RCC_CD
                                            #elseif (${fmtype} == 'L')
                                                AND B.LCC_CD
                                            #else
                                                AND B.ECC_CD
                                            #end
                                            IN(
                                            #foreach ($key in ${arrFmEccCd})
                                                #if($velocityCount < $arrFmEccCd.size())
                                                '$key',
                                                #else
                                                '$key'
                                                #end
                                            #end
                                            )) C
                                        #else
                                            ) C
                                        #end
                                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                        #if ($arrToEccCd.size() > 0)
                                            #if (${totype} == 'R')
                                                AND B.RCC_CD
                                            #elseif (${totype} == 'L')
                                                AND B.LCC_CD
                                            #else
                                                AND B.ECC_CD
                                            #end
                                            IN(
                                            #foreach ($key in ${arrToEccCd})
                                                #if($velocityCount < $arrToEccCd.size())
                                                '$key',
                                                #else
                                                '$key'
                                                #end
                                            #end
                                            )) D
                                        #else
                                            ) D
                                        #end
                                    WHERE
                                        A.REPO_PLN_ID = Q.REPO_PLN_ID
                                        AND A.PLN_YRWK = Q.PLN_YRWK
                                        AND A.PLN_SEQ = Q.PLN_SEQ
                                        AND A.REF_ID = Q.REF_ID
                                        AND A.REPO_MTY_BKG_FLG = 'Y'
                                        AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                                        #if (${weeklymonthly} == '2')
                                            AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                                        #end
                                        #if ($arrOddtpszCd.size() > 0)
                                            AND Q.CNTR_TPSZ_CD IN(
                                            #foreach ($key in ${arrOddtpszCd})
                                                #if($velocityCount < $arrOddtpszCd.size())
                                                '$key',
                                                #else
                                                '$key'
                                                #end
                                            #end
                                            )
                                        #end
                                        #if ($arrLane.size() > 0)
                                            AND VSL_LANE_CD IN(
                                            #foreach ($key in ${arrLane})
                                                #if($velocityCount < $arrLane.size())
                                                '$key',
                                                #else
                                                '$key'
                                                #end
                                            #end
                                            )
                                        #end
                                        #if (${item} == 'O' || ${item} == 'F')
                                            AND ONF_HIR_DIV_CD = @[item]
                                        #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                                            AND A.TRSP_MOD_CD = @[item]
                                        #end
                                        #if (${feedback} == 'on')
                                            AND REPO_PLN_FB_RSN_CD IS NOT NULL
                                        #end
                                        --AND   TRIM(A.MTY_BKG_NO_SPLIT) IS NULL
                                        AND A.SPLIT_REPO_PLN_FLG = 'N'
                                        #if (${fmPlnSYrWk} != '')
                                            AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                                        #end
                                        #if (${toPlnSYrWk} != '')
                                            AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                                        #end
                                ) B
                            WHERE 
                                A.REPO_PLN_ID = Q.REPO_PLN_ID
                                AND A.PLN_YRWK = Q.PLN_YRWK
                                AND A.PLN_SEQ = Q.PLN_SEQ
                                AND A.REF_ID = Q.REF_ID
                                AND A.MTY_BKG_NO = B.MTY_BKG_NO
                            GROUP BY A.MTY_BKG_NO ,Q.CNTR_TPSZ_CD
                        ) B
                        #if (${weeklymonthly} == '2')
                            ,EQR_WK_PRD E
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrFmEccCd.size() > 0)
                            #if (${fmtype} == 'R')
                                AND B.RCC_CD
                            #elseif (${fmtype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrFmEccCd})
                                #if($velocityCount < $arrFmEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) C
                        #else
                            ) C
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrToEccCd.size() > 0)
                            #if (${totype} == 'R')
                                AND B.RCC_CD
                            #elseif (${totype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrToEccCd})
                                #if($velocityCount < $arrToEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) D
                        #else
                            ) D
                        #end
                    WHERE
                        A.MTY_BKG_NO   = B.MTY_BKG_NO(+)
                        AND A.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD(+)
                        AND A.MTY_BKG_NO IS NOT NULL
                        AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                        #if (${weeklymonthly} == '2')
                            AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                        #end
                        #if ($arrOddtpszCd.size() > 0)
                            AND A.CNTR_TPSZ_CD IN(
                            #foreach ($key in ${arrOddtpszCd})
                                #if($velocityCount < $arrOddtpszCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if ($arrLane.size() > 0)
                            AND VSL_LANE_CD IN(
                            #foreach ($key in ${arrLane})
                                #if($velocityCount < $arrLane.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if (${item} == 'O' || ${item} == 'F')
                            AND ONF_HIR_DIV_CD = @[item]
                        #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                            AND A.TRSP_MOD_CD = @[item]
                        #end
                        #if (${feedback} == 'on')
                            AND REPO_PLN_FB_RSN_CD IS NOT NULL
                        #end
                        #if (${fmPlnSYrWk} != '')
                            AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                        #end
                        #if (${toPlnSYrWk} != '')
                            AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                        #end
                #else
                    -- ITEM = T.VVD
                    -- W/O 2
                    #if (${weeklymonthly} == '1')
                        SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_YRWK
                    #else
                        SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_MON
                    #end
                        ,A.CO_CD
                        ,(
                            SELECT B.
                            #if (${fmtypeby} == 'R')
                                RCC_CD
                            #elseif (${fmtypeby} == 'C')
                                CNT_CD
                            #elseif (${fmtypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(A.FM_YD_CD ,0,5)
                        ) FM_ECC_CD
                        ,(
                            SELECT B.
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(A.TO_YD_CD ,0,5)
                        ) TO_ECC_CD
                        ,A.TRSP_MOD_CD
                        ,Q.CNTR_QTY VOL
                        ,Q.LODG_DCHG_COST_AMT COST
                        ,'' FEEDBACK_KEY
                        ,'3' FLAG
                    FROM
                        EQR_VSL_LODG_DCHG_EXE_PLN A
                        , EQR_VSL_EXE_PLN_QTY Q
                        #if (${weeklymonthly} == '2')
                            ,EQR_WK_PRD E
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrFmEccCd.size() > 0)
                            #if (${fmtype} == 'R')
                                AND B.RCC_CD
                            #elseif (${fmtype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrFmEccCd})
                                #if($velocityCount < $arrFmEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) C
                        #else
                            ) C
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrToEccCd.size() > 0)
                            #if (${totype} == 'R')
                                AND B.RCC_CD
                            #elseif (${totype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrToEccCd})
                                #if($velocityCount < $arrToEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) D
                        #else
                            ) D
                        #end
                    WHERE
                        1=1
                        AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                        AND A.PLN_YRWK = Q.PLN_YRWK
                        AND A.PLN_SEQ = Q.PLN_SEQ
                        AND A.REF_ID = Q.REF_ID
                        AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                        #if (${weeklymonthly} == '2')
                            AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                        #end
                        #if ($arrOddtpszCd.size() > 0)
                            AND Q.CNTR_TPSZ_CD IN(
                            #foreach ($key in ${arrOddtpszCd})
                                #if($velocityCount < $arrOddtpszCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if ($arrLane.size() > 0)
                            AND VSL_LANE_CD IN(
                            #foreach ($key in ${arrLane})
                                #if($velocityCount < $arrLane.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if (${item} == 'O' || ${item} == 'F')
                            AND ONF_HIR_DIV_CD = @[item]
                        #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                            AND A.TRSP_MOD_CD = @[item]
                        #end
                        #if (${feedback} == 'on')
                            AND REPO_PLN_FB_RSN_CD IS NOT NULL
                        #end
                        AND   A.MTY_BKG_NO IS NOT NULL
                        AND   Q.CNTR_QTY > 0
                        #if (${fmPlnSYrWk} != '')
                            AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                        #end
                        #if (${toPlnSYrWk} != '')
                            AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                        #end
                #end

                UNION ALL

                ---------------------- FEEDBACK -------------------------------
                -- VESSEL FEEDBACK
                SELECT
                    A.
                    #if (${weeklymonthly} == '1')
                        PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        PLN_MON
                    #end
                    ,A.CO_CD
                    ,A.FM_ECC_CD
                    ,A.TO_ECC_CD
                    ,A.TRSP_MOD_CD
                    ,SUM(A.RSN_COUNT) VOL
                    ,0 COST
                    ,A.REPO_PLN_FB_RSN_CD FEEDBACK_KEY
                    ,'4' FLAG
                FROM
                (
                    SELECT
                        DISTINCT A.REF_ID
                        ,A.CO_CD
                        ,A.TRSP_MOD_CD
                        #if (${weeklymonthly} == '1')
                            ,(
                                SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                                FROM EQR_WK_PRD
                                WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                            )  PLN_YRWK
                        #else
                            ,(
                                SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                                FROM EQR_WK_PRD
                                WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                            )  PLN_MON
                        #end
                        ,(
                            SELECT B.
                            #if (${fmtypeby} == 'R')
                                RCC_CD
                            #elseif (${fmtypeby} == 'C')
                                CNT_CD
                            #elseif (${fmtypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(FM_YD_CD ,0,5)
                        ) FM_ECC_CD
                        #if (${adherence} == 'O')
                            ,'ALL' TO_ECC_CD
                        #else
                            ,(
                                SELECT B.
                                #if (${totypeby} == 'R')
                                    RCC_CD
                                #elseif (${totypeby} == 'C')
                                    CNT_CD
                                #elseif (${totypeby} == 'L')
                                    LCC_CD
                                #else
                                    ECC_CD
                                #end
                                FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                                WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                            ) TO_ECC_CD
                        #end
                        ,A.MTY_BKG_NO
                        --,A.MTY_BKG_NO_SPLIT
                        ,A.REPO_PLN_FB_RSN_CD
                        ,1 RSN_COUNT
                    FROM
                        EQR_VSL_LODG_DCHG_EXE_PLN A
                        , EQR_VSL_EXE_PLN_QTY Q
                        #if (${weeklymonthly} == '2')
                            ,EQR_WK_PRD E
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrFmEccCd.size() > 0)
                            #if (${fmtype} == 'R')
                                AND B.RCC_CD
                            #elseif (${fmtype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrFmEccCd})
                                #if($velocityCount < $arrFmEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) C
                        #else
                            ) C
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrToEccCd.size() > 0)
                            #if (${totype} == 'R')
                                AND B.RCC_CD
                            #elseif (${totype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrToEccCd})
                                #if($velocityCount < $arrToEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) D
                        #else
                            ) D
                        #end
                    WHERE
                        1=1
                        AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                        AND A.PLN_YRWK = Q.PLN_YRWK
                        AND A.PLN_SEQ = Q.PLN_SEQ
                        AND A.REF_ID = Q.REF_ID
                        AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                        #if (${weeklymonthly} == '2')
                            AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                        #end
                        #if ($arrOddtpszCd.size() > 0)
                            AND Q.CNTR_TPSZ_CD IN(
                            #foreach ($key in ${arrOddtpszCd})
                                #if($velocityCount < $arrOddtpszCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if ($arrLane.size() > 0)
                            AND VSL_LANE_CD IN(
                            #foreach ($key in ${arrLane})
                                #if($velocityCount < $arrLane.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if (${item} == 'O' || ${item} == 'F')
                            AND ONF_HIR_DIV_CD = @[item]
                        #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                            AND A.TRSP_MOD_CD = @[item]
                        #end
                        #if (${feedback} == 'on')
                            AND REPO_PLN_FB_RSN_CD IS NOT NULL
                        #end
                        AND   A.MTY_BKG_NO IS NOT NULL
                        --AND   TRIM(A.MTY_BKG_NO_SPLIT) IS NULL
                        AND   SPLIT_REPO_PLN_FLG = 'N'
                        AND   A.REPO_PLN_FB_RSN_CD IS NOT NULL
                        #if (${fmPlnSYrWk} != '')
                            AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                            AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                        #end
                        #if (${toPlnSYrWk} != '')
                            AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                            AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                        #end
                ) A
                GROUP BY
                    A.
                    #if (${weeklymonthly} == '1')
                        PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        PLN_MON
                    #end
                    ,A.CO_CD
                    ,A.FM_ECC_CD
                    ,A.TO_ECC_CD
                    ,A.TRSP_MOD_CD
                    ,A.REPO_PLN_FB_RSN_CD
            #end
        #elseif (${item} == 'V')
            -- ITEM = T.VVD ------------------------------------------------------------------------------------------------
            -- Plan ID 1
            #if(${weeklymonthly} == '1')
                SELECT
                    (
                        SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                        FROM EQR_WK_PRD
                        WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                    )  PLN_YRWK
            #else
                SELECT
                    (
                        SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                        FROM EQR_WK_PRD
                        WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                    )  PLN_MON
            #end
                ,'' CO_CD
                ,(
                    SELECT
                    #if (${fmtypeby} == 'R')
                        RCC_CD
                    #elseif (${fmtypeby} == 'C')
                        CNT_CD
                    #elseif (${fmtypeby} == 'L')
                        LCC_CD
                    #else
                        ECC_CD
                    #end
                    FROM EQR_ECC_MST
                    WHERE FM_ECC_CD = ECC_CD
                ) FM_ECC_CD
                #if (${adherence} == 'O')
                    ,'ALL' TO_ECC_CD
                #else
                    ,(
                        SELECT
                        #if (${totypeby} == 'R')
                            RCC_CD
                        #elseif (${totypeby} == 'C')
                            CNT_CD
                        #elseif (${totypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST
                        WHERE TO_ECC_CD = ECC_CD
                    ) TO_ECC_CD
                #end
                ,TRSP_MOD_CD
                ,SUM(CNTR_QTY) VOL
                ,SUM(LODG_DCHG_COST_AMT) COST
                ,'' FEEDBACK_KEY
                ,'1' FLAG
            FROM
                EQR_VSL_LODG_DCHG_PLN A
                ,EQR_VSL_LODG_DCHG_PLN_QTY Q
                ,EQR_EQ_REPO_PLN B
                #if (${weeklymonthly} == '2')
                    ,EQR_WK_PRD E
                #end
                ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                #if ($arrFmEccCd.size() > 0)
                    #if (${fmtype} == 'R')
                        AND RCC_CD
                    #elseif (${fmtype} == 'L')
                        AND LCC_CD
                    #else
                        AND ECC_CD
                    #end
                    IN(
                    #foreach ($key in ${arrFmEccCd})
                        #if($velocityCount < $arrFmEccCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )) C
                #else
                    ) C
                #end
                ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                #if ($arrToEccCd.size() > 0)
                    #if (${totype} == 'R')
                        AND RCC_CD
                    #elseif (${totype} == 'L')
                        AND LCC_CD
                    #else
                        AND ECC_CD
                    #end
                    IN(
                    #foreach ($key in ${arrToEccCd})
                        #if($velocityCount < $arrToEccCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )) D
                #else
                    ) D
                #end
            WHERE
                A.REPO_PLN_ID = Q.REPO_PLN_ID
                AND A.PLN_YRWK = Q.PLN_YRWK
                AND A.PLN_SEQ = Q.PLN_SEQ
                AND A.REPO_PLN_ID = B.REPO_PLN_ID
                AND FM_ECC_CD = C.ECC_CD AND TO_ECC_CD = D.ECC_CD
                #if (${weeklymonthly} == '2')
                    AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                #end
                AND PAST_REPO_PLN_FLG NOT IN('Y')
                AND B.REPO_PLN_DTRB_FLG ='Y'       -- 새로 추가된 조건
                AND SUBSTR(A.REPO_PLN_ID,5,6) = A.PLN_YRWK
                #if ($arrOddtpszCd.size() > 0)
                    AND Q.CNTR_TPSZ_CD IN(
                    #foreach ($key in ${arrOddtpszCd})
                        #if($velocityCount < $arrOddtpszCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )
                #end
                #if ($arrLane.size() > 0)
                    AND VSL_LANE_CD IN(
                    #foreach ($key in ${arrLane})
                        #if($velocityCount < $arrLane.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )
                #end
                #if (${fmPlnSYrWk} != '')
                    AND TO_CHAR (FM_ETD_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                #end
                #if (${toPlnSYrWk} != '')
                    AND TO_CHAR (TO_ETB_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                #end
            GROUP BY
                A.FM_ETD_DT, FM_ECC_CD, TO_ECC_CD, TRSP_MOD_CD
            
            -- 새로 추가된 개념(20080610)
            -- CSR NO : N200805150003
            -- modified by shin yongchan - 20080602
            UNION ALL
            #if(${weeklymonthly} == '1')
                SELECT
                    (
                        SELECT PLN_YR||'-'||PLN_WK  PLN_YRWK
                        FROM EQR_WK_PRD
                        WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                    )  PLN_YRWK
            #else
                SELECT
                    (
                        SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                        FROM EQR_WK_PRD
                        WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                    )  PLN_MON
            #end
                ,'' CO_CD
                ,(
                    SELECT
                    #if (${fmtypeby} == 'R')
                        RCC_CD
                    #elseif (${fmtypeby} == 'C')
                        CNT_CD
                    #elseif (${fmtypeby} == 'L')
                        LCC_CD
                    #else
                        ECC_CD
                    #end
                    FROM EQR_ECC_MST
                    WHERE FM_ECC_CD = ECC_CD
                ) FM_ECC_CD
                #if (${adherence} == 'O')
                    ,'ALL' TO_ECC_CD
                #else
                    ,(
                        SELECT
                        #if (${totypeby} == 'R')
                            RCC_CD
                        #elseif (${totypeby} == 'C')
                            CNT_CD
                        #elseif (${totypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST
                         WHERE TO_ECC_CD = ECC_CD
                    ) TO_ECC_CD
                #end
                ,TRSP_MOD_CD
                ,SUM(CNTR_QTY) VOL
                ,SUM(LODG_DCHG_COST_AMT) COST
                ,'' FEEDBACK_KEY
                ,'1' FLAG
            FROM
                EQR_VSL_LODG_DCHG_PLN A
                , EQR_VSL_LODG_DCHG_PLN_QTY Q
                #if (${weeklymonthly} == '2')
                    ,EQR_WK_PRD E
                #end
                ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                #if ($arrFmEccCd.size() > 0)
                    #if (${fmtype} == 'R')
                        AND RCC_CD
                    #elseif (${fmtype} == 'L')
                        AND LCC_CD
                    #else
                        AND ECC_CD
                    #end
                    IN(
                    #foreach ($key in ${arrFmEccCd})
                        #if($velocityCount < $arrFmEccCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )) C
                #else
                    ) C
                #end
                ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                #if ($arrToEccCd.size() > 0)
                    #if (${totype} == 'R')
                        AND RCC_CD
                    #elseif (${totype} == 'L')
                        AND LCC_CD
                    #else
                        AND ECC_CD
                    #end
                    IN(
                    #foreach ($key in ${arrToEccCd})
                        #if($velocityCount < $arrToEccCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )) D
                #else
                    ) D
                #end
            WHERE
                A.REPO_PLN_ID = Q.REPO_PLN_ID
                AND A.PLN_YRWK = Q.PLN_YRWK
                AND A.PLN_SEQ = Q.PLN_SEQ
                AND PAST_REPO_PLN_FLG NOT IN ('Y')
                AND FM_ECC_CD = C.ECC_CD AND TO_ECC_CD = D.ECC_CD
                #if (${weeklymonthly} == '2')
                    AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                #end
                AND SUBSTR(A.REPO_PLN_ID,5,6) <> A.PLN_YRWK
                #if ($arrOddtpszCd.size() > 0)
                    AND Q.CNTR_TPSZ_CD IN(
                    #foreach ($key in ${arrOddtpszCd})
                        #if($velocityCount < $arrOddtpszCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )
                #end
                #if ($arrLane.size() > 0)
                    AND VSL_LANE_CD IN(
                    #foreach ($key in ${arrLane})
                        #if($velocityCount < $arrLane.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )
                #end
                #if (${fmPlnSYrWk} != '')
                    AND TO_CHAR (FM_ETD_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                #end
                #if (${toPlnSYrWk} != '')
                    AND TO_CHAR (TO_ETB_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                #end
                AND (A.REPO_PLN_ID, A.VSL_LANE_CD, A.VSL_CD, A.SKD_VOY_NO, A.SKD_DIR_CD, A.FM_ECC_CD, A.TO_ECC_CD ) IN
                (
                    SELECT
                        REPO_PLN_ID
                        , LANE
                        , VSL
                        , VOY
                        , DIR
                        , FM_ECC
                        , TO_ECC
                    FROM
                    (
                        SELECT
                            DISTINCT A.REPO_PLN_ID REPO_PLN_ID
                            , A.VSL_LANE_CD LANE
                            , A.VSL_CD VSL
                            , A.SKD_VOY_NO VOY
                            , A.SKD_DIR_CD DIR
                            , (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SUBSTR(A.FM_YD_CD,1,5) = SCC_CD) FM_ECC
                            , (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SUBSTR(A.TO_YD_CD,1,5) = SCC_CD) TO_ECC
                            , A.FM_ETD_DT
                            , A.TO_ETB_DT
                        FROM
                            EQR_VSL_LODG_DCHG_EXE_PLN A
                            ,EQR_VSL_EXE_PLN_QTY Q
                            #if (${weeklymonthly} == '2')
                                ,EQR_WK_PRD E
                            #end
                            ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                            #if ($arrFmEccCd.size() > 0)
                                #if (${fmtype} == 'R')
                                    AND B.RCC_CD
                                #elseif (${fmtype} == 'L')
                                    AND B.LCC_CD
                                #else
                                    AND B.ECC_CD
                                #end
                                IN(
                                #foreach ($key in ${arrFmEccCd})
                                    #if($velocityCount < $arrFmEccCd.size())
                                    '$key',
                                    #else
                                    '$key'
                                    #end
                                #end
                                )) C
                            #else
                                ) C
                            #end
                            ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                            #if ($arrToEccCd.size() > 0)
                                #if (${totype} == 'R')
                                    AND B.RCC_CD
                                #elseif (${totype} == 'L')
                                    AND B.LCC_CD
                                #else
                                    AND B.ECC_CD
                                #end
                                IN(
                                #foreach ($key in ${arrToEccCd})
                                    #if($velocityCount < $arrToEccCd.size())
                                    '$key',
                                    #else
                                    '$key'
                                    #end
                                #end
                                )) D
                            #else
                                ) D
                            #end
                        WHERE
                            1=1
                            AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                            AND A.PLN_YRWK = Q.PLN_YRWK
                            AND A.PLN_SEQ = Q.PLN_SEQ
                            AND A.REF_ID = Q.REF_ID
                            AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                            #if (${weeklymonthly} == '2')
                                AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                            #end
                            #if ($arrOddtpszCd.size() > 0)
                                AND Q.CNTR_TPSZ_CD IN(
                                #foreach ($key in ${arrOddtpszCd})
                                    #if($velocityCount < $arrOddtpszCd.size())
                                    '$key',
                                    #else
                                    '$key'
                                    #end
                                #end
                                )
                            #end
                            #if ($arrLane.size() > 0)
                                AND VSL_LANE_CD IN(
                                #foreach ($key in ${arrLane})
                                    #if($velocityCount < $arrLane.size())
                                    '$key',
                                    #else
                                    '$key'
                                    #end
                                #end
                                )
                            #end
                            #if (${item} == 'O' || ${item} == 'F')
                                AND ONF_HIR_DIV_CD = @[item]
                            #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                                AND A.TRSP_MOD_CD = @[item]
                            #end
                            #if (${feedback} == 'on')
                                AND REPO_PLN_FB_RSN_CD IS NOT NULL
                            #end
                            #if (${fmPlnSYrWk} != '')
                                AND TO_CHAR (FM_ETD_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                                AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                            #end
                            #if (${toPlnSYrWk} != '')
                                AND TO_CHAR (TO_ETB_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                                AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                            #end
                            AND A.PLN_YRWK =  (SELECT PLN_YR||PLN_WK FROM EQR_WK_PRD WHERE TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT )
                            AND REPO_MTY_BKG_FLG ='Y'
                    )
                )
            GROUP BY
                A.FM_ETD_DT, FM_ECC_CD, TO_ECC_CD, TRSP_MOD_CD

            UNION ALL

            #if (${adherence} == 'O')
                ------------- ORG ONLY
                #if (${weeklymonthly} == '1')
                    SELECT
                    (
                        SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                        FROM EQR_WK_PRD
                        WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                    )  PLN_YRWK
                #else
                    SELECT
                    (
                        SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                        FROM EQR_WK_PRD
                        WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                    )  PLN_MON
                #end
                    ,A.CO_CD
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(A.FM_YD_CD ,0,5)
                    ) FM_ECC_CD
                    ,'ALL' TO_ECC_CD
                    ,A.TRSP_MOD_CD
                    --,DECODE(A.MTY_BKG_NO_SPLIT, '  ', B.CNTR_QTY, 0) VOL
                    ,DECODE(A.SPLIT_REPO_PLN_FLG, 'N', B.CNTR_QTY, 0) VOL
                    ,A.LODG_DCHG_COST_AMT COST
                    ,A.REPO_PLN_FB_RSN_CD FEEDBACK_KEY
                    ,'2' FLAG
                FROM
                    (
                        SELECT
                            A.PLN_YRWK
                            , A.CO_CD
                            , A.TRSP_MOD_CD
                            , A.VSL_LANE_CD
                            , A.VSL_CD
                            , A.SKD_VOY_NO
                            , A.SKD_DIR_CD
                            , A.FM_YD_CD
                            , A.FM_ETD_DT
                            , A.TO_YD_CD
                            , A.TO_ETB_DT
                            , A.EQ_REPO_PURP_CD
                            , A.REPO_MTY_BKG_FLG
                            , A.REPO_PLN_FB_RSN_CD
                            , A.REPO_PLN_FB_RMK
                            , A.MTY_BKG_NO
                            , A.SPLIT_REPO_PLN_FLG
                            , A.PAST_REPO_PLN_FLG
                            , Q.CNTR_TPSZ_CD
                            , Q.CNTR_QTY
                            , Q.LODG_DCHG_COST_AMT
                            , Q.PLN_UC_AMT
                            , Q.LODG_PORT_UC_AMT
                            , Q.DCHG_PORT_UC_AMT
                        FROM
                            EQR_VSL_LODG_DCHG_EXE_PLN A
                            , EQR_VSL_EXE_PLN_QTY Q
                        WHERE
                            A.REPO_PLN_ID = Q.REPO_PLN_ID
                            AND A.PLN_YRWK = Q.PLN_YRWK
                            AND A.PLN_SEQ = Q.PLN_SEQ
                            AND A.REF_ID = Q.REF_ID
                    ) A
                    ,(
                        -- original booking vol 집계
                        SELECT
                            DISTINCT A.MTY_BKG_NO
                            ,Q.CNTR_TPSZ_CD
                            ,SUM(Q.CNTR_QTY) CNTR_QTY
                        FROM
                            EQR_VSL_LODG_DCHG_EXE_PLN A
                            ,EQR_VSL_EXE_PLN_QTY Q
                            ,(
                                SELECT
                                    DISTINCT MTY_BKG_NO
                                FROM
                                    EQR_VSL_LODG_DCHG_EXE_PLN A
                                    ,EQR_VSL_EXE_PLN_QTY Q
                                    #if (${weeklymonthly} == '2')
                                        ,EQR_WK_PRD E
                                    #end
                                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                    #if ($arrFmEccCd.size() > 0)
                                        #if (${fmtype} == 'R')
                                            AND B.RCC_CD
                                        #elseif (${fmtype} == 'L')
                                            AND B.LCC_CD
                                        #else
                                            AND B.ECC_CD
                                        #end
                                        IN(
                                        #foreach ($key in ${arrFmEccCd})
                                            #if($velocityCount < $arrFmEccCd.size())
                                            '$key',
                                            #else
                                            '$key'
                                            #end
                                        #end
                                        )) C
                                    #else
                                        ) C
                                    #end
                                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                    #if ($arrToEccCd.size() > 0)
                                        #if (${totype} == 'R')
                                            AND B.RCC_CD
                                        #elseif (${totype} == 'L')
                                            AND B.LCC_CD
                                        #else
                                            AND B.ECC_CD
                                        #end
                                        IN(
                                        #foreach ($key in ${arrToEccCd})
                                            #if($velocityCount < $arrToEccCd.size())
                                            '$key',
                                            #else
                                            '$key'
                                            #end
                                        #end
                                        )) D
                                    #else
                                        ) D
                                    #end
                                WHERE
                                    A.REPO_PLN_ID = Q.REPO_PLN_ID
                                    AND A.PLN_YRWK = Q.PLN_YRWK
                                    AND A.PLN_SEQ = Q.PLN_SEQ
                                    AND A.REF_ID = Q.REF_ID
                                    AND A.REPO_MTY_BKG_FLG = 'Y'
                                    AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                                    #if (${weeklymonthly} == '2')
                                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                                    #end
                                    #if ($arrOddtpszCd.size() > 0)
                                        AND Q.CNTR_TPSZ_CD IN(
                                        #foreach ($key in ${arrOddtpszCd})
                                            #if($velocityCount < $arrOddtpszCd.size())
                                            '$key',
                                            #else
                                            '$key'
                                            #end
                                        #end
                                        )
                                    #end
                                    #if ($arrLane.size() > 0)
                                        AND VSL_LANE_CD IN(
                                        #foreach ($key in ${arrLane})
                                            #if($velocityCount < $arrLane.size())
                                            '$key',
                                            #else
                                            '$key'
                                            #end
                                        #end
                                        )
                                    #end
                                    #if (${item} == 'O' || ${item} == 'F')
                                        AND ONF_HIR_DIV_CD = @[item]
                                    #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                                        AND A.TRSP_MOD_CD = @[item]
                                    #end
                                    #if (${feedback} == 'on')
                                        AND REPO_PLN_FB_RSN_CD IS NOT NULL
                                    #end
                                    --AND   TRIM(A.MTY_BKG_NO_SPLIT) IS NULL
                                    AND A.SPLIT_REPO_PLN_FLG = 'N'
                                    #if(${fmPlnSYrWk} != '')
                                        AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                                    #end
                                    #if(${toPlnSYrWk} != '')
                                        AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                                    #end
                            ) B
                        WHERE 
                            A.REPO_PLN_ID = Q.REPO_PLN_ID
                            AND A.PLN_YRWK = Q.PLN_YRWK
                            AND A.PLN_SEQ = Q.PLN_SEQ
                            AND A.REF_ID = Q.REF_ID
                            AND A.MTY_BKG_NO = B.MTY_BKG_NO
                        GROUP BY A.MTY_BKG_NO ,Q.CNTR_TPSZ_CD
                    ) B
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND B.RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND B.RCC_CD
                        #elseif (${totype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    A.MTY_BKG_NO   = B.MTY_BKG_NO(+)
                    AND A.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD(+)
                    AND A.MTY_BKG_NO IS NOT NULL
                    AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    #if ($arrOddtpszCd.size() > 0)
                        AND A.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${item} == 'O' || ${item} == 'F')
                        AND ONF_HIR_DIV_CD = @[item]
                    #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                        AND A.TRSP_MOD_CD = @[item]
                    #end
                    #if (${feedback} == 'on')
                        AND REPO_PLN_FB_RSN_CD IS NOT NULL
                    #end
                    #if (${fmPlnSYrWk} != '')
                        AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                    #end
            #else
                #if (${weeklymonthly} == '1')
                    SELECT
                    (
                        SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                        FROM EQR_WK_PRD
                        WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                    )  PLN_YRWK
                #else
                    SELECT
                    (
                        SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                        FROM EQR_WK_PRD
                        WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                    )  PLN_MON
                #end
                    ,A.CO_CD
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(A.FM_YD_CD ,0,5)
                    ) FM_ECC_CD
                    ,(
                        SELECT B.
                        #if (${totypeby} == 'R')
                            RCC_CD
                        #elseif (${totypeby} == 'C')
                            CNT_CD
                        #elseif (${totypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(A.TO_YD_CD ,0,5)
                    ) TO_ECC_CD
                    ,A.TRSP_MOD_CD
                    ,Q.CNTR_QTY VOL
                    ,Q.LODG_DCHG_COST_AMT COST
                    ,A.REPO_PLN_FB_RSN_CD FEEDBACK_KEY
                    ,'2' FLAG
                FROM
                    EQR_VSL_LODG_DCHG_EXE_PLN A
                    , EQR_VSL_EXE_PLN_QTY Q
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND B.RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND B.RCC_CD
                        #elseif (${totype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    1=1
                    AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND A.REF_ID = Q.REF_ID
                    AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${item} == 'O' || ${item} == 'F')
                        AND ONF_HIR_DIV_CD = @[item]
                    #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                        AND A.TRSP_MOD_CD = @[item]
                    #end
                    #if (${feedback} == 'on')
                        AND REPO_PLN_FB_RSN_CD IS NOT NULL
                    #end
                    AND   A.MTY_BKG_NO IS NOT NULL
                    AND   Q.CNTR_QTY > 0
                    #if (${fmPlnSYrWk} != '')
                        AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
                    #if(${toPlnSYrWk} != '')
                        AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                    #end
            #end

            UNION ALL

            #if (${adherence} == 'O')
                -- ITEM = T.VVD
                -- W/O 2
                ------------- ORG ONLY
                #if (${weeklymonthly} == '1')
                    SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_YRWK
                #else
                    SELECT
                        (
                            SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_MON
                #end
                    ,A.CO_CD
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(A.FM_YD_CD ,0,5)
                    ) FM_ECC_CD
                    ,'ALL' TO_ECC_CD
                    ,A.TRSP_MOD_CD
                    --,DECODE(A.MTY_BKG_NO_SPLIT, '  ', B.CNTR_QTY, 0) VOL
                    ,DECODE(A.SPLIT_REPO_PLN_FLG, 'N', B.CNTR_QTY, 0) VOL
                    ,A.LODG_DCHG_COST_AMT COST
                    ,'' FEEDBACK_KEY
                    ,'3' FLAG    -- W/O FLAG
                FROM
                    (
                        SELECT
                            A.PLN_YRWK
                            , A.CO_CD
                            , A.TRSP_MOD_CD
                            , A.VSL_LANE_CD
                            , A.VSL_CD
                            , A.SKD_VOY_NO
                            , A.SKD_DIR_CD
                            , A.FM_YD_CD
                            , A.FM_ETD_DT
                            , A.TO_YD_CD
                            , A.TO_ETB_DT
                            , A.EQ_REPO_PURP_CD
                            , A.REPO_MTY_BKG_FLG
                            , A.REPO_PLN_FB_RSN_CD
                            , A.REPO_PLN_FB_RMK
                            , A.MTY_BKG_NO
                            , A.SPLIT_REPO_PLN_FLG
                            , A.PAST_REPO_PLN_FLG
                            , Q.CNTR_TPSZ_CD
                            , Q.CNTR_QTY
                            , Q.LODG_DCHG_COST_AMT
                            , Q.PLN_UC_AMT
                            , Q.LODG_PORT_UC_AMT
                            , Q.DCHG_PORT_UC_AMT
                        FROM
                            EQR_VSL_LODG_DCHG_EXE_PLN A
                            , EQR_VSL_EXE_PLN_QTY Q
                        WHERE
                            A.REPO_PLN_ID = Q.REPO_PLN_ID
                            AND A.PLN_YRWK = Q.PLN_YRWK
                            AND A.PLN_SEQ = Q.PLN_SEQ
                            AND A.REF_ID = Q.REF_ID
                    ) A
                    ,(
                        -- original booking vol 집계
                        SELECT
                            DISTINCT A.MTY_BKG_NO
                            ,Q.CNTR_TPSZ_CD
                            ,SUM(Q.CNTR_QTY) CNTR_QTY
                        FROM
                            EQR_VSL_LODG_DCHG_EXE_PLN A
                            , EQR_VSL_EXE_PLN_QTY Q
                            ,(
                                SELECT
                                    DISTINCT MTY_BKG_NO
                                FROM
                                    EQR_VSL_LODG_DCHG_EXE_PLN A
                                    , EQR_VSL_EXE_PLN_QTY Q
                                    #if (${weeklymonthly} == '2')
                                        ,EQR_WK_PRD E
                                    #end
                                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                    #if ($arrFmEccCd.size() > 0)
                                        #if (${fmtype} == 'R')
                                            AND B.RCC_CD
                                        #elseif (${fmtype} == 'L')
                                            AND B.LCC_CD
                                        #else
                                            AND B.ECC_CD
                                        #end
                                        IN(
                                        #foreach ($key in ${arrFmEccCd})
                                            #if($velocityCount < $arrFmEccCd.size())
                                            '$key',
                                            #else
                                            '$key'
                                            #end
                                        #end
                                        )) C
                                    #else
                                        ) C
                                    #end
                                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                    #if ($arrToEccCd.size() > 0)
                                        #if (${totype} == 'R')
                                            AND B.RCC_CD
                                        #elseif (${totype} == 'L')
                                            AND B.LCC_CD
                                        #else
                                            AND B.ECC_CD
                                        #end
                                        IN(
                                        #foreach ($key in ${arrToEccCd})
                                            #if($velocityCount < $arrToEccCd.size())
                                            '$key',
                                            #else
                                            '$key'
                                            #end
                                        #end
                                        )) D
                                    #else
                                        ) D
                                    #end
                                WHERE
                                    A.REPO_PLN_ID = Q.REPO_PLN_ID
                                    AND A.PLN_YRWK = Q.PLN_YRWK
                                    AND A.PLN_SEQ = Q.PLN_SEQ
                                    AND A.REF_ID = Q.REF_ID
                                    AND A.REPO_MTY_BKG_FLG = 'Y'
                                    AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                                    #if (${weeklymonthly} == '2')
                                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                                    #end
                                    #if ($arrOddtpszCd.size() > 0)
                                        AND Q.CNTR_TPSZ_CD IN(
                                        #foreach ($key in ${arrOddtpszCd})
                                            #if($velocityCount < $arrOddtpszCd.size())
                                            '$key',
                                            #else
                                            '$key'
                                            #end
                                        #end
                                        )
                                    #end
                                    #if ($arrLane.size() > 0)
                                        AND VSL_LANE_CD IN(
                                        #foreach ($key in ${arrLane})
                                            #if($velocityCount < $arrLane.size())
                                            '$key',
                                            #else
                                            '$key'
                                            #end
                                        #end
                                        )
                                    #end
                                    #if (${item} == 'O' || ${item} == 'F')
                                        AND ONF_HIR_DIV_CD = @[item]
                                    #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                                        AND A.TRSP_MOD_CD = @[item]
                                    #end
                                    #if (${feedback} == 'on')
                                        AND REPO_PLN_FB_RSN_CD IS NOT NULL
                                    #end
                                    --AND   TRIM(A.MTY_BKG_NO_SPLIT) IS NULL
                                    AND A.SPLIT_REPO_PLN_FLG = 'N'
                                    #if (${fmPlnSYrWk} != '')
                                        AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                                    #end
                                    #if (${toPlnSYrWk} != '')
                                        AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                                    #end
                            ) B
                        WHERE 
                            A.REPO_PLN_ID = Q.REPO_PLN_ID
                            AND A.PLN_YRWK = Q.PLN_YRWK
                            AND A.PLN_SEQ = Q.PLN_SEQ
                            AND A.REF_ID = Q.REF_ID
                            AND A.MTY_BKG_NO = B.MTY_BKG_NO
                        GROUP BY A.MTY_BKG_NO ,Q.CNTR_TPSZ_CD
                    ) B
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND B.RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND B.RCC_CD
                        #elseif (${totype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    A.MTY_BKG_NO   = B.MTY_BKG_NO(+)
                    AND A.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD(+)
                    AND A.MTY_BKG_NO IS NOT NULL
                    AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    #if ($arrOddtpszCd.size() > 0)
                        AND A.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${item} == 'O' || ${item} == 'F')
                        AND ONF_HIR_DIV_CD = @[item]
                    #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                        AND A.TRSP_MOD_CD = @[item]
                    #end
                    #if (${feedback} == 'on')
                        AND REPO_PLN_FB_RSN_CD IS NOT NULL
                    #end
                    #if (${fmPlnSYrWk} != '')
                        AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                    #end
            #else
                -- ITEM = T.VVD
                -- W/O 2
                #if (${weeklymonthly} == '1')
                    SELECT
                    (
                        SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                        FROM EQR_WK_PRD
                        WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                    )  PLN_YRWK
                #else
                    SELECT
                    (
                        SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                        FROM EQR_WK_PRD
                        WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                    )  PLN_MON
                #end
                    ,A.CO_CD
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(A.FM_YD_CD ,0,5)
                    ) FM_ECC_CD
                    ,(
                        SELECT B.
                        #if (${totypeby} == 'R')
                            RCC_CD
                        #elseif (${totypeby} == 'C')
                            CNT_CD
                        #elseif (${totypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(A.TO_YD_CD ,0,5)
                    ) TO_ECC_CD
                    ,A.TRSP_MOD_CD
                    ,Q.CNTR_QTY VOL
                    ,Q.LODG_DCHG_COST_AMT COST
                    ,'' FEEDBACK_KEY
                    ,'3' FLAG
                FROM
                    EQR_VSL_LODG_DCHG_EXE_PLN A
                    , EQR_VSL_EXE_PLN_QTY Q
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND B.RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND B.RCC_CD
                        #elseif (${totype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    1=1
                    AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND A.REF_ID = Q.REF_ID
                    AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${item} == 'O' || ${item} == 'F')
                        AND ONF_HIR_DIV_CD = @[item]
                    #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                        AND A.TRSP_MOD_CD = @[item]
                    #end
                    #if (${feedback} == 'on')
                        AND REPO_PLN_FB_RSN_CD IS NOT NULL
                    #end
                    AND   A.MTY_BKG_NO IS NOT NULL
                    AND   Q.CNTR_QTY > 0
                    #if (${fmPlnSYrWk} != '')
                        AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                    #end
            #end

            UNION ALL

            ---------------------- FEEDBACK -------------------------------
            -- VESSEL FEEDBACK
            SELECT
                A.
                #if (${weeklymonthly} == '1')
                    PLN_YRWK
                #elseif (${weeklymonthly} == '2')
                    PLN_MON
                #end
                ,A.CO_CD
                ,A.FM_ECC_CD
                ,A.TO_ECC_CD
                ,A.TRSP_MOD_CD
                ,SUM(A.RSN_COUNT) VOL
                ,0 COST
                ,A.REPO_PLN_FB_RSN_CD FEEDBACK_KEY
                ,'4' FLAG
            FROM
            (
                SELECT
                    DISTINCT A.REF_ID
                    ,A.CO_CD
                    ,A.TRSP_MOD_CD
                    #if (${weeklymonthly} == '1')
                        ,(
                            SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_YRWK
                    #else
                        ,(
                            SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_MON
                    #end
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(FM_YD_CD ,0,5)
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT B.
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                        ) TO_ECC_CD
                    #end
                    ,A.MTY_BKG_NO
                    --,A.MTY_BKG_NO_SPLIT
                    ,A.REPO_PLN_FB_RSN_CD
                    ,1 RSN_COUNT
                FROM
                    EQR_VSL_LODG_DCHG_EXE_PLN A
                    , EQR_VSL_EXE_PLN_QTY Q
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND B.RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND B.RCC_CD
                        #elseif (${totype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    1=1
                    AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND A.REF_ID = Q.REF_ID
                    AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${item} == 'O' || ${item} == 'F')
                        AND ONF_HIR_DIV_CD = @[item]
                    #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                        AND A.TRSP_MOD_CD = @[item]
                    #end
                    #if (${feedback} == 'on')
                        AND REPO_PLN_FB_RSN_CD IS NOT NULL
                    #end
                    AND   A.MTY_BKG_NO IS NOT NULL
                    --AND   TRIM(A.MTY_BKG_NO_SPLIT) IS NULL
                    AND   SPLIT_REPO_PLN_FLG = 'N'
                    AND   A.REPO_PLN_FB_RSN_CD IS NOT NULL
                    #if (${fmPlnSYrWk} != '')
                        AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                    #end
            ) A
            GROUP BY
                A.
                #if (${weeklymonthly} == '1')
                    PLN_YRWK
                #elseif (${weeklymonthly} == '2')
                    PLN_MON
                #end
                ,A.CO_CD
                ,A.FM_ECC_CD
                ,A.TO_ECC_CD
                ,A.TRSP_MOD_CD
                ,A.REPO_PLN_FB_RSN_CD
        #elseif(${item} == 'W' || ${item} == 'R' || ${item} == 'T')
            #if (${lane} == '')
                -- ITEM = Rail(R), Truck(T), Water(W)  -------------------------------------------------
                -- Plan ID 3
                SELECT
                    #if (${weeklymonthly} == '1')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||SUBSTR(A.PLN_YRWK,5,6) PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                    #end
                    ,'' CO_CD
                    ,(
                        SELECT
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST
                        WHERE FM_ECC_CD = ECC_CD
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST
                            WHERE TO_ECC_CD = ECC_CD
                        ) TO_ECC_CD
                    #end
                    ,TRSP_MOD_CD
                    ,SUM(CNTR_QTY) VOL
                    ,SUM(TRSP_COST_AMT) COST
                    ,''  FEEDBACK_KEY
                    ,'1' FLAG
                FROM
                    EQR_INLND_TRSP_PLN A
                    , EQR_INLND_TRSP_PLN_QTY Q
                    , EQR_EQ_REPO_PLN B
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND LCC_CD
                        #else
                            AND ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND RCC_CD
                        #elseif (${totype} == 'L')
                            AND LCC_CD
                        #else
                            AND ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND A.REPO_PLN_ID = B.REPO_PLN_ID
                    AND FM_ECC_CD = C.ECC_CD AND TO_ECC_CD = D.ECC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${item} == 'O' || ${item} == 'F')
                        AND ONF_HIR_DIV_CD = @[item]
                    #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                        AND A.TRSP_MOD_CD = @[item]
                    #end
                    AND A.PAST_REPO_PLN_FLG NOT IN('Y')
                    AND B.REPO_PLN_DTRB_FLG ='Y'       -- 새로 추가된 조건
                    AND SUBSTR(A.REPO_PLN_ID,5,6) = A.PLN_YRWK
                    #if (${fmPlnSYrWk} != '')
                        AND FM_YRWK BETWEEN @[fmPlnSYrWk] AND @[fmPlnEYrWk]
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_YRWK BETWEEN @[toPlnSYrWk] AND @[toPlnEYrWk]
                    #end
                GROUP BY
                    #if (${weeklymonthly} == '1')
                        A.PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        A.PLN_YRWK, PLN_MON
                    #end
                    , FM_ECC_CD
                    , TO_ECC_CD
                    , TRSP_MOD_CD
                
                -- 새로 추가된 개념(20080610)
                -- CSR NO : N200805150003
                -- modified by shin yongchan - 20080602
                UNION ALL
                SELECT
                    #if (${weeklymonthly} == '1')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||SUBSTR(A.PLN_YRWK,5,6) PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                    #end
                    ,'' CO_CD
                    ,(
                        SELECT
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST
                        WHERE FM_ECC_CD = ECC_CD
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST
                            WHERE TO_ECC_CD = ECC_CD
                        ) TO_ECC_CD
                    #end
                    ,TRSP_MOD_CD
                    ,SUM(CNTR_QTY) VOL
                    ,SUM(TRSP_COST_AMT) COST
                    ,''  FEEDBACK_KEY
                    ,'1' FLAG
                FROM
                    EQR_INLND_TRSP_PLN A
                    , EQR_INLND_TRSP_PLN_QTY Q
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND LCC_CD
                        #else
                            AND ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND RCC_CD
                        #elseif (${totype} == 'L')
                            AND LCC_CD
                        #else
                            AND ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND A.PAST_REPO_PLN_FLG NOT IN('Y')
                    AND FM_ECC_CD = C.ECC_CD AND TO_ECC_CD = D.ECC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${item} == 'O' || ${item} == 'F')
                        AND ONF_HIR_DIV_CD = @[item]
                    #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                        AND A.TRSP_MOD_CD = @[item]
                    #end
                    AND SUBSTR(A.REPO_PLN_ID,5,6) <> A.PLN_YRWK
                    #if (${fmPlnSYrWk} != '')
                        AND FM_YRWK BETWEEN @[fmPlnSYrWk] AND @[fmPlnEYrWk]
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_YRWK BETWEEN @[toPlnSYrWk] AND @[toPlnEYrWk]
                    #end
                    -- EXE 테이블과의 조인
                    AND (A.REPO_PLN_ID, A.FM_ECC_CD, A.TO_ECC_CD, A.TRSP_MOD_CD ) IN
                    (
                        SELECT
                            REPO_PLN_ID
                            , FM_ECC
                            , TO_ECC
                            , TRSP_MOD_CD
                        FROM
                        (
                            SELECT
                                DISTINCT A.REPO_PLN_ID REPO_PLN_ID,
                                (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SUBSTR(A.FM_YD_CD,1,5) = SCC_CD) FM_ECC,
                                (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SUBSTR(A.TO_YD_CD,1,5) = SCC_CD) TO_ECC,
                                A.TRSP_MOD_CD
                            FROM
                                EQR_INLND_TRSP_EXE_PLN A
                                , EQR_INLND_TRSP_EXE_PLN_QTY Q
                                #if (${weeklymonthly} == '2')
                                    ,EQR_WK_PRD E
                                #end
                                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                #if ($arrFmEccCd.size() > 0)
                                    #if (${fmtype} == 'R')
                                        AND B.RCC_CD
                                    #elseif (${fmtype} == 'L')
                                        AND B.LCC_CD
                                    #else
                                        AND B.ECC_CD
                                    #end
                                    IN(
                                    #foreach ($key in ${arrFmEccCd})
                                        #if($velocityCount < $arrFmEccCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )) C
                                #else
                                    ) C
                                #end
                                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                #if ($arrToEccCd.size() > 0)
                                    #if (${totype} == 'R')
                                        AND B.RCC_CD
                                    #elseif (${totype} == 'L')
                                        AND B.LCC_CD
                                    #else
                                        AND B.ECC_CD
                                    #end
                                    IN(
                                    #foreach ($key in ${arrToEccCd})
                                        #if($velocityCount < $arrToEccCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )) D
                                #else
                                    ) D
                                #end
                            WHERE
                                1=1
                                AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                                AND A.PLN_YRWK = Q.PLN_YRWK
                                AND A.PLN_SEQ = Q.PLN_SEQ
                                AND A.REF_ID = Q.REF_ID
                                AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                                #if (${weeklymonthly} == '2')
                                    AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                                #end
                                #if ($arrOddtpszCd.size() > 0)
                                    AND Q.CNTR_TPSZ_CD IN(
                                    #foreach ($key in ${arrOddtpszCd})
                                        #if($velocityCount < $arrOddtpszCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )
                                #end
                                #if ($arrLane.size() > 0)
                                    AND VSL_LANE_CD IN(
                                    #foreach ($key in ${arrLane})
                                        #if($velocityCount < $arrLane.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )
                                #end
                                #if (${item} == 'O' || ${item} == 'F')
                                    AND ONF_HIR_DIV_CD = @[item]
                                #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                                    AND A.TRSP_MOD_CD = @[item]
                                #end
                                #if (${feedback} == 'on')
                                    AND REPO_PLN_FB_RSN_CD IS NOT NULL
                                #end
                                #if (${fmPlnSYrWk} != '')
                                    AND TO_CHAR (FM_ETD_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                                #end
                                #if (${toPlnSYrWk} != '')
                                    AND TO_CHAR (TO_ETA_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                                    AND (SELECT wk_end_dt FROM eqr_wk_prd WHERE pln_yr || pln_wk = @[toPlnEYrWk])
                                #end
                                AND A.PLN_YRWK =  (SELECT PLN_YR||PLN_WK FROM EQR_WK_PRD WHERE TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT )
                                AND REPO_MTY_BKG_FLG ='Y' -- 중요함
                
                            UNION ALL
                
                            SELECT
                                DISTINCT
                                A.REPO_PLN_ID REPO_PLN_ID,
                                (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SUBSTR(A.FM_YD_CD,1,5) = SCC_CD) FM_ECC,
                                (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SUBSTR(A.TO_YD_CD,1,5) = SCC_CD) TO_ECC,
                                A.TRSP_MOD_CD
                            FROM
                                EQR_INLND_TRSP_EXE_PLN A
                                , EQR_INLND_TRSP_EXE_PLN_QTY Q
                                , EQR_REPO_EXE_SO_IF B
                                #if (${weeklymonthly} == '2')
                                    ,EQR_WK_PRD E
                                #end
                                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                #if ($arrFmEccCd.size() > 0)
                                    #if (${fmtype} == 'R')
                                        AND B.RCC_CD
                                    #elseif (${fmtype} == 'L')
                                        AND B.LCC_CD
                                    #else
                                        AND B.ECC_CD
                                    #end
                                    IN(
                                    #foreach ($key in ${arrFmEccCd})
                                        #if($velocityCount < $arrFmEccCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )) C
                                #else
                                    ) C
                                #end
                                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                                #if ($arrToEccCd.size() > 0)
                                    #if (${totype} == 'R')
                                        AND B.RCC_CD
                                    #elseif (${totype} == 'L')
                                        AND B.LCC_CD
                                    #else
                                        AND B.ECC_CD
                                    #end
                                    IN(
                                    #foreach ($key in ${arrToEccCd})
                                        #if($velocityCount < $arrToEccCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )) D
                                #else
                                    ) D
                                #end
                            WHERE
                                A.REPO_PLN_ID = Q.REPO_PLN_ID
                                AND A.PLN_YRWK = Q.PLN_YRWK
                                AND A.PLN_SEQ = Q.PLN_SEQ
                                AND A.REF_ID = Q.REF_ID
                                AND A.REPO_PLN_ID = B.REPO_PLN_ID
                                AND A.PLN_YRWK = B.PLN_YRWK
                                AND A.REF_ID   = B.REF_ID
                                AND Q.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD
                                AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                                #if (${weeklymonthly} == '2')
                                    AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                                #end
                                #if ($arrOddtpszCd.size() > 0)
                                    AND Q.CNTR_TPSZ_CD IN(
                                    #foreach ($key in ${arrOddtpszCd})
                                        #if($velocityCount < $arrOddtpszCd.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )
                                #end
                                #if ($arrLane.size() > 0)
                                    AND VSL_LANE_CD IN(
                                    #foreach ($key in ${arrLane})
                                        #if($velocityCount < $arrLane.size())
                                        '$key',
                                        #else
                                        '$key'
                                        #end
                                    #end
                                    )
                                #end
                                #if (${item} == 'O' || ${item} == 'F')
                                    AND ONF_HIR_DIV_CD = @[item]
                                #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                                    AND A.TRSP_MOD_CD = @[item]
                                #end
                                #if (${feedback} == 'on')
                                    AND REPO_PLN_FB_RSN_CD IS NOT NULL
                                #end
                                #if (${fmPlnSYrWk} != '')
                                    AND TO_CHAR (FM_ETD_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                                #end
                                #if (${toPlnSYrWk} != '')
                                    AND TO_CHAR (TO_ETA_DT, 'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                                #end
                                AND A.PLN_YRWK =  (SELECT PLN_YR||PLN_WK FROM EQR_WK_PRD WHERE TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT )
                                AND B.WO_EXE_FLG ='Y' -- 중요함
                        )
                    )
                GROUP BY
                    #if (${weeklymonthly} == '1')
                        A.PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        A.PLN_YRWK, PLN_MON
                    #end
                    , FM_ECC_CD
                    , TO_ECC_CD
                    , TRSP_MOD_CD

                UNION ALL

                -- ITEM = Rail(R), Truck(T), Water(W)
                -- Execultion 3
                SELECT
                    #if (${weeklymonthly} == '1')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||SUBSTR(A.PLN_YRWK,5,6) PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        SUBSTR(A.PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                    #end
                    ,CO_CD
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(FM_YD_CD ,0,5)
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT B.
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                        ) TO_ECC_CD
                    #end
                    ,TRSP_MOD_CD
                    ,CNTR_QTY VOL
                    ,TRSP_COST_AMT COST
                    ,REPO_PLN_FB_RSN_CD    FEEDBACK_KEY
                    ,'2' FLAG
                FROM
                    EQR_INLND_TRSP_EXE_PLN A
                    , EQR_INLND_TRSP_EXE_PLN_QTY Q
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND B.RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND B.RCC_CD
                        #elseif (${totype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    1=1
                    AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND A.REF_ID = Q.REF_ID
                    AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${item} == 'O' || ${item} == 'F')
                        AND ONF_HIR_DIV_CD = @[item]
                    #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                        AND A.TRSP_MOD_CD = @[item]
                    #end
                    #if (${feedback} == 'on')
                        AND REPO_PLN_FB_RSN_CD IS NOT NULL
                    #end
                    AND CNTR_QTY <> 0
                    AND PAST_REPO_PLN_FLG NOT IN ('Y')
                    #if (${fmPlnSYrWk} != '')
                        AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_CHAR(TO_ETA_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                    #end

                UNION ALL

                -- ITEM = Rail(R), Truck(T), Water(W), Shuttle(S) ------------------------------------------------
                -- W/O 1
                SELECT
                    #if (${weeklymonthly} == '1')
                        SUBSTR(PLN_YRWK,0,4)||'-'||SUBSTR(PLN_YRWK,5,6) PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        SUBSTR(PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                    #end
                    ,CO_CD
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(FM_YD_CD ,0,5)
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT B.
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                        ) TO_ECC_CD
                    #end
                    ,SO_IF_DIV_CD TRSP_MOD_CD
                    ,COUNT(CNTR_TPSZ_CD) VOL
                    ,SUM(REPO_COST_AMT) COST
                    ,''  FEEDBACK_KEY
                    ,'3' FLAG
                FROM
                    EQR_REPO_EXE_SO_IF A
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND B.RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND B.RCC_CD
                        #elseif (${totype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE 1=1
                    AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    AND WO_EXE_FLG = 'Y'
                    #if ($arrOddtpszCd.size() > 0)
                        AND A.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${item} == '')
                        AND SO_IF_DIV_CD IN('R','T','W','S')
                    #else
                        AND SO_IF_DIV_CD = @[item]
                    #end
                    AND PAST_REPO_PLN_FLG NOT IN ('Y')
                    #if (${fmPlnSYrWk} != '')
                        AND FM_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                    #end
                GROUP BY
                    #if (${weeklymonthly} == '1')
                        PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        PLN_YRWK, PLN_MON
                    #end
                    , CO_CD
                    , FM_YD_CD
                    , TO_YD_CD
                    , SO_IF_DIV_CD

                UNION ALL

                -- INLAND FEEDBACK
                SELECT
                    A.
                    #if (${weeklymonthly} == '1')
                        PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        PLN_MON
                    #end
                    ,A.CO_CD
                    ,A.FM_ECC_CD
                    ,A.TO_ECC_CD
                    ,A.TRSP_MOD_CD
                    ,SUM(A.RSN_COUNT) VOL
                    ,0 COST
                    ,A.REPO_PLN_FB_RSN_CD FEEDBACK_KEY
                    ,'4' FLAG
                FROM
                (
                    SELECT
                        DISTINCT A.REF_ID
                        ,A.CO_CD
                        ,A.TRSP_MOD_CD
                        #if (${weeklymonthly} == '1')
                            ,(
                                SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                                FROM EQR_WK_PRD
                                WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                            )  PLN_YRWK
                        #else
                            ,(
                                SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                                FROM EQR_WK_PRD
                                WHERE TO_CHAR(A.FM_ETD_DT, 'YYYYMMDD') BETWEEN WK_ST_DT AND WK_END_DT
                            )  PLN_MON
                        #end
                        ,(
                            SELECT B.
                            #if (${fmtypeby} == 'R')
                                RCC_CD
                            #elseif (${fmtypeby} == 'C')
                                CNT_CD
                            #elseif (${fmtypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(FM_YD_CD ,0,5)
                        ) FM_ECC_CD
                        #if (${adherence} == 'O')
                            ,'ALL' TO_ECC_CD
                        #else
                            ,(
                                SELECT B.
                                #if (${totypeby} == 'R')
                                    RCC_CD
                                #elseif (${totypeby} == 'C')
                                    CNT_CD
                                #elseif (${totypeby} == 'L')
                                    LCC_CD
                                #else
                                    ECC_CD
                                #end
                                FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                                WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                            ) TO_ECC_CD
                        #end
                        ,A.MTY_BKG_NO
                        --,A.MTY_BKG_NO_SPLIT
                        ,A.REPO_PLN_FB_RSN_CD
                        ,1 RSN_COUNT
                    FROM
                        EQR_INLND_TRSP_EXE_PLN A
                        , EQR_INLND_TRSP_EXE_PLN_QTY Q
                        #if (${weeklymonthly} == '2')
                            ,EQR_WK_PRD E
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrFmEccCd.size() > 0)
                            #if (${fmtype} == 'R')
                                AND B.RCC_CD
                            #elseif (${fmtype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrFmEccCd})
                                #if($velocityCount < $arrFmEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) C
                        #else
                            ) C
                        #end
                        ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                        #if ($arrToEccCd.size() > 0)
                            #if (${totype} == 'R')
                                AND B.RCC_CD
                            #elseif (${totype} == 'L')
                                AND B.LCC_CD
                            #else
                                AND B.ECC_CD
                            #end
                            IN(
                            #foreach ($key in ${arrToEccCd})
                                #if($velocityCount < $arrToEccCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )) D
                        #else
                            ) D
                        #end
                    WHERE
                        1=1
                        AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                        AND A.PLN_YRWK = Q.PLN_YRWK
                        AND A.PLN_SEQ = Q.PLN_SEQ
                        AND A.REF_ID = Q.REF_ID
                        AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                        #if (${weeklymonthly} == '2')
                            AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                        #end
                        #if ($arrOddtpszCd.size() > 0)
                            AND Q.CNTR_TPSZ_CD IN(
                            #foreach ($key in ${arrOddtpszCd})
                                #if($velocityCount < $arrOddtpszCd.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if ($arrLane.size() > 0)
                            AND VSL_LANE_CD IN(
                            #foreach ($key in ${arrLane})
                                #if($velocityCount < $arrLane.size())
                                '$key',
                                #else
                                '$key'
                                #end
                            #end
                            )
                        #end
                        #if (${item} == 'O' || ${item} == 'F')
                            AND ONF_HIR_DIV_CD = @[item]
                        #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                            AND A.TRSP_MOD_CD = @[item]
                        #end
                        #if (${feedback} == 'on')
                            AND REPO_PLN_FB_RSN_CD IS NOT NULL
                        #end
                        AND CNTR_QTY <> 0
                        AND PAST_REPO_PLN_FLG NOT IN ('Y')
                        #if (${fmPlnSYrWk} != '')
                            AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                            AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                        #end
                        #if (${toPlnSYrWk} != '')
                            AND TO_CHAR(TO_ETA_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                            AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                        #end
                ) A
                GROUP BY
                    A.
                    #if (${weeklymonthly} == '1')
                        PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        PLN_MON
                    #end
                    ,A.CO_CD
                    ,A.FM_ECC_CD
                    ,A.TO_ECC_CD
                    ,A.TRSP_MOD_CD
                    ,A.REPO_PLN_FB_RSN_CD
            #else
                -- ITEM = Rail(R), Truck(T), Water(W), Shuttle(S) ------------------------------------------------
                -- W/O 1
                SELECT
                    #if (${weeklymonthly} == '1')
                        SUBSTR(PLN_YRWK,0,4)||'-'||SUBSTR(PLN_YRWK,5,6) PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        SUBSTR(PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                    #end
                    ,CO_CD
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(FM_YD_CD ,0,5)
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT B.
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                        ) TO_ECC_CD
                    #end
                    ,SO_IF_DIV_CD TRSP_MOD_CD
                    ,COUNT(CNTR_TPSZ_CD) VOL
                    ,SUM(REPO_COST_AMT) COST
                    ,''  FEEDBACK_KEY
                    ,'3' FLAG
                FROM
                    EQR_REPO_EXE_SO_IF A
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND B.RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND B.RCC_CD
                        #elseif (${totype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE 1=1
                    AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    AND WO_EXE_FLG = 'Y'
                    #if ($arrOddtpszCd.size() > 0)
                        AND A.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${item} == '')
                        AND SO_IF_DIV_CD IN('R','T','W','S')
                    #else
                        AND SO_IF_DIV_CD = @[item]
                    #end
                    AND PAST_REPO_PLN_FLG NOT IN ('Y')
                    #if (${fmPlnSYrWk} != '')
                        AND FM_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
                    #if (${toPlnSYrWk} != '')
                        AND TO_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                    #end
                GROUP BY
                    #if (${weeklymonthly} == '1')
                        PLN_YRWK
                    #elseif (${weeklymonthly} == '2')
                        PLN_YRWK, PLN_MON
                    #end
                    , CO_CD
                    , FM_YD_CD
                    , TO_YD_CD
                    , SO_IF_DIV_CD
            #end
        #elseif(${item} == 'O')
            -- ITEM = On-Hire(O)  ------------------------------------------------------------------
            -- Plan ID 2
            SELECT
                #if (${weeklymonthly} == '1')
                    SUBSTR(A.PLN_YRWK,0,4)||'-'||SUBSTR(A.PLN_YRWK,5,6) PLN_YRWK
                #elseif (${weeklymonthly} == '2')
                    SUBSTR(A.PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                #end
                ,'' CO_CD
                ,(
                    SELECT
                    #if (${fmtypeby} == 'R')
                        RCC_CD
                    #elseif (${fmtypeby} == 'C')
                        CNT_CD
                    #elseif (${fmtypeby} == 'L')
                        LCC_CD
                    #else
                        ECC_CD
                    #end
                    FROM EQR_ECC_MST
                    WHERE DECODE(ONF_HIR_DIV_CD , 'O', A.ECC_CD,'F',A.ECC_CD) = ECC_CD
                ) FM_ECC_CD
                #if (${adherence} == 'O')
                    ,'ALL' TO_ECC_CD
                #else
                    ,(
                        SELECT
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST
                        WHERE DECODE(ONF_HIR_DIV_CD , 'O', A.ECC_CD,'F',A.ECC_CD) = ECC_CD
                    ) TO_ECC_CD
                #end
                ,ONF_HIR_DIV_CD TRSP_MOD_CD
                ,SUM(CNTR_QTY)   VOL
                ,SUM(ONF_HIR_COST_AMT) COST
                ,''  FEEDBACK_KEY
                ,'1' FLAG
            -- CSRNO : N200712050007 추가
            FROM
                EQR_ONF_HIR_PLN A
                , EQR_ONF_HIR_PLN_QTY Q
                , EQR_EQ_REPO_PLN B
                #if (${weeklymonthly} == '2')
                    ,EQR_WK_PRD E
                #end
                ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                #if ($arrFmEccCd.size() > 0)
                    #if (${fmtype} == 'R')
                        AND RCC_CD
                    #elseif (${fmtype} == 'L')
                        AND LCC_CD
                    #else
                        AND ECC_CD
                    #end
                    IN(
                    #foreach ($key in ${arrFmEccCd})
                        #if($velocityCount < $arrFmEccCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )) C
                #else
                    ) C
                #end
            WHERE
                A.REPO_PLN_ID = Q.REPO_PLN_ID
                AND A.PLN_YRWK = Q.PLN_YRWK
                AND A.PLN_SEQ = Q.PLN_SEQ
                AND A.REPO_PLN_ID = B.REPO_PLN_ID
                AND A.ECC_CD = C.ECC_CD
                #if (${weeklymonthly} == '2')
                    AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                #end
                #if ($arrOddtpszCd.size() > 0)
                    AND Q.CNTR_TPSZ_CD IN(
                    #foreach ($key in ${arrOddtpszCd})
                        #if($velocityCount < $arrOddtpszCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )
                #end
                AND A.ONF_HIR_DIV_CD    IN ('O','F')
                AND B.REPO_PLN_DTRB_FLG ='Y'                  -- 새로 추가된 조건
                AND SUBSTR(A.REPO_PLN_ID,5,6) = A.PLN_YRWK	-- 새로 추가된 조건
                #if (${fmPlnSYrWk} != '')
                    AND A.PLN_YRWK BETWEEN @[fmPlnSYrWk] AND @[fmPlnEYrWk]
                #end
            GROUP BY
                #if (${weeklymonthly} == '1')
                    A.PLN_YRWK
                #elseif (${weeklymonthly} == '2')
                    A.PLN_YRWK, PLN_MON
                #end
                , A.ECC_CD
                , ONF_HIR_DIV_CD
            
            -- 새로 추가된 개념(20080610)
            -- CSR NO : N200805150003
            -- modified by shin yongchan - 20080602
            UNION ALL
            SELECT
                #if (${weeklymonthly} == '1')
                    SUBSTR(A.PLN_YRWK,0,4)||'-'||SUBSTR(A.PLN_YRWK,5,6) PLN_YRWK
                #elseif (${weeklymonthly} == '2')
                    SUBSTR(A.PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                #end
                ,'' CO_CD
                ,(
                    SELECT
                    #if (${fmtypeby} == 'R')
                        RCC_CD
                    #elseif (${fmtypeby} == 'C')
                        CNT_CD
                    #elseif (${fmtypeby} == 'L')
                        LCC_CD
                    #else
                        ECC_CD
                    #end
                    FROM EQR_ECC_MST
                    WHERE DECODE(ONF_HIR_DIV_CD , 'O', A.ECC_CD,'F',A.ECC_CD) = ECC_CD
                ) FM_ECC_CD
                #if (${adherence} == 'O')
                    ,'ALL' TO_ECC_CD
                #else
                    ,(
                        SELECT
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST
                        WHERE DECODE(ONF_HIR_DIV_CD , 'O', A.ECC_CD,'F',A.ECC_CD) = ECC_CD
                    ) TO_ECC_CD
                #end
                ,ONF_HIR_DIV_CD TRSP_MOD_CD
                ,SUM(CNTR_QTY)   VOL
                ,SUM(ONF_HIR_COST_AMT) COST
                ,''  FEEDBACK_KEY
                ,'1' FLAG
            FROM
                EQR_ONF_HIR_PLN A
                ,EQR_ONF_HIR_PLN_QTY Q
                #if (${weeklymonthly} == '2')
                    ,EQR_WK_PRD E
                #end
                ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                #if ($arrFmEccCd.size() > 0)
                    #if (${fmtype} == 'R')
                        AND RCC_CD
                    #elseif (${fmtype} == 'L')
                        AND LCC_CD
                    #else
                        AND ECC_CD
                    #end
                    IN(
                    #foreach ($key in ${arrFmEccCd})
                        #if($velocityCount < $arrFmEccCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )) C
                #else
                    ) C
                #end
            WHERE
                1=1
                AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                AND A.PLN_YRWK = Q.PLN_YRWK
                AND A.PLN_SEQ = Q.PLN_SEQ
                AND A.ECC_CD = C.ECC_CD
                #if (${weeklymonthly} == '2')
                    AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                #end
                #if ($arrOddtpszCd.size() > 0)
                    AND Q.CNTR_TPSZ_CD IN(
                    #foreach ($key in ${arrOddtpszCd})
                        #if($velocityCount < $arrOddtpszCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )
                #end
                AND A.ONF_HIR_DIV_CD    IN ('O','F')
                AND SUBSTR(A.REPO_PLN_ID,5,6) <> A.PLN_YRWK	-- 새로 추가된 조건
                #if (${fmPlnSYrWk} != '')
                    AND A.PLN_YRWK BETWEEN @[fmPlnSYrWk] AND @[fmPlnEYrWk]
                #end
                -- EXE 테이블과의 조인
                AND (A.REPO_PLN_ID, A.ONF_HIR_DIV_CD, A.ECC_CD ) IN
                (
                    SELECT
                        REPO_PLN_ID
                        , ONF_HIR_DIV_CD
                        , FM_ECC
                    FROM
                    (
                        SELECT
                            DISTINCT A.REPO_PLN_ID REPO_PLN_ID
                            , A.ONF_HIR_DIV_CD
                            , (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SUBSTR(A.FM_YD_CD,1,5) = SCC_CD) FM_ECC
                        FROM
                            EQR_ONF_HIR_EXE_PLN A
                            , EQR_ONF_HIR_EXE_PLN_QTY Q
                            , EQR_REPO_EXE_SO_IF B
                            #if (${weeklymonthly} == '2')
                                ,EQR_WK_PRD E
                            #end
                            ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                            #if ($arrFmEccCd.size() > 0)
                                #if (${fmtype} == 'R')
                                    AND B.RCC_CD
                                #elseif (${fmtype} == 'L')
                                    AND B.LCC_CD
                                #else
                                    AND B.ECC_CD
                                #end
                                IN(
                                #foreach ($key in ${arrFmEccCd})
                                    #if($velocityCount < $arrFmEccCd.size())
                                    '$key',
                                    #else
                                    '$key'
                                    #end
                                #end
                                )) C
                            #else
                                ) C
                            #end
                        WHERE
                            A.REPO_PLN_ID = Q.REPO_PLN_ID
                            AND A.PLN_YRWK = Q.PLN_YRWK
                            AND A.PLN_SEQ = Q.PLN_SEQ
                            AND A.REF_ID = Q.REF_ID
                            AND A.ONF_HIR_DIV_CD IN ('O','F')
                            AND A.REPO_PLN_ID = B.REPO_PLN_ID
                            AND A.PLN_YRWK = B.PLN_YRWK
                            AND A.REF_ID   = B.REF_ID
                            AND Q.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD
                            AND B.WO_EXE_FLG ='Y' -- 중요함
                            AND SUBSTR(A.TO_YD_CD ,0,5) = C.SCC_CD
                            #if (${weeklymonthly} == '2')
                                AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                            #end
                            #if ($arrOddtpszCd.size() > 0)
                                AND Q.CNTR_TPSZ_CD IN(
                                #foreach ($key in ${arrOddtpszCd})
                                    #if($velocityCount < $arrOddtpszCd.size())
                                    '$key',
                                    #else
                                    '$key'
                                    #end
                                #end
                                )
                            #end
                            #if (${feedback} == 'on')
                                AND REPO_PLN_FB_RSN_CD IS NOT NULL
                            #end
                            #if (${fmPlnSYrWk} != '')
                                AND A.FM_LOC_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                                AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                            #end
                            AND A.PLN_YRWK = (SELECT PLN_YR||PLN_WK FROM EQR_WK_PRD WHERE FM_LOC_DT BETWEEN WK_ST_DT AND WK_END_DT )
                    )
                )
            GROUP BY
                #if (${weeklymonthly} == '1')
                    A.PLN_YRWK
                #elseif (${weeklymonthly} == '2')
                    A.PLN_YRWK, PLN_MON
                #end
                , A.ECC_CD
                , ONF_HIR_DIV_CD

            UNION ALL

            -- ITEM = On-Hire(O)
            -- Execultion 2
            SELECT
                #if (${weeklymonthly} == '1')
                    SUBSTR(A.PLN_YRWK,0,4)||'-'||SUBSTR(A.PLN_YRWK,5,6) PLN_YRWK
                #elseif (${weeklymonthly} == '2')
                    SUBSTR(A.PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                #end
                ,CO_CD
                ,(
                    SELECT B.
                    #if (${fmtypeby} == 'R')
                        RCC_CD
                    #elseif (${fmtypeby} == 'C')
                        CNT_CD
                    #elseif (${fmtypeby} == 'L')
                        LCC_CD
                    #else
                        ECC_CD
                    #end
                    FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                    WHERE B.ECC_CD = C.ECC_CD
                    AND   C.SCC_CD = CASE WHEN A.ONF_HIR_DIV_CD ='O' THEN SUBSTR(TO_YD_CD ,0,5)
                    WHEN A.ONF_HIR_DIV_CD ='F' THEN SUBSTR(FM_YD_CD ,0,5) END
                ) FM_ECC_CD
                #if (${adherence} == 'O')
                    ,'ALL' TO_ECC_CD
                #else
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD
                        AND   C.SCC_CD = CASE WHEN A.ONF_HIR_DIV_CD ='O' THEN SUBSTR(TO_YD_CD ,0,5)
                        WHEN A.ONF_HIR_DIV_CD ='F' THEN SUBSTR(FM_YD_CD ,0,5) END
                    ) TO_ECC_CD
                #end
                ,ONF_HIR_DIV_CD TRSP_MOD_CD
                ,CNTR_QTY VOL
                ,ONF_HIR_COST_AMT COST
                ,REPO_PLN_FB_RSN_CD FEEDBACK_KEY
                ,'2' FLAG
            FROM
                EQR_ONF_HIR_EXE_PLN A
                , EQR_ONF_HIR_EXE_PLN_QTY Q
                #if (${weeklymonthly} == '2')
                    ,EQR_WK_PRD E
                #end
                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                #if ($arrFmEccCd.size() > 0)
                    #if (${fmtype} == 'R')
                        AND B.RCC_CD
                    #elseif (${fmtype} == 'L')
                        AND B.LCC_CD
                    #else
                        AND B.ECC_CD
                    #end
                    IN(
                    #foreach ($key in ${arrFmEccCd})
                        #if($velocityCount < $arrFmEccCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )) C
                #else
                    ) C
                #end
            WHERE
                A.REPO_PLN_ID = Q.REPO_PLN_ID
                AND A.PLN_YRWK = Q.PLN_YRWK
                AND A.PLN_SEQ = Q.PLN_SEQ
                AND A.REF_ID = Q.REF_ID
                AND A.ONF_HIR_DIV_CD IN ('O','F')
                AND CASE WHEN A.ONF_HIR_DIV_CD ='O' THEN SUBSTR(TO_YD_CD ,0,5)
                WHEN A.ONF_HIR_DIV_CD ='F' THEN SUBSTR(FM_YD_CD ,0,5) END = C.SCC_CD
                #if (${weeklymonthly} == '2')
                    AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                #end
                #if ($arrOddtpszCd.size() > 0)
                    AND Q.CNTR_TPSZ_CD IN(
                    #foreach ($key in ${arrOddtpszCd})
                        #if($velocityCount < $arrOddtpszCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )
                #end
                #if (${feedback} == 'on')
                    AND REPO_PLN_FB_RSN_CD IS NOT NULL
                #end
                AND CNTR_QTY <> 0
                #if (${fmPlnSYrWk} != '')
                    AND FM_LOC_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                #end
            
            UNION ALL

            -- ITEM = On-Hire(O)
            -- W/O 1
            SELECT
                #if (${weeklymonthly} == '1')
                    SUBSTR(PLN_YRWK,0,4)||'-'||SUBSTR(PLN_YRWK,5,6) PLN_YRWK
                #elseif (${weeklymonthly} == '2')
                    SUBSTR(PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                #end
                ,CO_CD
                ,(
                    SELECT B.
                    #if (${fmtypeby} == 'R')
                        RCC_CD
                    #elseif (${fmtypeby} == 'C')
                        CNT_CD
                    #elseif (${fmtypeby} == 'L')
                        LCC_CD
                    #else
                        ECC_CD
                    #end
                    FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                    WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD =
                    CASE WHEN SO_IF_DIV_CD = 'O' THEN SUBSTR(TO_YD_CD ,0,5)
                    WHEN SO_IF_DIV_CD = 'F' THEN SUBSTR(FM_YD_CD ,0,5) END
                ) FM_ECC_CD
                #if (${adherence} == 'O')
                    ,'ALL' TO_ECC_CD
                #else
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD =
                        CASE WHEN SO_IF_DIV_CD = 'O' THEN SUBSTR(TO_YD_CD ,0,5)
                        WHEN SO_IF_DIV_CD = 'F' THEN SUBSTR(FM_YD_CD ,0,5) END
                    ) TO_ECC_CD
                #end
                ,SO_IF_DIV_CD TRSP_MOD_CD
                ,COUNT(CNTR_TPSZ_CD) VOL
                ,SUM(REPO_COST_AMT) COST
                ,''  FEEDBACK_KEY
                ,'3' FLAG
            FROM
                EQR_REPO_EXE_SO_IF A
                #if (${weeklymonthly} == '2')
                    ,EQR_WK_PRD E
                #end
                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                #if ($arrFmEccCd.size() > 0)
                    #if (${fmtype} == 'R')
                        AND B.RCC_CD
                    #elseif (${fmtype} == 'L')
                        AND B.LCC_CD
                    #else
                        AND B.ECC_CD
                    #end
                    IN(
                    #foreach ($key in ${arrFmEccCd})
                        #if($velocityCount < $arrFmEccCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )) C
                #else
                    ) C
                #end
            WHERE
                SO_IF_DIV_CD IN ('O','F')
                AND CASE WHEN SO_IF_DIV_CD = 'O' THEN SUBSTR(TO_YD_CD ,0,5)
                WHEN SO_IF_DIV_CD = 'F' THEN SUBSTR(FM_YD_CD ,0,5) END = C.SCC_CD
                #if (${weeklymonthly} == '2')
                    AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                #end
                AND WO_EXE_FLG   = 'Y'
                #if ($arrOddtpszCd.size() > 0)
                    AND A.CNTR_TPSZ_CD IN(
                    #foreach ($key in ${arrOddtpszCd})
                        #if($velocityCount < $arrOddtpszCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )
                #end
                #if ($arrLane.size() > 0)
                    AND VSL_LANE_CD IN(
                    #foreach ($key in ${arrLane})
                        #if($velocityCount < $arrLane.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )
                #end
                #if (${fmPlnSYrWk} != '')
                    AND FM_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                #end
            GROUP BY
                #if (${weeklymonthly} == '1')
                    PLN_YRWK
                #elseif (${weeklymonthly} == '2')
                    PLN_YRWK, PLN_MON
                #end
                , CO_CD,FM_YD_CD
                , TO_YD_CD
                , SO_IF_DIV_CD
                , CNTR_TPSZ_CD

            UNION ALL

            -- ITEM = On-Hire(O)  RUN_SO
            -- w/o 1
            SELECT
                #if (${weeklymonthly} == '1')
                    SUBSTR(A.PLN_YRWK,0,4)||'-'||SUBSTR(A.PLN_YRWK,5,6) PLN_YRWK
                #elseif (${weeklymonthly} == '2')
                    SUBSTR(A.PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                #end
                ,CO_CD
                ,(
                    SELECT B.
                    #if (${fmtypeby} == 'R')
                        RCC_CD
                    #elseif (${fmtypeby} == 'C')
                        CNT_CD
                    #elseif (${fmtypeby} == 'L')
                        LCC_CD
                    #else
                        ECC_CD
                    #end
                    FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                    WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                ) FM_ECC_CD
                ,(
                    SELECT B.
                    #if (${fmtypeby} == 'R')
                        RCC_CD
                    #elseif (${fmtypeby} == 'C')
                        CNT_CD
                    #elseif (${fmtypeby} == 'L')
                        LCC_CD
                    #else
                        ECC_CD
                    #end
                    FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                    WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                ) TO_ECC_CD
                ,ONF_HIR_DIV_CD TRSP_MOD_CD
                ,CNTR_QTY  VOL
                ,ONF_HIR_COST_AMT
                ,''  FEEDBACK_KEY
                ,'3' FLAG
            FROM
                EQR_ONF_HIR_EXE_PLN A
                , EQR_ONF_HIR_EXE_PLN_QTY Q
                #if (${weeklymonthly} == '2')
                    ,EQR_WK_PRD E
                #end
                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                #if ($arrFmEccCd.size() > 0)
                    #if (${fmtype} == 'R')
                        AND B.RCC_CD
                    #elseif (${fmtype} == 'L')
                        AND B.LCC_CD
                    #else
                        AND B.ECC_CD
                    #end
                    IN(
                    #foreach ($key in ${arrFmEccCd})
                        #if($velocityCount < $arrFmEccCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )) C
                #else
                    ) C
                #end
            WHERE
                A.REPO_PLN_ID = Q.REPO_PLN_ID
                AND A.PLN_YRWK = Q.PLN_YRWK
                AND A.PLN_SEQ = Q.PLN_SEQ
                AND A.REF_ID = Q.REF_ID
                AND ONF_HIR_DIV_CD IN ('O','F')
                AND CASE WHEN ONF_HIR_DIV_CD = 'O' THEN SUBSTR(TO_YD_CD, 0,5)
                WHEN ONF_HIR_DIV_CD = 'F' THEN SUBSTR(FM_YD_CD, 0,5) END = C.SCC_CD
                #if (${weeklymonthly} == '2')
                    AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                #end
                AND NON_SO_ISS_FLG ='Y'
                #if ($arrOddtpszCd.size() > 0)
                    AND Q.CNTR_TPSZ_CD IN(
                    #foreach ($key in ${arrOddtpszCd})
                        #if($velocityCount < $arrOddtpszCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )
                #end
                #if ($arrLane.size() > 0)
                    AND VSL_LANE_CD IN(
                    #foreach ($key in ${arrLane})
                        #if($velocityCount < $arrLane.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )
                #end
                #if (${fmPlnSYrWk} != '')
                    AND FM_LOC_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                #end

            UNION ALL

            -- ON-OFF HIRE FEEDBACK
            SELECT
                A.
                #if (${weeklymonthly} == '1')
                    PLN_YRWK
                #elseif (${weeklymonthly} == '2')
                    PLN_MON
                #end
                ,A.CO_CD
                ,A.FM_ECC_CD
                ,A.TO_ECC_CD
                ,A.TRSP_MOD_CD
                ,SUM(A.RSN_COUNT) VOL
                ,0 COST
                ,A.REPO_PLN_FB_RSN_CD FEEDBACK_KEY
                ,'4' FLAG
            FROM
            (
                SELECT
                    DISTINCT A.REF_ID
                    ,A.CO_CD
                    ,A.ONF_HIR_DIV_CD TRSP_MOD_CD
                    #if (${weeklymonthly} == '1')
                        ,(
                            SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE A.FM_LOC_DT BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_YRWK
                    #else
                        ,(
                            SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE A.FM_LOC_DT BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_MON
                    #end
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(FM_YD_CD ,0,5)
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT B.
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                        ) TO_ECC_CD
                    #end
                    ,A.REPO_PLN_FB_RSN_CD
                    ,1 RSN_COUNT
                FROM
                    EQR_ONF_HIR_EXE_PLN A
                    , EQR_ONF_HIR_EXE_PLN_QTY Q
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND B.RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND B.RCC_CD
                        #elseif (${totype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    1=1
                    AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND A.REF_ID = Q.REF_ID
                    AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${item} == 'O' || ${item} == 'F')
                        AND ONF_HIR_DIV_CD = @[item]
                    #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                        AND A.TRSP_MOD_CD = @[item]
                    #end
                    #if (${feedback} == 'on')
                        AND REPO_PLN_FB_RSN_CD IS NOT NULL
                    #end
                    #if (${fmPlnSYrWk} != '')
                        AND FM_LOC_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
            ) A
            GROUP BY
                A.
                #if (${weeklymonthly} == '1')
                    PLN_YRWK
                #elseif (${weeklymonthly} == '2')
                    PLN_MON
                #end
                ,A.CO_CD
                ,A.FM_ECC_CD
                ,A.TO_ECC_CD
                ,A.TRSP_MOD_CD
                ,A.REPO_PLN_FB_RSN_CD
        #elseif(${item} == 'F')
            -- ON-OFF HIRE FEEDBACK
            SELECT
                A.
                #if (${weeklymonthly} == '1')
                    PLN_YRWK
                #elseif (${weeklymonthly} == '2')
                    PLN_MON
                #end
                ,A.CO_CD
                ,A.FM_ECC_CD
                ,A.TO_ECC_CD
                ,A.TRSP_MOD_CD
                ,SUM(A.RSN_COUNT) VOL
                ,0 COST
                ,A.REPO_PLN_FB_RSN_CD FEEDBACK_KEY
                ,'4' FLAG
            FROM
            (
                SELECT
                    DISTINCT A.REF_ID
                    ,A.CO_CD
                    ,A.ONF_HIR_DIV_CD TRSP_MOD_CD
                    #if (${weeklymonthly} == '1')
                        ,(
                            SELECT PLN_YR||'-'||PLN_WK PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE A.FM_LOC_DT BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_YRWK
                    #else
                        ,(
                            SELECT PLN_YR||'-'||PLN_MON PLN_YRWK
                            FROM EQR_WK_PRD
                            WHERE A.FM_LOC_DT BETWEEN WK_ST_DT AND WK_END_DT
                        )  PLN_MON
                    #end
                    ,(
                        SELECT B.
                        #if (${fmtypeby} == 'R')
                            RCC_CD
                        #elseif (${fmtypeby} == 'C')
                            CNT_CD
                        #elseif (${fmtypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(FM_YD_CD ,0,5)
                    ) FM_ECC_CD
                    #if (${adherence} == 'O')
                        ,'ALL' TO_ECC_CD
                    #else
                        ,(
                            SELECT B.
                            #if (${totypeby} == 'R')
                                RCC_CD
                            #elseif (${totypeby} == 'C')
                                CNT_CD
                            #elseif (${totypeby} == 'L')
                                LCC_CD
                            #else
                                ECC_CD
                            #end
                            FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                            WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                        ) TO_ECC_CD
                    #end
                    ,A.REPO_PLN_FB_RSN_CD
                    ,1 RSN_COUNT
                FROM
                    EQR_ONF_HIR_EXE_PLN A
                    , EQR_ONF_HIR_EXE_PLN_QTY Q
                    #if (${weeklymonthly} == '2')
                        ,EQR_WK_PRD E
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrFmEccCd.size() > 0)
                        #if (${fmtype} == 'R')
                            AND B.RCC_CD
                        #elseif (${fmtype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrFmEccCd})
                            #if($velocityCount < $arrFmEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) C
                    #else
                        ) C
                    #end
                    ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                    #if ($arrToEccCd.size() > 0)
                        #if (${totype} == 'R')
                            AND B.RCC_CD
                        #elseif (${totype} == 'L')
                            AND B.LCC_CD
                        #else
                            AND B.ECC_CD
                        #end
                        IN(
                        #foreach ($key in ${arrToEccCd})
                            #if($velocityCount < $arrToEccCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )) D
                    #else
                        ) D
                    #end
                WHERE
                    1=1
                    AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                    AND A.PLN_YRWK = Q.PLN_YRWK
                    AND A.PLN_SEQ = Q.PLN_SEQ
                    AND A.REF_ID = Q.REF_ID
                    AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                    #if (${weeklymonthly} == '2')
                        AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                    #end
                    #if ($arrOddtpszCd.size() > 0)
                        AND Q.CNTR_TPSZ_CD IN(
                        #foreach ($key in ${arrOddtpszCd})
                            #if($velocityCount < $arrOddtpszCd.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if ($arrLane.size() > 0)
                        AND VSL_LANE_CD IN(
                        #foreach ($key in ${arrLane})
                            #if($velocityCount < $arrLane.size())
                            '$key',
                            #else
                            '$key'
                            #end
                        #end
                        )
                    #end
                    #if (${item} == 'O' || ${item} == 'F')
                        AND ONF_HIR_DIV_CD = @[item]
                    #elseif (${item} != '' && ${item} != 'O' && ${item} != 'F')
                        AND A.TRSP_MOD_CD = @[item]
                    #end
                    #if (${feedback} == 'on')
                        AND REPO_PLN_FB_RSN_CD IS NOT NULL
                    #end
                    #if (${fmPlnSYrWk} != '')
                        AND FM_LOC_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                        AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                    #end
            ) A
            GROUP BY
                A.
                #if (${weeklymonthly} == '1')
                    PLN_YRWK
                #elseif (${weeklymonthly} == '2')
                    PLN_MON
                #end
                ,A.CO_CD
                ,A.FM_ECC_CD
                ,A.TO_ECC_CD
                ,A.TRSP_MOD_CD
                ,A.REPO_PLN_FB_RSN_CD
        #elseif(${item} == 'S')
            -- ITEM = Shuttle(S)
            -- Execultion 4
            SELECT
                #if (${weeklymonthly} == '1')
                    SUBSTR(A.PLN_YRWK,0,4)||'-'||SUBSTR(A.PLN_YRWK,5,6) PLN_YRWK
                #elseif (${weeklymonthly} == '2')
                    SUBSTR(A.PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                #end
                ,CO_CD
                ,(
                    SELECT
                    #if (${fmtypeby} == 'R')
                        RCC_CD
                    #elseif (${fmtypeby} == 'C')
                        CNT_CD
                    #elseif (${fmtypeby} == 'L')
                        LCC_CD
                    #else
                        ECC_CD
                    #end
                    FROM MDM_EQ_ORZ_CHT
                    WHERE SCC_CD = SUBSTR(FM_YD_CD ,0,5)
                ) FM_ECC_CD
                #if (${adherence} == 'O')
                    ,'ALL' TO_ECC_CD
                #else
                    ,(
                        SELECT
                        #if (${totypeby} == 'R')
                            RCC_CD
                        #elseif (${totypeby} == 'C')
                            CNT_CD
                        #elseif (${totypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM MDM_EQ_ORZ_CHT
                        WHERE SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                    ) TO_ECC_CD
                #end
                ,'S' TRSP_MOD_CD
                ,CNTR_QTY VOL
                ,TRSP_COST_AMT COST
                ,'' FEEDBACK_KEY
                ,'2' FLAG
            FROM
                EQR_ECC_INTER_EXE_PLN A
                , EQR_ECC_INTER_EXE_PLN_QTY Q
                #if (${weeklymonthly} == '2')
                    ,EQR_WK_PRD E
                #end
                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                #if ($arrFmEccCd.size() > 0)
                    #if (${fmtype} == 'R')
                        AND B.RCC_CD
                    #elseif (${fmtype} == 'L')
                        AND B.LCC_CD
                    #else
                        AND B.ECC_CD
                    #end
                    IN(
                    #foreach ($key in ${arrFmEccCd})
                        #if($velocityCount < $arrFmEccCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )) C
                #else
                    ) C
                #end
                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                #if ($arrToEccCd.size() > 0)
                    #if (${totype} == 'R')
                        AND B.RCC_CD
                    #elseif (${totype} == 'L')
                        AND B.LCC_CD
                    #else
                        AND B.ECC_CD
                    #end
                    IN(
                    #foreach ($key in ${arrToEccCd})
                        #if($velocityCount < $arrToEccCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )) D
                #else
                    ) D
                #end
            WHERE
                1=1
                AND A.REPO_PLN_ID = Q.REPO_PLN_ID
                AND A.PLN_YRWK = Q.PLN_YRWK
                AND A.REF_ID = Q.REF_ID
                AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                #if (${weeklymonthly} == '2')
                    AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                #end
                #if ($arrOddtpszCd.size() > 0)
                    AND Q.CNTR_TPSZ_CD IN(
                    #foreach ($key in ${arrOddtpszCd})
                        #if($velocityCount < $arrOddtpszCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )
                #end
                #if (${fmPlnSYrWk} != '')
                    AND A.PLN_YRWK BETWEEN @[fmPlnSYrWk] AND @[fmPlnEYrWk]
                #end
                #if (${toPlnSYrWk} != '')
                    AND A.PLN_YRWK BETWEEN @[fmPlnSYrWk] AND @[fmPlnEYrWk]
                #end

            UNION ALL

            -- ITEM = Rail(R), Truck(T), Water(W), Shuttle(S) ------------------------------------------------
            -- W/O 1
            SELECT
                #if (${weeklymonthly} == '1')
                    SUBSTR(PLN_YRWK,0,4)||'-'||SUBSTR(PLN_YRWK,5,6) PLN_YRWK
                #elseif (${weeklymonthly} == '2')
                    SUBSTR(PLN_YRWK,0,4)||'-'||PLN_MON PLN_MON
                #end
                ,CO_CD
                ,(
                    SELECT B.
                    #if (${fmtypeby} == 'R')
                        RCC_CD
                    #elseif (${fmtypeby} == 'C')
                        CNT_CD
                    #elseif (${fmtypeby} == 'L')
                        LCC_CD
                    #else
                        ECC_CD
                    #end
                    FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                    WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(FM_YD_CD ,0,5)
                ) FM_ECC_CD
                #if (${adherence} == 'O')
                    ,'ALL' TO_ECC_CD
                #else
                    ,(
                        SELECT B.
                        #if (${totypeby} == 'R')
                            RCC_CD
                        #elseif (${totypeby} == 'C')
                            CNT_CD
                        #elseif (${totypeby} == 'L')
                            LCC_CD
                        #else
                            ECC_CD
                        #end
                        FROM EQR_ECC_MST B, MDM_EQ_ORZ_CHT C
                        WHERE B.ECC_CD = C.ECC_CD AND C.SCC_CD = SUBSTR(TO_YD_CD ,0,5)
                    ) TO_ECC_CD
                #end
                ,SO_IF_DIV_CD TRSP_MOD_CD
                ,COUNT(CNTR_TPSZ_CD) VOL
                ,SUM(REPO_COST_AMT) COST
                ,''  FEEDBACK_KEY
                ,'3' FLAG
            FROM
                EQR_REPO_EXE_SO_IF A
                #if (${weeklymonthly} == '2')
                    ,EQR_WK_PRD E
                #end
                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                #if ($arrFmEccCd.size() > 0)
                    #if (${fmtype} == 'R')
                        AND B.RCC_CD
                    #elseif (${fmtype} == 'L')
                        AND B.LCC_CD
                    #else
                        AND B.ECC_CD
                    #end
                    IN(
                    #foreach ($key in ${arrFmEccCd})
                        #if($velocityCount < $arrFmEccCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )) C
                #else
                    ) C
                #end
                ,(SELECT SCC_CD FROM EQR_ECC_MST A, MDM_EQ_ORZ_CHT B WHERE A.ECC_CD = B.ECC_CD
                #if ($arrToEccCd.size() > 0)
                    #if (${totype} == 'R')
                        AND B.RCC_CD
                    #elseif (${totype} == 'L')
                        AND B.LCC_CD
                    #else
                        AND B.ECC_CD
                    #end
                    IN(
                    #foreach ($key in ${arrToEccCd})
                        #if($velocityCount < $arrToEccCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )) D
                #else
                    ) D
                #end
            WHERE 1=1
                AND SUBSTR(A.FM_YD_CD ,0,5) = C.SCC_CD AND SUBSTR(A.TO_YD_CD ,0,5) = D.SCC_CD
                #if (${weeklymonthly} == '2')
                    AND A.PLN_YRWK = E.PLN_YR || E.PLN_WK
                #end
                AND WO_EXE_FLG = 'Y'
                #if ($arrOddtpszCd.size() > 0)
                    AND A.CNTR_TPSZ_CD IN(
                    #foreach ($key in ${arrOddtpszCd})
                        #if($velocityCount < $arrOddtpszCd.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )
                #end
                #if ($arrLane.size() > 0)
                    AND VSL_LANE_CD IN(
                    #foreach ($key in ${arrLane})
                        #if($velocityCount < $arrLane.size())
                        '$key',
                        #else
                        '$key'
                        #end
                    #end
                    )
                #end
                #if (${item} == '')
                    AND SO_IF_DIV_CD IN('R','T','W','S')
                #else
                    AND SO_IF_DIV_CD = @[item]
                #end
                AND PAST_REPO_PLN_FLG NOT IN ('Y')
                #if (${fmPlnSYrWk} != '')
                    AND FM_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnSYrWk])
                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fmPlnEYrWk])
                #end
                #if (${toPlnSYrWk} != '')
                    AND TO_DT BETWEEN (SELECT WK_ST_DT  FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnSYrWk])
                    AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[toPlnEYrWk])
                #end
            GROUP BY
                #if (${weeklymonthly} == '1')
                    PLN_YRWK
                #elseif (${weeklymonthly} == '2')
                    PLN_YRWK, PLN_MON
                #end
                , CO_CD
                , FM_YD_CD
                , TO_YD_CD
                , SO_IF_DIV_CD
        #end
    )X
    #if (${lane} != '')
        WHERE X.TRSP_MOD_CD IN('V','W')
    #end
    GROUP BY
        X.
        #if (${weeklymonthly} == '1')
            PLN_YRWK
        #elseif (${weeklymonthly} == '2')
            PLN_MON
        #end
        #if (${item} == 'O')
            ,TO_ECC_CD
        #elseif (${item} == 'F')
            ,FM_ECC_CD
        #else
            ,FM_ECC_CD, TO_ECC_CD
        #end
        , X.TRSP_MOD_CD
    #if (${ratiovolnum} != '')
        #if (${ratiovol} == 'R')
            #if (${ratiovoltype} == 'U')
                HAVING ROUND(SUM(DECODE(X.FLAG, '2', VOL,  '')) / DECODE(SUM(DECODE(X.FLAG, '1', VOL,  '')), 0, '', MAX(DECODE(X.FLAG, '1', VOL,  ''))),2) >= @[ratiovolnum]
            #else
                HAVING ROUND(SUM(DECODE(X.FLAG, '2', VOL,  '')) / DECODE(SUM(DECODE(X.FLAG, '1', VOL,  '')), 0, '', MAX(DECODE(X.FLAG, '1', VOL,  ''))),2) <= @[ratiovolnum]
            #end
        #else
            #if (${ratiovoltype} == 'U')
                HAVING MAX(DECODE(X.FLAG, '1', VOL,  '')) - SUM(DECODE(X.FLAG, '2', VOL,  '')) >= @[ratiovolnum]
            #else
                HAVING MAX(DECODE(X.FLAG, '1', VOL,  '')) - SUM(DECODE(X.FLAG, '2', VOL,  '')) <= @[ratiovolnum]
            #end
        #end
    #end
) A,
(
    SELECT 1 NUM, ''      NAME FROM DUAL
    UNION
    SELECT 2 NUM, 'TOTAL' NAME FROM DUAL  -- GRAND TOTAL
    UNION
    SELECT 3 NUM, 'Sub TTL'   NAME FROM DUAL  -- SUB TOTAL (GS에서 substring 해서 보여줌에 유의)
) B
GROUP BY
    DECODE(
        B.NUM
        , 1
        , A.
        #if (${weeklymonthly} == '1')
            PLN_YRWK
        #elseif (${weeklymonthly} == '2')
            PLN_MON
        #end
        , 2
        , B.NAME
        , 3
        , A.
        #if (${weeklymonthly} == '1')
            PLN_YRWK
        #elseif (${weeklymonthly} == '2')
            PLN_MON
        #end
        ||' '||B.NAME
    )
    ,DECODE(B.NUM, 1, A.FM_ECC_CD, 	2, '',      3, '')
    ,DECODE(B.NUM, 1, A.TO_ECC_CD, 	2, '',      3, '')
    ,DECODE(B.NUM, 1, A.TRSP_MOD_CD, 2, A.TRSP_MOD_CD,      3, A.TRSP_MOD_CD)
    ,ITEMCD
ORDER BY
    1, 2, 3, 4, 5			]]></sql>
			<params>
				<param name="fmPlnSYrWk" type="12" value="" out="N"/>
				<param name="fmPlnEYrWk" type="12" value="" out="N"/>
				<param name="toPlnSYrWk" type="12" value="" out="N"/>
				<param name="toPlnEYrWk" type="12" value="" out="N"/>
				<param name="item" type="12" value="" out="N"/>
				<param name="ratiovolnum" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
