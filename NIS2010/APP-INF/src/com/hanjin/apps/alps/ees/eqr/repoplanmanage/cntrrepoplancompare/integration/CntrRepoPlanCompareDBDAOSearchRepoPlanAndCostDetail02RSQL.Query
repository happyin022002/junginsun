<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CntrRepoPlanCompareDBDAOSearchRepoPlanAndCostDetail02RSQL">
			<desc><![CDATA[Mactched의  Perforomance]]></desc>
			<sql><![CDATA[
SELECT PLN_YRWK,
       TRSP_MOD_CD ,
       FM_ECC_CD,
       TO_ECC_CD,
       SUM(OLDPLN_TOTQTY),
       SUM(OLDPLN_TOTAMT),
       SUM(NEWPLN_TOTQTY),
       SUM(NEWPLN_TOTAMT),
       SUM(DIFFPLN_TOTQTY),
       SUM(DIFFPLN_TOTAMT),
 #foreach( ${key} in ${arrtpszcd})
	   #if($velocityCount < $arrtpszcd.size())
	    SUM(OLDPLN_QTY_${key}),                                                                      
        SUM(OLDPLN_AMT_${key}),                                                                      
        SUM(NEWPLN_QTY_${key}),                                                                      
        SUM(NEWPLN_AMT_${key}),                                                                      
        SUM(DIFFPLN_QTY_${key}),
        SUM(DIFFPLN_AMT_${key}), 
 	   #else
 	    SUM(OLDPLN_QTY_${key}),                                                                      
        SUM(OLDPLN_AMT_${key}),                                                                      
        SUM(NEWPLN_QTY_${key}),                                                                      
        SUM(NEWPLN_AMT_${key}),                                                                      
        SUM(DIFFPLN_QTY_${key}),
        SUM(DIFFPLN_AMT_${key})
       #end
 #end
FROM (
SELECT A.PLN_YRWK,                                                                                                            
       A.TRSP_MOD_CD,
      #if (${fmtoat} == '1')
       (SELECT                                                
             #if (${fmtypeby} == 'R')                              
             RCC_CD                                                
             #elseif (${fmtypeby} == 'C')                          
             CNT_CD                                                
             #elseif (${fmtypeby} == 'L')                          
             LCC_CD                                                
             #elseif (${fmtypeby} == 'E' || ${fmtypeby} == '')     
             ECC_CD                                                
             #end                                                  
       FROM EQR_ECC_MST WHERE  A.FM_ECC_CD = ECC_CD) FM_ECC_CD, 
      (SELECT                                               
             #if (${totypeby} == 'R')                              
             RCC_CD                                                
             #elseif (${totypeby} == 'C')                          
             CNT_CD                                                
             #elseif (${totypeby} == 'L')                          
             LCC_CD                                                
             #elseif (${totypeby} == 'E' || ${totypeby} == '')     
             ECC_CD                                                   
             #end                                                  
        FROM EQR_ECC_MST WHERE A.TO_ECC_CD = ECC_CD) TO_ECC_CD,
      #else
                                                                        
	    (SELECT                                                
             #if (${attypeby} == 'R')                              
             RCC_CD                                                
             #elseif (${attypeby} == 'C')                          
             CNT_CD                                                
             #elseif (${attypeby} == 'L')                          
             LCC_CD                                                
             #elseif (${attypeby} == 'E' || ${attypeby} == '')     
             ECC_CD                                                
             #end                                                  
       FROM EQR_ECC_MST WHERE A.FM_ECC_CD = ECC_CD) FM_ECC_CD, 
      (SELECT                                               
             #if (${attypeby} == 'R')                              
             RCC_CD                                                
             #elseif (${attypeby} == 'C')                          
             CNT_CD                                                
             #elseif (${attypeby} == 'L')                          
             LCC_CD                                                
             #elseif (${attypeby} == 'E' || ${attypeby} == '')     
             ECC_CD                                                   
             #end                                                  
        FROM EQR_ECC_MST WHERE A.TO_ECC_CD = ECC_CD) TO_ECC_CD, 
     #end                        
     #if (${fmtoat} == '1')   
           -- FM_TO 일때 
          #foreach( ${key} in ${arrtpszcd})
	          #if($velocityCount < $arrtpszcd.size())
	              NVL(MAX(A.OLDQTY${key}),0)  + 
 	          #else
 	              NVL(MAX(A.OLDQTY${key}),0)   OLDPLN_TOTQTY,
	          #end
          #end
         #foreach( ${key} in ${arrtpszcd})
	          #if($velocityCount < $arrtpszcd.size())
	              NVL(MAX(A.OLDAMT${key}),0)  + 
 	          #else
 	              NVL(MAX(A.OLDAMT${key}),0)   OLDPLN_TOTAMT,
	          #end
          #end
         #foreach( ${key} in ${arrtpszcd})
	          #if($velocityCount < $arrtpszcd.size())
	              NVL(MAX(B.OLDQTY${key}),0)  + 
 	          #else
 	              NVL(MAX(B.OLDQTY${key}),0)  NEWPLN_TOTQTY,
	          #end
          #end
          #foreach( ${key} in ${arrtpszcd})
	          #if($velocityCount < $arrtpszcd.size())
	              NVL(MAX(B.OLDAMT${key}),0)  + 
 	          #else
 	              NVL(MAX(B.OLDAMT${key}),0)  NEWPLN_TOTAMT,
	          #end
          #end
          #foreach( ${key} in ${arrtpszcd})
	          #if($velocityCount < $arrtpszcd.size())
	              NVL(MAX(A.OLDQTY${key}),0) - NVL(MAX(B.OLDQTY${key}),0)  +
 	          #else
 	              NVL(MAX(A.OLDQTY${key}),0) - NVL(MAX(B.OLDQTY${key}),0)  DIFFPLN_TOTQTY,
	          #end
          #end       
          #foreach( ${key} in ${arrtpszcd})
	          #if($velocityCount < $arrtpszcd.size())
	              NVL(MAX(A.OLDAMT${key}),0)  - NVL(MAX(B.OLDAMT${key}),0)  + 
 	          #else
 	              NVL(MAX(A.OLDAMT${key}),0)  - NVL(MAX(B.OLDAMT${key}),0)  DIFFPLN_TOTAMT,
	          #end
          #end
          #foreach( ${key} in ${arrtpszcd})
	          #if($velocityCount < $arrtpszcd.size())
	              MAX(A.OLDQTY${key})  OLDPLN_QTY_${key},                                                                      
                MAX(A.OLDAMT${key})  OLDPLN_AMT_${key},                                                                      
                MAX(B.OLDQTY${key})  NEWPLN_QTY_${key},                                                                      
                MAX(B.OLDAMT${key})  NEWPLN_AMT_${key},                                                                      
                NVL(MAX(A.OLDQTY${key}),0) - NVL(MAX(B.OLDQTY${key}),0)  DIFFPLN_QTY_${key},
                NVL(MAX(A.OLDAMT${key}),0) - NVL(MAX(B.OLDAMT${key}),0)  DIFFPLN_AMT_${key}, 
 	          #else
 	              MAX(A.OLDQTY${key})  OLDPLN_QTY_${key},                                                                      
                MAX(A.OLDAMT${key})  OLDPLN_AMT_${key},                                                                      
                MAX(B.OLDQTY${key})  NEWPLN_QTY_${key},                                                                      
                MAX(B.OLDAMT${key})  NEWPLN_AMT_${key},                                                                      
                NVL(MAX(A.OLDQTY${key}),0) - NVL(MAX(B.OLDQTY${key}),0)  DIFFPLN_QTY_${key},
                NVL(MAX(A.OLDAMT${key}),0) - NVL(MAX(B.OLDAMT${key}),0)  DIFFPLN_AMT_${key}
              
	          #end
          #end        
             -- FM_TO 일때 끝    
    #else
             -- AT 일때 시작
             #foreach( ${key} in ${arrtpszcd})
	            #if($velocityCount < $arrtpszcd.size())
	                NVL(MAX(A.OLDQTY${key}),0)  + 
 	            #else
 	                NVL(MAX(A.OLDQTY${key}),0)   OLDPLN_TOTQTY,
	            #end
            #end
           #foreach( ${key} in ${arrtpszcd})
	            #if($velocityCount < $arrtpszcd.size())
	                NVL(MAX(A.OLDAMT${key}),0)  + 
 	            #else
 	                NVL(MAX(A.OLDAMT${key}),0)   OLDPLN_TOTAMT,
	            #end
            #end
           #foreach( ${key} in ${arrtpszcd})
	            #if($velocityCount < $arrtpszcd.size())
	                NVL(MAX(B.OLDQTY${key}),0)  + 
 	            #else
 	                NVL(MAX(B.OLDQTY${key}),0)  NEWPLN_TOTQTY,
	            #end
            #end
            #foreach( ${key} in ${arrtpszcd})
	            #if($velocityCount < $arrtpszcd.size())
	                NVL(MAX(B.OLDAMT${key}),0)  + 
 	            #else
 	                NVL(MAX(B.OLDAMT${key}),0)  NEWPLN_TOTAMT,
	            #end
            #end
            #foreach( ${key} in ${arrtpszcd})
	            #if($velocityCount < $arrtpszcd.size())
	                NVL(MAX(A.OLDQTY${key}),0) - NVL(MAX(B.OLDQTY${key}),0)  +
 	            #else
 	                NVL(MAX(A.OLDQTY${key}),0) - NVL(MAX(B.OLDQTY${key}),0)  DIFFPLN_TOTQTY,
	            #end
            #end       
            #foreach( ${key} in ${arrtpszcd})
	            #if($velocityCount < $arrtpszcd.size())
	                NVL(MAX(A.OLDAMT${key}),0)  - NVL(MAX(B.OLDAMT${key}),0)  + 
 	            #else
 	                NVL(MAX(A.OLDAMT${key}),0)  - NVL(MAX(B.OLDAMT${key}),0)  DIFFPLN_TOTAMT,
	            #end
            #end
            #foreach( ${key} in ${arrtpszcd})
	            #if($velocityCount < $arrtpszcd.size())
	                MAX(A.OLDQTY${key})  OLDPLN_QTY_${key},                                                                      
                  MAX(A.OLDAMT${key})  OLDPLN_AMT_${key},                                                                      
                  MAX(B.OLDQTY${key})  NEWPLN_QTY_${key},                                                                      
                  MAX(B.OLDAMT${key})  NEWPLN_AMT_${key},                                                                      
                  NVL(MAX(A.OLDQTY${key}),0) - NVL(MAX(B.OLDQTY${key}),0)  DIFFPLN_QTY_${key},
                  NVL(MAX(A.OLDAMT${key}),0) - NVL(MAX(B.OLDAMT${key}),0)  DIFFPLN_AMT_${key}, 
 	            #else
 	                MAX(A.OLDQTY${key})  OLDPLN_QTY_${key},                                                                      
                  MAX(A.OLDAMT${key})  OLDPLN_AMT_${key},                                                                      
                  MAX(B.OLDQTY${key})  NEWPLN_QTY_${key},                                                                      
                  MAX(B.OLDAMT${key})  NEWPLN_AMT_${key},                                                                      
                  NVL(MAX(A.OLDQTY${key}),0) - NVL(MAX(B.OLDQTY${key}),0)  DIFFPLN_QTY_${key},
                  NVL(MAX(A.OLDAMT${key}),0) - NVL(MAX(B.OLDAMT${key}),0)  DIFFPLN_AMT_${key}
                
	            #end
            #end
       #end                                                                                                           
 FROM                                                                                                                                                 
        (                                                                                                                                             
		  SELECT REPO_PLN_ID,                                                                                                                          
		         PLN_YRWK,                                                                                                                              
				     TRSP_MOD_CD,                                                                                                                           
				     FM_ECC_CD,		                                               
             TO_ECC_CD,                                                       
				 #if (${fmtoat} == '1')
            #foreach( ${key} in ${arrtpszcd})
              SUM(DECODE(CNTR_TPSZ_CD , '${key}', QTY )) OLDQTY${key},
              SUM(DECODE(CNTR_TPSZ_CD , '${key}', AMT )) OLDAMT${key},
            #end
         #else        
            #foreach( ${key} in ${arrtpszcd})
              MAX(DECODE(CNTR_TPSZ_CD , '${key}', QTY )) OLDQTY${key},
              MAX(DECODE(CNTR_TPSZ_CD , '${key}', AMT )) OLDAMT${key},
            #end
         #end                                              
				'A' FLG                                                                                                                                
		 FROM(		                                                                                                                                   
		        ----------------------	EQR_VSL_LODG_DCHG_PLN   --------------------------	
		   SELECT PLN.REPO_PLN_ID,                                                   
					       PLN.PLN_YRWK ,                                                     
                 TRSP_MOD_CD ,                                                  
                 FM_ECC_CD ,                                                    
                 TO_ECC_CD ,                                                    
                 QTY.CNTR_TPSZ_CD ,                                                 
                 QTY.CNTR_QTY QTY ,                                                 
                 QTY.LODG_DCHG_COST_AMT  AMT                                        
          FROM EQR_VSL_LODG_DCHG_PLN PLN 
              ,EQR_VSL_LODG_DCHG_PLN_QTY QTY 
          #if (${fmtoat} == '1')                                     
              ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                  #if (${fmecccd} != '')                                                       
                       #if (${fmtype} == 'R')             
                             AND RCC_CD IN (${arrfmecccd}) 
                       #end                               
                        #if (${fmtype} == 'L')             
                             AND LCC_CD IN (${arrfmecccd}) 
                       #end                               
                        #if (${fmtype} == 'E')             
                             AND ECC_CD IN (${arrfmecccd}) 
                       #end                               
                  #end                                     
               ) c
              , (SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1 
                   #if (${toecccd} != '') 
                        #if (${totype} == 'R')
                             AND RCC_CD IN (${arrtoecccd}) 
                			  #end
                        #if (${totype} == 'L')
                             AND LCC_CD IN (${arrtoecccd})
                			  #end
                        #if (${totype} == 'E')
                             AND ECC_CD IN (${arrtoecccd})
                			  #end
                	 #end
               ) d 
          #else
            , ( SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
		               #if (${atecccd} != '') 
                        #if (${attype} == 'R')
                             AND RCC_CD IN (${arratecccd}) 
			                  #end
                        #if (${attype} == 'L')
                             AND LCC_CD IN (${arratecccd})
			                  #end
                        #if (${attype} == 'E')
                             AND ECC_CD IN (${arratecccd})
			                  #end
		               #end
               ) c
          #end                                            
          WHERE PLN.REPO_PLN_ID = @[repo_pln_id]                                                
	        #if (${fmtoat} == '1')                                   
          AND FM_ECC_CD = C.ECC_CD AND TO_ECC_CD = D.ECC_CD
          #else
          AND (FM_ECC_CD = C.ECC_CD OR TO_ECC_CD = C.ECC_CD) 
          #end 
          #if(${item} != '') 
          AND PLN.TRSP_MOD_CD IN (${arritem})
          #end
          #if(${lane} != '')
				  AND PLN.VSL_LANE_CD IN (${arrlane})
				  #end
				   #if(${vvd} != '')
				  AND PLN.VSL_CD||SKD_VOY_NO||SKD_DIR_CD IN(${arrvvd})
				  #end  
          #if (${fmtoat} == '1')
            #if(${fmplnwk} !='')
                AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN                                  
                  (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fm_yrwk]  )             
                  AND                                                                        
                  (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[to_yrwk]  )
            #end
            #if(${fmtoplnwk} != '')             
                  AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN                                  
                    (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fm_to_yrwk]   )             
                    AND                                                                        
                    (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[to_to_yrwk]  )
            #end
          #else
          AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN                                  
            (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[at_fm_yrwk]  )             
            AND                                                                        
            (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[at_to_yrwk]  )             
          AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN                                  
            (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[at_fm_yrwk]   )             
            AND                                                                        
            (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[at_to_yrwk]  )
          #end
          #if(${arroddtpsz} !='')                                           
          AND CNTR_TPSZ_CD IN(${arroddtpsz})
          #end  
          AND PLN.REPO_PLN_ID = QTY.REPO_PLN_ID
          AND PLN.PLN_YRWK  = QTY.PLN_YRWK
          AND PLN.PLN_SEQ   = QTY.PLN_SEQ                                                             
  UNION ALL                                                                                               
					----------------------	EQR_INLND_TRSP_PLN   --------------------------	
				SELECT PLN.REPO_PLN_ID,                                                                       
                 PLN.PLN_YRWK,                                                                           
                 TRSP_MOD_CD,                                                                        
                 FM_ECC_CD,                                                                          
                 TO_ECC_CD,                                                                          
                 CNTR_TPSZ_CD,                                                                       
                 CNTR_QTY  QTY,                                                                      
                 TRSP_COST_AMT AMT		                                                            
          FROM   EQR_INLND_TRSP_PLN  PLN
                ,EQR_INLND_TRSP_PLN_QTY  QTY
          #if (${fmtoat} == '1')                                     
              ,(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
                  #if (${fmecccd} != '')                                                       
                       #if (${fmtype} == 'R')             
                             AND RCC_CD IN (${arrfmecccd}) 
                       #end                               
                        #if (${fmtype} == 'L')             
                             AND LCC_CD IN (${arrfmecccd}) 
                       #end                               
                        #if (${fmtype} == 'E')             
                             AND ECC_CD IN (${arrfmecccd}) 
                       #end                               
                  #end                                     
               ) c
              , (SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1 
                   #if (${toecccd} != '') 
                        #if (${totype} == 'R')
                             AND RCC_CD IN (${arrtoecccd}) 
                			  #end
                        #if (${totype} == 'L')
                             AND LCC_CD IN (${arrtoecccd})
                			  #end
                        #if (${totype} == 'E')
                             AND ECC_CD IN (${arrtoecccd})
                			  #end
                	 #end
               ) d 
          #else
            , ( SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
		               #if (${atecccd} != '') 
                        	#if (${attype} == 'R')
                             AND RCC_CD IN (${arratecccd}) 
			                  #end
                        	 #if (${attype} == 'L')
                             AND LCC_CD IN (${arratecccd})
			                  #end
                        #if (${attype} == 'E')
                             AND ECC_CD IN (${arratecccd})
			                  #end
		               #end
               ) c
          #end                                            
	        WHERE  PLN.REPO_PLN_ID = @[repo_pln_id]		                                                                
          #if (${fmtoat} == '1')                                                                                  
          AND FM_ECC_CD = C.ECC_CD AND TO_ECC_CD = D.ECC_CD
          #else
          AND (FM_ECC_CD = C.ECC_CD OR TO_ECC_CD = C.ECC_CD) 
          #end
          #if(${item} != '') 
          AND PLN.TRSP_MOD_CD IN (${arritem})
          #end
          #if (${fmtoat} == '1')
            #if(${fmplnwk} !='')  
                AND PLN.PLN_YRWK BETWEEN @[fm_yrwk] AND @[to_yrwk]
            #end
            #if(${fmtoplnwk} != '')	                                                    
                AND PLN.TO_YRWK  BETWEEN @[fm_to_yrwk] AND @[to_to_yrwk]
            #end
          #else
          AND PLN.PLN_YRWK BETWEEN @[at_fm_yrwk] AND @[at_to_yrwk]
          AND PLN.TO_YRWK  BETWEEN @[at_fm_yrwk] AND @[at_to_yrwk]
          #end
          #if(${arroddtpsz} !='')                                           
          AND CNTR_TPSZ_CD IN(${arroddtpsz})
          #end                                                       
          AND PLN.REPO_PLN_ID = QTY.REPO_PLN_ID
          AND PLN.PLN_YRWK   = QTY.PLN_YRWK
          AND PLN.PLN_SEQ    = QTY.PLN_SEQ  
     UNION ALL
        	SELECT PLN.REPO_PLN_ID,                                                                       
                 PLN.PLN_YRWK,                                                                          
						     ONF_HIR_DIV_CD,		                                                               
                 DECODE(ONF_HIR_DIV_CD ,'F', PLN.ECC_CD) FM_ECC_CD,                                 
                 DECODE(ONF_HIR_DIV_CD ,'O', PLN.ECC_CD) TO_ECC_CD,                                 
                 QTY.CNTR_TPSZ_CD,		                                                               
                 QTY.CNTR_QTY QTY,			                                                           
                 QTY.ONF_HIR_COST_AMT AMT                                                               
          FROM   EQR_ONF_HIR_PLN	 PLN
                ,EQR_ONF_HIR_PLN_QTY QTY
          #if (${fmtoat} == '1')                                                    
                , ( SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1 
             		     #if (${fmecccd} != '')                       
                           #if (${fmtype} == 'R')                  
                                AND RCC_CD IN (${arrfmecccd},${arrtoecccd})      
             			         #end                                   
                           #if (${fmtype} == 'L')                  
                                AND LCC_CD IN (${arrfmecccd},${arrtoecccd})      
             			         #end                                   
                           #if (${fmtype} == 'E')                  
                                AND ECC_CD IN (${arrfmecccd},${arrtoecccd})      
             			         #end                                   
             		      #end                                         
                   ) C   
            --   , ( SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1 
            -- 		     #if ( ${toecccd} != '')                       
            --               #if (${totype} == 'R')                  
            --                    AND RCC_CD IN ( ${arrtoecccd})      
             --			         #end                                   
             --              #if (${totype} == 'L')                  
             --                   AND LCC_CD IN ( ${arrtoecccd})      
             --			         #end                                   
             --              #if (${totype} == 'E')                  
             --                   AND ECC_CD IN ( ${arrtoecccd})      
             --			         #end                                   
             --		      #end                                         
             --      ) D                                            
          #else                                               
                 , ( SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1 
             		     #if (${atecccd} != '')                       
                          #if (${attype} == 'R')                  
                               AND RCC_CD IN (${arratecccd})      
             			        #end                                   
                          #if (${attype} == 'L')                  
                               AND LCC_CD IN (${arratecccd})      
             			        #end                                   
                          #if (${attype} == 'E')                  
                               AND ECC_CD IN (${arratecccd})      
             			        #end                                    
             		     #end                                          
                  ) c                                            
         #end                                                
         WHERE  PLN.REPO_PLN_ID = @[repo_pln_id]		                                                           
         #if (${fmtoat} == '1')                                                                               
	       AND PLN.ECC_CD = C.ECC_CD AND PLN.ECC_CD = C.ECC_CD
	       #else
	       AND (PLN.ECC_CD = C.ECC_CD OR PLN.ECC_CD = C.ECC_CD)
	       #end
	       #if(${item} != '') 
          AND PLN.ONF_HIR_DIV_CD IN (${arritem})
         #end 
         #if (${fmtoat} == '1')
	       AND PLN.PLN_YRWK BETWEEN @[fm_yrwk] AND  @[to_yrwk]	                                                           
	       #else
	       AND PLN.PLN_YRWK BETWEEN @[at_fm_yrwk] AND @[at_to_yrwk]
	       #end
	       #if(${arroddtpsz} !='')                                           
         AND CNTR_TPSZ_CD IN(${arroddtpsz})
         #end
         AND PLN.REPO_PLN_ID =  QTY.REPO_PLN_ID
         AND PLN.PLN_YRWK    =  QTY.PLN_YRWK
         AND PLN.PLN_SEQ     =  QTY.PLN_SEQ                                      
				)                                                                                              
     GROUP BY REPO_PLN_ID , PLN_YRWK, TRSP_MOD_CD , FM_ECC_CD ,TO_ECC_CD	                                                                                              
		) A,                                                                                                                        
 ( SELECT    REPO_PLN_ID,                                                                                                                           
             PLN_YRWK,                                                                                                                             
				     SO_IF_DIV_CD,                                                                                                                          
				     FM_ECC_CD,		                                                          
             TO_ECC_CD,                                                                 
				 #if (${fmtoat} == '1')
                 #if (${arrtpszcd} !='')
                   #foreach( ${key} in ${arrtpszcd})
               	    #if(${key} == 'O2')
                	       NVL(SUM(DECODE(CNTR_TPSZ_CD , '${key}', QTY )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'S2', QTY )),0) OLDQTY${key},
                         NVL(SUM(DECODE(CNTR_TPSZ_CD , '${key}', AMT )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'S2', AMT )),0) OLDAMT${key},
               	     #elseif(${key} == 'O4')
                	       NVL(SUM(DECODE(CNTR_TPSZ_CD , '${key}', QTY )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'S4', QTY )),0) OLDQTY${key},
                         NVL(SUM(DECODE(CNTR_TPSZ_CD , '${key}', AMT )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'S4', AMT )),0) OLDAMT${key},
                     #elseif(${key} == 'F2')
                	       NVL(SUM(DECODE(CNTR_TPSZ_CD , '${key}', QTY )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'A2', QTY )),0) OLDQTY${key}, 
                         NVL(SUM(DECODE(CNTR_TPSZ_CD , '${key}', AMT )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'A2', AMT )),0) OLDAMT${key}, 
                     #elseif(${key} == 'F4')
                	       NVL(SUM(DECODE(CNTR_TPSZ_CD , '${key}', QTY )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'A4', QTY )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'F5', QTY )),0) OLDQTY${key}, 
                         NVL(SUM(DECODE(CNTR_TPSZ_CD , '${key}', AMT )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'A4', AMT )),0)   + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'F5', AMT )),0) OLDAMT${key},
                     #else
                         SUM(DECODE(CNTR_TPSZ_CD , '${key}', QTY )) OLDQTY${key},
                         SUM(DECODE(CNTR_TPSZ_CD , '${key}', AMT )) OLDAMT${key},
               	    #end
                   #end
                 #end 
	             #else
	              #if (${arrtpszcd} !='')
                   #foreach( ${key} in ${arrtpszcd})
               	    #if(${key} == 'O2')
                	        NVL(MAX(DECODE(CNTR_TPSZ_CD , '${key}', QTY )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'S2', QTY )),0) OLDQTY${key},
                          NVL(MAX(DECODE(CNTR_TPSZ_CD , '${key}', AMT )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'S2', AMT )),0) OLDAMT${key},
               	    #elseif(${key} == 'O4')
                	        NVL(MAX(DECODE(CNTR_TPSZ_CD , '${key}', QTY )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'S4', QTY )),0) OLDQTY${key},
                          NVL(MAX(DECODE(CNTR_TPSZ_CD , '${key}', AMT )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'S4', AMT )),0) OLDAMT${key},
                     #elseif(${key} == 'F2')
                	        NVL(MAX(DECODE(CNTR_TPSZ_CD , '${key}', QTY )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'A2', QTY )),0) OLDQTY${key}, 
                          NVL(MAX(DECODE(CNTR_TPSZ_CD , '${key}', AMT )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'A2', AMT )),0) OLDAMT${key}, 
                     #elseif(${key} == 'F4')
                	        NVL(MAX(DECODE(CNTR_TPSZ_CD , '${key}', QTY )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'A4', QTY )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'F5', QTY )),0) OLDQTY${key}, 
                            NVL(MAX(DECODE(CNTR_TPSZ_CD , '${key}', AMT )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'A4', AMT )),0) + NVL(SUM(DECODE(CNTR_TPSZ_CD , 'F5', AMT )),0) OLDAMT${key},
                     #else
                          MAX(DECODE(CNTR_TPSZ_CD , '${key}', QTY )) OLDQTY${key},
                          MAX(DECODE(CNTR_TPSZ_CD , '${key}', AMT )) OLDAMT${key},
               	    #end
                   #end
                 #end
	           #end                                                              
				
				'B' FLG                                                                                                                                
FROM                                                                                                                                          
     (  
#if(${item} != 'O' && ${item} !='F')  
           SELECT    REPO_PLN_ID,	                                                                                
	                    PLN_YRWK,                                                                                          
			                SO_IF_DIV_CD,		                                                                                
    	                (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SCC_CD = SUBSTR(FM_YD_CD ,1,5)) FM_ECC_CD,		        
    	                (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SCC_CD = SUBSTR(TO_YD_CD ,1,5)) TO_ECC_CD,	            
    	                COUNT(CNTR_TPSZ_CD)  QTY,                                                                          
    	                SUM(REPO_COST_AMT)   AMT,                                                                          
    	                CNTR_TPSZ_CD 		                                                                                
            FROM     EQR_REPO_EXE_SO_IF PLN	
     		  WHERE REPO_PLN_ID = @[repo_pln_id]
    		   #if(${item} != '')                                                                              
           AND SO_IF_DIV_CD IN (${arritem})                                                        
           #else
           AND SO_IF_DIV_CD IN ('T','R','W','S')
           #end
           #if(${lane} != '')
				   AND PLN.VSL_LANE_CD IN (${arrlane})
				   #end
				   #if(${vvd} != '')
				   AND PLN.VSL_CD||SKD_VOY_NO||SKD_DIR_CD IN(${arrvvd})
				   #end
            #if (${fmtoat} == '1')
           AND SUBSTR(FM_YD_CD ,1,5) IN (
              SELECT SCC_CD FROM MDM_EQ_ORZ_CHT WHERE 1 = 1
                  #if (${fmecccd} != '')                                                       
                       #if (${fmtype} == 'R')             
                             AND RCC_CD IN (${arrfmecccd}) 
                       #end                               
                        #if (${fmtype} == 'L')             
                             AND LCC_CD IN (${arrfmecccd}) 
                       #end                               
                        #if (${fmtype} == 'E')             
                             AND ECC_CD IN (${arrfmecccd}) 
                       #end                               
                  #end 
               ) 
               AND SUBSTR(TO_YD_CD ,1,5) IN ( 
                  SELECT SCC_CD FROM MDM_EQ_ORZ_CHT WHERE 1 = 1 
                   #if (${toecccd} != '') 
                        #if (${totype} == 'R')
                             AND RCC_CD IN (${arrtoecccd}) 
                			  #end
                        #if (${totype} == 'L')
                             AND LCC_CD IN (${arrtoecccd})
                			  #end
                        #if (${totype} == 'E')
                             AND ECC_CD IN (${arrtoecccd})
                			  #end
                	 #end
                ) 
           #else
           AND (SUBSTR(FM_YD_CD ,1,5) IN (
           
                SELECT SCC_CD FROM MDM_EQ_ORZ_CHT WHERE 1 = 1 
             		     #if (${atecccd} != '')                       
                          #if (${attype} == 'R')                  
                               AND RCC_CD IN (${arratecccd})      
             			        #end                                   
                          #if (${attype} == 'L')                  
                               AND LCC_CD IN (${arratecccd})      
             			        #end                                   
                          #if (${attype} == 'E')                  
                               AND ECC_CD IN (${arratecccd})      
             			        #end                                    
             		     #end   
                                                    
                ) OR SUBSTR(TO_YD_CD ,1,5) IN (
                SELECT SCC_CD FROM MDM_EQ_ORZ_CHT WHERE 1 = 1 
             		     #if (${atecccd} != '')                       
                          #if (${attype} == 'R')                  
                               AND RCC_CD IN (${arratecccd})      
             			        #end                                   
                          #if (${attype} == 'L')                  
                               AND LCC_CD IN (${arratecccd})      
             			        #end                                   
                          #if (${attype} == 'E')                  
                               AND ECC_CD IN (${arratecccd})      
             			        #end                                    
             		     #end   
                 )) 
           #end
          
           #if (${fmtoat} == '1')
             #if(${fmplnwk} !='') 
                AND FM_DT  BETWEEN                                                                         
                    (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[fm_yrwk])                                
                    AND		                                                                                
                    (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[to_yrwk])	
             #end
             #if(${fmtoplnwk} != '')                         
                AND TO_DT  BETWEEN		                                                                    
                    (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[fm_to_yrwk])		                        
                    AND		                                                                                
                    (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[to_to_yrwk])
             #end
           #else	
           AND FM_DT  BETWEEN                                                                         
                    (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[at_fm_yrwk])                                
                    AND		                                                                                
                    (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[at_to_yrwk])
           AND TO_DT  BETWEEN		                                                                    
                    (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[at_fm_yrwk])		                        
                    AND		                                                                                
                    (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[at_to_yrwk])	
           #end
           #if(${arroddtpsz} !='')                                           
           AND CNTR_TPSZ_CD IN(${arroddtpsz})
           #end	                        
           AND WO_EXE_FLG = 'Y'                                                                           
       GROUP BY REPO_PLN_ID ,PLN_YRWK ,CNTR_TPSZ_CD ,FM_YD_CD,TO_YD_CD ,SO_IF_DIV_CD	                    
	 UNION ALL
#end                                                                                                                               
	    SELECT    REPO_PLN_ID,	                                                                                    
	              PLN_YRWK,                                                                                         
			          SO_IF_DIV_CD,		                                                                                
	              DECODE(SO_IF_DIV_CD,'F', (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SCC_CD = SUBSTR(FM_YD_CD ,1,5))) FM_ECC_CD,		
	              DECODE(SO_IF_DIV_CD,'O', (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SCC_CD = SUBSTR(TO_YD_CD ,1,5))) TO_ECC_CD,     
                COUNT(CNTR_TPSZ_CD) QTY,		                                                                                    
	              SUM(REPO_COST_AMT)  AMT,                                                                                          
	              CNTR_TPSZ_CD 		                                                                                                
         FROM   EQR_REPO_EXE_SO_IF PLN
         #if (${fmtoat} == '1')                                                    
                , ( SELECT SCC_CD FROM MDM_EQ_ORZ_CHT WHERE 1 = 1 
             		     #if (${fmecccd} != '' || ${toecccd} != '')                       
                           #if (${fmtype} == 'R')                  
                                AND RCC_CD IN (${arrfmecccd} )      
             			         #end                                   
                           #if (${fmtype} == 'L')                  
                                AND LCC_CD IN (${arrfmecccd} )      
             			         #end                                   
                           #if (${fmtype} == 'E')                  
                                AND ECC_CD IN (${arrfmecccd} )      
             			         #end                                   
             		      #end                                         
                   ) c                                            
          #else                                               
                 , ( SELECT SCC_CD FROM MDM_EQ_ORZ_CHT WHERE 1 = 1 
             		     #if (${atecccd} != '')                       
                          #if (${attype} == 'R')                  
                               AND RCC_CD IN (${arratecccd})      
             			        #end                                   
                          #if (${attype} == 'L')                  
                               AND LCC_CD IN (${arratecccd})      
             			        #end                                   
                          #if (${attype} == 'E')                  
                               AND ECC_CD IN (${arratecccd})      
             			        #end                                    
             		     #end                                          
                  ) c                                            
         #end           
        WHERE REPO_PLN_ID = @[repo_pln_id]
        #if(${item} == '')                                                                              
        AND SO_IF_DIV_CD IN ('O','F')
        #else
        AND SO_IF_DIV_CD IN (${arritem}) 
        #end
        #if(${lane} != '')
		 AND PLN.VSL_LANE_CD IN (${arrlane})
		    #end 
		    #if(${vvd} != '')
				  AND PLN.VSL_CD||SKD_VOY_NO||SKD_DIR_CD IN(${arrvvd})
				 #end        
        AND (DECODE(SO_IF_DIV_CD, 'F', SUBSTR(FM_YD_CD ,1,5)) IN( C.SCC_CD ) OR DECODE(SO_IF_DIV_CD, 'O', SUBSTR(TO_YD_CD ,1,5)) IN( C.SCC_CD )) 
        #if (${fmtoat} == '1')
             #if(${fmplnwk} !='')
             AND FM_DT  BETWEEN                                                                             
		             (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[fm_yrwk])                                    
		             AND		                                                                                    
 			           (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[to_yrwk])
             #end
             #if(${fmtoplnwk} != '')
             AND TO_DT  BETWEEN		                                                                                                   
		            (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[fm_to_yrwk])		                                                     
			          AND		                                                                                                                     
			          (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[to_to_yrwk])
             #end
        #else
        AND FM_DT  BETWEEN                                                                             
		    (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[at_fm_yrwk])                                    
		       AND		                                                                                    
 			    (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[at_to_yrwk])	                                
		AND TO_DT  BETWEEN		                                                                                                   
		      (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[at_fm_yrwk])		                                                     
		       AND		                                                                                                                     
			    (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[at_to_yrwk])
			  #end
		#if(${arroddtpsz} !='')                                           
        AND CNTR_TPSZ_CD IN(${arroddtpsz})
        #end			                                                     
        AND WO_EXE_FLG = 'Y'                                                                                          
     GROUP BY REPO_PLN_ID ,PLN_YRWK ,CNTR_TPSZ_CD ,FM_YD_CD,TO_YD_CD ,SO_IF_DIV_CD		                         
 UNION ALL                                                                                            
         SELECT PLN.REPO_PLN_ID ,  
                PLN.PLN_YRWK,       
                ONF_HIR_DIV_CD,  
                DECODE(ONF_HIR_DIV_CD,'F', (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SCC_CD = SUBSTR(FM_YD_CD ,1,5))) FM_ECC_CD,             
                DECODE(ONF_HIR_DIV_CD,'O', (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SCC_CD = SUBSTR(TO_YD_CD ,1,5))) TO_ECC_CD,                 
                SUM(QTY.CNTR_QTY) QTY,                                                                                                               
                SUM(QTY.ONF_HIR_COST_AMT) AMT,                                                                                                      
                CNTR_TPSZ_CD																													 
        FROM   EQR_ONF_HIR_EXE_PLN PLN
              ,EQR_ONF_HIR_EXE_PLN_QTY QTY
            #if (${fmtoat} == '1')                                                    
                , ( SELECT SCC_CD FROM MDM_EQ_ORZ_CHT WHERE 1 = 1 
             		     #if (${fmecccd} != '' || ${toecccd} != '')                       
                           #if (${fmtype} == 'R')                  
                                AND RCC_CD IN (${arrfmecccd} )      
             			         #end                                   
                           #if (${fmtype} == 'L')                  
                                AND LCC_CD IN (${arrfmecccd} )      
             			         #end                                   
                           #if (${fmtype} == 'E')                  
                                AND ECC_CD IN (${arrfmecccd} )      
             			         #end                                   
             		      #end                                         
                   ) c                                            
            #else                                               
                 , ( SELECT SCC_CD FROM MDM_EQ_ORZ_CHT WHERE 1 = 1 
             		     #if (${atecccd} != '')                       
                          #if (${attype} == 'R')                  
                               AND RCC_CD IN (${arratecccd})      
             			        #end                                   
                          #if (${attype} == 'L')                  
                               AND LCC_CD IN (${arratecccd})      
             			        #end                                   
                          #if (${attype} == 'E')                  
                               AND ECC_CD IN (${arratecccd})      
             			        #end                                    
             		     #end                                          
                  ) c                                            
            #end           																										 
            WHERE PLN.REPO_PLN_ID = @[repo_pln_id]
            #if(${item} == '')                                                                              
            AND ONF_HIR_DIV_CD IN ('O','F')
            #else
            AND ONF_HIR_DIV_CD IN (${arritem})
            #end                                                                                                       
            AND (decode(ONF_HIR_DIV_CD, 'F', SUBSTR(FM_YD_CD ,1,5)) in( c.scc_cd ) OR decode(ONF_HIR_DIV_CD, 'O', SUBSTR(TO_YD_CD ,1,5)) in( c.scc_cd )) 
            #if (${fmtoat} == '1')
             #if(${fmplnwk} !='')
              AND FM_LOC_DT  BETWEEN                                                                              
        		    (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[fm_yrwk])                                         
        		    AND		                                                                                         
         			  (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[to_yrwk])	
              #end
             #if(${fmtoplnwk} != '')
              AND TO_LOC_DT  BETWEEN		                                                                     
        		    (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[fm_to_yrwk])		                                 
	              AND		                                                                                         
 	              (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[to_to_yrwk])	
             #end
            #else
            AND FM_LOC_DT  BETWEEN                                                                              
        		    (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[at_fm_yrwk])                                         
        		    AND		                                                                                         
         			  (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[at_to_yrwk])	                                     
        		AND TO_LOC_DT  BETWEEN		                                                                     
        		    (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[at_fm_yrwk])		                                 
	              AND		                                                                                         
 	              (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[at_to_yrwk])		                                 
        		#end
        		#if(${arroddtpsz} !='')                                           
            AND CNTR_TPSZ_CD IN(${arroddtpsz})
            #end
            AND NON_SO_ISS_FLG = 'Y'
            AND PLN.REPO_PLN_ID = QTY.REPO_PLN_ID
            AND PLN.PLN_YRWK    = QTY.PLN_YRWK
            AND PLN.PLN_SEQ     = QTY.PLN_SEQ
            AND PLN.REF_ID      = QTY.REF_ID
             GROUP BY PLN.REPO_PLN_ID ,PLN.PLN_YRWK ,CNTR_TPSZ_CD ,FM_YD_CD,TO_YD_CD ,ONF_HIR_DIV_CD                                                 
#if(${item} != 'O' && ${item} !='F')          			  											 	
    UNION ALL
				    SELECT  VSL.REPO_PLN_ID, 																							 
				            VSL.PLN_YRWK ,                                                                                               
				            TRSP_MOD_CD SO_IF_DIV_CD,                                                                                            
				            (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SCC_CD = SUBSTR(FM_YD_CD ,1,5)) FM_ECC_CD,						 
				    	      (SELECT ECC_CD FROM MDM_EQ_ORZ_CHT WHERE SCC_CD = SUBSTR(TO_YD_CD ,1,5)) TO_ECC_CD,	                     
			              DECODE(VSL.REPO_MTY_BKG_FLG, 'Y', DECODE(VSL.SPLIT_REPO_PLN_FLG,'N',B.CNTR_QTY,QTY.CNTR_QTY), QTY.CNTR_QTY)  QTY, 					 					
						        QTY.LODG_DCHG_COST_AMT AMT,                                                                                 
					          QTY.CNTR_TPSZ_CD                                                                                            
		        FROM EQR_VSL_LODG_DCHG_EXE_PLN  VSL, 
		             EQR_VSL_EXE_PLN_QTY QTY,																			 
		             (                                                                                    
		               SELECT A.OLD_BKG_GRP_NO	                                                            
		                      ,A.CNTR_TPSZ_CD                                                             
		                      ,NVL(A.CNTR_QTY, 0) - NVL(B.CNTR_QTY, 0) CNTR_QTY  -- (original - split)    
		               FROM                                                                              
		                   (                                                                                 
		                    SELECT DISTINCT A.OLD_BKG_GRP_NO                                                 
		                          ,QTY.CNTR_TPSZ_CD                                                        
		                          ,SUM(QTY.CNTR_QTY) CNTR_QTY                                              
		                    FROM EQR_VSL_LODG_DCHG_EXE_PLN A,
		                         EQR_VSL_EXE_PLN_QTY QTY,                                            
		                         (                                                                       
		                             SELECT DISTINCT OLD_BKG_GRP_NO                                         
		                             FROM EQR_VSL_LODG_DCHG_EXE_PLN                                      
		              			   WHERE REPO_PLN_ID = @[repo_pln_id]                               
		                             AND   REPO_MTY_BKG_FLG = 'Y'                                        
		                           --  AND	SPLIT_REPO_PLN_FLG = 'N'                              
		                         ) B                                                                     
		                    WHERE A.OLD_BKG_GRP_NO = B.OLD_BKG_GRP_NO
		                    AND   A.REPO_PLN_ID    = QTY.REPO_PLN_ID
		                    AND   A.PLN_YRWK       = QTY.PLN_YRWK
		                    AND   A.PLN_SEQ        = QTY.PLN_SEQ
		                    AND   A.REF_ID         = QTY.REF_ID                                            
		                    GROUP BY A.OLD_BKG_GRP_NO                                                        
		                            ,QTY.CNTR_TPSZ_CD                                                      
		                    ) A,                                                                              
		                    (                                                                                 
		                           SELECT DISTINCT A.OLD_BKG_GRP_NO                                                 
		                                 ,QTY.CNTR_TPSZ_CD                                                        
		                                 ,SUM(QTY.CNTR_QTY) CNTR_QTY                                              
		                           FROM EQR_VSL_LODG_DCHG_EXE_PLN A,
		                                EQR_VSL_EXE_PLN_QTY QTY,                                            
		                                (                                                                       
		                                    SELECT DISTINCT OLD_BKG_GRP_NO                                          
		                                    FROM EQR_VSL_LODG_DCHG_EXE_PLN                                      
		              				        WHERE REPO_PLN_ID = @[repo_pln_id]                               
		                                    AND   REPO_MTY_BKG_FLG = 'Y'
		                                    AND	SPLIT_REPO_PLN_FLG = 'Y'
										  --  AND	SUBSTR(MTY_BKG_NO,LENGTH(MTY_BKG_NO)-1, LENGTH(MTY_BKG_NO)) IS NOT NULL                                        
		                                ) B                                                                     
		                           WHERE A.OLD_BKG_GRP_NO = B.OLD_BKG_GRP_NO 
		                           AND   A.REPO_PLN_ID    = QTY.REPO_PLN_ID
		                           AND   A.PLN_YRWK       = QTY.PLN_YRWK
		                           AND   A.PLN_SEQ        = QTY.PLN_SEQ 
		                           AND   A.REF_ID         = QTY.REF_ID                                           
		                           GROUP BY A.OLD_BKG_GRP_NO                                                        
		                                   ,QTY.CNTR_TPSZ_CD                                                      
		                      ) B                                                                              
		                       WHERE A.OLD_BKG_GRP_NO = B.OLD_BKG_GRP_NO(+)                                             
		                       AND   A.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD(+)                                         
		                ) B
		        #if (${fmtoat} == '1')
		          ,(SELECT SCC_CD FROM MDM_EQ_ORZ_CHT WHERE 1 = 1
                  #if (${fmecccd} != '')                                                       
                       #if (${fmtype} == 'R')             
                             AND RCC_CD IN (${arrfmecccd}) 
                       #end                               
                        #if (${fmtype} == 'L')             
                             AND LCC_CD IN (${arrfmecccd}) 
                       #end                               
                        #if (${fmtype} == 'E')             
                             AND ECC_CD IN (${arrfmecccd}) 
                       #end                               
                  #end                                     
               ) c
              , (SELECT SCC_CD FROM MDM_EQ_ORZ_CHT WHERE 1 = 1 
                   #if (${toecccd} != '') 
                        #if (${totype} == 'R')
                             AND RCC_CD IN (${arrtoecccd}) 
                			  #end
                        #if (${totype} == 'L')
                             AND LCC_CD IN (${arrtoecccd})
                			  #end
                        #if (${totype} == 'E')
                             AND ECC_CD IN (${arrtoecccd})
                			  #end
                	 #end
               ) d
          #else 
           , ( SELECT SCC_CD FROM MDM_EQ_ORZ_CHT WHERE 1 = 1 
             		     #if (${atecccd} != '')                       
                          #if (${attype} == 'R')                  
                               AND RCC_CD IN (${arratecccd})      
             			        #end                                   
                          #if (${attype} == 'L')                  
                               AND LCC_CD IN (${arratecccd})      
             			        #end                                   
                          #if (${attype} == 'E')                  
                               AND ECC_CD IN (${arratecccd})      
             			        #end                                    
             		     #end                                          
                  ) C    
          #end                                                                                     
	        WHERE VSL.REPO_PLN_ID = @[repo_pln_id]                                                                                 
            AND   VSL.OLD_BKG_GRP_NO   = B.OLD_BKG_GRP_NO   	        							
		    AND   QTY.CNTR_TPSZ_CD = B.CNTR_TPSZ_CD										
			AND   REPO_MTY_BKG_FLG ='Y'
            #if(${item} != '')                                                                            
            AND   TRSP_MOD_CD IN (${arritem})
            #end
            #if(${lane} != '')
			      AND VSL_LANE_CD IN (${arrlane})
			      #end
			      #if(${vvd} != '')
				    AND VSL_CD||SKD_VOY_NO||SKD_DIR_CD IN(${arrvvd})
				    #end
            #if (${fmtoat} == '1')                                                          
            AND SUBSTR(FM_YD_CD ,1,5) IN ( C.SCC_CD ) AND SUBSTR(TO_YD_CD ,1,5) IN ( D.SCC_CD ) 
            #else
            AND (SUBSTR(FM_YD_CD ,1,5) IN ( C.SCC_CD ) OR SUBSTR(TO_YD_CD ,1,5) IN ( C.SCC_CD ))
            #end
            #if (${fmtoat} == '1')
             #if(${fmplnwk} !='')
              AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fm_yrwk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[to_yrwk]  ) 
             #end
             #if(${fmtoplnwk} != '')
              AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[fm_to_yrwk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK =@[to_to_yrwk] )   
             #end
            #else
            AND TO_CHAR(FM_ETD_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[at_fm_yrwk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[at_to_yrwk] ) 
			AND TO_CHAR(TO_ETB_DT,'YYYYMMDD') BETWEEN (SELECT WK_ST_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[at_fm_yrwk]) AND (SELECT WK_END_DT FROM EQR_WK_PRD WHERE PLN_YR || PLN_WK = @[at_to_yrwk] )   
			#end
						AND VSL.REPO_PLN_ID = QTY.REPO_PLN_ID
						AND VSL.PLN_YRWK    = QTY.PLN_YRWK
						AND VSL.PLN_SEQ     = QTY.PLN_SEQ
						AND VSL.REF_ID      = QTY.REF_ID
#end	                                                                                   
    )                                                                                                                                         
   GROUP BY    REPO_PLN_ID, PLN_YRWK, SO_IF_DIV_CD ,FM_ECC_CD ,TO_ECC_CD                                                                                  
	 ) B                                                                                                                       
                 	 WHERE A.PLN_YRWK  = B.PLN_YRWK                                                                                                                                                   
                 	       AND A.TRSP_MOD_CD  = B.SO_IF_DIV_CD                                                                                                                                           
                 		   AND A.FM_ECC_CD    = B.FM_ECC_CD                                                                                                                                              
                 		   AND A.TO_ECC_CD    = B.TO_ECC_CD                                                                                                                                              
                 	 GROUP BY A.PLN_YRWK,A.TRSP_MOD_CD ,A.FM_ECC_CD ,A.TO_ECC_CD                                                                                                                       
                 	 ORDER BY A.PLN_YRWK ASC
)
     GROUP BY PLN_YRWK,TRSP_MOD_CD ,FM_ECC_CD ,TO_ECC_CD                                                         
	 ORDER BY PLN_YRWK ,TRSP_MOD_CD ,FM_ECC_CD ,TO_ECC_CD  ASC			]]></sql>
			<params>
				<param name="repo_pln_id" type="12" value="" out="N"/>
				<param name="fm_yrwk" type="12" value="" out="N"/>
				<param name="to_yrwk" type="12" value="" out="N"/>
				<param name="fm_to_yrwk" type="12" value="" out="N"/>
				<param name="to_to_yrwk" type="12" value="" out="N"/>
				<param name="at_fm_yrwk" type="12" value="" out="N"/>
				<param name="at_to_yrwk" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
