<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ExpensePlanDBDAOExpensePlanListRSQL">
			<desc><![CDATA[CNTR/CHSS에 대한 년간 사업계획 목록을 조회한다.]]></desc>
			<sql><![CDATA[
SELECT  ROW_NUMBER() OVER(ORDER BY EQ_KND_CD, DECODE(EQ_TERM_NM,'LP',1,'OL',2,'LT',
            3,'ST', 4,'DR COST', 5,'SB',6,'SO',7,'N/P',8,'C/P',9, 'MG.SET',10, 11,'SEN Rev', 12), EXPN_MON) AS PLN_SEQ,
        PLN_YR, VER_SEQ, EQ_KND_CD, EQ_TERM_NM, EXPN_MON_CD, EXPN_AMT, IBFLAG
FROM   (SELECT  NVL2(AA.PLN_YR, 'R','U') AS IBFLAG,
                NVL(AA.PLN_YR, P.PLN_YR) AS PLN_YR,          
                NVL(AA.VER_SEQ, P.VER_SEQ) AS VER_SEQ, 
                NVL(AA.EQ_KND_CD, BB.EQ_KND_CD) AS EQ_KND_CD, 
                NVL(AA.EQ_TERM_NM, BB.EQ_TERM_NM) AS EQ_TERM_NM,
                NVL(AA.EXPN_MON_CD, BB.EXPN_MON_CD) AS EXPN_MON_CD,
                NVL(AA.EXPN_AMT, 0) AS EXPN_AMT, BB.EXPN_MON
        FROM   (
#if (${cmd_type} == "NEWVER")
				SELECT  NVL(MAX(PLN_YR),@[pln_yr]) AS PLN_YR,
				        NVL(MAX(VER_SEQ),0) +1 	   AS VER_SEQ   
				FROM    LSE_EQ_EXPN_PLN
				WHERE   PLN_YR = @[pln_yr]	
#elseif (${ver_seq} == "") 
				SELECT  NVL(MAX(PLN_YR),@[pln_yr]) AS PLN_YR,
				        NVL(MAX(VER_SEQ),1)   	   AS VER_SEQ   
				FROM    LSE_EQ_EXPN_PLN
				WHERE   PLN_YR = @[pln_yr]
#else
				SELECT  @[pln_yr]  AS PLN_YR,
				        @[ver_seq] AS VER_SEQ   
				FROM    DUAL
#end
				) P,
               (SELECT  A.PLN_YR, A.PLN_SEQ, A.VER_SEQ, A.EQ_KND_CD, 
                        A.EQ_TERM_NM, A.EXPN_MON_CD, A.EXPN_AMT 
                FROM    LSE_EQ_EXPN_PLN A, 
                       (
#if (${cmd_type} == "NEWVER")
						SELECT  NVL(MAX(PLN_YR),@[pln_yr]) AS PLN_YR,
					            NVL(MAX(VER_SEQ),0) +1 	   AS VER_SEQ   
					    FROM    LSE_EQ_EXPN_PLN
					    WHERE   PLN_YR = @[pln_yr]	
#elseif (${ver_seq} == "") 
						SELECT  NVL(MAX(PLN_YR),@[pln_yr]) AS PLN_YR,
					            NVL(MAX(VER_SEQ),1)   	   AS VER_SEQ   
					    FROM    LSE_EQ_EXPN_PLN
					    WHERE   PLN_YR = @[pln_yr]
#else
						SELECT  @[pln_yr]  AS PLN_YR,
					            @[ver_seq] AS VER_SEQ   
					    FROM    DUAL
#end
						) P
                WHERE   1 = 1
                AND     A.PLN_YR  = P.PLN_YR
                AND     A.VER_SEQ = P.VER_SEQ
                ) AA,
               (SELECT  'U' EQ_KND_CD, C.EQ_TERM_NM, B.EXPN_MON_CD, B.EXPN_MON
                FROM   (SELECT  LEVEL AS EXPN_MON,
                                TO_CHAR(ADD_MONTHS(TO_DATE('200901', 'YYYYMM'), LEVEL -1), 
                                    'MON', 'NLS_DATE_LANGUAGE = American') EXPN_MON_CD                             
                        FROM    DUAL
                        CONNECT BY LEVEL <= 12) B,             
                       (SELECT 'LP' AS EQ_TERM_NM FROM DUAL  
                        UNION SELECT 'OL' FROM DUAL
                        UNION SELECT 'LT' FROM DUAL
                        UNION SELECT 'ST' FROM DUAL
						UNION SELECT 'DR COST' FROM DUAL
                        UNION SELECT 'SB' FROM DUAL
                        UNION SELECT 'SO' FROM DUAL) C
                UNION
                SELECT  'Z' EQ_KND_CD, C.EQ_TERM_NM, B.EXPN_MON_CD, B.EXPN_MON
                FROM   (SELECT  LEVEL AS EXPN_MON,
                                TO_CHAR(ADD_MONTHS(TO_DATE('200901', 'YYYYMM'), LEVEL -1), 
                                    'MON', 'NLS_DATE_LANGUAGE = American') EXPN_MON_CD
                        FROM    DUAL
                        CONNECT BY LEVEL <= 12) B,             
                       (SELECT 'LP' AS EQ_TERM_NM FROM DUAL  
                        UNION SELECT 'OL' FROM DUAL
                        UNION SELECT 'LT' FROM DUAL
                        UNION SELECT 'ST' FROM DUAL
                        UNION SELECT 'N/P' FROM DUAL
                        UNION SELECT 'C/P' FROM DUAL
                        UNION SELECT 'MG.SET' FROM DUAL
						UNION SELECT 'SEN Rev' FROM DUAL) C
                ) BB        
        WHERE   BB.EQ_KND_CD = AA.EQ_KND_CD(+)
        AND     BB.EQ_TERM_NM = AA.EQ_TERM_NM(+)
        AND     BB.EXPN_MON_CD = AA.EXPN_MON_CD(+)       
)			]]></sql>
			<params>
				<param name="pln_yr" type="12" value="" out="N"/>
				<param name="ver_seq" type="2" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
