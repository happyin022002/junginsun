<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EQAvailabilityFinderDBDAOsearchAvailListRSQL">
			<desc><![CDATA[EQ Availability]]></desc>
			<sql><![CDATA[
WITH LV_YARD_QTY AS (
    SELECT 
           'YARD' LOC_LEVEL
          ,A.YD_CD
          ,A.SCC_CD
          ,TO_CHAR(A.FCAST_DT,'YYYYMMDD') FCAST_DT
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL1,A.EA)) EA1
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL1,A.BR)) BR1
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL1,A.PUP)) PUP1
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL1,A.RO)) RO1
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL1,A.OFH)) OFH1
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL1,A.DG)) DG1
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL1,A.SN)) SN1
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL1,A.IG)) IG1
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL1,A.RTN)) RTN1
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL1,A.RI)) RI1
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL1,A.ONH)) ONH1
		  ,'' CELLSPACE1

          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL2,A.EA)) EA2
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL2,A.BR)) BR2
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL2,A.PUP)) PUP2
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL2,A.RO)) RO2
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL2,A.OFH)) OFH2
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL2,A.DG)) DG2
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL2,A.SN)) SN2
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL2,A.IG)) IG2
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL2,A.RTN)) RTN2
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL2,A.RI)) RI2
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL2,A.ONH)) ONH2
		  ,'' CELLSPACE2

          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL3,A.EA)) EA3
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL3,A.BR)) BR3
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL3,A.PUP)) PUP3
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL3,A.RO)) RO3
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL3,A.OFH)) OFH3
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL3,A.DG)) DG3
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL3,A.SN)) SN3
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL3,A.IG)) IG3
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL3,A.RTN)) RTN3
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL3,A.RI)) RI3
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL3,A.ONH)) ONH3
		  ,'' CELLSPACE3

          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL4,A.EA)) EA4
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL4,A.BR)) BR4
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL4,A.PUP)) PUP4
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL4,A.RO)) RO4
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL4,A.OFH)) OFH4
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL4,A.DG)) DG4
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL4,A.SN)) SN4
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL4,A.IG)) IG4
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL4,A.RTN)) RTN4
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL4,A.RI)) RI4
          ,SUM(DECODE(A.CNTR_TPSZ_CD,C.CNTR_TPSZ_CD_VAL4,A.ONH)) ONH4
		  ,'' CELLSPACE4
    FROM CIM_AVAL_SMRY_V A,MDM_LOCATION B,
		(	
		    SELECT
		        MAX(DECODE(RANK,1,CNTR_TPSZ_CD)) CNTR_TPSZ_CD_VAL1 
		       ,MAX(DECODE(RANK,2,CNTR_TPSZ_CD)) CNTR_TPSZ_CD_VAL2 
		       ,MAX(DECODE(RANK,3,CNTR_TPSZ_CD)) CNTR_TPSZ_CD_VAL3 
		       ,MAX(DECODE(RANK,4,CNTR_TPSZ_CD)) CNTR_TPSZ_CD_VAL4 
		    FROM
		    (
		        SELECT
		               A.CNTR_TPSZ_CD
		               ,RANK() OVER (ORDER BY A.CNTR_TPSZ_CD) RANK
		          FROM MDM_CNTR_TP_SZ A
		          WHERE A.CNTR_TPSZ_CD IN (@[cntr_tpsz_cd_val1],@[cntr_tpsz_cd_val2],@[cntr_tpsz_cd_val3],@[cntr_tpsz_cd_val4])
		          ORDER BY A.RPT_DP_SEQ
		    )
		) C
    WHERE A.SCC_CD=B.SCC_CD
	#if (${loc_type_code} == 'Y')
	    AND B.LOC_CD = SUBSTR(@[loc_cd],1,5)
	#else
	    AND B.LOC_CD = @[loc_cd]
	#end
    AND A.CNTR_TPSZ_CD IN (@[cntr_tpsz_cd_val1],@[cntr_tpsz_cd_val2],@[cntr_tpsz_cd_val3],@[cntr_tpsz_cd_val4])
    GROUP BY A.SCC_CD,A.YD_CD,A.FCAST_DT,A.FCAST_DT
    ORDER BY A.SCC_CD,A.YD_CD,A.FCAST_DT
)
,LV_SCC_QTY AS(
    SELECT  
            'SCC' LOC_LEVEL
           ,'' YD_CD
           ,A.SCC_CD
           ,A.FCAST_DT
           ,SUM(A.EA1) EA1
           ,SUM(A.BR1) BR1
           ,SUM(A.PUP1) PUP1
           ,SUM(A.RO1) RO1
           ,SUM(A.OFH1) OFH1
           ,SUM(A.DG1) DG1
           ,SUM(A.SN1) SN1
           ,SUM(A.IG1) IG1
           ,SUM(A.RTN1) RTN1
           ,SUM(A.RI1) RI1
           ,SUM(A.ONH1) ONH1

           ,SUM(A.EA2) EA2
           ,SUM(A.BR2) BR2
           ,SUM(A.PUP2) PUP2
           ,SUM(A.RO2) RO2
           ,SUM(A.OFH2) OFH2
           ,SUM(A.DG2) DG2
           ,SUM(A.SN2) SN2
           ,SUM(A.IG2) IG2
           ,SUM(A.RTN2) RTN2
           ,SUM(A.RI2) RI2
           ,SUM(A.ONH2) ONH2

           ,SUM(A.EA3) EA3
           ,SUM(A.BR3) BR3
           ,SUM(A.PUP3) PUP3
           ,SUM(A.RO3) RO3
           ,SUM(A.OFH3) OFH3
           ,SUM(A.DG3) DG3
           ,SUM(A.SN3) SN3
           ,SUM(A.IG3) IG3
           ,SUM(A.RTN3) RTN3
           ,SUM(A.RI3) RI3
           ,SUM(A.ONH3) ONH3

           ,SUM(A.EA4) EA4
           ,SUM(A.BR4) BR4
           ,SUM(A.PUP4) PUP4
           ,SUM(A.RO4) RO4
           ,SUM(A.OFH4) OFH4
           ,SUM(A.DG4) DG4
           ,SUM(A.SN4) SN4
           ,SUM(A.IG4) IG4
           ,SUM(A.RTN4) RTN4
           ,SUM(A.RI4) RI4
           ,SUM(A.ONH4) ONH4
    FROM LV_YARD_QTY A
    GROUP BY A.SCC_CD,A.FCAST_DT,A.FCAST_DT
    ORDER BY A.SCC_CD,A.FCAST_DT
)
SELECT 
   LOC_LEVEL
  ,YD_CD
  ,SCC_CD
  ,SCC_CD SCC_YD_CD
  ,FCAST_DT
  ,EA1+BR1+PUP1+RO1+OFH1+SN1+DG1+IG1+RTN1+RI1+ONH1 avail1
  ,EA1
  ,BR1
  ,PUP1
  
  ,RO1
  ,OFH1
  ,DG1
  ,SN1
  ,IG1
  ,RTN1
  ,RI1
  ,ONH1

  ,EA2+BR2+PUP2+RO2+OFH2+SN2+DG2+IG2+RTN2+RI2+ONH2 avail2
  ,EA2
  ,BR2
  ,PUP2
  
  ,RO2
  , OFH2
  ,DG2
  ,SN2
  ,IG2
  ,RTN2
  ,RI2
  ,ONH2

  ,EA3+BR3+PUP4+RO3+OFH3+DG3+SN3+IG3+RTN3+RI3+ONH3 avail3
  ,EA3
  ,BR3
  ,PUP3
  
  ,RO3
  , OFH3
  ,DG3
  ,SN3
  ,IG3
  ,RTN3
  ,RI3
  ,ONH3

  ,EA4+BR4+PUP4+RO4+OFH4+DG4+SN4+IG4+RI4+RTN4+ONH4 avail14
  ,EA4
  ,BR4
  ,PUP4
  
  ,RO4
  ,OFH4
  ,DG4
  ,SN4
  ,IG4
  ,RTN4
  ,RI4
  ,ONH4  
FROM LV_SCC_QTY
UNION ALL
SELECT 
   LOC_LEVEL
  ,YD_CD
  ,SCC_CD
  ,YD_CD SCC_YD_CD
  ,FCAST_DT
  ,EA1+BR1+PUP1+RO1+OFH1+SN1+DG1+IG1+RTN1+RI1+ONH1 avail1
  ,EA1
  ,BR1
  ,PUP1
  ,RO1
  ,OFH1
  ,DG1
  ,SN1
  ,IG1
  ,RTN1
  ,RI1
  ,ONH1

  ,EA2+BR2+PUP2+RO2+OFH2+SN2+DG2+IG2+RTN2+RI2+ONH2 avail2
  ,EA2
  ,BR2
  ,PUP2
  ,RO2
  , OFH2
  ,DG2
  ,SN2
  ,IG2
  ,RTN2
  ,RI2
  ,ONH2

  ,EA3+BR3+PUP3+RO3+OFH3+SN3+DG3+IG3+RTN3+RI3+ONH3 avail3
  ,EA3
  ,BR3
  ,PUP3
  ,RO3
  , OFH3
  ,DG3
  ,SN3
  ,IG3
  ,RTN3
  ,RI3
  ,ONH3

  ,EA4+BR4+PUP4+RO4+OFH4+SN4+DG4+IG4+RTN4+RI4+ONH4 avail14
  ,EA4
  ,BR4
  ,PUP4
  ,RO4
  ,OFH4
  ,DG4
  ,SN4
  ,IG4
  ,RTN4
  ,RI4
  ,ONH4
FROM LV_YARD_QTY A
#if (${loc_type_code} == 'Y')
	WHERE YD_CD = @[loc_cd]
#end			]]></sql>
			<params>
				<param name="cntr_tpsz_cd_val1" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd_val2" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd_val3" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd_val4" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
