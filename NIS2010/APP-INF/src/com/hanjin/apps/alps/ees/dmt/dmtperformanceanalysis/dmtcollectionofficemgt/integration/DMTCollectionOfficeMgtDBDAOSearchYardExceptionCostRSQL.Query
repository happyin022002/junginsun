<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DMTCollectionOfficeMgtDBDAOSearchYardExceptionCostRSQL">
			<desc><![CDATA[Yard별로 등록된 Exception Cost를 조회함.
(1) DET Amount = CNTR_COST + OTR_COST + CY or DOR + STOCK 
: DTIC, CTIC 인 경우, term 이 'O'(FO) 인 경우
(2) DEM Amount = TML_COST + CNTR_COST + OTR_COST + CY or DOR + STOCK
 : DEM Amount대상 이외 경우]]></desc>
			<sql><![CDATA[
SELECT EXPT.CFM_FLG,
       EXPT.COST_STS,                       
       YD.DMDT_OFC_CD,
       YD.DEM_IB_CLT_FLG,
       YD.YD_CD,
       YD.YD_NM,
       YD.DELT_FLG,
       NVL(EXPT.CURR_CD,'USD') AS CURR_CD,
       NVL(EXPT.DMDT_CALC_TP_CD,   (SELECT /*+ INDEX_DESC( TB DMT_CALC_TP XPKDMT_CALC_TP) */
                                            TB.DMDT_CALC_TP_CD
                                      FROM  DMT_CALC_TP TB ,
                                            MDM_LOCATION TC
                                      WHERE TC.LOC_CD = SUBSTR(YD.YD_CD,1,5)
                                      AND   ( TB.CNT_CD   =  TC.CNT_CD OR TB.CNT_CD = ' ' )
                                      AND   ( TB.RGN_CD   =  TC.RGN_CD OR TB.RGN_CD = ' ' )
                                      AND   ( TB.STE_CD   =  TC.STE_CD OR TB.STE_CD = ' ' )
                                      AND   ( TB.LOC_CD   =  TC.LOC_CD OR TB.LOC_CD = ' ' )
                                      AND   TB.IO_BND_CD  =  'I'
                                      AND   TB.CALC_TP_SEQ = ( SELECT /*+ INDEX_DESC( TD XPKDMT_CALC_TP) */
                                                                    TD.CALC_TP_SEQ
                                                             FROM   DMT_CALC_TP  TD
                                                             WHERE  ( TD.CNT_CD = TC.CNT_CD   OR  TD.CNT_CD = ' ' )
                                                             AND    ( TD.RGN_CD = TC.RGN_CD   OR  TD.RGN_CD = ' ' )
                                                             AND    ( TD.STE_CD = TC.STE_CD   OR  TD.STE_CD = ' ' )
                                                             AND    ( TD.LOC_CD = TC.LOC_CD   OR  TD.LOC_CD = ' ' )
                                                             AND    TD.IO_BND_CD =  'I'
                                                             AND    ROWNUM = 1
                                                             )
                                      AND  ROWNUM = 1)
      ) AS DMDT_CALC_TP_CD,
       EXPT.TML_COST_20FT_RT_AMT,
       EXPT.TML_COST_40FT_RT_AMT,
       EXPT.CNTR_COST_20FT_RT_AMT,
       EXPT.CNTR_COST_40FT_RT_AMT,
       EXPT.CHG_COST_CY_RT_AMT,
       EXPT.CHG_COST_DOR_RT_AMT,
       EXPT.OTR_COST_20FT_RT_AMT,
       EXPT.OTR_COST_40FT_RT_AMT,
       EXPT.CNTR_COST_STK_AMT, 
       NVL(EXPT.DEM_CY_20FT, 0) AS DEM_CY_20FT,
       NVL(EXPT.DEM_CY_40FT, 0) AS DEM_CY_40FT,
       NVL(EXPT.DEM_DOR_20FT, 0) AS DEM_DOR_20FT,
       NVL(EXPT.DEM_DOR_40FT, 0) AS DEM_DOR_40FT,
       NVL(EXPT.DET_CY_20FT, 0) AS DET_CY_20FT,
       NVL(EXPT.DET_CY_40FT, 0) AS DET_CY_40FT,
       NVL(EXPT.DET_DOR_20FT, 0) AS DET_DOR_20FT,
       NVL(EXPT.DET_DOR_40FT, 0) AS DET_DOR_40FT,
       EXPT.EFF_DT,
       EXPT.EXP_DT,
       EXPT.CFM_DT,
       EXPT.CFM_USR_ID,
       EXPT.YD_EXPT_COST_SEQ
FROM (
SELECT
      NVL(A.CFM_FLG,'X') AS CFM_FLG,
      DECODE(NVL(A.CFM_FLG,'X'),'N','Temp. Saved','Y','Fixed','' ) AS COST_STS,                       
      B.DMDT_OFC_CD,
      B.DEM_IB_CLT_FLG,
      B.YD_CD,
      B.YD_NM,
      B.DELT_FLG,
      A.CURR_CD,
      A.DMDT_CALC_TP_CD,
      A.TML_COST_20FT_RT_AMT,
      A.TML_COST_40FT_RT_AMT,
      A.CNTR_COST_20FT_RT_AMT,
      A.CNTR_COST_40FT_RT_AMT,
      A.CHG_COST_CY_RT_AMT,
      A.CHG_COST_DOR_RT_AMT,
      A.OTR_COST_20FT_RT_AMT,
      A.OTR_COST_40FT_RT_AMT,
      A.CNTR_COST_STK_AMT,
      ( NVL(A.TML_COST_20FT_RT_AMT,0)  + 
        NVL(A.CNTR_COST_20FT_RT_AMT,0) + 
        NVL(A.OTR_COST_20FT_RT_AMT,0)  + 
        NVL(A.CHG_COST_CY_RT_AMT,0)    +
        NVL(A.CNTR_COST_STK_AMT,0)   ) AS DEM_CY_20FT,
      ( NVL(A.TML_COST_40FT_RT_AMT,0)  + 
        NVL(A.CNTR_COST_40FT_RT_AMT,0) +
        NVL(A.OTR_COST_40FT_RT_AMT,0)  + 
        NVL(A.CHG_COST_CY_RT_AMT,0)    +
        NVL(A.CNTR_COST_STK_AMT,0)   ) AS DEM_CY_40FT,
      ( NVL(A.TML_COST_20FT_RT_AMT,0)  + 
        NVL(A.CNTR_COST_20FT_RT_AMT,0) +
        NVL(A.OTR_COST_20FT_RT_AMT,0)  + 
        NVL(A.CHG_COST_DOR_RT_AMT,0)   +
        NVL(A.CNTR_COST_STK_AMT,0)  ) AS DEM_DOR_20FT,
      ( NVL(A.TML_COST_40FT_RT_AMT,0)  + 
        NVL(A.CNTR_COST_40FT_RT_AMT,0) +
        NVL(A.OTR_COST_40FT_RT_AMT,0)  + 
        NVL(A.CHG_COST_DOR_RT_AMT,0)   +
        NVL(A.CNTR_COST_STK_AMT,0)   ) AS DEM_DOR_40FT,
      ( NVL(A.CNTR_COST_20FT_RT_AMT,0) +
        NVL(A.OTR_COST_20FT_RT_AMT,0)  + 
        NVL(A.CHG_COST_CY_RT_AMT,0)    +
        NVL(A.CNTR_COST_STK_AMT,0)   ) AS DET_CY_20FT,
      ( NVL(A.CNTR_COST_40FT_RT_AMT,0) +
        NVL(A.OTR_COST_40FT_RT_AMT,0)  + 
        NVL(A.CHG_COST_CY_RT_AMT,0)    +
        NVL(A.CNTR_COST_STK_AMT,0)   ) AS DET_CY_40FT,
      ( NVL(A.CNTR_COST_20FT_RT_AMT,0) +
        NVL(A.OTR_COST_20FT_RT_AMT,0)  + 
        NVL(A.CHG_COST_DOR_RT_AMT,0)   +
        NVL(A.CNTR_COST_STK_AMT,0)  ) AS DET_DOR_20FT,
      ( NVL(A.CNTR_COST_40FT_RT_AMT,0) +
        NVL(A.OTR_COST_40FT_RT_AMT,0)  + 
        NVL(A.CHG_COST_DOR_RT_AMT,0)   +
        NVL(A.CNTR_COST_STK_AMT,0)   ) AS DET_DOR_40FT,
      TO_CHAR(A.EFF_DT,'YYYY-MM-DD') AS EFF_DT,
      TO_CHAR(A.EXP_DT,'YYYY-MM-DD') AS EXP_DT,
      TO_CHAR(A.CFM_DT,'YYYY-MM-DD') AS CFM_DT,
      A.CFM_USR_ID,
      A.YD_EXPT_COST_SEQ
FROM DMT_YD_EXPT_COST A,
     MDM_YARD B
WHERE A.YD_CD(+) = B.YD_CD
#if ( ${ofc_cd} != '' )
AND	B.DMDT_OFC_CD IN (
   #foreach( $dmdt_ofc_cd in ${dmtOfcList}) 
     #if($velocityCount < $dmtOfcList.size()) 
        '$dmdt_ofc_cd', 
     #else 
        '$dmdt_ofc_cd' 
     #end 
   #end
)
#end
#if ( ${dem_ib_clt_flg} != 'A' )
AND B.DEM_IB_CLT_FLG =  @[dem_ib_clt_flg]
#end
#if ( ${dem_ob_clt_flg} != 'A' )
AND B.DEM_OB_CLT_FLG =  @[dem_ob_clt_flg]
#end
#if ( ${cnt_cd} != '' )
AND SUBSTR(A.YD_CD,1,2) =  @[cnt_cd]
#end
#if ( ${yd_cd} != '' )
AND A.YD_CD LIKE  @[yd_cd]||'%'
#end
#if ( ${yd_delt_flg} != 'A' )
AND B.DELT_FLG =  @[yd_delt_flg]
#end
#if ( ${yd_type} == 'MA' )
AND B.YD_FCTY_TP_MRN_TML_FLG = 'Y'
#end
#if ( ${yd_type} == 'CY' )
AND B.YD_FCTY_TP_CY_FLG = 'Y'
#end
#if ( ${yd_type} == 'CF' )
AND B.YD_FCTY_TP_CFS_FLG = 'Y'
#end
#if ( ${yd_type} == 'RA' )
AND B.YD_FCTY_TP_RAIL_RMP_FLG = 'Y'
#end
#if ( ${yd_type} == 'BA' )
AND B.YD_FCTY_TP_BRG_RMP_FLG = 'Y'
#end
#if ( ${chk_current} == 'Y' &&  ${chk_tobe} == 'Y' &&  ${chk_expired} == 'N' )
AND (  (SYSDATE BETWEEN A.EFF_DT AND  NVL(A.EXP_DT,SYSDATE))
     OR SYSDATE < A.EFF_DT )
#end
#if ( ${chk_current} == 'Y' &&  ${chk_tobe} == 'N' &&  ${chk_expired} == 'N' )
AND SYSDATE BETWEEN A.EFF_DT AND  NVL(A.EXP_DT,SYSDATE)
#end
#if ( ${chk_current} == 'Y' &&  ${chk_tobe} == 'N' &&  ${chk_expired} == 'Y' )
AND ( (SYSDATE BETWEEN A.EFF_DT AND  NVL(A.EXP_DT,SYSDATE))
    OR SYSDATE > NVL(A.EXP_DT,SYSDATE))
#end
#if ( ${chk_current} == 'N' &&  ${chk_tobe} == 'Y' &&  ${chk_expired} == 'Y' )
AND (   SYSDATE < A.EFF_DT
     OR SYSDATE > NVL(A.EXP_DT,SYSDATE))
#end
#if ( ${chk_current} == 'N' &&  ${chk_tobe} == 'Y' &&  ${chk_expired} == 'N' )
AND SYSDATE < A.EFF_DT
#end
#if ( ${chk_current} == 'N' &&  ${chk_tobe} == 'N' &&  ${chk_expired} == 'Y' )
AND  SYSDATE > NVL(A.EXP_DT,SYSDATE)
#end
) EXPT, 
  MDM_YARD YD
WHERE EXPT.YD_CD(+) = YD.YD_CD
#if ( ${ofc_cd} != '' )
AND	YD.DMDT_OFC_CD IN (
   #foreach( $dmdt_ofc_cd in ${dmtOfcList}) 
     #if($velocityCount < $dmtOfcList.size()) 
        '$dmdt_ofc_cd', 
     #else 
        '$dmdt_ofc_cd' 
     #end 
   #end
)
#end
#if ( ${dem_ib_clt_flg} != 'A' )
AND YD.DEM_IB_CLT_FLG =  @[dem_ib_clt_flg]
#end
#if ( ${dem_ob_clt_flg} != 'A' )
AND YD.DEM_OB_CLT_FLG =  @[dem_ob_clt_flg]
#end
#if ( ${cnt_cd} != '' )
AND SUBSTR(YD.YD_CD,1,2) =  @[cnt_cd]
#end
#if ( ${yd_cd} != '' )
AND YD.YD_CD LIKE  @[yd_cd]||'%'
#end
#if ( ${yd_delt_flg} != 'A' )
AND YD.DELT_FLG =  @[yd_delt_flg]
#end
#if ( ${yd_type} == 'MA' )
AND YD.YD_FCTY_TP_MRN_TML_FLG = 'Y'
#end
#if ( ${yd_type} == 'CY' )
AND YD.YD_FCTY_TP_CY_FLG = 'Y'
#end
#if ( ${yd_type} == 'CF' )
AND YD.YD_FCTY_TP_CFS_FLG = 'Y'
#end
#if ( ${yd_type} == 'RA' )
AND YD.YD_FCTY_TP_RAIL_RMP_FLG = 'Y'
#end
#if ( ${yd_type} == 'BA' )
AND YD.YD_FCTY_TP_BRG_RMP_FLG = 'Y'
#end
#if ( ${cfm_flg} != 'A' )
AND  NVL(EXPT.CFM_FLG,'X') =  @[cfm_flg]
#end
ORDER BY YD.YD_CD, EXPT.YD_EXPT_COST_SEQ			]]></sql>
			<params>
				<param name="dem_ib_clt_flg" type="12" value="" out="N"/>
				<param name="dem_ob_clt_flg" type="12" value="" out="N"/>
				<param name="cnt_cd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="yd_delt_flg" type="12" value="" out="N"/>
				<param name="cfm_flg" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
