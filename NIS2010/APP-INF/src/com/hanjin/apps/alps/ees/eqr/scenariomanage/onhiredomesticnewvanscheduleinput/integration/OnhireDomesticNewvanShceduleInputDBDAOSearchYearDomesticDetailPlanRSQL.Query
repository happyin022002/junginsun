<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OnhireDomesticNewvanShceduleInputDBDAOSearchYearDomesticDetailPlanRSQL">
			<desc><![CDATA[eqr_scnr_dmst + eqr_dmst_perf 테이블의 데이터 조회]]></desc>
			<sql><![CDATA[
SELECT
    E.FM_ECC_CD,
    E.TO_ECC_CD,
    CNTR_TPSZ_CD,
    TO_CHAR(NVL(ROUND(SUM(DMST_RTO)/16,2),0),'990.99')||'%' DMST_RTO,
    #foreach( $key in ${arr})
        SUM (DECODE (PLN_YRWK, '$key', CNTR_VOL_QTY)) AS S2_${key}_CNTR_VOL_QTY,
    #end
    MAX (SCNR_ID) SCNR_ID,
    MAX(TIMEGAP) TIMEGAP
FROM (
    SELECT
        (SELECT
            #if (${fmtoat} == '1') 
            	#if (${fmtypeby} == 'R') 
            		RCC_CD
            	#elseif (${fmtypeby} == 'C') 
            		CNT_CD
            	#elseif (${fmtypeby} == 'L') 
            		LCC_CD
            	#else
            		ECC_CD
            	#end
            #else 
            	#if (${attypeby} == 'R') 
            		RCC_CD
            	#elseif (${attypeby} == 'C') 
            		CNT_CD
            	#elseif (${attypeby} == 'L') 
            		LCC_CD
            	#else
            		ECC_CD
            	#end
            #end
            FROM EQR_ECC_MST 
            WHERE A.FM_ECC_CD = ECC_CD
        ) FM_ECC_CD,
        (SELECT
            #if (${fmtoat} == '1') 
            	#if (${totypeby} == 'R') 
            		RCC_CD
            	#elseif (${totypeby} == 'C') 
            		CNT_CD
            	#elseif (${totypeby} == 'L') 
            		LCC_CD
            	#else
            		ECC_CD
            	#end
            #else 
            	#if (${attypeby} == 'R') 
            		RCC_CD
            	#elseif (${attypeby} == 'C') 
            		CNT_CD
            	#elseif (${attypeby} == 'L') 
            		LCC_CD
            	#else
            		ECC_CD
            	#end
            #end
            FROM EQR_ECC_MST 
            WHERE A.TO_ECC_CD = ECC_CD
        ) TO_ECC_CD,
        A.CNTR_TPSZ_CD,
        PLN_MON,
        MAX(CNTR_VOL_QTY)CNTR_VOL_QTY,
        DMST_RTO,
        A.PLN_YRWK ,
        A.SCNR_ID,
        DECODE(A.CRE_DT, A.UPD_DT, 'N', 'Y') TIMEGAP
    FROM
        EQR_SCNR_DMST A,
        EQR_WK_PRD B,
        #if (${fmtoat} == '1') 
        	(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
        	#if ($arrFmEccCd.size() > 0) 
        		#if (${fmtype} == 'R') 
        			AND RCC_CD
        		#elseif (${fmtype} == 'L') 
        			AND LCC_CD
        		#elseif (${fmtype} == 'E') 
        			AND ECC_CD
        		#end
        		IN(
          		#foreach( $key in ${arrFmEccCd}) 
            		#if($velocityCount < $arrFmEccCd.size())
            			'$key',
            		#else 
            			'$key'
            		#end
          		#end
        		)) C,
        	#else 
        		) C,
        	#end
        	(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
        	#if ($arrToEccCd.size() > 0) 
        		#if (${totype} == 'R') 
        			AND RCC_CD
        		#elseif (${totype} == 'L') 
        			AND LCC_CD
        		#elseif (${totype} == 'E') 
        			AND ECC_CD
        		#end
        		IN(
          		#foreach( $key in ${arrToEccCd}) 
            		#if($velocityCount < $arrToEccCd.size())
            			'$key',
            		#else 
            			'$key'
            		#end
          		#end
        		)) D,
        	#else
        		) D,
        	#end
        #else 
        	#if (${attype} != '' && $arrAtEccCd.size() > 0) 
        		(SELECT ECC_CD FROM EQR_ECC_MST WHERE 1 = 1
        		#if (${attype} == 'R') 
        			AND RCC_CD
        		#elseif (${attype} == 'L') 
        			AND LCC_CD
        		#elseif (${attype} == 'E') 
        			AND ECC_CD
        		#end
        		IN(
          		#foreach( $key in ${arrAtEccCd}) 
            		#if($velocityCount < $arrAtEccCd.size())
            			'$key',
            		#else 
            			'$key'
            		#end
          		#end
        		)) C,
        	#end
        #end
        EQR_DMST_PERF E
    WHERE
        A.PLN_YRWK = B.PLN_YR || B.PLN_WK
        AND A.FM_ECC_CD = E.FM_ECC_CD(+)
        AND A.TO_ECC_CD = E.TO_ECC_CD(+)
        AND A.CNTR_TPSZ_CD = E.CNTR_TPSZ_CD(+)
        #if (${fmtoat} == '1') 
        	AND A.FM_ECC_CD = C.ECC_CD AND A.TO_ECC_CD = D.ECC_CD
        #else
        	#if (${attype} != '' && $arrAtEccCd.size() > 0) 
        		AND (A.FM_ECC_CD = C.ECC_CD OR A.TO_ECC_CD = C.ECC_CD)
        	#end
        #end
        AND A.PLN_YRWK BETWEEN @[fmPlnYrwk] AND @[toPlnYrwk]
        AND A.SCNR_ID = @[scnr_id]
        #if ($arrTpszcd.size() > 0) 
          AND A.CNTR_TPSZ_CD IN(
          #foreach( $key in ${arrTpszcd})
            #if($velocityCount < $arrTpszcd.size())
            '$key',
            #else 
            '$key'
            #end
          #end
          )
        #end
    GROUP BY
        A.FM_ECC_CD,
        A.TO_ECC_CD,
        A.CNTR_TPSZ_CD,
        PLN_MON,
        PLN_YRWK,
        DMST_RTO,
        A.SCNR_ID,
        A.CRE_DT,
        A.UPD_DT
) E
GROUP BY E.FM_ECC_CD, E.TO_ECC_CD, CNTR_TPSZ_CD
ORDER BY E.FM_ECC_CD, E.TO_ECC_CD, CNTR_TPSZ_CD			]]></sql>
			<params>
				<param name="fmPlnYrwk" type="12" value="" out="N"/>
				<param name="toPlnYrwk" type="12" value="" out="N"/>
				<param name="scnr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
