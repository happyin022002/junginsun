/*=========================================================
*Copyright(c) 2017 CyberLogitec
*@FileName : InvoiceIssueCollectionMgtDBDAOSearchIssuedInvoiceListRSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2017.11.06
*@LastModifier : 
*@LastVersion : 1.0
* 2017.11.06 
* 1.0 Creation
=========================================================*/
package com.hanjin.apps.alps.ees.dmt.dmtinvoicemgt.invoiceissuecollectionmgt.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.hanjin.framework.support.db.ISQLTemplate;

/**
 *
 * @author 
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class InvoiceIssueCollectionMgtDBDAOSearchIssuedInvoiceListRSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * Issued Invoice Inquiry - By Booking, By Container 
	  * </pre>
	  */
	public InvoiceIssueCollectionMgtDBDAOSearchIssuedInvoiceListRSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("s_issue_fm",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("s_issue_to",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("s_rfa_no",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("s_taa_no",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("s_sc_no",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("s_cust_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("session_rhq_ofc_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("s_inv_over_fm",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("s_issue_usr_id",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("s_inv_over_to",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.hanjin.apps.alps.ees.dmt.dmtinvoicemgt.invoiceissuecollectionmgt.integration").append("\n"); 
		query.append("FileName : InvoiceIssueCollectionMgtDBDAOSearchIssuedInvoiceListRSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("WITH INV_DATA AS (" ).append("\n"); 
		query.append("#if(${s_group_by} == '1')" ).append("\n"); 
		query.append("	SELECT  DISTINCT A.DMDT_INV_NO" ).append("\n"); 
		query.append("		   ,A.INV_PRT_FLG" ).append("\n"); 
		query.append("		   ,A.DMDT_AR_IF_CD" ).append("\n"); 
		query.append("		   ,A.DMDT_INV_STS_CD" ).append("\n"); 
		query.append("		   ,A.DMDT_TRF_CD" ).append("\n"); 
		query.append("		   ,A.BKG_NO" ).append("\n"); 
		query.append("		   ,A.BL_NO" ).append("\n"); 
		query.append("		   ,A.SC_NO" ).append("\n"); 
		query.append("		   ,A.RFA_NO " ).append("\n"); 
		query.append("		   ,A.TAA_NO" ).append("\n"); 
		query.append("		   ,A.CHG_CURR_CD" ).append("\n"); 
		query.append("		   ,A.ORG_CHG_AMT" ).append("\n"); 
		query.append("		   ,A.DMDT_EXPT_AMT" ).append("\n"); 
		query.append("		   ,A.DC_AMT" ).append("\n"); 
		query.append("		   ,A.BIL_AMT" ).append("\n"); 
		query.append("		   ,A.INV_CURR_CD" ).append("\n"); 
		query.append("		   ,A.INV_CHG_AMT" ).append("\n"); 
		query.append("           ,CASE (SELECT SUBSTR(LOC_CD, 0, 2) FROM MDM_ORGANIZATION WHERE OFC_CD = A.CRE_OFC_CD)" ).append("\n"); 
		query.append("				WHEN 'IN' THEN " ).append("\n"); 
		query.append("					CASE " ).append("\n"); 
		query.append("						WHEN A.CRE_DT >= (SELECT TO_DATE(ATTR_CTNT1, 'YYYYMMDDHH24MI') FROM DMT_HRD_CDG_CTNT WHERE HRD_CDG_ID = 'IDA_TAX_APPL_DT') THEN" ).append("\n"); 
		query.append("							NVL(IDA_CGST_AMT, 0) + NVL(IDA_SGST_AMT, 0) + NVL(IDA_IGST_AMT, 0) + NVL(IDA_UGST_AMT, 0)" ).append("\n"); 
		query.append("						ELSE" ).append("\n"); 
		query.append("							A.TAX_AMT + NVL(A.IDA_EDU_TAX, 0) + NVL(A.IDA_HIGH_EDU_TAX, 0) + NVL(A.IDA_LOCL_TAX, 0) + NVL(A.IDA_N2ND_LOCL_TAX, 0)" ).append("\n"); 
		query.append("					END" ).append("\n"); 
		query.append("                ELSE " ).append("\n"); 
		query.append("					A.TAX_AMT" ).append("\n"); 
		query.append("            END AS TAX_AMT" ).append("\n"); 
		query.append("		   ,A.INV_AMT" ).append("\n"); 
		query.append("		   ,DECODE(SUBSTR(A.DMDT_TRF_CD,3,1), 'I', A.POD_CD, A.POL_CD) 	AS PORT" ).append("\n"); 
		query.append("		   ,TO_CHAR(A.CRE_DT,'YYYY-MM-DD') 								AS CRE_DT" ).append("\n"); 
		query.append("		   ,A.CRE_OFC_CD" ).append("\n"); 
		query.append("		   ,A.CRE_USR_ID 												AS ISSUE_ID" ).append("\n"); 
		query.append("		   ,(SELECT USR_NM FROM COM_USER WHERE USR_ID = A.CRE_USR_ID) 	AS ISSUE_NM" ).append("\n"); 
		query.append("		   ,DECODE(A.DMDT_AR_IF_CD, 'Y', A.AR_IF_NO, '') 				AS AR_IF_NO" ).append("\n"); 
		query.append("		   ,TO_CHAR(A.AR_IF_DT, 'YYYY-MM-DD') 							AS AR_IF_DT" ).append("\n"); 
		query.append("		   ,A.AR_IF_OFC_CD" ).append("\n"); 
		query.append("		   ,A.AR_IF_USR_ID" ).append("\n"); 
		query.append("		   ,(SELECT USR_NM FROM COM_USER WHERE USR_ID = A.AR_IF_USR_ID) AS AR_IF_USR_NM" ).append("\n"); 
		query.append("		   ,DECODE(NVL(A.DMDT_AR_IF_CD,'N')" ).append("\n"); 
		query.append("				,'Y'" ).append("\n"); 
		query.append("				,(TO_DATE(TO_CHAR(A.AR_IF_DT, 'YYYYMMDD'),'YYYYMMDD') - TO_DATE(TO_CHAR(A.CRE_DT,'YYYYMMDD'),'YYYYMMDD'))" ).append("\n"); 
		query.append("				,(TO_DATE(TO_CHAR(NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(A.CRE_OFC_CD),SYSDATE),'YYYYMMDD'),'YYYYMMDD') - TO_DATE(TO_CHAR(A.CRE_DT,'YYYYMMDD'),'YYYYMMDD'))" ).append("\n"); 
		query.append("			) 															AS INV_OVER" ).append("\n"); 
		query.append("		   ,DECODE(A.ACT_PAYR_CNT_CD, '00', NULL ,A.ACT_PAYR_CNT_CD) || DECODE(LPAD(A.ACT_PAYR_SEQ, 6,'0'), '000000', NULL, LPAD(A.ACT_PAYR_SEQ, 6,'0')) AS ACT_PAYR_CD" ).append("\n"); 
		query.append("		   ,CASE " ).append("\n"); 
		query.append("				WHEN A.ACT_PAYR_CNT_CD = '00' THEN " ).append("\n"); 
		query.append("					(" ).append("\n"); 
		query.append("						SELECT  VNDR_LGL_ENG_NM " ).append("\n"); 
		query.append("						  FROM  MDM_VENDOR " ).append("\n"); 
		query.append("						 WHERE  VNDR_SEQ = A.ACT_PAYR_SEQ" ).append("\n"); 
		query.append("					)" ).append("\n"); 
		query.append("	            ELSE " ).append("\n"); 
		query.append("					(" ).append("\n"); 
		query.append("					" ).append("\n"); 
		query.append("						SELECT  CUST_LGL_ENG_NM " ).append("\n"); 
		query.append("						  FROM  MDM_CUSTOMER " ).append("\n"); 
		query.append("						 WHERE  CUST_CNT_CD = A.ACT_PAYR_CNT_CD " ).append("\n"); 
		query.append("						   AND  CUST_SEQ = A.ACT_PAYR_SEQ" ).append("\n"); 
		query.append("					 )" ).append("\n"); 
		query.append("	        END 														AS ACT_PAYR_NM" ).append("\n"); 
		query.append("		   ,CASE " ).append("\n"); 
		query.append("				WHEN A.ACT_PAYR_CNT_CD = '00' THEN " ).append("\n"); 
		query.append("					(" ).append("\n"); 
		query.append("						SELECT  DELT_FLG " ).append("\n"); 
		query.append("						  FROM  MDM_VENDOR " ).append("\n"); 
		query.append("						 WHERE  VNDR_SEQ = A.ACT_PAYR_SEQ" ).append("\n"); 
		query.append("					)" ).append("\n"); 
		query.append("				ELSE " ).append("\n"); 
		query.append("					(" ).append("\n"); 
		query.append("						SELECT  DELT_FLG " ).append("\n"); 
		query.append("						  FROM  MDM_CUSTOMER " ).append("\n"); 
		query.append("						 WHERE  CUST_CNT_CD = A.ACT_PAYR_CNT_CD " ).append("\n"); 
		query.append("						   AND CUST_SEQ = A.ACT_PAYR_SEQ" ).append("\n"); 
		query.append("					)" ).append("\n"); 
		query.append("			END 														AS ACT_DELT_FLG" ).append("\n"); 
		query.append("		   ,A.CR_INV_NO		   " ).append("\n"); 
		query.append("		   ,CASE " ).append("\n"); 
		query.append("				WHEN C.RFA_NO IS NOT NULL AND SUBSTR(C.RFA_NO, 1, 3) != 'DUM' THEN " ).append("\n"); 
		query.append("					(" ).append("\n"); 
		query.append("						SELECT  PROP_OFC_CD" ).append("\n"); 
		query.append("						  FROM  PRI_RP_HDR 	HDR" ).append("\n"); 
		query.append("							   ,PRI_RP_MN 	MN" ).append("\n"); 
		query.append("						 WHERE  1 = 1" ).append("\n"); 
		query.append("						   AND  HDR.RFA_NO  = A.RFA_NO" ).append("\n"); 
		query.append("						   AND  HDR.PROP_NO = MN.PROP_NO" ).append("\n"); 
		query.append("						   AND  ROWNUM      = 1" ).append("\n"); 
		query.append("					) " ).append("\n"); 
		query.append("				WHEN C.SC_NO IS NOT NULL AND SUBSTR(C.SC_NO, 1, 3) != 'DUM' THEN " ).append("\n"); 
		query.append("					(" ).append("\n"); 
		query.append("						SELECT  PROP_OFC_CD" ).append("\n"); 
		query.append("						  FROM  PRI_SP_HDR 	HDR" ).append("\n"); 
		query.append("							   ,PRI_SP_MN 	MN" ).append("\n"); 
		query.append("						 WHERE  1 = 1" ).append("\n"); 
		query.append("						   AND  A.SC_NO     = HDR.SC_NO" ).append("\n"); 
		query.append("						   AND  HDR.PROP_NO = MN.PROP_NO" ).append("\n"); 
		query.append("						   AND  ROWNUM      = 1" ).append("\n"); 
		query.append("					)" ).append("\n"); 
		query.append("				WHEN C.TAA_NO IS NOT NULL AND SUBSTR(C.TAA_NO, 1, 3) != 'DUM' THEN " ).append("\n"); 
		query.append("					(" ).append("\n"); 
		query.append("						SELECT  RESPB_SLS_OFC_CD" ).append("\n"); 
		query.append("						  FROM  PRI_TAA_HDR HDR" ).append("\n"); 
		query.append("							   ,PRI_TAA_MN 	MN" ).append("\n"); 
		query.append("						 WHERE  HDR.TAA_PROP_NO = MN.TAA_PROP_NO" ).append("\n"); 
		query.append("						   AND  HDR.TAA_NO    	= A.TAA_NO" ).append("\n"); 
		query.append("						   AND  ROWNUM          = 1" ).append("\n"); 
		query.append("					)" ).append("\n"); 
		query.append("				ELSE " ).append("\n"); 
		query.append("					' ' " ).append("\n"); 
		query.append("			END															AS CTRT_OFC" ).append("\n"); 
		query.append("		   ,REPLACE(REPLACE(A.INV_RMK,'@*',CHR(10)),CHR(10), '-') 		AS INV_RMK" ).append("\n"); 
		query.append("           ,(" ).append("\n"); 
		query.append("				SELECT  AR_HD_QTR_OFC_CD " ).append("\n"); 
		query.append("				  FROM  MDM_ORGANIZATION " ).append("\n"); 
		query.append("				 WHERE  OFC_CD = A.CRE_OFC_CD" ).append("\n"); 
		query.append("			) 															AS RHQ_OFC_CD" ).append("\n"); 
		query.append("           ,A.POR_CD" ).append("\n"); 
		query.append("           ,A.POL_CD" ).append("\n"); 
		query.append("           ,A.POD_CD" ).append("\n"); 
		query.append("           ,A.DEL_CD" ).append("\n"); 
		query.append("           ,A.CRE_DT 													AS S_CRE_DT" ).append("\n"); 
		query.append("           ,CASE " ).append("\n"); 
		query.append("                WHEN DMDT_INV_STS_CD = 'I' AND DMDT_AR_IF_CD = 'Y' THEN " ).append("\n"); 
		query.append("					'Y'" ).append("\n"); 
		query.append("                WHEN DMDT_INV_STS_CD = 'I' AND DMDT_AR_IF_CD = 'N' THEN " ).append("\n"); 
		query.append("					'N'" ).append("\n"); 
		query.append("                WHEN DMDT_INV_STS_CD IN ('C', 'X') THEN " ).append("\n"); 
		query.append("					'Y'" ).append("\n"); 
		query.append("                ELSE " ).append("\n"); 
		query.append("					'N' " ).append("\n"); 
		query.append("			END 														AS V_COLLECTED" ).append("\n"); 
		query.append("           ,INV_XCH_RT" ).append("\n"); 
		query.append("		   ,(" ).append("\n"); 
		query.append("				SELECT  CASE " ).append("\n"); 
		query.append("							WHEN A2.CNT_CD = 'IN' AND A.CRE_DT >= TO_DATE(A3.ATTR_CTNT1, 'YYYYMMDDHH24MI') THEN " ).append("\n"); 
		query.append("								SUBSTR(A.DMDT_INV_NO, 4, 1)" ).append("\n"); 
		query.append("							ELSE" ).append("\n"); 
		query.append("								SUBSTR(A.DMDT_INV_NO, 3, 1)" ).append("\n"); 
		query.append("						END" ).append("\n"); 
		query.append("						" ).append("\n"); 
		query.append("				  FROM  MDM_ORGANIZATION  	A1" ).append("\n"); 
		query.append("					   ,MDM_LOCATION      	A2" ).append("\n"); 
		query.append("					   ,DMT_HRD_CDG_CTNT	A3" ).append("\n"); 
		query.append("					   " ).append("\n"); 
		query.append("				 WHERE  A1.OFC_CD     = A.CRE_OFC_CD" ).append("\n"); 
		query.append("				   AND  A1.LOC_CD     = A2.LOC_CD" ).append("\n"); 
		query.append("				   AND  A3.HRD_CDG_ID = 'IDA_TAX_APPL_DT'" ).append("\n"); 
		query.append("			 ) AS DMDT_INV_TP_CD" ).append("\n"); 
		query.append("			 " ).append("\n"); 
		query.append("	  FROM  DMT_INV_MN  		A" ).append("\n"); 
		query.append("	       ,DMT_INV_DTL 		B" ).append("\n"); 
		query.append("		   ,BKG_BOOKING 		C" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	 WHERE  A.DMDT_INV_NO   = B.DMDT_INV_NO(+)" ).append("\n"); 
		query.append("	   AND  A.CRE_OFC_CD    = B.CRE_OFC_CD(+)" ).append("\n"); 
		query.append("	   AND  A.BKG_NO        = C.BKG_NO(+)" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	## Tariff Type" ).append("\n"); 
		query.append("	   #if (${s_dmdt_trf_cd} != '')" ).append("\n"); 
		query.append("       AND  A.DMDT_TRF_CD IN (" ).append("\n"); 
		query.append("			#foreach($dmdt_trf_no in ${dmdt_trf_cd_list}) " ).append("\n"); 
		query.append("			#if($velocityCount < $dmdt_trf_cd_list.size()) " ).append("\n"); 
		query.append("		           '$dmdt_trf_no', " ).append("\n"); 
		query.append("			#else " ).append("\n"); 
		query.append("		           '$dmdt_trf_no' " ).append("\n"); 
		query.append("			#end " ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	" ).append("\n"); 
		query.append("	## AR/IF = (N, Y, H, H and LIT)" ).append("\n"); 
		query.append("	   #if (${s_dmdt_ar_if_cd} != '')" ).append("\n"); 
		query.append("       AND  ( 1 != 1 " ).append("\n"); 
		query.append("				#if (${uncollected} == 'N')" ).append("\n"); 
		query.append("				OR (DMDT_INV_STS_CD  IN ('I', 'X', 'C') AND DMDT_AR_IF_CD = 'N')								--// AUTO I/F OFFICE 가 아닌 경우" ).append("\n"); 
		query.append("				#end " ).append("\n"); 
		query.append("				#if (${collected} == 'Y')" ).append("\n"); 
		query.append("				OR (DMDT_AR_IF_CD = 'Y')" ).append("\n"); 
		query.append("				#end " ).append("\n"); 
		query.append("				#if (${hold} == 'H')" ).append("\n"); 
		query.append("				OR A.DMDT_AR_IF_CD = 'H'" ).append("\n"); 
		query.append("				#end " ).append("\n"); 
		query.append("				#if (${hold_Litigation} == 'L')" ).append("\n"); 
		query.append("				OR (A.DMDT_AR_IF_CD = 'H' AND A.INV_HLD_RSN_CD = 'LIT')" ).append("\n"); 
		query.append("				#end " ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("	   #end " ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	## INVOICE STATUS" ).append("\n"); 
		query.append("       #if (${s_dmdt_inv_sts_cd} != '')" ).append("\n"); 
		query.append("       AND  A.DMDT_INV_STS_CD IN (" ).append("\n"); 
		query.append("			#foreach($dmdt_inv_sts_no in ${dmdt_inv_sts_list}) " ).append("\n"); 
		query.append("			#if($velocityCount < $dmdt_inv_sts_list.size()) " ).append("\n"); 
		query.append("		           '$dmdt_inv_sts_no', " ).append("\n"); 
		query.append("			#else " ).append("\n"); 
		query.append("		           '$dmdt_inv_sts_no' " ).append("\n"); 
		query.append("			#end " ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	## OFC radio box" ).append("\n"); 
		query.append("       #if (${s_inv_check} == 'N')" ).append("\n"); 
		query.append("       AND  A.CRE_OFC_CD IN (" ).append("\n"); 
		query.append("			#foreach($s_issue_ofc in ${ofc_cd_list} )" ).append("\n"); 
		query.append("				#if($velocityCount < $ofc_cd_list.size()) '$s_issue_ofc', #else '$s_issue_ofc' #end" ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("			" ).append("\n"); 
		query.append("       AND  A.CRE_DT >= TO_DATE(@[s_issue_fm]||'000000','YYYYMMDDHH24MISS')" ).append("\n"); 
		query.append("       AND  A.CRE_DT <= TO_DATE(@[s_issue_to]||'235959','YYYYMMDDHH24MISS')" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	## INV radio box" ).append("\n"); 
		query.append("    #if (${s_inv_check} == 'Y')" ).append("\n"); 
		query.append("       #if (${session_rhq_ofc_cd} != 'SELHO')" ).append("\n"); 
		query.append("       AND  A.CRE_OFC_CD IN " ).append("\n"); 
		query.append("			( " ).append("\n"); 
		query.append("				SELECT  OFC_CD " ).append("\n"); 
		query.append("				  FROM  MDM_ORGANIZATION " ).append("\n"); 
		query.append("				 WHERE  AR_HD_QTR_OFC_CD = @[session_rhq_ofc_cd]" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	   #if (${s_invoice_no} != '')	" ).append("\n"); 
		query.append("       AND  A.DMDT_INV_NO IN " ).append("\n"); 
		query.append("			(" ).append("\n"); 
		query.append("			#foreach( $invoice_cd in ${invoice_no_list} )" ).append("\n"); 
		query.append("			#if($velocityCount < $invoice_no_list.size()) " ).append("\n"); 
		query.append("				'$invoice_cd', " ).append("\n"); 
		query.append("			#else " ).append("\n"); 
		query.append("				'$invoice_cd' " ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	   #if (${s_bkg_no} != '')	" ).append("\n"); 
		query.append("	   AND  A.BKG_NO IN " ).append("\n"); 
		query.append("			(" ).append("\n"); 
		query.append("			#foreach( $bkg_cd in ${bkg_no_list} )" ).append("\n"); 
		query.append("			#if($velocityCount < $bkg_no_list.size()) " ).append("\n"); 
		query.append("				'$bkg_cd', " ).append("\n"); 
		query.append("			#else " ).append("\n"); 
		query.append("				'$bkg_cd' " ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	   #if (${s_bl_no} != '')	" ).append("\n"); 
		query.append("	   AND  A.BL_NO IN " ).append("\n"); 
		query.append("			(" ).append("\n"); 
		query.append("			#foreach( $bl_cd in ${bl_no_list} )" ).append("\n"); 
		query.append("			#if($velocityCount < $bl_no_list.size()) " ).append("\n"); 
		query.append("				'$bl_cd', " ).append("\n"); 
		query.append("			#else " ).append("\n"); 
		query.append("				'$bl_cd' " ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("	" ).append("\n"); 
		query.append("	## ISSUE ID" ).append("\n"); 
		query.append("	   #if(${s_issue_usr_id} != '')" ).append("\n"); 
		query.append("	   AND  A.CRE_USR_ID = @[s_issue_usr_id]" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	## PAYER" ).append("\n"); 
		query.append("	  #if(${s_payer_cd} != '')" ).append("\n"); 
		query.append("	   #if (${s_cust_gubun} == '1')" ).append("\n"); 
		query.append("	   AND  LPAD(A.ACT_PAYR_SEQ,6,'0') = LPAD(@[s_cust_cd],6,'0')" ).append("\n"); 
		query.append("	   #elseif (${s_cust_gubun} == '2') " ).append("\n"); 
		query.append("	   AND  A.ACT_PAYR_CNT_CD          = SUBSTR(@[s_cust_cd],1,2)" ).append("\n"); 
		query.append("	   AND  LPAD(A.ACT_PAYR_SEQ,6,'0') = SUBSTR(@[s_cust_cd],3)" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	  #end" ).append("\n"); 
		query.append("	" ).append("\n"); 
		query.append("	## SC NO" ).append("\n"); 
		query.append("	   #if(${s_sc_no} != '')" ).append("\n"); 
		query.append("	   AND  A.SC_NO = @[s_sc_no]" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	## RFA NO" ).append("\n"); 
		query.append("	   #if(${s_rfa_no} != '')" ).append("\n"); 
		query.append("	   AND  A.RFA_NO = @[s_rfa_no]" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	## TAA NO" ).append("\n"); 
		query.append("	   #if(${s_taa_no} != '')" ).append("\n"); 
		query.append("	   AND C.TAA_NO = @[s_taa_no]" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	ORDER BY A.DMDT_INV_NO" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#elseif(${s_group_by} == '2')" ).append("\n"); 
		query.append("	SELECT  A.DMDT_INV_NO" ).append("\n"); 
		query.append("		   ,A.INV_PRT_FLG" ).append("\n"); 
		query.append("		   ,A.DMDT_AR_IF_CD" ).append("\n"); 
		query.append("		   ,A.DMDT_INV_STS_CD" ).append("\n"); 
		query.append("		   ,A.DMDT_TRF_CD" ).append("\n"); 
		query.append("		   ,A.BKG_NO" ).append("\n"); 
		query.append("		   ,A.BL_NO" ).append("\n"); 
		query.append("		   --// Incl. CNTR Detail 을 선택하지 않은 경우 CNTR No. 없어서 아래 JOIN 시 데이터를 찾지 못하는 문제점을 해결하기 위해서 사용함." ).append("\n"); 
		query.append("           ,CASE" ).append("\n"); 
		query.append("				WHEN MNL_INP_FLG = 'Y' AND MNL_INV_SND_FLG = 'N' THEN" ).append("\n"); 
		query.append("					'0000000000' " ).append("\n"); 
		query.append("				ELSE" ).append("\n"); 
		query.append("					B.CNTR_NO " ).append("\n"); 
		query.append("			END						AS CNTR_NO" ).append("\n"); 
		query.append("		   ,B.FT_DYS" ).append("\n"); 
		query.append("		   ,A.SC_NO" ).append("\n"); 
		query.append("		   ,A.RFA_NO" ).append("\n"); 
		query.append("		   ,A.TAA_NO" ).append("\n"); 
		query.append("		   ,A.CHG_CURR_CD" ).append("\n"); 
		query.append("		   ,B.ORG_CHG_AMT" ).append("\n"); 
		query.append("		   ,B.SC_RFA_EXPT_AMT 		AS DMDT_EXPT_AMT" ).append("\n"); 
		query.append("		   ,B.AFT_EXPT_DC_AMT 		AS DC_AMT" ).append("\n"); 
		query.append("		   ,B.BIL_AMT" ).append("\n"); 
		query.append("		   ,A.INV_CURR_CD" ).append("\n"); 
		query.append("           ,CASE " ).append("\n"); 
		query.append("				WHEN SUBSTR(A.DMDT_INV_NO, 3, 1) = 'M' THEN		--// Manual Invoice 인 경우" ).append("\n"); 
		query.append("					CASE " ).append("\n"); 
		query.append("						WHEN MNL_INV_SND_FLG = 'Y' THEN   		--// Incl. CNTR Detail 가 'Y' 인 경우" ).append("\n"); 
		query.append("							( " ).append("\n"); 
		query.append("								SELECT  SUM(RT_OVR_CHG_AMT) " ).append("\n"); 
		query.append("								  FROM  DMT_INV_RT " ).append("\n"); 
		query.append("								 WHERE  DMDT_INV_NO = A.DMDT_INV_NO " ).append("\n"); 
		query.append("								   AND  INV_DTL_SEQ = B.INV_DTL_SEQ " ).append("\n"); 
		query.append("							)" ).append("\n"); 
		query.append("						ELSE							--// Incl. CNTR Detail 가 'N' 인 경우" ).append("\n"); 
		query.append("							A.INV_CHG_AMT" ).append("\n"); 
		query.append("					END" ).append("\n"); 
		query.append("				ELSE									--// Manual Invoice 가 아닌 경우" ).append("\n"); 
		query.append("					B.CNTR_INV_AMT" ).append("\n"); 
		query.append("            END 					AS INV_CHG_AMT" ).append("\n"); 
		query.append("           ,CASE " ).append("\n"); 
		query.append("				WHEN A.TAX_RTO = 0 THEN 0" ).append("\n"); 
		query.append("				WHEN SUBSTR(A.DMDT_INV_NO, 3, 1) = 'M' THEN 	--// Manual Invoice 인 경우" ).append("\n"); 
		query.append("					CASE " ).append("\n"); 
		query.append("						WHEN MNL_INV_SND_FLG = 'Y' THEN		    --// Incl. CNTR Detail 가 'Y' 인 경우" ).append("\n"); 
		query.append("			            	CASE " ).append("\n"); 
		query.append("								WHEN A.INV_CURR_CD IN ('KRW', 'JPY', 'BEF', 'DJF', 'ESP', 'GRD', 'ITL', 'LAK', 'MGF', 'MRO', 'MXP', 'PTE', 'SDD', 'MXN') THEN" ).append("\n"); 
		query.append("			                        TRUNC(( SELECT SUM(RT_OVR_CHG_AMT) FROM DMT_INV_RT WHERE DMDT_INV_NO = B.DMDT_INV_NO AND INV_DTL_SEQ = B.INV_DTL_SEQ ) / A.TAX_RTO, 0)" ).append("\n"); 
		query.append("					            WHEN A.INV_CURR_CD IN ('TWD', 'IDR', 'VND') THEN" ).append("\n"); 
		query.append("						            ROUND(( SELECT SUM(RT_OVR_CHG_AMT) FROM DMT_INV_RT WHERE DMDT_INV_NO = B.DMDT_INV_NO AND INV_DTL_SEQ = B.INV_DTL_SEQ ) / A.TAX_RTO, 0)" ).append("\n"); 
		query.append("					            ELSE" ).append("\n"); 
		query.append("                    				ROUND(( SELECT SUM(RT_OVR_CHG_AMT) FROM DMT_INV_RT WHERE DMDT_INV_NO = B.DMDT_INV_NO AND INV_DTL_SEQ = B.INV_DTL_SEQ ) / A.TAX_RTO, 2)" ).append("\n"); 
		query.append("							END" ).append("\n"); 
		query.append("						ELSE							--// Incl. CNTR Detail 가 'N' 인 경우" ).append("\n"); 
		query.append("							A.TAX_AMT" ).append("\n"); 
		query.append("					END" ).append("\n"); 
		query.append("				ELSE 									--// Manual Invoice 가 아닌 경우" ).append("\n"); 
		query.append("					B.TAX_AMT " ).append("\n"); 
		query.append("			END AS TAX_AMT" ).append("\n"); 
		query.append("           ,CASE " ).append("\n"); 
		query.append("				WHEN SUBSTR(A.DMDT_INV_NO, 3, 1) = 'M' THEN  	--// Manual Invoice 인 경우" ).append("\n"); 
		query.append("					CASE " ).append("\n"); 
		query.append("						WHEN MNL_INV_SND_FLG = 'Y' THEN	   		--// Incl. CNTR Detail 가 'Y' 인 경우" ).append("\n"); 
		query.append("							( " ).append("\n"); 
		query.append("								SELECT  SUM(RT_OVR_CHG_AMT) " ).append("\n"); 
		query.append("								  FROM  DMT_INV_RT " ).append("\n"); 
		query.append("								 WHERE  DMDT_INV_NO = B.DMDT_INV_NO " ).append("\n"); 
		query.append("								   AND  INV_DTL_SEQ = B.INV_DTL_SEQ" ).append("\n"); 
		query.append("							)" ).append("\n"); 
		query.append("						ELSE						--// Incl. CNTR Detail 가 'N' 인 경우" ).append("\n"); 
		query.append("							A.INV_CHG_AMT" ).append("\n"); 
		query.append("					END" ).append("\n"); 
		query.append("                ELSE 									--// Manual Invoice 가 아닌 경우" ).append("\n"); 
		query.append("					B.CNTR_INV_AMT" ).append("\n"); 
		query.append("			END" ).append("\n"); 
		query.append("            +" ).append("\n"); 
		query.append("            CASE " ).append("\n"); 
		query.append("				WHEN NVL(A.TAX_RTO, 0) = 0 THEN" ).append("\n"); 
		query.append("					0" ).append("\n"); 
		query.append("				WHEN SUBSTR(A.DMDT_INV_NO,3,1) = 'M' THEN		--// Manual Invoice 인 경우" ).append("\n"); 
		query.append("					CASE " ).append("\n"); 
		query.append("						WHEN MNL_INV_SND_FLG = 'Y' THEN    --// Incl. CNTR Detail 가 'Y' 인 경우" ).append("\n"); 
		query.append("			            	CASE " ).append("\n"); 
		query.append("								WHEN A.INV_CURR_CD IN ('KRW', 'JPY', 'BEF', 'DJF', 'ESP', 'GRD', 'ITL', 'LAK', 'MGF', 'MRO', 'MXP', 'PTE', 'SDD', 'MXN') THEN" ).append("\n"); 
		query.append("			                        TRUNC(( SELECT SUM(RT_OVR_CHG_AMT) FROM DMT_INV_RT WHERE DMDT_INV_NO = B.DMDT_INV_NO AND INV_DTL_SEQ = B.INV_DTL_SEQ ) / A.TAX_RTO, 0)" ).append("\n"); 
		query.append("			                    WHEN A.INV_CURR_CD IN ('TWD', 'IDR', 'VND') THEN" ).append("\n"); 
		query.append("						            ROUND(( SELECT SUM(RT_OVR_CHG_AMT) FROM DMT_INV_RT WHERE DMDT_INV_NO = B.DMDT_INV_NO AND INV_DTL_SEQ = B.INV_DTL_SEQ ) / A.TAX_RTO, 0)" ).append("\n"); 
		query.append("					            ELSE" ).append("\n"); 
		query.append("                    			    ROUND(( SELECT SUM(RT_OVR_CHG_AMT) FROM DMT_INV_RT WHERE DMDT_INV_NO = B.DMDT_INV_NO AND INV_DTL_SEQ = B.INV_DTL_SEQ ) / A.TAX_RTO, 2)" ).append("\n"); 
		query.append("			                END" ).append("\n"); 
		query.append("						ELSE						--// Incl. CNTR Detail 가 'N' 인 경우" ).append("\n"); 
		query.append("							A.TAX_AMT" ).append("\n"); 
		query.append("					END" ).append("\n"); 
		query.append("                ELSE 									--// Manual Invoice 가 아닌 경우" ).append("\n"); 
		query.append("					B.TAX_AMT " ).append("\n"); 
		query.append("			END AS INV_AMT" ).append("\n"); 
		query.append("		   ,DECODE(SUBSTR(A.DMDT_TRF_CD,3,1), 'I', A.POD_CD, A.POL_CD) 	AS PORT" ).append("\n"); 
		query.append("		   ,TO_CHAR(A.CRE_DT,'YYYY-MM-DD') 								AS CRE_DT" ).append("\n"); 
		query.append("		   ,A.CRE_OFC_CD" ).append("\n"); 
		query.append("		   ,A.CRE_USR_ID 												AS ISSUE_ID" ).append("\n"); 
		query.append("		   ,(SELECT USR_NM FROM COM_USER WHERE USR_ID = A.CRE_USR_ID) 	AS ISSUE_NM" ).append("\n"); 
		query.append("		   ,DECODE(A.DMDT_AR_IF_CD, 'Y', A.AR_IF_NO, '') 				AS AR_IF_NO" ).append("\n"); 
		query.append("		   ,TO_CHAR(A.AR_IF_DT, 'YYYY-MM-DD') 							AS AR_IF_DT" ).append("\n"); 
		query.append("		   ,A.AR_IF_OFC_CD" ).append("\n"); 
		query.append("		   ,A.AR_IF_USR_ID" ).append("\n"); 
		query.append("		   ,(SELECT USR_NM FROM COM_USER WHERE USR_ID = A.AR_IF_USR_ID) AS AR_IF_USR_NM" ).append("\n"); 
		query.append("		   ,DECODE(NVL(A.DMDT_AR_IF_CD,'N')" ).append("\n"); 
		query.append("				,'Y'" ).append("\n"); 
		query.append("				,(TO_DATE(TO_CHAR(A.AR_IF_DT, 'YYYYMMDD'),'YYYYMMDD') - TO_DATE(TO_CHAR(A.CRE_DT,'YYYYMMDD'),'YYYYMMDD'))" ).append("\n"); 
		query.append("				,(TO_DATE(TO_CHAR(NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(A.CRE_OFC_CD),SYSDATE),'YYYYMMDD'),'YYYYMMDD') - TO_DATE(TO_CHAR(A.CRE_DT,'YYYYMMDD'),'YYYYMMDD'))" ).append("\n"); 
		query.append("			) 															AS INV_OVER			" ).append("\n"); 
		query.append("		   ,DECODE(A.ACT_PAYR_CNT_CD, '00', NULL ,A.ACT_PAYR_CNT_CD) || DECODE(LPAD(A.ACT_PAYR_SEQ, 6,'0'), '000000', NULL, LPAD(A.ACT_PAYR_SEQ, 6,'0')) AS ACT_PAYR_CD" ).append("\n"); 
		query.append("		   ,CASE " ).append("\n"); 
		query.append("				WHEN A.ACT_PAYR_CNT_CD = '00' THEN " ).append("\n"); 
		query.append("					(" ).append("\n"); 
		query.append("						SELECT  VNDR_LGL_ENG_NM " ).append("\n"); 
		query.append("						  FROM  MDM_VENDOR " ).append("\n"); 
		query.append("						 WHERE  VNDR_SEQ = A.ACT_PAYR_SEQ" ).append("\n"); 
		query.append("					)" ).append("\n"); 
		query.append("	            ELSE " ).append("\n"); 
		query.append("					(" ).append("\n"); 
		query.append("					" ).append("\n"); 
		query.append("						SELECT  CUST_LGL_ENG_NM " ).append("\n"); 
		query.append("						  FROM  MDM_CUSTOMER " ).append("\n"); 
		query.append("						 WHERE  CUST_CNT_CD = A.ACT_PAYR_CNT_CD " ).append("\n"); 
		query.append("						   AND  CUST_SEQ = A.ACT_PAYR_SEQ" ).append("\n"); 
		query.append("					 )" ).append("\n"); 
		query.append("	        END 														AS ACT_PAYR_NM" ).append("\n"); 
		query.append("		   ,CASE " ).append("\n"); 
		query.append("				WHEN A.ACT_PAYR_CNT_CD = '00' THEN " ).append("\n"); 
		query.append("					(" ).append("\n"); 
		query.append("						SELECT  DELT_FLG " ).append("\n"); 
		query.append("						  FROM  MDM_VENDOR " ).append("\n"); 
		query.append("						 WHERE  VNDR_SEQ = A.ACT_PAYR_SEQ" ).append("\n"); 
		query.append("					)" ).append("\n"); 
		query.append("				ELSE " ).append("\n"); 
		query.append("					(" ).append("\n"); 
		query.append("						SELECT  DELT_FLG " ).append("\n"); 
		query.append("						  FROM  MDM_CUSTOMER " ).append("\n"); 
		query.append("						 WHERE  CUST_CNT_CD = A.ACT_PAYR_CNT_CD " ).append("\n"); 
		query.append("						   AND  CUST_SEQ = A.ACT_PAYR_SEQ" ).append("\n"); 
		query.append("					)" ).append("\n"); 
		query.append("			END 														AS ACT_DELT_FLG" ).append("\n"); 
		query.append("		   ,A.CR_INV_NO	" ).append("\n"); 
		query.append("		   ,CASE " ).append("\n"); 
		query.append("				WHEN C.RFA_NO IS NOT NULL AND SUBSTR(C.RFA_NO, 1, 3) != 'DUM' THEN " ).append("\n"); 
		query.append("					(" ).append("\n"); 
		query.append("						SELECT  PROP_OFC_CD" ).append("\n"); 
		query.append("						  FROM  PRI_RP_HDR 	HDR" ).append("\n"); 
		query.append("							   ,PRI_RP_MN 	MN" ).append("\n"); 
		query.append("						 WHERE  1 = 1" ).append("\n"); 
		query.append("						   AND  HDR.RFA_NO  = A.RFA_NO" ).append("\n"); 
		query.append("						   AND  HDR.PROP_NO = MN.PROP_NO" ).append("\n"); 
		query.append("						   AND  ROWNUM      = 1" ).append("\n"); 
		query.append("					) " ).append("\n"); 
		query.append("				WHEN C.SC_NO IS NOT NULL AND SUBSTR(C.SC_NO, 1, 3) != 'DUM' THEN " ).append("\n"); 
		query.append("					(" ).append("\n"); 
		query.append("						SELECT  PROP_OFC_CD" ).append("\n"); 
		query.append("						  FROM  PRI_SP_HDR 	HDR" ).append("\n"); 
		query.append("							   ,PRI_SP_MN 	MN" ).append("\n"); 
		query.append("						 WHERE  1 = 1" ).append("\n"); 
		query.append("						   AND  A.SC_NO     = HDR.SC_NO" ).append("\n"); 
		query.append("						   AND  HDR.PROP_NO = MN.PROP_NO" ).append("\n"); 
		query.append("						   AND  ROWNUM      = 1" ).append("\n"); 
		query.append("					)" ).append("\n"); 
		query.append("				WHEN C.TAA_NO IS NOT NULL AND SUBSTR(C.TAA_NO, 1, 3) != 'DUM' THEN " ).append("\n"); 
		query.append("					(" ).append("\n"); 
		query.append("						SELECT  RESPB_SLS_OFC_CD" ).append("\n"); 
		query.append("						  FROM  PRI_TAA_HDR HDR" ).append("\n"); 
		query.append("							   ,PRI_TAA_MN 	MN" ).append("\n"); 
		query.append("						 WHERE  HDR.TAA_PROP_NO = MN.TAA_PROP_NO" ).append("\n"); 
		query.append("						   AND  HDR.TAA_NO    	= A.TAA_NO" ).append("\n"); 
		query.append("						   AND  ROWNUM          = 1" ).append("\n"); 
		query.append("					)" ).append("\n"); 
		query.append("				ELSE " ).append("\n"); 
		query.append("					' ' " ).append("\n"); 
		query.append("			END															AS CTRT_OFC" ).append("\n"); 
		query.append("		   ,REPLACE(REPLACE(A.INV_RMK,'@*',CHR(10)),CHR(10), '-') 		AS INV_RMK" ).append("\n"); 
		query.append("           ,(" ).append("\n"); 
		query.append("				SELECT  AR_HD_QTR_OFC_CD " ).append("\n"); 
		query.append("				  FROM  MDM_ORGANIZATION " ).append("\n"); 
		query.append("				 WHERE  OFC_CD = A.CRE_OFC_CD" ).append("\n"); 
		query.append("			) 															AS RHQ_OFC_CD" ).append("\n"); 
		query.append("           ,A.POR_CD" ).append("\n"); 
		query.append("           ,A.POL_CD" ).append("\n"); 
		query.append("           ,A.POD_CD" ).append("\n"); 
		query.append("           ,A.DEL_CD" ).append("\n"); 
		query.append("           ,A.CRE_DT 													AS S_CRE_DT" ).append("\n"); 
		query.append("           ,CASE " ).append("\n"); 
		query.append("                WHEN DMDT_INV_STS_CD = 'I' AND DMDT_AR_IF_CD = 'Y' THEN " ).append("\n"); 
		query.append("					'Y'" ).append("\n"); 
		query.append("                WHEN DMDT_INV_STS_CD = 'I' AND DMDT_AR_IF_CD = 'N' THEN " ).append("\n"); 
		query.append("					'N'" ).append("\n"); 
		query.append("                WHEN DMDT_INV_STS_CD IN ('C', 'X') THEN " ).append("\n"); 
		query.append("					'Y'" ).append("\n"); 
		query.append("                ELSE " ).append("\n"); 
		query.append("					'N' " ).append("\n"); 
		query.append("			END 														AS V_COLLECTED" ).append("\n"); 
		query.append("           ,INV_XCH_RT" ).append("\n"); 
		query.append("           ,ROUND(B.CNTR_INV_AMT/DECODE(NVL(A.INV_CHG_AMT,1),0,1,NVL(A.INV_CHG_AMT,1)),2) AS BKG_CNTR_QTY" ).append("\n"); 
		query.append("           ,INV_DTL_SEQ		   " ).append("\n"); 
		query.append("		   ,(" ).append("\n"); 
		query.append("				SELECT  CASE " ).append("\n"); 
		query.append("							WHEN A2.CNT_CD = 'IN' AND A.CRE_DT >= TO_DATE(A3.ATTR_CTNT1, 'YYYYMMDDHH24MI') THEN " ).append("\n"); 
		query.append("								SUBSTR(A.DMDT_INV_NO, 4, 1)" ).append("\n"); 
		query.append("							ELSE" ).append("\n"); 
		query.append("								SUBSTR(A.DMDT_INV_NO, 3, 1)" ).append("\n"); 
		query.append("						END" ).append("\n"); 
		query.append("						" ).append("\n"); 
		query.append("				  FROM  MDM_ORGANIZATION  	A1" ).append("\n"); 
		query.append("					   ,MDM_LOCATION      	A2" ).append("\n"); 
		query.append("					   ,DMT_HRD_CDG_CTNT	A3" ).append("\n"); 
		query.append("					   " ).append("\n"); 
		query.append("				 WHERE  A1.OFC_CD     = A.CRE_OFC_CD" ).append("\n"); 
		query.append("				   AND  A1.LOC_CD     = A2.LOC_CD" ).append("\n"); 
		query.append("				   AND  A3.HRD_CDG_ID = 'IDA_TAX_APPL_DT'" ).append("\n"); 
		query.append("			) AS DMDT_INV_TP_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	  FROM  DMT_INV_MN  		A" ).append("\n"); 
		query.append("	       ,DMT_INV_DTL 		B" ).append("\n"); 
		query.append("		   ,BKG_BOOKING 		C" ).append("\n"); 
		query.append("		   " ).append("\n"); 
		query.append("	 WHERE  A.DMDT_INV_NO   = B.DMDT_INV_NO(+)" ).append("\n"); 
		query.append("	   AND  A.CRE_OFC_CD    = B.CRE_OFC_CD(+)" ).append("\n"); 
		query.append("	   AND  A.BKG_NO        = C.BKG_NO(+)" ).append("\n"); 
		query.append("	" ).append("\n"); 
		query.append("	## Tariff Type" ).append("\n"); 
		query.append("	   #if (${s_dmdt_trf_cd} != '')" ).append("\n"); 
		query.append("       AND  A.DMDT_TRF_CD IN (" ).append("\n"); 
		query.append("			#foreach($dmdt_trf_no in ${dmdt_trf_cd_list}) " ).append("\n"); 
		query.append("			#if($velocityCount < $dmdt_trf_cd_list.size()) " ).append("\n"); 
		query.append("		           '$dmdt_trf_no', " ).append("\n"); 
		query.append("			#else " ).append("\n"); 
		query.append("		           '$dmdt_trf_no' " ).append("\n"); 
		query.append("			#end " ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	## AR/IF = (N, Y, H, H and LIT)" ).append("\n"); 
		query.append("	   #if (${s_dmdt_ar_if_cd} != '')" ).append("\n"); 
		query.append("       AND  ( 1 != 1 " ).append("\n"); 
		query.append("				#if (${uncollected} == 'N')" ).append("\n"); 
		query.append("				OR (DMDT_INV_STS_CD  IN ('I', 'X', 'C') AND DMDT_AR_IF_CD = 'N')								--// AUTO I/F OFFICE 가 아닌 경우" ).append("\n"); 
		query.append("				#end " ).append("\n"); 
		query.append("				#if (${collected} == 'Y')" ).append("\n"); 
		query.append("				OR (DMDT_AR_IF_CD = 'Y')" ).append("\n"); 
		query.append("				#end " ).append("\n"); 
		query.append("				#if (${hold} == 'H')" ).append("\n"); 
		query.append("				OR A.DMDT_AR_IF_CD = 'H'" ).append("\n"); 
		query.append("				#end " ).append("\n"); 
		query.append("				#if (${hold_Litigation} == 'L')" ).append("\n"); 
		query.append("				OR (A.DMDT_AR_IF_CD = 'H' AND A.INV_HLD_RSN_CD = 'LIT')" ).append("\n"); 
		query.append("				#end " ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("	   #end	   " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	## INVOICE STATUS" ).append("\n"); 
		query.append("       #if (${s_dmdt_inv_sts_cd} != '')" ).append("\n"); 
		query.append("       AND  A.DMDT_INV_STS_CD IN (" ).append("\n"); 
		query.append("			#foreach($dmdt_inv_sts_no in ${dmdt_inv_sts_list}) " ).append("\n"); 
		query.append("			#if($velocityCount < $dmdt_inv_sts_list.size()) " ).append("\n"); 
		query.append("		           '$dmdt_inv_sts_no', " ).append("\n"); 
		query.append("			#else " ).append("\n"); 
		query.append("		           '$dmdt_inv_sts_no' " ).append("\n"); 
		query.append("			#end " ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("	   #end	" ).append("\n"); 
		query.append("	" ).append("\n"); 
		query.append("	## OFC radio box" ).append("\n"); 
		query.append("       #if (${s_inv_check} == 'N')" ).append("\n"); 
		query.append("       AND  A.CRE_OFC_CD IN (" ).append("\n"); 
		query.append("			#foreach($s_issue_ofc in ${ofc_cd_list} )" ).append("\n"); 
		query.append("				#if($velocityCount < $ofc_cd_list.size()) '$s_issue_ofc', #else '$s_issue_ofc' #end" ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("			" ).append("\n"); 
		query.append("       AND  A.CRE_DT >= TO_DATE(@[s_issue_fm]||'000000','YYYYMMDDHH24MISS')" ).append("\n"); 
		query.append("       AND  A.CRE_DT <= TO_DATE(@[s_issue_to]||'235959','YYYYMMDDHH24MISS')" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	## INV radio box" ).append("\n"); 
		query.append("    #if (${s_inv_check} == 'Y')" ).append("\n"); 
		query.append("       #if (${session_rhq_ofc_cd} != 'SELHO')" ).append("\n"); 
		query.append("       AND  A.CRE_OFC_CD IN " ).append("\n"); 
		query.append("			( " ).append("\n"); 
		query.append("				SELECT  OFC_CD " ).append("\n"); 
		query.append("				  FROM  MDM_ORGANIZATION " ).append("\n"); 
		query.append("				 WHERE  AR_HD_QTR_OFC_CD = @[session_rhq_ofc_cd]" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	   #if (${s_invoice_no} != '')	" ).append("\n"); 
		query.append("       AND  A.DMDT_INV_NO IN " ).append("\n"); 
		query.append("			(" ).append("\n"); 
		query.append("			#foreach( $invoice_cd in ${invoice_no_list} )" ).append("\n"); 
		query.append("			#if($velocityCount < $invoice_no_list.size()) " ).append("\n"); 
		query.append("				'$invoice_cd', " ).append("\n"); 
		query.append("			#else " ).append("\n"); 
		query.append("				'$invoice_cd' " ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	   #if (${s_bkg_no} != '')	" ).append("\n"); 
		query.append("	   AND  A.BKG_NO IN " ).append("\n"); 
		query.append("			(" ).append("\n"); 
		query.append("			#foreach( $bkg_cd in ${bkg_no_list} )" ).append("\n"); 
		query.append("			#if($velocityCount < $bkg_no_list.size()) " ).append("\n"); 
		query.append("				'$bkg_cd', " ).append("\n"); 
		query.append("			#else " ).append("\n"); 
		query.append("				'$bkg_cd' " ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	   #if (${s_bl_no} != '')	" ).append("\n"); 
		query.append("	   AND  A.BL_NO IN " ).append("\n"); 
		query.append("			(" ).append("\n"); 
		query.append("			#foreach( $bl_cd in ${bl_no_list} )" ).append("\n"); 
		query.append("			#if($velocityCount < $bl_no_list.size()) " ).append("\n"); 
		query.append("				'$bl_cd', " ).append("\n"); 
		query.append("			#else " ).append("\n"); 
		query.append("				'$bl_cd' " ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			)" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	## ISSUE ID" ).append("\n"); 
		query.append("	   #if(${s_issue_usr_id} != '')" ).append("\n"); 
		query.append("	   AND  A.CRE_USR_ID = @[s_issue_usr_id]" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	## PAYER" ).append("\n"); 
		query.append("	  #if(${s_payer_cd} != '')" ).append("\n"); 
		query.append("	   #if (${s_cust_gubun} == '1')" ).append("\n"); 
		query.append("	   AND  LPAD(A.ACT_PAYR_SEQ,6,'0') = LPAD(@[s_cust_cd],6,'0')" ).append("\n"); 
		query.append("	   #elseif (${s_cust_gubun} == '2') " ).append("\n"); 
		query.append("	   AND  A.ACT_PAYR_CNT_CD          = SUBSTR(@[s_cust_cd],1,2)" ).append("\n"); 
		query.append("	   AND  LPAD(A.ACT_PAYR_SEQ,6,'0') = SUBSTR(@[s_cust_cd],3)" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	  #end" ).append("\n"); 
		query.append("	" ).append("\n"); 
		query.append("	## SC NO" ).append("\n"); 
		query.append("	   #if(${s_sc_no} != '')" ).append("\n"); 
		query.append("	   AND  A.SC_NO = @[s_sc_no]" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	## RFA NO" ).append("\n"); 
		query.append("	   #if(${s_rfa_no} != '')" ).append("\n"); 
		query.append("	   AND  A.RFA_NO = @[s_rfa_no]" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	## TAA NO" ).append("\n"); 
		query.append("	   #if(${s_taa_no} != '')" ).append("\n"); 
		query.append("	   AND C.TAA_NO = @[s_taa_no]" ).append("\n"); 
		query.append("	   #end" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("	ORDER BY A.DMDT_INV_NO" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${usr_ofc_cd} == 'SAOSC' && ${btn_id} == 'btn_downexcel')" ).append("\n"); 
		query.append("    SELECT  DISTINCT" ).append("\n"); 
		query.append("            T1.*" ).append("\n"); 
		query.append("           ,NVL(T3.CNTR_NO, T2.CNTR_NO)				   			AS CNTR_NO_S" ).append("\n"); 
		query.append("           ,TO_CHAR(T2.FM_MVMT_DT, 'YYYY-MM-DD HH24:MI')		AS FM_MVMT_DT " ).append("\n"); 
		query.append("           ,TO_CHAR(T2.TO_MVMT_DT, 'YYYY-MM-DD HH24:MI')		AS TO_MVMT_DT" ).append("\n"); 
		query.append("           ,NVL(T3.FX_FT_OVR_DYS, T2.TO_MVMT_DT - T2.FT_END_DT) AS FX_FT_OVR_DYS" ).append("\n"); 
		query.append("		   " ).append("\n"); 
		query.append("      FROM  INV_DATA        T1" ).append("\n"); 
		query.append("	       ,DMT_INV_DTL     T2" ).append("\n"); 
		query.append("		   ,DMT_CHG_CALC    T3" ).append("\n"); 
		query.append("		   " ).append("\n"); 
		query.append("     WHERE  1 = 1" ).append("\n"); 
		query.append("       AND  T1.DMDT_INV_NO          = T2.DMDT_INV_NO" ).append("\n"); 
		query.append("       AND  T1.CRE_OFC_CD           = T2.CRE_OFC_CD" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("       #if(${s_group_by} != '1')" ).append("\n"); 
		query.append("       AND  T1.CNTR_NO	            = T2.CNTR_NO" ).append("\n"); 
		query.append("       #end" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("       AND  T2.SYS_AREA_GRP_ID      = T3.SYS_AREA_GRP_ID    (+)" ).append("\n"); 
		query.append("       AND  T2.CNTR_NO              = T3.CNTR_NO            (+)" ).append("\n"); 
		query.append("       AND  T2.CNTR_CYC_NO          = T3.CNTR_CYC_NO        (+)" ).append("\n"); 
		query.append("       AND  T2.DMDT_TRF_CD          = T3.DMDT_TRF_CD        (+)" ).append("\n"); 
		query.append("       AND  T2.DMDT_CHG_LOC_DIV_CD  = T3.DMDT_CHG_LOC_DIV_CD(+)" ).append("\n"); 
		query.append("       AND  T2.CHG_SEQ              = T3.CHG_SEQ            (+)" ).append("\n"); 
		query.append("	   " ).append("\n"); 
		query.append("    ORDER BY T1.DMDT_INV_NO" ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${srch_tp_cd} == 'G')" ).append("\n"); 
		query.append("	SELECT  DMDT_INV_NO	" ).append("\n"); 
		query.append("           ,INV_PRT_FLG	" ).append("\n"); 
		query.append("           ,DMDT_AR_IF_CD	" ).append("\n"); 
		query.append("           ,DMDT_INV_STS_CD	" ).append("\n"); 
		query.append("           ,DMDT_TRF_CD	" ).append("\n"); 
		query.append("           ,BKG_NO	" ).append("\n"); 
		query.append("           ,BL_NO" ).append("\n"); 
		query.append("		   #if(${s_group_by} != '1')" ).append("\n"); 
		query.append("	       ,DECODE(CNTR_NO, '0000000000', NULL, CNTR_NO) AS CNTR_NO" ).append("\n"); 
		query.append("           ,FT_DYS" ).append("\n"); 
		query.append("		   #end" ).append("\n"); 
		query.append("           ,SC_NO	" ).append("\n"); 
		query.append("           ,RFA_NO	" ).append("\n"); 
		query.append("           ,TAA_NO	" ).append("\n"); 
		query.append("           ,CHG_CURR_CD	" ).append("\n"); 
		query.append("           ,ORG_CHG_AMT	" ).append("\n"); 
		query.append("           ,DMDT_EXPT_AMT	" ).append("\n"); 
		query.append("           ,DC_AMT	" ).append("\n"); 
		query.append("           ,BIL_AMT	" ).append("\n"); 
		query.append("           ,INV_CURR_CD	" ).append("\n"); 
		query.append("           ,INV_CHG_AMT	" ).append("\n"); 
		query.append("           ,TAX_AMT	" ).append("\n"); 
		query.append("           ,INV_AMT	" ).append("\n"); 
		query.append("           ,PORT	" ).append("\n"); 
		query.append("           ,CRE_DT	" ).append("\n"); 
		query.append("           ,CRE_OFC_CD	" ).append("\n"); 
		query.append("           ,ISSUE_ID	" ).append("\n"); 
		query.append("           ,ISSUE_NM	" ).append("\n"); 
		query.append("           ,AR_IF_NO	" ).append("\n"); 
		query.append("           ,AR_IF_DT	" ).append("\n"); 
		query.append("           ,AR_IF_OFC_CD	" ).append("\n"); 
		query.append("           ,AR_IF_USR_ID	" ).append("\n"); 
		query.append("           ,AR_IF_USR_NM	" ).append("\n"); 
		query.append("           ,ACT_PAYR_CD	" ).append("\n"); 
		query.append("           ,ACT_PAYR_NM	" ).append("\n"); 
		query.append("           ,ACT_DELT_FLG	" ).append("\n"); 
		query.append("           ,CR_INV_NO	" ).append("\n"); 
		query.append("           ,CTRT_OFC	" ).append("\n"); 
		query.append("           ,INV_RMK	" ).append("\n"); 
		query.append("           ,RHQ_OFC_CD	" ).append("\n"); 
		query.append("           ,POR_CD	" ).append("\n"); 
		query.append("           ,POL_CD	" ).append("\n"); 
		query.append("           ,POD_CD	" ).append("\n"); 
		query.append("           ,DEL_CD" ).append("\n"); 
		query.append("	       ,INV_OVER" ).append("\n"); 
		query.append("	       ,DMDT_INV_TP_CD" ).append("\n"); 
		query.append("		   ,DECODE(DMDT_AR_IF_CD, 'H', 0, DECODE(V_COLLECTED, 'Y', 0, INV_AMT)) AS UNCOL_AMT" ).append("\n"); 
		query.append("	" ).append("\n"); 
		query.append("	  FROM  INV_DATA" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	WHERE  1 = 1" ).append("\n"); 
		query.append("	" ).append("\n"); 
		query.append("	## OVER DAYS" ).append("\n"); 
		query.append("	  #if(${s_inv_over_to} != '')" ).append("\n"); 
		query.append("	  AND  INV_OVER BETWEEN @[s_inv_over_fm] AND @[s_inv_over_to]" ).append("\n"); 
		query.append("	  #end" ).append("\n"); 
		query.append("	  " ).append("\n"); 
		query.append("#else	  " ).append("\n"); 
		query.append("	SELECT  T.*" ).append("\n"); 
		query.append("		   ,CASE" ).append("\n"); 
		query.append("				WHEN T.SM_GSTN_NO IS NULL THEN" ).append("\n"); 
		query.append("					'Yes'" ).append("\n"); 
		query.append("				ELSE" ).append("\n"); 
		query.append("					'No'" ).append("\n"); 
		query.append("			END AS RVS_CHG_FLG		-- REVERSE CHARGE" ).append("\n"); 
		query.append("	  FROM  (" ).append("\n"); 
		query.append("				SELECT  T2.CRE_OFC_CD					AS ISS_OFC_CD" ).append("\n"); 
		query.append("					   ,(" ).append("\n"); 
		query.append("							SELECT  B.IDA_GST_RGST_NO" ).append("\n"); 
		query.append("							  FROM  MDM_ORGANIZATION  A" ).append("\n"); 
		query.append("								   ,MDM_CUSTOMER      B" ).append("\n"); 
		query.append("							 WHERE  A.OFC_CD          = T2.CRE_OFC_CD" ).append("\n"); 
		query.append("							   AND  A.REP_CUST_CNT_CD = B.CUST_CNT_CD" ).append("\n"); 
		query.append("							   AND  A.REP_CUST_SEQ    = B.CUST_SEQ" ).append("\n"); 
		query.append("						)								AS SM_GSTN_NO" ).append("\n"); 
		query.append("					   ,T2.BKG_NO" ).append("\n"); 
		query.append("					   ,CASE " ).append("\n"); 
		query.append("							WHEN T2.ACT_PAYR_CNT_CD = '00' THEN" ).append("\n"); 
		query.append("							   (" ).append("\n"); 
		query.append("									SELECT  NVL(IDA_SPCL_ECN_ZN_UT_FLG, 'N')  " ).append("\n"); 
		query.append("									  FROM  MDM_VENDOR  " ).append("\n"); 
		query.append("									 WHERE  VNDR_SEQ = T2.ACT_PAYR_SEQ" ).append("\n"); 
		query.append("									   AND  NVL(DELT_FLG, 'N') = 'N'  " ).append("\n"); 
		query.append("								)							" ).append("\n"); 
		query.append("							ELSE" ).append("\n"); 
		query.append("							   (" ).append("\n"); 
		query.append("									SELECT  NVL(IDA_SPCL_ECN_ZN_UT_FLG, 'N')  " ).append("\n"); 
		query.append("									  FROM  MDM_CUSTOMER  " ).append("\n"); 
		query.append("									 WHERE  CUST_CNT_CD = T2.ACT_PAYR_CNT_CD" ).append("\n"); 
		query.append("									   AND  CUST_SEQ    = T2.ACT_PAYR_SEQ" ).append("\n"); 
		query.append("									   AND  NVL(DELT_FLG, 'N') = 'N'   " ).append("\n"); 
		query.append("								)				" ).append("\n"); 
		query.append("						END								AS SEZ_FLG" ).append("\n"); 
		query.append("					   ,CASE " ).append("\n"); 
		query.append("							WHEN T2.ACT_PAYR_CNT_CD = '00' THEN" ).append("\n"); 
		query.append("								(" ).append("\n"); 
		query.append("									SELECT  IDA_GST_RGST_NO" ).append("\n"); 
		query.append("									  FROM  MDM_VENDOR" ).append("\n"); 
		query.append("									 WHERE  VNDR_SEQ = T2.ACT_PAYR_SEQ" ).append("\n"); 
		query.append("								)" ).append("\n"); 
		query.append("							ELSE" ).append("\n"); 
		query.append("								(" ).append("\n"); 
		query.append("									SELECT  IDA_GST_RGST_NO  " ).append("\n"); 
		query.append("									  FROM  MDM_CUSTOMER  " ).append("\n"); 
		query.append("									 WHERE  CUST_CNT_CD = T2.ACT_PAYR_CNT_CD" ).append("\n"); 
		query.append("									   AND  CUST_SEQ    = T2.ACT_PAYR_SEQ" ).append("\n"); 
		query.append("									   AND  NVL(DELT_FLG, 'N') = 'N' " ).append("\n"); 
		query.append("								)" ).append("\n"); 
		query.append("						END								AS CUST_GSTN_NO" ).append("\n"); 
		query.append("					   ,CASE " ).append("\n"); 
		query.append("							WHEN T2.ACT_PAYR_CNT_CD = '00' THEN" ).append("\n"); 
		query.append("								(" ).append("\n"); 
		query.append("									SELECT  VNDR_LGL_ENG_NM" ).append("\n"); 
		query.append("									  FROM  MDM_VENDOR" ).append("\n"); 
		query.append("									 WHERE  VNDR_SEQ = T2.ACT_PAYR_SEQ" ).append("\n"); 
		query.append("								)" ).append("\n"); 
		query.append("							ELSE" ).append("\n"); 
		query.append("								(" ).append("\n"); 
		query.append("									SELECT  CUST_LGL_ENG_NM  " ).append("\n"); 
		query.append("									  FROM  MDM_CUSTOMER  " ).append("\n"); 
		query.append("									 WHERE  CUST_CNT_CD = T2.ACT_PAYR_CNT_CD" ).append("\n"); 
		query.append("									   AND  CUST_SEQ    = T2.ACT_PAYR_SEQ" ).append("\n"); 
		query.append("									   AND  NVL(DELT_FLG, 'N') = 'N' " ).append("\n"); 
		query.append("								)" ).append("\n"); 
		query.append("						END				AS CUST_NM" ).append("\n"); 
		query.append("					   ,T2.DMDT_INV_NO" ).append("\n"); 
		query.append("					   ,TO_CHAR(T2.CRE_DT, 'YYYY-MM-DD')	AS ISS_DT" ).append("\n"); 
		query.append("					   ,T2.INV_AMT							AS TTL_INV_AMT" ).append("\n"); 
		query.append("					   ,(" ).append("\n"); 
		query.append("							SELECT   C.IDA_STE_CD  " ).append("\n"); 
		query.append("							FROM     MDM_ORGANIZATION 	A  " ).append("\n"); 
		query.append("								   , MDM_LOCATION 		B  " ).append("\n"); 
		query.append("								   , MDM_STATE 			C  " ).append("\n"); 
		query.append("							WHERE    1 = 1  " ).append("\n"); 
		query.append("							AND      A.LOC_CD = B.LOC_CD  " ).append("\n"); 
		query.append("							AND      B.CNT_CD = C.CNT_CD  " ).append("\n"); 
		query.append("							AND      B.STE_CD = C.STE_CD  " ).append("\n"); 
		query.append("							AND      A.OFC_CD = T2.CRE_OFC_CD" ).append("\n"); 
		query.append("							AND      NVL(A.DELT_FLG, 'N') = 'N'  " ).append("\n"); 
		query.append("							AND      NVL(B.DELT_FLG, 'N') = 'N'  " ).append("\n"); 
		query.append("							AND      NVL(C.DELT_FLG, 'N') = 'N' 				   " ).append("\n"); 
		query.append("						)								AS SM_STE_CD" ).append("\n"); 
		query.append("					   ,CASE " ).append("\n"); 
		query.append("							WHEN T2.ACT_PAYR_CNT_CD = '00' THEN" ).append("\n"); 
		query.append("							   (" ).append("\n"); 
		query.append("									SELECT   NVL(SUBSTR(A.IDA_GST_RGST_NO, 1, 2), C.IDA_STE_CD)  " ).append("\n"); 
		query.append("									FROM     MDM_VENDOR 	A  " ).append("\n"); 
		query.append("										   , MDM_LOCATION 	B  " ).append("\n"); 
		query.append("										   , MDM_STATE 		C  " ).append("\n"); 
		query.append("									WHERE    1 = 1  " ).append("\n"); 
		query.append("									AND      A.LOC_CD = B.LOC_CD  " ).append("\n"); 
		query.append("									AND      B.CNT_CD = C.CNT_CD  " ).append("\n"); 
		query.append("									AND      B.STE_CD = C.STE_CD  " ).append("\n"); 
		query.append("									AND      A.VNDR_SEQ = T2.ACT_PAYR_SEQ" ).append("\n"); 
		query.append("									AND      NVL(A.DELT_FLG, 'N') = 'N'  " ).append("\n"); 
		query.append("									AND      NVL(B.DELT_FLG, 'N') = 'N'  " ).append("\n"); 
		query.append("									AND      NVL(C.DELT_FLG, 'N') = 'N'  " ).append("\n"); 
		query.append("								)							" ).append("\n"); 
		query.append("							ELSE" ).append("\n"); 
		query.append("							   (" ).append("\n"); 
		query.append("									SELECT   C.IDA_STE_CD  " ).append("\n"); 
		query.append("									FROM     MDM_CUSTOMER 		A  " ).append("\n"); 
		query.append("										   , MDM_LOCATION 		B  " ).append("\n"); 
		query.append("										   , MDM_STATE 			C  " ).append("\n"); 
		query.append("									WHERE    1 = 1  " ).append("\n"); 
		query.append("									AND      A.LOC_CD = B.LOC_CD  " ).append("\n"); 
		query.append("									AND      B.CNT_CD = C.CNT_CD  " ).append("\n"); 
		query.append("									AND      B.STE_CD = C.STE_CD  " ).append("\n"); 
		query.append("									AND      A.CUST_CNT_CD = T2.ACT_PAYR_CNT_CD" ).append("\n"); 
		query.append("									AND      A.CUST_SEQ    = T2.ACT_PAYR_SEQ" ).append("\n"); 
		query.append("									AND      NVL(A.DELT_FLG, 'N') = 'N'  " ).append("\n"); 
		query.append("									AND      NVL(B.DELT_FLG, 'N') = 'N'  " ).append("\n"); 
		query.append("									AND      NVL(C.DELT_FLG, 'N') = 'N' " ).append("\n"); 
		query.append("								)				" ).append("\n"); 
		query.append("						END								AS CUST_STE_CD" ).append("\n"); 
		query.append("					   ,T2.POR_CD" ).append("\n"); 
		query.append("					   ,T2.DEL_CD" ).append("\n"); 
		query.append("					   ,'996719'						AS SAC_CD" ).append("\n"); 
		query.append("					   ,T2.INV_CHG_AMT" ).append("\n"); 
		query.append("					   ,T2.IDA_CGST_RTO" ).append("\n"); 
		query.append("					   ,T2.IDA_CGST_AMT" ).append("\n"); 
		query.append("					   ,T2.IDA_SGST_RTO" ).append("\n"); 
		query.append("					   ,T2.IDA_SGST_AMT" ).append("\n"); 
		query.append("					   ,T2.IDA_IGST_RTO" ).append("\n"); 
		query.append("					   ,T2.IDA_IGST_AMT" ).append("\n"); 
		query.append("					   ,T2.IDA_UGST_RTO" ).append("\n"); 
		query.append("					   ,T2.IDA_UGST_AMT" ).append("\n"); 
		query.append("					   ,T2.INV_AMT" ).append("\n"); 
		query.append("					   ,T1.CRE_OFC_CD" ).append("\n"); 
		query.append("					   ,T1.DMDT_TRF_CD" ).append("\n"); 
		query.append("					   ,T1.DMDT_INV_TP_CD" ).append("\n"); 
		query.append("                       ,''								AS CNTR_NO" ).append("\n"); 
		query.append("				" ).append("\n"); 
		query.append("				  FROM  INV_DATA   T1" ).append("\n"); 
		query.append("					   ,DMT_INV_MN T2" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("				WHERE  1 = 1" ).append("\n"); 
		query.append("				  AND  T1.DMDT_INV_NO = T2.DMDT_INV_NO" ).append("\n"); 
		query.append("				" ).append("\n"); 
		query.append("				## OVER DAYS" ).append("\n"); 
		query.append("				  #if(${s_inv_over_to} != '')" ).append("\n"); 
		query.append("				  AND  T1.INV_OVER BETWEEN @[s_inv_over_fm] AND @[s_inv_over_to]" ).append("\n"); 
		query.append("				  #end" ).append("\n"); 
		query.append("			) T" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#end" ).append("\n"); 

	}
}