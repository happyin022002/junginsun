<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralCodeSearchMgtDBDAOSearchMnrOnsiteInspectionHistoryRSQL">
			<desc><![CDATA[M&R Onsite Inspection History 조회]]></desc>
			<sql><![CDATA[
SELECT   

		 DISTINCT
#if (${searchcon} == 'COMMON') 
         A.YD_CD AS CD_ID
#end
#if (${searchcon} == 'COMMON1') 
         A.YD_CD||'('||A.VNDR_SEQ||')' AS CD_ID
#end
        ,TO_CHAR(A.FLD_INSP_DT,'YYYY-MM-DD') AS CD_DESC
FROM MNR_ONSITE_INSP_RSLT A
#if (${searchcon} == 'COMMON1') 
,(
SELECT WK_ST_DT, WK_END_DT FROM EQR_WK_PRD
WHERE PLN_YR = TO_NUMBER(SUBSTR(@[searchkey], 1, 4))
AND PLN_WK = TO_NUMBER(SUBSTR(@[searchkey], 5, 2))
) B
#end
#if (${searchcon} == 'COMMON') 
 	WHERE A.VNDR_SEQ = TO_NUMBER(SUBSTR(@[searchkey], 1, 6))
    AND   A.INSP_OFC_CD   = SUBSTR(@[searchkey], 7)
#end
#if (${searchcon} == 'COMMON1') 
 	WHERE A.INSP_OFC_CD   IN (SELECT DISTINCT OFC_CD
          FROM MDM_ORGANIZATION A
         WHERE 1=1
           AND A.DELT_FLG != 'Y' START WITH A.OFC_CD = SUBSTR(@[searchkey], 7, 5) CONNECT BY PRIOR A.OFC_CD = A.PRNT_OFC_CD)
    AND   A.FLD_INSP_DT BETWEEN TO_DATE(B.WK_ST_DT, 'YYYY-MM-DD')+0.0 AND TO_DATE(B.WK_END_DT, 'YYYY-MM-DD')+0.99999
    AND   A.VNDR_SEQ LIKE '%'||SUBSTR(@[searchkey], 12,5)||'%'
    AND   A.FILE_SEQ != 0
#end
ORDER BY TO_CHAR(A.FLD_INSP_DT,'YYYY-MM-DD') DESC			]]></sql>
			<params>
				<param name="searchkey" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
