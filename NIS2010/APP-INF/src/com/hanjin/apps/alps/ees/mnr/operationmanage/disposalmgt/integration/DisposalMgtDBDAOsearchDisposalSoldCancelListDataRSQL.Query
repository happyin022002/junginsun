<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DisposalMgtDBDAOsearchDisposalSoldCancelListDataRSQL">
			<desc><![CDATA[* --------------------------------------------------------
* History
* 2012.01.13 김상수 [CHM-201215565-01] ALPS MNR-Disposal-SLD Management-> SLD Cancellation 보완 요청
*                                      - Disposal Sold Cancelation 화면에서 M.G.Set과 Chassis도 SLD Cancel 가능하도록 CGM연계로직 추가]]></desc>
			<sql><![CDATA[
SELECT DISTINCT
       A.INV_NO,
       CASE WHEN A.MNR_INV_STS_CD = 'HC' THEN
                 (SELECT /*+ INDEX_DESC (IAI XPKINV_AR_IF_MN) */
                         DECODE(IAA.INV_ERP_IF_STS_CD, 'N', (SELECT MGC.MNR_CD_DESC
                                                               FROM MNR_GEN_CD MGC
                                                              WHERE A.MNR_INV_STS_CD = MGC.MNR_CD_ID
                                                                AND MGC.PRNT_CD_ID = 'CD00027'
                                                                AND ROWNUM = 1),
                                                       'E', IAA.ERR_DESC,
                                                       'Y', 'ERP Interfaced')
                    FROM INV_AR_IF_MN IAI,
                         INV_AR_AMT IAA
                   WHERE IAI.AR_IF_NO = IAA.AR_IF_NO
                     AND A.INV_NO = IAI.BL_SRC_NO
                     AND ROWNUM = 1)
            ELSE
                 (SELECT MGC.MNR_CD_DESC
                    FROM MNR_GEN_CD MGC
                   WHERE A.MNR_INV_STS_CD = MGC.MNR_CD_ID
                     AND MGC.PRNT_CD_ID = 'CD00027'
                     AND ROWNUM = 1)
       END AS MNR_INV_STS_CD,
       D.DISP_NO,
       D.DISP_DTL_SEQ,
       A.MNR_PRNR_CNT_CD||TO_CHAR(A.MNR_PRNR_SEQ, '000000') AS BUYER_CODE,
       B.MNR_PRNR_LGL_ENG_NM AS BUYER_NAME,
       D.EQ_NO,
       F.EQ_KND_CD,
       F.EQ_KND_NM,
       D.EQ_TPSZ_CD,
       F.LSTM_CD,
       F.CNTR_STS_CD,
       F.CNMV_STS_CD,
       TO_CHAR(D.DISP_SOLD_DT, 'YYYY-MM-DD') AS DISP_SOLD_DT,
       F.LST_STS_YD_CD,
       A.UPD_USR_ID
  FROM MNR_RCV_INV_WRK A,
       MNR_PARTNER B,
       MNR_DISP_HDR C,
       MNR_DISP_DTL D,
       MNR_GEN_CD G,
       MDM_CURRENCY E,
       INV_AR_IF_MN IAI,
       INV_AR_AMT IAA,
       (SELECT A.EQ_NO,
               A.EQ_KND_CD,
               DECODE(A.EQ_KND_CD, 'U', 'CNTR', 'Z', 'Chassis', 'G', 'M.G.Set') AS EQ_KND_NM,
               A.AGMT_LSTM_CD AS LSTM_CD,
               B.EQ_ASET_STS_CD AS CNTR_STS_CD,
               A.CHSS_MVMT_STS_CD AS CNMV_STS_CD,
               A.CRNT_YD_CD AS LST_STS_YD_CD
          FROM CGM_EQUIPMENT A,
               CGM_EQ_STS_HIS B
         WHERE A.EQ_NO = B.EQ_NO
           AND A.EQ_STS_SEQ = B.EQ_STS_SEQ
        UNION ALL
        SELECT CNTR_NO AS EQ_NO,
               'U' AS EQ_KND_CD,
               'CNTR' AS EQ_KND_NM,
               LSTM_CD,
               CNTR_STS_CD,
               CNMV_STS_CD,
               LST_STS_YD_CD
          FROM MST_CONTAINER) F
 WHERE A.MNR_PRNR_CNT_CD = B.MNR_PRNR_CNT_CD(+)
   AND A.MNR_PRNR_SEQ = B.MNR_PRNR_SEQ(+)
   AND A.CURR_CD = E.CURR_CD
--AND A.CRE_DT BETWEEN GLOBALDATE_PKG.TIME_CONV_OFC_FNC(NVL(null, MNR_COMMON_PKG.MNR_GET_HOOFC_FNC()), TO_DATE('2011-06-01', 'YYYY-MM-DD'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC()) AND GLOBALDATE_PKG.TIME_CONV_OFC_FNC(NVL(null, MNR_COMMON_PKG.MNR_GET_HOOFC_FNC()), TO_DATE('2011-12-31', 'YYYY-MM-DD'), MNR_COMMON_PKG.MNR_GET_HOOFC_FNC())+ 0.99999
   AND IAI.AR_IF_NO = IAA.AR_IF_NO(+)
   AND A.INV_NO = IAI.BL_SRC_NO(+)
   AND C.DISP_NO = D.DISP_NO
   AND A.RCV_INV_SEQ = D.RCV_INV_SEQ
   AND C.DISP_NO = D.DISP_NO
   AND C.CURR_CD = E.CURR_CD
   AND G.PRNT_CD_ID(+) = 'CD00035'
   AND C.DISP_TP_CD = G.MNR_CD_ID(+)
   AND D.EQ_NO = F.EQ_NO
#if (${kind_cd} == 'I')
   AND A.INV_NO = @[kind_no]
#end
#if (${kind_cd} == 'D')
   AND D.INV_NO IN (SELECT INV_NO FROM MNR_DISP_DTL WHERE DISP_NO = @[kind_no])
#end
#if (${kind_cd} == 'E')
   AND A.INV_NO IN (SELECT INV_NO FROM MNR_DISP_DTL WHERE EQ_NO = @[kind_no])
#end			]]></sql>
			<params>
				<param name="kind_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
