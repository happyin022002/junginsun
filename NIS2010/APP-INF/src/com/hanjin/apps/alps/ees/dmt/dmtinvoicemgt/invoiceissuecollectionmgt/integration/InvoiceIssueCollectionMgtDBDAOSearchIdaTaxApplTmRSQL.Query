<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceIssueCollectionMgtDBDAOSearchIdaTaxApplTmRSQL">
			<desc><![CDATA[InvoiceIssueCollectionMgtDBDAOSearchIdaTaxApplTmRSQL]]></desc>
			<sql><![CDATA[
SELECT  CASE
			--// INVOICE 생성 전
			WHEN @[dmdt_inv_no] IS NULL THEN
			
				CASE
					WHEN TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDDHH24MI'), 'YYYYMMDDHH24MI') - TO_DATE(ATTR_CTNT1, 'YYYYMMDDHH24MI') > 0 
						THEN 'A' 
						ELSE 'B' 
				END

			--// CREDIT INVOICE 인 경우 원본 INVOICE 의 생성일자를 기준으로 구한다.
			WHEN (
					SELECT  DMDT_INV_STS_CD
					  FROM  DMT_INV_MN
					 WHERE  DMDT_INV_NO = @[dmdt_inv_no]
				 ) = 'C' THEN
				(
					SELECT  CASE
								WHEN TO_DATE(TO_CHAR(T1.CRE_DT, 'YYYYMMDDHH24MI'), 'YYYYMMDDHH24MI') - TO_DATE(ATTR_CTNT1, 'YYYYMMDDHH24MI') > 0
									THEN 'A'
								ELSE 'B'
							END
					  FROM  DMT_INV_MN T1
					 WHERE  T1.DMDT_INV_NO = 
							(
								SELECT  CR_INV_NO
								  FROM  DMT_INV_MN
								 WHERE  DMDT_INV_NO = @[dmdt_inv_no]
							)
				)
			--// INVOICE 인 경우 생성일자를 기준으로 구한다.				
			ELSE
				(
					SELECT  CASE
								WHEN TO_DATE(TO_CHAR(T1.CRE_DT, 'YYYYMMDDHH24MI'), 'YYYYMMDDHH24MI') - TO_DATE(ATTR_CTNT1, 'YYYYMMDDHH24MI') > 0
									THEN 'A'
								ELSE 'B'
							END
					  FROM  DMT_INV_MN 			T1
					 WHERE  T1.DMDT_INV_NO = @[dmdt_inv_no]
				)			
		END AS IDA_TAX_APPL_TM
		
  FROM  DMT_HRD_CDG_CTNT
 WHERE  HRD_CDG_ID = 'IDA_TAX_APPL_DT'			]]></sql>
			<params>
				<param name="dmdt_inv_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
