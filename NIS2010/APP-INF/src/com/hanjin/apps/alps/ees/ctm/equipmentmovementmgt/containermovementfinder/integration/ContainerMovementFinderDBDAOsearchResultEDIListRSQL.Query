<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContainerMovementFinderDBDAOsearchResultEDIListRSQL">
			<desc><![CDATA[ContainerMovementFinderDBDAO.java]]></desc>
			<sql><![CDATA[
#if (${flgrslt} == 'VL')
	#if (${viewtype} == '1')
	    SELECT CNTR_NO, CNTR_TPSZ_CD, ORG_YD_CD, FULL_FG, MVMT_STS_CD, MAX(BKG_NO) BKG_NO
	    FROM (
			SELECT C.CNTR_NO, C.CNTR_TPSZ_CD, C.ORG_YD_CD, DECODE (B.BKG_CGO_TP_CD, 'P', 'M', 'F' ) FULL_FG, C.CNMV_STS_CD MVMT_STS_CD, C.BKG_NO
			  FROM BKG_CONTAINER C, BKG_BOOKING B
			 WHERE C.BKG_NO IN (
				  SELECT BV.BKG_NO
				    FROM BKG_VVD BV
				   WHERE BV.VSL_CD = SUBSTR(@[vls_cd], 0,4)
				     AND BV.SKD_VOY_NO = SUBSTR(@[vls_cd], 5,4)
				     AND BV.SKD_DIR_CD = SUBSTR(@[vls_cd], 9,1)
				     AND BV.POL_CD = @[pol_cd]
					)
			   AND C.BKG_NO = B.BKG_NO
			   AND B.BKG_STS_CD NOT IN ('X', 'S')
	    )
	    GROUP BY CNTR_NO, CNTR_TPSZ_CD, FULL_FG, MVMT_STS_CD, ORG_YD_CD
	    ORDER BY CNTR_NO
	#else
	SELECT DISTINCT EDI.CNTR_NO, MST.CNTR_TPSZ_CD, EDI.CNTR_FULL_STS_CD FULL_FG,
           EDI.EDI_MVMT_STS_CD MVMT_STS_CD, EDI.EVNT_YD_CD ORG_YD_CD, 'EDI' BKG_NO,
           TO_CHAR(EVNT_DT, 'YYYY-MM-DD HH24:MI') EVNT_DT, MVMT_EDI_MSG_AREA_CD AS SVR_ID
	FROM CTM_MVMT_EDI_MSG EDI, MST_CONTAINER MST
	WHERE 1 =1
	AND   EDI.CNTR_NO = MST.CNTR_NO
	AND EDI_GATE_IO_CD = 'AE'
	AND     CRNT_VSL_CD  = SUBSTR(@[vls_cd], 1, 4)
	AND     CRNT_SKD_VOY_NO = SUBSTR(@[vls_cd], 5, 4) 
	AND     CRNT_SKD_DIR_CD = SUBSTR(@[vls_cd], 9, 1)

	AND EVNT_YD_CD  LIKE @[pol_cd] || '%'
    ORDER BY EDI.CNTR_NO
	#end
#elseif (${flgrslt} == 'VD')
	#if (${viewtype} == '1')
	    SELECT CNTR_NO, CNTR_TPSZ_CD, FULL_FG, ORG_YD_CD, MVMT_STS_CD, MAX(BKG_NO) BKG_NO
	    FROM (
			SELECT C.CNTR_NO, C.CNTR_TPSZ_CD, C.ORG_YD_CD, DECODE(B.BKG_CGO_TP_CD, 'P', 'M', 'F') FULL_FG, C.CNMV_STS_CD MVMT_STS_CD, C.BKG_NO
			FROM BKG_CONTAINER C, BKG_BOOKING B
			WHERE C.BKG_NO IN
			    (
				SELECT BV.BKG_NO
				    FROM BKG_VVD BV
				    WHERE  BV.VSL_CD = SUBSTR(@[vls_cd], 0,4)
				    AND BV.SKD_VOY_NO = SUBSTR(@[vls_cd], 5,4)
				    AND BV.SKD_DIR_CD = SUBSTR(@[vls_cd], 9,1)
				    AND BV.POD_CD = @[pol_cd]
			    )
			AND C.BKG_NO = B.BKG_NO
			AND B.BKG_STS_CD NOT IN ('X', 'S')
	    )
	    GROUP BY CNTR_NO, CNTR_TPSZ_CD, FULL_FG, MVMT_STS_CD, ORG_YD_CD
	    ORDER BY CNTR_NO
	#else
	SELECT DISTINCT EDI.CNTR_NO, MST.CNTR_TPSZ_CD, EDI.CNTR_FULL_STS_CD FULL_FG,
           EDI.EDI_MVMT_STS_CD MVMT_STS_CD, EDI.EVNT_YD_CD ORG_YD_CD, 'EDI' BKG_NO,
           TO_CHAR(EVNT_DT, 'YYYY-MM-DD HH24:MI') EVNT_DT, MVMT_EDI_MSG_AREA_CD AS SVR_ID
	FROM CTM_MVMT_EDI_MSG EDI, MST_CONTAINER MST
	WHERE 1 = 1
	AND   EDI.CNTR_NO = MST.CNTR_NO
	AND EDI_GATE_IO_CD = 'UV'
	AND     CRNT_VSL_CD  = SUBSTR(@[vls_cd], 1, 4)
	AND     CRNT_SKD_VOY_NO = SUBSTR(@[vls_cd], 5, 4) 
	AND     CRNT_SKD_DIR_CD = SUBSTR(@[vls_cd], 9, 1)
	AND EVNT_YD_CD  LIKE @[pol_cd] || '%'
    ORDER BY EDI.CNTR_NO
	#end
#end			]]></sql>
			<params>
				<param name="vls_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
