<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ScenarioManageDBDAOMergeNISCurrentVesselSchedulePortCSQL">
			<desc><![CDATA[VSK_VSL_PORT_SKD 테이블에서 특정VVD의 정보를 EQR_SCNR_VSL_SKD 테이블에 입력/수정

1. 수정이력
   2012.09.19 
   DOUBLE CALLING PORT 수정에서 오류가 발생할수 있는 SQL 수정
   신용찬 수석]]></desc>
			<sql><![CDATA[
MERGE INTO EQR_SCNR_VSL_SKD A                               	     	 
USING   (        														 
        SELECT 
            @[scnr_id]  SCNR_ID1,  -- EX) SCEN200824W001  						 
            A.VSL_CD VSL_CD1,												 
            A.SKD_VOY_NO  SKD_VOY_NO1,									 
            A.SKD_DIR_CD  SKD_DIR_CD1,									 
            A.VPS_PORT_CD,  -- VSL_LOC_CD									 
            A.CLPT_IND_SEQ, -- VSL_CALL_IND_CD							 
            A.CLPT_SEQ,     -- VSL_CALL_SEQ								 
            A.VPS_ETA_DT,   -- VSL_ETA_DT									 
            A.VPS_ETB_DT,   -- VSL_ETB_DT					  			     
            A.VPS_ETD_DT,   -- VSL_ETD_DT									 
            A.TURN_PORT_IND_CD, -- VSL_TURN_PORT_INFO_CD					 
            A.TURN_SKD_VOY_NO,  -- VSL_TURN_VOY_NO						 
            A.TURN_SKD_DIR_CD,  -- VSL_TURN_DIR_CD						 
            A.TURN_CLPT_IND_SEQ,-- VSL_TURN_CALL_IND_CD					 
            A.SLAN_CD,          -- VSL_SLAN_CD
            A.YD_CD            -- YD_CD			09.12.29 YD정보를 넣기 위해 추가  By ChangeHoChae				 						 
        FROM VSK_VSL_PORT_SKD A
            ,VSK_VSL_SKD B												 
        WHERE A.VSL_CD     = @[vsl_cd]    -- VSL_CD 입력값   EX) EME7					 
        AND   A.SKD_VOY_NO = @[skd_voy_no] -- SKD VOY 입력값  EX) 0718						 
        AND   A.SKD_DIR_CD = @[skd_dir_cd] -- SKD DIR 입력값  EX) N						 
        AND   A.VPS_PORT_CD= @[vsl_loc_cd] -- 한진고객이 요청하지 않는 경우는 생략함			 												 
        AND   A.SLAN_CD    =  @[vsl_slan_cd]	
		AND   A.SLAN_CD    = B.VSL_SLAN_CD
        AND   A.VSL_CD     = B.VSL_CD
        AND   A.SKD_VOY_NO = B.SKD_VOY_NO
        AND   A.SKD_DIR_CD = B.SKD_DIR_CD
        AND NVL(SKD_CNG_STS_CD,'N') not in ('S')
        AND A.VPS_ETD_DT BETWEEN (SELECT TO_DATE(WK_ST_DT,'YYYYMMDD') FROM EQR_WK_PRD WHERE PLN_YR||PLN_WK = @[v_fm_wk] )
                         AND     (SELECT TO_DATE(WK_END_DT,'YYYYMMDD') FROM EQR_WK_PRD WHERE PLN_YR||PLN_WK = @[v_to_wk] )											 
        ) B																 
ON      (      
        A.SCNR_ID               = B.SCNR_ID1							 
        AND  A.VSL_CD           = B.VSL_CD1 							 
        AND  A.SKD_VOY_NO       = B.SKD_VOY_NO1							 
        AND  A.SKD_DIR_CD       = B.SKD_DIR_CD1 						 
        AND  A.VSL_LOC_CD       = B.VPS_PORT_CD 						 
        AND  A.VSL_CALL_IND_CD  = B.CLPT_IND_SEQ						 					 
        --AND  A.VSL_SLAN_CD      = B.SLAN_CD
        )																	 
WHEN MATCHED THEN    													  
        UPDATE 	SET     														 
            --A.VSL_CALL_IND_CD         = B.CLPT_IND_SEQ,			     
            A.VSL_CALL_SEQ            = B.CLPT_SEQ,				     
            A.VSL_ETA_DT              = B.VPS_ETA_DT,					 
            A.VSL_ETB_DT              = B.VPS_ETB_DT,					 
            A.VSL_ETD_DT              = B.VPS_ETD_DT,					 
            A.VSL_TURN_PORT_INFO_CD   = B.TURN_PORT_IND_CD,			 
            A.VSL_TURN_VOY_NO         = B.TURN_SKD_VOY_NO,				 
            A.VSL_TURN_DIR_CD         = B.TURN_SKD_DIR_CD,				 
            A.VSL_TURN_CALL_IND_CD    = B.TURN_CLPT_IND_SEQ,
            A.YD_CD                   = B.YD_CD,			 				 
            A.DELT_FLG                = 'N',							 
            A.UPD_USR_ID              =  @[User_id] ,							 
            A.UPD_DT                  = SYSDATE			]]></sql>
			<params>
				<param name="scnr_id" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="vsl_loc_cd" type="12" value="" out="N"/>
				<param name="vsl_slan_cd" type="12" value="" out="N"/>
				<param name="v_fm_wk" type="12" value="" out="N"/>
				<param name="v_to_wk" type="12" value="" out="N"/>
				<param name="User_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
