<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChargeCalculationDBDAOSearchRecalculationStatusRSQL">
			<desc><![CDATA[ChargeCalculationDBDAOSearchRecalculationStatusRSQL]]></desc>
			<sql><![CDATA[
SELECT  CASE 
			WHEN DMDT_CHG_STS_CD = 'D' THEN 'N'	--// INACT 된 경우, RECALC 불가
            ELSE
				CASE 
					WHEN 
						(
							SELECT  NVL(MAX(DMDT_DELT_RQST_STS_CD), 'C')
							  FROM  DMT_CHG_DELT_RQST_APRO A
							 WHERE  A.SYS_AREA_GRP_ID     = T1.SYS_AREA_GRP_ID
							   AND  A.CNTR_NO             = T1.CNTR_NO
							   AND  A.CNTR_CYC_NO         = T1.CNTR_CYC_NO
							   AND  A.DMDT_TRF_CD         = T1.DMDT_TRF_CD
							   AND  A.DMDT_CHG_LOC_DIV_CD = T1.DMDT_CHG_LOC_DIV_CD
							   AND  A.CHG_SEQ             = T1.CHG_SEQ
							   AND  A.CHG_OFC_CD          = @[ofc_cd]
							   AND  A.DELT_SEQ            =
									(
										SELECT  /*+ INDEX_DESC( B XPKDMT_CHG_DELT_RQST_APRO ) */ DELT_SEQ
										  FROM  DMT_CHG_DELT_RQST_APRO B
										 WHERE  B.SYS_AREA_GRP_ID     = A.SYS_AREA_GRP_ID
										   AND  B.CNTR_NO             = A.CNTR_NO
										   AND  B.CNTR_CYC_NO         = A.CNTR_CYC_NO
										   AND  B.DMDT_TRF_CD         = A.DMDT_TRF_CD
										   AND  B.DMDT_CHG_LOC_DIV_CD = A.DMDT_CHG_LOC_DIV_CD
										   AND  B.CHG_SEQ             = A.CHG_SEQ
										   AND  B.CHG_OFC_CD          = A.CHG_OFC_CD
										   AND  ROWNUM                = 1
									)
						) IN ('C', 'E', 'F', 'G') THEN 'Y'		--// INACT REQ. 요청한 이력이 없거나 CANCEL 및 REJECT 한 경우, RECALC 가능 (E : BBG REJECT, F : RHQ REJECT, G : HDO REJECT )
					ELSE
						'N'						--// INACT REQ. 요청한 이력이 있을 경우, RECALC 불가
				END
		END RECALC_YN
		
  FROM  DMT_CHG_CALC T1
 WHERE  T1.SYS_AREA_GRP_ID     = @[svr_id]
   AND  T1.CNTR_NO             = @[cntr_no]
   AND  T1.CNTR_CYC_NO         = @[cntr_cyc_no]
   AND  T1.DMDT_TRF_CD         = @[dmdt_trf_cd]
   AND  T1.DMDT_CHG_LOC_DIV_CD = @[dmdt_chg_loc_div_cd]
   AND  T1.CHG_SEQ             = @[chg_seq]			]]></sql>
			<params>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="svr_id" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="cntr_cyc_no" type="12" value="" out="N"/>
				<param name="dmdt_trf_cd" type="12" value="" out="N"/>
				<param name="dmdt_chg_loc_div_cd" type="12" value="" out="N"/>
				<param name="chg_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
