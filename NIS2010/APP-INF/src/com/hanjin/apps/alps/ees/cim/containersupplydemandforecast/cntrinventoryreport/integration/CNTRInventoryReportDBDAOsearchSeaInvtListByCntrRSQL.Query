<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CNTRInventoryReportDBDAOsearchSeaInvtListByCntrRSQL">
			<desc><![CDATA[sea CNTR list 목록


Ticket ID : CHM-201007040-01
Title : SEA Inventory 화면의 CMDT 추가
설계자 : 이영두 / 개발자 : 이상민
period : 2010.11.12 ~ 2010.11.16 

내용 : 
1. SEA Inventory 검색조건 CMDT추가, 빠른Grid "Speed"옵션 추가
2. 3번째 탭 CNTR List 외 탭에서 CMDT조건 Hide
3. CMDT 체크시 MST_CONTAINER와 BKG_BOOKING 조인하여 CMDT / REMARK select\

2012.01.15 신자영 [CHM-201215469-01] [CIM] sea-inventory / cntr list 기능 보완
2012.05.03 신자영 [CHM-201217541-01] [CIM] ALPS Inventory-Sea inventory에 제작년도 보여주는 화면]]></desc>
			<sql><![CDATA[
SELECT   
     NVL(A.VVD,'XXXX0000') VVD
    ,A.POL_CD
    ,A.POD_CD
    ,A.CNTR_NO
    ,A.CNTR_TPSZ_CD						
    ,A.FULL_FLG			
    ,A.LSTM_CD					
    ,A.CNMV_DT
    ,A.DEL_CD
    ,A.STAY_DAYS
    ,A.BKG_NO
    ,A.BL_NO

	#if (${view_commodity} == 'Y')
    	,(SELECT D.CMDT_NM FROM MDM_COMMODITY D
    	  WHERE   A.CMDT_CD = D.CMDT_CD
    	 ) REP_CMDT_NM
    	,(SELECT REPLACE(SUBSTR(X.CNTR_MF_GDS_DESC,1,100),CHR(13)||chr(10),' ') MK_DESC
    		FROM BKG_CNTR_MF_DESC X
    	   WHERE A.BKG_NO = X.BKG_NO
    	   AND A.CNTR_NO=X.CNTR_NO
           AND ROWNUM=1
         ) MK_DESC
    #end

	,DECODE(A.DMG_FLG,'Y',A.DMG_FLG,'') DMG_FLG
	,(SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL WHERE INTG_CD_ID='CD02012' AND INTG_CD_VAL_CTNT=A.CNTR_HNGR_RCK_CD) CNTR_HNGR_RCK_CD
	,A.MNR_HNGR_BAR_TP_CD
	,A.CNTR_HNGR_BAR_ATCH_KNT
	,DECODE(A.DISP_FLG,'Y',A.DISP_FLG,'') DISP_FLG
	,DECODE(A.IMDT_EXT_FLG,'Y',A.IMDT_EXT_FLG,'') IMDT_EXT_FLG
	,A.AGMT_CTY_CD||A.AGMT_SEQ AGMT_NO
	,TO_CHAR(A.VPS_ETA_DT, 'YYYY-MM-DD HH24:MI:SS') POD_ETA
	,TO_CHAR(A.MFT_DT, 'YYYY-MM-DD') MFT_DT
    ,A.LESSOR
FROM 
(
	SELECT  /*+ ORDERED USE_NL(A B C) */
         A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD VVD
        ,A.CNTR_NO
        ,A.CNTR_TPSZ_CD
        ,DECODE(A.FULL_FLG,'Y','F','M') FULL_FLG
        ,A.LSTM_CD
        ,DECODE(@[route_tp_cd],'B',B.POL_NOD_CD,A.CRNT_YD_CD) POL_CD
        ,TO_CHAR(A.CNMV_DT,'YYYY-MM-DD') CNMV_DT
        ,NVL(DECODE(@[route_tp_cd],'B',SUBSTR(B.POD_NOD_CD,1,5),SUBSTR(C.POD_YD_CD,1,5)),'XXXXX') POD_CD
        ,B.DEL_CD
        ,(TRUNC(SYSDATE) - TRUNC(CNMV_DT) + 1) STAY_DAYS
        ,A.BKG_NO
        ,B.BL_NO
        ,A.DMG_FLG
		,A.CNTR_HNGR_RCK_CD
		,A.MNR_HNGR_BAR_TP_CD
        ,NVL(A.CNTR_HNGR_BAR_ATCH_KNT,0) CNTR_HNGR_BAR_ATCH_KNT
        ,A.DISP_FLG
        ,A.IMDT_EXT_FLG
		,B.CMDT_CD
		,A.AGMT_CTY_CD
		,A.AGMT_SEQ
		,D.VPS_ETA_DT
		,A.MFT_DT
        ,(SELECT X.VNDR_ABBR_NM
	    FROM MDM_VENDOR X
	    WHERE A.VNDR_SEQ = X.VNDR_SEQ) LESSOR
    FROM MST_CONTAINER A
        ,BKG_BOOKING B
        ,BKG_VVD C
        ,VSK_VSL_PORT_SKD D
    WHERE A.ACIAC_DIV_CD='A'
    AND   A.CNMV_STS_CD='VL'
    AND A.BKG_NO = B.BKG_NO(+)
    AND A.BKG_NO = C.BKG_NO(+)
    AND A.VSL_CD = C.VSL_CD(+)
    AND A.SKD_VOY_NO = C.SKD_VOY_NO(+)
    AND A.SKD_DIR_CD = C.SKD_DIR_CD(+)
	AND C.VSL_CD = D.VSL_CD(+)
	AND C.SKD_VOY_NO = D.SKD_VOY_NO(+)
	AND C.SKD_DIR_CD = D.SKD_DIR_CD(+)
	AND C.POD_CD = D.VPS_PORT_CD(+)
	AND D.CLPT_IND_SEQ(+) = 1

	#if(${off_hire_flg} != '')
	AND (
                 ( A.LSTM_CD = 'LT' AND NVL(A.min_onh_dys,0) > 0
                   AND  TRUNC(SYSDATE) > TRUNC(A.ONH_DT) + (NVL(A.MIN_ONH_DYS,0) - 1)
                 )
                 OR
                 ( A.LSTM_CD = 'LT' AND NVL(A.min_onh_dys,0) = 0
                     AND  TRUNC(SYSDATE) - ( SELECT /*+ INDEX_DESC (S XPKLSE_AGMT_VER) */ TRUNC(EXP_DT)
                                                                  FROM   LSE_AGMT_VER S
                                                                  WHERE  S.AGMT_CTY_CD = A.AGMT_CTY_CD
                                                                  AND    S.AGMT_SEQ    = A.AGMT_SEQ
                                                                  AND    ROWNUM = 1
                               ) > 0
                 )
                OR
                 ( A.LSTM_CD IN ('ST', 'SI', 'OF', 'MI')
                     AND TRUNC(SYSDATE)  > TRUNC(A.ONH_DT) + (NVL(A.MIN_ONH_DYS,0) - 1)
                 )
            )
	#end
    
    #if (${slan_cd} != '' && ${slan_cd} != 'XXX')
    	AND C.SLAN_CD = @[slan_cd]
    #end

    #if (${cntr_tpsz_cd} != '')
    	AND A.CNTR_TPSZ_CD IN ( 
    		  				 SELECT COLUMN_VALUE
        	                 FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[cntr_tpsz_cd] ) AS listItemType ) 
            	             FROM dual )
    				        )
    #end

    #if (${imdt_ext_flg} != '')
        AND A.IMDT_EXT_FLG =@[imdt_ext_flg]
    #end

    #if (${plst_flr_flg} != '')
        AND A.PLST_FLR_FLG =@[plst_flr_flg]
    #end
    
    #if ( ${slan_cd} =='XXX' ) --vvd정보가 없을시 
        AND UPPER(nvl(A.VSL_CD,'xxxx')||nvl(A.SKD_VOY_NO,'0000')||nvl(A.SKD_DIR_CD,'x')) ='XXXX0000X'
	#end

    #if (${vvd1} != '' || ${vvd2} != '' || ${vvd3} != '') 
        #if (${vvd1} == 'XXXX0000' || ${vvd2} != 'XXXX0000' || ${vvd3} != 'XXXX0000') 
            AND UPPER(nvl(A.VSL_CD,'xxxx')||nvl(A.SKD_VOY_NO,'0000')||A.SKD_DIR_CD) IN ( @[vvd1],@[vvd2],@[vvd3])
        #else
            AND (A.VSL_CD,A.SKD_VOY_NO,A.SKD_DIR_CD) IN ( (SUBSTR(@[vvd1],1,4),SUBSTR(@[vvd1],5,4),SUBSTR(@[vvd1],9,1)), (SUBSTR(@[vvd2],1,4),SUBSTR(@[vvd2],5,4),SUBSTR(@[vvd2],9,1)), (SUBSTR(@[vvd3],1,4),SUBSTR(@[vvd3],5,4),SUBSTR(@[vvd3],9,1)) )
        #end
    #end    

    #if (${lstm_cd} != '')
    	AND A.LSTM_CD IN ( 
    		  				 SELECT COLUMN_VALUE
        	                 FROM TABLE ( SELECT cast( CIM_IN_LIST_FNC( @[lstm_cd] ) AS listItemType ) 
            	             FROM dual )
    				        )
    #end  
    
    #if (${cntr_no} != '')
    	AND SUBSTR(A.CNTR_NO,0,4) = @[cntr_no]
    #end  
    
    #if (${pol_cd} != '')
        AND DECODE(@[route_tp_cd],'B',B.POL_CD,SUBSTR(A.CRNT_YD_CD,1,5)) = @[pol_cd]
    #end  
    #if (${pod_cd} != '')
        AND NVL(DECODE(@[route_tp_cd],'B',SUBSTR(B.POD_NOD_CD,1,5),SUBSTR(C.POD_YD_CD,1,5)),'XXXXX') = @[pod_cd]
    #end  
    #if (${del_cd} != '')
        AND B.DEL_CD = @[del_cd]
    #end  
    
	#if (${stay_days} != '')
		AND TRUNC(SYSDATE) - TRUNC(CNMV_DT) + 1 > = @[stay_days]
    #end  

    #if (${cntr_use_co_cd} != '')
    	AND A.CNTR_USE_CO_CD = @[cntr_use_co_cd]
    #end  
    
    #if (${full_flg} != '')
    	AND A.FULL_FLG = @[full_flg]
    #end

    #if (${dmg_flg} != '')
    	AND A.DMG_FLG = @[dmg_flg]
    #end  
    
    #if (${rf_tp_cd_c} != '' || ${rf_tp_cd_h} != '' || ${rf_cntr} != '' || ${rd_cgo_flg} != '')
        AND A.CNTR_TPSZ_CD LIKE 'R%'
    #end  

    #if (${rf_tp_cd_c} != '' || ${rf_tp_cd_h} != '')
        AND A.RF_TP_CD IN(@[rf_tp_cd_c],@[rf_tp_cd_h])
    #end  

	#if (${rd_cgo_flg} != '' || ${rf_cntr} != '')
        AND B.RD_CGO_FLG IN(@[rf_cntr],@[rd_cgo_flg])
    #end      
    
    #if (${cntr_hngr_rck_cd} != '')
    	AND (A.CNTR_HNGR_RCK_CD IS NOT NULL OR  A.CNTR_HNGR_BAR_ATCH_KNT > 0)
    #end

    #if (${disp_flg} != '')
    	AND A.DISP_FLG = @[disp_flg]
    #end
    #if (${d2_payld_flg} != '')
		AND A.CNTR_TPSZ_CD ='D2'
    	AND A.D2_PAYLD_FLG = @[d2_payld_flg]
    #end
    #if (${soc_cd} != '')
    	#if (${soc_cd} == '1')
    		AND A.LSTM_CD <> 'SH'
    	#else
    		AND A.LSTM_CD = 'SH'
    	#end
    #end
) A
ORDER BY A.VVD,A.CNTR_NO,A.CNTR_TPSZ_CD			]]></sql>
			<params>
				<param name="route_tp_cd" type="12" value="" out="N"/>
				<param name="slan_cd" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="imdt_ext_flg" type="12" value="" out="N"/>
				<param name="plst_flr_flg" type="12" value="" out="N"/>
				<param name="vvd1" type="12" value="" out="N"/>
				<param name="vvd2" type="12" value="" out="N"/>
				<param name="vvd3" type="12" value="" out="N"/>
				<param name="lstm_cd" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
				<param name="stay_days" type="12" value="" out="N"/>
				<param name="cntr_use_co_cd" type="12" value="" out="N"/>
				<param name="full_flg" type="12" value="" out="N"/>
				<param name="dmg_flg" type="12" value="" out="N"/>
				<param name="rf_tp_cd_c" type="12" value="" out="N"/>
				<param name="rf_tp_cd_h" type="12" value="" out="N"/>
				<param name="rf_cntr" type="12" value="" out="N"/>
				<param name="rd_cgo_flg" type="12" value="" out="N"/>
				<param name="disp_flg" type="12" value="" out="N"/>
				<param name="d2_payld_flg" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
