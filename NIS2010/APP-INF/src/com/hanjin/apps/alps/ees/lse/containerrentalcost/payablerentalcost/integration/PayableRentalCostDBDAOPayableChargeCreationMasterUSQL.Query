<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PayableRentalCostDBDAOPayableChargeCreationMasterUSQL">
			<desc><![CDATA[Payable Rental Charge Creation : Master Data Charge Amount Update]]></desc>
			<sql><![CDATA[
UPDATE LSE_PAY_RNTL_CHG
SET    (  TTL_COST_AMT
        , CR_TTL_AMT
        , LR_COST_AMT
--        , PAY_RNTL_COST_AMT
        , INV_NO )
     = ( SELECT NVL(A.TTL_COST_AMT, 0)
              , NVL(A.CR_COST_AMT,  0)
              , NVL(B.DSCR_COST_AMT, 0)
--              , NVL(B.DSCR_COST_AMT, 0) + NVL(A.CR_COST_AMT, 0)
              , B.INV_NO
         FROM   ( SELECT AGMT_CTY_CD
                       , AGMT_SEQ
                       , SUM(TTL_COST_AMT) AS TTL_COST_AMT
                       , SUM(CR_AMT)       AS CR_COST_AMT
                  FROM   LSE_PAY_RNTL_CHG_DTL
                  WHERE  CHG_SEQ     = @[chg_seq]
                  AND    AGMT_SEQ    = @[agmt_seq]
                  AND    AGMT_CTY_CD = @[agmt_cty_cd]
                  GROUP  BY AGMT_CTY_CD
                          , AGMT_SEQ ) A
               , ( SELECT AGMT_CTY_CD
                        , AGMT_SEQ
                        , MAX(INV_NO)       AS INV_NO
                        , SUM(TTL_COST_AMT) AS DSCR_COST_AMT
                   FROM   LSE_PAY_RNTL_CHG_CO
                   WHERE  CO_COST_YRMON = @[chg_cost_yrmon]
                   AND    AGMT_SEQ      = @[agmt_seq]
                   AND    AGMT_CTY_CD   = @[agmt_cty_cd] 
                   GROUP  BY AGMT_CTY_CD
                           , AGMT_SEQ ) B
               , ( SELECT @[agmt_cty_cd] AS AGMT_CTY_CD
                        , @[agmt_seq]    AS AGMT_SEQ
                   FROM   DUAL ) C
         WHERE    C.AGMT_CTY_CD = B.AGMT_CTY_CD(+)
         AND      C.AGMT_SEQ    = B.AGMT_SEQ(+)
         AND      C.AGMT_CTY_CD = A.AGMT_CTY_CD(+)
         AND      C.AGMT_SEQ    = A.AGMT_SEQ(+)
       )
WHERE  CHG_SEQ     = @[chg_seq]
AND    AGMT_SEQ    = @[agmt_seq]
AND    AGMT_CTY_CD = @[agmt_cty_cd]			]]></sql>
			<params>
				<param name="chg_seq" type="2" value="" out="N"/>
				<param name="agmt_seq" type="2" value="" out="N"/>
				<param name="agmt_cty_cd" type="12" value="" out="N"/>
				<param name="chg_cost_yrmon" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
