<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="LongTxContainerMovementFinderDBDAOgetUpdateRatioDetailRSQL">
			<desc><![CDATA[MVMT Timely Update Ratio 의 DETAIL
--------------------------------------------------------
History
2010.08.18 나상보 [CHM-201005413-01] MVNT timely update ratio 기능보완
                  : [EES_CTM_0418] 1. LCC 선택시 Yard 단위로 Download 가능 하도록 처리
					             2. 검색 조건 추가 (mvmt status 멀티 선택 가능)
2010.09.09 김상수 [CHM-201006478-01] Full/Mty Option기능 추가 (Movement 적시 update 비율 및 row data를 조회하는 화면)
                  1.Movement 적시 update 비율 및 row data를 조회하는 화면에 Full/Mty Option기능 추가
                    ->Service Management > CNTR Movement > Monitoring > MVMT Timely Update Ratio
                  2. Default 값은 All 로 하고, 필요시 Full 혹은 Mty별 조회 기능 추가
]]></desc>
			<sql><![CDATA[
SELECT CNTR_NO,
       CNTR_TPSZ_CD,
       MVMT_STS_CD,
       OB_CNTR_FLG,
       MVMT_INP_TP_CD,
       ORG_YD_CD,
       CNMV_EVNT_DT,
       CRE_LOCL_DT,
       ROUND (OFFSET_DATE, 1) AS OFFSET_DT,
	   USR_NM
  FROM (SELECT CNTR_NO,
               CNTR_TPSZ_CD,
               MVMT_STS_CD,
               OB_CNTR_FLG,
               MVMT_INP_TP_CD,
               ORG_YD_CD,
               CNMV_EVNT_DT,
               CRE_LOCL_DT,
               OFFSET_DT,
               OFFSET_DATE,
               CASE WHEN OFFSET_DT <= 0.5 THEN 1 ELSE 0 END AS OFF_12,
               CASE WHEN OFFSET_DT > 2 THEN 1 ELSE 0 END AS OVR_48,
               CASE WHEN OFFSET_DT > 0.5 AND OFFSET_DT <= 1 THEN 1 ELSE 0 END AS OFF_24,
               CASE WHEN OFFSET_DT > 1 AND OFFSET_DT <= 2 THEN 1 ELSE 0 END AS OFF_48,
			   USR_NM
          FROM (SELECT CNTR_NO,
                       CNTR_TPSZ_CD,
                       MVMT_STS_CD,
                       OB_CNTR_FLG,
                       MVMT_INP_TP_CD,
                       ORG_YD_CD,
                       TO_CHAR (CNMV_EVNT_DT, 'YYYY-MM-DD HH24:MI') AS CNMV_EVNT_DT,
                       TO_CHAR (CRE_LOCL_DT, 'YYYY-MM-DD HH24:MI') CRE_LOCL_DT,
                       (CRE_LOCL_DT - CNMV_EVNT_DT) AS OFFSET_DT,
                       (CRE_LOCL_DT - CNMV_EVNT_DT) * 24 AS OFFSET_DATE,
					   USR_NM
                  FROM CTM_MOVEMENT
                 WHERE 1 = 1
              #if (${rcc_cd} != '')
                   AND SYS_AREA_GRP_ID =
                          (SELECT SYS_AREA_GRP_ID
                             FROM COM_SYS_AREA_GRP_ID
                            WHERE CNT_CD = SUBSTR (@[rcc_cd], 0, 2)
                              AND SUBSTR (SYS_AREA_GRP_ID, 0, 1) != 'D')
              #else
                   AND SYS_AREA_GRP_ID IN ('USA', 'SWA', 'KOR', 'EUR', 'CHN')
              #end
              #if (${dom_flg} == 'I')
                   AND SUBSTR (MVMT_STS_CD, 0, 1) != 'C'
              #elseif (${dom_flg} == 'D')
                   AND SUBSTR (MVMT_STS_CD, 0, 1) = 'C'
              #end
                   AND CNMV_EVNT_DT BETWEEN TO_DATE (@[p_date1], 'YYYY-MM-DD') AND TO_DATE (@[p_date2], 'YYYY-MM-DD') + 0.99999
                   AND ORG_YD_CD = @[p_yard]
                   AND (NVL(MVMT_CRE_TP_CD, 'XX') = 'XX'
						OR MVMT_CRE_TP_CD IN ('N', 'M', 'S', 'B'))
              #if (${edi_type} == 'S')
                   AND MVMT_INP_TP_CD = 'SPP'
              #elseif (${edi_type} == 'E')
                   AND MVMT_INP_TP_CD = 'EDI'
              #elseif (${edi_type} == 'M')
                   AND MVMT_INP_TP_CD = 'MAN'
              #end
              #if (${sts_cd} != '')
                   AND MVMT_STS_CD IN (${sts_cd})
              #end
              #if (${fcntr_flg} != '')
                   AND FCNTR_FLG = @[fcntr_flg]
              #end
               ) CTM,
               MDM_LOCATION LOC,
               MDM_EQ_ORZ_CHT EQ
         WHERE LOC.SCC_CD = EQ.SCC_CD
           AND LOC.LOC_CD = SUBSTR (CTM.ORG_YD_CD, 0, 5)
      #if (${rcc_cd} != '')
           AND EQ.RCC_CD = @[rcc_cd]
      #end
      #if (${lcc_cd} != '')
           AND EQ.LCC_CD = @[lcc_cd]
      #end
       )
 WHERE 1 = 1
#if (${gap} == '12')
   #if (${time_off} == '1')
     AND OFF_12 = '1'
   #elseif (${time_off} == '5')
     AND 1 = 1
   #else
     AND OFF_12 != '1'
   #end
#elseif (${gap} == '24')
   #if (${time_off} == '2')
      AND (OFF_12 = '1' OR OFF_24 = '1')
   #elseif (${time_off} == '5')
      AND 1 = 1
   #else
      AND (OFF_12 != '1' AND OFF_24 != '1')
   #end
#elseif (${gap} == '48')
   #if (${time_off} == '3')
      AND (OFF_12 = '1' OR OFF_24 = '1' OR OFF_48 = '1')
   #elseif (${time_off} == '5')
      AND 1 = 1
   #else
      AND (OFF_12 != '1' AND OFF_24 != '1' AND OFF_48 != '1')
   #end
#else
   #if (${time_off} == '1')
      AND OFF_12 = '1'
   #elseif (${time_off} == '2')
      AND OFF_24 = '1'
   #elseif (${time_off} == '3')
      AND OFF_48 = '1'
   #elseif (${time_off} == '4')
      AND OVR_48 = '1'
   #else
      AND 1 = 1
   #end
#end			]]></sql>
			<params>
				<param name="rcc_cd" type="12" value="" out="N"/>
				<param name="p_date1" type="12" value="" out="N"/>
				<param name="p_date2" type="12" value="" out="N"/>
				<param name="p_yard" type="12" value="" out="N"/>
				<param name="fcntr_flg" type="12" value="" out="N"/>
				<param name="lcc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
