<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PerformanceReportDBDAOsearchDisposalPFMCByEqDetailListRSQL">
			<desc><![CDATA[장비별 매각실적 상세목록을 조회합니다.
--------------------------------------------------------
History
2011.11.30 남궁진호 [CHM-201007327-01]   Disposal Performance를 장비별 Detail 내역 조회
2011.11.21 김상수 [CHM-201114548-01] sheet에 새로 추가된 DB컬럼 Book Vale 조회 추가
2012.07.16 김창헌 [CHM-201218975-01] EQ TP/SZ 조건 추가
2013.01.03 조경완 [CHM-201218975-01] ALPS MNR-DISPOSAL-DISPOSAL PERFORMANCE-BY EQ에서 OVER DAY LOGIC 변경 요청]]></desc>
			<sql><![CDATA[
SELECT A.RHQ_CD,
       A.RQST_OFC_CD,
       A.APRO_OFC_CD,
       A.DISP_PKUP_ST_DT,
       A.DISP_PKUP_END_DT,
       TO_CHAR(A.CRE_DT, 'YYYY-MM-DD') AS CRE_DT,
       A.OVER_DATE AS OVER_DATE,
       A.EQ_KND_CD,
       A.EQ_NO,
       A.EQ_TPSZ_CD,
       A.MANU_DT,
       A.DISP_TP_CD,
       A.DISP_NO,
       A.DISP_DTL_SEQ,
       TO_CHAR(A.DISP_SOLD_DT, 'YYYY-MM-DD') AS DISP_SOLD_DT,
       A.CUST_CD,
       A.CUST_NM,
       B.RCC_CD,
       B.LCC_CD,
       B.SCC_CD,
       B.LOC_CD,
       A.DISP_YD_CD,
       (SELECT MNR_CD_DP_DESC
          FROM MNR_GEN_CD
         WHERE PRNT_CD_ID = 'CD00038'
           AND MNR_CD_ID = A.DISP_RSN_CD) AS DISP_RSN_CD,
       A.CURR_CD,
       A.PART_AMT,
       A.CAL_PART_AMT,
       A.DISP_UT_PRC,
       A.DISP_TRF_UT_PRC,
       A.DISP_VRFY_TP_CD,
       (SELECT MNR_CD_DP_DESC
          FROM MNR_GEN_CD
         WHERE PRNT_CD_ID = 'CD00080'
           AND MNR_CD_ID = A.DISP_VRFY_TP_CD) AS DISP_VRFY_TP_NM,
       CASE
          WHEN A.DISP_RSN_CD != 'C'
             THEN A.RPR_COST_AMT
       END AS RPR_COST_AMT,
       A.BK_VAL_AMT,
	   A.INV_NO,
	   TO_CHAR(A.ISS_DT, 'YYYY-MM-DD') AS ISS_DT
  FROM (SELECT A.DISP_NO,
               B.DISP_SOLD_DT,
               B.CRE_DT,
               A.EQ_KND_CD,
               A.DISP_TP_CD,
               A.RQST_OFC_CD,
               A.CURR_CD,
               MNR_COMMON_PKG.MNR_GET_RHQ_OFC_FNC(A.RQST_OFC_CD) AS RHQ_CD,
               TO_CHAR(A.DISP_PKUP_ST_DT, 'YYYY-MM-DD') AS DISP_PKUP_ST_DT,
               TO_CHAR(A.DISP_PKUP_END_DT, 'YYYY-MM-DD') AS DISP_PKUP_END_DT,
               TO_CHAR(A.DISP_PKUP_ST_DT, 'YYYYMMDD') AS DISP_PKUP_ST_DT_VAL,
               A.DISP_PKUP_END_DT AS DISP_PKUP_END_DT_VAL,
               A.APRO_OFC_CD,
               B.DISP_DTL_SEQ,
               B.EQ_TPSZ_CD,
               B.DISP_QTY,
               B.PART_AMT,
               B.DISP_YD_CD,
               MNR_COMMON_PKG.MNR_CAL_CURR_RATE_FNC(TO_CHAR(B.DISP_SOLD_DT, 'YYYYMM'), A.CURR_CD, 'USD', B.PART_AMT) AS CAL_PART_AMT,
               D.MANU_DT,
               CASE
                  WHEN B.MNR_PRNR_SEQ IS NOT NULL
                     THEN MNR_COMMON_PKG.MNR_CONV_PARTNER_CD_FNC(B.MNR_PRNR_SEQ, B.MNR_PRNR_CNT_CD)
                  WHEN B.NIS_PRNR_VNDR_SEQ IS NOT NULL
                     THEN MNR_COMMON_PKG.MNR_CONV_PARTNER_CD_FNC(B.NIS_PRNR_VNDR_SEQ, B.NIS_PRNR_CNT_CD)
                  ELSE
                     'ZZ999999'
               END AS CUST_CD,
               CASE
                  WHEN B.MNR_PRNR_SEQ IS NOT NULL
                     THEN C.MNR_PRNR_LGL_ENG_NM
                  WHEN B.NIS_PRNR_VNDR_SEQ IS NOT NULL
                     THEN B.NIS_PRNR_VNDR_ABBR_NM
                  ELSE
                     'Anonymous Buyer'
               END AS CUST_NM,
               B.EQ_NO,
               B.DISP_RSN_CD,
               B.DISP_UT_PRC,
               B.DISP_TRF_UT_PRC,
               D.RPR_COST_AMT,
               CASE
                  WHEN B.DISP_VRFY_TP_CD IS NOT NULL
                     THEN B.DISP_VRFY_TP_CD
                  WHEN B.DISP_RSN_CD != 'C'
                     THEN 'DA'
                  WHEN B.DISP_TRF_UT_PRC IS NULL
                     THEN 'NT'
                  WHEN B.DISP_UT_PRC >= B.DISP_TRF_UT_PRC
                     THEN 'SS'
                  WHEN B.DISP_UT_PRC < B.DISP_TRF_UT_PRC
                     THEN 'UP'
               END AS DISP_VRFY_TP_CD,
               B.BK_VAL_AMT,
			   B.INV_NO,
		       E.ISS_DT,
			   TO_CHAR(TO_DATE(TO_CHAR(B.DISP_SOLD_DT, 'YYYYMMDD'), 'YYYYMMDD') - TO_DATE(TO_CHAR(E.ISS_DT, 'YYYYMMDD'), 'YYYYMMDD')) AS OVER_DATE
          FROM MNR_DISP_HDR A,
               MNR_DISP_DTL B,
               MNR_PARTNER C,
               MNR_EQ_STS_V D,
               MNR_RCV_INV_WRK E
         WHERE A.DISP_NO = B.DISP_NO
           AND A.EQ_KND_CD = D.EQ_TYPE
           AND B.EQ_NO = D.EQ_NO
           AND B.EQ_TPSZ_CD = D.EQ_TPSZ_CD
           AND B.MNR_PRNR_CNT_CD = C.MNR_PRNR_CNT_CD(+)
           AND B.MNR_PRNR_SEQ = C.MNR_PRNR_SEQ(+)
           AND B.DISP_SOLD_DT IS NOT NULL
		   AND B.INV_NO = E.INV_NO) A,

       (SELECT A.LOC_CD,
               A.RGN_CD,
               A.SCC_CD,
               A.EQ_CTRL_OFC_CD,
               C.LCC_CD,
               C.ECC_CD,
               C.RCC_CD
          FROM MDM_LOCATION A,
               MDM_EQ_ORZ_CHT C
         WHERE A.SCC_CD = C.SCC_CD) B

 WHERE SUBSTR(A.DISP_YD_CD, 1, 5) = B.LOC_CD
   AND A.DISP_SOLD_DT BETWEEN TO_DATE(@[p_str_evnt_dt], 'YYYY-MM-DD') AND TO_DATE(@[p_end_evnt_dt], 'YYYY-MM-DD') + 0.99999
#if (${p_str_cre_dt} != '' && ${p_end_cre_dt} != '')
   AND A.CRE_DT BETWEEN TO_DATE(@[p_str_cre_dt], 'YYYY-MM-DD') AND TO_DATE(@[p_end_cre_dt], 'YYYY-MM-DD') + 0.99999
#end
#if (${p_eq_knd_cd} != '' )
   AND A.EQ_KND_CD = @[p_eq_knd_cd]
#end
#if (${eq_tpsz_cd} != '' )
   AND A.EQ_TPSZ_CD IN (
      #foreach ($user_tpszCds IN ${tpszCds})
         #if($velocityCount < $tpszCds.size())
            '$user_tpszCds',
         #else
            '$user_tpszCds'
         #end
      #end
   )
#end
#if (${p_disp_tp_cd} != '' )
   AND A.DISP_TP_CD = @[p_disp_tp_cd]
#end
#if (${p_disp_rsn_cd} != '' )
   AND A.DISP_RSN_CD = @[p_disp_rsn_cd]
#end
#if (${p_cust_cd} != '')
   AND A.CUST_CD = @[p_cust_cd]
#end
#if (${p_loc_cd} != '')
   #if (${p_loc_tp} == 'RCC')
   AND B.RCC_CD = @[p_loc_cd]
   #elseif (${p_loc_tp} == 'LCC')
   AND B.LCC_CD = @[p_loc_cd]
   #else
   AND B.SCC_CD = @[p_loc_cd]
   #end
#end
ORDER BY A.DISP_NO,
         A.DISP_DTL_SEQ,
         A.DISP_SOLD_DT,
         A.EQ_TPSZ_CD,
         A.EQ_NO			]]></sql>
			<params>
				<param name="p_str_evnt_dt" type="12" value="" out="N"/>
				<param name="p_end_evnt_dt" type="12" value="" out="N"/>
				<param name="p_str_cre_dt" type="12" value="" out="N"/>
				<param name="p_end_cre_dt" type="12" value="" out="N"/>
				<param name="p_eq_knd_cd" type="12" value="" out="N"/>
				<param name="p_disp_tp_cd" type="12" value="" out="N"/>
				<param name="p_disp_rsn_cd" type="12" value="" out="N"/>
				<param name="p_cust_cd" type="12" value="" out="N"/>
				<param name="p_loc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
