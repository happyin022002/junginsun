<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ProductCatalogCreateDBDAOSearchSameRoutSceRSQL">
			<desc><![CDATA[searchSameRoutSce]]></desc>
			<sql><![CDATA[
SELECT PCTL_NO
FROM 
(
    SELECT H.PCTL_NO, 
           NVL(BC.RCV_TERM_CD,M.BKG_RCV_TERM_CD)  BKG_RCV_TERM_CD, 
           NVL(BC.DE_TERM_CD,M.BKG_DE_TERM_CD)    BKG_DE_TERM_CD 
    FROM SCE_COP_HDR H,PRD_PROD_CTL_MST M,SCE_COP_DTL PU, SCE_COP_DTL RTN, BKG_CONTAINER BC, PRD_PROD_CTL_ROUT_DTL O,PRD_PROD_CTL_ROUT_DTL I
    WHERE H.BKG_NO = @[bkg_no]
    AND NVL(H.UMCH_STS_CD,'N') <> 'Y'
    AND H.PCTL_NO = M.PCTL_NO
    AND H.CNTR_NO = BC.CNTR_NO(+)
    AND H.BKG_NO = BC.BKG_NO(+)
    AND NVL(H.COP_STS_CD,'N') <> 'X' 
    AND H.COP_NO = PU.COP_NO(+)
    AND PU.ACT_CD(+) = 'MOTYDO'
    AND PU.ACT_DT(+) IS NOT NULL
    AND H.COP_NO = RTN.COP_NO(+)
    AND RTN.ACT_CD(+) = 'MITYAD'   
    AND RTN.ACT_DT(+) IS NOT NULL 
    AND H.PCTL_NO = O.PCTL_NO
    AND O.PCTL_SEQ =1
    AND H.PCTL_NO =I.PCTL_NO
    AND I.PCTL_SEQ = (SELECT /*+ INDEX_DESC (I2 XPKPRD_PROD_CTL_ROUT_DTL)  */ 
                             PCTL_SEQ
                       FROM PRD_PROD_CTL_ROUT_DTL I2
                       WHERE I2.PCTL_NO = I.PCTL_NO
                       AND I2.PCTL_IO_BND_CD ='I'
                       AND ROWNUM =1)
    AND NVL(PRD_GET_INLND_ROUT_STR_FNC(O.ROUT_ORG_NOD_CD,O.ROUT_DEST_NOD_CD,O.ROUT_SEQ),'%') LIKE REGEXP_REPLACE(@[out_str],'-...-','-')||'%'
    AND NVL(PRD_GET_INLND_ROUT_STR_FNC(I.ROUT_ORG_NOD_CD,I.ROUT_DEST_NOD_CD,I.ROUT_SEQ),'%') LIKE REGEXP_REPLACE(@[in_str],'-...-','-')||'%'
    AND NVL(PRD_GET_OCN_LINK_STR_FNC(H.COP_NO),'%') LIKE REGEXP_REPLACE(@[ocn_str],'-...-','-')||'%'
    AND NVL(PU.NOD_CD(+),'N') = NVL(@[mt_pu],NVL(PU.NOD_CD(+),'N'))
    AND NVL(RTN.NOD_CD(+),'N') = NVL(@[mt_rtn],NVL(RTN.NOD_CD(+),'N'))
    AND NVL(H.OB_TRO_FLG,'N') = NVL(@[ob_tro_flg],'N')
    AND NVL(H.IB_TRO_FLG,'N') = NVL(@[ib_tro_flg],'N')
    AND H.POR_NOD_CD = NVL(@[por_nod_cd],H.POR_NOD_CD)
    AND H.POL_NOD_CD = NVL(@[pol_nod_cd],H.POL_NOD_CD)
    AND H.DEL_NOD_CD = NVL(@[del_nod_cd],H.DEL_NOD_CD)
    AND M.FULL_RTN_YD_CD =NVL(@[full_rtn_yd_cd],M.FULL_RTN_YD_CD)
    AND M.FULL_PKUP_YD_CD =NVL(@[full_pkup_yd_cd],M.FULL_PKUP_YD_CD)
    AND NVL(@[ob_trsp_mode],'N') = NVL((SELECT TRSP_MOD_CD 
                                      FROM PRD_INLND_ROUT_MST 
                                      WHERE ROUT_ORG_NOD_CD =  O.ROUT_ORG_NOD_CD
                                      AND  ROUT_DEST_NOD_CD =  O.ROUT_DEST_NOD_CD
                                      AND ROUT_SEQ = O.ROUT_SEQ),'N') 
    AND NVL(@[ib_trsp_mode],'N') = NVL((SELECT TRSP_MOD_CD 
                                      FROM PRD_INLND_ROUT_MST 
                                      WHERE ROUT_ORG_NOD_CD =  I.ROUT_ORG_NOD_CD
                                      AND  ROUT_DEST_NOD_CD =  I.ROUT_DEST_NOD_CD
                                      AND ROUT_SEQ = I.ROUT_SEQ),'N')                       
)
WHERE BKG_RCV_TERM_CD =  @[r_term]
AND BKG_DE_TERM_CD  = @[d_term]
AND ROWNUM =1			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="out_str" type="12" value="" out="N"/>
				<param name="in_str" type="12" value="" out="N"/>
				<param name="ocn_str" type="12" value="" out="N"/>
				<param name="mt_pu" type="12" value="" out="N"/>
				<param name="mt_rtn" type="12" value="" out="N"/>
				<param name="ob_tro_flg" type="12" value="" out="N"/>
				<param name="ib_tro_flg" type="12" value="" out="N"/>
				<param name="por_nod_cd" type="12" value="" out="N"/>
				<param name="pol_nod_cd" type="12" value="" out="N"/>
				<param name="del_nod_cd" type="12" value="" out="N"/>
				<param name="full_rtn_yd_cd" type="12" value="" out="N"/>
				<param name="full_pkup_yd_cd" type="12" value="" out="N"/>
				<param name="ob_trsp_mode" type="12" value="" out="N"/>
				<param name="ib_trsp_mode" type="12" value="" out="N"/>
				<param name="r_term" type="12" value="" out="N"/>
				<param name="d_term" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
