<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RailBillingVerifyManageDBDAOCheckFullContainerStatusFirstDupRSQL">
			<desc><![CDATA[SEN, HJL, HJS RAIL BILLING 중복 CHECK]]></desc>
			<sql><![CDATA[
SELECT 
    EQ_NO,
    MAX(VERIFY_RESULT) VERIFY_RESULT,
    MAX(VERIFY_YN) VERIFY_YN,
    MAX(CXL_RQST) CXL_RQST
FROM 
    (
        SELECT EQ_NO,
        SUBSTR( TO_CHAR(LOCL_CRE_DT, 'YYYYMMDD')|| 'SMLINE - CNTR_NO: ' ||EQ_NO
        ||' S/O created( '||TO_CHAR(LOCL_CRE_DT, 'YYYYMMDD') 
        ||DECODE(TRSP_BND_CD, 'O', ' : Full )', ' : Mty )'
        ||' ROUTE : ' ||FM_NOD_CD||'-->'||TO_NOD_CD), 9, 100) VERIFY_RESULT,
        CASE WHEN SO.TRSP_BND_CD = 'O' THEN 'Y' 
             WHEN SO.TRSP_BND_CD IS NULL THEN 
                    DECODE(SIGN(TRUNC(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC('PHXSA') - LOCL_CRE_DT )-3), -1, 'Y', 0, 'Y', 'N')
        END VERIFY_YN,
        DECODE(SIGN(TRUNC(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC('PHXSA') - SO.CXL_RQST_DT )-1 ), -1, 'Y', 0, 'Y', 'N') CXL_RQST
    FROM 
        TRS_TRSP_RAIL_BIL_ORD SO
    WHERE ( TRSP_BND_CD = 'O'
                OR TRSP_BND_CD IS NULL )
    AND   ( NVL(DELT_FLG, 'N') = 'N'
                OR SO.CXL_RQST_DT IS NOT NULL )
    AND   EQ_NO = @[eqNo]
    AND   LOCL_CRE_DT BETWEEN (GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC('PHXSA') - 15) AND GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC('PHXSA')
    UNION ALL
    SELECT 
        EQ_NO,
        SUBSTR( TO_CHAR(LOCL_CRE_DT, 'YYYYMMDD')|| 'SMLINE - CNTR_NO: ' ||EQ_NO
        ||' S/O created( '||TO_CHAR(LOCL_CRE_DT, 'YYYYMMDD') 
        ||DECODE(TRSP_BND_CD, 'O', ' : Full )', ' : Mty )'
        ||' ROUTE : ' ||FM_NOD_CD||'-->'||TO_NOD_CD), 9, 100) VERIFY_RESULT,
        'Y' VERIFY_YN,
        ''
    FROM 
        TRS_TRSP_RAIL_BIL_ORD SO
    WHERE SO.TRSP_BND_CD = 'I'
    AND   NVL(DELT_FLG, 'N') = 'N'
    AND   EQ_NO = @[eqNo]
    AND   LOCL_CRE_DT BETWEEN (GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC('PHXSA') - 5) AND GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC('PHXSA')
    UNION ALL
    SELECT 
        A.CNTR_NO AS EQ_NO,
        SUBSTR( TO_CHAR(A.CRE_DT, 'YYYYMMDD') 
        || 'DOMESTIC - ' 
        || 'CNTR_NO: ' || A.CNTR_NO ||' S/O created(' || TO_CHAR(A.CRE_DT, 'ddMonrr') 
        || ' : Mty )' 
        || ' ROUTE : ' || A.ROUT_ORG_YD_CD ||'-->' || A.ROUT_DEST_YD_CD, 9, 100) AS VERIFY_RESULT,
        'N' AS VERIFY_YN,
        ''
    FROM 
        DOM_RAIL_SO_MST A
    WHERE NVL(A.DELT_FLG, 'N') = 'N'
    AND   A.CNTR_NO = @[eqNo]
    AND   A.CRE_DT BETWEEN GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC('PHXSA') - 15 AND GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC('PHXSA')    
	)
GROUP BY EQ_NO			]]></sql>
			<params>
				<param name="eqNo" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
