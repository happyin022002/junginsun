<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="USATruckEdiWoAckManageDBDAOsearchWorkOrderDetailRSQL">
			<desc><![CDATA[searchWorkOrderDetail]]></desc>
			<sql><![CDATA[
SELECT DISTINCT so.fm_nod_cd fm_code ,
	   yd1.yd_nm fm_full_name ,
	   yd1.yd_addr fm_address ,
	   yd1.phn_no fm_tel ,
	   yd1.fax_no fm_fax ,
	   yd1.yd_pic_nm fm_pic ,
	   so.via_nod_cd via_code ,
	   yd2.yd_nm via_full_name ,
	   yd2.yd_addr via_address ,
	   yd2.phn_no via_tel ,
	   yd2.fax_no via_fax ,
	   yd2.yd_pic_nm via_pic ,
	   so.to_nod_cd to_code ,
	   yd3.yd_nm to_full_name ,
	   yd3.yd_addr to_address ,
	   yd3.phn_no to_tel ,
	   yd3.fax_no to_fax ,
	   yd3.yd_pic_nm to_pic ,
	   so.dor_nod_cd dor_code ,
	   (select zn_nm from mdm_zone where zn_cd = so.dor_nod_cd) zn_nm ,
	   so.fctry_nm dor_full_name ,
	   so.dor_de_addr dor_address ,
	   so.cntc_pson_phn_no dor_tel ,
	   so.cntc_pson_fax_no dor_fax ,
	   so.cntc_pson_nm dor_pic ,
       to_char(so.edi_snd_dt,'YYYY-MM-DD') as edi_snd_dt ,
       wo.wo_vndr_seq ,
       mv.vndr_lgl_eng_nm as vndr_nm ,
       mv.phn_no ,
       mv.vndr_eml ,
      (select usr_eml
         from com_user
        where usr_id = (select cre_usr_id from trs_trsp_wrk_ord_his where (trsp_wo_ofc_cty_cd, trsp_wo_seq) in ((wo.trsp_wo_ofc_cty_cd, wo.trsp_wo_seq)) and rownum =1)) as usr_eml
	FROM trs_trsp_wrk_ord wo,
	  (
	    SELECT s.trsp_so_ofc_cty_cd ,
	      s.trsp_so_seq ,
	      r.trsp_wo_ofc_cty_cd ,
	      r.trsp_wo_seq ,
	      s.fm_nod_cd ,
	      s.via_nod_cd ,
	      s.to_nod_cd ,
	      s.dor_nod_cd ,
	      s.fctry_nm ,
	      s.dor_de_addr ,
	      s.cntc_pson_phn_no ,
	      s.cntc_pson_fax_no ,
	      s.cntc_pson_nm ,
          s.edi_snd_dt
	    FROM trs_trsp_wrk_ord_rjct_his r,
	         trs_trsp_svc_ord s
	    WHERE r.trsp_so_ofc_cty_cd = s.trsp_so_ofc_cty_cd
	      AND r.trsp_so_seq = s.trsp_so_seq
		  AND (s.trsp_wo_ofc_cty_cd, s.trsp_wo_seq ) IN ((@[trsp_wo_ofc_cty_cd],@[trsp_wo_seq]))
	    UNION ALL
	    SELECT s.trsp_so_ofc_cty_cd ,
	      s.trsp_so_seq ,
	      s.trsp_wo_ofc_cty_cd ,
	      s.trsp_wo_seq ,
	      s.fm_nod_cd ,
	      s.via_nod_cd ,
	      s.to_nod_cd ,
	      s.dor_nod_cd ,
	      s.fctry_nm ,
	      s.dor_de_addr ,
	      s.cntc_pson_phn_no ,
	      s.cntc_pson_fax_no ,
	      s.cntc_pson_nm ,
          s.edi_snd_dt
	    FROM trs_trsp_svc_ord s
	    WHERE s.trsp_wo_ofc_cty_cd IS NOT NULL
	      AND s.trsp_wo_seq IS NOT NULL 
          AND (s.trsp_wo_ofc_cty_cd, s.trsp_wo_seq ) IN ((@[trsp_wo_ofc_cty_cd],@[trsp_wo_seq]))) so ,
	  mdm_yard yd1 ,
	  mdm_yard yd2 ,
	  mdm_yard yd3 ,
      (
       SELECT V1.VNDR_SEQ
            , V1.VNDR_LGL_ENG_NM
            , (SELECT V2.INTL_PHN_NO || PHN_NO
                 FROM MDM_VNDR_CNTC_PNT V2
                WHERE V1.VNDR_SEQ = V2.VNDR_SEQ 
                  AND V2.PRMRY_CHK_FLG = 'Y'  
                  AND V2.CNTC_DIV_CD = 'PHN') AS PHN_NO 
            , (SELECT V2.VNDR_EML
                 FROM MDM_VNDR_CNTC_PNT V2
                WHERE V1.VNDR_SEQ = V2.VNDR_SEQ 
                  AND V2.PRMRY_CHK_FLG = 'Y'  
                  AND V2.CNTC_DIV_CD = 'EMAIL') AS VNDR_EML
         FROM MDM_VENDOR V1
        WHERE V1.DELT_FLG = 'N' 
       ) mv
	WHERE 1 = 1
      AND ( wo.trsp_wo_ofc_cty_cd, wo.trsp_wo_seq ) IN ((@[trsp_wo_ofc_cty_cd],@[trsp_wo_seq]))
	  AND so.fm_nod_cd = yd1.yd_cd(+)
   	  AND so.via_nod_cd = yd2.yd_cd(+)
   	  AND so.to_nod_cd = yd3.yd_cd(+)
      AND wo.wo_vndr_seq = mv.vndr_seq 			]]></sql>
			<params>
				<param name="trsp_wo_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="trsp_wo_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
