<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SpotBidPerformanceReportDBDAOSrchSpotBidPerfRptRSQL">
			<desc><![CDATA[Search Spot Bid Performance Report]]></desc>
			<sql><![CDATA[
#if (${grid_flg} != 'Y') 
SELECT 
'EQ No.'
,'TP/SZ'
,'Org TP/SZ'
,'Cost Mode'
,'Trans Mode'
,'S/O TP'
,'Unplanned'
-- 2012.10.31 Pre-Pull
,'Pre-Pull'
,'CB'
,'Frustrated'
,'S/O No.'
,'S/O CRE DT'
,'S/O DEL'
,'S/O DEL DT'
,'S/O UPD Name'
,'W/O No.'
,'W/O Iss STS'
,'W/O Iss WK'
,'W/O Iss DT'
,'W/O ISS TP'
,'W/O ISS OFC'
,'W/O ISS Name'
,'From'
,'Via'
,'To'
,'Door'
,'Km'
,'R.Link'
,'Bid'
,'Bid No'
,'Due Date'
,'Due Date'
,'Actual Customer'
,'Factory Name'
,'Zip Code'
,'Address'
,'TEL'
,'FAX'
,'PIC'
,'User Info'
,'Time'
,'Time'
,'Type'
,'Code'
,'Name'
,'Code'
,'Name'
,'W/O RCV DT'
,'Appt. Time'
,'Deliv. Time'
,'Receiving'
,'Delivery'
,'3rd Party'
,'Cost OFC'
,'Currency'
,'Basic'
,'Negotiated'
,'Fuel'
,'Vat'
#if (${invar_usrail} != 'Y') 
,'Toll Fee'
#end
,'Additional'
-- 20100806 ADD HZD_MTRL_SCG_AMT, OVR_WGT_SCG_AMT
#if (${invar_usrail} == 'Y') 
,'HZD'
,'OVR'
,'USA Rail Surcharge'
#end
--
,'Total'
,'W/O Amount Total(USD)'
,'Exchange Rate'
,'Calculation Logic'
,'Currency'
,'Basic'
,'Surcharge'
,'Total'
,'Invoice Amount Total(USD)'
,'Code'
,'Name'
,'Invoice No.'
,'INV STS'
,'INV CNFM DT'
,'CSR No.'
,'INV I/F DT'
,'INV OFC'
,'INV User'
,'Invoice Remark'
,'From Departure'
,'To Arrival'
,'Door Arrival'
,'TRO Door Date'
,'COP No.'
,'A/G SEQ'
,'A/G Code'
,'BKG No.'
,'BL No.'
,'BND'
,'Term'
,'SEQ'
,'CNFM'
,'Office'
,'User ID'
,'Time'
,'Rev Curr'
,'Rev Amt'
,'Manifested'
,'Load Ref No'
,'BKG QTY'
,'POR'
,'POL'
,'POD'
,'DEL'
,'T.VVD'
,'Lane'
,'In VVD'
,'In VVD Lane'
,'Out VVD'
,'Out VVD Lane'
,'CGO TP'
,'CNTR SPE'
,'Used'
,'L/T'
,'I.Exit'
,'L/T EXP'
,'Seal No.1'
,'Seal No.2'
,'Weight(KGS)'
,'Weight(LBS)'
,'No of PKG'
,'PKG CD'
,'Commodity DESC'
,'C.LOC'
,'USA Last City'
,'F'
,'O'
,'C'
,'IT No'
,'Pickup No.'
,'PU Yard'
,'Available DT'
,'Last Free DT'
,'S/C No.'
,'RFA No.'
,'Contract Customer Name'
,'Door SVC TP'
,'Pickup CNTR'
,'Shipper'
,'Consignee'
,'Notify'
,'Ref.BKG No'
,'Ref.BL No'
,'Outgate Date'
,'Ingate Date'
,'MTY Reference No'
,'Reason'
,'Internal Remark'
,'Nego. Remark'
-- 2012.10.30 KTKIM 컬럼 추가 start
,'Reason of Node Change'
-- 2012.10.30 KTKIM 컬럼 추가 end
,'Special Instruction'
,'W/O Instruction'
,'CHZ Bundle'
,'Supplement Kind'
#if (${invar_usdropnpull} == 'Y') 
--추가yj
,'Date'
,'Yard'
,'Status'
,'Date'
,'Yard'
,'Status'
,'Date'
,'Yard'
,'WEB Mty'
,'Grace End'
#end
,'GP ID'
,'GP Seq'
,'ETS'
,'HJL Handling Fee'
FROM DUAL
UNION ALL
#end
#if (${invar_usrail} == 'N') 
/* S/O inquiry */
SELECT X.EQ_NO
      ,X.EQ_TPSZ
      ,X.ORG_EQ_TPSZ AS ORG_EQ_TPSZ
      ,X.TRSP_COST_DTL_MOD_CD
      ,X.TRSP_CRR_MOD_CD
      ,(SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL CD WHERE CD.INTG_CD_ID = 'CD00279' AND CD.INTG_CD_VAL_CTNT = X.TRSP_SO_TP_CD) AS TRSP_SO_TP_CD
      ,X.UPLN_SO_FLG
      ,X.PRE_PULL_FLG
      ,(SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL CD WHERE CD.INTG_CD_ID = 'CD00762' AND CD.INTG_CD_VAL_CTNT = X.BKG_CNTR_CMB_SEQ) AS BKG_CNTR_CMB_SEQ
      ,X.TRSP_FRST_FLG
      ,X.SO_NO
      ,X.SO_CRE_DT1
      ,X.SO_DEL_FLG
      ,DECODE (X.SO_DEL_FLG,'Y', SO_UPD_DT) SO_DEL_DT
      ,(SELECT USR_NM FROM COM_USER CU WHERE CU.USR_ID = X.UPD_USR_ID) AS UPD_USR_NM
      ,X.WO_NO
      ,(SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL CD WHERE CD.INTG_CD_ID = 'CD00804' AND CD.INTG_CD_VAL_CTNT = X.WO_ISS_STS_CD) AS WO_ISS_STS_CD
      ,X.WO_ISS_WK
      ,X.WO_ISS_DT
      ,X.WO_ISS_TP
      ,X.WO_ISS_OFC_CD
      ,(SELECT USR_NM FROM COM_USER CU WHERE CU.USR_ID = X.WO_ISS_ID) AS WO_ISS_NM
      ,X.FM_NOD_CD
      ,X.VIA_NOD_CD
      ,X.TO_NOD_CD
      ,X.DOOR
	  ,TO_CHAR(X.TTL_DIST) TTL_DIST
	  ,X.LNK_DIST_DIV_CD
      ,X.SPOT_BID_FLG
      ,X.SPOT_BID_NO
      ,X.SPOT_BID_DUE_DT
      ,X.SPOT_BID_DUE_DT_HMS
      ,CASE WHEN SUBSTR(X.USA_DO_INFO, 1, INSTR(X.USA_DO_INFO, '$', 1, 1) -1) = 'W'
            THEN 'WEB'
            WHEN SUBSTR(X.USA_DO_INFO, 1, INSTR(X.USA_DO_INFO, '$', 1, 1) -1) = 'E'
            THEN 'TRS D/O'
            ELSE X.DOOR_ACT_CUST
       END DOOR_ACT_CUST
	  ,REPLACE(REPLACE(REPLACE(X.DOOR_FCTRY_NM, CHR(13), ' '), CHR(10), ' '), CHR(34), '') AS DOOR_FCTRY_NM
      ,X.DOOR_ZIP
      ,REPLACE(REPLACE(REPLACE(X.DOR_DE_ADDR, CHR(13), ' '), CHR(10), ' '), CHR(34), '') AS DOR_DE_ADDR
      ,X.DOOR_TEL
      ,X.DOOR_FAX
      ,REPLACE(REPLACE(REPLACE(X.DOOR_PIC, CHR(13), ' '), CHR(10), ' '), CHR(34), '') AS DOOR_PIC
      ,CASE WHEN SUBSTR(X.USA_DO_INFO, 1, INSTR(X.USA_DO_INFO, '$', 1, 1) - 1) = 'W' -- IF_SYS_KND_CD
            THEN SUBSTR(X.USA_DO_INFO, INSTR(X.USA_DO_INFO, '$', 1, 2) + 1, INSTR(X.USA_DO_INFO, '$', 1, 3) - INSTR(X.USA_DO_INFO, '$', 1, 2) - 1) -- EMAIL, TEL
            ELSE SUBSTR(X.USA_DO_INFO, INSTR(X.USA_DO_INFO, '$', 1, 3) + 1) -- USER_ID
       END USA_DO_USR_INFO
      ,TO_CHAR(TO_DATE(SUBSTR(X.USA_DO_INFO, INSTR(X.USA_DO_INFO, '$', 1, 1) + 1, INSTR(X.USA_DO_INFO, '$', 1, 2) - INSTR(X.USA_DO_INFO, '$', 1, 1) - 1),'YYYYMMDDHH24MISS'),'YYYY-MM-DD') AS DO_CRE_DATE
      ,TO_CHAR(TO_DATE(SUBSTR(X.USA_DO_INFO, INSTR(X.USA_DO_INFO, '$', 1, 1) + 1, INSTR(X.USA_DO_INFO, '$', 1, 2) - INSTR(X.USA_DO_INFO, '$', 1, 1) - 1),'YYYYMMDDHH24MISS'),'HH24:MI:SS') AS DO_CRE_TIME
      ,X.VNDR_TP_CD
      ,SUBSTR(X.INV_VNDR_INFO, 1, INSTR(X.INV_VNDR_INFO, '$', 1, 1) - 1) AS VNDR_CD
      ,SUBSTR(X.INV_VNDR_INFO, INSTR(X.INV_VNDR_INFO, '$', 1, 1) + 1, INSTR(X.INV_VNDR_INFO, '$', 1, 2) - INSTR(X.INV_VNDR_INFO, '$', 1, 1) - 1) AS VNDR_ABBR_NM
      ,SUBSTR(X.INV_VNDR_INFO, INSTR(X.INV_VNDR_INFO, '$', 1, 2) + 1, INSTR(X.INV_VNDR_INFO, '$', 1, 3) - INSTR(X.INV_VNDR_INFO, '$', 1, 2) - 1) AS PVNDR_CD
      ,SUBSTR(X.INV_VNDR_INFO, INSTR(X.INV_VNDR_INFO, '$', 1, 3) + 1) AS PVNDR_NM
      ,X.WO_RCV_DT
      ,X.APPT_TIME
      ,X.DELIV_TIME
      ,X.WTR_RCV_TERM_CD   
      ,X.WTR_DE_TERM_CD
      ,X.N3PTY_BIL_FLG
      ,CASE WHEN X.COST_OFC_CD_CN IS NOT NULL
            THEN X.COST_OFC_CD_CN
            WHEN X.COST_OFC_CD_M IS NOT NULL
            THEN X.COST_OFC_CD_M
            ELSE X.SO_CRE_OFC_CD
		END COST_OFC_CD
      ,X.WO_CURR_CD
      ,TO_CHAR(X.WO_BZC_AMT) WO_BZC_AMT
      ,TO_CHAR(X.WO_NEGO_AMT) WO_NEGO_AMT
      ,TO_CHAR(X.WO_FUEL_SCG_AMT) WO_FUEL_SCG_AMT
	  ,TO_CHAR(X.WO_VAT_SCG_AMT) WO_VAT_SCG_AMT
      ,TO_CHAR(X.WO_TOLL_FEE_AMT) WO_TOLL_FEE_AMT
      ,TO_CHAR(X.WO_ETC_ADD_AMT) WO_ETC_ADD_AMT --additional 
      ,TO_CHAR(X.WO_TOT_AMT) WO_TOT_AMT
      ,TO_CHAR(X.WO_TOT_AMT_USD) WO_TOT_AMT_USD
      ,TO_CHAR(X.INV_XCH_RT) INV_XCH_RT
      ,(SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL CD WHERE CD.INTG_CD_ID = 'CD00874' AND CD.INTG_CD_VAL_CTNT = X.INV_CALC_LGC_TP_CD) AS INV_CALC_LGC_TP_CD
      ,X.INV_CURR_CD
      ,TO_CHAR(X.INV_BZC_AMT) INV_BZC_AMT
      ,TO_CHAR(X.INV_ETC_ADD_AMT) INV_ETC_ADD_AMT
      ,TO_CHAR(X.INV_TOT_AMT) INV_TOT_AMT
      ,TO_CHAR(X.INV_TOT_AMT_USD) INV_TOT_AMT_USD
      ,TO_CHAR(X.INV_VNDR_SEQ) INV_VNDR_CD
      ,X.INV_VNDR_NM
      ,X.INV_NO
      ,(SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL CD WHERE CD.INTG_CD_ID = 'CD00824' AND CD.INTG_CD_VAL_CTNT = X.INV_STS_CD) AS INV_STS_CD
      ,X.INV_CFM_DT
      ,X.CSR_NO CAR_NO
      ,TO_CHAR (X.IF_DT, 'YYYY-MM-DD HH24:MI:SS') INV_IF_DT
      ,X.INV_CFM_OFC_CD
      ,(SELECT USR_NM FROM COM_USER CU WHERE CU.USR_ID = X.INV_CRE_USR_ID) AS INV_CRE_USR_NM
      ,REPLACE(REPLACE(X.INV_RMK , CHR(13), ' '), CHR(10), ' ') INV_RMK
      ,X.N1ST_NOD_PLN_DT
      ,X.LST_NOD_PLN_DT
      ,X.DOR_NOD_PLN_DT
      ,X.DOR_ARR_DT
      ,X.COP_NO
      ,TO_CHAR(X.AG_SEQ) AG_SEQ
      ,X.AG_CODE
      ,X.BKG_NO
      ,X.BL_NO
      ,X.TRSP_BND_CD
      ,X.TERM
      ,TO_CHAR(X.TRO_SEQ) TRO_SEQ
      ,X.TRO_CNFM
      ,X.TRO_CFM_OFC
      ,X.TRO_CFM_USR
      ,X.TRO_CFM_UPD
      ,X.TRO_REV_CUR
      ,SUBSTR(X.EUR_TRO_INFO, INSTR(X.EUR_TRO_INFO, '$', 1, 1) + 1, INSTR(X.EUR_TRO_INFO, '$', 1, 2) - INSTR(X.EUR_TRO_INFO, '$', 1, 1) - 1) EUR_TRO_REV
      ,SUBSTR(X.EUR_TRO_INFO, 1, INSTR(X.EUR_TRO_INFO, '$', 1, 1) -1) AS MANIFESTED
      ,X.TRO_LOD_REF
      ,TO_CHAR(X.BKG_QTY) BKG_QTY
      ,X.POR_CD POR_CD
      ,X.POL_CD POL_CD
      ,X.POD_CD POD_CD
      ,X.DEL_CD DEL_CD
      ,X.T_VVD
      ,X.SLAN_CD
      ,X.IB_VVD_CD
      ,X.IB_SLAN_CD
      ,X.OB_VVD_CD
      ,X.OB_SLAN_CD
      ,X.CGO_TP_CD
--      ,SUBSTR(X.BKG_CNTR_INFO, INSTR(X.BKG_CNTR_INFO, '$', 1, 2) + 1) AS BKG_SPE
      ,X.SPCL_CGO_CNTR_TP_CD AS BKG_SPE
      ,SUBSTR(X.MST_CNTR_INFO, 1, INSTR(X.MST_CNTR_INFO, '$', 1, 1) -1) AS USED
      ,SUBSTR(X.MST_CNTR_INFO, INSTR(X.MST_CNTR_INFO, '$', 1, 1) + 1, INSTR(X.MST_CNTR_INFO, '$', 1, 2) - INSTR(X.MST_CNTR_INFO, '$', 1, 1) - 1) AS LT
      ,SUBSTR(X.MST_CNTR_INFO, INSTR(X.MST_CNTR_INFO, '$', 1, 2) + 1) AS I_EXIT
      ,X.LSE_CNTR_FLG AS LT_EXP -- 직반납 대상여부 체크 플래그 (TO-BE모델에서 추가된 컬럼)
      ,(SELECT CNTR_SEAL_NO FROM BKG_CNTR_SEAL_NO WHERE BKG_NO  = X.BKG_NO AND CNTR_NO = X.EQ_NO AND CNTR_SEAL_SEQ = 1) AS SEAL_NO
      ,(SELECT CNTR_SEAL_NO FROM BKG_CNTR_SEAL_NO WHERE BKG_NO  = X.BKG_NO AND CNTR_NO = X.EQ_NO AND CNTR_SEAL_SEQ = 2) AS SEAL_NO2
      ,TO_CHAR(X.WEIGHT_KGS) WEIGHT_KGS
      ,TO_CHAR(X.WEIGHT_LBS) WEIGHT_LBS
      ,SUBSTR(X.BKG_CNTR_INFO, 1, INSTR(X.BKG_CNTR_INFO, '$', 1, 1) -1) AS NO_PKG
      ,SUBSTR(X.BKG_CNTR_INFO, INSTR(X.BKG_CNTR_INFO, '$', 1, 1) + 1, INSTR(X.BKG_CNTR_INFO, '$', 1, 2) - INSTR(X.BKG_CNTR_INFO, '$', 1, 1) - 1) PKG_CD
      ,REPLACE(X.CMDT_NM, chr(34), '') AS CMDT_NM
      ,X.C_LOC
      ,X.USA_LAST_CITY
      ,SUBSTR(X.EDI_FOC_INFO, 1, INSTR(X.EDI_FOC_INFO, '$', 1, 1) -1) AS F
      ,SUBSTR(X.EDI_FOC_INFO, INSTR(X.EDI_FOC_INFO, '$', 1, 1) + 1, INSTR(X.EDI_FOC_INFO, '$', 1, 2) - INSTR(X.EDI_FOC_INFO, '$', 1, 1) - 1) AS O
      ,SUBSTR(X.EDI_FOC_INFO, INSTR(X.EDI_FOC_INFO, '$', 1, 2) + 1) AS C
      ,IT_NO
      ,SUBSTR(X.PKUP_INFO, 1, INSTR(X.PKUP_INFO, '$', 1, 1) -1) AS PICKUP_NO
      ,SUBSTR(X.PKUP_INFO, INSTR(X.PKUP_INFO, '$', 1, 1) + 1, INSTR(X.PKUP_INFO, '$', 1, 2) - INSTR(X.PKUP_INFO, '$', 1, 1) - 1) AS PU_YARD_CD
      ,SUBSTR(X.PKUP_INFO, INSTR(X.PKUP_INFO, '$', 1, 2) + 1, INSTR(X.PKUP_INFO, '$', 1, 3) - INSTR(X.PKUP_INFO, '$', 1, 2) - 1) AS AVAILABLE_DT
      ,SUBSTR(X.PKUP_INFO, INSTR(X.PKUP_INFO, '$', 1, 3) + 1, INSTR(X.PKUP_INFO, '$', 1, 4) - INSTR(X.PKUP_INFO, '$', 1, 3) - 1) AS LAST_FREE_DT
      ,SUBSTR(X.BKG_SC_NO_INFO, 1, INSTR(X.BKG_SC_NO_INFO, '$', 1, 1) -1) AS SC_NO
      ,SUBSTR(X.BKG_SC_NO_INFO, INSTR(X.BKG_SC_NO_INFO, '$', 1, 1) + 1) AS RFA_NO
      ,DECODE(TRIM(SUBSTR(X.BKG_SC_NO_INFO, 1, INSTR(X.BKG_SC_NO_INFO, '$', 1, 1) -1)), NULL,
                   (
                    -- RFA 조회
                    SELECT (SELECT MC.CUST_LGL_ENG_NM FROM MDM_CUSTOMER MC WHERE MC.CUST_CNT_CD = A2.CTRT_CUST_CNT_CD AND MC.CUST_SEQ = A2.CTRT_CUST_SEQ) CTRT_CUST_NM
                      FROM PRI_RP_HDR A1
                          ,PRI_RP_MN A2
                          ,PRI_RP_DUR A3
                     WHERE A1.RFA_NO = SUBSTR(X.BKG_SC_NO_INFO, INSTR(X.BKG_SC_NO_INFO, '$', 1, 1) + 1)
                       AND A1.PROP_NO = A2.PROP_NO
                       AND A2.AMDT_SEQ = (
                                         SELECT  /*+ INDEX_DESC(X XPKPRI_SP_MN) */
                                                AMDT_SEQ
                                           FROM PRI_RP_MN X
                                          WHERE PROP_NO = A1.PROP_NO
                                            AND PROP_STS_CD = 'A'
                                            AND ROWNUM = 1)
                       AND A2.PROP_NO  = A3.PROP_NO
                       AND A2.AMDT_SEQ = A3.AMDT_SEQ
                   ),
                    -- S/C 조회
                   (SELECT (SELECT MC.CUST_LGL_ENG_NM FROM MDM_CUSTOMER MC WHERE MC.CUST_CNT_CD = A3.CUST_CNT_CD AND MC.CUST_SEQ = A3.CUST_SEQ) CTRT_CUST_NM
                    FROM PRI_SP_HDR A1
                        ,PRI_SP_MN A2
                        ,PRI_SP_CTRT_PTY A3
                    WHERE A1.SC_NO = SUBSTR(X.BKG_SC_NO_INFO, 1, INSTR(X.BKG_SC_NO_INFO, '$', 1, 1) -1)
                      AND A1.PROP_NO = A2.PROP_NO
                      AND A2.AMDT_SEQ = (
                                        SELECT  /*+ INDEX_DESC(X XPKPRI_SP_MN) */
                                               AMDT_SEQ
                                          FROM PRI_SP_MN X
                                         WHERE PROP_NO = A1.PROP_NO
                                           AND PROP_STS_CD = 'F'
                                           AND ROWNUM = 1)
                      AND A2.PROP_NO  = A3.PROP_NO
                      AND A2.AMDT_SEQ = A3.AMDT_SEQ
                      AND A3.PRC_CTRT_PTY_TP_CD = 'C'
                   )
             ) AS CTRC_CUST_NM
      ,X.DOOR_SVC_TP
      ,X.PKUP_CNTR
      ,REPLACE(X.SHIPPER, chr(34), '') AS SHIPPER 
      ,REPLACE(X.CONSIGNEE, chr(34), '') AS CONSIGNEE
      ,REPLACE(X.NOTIFY, chr(34), '') AS NOTIFY
      ,X.REF_BKG_NO
      ,X.REF_BL_NO
      ,X.ORG_GATE_OUT_DT
      ,X.DEST_GATE_IN_DT
      ,X.MTY_REF_ID
      ,REPLACE(REPLACE(DECODE(X.TRSP_SO_TP_CD, 'S', X.SPL_ISS_RSN, X.TRSP_PURP_RSN), CHR(13)||CHR(10), ' '), chr(34), '') TRSP_PURP_RSN  
      ,REPLACE(REPLACE(X.INTER_RMK, CHR(13)||CHR(10), ' '), chr(34), '')  INTER_RMK
      ,X.NEGO_RMK NEGO_RMK
      ,REPLACE(REPLACE(X.CNG_RSN_DESC, CHR(13)||CHR(10), ' '), chr(34), '') CNG_RSN_DESC
      ,REPLACE(REPLACE(X.SPCL_INSTR_RMK, CHR(13)||CHR(10), ' '), chr(34), '')  SPCL_INSTR_RMK      		
      ,REPLACE(REPLACE(X.WO_INSTR_RMK, CHR(13)||CHR(10), ' '), chr(34), '')  WO_INSTR_RMK
      ,TO_CHAR(X.CHZ_BUNDLE_SEQ) CHZ_BUNDLE_SEQ
      ,X.TRSP_SPL_SO_TP_CD
#if (${invar_usdropnpull} == 'Y') 
  ,SUBSTR(X.DMDT_INFO, 1, INSTR(X.DMDT_INFO, '$', 1, 1) -1) AS FM_DT
  ,SUBSTR(X.DMDT_INFO, INSTR(X.DMDT_INFO, '$', 1, 1) + 1, INSTR(X.DMDT_INFO, '$', 1, 2) - INSTR(X.DMDT_INFO, '$', 1, 1) - 1) AS FM_YD
  ,SUBSTR(X.DMDT_INFO, INSTR(X.DMDT_INFO, '$', 1, 2) + 1, INSTR(X.DMDT_INFO, '$', 1, 3) - INSTR(X.DMDT_INFO, '$', 1, 2) - 1) AS FM_STS 
  ,SUBSTR(X.DMDT_INFO, INSTR(X.DMDT_INFO, '$', 1, 3) + 1, INSTR(X.DMDT_INFO, '$', 1, 4) - INSTR(X.DMDT_INFO, '$', 1, 3) - 1) AS TO_DT 
  ,SUBSTR(X.DMDT_INFO, INSTR(X.DMDT_INFO, '$', 1, 4) + 1, INSTR(X.DMDT_INFO, '$', 1, 5) - INSTR(X.DMDT_INFO, '$', 1, 4) - 1) AS TO_YD 
  ,SUBSTR(X.DMDT_INFO, INSTR(X.DMDT_INFO, '$', 1, 5) + 1, INSTR(X.DMDT_INFO, '$', 1, 6) - INSTR(X.DMDT_INFO, '$', 1, 5) - 1) AS TO_STS
  ,SUBSTR(X.DMDT_INFO, INSTR(X.DMDT_INFO, '$', 1, 6) + 1, INSTR(X.DMDT_INFO, '$', 1, 7) - INSTR(X.DMDT_INFO, '$', 1, 6) - 1) AS MT_DT 
  ,SUBSTR(X.DMDT_INFO, INSTR(X.DMDT_INFO, '$', 1, 7) + 1, INSTR(X.DMDT_INFO, '$', 1, 8) - INSTR(X.DMDT_INFO, '$', 1, 7) - 1) AS MT_YD 
  ,SUBSTR(X.DMDT_INFO, INSTR(X.DMDT_INFO, '$', 1, 8) + 1, INSTR(X.DMDT_INFO, '$', 1, 9) - INSTR(X.DMDT_INFO, '$', 1, 8) - 1) AS WEB_MT_DT 
  ,SUBSTR(X.DMDT_INFO, INSTR(X.DMDT_INFO, '$', 1, 9) + 1, INSTR(X.DMDT_INFO, '$', 1,10) - INSTR(X.DMDT_INFO, '$', 1, 9) - 1) AS GRACE_END 
--  ,SUBSTR(X.DMDT_INFO, INSTR(X.DMDT_INFO, '$', 1, 9) + 1, INSTR(X.DMDT_INFO, '^', 1, 1) - INSTR(X.DMDT_INFO, '$', 1, 9) - 1) AS GRACE_END 
#end
      ,X.MCNTR_BDL_GRP_SEQ
      ,X.MCNTR_BDL_SEQ
      ,X.HJL_NO
      ,TO_CHAR(X.WO_HJL_HNDL_AMT) WO_HJL_HNDL_AMT
    #if (${grid_flg} == 'Y')
      -- 여기서부터는 타이틀
      ,X.CONTI_CD
      ,X.TRSP_SO_OFC_CTY_CD
      ,TO_CHAR(X.TRSP_SO_SEQ) TRSP_SO_SEQ
      ,TO_CHAR(X.VNDR_SEQ) VNDR_SEQ
      ,X.TRSP_WO_OFC_CTY_CD
      ,TO_CHAR(X.TRSP_WO_SEQ) TRSP_WO_SEQ
      ,X.WGT_MEAS_UT_CD UOM
      ,X.REGISTRATION_NO
      ,X.UPD_USR_ID
      ,(SELECT USR_NM FROM COM_USER CU WHERE CU.USR_ID = X.UPD_USR_ID) AS UPD_USR_NM
      ,SUBSTR(X.USA_DO_INFO, 1, INSTR(X.USA_DO_INFO, '$', 1, 1) - 1) AS IF_SYS_KND_CD
    #end
      ,X.SO_CRE_OFC_CD
      ,COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD03430', X.SPOT_BID_STS_CD) AS SPOT_BID_STS_CD
      ,X.GLINE_VNDR_SEQ
      ,X.GLINE_CURR_CD
      ,(CASE WHEN (X.GLINE_VNDR_SEQ IS NULL AND X.GLINE_CURR_CD IS NULL) THEN NULL ELSE X.GLINE_BZC_AMT END)      AS GLINE_BZC_AMT
      ,(CASE WHEN (X.GLINE_VNDR_SEQ IS NULL AND X.GLINE_CURR_CD IS NULL) THEN NULL ELSE X.GLINE_FUEL_SCG_AMT END) AS GLINE_FUEL_SCG_AMT
      ,(CASE WHEN (X.GLINE_VNDR_SEQ IS NULL AND X.GLINE_CURR_CD IS NULL) THEN NULL ELSE X.GLINE_SCG_VAT_AMT END)  AS GLINE_SCG_VAT_AMT
      ,(CASE WHEN (X.GLINE_VNDR_SEQ IS NULL AND X.GLINE_CURR_CD IS NULL) THEN NULL ELSE X.GLINE_TOLL_FEE_AMT END) AS GLINE_TOLL_FEE_AMT
      ,(CASE WHEN (X.GLINE_VNDR_SEQ IS NULL AND X.GLINE_CURR_CD IS NULL) THEN NULL ELSE X.GLINE_TTL_AMT END)      AS GLINE_TTL_AMT
      ,(CASE WHEN (X.GLINE_VNDR_SEQ IS NULL AND X.GLINE_CURR_CD IS NULL) THEN NULL ELSE TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC(X.GLINE_CURR_CD, X.GLINE_TTL_AMT, TO_CHAR(WO_CRE_DT, 'YYYYMM' )) END) AS GLINE_TTL_AMT_USD

      ,DECODE(X.GLINE_CURR_CD, NULL, NULL, X.WO_CURR_CD) AS VS_WO_CURR_CD
      ,DECODE(X.GLINE_CURR_CD, NULL, NULL, (NVL(X.GLINE_TTL_AMT, 0) - NVL(WO_TOT_AMT, 0))) AS VS_WO_AMT
      ,DECODE(X.GLINE_CURR_CD, NULL, NULL, NVL((ROUND(TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC(X.GLINE_CURR_CD, X.GLINE_TTL_AMT, TO_CHAR(WO_CRE_DT, 'YYYYMM' )), 2)), 0) - NVL(WO_TOT_AMT_USD, 0)) AS VS_WO_AMT_USD
      ,DECODE(X.GLINE_CURR_CD, NULL, NULL, DECODE(SIGN(NVL((ROUND(TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC(X.GLINE_CURR_CD, X.GLINE_TTL_AMT, TO_CHAR(WO_CRE_DT, 'YYYYMM' )), 2)), 0) - NVL(WO_TOT_AMT_USD, 0)), -1, 'Loss', 'Profit') ) AS VS_WO_RSLT

      ,DECODE(X.GLINE_CURR_CD, NULL, NULL, DECODE(X.INV_NO, NULL, NULL, X.INV_CURR_CD)) AS VS_INV_CURR_CD
      ,DECODE(X.GLINE_CURR_CD, NULL, NULL, DECODE(X.INV_NO, NULL, NULL, (NVL(X.GLINE_TTL_AMT, 0) - NVL(INV_TOT_AMT, 0)))) AS VS_INV_AMT
      ,DECODE(X.GLINE_CURR_CD, NULL, NULL, DECODE(X.INV_NO, NULL, NULL, NVL((ROUND(TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC(X.GLINE_CURR_CD, X.GLINE_TTL_AMT, TO_CHAR(WO_CRE_DT, 'YYYYMM' )), 2)), 0) - NVL(INV_TOT_AMT_USD, 0))) AS VS_INV_AMT_USD
      ,DECODE(X.GLINE_CURR_CD, NULL, NULL, DECODE(X.INV_NO, NULL, NULL, DECODE(SIGN(NVL((ROUND(TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC(X.GLINE_CURR_CD, X.GLINE_TTL_AMT, TO_CHAR(WO_CRE_DT, 'YYYYMM' )), 2)), 0) - NVL(INV_TOT_AMT_USD, 0)), -1, 'Loss', 'Profit'))) AS VS_INV_RSLT

      ,TRS_COM_SPOT_BID_PKG.GET_SPOT_BID_VNDR_INFO(X.SPOT_BID_NO) AS SPOT_BID_VNDR_INFO
      ,DECODE((SELECT SIGN(COUNT(1)-3) FROM TRS_SPOT_BID_VNDR  WHERE 1=1  AND SPOT_BID_NO = X.SPOT_BID_NO AND SPOT_BID_VNDR_STS_CD = 'S' AND SPOT_BID_AMT > 0 ), 1, 'Y', 'N') AS SPOT_BID_MORE_BID
      ,(SELECT COUNT(1) FROM TRS_SPOT_BID_VNDR  WHERE 1=1  AND SPOT_BID_NO = X.SPOT_BID_NO AND SPOT_BID_VNDR_STS_CD = 'S' AND SPOT_BID_AMT > 0 ) AS SPOT_BID_VNDR_CNT
  FROM (
          SELECT SO.CMDT_CD
                ,CASE WHEN SO.HJL_NO IS NOT NULL THEN (SELECT HJL_VNDR_SEQ FROM TRS_TRSP_HJL_SVC_ORD WHERE TRSP_SO_OFC_CTY_CD = SO.TRSP_SO_OFC_CTY_CD AND TRSP_SO_SEQ = SO.TRSP_SO_SEQ)
                      ELSE SO.VNDR_SEQ
                 END VNDR_SEQ
                ,SO.CUST_SEQ
                ,SO.CUST_CNT_CD
                ,WRK.CSR_NO
                ,SO.TRSP_SO_CMB_SEQ
                ,DECODE(SO.PRE_PULL_FLG, 'Y', SO.PRE_PULL_FLG, '') AS PRE_PULL_FLG
                ,SO.TRSP_SO_CMB_TP_CD
                ,SO.LOCL_CRE_DT AS SO_CRE_DT
                ,WO.LOCL_CRE_DT AS WO_CRE_DT
                ,WRK.CRE_OFC_CD AS INV_CRE_OFC_CD
                ,SO.VSL_CD
                ,SO.SKD_VOY_NO
                ,SO.SKD_DIR_CD
                ,SO.TRSP_SO_STS_CD
                ,SO.CGO_TP_CD
                ,SO.CNTR_KGS_WGT AS WEIGHT_KGS
                ,SO.CNTR_LBS_WGT AS WEIGHT_LBS
                ,SO.WGT_MEAS_UT_CD
                ,SO.EQ_NO EQ_NO
                ,SO.EQ_KND_CD
                ,SO.EQ_TPSZ_CD AS EQ_TPSZ
                ,SO.TRSP_SO_OFC_CTY_CD
                ,SO.TRSP_SO_SEQ
                ,SO.TRSP_COST_DTL_MOD_CD AS TRSP_COST_DTL_MOD_CD
                ,SO.TRSP_CRR_MOD_CD AS TRSP_CRR_MOD_CD
                ,SO.TRSP_SO_OFC_CTY_CD || SO.TRSP_SO_SEQ AS SO_NO
                ,TO_CHAR (SO.LOCL_CRE_DT, 'YYYY-MM-DD HH24:MI:SS') AS SO_CRE_DT1
                ,SO.DELT_FLG SO_DEL_FLG
                ,TO_CHAR (SO.LOCL_UPD_DT, 'YYYY-MM-DD HH24:MI:SS') AS SO_UPD_DT
                ,WO.TRSP_WO_OFC_CTY_CD || WO.TRSP_WO_SEQ AS WO_NO
                ,WO.TRSP_WO_OFC_CTY_CD
                ,WO.TRSP_WO_SEQ
                ,WO.WO_ISS_STS_CD AS WO_ISS_STS_CD
                ,(SELECT COST_YR || COST_WK FROM MAS_WK_PRD WHERE TO_CHAR ( WO.LOCL_CRE_DT, 'YYYYMMDD') BETWEEN SLS_FM_DT AND SLS_TO_DT) WO_ISS_WK
                ,TO_CHAR ( WO.LOCL_CRE_DT, 'YYYY-MM-DD HH24:MI:SS') AS WO_ISS_DT
                ,DECODE (WO.WO_PRN_USE_FLG,'Y', 'PRINT','') 
                  || DECODE (WO.WO_FAX_USE_FLG,'Y', 'FAX','') 
                  || DECODE (WO.WO_EML_USE_FLG,'Y', ' EMAIL','') 
                  || DECODE (WO.WO_EDI_USE_FLG,'Y', ' EDI','') AS WO_ISS_TP
                ,WO.CRE_OFC_CD AS WO_ISS_OFC_CD
                ,WO.CRE_USR_ID AS WO_ISS_ID
                ,SO.FM_NOD_CD AS FM_NOD_CD
                ,SO.VIA_NOD_CD AS VIA_NOD_CD
                ,SO.TO_NOD_CD AS TO_NOD_CD
                ,SO.FCTRY_NM AS DOOR_FCTRY_NM
                ,SO.DOR_NOD_CD AS DOOR
                ,SO.DOR_DE_ADDR AS DOR_DE_ADDR
                ,SO.TRSP_SO_TP_CD AS TRSP_SO_TP_CD
                ,SO.TRSP_SO_CMB_TP_CD AS BKG_CNTR_CMB_SEQ
                ,DECODE (SO.CUST_NOMI_TRKR_FLG,'Y', 'CNT','HJS') AS VNDR_TP_CD
                ,DECODE (WO.WO_OPN_FLG,'Y', TO_CHAR (WO.UPD_DT, 'YYYY-MM-DD HH24:MI:SS')) AS WO_RCV_DT
                ,TO_CHAR (SO.APNT_DT, 'YYYY-MM-DD HH24:MI:SS') AS APPT_TIME
                ,TO_CHAR (SO.DE_DT, 'YYYY-MM-DD HH24:MI:SS') AS DELIV_TIME
                ,NVL (SO.N3PTY_BIL_FLG, 'N') AS N3PTY_BIL_FLG
                ,SO.CURR_CD AS WO_CURR_CD
                ,NVL (SO.BZC_AMT, 0) AS WO_BZC_AMT
                ,NVL (SO.NEGO_AMT, 0) AS WO_NEGO_AMT
                ,NVL (SO.FUEL_SCG_AMT, 0) AS WO_FUEL_SCG_AMT
				,NVL (SO.SCG_VAT_AMT, 0) AS WO_VAT_SCG_AMT
				,NVL (SO.TOLL_FEE_AMT, 0) AS WO_TOLL_FEE_AMT
                ,NVL (SO.ETC_ADD_AMT, 0) AS WO_ETC_ADD_AMT -- additional  
                ,NVL (SO.HJL_HNDL_AMT, 0) AS WO_HJL_HNDL_AMT
                ,NVL (SO.BZC_AMT, 0) + NVL (SO.FUEL_SCG_AMT, 0)+ NVL (SO.SCG_VAT_AMT, 0) + NVL (SO.NEGO_AMT, 0) + NVL (SO.TOLL_FEE_AMT, 0)+ NVL (SO.ETC_ADD_AMT, 0)+NVL (SO.HJL_HNDL_AMT, 0) AS WO_TOT_AMT
                ,SO.INV_XCH_RT AS INV_XCH_RT
                ,SO.TRSP_INV_CALC_LGC_TP_CD AS INV_CALC_LGC_TP_CD

				,( SELECT SO.CRE_OFC_CD
				     FROM MDM_LOCATION LOC
				    WHERE LOC.CNT_CD = 'CN' 
				      AND SUBSTR(SO.FM_NOD_CD,1,5) = LOC.LOC_CD ) AS COST_OFC_CD_CN
				,( SELECT SO.CRE_OFC_CD
				     FROM MDM_LOCATION LOC
				    WHERE LOC.CONTI_CD = 'M'
				      AND SUBSTR(SO.TO_NOD_CD,1,5) = LOC.LOC_CD ) AS COST_OFC_CD_M
				, SO.CRE_OFC_CD AS SO_CRE_OFC_CD

                ,SO.INV_CURR_CD AS INV_CURR_CD
                ,SO.INV_BZC_AMT AS INV_BZC_AMT
                ,SO.INV_ETC_ADD_AMT AS INV_ETC_ADD_AMT
                , NVL (SO.INV_BZC_AMT, 0) + NVL (SO.INV_ETC_ADD_AMT, 0) AS INV_TOT_AMT
                ,SO.INV_NO AS INV_NO
                ,WRK.TRSP_INV_AUD_STS_CD AS INV_STS_CD
                ,WRK.RGST_NO AS REGISTRATION_NO
                ,TO_CHAR (WRK.INV_CFM_DT, 'YYYYMMDD') AS INV_CFM_DT
                ,WRK.CSR_NO AS CAR_NO
                ,CASE
                    WHEN WRK.TRSP_INV_AUD_STS_CD IN ('CF', 'AR', 'IF', 'PD')
                       THEN WRK.CRE_OFC_CD
                    ELSE ''
                 END AS INV_CFM_OFC_CD
                ,WRK.CRE_USR_ID AS INV_CRE_USR_ID
                ,SO.INV_RMK
                ,SO.BKG_NO AS BKG_NO
                ,SO.BL_NO AS BL_NO
                ,SO.TRSP_BND_CD AS TRSP_BND_CD
                ,SO.BKG_RCVDE_TERM_CD AS TERM
                ,SO.POR_CD POR_CD
                ,SO.POL_CD POL_CD
                ,SO.POD_CD POD_CD
                ,SO.DEL_CD DEL_CD
                ,SO.VSL_CD || SO.SKD_VOY_NO || SO.SKD_DIR_CD T_VVD
                ,SO.SLAN_CD SLAN_CD
                ,SO.IB_VVD_CD
                ,(SELECT VS.VSL_SLAN_CD
					FROM VSK_VSL_SKD VS
				   WHERE VS.VSL_CD = SUBSTR(SO.IB_VVD_CD,1,4)
					 AND VS.SKD_VOY_NO = SUBSTR(SO.IB_VVD_CD,5,4)
					 AND VS.SKD_DIR_CD = SUBSTR(SO.IB_VVD_CD,9,1)
				  ) AS IB_SLAN_CD
               	,SO.OB_VVD_CD
				,(SELECT VS.VSL_SLAN_CD
				    FROM VSK_VSL_SKD VS
				   WHERE VS.VSL_CD = SUBSTR(SO.OB_VVD_CD,1,4)
					 AND VS.SKD_VOY_NO = SUBSTR(SO.OB_VVD_CD,5,4)
					 AND VS.SKD_DIR_CD = SUBSTR(SO.OB_VVD_CD,9,1)
				  ) AS OB_SLAN_CD
                ,SO.IBD_CSTMS_CLR_LOC_CD C_LOC
                ,SO.LST_LOC_CD USA_LAST_CITY
                ,TO_CHAR (SO.AVAL_DT, 'YYYYMMDD') AVAILABLE_DT
                ,TO_CHAR (SO.LST_FREE_DT, 'YYYYMMDD') LAST_FREE_DT
                ,SO.REF_BKG_NO REF_BKG_NO
                ,SO.REF_BL_NO REF_BL_NO
                ,SO.INTER_RMK INTER_RMK
                ,SO.NEGO_RMK NEGO_RMK
                ,WO.WO_RMK WO_INSTR_RMK
                ,SO.SPCL_INSTR_RMK
                ,CASE
                    WHEN SO.EQ_KND_CD = 'Z'
                    AND SO.TRSP_SO_CMB_TP_CD = 'BD'
                       THEN COUNT (SO.TRSP_SO_SEQ) OVER (PARTITION BY SO.TRSP_SO_CMB_TP_CD, SO.TRSP_SO_CMB_SEQ)
                    WHEN SO.EQ_KND_CD = 'Z'
                       THEN 1
                    ELSE NULL
                 END AS CHZ_BUNDLE_SEQ
                ,SO.COP_NO
                ,SO.COST_ACT_GRP_SEQ AG_SEQ
                ,SO.COST_ACT_GRP_CD AG_CODE
                ,DECODE (SO.TRSP_COST_DTL_MOD_CD,'DR'
                         , DECODE (NVL (SO.TRO_SEQ, ''),'', 'N','Y')
                        ,'N/A') TRO_CNFM
                ,SO.TRO_SEQ
 
                ,NVL (SO.UPD_USR_ID, SO.CRE_USR_ID) UPD_USR_ID
                ,SO.ACT_CUST_CNT_CD || SO.ACT_CUST_SEQ DOOR_ACT_CUST
                ,SO.DOR_PST_CD DOOR_ZIP
                ,SO.CNTC_PSON_PHN_NO DOOR_TEL
                ,SO.CNTC_PSON_FAX_NO DOOR_FAX
                ,SO.CNTC_PSON_NM DOOR_PIC
                ,DECODE (SO.DOR_SVC_TP_CD,'UD', 'UNDECIDED','LL', 'LIVE LOAD','LU', 'LIVE UNLOAD','ST', 'STREET TURN','DP', 'DROP AND PICK') DOOR_SVC_TP
                ,SO.REF_ID MTY_REF_ID
                ,DECODE (SO.TRSP_SPL_SO_TP_CD,'AS', 'ADD S.CHG','RR', 'RETROACTIVE') TRSP_SPL_SO_TP_CD
                ,TO_CHAR (SO.ORG_GATE_OUT_DT, 'YYYY-MM-DD HH24:MI:SS') ORG_GATE_OUT_DT
                ,TO_CHAR (SO.DEST_GATE_IN_DT, 'YYYY-MM-DD HH24:MI:SS') DEST_GATE_IN_DT
                ,SO.TRSP_PURP_RSN
                ,SO.SPL_ISS_RSN -- SUPPLEMENT REASON, CSR : CHM-201322296, 2013-01-08 추가, 신용찬                
                
                ,NVL(SO.UPLN_SO_FLG, 'N') UPLN_SO_FLG
                ,NVL(SO.TRSP_FRST_FLG, 'N') TRSP_FRST_FLG
                ,DECODE (SO.EQ_TPSZ_CD
                        ,SO.ORG_EQ_TPSZ_CD, ''
                        ,SO.ORG_EQ_TPSZ_CD
                        ) ORG_EQ_TPSZ
                ,SO.DOR_PKUP_CNTR_NO PKUP_CNTR
                ,TO_CHAR (SO.N1ST_NOD_PLN_DT, 'YYYY-MM-DD HH24:MI:SS') N1ST_NOD_PLN_DT
                ,TO_CHAR (SO.LST_NOD_PLN_DT, 'YYYY-MM-DD HH24:MI:SS') LST_NOD_PLN_DT
                ,TO_CHAR (SO.DOR_NOD_PLN_DT, 'YYYY-MM-DD HH24:MI:SS') DOR_NOD_PLN_DT
                ,TO_CHAR (SO.DOR_ARR_DT, 'YYYY-MM-DD HH24:MI:SS') DOR_ARR_DT
                ,DECODE (SO.HJL_NO,'', 'N','Y') HJL_NO
                ,(SELECT REPLACE (CUST_NM, CHR (13) || CHR (10),' ')
                    FROM BKG_CUSTOMER CUST
                   WHERE CUST.BKG_NO = SO.BKG_NO
                     AND CUST.BKG_CUST_TP_CD = 'S' ) AS SHIPPER
                ,(SELECT REPLACE (CUST_NM, CHR (13) || CHR (10),' ')
                    FROM BKG_CUSTOMER CUST
                   WHERE CUST.BKG_NO = SO.BKG_NO
                     AND CUST.BKG_CUST_TP_CD = 'C' ) AS CONSIGNEE
                ,(SELECT REPLACE (CUST_NM, CHR (13) || CHR (10),' ') 
                    FROM BKG_CUSTOMER CUST
                   WHERE CUST.BKG_NO = SO.BKG_NO
                     AND CUST.BKG_CUST_TP_CD = 'N' ) AS NOTIFY
                ,(SELECT DECODE(NVL(U.EQ_SUBST_CGO_QTY, 0), 0, U.CNTR_TPSZ_CD
                           ||' '||U.OP_CNTR_QTY, U.CNTR_TPSZ_CD||' '||U.OP_CNTR_QTY
                           ||'-SUB '||U.EQ_SUBST_CNTR_TPSZ_CD||' '||U.EQ_SUBST_CGO_QTY
                          )
                    FROM BKG_QUANTITY U
                   WHERE U.BKG_NO       = SO.BKG_NO
                     AND U.CNTR_TPSZ_CD = SO.EQ_TPSZ_CD) AS BKG_QTY
                ,(SELECT CMDT_NM
                    FROM MDM_COMMODITY CMT
                   WHERE CMT.CMDT_CD = SO.CMDT_CD ) AS CMDT_NM
                ,DECODE (SO.TRSP_COST_DTL_MOD_CD,'DR', SO.TRO_CFM_OFC_CD, '') TRO_CFM_OFC
                ,DECODE (SO.TRSP_COST_DTL_MOD_CD,'DR', SO.TRO_CFM_USR_ID, '') TRO_CFM_USR
                ,DECODE (SO.TRSP_COST_DTL_MOD_CD,'DR', TO_CHAR (SO.TRO_CFM_UPD_DT, 'YYYY-MM-DD HH24:MI:SS'), '') TRO_CFM_UPD
                ,DECODE (SO.TRSP_COST_DTL_MOD_CD,'DR', SO.REV_CURR_CD, '') TRO_REV_CUR
                ,(SELECT HDR.IF_DT
                    FROM AP_INV_HDR HDR
                   WHERE HDR.CSR_NO = WRK.CSR_NO) AS IF_DT
                ,SO.LSE_CNTR_FLG
                ,ROUND ((NVL (SO.BZC_AMT, 0) + NVL (SO.FUEL_SCG_AMT, 0) + NVL (SO.NEGO_AMT, 0)+ NVL (SO.TOLL_FEE_AMT, 0) + NVL (SO.ETC_ADD_AMT, 0) + NVL (SO.HJL_HNDL_AMT, 0) + NVL (SO.SCG_VAT_AMT, 0)) / 
						 CASE WHEN NVL(SO.CURR_CD,'USD') = 'USD' THEN 1
						 ELSE	
                         (SELECT USD_LOCL_XCH_RT
                            FROM GL_MON_XCH_RT XCH
             		         WHERE XCH.ACCT_XCH_RT_LVL = 1 
			                   AND XCH.CURR_CD           = SO.CURR_CD
			                   AND XCH.ACCT_XCH_RT_YRMON = NVL(TO_CHAR(WO.LOCL_CRE_DT,'YYYYMM'),TO_CHAR (SO.LOCL_CRE_DT, 'YYYYMM')))
					     END
							   , 2) WO_TOT_AMT_USD
                ,ROUND ((NVL (SO.INV_BZC_AMT, 0) + NVL (SO.INV_ETC_ADD_AMT, 0)) / 
						 CASE WHEN NVL(SO.INV_CURR_CD,'USD') = 'USD' THEN 1
						 ELSE	
                        (SELECT USD_LOCL_XCH_RT
                            FROM GL_MON_XCH_RT XCH
             		         WHERE XCH.ACCT_XCH_RT_LVL = 1 
			                   AND XCH.CURR_CD           = NVL(SO.INV_CURR_CD, SO.CURR_CD) 
			                   AND XCH.ACCT_XCH_RT_YRMON = NVL(TO_CHAR(WRK.LOCL_CRE_DT,'YYYYMM'),TO_CHAR(WO.LOCL_CRE_DT,'YYYYMM')))
					     END
							   , 2) INV_TOT_AMT_USD
                , CASE WHEN SO.HJL_NO IS NOT NULL THEN (SELECT HJL_INV_VNDR_SEQ FROM TRS_TRSP_HJL_SVC_ORD WHERE TRSP_SO_OFC_CTY_CD = SO.TRSP_SO_OFC_CTY_CD AND TRSP_SO_SEQ = SO.TRSP_SO_SEQ)
                       ELSE SO.INV_VNDR_SEQ
                  END INV_VNDR_SEQ
                ,(SELECT VDR.VNDR_ABBR_NM
                    FROM MDM_VENDOR VDR
                   WHERE VDR.VNDR_SEQ = CASE WHEN SO.HJL_NO IS NOT NULL THEN (SELECT HJL_INV_VNDR_SEQ FROM TRS_TRSP_HJL_SVC_ORD WHERE TRSP_SO_OFC_CTY_CD = SO.TRSP_SO_OFC_CTY_CD AND TRSP_SO_SEQ = SO.TRSP_SO_SEQ)
                                             ELSE SO.INV_VNDR_SEQ
                                        END ) AS INV_VNDR_NM
                ,(SELECT IVDR.VNDR_SEQ ||'$'|| NVL(IVDR.VNDR_ABBR_NM, ' ') ||'$'||
                         (SELECT PVNDR.VNDR_SEQ ||'$'|| NVL(PVNDR.VNDR_ABBR_NM, ' ')
                            FROM MDM_VENDOR PVNDR
                           WHERE PVNDR.VNDR_SEQ = IVDR.PRNT_VNDR_SEQ )
                    FROM MDM_VENDOR IVDR
                   WHERE IVDR.VNDR_SEQ = CASE WHEN SO.HJL_NO IS NOT NULL THEN (SELECT HJL_VNDR_SEQ FROM TRS_TRSP_HJL_SVC_ORD WHERE TRSP_SO_OFC_CTY_CD = SO.TRSP_SO_OFC_CTY_CD AND TRSP_SO_SEQ = SO.TRSP_SO_SEQ)
                                              ELSE SO.VNDR_SEQ
                                         END ) AS INV_VNDR_INFO
                ,SO.TRO_LOD_REF_NO AS TRO_LOD_REF 

                ,(SELECT IF_SYS_KND_CD ||'$'|| TO_CHAR(NVL(DOH.LOCL_UPD_DT, DOH.LOCL_CRE_DT),'YYYYMMDDHH24MISS') ||'$'||' Email : '|| NVL(DOH.USR_EML, ' ') ||' / Tel : '|| NVL(DOH.USR_PHN_NO, ' ') ||'$'||NVL(DOH.CRE_USR_ID, ' ')
                    FROM TRS_TRSP_USA_DO_HDR DOH
                   WHERE DOH.BL_NO = SO.BL_NO) USA_DO_INFO
                ,(SELECT NVL(ETH.ALL_IN_RT_CD,' ') ||'$'|| NVL(TO_CHAR(DECODE(NVL(ETH.TRNS_REV_AMT,0)+NVL(ETH.NMF_TRNS_REV_AMT, 0)+NVL(ETH.ADD_REV_AMT, 0),0,'',NVL(ETH.TRNS_REV_AMT,0)+NVL(ETH.NMF_TRNS_REV_AMT, 0)+NVL(ETH.ADD_REV_AMT, 0) )), ' ') ||'$'||
                         NVL(ETH.CXL_FLG,' ') ||'$'|| NVL(ETH.TRO_PROC_CD,' ') ||'$'|| NVL(ETH.EUR_TRNS_TP_CD,' ')
                    FROM BKG_EUR_TRO ETH
                   WHERE ETH.BKG_NO    = SO.BKG_NO
                     AND ETH.IO_BND_CD = SO.TRSP_BND_CD
                     AND ETH.TRO_SEQ   = SO.TRO_SEQ
                     AND SO.TRSP_COST_DTL_MOD_CD = 'DR' ) EUR_TRO_INFO
                ,(SELECT IBD_TRSP_NO
                    FROM BKG_CSTMS_ADV_IBD
                   WHERE CNT_CD = 'US'
                     AND BL_NO = SO.BL_NO) AS IT_NO 

                ,(SELECT BKG.SC_NO ||'$'|| BKG.RFA_NO 
                    FROM BKG_BOOKING BKG     
                   WHERE BKG.BKG_NO = SO.BKG_NO 
                   #if($r_sc_rfa_cd.size() > 0) 
                      #if (${r_radio_number} == 'S' )
                        AND BKG.SC_NO IN (
                        #foreach( ${key} in ${r_sc_rfa_cd}) 
                          #if($velocityCount < $r_sc_rfa_cd.size()) 
                             UPPER('${key}'), 
                          #else 
                             UPPER('${key}')
                          #end 
                        #end
                      )
                      #else
                        AND BKG.RFA_NO IN (
                        #foreach( ${key} in ${r_sc_rfa_cd}) 
                          #if($velocityCount < $r_sc_rfa_cd.size()) 
                             UPPER('${key}'), 
                          #else 
                             UPPER('${key}')
                          #end 
                        #end
                        )
                      #end
                   #end
                 ) BKG_SC_NO_INFO
                     
                ,(SELECT BKG_CNTR.PCK_QTY ||'$'|| BKG_CNTR.PCK_TP_CD ||'$'||
                         NVL(CASE WHEN BKG_CNTR.DCGO_FLG = 'Y' THEN 'DG'
                              WHEN BKG_CNTR.BB_CGO_FLG = 'Y' THEN 'BB'
                              WHEN BKG_CNTR.AWK_CGO_FLG= 'Y' THEN 'AK'
                              WHEN BKG_CNTR.RC_FLG = 'Y' THEN 'RF'
                              WHEN BKG_CNTR.RD_CGO_FLG = 'Y' THEN 'RD' END
                     , ' ') 
                    FROM BKG_CONTAINER BKG_CNTR 
                   WHERE BKG_CNTR.BKG_NO  = SO.BKG_NO
                     AND BKG_CNTR.CNTR_NO = SO.EQ_NO
                 ) BKG_CNTR_INFO
                ,TRS_GET_FOC_INFO_FNC(SO.BL_NO, SO.TRSP_SO_OFC_CTY_CD, SO.TRSP_SO_SEQ, '$') EDI_FOC_INFO
                    
                ,(SELECT NVL(MST_CNTR.OWNR_CO_CD, ' ') ||'$'|| NVL(MST_CNTR.LSTM_CD, ' ') ||'$'|| NVL(MST_CNTR.IMDT_EXT_FLG, ' ')
                    FROM MST_CONTAINER MST_CNTR
                   WHERE MST_CNTR.CNTR_NO = SO.EQ_NO ) MST_CNTR_INFO
                 ,SO.BKG_RCVDE_TERM_CD
                 ,CASE WHEN TRS_GET_FOC_INFO_FNC(SO.BL_NO, SO.TRSP_SO_OFC_CTY_CD, SO.TRSP_SO_SEQ, NULL) = 'YYY'
                       THEN (SELECT PKUP_NO ||'$'|| PKUP_YD_CD ||'$'|| TO_CHAR(PKUP_AVAL_DT,'YYYYMMDD') ||'$'|| TO_CHAR(LST_FREE_DT,'YYYYMMDD') ||'$'
                               FROM BKG_PKUP_NTC_PKUP_NO PU
                                   ,MDM_LOCATION LOC
                              WHERE LOC.LOC_CD  = PU.DEL_CD
                                AND PU.BKG_NO   = SO.BKG_NO
                                AND PU.CNTR_NO  = SO.EQ_NO
                                AND PU.PKUP_YD_CD = SO.FM_NOD_CD
                                AND SO.CONTI_CD = 'M'
                                AND LOC.DELT_FLG = 'N'
                                AND PU.UPD_DT = (SELECT MAX(Y.UPD_DT)
                                                   FROM BKG_PKUP_NTC_PKUP_NO Y
                                                  WHERE Y.BKG_NO  = PU.BKG_NO
                                                    AND Y.CNTR_NO = PU.CNTR_NO
                                                    AND Y.PKUP_YD_CD = PU.PKUP_YD_CD
                                                )
                                AND ROWNUM = 1
                            )
                       ELSE ''
                  END AS PKUP_INFO
                 ,SO.CONTI_CD
      ,(
        SELECT /*+ ORDERED INDEX_DESC(DMT_CNTR XPKDMT_CHG_BKG_CNTR) */
           TO_CHAR(DMT_CALC.FM_MVMT_DT, 'YYYY-MM-DD')
           || '$' ||DMT_CALC.FM_MVMT_YD_CD
           || '$' ||DMT_CALC.FM_MVMT_STS_CD
           || '$' ||DMT_CALC.TO_MVMT_DT
           || '$' ||DMT_CALC.TO_MVMT_YD_CD
           || '$' ||DMT_CALC.TO_MVMT_STS_CD
           || '$' ||
           NVL((SELECT TO_CHAR(CTM_MOV.CNMV_EVNT_DT, 'YYYY-MM-DD') || '$' || CTM_MOV.ORG_YD_CD
              FROM CTM_MOVEMENT CTM_MOV
             WHERE 1=1
               AND CTM_MOV.CNTR_NO        = DMT_CNTR.CNTR_NO
               AND CTM_MOV.CNMV_YR       IN (DMT_CALC.FM_MVMT_YR, DMT_CALC.TO_MVMT_YR) 
               AND CTM_MOV.CNMV_SEQ      IN (DMT_CALC.FM_MVMT_SEQ, DMT_CALC.TO_MVMT_SEQ)
               AND CTM_MOV.CNMV_SPLIT_NO IN (DMT_CALC.FM_MVMT_SPLIT_NO, DMT_CALC.TO_MVMT_SPLIT_NO)
               AND CTM_MOV.MVMT_STS_CD    = 'MT'
               AND ROWNUM = 1
           ),'$')
           || '$' ||DECODE(DMT_CALC.WEB_IND_FLG, 'Y', TO_CHAR(NVL(DMT_CALC.WEB_MTY_DT, DMT_CALC.TO_MVMT_DT), 'YYYY-MM-DD'), TO_CHAR(DMT_CALC.WEB_MTY_DT, 'YYYY-MM-DD')) 
           || '$' ||DECODE(DMT_CALC.WEB_IND_FLG, 'Y', TO_CHAR(NVL(DMT_CALC.WEB_MTY_DT, DMT_CALC.TO_MVMT_DT) + 7, 'YYYY-MM-DD'), TO_CHAR(DMT_CALC.WEB_MTY_DT + 7, 'YYYY-MM-DD'))
           || '$' DMT_INFO
        FROM DMT_CHG_BKG_CNTR DMT_CNTR
          ,DMT_CHG_CALC     DMT_CALC
        WHERE DMT_CNTR.SYS_AREA_GRP_ID = DMT_CALC.SYS_AREA_GRP_ID
        AND DMT_CNTR.CNTR_NO         = DMT_CALC.CNTR_NO
        AND DMT_CNTR.CNTR_CYC_NO     = DMT_CALC.CNTR_CYC_NO
        AND DMT_CNTR.BKG_NO  = SO.BKG_NO
        AND DMT_CNTR.CNTR_NO = SO.EQ_NO
        AND DMT_CALC.DMDT_TRF_CD = 'DTIC'
        AND DMT_CALC.CHG_SEQ     = 1
        AND 'I' = SO.TRSP_BND_CD
        AND ROWNUM = 1
      )DMDT_INFO
		, SO.SPCL_CGO_CNTR_TP_CD
		, SO.MCNTR_BDL_GRP_SEQ
		, SO.MCNTR_BDL_SEQ
        , DECODE(SO.WTR_RCV_TERM_CD,'0',NULL,SO.WTR_RCV_TERM_CD) WTR_RCV_TERM_CD
        , DECODE(SO.WTR_DE_TERM_CD,'0',NULL,SO.WTR_DE_TERM_CD) WTR_DE_TERM_CD
		, NVL(SO.TTL_DIST,0) TTL_DIST
		, SO.LNK_DIST_DIV_CD
		, SO.CNG_RSN_DESC
	    , NVL(SO.SPOT_BID_FLG,'N') SPOT_BID_FLG
        , SO.SPOT_BID_NO
		,TO_CHAR(SO.SPOT_BID_DUE_DT, 'YYYYMMDD')   SPOT_BID_DUE_DT
        ,TO_CHAR(SO.SPOT_BID_DUE_DT, 'HH24:MI:SS') SPOT_BID_DUE_DT_HMS

        , SB.SPOT_BID_STS_CD
        , SB.GLINE_VNDR_SEQ
        , SB.GLINE_CURR_CD
        , SB.GLINE_BZC_AMT
        , SB.GLINE_FUEL_SCG_AMT
        , SB.GLINE_SCG_VAT_AMT
        , SB.GLINE_TOLL_FEE_AMT
        , SB.GLINE_TTL_AMT
    FROM TRS_TRSP_SVC_ORD SO
        ,TRS_TRSP_WRK_ORD WO
        ,TRS_TRSP_INV_WRK WRK
        ,TRS_SPOT_BID SB
   WHERE SO.TRSP_WO_OFC_CTY_CD = WO.TRSP_WO_OFC_CTY_CD(+)
     AND SO.SPOT_BID_NO = SB.SPOT_BID_NO
     AND SO.TRSP_SO_OFC_CTY_CD = SB.TRSP_SO_OFC_CTY_CD
     AND SO.TRSP_SO_SEQ = SB.TRSP_SO_SEQ
     AND SO.TRSP_WO_SEQ = WO.TRSP_WO_SEQ(+)
     AND SO.INV_NO = WRK.INV_NO(+) 
     AND SO.INV_VNDR_SEQ = WRK.INV_VNDR_SEQ(+)
    #if($r_trunk_vvd.size() > 0) 
       AND ((SO.VSL_CD, SO.SKD_VOY_NO, SO.SKD_DIR_CD) IN (
       #foreach( ${key} in ${r_trunk_vvd}) 
         #if($velocityCount == 1) 
            ( SUBSTR('$key', 1, 4), SUBSTR('$key', 5, 4), SUBSTR('$key', 9))
         #else 
          , ( SUBSTR('$key', 1, 4), SUBSTR('$key', 5, 4), SUBSTR('$key', 9))
         #end 
       #end
         )
       )
    #end

    #if($r_bkgnumber.size() > 0) 
       AND SO.BKG_NO IN (
       #foreach( ${key} in ${r_bkgnumber}) 
         #if($velocityCount < $r_bkgnumber.size()) 
            UPPER('${key}'), 
         #else 
            UPPER('${key}')
         #end 
       #end
       )
    #end

    #if($r_blnumber.size() > 0) 
       AND SO.BL_NO IN (
       #foreach( ${key} in ${r_blnumber}) 
         #if($velocityCount < $r_blnumber.size()) 
            UPPER('${key}'), 
         #else 
            UPPER('${key}')
         #end 
       #end
       )
    #end

    #if($r_copnumber.size() > 0) 
       AND SO.COP_NO IN (
       #foreach( ${key} in ${r_copnumber}) 
         #if($velocityCount < $r_copnumber.size()) 
           UPPER('${key}'), 
         #else 
           UPPER('${key}')
         #end 
       #end
       )
    #end 

    #if($r_eqnumber.size() > 0) 
       AND SO.EQ_NO IN (
       #foreach( ${key} in ${r_eqnumber}) 
         #if($velocityCount < $r_eqnumber.size()) 
           UPPER('${key}'), 
         #else 
           UPPER('${key}')
         #end 
      #end
      )

      #if (${r_radio_eq} == 'CNTR') 
        AND SO.EQ_KND_CD = 'U'
      #elseif (${r_radio_eq} == 'CHS') 
        AND SO.EQ_KND_CD = 'Z'
      #elseif (${r_radio_eq} == 'GEN') 
        AND SO.EQ_KND_CD = 'G'
      #end
    #end

    #if($r_mtyrefnumber.size() > 0) 
       AND SO.REF_ID IN (
       #foreach( ${key} in ${r_mtyrefnumber}) 
         #if($velocityCount < $r_mtyrefnumber.size()) 
           UPPER('${key}'), 
         #else 
           UPPER('${key}')
         #end 
      #end
      )
    #end

    #if (${r_period} == 'S') 
      #if (${r_from_date} != ''|| ${r_to_date} != '') 
        AND SO.LOCL_CRE_DT BETWEEN TO_DATE (@[r_from_date], 'rrrrmmdd') AND TO_DATE (@[r_to_date], 'rrrrmmdd') + 0.999999
      #end
    #elseif (${r_period} == 'W')
      #if (${r_from_date} != ''|| ${r_to_date} != '') 
        #if (${month_flg}) 
          AND WO.LOCL_CRE_DT BETWEEN TO_DATE ( @[r_from_date] ,'RRRRMM') AND LAST_DAY( TO_DATE( @[r_to_date] , 'RRRRMM'))+1
        #else 
          AND WO.LOCL_CRE_DT BETWEEN TO_DATE (@[r_from_date], 'rrrrmmddhh24') AND TO_DATE (@[r_to_date], 'rrrrmmddhh24') + 0.999999
        #end
     #end
    #elseif (${r_period} == 'I')
      #if (${r_from_date} != '' && ${r_to_date} != '') 
        AND WRK.INV_CFM_DT BETWEEN TO_DATE (@[r_from_date], 'rrrrmmddhh24') AND TO_DATE (@[r_to_date], 'rrrrmmddhh24') + 0.999999
      #end
    #elseif (${r_period} == 'O')
      #if (${r_from_date} != '' && ${r_to_date} != '') 
        AND SO.N1ST_NOD_PLN_DT BETWEEN TO_DATE (@[r_from_date], 'rrrrmmddhh24') AND TO_DATE (@[r_to_date], 'rrrrmmddhh24') + 0.999999
      #end 
    #elseif (${r_period} == 'L')
      #if (${r_from_date} != '' && ${r_to_date} != '') 
        AND SO.LST_NOD_PLN_DT BETWEEN TO_DATE (@[r_from_date], 'rrrrmmddhh24') AND TO_DATE (@[r_to_date], 'rrrrmmddhh24') + 0.999999
      #end 
    #elseif (${r_period} == 'D')
      #if (${r_from_date} != '' && ${r_to_date} != '') 
        AND SO.DOR_NOD_PLN_DT BETWEEN TO_DATE (@[r_from_date], 'rrrrmmddhh24') AND TO_DATE (@[r_to_date], 'rrrrmmddhh24') + 0.999999
      #end 
    #elseif (${r_period} == 'B')
      #if (${r_from_date} != '' && ${r_to_date} != '') 
        AND SO.SPOT_BID_DUE_DT BETWEEN TO_DATE (@[r_from_date], 'rrrrmmddhh24') AND TO_DATE (@[r_to_date], 'rrrrmmddhh24') + 0.999999
      #end 
    #end

    #if($r_input_office.size() > 0) 
      #if (${r_radio_office} == 'S')
        AND SO.CRE_OFC_CD IN (
        #foreach( ${key} IN ${r_input_office}) 
          #if($velocityCount < $r_input_office.size()) 
            UPPER('${key}'),
          #else 
            UPPER('${key}')
          #end 
        #end
        )
      #elseif (${r_radio_office} == 'V')
        AND WRK.CRE_OFC_CD IN (
        #foreach( ${key} IN ${r_input_office}) 
          #if($velocityCount < $r_input_office.size()) 
            UPPER('${key}'),
          #else 
            UPPER('${key}')
          #end 
        #end
        )
      #elseif (${r_radio_office} == 'W')
        AND WO.CRE_OFC_CD IN (
        #foreach( ${key} in ${r_input_office}) 
          #if($velocityCount < $r_input_office.size()) 
            UPPER('${key}'),
          #else 
            UPPER('${key}')
          #end 
        #end
        )
      #end
    #end

    #if (${r_somode} == 'LV') 
       AND SO.DELT_FLG = 'N'
    #elseif (${r_somode}=='DL')
       AND SO.DELT_FLG = 'Y'
    #end

    #if (${r_womode} != 'ALL')
      #if (${r_womode} == 'IS')
        AND WO.WO_ISS_STS_CD IN ( 'I' , 'R' , 'C')
      #elseif (${r_womode} == 'NS')
        AND NVL(WO.WO_ISS_STS_CD,'N') = 'N'
      #end
    #end

    #if (${r_invoicemode} != '' && ${r_invoicemode} != 'ALL')
      #if (${r_invoicemode} == 'NL') 
        AND WRK.TRSP_INV_AUD_STS_CD IS NULL
      #else
        AND WRK.TRSP_INV_AUD_STS_CD = @[r_invoicemode]
      #end
    #end

    #if (${r_boundmode} != '' && ${r_boundmode} != 'ALL')
      AND SO.TRSP_BND_CD = @[r_boundmode]
    #end

    #if (${r_radio_user} == 'S') 
      #if (${r_user_id} != '') 
        AND SO.CRE_USR_ID = @[r_user_id]
      #end
    #elseif (${r_radio_user} == 'V') 
      #if (${r_user_id} != '') 
        AND WRK.CRE_USR_ID = @[r_user_id]
      #end
    #end

    #if (${r_costmode} != '' && ${r_costmode} != 'ALL')
      AND SO.TRSP_COST_DTL_MOD_CD = @[r_costmode]
    #end
    #if (${r_transmode} != '' && ${r_transmode} != 'ALL')
      AND SO.TRSP_CRR_MOD_CD = @[r_transmode]
    #end
    #if (${r_sotype} != '' && ${r_sotype} != 'ALL')
      AND SO.TRSP_SO_TP_CD = @[r_sotype]
    #end

    #if (${r_provider} != '' && ${r_provider} != 'ALL') 
      #if (${r_provider_type} == 'WO') 
        AND CASE WHEN SO.HJL_NO IS NOT NULL THEN (SELECT HJL_VNDR_SEQ FROM TRS_TRSP_HJL_SVC_ORD WHERE TRSP_SO_OFC_CTY_CD = SO.TRSP_SO_OFC_CTY_CD AND TRSP_SO_SEQ = SO.TRSP_SO_SEQ)
                 ELSE SO.VNDR_SEQ
            END = @[r_provider]
	  #elseif (${r_provider_type} == 'PA') 
		-- ETS ACTUAL VENDOR 고려하지 않기로 함(박진영)2014.03.10
	    AND SO.VNDR_SEQ IN ( SELECT PV.VNDR_SEQ
                               FROM MDM_VENDOR PV
                              WHERE PV.PRNT_VNDR_SEQ = @[r_provider])
      #elseif (${r_provider_type} == 'IV') 
        AND CASE WHEN SO.HJL_NO IS NOT NULL THEN (SELECT HJL_INV_VNDR_SEQ FROM TRS_TRSP_HJL_SVC_ORD WHERE TRSP_SO_OFC_CTY_CD = SO.TRSP_SO_OFC_CTY_CD AND TRSP_SO_SEQ = SO.TRSP_SO_SEQ)
                 ELSE SO.INV_VNDR_SEQ
            END = @[r_provider]
      #end
    #end

    #if (${r_from_node} != '') 
      AND SO.FM_NOD_CD LIKE @[r_from_node]||'%'
    #end
    #if (${r_via_node} != '') 
      AND SO.VIA_NOD_CD LIKE @[r_via_node]||'%'
    #end
    #if (${r_to_node} != '') 
      AND SO.TO_NOD_CD LIKE @[r_to_node]||'%'
    #end
    #if (${r_door_node} != '') 
      AND SO.DOR_NOD_CD LIKE @[r_door_node]||'%'
    #end

    #if($r_sonumber.size() > 0) 
      AND ((SO.TRSP_SO_OFC_CTY_CD, SO.TRSP_SO_SEQ) IN (
        #foreach( ${key} IN ${r_sonumber}) 
          #if($velocityCount == 1) 
             ( SUBSTR('${key}',1,3),SUBSTR('${key}',4) )
          #else
            ,( SUBSTR('${key}',1,3),SUBSTR('${key}',4) )
          #end
        #end
        ) 
      )
    #end
   
    #if($r_spotbidno.size() > 0) 
       AND SO.SPOT_BID_NO IN (
       #foreach( ${key} IN ${r_spotbidno}) 
         #if($velocityCount < $r_spotbidno.size()) 
            '${key}',
         #else 
            '${key}'
         #end 
       #end
       )
    #end
 
      AND SO.SPOT_BID_FLG = 'Y'

    #if($r_wonumber.size() > 0) 
      AND ((SO.TRSP_WO_OFC_CTY_CD, SO.TRSP_WO_SEQ) IN (
        #foreach( ${key} IN ${r_wonumber}) 
          #if($velocityCount == 1) 
             ( SUBSTR('${key}',1,3),SUBSTR('${key}',4) )
          #else
            ,( SUBSTR('${key}',1,3),SUBSTR('${key}',4) )
          #end
        #end
        ) 
      )
    #end

    #if($r_invoicenumber.size() > 0) 
       AND SO.INV_NO IN (
       #foreach( ${key} IN ${r_invoicenumber}) 
         #if($velocityCount < $r_invoicenumber.size()) 
            '${key}',
         #else 
            '${key}'
         #end 
       #end
       )
    #end

    #if (${r_unplanned} != '' && ${r_unplanned} != 'ALL')
       AND NVL(SO.UPLN_SO_FLG,'N') = @[r_unplanned]
    #end

    #if($r_zip_code.size() > 0) 
       AND SO.DOR_PST_CD IN (
       #foreach( ${key} IN ${r_zip_code}) 
         #if($velocityCount < $r_zip_code.size()) 
           UPPER('${key}'),
         #else 
           UPPER('${key}')
         #end 
       #end
       )
    #end

    #if (${r_amount} == 'T')
       AND SO.INV_NO IS NOT NULL
       AND NVL(SO.INV_ETC_ADD_AMT,0) = 0
    #elseif (${r_amount} == 'F')
       AND SO.INV_NO IS NOT NULL
       AND NVL(SO.INV_ETC_ADD_AMT,0) <> 0
    #end

    #if (${r_prepull} == 'Y')
       AND SO.PRE_PULL_FLG = @[r_prepull]
    #end
    #if (${r_cnt_flg} !='')    
  		#if   (${r_cnt_flg} =='Y')
			AND SO.CUST_NOMI_TRKR_FLG ='Y'	
		#elseif (${r_cnt_flg} =='N')
			AND NVL(SO.CUST_NOMI_TRKR_FLG, 'N' )	= 'N'
		#end
	#end
	
    #if (${r_sel_spotbidsts} != '' && ${r_sel_spotbidsts} != 'ALL')
      AND SB.SPOT_BID_STS_CD = @[r_sel_spotbidsts]
    #end

    #if (${grid_flg} == 'Y' && $r_sc_rfa_cd.size() == 0)
       AND ROWNUM < 2001
    #end
) X
WHERE 1=1

    #if (${r_sel_profit} != '' && ${r_sel_profit} != 'ALL')
      #if (${r_radio_profit} == 'I') 
        AND DECODE(X.GLINE_CURR_CD, NULL, NULL, DECODE(X.INV_NO, NULL, NULL, DECODE(SIGN(NVL((ROUND(TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC(X.GLINE_CURR_CD, X.GLINE_TTL_AMT, TO_CHAR(WO_CRE_DT, 'YYYYMM' )), 2)), 0) - NVL(INV_TOT_AMT_USD, 0)), -1, 'Loss', 'Profit'))) = @[r_sel_profit]
      #else 
        AND DECODE(X.GLINE_CURR_CD, NULL, NULL, DECODE(SIGN(NVL((ROUND(TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC(X.GLINE_CURR_CD, X.GLINE_TTL_AMT, TO_CHAR(WO_CRE_DT, 'YYYYMM' )), 2)), 0) - NVL(WO_TOT_AMT_USD, 0)), -1, 'Loss', 'Profit') ) = @[r_sel_profit]
      #end
    #end

    #if (${opener} == 'chreport')
        AND NVL(SUBSTR(X.EUR_TRO_INFO, INSTR(X.EUR_TRO_INFO, '$', 1, 2) + 1, INSTR(X.EUR_TRO_INFO, '$', 1, 3) - INSTR(X.EUR_TRO_INFO, '$', 1, 2) - 1), ' ') != 'Y'
        AND X.TRSP_SO_TP_CD IN ('Y','M') -- SO TYPE = Y 또는 MT 만.
        AND NVL(X.trsp_bnd_cd,'NULL') IN ('I','O',' ','NULL')    -- 'T' BND 제외08.09.22
        AND X.TRSP_COST_DTL_MOD_CD IN ('CY','DR','ER')	
        AND DECODE(X.TRSP_COST_DTL_MOD_CD, 'CY', X.TRSP_CRR_MOD_CD, 'TD') IN ('TD', 'RD', 'TR', 'RT') 	 -- 2008.09.03 C/H REPORT 조회시간 단축
        #if (${invar_onlycy} == 'Y')
            AND DECODE(X.TRSP_COST_DTL_MOD_CD, 'CY', X.BKG_RCVDE_TERM_CD, 'D') = 'Y'
        #else
            AND DECODE(X.TRSP_COST_DTL_MOD_CD, 'CY', X.BKG_RCVDE_TERM_CD, 'D') = 'D'    -- 2008.09.19 CY 일때 BKG TERM 'D'
        #end
    #end

    #if($r_sc_rfa_cd.size() > 0) 
       #if (${r_radio_number} == 'S' )
         AND SUBSTR(X.BKG_SC_NO_INFO, 1, INSTR(X.BKG_SC_NO_INFO, '$', 1, 1) -1) IN (
         #foreach( ${key} in ${r_sc_rfa_cd}) 
           #if($velocityCount < $r_sc_rfa_cd.size()) 
              UPPER('${key}'), 
           #else 
              UPPER('${key}')
           #end 
         #end
       )
       #else
         AND SUBSTR(X.BKG_SC_NO_INFO, INSTR(X.BKG_SC_NO_INFO, '$', 1, 1) + 1) IN (
         #foreach( ${key} in ${r_sc_rfa_cd}) 
           #if($velocityCount < $r_sc_rfa_cd.size()) 
              UPPER('${key}'), 
           #else 
              UPPER('${key}')
           #end 
         #end
         )
       #end
    #end

#elseif (${invar_usrail} == 'Y') 
/* US RAIL Only inquiry */
SELECT   X.EQ_NO
        ,X.EQ_TPSZ
        ,NULL ORG_EQ_TPSZ
        ,X.TRSP_COST_DTL_MOD_CD
        ,'RD' TRSP_CRR_MOD_CD
        ,'RAIL BILLING' AS TRSP_SO_TP_CD
        ,'N' UPLN_SO_FLG
        ,NULL AS PRE_PULL_FLG
        ,NULL AS BKG_CNTR_CMB_SEQ
        ,X.TRSP_FRST_FLG
        ,X.SO_NO
        ,X.SO_CRE_DT1
        ,X.SO_DEL_FLG
        ,DECODE (X.SO_DEL_FLG,'Y', SO_UPD_DT) SO_DEL_DT
        ,X.SO_UPD_DT
        ,NULL WO_NO
        ,(SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL CD WHERE CD.INTG_CD_ID = 'CD00804' AND CD.INTG_CD_VAL_CTNT = X.WO_ISS_STS_CD) AS WO_ISS_STS_CD
        ,X.WO_ISS_WK
        ,X.WO_ISS_DT
        ,X.WO_ISS_TP
        ,X.WO_ISS_OFC_CD
--        ,X.WO_ISS_ID
        ,(SELECT USR_NM FROM COM_USER CU WHERE CU.USR_ID = X.WO_ISS_ID) AS WO_ISS_NM
        ,X.FM_NOD_CD
        ,NULL VIA_NOD_CD
        ,X.TO_NOD_CD
        ,NULL DOOR
		,NULL TTL_DIST
		,NULL LNK_DIST_DIV_CD
   	    , 'N' SPOT_BID_FLG
        ,NULL SPOT_BID_NO
		,NULL SPOT_BID_DUE_DT
        ,NULL SPOT_BID_DUE_DT_HMS
        ,NULL DOOR_ACT_CUST
        ,NULL DOOR_FCTRY_NM        
        ,NULL DOOR_ZIP
        ,NULL DOR_DE_ADDR
        ,NULL DOOR_TEL
        ,NULL DOOR_FAX
        ,NULL DOOR_PIC
        ,NULL USA_DO_USR_INFO
        ,NULL DO_CRE_DATE
        ,NULL DO_CRE_TIME
        ,NULL VNDR_TP_CD
        ,SUBSTR(X.INV_VNDR_INFO, 1, INSTR(X.INV_VNDR_INFO, '$', 1, 1) - 1) AS VNDR_CD
        ,SUBSTR(X.INV_VNDR_INFO, INSTR(X.INV_VNDR_INFO, '$', 1, 1) + 1, INSTR(X.INV_VNDR_INFO, '$', 1, 2) - INSTR(X.INV_VNDR_INFO, '$', 1, 1) - 1) AS VNDR_ABBR_NM
        ,SUBSTR(X.INV_VNDR_INFO, INSTR(X.INV_VNDR_INFO, '$', 1, 2) + 1, INSTR(X.INV_VNDR_INFO, '$', 1, 3) - INSTR(X.INV_VNDR_INFO, '$', 1, 2) - 1) AS PVNDR_CD
        ,SUBSTR(X.INV_VNDR_INFO, INSTR(X.INV_VNDR_INFO, '$', 1, 3) + 1) AS PVNDR_NM
        ,NULL WO_RCV_DT
        ,NULL APPT_TIME
        ,NULL DELIV_TIME
        ,NULL WTR_RCV_TERM_CD
        ,NULL WTR_DE_TERM_CD
        ,X.N3PTY_BIL_FLG
        ,X.COST_OFC_CD
        ,X.WO_CURR_CD
        ,TO_CHAR(X.WO_BZC_AMT) WO_BZC_AMT
        ,TO_CHAR(X.WO_NEGO_AMT) WO_NEGO_AMT
        ,TO_CHAR(X.WO_FUEL_SCG_AMT) WO_FUEL_SCG_AMT
		,'0' WO_VAT_SCG_AMT
        ,'0' WO_ETC_ADD_AMT -- additional 

		-- 20100806 ADD HZD_MTRL_SCG_AMT, OVR_WGT_SCG_AMT
		,TO_CHAR(X.WO_HZD_MTRL_SCG_AMT) WO_HZD_MTRL_SCG_AMT
		,TO_CHAR(X.WO_OVR_WGT_SCG_AMT) WO_OVR_WGT_SCG_AMT
		,TO_CHAR(X.WO_ETC_ADD_AMT) WO_USA_TTL_AMT  -- usa ttl 
		--

        ,TO_CHAR(X.WO_TOT_AMT) WO_TOT_AMT
        ,TO_CHAR(X.WO_TOT_AMT_USD) WO_TOT_AMT_USD
        ,NULL INV_XCH_RT
        ,NULL INV_CALC_LGC_TP_CD
        ,X.INV_CURR_CD
        ,TO_CHAR(X.INV_BZC_AMT) INV_BZC_AMT
        ,TO_CHAR(X.INV_ETC_ADD_AMT) INV_ETC_ADD_AMT
        ,TO_CHAR(X.INV_TOT_AMT) INV_TOT_AMT
        ,TO_CHAR(X.INV_TOT_AMT_USD) INV_TOT_AMT_USD
        ,TO_CHAR(X.INV_VNDR_SEQ) INV_VNDR_CD
        ,X.INV_VNDR_NM
        ,X.INV_NO
        ,(SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL CD WHERE CD.INTG_CD_ID = 'CD00824' AND CD.INTG_CD_VAL_CTNT = X.INV_STS_CD) AS INV_STS_CD
        ,X.INV_CFM_DT
        ,X.CSR_NO CAR_NO
        ,TO_CHAR (X.IF_DT, 'YYYY-MM-DD HH24:MI:SS') INV_IF_DT
        ,X.INV_CFM_OFC_CD
--        ,X.INV_CRE_USR_ID
        ,(SELECT USR_NM FROM COM_USER CU WHERE CU.USR_ID = X.INV_CRE_USR_ID) AS INV_CRE_USR_NM
        ,NULL INV_RMK
        ,X.N1ST_NOD_PLN_DT
        ,X.LST_NOD_PLN_DT
        ,NULL DOR_NOD_PLN_DT
        ,NULL DOR_ARR_DT
        ,X.COP_NO
        ,TO_CHAR(X.AG_SEQ) AG_SEQ
        ,X.AG_CODE
        ,X.BKG_NO 
        ,X.BL_NO
        ,X.TRSP_BND_CD
        ,X.TERM
        ,NULL TRO_SEQ
        ,'N/A' TRO_CNFM
        ,NULL TRO_CFM_OFC
        ,NULL TRO_CFM_USR
        ,NULL TRO_CFM_UPD
        ,NULL TRO_REV_CUR
        ,NULL EUR_TRO_REV
        ,NULL MANIFESTED
        ,NULL TRO_LOD_REF
        ,NULL BKG_QTY
        ,X.POR_CD POR_CD
        ,X.POL_CD POL_CD
        ,X.POD_CD POD_CD
        ,X.DEL_CD DEL_CD
        ,X.T_VVD
        ,X.SLAN_CD
        ,NULL IB_VVD_CD
        ,NULL IB_SLAN_CD
        ,NULL OB_VVD_CD
        ,NULL OB_SLAN_CD
        ,X.CGO_TP_CD
        ,SUBSTR(X.BKG_CNTR_INFO, INSTR(X.BKG_CNTR_INFO, '$', 1, 2) + 1) AS BKG_SPE
        ,SUBSTR(X.MST_CNTR_INFO, 1, INSTR(X.MST_CNTR_INFO, '$', 1, 1) -1) AS USED
        ,SUBSTR(X.MST_CNTR_INFO, INSTR(X.MST_CNTR_INFO, '$', 1, 1) + 1, INSTR(X.MST_CNTR_INFO, '$', 1, 2) - INSTR(X.MST_CNTR_INFO, '$', 1, 1) - 1) AS LT
        ,SUBSTR(X.MST_CNTR_INFO, INSTR(X.MST_CNTR_INFO, '$', 1, 2) + 1) AS I_EXIT
        ,NULL LT_EXP
        ,(SELECT CNTR_SEAL_NO FROM BKG_CNTR_SEAL_NO WHERE BKG_NO  = X.BKG_NO AND CNTR_NO = X.EQ_NO AND CNTR_SEAL_SEQ = 1) AS SEAL_NO
        ,(SELECT CNTR_SEAL_NO FROM BKG_CNTR_SEAL_NO WHERE BKG_NO  = X.BKG_NO AND CNTR_NO = X.EQ_NO AND CNTR_SEAL_SEQ = 2) AS SEAL_NO2
        ,TO_CHAR(X.WEIGHT_KGS) WEIGHT_KGS
        ,TO_CHAR(X.WEIGHT_LBS) WEIGHT_LBS
        ,SUBSTR(X.BKG_CNTR_INFO, 1, INSTR(X.BKG_CNTR_INFO, '$', 1, 1) -1) AS NO_PKG
        ,SUBSTR(X.BKG_CNTR_INFO, INSTR(X.BKG_CNTR_INFO, '$', 1, 1) + 1, INSTR(X.BKG_CNTR_INFO, '$', 1, 2) - INSTR(X.BKG_CNTR_INFO, '$', 1, 1) - 1) PKG_CD
        ,X.CMDT_NM
        ,X.C_LOC
        ,NULL USA_LAST_CITY
        ,SUBSTR(X.EDI_FOC_INFO, 1, INSTR(X.EDI_FOC_INFO, '$', 1, 1) -1) AS F
        ,SUBSTR(X.EDI_FOC_INFO, INSTR(X.EDI_FOC_INFO, '$', 1, 1) + 1, INSTR(X.EDI_FOC_INFO, '$', 1, 2) - INSTR(X.EDI_FOC_INFO, '$', 1, 1) - 1) AS O
        ,SUBSTR(X.EDI_FOC_INFO, INSTR(X.EDI_FOC_INFO, '$', 1, 2) + 1) AS C
        ,IT_NO
        ,'' AS PICKUP_NO
        ,'' AS PU_YARD_CD
        ,'' AS AVAILABLE_DT
        ,'' AS LAST_FREE_DT
        ,SUBSTR(X.BKG_SC_NO_INFO, 1, INSTR(X.BKG_SC_NO_INFO, '$', 1, 1) -1) AS SC_NO
        ,SUBSTR(X.BKG_SC_NO_INFO, INSTR(X.BKG_SC_NO_INFO, '$', 1, 1) + 1) AS RFA_NO
        ,DECODE(TRIM(SUBSTR(X.BKG_SC_NO_INFO, 1, INSTR(X.BKG_SC_NO_INFO, '$', 1, 1) -1)), NULL,
                   (
                    -- RFA 조회
                    SELECT (SELECT MC.CUST_LGL_ENG_NM FROM MDM_CUSTOMER MC WHERE MC.CUST_CNT_CD = A2.CTRT_CUST_CNT_CD AND MC.CUST_SEQ = A2.CTRT_CUST_SEQ) CTRT_CUST_NM
                      FROM PRI_RP_HDR A1
                          ,PRI_RP_MN A2
                          ,PRI_RP_DUR A3
                     WHERE A1.RFA_NO = SUBSTR(X.BKG_SC_NO_INFO, INSTR(X.BKG_SC_NO_INFO, '$', 1, 1) + 1)
                       AND A1.PROP_NO = A2.PROP_NO
                       AND A2.AMDT_SEQ = (
                                         SELECT  /*+ INDEX_DESC(X XPKPRI_SP_MN) */
                                                AMDT_SEQ
                                           FROM PRI_RP_MN X
                                          WHERE PROP_NO = A1.PROP_NO
                                            AND PROP_STS_CD = 'A'
                                            AND ROWNUM = 1)
                       AND A2.PROP_NO  = A3.PROP_NO
                       AND A2.AMDT_SEQ = A3.AMDT_SEQ
                   ),
                    -- S/C 조회
                   (SELECT (SELECT MC.CUST_LGL_ENG_NM FROM MDM_CUSTOMER MC WHERE MC.CUST_CNT_CD = A3.CUST_CNT_CD AND MC.CUST_SEQ = A3.CUST_SEQ) CTRT_CUST_NM
                    FROM PRI_SP_HDR A1
                        ,PRI_SP_MN A2
                        ,PRI_SP_CTRT_PTY A3
                    WHERE A1.SC_NO = SUBSTR(X.BKG_SC_NO_INFO, 1, INSTR(X.BKG_SC_NO_INFO, '$', 1, 1) -1)
                      AND A1.PROP_NO = A2.PROP_NO
                      AND A2.AMDT_SEQ = (
                                        SELECT  /*+ INDEX_DESC(X XPKPRI_SP_MN) */
                                               AMDT_SEQ
                                          FROM PRI_SP_MN X
                                         WHERE PROP_NO = A1.PROP_NO
                                           AND PROP_STS_CD = 'F'
                                           AND ROWNUM = 1)
                      AND A2.PROP_NO  = A3.PROP_NO
                      AND A2.AMDT_SEQ = A3.AMDT_SEQ
                      AND A3.PRC_CTRT_PTY_TP_CD = 'C'
                   )
             ) AS CTRC_CUST_NM
        ,NULL DOOR_SVC_TP
        ,NULL PKUP_CNTR
        ,NULL SHIPPER
        ,NULL CONSIGNEE
        ,NULL NOTIFY
        ,NULL REF_BKG_NO
        ,NULL REF_BL_NO
        ,NULL ORG_GATE_OUT_DT
        ,NULL DEST_GATE_IN_DT
        ,X.MTY_REF_ID
        ,NULL TRSP_PURP_RSN
        ,REPLACE(REPLACE(X.INTER_RMK, CHR(13)||CHR(10), ' '), chr(34), '') AS INTER_RMK
        ,X.NEGO_RMK AS NEGO_RMK
        ,NULL CNG_RSN_DESC        
        ,NULL SPCL_INSTR_RMK
        ,REPLACE(REPLACE(X.WO_INSTR_RMK, CHR(13)||CHR(10), ' '), chr(34), '') AS WO_INSTR_RMK
        ,NULL CHZ_BUNDLE_SEQ
        ,NULL TRSP_SPL_SO_TP_CD
		,NULL MCNTR_BDL_GRP_SEQ
		,NULL MCNTR_BDL_SEQ
        ,NULL HJL_NO
	    ,NULL WO_HJL_HNDL_AMT
#if (${invar_usdropnpull} == 'Y') 
--추가 YJ
		,''FM_DT
		,''FM_YD
		,''FM_STS
		,''TO_DT
		,''TO_YD
		,''TO_STS
		,''MT_DT
		,''MT_YD
		,''WEB_MT_DT
		,''GRACE_END
#end
        
    #if (${grid_flg} == 'Y')
        ,'M' CONTI_CD
        ,X.TRSP_SO_OFC_CTY_CD
        ,TO_CHAR(X.TRSP_SO_SEQ) TRSP_SO_SEQ
        ,TO_CHAR(X.VNDR_SEQ) VNDR_SEQ
        ,NULL TRSP_WO_OFC_CTY_CD
        ,NULL TRSP_WO_SEQ
        ,X.WGT_MEAS_UT_CD UOM
        ,X.REGISTRATION_NO
        ,X.UPD_USR_ID
        ,(SELECT USR_NM FROM COM_USER CU WHERE CU.USR_ID = X.UPD_USR_ID) AS UPD_USR_NM
        ,NULL IF_SYS_KND_CD
    #end
  FROM (
          SELECT --/*+ USE_NL(SO,VNDR,WO,WRK,PU,CMT) USE_NL(WRK,HDR) USE_NL(VNDR,XCH) USE_NL(VNDR,IXCH) INDEX(SO XPKTRS_TRSP_RAIL_BIL_ORD)*/
                 SO.CMDT_CD
                ,VNDR.VNDR_SEQ
                ,SO.CUST_SEQ
                ,SO.CUST_CNT_CD
                ,WRK.CSR_NO
                ,SO.LOCL_CRE_DT SO_CRE_DT
                ,VNDR.LOCL_CRE_DT WO_CRE_DT
                ,WRK.CRE_OFC_CD INV_CRE_OFC_CD
                ,SO.VSL_CD
                ,SO.SKD_VOY_NO
                ,SO.SKD_DIR_CD
                ,SO.TRSP_SO_STS_CD
                ,SO.CGO_TP_CD
                ,(SO.CNTR_WGT / 2.2) WEIGHT_KGS
                ,SO.CNTR_WGT WEIGHT_LBS
                ,SO.WGT_MEAS_UT_CD
                ,SO.EQ_NO EQ_NO
                ,SO.EQ_KND_CD
                ,SO.EQ_TPSZ_CD EQ_TPSZ
                ,SO.TRSP_SO_OFC_CTY_CD
                ,SO.TRSP_SO_SEQ
                ,SO.TRSP_COST_DTL_MOD_CD TRSP_COST_DTL_MOD_CD
                ,SO.TRSP_SO_OFC_CTY_CD || SO.TRSP_SO_SEQ SO_NO
                ,TO_CHAR (SO.LOCL_CRE_DT, 'YYYY-MM-DD HH24:MI:SS') SO_CRE_DT1
                ,SO.DELT_FLG SO_DEL_FLG
                ,TO_CHAR (SO.LOCL_UPD_DT, 'YYYY-MM-DD HH24:MI:SS') SO_UPD_DT
                ,DECODE (WO.BIL_ISS_STS_CD,'X', 'N',WO.BIL_ISS_STS_CD) WO_ISS_STS_CD
                ,(SELECT COST_YR || COST_WK FROM MAS_WK_PRD WHERE TO_CHAR (WO.BIL_EDI_SNT_DT, 'YYYYMMDD') BETWEEN SLS_FM_DT AND SLS_TO_DT) WO_ISS_WK
                ,TO_CHAR (WO.BIL_EDI_SNT_DT, 'YYYY-MM-DD HH24:MI:SS') WO_ISS_DT
                ,DECODE (WO.BIL_ISS_STS_CD,'I', 'EDI','') WO_ISS_TP
                ,WO.CRE_OFC_CD WO_ISS_OFC_CD
                ,WO.CRE_USR_ID WO_ISS_ID
                ,VNDR.FM_NOD_CD FM_NOD_CD
                ,VNDR.TO_NOD_CD TO_NOD_CD
                ,SO.N3PTY_BIL_FLG N3PTY_BIL_FLG
                ,VNDR.CURR_CD WO_CURR_CD

   	            -- 20100806 MOD, VNDR.BZC_AMT WO_BZC_AMT
                ,VNDR.BZC_AMT WO_BZC_AMT 
                ,VNDR.NEGO_AMT WO_NEGO_AMT
                ,VNDR.FUEL_SCG_AMT WO_FUEL_SCG_AMT
                ,NVL (VNDR.ETC_ADD_AMT, 0) WO_ETC_ADD_AMT
                -- 20100806 ADD HZD_MTRL_SCG_AMT, OVR_WGT_SCG_AMT
                ,NVL(VNDR.HZD_MTRL_SCG_AMT,0) WO_HZD_MTRL_SCG_AMT
                ,NVL(VNDR.OVR_WGT_SCG_AMT,0) WO_OVR_WGT_SCG_AMT
                -- 20101209 J
                ,NVL(VNDR.BZC_AMT,0) + NVL(VNDR.FUEL_SCG_AMT,0) + NVL(VNDR.OVR_WGT_SCG_AMT,0) + NVL(VNDR.HZD_MTRL_SCG_AMT,0) + NVL(VNDR.ETC_ADD_AMT,0) WO_TOT_AMT

                ,'PHXSA' COST_OFC_CD
                ,VNDR.INV_CURR_CD INV_CURR_CD
                ,NVL(VNDR.INV_BZC_AMT,0) - NVL(VNDR.INV_ETC_ADD_AMT,0) INV_BZC_AMT
                ,VNDR.INV_ETC_ADD_AMT INV_ETC_ADD_AMT
                ,VNDR.INV_BZC_AMT INV_TOT_AMT
                ,VNDR.INV_NO INV_NO
                ,WRK.TRSP_INV_AUD_STS_CD INV_STS_CD
                ,WRK.RGST_NO REGISTRATION_NO
                ,TO_CHAR (WRK.INV_CFM_DT, 'YYYYMMDD') INV_CFM_DT
                ,WRK.CSR_NO CAR_NO
                ,CASE
                    WHEN WRK.TRSP_INV_AUD_STS_CD IN ('CF', 'AR', 'IF', 'PD')
                       THEN WRK.CRE_OFC_CD
                    ELSE ''
                 END INV_CFM_OFC_CD
                ,WRK.CRE_USR_ID INV_CRE_USR_ID
                ,SO.BKG_NO BKG_NO
                ,SO.BL_NO BL_NO
                ,SO.TRSP_BND_CD TRSP_BND_CD
                ,SO.BKG_RCVDE_TERM_CD TERM
                ,SO.POR_CD POR_CD
                ,SO.POL_CD POL_CD
                ,SO.POD_CD POD_CD
                ,SO.DEL_CD DEL_CD
                ,SO.VSL_CD || SO.SKD_VOY_NO || SO.SKD_DIR_CD T_VVD
                ,SO.SLAN_CD SLAN_CD
                ,NULL IB_VVD_CD
				,NULL IB_SLAN_CD
      			,NULL OB_VVD_CD
       			,NULL OB_SLAN_CD
                ,SO.IBD_CSTMS_CLR_LOC_CD C_LOC
                ,TO_CHAR (SO.AVAL_DT, 'YYYYMMDD') AVAILABLE_DT
                ,TO_CHAR (SO.LST_FREE_DT, 'YYYYMMDD') LAST_FREE_DT
                ,SO.INTER_RMK INTER_RMK
                ,NULL NEGO_RMK
                ,WO.INTER_RMK WO_INSTR_RMK
                ,SO.COP_NO
                ,SO.COST_ACT_GRP_SEQ AG_SEQ
                ,SO.COST_ACT_GRP_CD AG_CODE
                ,NVL (SO.UPD_USR_ID, SO.CRE_USR_ID) UPD_USR_ID
                ,SO.REF_ID MTY_REF_ID
                
                ,ROUND ((NVL(VNDR.BZC_AMT,0) + NVL(VNDR.FUEL_SCG_AMT,0) + NVL(VNDR.OVR_WGT_SCG_AMT,0) + NVL(VNDR.HZD_MTRL_SCG_AMT,0) + NVL(VNDR.ETC_ADD_AMT,0)) / 
						CASE WHEN NVL(VNDR.CURR_CD,'USD') = 'USD' THEN 1
						ELSE
                         (SELECT USD_LOCL_XCH_RT
                            FROM GL_MON_XCH_RT XCH
			     			 WHERE XCH.ACCT_XCH_RT_LVL = 1 
			       			   AND XCH.CURR_CD           = VNDR.CURR_CD
			       			   AND XCH.ACCT_XCH_RT_YRMON = NVL(TO_CHAR(WO.LOCL_CRE_DT,'YYYYMM'),TO_CHAR(SO.LOCL_CRE_DT,'YYYYMM')))
						END
							   , 2) WO_TOT_AMT_USD  	   
                ,ROUND (NVL (VNDR.INV_BZC_AMT, 0)  / 
						CASE WHEN NVL(VNDR.INV_CURR_CD,'USD') = 'USD' THEN 1
						ELSE 
                        (SELECT USD_LOCL_XCH_RT
                            FROM GL_MON_XCH_RT XCH
						     WHERE XCH.ACCT_XCH_RT_LVL = 1 
						       AND XCH.CURR_CD           = NVL(VNDR.INV_CURR_CD, VNDR.CURR_CD) 
			       			   AND XCH.ACCT_XCH_RT_YRMON = NVL(TO_CHAR(WRK.LOCL_CRE_DT,'YYYYMM'),TO_CHAR(WO.LOCL_CRE_DT,'YYYYMM')))
						END	   
							   , 2) INV_TOT_AMT_USD  	     
                ,NVL (SO.TRSP_FRST_FLG, 'N') TRSP_FRST_FLG
                ,TO_CHAR (SO.N1ST_NOD_PLN_DT, 'YYYY-MM-DD HH24:MI:SS') N1ST_NOD_PLN_DT
                ,TO_CHAR (SO.LST_NOD_PLN_DT, 'YYYY-MM-DD HH24:MI:SS') LST_NOD_PLN_DT
                ,VNDR.INV_VNDR_SEQ
                ,(SELECT VDR.VNDR_ABBR_NM
                    FROM MDM_VENDOR VDR
                   WHERE VDR.VNDR_SEQ = VNDR.INV_VNDR_SEQ ) AS INV_VNDR_NM
                ,(SELECT HDR.IF_DT
                    FROM AP_INV_HDR HDR
                   WHERE HDR.CSR_NO = WRK.CSR_NO) AS IF_DT
                ,(SELECT BKG.SC_NO ||'$'|| BKG.RFA_NO 
                    FROM BKG_BOOKING BKG     
                   WHERE BKG.BKG_NO = SO.BKG_NO ) BKG_SC_NO_INFO  
                ,(SELECT BKG_CNTR.PCK_QTY ||'$'|| BKG_CNTR.PCK_TP_CD ||'$'||
                         NVL(CASE WHEN BKG_CNTR.DCGO_FLG = 'Y' THEN 'DG'
                              WHEN BKG_CNTR.BB_CGO_FLG = 'Y' THEN 'BB'
                              WHEN BKG_CNTR.AWK_CGO_FLG= 'Y' THEN 'AK'
                              WHEN BKG_CNTR.RC_FLG = 'Y' THEN 'RF'
                              WHEN BKG_CNTR.RD_CGO_FLG = 'Y' THEN 'RD' END
                     , ' ') 
                    FROM BKG_CONTAINER BKG_CNTR 
                   WHERE BKG_CNTR.BKG_NO  = SO.BKG_NO
                     AND BKG_CNTR.CNTR_NO = SO.EQ_NO
                 ) BKG_CNTR_INFO
                ,(SELECT NVL(MST_CNTR.OWNR_CO_CD, ' ') ||'$'|| NVL(MST_CNTR.LSTM_CD, ' ') ||'$'|| NVL(MST_CNTR.IMDT_EXT_FLG, ' ')
                    FROM MST_CONTAINER MST_CNTR
                   WHERE MST_CNTR.CNTR_NO = SO.EQ_NO ) MST_CNTR_INFO
                ,(SELECT CMDT_NM
                    FROM MDM_COMMODITY CMT
                   WHERE CMT.CMDT_CD = SO.CMDT_CD ) AS CMDT_NM
                ,TRS_GET_FOC_INFO_FNC(SO.BL_NO, SO.TRSP_SO_OFC_CTY_CD, SO.TRSP_SO_SEQ, '$') EDI_FOC_INFO
                ,(SELECT IVDR.VNDR_SEQ ||'$'|| NVL(IVDR.VNDR_ABBR_NM, ' ') ||'$'||
                         (SELECT PVNDR.VNDR_SEQ ||'$'|| NVL(PVNDR.VNDR_ABBR_NM, ' ')
                            FROM MDM_VENDOR PVNDR
                           WHERE PVNDR.VNDR_SEQ = IVDR.VNDR_SEQ )
                   FROM MDM_VENDOR IVDR
                   WHERE IVDR.VNDR_SEQ = VNDR.VNDR_SEQ ) AS INV_VNDR_INFO
                , (SELECT IBD_NO
                     FROM BKG_CGO_RLSE
                    WHERE BL_NO = SO.BL_NO ) AS IT_NO
            FROM TRS_TRSP_RAIL_BIL_ORD SO
                ,TRS_TRSP_RAIL_BIL_VNDR_SET VNDR
                ,TRS_TRSP_EDI_RAIL_ORD WO
                ,TRS_TRSP_RAIL_INV_WRK WRK
           WHERE SO.TRSP_SO_OFC_CTY_CD  = VNDR.TRSP_SO_OFC_CTY_CD
             AND SO.TRSP_SO_SEQ         = VNDR.TRSP_SO_SEQ  
             AND SO.TRSP_SO_OFC_CTY_CD  = WO.TRSP_SO_OFC_CTY_CD(+)
             AND SO.TRSP_SO_SEQ = WO.TRSP_SO_SEQ(+)
             AND SO.BIL_ISS_KNT = WO.BIL_ISS_KNT(+)
             AND VNDR.INV_NO    = WRK.INV_NO(+)
             AND VNDR.INV_VNDR_SEQ = WRK.INV_VNDR_SEQ(+)

    #if($r_trunk_vvd.size() > 0) 
       AND ((SO.VSL_CD, SO.SKD_VOY_NO, SO.SKD_DIR_CD) IN (
       #foreach( ${key} in ${r_trunk_vvd}) 
         #if($velocityCount == 1) 
            ( SUBSTR('$key', 1, 4), SUBSTR('$key', 5, 4), SUBSTR('$key', 9))
         #else 
          , ( SUBSTR('$key', 1, 4), SUBSTR('$key', 5, 4), SUBSTR('$key', 9))
         #end 
       #end
         )
       )
    #end

    #if($r_bkgnumber.size() > 0) 
       AND SO.BKG_NO IN (
       #foreach( ${key} in ${r_bkgnumber}) 
         #if($velocityCount < $r_bkgnumber.size()) 
            UPPER('${key}'), 
         #else 
            UPPER('${key}')
         #end 
       #end
       )
    #end

    #if($r_blnumber.size() > 0) 
       AND SO.BL_NO IN (
       #foreach( ${key} in ${r_blnumber}) 
         #if($velocityCount < $r_blnumber.size()) 
            UPPER('${key}'), 
         #else 
            UPPER('${key}')
         #end 
       #end
       )
    #end

    #if($r_copnumber.size() > 0) 
       AND SO.COP_NO IN (
       #foreach( ${key} in ${r_copnumber}) 
         #if($velocityCount < $r_copnumber.size()) 
           UPPER('${key}'), 
         #else 
           UPPER('${key}')
         #end 
       #end
       )
    #end 

    #if($r_eqnumber.size() > 0) 
       AND SO.EQ_NO IN (
       #foreach( ${key} in ${r_eqnumber}) 
         #if($velocityCount < $r_eqnumber.size()) 
           UPPER('${key}'), 
         #else 
           UPPER('${key}')
         #end 
      #end
      )

      #if (${r_radio_eq} == 'CNTR') 
        AND SO.EQ_KND_CD = 'U'
      #elseif (${r_radio_eq} == 'CHS') 
        AND SO.EQ_KND_CD = 'Z'
      #elseif (${r_radio_eq} == 'GEN') 
        AND SO.EQ_KND_CD = 'G'
      #end
    #end

    #if($r_mtyrefnumber.size() > 0) 
       AND SO.REF_ID IN (
       #foreach( ${key} in ${r_mtyrefnumber}) 
         #if($velocityCount < $r_mtyrefnumber.size()) 
           UPPER('${key}'), 
         #else 
           UPPER('${key}')
         #end 
      #end
      )
    #end

    #if (${r_period} == 'S') 
      #if (${r_from_date} != ''|| ${r_to_date} != '') 
        AND SO.LOCL_CRE_DT BETWEEN TO_DATE (@[r_from_date], 'rrrrmmdd') AND TO_DATE (@[r_to_date], 'rrrrmmdd') + 0.999999
      #end
    #elseif (${r_period} == 'W')
      #if (${r_from_date} != ''|| ${r_to_date} != '') 
        #if (${month_flg}) 
          AND WO.LOCL_CRE_DT BETWEEN TO_DATE ( @[r_from_date] ,'RRRRMM') AND LAST_DAY( TO_DATE( @[r_to_date] , 'RRRRMM'))+1
        #else 
          AND WO.LOCL_CRE_DT BETWEEN TO_DATE (@[r_from_date], 'rrrrmmddhh24') AND TO_DATE (@[r_to_date], 'rrrrmmddhh24') + 0.999999
        #end
     #end
    #elseif (${r_period} == 'I')
      #if (${r_from_date} != '' && ${r_to_date} != '') 
        AND WRK.INV_CFM_DT BETWEEN TO_DATE (@[r_from_date], 'rrrrmmddhh24') AND TO_DATE (@[r_to_date], 'rrrrmmddhh24') + 0.999999
      #end
    #elseif (${r_period} == 'O')
      #if (${r_from_date} != '' && ${r_to_date} != '') 
        AND SO.N1ST_NOD_PLN_DT BETWEEN TO_DATE (@[r_from_date], 'rrrrmmddhh24') AND TO_DATE (@[r_to_date], 'rrrrmmddhh24') + 0.999999
      #end 
    #elseif (${r_period} == 'L')
      #if (${r_from_date} != '' && ${r_to_date} != '') 
        AND SO.LST_NOD_PLN_DT BETWEEN TO_DATE (@[r_from_date], 'rrrrmmddhh24') AND TO_DATE (@[r_to_date], 'rrrrmmddhh24') + 0.999999
      #end 
    #elseif (${r_period} == 'D')
      #if (${r_from_date} != '' && ${r_to_date} != '') 
        AND 1=2
      #end 
    #end

    #if($r_input_office.size() > 0) 
      #if (${r_radio_office} == 'S')
        AND SO.CRE_OFC_CD IN (
        #foreach( ${key} IN ${r_input_office}) 
          #if($velocityCount < $r_input_office.size()) 
            UPPER('${key}'),
          #else 
            UPPER('${key}')
          #end 
        #end
        )
      #elseif (${r_radio_office} == 'V')
        AND WRK.CRE_OFC_CD IN (
        #foreach( ${key} IN ${r_input_office}) 
          #if($velocityCount < $r_input_office.size()) 
            UPPER('${key}'),
          #else 
            UPPER('${key}')
          #end 
        #end
        )
      #elseif (${r_radio_office} == 'W')
        AND WO.CRE_OFC_CD IN (
        #foreach( ${key} in ${r_input_office}) 
          #if($velocityCount < $r_input_office.size()) 
            UPPER('${key}'),
          #else 
            UPPER('${key}')
          #end 
        #end
        )
      #end
    #end

    #if (${r_somode} == 'LV') 
       AND SO.DELT_FLG = 'N'
    #elseif (${r_somode}=='DL')
       AND SO.DELT_FLG = 'Y'
    #end

    #if (${r_womode} != 'ALL')
      #if (${r_womode} == 'IS')
        AND WO.BIL_ISS_STS_CD = 'I'
      #elseif (${r_womode} == 'NS')
        AND NVL(WO.BIL_ISS_STS_CD,'X') = 'X'
      #end
    #end

    #if (${r_invoicemode} != '' && ${r_invoicemode} != 'ALL')
      #if (${r_invoicemode} == 'NL') 
        AND WRK.TRSP_INV_AUD_STS_CD IS NULL
      #else
        AND WRK.TRSP_INV_AUD_STS_CD = @[r_invoicemode]
      #end
    #end

    #if (${r_boundmode} != '' && ${r_boundmode} != 'ALL')
      AND SO.TRSP_BND_CD = @[r_boundmode]
    #end

    #if (${r_radio_user} == 'S') 
      #if (${r_user_id} != '') 
        AND SO.CRE_USR_ID = @[r_user_id]
      #end
    #elseif (${r_radio_user} == 'V') 
      #if (${r_user_id} != '') 
        AND WRK.CRE_USR_ID = @[r_user_id]
      #end
    #end


    #if (${r_costmode} != '' && ${r_costmode} != 'ALL')
      #if (${r_costmode} == 'CY') 
        AND SO.CGO_TP_CD = 'F'
      #elseif (${r_costmode} == 'ER') 
        AND SO.CGO_TP_CD = 'M'
      #else 
        AND SO.TRSP_SO_SEQ = 0
      #end
    #end
    #if (${r_transmode} != '' && ${r_transmode} != 'ALL')
      AND 'RD' = @[r_transmode]
    #end

    #if (${r_sotype} != '' && ${r_sotype} != 'ALL' && ${r_sotype} != 'R')
      AND SO.TRSP_SO_SEQ = 0
    #end

    #if (${r_provider} != '' && ${r_provider} != 'ALL') 
      #if (${r_provider_type} == 'WO') 
        AND VNDR.VNDR_SEQ = @[r_provider]
	  #elseif (${r_provider_type} == 'PA') 
		AND VNDR.VNDR_SEQ IN ( SELECT PV.VNDR_SEQ
                                 FROM MDM_VENDOR PV
                                WHERE PV.PRNT_VNDR_SEQ = @[r_provider] ) 
      #elseif (${r_provider_type} == 'IV') 
        AND VNDR.INV_VNDR_SEQ = @[r_provider]
      #end
    #end

    #if (${r_from_node} != '') 
      AND VNDR.FM_NOD_CD LIKE @[r_from_node]||'%'
    #end
    #if (${r_via_node} != '') 
      AND 0 = 1
    #end
    #if (${r_to_node} != '') 
      AND VNDR.TO_NOD_CD LIKE @[r_to_node]||'%'
    #end
    #if (${r_door_node} != '') 
      AND 0 = 1
    #end

    #if($r_sonumber.size() > 0) 
      AND ((SO.TRSP_SO_OFC_CTY_CD, SO.TRSP_SO_SEQ) IN (
        #foreach( ${key} IN ${r_sonumber}) 
          #if($velocityCount == 1) 
             ( SUBSTR('${key}',1,3),SUBSTR('${key}',4) )
          #else
            ,( SUBSTR('${key}',1,3),SUBSTR('${key}',4) )
          #end
        #end
        ) 
      )
    #end

    #if($r_wonumber.size() > 0) 
      AND 0 = 1
    #end

    #if($r_invoicenumber.size() > 0) 
       AND VNDR.INV_NO IN (
       #foreach( ${key} IN ${r_invoicenumber}) 
         #if($velocityCount < $r_invoicenumber.size()) 
            '${key}',
         #else 
            '${key}'
         #end 
       #end
       )
    #end

    #if (${r_unplanned} != '' && ${r_unplanned} != 'ALL')
       AND 0 = 1
    #end

    #if($r_zip_code.size() > 0) 
       AND 0 = 1
    #end

    #if (${r_amount} == 'T')
       AND VNDR.INV_NO IS NOT NULL
       AND NVL(VNDR.INV_ETC_ADD_AMT,0) = 0
    #elseif (${r_amount} == 'F')
       AND VNDR.INV_NO IS NOT NULL
       AND NVL(VNDR.INV_ETC_ADD_AMT,0) <> 0
    #end

    #if (${opener} == 'chreport')
       AND SO.TRSP_SO_SEQ=0
    #end

    #if (${grid_flg} == 'Y')
       AND ROWNUM < 2001
    #end

) X
WHERE 1=1

    #if($r_sc_rfa_cd.size() > 0) 
       #if (${r_radio_number} == 'S' )
         AND SUBSTR(X.BKG_SC_NO_INFO, 1, INSTR(X.BKG_SC_NO_INFO, '$', 1, 1) -1) IN (
         #foreach( ${key} in ${r_sc_rfa_cd}) 
           #if($velocityCount < $r_sc_rfa_cd.size()) 
              UPPER('${key}'), 
           #else 
              UPPER('${key}')
           #end 
         #end
       )
       #else
         AND SUBSTR(X.BKG_SC_NO_INFO, INSTR(X.BKG_SC_NO_INFO, '$', 1, 1) + 1) IN (
         #foreach( ${key} in ${r_sc_rfa_cd}) 
           #if($velocityCount < $r_sc_rfa_cd.size()) 
              UPPER('${key}'), 
           #else 
              UPPER('${key}')
           #end 
         #end
         )
       #end
    #end
#end			]]></sql>
			<params>
				<param name="r_from_date" type="12" value="" out="N"/>
				<param name="r_to_date" type="12" value="" out="N"/>
				<param name="r_invoicemode" type="12" value="" out="N"/>
				<param name="r_boundmode" type="12" value="" out="N"/>
				<param name="r_user_id" type="12" value="" out="N"/>
				<param name="r_costmode" type="12" value="" out="N"/>
				<param name="r_transmode" type="12" value="" out="N"/>
				<param name="r_sotype" type="12" value="" out="N"/>
				<param name="r_provider" type="12" value="" out="N"/>
				<param name="r_from_node" type="12" value="" out="N"/>
				<param name="r_via_node" type="12" value="" out="N"/>
				<param name="r_to_node" type="12" value="" out="N"/>
				<param name="r_door_node" type="12" value="" out="N"/>
				<param name="r_unplanned" type="12" value="" out="N"/>
				<param name="r_prepull" type="12" value="" out="N"/>
				<param name="r_sel_spotbidsts" type="12" value="" out="N"/>
				<param name="r_sel_profit" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
