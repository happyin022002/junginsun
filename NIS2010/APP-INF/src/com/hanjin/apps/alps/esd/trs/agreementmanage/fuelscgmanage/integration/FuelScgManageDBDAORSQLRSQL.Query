<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="FuelScgManageDBDAORSQLRSQL">
			<desc><![CDATA[Fuel Surcharge (FUA) Update List 조회]]></desc>
			<sql><![CDATA[
SELECT X.*
  FROM ( SELECT C.TRSP_AGMT_RT_TP_CD
	       ,A.TRSP_AGMT_OFC_CTY_CD || A.TRSP_AGMT_SEQ AGMT_NO
	       ,B.VNDR_SEQ
	       ,(SELECT MDM.VNDR_LGL_ENG_NM FROM MDM_VENDOR MDM WHERE MDM.VNDR_SEQ = B.VNDR_SEQ ) VNDR_NM
	       ,C.TRSP_COST_MOD_CD
	       ,C.AGMT_TRSP_TP_CD
	       ,E.EQ_KND_CD
	       ,C.CGO_TP_CD
	       ,DECODE(C.CUST_CNT_CD||C.CUST_SEQ, 'XX0', NULL, C.CUST_CNT_CD||C.CUST_SEQ) CUST_CD
	       ,DECODE(C.CMDT_GRP_CD, 'XXXX', NULL, C.CMDT_GRP_CD) CMDT_GRP_CD
	       ,DECODE(C.RAIL_SVC_TP_CD, '00', NULL, C.RAIL_SVC_TP_CD) RAIL_SVC_TP_CD
	       ,D.AGMT_ROUT_ALL_FLG
	       ,TO_CHAR(E.EFF_FM_DT,'YYYYMMDD')  AS EFF_FM_DT
	       ,TO_CHAR(E.EFF_TO_DT,'YYYYMMDD')  AS EFF_TO_DT
	       ,E.AGMT_SCG_RT_DIV_CD
	       ,E.TRSP_ONE_WY_RT
	       ,E.TRSP_RND_RT
	       ,C.UPD_USR_ID
	       ,(SELECT USR_NM FROM COM_USER WHERE USR_ID = C.UPD_USR_ID) UPD_USR_NM
	       ,C.UPD_OFC_CD
	       ,(SELECT COUNT(*)
	           FROM TRS_AGMT_EQ_RT X
	          WHERE X.TRSP_AGMT_OFC_CTY_CD   = C.TRSP_AGMT_OFC_CTY_CD
	            AND X.TRSP_AGMT_SEQ          = C.TRSP_AGMT_SEQ
	            AND X.TRSP_AGMT_RT_TP_SER_NO = C.TRSP_AGMT_RT_TP_SER_NO
	            AND NVL(X.DELT_FLG, 'N') = 'N'
		   #if (${fm_effective_agmt} != 'A' )
	    	    AND (SELECT GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(A.CTRT_OFC_CD)  FROM DUAL ) BETWEEN E.EFF_FM_DT AND E.EFF_TO_DT
		   #end
	        ) AS RATE_TOT_CNT 
	       ,A.TRSP_AGMT_OFC_CTY_CD
	       ,A.TRSP_AGMT_SEQ
	       ,E.TRSP_AGMT_RT_TP_SER_NO
	       ,E.TRSP_AGMT_SCG_NOD_SEQ
	       ,E.TRSP_AGMT_SCG_RT_SEQ
	       ,DECODE(SUBSTR(D.FM_NOD_CD,1,5), '00000', NULL, SUBSTR(D.FM_NOD_CD,1,5)) AS FM_NOD_CD
	       ,DECODE(SUBSTR(D.FM_NOD_CD,6), '00', NULL, SUBSTR(D.FM_NOD_CD,6)) AS FM_NOD_YD
	       ,DECODE(SUBSTR(D.VIA_NOD_CD,1,5), '00000', NULL, SUBSTR(D.VIA_NOD_CD,1,5)) AS VIA_NOD_CD
	       ,DECODE(SUBSTR(D.VIA_NOD_CD,6), '00', NULL, SUBSTR(D.VIA_NOD_CD,6)) AS VIA_NOD_YD
	       ,DECODE(SUBSTR(D.DOR_NOD_CD,1,5), '00000', NULL, SUBSTR(D.DOR_NOD_CD,1,5)) AS DOR_NOD_CD
	       ,DECODE(SUBSTR(D.DOR_NOD_CD,6), '00', NULL, SUBSTR(D.DOR_NOD_CD,6)) AS DOR_NOD_YD
	       ,DECODE(SUBSTR(D.TO_NOD_CD,1,5), '00000', NULL, SUBSTR(D.TO_NOD_CD,1,5)) AS TO_NOD_CD
	       ,DECODE(SUBSTR(D.TO_NOD_CD,6), '00', NULL, SUBSTR(D.TO_NOD_CD,6)) AS TO_NOD_YD
		   ,E.TO_WGT
	       ,E.WGT_MEAS_UT_CD
		   ,D.TRSP_SCG_CD
	       ,E.CURR_CD       
	  FROM  TRS_AGMT_HDR   A
	       ,TRS_AGMT_APLY_VNDR B
	       ,TRS_AGMT_RT_TP C
	       ,TRS_AGMT_SCG_NOD   D
	       ,TRS_AGMT_SCG_RT E
	  WHERE A.TRSP_AGMT_OFC_CTY_CD = B.TRSP_AGMT_OFC_CTY_CD
	    AND A.TRSP_AGMT_SEQ = B.TRSP_AGMT_SEQ
	    AND A.TRSP_AGMT_OFC_CTY_CD   = C.TRSP_AGMT_OFC_CTY_CD
	    AND A.TRSP_AGMT_SEQ          = C.TRSP_AGMT_SEQ
	    AND C.TRSP_AGMT_OFC_CTY_CD   = D.TRSP_AGMT_OFC_CTY_CD
	    AND C.TRSP_AGMT_SEQ          = D.TRSP_AGMT_SEQ
	    AND C.TRSP_AGMT_RT_TP_SER_NO = D.TRSP_AGMT_RT_TP_SER_NO
	    AND D.TRSP_AGMT_OFC_CTY_CD   = E.TRSP_AGMT_OFC_CTY_CD
	    AND D.TRSP_AGMT_SEQ          = E.TRSP_AGMT_SEQ
	    AND D.TRSP_AGMT_RT_TP_SER_NO = E.TRSP_AGMT_RT_TP_SER_NO
	    AND D.TRSP_AGMT_SCG_NOD_SEQ  = E.TRSP_AGMT_SCG_NOD_SEQ
	    AND B.AGMT_VNDR_PRMRY_FLG  = 'Y'
	    AND D.TRSP_SCG_CD = 'FUA'
	    AND D.AGMT_ROUT_ALL_FLG = 'Y'
	#if ($arr_agmt_no.size() > 0) 
	    AND (A.TRSP_AGMT_OFC_CTY_CD,A.TRSP_AGMT_SEQ) IN (
	    #foreach( ${key} in ${arr_agmt_no}) 
			#if($velocityCount < $arr_agmt_no.size()) 
				(SUBSTR('$key',1,3),SUBSTR('$key',4)), 
		    #else 
				(SUBSTR('$key',1,3),SUBSTR('$key',4)) 
		    #end 
	    #end
	           )
	#end
	
	#if ($arr_vndr_seq.size() > 0 )
	    AND (A.TRSP_AGMT_OFC_CTY_CD, A.TRSP_AGMT_SEQ) IN ( SELECT TRSP_AGMT_OFC_CTY_CD, TRSP_AGMT_SEQ
												             FROM TRS_AGMT_APLY_VNDR
											                WHERE VNDR_SEQ IN (
																			#if($velocityCount < $arr_vndr_seq.size()) 
																				'$key',
																			#else
																				'$key'
	        	                                                            #end
																			)
														      AND DELT_FLG = 'N'
												          )
	#end
	
	#if ($arr_ctrt_office.size() > 0) 
	    AND A.CTRT_OFC_CD IN (
	    #foreach( ${key} in ${arr_ctrt_office}) 
			#if($velocityCount < $arr_ctrt_office.size()) 
				'$key', 
		    #else 
				'$key' 
		    #end 
	    #end
	           )
	#end
	
	#if (${fm_effective_agmt} != 'A' )
	    AND (SELECT GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(A.CTRT_OFC_CD)  FROM DUAL ) BETWEEN E.EFF_FM_DT AND E.EFF_TO_DT
	#end
	
	#if (${fm_trsp_cost_mod_cd} != '' )
	 	AND C.TRSP_COST_MOD_CD =  @[fm_trsp_cost_mod_cd]
	#end
	#if (${fm_agmt_trsp_tp_cd} != '' )
		AND C.AGMT_TRSP_TP_CD = @[fm_agmt_trsp_tp_cd]
	#end
	    AND NVL(E.DELT_FLG, 'N')     = 'N'
	    AND E.EQ_KND_CD = 'U'
	) X
WHERE 1=1
  AND X.RATE_TOT_CNT > 0			]]></sql>
			<params>
				<param name="fm_trsp_cost_mod_cd" type="12" value="" out="N"/>
				<param name="fm_agmt_trsp_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
