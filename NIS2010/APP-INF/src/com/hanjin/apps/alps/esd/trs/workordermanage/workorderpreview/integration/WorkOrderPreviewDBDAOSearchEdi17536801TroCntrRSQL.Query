<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="WorkOrderPreviewDBDAOSearchEdi17536801TroCntrRSQL">
			<desc><![CDATA[searchEdi_175368_01_TRO_CNTR]]></desc>
			<sql><![CDATA[
SELECT
 X.CNTR_NO
,X.CNTR_TARE_WGT
,NVL(SUBSTR(TMP, 1, INSTR(TMP, '$', 1, 1) -1),X.cntr_wgt) + X.CNTR_TARE_WGT AS cntr_gross_wgt 
,X.CNTR_TP
,X.CNTR_TP_DESC
,X.TRO_BOUND
,X.TRO_TYPE
,SUBSTR(TMP, INSTR(TMP, '$', 1, 1) + 1, INSTR(TMP, '$', 1, 2) - INSTR(TMP, '$', 1, 1) - 1) AS tro_haul_type 
,X.BKG_NO
,X.BL_NO
,X.TVVD_LANE
,X.TVVD_VSL_CALL
,X.TVSL_NAME
,X.TVVD_VVD
,X.TVV_POR
,X.TVV_POL
,SUBSTR(TMP4, 1, INSTR(TMP4, '$', 1, 1) -1) AS TVVD_POL_NM 
,X.TVVD_POD
,SUBSTR(TMP5, 1, INSTR(TMP5, '$', 1, 1) -1) AS TVVD_POD_NM 
,SUBSTR(TMP2, 1, INSTR(TMP2, '$', 1, 1) -1) AS tvvd_etd
,SUBSTR(TMP2, INSTR(TMP2, '$', 1, 1) + 1, INSTR(TMP2, '$', 1, 2) - INSTR(TMP2, '$', 1, 1) - 1) AS tvvd_eta
,X.DEL
,X.MT_IND
,SUBSTR(TMP2, INSTR(TMP2, '$', 1, 2) + 1, INSTR(TMP2, '$', 1, 3) - INSTR(TMP2, '$', 1, 2) - 1) AS rf_ind
,SUBSTR(TMP2, INSTR(TMP2, '$', 1, 3) + 1, INSTR(TMP2, '$', 1, 4) - INSTR(TMP2, '$', 1, 3) - 1) AS dg_ind
,SUBSTR(TMP2, INSTR(TMP2, '$', 1, 4) + 1, INSTR(TMP2, '$', 1, 5) - INSTR(TMP2, '$', 1, 4) - 1) AS awk_ind
,TRIM(SUBSTR( REPLACE( REPLACE(REPLACE(REPLACE(spcl_inst ,CHR(13)||CHR(10),' '), '\"','*'),CHR(9),' '), CHR(10),' ') ,1,350)) spcl_inst
,TRIM(SUBSTR( REPLACE( REPLACE(REPLACE(REPLACE(SUBSTR(TMP2, INSTR(TMP2, '$', 1, 5) + 1, INSTR(TMP2, '$', 1, 6) - INSTR(TMP2, '$', 1, 5) - 1) ,CHR(13)||CHR(10),' '), '\"','*'),CHR(9),' '), CHR(10),' ') ,1,350)) remark
,SUBSTR(TMP, INSTR(TMP, '$', 1, 3) + 1, INSTR(TMP, '$', 1, 4) - INSTR(TMP, '$', 1, 3) - 1) AS trm_customs_no 
,SUBSTR(TMP3, 1, INSTR(TMP3, '$', 1, 1) -1) AS cmd_hs_cd 
,X.PU_YD
,X.PU_YD_DESC
,X.PU_DT
,X.FM_YD
,X.FM_YD_DESC
,X.FM_YD_DT
,X.TO_YD
,X.TO_YD_DESC
,X.TO_YD_DT
,X.RTN_YD
,X.RTN_YD_DESC
,X.RTN_DT
,X.SEAL_NO
,(SELECT /*+ INDEX_ASC(DTL XPKBKG_EUR_TRO_DTL) */
       DTL.LOD_REF_NO
  FROM BKG_EUR_TRO_DTL DTL
 WHERE DTL.BKG_NO      = SUBSTR(TMP, INSTR(TMP, '$', 1, 4) + 1, INSTR(TMP, '$', 1, 5) - INSTR(TMP, '$', 1, 4) - 1)
   AND DTL.IO_BND_CD   = SUBSTR(TMP, INSTR(TMP, '$', 1, 5) + 1, INSTR(TMP, '$', 1, 6) - INSTR(TMP, '$', 1, 5) - 1)
   AND DTL.TRO_SEQ     = SUBSTR(TMP, INSTR(TMP, '$', 1, 6) + 1, INSTR(TMP, '$', 1, 7) - INSTR(TMP, '$', 1, 6) - 1)
   AND ROWNUM = 1
  ) LOAD_REF 
,(SELECT A.CMDT_CD FROM BKG_BOOKING A WHERE A.BKG_NO = X.BKG_NO) AS BKG_CMDT_CODE
,(SELECT CMDT.CMDT_NM FROM MDM_COMMODITY CMDT WHERE CMDT.CMDT_CD = (SELECT A.CMDT_CD FROM BKG_BOOKING A WHERE A.BKG_NO = X.BKG_NO)) AS BKG_CMDT_DESC
,SUBSTR(TMP6, 1, INSTR(TMP6, '$', 1, 1) -1) AS VGM_WEIGHT
,SUBSTR(TMP6, INSTR(TMP6, '$', 1, 1) + 1, INSTR(TMP6, '$', 1, 2) - INSTR(TMP6, '$', 1, 1) - 1) AS VGM_UNIT
,SUBSTR(TMP6, INSTR(TMP6, '$', 1, 2) + 1, INSTR(TMP6, '$', 1, 3) - INSTR(TMP6, '$', 1, 2) - 1) AS VGM_METHOD
,SUBSTR(TMP6, INSTR(TMP6, '$', 1, 3) + 1, INSTR(TMP6, '$', 1, 4) - INSTR(TMP6, '$', 1, 3) - 1) AS VGM_AUTH_PERSON
FROM
(
    SELECT
           so.eq_no cntr_no
          ,tpsz.cntr_tpsz_tare_wgt cntr_tare_wgt
          ,tpsz.cntr_tpsz_iso_cd cntr_tp
          ,so.eq_tpsz_cd cntr_tp_desc
          ,so.trsp_bnd_cd tro_bound		
          ,so.trsp_crr_mod_cd tro_type
          ,so.bkg_no bkg_no
          ,so.bl_no bl_no
          ,so.slan_cd tvvd_lane
          ,vsl.call_sgn_no tvvd_vsl_call
          ,vsl.vsl_eng_nm tvsl_name
          ,so.vsl_cd||so.skd_voy_no||so.skd_dir_cd	tvvd_vvd
          ,so.por_cd tvv_por
          ,so.pol_cd tvv_pol
          ,so.pod_cd tvvd_pod
          ,so.del_cd del
          ,DECODE(so.cgo_tp_cd,'F','N','B','N','Y')	mt_ind
          ,'' pu_yd
          ,'' pu_yd_desc
          ,'' pu_dt
          ,so.fm_nod_cd fm_yd
          ,yd1.yd_nm fm_yd_desc
          ,TO_CHAR(so.n1st_nod_pln_dt ,'YYYYMMDDHH24MI') fm_yd_dt
          ,so.to_nod_cd to_yd
          ,yd3.yd_nm to_yd_desc
          ,TO_CHAR(so.lst_nod_pln_dt,'YYYYMMDDHH24MI') to_yd_dt
          ,'' rtn_yd
          ,'' rtn_yd_desc
          ,'' rtn_dt
          ,(SELECT SEAL.CNTR_SEAL_NO  FROM BKG_CNTR_SEAL_NO SEAL
                                     WHERE SEAL.CNTR_SEAL_SEQ = 1
                                       AND SEAL.BKG_NO  = SO.BKG_NO
                                       AND SEAL.CNTR_NO = SO.EQ_NO ) seal_no  
        ,so.cntr_wgt    --추가
        ,so.spcl_instr_rmk AS spcl_inst
        ,
        (
        SELECT  tro.cgo_wgt || '$' || 
                tro.EUR_TRNS_TP_CD || '$' || 
                tro.spcl_instr_rmk || '$' || 
                tro.cstms_clr_no || '$' ||
                tro.BKG_NO || '$' || 
                tro.IO_BND_CD || '$' || 
                tro.TRO_SEQ || '$'
        FROM   bkg_eur_tro tro
        WHERE 1=1
           AND so.bkg_no = tro.bkg_no
           AND so.trsp_bnd_cd  = tro.io_bnd_cd
           AND so.tro_seq = tro.tro_seq   
        ) TMP
        ,
        (
        SELECT 
              TO_CHAR(skd1.vps_etd_dt,'YYYYMMDDHH24MI') || '$' || 
              TO_CHAR(skd2.vps_eta_dt,'YYYYMMDDHH24MI') || '$' || 
              CASE WHEN SO.VNDR_SEQ IN (114745, 194962,157955) THEN (SELECT RC_FLG FROM BKG_CONTAINER WHERE BKG_NO = BKG.BKG_NO AND CNTR_NO = SO.EQ_NO)                                                
                   ELSE bkg.rc_flg                                                 
              END || '$' ||                                                           
              CASE WHEN SO.VNDR_SEQ IN (114745, 194962,157955) THEN (SELECT DCGO_FLG FROM BKG_CONTAINER WHERE BKG_NO = BKG.BKG_NO AND CNTR_NO = SO.EQ_NO)                                                
              	   ELSE bkg.dcgo_flg                                                 
              END || '$' ||                                                 
              CASE WHEN SO.VNDR_SEQ IN (114745, 194962,157955) THEN (SELECT AWK_CGO_FLG FROM BKG_CONTAINER WHERE BKG_NO = BKG.BKG_NO AND CNTR_NO = SO.EQ_NO)                                                
                   ELSE bkg.awk_cgo_flg                                                 
              END || '$' ||
              bkg.inter_rmk || '$'
          FROM 
               vsk_vsl_port_skd skd1
              ,vsk_vsl_port_skd skd2
              ,bkg_vvd bv        
              ,bkg_booking bkg
         WHERE 1=1
           AND bv.bkg_no = bkg.bkg_no
           AND bv.vsl_pre_pst_cd = 'T'
           AND bv.vsl_cd = SKD1.VSL_CD
           AND bv.skd_voy_no = skd1.skd_voy_no
           AND bv.skd_dir_cd = skd1.skd_dir_cd
           AND bv.pol_cd = skd1.vps_port_cd
           AND skd1.clpt_ind_seq =1
           AND bv.vsl_cd = skd2.vsl_cd
           AND bv.skd_voy_no = skd2.skd_voy_no
           AND bv.skd_dir_cd = skd2.skd_dir_cd
           AND bv.pod_cd = skd2.vps_port_cd
           AND skd2.clpt_ind_seq =1
           AND so.bkg_no = bkg.bkg_no
        ) TMP2
        ,
        (
            SELECT
                cm.cmdt_hs_cd || '$'
            FROM bkg_cntr_mf_desc cm
            WHERE 1=1
            AND so.bkg_no = cm.bkg_no
            AND so.eq_no = cm.cntr_no
            AND cm.cntr_mf_seq= 1 
        ) TMP3
        ,
        (
            SELECT loc1.loc_nm || '$' FROM mdm_location loc1
            WHERE 1=1
            AND loc1.loc_cd = so.pol_cd
        ) TMP4 
        ,
        (
            SELECT loc2.loc_nm || '$' FROM mdm_location loc2
            WHERE 1=1
            AND loc2.loc_cd = so.pod_cd
        ) TMP5
		,
        (
			SELECT VGM_WGT || '$' || VGM_WGT_UT_CD || '$' || VGM_MZD_TP_CD || '$' || VGM_VRFY_SIG_CTNT || '$' FROM BKG_CONTAINER
            WHERE 1=1
			AND BKG_NO = SO.BKG_NO
			AND CNTR_NO = SO.EQ_NO
		) TMP6
      FROM mdm_cntr_tp_sz tpsz
          ,mdm_vsl_cntr vsl
          ,mdm_yard yd1
          ,mdm_yard yd2
          ,mdm_yard yd3
          ,trs_trsp_svc_ord so                          
     WHERE so.delt_flg	<> 'Y'							
       AND so.trsp_so_ofc_cty_cd = @[trsp_so_ofc_cty_cd]
       AND so.trsp_so_seq = @[trsp_so_seq]
       AND so.hjl_no IS NULL
       AND so.eq_tpsz_cd	= tpsz.cntr_tpsz_cd
       AND so.vsl_cd = vsl.vsl_cd
       AND so.fm_nod_cd = yd1.yd_cd
       AND so.via_nod_cd = yd2.yd_cd(+)
       AND so.to_nod_cd = yd3.yd_cd
) X			]]></sql>
			<params>
				<param name="trsp_so_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="trsp_so_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
