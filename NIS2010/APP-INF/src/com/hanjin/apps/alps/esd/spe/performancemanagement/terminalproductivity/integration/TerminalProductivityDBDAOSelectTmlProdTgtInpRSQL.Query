<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TerminalProductivityDBDAOSelectTmlProdTgtInpRSQL">
			<desc><![CDATA[Terminal Productivity Target Input 을 조회한다.]]></desc>
			<sql><![CDATA[
SELECT AA.EG_ID
     , AA.EG_NM
     , BB.EV_YR
     , LPAD(BB.SP_SEQ, 6, '0') AS SP_SEQ
     , (SELECT VNDR_LGL_ENG_NM FROM MDM_VENDOR WHERE VNDR_SEQ= BB.SP_SEQ AND NVL(DELT_FLG, 'N') <> 'Y') SP_NAME
     , BB.TML_CD     
     , (SELECT ROUND(SUM((JAN_RTO+FEB_RTO+MAR_RTO+APR_RTO+MAY_RTO+JUN_RTO+JUL_RTO+AUG_RTO+SEP_RTO+OCT_RTO+NOV_RTO+DEC_RTO)/12)/COUNT(1),2) 
        	  FROM SPE_EV_GRP_KPI_PERF KP
                 , SPE_SP_SVC_CATE_KPI SCKP
        	 WHERE KP.SP_KPI_ID = SCKP.SP_KPI_ID
               AND KP.EG_ID = BB.EG_ID
        	   AND SCKP.SP_KPI_TP_CD = 'P'
               AND EV_SVC_CATE_CD = AA.EV_SVC_CATE_CD
               AND SP_SEQ = BB.SP_SEQ
        	   AND KP.EV_YR = TO_NUMBER(BB.EV_YR)-1
       ) AS PRE_PERF_RTO
     , (SELECT SUM(KPI_TGT_RTO) 
          FROM SPE_EV_GRP_TML_PROD_TGT 
         WHERE EG_ID = BB.EG_ID
           AND SP_SEQ = BB.SP_SEQ
           AND TML_CD = BB.TML_CD
           AND EV_YR  = TO_NUMBER(BB.EV_YR)-1) AS PRE_TGT_RTO
     , BB.KPI_TGT_RTO
     , BB.KPI_RMK
     , BB.EG_TML_PROD_TGT_SEQ
     , DECODE(BB.EG_TML_PROD_TGT_SEQ,NULL,'N','Y') AS ISFLAG
  FROM SPE_EV_GRP AA
     , (SELECT B.EG_ID
             , A.EG_TML_PROD_TGT_SEQ
             , B.EV_YR
             , B.SP_SEQ
             , A.TML_CD
             , A.KPI_TGT_RTO
             , A.KPI_WGT_RTO
             , A.KPI_RMK
             , B.BZC_EV_GRD_CD
          FROM SPE_EV_GRP_TML_PROD_TGT A
             , SPE_SP_BZC_EV_GRP B
         WHERE A.SP_SEQ(+) = B.SP_SEQ
           AND A.EG_ID(+)  = B.EG_ID
           AND A.EV_YR(+)  = B.EV_YR
           AND B.EV_YR     = @[s_ev_yr]
        ) BB
     , (SELECT A.EG_ID
             , A.SP_KPI_ID
             , A.EV_YR
          FROM SPE_EV_GRP_KPI_PERF_TGT A
             , SPE_SP_SVC_CATE_KPI B
         WHERE A.SP_KPI_ID = B.SP_KPI_ID
           AND B.SP_KPI_TP_CD = 'P'
           AND A.EV_YR     =  @[s_ev_yr]
       ) CC
 WHERE AA.EG_ID = BB.EG_ID(+)
   AND AA.EG_ID = CC.EG_ID(+) 
   AND BB.BZC_EV_GRD_CD IS NOT NULL
   AND AA.DELT_FLG         = 'N'
   AND AA.EG_RHQ_CD        = @[s_eg_rhq_cd]
   AND AA.EG_OFC_CD        = @[s_eg_ofc_cd]
   AND AA.EV_SVC_CATE_CD   = @[s_ev_svc_cate_cd]
#if(${s_tml_cd}!='')
   AND BB.TML_CD           = @[s_tml_cd]
#end
#if(${s_sp_seq}!='')
   AND BB.SP_SEQ          = @[s_sp_seq]
#end
ORDER BY BB.EV_YR DESC,AA.EG_ID, BB.SP_SEQ			]]></sql>
			<params>
				<param name="s_ev_yr" type="12" value="" out="N"/>
				<param name="s_eg_rhq_cd" type="12" value="" out="N"/>
				<param name="s_eg_ofc_cd" type="12" value="" out="N"/>
				<param name="s_ev_svc_cate_cd" type="12" value="" out="N"/>
				<param name="s_tml_cd" type="12" value="" out="N"/>
				<param name="s_sp_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
