<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TerminalInvoiceInquiryDBDAOSearchTerminalInvoiceExcelPrintRSQL">
			<desc><![CDATA[Terminal Invoice 내역을 EXCEL 또는 PDF 파일로 출력한다.]]></desc>
			<sql><![CDATA[
SELECT   YD_CD                                                                   
        ,YD_NM                                                                   	  
        ,INV_NO                                                                   	  
        ,CURR_CD                                                                   	  
        ,VAT_AMT                                                                   	  
        ,TTL_INV_AMT                                                                   
        ,TTL_AMT                                                                   	  
        ,ISS_DT                                                                   	  
        ,RCV_DT                                                                   	  
        ,TML_INV_STS_CD                                                                
        ,TML_INV_STS_NM                                                                
        ,RJCT_STS                                                             		
        ,TML_INV_RJCT_STS_NM                                                           
        ,INV_RJCT_RMK                                                             	  
        ,TES_TML_SO_HDR_CSR_NO                                                         
        ,AP_INV_HDR_CSR_NO                                                             
        ,INV_PAY_MZD_CD                                                                
        ,INV_CHK_TRNS_NO                                                               
        ,VNDR_SEQ                                                                		
FROM (SELECT  H.YD_CD 
             ,(SELECT YD_NM FROM MDM_YARD WHERE YD_CD = H.YD_CD) YD_NM                         
             ,H.INV_NO
             ,H.CURR_CD                                             
             ,H.VAT_AMT
             ,H.TTL_INV_AMT                                        
             ,NVL (H.VAT_AMT, 0) + NVL (H.TTL_INV_AMT, 0) TTL_AMT             
             ,TO_CHAR (H.ISS_DT, 'YYYY-MM-DD HH24:MI:SS') ISS_DT              
             ,TO_CHAR (H.RCV_DT, 'YYYY-MM-DD HH24:MI:SS') RCV_DT              
             ,H.TML_INV_STS_CD                                                
             ,DECODE (H.TML_INV_STS_CD,'R', 'AUDITING'                                                                                  
                         	          ,'C', 'AUDITING'                                         
                                      ,'A', 'AUDITING'                                         
                                      ,'P', 'PROCESSING'                                       
                                      ,'D', 'PAID'      ) TML_INV_STS_NM
             ,DECODE(H.TML_INV_RJCT_STS_CD,'NL','N' 					
                                          ,NULL,'N'					
                                          ,'','N','Y'   ) RJCT_STS		
             ,DECODE(H.TML_INV_RJCT_STS_CD,'NL','Normal'				
					  					  ,'RJ','Rejected'				
					  					  ,'RL','Normal') TML_INV_RJCT_STS_NM
             ,H.INV_RJCT_RMK 							
             ,H.CSR_NO TES_TML_SO_HDR_CSR_NO 					
	         ,A.CSR_NO AP_INV_HDR_CSR_NO      			
             ,A.PAY_MZD_LU_CD INV_PAY_MZD_CD                                  
             ,A.FTU_USE_CTNT1 INV_CHK_TRNS_NO                                 
             ,H.VNDR_SEQ						          
      FROM  TES_TML_SO_HDR H
           ,AP_INV_HDR A                                   
      WHERE 1 = 1                                                            
      AND NVL (h.DELT_FLG, 'N') <> 'Y'                                     
      AND H.CSR_NO = A.CSR_NO(+)                                           

#if ($r_serviceOrderNo.size() > 0) 
      AND (H.TML_SO_OFC_CTY_CD,H.TML_SO_SEQ) IN (
	#foreach(${sonoKey} in ${r_serviceOrderNo}) 
		#if(${velocityCount} < $r_serviceOrderNo.size()) 
			(SUBSTR('${sonoKey}',0,3),TO_NUMBER(SUBSTR('${sonoKey}',4,LENGTH('${sonoKey}')))),
		#else 
			(SUBSTR('${sonoKey}',0,3),TO_NUMBER(SUBSTR('${sonoKey}',4,LENGTH('${sonoKey}'))))
		#end 
	#end 
  )
#end 

UNION ALL                                                                        
	  SELECT  E.YD_CD 
        	 ,(SELECT YD_NM FROM MDM_YARD WHERE YD_CD = E.YD_CD) YD_NM                        
 			 ,E.INV_NO
 			 ,E.CURR_CD                                            
 			 ,E.VAT_AMT 
 			,E.TTL_INV_AMT                                       
 			,NVL (E.VAT_AMT, 0) + NVL (E.TTL_INV_AMT, 0) TTL_AMT            
 			,NULL ISS_DT                                                    
 			,TO_CHAR (E.RCV_DT, 'YYYY-MM-DD HH24:MI:SS') RCV_DT             
 			,E.TML_INV_STS_CD                                               
 			,DECODE(E.TML_INV_STS_CD,'R','EDI Received') TML_INV_STS_NM     
			,DECODE(E.TML_INV_RJCT_STS_CD,'NL','N'			
				    				 	 ,NULL,'N'			
				    				 	 ,'','N','Y') RJCT_STS
 			,DECODE(E.TML_INV_RJCT_STS_CD,'NL','Normal'				
			             			     ,'RJ','Rejected') TML_INV_RJCT_STS_NM
 			,E.INV_RJCT_RMK                       					
        	,NULL TES_TML_SO_HDR_CSR_NO           					
        	,NULL AP_INV_HDR_CSR_NO               					
        	,NULL INV_PAY_MZD_CD                 					
        	,NULL INV_CHK_TRNS_NO                 				
        	,E.VNDR_SEQ			                 			
	  FROM TES_EDI_SO_HDR E                                                
	  WHERE 1 = 1                                                           
	  AND NVL(E.DELT_FLG, 'N') <> 'Y'                                    
	  AND E.TML_SO_OFC_CTY_CD IS NULL                                     
	  AND E.TML_SO_SEQ IS NULL                                            

#if ($r_serviceOrderNo.size() > 0) 
      AND (E.TML_SO_OFC_CTY_CD,E.TML_SO_SEQ) IN (
	#foreach(${sonoKey} in ${r_serviceOrderNo}) 
		#if(${velocityCount} < $r_serviceOrderNo.size()) 
			(SUBSTR('${sonoKey}',0,3),TO_NUMBER(SUBSTR('${sonoKey}',4,LENGTH('${sonoKey}')))),
		#else 
			(SUBSTR('${sonoKey}',0,3),TO_NUMBER(SUBSTR('${sonoKey}',4,LENGTH('${sonoKey}'))))
		#end 
	#end 
  )
#end 
)
ORDER BY VNDR_SEQ, INV_NO DESC			]]></sql>
			<params>
			</params>
		</query>
	</querys>
</sqls>
