<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EacRegRptDBDAOSearchOfcStatisticsRSQL">
			<desc><![CDATA[월별 비용심사 실적 조회]]></desc>
			<sql><![CDATA[
SELECT AUDR_OFC_CD
      ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'VU' THEN 1 ELSE 0 END)) AS M_BIL_UMCH_CNT
      ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'VU' THEN INV_AUD_USD_AMT ELSE 0 END)) AS M_BIL_UMCH_AMT
      ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'RD' THEN 1 ELSE 0 END)) AS M_RT_DIS_UMCH_CNT
      ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'RD' THEN INV_AUD_USD_AMT ELSE 0 END)) AS M_RT_DIS_UMCH_AMT
      ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'DB' THEN 1 ELSE 0 END)) AS M_DBL_BIL_UMCH_CNT
      ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'DB' THEN INV_AUD_USD_AMT ELSE 0 END)) AS M_DBL_BIL_UMCH_AMT
      ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'NH' THEN 1 ELSE 0 END)) AS M_NOT_ACCT_UMCH_CNT
      ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'NH' THEN INV_AUD_USD_AMT ELSE 0 END)) AS M_NOT_ACCT_UMCH_AMT
      ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'LE' THEN 1 ELSE 0 END)) AS M_LACK_EVID_CNT
      ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'LE' THEN INV_AUD_USD_AMT ELSE 0 END)) AS M_LACK_EVID_AMT
      ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'MO' THEN 1 ELSE 0 END)) AS M_OTR_CNT
      ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'MO' THEN INV_AUD_USD_AMT ELSE 0 END)) AS M_OTR_AMT          
      ,SUM((CASE WHEN EAC_TP_CD = 'M' THEN 1 ELSE 0 END)) AS M_SUB_TOT_CNT
      ,SUM((CASE WHEN EAC_TP_CD = 'M' THEN INV_AUD_USD_AMT ELSE 0 END)) AS M_SUB_TOT_AMT
      ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'BE' THEN 1 ELSE 0 END)) AS I_BKG_CNT
      ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'BE' THEN INV_AUD_USD_AMT ELSE 0 END)) AS I_BKG_AMT
      ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'WE' THEN 1 ELSE 0 END)) AS I_WRK_ORD_CNT
      ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'WE' THEN INV_AUD_USD_AMT ELSE 0 END)) AS I_WRK_ORD_AMT
      ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'OR' THEN 1 ELSE 0 END)) AS I_OP_CNT
      ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'OR' THEN INV_AUD_USD_AMT ELSE 0 END)) AS I_OP_AMT
      ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'CE' THEN 1 ELSE 0 END)) AS I_CTRT_CNT
      ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'CE' THEN INV_AUD_USD_AMT ELSE 0 END)) AS I_CTRT_AMT
      ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'SE' THEN 1 ELSE 0 END)) AS I_SYS_CNT
      ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'SE' THEN INV_AUD_USD_AMT ELSE 0 END)) AS I_SYS_AMT
      ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'OE' THEN 1 ELSE 0 END)) AS I_OTR_CNT
      ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'OE' THEN INV_AUD_USD_AMT ELSE 0 END)) AS I_OTR_AMT
      ,SUM((CASE WHEN EAC_TP_CD = 'I' THEN 1 ELSE 0 END)) AS I_SUB_TOT_CNT
      ,SUM((CASE WHEN EAC_TP_CD = 'I' THEN INV_AUD_USD_AMT ELSE 0 END)) AS I_SUB_TOT_AMT
      ,SUM((CASE WHEN EAC_TP_CD = 'T' THEN 1 ELSE 0 END)) AS MIS_TPB_CNT
      ,SUM((CASE WHEN EAC_TP_CD = 'T' THEN INV_AUD_USD_AMT ELSE 0 END)) AS MIS_TPB_AMT
      ,SUM((CASE WHEN EAC_TP_CD IN ('M', 'I', 'T') THEN 1 ELSE 0 END)) AS TOT_CNT
      ,SUM((CASE WHEN EAC_TP_CD IN ('M', 'I', 'T') THEN INV_AUD_USD_AMT ELSE 0 END)) AS TOT_AMT
 FROM      
(    
    SELECT CASE WHEN @[s_ofc_tp_cd] = 'A' THEN AUDR_OFC_CD
                WHEN @[s_ofc_tp_cd] = 'K' THEN KPI_OFC_CD
           END AUDR_OFC_CD
          ,EAC_TP_CD
          ,EAC_BIL_TP_CD
          ,CASE WHEN @[s_cal_val] = 'I' THEN INV_AUD_USD_AMT
                WHEN @[s_cal_val] = 'U' THEN ROUND(INV_AUD_USD_AMT)
                WHEN @[s_cal_val] = 'T' THEN TRUNC(INV_AUD_USD_AMT)            
           END INV_AUD_USD_AMT
      FROM EAS_EXPN_AUD_CS_MGMT
     WHERE 1=1
--       AND EAC_STS_CD IN ('IS', 'AC', 'RC', 'HC') 요청에 의한 코드 변경
       AND EAC_STS_CD IN ('HC')
       #if (${s_rhq_ofc_cd} != '')
         #if (${s_rhq_ofc_cd} == 'SELADG')
         AND AUDR_OFC_CD = @[s_rhq_ofc_cd]
         #else
         AND TRS_COMMON_PKG.TRS_GET_RHQ_OFC_CD(AUDR_OFC_CD) = @[s_rhq_ofc_cd] -- RHQ 필수
         #end
       #end
       #if (${s_ofc_cd} != '')
         #if (${s_ofc_tp_cd} == 'A')
         AND AUDR_OFC_CD = @[s_ofc_cd] -- Audit Office
         #elseif (${s_ofc_tp_cd} == 'K')
         AND KPI_OFC_CD = @[s_ofc_cd] -- Audit Office
         #end
       #end
       AND EAC_YRMON BETWEEN replace(@[s_eac_yrmon_fm],'-','') AND replace(@[s_eac_yrmon_to],'-','') -- Audit Month 필수
       #if (${s_eac_tp_cd} != '') 
       AND EAC_TP_CD = @[s_eac_tp_cd] -- EAC Type
       #end
       #if (${s_eac_apro_tp_cd} != '') 
       AND EAC_APRO_TP_CD = @[s_eac_apro_tp_cd] -- Audit Type
       #end
)
 GROUP BY AUDR_OFC_CD			]]></sql>
			<params>
				<param name="s_ofc_tp_cd" type="12" value="" out="N"/>
				<param name="s_cal_val" type="12" value="" out="N"/>
				<param name="s_rhq_ofc_cd" type="12" value="" out="N"/>
				<param name="s_ofc_cd" type="12" value="" out="N"/>
				<param name="s_eac_yrmon_fm" type="12" value="" out="N"/>
				<param name="s_eac_yrmon_to" type="12" value="" out="N"/>
				<param name="s_eac_tp_cd" type="12" value="" out="N"/>
				<param name="s_eac_apro_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
