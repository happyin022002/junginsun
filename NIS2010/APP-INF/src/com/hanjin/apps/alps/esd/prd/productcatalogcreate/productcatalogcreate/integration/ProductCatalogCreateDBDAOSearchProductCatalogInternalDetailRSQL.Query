<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ProductCatalogCreateDBDAOSearchProductCatalogInternalDetailRSQL">
			<desc><![CDATA[SearchProductCatalogInternalDetail]]></desc>
			<sql><![CDATA[
SELECT DECODE(nod_lnk_div_cd,
                 'N', org_nod_cd,
                 org_nod_cd || ' -> ' || dest_nod_cd
                ) node_link,
		'Planned' trans_st, DECODE(trsp_mod_cd,'X','',trsp_mod_cd) trsp_mod_cd,
		LTRIM(TO_CHAR (TRUNC (tz_dwll_tm_hrs / 24, 0), '00'))
		|| LTRIM (TO_CHAR (MOD (tz_dwll_tm_hrs, 24), '00')) fmt_tz_dwll_tm,
		TO_CHAR (arr_st_dt, 'MON DD HH24:MI') arr_time,
		TO_CHAR (dep_fsh_dt, 'MON DD HH24:MI') dep_time,
		CASE WHEN vsl_cd IS NOT NULL AND  skd_voy_no IS NOT NULL AND skd_dir_cd IS NOT NULL THEN
			vsl_cd || TRIM (TO_CHAR (skd_voy_no, '0000')) || skd_dir_cd
  			ELSE 'N'
		END vvd,                                                                                 			
		DECODE(LENGTH(cnst_flg), 1, '1', '3') remark_img, DECODE(LENGTH(cnst_flg), 1, cnst_flg, '') remark, 
		gen_aval_spc, d7_aval_spc, rf_aval_spc, pctl_no,
		pctl_seq, vsl_slan_cd,rout_org_nod_cd, rout_dest_nod_cd ,
		CASE
			WHEN trsp_mod_cd IN ('WD', 'VD')
				AND nod_lnk_div_cd = 'L'
				AND vsl_slan_cd > ' '
			THEN 'T'
            ELSE 'F'
		END AS vvd_gb,
		TO_CHAR (arr_st_dt, 'yyyymmddhh24miss') etd,
		TO_CHAR (dep_fsh_dt, 'yyyymmddhh24miss') etb,
		org_nod_cd, dest_nod_cd,
		pctl_wtr_div_cd, nod_lnk_div_cd, mty_yd_flg,
		CASE WHEN nod_lnk_div_cd='N' AND PCTL_IO_BND_CD='O'
				AND ORG_NOD_TP_CD ='Z' AND DEST_NOD_TP_CD ='Z' THEN   'Y'
			ELSE 'N'
		END AS door_dt,
		TO_CHAR(max(dep_fsh_dt) over (partition by nod_lnk_div_cd,mty_yd_flg) ,'yyyymmddhh24miss')as delivery_dt,
		(SELECT
			CASE WHEN max(DECODE(trsp_mod_cd,'WD',trsp_mod_cd,'')) = 'WD' THEN 'W'
				WHEN max(DECODE(trsp_mod_cd,'RD',trsp_mod_cd,'')) = 'RD' THEN 'R'
				WHEN max(DECODE(trsp_mod_cd,'TD',trsp_mod_cd,'')) = 'TD' THEN 'T'
			END otm
		FROM
			(
			SELECT trsp_mod_cd ,  row_number() over(partition by trsp_mod_cd order by trsp_mod_cd) no
			FROM prd_prod_ctl_rout_dtl
			WHERE  pctl_no = @[pctl_no]
			AND pctl_io_bnd_cd ='O'
			AND  nod_lnk_div_cd='L'
			group by trsp_mod_cd
			)	
		) 	o_t_mode,
		(SELECT
				CASE WHEN max(DECODE(trsp_mod_cd,'WD',trsp_mod_cd,'')) = 'WD' THEN 'W'
					WHEN max(DECODE(trsp_mod_cd,'RD',trsp_mod_cd,'')) = 'RD' THEN 'R'
					WHEN max(DECODE(trsp_mod_cd,'TD',trsp_mod_cd,'')) = 'TD' THEN 'T'
					END itm
		FROM
			(
				SELECT trsp_mod_cd ,  row_number() over(partition by trsp_mod_cd order by trsp_mod_cd) no
				FROM prd_prod_ctl_rout_dtl
				WHERE  pctl_no = @[pctl_no]
				AND pctl_io_bnd_cd ='I'
				AND  nod_lnk_div_cd='L'
				group by trsp_mod_cd
			)	
		) 	i_t_mode,		
  	 	(SELECT
			min(pctl_seq)
  			FROM prd_prod_ctl_rout_dtl
  			WHERE  pctl_no = @[pctl_no]
  			AND trsp_mod_cd in ('WD','VD')
  			AND pctl_io_bnd_cd = 'T'		
		) load_dt_pctl_seq,
		(SELECT min(pctl_seq)
			FROM prd_prod_ctl_rout_dtl
  			WHERE  pctl_no = @[pctl_no]
  			AND pctl_io_bnd_cd = 'O'
  			AND nod_lnk_div_cd = 'N'
  			AND mty_yd_flg = 'N'		
			AND org_nod_tp_cd <> 'Z'
		) fl_rt_cy_pctl_seq                                 			
FROM prd_prod_ctl_rout_dtl
WHERE ((pctl_no =  @[pctl_no]))
ORDER BY pctl_seq
			]]></sql>
			<params>
				<param name="pctl_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
