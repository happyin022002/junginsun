<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CARIssueTransferSlipManageDBDAOSearchCSRSOlistRSQL">
			<desc><![CDATA[SearchCSRSOlist]]></desc>
			<sql><![CDATA[
SELECT
 T.TML_SO_OFC_CTY_CD, T.TML_SO_SEQ, A.AFT_ACT_FLG,
 CASE
 WHEN T.TML_INV_STS_CD='C' AND T.TML_INV_RJCT_STS_CD='RJ' THEN 0
 WHEN T.TML_INV_STS_CD='R' AND T.TML_INV_RJCT_STS_CD='RJ' THEN 1
 ELSE 0
 END CHK,
 T.INV_NO, NVL(T.TTL_INV_AMT,0) TTL_INV_AMT, NVL(T.VAT_AMT,0) VAT_AMT, NVL(T.WHLD_TAX_AMT,0) WHLD_TAX_AMT,
 NVL(T.TTL_INV_AMT,0) + NVL(T.VAT_AMT,0) - NVL(T.WHLD_TAX_AMT,0) TOTAL_AMT, TO_CHAR(T.ISS_DT,'YYYY-MM-DD') ISS_DT, TO_CHAR(T.RCV_DT,'YYYY-MM-DD') RCV_DT,
 TO_CHAR(T.INV_CFM_DT,'YYYY-MM-DD') INV_CFM_DT
, T.EDI_FLG, 
NVL(
CASE
WHEN T.EDI_FLG = 'Y'
THEN  (
    SELECT 
        CASE
        WHEN F.FILE_SEQ IS NOT NULL AND F.ORG_FILE_NM IS NOT NULL AND F.FILE_SAV_ID IS NOT NULL AND C.FILE_SAV_ID IS NOT NULL
        THEN 'Y'
        ELSE 'N'
        END FILE_CHK
    FROM TES_EDI_SO_HDR E, TES_EDI_SO_FILE F, COM_UPLD_FILE C
    WHERE 1=1
    AND E.TML_SO_OFC_CTY_CD = T.TML_SO_OFC_CTY_CD
    AND E.TML_SO_SEQ = T.TML_SO_SEQ
    AND NVL(E.DELT_FLG,'N') <> 'Y'
    AND ((E.TML_EDI_SO_OFC_CTY_CD = F.TML_EDI_SO_OFC_CTY_CD AND E.TML_EDI_SO_SEQ = F.TML_EDI_SO_SEQ)
		OR
		 (E.TML_SO_OFC_CTY_CD = F.TML_SO_OFC_CTY_CD AND E.TML_SO_SEQ = F.TML_SO_SEQ))
    AND NVL(F.DELT_FLG,'N') <> 'Y'
    AND F.FILE_SAV_ID = C.FILE_SAV_ID
    AND NVL(C.DELT_FLG,'N') <> 'Y'
	AND ROWNUM = 1
    )
ELSE 'N'
END,'N') FILE_CHK, T.YD_CD
 FROM TES_TML_SO_HDR T, AP_INV_HDR A
 WHERE 1=1
 AND T.CSR_NO = A.CSR_NO
 AND T.CSR_NO = @[csr_no]
 AND NVL(T.DELT_FLG,'N') <> 'Y'			]]></sql>
			<params>
				<param name="csr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
