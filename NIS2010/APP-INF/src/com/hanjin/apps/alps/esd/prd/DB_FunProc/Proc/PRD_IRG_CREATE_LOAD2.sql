CREATE OR REPLACE PROCEDURE PRD_IRG_CREATE_LOAD2 /* ========================================================   1. Object Name      : PRD_IRG_CREATE_LOAD2   2. Version          : 1.0   3. Create Date      : 0000.00.00   4. Sub System       : Product Catalog   5. Author           : jsy   6. Description      : 대량 excel data를  irg create   7. Revision History : 2013.05.09 최초 생성.(파라메터 추가)======================================================== */(   in_REMARK      IN   VARCHAR2     ,in_cre_user    in   varchar2  ,in_optm_flg    in   varchar2) authid current_userIS    commit_ut   NUMBER  := 1000 ;    N_VALID_COUNT         NUMBER(18);     cursor curIN is        select trim(ROUT_ORG_NOD_CD) ROUT_ORG,ROUT_DEST_NOD_CD ROUT_DEST,trim(HUB_LOC_CD) HUB_LOCATION_NODE,ROUT_SEQ,PRIO_SEQ PRIO,            INLND_ROUT_INV_BIL_PATT_CD INV_BIL_PTN,ROUT_PLN_CD ROUT_PLN,WRS_FULL_CMDT_CD WRS_FULL_CM,            WRS_MTY_CMDT_CD WRS_MTY_CM,INLND_ROUT_BKG_FLG BKG_FLAG,PCTL_IO_BND_CD IO_BND_CD,INLND_ROUT_TMP_FLG TMP_FLAG,            INLND_ROUT_INCL_STTL_FLG FREESHTL_FLAG,DELT_FLG,trim(N1ST_NOD_CD) N1ST_NODE,N1ST_TRSP_MOD_CD TM1,            N1ST_VNDR_SEQ VNDR1,N1ST_TZTM_HRS TRANSIT_TIME1,N1ST_INLND_ROUT_CMB_FLG COM_FLG1,N1ST_INLND_ROUT_JUNC_NM JUNC_NM1,            N1ST_RAIL_CRR_TP_CD RD_CRR_TP1,N1ST_TRSP_AGMT_OFC_CTY_CD AGMT_NO1,N1ST_TRSP_AGMT_SEQ AGMT_SEQ1,N1ST_AGMT_REF_NO AGMT_REF_NO1,            trim(N2ND_NOD_CD) N2ND_NODE,N2ND_TRSP_MOD_CD TM2,N2ND_VNDR_SEQ VNDR2,N2ND_TZTM_HRS TRANSIT_TIME2,            N2ND_INLND_ROUT_CMB_FLG COM_FLG2,N2ND_INLND_ROUT_JUNC_NM JUNC_NM2,N2ND_RAIL_CRR_TP_CD RD_CRR_TP2,            N2ND_TRSP_AGMT_OFC_CTY_CD AGMT_NO2,N2ND_TRSP_AGMT_SEQ AGMT_SEQ2,N2ND_AGMT_REF_NO AGMT_REF_NO2,            trim(N3RD_NOD_CD) N3RD_NODE,N3RD_TRSP_MOD_CD TM3,N3RD_VNDR_SEQ VNDR3,N3RD_TZTM_HRS TRANSIT_TIME3,            N3RD_INLND_ROUT_CMB_FLG COM_FLG3,N3RD_INLND_ROUT_JUNC_NM JUNC_NM3,N3RD_RAIL_CRR_TP_CD RD_CRR_TP3,            N3RD_TRSP_AGMT_OFC_CTY_CD AGMT_NO3,N3RD_TRSP_AGMT_SEQ AGMT_SEQ3,N3RD_AGMT_REF_NO AGMT_REF_NO3,            trim(N4TH_NOD_CD) N4TH_NODE,N4TH_TRSP_MOD_CD TM4,N4TH_VNDR_SEQ VNDR4,N4TH_TZTM_HRS TRANSIT_TIME4,            N4TH_INLND_ROUT_CMB_FLG COM_FLG4, N4TH_INLND_ROUT_JUNC_NM JUNC_NM4,N4TH_RAIL_CRR_TP_CD RD_CRR_TP4,            N4TH_TRSP_AGMT_OFC_CTY_CD AGMT_NO4,N4TH_TRSP_AGMT_SEQ AGMT_SEQ4,N4TH_AGMT_REF_NO AGMT_REF_NO4,            trim(N5TH_NOD_CD) N5TH_NODE,N5TH_TRSP_MOD_CD TM5,N5TH_VNDR_SEQ VNDR5,N5TH_TZTM_HRS TRANSIT_TIME5,            N5TH_INLND_ROUT_CMB_FLG COM_FLG5,N5TH_INLND_ROUT_JUNC_NM JUNC_NM5,N5TH_RAIL_CRR_TP_CD RD_CRR_TP5,            N5TH_TRSP_AGMT_OFC_CTY_CD AGMT_NO5,N5TH_TRSP_AGMT_SEQ AGMT_SEQ5,N5TH_AGMT_REF_NO AGMT_REF_NO5,            trim(N6TH_NOD_CD) N6TH_NODE                        from  PRD_INLND_ROUT_LOD;    V_ROUT_SEQ NUMBER;BEGIN    DBMS_OUTPUT.ENABLE;dbms_output.put_line('now Starting!');    N_VALID_COUNT := 0;     FOR recIN IN curIN LOOP        /*        * 첫번째 링크의 EACH LINK 가 없으면 INSERT        */--        insert into PRD_INLND_EACH_LNK_TMP  --TEST        insert into PRD_INLND_EACH_LNK o  --LIVE        (LNK_ORG_NOD_CD,LNK_DEST_NOD_CD,TRSP_MOD_CD,VNDR_SEQ,TZTM_HRS,LNK_RMK,CRE_DT,CRE_USR_ID,UPD_DT,UPD_USR_ID)        select recIN.N1ST_NODE  , recIN.N2ND_NODE  ,               recIN.TM1  , recIN.VNDR1  , recIN.TRANSIT_TIME1  , in_REMARK  , sysdate,'PRD', sysdate,'PRD'        from DUAL D        where         not exists (            select 'x'--            from PRD_INLND_EACH_LNK_TMP C--TEST            from PRD_INLND_EACH_LNK  C -- LIVE            where c.LNK_ORG_NOD_CD = recIN.N1ST_NODE            and  c.LNK_DEST_NOD_CD = recIN.N2ND_NODE            and c.TRSP_MOD_CD = recIN.TM1            );        /*        * 2번째 링크의 EACH LINK 가 없으면 INSERT        */                IF recIN.N3RD_NODE IS NOT NULL THEN--        insert into PRD_INLND_EACH_LNK_TMP  --TEST            insert into PRD_INLND_EACH_LNK  o  --LIVE            (LNK_ORG_NOD_CD,LNK_DEST_NOD_CD,TRSP_MOD_CD,VNDR_SEQ,TZTM_HRS,LNK_RMK,CRE_DT,CRE_USR_ID,UPD_DT,UPD_USR_ID)            select recIN.N2ND_NODE  , recIN.N3RD_NODE  ,                   recIN.TM2  , recIN.VNDR2  , recIN.TRANSIT_TIME2  ,in_REMARK, sysdate,'PRD', sysdate,'PRD'            from DUAL D            where             not exists (                select 'x'--              from PRD_INLND_EACH_LNK_TMP C--TEST                from PRD_INLND_EACH_LNK  C -- LIVE                where c.LNK_ORG_NOD_CD = recIN.N2ND_NODE                and  c.LNK_DEST_NOD_CD = recIN.N3RD_NODE                and c.TRSP_MOD_CD = recIN.TM2                    );           END IF;                             /*        * 3번째 링크의 EACH LINK 가 없으면 INSERT        */        IF recIN.N4TH_NODE IS NOT NULL THEN--          insert into PRD_INLND_EACH_LNK_TMP  --TEST            insert into PRD_INLND_EACH_LNK  o  --LIVE            (LNK_ORG_NOD_CD,LNK_DEST_NOD_CD,TRSP_MOD_CD,VNDR_SEQ,TZTM_HRS,LNK_RMK,CRE_DT,CRE_USR_ID,UPD_DT,UPD_USR_ID)            select recIN.N3RD_NODE  , recIN.N4TH_NODE  ,                   recIN.TM3  , recIN.VNDR3  , recIN.TRANSIT_TIME3  ,in_REMARK, sysdate,'PRD', sysdate,'PRD'            from DUAL D            where             not exists (                select 'x'--              from PRD_INLND_EACH_LNK_TMP C--TEST                from PRD_INLND_EACH_LNK  C -- LIVE                where c.LNK_ORG_NOD_CD = recIN.N3RD_NODE                and  c.LNK_DEST_NOD_CD = recIN.N4TH_NODE                and c.TRSP_MOD_CD = recIN.TM3                    );           END IF;                    /*        * 4번째 링크의 EACH LINK 가 없으면 INSERT        */        IF recIN.N5TH_NODE IS NOT NULL THEN--          insert into PRD_INLND_EACH_LNK_TMP  --TEST            insert into PRD_INLND_EACH_LNK  o  --LIVE            (LNK_ORG_NOD_CD,LNK_DEST_NOD_CD,TRSP_MOD_CD,VNDR_SEQ,TZTM_HRS,LNK_RMK,CRE_DT,CRE_USR_ID,UPD_DT,UPD_USR_ID)            select recIN.N4TH_NODE  , recIN.N5TH_NODE  ,                   recIN.TM4  , recIN.VNDR4  , recIN.TRANSIT_TIME4  ,in_REMARK, sysdate,'PRD', sysdate,'PRD'            from DUAL D            where             not exists (                select 'x'--              from PRD_INLND_EACH_LNK_TMP C--TEST                from PRD_INLND_EACH_LNK  C-- LIVE                where c.LNK_ORG_NOD_CD = recIN.N4TH_NODE                and  c.LNK_DEST_NOD_CD = recIN.N5TH_NODE                and c.TRSP_MOD_CD = recIN.TM4                    );          END IF;                /*        * 5번째 링크의 EACH LINK 가 없으면 INSERT        */        IF recIN.N6TH_NODE IS NOT NULL THEN--          insert into PRD_INLND_EACH_LNK_TMP  --TEST            insert into PRD_INLND_EACH_LNK  o  --LIVE            (LNK_ORG_NOD_CD,LNK_DEST_NOD_CD,TRSP_MOD_CD,VNDR_SEQ,TZTM_HRS,LNK_RMK,CRE_DT,CRE_USR_ID,UPD_DT,UPD_USR_ID)            select recIN.N5TH_NODE  , recIN.N6TH_NODE  ,                   recIN.TM5  , recIN.VNDR5  , recIN.TRANSIT_TIME5  ,in_REMARK, sysdate,'PRD', sysdate,'PRD'            from DUAL D            where             not exists (                select 'x'--              from PRD_INLND_EACH_LNK_TMP C--TEST                from PRD_INLND_EACH_LNK  C -- LIVE                where c.LNK_ORG_NOD_CD = recIN.N5TH_NODE                and  c.LNK_DEST_NOD_CD = recIN.N6TH_NODE                and c.TRSP_MOD_CD = recIN.TM5                    );         END IF;                   select nvl(max(rout_seq),0) +1        INTO V_ROUT_SEQ--        from PRD_INLND_ROUT_MST_TMP  --test        from PRD_INLND_ROUT_MST  --live                ;        --        dbms_output.put_line('now V_ROUT_SEQ!'||V_ROUT_SEQ||'-' ||recIN.ROUT_ORG||'-' ||recIN.ROUT_DEST||'-'||recIN.PRIO   );--        dbms_output.put_line(recIN.INV_BIL_PTN||'-' ||recIN.ROUT_PLN||'-' ||recIN.WRS_FULL_CM||'-' ||recIN.WRS_MTY_CM);--        dbms_output.put_line(recIN.BKG_FLAG||'-' ||recIN.IO_BND_CD||'-' ||recIN.TMP_FLAG);--        dbms_output.put_line(in_REMARK||'-' ||recIN.HUB_LOCATION_NODE);--                        /*        * 마스터 INSERT        */--        insert into PRD_INLND_ROUT_MST_TMP --TEST        insert into PRD_INLND_ROUT_MST  -- LIVE        (ROUT_ORG_NOD_CD,ROUT_DEST_NOD_CD,ROUT_SEQ,PRIO_SEQ,         INLND_ROUT_INV_BIL_PATT_CD, ROUT_PLN_CD,  WRS_FULL_CMDT_CD, WRS_MTY_CMDT_CD,          INLND_ROUT_BKG_FLG,PCTL_IO_BND_CD,         INLND_ROUT_TMP_FLG,INLND_ROUT_RMK,INLND_ROUT_N2ND_RMK, HUB_NOD_CD,CRE_DT,CRE_USR_ID,UPD_DT, UPD_USR_ID,INLND_ROUT_OPTM_FLG)        select recIN.ROUT_ORG  , recIN.ROUT_DEST  ,                V_ROUT_SEQ , recIN.PRIO  ,                recIN.INV_BIL_PTN, recIN.ROUT_PLN, recIN.WRS_FULL_CM, recIN.WRS_MTY_CM ,               recIN.BKG_FLAG  , recIN.IO_BND_CD , recIN.TMP_FLAG,               in_REMARK,in_REMARK, recIN.HUB_LOCATION_NODE, sysdate, in_cre_user, sysdate, in_cre_user ,in_optm_flg            from DUAL D        ;                        /*        * 디테일 INSERT        * 첫번쨰 링크         */--dbms_output.put_line('now dtl!'||V_ROUT_SEQ||'-' ||recIN.ROUT_ORG||'-' ||recIN.ROUT_DEST );               --        insert into PRD_INLND_ROUT_dtl_TMP --TEST         insert into PRD_INLND_ROUT_dtl   --LIVE         (ROUT_ORG_NOD_CD,ROUT_DEST_NOD_CD,ROUT_SEQ,          LNK_ORG_NOD_CD,LNK_DEST_NOD_CD,ROUT_DTL_SEQ,TRSP_MOD_CD,VNDR_SEQ,         INLND_ROUT_CMB_FLG ,INLND_ROUT_JUNC_NM,         RAIL_CRR_TP_CD, TRSP_AGMT_OFC_CTY_CD, TRSP_AGMT_SEQ, CRE_DT,CRE_USR_ID,UPD_DT,UPD_USR_ID)        select recIN.ROUT_ORG, recIN.ROUT_DEST,         V_ROUT_SEQ,        recIN.N1ST_NODE, recIN.N2ND_NODE,  1, recIN.TM1, recIN.VNDR1,         recIN.COM_FLG1, recIN.JUNC_NM1,         recIN.RD_CRR_TP1, recIN.AGMT_NO1, SUBSTR(LPAD(recIN.AGMT_SEQ1,9,'0'),4,6), SYSDATE, in_cre_user, SYSDATE, in_cre_user        from DUAL D        ;                   /*        * 디테일 INSERT        * 2번쨰 링크         */        IF recIN.N3RD_NODE IS NOT NULL THEN--          insert into PRD_INLND_ROUT_dtl_TMP --TEST             insert into PRD_INLND_ROUT_dtl --LIVE             (ROUT_ORG_NOD_CD,ROUT_DEST_NOD_CD,ROUT_SEQ,              LNK_ORG_NOD_CD,LNK_DEST_NOD_CD,ROUT_DTL_SEQ,TRSP_MOD_CD,VNDR_SEQ,             INLND_ROUT_CMB_FLG ,INLND_ROUT_JUNC_NM,             RAIL_CRR_TP_CD, TRSP_AGMT_OFC_CTY_CD, TRSP_AGMT_SEQ, CRE_DT,CRE_USR_ID,UPD_DT,UPD_USR_ID)            select recIN.ROUT_ORG, recIN.ROUT_DEST,             V_ROUT_SEQ,            recIN.N2ND_NODE, recIN.N3RD_NODE,  2, recIN.TM2, recIN.VNDR2,             recIN.COM_FLG2, recIN.JUNC_NM2,            recIN.RD_CRR_TP2, recIN.AGMT_NO2, SUBSTR(LPAD(recIN.AGMT_SEQ2,9,'0'),4,6), SYSDATE, in_cre_user, SYSDATE, in_cre_user            from DUAL D            ;          END IF;                                        /*        * 디테일 INSERT        * 3번쨰 링크         */        IF recIN.N4TH_NODE IS NOT NULL THEN--          insert into PRD_INLND_ROUT_dtl_TMP --TEST             insert into PRD_INLND_ROUT_dtl  --LIVE             (ROUT_ORG_NOD_CD,ROUT_DEST_NOD_CD,ROUT_SEQ,              LNK_ORG_NOD_CD,LNK_DEST_NOD_CD,ROUT_DTL_SEQ,TRSP_MOD_CD,VNDR_SEQ,             INLND_ROUT_CMB_FLG ,INLND_ROUT_JUNC_NM,             RAIL_CRR_TP_CD, TRSP_AGMT_OFC_CTY_CD, TRSP_AGMT_SEQ, CRE_DT,CRE_USR_ID,UPD_DT,UPD_USR_ID)            select recIN.ROUT_ORG, recIN.ROUT_DEST,             V_ROUT_SEQ,            recIN.N3RD_NODE, recIN.N4TH_NODE,  3, recIN.TM3, recIN.VNDR3,             recIN.COM_FLG3, recIN.JUNC_NM3,            recIN.RD_CRR_TP3, recIN.AGMT_NO3, SUBSTR(LPAD(recIN.AGMT_SEQ3,9,'0'),4,6), SYSDATE, in_cre_user, SYSDATE, in_cre_user            from DUAL D            ;          END IF;                                         /*        * 디테일 INSERT        * 4번쨰 링크         */        IF recIN.N5TH_NODE IS NOT NULL THEN--          insert into PRD_INLND_ROUT_dtl_TMP --TEST             insert into PRD_INLND_ROUT_dtl  --LIVE             (ROUT_ORG_NOD_CD,ROUT_DEST_NOD_CD,ROUT_SEQ,              LNK_ORG_NOD_CD,LNK_DEST_NOD_CD,ROUT_DTL_SEQ,TRSP_MOD_CD,VNDR_SEQ,             INLND_ROUT_CMB_FLG ,INLND_ROUT_JUNC_NM,             RAIL_CRR_TP_CD, TRSP_AGMT_OFC_CTY_CD, TRSP_AGMT_SEQ, CRE_DT,CRE_USR_ID,UPD_DT,UPD_USR_ID)            select recIN.ROUT_ORG, recIN.ROUT_DEST,             V_ROUT_SEQ,            recIN.N4TH_NODE, recIN.N5TH_NODE,  4, recIN.TM4, recIN.VNDR4,             recIN.COM_FLG4, recIN.JUNC_NM4,            recIN.RD_CRR_TP4, recIN.AGMT_NO4, SUBSTR(LPAD(recIN.AGMT_SEQ4,9,'0'),4,6), SYSDATE, in_cre_user, SYSDATE, in_cre_user            from DUAL D            ;          END IF;                                        /*        * 디테일 INSERT        * 4번쨰 링크         */        IF recIN.N6TH_NODE IS NOT NULL THEN--          insert into PRD_INLND_ROUT_dtl_TMP --TEST             insert into PRD_INLND_ROUT_dtl  --LIVE             (ROUT_ORG_NOD_CD,ROUT_DEST_NOD_CD,ROUT_SEQ,              LNK_ORG_NOD_CD,LNK_DEST_NOD_CD,ROUT_DTL_SEQ,TRSP_MOD_CD,VNDR_SEQ,             INLND_ROUT_CMB_FLG ,INLND_ROUT_JUNC_NM,             RAIL_CRR_TP_CD, TRSP_AGMT_OFC_CTY_CD, TRSP_AGMT_SEQ, CRE_DT,CRE_USR_ID,UPD_DT,UPD_USR_ID)            select recIN.ROUT_ORG, recIN.ROUT_DEST,             V_ROUT_SEQ,            recIN.N5TH_NODE, recIN.N6TH_NODE,  5, recIN.TM5, recIN.VNDR5,             recIN.COM_FLG5, recIN.JUNC_NM5,            recIN.RD_CRR_TP5, recIN.AGMT_NO5, SUBSTR(LPAD(recIN.AGMT_SEQ5,9,'0'),4,6), SYSDATE, in_cre_user, SYSDATE, in_cre_user            from DUAL D            ;          END IF;                                                        N_VALID_COUNT := N_VALID_COUNT + 1;                  /*            load 테이블에 작업여부 마크         */--        update  PRD_INLND_ROUT_LOD    --          set UPD_USR_ID ='OK'--        where ROUT_ORG_NOD_CD = recIN.ROUT_ORG  and ROUT_DEST_NOD_CD= recIN.ROUT_DEST ;    IF ( MOD(N_VALID_COUNT, commit_ut) = 0 ) THEN      COMMIT;      DBMS_OUTPUT.PUT_LINE( 'COMMIT! row_cnt : [' || N_VALID_COUNT || ']' );    END IF;                       END LOOP;        COMMIT;dbms_output.put_line('now end!'); DBMS_OUTPUT.PUT_LINE( 'N_VALID_COUNT : '||N_VALID_COUNT||' ... commit ' );   enis_log_prc(SYSDATE, 'PRD_IRG_CREATE_LOAD', 'N_VALID_COUNT: ' || N_VALID_COUNT);END ;/