<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceInquiryCorrectionDBDAOConfirmInvoiceSoUSQL">
			<desc><![CDATA[S/O 테이블에 Invoice Confirm 정보를 반영]]></desc>
			<sql><![CDATA[
UPDATE  TRS_TRSP_SVC_ORD 
SET     TRSP_INV_ACT_STS_CD = 'C'
      , LGS_COST_CD	        = (
                                SELECT  NVL((
                                              SELECT  A.LGS_COST_CD
                                              FROM    TRS_LGS_COST_CD_CONV_RULE A
                                                    , TRS_TRSP_SVC_ORD B
                                                    , TES_LGS_COST LGS_COST
                                              WHERE   A.COST_ACT_GRP_CD = B.COST_ACT_GRP_CD
                                              AND     A.LGS_COST_CD_CHK_FLG = DECODE(SUBSTR(FM_NOD_CD,1,5),SUBSTR(TO_NOD_CD,1,5) ,'Y','N')
                                              AND     LGS_COST.LGS_COST_CD  =A.LGS_COST_CD
                                              AND     CGO_TP_CD='F'
                                              AND     TRSP_SO_TP_CD = 'Y'
                                              AND	  B.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                                              AND	  B.TRSP_SO_SEQ = @[trsp_so_seq]
                                                      /* 2008.04.29 ETS OPEN */
                                              AND     B.HJL_NO IS NULL
                                              UNION ALL
                                              SELECT  LGS_COST.LGS_COST_CD
                                              FROM    TRS_TRSP_SVC_ORD B,TES_LGS_COST LGS_COST
                                              WHERE   LGS_COST.LGS_COST_CD = 'TR'
                                                                             || DECODE(B.TRSP_COST_DTL_MOD_CD, 'CF', 'OF', 'CN', 'ON', 'MT')
                                                                             || DECODE(B.TRSP_CRR_MOD_CD, 'TW', 'WT', 'RW', 'WR', 'TR', 'RT', B.TRSP_CRR_MOD_CD)
                                              AND     (B.CGO_TP_CD, B.TRSP_SO_TP_CD) in (('M','M'), ('M','Y'))
                                              AND	  B.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                                              AND	  B.TRSP_SO_SEQ = @[trsp_so_seq]
                                            ),  C.LGS_COST_CD)
                                FROM    TRS_TRSP_SVC_ORD C
                                WHERE   C.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                                AND	    C.TRSP_SO_SEQ = @[trsp_so_seq]
                                        /* 2008.04.29 ETS OPEN */
                                AND     C.HJL_NO IS NULL
                              )
      , ACCT_CD             = (
                                SELECT  NVL((
                                              SELECT  LGS_COST.ACCT_CD
                                              FROM    TRS_LGS_COST_CD_CONV_RULE A
                                                    , TRS_TRSP_SVC_ORD B
                                                    , TES_LGS_COST LGS_COST
                                              WHERE   A.COST_ACT_GRP_CD = B.COST_ACT_GRP_CD
                                              AND     A.LGS_COST_CD_CHK_FLG = DECODE(SUBSTR(FM_NOD_CD,1,5),SUBSTR(TO_NOD_CD,1,5) ,'Y','N')
                                              AND     LGS_COST.LGS_COST_CD  =A.LGS_COST_CD
                                              AND     CGO_TP_CD = 'F'
                                              AND     TRSP_SO_TP_CD = 'Y'
                                              AND	  B.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                                              AND	  B.TRSP_SO_SEQ = @[trsp_so_seq]
                                                      /* 2008.04.29 ETS OPEN */
                                              AND     B.HJL_NO IS NULL
                                              UNION ALL
                                              SELECT  LGS_COST.ACCT_CD
                                              FROM    TRS_TRSP_SVC_ORD B,TES_LGS_COST LGS_COST
                                              WHERE   LGS_COST.LGS_COST_CD = 'TR'
                                                                             || DECODE(B.TRSP_COST_DTL_MOD_CD, 'CF', 'OF', 'CN', 'ON', 'MT')
                                                                             || DECODE(B.TRSP_CRR_MOD_CD, 'TW', 'WT', 'RW', 'WR', 'TR', 'RT', B.TRSP_CRR_MOD_CD)
                                              AND     (B.CGO_TP_CD, B.TRSP_SO_TP_CD) in (('M','M'), ('M','Y'))
                                              AND	  B.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                                              AND	  B.TRSP_SO_SEQ = @[trsp_so_seq]
                                            ),  C.ACCT_CD)
                                FROM    TRS_TRSP_SVC_ORD C
                                WHERE   C.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                                AND	    C.TRSP_SO_SEQ = @[trsp_so_seq]
                                        /* 2008.04.29 ETS OPEN */
                                AND     C.HJL_NO IS NULL
                              )
      , FINC_VSL_CD         = (
                                SELECT	B.VSL_CD FDR_VSL_CD
                                FROM	TRS_TRSP_SVC_ORD B
                                WHERE   B.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                                AND	    B.TRSP_SO_SEQ = @[trsp_so_seq]
                                        /* 2008.04.29 ETS OPEN */
                                AND     B.HJL_NO IS NULL
                              )
      ,	FINC_SKD_VOY_NO     = (
                                SELECT	B.SKD_VOY_NO FDR_SKD_VOY_NO
                                FROM	TRS_TRSP_SVC_ORD B
                                WHERE   B.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                                AND	    B.TRSP_SO_SEQ = @[trsp_so_seq]
                                        /* 2008.04.29 ETS OPEN */
                                AND    B.HJL_NO IS NULL
                              )
      ,	FINC_SKD_DIR_CD     = (
                                SELECT  DECODE (VSL_CD ,'CNTC','M',	NVL (MAS_REV_DIR_CONV_FNC (SLAN_CD,POL_CD,SKD_DIR_CD,POD_CD),SKD_DIR_CD))
                                FROM	TRS_TRSP_SVC_ORD B
                                WHERE   B.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
                                AND	    B.TRSP_SO_SEQ = @[trsp_so_seq]
                                        /* 2008.04.29 ETS OPEN */
                                AND     B.HJL_NO IS NULL
                              )
      , UPD_USR_ID		    = @[FORM_CRE_USR_ID]
      ,	UPD_DT			    = SYSDATE
      , LOCL_UPD_DT         = GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[FORM_USR_OFC_CD])
WHERE   TRSP_SO_OFC_CTY_CD  = @[trsp_so_ofc_cty_cd]
AND     TRSP_SO_SEQ         = @[trsp_so_seq]
		/* 2008.04.29 ETS OPEN */
AND     HJL_NO IS NULL			]]></sql>
			<params>
				<param name="trsp_so_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="trsp_so_seq" type="2" value="" out="N"/>
				<param name="FORM_CRE_USR_ID" type="12" value="" out="N"/>
				<param name="FORM_USR_OFC_CD" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
