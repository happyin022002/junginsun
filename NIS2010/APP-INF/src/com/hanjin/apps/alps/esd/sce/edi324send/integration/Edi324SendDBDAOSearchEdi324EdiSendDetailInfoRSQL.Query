<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="Edi324SendDBDAOSearchEdi324EdiSendDetailInfoRSQL">
			<desc><![CDATA[COP_NO을 기준으로 발송될 EDI의 상제 정보를 가져온다.]]></desc>
			<sql><![CDATA[
SELECT NVL(DECODE(MV.LLOYD_NO, 'T.B.N.', 'TBN', 'T.B.N', 'TBN', MV.LLOYD_NO), ' ')  LLOYD_VSL_NO
     , NVL(REPLACE(MV.VSL_ENG_NM, CHR(39), ' '), ' ') VSL_NM
     , DT.NOD_CD POD_YD_CD
     , (SELECT LOC_NM FROM MDM_LOCATION WHERE LOC_CD = SUBSTR(DT.NOD_CD, 1,5)) POD_NM
     , DT.ACT_CD
     , TO_CHAR(DT.ESTM_DT,'YYYY-MM-DD HH24:MI:SS') POD_ESTM_ARR_DT
     , TO_CHAR(DT.ESTM_GDT,'YYYY-MM-DD HH24:MI:SS') POD_ESTM_ARR_GDT
     , (SELECT BL_NO FROM BKG_BOOKING WHERE BKG_NO = HD.BKG_NO) BL_NO
     , BK.CNTR_WGT CNTR_WGT
     , BK.WGT_UT_CD CNTR_WGT_UT_CD
     , ROUND((BK.CNTR_WGT * 2.2046),3) CNTR_LBS_WGT
     , BK.CNTR_TPSZ_CD CNTR_TPSZ_CD
     , SIZ.CNTR_LEN
     , SIZ.CNTR_HGT
     , (SELECT REPLACE(NVL(CNTR_SEAL_NO, ' '), CHR(13)||CHR(10), '') FROM BKG_CNTR_SEAL_NO WHERE BKG_NO = HD.BKG_NO AND CNTR_NO = HD.CNTR_NO AND CNTR_SEAL_SEQ = 1) CNTR_SEAL_NO
     , ORG.YD_LOC_CTY_NM ORG_YD_LOC_CTY_NM
     , ORG.YD_LOC_STE_CD ORG_YD_LOC_STE_CD
     , ORG.LOC_NM ORG_LOC_NM
     , DST.YD_LOC_CTY_NM DST_YD_LOC_CTY_NM
     , DST.YD_LOC_STE_CD DST_YD_LOC_STE_CD
     , DST.LOC_NM DST_LOC_NM
     , BK.DCGO_FLG DG_FLG
     , HD.BKG_NO, HD.CNTR_NO
  FROM SCE_COP_HDR HD
     , SCE_COP_DTL DT
     , MDM_VSL_CNTR MV
     , BKG_CONTAINER BK
     , (SELECT OMY.YD_CD, OMY.YD_LOC_CTY_NM, OMY.YD_LOC_STE_CD, OML.LOC_NM
          FROM MDM_YARD OMY, MDM_LOCATION OML
         WHERE OMY.LOC_CD = OML.LOC_CD
           AND OMY.YD_CD = @[org_yd_cd]
       ) ORG
     , (SELECT DMY.YD_LOC_CTY_NM, DMY.YD_LOC_STE_CD, DML.LOC_NM
          FROM MDM_YARD DMY, MDM_LOCATION DML
         WHERE DMY.LOC_CD = DML.LOC_CD
           AND DMY.YD_CD = @[dest_yd_cd]
       ) DST
     , (SELECT CNTR_TPSZ_CD, XTER_LEN CNTR_LEN, XTER_HGT CNTR_HGT
          FROM SCE_CNTR_SPEC
         WHERE DELT_FLG = 'N'
       ) SIZ
 WHERE 1 = 1
   AND HD.COP_NO = @[cop_no]
   AND HD.COP_NO = DT.COP_NO
   AND DT.COP_DTL_SEQ = ( SELECT /*+ INDEX_DESC(A XPKSCE_COP_DTL) */ COP_DTL_SEQ
         FROM SCE_COP_DTL A
        WHERE A.COP_NO = DT.COP_NO
       AND A.ACT_CD LIKE 'FU__A_'
       AND SUBSTR(A.ACT_CD,3,1) IN ( 'V','W' )
                            AND A.COP_DTL_SEQ LIKE '4%'
                            AND A.ACT_STS_CD IN('F','C','N')
       AND ROWNUM = 1 )
   AND DT.VSL_CD = MV.VSL_CD(+)
   AND HD.BKG_NO = BK.BKG_NO(+)
   AND HD.CNTR_NO = BK.CNTR_NO(+)
   AND HD.CNTR_TPSZ_CD = SIZ.CNTR_TPSZ_CD(+)			]]></sql>
			<params>
				<param name="org_yd_cd" type="12" value="" out="N"/>
				<param name="dest_yd_cd" type="12" value="" out="N"/>
				<param name="cop_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
