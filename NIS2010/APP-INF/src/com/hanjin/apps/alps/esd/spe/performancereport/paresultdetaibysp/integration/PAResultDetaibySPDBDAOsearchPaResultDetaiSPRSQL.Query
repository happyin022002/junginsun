<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PAResultDetaibySPDBDAOsearchPaResultDetaiSPRSQL">
			<desc><![CDATA[Quantitative Analysis : PA Result Detail by S/P 데이터를 조회한다]]></desc>
			<sql><![CDATA[
SELECT EG_ID
     , SP_KPI_ID
     , SP_KPI_NM
     , RSLT_SCRE_RTO
     , KPI_TGT_RTO
     , ROUND(((JAN_RTO + FEB_RTO + MAR_RTO + APR_RTO + 
                    MAY_RTO + JUN_RTO + JUL_RTO + AUG_RTO + 
                    SEP_RTO + OCT_RTO + NOV_RTO + DEC_RTO)/(KPI_TGT_RTO*INCNT)
        )*100,2)||'%' AS TGT_AVG
     , JAN_RTO  
     , FEB_RTO  
     , MAR_RTO
     , APR_RTO 
     , MAY_RTO
     , JUN_RTO 
     , JUL_RTO  
     , AUG_RTO
     , SEP_RTO 
     , OCT_RTO
     , NOV_RTO
     , DEC_RTO
  FROM (SELECT A.EG_ID
             , A.SP_KPI_ID
             , (SELECT SP_KPI_NM FROM SPE_SP_SVC_CATE_KPI WHERE SP_KPI_ID = A.SP_KPI_ID
               ) AS SP_KPI_NM
             , A.RSLT_SCRE_RTO
             , CASE  WHEN C.SP_KPI_TP_CD != 'P' THEN B.KPI_TGT_RTO 
                          ELSE (SELECT ROUND(SUM(KPI_TGT_RTO)/COUNT(1),2) FROM SPE_EV_GRP_TML_PROD_TGT WHERE EG_ID = A.EG_ID AND SP_SEQ = A.SP_SEQ)
               END AS KPI_TGT_RTO
             , A.JAN_RTO  
             , A.FEB_RTO  
             , A.MAR_RTO
             , A.APR_RTO 
             , A.MAY_RTO
             , A.JUN_RTO 
             , A.JUL_RTO  
             , A.AUG_RTO
             , A.SEP_RTO 
             , A.OCT_RTO
             , A.NOV_RTO
             , A.DEC_RTO
             , (SELECT CASE WHEN JAN_RTO > 0 THEN 1 ELSE 0 END  
                     + CASE WHEN FEB_RTO > 0 THEN 1 ELSE 0 END  
                     + CASE WHEN MAR_RTO > 0 THEN 1 ELSE 0 END  
                     + CASE WHEN APR_RTO > 0 THEN 1 ELSE 0 END  
                     + CASE WHEN MAY_RTO > 0 THEN 1 ELSE 0 END  
                     + CASE WHEN JUN_RTO > 0 THEN 1 ELSE 0 END  
                     + CASE WHEN JUL_RTO > 0 THEN 1 ELSE 0 END  
                     + CASE WHEN AUG_RTO > 0 THEN 1 ELSE 0 END  
                     + CASE WHEN SEP_RTO > 0 THEN 1 ELSE 0 END  
                     + CASE WHEN OCT_RTO > 0 THEN 1 ELSE 0 END  
                     + CASE WHEN NOV_RTO > 0 THEN 1 ELSE 0 END  
                     + CASE WHEN DEC_RTO > 0 THEN 1 ELSE 0 END  
                  FROM SPE_EV_GRP_KPI_PERF 
                 WHERE EG_ID = A.EG_ID 
                   AND SP_KPI_ID = A.SP_KPI_ID 
                   AND EV_YR = A.EV_YR 
                   AND SP_SEQ = A.SP_SEQ) INCNT
          FROM SPE_EV_GRP_KPI_PERF A
             , SPE_EV_GRP_KPI_PERF_TGT B
             , SPE_SP_SVC_CATE_KPI C
         WHERE A.EG_ID = B.EG_ID 
           AND A.SP_KPI_ID = B.SP_KPI_ID
           AND A.SP_KPI_ID = C.SP_KPI_ID
           AND A.EV_YR = B.EV_YR
           AND C.SP_KPI_TP_CD <> 'S'
           AND A.SP_SEQ = @[s_sp_seq]
           AND A.EV_YR = @[s_ev_yr]
           AND A.EG_ID= @[eg_id]
         )			]]></sql>
			<params>
				<param name="s_sp_seq" type="12" value="" out="N"/>
				<param name="s_ev_yr" type="12" value="" out="N"/>
				<param name="eg_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
