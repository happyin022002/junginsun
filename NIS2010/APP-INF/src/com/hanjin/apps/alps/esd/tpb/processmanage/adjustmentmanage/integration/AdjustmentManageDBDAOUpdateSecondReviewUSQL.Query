<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AdjustmentManageDBDAOUpdateSecondReviewUSQL">
			<desc><![CDATA[[각R1~R4를 처리한 후 2nd Review를 위해 COPY]
2-1.<FOR R3>R2:[재차:ADJ_N2ND_RVW_SEQ>1] ROC-IN  RHQ에서    REJECT(Reject As Forward) 매 처리시 처리 내용을 UPDATE
3-1.<FOR R4>R3:[재차:ADJ_N2ND_RVW_SEQ>1] ROC-OUT RHQ에서    ACCEPT(Approval As Forward) 매 처리시 처리 내용을 UPDATE]]></desc>
			<sql><![CDATA[
UPDATE   TPB_ADJ_N2ND_RVW_HIS H
SET      ( STL_RQST_OFC_CD
        ,N3PTY_STL_TP_CD
        ,STL_APRO_OFC_CD
        ,STL_TO_CLT_CNG_OFC_CD
        ,STL_RJCT_OFC_CD
        ,STL_CLT_OFC_CNG_AMT
        ,STL_FWRD_OFC_CD
        ,STL_CPY_OFC_CD
        ,STL_RJCT_DT
        ,STL_RQST_DT
        ,STL_RJCT_USR_ID
        ,STL_RQST_USR_ID
        ,STL_APRO_DT
        ,STL_APRO_USR_ID
        ,STL_FWRD_DT
        ,STL_FWRD_USR_ID
        ,STL_CPY_DT
        ,STL_CPY_USR_ID
        ,STL_RQST_RMK
        ,STL_APRO_RMK
        ,STL_RJCT_RMK
        ,STL_STS_LST_FLG
        ,UPD_DT
       ) = 
       (
          SELECT STL_RQST_OFC_CD
                ,N3PTY_STL_TP_CD
                ,STL_APRO_OFC_CD
                ,STL_TO_CLT_CNG_OFC_CD
                ,STL_RJCT_OFC_CD
                ,STL_CLT_OFC_CNG_AMT
                ,STL_FWRD_OFC_CD
                ,STL_CPY_OFC_CD
                ,STL_RJCT_DT
                ,STL_RQST_DT
                ,STL_RJCT_USR_ID
                ,STL_RQST_USR_ID
                ,STL_APRO_DT
                ,STL_APRO_USR_ID
                ,STL_FWRD_DT
                ,STL_FWRD_USR_ID
                ,STL_CPY_DT
                ,STL_CPY_USR_ID
                ,STL_RQST_RMK
                ,STL_APRO_RMK
                ,STL_RJCT_RMK
                ,STL_STS_LST_FLG
                ,UPD_DT
            FROM TPB_ADJ_STS
           WHERE N3PTY_NO =  H.N3PTY_NO
             AND ADJ_STS_SEQ = H.ADJ_STS_SEQ
             AND STL_STS_LST_FLG = 'Y'
             AND ROWNUM = 1
       )
 WHERE N3PTY_NO = @[n3pty_no]
   AND ADJ_STS_SEQ = @[adj_sts_seq]
   AND ADJ_N2ND_RVW_STS_CD = (
                                SELECT   CASE WHEN STL_FWRD_OFC_CD = TPB_GET_HNDL_OFC_FNC('R',STL_TO_CLT_CNG_OFC_CD) THEN 'R3'
                                              WHEN STL_FWRD_OFC_CD IN ( SELECT ATTR_CTNT1 AS OFC_CD FROM TPB_HRD_CDG_CTNT WHERE HRD_CDG_ID = 'HO_OFC_CD' ) THEN 'R4'
                                         END
                                FROM     TPB_ADJ_STS
                                WHERE    1 = 1
                                AND      N3PTY_NO = H.N3PTY_NO
                                AND      ADJ_STS_SEQ = H.ADJ_STS_SEQ
                             )
   AND STL_STS_LST_FLG = 'Y'
   AND ROWNUM = 1			]]></sql>
			<params>
				<param name="n3pty_no" type="12" value="1" out="N"/>
				<param name="adj_sts_seq" type="12" value="1" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
