<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceCreationDetailDBDAOsaveMultiWorkOrderNoUSQL">
			<desc><![CDATA[Multi Invoice SO 테이블 업데이트]]></desc>
			<sql><![CDATA[
update trs_trsp_svc_ord b
       set b.inv_no = @[inv_no]
       ,b.inv_vndr_seq = @[inv_vndr_seq]
       ,b.inv_curr_cd = @[inv_curr_cd]
       ,b.trsp_inv_calc_lgc_tp_cd = @[trsp_inv_calc_lgc_tp_cd]
       ,b.inv_xch_rt = to_number(@[inv_xch_rt])
       ,b.trsp_inv_act_sts_cd = @[trsp_inv_act_sts_cd]
       ,b.inv_bzc_amt = case when @[inv_curr_cd] in ('KRW','JPY','TWD') then round(((nvl(b.bzc_amt,0) + nvl(b.nego_amt,0) + nvl(b.fuel_scg_amt,0)+ nvl(b.scg_vat_amt,0) + nvl(b.ovr_wgt_scg_amt,0) + nvl(b.etc_add_amt,0) + nvl(b.toll_fee_amt,0)) * @[inv_xch_rt]),0)
                        else round(((nvl(b.bzc_amt,0) + nvl(b.nego_amt,0) + nvl(b.fuel_scg_amt,0) + nvl(b.scg_vat_amt,0) + nvl(b.ovr_wgt_scg_amt,0) + nvl(b.etc_add_amt,0) + nvl(b.toll_fee_amt,0)) * @[inv_xch_rt]),2)
                        end
 	   ,b.locl_upd_dt = GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC((select ofc_cd from mdm_vendor where vndr_seq = @[wo_vndr_seq]))
where (b.trsp_wo_ofc_cty_cd,b.trsp_wo_seq) in (select trsp_wo_ofc_cty_cd,trsp_wo_seq
                                                 from trs_trsp_wrk_ord a
                                                where a.trsp_wo_ofc_cty_cd = @[trsp_wo_ofc_cty_cd]
                                                  and a.trsp_wo_seq = @[trsp_wo_seq]
                                                  and a.wo_vndr_seq = @[wo_vndr_seq]
                                                  and NVL(a.delt_flg, 'N') = 'N'
                                                  AND NVL(a.inter_use_flg, 'N') != 'Y')
  and b.eq_no is not null
  and NVL(b.delt_flg, 'N') = 'N'			]]></sql>
			<params>
				<param name="inv_no" type="12" value="" out="N"/>
				<param name="inv_vndr_seq" type="2" value="" out="N"/>
				<param name="inv_curr_cd" type="12" value="" out="N"/>
				<param name="trsp_inv_calc_lgc_tp_cd" type="12" value="" out="N"/>
				<param name="inv_xch_rt" type="12" value="" out="N"/>
				<param name="trsp_inv_act_sts_cd" type="12" value="" out="N"/>
				<param name="wo_vndr_seq" type="2" value="" out="N"/>
				<param name="trsp_wo_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="trsp_wo_seq" type="2" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
