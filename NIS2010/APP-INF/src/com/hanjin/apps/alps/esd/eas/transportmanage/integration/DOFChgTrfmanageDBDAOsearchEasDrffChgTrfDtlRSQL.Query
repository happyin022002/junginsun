<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DOFChgTrfmanageDBDAOsearchEasDrffChgTrfDtlRSQL">
			<desc><![CDATA[Drop-off Charge조회]]></desc>
			<sql><![CDATA[
SELECT
D.DRFF_CHG_TRF_SEQ
,D.DRFF_CHG_TRF_VER_NO
,D.DRFF_CHG_TRF_DTL_SEQ
,D.SCC_CD
,D.PORT_INLND_CD
,D.CONTI_CD
,D.POD_CNT_CD
,D.POD_CNT_LIST_CTNT 
,D.CURR_CD
,CASE
WHEN D.CURR_LIST_CTNT IS NOT NULL
THEN D.CURR_LIST_CTNT
ELSE 'EUR|USD'||DECODE((SELECT MAX(M.CURR_CD) CURR_CD FROM MDM_COUNTRY M WHERE M.CNT_CD LIKE SUBSTR(D.SCC_CD,1,2)||'%' AND M.CURR_CD NOT IN ('EUR','USD')),NULL,'','','','|')||(
        SELECT MAX(M.CURR_CD) CURR_CD FROM MDM_COUNTRY M WHERE M.CNT_CD LIKE SUBSTR(D.SCC_CD,1,2)||'%' AND M.CURR_CD NOT IN ('EUR','USD')) 
END CURR_LIST_CTNT
,D.EXP_FLG
,DECODE(MAX(X.D2), 0, 'E', MAX(X.D2)) D2
,DECODE(MAX(X.D4), 0, 'E', MAX(X.D4)) D4
,DECODE(MAX(X.D5), 0, 'E', MAX(X.D5)) D5
,DECODE(MAX(X.R2), 0, 'E', MAX(X.R2)) R2
,DECODE(MAX(X.R5), 0, 'E', MAX(X.R5)) R5
,DECODE(MAX(X.R9), 0, 'E', MAX(X.R9)) R9
FROM EAS_DRFF_CHG_TRF_HDR H, EAS_DRFF_CHG_TRF_DTL D
, ( SELECT 
    D.DRFF_CHG_TRF_SEQ
    ,D.DRFF_CHG_TRF_VER_NO
    ,D.DRFF_CHG_TRF_DTL_SEQ
    ,DECODE(T.CNTR_TPSZ_CD, 'D2', CHRR_FRT_TAX_VAL, 0) D2
    ,DECODE(T.CNTR_TPSZ_CD, 'D4', CHRR_FRT_TAX_VAL, 0) D4
    ,DECODE(T.CNTR_TPSZ_CD, 'D5', CHRR_FRT_TAX_VAL, 0) D5
    ,DECODE(T.CNTR_TPSZ_CD, 'R2', CHRR_FRT_TAX_VAL, 0) R2
    ,DECODE(T.CNTR_TPSZ_CD, 'R5', CHRR_FRT_TAX_VAL, 0) R5
    ,DECODE(T.CNTR_TPSZ_CD, 'R9', CHRR_FRT_TAX_VAL, 0) R9
    FROM EAS_DRFF_CHG_TRF_HDR H, EAS_DRFF_CHG_TRF_DTL D, EAS_DRFF_CHG_TRF_TP_SZ T
    WHERE 1=1
    AND H.DRFF_CHG_TRF_SEQ = D.DRFF_CHG_TRF_SEQ
    AND H.DRFF_CHG_TRF_VER_NO = D.DRFF_CHG_TRF_VER_NO
    AND NVL(H.DELT_FLG,'N') <> 'Y'
    AND H.DRFF_CHG_TRF_SEQ = @[drff_chg_trf_seq]
    AND H.DRFF_CHG_TRF_VER_NO = @[drff_chg_trf_ver_no]
    AND D.DRFF_CHG_TRF_SEQ = T.DRFF_CHG_TRF_SEQ
    AND D.DRFF_CHG_TRF_VER_NO = T.DRFF_CHG_TRF_VER_NO
    AND D.DRFF_CHG_TRF_DTL_SEQ = T.DRFF_CHG_TRF_DTL_SEQ
) X
WHERE 1=1
AND H.DRFF_CHG_TRF_SEQ = D.DRFF_CHG_TRF_SEQ
AND H.DRFF_CHG_TRF_VER_NO = D.DRFF_CHG_TRF_VER_NO
AND NVL(H.DELT_FLG,'N') <> 'Y'
AND H.DRFF_CHG_TRF_SEQ = @[drff_chg_trf_seq]
AND H.DRFF_CHG_TRF_VER_NO = @[drff_chg_trf_ver_no]
AND D.DRFF_CHG_TRF_SEQ = X.DRFF_CHG_TRF_SEQ(+)
AND D.DRFF_CHG_TRF_VER_NO = X.DRFF_CHG_TRF_VER_NO(+)
AND D.DRFF_CHG_TRF_DTL_SEQ = X.DRFF_CHG_TRF_DTL_SEQ(+)
GROUP BY    D.DRFF_CHG_TRF_SEQ, D.DRFF_CHG_TRF_VER_NO, D.DRFF_CHG_TRF_DTL_SEQ, 
            D.SCC_CD, D.PORT_INLND_CD, D.CONTI_CD, D.POD_CNT_CD, D.POD_CNT_LIST_CTNT, D.CURR_CD, D.CURR_LIST_CTNT, D.EXP_FLG
ORDER BY D.DRFF_CHG_TRF_DTL_SEQ, D.SCC_CD, D.PORT_INLND_CD, D.CONTI_CD, D.POD_CNT_CD, D.CURR_CD, D.EXP_FLG DESC			]]></sql>
			<params>
				<param name="drff_chg_trf_seq" type="12" value="" out="N"/>
				<param name="drff_chg_trf_ver_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
