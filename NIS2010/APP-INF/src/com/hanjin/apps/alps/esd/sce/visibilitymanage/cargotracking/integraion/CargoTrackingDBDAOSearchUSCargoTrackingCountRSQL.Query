<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CargoTrackingDBDAOSearchUSCargoTrackingCountRSQL">
			<desc><![CDATA[for count rows]]></desc>
			<sql><![CDATA[
SELECT COUNT(t1.eq_no) tot_cnt  
  FROM   (SELECT  tcntr.eq_no  
 	       FROM ( SELECT srtr.eq_no eq_no  
 		        ,NVL(max(sem.cop_expt_no),'NOEXPT') cop_expt_no  
 	       from sce_rail_tz_rpt      srtr 
 		       ,bkg_customer        bbc  
 		       ,bkg_booking         bb  
 		       ,sce_cop_hdr         sch  
 		       ,sce_cop_dtl         scd  
 		       ,sce_cop_dtl         scd2  
 		       ,sce_cop_dtl         scd3  
 		       ,BKG_CGO_RLSE  euicr 
 		       ,sce_rail_splc       srs 
 		       ,mdm_location        ml 
 		       ,mdm_activity        ma 
 		       ,sce_expt_mst sem  
 		WHERE sch.bkg_no                 = bbc.bkg_no 
 		AND   sch.cop_sts_cd             IN ('C','T') 
 		AND   sch.cntr_no                <> 'SMCU0000000' 
 		AND   (ml.loc_cd                 = SUBSTR(bb.del_cd,1,5) AND   ml.conti_cd  = 'M' ) 
 		AND   scd.cop_no                 = sch.cop_no 
 		AND   scd.act_sts_cd             = 'C' 
 		AND   scd2.cop_no(+)             = scd.cop_no 
 		AND   scd2.act_sts_cd(+)         = 'F' 
 		AND   scd3.cop_no(+)             = scd.cop_no 
 		AND   scd3.act_cd(+)             = 'FUVMUD' 
 		AND   scd2.act_cd                = ma.act_cd(+) 
 		AND   SUBSTR(scd2.nod_cd,1,5)    = ml.loc_cd(+) 
 		AND   bbc.bkg_no                 = bb.bkg_no 
 		AND   bbc.cust_cnt_cd            is not null 
 		AND   bbc.cust_seq               is not null 
 		AND   bbc.bkg_no                 = srtr.bkg_no(+) 
 		AND   srtr.arr_splc_cd           = srs.splc_cd(+) 
 		AND   bb.bl_no                   = euicr.bl_no(+) 
 		AND   sch.cop_no                 = sem.cop_no(+)  
 		AND   sem.cop_expt_sts_cd(+)     <> 'X'   
 		AND   srtr.eq_no  IS NOT NULL 

#if (${cust_value1} != '' && ${cust_value2} != '')
 AND   bbc.cust_cnt_cd                   = @[cust_value1] 

 AND   bbc.cust_seq                      = @[cust_value2] 

 AND   bbc.bkg_cust_tp_cd                IN ('S', 'C', 'N') 
#end


#if (${cust_value1} != '' && ${cust_value2} == '')

 AND   bbc.cust_cnt_cd                   = @[cust_value1] 

 AND   bbc.cust_seq                      = '' 

 AND   bbc.bkg_cust_tp_cd                IN ('S', 'C', 'N') 

#end


#if (${sc_no} != '')
 AND   srtr.sc_no                        = @[sc_no]
#end 


   #if (${date_kind} != '' && ${date_kind} == 'S' && ${fm_dt} != '' && ${to_dt} != '')
       AND     srtr.SO_CRE_DT    BETWEEN  TO_DATE(@[fm_dt], 'YYYY-MM-DD HH24:MI:SS')  AND  TO_DATE(@[to_dt], 'YYYY-MM-DD HH24:MI:SS')
   #end

   #if(${date_kind} != '' && ${date_kind} == 'A' && ${fm_dt} != '' && ${to_dt} != '')
       AND     srtr.DEST_AVAL_DT BETWEEN  TO_DATE(@[fm_dt], 'YYYY-MM-DD HH24:MI:SS')  AND  TO_DATE(@[to_dt], 'YYYY-MM-DD HH24:MI:SS') 

  #end
  
  #if(${date_kind} != '' && ${date_kind} == 'O'&& ${fm_dt} != '' && ${to_dt} != '')
       AND         (CASE WHEN srtr.TO_NOD_CD IN ('CAVANM2', 'USLGBPT', 'USORFM2', 'USPDXM1', 'USSAVM1', 'USTIWM1') 
                         THEN srtr.DEST_AVAL_DT 
                         ELSE srtr.DEST_GATE_OUT_DT 
                    END)        BETWEEN  TO_DATE(@[fm_dt], 'YYYY-MM-DD HH24:MI:SS')  AND  TO_DATE(@[to_dt], 'YYYY-MM-DD HH24:MI:SS') 
  #end


#if (${por_cd} != '')     
 AND    bb.por_cd                         = @[por_cd]
#end  

#if (${pol_cd} != '')  
 AND    bb.pol_cd                         = @[pol_cd]  
#end

#if (${pod_cd} != '')
 AND    bb.pod_cd                         = @[pod_cd]
#end
  
#if (${del_cd} != '')
 AND    bb.del_cd                         = @[del_cd] 
#end 

 		GROUP BY srtr.eq_no  
 	    ) tcntr    
 	    ,sce_expt_mst sem  
 	 where tcntr.cop_expt_no = sem.cop_expt_no(+)  
 	 ) t1			]]></sql>
			<params>
				<param name="cust_value1" type="12" value="" out="N"/>
				<param name="cust_value2" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
				<param name="fm_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="por_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
