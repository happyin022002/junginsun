<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SDAnalysisResultDetailDBDAOSearchSDAnalysisDtlRSQL">
			<desc><![CDATA[SD Analysis Result Detail 조회 쿼리]]></desc>
			<sql><![CDATA[
SELECT B.EG_ID 
     , B.EG_NM
     , (SELECT VNDR_LGL_ENG_NM FROM MDM_VENDOR WHERE VNDR_SEQ = A.SP_SEQ) AS SP_NAME     
     , C.SP_KPI_TP_CD
     , (SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL WHERE INTG_CD_ID ='CD03370' AND INTG_CD_VAL_CTNT = C.SP_KPI_TP_CD ) AS SP_KPI_TP_NM
     , C.SP_KPI_ID
     , C.SP_KPI_NM   
     , CASE  WHEN C.SP_KPI_TP_CD != 'P' THEN D.KPI_TGT_RTO 
                  ELSE (SELECT ROUND(SUM(KPI_TGT_RTO)/COUNT(1),2) FROM SPE_EV_GRP_TML_PROD_TGT WHERE EG_ID = A.EG_ID AND SP_SEQ = A.SP_SEQ)
       END AS KPI_TGT_RTO     
     , D.KPI_WGT_RTO
     , B.EG_RHQ_CD
     , B.EG_OFC_CD
     , B.EV_SVC_CATE_CD
     , A.SP_SEQ     
     , A.EV_YR
     , A.RSLT_SCRE_RTO
     , (SELECT ROUND(SUM(MON_SCORE)/COUNT(1),2) FROM(
        WITH PERF AS(SELECT EG_ID, SP_SEQ, EV_YR, SP_KPI_ID 
                          , JAN_RTO  
                          , FEB_RTO  
                          , MAR_RTO
                          , APR_RTO 
                          , MAY_RTO
                          , JUN_RTO 
                          , JUL_RTO  
                          , AUG_RTO
                          , SEP_RTO 
                          , OCT_RTO
                          , NOV_RTO
                          , DEC_RTO 
                       FROM SPE_EV_GRP_KPI_PERF                                   
                       )
                       SELECT EG_ID, SP_SEQ, EV_YR, SP_KPI_ID 
                            , CASE WHEN NUM =1 THEN JAN_RTO
                                   WHEN NUM =2 THEN FEB_RTO
                                   WHEN NUM =3 THEN MAR_RTO
                                   WHEN NUM =4 THEN APR_RTO
                                   WHEN NUM =5 THEN MAY_RTO
                                   WHEN NUM =6 THEN JUN_RTO                
                                   WHEN NUM =7 THEN JUL_RTO
                                   WHEN NUM =8 THEN AUG_RTO
                                   WHEN NUM =9 THEN SEP_RTO
                                   WHEN NUM =10 THEN OCT_RTO
                                   WHEN NUM =11 THEN NOV_RTO
                                   WHEN NUM =12 THEN DEC_RTO                 
                               END MON_SCORE
                         FROM PERF
                            , (SELECT LEVEL NUM FROM DUAL
                               CONNECT BY LEVEL <= 12 
                              )
                           )
                         WHERE EG_ID = A.EG_ID
                           AND SP_KPI_ID = A.SP_KPI_ID
                           AND EV_YR = A.EV_YR
                           AND SP_sEQ = A.SP_SEQ
                           AND MON_SCORE <> 0
       ) AS PFMC
  FROM SPE_EV_GRP_KPI_PERF A
     , SPE_EV_GRP B
     , SPE_SP_SVC_CATE_KPI C
     , SPE_EV_GRP_KPI_PERF_TGT D
 WHERE A.EG_ID = B.EG_ID
   AND A.SP_KPI_ID = C.SP_KPI_ID
   AND A.EG_ID = D.EG_ID
   AND A.SP_KPI_ID = D.SP_KPI_ID
   AND A.EV_YR = D.EV_YR
   AND A.SP_SEQ = @[sp_seq]
   AND A.EV_YR = @[ev_yr]
   AND B.EG_ID = @[eg_id]			]]></sql>
			<params>
				<param name="sp_seq" type="12" value="" out="N"/>
				<param name="ev_yr" type="12" value="" out="N"/>
				<param name="eg_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
