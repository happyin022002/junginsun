<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccrualBatchExecuteResultDBDAOSearchYearlyCostBudgetRSQL">
			<desc><![CDATA[SearchYearlyCostBudget]]></desc>
			<sql><![CDATA[
SELECT A.BSE_YR,          
       C.RHQ_CD,
       A.CTRL_OFC_CD,
       B.COST_SRC_SYS_CD,     
       A.COA_COST_SRC_CD,
       B.LGS_COST_FULL_NM, 
       A.ACCT_CD,         
       A.TTL_USD_AMT,     
       A.MON_BUD_USD_AMT, 
       A.MNL_FLG         
 FROM LEA_YRY_COST_BUD A,
      LEA_LGS_COST B,
      (SELECT     *
FROM  (SELECT 
             -- DECODE(L.OFC_CD, 'SELTOB', 'SHAAS', 'SELCOE','SHAAS', L.OFC_N3RD_LVL_CD ) as RHQ_CD
             --, DECODE(L.OFC_CD, 'SELTOB', 'SELBB', 'SELCOE','SELBB', L.OFC_N5TH_LVL_CD ) as CONTROL_OFC
               DECODE(L.OFC_CD, 'SELTBB', 'SHARC', 'SELOPE','SHARC', L.OFC_N3RD_LVL_CD ) as RHQ_CD
             , DECODE(L.OFC_CD, 'SELTBB', 'SELSC', 'SELOPE','SELSC', L.OFC_N5TH_LVL_CD ) as CONTROL_OFC
             , L.OFC_CD AS SUB_OFC_CD
             , ROW_NUMBER() OVER (PARTITION BY L.OFC_CD ORDER BY L.OFC_APLY_TO_YRMON DESC) OFC_ORDER
        FROM  COA_OFC_LVL L
       WHERE  L.OFC_N3RD_LVL_CD IS NOT NULL
         AND  L.OFC_N5TH_LVL_CD IS NOT NULL
      ) X
WHERE X.OFC_ORDER    = 1
			) C
WHERE 1=1
  AND A.BSE_YR = @[bse_yr]
  AND A.COA_COST_SRC_CD =  B.COA_COST_SRC_CD
  AND A.CTRL_OFC_CD = C.SUB_OFC_CD
#if (${rhq_cd} !='')
  AND C.RHQ_CD = @[rhq_cd]
#end
ORDER BY C.RHQ_CD,
         A.CTRL_OFC_CD,     
         A.COA_COST_SRC_CD			]]></sql>
			<params>
				<param name="bse_yr" type="12" value="" out="N"/>
				<param name="rhq_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
