<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AgreementHisDBDAOSearchDtlAgmtRSQL">
			<desc><![CDATA[Pair type Agreement 의 detail을 Inquiry]]></desc>
			<sql><![CDATA[
SELECT *
  FROM (
    SELECT ROWNUM NUM, X.*
      FROM (
        SELECT   /*+ INDEX(C XAK1TRS_AGMT_NOD) */
                 E.VNDR_SEQ
               ,(SELECT MDM.VNDR_LGL_ENG_NM
                  FROM MDM_VENDOR MDM
                 WHERE MDM.VNDR_SEQ = E.VNDR_SEQ) VNDR_NM
               ,A.TRSP_AGMT_OFC_CTY_CD 
               ,A.TRSP_AGMT_SEQ 
               ,A.TRSP_AGMT_OFC_CTY_CD||A.TRSP_AGMT_SEQ AGMT_NO
               ,B.TRSP_COST_MOD_CD 
               ,B.CGO_TP_CD 
               ,DECODE(B.CUST_NOMI_TRKR_IND_CD, 'HJS', 'SML', B.CUST_NOMI_TRKR_IND_CD) AS CUST_NOMI_TRKR_IND_CD
               ,DECODE(B.CUST_CNT_CD , 'XX', NULL, B.CUST_CNT_CD ) CUST_CNT_CD 
               ,DECODE(B.CUST_SEQ , '0', NULL, B.CUST_SEQ ) CUST_SEQ
               ,DECODE(B.CUST_CNT_CD||B.CUST_SEQ, 'XX0', NULL, B.CUST_CNT_CD||B.CUST_SEQ) AS CUSTOMER_CD
               ,DECODE(B.CMDT_GRP_CD, 'XXXX', NULL, B.CMDT_GRP_CD) CMDT_GRP_CD 
               ,DECODE(B.RAIL_SVC_TP_CD, '00', NULL, B.RAIL_SVC_TP_CD) RAIL_SVC_TP_CD 
               ,DECODE(C.FM_NOD_CD, '0000000', NULL, C.FM_NOD_CD) FM_NOD_CD 
               ,DECODE(C.VIA_NOD_CD, '0000000', NULL, C.VIA_NOD_CD) VIA_NOD_CD 
               ,DECODE(C.DOR_NOD_CD, '0000000', NULL, C.DOR_NOD_CD) DOR_NOD_CD 
               ,DECODE(C.TO_NOD_CD, '0000000', NULL, C.TO_NOD_CD) TO_NOD_CD
               ,NVL(NVL(FM_Y.YD_NM, FM_S.LSE_CO_YD_NM), FM_L.LOC_NM) FM_NOD_CD_NM
               ,NVL(NVL(VA_Y.YD_NM, VA_S.LSE_CO_YD_NM), VA_L.LOC_NM) VIA_NOD_CD_NM
               ,NVL(DR_Z.ZN_NM, DR_L.LOC_NM) DOR_NOD_CD_NM
               ,NVL(NVL(TO_Y.YD_NM, TO_S.LSE_CO_YD_NM), TO_L.LOC_NM) TO_NOD_CD_NM
               ,D.TRSP_AGMT_EQ_TP_SZ_CD 
               ,DECODE(D.WTR_RCV_TERM_CD, '0', NULL, D.WTR_RCV_TERM_CD) WTR_RCV_TERM_CD --FEEDER TERM (R)
               ,DECODE(D.WTR_DE_TERM_CD, '0', NULL, D.WTR_DE_TERM_CD) WTR_DE_TERM_CD --FEEDER TERM (D)
               ,DECODE(D.TRSP_AGMT_BDL_QTY, '0', NULL, D.TRSP_AGMT_BDL_QTY) TRSP_AGMT_BDL_QTY --CHASSIS
               ,DECODE(D.TO_WGT, '0', NULL, '999999.99', 'MAX', D.TO_WGT) TO_WGT --WEIGHT TIER
               ,DECODE(D.WGT_MEAS_UT_CD, 'XXX', NULL, D.WGT_MEAS_UT_CD) WGT_MEAS_UT_CD --UOM
               ,D.CURR_CD
               ,B.AGMT_TRSP_TP_CD --TRANS MODE TYPE
               ,D.TRSP_ONE_WY_RT
               ,D.TRSP_RND_RT
               ,A.CTRT_OFC_CD
               ,D.TRSP_AGMT_RT_TP_SER_NO
               ,TO_CHAR(D.EFF_FM_DT,'YYYYMMDD') EFF_FM_DT
               ,TO_CHAR(D.EFF_TO_DT,'YYYYMMDD') EFF_TO_DT
               ,D.TRSP_RVS_APLY_FLG
               ,NVL(D.DELT_FLG, 'N') DELT_FLG
               ,TO_CHAR(D.AGMT_APRO_DT,'YYYYMMDD') AGMT_APRO_DT
               ,TO_CHAR(D.UPD_DT,'YYYYMMDD') UPD_DT
               ,TO_CHAR(TO_DATE(TO_CHAR(D.AGMT_APRO_DT,'YYYYMMDD'),'YYYYMMDD') - TO_DATE(TO_CHAR(D.UPD_DT,'YYYYMMDD'),'YYYYMMDD')) DT_GAP
               ,NVL((SELECT MAX(X.USR_NM) FROM COM_USER X WHERE X.USR_ID = D.UPD_USR_ID),D.UPD_USR_ID) UPD_USR_NM
               ,B.CFM_FLG
               ,NVL((SELECT MAX(X.USR_NM) FROM COM_USER X WHERE X.USR_ID = B.CFM_USR_ID),B.CFM_USR_ID) CFM_USR_NM
           FROM TRS_AGMT_HDR A 
               ,TRS_AGMT_RT_TP B 
               ,TRS_AGMT_NOD C 
               ,TRS_AGMT_EQ_RT D
               ,TRS_AGMT_APLY_VNDR E
               ,MDM_YARD      FM_Y
               ,MDM_LSE_CO_YD FM_S
               ,MDM_LOCATION  FM_L
               ,MDM_YARD      VA_Y
               ,MDM_LSE_CO_YD VA_S
               ,MDM_LOCATION  VA_L
               ,MDM_ZONE      DR_Z
               ,MDM_LOCATION  DR_L
               ,MDM_YARD      TO_Y
               ,MDM_LSE_CO_YD TO_S
               ,MDM_LOCATION  TO_L
          WHERE A.TRSP_AGMT_OFC_CTY_CD = B.TRSP_AGMT_OFC_CTY_CD
            AND A.TRSP_AGMT_SEQ = B.TRSP_AGMT_SEQ
            AND B.TRSP_AGMT_OFC_CTY_CD = C.TRSP_AGMT_OFC_CTY_CD
            AND B.TRSP_AGMT_SEQ = C.TRSP_AGMT_SEQ
            AND B.TRSP_AGMT_RT_TP_SER_NO = C.TRSP_AGMT_RT_TP_SER_NO
            AND C.TRSP_AGMT_OFC_CTY_CD = D.TRSP_AGMT_OFC_CTY_CD
            AND C.TRSP_AGMT_SEQ = D.TRSP_AGMT_SEQ
            AND C.TRSP_AGMT_RT_TP_SER_NO = D.TRSP_AGMT_RT_TP_SER_NO
            AND C.TRSP_AGMT_NOD_SEQ = D.TRSP_AGMT_NOD_SEQ
            AND B.TRSP_AGMT_RT_TP_CD = 'P'
            AND E.TRSP_AGMT_OFC_CTY_CD = A.TRSP_AGMT_OFC_CTY_CD
            AND E.TRSP_AGMT_SEQ = A.TRSP_AGMT_SEQ
            AND E.AGMT_VNDR_PRMRY_FLG = 'Y'
            AND C.FM_NOD_CD = FM_Y.YD_CD(+)
            AND C.FM_NOD_CD = FM_S.LSE_CO_YD_CD(+)
            AND SUBSTR(C.FM_NOD_CD,1,5) = FM_L.LOC_CD(+)
            AND C.VIA_NOD_CD = VA_Y.YD_CD(+)
            AND C.VIA_NOD_CD = VA_S.LSE_CO_YD_CD(+)
            AND SUBSTR(C.VIA_NOD_CD,1,5) = VA_L.LOC_CD(+)
            AND C.DOR_NOD_CD = DR_Z.ZN_CD(+)
            AND SUBSTR(C.DOR_NOD_CD,1,5) = DR_L.LOC_CD(+)
            AND C.TO_NOD_CD = TO_Y.YD_CD(+)
            AND C.TO_NOD_CD = TO_S.LSE_CO_YD_CD(+)
            AND SUBSTR(C.TO_NOD_CD,1,5) = TO_L.LOC_CD(+)
        #if (${delete_yn} != '')
            AND NVL(D.DELT_FLG, 'N') = @[delete_yn]
        #end
        #if (${fm_nod} != '' )
            AND C.FM_NOD_CD LIKE @[fm_nod]||'%'
        #end
        #if (${via_nod} != '' )
            AND C.VIA_NOD_CD LIKE @[via_nod]||'%'
        #else
            AND C.VIA_NOD_CD LIKE '%'
        #end
        #if (${to_nod} != '' )
            AND C.TO_NOD_CD LIKE @[to_nod]||'%'
        #else
            AND C.TO_NOD_CD LIKE '%'
        #end
        #if (${dor_nod} != '' )
            AND C.DOR_NOD_CD LIKE @[dor_nod]||'%'
        #else
            AND C.DOR_NOD_CD LIKE '%'
        #end
        
        #if (${costmode} != '') 
              AND B.TRSP_COST_MOD_CD = @[costmode]
        #end
        
        #if (${cargo} != '') 
              AND B.CGO_TP_CD = @[cargo]
        #end
              AND D.EQ_KND_CD = @[eqtype]
        
        #if ($eqtpsz.size() > 0)
              AND D.TRSP_AGMT_EQ_TP_SZ_CD IN (
        	#foreach($key in ${eqtpsz}) 
        
        		#if($velocityCount < $eqtpsz.size()) 
        			'$key', 
        		#else 
        			'$key' 
        		#end 
        
        	#end
        	)
        #end
        
        #if (${fmAgmtTrspTpCd} != '') 
              AND B.AGMT_TRSP_TP_CD = @[fmAgmtTrspTpCd]
        #end
        
        #if (${fmEffectiveAgmt} != 'A' )
              AND (SELECT GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(A.CTRT_OFC_CD) FROM DUAL) BETWEEN D.EFF_FM_DT AND D.EFF_TO_DT
        #end
        
        #if (${fmVndrPrmrySeq} != '') 
              AND (A.TRSP_AGMT_OFC_CTY_CD, A.TRSP_AGMT_SEQ) IN (
                  SELECT TRSP_AGMT_OFC_CTY_CD, TRSP_AGMT_SEQ
                    FROM TRS_AGMT_APLY_VNDR
                   WHERE VNDR_SEQ = @[fmVndrPrmrySeq]
                  )
        #end

		#if (${trspAgmtOfcCtyCd} != '')
			AND A.TRSP_AGMT_OFC_CTY_CD = @[trspAgmtOfcCtyCd]
		#end

		#if (${trspAgmtSeq} != '')
			AND A.TRSP_AGMT_SEQ LIKE @[trspAgmtSeq]||'%'
		#end
        #if (${approval_date} != '')
             AND D.AGMT_APRO_DT >= TO_DATE(REPLACE(@[approval_date],'-',''),'YYYYMMDD')
        #end


    ) X
)
WHERE NUM BETWEEN 1 + ((@[cur_page_cnt]-1)*@[page_size]) AND (@[cur_page_cnt]*@[page_size])			]]></sql>
			<params>
				<param name="delete_yn" type="12" value="" out="N"/>
				<param name="fm_nod" type="12" value="" out="N"/>
				<param name="via_nod" type="12" value="" out="N"/>
				<param name="to_nod" type="12" value="" out="N"/>
				<param name="dor_nod" type="12" value="" out="N"/>
				<param name="costmode" type="12" value="" out="N"/>
				<param name="cargo" type="12" value="" out="N"/>
				<param name="eqtype" type="12" value="" out="N"/>
				<param name="fmAgmtTrspTpCd" type="12" value="" out="N"/>
				<param name="fmVndrPrmrySeq" type="12" value="" out="N"/>
				<param name="trspAgmtOfcCtyCd" type="12" value="" out="N"/>
				<param name="trspAgmtSeq" type="12" value="" out="N"/>
				<param name="approval_date" type="12" value="" out="N"/>
				<param name="cur_page_cnt" type="12" value="" out="N"/>
				<param name="page_size" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
