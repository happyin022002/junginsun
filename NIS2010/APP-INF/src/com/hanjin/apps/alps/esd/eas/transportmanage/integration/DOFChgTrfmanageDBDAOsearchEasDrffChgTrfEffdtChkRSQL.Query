<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DOFChgTrfmanageDBDAOsearchEasDrffChgTrfEffdtChkRSQL">
			<desc><![CDATA[Drop-off Charge조회]]></desc>
			<sql><![CDATA[
SELECT 
    X.PREV_FM_EFF_DT, H.FM_EFF_DT,
    CASE
    WHEN EXISTS (SELECT 'X' 
                 FROM EAS_DRFF_CHG_TRF_HDR H2 
                 WHERE H2.CNT_CD = H.CNT_CD 
                 AND H2.DRFF_CHG_TRF_SEQ = H.DRFF_CHG_TRF_SEQ 
                 AND H2.DRFF_CHG_TRF_VER_NO = H.DRFF_CHG_TRF_VER_NO-1
                 AND NVL(H2.DELT_FLG,'N') <> 'Y')
    THEN CASE
         WHEN H.FM_EFF_DT IS NOT NULL AND X.PREV_FM_EFF_DT IS NOT NULL 
                AND LENGTH(H.FM_EFF_DT)=8  AND LENGTH(X.PREV_FM_EFF_DT)=8 
                AND SIGN(X.PREV_FM_EFF_DT-H.FM_EFF_DT) < 0
         THEN 'Y'
         ELSE 'N'
         END
    ELSE 'Y'
    END FM_EFF_DT_CHK
FROM EAS_DRFF_CHG_TRF_HDR H, 
(
    SELECT (
        SELECT H.FM_EFF_DT
        FROM EAS_DRFF_CHG_TRF_HDR H
#if (${cnt_cd} != '') 
        WHERE H.CNT_CD = @[cnt_cd]
#else 
        WHERE H.RFA_NO = @[rfa_no]
#end
        AND H.DRFF_CHG_TRF_SEQ = @[drff_chg_trf_seq]
        AND H.DRFF_CHG_TRF_VER_NO = TO_NUMBER(@[drff_chg_trf_ver_no])-1
    ) PREV_FM_EFF_DT FROM DUAL
) X
WHERE 1=1
#if (${cnt_cd} != '') 
AND H.CNT_CD = @[cnt_cd]
#else 
AND H.RFA_NO = @[rfa_no]
#end
AND H.DRFF_CHG_TRF_SEQ = @[drff_chg_trf_seq]
AND H.DRFF_CHG_TRF_VER_NO = TO_NUMBER(@[drff_chg_trf_ver_no])
AND NVL(H.DELT_FLG,'N') <> 'Y'			]]></sql>
			<params>
				<param name="cnt_cd" type="12" value="" out="N"/>
				<param name="rfa_no" type="12" value="" out="N"/>
				<param name="drff_chg_trf_seq" type="12" value="" out="N"/>
				<param name="drff_chg_trf_ver_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
