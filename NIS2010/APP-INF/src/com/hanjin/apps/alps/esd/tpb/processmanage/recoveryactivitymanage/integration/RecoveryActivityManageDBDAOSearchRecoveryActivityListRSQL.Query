<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RecoveryActivityManageDBDAOSearchRecoveryActivityListRSQL">
			<desc><![CDATA[Recovery Activity List Search]]></desc>
			<sql><![CDATA[
SELECT 2 sortNo
      ,b.n3pty_no
      ,b.ots_grp_rcvr_act_seq
      ,b.act_rmk
      ,TO_CHAR(TPB_GET_LCL_DATE_FNC(b.locl_cre_dt,@[user_ofc_cd]),'YYYY-MM-DD HH24:MI') locl_cre_dt
      ,b.clt_act_upd_ofc_cd
      ,b.upd_usr_id
      ,b.cntc_pson_nm
      ,DECODE(b.n3pty_clt_rmk_tp_cd,'A',1,0) n3pty_no_y
      ,DECODE(b.n3pty_clt_rmk_tp_cd,'M',1,0) n3pty_no_n
      ,NVL2(b.file_no,'File Attach',DECODE(b.n3pty_clt_rmk_tp_cd,'M','File Attach')) img_file_no
      ,b.file_no
      ,a.n3pty_inv_no
      ,b.n3pty_clt_rmk_tp_cd
      ,NVL2(b.file_no, ( SELECT COUNT(0) cnt FROM TPB_TTL_FILE_MGMT f WHERE f.file_no=b.file_no AND f.delt_flg='N' ), 0) As file_count
  FROM TPB_OTS_GRP a
      ,TPB_OTS_GRP_RCVR_ACT b
 WHERE a.n3pty_no = b.n3pty_no
#if (${s_n3pty_no} != '') 
   AND a.n3pty_no = @[s_n3pty_no]
#else 
   AND 1 = 0
#end
union
SELECT 2 sortNo
,b.n3pty_no
,b.ots_grp_rcvr_act_seq
,TPB_GET_IF_RMK_FNC(b.n3pty_no) act_rmk
,TO_CHAR(TPB_GET_LCL_DATE_FNC(b.locl_cre_dt,@[user_ofc_cd]),'YYYY-MM-DD HH24:MI') locl_cre_dt
,b.clt_act_upd_ofc_cd
,b.upd_usr_id
,b.cntc_pson_nm
,DECODE(b.n3pty_clt_rmk_tp_cd,'A',1,0) n3pty_no_y
,DECODE(b.n3pty_clt_rmk_tp_cd,'M',1,0) n3pty_no_n
,NVL2(b.file_no,'File Attach',DECODE(b.n3pty_clt_rmk_tp_cd,'M','File Attach')) img_file_no
,b.file_no
,a.n3pty_inv_no
,b.n3pty_clt_rmk_tp_cd
,NVL2(b.file_no, ( SELECT COUNT(0) cnt FROM TPB_TTL_FILE_MGMT f WHERE f.file_no=b.file_no AND f.delt_flg='N' ), 0) As file_count
FROM TPB_OTS_GRP a
,TPB_OTS_GRP_RCVR_ACT b
WHERE a.n3pty_no = b.n3pty_no
#if (${s_n3pty_no} != '') 
   AND a.n3pty_no = @[s_n3pty_no]
#else 
   AND 1 = 0
#end
and b.ots_grp_rcvr_act_seq = 1
and TPB_GET_IF_RMK_FNC(b.n3pty_no) is not null
ORDER BY sortNo, n3pty_no, ots_grp_rcvr_act_seq			]]></sql>
			<params>
				<param name="user_ofc_cd" type="12" value="" out="N"/>
				<param name="s_n3pty_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
