<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SPServiceCategoryDBDAOSearchSpSvcCateCfmRSQL">
			<desc><![CDATA[업체의 서비스 카테고리 정보를 조회한다]]></desc>
			<sql><![CDATA[
SELECT LPAD(SP_SEQ,6,0 )AS SP_SEQ
     , SP_NAME
     , SP_GRP_OFC_CD
     , SP_CTRL_OFC_CD 
     , EV_SVC_CATE_CD
     , MAPTYPE
     , (SELECT SUBSTR(MAX(AAA),2, LENGTH(MAX(AAA))) 
           FROM (SELECT SYS_CONNECT_BY_PATH(INTG_CD_VAL_CTNT,',') AAA 
                         , NUM 
                      FROM (SELECT INTG_CD_VAL_CTNT
                                 , ROWNUM NUM 
                              FROM COM_INTG_CD_DTL
                             WHERE INTG_CD_ID ='CD03377'
                            ORDER BY INTG_CD_VAL_DP_SEQ
                            ) 
                   START WITH NUM=1
                   CONNECT BY PRIOR NUM=NUM-1
                )
        )PLUSCOL
	 , SP_CTRT_OFC_CD
     , (SELECT COUNT(1)  FROM SPE_SP_BZC_EV_GRP WHERE SP_SEQ = A.SP_SEQ) AS ISFLAG
FROM (
#if(${s_chk_all} != '')
      SELECT A.SP_SEQ
            ,(SELECT VNDR_LGL_ENG_NM FROM MDM_VENDOR WHERE VNDR_SEQ= A.SP_SEQ AND NVL(DELT_FLG, 'N') <> 'Y') SP_NAME
            , A.SP_GRP_OFC_CD
            , A.SP_CTRL_OFC_CD 
            , B.EV_SVC_CATE_CD 
            , 'MAPPER' AS MAPTYPE
	        , A.SP_CTRT_OFC_CD
         FROM SPE_SP A
            , SPE_SP_SVC_CATE_STUP B
        WHERE A.SP_SEQ = B.SP_SEQ
      #if(${s_sp_seq} != '')
          AND A.SP_SEQ = @[s_sp_seq]
      #end
      #if(${s_eg_rhq_cd} != '')
          AND A.SP_GRP_OFC_CD = @[s_eg_rhq_cd]
      #end
      #if(${s_eg_ofc_cd} != '')
          AND A.SP_CTRL_OFC_CD = @[s_eg_ofc_cd]
      #end

      UNION ALL
        SELECT AA.VNDR_SEQ 
             , AA.VNDR_LGL_ENG_NM
             , TT.TG
             , AA.OFC_CD
             , ''
             , 'UNMAPPER' AS MAPTYPE
	         , ''
         FROM MDM_VENDOR AA
            , (SELECT OFC_CD
                    , SPE_GET_RHQ_OFC_CD_FNC(OFC_CD) TG
                 FROM  MDM_ORGANIZATION    
               ) TT
         WHERE NVL(AA.DELT_FLG, 'N') <> 'Y'
           AND AA.OFC_CD = TT.OFC_CD
           AND TT.TG =@[s_eg_rhq_cd]
           AND NOT EXISTS(SELECT A.SP_SEQ
                            FROM SPE_SP A
                               , SPE_SP_SVC_CATE_STUP B
                           WHERE A.SP_SEQ = B.SP_SEQ
                             AND A.SP_SEQ = AA.VNDR_SEQ
                          )
    
#end

#if(${s_chk_map} != '')
      SELECT A.SP_SEQ
            ,(SELECT VNDR_LGL_ENG_NM FROM MDM_VENDOR WHERE VNDR_SEQ= A.SP_SEQ AND NVL(DELT_FLG, 'N') <> 'Y') SP_NAME
            , A.SP_GRP_OFC_CD
            , A.SP_CTRL_OFC_CD 
            , B.EV_SVC_CATE_CD 
            , 'MAPPER' AS MAPTYPE
            , A.SP_CTRT_OFC_CD
         FROM SPE_SP A
            , SPE_SP_SVC_CATE_STUP B
        WHERE A.SP_SEQ = B.SP_SEQ
      #if(${s_sp_seq} != '')
          AND A.SP_SEQ = @[s_sp_seq]
      #end
      #if(${s_eg_rhq_cd} != '')
          AND A.SP_GRP_OFC_CD = @[s_eg_rhq_cd]
      #end
      #if(${s_eg_ofc_cd} != '')
          AND A.SP_CTRL_OFC_CD = @[s_eg_ofc_cd]
      #end
#end

#if(${s_chk_unmap} != '')
        SELECT AA.VNDR_SEQ AS SP_SEQ 
             , AA.VNDR_LGL_ENG_NM AS SP_NAME
             , TT.TG AS SP_GRP_OFC_CD
             , AA.OFC_CD AS SP_CTRL_OFC_CD 
             , '' AS EV_SVC_CATE_CD
             , 'UNMAPPER' AS MAPTYPE
	         , '' AS SP_CTRT_OFC_CD
         FROM MDM_VENDOR AA
            , (SELECT OFC_CD
                    , SPE_GET_RHQ_OFC_CD_FNC(OFC_CD) TG
                 FROM  MDM_ORGANIZATION    
               ) TT
         WHERE NVL(AA.DELT_FLG, 'N') <> 'Y'
           AND AA.OFC_CD = TT.OFC_CD
           AND TT.TG =@[s_eg_rhq_cd]
           AND NOT EXISTS(SELECT A.SP_SEQ
                            FROM SPE_SP A
                               , SPE_SP_SVC_CATE_STUP B
                           WHERE A.SP_SEQ = B.SP_SEQ
                             AND A.SP_SEQ =AA.VNDR_SEQ
                          )
      
#end
  ) A
WHERE 1=1
#if(${s_sp_seq} != '')
    AND SP_SEQ = @[s_sp_seq]
#end
#if(${s_eg_ofc_cd} != '')
    AND SP_CTRL_OFC_CD = @[s_eg_ofc_cd]
#end
#if(${s_ctrt_ofc_cd} != '')
    AND SP_CTRT_OFC_CD = @[s_ctrt_ofc_cd]
#end
ORDER BY SP_SEQ,EV_SVC_CATE_CD			]]></sql>
			<params>
				<param name="s_sp_seq" type="12" value="" out="N"/>
				<param name="s_eg_rhq_cd" type="12" value="" out="N"/>
				<param name="s_eg_ofc_cd" type="12" value="" out="N"/>
				<param name="s_ctrt_ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
