<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CARIssueTransferSlipManageDBDAOSearchCSRSummaryDetail1RSQL">
			<desc><![CDATA[SearchCSRSummaryDetail1]]></desc>
			<sql><![CDATA[
SELECT	inv_no
		,nvl(ttl_inv_amt,0) ttl_inv_amt
		,nvl(vat_amt,0)  vat_amt
		,nvl(whld_tax_amt,0) whld_tax_amt
		,(nvl(ttl_inv_amt,0)+nvl(vat_amt,0)-nvl(whld_tax_amt,0)) inv_total_amt
		,to_char(iss_dt,'YYYY-MM-DD') iss_dt
		,to_char(rcv_dt,'YYYY-MM-DD') rcv_dt
		,to_char(inv_cfm_dt,'YYYY-MM-DD') inv_cfm_dt
		,tml_so_ofc_cty_cd
		,tml_so_seq
		,vndr_seq
		,edi_flg
        ,   NVL(
			CASE
        	WHEN H.EDI_FLG = 'Y'
        	THEN  (
            	SELECT 
                	CASE
        	        WHEN F.FILE_SEQ IS NOT NULL AND F.ORG_FILE_NM IS NOT NULL AND F.FILE_SAV_ID IS NOT NULL AND C.FILE_SAV_ID IS NOT NULL
            	    THEN 'Y'
                	ELSE 'N'
        	        END FILE_CHK
            	FROM TES_EDI_SO_HDR E, TES_EDI_SO_FILE F, COM_UPLD_FILE C
        	    WHERE 1=1
        	    AND E.TML_SO_OFC_CTY_CD = H.TML_SO_OFC_CTY_CD
        	    AND E.TML_SO_SEQ = H.TML_SO_SEQ
        	    AND NVL(E.DELT_FLG,'N') <> 'Y'
        	    AND ((E.TML_EDI_SO_OFC_CTY_CD = F.TML_EDI_SO_OFC_CTY_CD AND E.TML_EDI_SO_SEQ = F.TML_EDI_SO_SEQ)
					OR
					 (E.TML_SO_OFC_CTY_CD = F.TML_SO_OFC_CTY_CD AND E.TML_SO_SEQ = F.TML_SO_SEQ))
        	    AND NVL(F.DELT_FLG,'N') <> 'Y'
        	    AND F.FILE_SAV_ID = C.FILE_SAV_ID
        	    AND NVL(C.DELT_FLG,'N') <> 'Y'
				AND ROWNUM = 1
            	)
        	ELSE 'N'
        	END,'N') FILE_CHK
FROM tes_tml_so_hdr H
WHERE cost_ofc_cd	= @[cost_ofc_cd]
	AND inv_ofc_cd	= @[inv_ofc_cd]
	AND vndr_seq	= @[vndr_seq]
	AND curr_cd		= @[curr_cd]
	AND tml_inv_sts_cd = 'C'
	AND tml_inv_rjct_sts_cd in ('NL','RL')
#if (${inv_cfm_dt} != '') 
	AND TO_CHAR(inv_cfm_dt,'YYYY-MM-DD') = @[inv_cfm_dt]     
#else 
#end
	AND NVL(DELT_FLG,'N') <> 'Y'
	AND NVL(HLD_FLG,'N') <> 'Y' -- [CHM-201538036]Invoice 'Hold' Status체크되면 CSR Creation진행 안되도록 조치
ORDER BY inv_no			]]></sql>
			<params>
				<param name="cost_ofc_cd" type="12" value="" out="N"/>
				<param name="inv_ofc_cd" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
				<param name="curr_cd" type="12" value="" out="N"/>
				<param name="inv_cfm_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
