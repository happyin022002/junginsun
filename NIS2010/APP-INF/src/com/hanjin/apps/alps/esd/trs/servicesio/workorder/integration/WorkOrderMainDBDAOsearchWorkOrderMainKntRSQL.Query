<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="WorkOrderMainDBDAOsearchWorkOrderMainKntRSQL">
			<desc><![CDATA[search Work Order Main Knt]]></desc>
			<sql><![CDATA[
select 'W' dvsn, count(1) cnt
  from trs_trsp_wrk_ord a
 where a.wo_vndr_seq = @[wo_vndr_seq]
   and CASE WHEN a.wo_opn_flg IS NULL THEN 'N' ELSE a.wo_opn_flg END <> 'Y'
   and CASE WHEN a.delt_flg   IS NULL THEN 'N' ELSE a.delt_flg END <> 'Y'
   and a.wo_iss_sts_cd in ('I','R')
   and CASE WHEN a.inter_use_flg IS NULL THEN 'N' ELSE a.inter_use_flg END <> 'Y'
   -- apnt_dt/de_dt set-up status 제외
   and 'NEW' = ( select decode(count(*), 0, 'NEW', 'OPEN')
                  from trs_trsp_svc_ord
                 where trsp_wo_ofc_cty_cd = a.trsp_wo_ofc_cty_cd
                   and trsp_wo_seq = a.trsp_wo_seq
                   and (apnt_dt is not null or de_dt is not null)
                )  
   AND @[dvsnA] = 'Y'
union all
SELECT 'I' dvsn,count(*) cnt
 FROM trs_trsp_inv_wrk INV
WHERE INV.inv_vndr_seq = @[inv_vndr_seq]
	AND INV.trsp_inv_aud_sts_cd IN ('RC')
	AND NVL(INV.delt_flg, 'E') <> 'Y'
	AND @[dvsnA] = 'Y'
union all
SELECT 'R' dvsn, count(*) cnt
FROM trs_trsp_rail_bil_ord a
  	,trs_trsp_rail_bil_vndr_set b
 	,trs_trsp_edi_rail_ord c
WHERE a.prov_vndr_seq = @[prov_vndr_seq]
  	AND NVL(a.delt_flg, 'N') = 'N'
 	AND a.locl_cre_dt BETWEEN TO_DATE(TO_CHAR(SYSDATE - 7, 'yyyymmdd') || '000000', 'yyyymmddhh24miss')
 	AND TO_DATE(TO_CHAR(SYSDATE, 'yyyymmdd') || '235959', 'yyyymmddhh24miss')
 	AND b.trsp_so_ofc_cty_cd = a.trsp_so_ofc_cty_cd
 	AND b.trsp_so_seq = a.trsp_so_seq
 	AND c.trsp_so_ofc_cty_cd = b.trsp_so_ofc_cty_cd
 	AND c.trsp_so_seq = b.trsp_so_seq
 	AND trim(c.vndr_seq) = b.vndr_seq
 	AND c.bil_iss_sts_cd = 'I'
 	AND trim(c.bil_edi_rcv_rslt_cd) = 'A'
  	AND NVL(c.delt_flg, 'N') = 'N'
  	AND c.bil_edi_rcv_rslt_dt BETWEEN TO_DATE(TO_CHAR(SYSDATE - 7, 'yyyymmdd') || '000000', 'yyyymmddhh24miss')
  	AND TO_DATE(TO_CHAR(SYSDATE, 'yyyymmdd') || '235959', 'yyyymmddhh24miss')
  	AND @[dvsnB] = 'Y'			]]></sql>
			<params>
				<param name="wo_vndr_seq" type="2" value="" out="N"/>
				<param name="dvsnA" type="12" value="" out="N"/>
				<param name="inv_vndr_seq" type="2" value="" out="N"/>
				<param name="prov_vndr_seq" type="2" value="" out="N"/>
				<param name="dvsnB" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
