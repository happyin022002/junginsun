<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ProductCatalogCreateDBDAOCreateBkgSplitMapBaseCSQL">
			<desc><![CDATA[Booking Split 또는 MEMO 생성시 prd_bkg_cop_map을 1세트 생성시킨다.]]></desc>
			<sql><![CDATA[
INSERT INTO PRD_BKG_COP_MAP
(
       PCTL_NO
     , BKG_NO
     , COP_NO
     , COP_MAPG_SEQ
     , CRNT_FLG
     , CNTR_NO
     , CNTR_TPSZ_CD
     , COP_OP_TP_CD
     , BKG_OP_RMK
--     , OB_ITCHG_CTNT
--     , IB_ITCHG_CTNT
--     , OCN_ITCHG_CTNT
--     , MTY_PKUP_YD_CD
--     , MTY_RTN_YD_CD
--     , POR_NOD_CD
--     , POL_NOD_CD
--     , BKG_RCV_TERM_CD
--     , BKG_DE_TERM_CD
     , OB_TRO_FLG
     , IB_TRO_FLG
--     , COP_PATT_ORD_NO
     , COP_SO_KNT
     , CRE_USR_ID
     , CRE_DT
     , UPD_USR_ID
     , UPD_DT
)
SELECT PCTL_NO
     , BKG_NO
     , COP_NO
     , @[mapg_seq] COP_MAPG_SEQ -- 모두 새로운 SEQ
     , 'Y' CRNT_FLG
     , CNTR_NO
     , CNTR_TPSZ_CD
     , 'X' COP_OP_TP_CD  -- 모두 일단 X
     , 'SPLIT' BKG_OP_RMK
--     , OB_ITCHG_CTNT
--     , IB_ITCHG_CTNT
--     , OCN_ITCHG_CTNT
--     , MTY_PKUP_YD_CD
--     , MTY_RTN_YD_CD
--     , POR_NOD_CD
--     , POL_NOD_CD
--     , BKG_RCV_TERM_CD
--     , BKG_DE_TERM_CD
     , OB_TRO_FLG
     , IB_TRO_FLG
--     , COP_PATT_ORD_NO
     , (SELECT COUNT(*)
        FROM TRS_TRSP_SVC_ORD
        WHERE COP_NO = S.COP_NO 
          AND TRSP_SO_TP_CD <> 'S' 
          AND NVL(DELT_FLG,'N') <> 'Y'
          AND NVL(RPLN_UMCH_FLG,'N') <> 'Y' -- 2010.04.09 추가 by j
          AND NVL(TRSP_FRST_FLG,'N') <> 'Y' ) +
        (SELECT COUNT(*)
         FROM TRS_TRSP_RAIL_BIL_ORD A 
         WHERE A.COP_NO = S.COP_NO
          AND NVL(A.TRSP_FRST_FLG,'N') <> 'Y'
          AND NVL(A.DELT_FLG,'N') <> 'Y'
          ) COP_SO_KNT
     , 'SYSTEM' CRE_USR_ID
     , SYSDATE CRE_DT
     , 'SYSTEM' UPD_USR_ID
     , SYSDATE UPD_DT
FROM SCE_COP_HDR S
WHERE BKG_NO = @[parent_bkg_no]
AND NVL(COP_STS_CD, 'N') <> 'X'			]]></sql>
			<params>
				<param name="mapg_seq" type="12" value="" out="N"/>
				<param name="parent_bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
