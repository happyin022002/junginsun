<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DODInvoiceMgtDBDAOSearchARInterfaceInvoiceMainRSQL">
			<desc><![CDATA[SearchARInterfaceInvoiceMain]]></desc>
			<sql><![CDATA[
SELECT  A.BL_NO
      , A.BL_NO AS  BL_SRC_NO
      , A.DOD_INV_NO AS INV_SRC_NO
      , A.BKG_NO
      , A.CUST_CNT_CD AS  CUST_CNT_CD
      , A.CUST_SEQ AS CUST_SEQ
      , (SELECT AR_OFC_CD FROM MDM_ORGANIZATION WHERE OFC_CD = A.CRE_OFC_CD)  AS OFC_CD
      , 'EAS' AS IF_SRC_CD
      , BK.VSL_CD 
      , BK.SKD_VOY_NO
      , BK.SKD_DIR_CD
      , BK.SVC_SCP_CD
      , '' AS SAIL_DT
      , '' AS SAIL_ARR_DT 
      , '' AS DUE_DT
      , '' AS GL_EFF_DT
      , BK.SLAN_CD
	  , BK.POL_CD
	  , A.POD_CD
      , BK.POR_CD
      , A.DEL_CD
      , BK.T_VSL_CD AS TRNK_VSL_CD
      , BK.T_SKD_VOY_NO  AS TRNK_SKD_VOY_NO
      , BK.T_SKD_DIR_CD  AS TRNK_SKD_DIR_CD
      , (SELECT SUM(DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),'2',1,0)) FROM EAS_DOD_INV_DTL WHERE DOD_INV_NO = A.DOD_INV_NO) AS BKG_TEU_QTY
      , (SELECT SUM(DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),'2',0,1)) FROM EAS_DOD_INV_DTL WHERE DOD_INV_NO = A.DOD_INV_NO) AS BKG_FEU_QTY
      , 'I' AS IO_BND_CD
      , A.CRE_OFC_CD AS SLS_OFC_CD
      , A.CRE_USR_ID
      , A.CRE_OFC_CD
	  , TO_CHAR(A.CRE_DT,'YYYYMMDD') AS CRE_DT
      , @[cre_usr_id] AS UPD_USR_ID
      , @[ofc_cd] AS UPD_OFC_CD
	  , TO_CHAR(A.UPD_DT,'YYYYMMDD') AS UPD_DT
      , '' INV_REF_NO
	  , '' AS INV_RMK
	  , '' AS DEST_TRNS_SVC_MOD_CD
      , A.AR_IF_FLG, A.DOD_INV_STS_CD 
FROM EAS_DOD_INV_MN A, 
     (SELECT B.BKG_NO, BV.VSL_CD , BV.SKD_VOY_NO ,BV.SKD_DIR_CD,  
             B.VSL_CD  AS T_VSL_CD, B.SKD_VOY_NO AS T_SKD_VOY_NO ,B.SKD_DIR_CD  AS T_SKD_DIR_CD,
             B.SLAN_CD, B.IB_SLS_OFC_CD, B. SVC_SCP_CD, 
	         B.POL_CD,  B.POR_CD
      FROM   BKG_VVD  BV
            ,VSK_VSL_PORT_SKD ACT
            ,BKG_BOOKING B
      WHERE B.BKG_NO = BV.BKG_NO
      AND B.BKG_NO = @[bkg_no]
      AND BV.VSL_CD = ACT.VSL_CD 
      AND BV.SKD_VOY_NO = ACT.SKD_VOY_NO 
      AND BV.SKD_DIR_CD = ACT.SKD_DIR_CD 
      AND BV.POL_CD = ACT.VPS_PORT_CD 
      AND BV.POL_CLPT_IND_SEQ = ACT.CLPT_IND_SEQ 
      AND VPS_ETD_DT = (SELECT MAX(VPS_ETD_DT)
                        FROM  BKG_VVD          BV
                             ,VSK_VSL_PORT_SKD ACT
                        WHERE  BV.VSL_CD = ACT.VSL_CD 
                        AND BV.SKD_VOY_NO = ACT.SKD_VOY_NO 
                        AND BV.SKD_DIR_CD = ACT.SKD_DIR_CD 
                        AND BV.POL_CD = ACT.VPS_PORT_CD 
                        AND BV.POL_CLPT_IND_SEQ = ACT.CLPT_IND_SEQ 
                        AND BV.BKG_NO =  @[bkg_no]) ) BK
WHERE A.DOD_INV_NO = @[dod_inv_no]
AND A.BKG_NO = BK.BKG_NO			]]></sql>
			<params>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="dod_inv_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
