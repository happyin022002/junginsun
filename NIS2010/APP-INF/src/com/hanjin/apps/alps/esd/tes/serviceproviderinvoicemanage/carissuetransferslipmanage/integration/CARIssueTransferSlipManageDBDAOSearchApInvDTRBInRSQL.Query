<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CARIssueTransferSlipManageDBDAOSearchApInvDTRBInRSQL">
			<desc><![CDATA[SearchApInvDTRBIn]]></desc>
			<sql><![CDATA[
SELECT LINE_SEQ, ROWNUM LINE_NO, LINE_TP_LU_CD, CSR_AMT,
			INV_DESC, INV_TAX_CD, DTRB_COA_CO_CD, DTRB_COA_RGN_CD, DTRB_COA_CTR_CD, DTRB_COA_ACCT_CD,
			DTRB_COA_VVD_CD, DTRB_COA_INTER_CO_CD, DTRB_COA_FTU_N1ST_CD, DTRB_COA_FTU_N2ND_CD,
			ATTR_CATE_NM, ATTR_CTNT1, ATTR_CTNT2, ATTR_CTNT3, ATTR_CTNT4, ATTR_CTNT5,
			ATTR_CTNT6, ATTR_CTNT7, ATTR_CTNT8, ATTR_CTNT9, ATTR_CTNT10, ATTR_CTNT11,
			ATTR_CTNT12, ATTR_CTNT13, ATTR_CTNT14, ATTR_CTNT15, BKG_NO,
			CNTR_TPSZ_CD, ACT_VVD_CD, PLN_SCTR_DIV_CD, SO_CRR_CD, YD_CD, FTU_USE_CTNT1,
			FTU_USE_CTNT2, FTU_USE_CTNT3, FTU_USE_CTNT4, FTU_USE_CNTR5, CRE_DT, CRE_USR_ID, EAI_EVNT_DT
	 FROM (
	 SELECT LINE_SEQ, LINE_NO, LINE_TP_LU_CD, ROUND((CSR_AMT/RATE)*FTU_USE_CTNT2) CSR_AMT,
			INV_DESC, INV_TAX_CD, DTRB_COA_CO_CD, DTRB_COA_RGN_CD, DTRB_COA_CTR_CD, DTRB_COA_ACCT_CD,
			DTRB_COA_VVD_CD, DTRB_COA_INTER_CO_CD, DTRB_COA_FTU_N1ST_CD, DTRB_COA_FTU_N2ND_CD,
			ATTR_CATE_NM, ATTR_CTNT1, ATTR_CTNT2, ATTR_CTNT3, ATTR_CTNT4, ATTR_CTNT5,
			ATTR_CTNT6, ATTR_CTNT7, ATTR_CTNT8, ATTR_CTNT9, ATTR_CTNT10, ATTR_CTNT11,
			ATTR_CTNT12, ATTR_CTNT13, ATTR_CTNT14, ATTR_CTNT15, BKG_NO, 
			CNTR_TPSZ_CD, ACT_VVD_CD, PLN_SCTR_DIV_CD, SO_CRR_CD, YD_CD, FTU_USE_CTNT1,
			FTU_USE_CTNT2, FTU_USE_CTNT3, FTU_USE_CTNT4, FTU_USE_CNTR5, CRE_DT, CRE_USR_ID, EAI_EVNT_DT
	 FROM (
			SELECT @[line_seq]                                            LINE_SEQ,
				   ''                                                     LINE_NO,
				   'ITEM'                                                 LINE_TP_LU_CD,
				   CSR_AMT,
				   INV_DESC,
				   ''                                           		   INV_TAX_CD,
				   '01'                                                   DTRB_COA_CO_CD,
				   DTRB_COA_RGN_CD,
				   DTRB_COA_CTR_CD,
				   DTRB_COA_ACCT_CD,
				   DTRB_COA_VVD_CD,
				   DTRB_COA_INTER_CO_CD,
				   '000000'                                                DTRB_COA_FTU_N1ST_CD,
				   '000000'                                                DTRB_COA_FTU_N2ND_CD,
				   ATTR_CATE_NM,
				   ATTR_CTNT1,
				   ATTR_CTNT2,
				   ATTR_CTNT3,
				   NULL                                                    ATTR_CTNT4,
				   NULL                                                    ATTR_CTNT5,
				   NULL                                                    ATTR_CTNT6,
				   NULL                                                    ATTR_CTNT7,
				   NULL                                                    ATTR_CTNT8,
				   NULL                                                    ATTR_CTNT9,
				   NULL                                                    ATTR_CTNT10,
				   NULL                                                    ATTR_CTNT11,
				   NULL                                                    ATTR_CTNT12,
				   NULL                                                    ATTR_CTNT13,
				   NULL                                                    ATTR_CTNT14,
				   'A'                                                     ATTR_CTNT15,
				   BKG_NO,
				   M.CNTR_TPSZ_CD,    --수정(20070723)
				   ACT_VVD_CD,
				   PLN_SCTR_DIV_CD,
				   SO_CRR_CD,
				   YD_CD,
				   FTU_USE_CTNT1,
				   NVL(FTU_USE_CTNT2,1)                                    FTU_USE_CTNT2,
				   FTU_USE_CTNT3,
				   NULL                                                    FTU_USE_CTNT4,
				   NULL                                                    FTU_USE_CNTR5,
				   GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[ofc_cd])            CRE_DT,
				   @[cre_usr_id]                                  				   CRE_USR_ID,
				   NVL(RATE,1)                                             RATE,
				   CURR,
				   '' EAI_EVNT_DT
			FROM
			( SELECT DISTINCT
				   ( SELECT ACCT_ENG_NM
					 FROM   MDM_ACCOUNT
					 WHERE  ACCT_CD = D.ACCT_CD )                          INV_DESC,
				   ( SELECT FINC_RGN_CD
					 FROM   MDM_ORGANIZATION
					 WHERE  OFC_CD = H.COST_OFC_CD )                        DTRB_COA_RGN_CD,
				   ( SELECT AP_CTR_CD
					 FROM   MDM_ORGANIZATION
					 WHERE  OFC_CD = H.COST_OFC_CD )                        DTRB_COA_CTR_CD,
				   D.ACCT_CD                                               DTRB_COA_ACCT_CD,
				   NVL(L.FINC_VSL_CD||L.FINC_SKD_VOY_NO||L.FINC_SKD_DIR_CD,
					   '0000000000')                                       DTRB_COA_VVD_CD,
				   ( SELECT NVL(SUBS_CO_CD,'00')
					 FROM   MDM_VENDOR
					 WHERE  VNDR_SEQ = H.VNDR_SEQ )                        DTRB_COA_INTER_CO_CD,
				   D.ACCT_CD                                               ATTR_CATE_NM,
				   H.INV_NO                                                ATTR_CTNT1,
				   TO_CHAR(H.ISS_DT,'YYYY/MM/DD HH24:MI:SS')               ATTR_CTNT2,
				   SUBSTR(H.YD_CD,1,5)                                     ATTR_CTNT3,
				   L.BKG_NO                                                BKG_NO,
				   L.CNTR_TPSZ_CD                                          CNTR_TPSZ_CD,
				   DECODE(H.TML_INV_TP_CD,'TM',
					 NVL(L.VSL_CD||L.SKD_VOY_NO||L.SKD_DIR_CD,L.FINC_VSL_CD||L.FINC_SKD_VOY_NO||L.FINC_SKD_DIR_CD),
					 L.FINC_VSL_CD||L.FINC_SKD_VOY_NO||L.FINC_SKD_DIR_CD) ACT_VVD_CD,
				   DECODE(SUBSTR(D.LGS_COST_CD,1,2),'ET','T',
					 DECODE((SELECT YD_OSHP_CD FROM MDM_YARD WHERE YD_CD = H.YD_CD),'O',
					 DECODE(NVL(TRIM(D.TML_CRR_CD),'SML'),'SML','C','T'),'C')) PLN_SCTR_DIV_CD,
				   TRIM(D.TML_CRR_CD)                            			SO_CRR_CD,
				   H.YD_CD                                                 YD_CD,
				   D.LGS_COST_CD                                           FTU_USE_CTNT1,
				   COUNT(L.CNTR_NO)                                        FTU_USE_CTNT2,
				   D.VOL_TR_UT_CD                                          FTU_USE_CTNT3,
				   H.CURR_CD                                               CURR
			FROM   TES_TML_SO_HDR H, TES_TML_SO_DTL D, TES_TML_SO_CNTR_LIST L
			WHERE  H.INV_NO              = @[inv_no]
			AND    H.VNDR_SEQ            = @[vndr_seq]
			AND    H.TML_INV_STS_CD      = 'C'
			AND    NVL(H.DELT_FLG,'N')   <> 'Y'
			AND    H.TML_SO_OFC_CTY_CD   = D.TML_SO_OFC_CTY_CD
			AND    H.TML_SO_SEQ          = D.TML_SO_SEQ
--		        AND    D.CALC_COST_GRP_CD    <> 'SP'
			AND    D.CALC_COST_GRP_CD    NOT IN ('SD','SP')   --수정(20080111)
			AND    D.CALC_TP_CD          = 'A'
			AND    NVL(D.INV_AMT,0)      <> 0
			AND    H.TML_SO_OFC_CTY_CD   = L.TML_SO_OFC_CTY_CD
			AND    H.TML_SO_SEQ          = L.TML_SO_SEQ
			AND    L.VRFY_RSLT_IND_CD       = 'CO'
			 AND    DECODE(H.TML_INV_TP_CD,
						  'TM',DECODE(SUBSTR(D.LGS_COST_CD,1,2),'TP',NVL(L.RVIS_IND_FLG,'N'),'TM',NVL(L.TML_RVIS_IND_FLG,'N'),'SR',NVL(L.STO_RVIS_IND_FLG,'N'),'SV',NVL(L.STV_RVIS_IND_FLG,'N'),'CG',NVL(L.CGO_RVIS_IND_FLG,'N')),
						  'ON',DECODE(SUBSTR(D.LGS_COST_CD,1,2),'TP',NVL(L.RVIS_IND_FLG,'N'),'TM',NVL(L.TML_RVIS_IND_FLG,'N'),'SR',NVL(L.STO_RVIS_IND_FLG,'N'),'SV',NVL(L.STV_RVIS_IND_FLG,'N'),'CG',NVL(L.CGO_RVIS_IND_FLG,'N')),
						  'OF',NVL(L.TML_RVIS_IND_FLG,'N'),
						  'ST','N') <> 'Y'
			AND    NVL(L.CNTR_TPSZ_CD,'N')     = NVL(D.CNTR_TPSZ_CD,'N')
--		        AND    DECODE('TM',NVL(L.IO_BND_CD,'N'),'ON',NVL(L.IO_BND_CD,'N'),'OF','N','ST','N')
--		               = DECODE('TM',NVL(D.IO_BND_CD,'N'),'ON',NVL(D.IO_BND_CD,'N'),'OF','N','ST','N')
--		        AND    DECODE('TM',NVL(L.IOC_CD,'N'),'ON',NVL(L.IOC_CD,'N'),'OF','N','ST','N')
--		               = DECODE('TM',NVL(D.IOC_CD,'N'),'ON',NVL(D.IOC_CD,'N'),'OF','N','ST','N')
--		        AND    DECODE('TM',NVL(L.LANE_CD,'N'),'ON',NVL(L.LANE_CD,'N'),'OF','N','ST','N')
--		               = DECODE('TM',NVL(D.LANE_CD,'N'),'ON',NVL(D.LANE_CD,'N'),'OF','N','ST','N')
--		        AND    DECODE(H.TML_INV_TP_CD,'TM',
----		                 DECODE(L.BB_CGO_FLG,'Y','BB',DECODE(L.LOCL_TS_IND_CD,'T','TS',DECODE(L.CNTR_STY_CD,'F','FL','MT'))),
--		                 DECODE(L.BB_CGO_FLG,'Y','BB',DECODE(L.LOCL_TS_IND_CD,'T',DECODE(L.CNTR_STY_CD,'F','TS','TM'),DECODE(L.CNTR_STY_CD,'F','FL','MT'))),
--		                 'ON',DECODE(CNTR_STY_CD,'F','F','M'),'OF',DECODE(L.CNTR_STY_CD,'F','FL','MT'),'ST',DECODE(L.LOCL_TS_IND_CD,'T','TS',DECODE(L.CNTR_STY_CD,'F','FL','MT')))
--		               = DECODE(H.TML_INV_TP_CD,'TM',SUBSTR(D.LGS_COST_CD,5,2),'ON',SUBSTR('TMNDRF',6,1),'OF',SUBSTR(D.LGS_COST_CD,5,2),
--		                 'ST',SUBSTR(D.LGS_COST_CD,5,2))
	--수정(20070920) -- B
			AND    DECODE(H.TML_INV_TP_CD,'TM',NVL(L.IO_BND_CD,'N'),'ON',NVL(L.IO_BND_CD,'N'),'OF','N','ST','N')
				   = DECODE(H.TML_INV_TP_CD,'TM',NVL(D.IO_BND_CD,'N'),'ON',NVL(D.IO_BND_CD,'N'),'OF','N','ST','N')
			AND    DECODE(H.TML_INV_TP_CD,'TM',NVL(L.IOC_CD,'N'),'ON',NVL(L.IOC_CD,'N'),'OF','N','ST','N')
				   = DECODE(H.TML_INV_TP_CD,'TM',NVL(D.IOC_CD,'N'),'ON',NVL(D.IOC_CD,'N'),'OF','N','ST','N')
			AND    DECODE(H.TML_INV_TP_CD,'TM',NVL(L.LANE_CD,'N'),'ON',NVL(L.LANE_CD,'N'),'OF','N','ST','N')
				   = DECODE(H.TML_INV_TP_CD,'TM',NVL(D.LANE_CD,'N'),'ON',NVL(D.LANE_CD,'N'),'OF','N','ST','N')
			AND    DECODE(H.TML_INV_TP_CD,'TM',
					 DECODE(L.BB_CGO_FLG,'Y','BB',DECODE(L.LOCL_TS_IND_CD,'T',DECODE(L.CNTR_STY_CD,'F','TS','TM'),DECODE(L.CNTR_STY_CD,'F','FL','MT'))),
					 'ON',DECODE(L.CNTR_STY_CD,'F','F','M'),'OF',DECODE(L.CNTR_STY_CD,'F','FL','MT'),'ST',DECODE(L.LOCL_TS_IND_CD,'T','TS',DECODE(L.CNTR_STY_CD,'F','FL','MT')))
				   = DECODE(H.TML_INV_TP_CD,'TM',SUBSTR(D.LGS_COST_CD,5,2),'ON',SUBSTR(D.LGS_COST_CD,6,1),'OF',SUBSTR(D.LGS_COST_CD,5,2),
					 'ST',SUBSTR(D.LGS_COST_CD,5,2))
			AND    DECODE(H.TML_INV_TP_CD,'TM',NVL(L.DCGO_CLSS_CD,'N'),'ON',NVL(L.DCGO_CLSS_CD,'N'),'OF',NVL(L.DCGO_CLSS_CD,'N'),'ST',NVL(L.DCGO_CLSS_CD,'N'))
				   = DECODE(H.TML_INV_TP_CD,'TM',NVL(D.DCGO_IND_CD,'N'),'ON',NVL(D.DCGO_IND_CD,'N'),'OF',NVL(D.DCGO_IND_CD,'N'),'ST',NVL(D.DCGO_IND_CD,'N'))
			AND    DECODE(H.TML_INV_TP_CD,'TM',DECODE(D.TML_TRNS_MOD_CD,'','S','S','S',NVL(L.TML_TRNS_MOD_CD,'S')),'N')
				   = DECODE(H.TML_INV_TP_CD,'TM',NVL(D.TML_TRNS_MOD_CD,'S'),'N')
			AND    DECODE(H.TML_INV_TP_CD,'TM',DECODE(SUBSTR(D.LGS_COST_CD,5,2),'TS','F','N'),'N')
				   = DECODE(H.TML_INV_TP_CD,'TM',DECODE(SUBSTR(D.LGS_COST_CD,5,2),'TS',L.CNTR_STY_CD,'N'),'N')
	--수정(20070920) -- E
			GROUP BY D.ACCT_CD,H.COST_OFC_CD,NVL(L.FINC_VSL_CD||L.FINC_SKD_VOY_NO||L.FINC_SKD_DIR_CD,'0000000000'),
					 H.VNDR_SEQ,H.INV_NO,TO_CHAR(H.ISS_DT,'YYYY/MM/DD HH24:MI:SS'),H.YD_CD,
					 L.BKG_NO, L.CNTR_TPSZ_CD,
					 DECODE(H.TML_INV_TP_CD,'TM',
					 NVL(L.VSL_CD||L.SKD_VOY_NO||L.SKD_DIR_CD,L.FINC_VSL_CD||L.FINC_SKD_VOY_NO||L.FINC_SKD_DIR_CD),
					 L.FINC_VSL_CD||L.FINC_SKD_VOY_NO||L.FINC_SKD_DIR_CD), D.LGS_COST_CD,
					 D.TML_CRR_CD,D.VOL_TR_UT_CD,H.CURR_CD ) M,
		   ( SELECT D.LGS_COST_CD, D.CNTR_TPSZ_CD, SUM(NVL(D.INV_AMT,0)) CSR_AMT, D.TML_CRR_CD    --수정(20070723)
			 FROM   TES_TML_SO_HDR H, TES_TML_SO_DTL D
			 WHERE  H.INV_NO              = @[inv_no]
			 AND    H.VNDR_SEQ            = @[vndr_seq]
			 AND    H.TML_INV_STS_CD      = 'C'
			 AND    NVL(H.DELT_FLG,'N')   <> 'Y'                  --추가(20070523)
			 AND    H.TML_SO_OFC_CTY_CD   = D.TML_SO_OFC_CTY_CD
			 AND    H.TML_SO_SEQ          = D.TML_SO_SEQ
--		         AND    D.CALC_COST_GRP_CD    <> 'SP'
			 AND    D.CALC_COST_GRP_CD    NOT IN ('SD','SP')      --수정(20080111)
			 AND    D.CALC_TP_CD          = 'A'
			 AND    NVL(D.INV_AMT,0)      <> 0                    --추가(20070523)
			 GROUP BY D.LGS_COST_CD, D.CNTR_TPSZ_CD, D.TML_CRR_CD ) A,                           --수정(20070723)
		   ( SELECT D.LGS_COST_CD, D.CNTR_TPSZ_CD, COUNT(L.CNTR_NO) RATE, D.TML_CRR_CD           --수정(20070723)
			 FROM   TES_TML_SO_HDR H, TES_TML_SO_DTL D, TES_TML_SO_CNTR_LIST L
			 WHERE  H.INV_NO              = @[inv_no]
			 AND    H.VNDR_SEQ            = @[vndr_seq]
			 AND    H.TML_INV_STS_CD      = 'C'
			 AND    NVL(H.DELT_FLG,'N')   <> 'Y'                 --추가(20070523)
			 AND    H.TML_SO_OFC_CTY_CD   = D.TML_SO_OFC_CTY_CD
			 AND    H.TML_SO_SEQ          = D.TML_SO_SEQ
--		         AND    D.CALC_COST_GRP_CD    <> 'SP'
			 AND    D.CALC_COST_GRP_CD    NOT IN ('SD','SP')    --수정(20080111)
			 AND    D.CALC_TP_CD          = 'A'
			 AND    NVL(D.INV_AMT,0)      <> 0                   --추가(20070523)
			 AND    H.TML_SO_OFC_CTY_CD   = L.TML_SO_OFC_CTY_CD
			 AND    H.TML_SO_SEQ          = L.TML_SO_SEQ
			 AND    L.VRFY_RSLT_IND_CD       = 'CO'
			  AND    DECODE(H.TML_INV_TP_CD,
						   'TM',DECODE(SUBSTR(D.LGS_COST_CD,1,2),'TP',NVL(L.RVIS_IND_FLG,'N'),'TM',NVL(L.TML_RVIS_IND_FLG,'N'),'SR',NVL(L.STO_RVIS_IND_FLG,'N'),'SV',NVL(L.STV_RVIS_IND_FLG,'N'),'CG',NVL(L.CGO_RVIS_IND_FLG,'N')),
						   'ON',DECODE(SUBSTR(D.LGS_COST_CD,1,2),'TP',NVL(L.RVIS_IND_FLG,'N'),'TM',NVL(L.TML_RVIS_IND_FLG,'N'),'SR',NVL(L.STO_RVIS_IND_FLG,'N'),'SV',NVL(L.STV_RVIS_IND_FLG,'N'),'CG',NVL(L.CGO_RVIS_IND_FLG,'N')),
						   'OF',NVL(L.TML_RVIS_IND_FLG,'N'),
						   'ST','N') <> 'Y'
			 AND    NVL(L.CNTR_TPSZ_CD,'N')     = NVL(D.CNTR_TPSZ_CD,'N')
--		         AND    DECODE('TM',NVL(L.IO_BND_CD,'N'),'ON',NVL(L.IO_BND_CD,'N'),'OF','N','ST','N')
--		                = DECODE('TM',NVL(D.IO_BND_CD,'N'),'ON',NVL(D.IO_BND_CD,'N'),'OF','N','ST','N')
--		         AND    DECODE('TM',NVL(L.IOC_CD,'N'),'ON',NVL(L.IOC_CD,'N'),'OF','N','ST','N')
--		                = DECODE('TM',NVL(D.IOC_CD,'N'),'ON',NVL(D.IOC_CD,'N'),'OF','N','ST','N')
--		         AND    DECODE('TM',NVL(L.LANE_CD,'N'),'ON',NVL(L.LANE_CD,'N'),'OF','N','ST','N')
--		                = DECODE('TM',NVL(D.LANE_CD,'N'),'ON',NVL(D.LANE_CD,'N'),'OF','N','ST','N')
--		         AND    DECODE(H.TML_INV_TP_CD,'TM',
----		                  DECODE(L.BB_CGO_FLG,'Y','BB',DECODE(L.LOCL_TS_IND_CD,'T','TS',DECODE(L.CNTR_STY_CD,'F','FL','MT'))),
--		                  DECODE(L.BB_CGO_FLG,'Y','BB',DECODE(L.LOCL_TS_IND_CD,'T',DECODE(L.CNTR_STY_CD,'F','TS','TM'),DECODE(L.CNTR_STY_CD,'F','FL','MT'))),
--		                  'ON',DECODE(CNTR_STY_CD,'F','F','M'),'OF',DECODE(L.CNTR_STY_CD,'F','FL','MT'),'ST',DECODE(L.LOCL_TS_IND_CD,'T','TS',DECODE(L.CNTR_STY_CD,'F','FL','MT')))
--		                = DECODE(H.TML_INV_TP_CD,'TM',SUBSTR(D.LGS_COST_CD,5,2),'ON',SUBSTR('TMNDRF',6,1),'OF',SUBSTR(D.LGS_COST_CD,5,2),
--		                  'ST',SUBSTR(D.LGS_COST_CD,5,2))
	--수정(20070920) -- B
			 AND    DECODE(H.TML_INV_TP_CD,'TM',NVL(L.IO_BND_CD,'N'),'ON',NVL(L.IO_BND_CD,'N'),'OF','N','ST','N')
					= DECODE(H.TML_INV_TP_CD,'TM',NVL(D.IO_BND_CD,'N'),'ON',NVL(D.IO_BND_CD,'N'),'OF','N','ST','N')
			 AND    DECODE(H.TML_INV_TP_CD,'TM',NVL(L.IOC_CD,'N'),'ON',NVL(L.IOC_CD,'N'),'OF','N','ST','N')
					= DECODE(H.TML_INV_TP_CD,'TM',NVL(D.IOC_CD,'N'),'ON',NVL(D.IOC_CD,'N'),'OF','N','ST','N')
			 AND    DECODE(H.TML_INV_TP_CD,'TM',NVL(L.LANE_CD,'N'),'ON',NVL(L.LANE_CD,'N'),'OF','N','ST','N')
					= DECODE(H.TML_INV_TP_CD,'TM',NVL(D.LANE_CD,'N'),'ON',NVL(D.LANE_CD,'N'),'OF','N','ST','N')
			 AND    DECODE(H.TML_INV_TP_CD,'TM',
					  DECODE(L.BB_CGO_FLG,'Y','BB',DECODE(L.LOCL_TS_IND_CD,'T',DECODE(L.CNTR_STY_CD,'F','TS','TM'),DECODE(L.CNTR_STY_CD,'F','FL','MT'))),
					  'ON',DECODE(L.CNTR_STY_CD,'F','F','M'),'OF',DECODE(L.CNTR_STY_CD,'F','FL','MT'),'ST',DECODE(L.LOCL_TS_IND_CD,'T','TS',DECODE(L.CNTR_STY_CD,'F','FL','MT')))
					= DECODE(H.TML_INV_TP_CD,'TM',SUBSTR(D.LGS_COST_CD,5,2),'ON',SUBSTR(D.LGS_COST_CD,6,1),'OF',SUBSTR(D.LGS_COST_CD,5,2),
					  'ST',SUBSTR(D.LGS_COST_CD,5,2))
			 AND    DECODE(H.TML_INV_TP_CD,'TM',NVL(L.DCGO_CLSS_CD,'N'),'ON',NVL(L.DCGO_CLSS_CD,'N'),'OF',NVL(L.DCGO_CLSS_CD,'N'),'ST',NVL(L.DCGO_CLSS_CD,'N'))
					= DECODE(H.TML_INV_TP_CD,'TM',NVL(D.DCGO_IND_CD,'N'),'ON',NVL(D.DCGO_IND_CD,'N'),'OF',NVL(D.DCGO_IND_CD,'N'),'ST',NVL(D.DCGO_IND_CD,'N'))
			 AND    DECODE(H.TML_INV_TP_CD,'TM',DECODE(D.TML_TRNS_MOD_CD,'','S','S','S',NVL(L.TML_TRNS_MOD_CD,'S')),'N')
					= DECODE(H.TML_INV_TP_CD,'TM',NVL(D.TML_TRNS_MOD_CD,'S'),'N')
			 AND    DECODE(H.TML_INV_TP_CD,'TM',DECODE(SUBSTR(D.LGS_COST_CD,5,2),'TS','F','N'),'N')
					= DECODE(H.TML_INV_TP_CD,'TM',DECODE(SUBSTR(D.LGS_COST_CD,5,2),'TS',L.CNTR_STY_CD,'N'),'N')
	--수정(20070920) -- E
			 GROUP BY D.LGS_COST_CD, D.CNTR_TPSZ_CD, D.TML_CRR_CD ) R                 --수정(20070723)
			 WHERE M.FTU_USE_CTNT1 = A.LGS_COST_CD
			 AND   M.CNTR_TPSZ_CD  = A.CNTR_TPSZ_CD                     --수정(20070723)
             AND   NVL(M.SO_CRR_CD,'N')  = NVL(A.TML_CRR_CD,'N')
			 AND   M.FTU_USE_CTNT1 = R.LGS_COST_CD
			 AND   M.CNTR_TPSZ_CD  = R.CNTR_TPSZ_CD
             AND   NVL(M.SO_CRR_CD,'N')  = NVL(R.TML_CRR_CD,'N') )                   --수정(20070723)
	 UNION ALL
	 SELECT --DISTINCT
			@[line_seq]                                                       LINE_SEQ,
			''                                                      LINE_NO,
			'ITEM'                                                  LINE_TP_LU_CD,
			NVL(ROUND(SUM(D.INV_AMT)),0)                            CSR_AMT,
			( SELECT ACCT_ENG_NM
			  FROM   MDM_ACCOUNT
			  WHERE  ACCT_CD = D.ACCT_CD )                          INV_DESC,
			''                                                       INV_TAX_CD,
			'01'                                                    DTRB_COA_CO_CD,
			( SELECT FINC_RGN_CD
			  FROM   MDM_ORGANIZATION
			  WHERE  OFC_CD = H.COST_OFC_CD )                        DTRB_COA_RGN_CD,
			( SELECT AP_CTR_CD
			  FROM   MDM_ORGANIZATION
			  WHERE  OFC_CD = H.COST_OFC_CD )                        DTRB_COA_CTR_CD,
			D.ACCT_CD                                               DTRB_COA_ACCT_CD,
			DECODE(D.ACCT_CD,'954111','0000000000',NVL(D.FINC_VSL_CD||D.FINC_SKD_VOY_NO||D.FINC_SKD_DIR_CD,'0000000000'))  DTRB_COA_VVD_CD,
			( SELECT NVL(SUBS_CO_CD,'00')
			  FROM   MDM_VENDOR
			  WHERE  VNDR_SEQ = H.VNDR_SEQ )                        DTRB_COA_INTER_CO_CD,
			'000000'                                                DTRB_COA_FTU_N1ST_CD,
			'000000'                                                DTRB_COA_FTU_N2ND_CD,
			D.ACCT_CD                                               ATTR_CATE_NM,
			H.INV_NO                                                ATTR_CTNT1,
			TO_CHAR(H.ISS_DT,'YYYY/MM/DD HH24:MI:SS')               ATTR_CTNT2,
			SUBSTR(H.YD_CD,1,5)                                     ATTR_CTNT3,
			NULL                                                    ATTR_CTNT4,
			NULL                                                    ATTR_CTNT5,
			NULL                                                    ATTR_CTNT6,
			NULL                                                    ATTR_CTNT7,
			NULL                                                    ATTR_CTNT8,
			NULL                                                    ATTR_CTNT9,
			NULL                                                    ATTR_CTNT10,
			NULL                                                    ATTR_CTNT11,
			NULL                                                    ATTR_CTNT12,
			NULL                                                    ATTR_CTNT13,
			NULL                                                    ATTR_CTNT14,
--		        'M'                                                     ATTR_CTNT15,
			D.CALC_TP_CD                                            ATTR_CTNT15,    --(20080111)
			NULL                                                    BKG_NO,
			NULL                                                    CNTR_TPSZ_CD,
			DECODE(H.TML_INV_TP_CD,'TM',
			  NVL(D.VSL_CD||D.SKD_VOY_NO||D.SKD_DIR_CD,D.FINC_VSL_CD||D.FINC_SKD_VOY_NO||D.FINC_SKD_DIR_CD),
			  D.FINC_VSL_CD||D.FINC_SKD_VOY_NO||D.FINC_SKD_DIR_CD)  ACT_VVD_CD,
			DECODE(SUBSTR(D.LGS_COST_CD,1,2),'ET','T',
			  DECODE((SELECT YD_OSHP_CD FROM MDM_YARD WHERE YD_CD = H.YD_CD),'O',
			  DECODE(NVL(TRIM(D.TML_CRR_CD),'SML'),'SML','C','T'),'C')) PLN_SCTR_DIV_CD,
			TRIM(D.TML_CRR_CD) 			                         SO_CRR_CD,
			H.YD_CD                                                 YD_CD,
			D.LGS_COST_CD                                           FTU_USE_CTNT1,
			D.RVIS_VOL_QTY                                     	  FTU_USE_CTNT2,
			D.VOL_TR_UT_CD                                          FTU_USE_CTNT3,
			NULL                                                    FTU_USE_CTNT4,
			NULL                                                    FTU_USE_CNTR5,
			GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[ofc_cd])         	CRE_DT,
			@[cre_usr_id]                                  					CRE_USR_ID,
			''                                 					 EAI_EVNT_DT
	 FROM   TES_TML_SO_HDR H, TES_TML_SO_DTL D
	 WHERE  H.INV_NO              = @[inv_no]
	 AND    H.VNDR_SEQ            = @[vndr_seq]
	 AND    H.TML_INV_STS_CD      = 'C'
	 AND    NVL(H.DELT_FLG,'N')   <> 'Y'
	 AND    H.TML_SO_OFC_CTY_CD   = D.TML_SO_OFC_CTY_CD(+)
	 AND    H.TML_SO_SEQ          = D.TML_SO_SEQ(+)
--		 AND    ( D.CALC_COST_GRP_CD    = 'SP'
	 AND    ( D.CALC_COST_GRP_CD    IN ('SD','SP')     --수정(20080111)
	 OR       D.CALC_TP_CD          = 'M' )
	 AND    NVL(D.INV_AMT,0)      <> 0        --추가(20070523)
	 GROUP BY D.TML_SO_DTL_SEQ, '', 'ITEM', D.ACCT_CD, '', '01', H.COST_OFC_CD,
			H.TML_INV_TP_CD, D.FINC_VSL_CD||D.FINC_SKD_VOY_NO||D.FINC_SKD_DIR_CD, H.VNDR_SEQ, H.INV_NO, H.ISS_DT,
			SUBSTR(H.YD_CD,1,5), NVL(D.VSL_CD||D.SKD_VOY_NO||D.SKD_DIR_CD,D.FINC_VSL_CD||D.FINC_SKD_VOY_NO||D.FINC_SKD_DIR_CD),
			DECODE(SUBSTR(D.LGS_COST_CD,1,2),'TP','C','SV','C','T'), D.TML_CRR_CD, H.YD_CD, D.LGS_COST_CD, D.RVIS_VOL_QTY, D.VOL_TR_UT_CD,
--		        GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(), 
			GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[ofc_cd]), @[cre_usr_id], D.CALC_TP_CD  --추가(20080111)
	 )			]]></sql>
			<params>
				<param name="line_seq" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="inv_no" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
