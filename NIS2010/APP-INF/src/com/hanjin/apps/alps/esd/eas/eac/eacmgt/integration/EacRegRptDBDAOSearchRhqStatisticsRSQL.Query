<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EacRegRptDBDAOSearchRhqStatisticsRSQL">
			<desc><![CDATA[RHQ별 월별 비용심사 실적 조회]]></desc>
			<sql><![CDATA[
WITH RPT AS (
    SELECT RHQ_OFC_CD
          ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'VU' THEN 1 ELSE 0 END)) AS M_BIL_UMCH_CNT
          ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'VU' THEN INV_AUD_USD_AMT ELSE 0 END)) AS M_BIL_UMCH_AMT
          ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'RD' THEN 1 ELSE 0 END)) AS M_RT_DIS_UMCH_CNT
          ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'RD' THEN INV_AUD_USD_AMT ELSE 0 END)) AS M_RT_DIS_UMCH_AMT
          ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'DB' THEN 1 ELSE 0 END)) AS M_DBL_BIL_UMCH_CNT
          ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'DB' THEN INV_AUD_USD_AMT ELSE 0 END)) AS M_DBL_BIL_UMCH_AMT
          ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'NH' THEN 1 ELSE 0 END)) AS M_NOT_ACCT_UMCH_CNT
          ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'NH' THEN INV_AUD_USD_AMT ELSE 0 END)) AS M_NOT_ACCT_UMCH_AMT
          ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'LE' THEN 1 ELSE 0 END)) AS M_LACK_EVID_CNT
          ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'LE' THEN INV_AUD_USD_AMT ELSE 0 END)) AS M_LACK_EVID_AMT
          ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'MO' THEN 1 ELSE 0 END)) AS M_OTR_CNT
          ,SUM((CASE WHEN EAC_TP_CD = 'M' AND EAC_BIL_TP_CD = 'MO' THEN INV_AUD_USD_AMT ELSE 0 END)) AS M_OTR_AMT
          ,SUM((CASE WHEN EAC_TP_CD = 'M' THEN 1 ELSE 0 END)) AS M_SUB_TOT_CNT
          ,SUM((CASE WHEN EAC_TP_CD = 'M' THEN INV_AUD_USD_AMT ELSE 0 END)) AS M_SUB_TOT_AMT
          ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'BE' THEN 1 ELSE 0 END)) AS I_BKG_CNT
          ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'BE' THEN INV_AUD_USD_AMT ELSE 0 END)) AS I_BKG_AMT
          ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'WE' THEN 1 ELSE 0 END)) AS I_WRK_ORD_CNT
          ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'WE' THEN INV_AUD_USD_AMT ELSE 0 END)) AS I_WRK_ORD_AMT
          ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'OR' THEN 1 ELSE 0 END)) AS I_OP_CNT
          ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'OR' THEN INV_AUD_USD_AMT ELSE 0 END)) AS I_OP_AMT
          ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'CE' THEN 1 ELSE 0 END)) AS I_CTRT_CNT
          ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'CE' THEN INV_AUD_USD_AMT ELSE 0 END)) AS I_CTRT_AMT
          ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'SE' THEN 1 ELSE 0 END)) AS I_SYS_CNT
          ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'SE' THEN INV_AUD_USD_AMT ELSE 0 END)) AS I_SYS_AMT
          ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'OE' THEN 1 ELSE 0 END)) AS I_OTR_CNT
          ,SUM((CASE WHEN EAC_TP_CD = 'I' AND EAC_BIL_TP_CD = 'OE' THEN INV_AUD_USD_AMT ELSE 0 END)) AS I_OTR_AMT
          ,SUM((CASE WHEN EAC_TP_CD = 'I' THEN 1 ELSE 0 END)) AS I_SUB_TOT_CNT
          ,SUM((CASE WHEN EAC_TP_CD = 'I' THEN INV_AUD_USD_AMT ELSE 0 END)) AS I_SUB_TOT_AMT
          ,SUM((CASE WHEN EAC_TP_CD = 'T' THEN 1 ELSE 0 END)) AS MIS_TPB_CNT
          ,SUM((CASE WHEN EAC_TP_CD = 'T' THEN INV_AUD_USD_AMT ELSE 0 END)) AS MIS_TPB_AMT
          ,SUM((CASE WHEN EAC_TP_CD IN ('M', 'I', 'T') THEN 1 ELSE 0 END)) AS TOT_CNT
          ,SUM((CASE WHEN EAC_TP_CD IN ('M', 'I', 'T') THEN INV_AUD_USD_AMT ELSE 0 END)) AS TOT_AMT
     FROM      
    (    
        SELECT CASE WHEN AUDR_OFC_CD = 'SELADG' THEN 'SELADG'
                    ELSE TRS_COMMON_PKG.TRS_GET_RHQ_OFC_CD(AUDR_OFC_CD)
               END RHQ_OFC_CD
              ,AUDR_OFC_CD
              ,EAC_TP_CD
              ,EAC_BIL_TP_CD
              ,CASE WHEN @[s_cal_val] = 'I' THEN INV_AUD_USD_AMT
                    WHEN @[s_cal_val] = 'U' THEN ROUND(INV_AUD_USD_AMT)
                    WHEN @[s_cal_val] = 'T' THEN TRUNC(INV_AUD_USD_AMT)            
               END INV_AUD_USD_AMT
          FROM EAS_EXPN_AUD_CS_MGMT
         WHERE 1=1
--           AND EAC_STS_CD IN ('IS', 'AC', 'RC', 'HC') 요청에 의해 코드 변경
           AND EAC_STS_CD IN ('HC')
           #if (${s_rhq_ofc_cd} != '')
             #if (${s_rhq_ofc_cd} == 'SELADG')
             AND AUDR_OFC_CD = @[s_rhq_ofc_cd]
             #else
             AND TRS_COMMON_PKG.TRS_GET_RHQ_OFC_CD(AUDR_OFC_CD) = @[s_rhq_ofc_cd] -- RHQ 필수
             #end
           #end
           AND EAC_YRMON BETWEEN replace(@[s_eac_yrmon_fm],'-','') AND replace(@[s_eac_yrmon_to],'-','') -- Audit Month 필수
           #if (${s_eac_tp_cd} != '') 
           AND EAC_TP_CD = @[s_eac_tp_cd] -- EAC Type
           #end
           #if (${s_eac_apro_tp_cd} != '') 
           AND EAC_APRO_TP_CD = @[s_eac_apro_tp_cd] -- Audit Type
           #end
    )
     GROUP BY RHQ_OFC_CD
)
SELECT RHQ_OFC_CD
      ,M_BIL_UMCH_CNT
      ,M_BIL_UMCH_AMT
      ,M_RT_DIS_UMCH_CNT
      ,M_RT_DIS_UMCH_AMT
      ,M_DBL_BIL_UMCH_CNT
      ,M_DBL_BIL_UMCH_AMT
      ,M_NOT_ACCT_UMCH_CNT
      ,M_NOT_ACCT_UMCH_AMT
      ,M_LACK_EVID_CNT
      ,M_LACK_EVID_AMT
      ,M_OTR_CNT
      ,M_OTR_AMT
      ,M_SUB_TOT_CNT
      ,M_SUB_TOT_AMT
      ,I_BKG_CNT
      ,I_BKG_AMT
      ,I_WRK_ORD_CNT
      ,I_WRK_ORD_AMT
      ,I_OP_CNT
      ,I_OP_AMT
      ,I_CTRT_CNT
      ,I_CTRT_AMT
      ,I_SYS_CNT
      ,I_SYS_AMT
      ,I_OTR_CNT
      ,I_OTR_AMT
      ,I_SUB_TOT_CNT
      ,I_SUB_TOT_AMT
      ,MIS_TPB_CNT
      ,MIS_TPB_AMT
      ,TOT_CNT
      ,TOT_AMT 
      ,'1' COLOR_CD
  FROM RPT
 WHERE RHQ_OFC_CD <> 'SELADG'
UNION ALL
SELECT *
  FROM (
SELECT 'Sub Total' AS RHQ_OFC_CD
       ,SUM(M_BIL_UMCH_CNT) AS M_BIL_UMCH_CNT
       ,SUM(M_BIL_UMCH_AMT) AS M_BIL_UMCH_AMT
       ,SUM(M_RT_DIS_UMCH_CNT) AS M_RT_DIS_UMCH_CNT
       ,SUM(M_RT_DIS_UMCH_AMT) AS M_RT_DIS_UMCH_AMT
       ,SUM(M_DBL_BIL_UMCH_CNT) AS M_DBL_BIL_UMCH_CNT
       ,SUM(M_DBL_BIL_UMCH_AMT) AS M_DBL_BIL_UMCH_AMT
       ,SUM(M_NOT_ACCT_UMCH_CNT) AS M_NOT_ACCT_UMCH_CNT
       ,SUM(M_NOT_ACCT_UMCH_AMT) AS M_NOT_ACCT_UMCH_AMT
       ,SUM(M_LACK_EVID_CNT) AS M_LACK_EVID_CNT
       ,SUM(M_LACK_EVID_AMT) AS M_LACK_EVID_AMT
       ,SUM(M_OTR_CNT) AS M_OTR_CNT
       ,SUM(M_OTR_AMT) AS M_OTR_AMT
       ,SUM(M_SUB_TOT_CNT) AS M_SUB_TOT_CNT
       ,SUM(M_SUB_TOT_AMT) AS M_SUB_TOT_AMT
       ,SUM(I_BKG_CNT) AS I_BKG_CNT
       ,SUM(I_BKG_AMT) AS I_BKG_AMT
       ,SUM(I_WRK_ORD_CNT) AS I_WRK_ORD_CNT
       ,SUM(I_WRK_ORD_AMT) AS I_WRK_ORD_AMT
       ,SUM(I_OP_CNT) AS I_OP_CNT
       ,SUM(I_OP_AMT) AS I_OP_AMT
       ,SUM(I_CTRT_CNT) AS I_CTRT_CNT
       ,SUM(I_CTRT_AMT) AS I_CTRT_AMT
       ,SUM(I_SYS_CNT) AS I_SYS_CNT
       ,SUM(I_SYS_AMT) AS I_SYS_AMT
       ,SUM(I_OTR_CNT) AS I_OTR_CNT
       ,SUM(I_OTR_AMT) AS I_OTR_AMT
       ,SUM(I_SUB_TOT_CNT) AS I_SUB_TOT_CNT
       ,SUM(I_SUB_TOT_AMT) AS I_SUB_TOT_AMT
       ,SUM(MIS_TPB_CNT) AS MIS_TPB_CNT
       ,SUM(MIS_TPB_AMT) AS MIS_TPB_AMT
       ,SUM(TOT_CNT) AS TOT_CNT
       ,SUM(TOT_AMT) AS TOT_AMT
       ,'2' COLOR_CD
  FROM RPT
 WHERE RHQ_OFC_CD <> 'SELADG'
)
WHERE TOT_CNT > 0
 UNION ALL
 SELECT RHQ_OFC_CD
       ,M_BIL_UMCH_CNT
       ,M_BIL_UMCH_AMT
       ,M_RT_DIS_UMCH_CNT
       ,M_RT_DIS_UMCH_AMT
       ,M_DBL_BIL_UMCH_CNT
       ,M_DBL_BIL_UMCH_AMT
       ,M_NOT_ACCT_UMCH_CNT
       ,M_NOT_ACCT_UMCH_AMT
       ,M_LACK_EVID_CNT
       ,M_LACK_EVID_AMT
       ,M_OTR_CNT
       ,M_OTR_AMT
       ,M_SUB_TOT_CNT
       ,M_SUB_TOT_AMT
       ,I_BKG_CNT
       ,I_BKG_AMT
       ,I_WRK_ORD_CNT
       ,I_WRK_ORD_AMT
       ,I_OP_CNT
       ,I_OP_AMT
       ,I_CTRT_CNT
       ,I_CTRT_AMT
       ,I_SYS_CNT
       ,I_SYS_AMT
       ,I_OTR_CNT
       ,I_OTR_AMT
       ,I_SUB_TOT_CNT
       ,I_SUB_TOT_AMT
       ,MIS_TPB_CNT
       ,MIS_TPB_AMT
       ,TOT_CNT
       ,TOT_AMT 
       ,'1' COLOR_CD
  FROM RPT
 WHERE RHQ_OFC_CD = 'SELADG'
UNION ALL
SELECT *
  FROM (
SELECT 'G.Total' AS RHQ_OFC_CD
       ,SUM(M_BIL_UMCH_CNT) AS M_BIL_UMCH_CNT
       ,SUM(M_BIL_UMCH_AMT) AS M_BIL_UMCH_AMT
       ,SUM(M_RT_DIS_UMCH_CNT) AS M_RT_DIS_UMCH_CNT
       ,SUM(M_RT_DIS_UMCH_AMT) AS M_RT_DIS_UMCH_AMT
       ,SUM(M_DBL_BIL_UMCH_CNT) AS M_DBL_BIL_UMCH_CNT
       ,SUM(M_DBL_BIL_UMCH_AMT) AS M_DBL_BIL_UMCH_AMT
       ,SUM(M_NOT_ACCT_UMCH_CNT) AS M_NOT_ACCT_UMCH_CNT
       ,SUM(M_NOT_ACCT_UMCH_AMT) AS M_NOT_ACCT_UMCH_AMT
       ,SUM(M_LACK_EVID_CNT) AS M_LACK_EVID_CNT
       ,SUM(M_LACK_EVID_AMT) AS M_LACK_EVID_AMT
       ,SUM(M_OTR_CNT) AS M_OTR_CNT
       ,SUM(M_OTR_AMT) AS M_OTR_AMT
       ,SUM(M_SUB_TOT_CNT) AS M_SUB_TOT_CNT
       ,SUM(M_SUB_TOT_AMT) AS M_SUB_TOT_AMT
       ,SUM(I_BKG_CNT) AS I_BKG_CNT
       ,SUM(I_BKG_AMT) AS I_BKG_AMT
       ,SUM(I_WRK_ORD_CNT) AS I_WRK_ORD_CNT
       ,SUM(I_WRK_ORD_AMT) AS I_WRK_ORD_AMT
       ,SUM(I_OP_CNT) AS I_OP_CNT
       ,SUM(I_OP_AMT) AS I_OP_AMT
       ,SUM(I_CTRT_CNT) AS I_CTRT_CNT
       ,SUM(I_CTRT_AMT) AS I_CTRT_AMT
       ,SUM(I_SYS_CNT) AS I_SYS_CNT
       ,SUM(I_SYS_AMT) AS I_SYS_AMT
       ,SUM(I_OTR_CNT) AS I_OTR_CNT
       ,SUM(I_OTR_AMT) AS I_OTR_AMT
       ,SUM(I_SUB_TOT_CNT) AS I_SUB_TOT_CNT
       ,SUM(I_SUB_TOT_AMT) AS I_SUB_TOT_AMT
       ,SUM(MIS_TPB_CNT) AS MIS_TPB_CNT
       ,SUM(MIS_TPB_AMT) AS MIS_TPB_AMT
       ,SUM(TOT_CNT) AS TOT_CNT
       ,SUM(TOT_AMT) AS TOT_AMT
       ,'3' COLOR_CD
  FROM RPT
)
WHERE TOT_CNT > 0			]]></sql>
			<params>
				<param name="s_cal_val" type="12" value="" out="N"/>
				<param name="s_rhq_ofc_cd" type="12" value="" out="N"/>
				<param name="s_eac_yrmon_fm" type="12" value="" out="N"/>
				<param name="s_eac_yrmon_to" type="12" value="" out="N"/>
				<param name="s_eac_tp_cd" type="12" value="" out="N"/>
				<param name="s_eac_apro_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
