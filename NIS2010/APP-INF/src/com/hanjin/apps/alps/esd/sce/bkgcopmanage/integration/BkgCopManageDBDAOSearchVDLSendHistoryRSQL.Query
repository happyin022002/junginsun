<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BkgCopManageDBDAOSearchVDLSendHistoryRSQL">
			<desc><![CDATA[bkg_no, cntr_no 로 315 EDI 로 VDL status 가 전송된 기록이 없으면 row 가 조회 된다.]]></desc>
			<sql><![CDATA[
SELECT HDR.CNTR_NO ,
  'VDL' AS STND_EDI_STS_CD,
  HDR.BKG_NO ,
  BKG.BL_NO,
  DTL.VSL_CD,
  DTL.SKD_VOY_NO ,
  DTL.SKD_DIR_CD ,
  TO_CHAR(DTL.ACT_DT, 'YYYYMMDDHH24MISS') AS ACT_DT,
  DTL.NOD_CD,
  DTL.COP_DTL_SEQ,
  DTL.VPS_PORT_CD,
  DTL.COP_NO
FROM SCE_COP_HDR HDR ,
  SCE_COP_DTL DTL,
  BKG_BOOKING BKG
WHERE HDR.COP_NO = DTL.COP_NO
  AND HDR.BKG_NO = @[bkg_no]
  AND HDR.CNTR_NO = @[cntr_no]
  AND HDR.BKG_NO = BKG.BKG_NO
  AND DTL.STND_EDI_STS_CD = 'VDL'
  AND HDR.CNTR_NO <> 'SMCU0000000'
  AND ACT_DT IS NULL
  AND NOT EXISTS ( /* VDL에 대한 전송 내역이 없어야 함*/
    SELECT RSLT.BKG_NO,
      RSLT.CNTR_NO
    FROM SCE_EDI_SND_RSLT RSLT
    WHERE RSLT.BKG_NO = HDR.BKG_NO
      AND RSLT.CNTR_NO = HDR.CNTR_NO
      AND RSLT.EDI_STS_CD = DTL.STND_EDI_STS_CD )			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
