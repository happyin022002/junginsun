<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="Edi315SendDBDAOSearchCOPInfoPodDtRSQL">
			<desc><![CDATA[SearchCOPInfoPodDt]]></desc>
			<sql><![CDATA[
select                                                                                                                                                                                                                                                                                                                                         
     TO_CHAR(e_t1, 'YYYYMMDDHH24MI') POD_ETA                                                                                                                                                                                                                                                                                                       
    ,DECODE(nod, NULL, '',                                                                                                                                                                                                                                                                                                                       
                       DECODE(e_t1, NULL, '',                                                                                                                                                                                                                                                                                                   
                       TO_CHAR(GLOBALDATE_PKG.TIME_CONV_FNC(nod, e_t1, 'GMT'),                                                                                                                                                                                                                                                                  
                                   'YYYYMMDDHH24MI'))) POD_ETA_GMT                                                                                                                                                                                                                                                                               
    ,TO_CHAR(a_t1, 'YYYYMMDDHH24MI') POD_ATA                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                
    ,DECODE(nod, NULL, '',                                                                                                                                                                                                                                                                                                                       
                       DECODE(a_t1, NULL, '',                                                                                                                                                                                                                                                                                                   
                       TO_CHAR(GLOBALDATE_PKG.TIME_CONV_FNC(nod, a_t1, 'GMT'),                                                                                                                                                                                                                                                                  
                                   'YYYYMMDDHH24MI'))) POD_ATA_GMT                                                                                                                                                                                                                                                                              
    ,TO_CHAR(e_t2, 'YYYYMMDDHH24MI') POD_ETD                                                                                                                                                                                                                                                                                                      
    ,DECODE(nod, NULL, '',                                                                                                                                                                                                                                                                                                                       
                       DECODE(e_t2, NULL, '',                                                                                                                                                                                                                                                                                                   
                       TO_CHAR(GLOBALDATE_PKG.TIME_CONV_FNC(nod, e_t2, 'GMT'),                                                                                                                                                                                                                                                                  
                                   'YYYYMMDDHH24MI'))) POD_ETD_GMT                                                                                                                                                                                                                                                                                 
    ,TO_CHAR(a_t2, 'YYYYMMDDHH24MI') POD_ATD                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                
    ,DECODE(nod, NULL, '',                                                                                                                                                                                                                                                                                                                       
                       DECODE(a_t2, NULL, '',                                                                                                                                                                                                                                                                                                   
                       TO_CHAR(GLOBALDATE_PKG.TIME_CONV_FNC(nod, a_t2, 'GMT'),                                                                                                                                                                                                                                                                  
                                   'YYYYMMDDHH24MI'))) POD_ATD_GMT                                                                                                                                                                                                                                                                                 
from (                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                
                -- 2009.11.04 hkoh 추가 START                                                                                                                                                                                                                                                                                                   
        select   case when sub_act_cd = 'V' then a.bef_estm_dt0                                                                                                                                                                                                                                                                                 
                      when sub_act_cd = 'W' then a.bef_estm_dt                                                                                                                                                                                                                                                                                  
                 end  e_t1                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                
                ,case when sub_act_cd = 'V' then case when  a.bef_act_dt0 is null and a.bef_cop_sts0 = 'F' then a.bef_estm_dt0 else a.bef_act_dt0 end                                                                                                                                                                                           
                      when sub_act_cd = 'W' then case when  a.bef_act_dt  is null and a.bef_cop_sts  = 'F' then a.bef_estm_dt  else a.bef_act_dt  end                                                                                                                                                                                           
                 end  a_t1                                                                                                                                                                                                                                                                                                                      
                -- 2009.11.04 hkoh 추가 END. 하단 주석처리                                                                                                                                                                                                                                                                                      
                ,a.aft_estm_dt e_t2                                                                                                                                                                                                                                                                                                             
                ,case when a.aft_act_cd is null and a.aft_cop_sts = 'F' then a.aft_estm_dt                                                                                                                                                                                                                                                      
                    else a.aft_act_cd                                                                                                                                                                                                                                                                                                           
                    end a_t2                                                                                                                                                                                                                                                                                                                    
                ,NVL(a.bef_nod_cd, a.aft_nod_cd) AS nod  -- CFS Term 경우에 GMT로 변환기준이 되는Node 를 aft_nod_cd 로 찾음                                                                                                                                                                                                                                                                                                          
            from                                                                                                                                                                                                                                                                                                                                
            (                                                                                                                                                                                                                                                                                                                                   
                select bef_estm_dt0, bef_act_dt0, bef_nod_cd0, bef_cop_sts0,                                                                                                                                                                                                                                                                    
                       bef_estm_dt,  bef_act_dt,  bef_nod_cd,  bef_cop_sts,                                                                                                                                                                                                                                                                     
                       aft_estm_dt,  aft_act_cd,  aft_nod_cd,  aft_cop_sts ,                                                                                                                                                                                                                                                                    
                       sub_act_cd                                                                                                                                                                                                                                                                                                               
                from (                                                                                                                                                                                                                                                                                                                          
                    select      stnd_edi_sts_cd, SUBSTR(act_cd,3,1) sub_act_cd , d.estm_dt                                                                                                                                                                                                                                                      
                                -- 2009.11.04 hkoh 추가 START                                                                                                                                                                                                                                                                                   
                                ,LAG(d.estm_dt, 2)              --  T/S Port Depature(Water)/ POD arraival (Vessel)                                                                                                                                                                                                                             
                                OVER (PARTITION BY d.cop_no                                                                                                                                                                                                                                                                                     
                                ORDER  BY d.cop_no, d.cop_dtl_seq) bef_estm_dt0                                                                                                                                                                                                                                                  
                                ,LAG(d.act_dt, 2)                                                                                                                                                                                                                                                                                               
                                OVER (PARTITION BY d.cop_no                                                                                                                                                                                                                                                                                     
                                ORDER  BY d.cop_no, d.cop_dtl_seq) bef_act_dt0                                                                                                                                                                                                                                                   
                                ,LAG(substr(d.nod_cd,1,5), 2)                                                                                                                                                                                                                                                                                   
                                OVER (PARTITION BY d.cop_no                                                                                                                                                                                                                                                                                     
                                ORDER  BY d.cop_no, d.cop_dtl_seq) bef_nod_cd0                                                                                                                                                                                                                                                   
                                ,LAG(d.act_sts_cd, 2)                                                                                                                                                                                                                                                                                           
                                OVER (PARTITION BY d.cop_no                                                                                                                                                                                                                                                                                     
                                ORDER  BY d.cop_no, d.cop_dtl_seq) bef_cop_sts0                                                                                                                                                                                                                                                  
                                -- 2009.11.04 hkoh 추가 END                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                
                                ,LAG(d.estm_dt, 1)              --  pod teminal arrival(Water)/ Berthing(Vessel)                                                                                                                                                                                                                                
                                OVER (PARTITION BY d.cop_no                                                                                                                                                                                                                                                                                     
                                ORDER  BY d.cop_no, d.cop_dtl_seq) bef_estm_dt                                                                                                                                                                                                                                                   
                                ,LAG(d.act_dt, 1)                                                                                                                                                                                                                                                                                               
                                OVER (PARTITION BY d.cop_no                                                                                                                                                                                                                                                                                     
                                ORDER  BY d.cop_no, d.cop_dtl_seq) bef_act_dt                                                                                                                                                                                                                                                    
                                ,LAG(substr(d.nod_cd,1,5), 1)                                                                                                                                                                                                                                                                                   
                                OVER (PARTITION BY d.cop_no                                                                                                                                                                                                                                                                                     
                                ORDER  BY d.cop_no, d.cop_dtl_seq) bef_nod_cd                                                                                                                                                                                                                                                    
                                ,LAG(d.act_sts_cd, 1)                                                                                                                                                                                                                                                                                           
                                OVER (PARTITION BY d.cop_no                                                                                                                                                                                                                                                                                     
                                ORDER  BY d.cop_no, d.cop_dtl_seq) bef_cop_sts                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                
                                ,LEAD(d.estm_dt, 1)             -- pod vessle departure                                                                                                                                                                                                                                                         
                                OVER (PARTITION BY d.cop_no                                                                                                                                                                                                                                                                                     
                                ORDER  BY d.cop_no, d.cop_dtl_seq) aft_estm_dt                                                                                                                                                                                                                                                   
                                ,LEAD(d.act_dt, 1)                                                                                                                                                                                                                                                                                              
                                OVER (PARTITION BY d.cop_no                                                                                                                                                                                                                                                                                     
                                ORDER  BY d.cop_no, d.cop_dtl_seq) aft_act_cd                                                                                                                                                                                                                                                    
                                ,LEAD(substr(d.nod_cd,1,5), 1)                                                                                                                                                                                                                                                                                  
                                OVER (PARTITION BY d.cop_no                                                                                                                                                                                                                                                                                     
                                ORDER  BY d.cop_no, d.cop_dtl_seq) aft_nod_cd                                                                                                                                                                                                                                                    
                                ,LEAD(d.act_sts_cd, 1)                                                                                                                                                                                                                                                                                          
                                OVER (PARTITION BY d.cop_no                                                                                                                                                                                                                                                                                     
                                ORDER  BY d.cop_no, d.cop_dtl_seq) aft_cop_sts                                                                                                                                                                                                                                                   
                    from    sce_cop_dtl d                                                                                                                                                                                                                                                                                                       
                    where   d.cop_no = @[e_cop_no]                                                                                                                                                                                                                                                                                                  
                    )                                                                                                                                                                                                                                                                                                                           
                where stnd_edi_sts_cd = 'UVD'    
				and rownum = 1                                                                                                                                                                                                                                                                                               
        ) a                                                                                                                                                                                                                                                                                                                                     
    )			]]></sql>
			<params>
				<param name="e_cop_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
