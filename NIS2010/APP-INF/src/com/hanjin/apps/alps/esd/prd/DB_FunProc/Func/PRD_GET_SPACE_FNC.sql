CREATE OR REPLACE FUNCTION PRD_GET_SPACE_FNC/* ======================================================== *Copyright(c) 2006 CyberLogitec *@Function Name : PRD_GET_SPACE_FNC *@LastModifyDate : 2009-10-08 *@LastModifier : JSY(jaksal@cyberlogitec.com) *@LastVersion : 1.0 *@Purpose : Get the space. *@Remark: *@Issue:======================================================== */(    V_PCTL_NO IN VARCHAR2,    V_POL IN VARCHAR2,    V_POD IN VARCHAR2,    V_VVD IN VARCHAR2,    V_T_VVD_FLAG IN VARCHAR2,    V_SLS_OFC_CD IN VARCHAR2    )     return VARCHAR2    authid current_userIS    V_RET_VAL VARCHAR2(100) := NULL;     V_QTY VARCHAR2(10) := NULL;     v_cnt   NUMBER := 0;    CURSOR QTY_TYPE_CUR IS        SELECT P.PCTL_NO,m.CNTR_TPSZ_CD,m.CNTR_SZ_CD         FROM prd_prod_ctl_qty p, MDM_CNTR_TP_SZ m         WHERE p.CNTR_TPSZ_CD = m.CNTR_TPSZ_CD        AND PCTL_NO = V_PCTL_NO;        BEGIN    DBMS_OUTPUT.ENABLE;    DBMS_OUTPUT.PUT_LINE('0.  START! :'||V_PCTL_NO );     FOR QTY_TYPE_LIST IN QTY_TYPE_CUR LOOP        DBMS_OUTPUT.PUT_LINE('0.------- '||QTY_TYPE_LIST.CNTR_TPSZ_CD );        IF SUBSTR(QTY_TYPE_LIST.CNTR_TPSZ_CD,1,1) ='R' THEN           SELECT ASGN_RF_QTY||'(Reefer)'                INTO V_QTY              FROM SPC_ALOC_POL_POD S              WHERE S.VSL_CD= SUBSTR(V_VVD ,1,4) AND S.SKD_VOY_NO =SUBSTR(V_VVD ,5,4)  AND S.SKD_DIR_CD = SUBSTR(V_VVD ,9,1)                AND S.POL_YD_CD =V_POL AND POD_YD_CD= V_POD AND S.TS_FLG =DECODE(V_T_VVD_FLAG,'V','N','Y')                  AND S.SLS_OFC_CD = NVL((SELECT CONV_RGN_OFC_CD  FROM spc_rgn_ofc_conv WHERE SLS_RGN_OFC_CD = SLS_OFC_CD), S.SLS_OFC_CD);           ELSIF QTY_TYPE_LIST.CNTR_SZ_CD ='2'  THEN            SELECT ASGN_20FT_QTY||'(TEU)'                INTO V_QTY              FROM SPC_ALOC_POL_POD S              WHERE S.VSL_CD= SUBSTR(V_VVD ,1,4) AND S.SKD_VOY_NO =SUBSTR(V_VVD ,5,4)  AND S.SKD_DIR_CD = SUBSTR(V_VVD ,9,1)                AND S.POL_YD_CD =V_POL AND POD_YD_CD= V_POD AND S.TS_FLG =DECODE(V_T_VVD_FLAG,'V','N','Y')                  AND S.SLS_OFC_CD = NVL((SELECT CONV_RGN_OFC_CD  FROM spc_rgn_ofc_conv WHERE SLS_RGN_OFC_CD = SLS_OFC_CD), S.SLS_OFC_CD);       ELSIF QTY_TYPE_LIST.CNTR_SZ_CD ='3' OR QTY_TYPE_LIST.CNTR_SZ_CD ='4' THEN           SELECT ASGN_40FT_QTY||'(TEU)'                INTO V_QTY              FROM SPC_ALOC_POL_POD S              WHERE S.VSL_CD= SUBSTR(V_VVD ,1,4) AND S.SKD_VOY_NO =SUBSTR(V_VVD ,5,4)  AND S.SKD_DIR_CD = SUBSTR(V_VVD ,9,1)                AND S.POL_YD_CD =V_POL AND POD_YD_CD= V_POD AND S.TS_FLG =DECODE(V_T_VVD_FLAG,'V','N','Y')                  AND S.SLS_OFC_CD = NVL((SELECT CONV_RGN_OFC_CD  FROM spc_rgn_ofc_conv WHERE SLS_RGN_OFC_CD = SLS_OFC_CD), S.SLS_OFC_CD);       ELSIF QTY_TYPE_LIST.CNTR_SZ_CD ='5' THEN           SELECT ASGN_40FT_HC_QTY||'(TEU)'                INTO V_QTY              FROM SPC_ALOC_POL_POD S              WHERE S.VSL_CD= SUBSTR(V_VVD ,1,4) AND S.SKD_VOY_NO =SUBSTR(V_VVD ,5,4)  AND S.SKD_DIR_CD = SUBSTR(V_VVD ,9,1)                AND S.POL_YD_CD =V_POL AND POD_YD_CD= V_POD AND S.TS_FLG =DECODE(V_T_VVD_FLAG,'V','N','Y')                  AND S.SLS_OFC_CD = NVL((SELECT CONV_RGN_OFC_CD  FROM spc_rgn_ofc_conv WHERE SLS_RGN_OFC_CD = SLS_OFC_CD), S.SLS_OFC_CD);       ELSIF (QTY_TYPE_LIST.CNTR_SZ_CD > '5' AND QTY_TYPE_LIST.CNTR_SZ_CD <= '9' ) OR             QTY_TYPE_LIST.CNTR_SZ_CD ='W' OR QTY_TYPE_LIST.CNTR_SZ_CD ='X' THEN           SELECT ASGN_45FT_HC_QTY||'(45''HC)'                INTO V_QTY              FROM SPC_ALOC_POL_POD S              WHERE S.VSL_CD= SUBSTR(V_VVD ,1,4) AND S.SKD_VOY_NO =SUBSTR(V_VVD ,5,4)  AND S.SKD_DIR_CD = SUBSTR(V_VVD ,9,1)                AND S.POL_YD_CD =V_POL AND POD_YD_CD= V_POD AND S.TS_FLG =DECODE(V_T_VVD_FLAG,'V','N','Y')                  AND S.SLS_OFC_CD = NVL((SELECT CONV_RGN_OFC_CD  FROM spc_rgn_ofc_conv WHERE SLS_RGN_OFC_CD = SLS_OFC_CD), S.SLS_OFC_CD);       ELSE V_QTY:='00(TEU)';       END IF;              V_CNT := V_CNT+1;              IF (V_CNT = 1) THEN             V_RET_VAL:=V_RET_VAL||V_QTY;       ELSE            V_RET_VAL:=V_RET_VAL||'/'||V_QTY;       END IF;       DBMS_OUTPUT.PUT_LINE('0.  V_QTY  : ' || V_QTY);        DBMS_OUTPUT.PUT_LINE('1.  V_RET_VAL  : ' || V_RET_VAL);            END LOOP;    DBMS_OUTPUT.PUT_LINE('9.  V_QTY  : ' || V_QTY);     IF V_RET_VAL = NULL THEN         V_RET_VAL:='0';    END IF;        RETURN V_RET_VAL;    EXCEPTION      WHEN NO_DATA_FOUND      THEN         BEGIN            DBMS_OUTPUT.PUT_LINE('9.  NO_DATA_FOUND  : ');             V_RET_VAL:=0;            RETURN V_RET_VAL;         END;      WHEN OTHERS      THEN         BEGIN            DBMS_OUTPUT.PUT_LINE('9.  OTHERS  : ');             V_RET_VAL:=0;            RETURN V_RET_VAL;         END;          END ;/