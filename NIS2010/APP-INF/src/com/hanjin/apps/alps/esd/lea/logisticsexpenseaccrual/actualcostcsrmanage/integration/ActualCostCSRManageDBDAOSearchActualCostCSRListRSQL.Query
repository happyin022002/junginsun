<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ActualCostCSRManageDBDAOSearchActualCostCSRListRSQL">
			<desc><![CDATA[Actual Cost  - CSR List 조회]]></desc>
			<sql><![CDATA[
SELECT
*
FROM (
SELECT	A.CSR_NO,
		DECODE(A.SRC_CTNT, 'SO_TRANS', 'TRS', 'SO_TERMINAL', 'TES') SRC_CTNT,
        A.INV_DT,
		NVL (A.IF_FLG, 'N') IF_FLG,
		TO_CHAR (A.IF_DT, 'YYYY MM.DD  HH24:MI') IF_DT,
		A.IF_ERR_RSN,
		DECODE(A.IF_FLG, 'Y', DECODE(SUBSTR(ESTM_ERR_RSN, 1, 3), 'LEA', 'N', 'Y'), 'N') LEA_FLG,
		A.CSR_CURR_CD,
		TO_CHAR(A.CSR_AMT, '99999999999990.00') CSR_AMT,
		A.ERR_CSR_NO,
		SUBSTR(A.GL_DT, 1, 4)||'-'||SUBSTR(A.GL_DT, 5, 2)||'-'||SUBSTR(A.GL_DT, 7, 2) GL_DT,
		COUNT(*) OVER() TOTAL_CNT,
        ROW_NUMBER() OVER(ORDER BY A.CSR_NO) RNUM,
		CASE  WHEN A.SRC_CTNT = 'TES' THEN
					(SELECT TE.INV_OFC_CD FROM TES_TML_SO_HDR TE WHERE TE.CSR_NO = A.CSR_NO AND ROWNUM = 1)
        	  WHEN A.SRC_CTNT = 'TRS' THEN                                      							
			   	NVL((SELECT COST_OFC_CD FROM TRS_TRSP_INV_WRK TW WHERE TW.CSR_NO = A.CSR_NO AND ROWNUM = 1), 
                    (SELECT COST_OFC_CD FROM TRS_TRSP_RAIL_INV_WRK TRW WHERE TRW.CSR_NO = A.CSR_NO AND ROWNUM = 1 ))
        	  ELSE  
                  A.TJ_OFC_CD 
		END INV_OFC_CD
FROM   AP_INV_HDR A
WHERE  A.IF_DT BETWEEN TO_DATE(REPLACE(@[frm_st_if_dt],'-',''),'YYYYMMDD')
		 		 AND TO_DATE(REPLACE(@[frm_end_if_dt],'-',''),'YYYYMMDD') + 0.99999
AND	   A.SRC_CTNT IN ('SO_TRANS','SO_TERMINAL')
AND	   A.SRC_CTNT = DECODE(@[frm_src_ctnt], 	'ALL', A.SRC_CTNT,
											'TRS', 'SO_TRANS',
											'TES', 'SO_TERMINAL')
AND	   NVL(A.IF_FLG, 'N') = DECODE(@[frm_if_flg], 'ALL', NVL(A.IF_FLG, 'N'), @[frm_if_flg])
AND	   DECODE(A.IF_FLG, 'Y', DECODE(SUBSTR(A.ESTM_ERR_RSN, 1, 3), 'LEA', 'N', 'Y'), 'N')
			= DECODE(@[frm_lea_flg], 'ALL', DECODE(A.IF_FLG, 'Y', DECODE(SUBSTR(A.ESTM_ERR_RSN, 1, 3), 'LEA', 'N', 'Y'), 'N'),@[frm_lea_flg])
#if(${frm_inv_ofc_cd} != '')
AND	 CASE  WHEN A.SRC_CTNT = 'TES' THEN
					(SELECT TE.INV_OFC_CD FROM TES_TML_SO_HDR TE WHERE TE.CSR_NO = A.CSR_NO AND ROWNUM = 1)
           WHEN A.SRC_CTNT = 'TRS' THEN                                      							
			   	NVL((SELECT COST_OFC_CD FROM TRS_TRSP_INV_WRK TW WHERE TW.CSR_NO = A.CSR_NO AND ROWNUM = 1), 
                    (SELECT COST_OFC_CD FROM TRS_TRSP_RAIL_INV_WRK TRW WHERE TRW.CSR_NO = A.CSR_NO AND ROWNUM = 1 ))
           ELSE  
                  A.TJ_OFC_CD 
		END = @[frm_inv_ofc_cd]
#end
)
WHERE 1=1
AND RNUM BETWEEN (@[page_no]-1)*@[pagerows]+1 AND @[page_no]*@[pagerows]			]]></sql>
			<params>
				<param name="frm_st_if_dt" type="12" value="" out="N"/>
				<param name="frm_end_if_dt" type="12" value="" out="N"/>
				<param name="frm_src_ctnt" type="12" value="" out="N"/>
				<param name="frm_if_flg" type="12" value="" out="N"/>
				<param name="frm_lea_flg" type="12" value="" out="N"/>
				<param name="frm_inv_ofc_cd" type="12" value="" out="N"/>
				<param name="page_no" type="12" value="" out="N"/>
				<param name="pagerows" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
