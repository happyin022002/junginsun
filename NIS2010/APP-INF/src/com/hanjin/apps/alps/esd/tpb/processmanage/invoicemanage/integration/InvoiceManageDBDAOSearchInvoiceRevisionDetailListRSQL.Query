<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceManageDBDAOSearchInvoiceRevisionDetailListRSQL">
			<desc><![CDATA[SearchInvoiceRevisionDetailList]]></desc>
			<sql><![CDATA[
SELECT   NVL(T.IDA_SAC_CD, G.IDA_SAC_CD) AS IDA_SAC_CD
       , (
           SELECT   S.IDA_SAC_NM
           FROM     BKG_IDA_SAC_MST S
           WHERE    1 = 1
           AND      S.IDA_SAC_CD = NVL(T.IDA_SAC_CD, G.IDA_SAC_CD)
         ) AS IDA_SAC_NM
       , A.N3PTY_INV_NO
       , A.N3PTY_NO
       , A.N3PTY_BIL_TP_CD
       , (SELECT TP.N3PTY_IF_TP_CD FROM TPB_N3RD_PTY_BIL_TP TP WHERE TP.N3PTY_BIL_TP_CD = A.N3PTY_BIL_TP_CD) N3PTY_TP_CD
       , TPB_GET_N3PTY_BIL_TP_NM_FNC(A.N3PTY_BIL_TP_CD) N3PTY_BIL_TP_NM
       , COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD01132',A.EQ_KND_CD) AS EQ_KND_NM
       , A.EQ_NO
       , A.EQ_TPSZ_CD
       , A.BKG_NO BKG_NO_ALL
       , A.BL_NO BL_NO_ALL
       , A.VSL_CD||A.SKD_VOY_NO||SUBSTR(A.FINC_DIR_CD,1,1) VVD
       , A.VVD_CD   /* Added By Kim Jin-seung In 2007-08-13 */
       , '' MGSET_NO
       , A.YD_CD
       , ( SELECT  YD_NM
           FROM    MDM_YARD
           WHERE   YD_CD = A.YD_CD
         ) YD_NM
       , TO_CHAR(TPB_GET_LCL_DATE_FNC(( SELECT  MIN(VPS_ETD_DT)
                                        FROM    VSK_VSL_PORT_SKD
                                        WHERE   VSL_CD = A.VSL_CD
                                        AND     SKD_VOY_NO = A.SKD_VOY_NO
                                        AND     SKD_DIR_CD  = A.SKD_DIR_CD
                                        AND     YD_CD = A.YD_CD
                                      ), ( SELECT OFC_CD FROM TPB_OTS_GRP WHERE N3PTY_NO = A.N3PTY_NO )
                                     ),'YYYY-MM-DD HH24:MI') ATD
       , DECODE(A.FM_NOD_CD,NULL,'',A.FM_NOD_CD||'-'||A.VIA_NOD_CD||'-'||A.TO_NOD_CD||'-'||A.DOR_NOD_CD) ROUTE
       , A.NEW_EQ_NO
       , A.NEW_CNTR_SEAL_NO
       , A.CITA_NO
       , A.CNTR_WGT
       , A.N3PTY_CNTR_WGT_UT_CD
       , A.WT_HRS
       , TO_CHAR(A.OCCR_DT,'YYYY-MM-DD HH24:MI') OCCR_DT /* TPB LOCAL DATE */
       , A.NEW_VSL_CD||A.NEW_SKD_VOY_NO||SUBSTR(A.NEW_SKD_DIR_CD,1,1) NEW_VVD
       , A.NEW_BKG_NO
       , '' DAMAGE_DT
       , '' REPAIR_LOCATION
       , TO_CHAR(A.LST_FREE_DT,'YYYY-MM-DD HH24:MI') LST_FREE_DT  /* NOT TPB LOCAL DATE */
       , TO_CHAR(A.PKUP_DT,'YYYY-MM-DD HH24:MI') PKUP_DT /* TPB LOCAL DATE */
       , A.FT_OVR_DYS
       , A.CSR_NO /* Added By Kim Jin-seung In 2007-08-13 */
       , A.GL_DT  /* Added By Kim Jin-seung In 2007-08-13 */
#if(${s_from_curr_cd} != '' && ${s_curr_cd} != '')
       , TPB_GET_INV_CURR_CHG_FNC(@[s_from_curr_cd],@[s_curr_cd],A.OTS_AMT, TPB_GET_LCL_DATE_FNC(SYSDATE,@[user_ofc_cd]) ) OTS_AMT /* TPB LOCAL DATE */
       , TPB_GET_INV_CURR_CHG_FNC(@[s_from_curr_cd],@[s_curr_cd],A.INV_DTL_AMT, TPB_GET_LCL_DATE_FNC(SYSDATE,@[user_ofc_cd]) ) INV_DTL_AMT /* TPB LOCAL DATE */
	   , TPB_GET_INV_CURR_CHG_FNC(@[s_from_curr_cd],@[s_curr_cd],B.ADD_AMT, TPB_GET_LCL_DATE_FNC(SYSDATE,@[user_ofc_cd]) ) ADD_AMT /* TPB LOCAL DATE */
       , TPB_GET_INV_CURR_CHG_FNC(@[s_from_curr_cd],@[s_curr_cd],B.DDCT_AMT, TPB_GET_LCL_DATE_FNC(SYSDATE,@[user_ofc_cd]) ) DDCT_AMT /* TPB LOCAL DATE */
       , TPB_GET_INV_CURR_CHG_FNC(@[s_from_curr_cd],@[s_curr_cd],NVL(A.VAT_DTL_AMT,0), TPB_GET_LCL_DATE_FNC(SYSDATE,@[user_ofc_cd]) ) VAT_DTL_AMT /* TPB LOCAL DATE */
       , TPB_GET_INV_CURR_CHG_FNC(@[s_from_curr_cd],@[s_curr_cd],B.VAT_AMT, TPB_GET_LCL_DATE_FNC(SYSDATE,@[user_ofc_cd]) ) S_VAT_AMT /* TPB LOCAL DATE */
       , TPB_GET_INV_CURR_CHG_FNC(@[s_from_curr_cd],@[s_curr_cd],A.ADD_AMT, TPB_GET_LCL_DATE_FNC(SYSDATE,@[user_ofc_cd]) ) INV_DTL_ADD_AMT /* TPB LOCAL DATE */
#else
       , A.OTS_AMT
       , A.INV_DTL_AMT
	   , B.ADD_AMT
	   , B.DDCT_AMT
	   , NVL(A.VAT_DTL_AMT,0) VAT_DTL_AMT
       , B.VAT_AMT AS S_VAT_AMT
       , NVL(A.ADD_AMT,0) INV_DTL_ADD_AMT 
#end
       , A.EQ_KND_CD
       , A.FM_NOD_CD
       , A.VIA_NOD_CD
       , A.TO_NOD_CD
       , A.DOR_NOD_CD
       , A.BKG_NO
       , A.BL_NO
       , A.VSL_CD
       , A.SKD_VOY_NO
       , SUBSTR(A.FINC_DIR_CD,1,1) FINC_DIR_CD
       , A.ESTM_SYS_AREA_GRP_ID ESTM_SVR_ID
       , A.N3PTY_INV_RVIS_SEQ
       , A.INV_DTL_AMT    ORIGINAL_INV_DTL_AMT
       , 0 AS SO_IF_SEQ
       , A.ACCT_CD
       , A.ACCT_CD ACCT_CD_ORG
       , A.OTS_DTL_SEQ
       , CASE WHEN NVL(A.VAT_DTL_AMT,0) <> 0 THEN 1 ELSE 0 END VAT_DTL_CHK
       , C.OFC_CD AS INV_ISS_OFC_CD
       , ( SELECT NVL(A.LOD_ID, MAX(R.CUST_REF_NO_CTNT)) FROM BKG_REFERENCE R WHERE R.BKG_NO(+) = A.BKG_NO AND R.CNTR_NO(+) = A.EQ_NO AND R.BKG_REF_TP_CD ='MSLD' ) LOD_ID  
FROM     TPB_INV_RVIS_DTL A
       , TPB_INV_RVIS B
       , TPB_INVOICE C
       , TPB_N3RD_PTY_BIL_TP T
       , MDM_CHARGE G
WHERE    1 = 1
AND      A.N3PTY_INV_NO = B.N3PTY_INV_NO
AND      A.N3PTY_INV_RVIS_SEQ = B.N3PTY_INV_RVIS_SEQ
AND      A.N3PTY_INV_NO = C.N3PTY_INV_NO
AND      A.N3PTY_BIL_TP_CD = T.N3PTY_BIL_TP_CD
AND      T.CHG_CD = G.CHG_CD(+)
AND      A.N3PTY_INV_NO = @[s_n3pty_inv_no]
-- SQL Log Error related logic
#if (${s_n3pty_inv_his_seq} == 'Invoice No.')
AND      A.N3PTY_INV_RVIS_SEQ = ''
#else
AND      A.N3PTY_INV_RVIS_SEQ = @[s_n3pty_inv_his_seq]
#end

ORDER BY A.N3PTY_BIL_TP_CD			]]></sql>
			<params>
				<param name="s_from_curr_cd" type="12" value="" out="N"/>
				<param name="s_curr_cd" type="12" value="" out="N"/>
				<param name="user_ofc_cd" type="12" value="" out="N"/>
				<param name="s_n3pty_inv_no" type="12" value="" out="N"/>
				<param name="s_n3pty_inv_his_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
