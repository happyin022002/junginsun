<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="Edi322ReceiveDBDAOSearchEdi322BkgNoRSQL">
			<desc><![CDATA[SearchEdi322BkgNo]]></desc>
			<sql><![CDATA[
SELECT BKG_NO FROM
(
    SELECT BKG_NO, PRT FROM
    (
        SELECT BKG_NO, 1 PRT FROM BKG_BOOKING A
        WHERE A.BKG_NO = NVL(@[bkg_no], @[bl_no])
          AND A.BKG_STS_CD <> 'X'
        UNION
        SELECT /*+ INDEX(BB XPKBKG_BOOKING) */ BB.BKG_NO, 2 PRT
        FROM BKG_BOOKING BB,
          (
            SELECT BKG_NO
            FROM(
                SELECT BKG_NO
                FROM BKG_CONTAINER
                WHERE CNTR_NO LIKE @[cntr_no] ||'%'
        		AND    ( NVL(CNMV_ID_NO,0) <> 0 AND NVL(CNMV_ID_NO,0) <> 0)
                ORDER BY CNTR_NO, CNMV_YR DESC, CNMV_ID_NO DESC, CNMV_CYC_NO DESC)
           ) BC
        WHERE BB.BKG_NO = BC.BKG_NO
          AND BB.BKG_CGO_TP_CD = 'F'
          AND BB.BKG_STS_CD <> 'X'
          AND ROWNUM = 1
          AND 'F'= (SELECT /*+ INDEX_DESC(CTM XPKCTM_MOVEMENT) */ NVL(BKG_CGO_TP_CD, 'M') FROM CTM_MOVEMENT CTM WHERE CTM.CNTR_NO LIKE @[cntr_no] ||'%' AND ROWNUM=1)
    )
    ORDER BY PRT
) WHERE ROWNUM=1			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="INKU222428" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
