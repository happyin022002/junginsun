<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TesAudDBDAOsearchOnDockRailDataListRSQL">
			<desc><![CDATA[searchOnDockRailDataList]]></desc>
			<sql><![CDATA[
SELECT	
		RHQ,
		COST_OFC_CD,
		INV_OFC_CD,
		YD_CD,
		VNDR_SEQ,
		VNDR_LGL_ENG_NM,
		INV_NO,
		CRE_USR_NM,
		CNTR_NO,
		CNTR_DTC,
		CNTR_TPSZ_CD,
		CNTR_STY_CD,
		DCGO_CLSS_CD,
		WRK_DT,
		CLM_DT,
		RAIL_BIL_DT,
		VRFY_RSLT_IND_CD,
		DSCR_IND_CD,
		CNTR_RMK,
		ROW_COUNT
FROM	(
    SELECT	DECODE(O.OFC_CD, 'DURBA', O.AR_HD_QTR_OFC_CD, 'DARBA', O.AR_HD_QTR_OFC_CD, 'MBABA', O.AR_HD_QTR_OFC_CD, 'AISBA', O.AR_HD_QTR_OFC_CD, DECODE(L.CONTI_CD, 'F', 'HAMUR', 'E', 'HAMUR', 'M', 'NYCNA', 'A', O.AR_HD_QTR_OFC_CD)) RHQ,
			  TES.COST_OFC_CD
			, TES.INV_OFC_CD
			, TES.YD_CD
			, TES.VNDR_SEQ			-- S/P
			, V.VNDR_LGL_ENG_NM		-- S/P NAME
			, TES.INV_NO
			, TES.CRE_USR_NM
			, TES.CNTR_NO
			, TES.CNTR_DTC		
			, TES.CNTR_TPSZ_CD		-- TYPE/SIZE
			, TES.CNTR_STY_CD		-- F/M
			, TES.DCGO_CLSS_CD		-- DG
			, TES.WRK_DT			-- Working Date
			, TES.CLM_DT			-- CLM Date
			, TES.RAIL_BIL_DT		-- Rail Billing Date
			, TES.VRFY_RSLT_IND_CD	-- Verify Result
			, TES.DSCR_IND_CD
			, TES.CNTR_RMK			-- Remark	
			,ROW_NUMBER() OVER (ORDER BY TES.INV_NO ASC) AS ROW_NUM
			,COUNT(TES.INV_NO) OVER() AS ROW_COUNT
	FROM	(
		SELECT
				  H.INV_OFC_CD
				, H.COST_OFC_CD
				, H.YD_CD
				, H.VNDR_SEQ
				, H.INV_NO
				, L.TML_SO_OFC_CTY_CD
				, L.TML_SO_SEQ
				, L.TML_SO_CNTR_LIST_SEQ
				, L.VRFY_RSLT_IND_CD
				, L.MODI_FLG AS CNTR_DTC
				, L.DSCR_IND_CD
				, DECODE(TES_GET_COMCODENAME_FNC('CD00823',DSCR_IND_CD), NULL, '', TES_GET_COMCODENAME_FNC('CD00823', DSCR_IND_CD)) AS DSCR_IND_NM
				, L.RVIS_IND_FLG
				, L.VSL_CD
				, L.SKD_VOY_NO
				, L.SKD_DIR_CD
				, L.FINC_VSL_CD
				, L.FINC_SKD_VOY_NO
				, L.FINC_SKD_DIR_CD
				, L.IO_BND_CD
				, L.IOC_CD
				, L.LANE_CD
				, TO_CHAR(ATB_DT,'YYYY-MM-DD') AS ATB_DT
				, L.CNTR_NO
				, L.CNTR_TPSZ_CD
				, L.CNTR_STY_CD
				, L.LOCL_TS_IND_CD
				, L.SAM_LOCL_TS_IND_CD
				, SUBSTR(RCVDE_TERM_IND_CD,0,1)||'/'||SUBSTR(RCVDE_TERM_IND_CD,2,1) AS RCVDE_TERM_IND_CD
				, L.PRE_YD_CD
				, TO_CHAR(MVMT_GATE_IN_DT,'YYYY-MM-DD') AS MVMT_GATE_IN_DT
				, TO_CHAR(INV_GATE_IN_DT,'YYYY-MM-DD') AS INV_GATE_IN_DT
				, L.GATE_IN_TD_DYS
				, L.MVMT_GATE_OUT_DT
				, L.INV_GATE_OUT_DT
				, L.GATE_OUT_TD_DYS
				, L.MVMT_STAY_DYS
				, L.INV_STAY_DYS
				, L.STAY_DIFF_DYS
				, L.DCGO_CLSS_CD
				, L.BB_CGO_FLG
				, TO_CHAR(WRK_DT,'YYYY-MM-DD') AS WRK_DT
				, TO_CHAR(CLM_DT,'YYYY-MM-DD') AS CLM_DT
				, TO_CHAR(RAIL_BIL_DT,'YYYY-MM-DD') AS RAIL_BIL_DT
				, L.BKG_NO
				, L.BL_NO
				, L.DSCR_RSN
				, L.HNDL_RSLT_RMK
				, L.CNTR_RMK
				, L.VSL_CD || L.SKD_VOY_NO || L.SKD_DIR_CD AS VVD_NO
				, L.DSCR_DTL_IND_CD
				, L.AWK_CGO_FLG
				, L.RC_FLG
				, (SELECT USR_NM FROM COM_USER WHERE USR_ID = H.CRE_USR_ID) CRE_USR_NM
		FROM	TES_TML_SO_HDR H
				, TES_TML_SO_CNTR_LIST L
				, AP_INV_HDR A
				, COM_APRO_CSR_DTL C
				, COM_APRO_RQST_HDR R
		WHERE	1	= 1
		AND		H.TML_SO_OFC_CTY_CD	= L.TML_SO_OFC_CTY_CD
		AND		H.TML_SO_SEQ		= L.TML_SO_SEQ
		AND		H.TML_INV_TP_CD		= 'ON'
--		--// 1. Invoice Date
		--// CHM-201642099 TES Intensive Audit 검색 조건 code 추가 (2016-06-16)
		AND		H.CSR_NO			= A.CSR_NO(+)
		AND		H.CSR_NO			= C.CSR_NO(+)
		AND		C.APRO_RQST_NO		= R.APRO_RQST_NO(+)
		#if (${inv_date_type} == 'I') 	-- ISSUED DATE
		AND		H.ISS_DT BETWEEN TO_DATE(@[fm_prd_dt],'YYYY-MM-DD') AND TO_DATE(@[to_prd_dt],'YYYY-MM-DD') + 0.99999
		#elseif (${inv_date_type} == 'R')	-- RECEIVED DATE
		AND		H.RCV_DT BETWEEN TO_DATE(@[fm_prd_dt],'YYYY-MM-DD') AND TO_DATE(@[to_prd_dt],'YYYY-MM-DD') + 0.99999
		#elseif (${inv_date_type} == 'P')	-- INVOICE UPDATE DATE
		AND		H.LOCL_UPD_DT BETWEEN TO_DATE(@[fm_prd_dt],'YYYY-MM-DD') AND TO_DATE(@[to_prd_dt],'YYYY-MM-DD') + 0.99999
		#elseif (${inv_date_type} == 'A')	-- ARRROVAL REQUESTED DATE
		AND		( (R.RQST_ST_DT BETWEEN TO_DATE(@[fm_prd_dt], 'YYYY-MM-DD') AND TO_DATE(@[to_prd_dt], 'YYYY-MM-DD') + 0.99999 )
		OR		( A.CSR_APRO_STEP_ASGN_DT BETWEEN TO_DATE(@[fm_prd_dt], 'YYYY-MM-DD') AND TO_DATE(@[to_prd_dt], 'YYYY-MM-DD') + 0.99999 ) )
		#elseif (${inv_date_type} == 'C')	-- CONFIRMED DATE
		AND		H.INV_CFM_DT BETWEEN TO_DATE(@[fm_prd_dt],'YYYY-MM-DD') AND TO_DATE(@[to_prd_dt],'YYYY-MM-DD') + 0.99999
		#elseif (${inv_date_type} == 'U')	-- I/F STATUS UPDATED
		AND		A.IF_DT BETWEEN TO_DATE(@[fm_prd_dt], 'YYYY-MM-DD') AND TO_DATE(@[to_prd_dt], 'YYYY-MM-DD') + 0.99999
		#end

     --		--// 2. YARD CODE
		#if ( ${yd_cd} != '' ) 
		AND		H.YD_CD		 = @[yd_cd]
		#end
      
      --		--// 3. S/P CODE
		#if ( ${vndr_seq} != '' ) 
		AND		H.VNDR_SEQ		 = @[vndr_seq] 	
		#end
      
      --		--// 6. Cost Office
		#if ( ${cost_ofc_cd} != '' )
		AND		H.COST_OFC_CD	= @[cost_ofc_cd] 
		#end
      
      --		--// 7. Invoice Office
		#if ( ${inv_ofc_cd} != '' )
		AND		H.INV_OFC_CD	= @[inv_ofc_cd]
		#end
      
	  --		--// 7. Invoice No
		#if ( ${inv_no} != '' )
		AND		H.INV_NO	= @[inv_no]
		#end

      --		--// 8. Inv Status
		#if ( ${tml_inv_sts_cd} != '' )
		AND		H.TML_INV_STS_CD = @[tml_inv_sts_cd]
		#end
     --		--// 4. Manual Input Only
		#if ( ${manual_check} != '' ) 
		AND		L.DSCR_IND_CD <> 'CO' 
        AND 	L.DSCR_IND_CD IS NOT NULL
		#end
		
		) TES
		, MDM_ORGANIZATION O
		, MDM_LOCATION L
		, MDM_VENDOR V
	WHERE	1	= 1
	AND		TES.INV_OFC_CD	= O.OFC_CD(+)
	AND		O.LOC_CD     	= L.LOC_CD(+)
	AND		TES.VNDR_SEQ	= V.VNDR_SEQ(+)
	ORDER BY DECODE(O.OFC_CD, 'DURBA', O.AR_HD_QTR_OFC_CD, 'DARBA', O.AR_HD_QTR_OFC_CD, 'MBABA', O.AR_HD_QTR_OFC_CD, 'AISBA', O.AR_HD_QTR_OFC_CD, DECODE(L.CONTI_CD, 'F', 'HAMUR', 'E', 'HAMUR', 'M', 'NYCNA', 'A', O.AR_HD_QTR_OFC_CD))
			, INV_OFC_CD, COST_OFC_CD, YD_CD, VNDR_SEQ, INV_NO 
	)
WHERE    ROW_NUM >= (@[pagerows] * (@[page_no] - 1) + 1)
AND    ROW_NUM <= (@[pagerows] * @[page_no])			]]></sql>
			<params>
				<param name="fm_prd_dt" type="12" value="" out="N"/>
				<param name="to_prd_dt" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
				<param name="cost_ofc_cd" type="12" value="" out="N"/>
				<param name="inv_ofc_cd" type="12" value="" out="N"/>
				<param name="inv_no" type="12" value="" out="N"/>
				<param name="tml_inv_sts_cd" type="12" value="" out="N"/>
				<param name="pagerows" type="12" value="" out="N"/>
				<param name="page_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
