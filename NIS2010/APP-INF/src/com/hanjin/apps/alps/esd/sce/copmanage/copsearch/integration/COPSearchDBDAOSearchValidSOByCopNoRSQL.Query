<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="COPSearchDBDAOSearchValidSOByCopNoRSQL">
			<desc><![CDATA[COP_NO 로 삭제, Frustrate, Unmatch 처리 되지 않은 S/O 가 해당 Bound 에 존재하는 지 확인한다.]]></desc>
			<sql><![CDATA[
select REGEXP_REPLACE(PRD_GET_INLND_ROUT_STR_FNC(ROUT_ORG_NOD_CD, ROUT_DEST_NOD_CD, ROUT_SEQ), '-.-', '-') irg
     , DECODE(REPLACE(PRD_GET_COP_BND_SO_STR_FNC(@[cop_no], @[trsp_bnd_cd]), '%', ''), NULL, '#'
                        , REGEXP_REPLACE(PRD_GET_COP_BND_SO_STR_FNC(@[cop_no], @[trsp_bnd_cd]), '-.-...-', '-')  ) so
from prd_inlnd_rout_mst
where 
(ROUT_ORG_NOD_CD, ROUT_DEST_NOD_CD) IN 
	(SELECT DISTINCT DECODE(@[trsp_bnd_cd], 'O', NVL(@[new_nod], ROUT_ORG_NOD_CD), ROUT_ORG_NOD_CD), 
					 DECODE(@[trsp_bnd_cd], 'I', NVL(@[new_nod], ROUT_DEST_NOD_CD), ROUT_DEST_NOD_CD) FROM PRD_PROD_CTL_ROUT_DTL WHERE PCTL_NO = 
		(SELECT PCTL_NO FROM SCE_COP_HDR WHERE COP_NO = @[cop_no]) AND PCTL_IO_BND_CD = @[trsp_bnd_cd]
	)
and NVL(DELT_FLG,'N') = 'N'
AND NVL(AUTO_IRG_FLG,'N') = 'N'
AND REGEXP_LIKE(REGEXP_REPLACE(PRD_GET_INLND_ROUT_STR_FNC(ROUT_ORG_NOD_CD, ROUT_DEST_NOD_CD, ROUT_SEQ), '-.-', '-')
                 , DECODE(REPLACE(PRD_GET_COP_BND_SO_STR_FNC(@[cop_no], @[trsp_bnd_cd]), '%', ''), NULL, '#'
                        , REPLACE( REGEXP_REPLACE(PRD_GET_COP_BND_SO_STR_FNC(@[cop_no], @[trsp_bnd_cd]), '-.-...-', '-') , '%', '(.*)') ))
			]]></sql>
			<params>
				<param name="cop_no" type="12" value="" out="N"/>
				<param name="trsp_bnd_cd" type="12" value="" out="N"/>
				<param name="new_nod" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
