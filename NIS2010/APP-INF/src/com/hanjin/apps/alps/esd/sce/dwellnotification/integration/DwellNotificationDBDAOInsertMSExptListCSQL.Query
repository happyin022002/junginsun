<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DwellNotificationDBDAOInsertMSExptListCSQL">
			<desc><![CDATA[MS Exception Dwell Reason 내역 저장]]></desc>
			<sql><![CDATA[
MERGE INTO SCE_MS_DWLL_NTFC T1
USING (SELECT COP_NO FROM
			(SELECT COP_NO
			 FROM SCE_MS_DWLL_NTFC
			 WHERE COP_NO = (SELECT COP_NO FROM SCE_COP_HDR WHERE BKG_NO = @[bkg_no] AND CNTR_NO = @[cntr_no])
			 UNION ALL
			 SELECT NULL COP_NO FROM DUAL
			) WHERE ROWNUM = 1
	   ) T2
ON (T1.COP_NO = T2.COP_NO)

WHEN MATCHED THEN
UPDATE SET
T1.MS_DWLL_RSN_CD = @[ms_dwll_rsn_cd]
, T1.MS_DWLL_RMK = @[ms_dwll_rmk]
,T1.UPD_USR_ID = @[upd_usr_id], T1.UPD_DT = SYSDATE

WHEN NOT MATCHED THEN 
INSERT (  T1.MS_DWLL_NTFC_SEQ 
        , T1.COP_NO
        , T1.BKG_NO
        , T1.CNTR_NO
        , T1.VSL_CD
        , T1.SKD_VOY_NO
        , T1.SKD_DIR_CD
        , T1.FM_ESTM_DT
        , T1.TO_ESTM_DT
        , T1.ESTM_TZTM_DESC
        , T1.FM_ACT_DT
        , T1.TO_ACT_DT
        , T1.ACT_TZTM_DESC
        , T1.DWLL_GAP_DESC
        , T1.MS_DWLL_RSN_CD
        , T1.MS_DWLL_RMK
		, T1.CRE_USR_ID
        , T1.CRE_DT
        , T1.UPD_USR_ID
        , T1.UPD_DT)
 VALUES ( SCE_MS_DWLL_NTFC_SEQ.NEXTVAL
		,(SELECT COP_NO FROM SCE_COP_HDR WHERE BKG_NO = @[bkg_no] AND CNTR_NO = @[cntr_no])
		, @[bkg_no]
        , @[cntr_no]
        , SUBSTR(@[vvd],1,4)
        , SUBSTR(@[vvd],5,4)
        , SUBSTR(@[vvd],9,1)
        , TO_DATE(@[estm_oc],'YYYYMMDDHH24MISS')
        , TO_DATE(@[estm_id],'YYYYMMDDHH24MISS')
        , @[estm_tt]
        , TO_DATE(@[act_oc],'YYYYMMDDHH24MISS')
        , TO_DATE(@[act_id],'YYYYMMDDHH24MISS')
        , @[act_tt]
        , @[diff]
        , @[ms_dwll_rsn_cd]
        , @[ms_dwll_rmk]
		, @[cre_usr_id]
        , SYSDATE
        , @[upd_usr_id]
        , SYSDATE)			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="ms_dwll_rsn_cd" type="12" value="" out="N"/>
				<param name="ms_dwll_rmk" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="estm_oc" type="12" value="" out="N"/>
				<param name="estm_id" type="12" value="" out="N"/>
				<param name="estm_tt" type="12" value="" out="N"/>
				<param name="act_oc" type="12" value="" out="N"/>
				<param name="act_id" type="12" value="" out="N"/>
				<param name="act_tt" type="12" value="" out="N"/>
				<param name="diff" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
