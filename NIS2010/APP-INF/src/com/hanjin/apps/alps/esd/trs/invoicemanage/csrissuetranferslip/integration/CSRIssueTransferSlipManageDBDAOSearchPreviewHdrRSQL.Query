<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CSRIssueTransferSlipManageDBDAOSearchPreviewHdrRSQL">
			<desc><![CDATA[CSR HDR 내역을 조회]]></desc>
			<sql><![CDATA[
SELECT 		DECODE(@[PREVIEW_INDICATOR], 'PREVIEW', '', CSR_NO)		PRE_CSR_NO       											
			, 	TJ_OFC_CD 								PRE_OFFICE       			 								
			, 	ATTR_CTNT10 							PRE_PRPD_DY       											
			, 	INV_DESC 								PRE_PAY_TO           										
			, 	CSR_TP_CD 								PRE_CSR_TYPE       											
            , (SELECT A.INV_DESC
                 FROM (SELECT D.DTRB_COA_ACCT_CD, MAX(D.INV_DESC) INV_DESC, RANK() OVER(ORDER BY ABS(SUM(D.INV_AMT)) DESC) RNK
                         FROM AP_INV_DTRB D
                        WHERE D.CSR_NO = @[NEW_CSR_NO]
                        GROUP BY D.DTRB_COA_ACCT_CD
                      ) A
                WHERE RNK = 1
                  AND ROWNUM = 1 -- ACOUNT CODE별 동일 금액이 존재 할 경우를 대비해서 추가
              ) PRE_DESC
			, 	PAY_GRP_LU_CD 							PRE_PAY_GROUP   											
			, 	ATTR_CATE_NM 							PRE_EVI_TP       											
			, 	(SELECT ATTR_CTNT1 FROM AP_INV_HDR 		WHERE CSR_NO = @[NEW_CSR_NO]) 	PRE_APPRO_BY        					
			,   (SELECT SUM(CNT) FROM   (                                  
					SELECT COUNT(INV_NO) CNT          
					  FROM TRS_TRSP_INV_WRK           
					 WHERE CSR_NO    = @[NEW_CSR_NO]              
					 UNION ALL                        
					SELECT COUNT(INV_NO) CNT          
					  FROM TRS_TRSP_RAIL_INV_WRK      
					 WHERE CSR_NO = @[NEW_CSR_NO]                 
			      )                                   
		       )     PRE_EVI_TP_COUNT                                     		
			, 	HDR.INV_TERM_DT							PRE_DUE_DATE												
			, 	CASE WHEN HDR.CSR_AMT = 0 AND HDR.ATTR_CTNT2 IS NOT NULL THEN HDR.ATTR_CTNT2						
				END      								PRE_ASA_NO      	 										
			, 	SUBSTR(INV_DT,1,4)||'/'||SUBSTR(INV_DT,5,2)||'/'||SUBSTR(INV_DT,7,2) 	PRE_INV_DT             		
			, 	CSR_CURR_CD  															PRE_CURR_CD      			
			, 	CSR_AMT  																PRE_AMT              		
			, 	DECODE(PAY_DT, '', '', CSR_CURR_CD	)  									PRE_PAY_CURR_CD           	
			, 	DECODE(PAY_DT, '', '', PAY_AMT		)  									PRE_PAY_AMT          		
, 	DECODE(VNDR_CNT_CD, 'US', (CASE WHEN PAY_MZD_CD = 'CHK' OR PAY_MZD_CD = 'CKG' OR PAY_MZD_CD = 'CKO' OR PAY_MZD_CD = 'CMG' OR PAY_MZD_CD = 'CMO'
                                    THEN 'CHK ADDR : '
                                    ELSE 'Payment Method : ' || DECODE(PAY_MZD_CD,'CSH','CASH'
                                                                       ,'CLE','CLEARING'
                                                                       ,'CMA','CMS ACH'
                                                                       ,'EFT','EFT'
                                                                       ,'WIR','WIRE'
                                                                       ,'AUD','AUTO DEBIT'
                                                                       ,'ICO','CMS ICO'
                                                                       ,'IDD','CMS IDD') END)) CHK_MAIL
, 	DECODE(VNDR_CNT_CD, 'US', (CASE WHEN PAY_MZD_CD = 'CHK' OR PAY_MZD_CD = 'CKG' OR PAY_MZD_CD = 'CKO' OR PAY_MZD_CD = 'CMG' OR PAY_MZD_CD = 'CMO'
                                    THEN NVL(CHK_DE_ADDR1, '') ELSE '' END)) CHK_MAIL1
, 	DECODE(VNDR_CNT_CD, 'US', (CASE WHEN PAY_MZD_CD = 'CHK' OR PAY_MZD_CD = 'CKG' OR PAY_MZD_CD = 'CKO' OR PAY_MZD_CD = 'CMG' OR PAY_MZD_CD = 'CMO'
                                    THEN NVL(CHK_DE_ADDR2, '') ELSE '' END)) CHK_MAIL2
, 	DECODE(VNDR_CNT_CD, 'US', (CASE WHEN PAY_MZD_CD = 'CHK' OR PAY_MZD_CD = 'CKG' OR PAY_MZD_CD = 'CKO' OR PAY_MZD_CD = 'CMG' OR PAY_MZD_CD = 'CMO'
                                    THEN NVL(CHK_DE_ADDR3, '') ELSE '' END)) CHK_MAIL3
, 	DECODE(VNDR_CNT_CD, 'US', (CASE WHEN PAY_MZD_CD = 'CHK' OR PAY_MZD_CD = 'CKG' OR PAY_MZD_CD = 'CKO' OR PAY_MZD_CD = 'CMG' OR PAY_MZD_CD = 'CMO'
                                    THEN NVL(CHK_DE_CTY_NM, '') ELSE '' END)) CHK_MAIL4
, 	DECODE(VNDR_CNT_CD, 'US', (CASE WHEN PAY_MZD_CD = 'CHK' OR PAY_MZD_CD = 'CKG' OR PAY_MZD_CD = 'CKO' OR PAY_MZD_CD = 'CMG' OR PAY_MZD_CD = 'CMO'
                                    THEN NVL(CHK_DE_STE_CD, '') ELSE '' END)) CHK_MAIL5
, 	DECODE(VNDR_CNT_CD, 'US', (CASE WHEN PAY_MZD_CD = 'CHK' OR PAY_MZD_CD = 'CKG' OR PAY_MZD_CD = 'CKO' OR PAY_MZD_CD = 'CMG' OR PAY_MZD_CD = 'CMO'
                                    THEN NVL(CHK_DE_ZIP_CD, '') ELSE '' END)) CHK_MAIL6
, 	DECODE(VNDR_CNT_CD, 'US', (CASE WHEN PAY_MZD_CD = 'CHK' OR PAY_MZD_CD = 'CKG' OR PAY_MZD_CD = 'CKO' OR PAY_MZD_CD = 'CMG' OR PAY_MZD_CD = 'CMO'
                                    THEN NVL(CHK_DE_CNT_CD, '') ELSE '' END)) CHK_MAIL7
FROM 		AP_INV_HDR  	HDR               																	
			,   MDM_VENDOR  	VNDR               																	
WHERE 		HDR.VNDR_NO = VNDR.VNDR_SEQ               															
			 AND 		CSR_NO 			= @[NEW_CSR_NO]			]]></sql>
			<params>
				<param name="PREVIEW_INDICATOR" type="12" value="" out="N"/>
				<param name="NEW_CSR_NO" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
