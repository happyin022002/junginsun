<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MarineTerminalInvoiceManageDBDAOSearchTORRSQL">
			<desc><![CDATA[SearchTOR]]></desc>
			<sql><![CDATA[
SELECT V.VSL_CD||V.SKD_VOY_NO||V.SKD_DIR_CD VVD, V.YD_CD, H.HATCH HATCH_HANDL, to_char(MIN(C.START_DATE),'YYYY-MM-DD HH24:MI') WORK_COMM, to_char(MAX(C.END_DATE), 'YYYY-MM-DD HH24:MI') WORK_COMP
FROM VSK_VSL_PORT_SKD V,
  TDR_HEADER H,
  TDR_CRANE C
WHERE V.VSL_CD = H.VSL_CD
  AND V.SKD_VOY_NO = H.VOY_NO
  AND V.SKD_DIR_CD = H.DIR_CD
  AND V.VPS_PORT_CD = H.PORT_CD
  AND V.CLPT_IND_SEQ = H.CALL_IND
  AND H.VSL_CD = C.VSL_CD(+)
  AND H.VOY_NO = C.VOY_NO(+)
  AND H.DIR_CD = C.DIR_CD(+)
  AND H.PORT_CD = C.PORT_CD(+)
  AND H.CALL_IND = C.CALL_IND(+)
  AND V.VSL_CD = SUBSTR(@[vvd],1,4) --vvd 변수 (빡)
  AND V.SKD_VOY_NO = SUBSTR(@[vvd],5,4)
  AND V.SKD_DIR_CD = SUBSTR(@[vvd],9,1)
  AND V.YD_CD = @[no_yd_cd]  -- yard 변수
  AND V.CLPT_IND_SEQ = '1' --default로 박아줌
  AND C.START_DATE BETWEEN TO_DATE(SUBSTR(REPLACE(@[atb_dt],'-'),1,8),'YYYYMMDD')-7 AND TO_DATE(SUBSTR(REPLACE(@[atb_dt],'-'),1,8),'YYYYMMDD')+7   --MR invoice atb date를 넣음
GROUP BY V.VSL_CD, V.SKD_VOY_NO, V.SKD_DIR_CD, V.YD_CD, H.GROSS_WORK, H.NET_WORK, H.LOSE_HR, H.GROSS_GANG, H.NET_GANG, H.HATCH, H.CON, H.MVS, H.GROSS_TML, H.NET_TML, H.GROSS_GC, H.NET_GC, H.COMMENCE, H.COMPLETE			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="no_yd_cd" type="12" value="" out="N"/>
				<param name="atb_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
