<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AutoAuditRptDAOsearchAutoAuditChangeHistoryRSQL">
			<desc><![CDATA[Auto Audit 변경 이력 조회]]></desc>
			<sql><![CDATA[
WITH SRC AS (
SELECT MDL_CD
      ,RHQ_CD
      #if(${s_ofc_cd} == '')
       ,RHQ_CD AS INV_OFC_CD
      #else
       ,INV_OFC_CD
      #end
      ,EXPN_AUD_RSLT_CD
      ,SUM((CASE WHEN AUTO_EXPN_AUD_STS_CD = 'C' AND EXPN_AUD_STS_CD = 'P' THEN 1 END)) CACO_CNT -- Candidate EAC => Coincidence
      ,ROUND(SUM((CASE WHEN AUTO_EXPN_AUD_STS_CD = 'C' AND EXPN_AUD_STS_CD = 'P' THEN INV_AMT END) / US_XCH_RT),2) AS CACO_USD_AMT
      ,SUM((CASE WHEN AUTO_EXPN_AUD_STS_CD = 'C' AND EXPN_AUD_STS_CD = 'E' THEN 1 END)) CAPO_CNT -- Candidate EAC => Potential EAC
      ,ROUND(SUM((CASE WHEN AUTO_EXPN_AUD_STS_CD = 'C' AND EXPN_AUD_STS_CD = 'E' THEN INV_AMT END) / US_XCH_RT),2) AS CAPO_USD_AMT
      ,SUM((CASE WHEN AUTO_EXPN_AUD_STS_CD = 'F' AND EXPN_AUD_STS_CD = 'A' THEN 1 END)) POCA_CNT -- Potential EAC => Candidate EAC
      ,ROUND(SUM((CASE WHEN AUTO_EXPN_AUD_STS_CD = 'F' AND EXPN_AUD_STS_CD = 'A' THEN INV_AMT END) / US_XCH_RT),2) AS POCA_USD_AMT
      ,SUM((CASE WHEN AUTO_EXPN_AUD_STS_CD = 'F' AND EXPN_AUD_STS_CD = 'P' THEN 1 END)) POCO_CNT -- Potential EAC => Coincidence
      ,ROUND(SUM((CASE WHEN AUTO_EXPN_AUD_STS_CD = 'F' AND EXPN_AUD_STS_CD = 'P' THEN INV_AMT END) / US_XCH_RT),2) AS POCO_USD_AMT
      ,SUM((CASE WHEN AUTO_EXPN_AUD_STS_CD = 'S' AND EXPN_AUD_STS_CD = 'A' THEN 1 END)) COCA_CNT -- Coincidence => Candidate EAC
      ,ROUND(SUM((CASE WHEN AUTO_EXPN_AUD_STS_CD = 'S' AND EXPN_AUD_STS_CD = 'A' THEN INV_AMT END) / US_XCH_RT),2) AS COCA_USD_AMT
      ,SUM((CASE WHEN AUTO_EXPN_AUD_STS_CD = 'S' AND EXPN_AUD_STS_CD = 'E' THEN 1 END)) COPO_CNT -- Coincidence => Potential EAC
      ,ROUND(SUM((CASE WHEN AUTO_EXPN_AUD_STS_CD = 'S' AND EXPN_AUD_STS_CD = 'E' THEN INV_AMT END) / US_XCH_RT),2) AS COPO_USD_AMT
      ,SUM((CASE WHEN AUTO_EXPN_AUD_STS_CD = 'C' AND EXPN_AUD_STS_CD = 'A' THEN 1 END)) CACA_CNT -- Candidate EAC => Candidate EAC
      ,ROUND(SUM((CASE WHEN AUTO_EXPN_AUD_STS_CD = 'C' AND EXPN_AUD_STS_CD = 'A' THEN INV_AMT END) / US_XCH_RT),2) AS CACA_USD_AMT
      ,SUM((CASE WHEN AUTO_EXPN_AUD_STS_CD = 'S' AND EXPN_AUD_STS_CD = 'P' THEN 1 END)) COCO_CNT -- Coincidence => Coincidence
      ,ROUND(SUM((CASE WHEN AUTO_EXPN_AUD_STS_CD = 'S' AND EXPN_AUD_STS_CD = 'P' THEN INV_AMT END) / US_XCH_RT),2) AS COCO_USD_AMT
      ,SUM((CASE WHEN AUTO_EXPN_AUD_STS_CD = 'F' AND EXPN_AUD_STS_CD = 'E' THEN 1 END)) POPO_CNT -- Potential EAC => Potential EAC
      ,ROUND(SUM((CASE WHEN AUTO_EXPN_AUD_STS_CD = 'F' AND EXPN_AUD_STS_CD = 'E' THEN INV_AMT END) / US_XCH_RT),2) AS POPO_USD_AMT
      ,SUM(1) TOT_CNT -- TOTAL
      ,ROUND(SUM(INV_AMT / US_XCH_RT),2) AS TOT_USD_AMT
  FROM (
        SELECT NULL MDL_CD
             , NULL RHQ_CD
             , NULL INV_OFC_CD
             , NULL AUTO_EXPN_AUD_STS_CD
             , NULL EXPN_AUD_STS_CD
             , NULL EXPN_AUD_RSLT_CD
             , NULL CURR_CD
             , NULL INV_AMT
             , NULL INV_CFM_DT
             , NULL US_XCH_RT
          FROM DUAL
        #if(${s_mdl_cd} == '' || ${s_mdl_cd} == 'TRS')
        UNION ALL
        SELECT 'TRS' MDL_CD
             , RHQ_CD
             , INV_OFC_CD
             , AUTO_EXPN_AUD_STS_CD
             , EXPN_AUD_STS_CD
             , EXPN_AUD_RSLT_CD
             , CURR_CD
             , INV_AMT
             , INV_CFM_DT
             , CASE WHEN NVL(A.CURR_CD, 'USD') = 'USD' THEN 1
                    ELSE (
                         SELECT USD_LOCL_XCH_RT
                           FROM GL_MON_XCH_RT XCH
                          WHERE XCH.ACCT_XCH_RT_LVL = 1
                            AND XCH.CURR_CD = A.CURR_CD
                            AND XCH.ACCT_XCH_RT_YRMON = TO_CHAR(A.INV_CFM_DT, 'YYYYMM')
                         )
               END US_XCH_RT
          FROM EAS_TRSP_AUD A
         WHERE A.INV_CFM_DT BETWEEN TO_DATE(REPLACE(@[s_inv_cfm_fm_dt],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[s_inv_cfm_to_dt],'-',''),'YYYYMMDD') + 0.99999
           AND A.AUTO_EXPN_AUD_STS_CD IN ('S', 'F', 'C')
           AND A.EXPN_AUD_STS_CD IS NOT NULL
           AND EXISTS (SELECT 'X'             
                         FROM TRS_TRSP_INV_WRK X
                             ,AP_INV_HDR Y
                        WHERE X.INV_NO       = A.INV_NO	
                          AND X.INV_VNDR_SEQ = A.INV_VNDR_SEQ
                          AND X.CSR_NO       = Y.CSR_NO(+)
                          AND X.TRSP_INV_AUD_STS_CD <> 'RJ'
                          AND Y.RCV_ERR_FLG(+) <> 'E'
                        UNION ALL
                       SELECT 'X'             
                         FROM TRS_TRSP_RAIL_INV_WRK X
                             ,AP_INV_HDR Y
                        WHERE X.INV_NO       = A.INV_NO	
                          AND X.INV_VNDR_SEQ = A.INV_VNDR_SEQ
                          AND X.CSR_NO       = Y.CSR_NO(+)
                          AND X.TRSP_INV_AUD_STS_CD <> 'RJ'
                          AND Y.RCV_ERR_FLG(+) <> 'E'
                      )
           #if(${s_rhq_ofc_cd} != '')
           AND A.RHQ_CD = @[s_rhq_ofc_cd]
           #end
           #if(${s_ofc_cd} != '' && ${s_ofc_cd} != 'ALL')
           AND A.INV_OFC_CD = @[s_ofc_cd]
           #end
           #if(${s_mdl_cd} == '' || ${s_mdl_cd} == 'TRS')
           AND 1=1
           #else
           AND 1=2
           #end
           #if(${s_before_sts_cd} != '')
           AND A.AUTO_EXPN_AUD_STS_CD = @[s_before_sts_cd]
           #end
           #if(${s_after_sts_cd} != '')
           AND A.EXPN_AUD_STS_CD = @[s_after_sts_cd]
           #end
           #if(${s_expn_aud_rslt_cd} != '')
           AND A.EXPN_AUD_RSLT_CD = @[s_expn_aud_rslt_cd]
           #end
           #if(${s_eac_if_flg} != '')
             #if(${s_eac_if_flg} == 'Y')
             AND EXISTS (SELECT 1
                           FROM EAS_TRSP_AUD_CHK X
                          WHERE X.INV_NO = A.INV_NO
                            AND X.INV_VNDR_SEQ = A.INV_VNDR_SEQ
                            AND X.TRSP_SO_TP_CD = A.TRSP_SO_TP_CD
                        )
             #else
             AND NOT EXISTS (SELECT 1
                           FROM EAS_TRSP_AUD_CHK X
                          WHERE X.INV_NO = A.INV_NO
                            AND X.INV_VNDR_SEQ = A.INV_VNDR_SEQ
                            AND X.TRSP_SO_TP_CD = A.TRSP_SO_TP_CD
                        )
             #end
           #end
        #end
        #if(${s_mdl_cd} == '' || ${s_mdl_cd} == 'TES')
        UNION ALL
        SELECT 'TES' MDL_CD
             , A.RHQ_CD
             , A.INV_OFC_CD
             , A.AUTO_EXPN_AUD_STS_CD
             , A.EXPN_AUD_STS_CD
             , A.EXPN_AUD_RSLT_CD
             , A.CURR_CD
             , A.INV_AMT
             , A.INV_CFM_DT
             , CASE WHEN NVL(A.CURR_CD, 'USD') = 'USD' THEN 1
                    ELSE (
                         SELECT USD_LOCL_XCH_RT
                           FROM GL_MON_XCH_RT XCH
                          WHERE XCH.ACCT_XCH_RT_LVL = 1
                            AND XCH.CURR_CD = A.CURR_CD
                            AND XCH.ACCT_XCH_RT_YRMON = TO_CHAR(A.INV_CFM_DT, 'YYYYMM')
                         )
               END US_XCH_RT
          FROM EAS_TML_AUD A
             , TES_TML_SO_HDR H
             , AP_INV_HDR AH
         WHERE 1 = 1
           AND A.YD_CD   = H.YD_CD
           AND A.VNDR_SEQ  = H.VNDR_SEQ
           AND A.INV_NO  = H.INV_NO
           AND A.INV_CFM_DT = H.INV_CFM_DT
           AND NVL(H.DELT_FLG, 'N')    = 'N'
           -- Detail중 한건이라도 Estimation 물량집계 데이타가 있는 데이타를 기본으로 보여주고 Estimation 물량이 없을 경우 Confirm후 14일 이후 심사대상으로 조회한다.
           AND ( ((NVL(A.AUD_DTL_TGT_QTY, 0) - NVL(A.BAT_ESTM_VOL_RSLT_CD_QTY, 0)) > 0) 
              OR  ( ((NVL(A.AUD_DTL_TGT_QTY, 0) - NVL(A.BAT_ESTM_VOL_RSLT_CD_QTY, 0)) = 0) 
              AND  A.INV_CFM_DT < SYSDATE - 14))
           AND H.CSR_NO  = AH.CSR_NO(+)
           AND H.TML_INV_STS_CD <> 'R'
           AND H.TML_INV_RJCT_STS_CD <> 'RJ'
           AND AH.RCV_ERR_FLG(+) <> 'E'
           AND  A.INV_CFM_DT BETWEEN TO_DATE(REPLACE(@[s_inv_cfm_fm_dt],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[s_inv_cfm_to_dt],'-',''),'YYYYMMDD') + 0.99999
           AND A.AUTO_EXPN_AUD_STS_CD IN ('S', 'F', 'C')
           AND A.EXPN_AUD_STS_CD IS NOT NULL
           #if(${s_rhq_ofc_cd} != '')
           AND A.RHQ_CD = @[s_rhq_ofc_cd]
           #end
           #if(${s_ofc_cd} != '' && ${s_ofc_cd} != 'ALL')
           AND A.INV_OFC_CD = @[s_ofc_cd]
           #end
           #if(${s_mdl_cd} == '' || ${s_mdl_cd} == 'TES')
           AND 1=1
           #else
           AND 1=2
           #end
           #if(${s_before_sts_cd} != '')
           AND A.AUTO_EXPN_AUD_STS_CD = @[s_before_sts_cd]
           #end
           #if(${s_after_sts_cd} != '')
           AND A.EXPN_AUD_STS_CD = @[s_after_sts_cd]
           #end
           #if(${s_expn_aud_rslt_cd} != '')
           AND A.EXPN_AUD_RSLT_CD = @[s_expn_aud_rslt_cd]
           #end
           #if(${s_eac_if_flg} != '')
             #if(${s_eac_if_flg} == 'Y')
             AND EXISTS (SELECT 1
                           FROM EAS_TML_AUD_DTL X
                          WHERE X.INV_NO = A.INV_NO
                            AND X.VNDR_SEQ = A.VNDR_SEQ
                            AND X.INV_CFM_DT = A.INV_CFM_DT
                            AND X.EXPN_AUD_SEQ = A.EXPN_AUD_SEQ
                        )
             #else
             AND NOT EXISTS (SELECT 1
                           FROM EAS_TML_AUD_DTL X
                          WHERE X.INV_NO = A.INV_NO
                            AND X.VNDR_SEQ = A.VNDR_SEQ
                            AND X.INV_CFM_DT = A.INV_CFM_DT
                            AND X.EXPN_AUD_SEQ = A.EXPN_AUD_SEQ
                        )
             #end
           #end
        #end
        #if(${s_mdl_cd} == '' || ${s_mdl_cd} == 'MNR')
        UNION ALL
        SELECT 'MNR' MDL_CD
             , A.RHQ_CD
             , A.INV_OFC_CD
             , A.AUTO_EXPN_AUD_STS_CD
             , A.EXPN_AUD_STS_CD
             , A.EXPN_AUD_RSLT_CD
             , A.CURR_CD
             , A.INV_AMT
             , A.INV_CFM_DT
             , CASE WHEN NVL(A.INV_CURR_CD, 'USD') = 'USD' THEN 1
                    ELSE (
                         SELECT USD_LOCL_XCH_RT
                           FROM GL_MON_XCH_RT XCH
                          WHERE XCH.ACCT_XCH_RT_LVL = 1
                            AND XCH.CURR_CD = A.INV_CURR_CD
                            AND XCH.ACCT_XCH_RT_YRMON = TO_CHAR(A.INV_CFM_DT, 'YYYYMM')
                         )
               END US_XCH_RT
          FROM EAS_MNR_CFM_INV A
             , AP_PAY_INV B
             , AP_INV_HDR C
             , MDM_VENDOR D
             , MNR_PAY_INV_WRK E
         WHERE A.INV_RGST_NO = B.INV_RGST_NO
           AND B.CSR_NO = C.CSR_NO(+)
           AND A.VNDR_SEQ = D.VNDR_SEQ
           AND A.INV_RGST_NO = E.INV_RGST_NO
           AND E.MNR_INV_STS_CD = 'HC'
           AND C.RCV_ERR_FLG(+) IS NULL --E(AP REJECT) OR NULL
           AND C.IF_FLG(+) IS NULL -- Y(정상) E(ERROR) NULL(진행안함)
           AND C.AFT_ACT_FLG(+) IS NULL -- N(CANCEL) X(CANCEL : ) NULL(정상)
           AND A.INV_CFM_DT BETWEEN TO_DATE(REPLACE(@[s_inv_cfm_fm_dt],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[s_inv_cfm_to_dt],'-',''),'YYYYMMDD') + 0.99999
           AND A.AUTO_EXPN_AUD_STS_CD IN ('S', 'F', 'C')
           AND A.EXPN_AUD_STS_CD IS NOT NULL
           #if(${s_rhq_ofc_cd} != '')
           AND A.RHQ_CD = @[s_rhq_ofc_cd]
           #end
           #if(${s_ofc_cd} != '' && ${s_ofc_cd} != 'ALL')
           AND A.INV_OFC_CD = @[s_ofc_cd]
           #end
           #if(${s_mdl_cd} == '' || ${s_mdl_cd} == 'MNR')
           AND 1=1
           #else
           AND 1=2
           #end
           #if(${s_before_sts_cd} != '')
           AND A.AUTO_EXPN_AUD_STS_CD = @[s_before_sts_cd]
           #end
           #if(${s_after_sts_cd} != '')
           AND A.EXPN_AUD_STS_CD = @[s_after_sts_cd]
           #end
           #if(${s_expn_aud_rslt_cd} != '')
           AND A.EXPN_AUD_RSLT_CD = @[s_expn_aud_rslt_cd]
           #end
           #if(${s_eac_if_flg} != '')
             #if(${s_eac_if_flg} == 'Y')
             AND EXISTS (SELECT 1
                           FROM EAS_MNR_CFM_INV_DTL X
                          WHERE X.INV_NO = A.INV_NO
                            AND X.VNDR_SEQ = A.VNDR_SEQ
                            AND X.EQ_KND_CD = A.EQ_KND_CD
                        )
             #else
             AND NOT EXISTS (SELECT 1
                           FROM EAS_MNR_CFM_INV_DTL X
                          WHERE X.INV_NO = A.INV_NO
                            AND X.VNDR_SEQ = A.VNDR_SEQ
                            AND X.EQ_KND_CD = A.EQ_KND_CD
                        )
             #end
           #end
        #end
        #if(${s_mdl_cd} == '' || ${s_mdl_cd} == 'PSO')
        UNION ALL
       SELECT 'PSO' MDL_CD
             , RHQ_CD
             , INV_OFC_CD
             , AUTO_EXPN_AUD_STS_CD
             , PORT_CHG_AUD_CHK_CD AS EXPN_AUD_STS_CD
             , EXPN_AUD_RSLT_CD
             , CURR_CD
             , INV_AMT
             , INV_CFM_DT
             , CASE WHEN NVL(AB.CURR_CD, 'USD') = 'USD' THEN 1
                    ELSE (
                         SELECT USD_LOCL_XCH_RT
                           FROM GL_MON_XCH_RT XCH
                          WHERE XCH.ACCT_XCH_RT_LVL = 1
                            AND XCH.CURR_CD = AB.CURR_CD
                            AND XCH.ACCT_XCH_RT_YRMON = TO_CHAR(AB.INV_CFM_DT, 'YYYYMM')
                         )
               END US_XCH_RT
         FROM (
                SELECT MAX(A.RHQ_CD) AS RHQ_CD
                     , MAX(A.INV_OFC_CD) AS INV_OFC_CD
                     , MAX(A.AUTO_EXPN_AUD_STS_CD) AS AUTO_EXPN_AUD_STS_CD
                     , MAX(A.PORT_CHG_AUD_CHK_CD) AS EXPN_AUD_STS_CD 
                     , MAX(A.EXPN_AUD_RSLT_CD) AS  EXPN_AUD_RSLT_CD
                     , MAX(A.CURR_CD) AS CURR_CD
                     , MAX(A.INV_AMT) AS INV_AMT
                     , MAX(A.INV_CFM_DT) AS INV_CFM_DT
                     , MAX(A.PORT_CHG_AUD_CHK_CD) AS PORT_CHG_AUD_CHK_CD
                     , A.ISS_CTY_CD
                     , A.SO_SEQ
                     , A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD VVD
                     , A.LGS_COST_CD 
                  FROM EAS_PORT_SO_CFM_INV A
                     , TES_LGS_COST C
                     , MDM_ACCOUNT MA
                     , EAS_PORT_SO_CHG_ACCT CS
                     , AP_PAY_INV AI
                     , AP_INV_HDR AH
                     , PSO_CHARGE PSO
                     , EAS_AUTO_AUD_BAT B
                 WHERE 1 = 1
                   AND A.ACCT_CD = MA.ACCT_CD
                   AND A.LGS_COST_CD = C.LGS_COST_CD
                   AND A.RHQ_CD = CS.AUD_OFC_CD
                   AND A.LGS_COST_CD = CS.LGS_COST_CD
                   AND A.ISS_CTY_CD = PSO.ISS_CTY_CD 
                   AND A.SO_SEQ = PSO.SO_SEQ
                   AND PSO.INV_RGST_NO  = AI.INV_RGST_NO
                   AND AI.CSR_NO       = AH.CSR_NO(+)
                   AND B.SUB_SYS_CD(+) = 'PSO'
                   AND A.ISS_CTY_CD   = B.ISS_CTY_CD(+)
                   AND A.SO_SEQ       = B.SO_SEQ(+)
                   AND A.SO_DTL_SEQ   = B.SO_DTL_SEQ(+)

                   AND LENGTH(A.LGS_COST_CD) = 6
                   AND C.ACCT_CD NOT IN ('999999', '511795')
                   AND ((SUBSTR(C.ACCT_CD,0,4) IN ('5117', '5118', '5119') AND CS.LGS_COST_AUD_FLG = 'Y')) 
                   AND A.INV_CFM_DT BETWEEN TO_DATE(REPLACE(@[s_inv_cfm_fm_dt],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[s_inv_cfm_to_dt],'-',''),'YYYYMMDD') + 0.99999
                   AND A.AUTO_EXPN_AUD_STS_CD IN ('S', 'F', 'C')
                   AND A.PORT_CHG_AUD_CHK_CD IS NOT NULL
                   AND NVL(AH.RCV_ERR_FLG, 'X') <> 'E'
                   #if(${s_rhq_ofc_cd} != '')
                   AND A.RHQ_CD = @[s_rhq_ofc_cd]
                   #end
                   #if(${s_ofc_cd} != '' && ${s_ofc_cd} != 'ALL')
                   AND A.INV_OFC_CD = @[s_ofc_cd]
                   #end
                   #if(${s_mdl_cd} == '' || ${s_mdl_cd} == 'PSO')
                   AND 1=1
                   #else
                   AND 1=2
                   #end
                   #if(${s_before_sts_cd} != '')
                   AND A.AUTO_EXPN_AUD_STS_CD = @[s_before_sts_cd]
                   #end
                   #if(${s_after_sts_cd} != '')
                   AND A.PORT_CHG_AUD_CHK_CD = @[s_after_sts_cd]
                   #end
                   #if(${s_expn_aud_rslt_cd} != '')
                   AND A.EXPN_AUD_RSLT_CD = @[s_expn_aud_rslt_cd]
                   #end
                   #if(${s_eac_if_flg} != '')
                     #if(${s_eac_if_flg} == 'Y')
                       AND A.EAC_NO IS NOT NULL
                     #else
                       AND A.EAC_NO IS NULL
                     #end
                   #end
              GROUP BY A.ISS_CTY_CD
                     , A.SO_SEQ
                     , A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD
                     , A.LGS_COST_CD 
              ) AB
       #end
       ) AA
WHERE 1=1
  AND RHQ_CD IS NOT NULL 
  #if(${s_more_than_amt} != '')
  AND (INV_AMT / US_XCH_RT) > @[s_more_than_amt]
  #end
GROUP BY MDL_CD
        ,RHQ_CD
        #if(${s_ofc_cd} == '')
         ,RHQ_CD
        #else
         ,INV_OFC_CD
        #end
        ,EXPN_AUD_RSLT_CD
)

SELECT *
  FROM (
        SELECT RHQ_CD
              ,INV_OFC_CD
              ,MDL_CD
              ,1 TP_CD
              ,EXPN_AUD_RSLT_CD
              ,CACO_CNT
              ,CACO_USD_AMT
              ,CAPO_CNT
              ,CAPO_USD_AMT
              ,POCA_CNT
              ,POCA_USD_AMT
              ,POCO_CNT
              ,POCO_USD_AMT
              ,COCA_CNT
              ,COCA_USD_AMT
              ,COPO_CNT
              ,COPO_USD_AMT
              ,CACA_CNT
              ,CACA_USD_AMT
              ,COCO_CNT
              ,COCO_USD_AMT
              ,POPO_CNT
              ,POPO_USD_AMT
              ,TOT_CNT
              ,TOT_USD_AMT
              ,RHQ_CD RHQ_ORD
              ,INV_OFC_CD INV_OFC_ORD
              ,MDL_CD MDL_ORD
          FROM SRC 
         UNION ALL
        SELECT 'Sub Total' RHQ_CD
              ,'' INV_OFC_CD
              ,'' MDL_CD
              ,2 TP_CD
              ,'' EXPN_AUD_RSLT_CD
              ,SUM(CACO_CNT) CACO_CNT
              ,SUM(CACO_USD_AMT) CACO_USD_AMT
              ,SUM(CAPO_CNT) CAPO_CNT
              ,SUM(CAPO_USD_AMT) CAPO_USD_AMT
              ,SUM(POCA_CNT) POCA_CNT
              ,SUM(POCA_USD_AMT) POCA_USD_AMT
              ,SUM(POCO_CNT) POCO_CNT
              ,SUM(POCO_USD_AMT) POCO_USD_AMT
              ,SUM(COCA_CNT) COCA_CNT
              ,SUM(COCA_USD_AMT) COCA_USD_AMT
              ,SUM(COPO_CNT) COPO_CNT
              ,SUM(COPO_USD_AMT) COPO_USD_AMT
              ,SUM(CACA_CNT) CACA_CNT
              ,SUM(CACA_USD_AMT) CACA_USD_AMT
              ,SUM(COCO_CNT) COCO_CNT
              ,SUM(COCO_USD_AMT) COCO_USD_AMT
              ,SUM(POPO_CNT) POPO_CNT
              ,SUM(POPO_USD_AMT) POPO_USD_AMT
              ,SUM(TOT_CNT) TOT_CNT
              ,SUM(TOT_USD_AMT) TOT_USD_AMT
              ,RHQ_CD RHQ_ORD
              ,INV_OFC_CD INV_OFC_ORD
              ,MDL_CD MDL_ORD
          FROM SRC
        GROUP BY RHQ_CD
                ,INV_OFC_CD
                ,MDL_CD     
        UNION ALL
        SELECT 'Grand Total' RHQ_CD
              ,'' INV_OFC_CD
              ,'' MDL_CD
              ,3 TP_CD
              ,EXPN_AUD_RSLT_CD
              ,SUM(CACO_CNT) CACO_CNT
              ,SUM(CACO_USD_AMT) CACO_USD_AMT
              ,SUM(CAPO_CNT) CAPO_CNT
              ,SUM(CAPO_USD_AMT) CAPO_USD_AMT
              ,SUM(POCA_CNT) POCA_CNT
              ,SUM(POCA_USD_AMT) POCA_USD_AMT
              ,SUM(POCO_CNT) POCO_CNT
              ,SUM(POCO_USD_AMT) POCO_USD_AMT
              ,SUM(COCA_CNT) COCA_CNT
              ,SUM(COCA_USD_AMT) COCA_USD_AMT
              ,SUM(COPO_CNT) COPO_CNT
              ,SUM(COPO_USD_AMT) COPO_USD_AMT
              ,SUM(CACA_CNT) CACA_CNT
              ,SUM(CACA_USD_AMT) CACA_USD_AMT
              ,SUM(COCO_CNT) COCO_CNT
              ,SUM(COCO_USD_AMT) COCO_USD_AMT
              ,SUM(POPO_CNT) POPO_CNT
              ,SUM(POPO_USD_AMT) POPO_USD_AMT
              ,SUM(TOT_CNT) TOT_CNT
              ,SUM(TOT_USD_AMT) TOT_USD_AMT
              ,'XXXXX' RHQ_ORD
              ,'XXXXX' INV_OFC_ORD
              ,'XXX' MDL_ORD
          FROM SRC
         GROUP BY EXPN_AUD_RSLT_CD
        UNION ALL
        SELECT 'G.Total Sum' RHQ_CD
              ,'' INV_OFC_CD
              ,'' MDL_CD
              ,4 TP_CD
              ,'' EXPN_AUD_RSLT_CD
              ,SUM(CACO_CNT) CACO_CNT
              ,SUM(CACO_USD_AMT) CACO_USD_AMT
              ,SUM(CAPO_CNT) CAPO_CNT
              ,SUM(CAPO_USD_AMT) CAPO_USD_AMT
              ,SUM(POCA_CNT) POCA_CNT
              ,SUM(POCA_USD_AMT) POCA_USD_AMT
              ,SUM(POCO_CNT) POCO_CNT
              ,SUM(POCO_USD_AMT) POCO_USD_AMT
              ,SUM(COCA_CNT) COCA_CNT
              ,SUM(COCA_USD_AMT) COCA_USD_AMT
              ,SUM(COPO_CNT) COPO_CNT
              ,SUM(COPO_USD_AMT) COPO_USD_AMT
              ,SUM(CACA_CNT) CACA_CNT
              ,SUM(CACA_USD_AMT) CACA_USD_AMT
              ,SUM(COCO_CNT) COCO_CNT
              ,SUM(COCO_USD_AMT) COCO_USD_AMT
              ,SUM(POPO_CNT) POPO_CNT
              ,SUM(POPO_USD_AMT) POPO_USD_AMT
              ,SUM(TOT_CNT) TOT_CNT
              ,SUM(TOT_USD_AMT) TOT_USD_AMT
              ,'XXXXX' RHQ_ORD
              ,'XXXXX' INV_OFC_ORD
              ,'XXX' MDL_ORD
          FROM SRC
)
ORDER BY RHQ_ORD, INV_OFC_ORD, MDL_ORD, TP_CD, EXPN_AUD_RSLT_CD

/*
SELECT 
  '' MDL_CD
, '' RHQ_CD
, '' INV_OFC_CD
, '' TP_CD
, '' EXPN_AUD_RSLT_CD
, '' CACO_CNT
, '' CACO_USD_AMT
, '' CAPO_CNT
, '' CAPO_USD_AMT
, '' POCA_CNT
, '' POCA_USD_AMT
, '' POCO_CNT
, '' POCO_USD_AMT
, '' COCA_CNT
, '' COCA_USD_AMT
, '' COPO_CNT
, '' COPO_USD_AMT
, '' CACA_CNT
, '' CACA_USD_AMT
, '' COCO_CNT
, '' COCO_USD_AMT
, '' POPO_CNT
, '' POPO_USD_AMT
, '' TOT_CNT
, '' TOT_USD_AMT
, '' RHQ_ORD
, '' MDL_ORD
, '' S_RHQ_OFC_CD
, '' S_OFC_CD
, '' S_INV_CFM_FM_DT
, '' S_INV_CFM_TO_DT
, '' S_MDL_CD
, '' S_BEFORE_STS_CD
, '' S_AFTER_STS_CD
, '' S_EAC_IF_FLG
, '' S_MORE_THAN_AMT
, '' S_EXPN_AUD_RSLT_CD
FROM DUAL
*/			]]></sql>
			<params>
				<param name="s_inv_cfm_fm_dt" type="12" value="" out="N"/>
				<param name="s_inv_cfm_to_dt" type="12" value="" out="N"/>
				<param name="s_rhq_ofc_cd" type="12" value="" out="N"/>
				<param name="s_ofc_cd" type="12" value="" out="N"/>
				<param name="s_before_sts_cd" type="12" value="" out="N"/>
				<param name="s_after_sts_cd" type="12" value="" out="N"/>
				<param name="s_expn_aud_rslt_cd" type="12" value="" out="N"/>
				<param name="s_more_than_amt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
