<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MarineTerminalInvoiceManageDBDAOSearchCostCodeDetailListRSQL">
			<desc><![CDATA[SearchCostCodeDetailList]]></desc>
			<sql><![CDATA[
/* Cost Code 별 detail 가져오는 쿼리 */
SELECT DISTINCT 
        'S'            AS calc_tp_cd
       ,A.LGS_COST_CD  AS lgs_cost_cd
       ,D.CNTR_TPSZ_CD AS cntr_tpsz_cd
       ,A.IO_BND_CD    AS io_bnd_cd
       ,@[dcgo_ind_cd] AS dcgo_ind_cd 
       ,''               AS rc_flg            /* Referer */
       ,@[tml_wrk_dy_cd] AS tml_wrk_dy_cd     /* Apply Date */ 

       ,DECODE(A.IOC_CD, 'I','IPC','S','Same','O','OCN') AS ioc_cd /* IPC */
       ,DECODE(A.TML_TRNS_MOD_CD,'V','Mother','R','Rail','T','Truck','B','Barge','O','Other','S','Same','F','Feeder') AS tml_trns_mod_cd /* Mode */
       ,A.LANE_CD      AS lane_cd
       ,'1 ~ 99999'    AS tier               /* VOL. Tier*/
       ,'1'           AS calc_vol_qty        /* Calculated\\nVol. */
       ,'1'           AS rvis_vol_qty        /* Revised\\n Vol. */
	   ,'1'           AS stay_days   
       ,A.TML_AGMT_VOL_UT_CD AS vol_tr_ut_cd /* UOM */
       ,D.AGMT_RT      AS ctrt_rt            /* Rate */
       ,A.CURR_CD      AS curr_cd            /* AGMT Curr */
       ,NVL('1',1) * NVL(D.AGMT_RT,0) AS inv_amt /* Amount */
       /* VO Fields */
       ,'' AS cost_code
       ,'' AS agmt_ofc_cty_cd
       ,'' AS agmt_seq
       ,'' AS agmt_ver_no
       ,'' AS yd_cd
       ,'' AS vndr_seq      
       ,'' AS eff_fm_dt
       ,'' AS eff_to_dt
       ,'' AS cre_ofc_cd
       ,'' AS ctrt_ofc_cd
       ,'' AS cre_dt
       ,'' AS upd_dt
	   ,100 AS portion
	   , 1 AS inv_xch_rt
	   , A.AGMT_DTL_RMK
-- 비용지급 전표 결재 기능 - 3차 AGMT 정보 등록 (4347-10-15)
		, @[agmt_ofc_cty_cd] AS TML_AGMT_OFC_CTY_CD
		, TO_NUMBER(@[agmt_seq]) AS TML_AGMT_SEQ
		, TO_NUMBER(REPLACE(@[agmt_ver_no],'.','')) AS TML_AGMT_VER_NO
        , NVL((SELECT VOL_RT_CHK_FLG FROM TES_TML_SO_COST C WHERE C.LGS_COST_CD = A.LGS_COST_CD),'N') VOL_RT_CHK_FLG
        , NVL((SELECT VOL_DUP_CHK_FLG FROM TES_TML_SO_COST C WHERE C.LGS_COST_CD = A.LGS_COST_CD),'N') VOL_DUP_CHK_FLG
		, NVL((SELECT RMK_CHK_FLG FROM TES_TML_SO_COST C WHERE C.LGS_COST_CD = A.LGS_COST_CD),'N') RMK_CHK_FLG
FROM TES_TML_AGMT_DTL A, 
  TES_TML_AGMT_APLY_DY B, 
  TES_TML_AGMT_DG_CGO_CLSS C, 
  (  SELECT A.TML_AGMT_OFC_CTY_CD, 
              A.TML_AGMT_SEQ, 
              A.TML_AGMT_VER_NO, 
              A.TML_AGMT_DTL_SEQ, 
              B.CNTR_APLY_TP_CD, 
              B.CNTR_TPSZ_CD, 
              A.LGS_COST_CD, 
              a.tml_agmt_vol_ut_cd, 
              DECODE(AGMT_RT,NULL,a.agmt_ut_rt,AGMT_RT) AGMT_RT 
    FROM TES_TML_AGMT_DTL A, 
      	(	SELECT * 
			FROM TES_TML_AGMT_TP_SZ
			WHERE 1=1

	#if (${rf_yn} == 'Y') 
		AND CNTR_TPSZ_CD  IN ('R2','R4','R5','R7','R8','R9')
	#end

		) B 
    WHERE A.TML_AGMT_OFC_CTY_CD = B.TML_AGMT_OFC_CTY_CD(+) 
      AND A.TML_AGMT_SEQ = B.TML_AGMT_SEQ(+) 
      AND A.TML_AGMT_VER_NO = B.TML_AGMT_VER_NO(+) 
      AND A.TML_AGMT_DTL_SEQ = B.TML_AGMT_DTL_SEQ(+) 
      AND A.TML_AGMT_OFC_CTY_CD = @[agmt_ofc_cty_cd]
      AND A.TML_AGMT_SEQ        = TO_NUMBER(@[agmt_seq])
      AND A.TML_AGMT_VER_NO     = TO_NUMBER(REPLACE(@[agmt_ver_no],'.',''))
      AND A.LGS_COST_CD         = @[cost_code]

  ) D 
WHERE 1=1
  AND A.TML_AGMT_OFC_CTY_CD = @[agmt_ofc_cty_cd]
  AND A.TML_AGMT_SEQ        = TO_NUMBER(@[agmt_seq])
  AND A.TML_AGMT_VER_NO     = TO_NUMBER(REPLACE(@[agmt_ver_no],'.',''))
  AND A.LGS_COST_CD         = @[cost_code]
  AND A.TMP_SAV_FLG IS NULL 
  AND A.TML_AGMT_OFC_CTY_CD = B.TML_AGMT_OFC_CTY_CD(+) 
  AND A.TML_AGMT_OFC_CTY_CD = C.TML_AGMT_OFC_CTY_CD(+) 
  AND A.TML_AGMT_OFC_CTY_CD = D.TML_AGMT_OFC_CTY_CD(+) 
  AND A.TML_AGMT_SEQ = B.TML_AGMT_SEQ(+) 
  AND A.TML_AGMT_SEQ = C.TML_AGMT_SEQ(+) 
  AND A.TML_AGMT_SEQ = D.TML_AGMT_SEQ(+) 
  AND A.TML_AGMT_VER_NO = B.TML_AGMT_VER_NO(+) 
  AND A.TML_AGMT_VER_NO = C.TML_AGMT_VER_NO(+) 
  AND A.TML_AGMT_VER_NO = D.TML_AGMT_VER_NO(+) 
  AND A.TML_AGMT_DTL_SEQ = B.TML_AGMT_DTL_SEQ(+) 
  AND A.TML_AGMT_DTL_SEQ = C.TML_AGMT_DTL_SEQ(+) 
  AND A.TML_AGMT_DTL_SEQ = D.TML_AGMT_DTL_SEQ(+) 

 
#if (${tml_agmt_vol_ut_cd} != 'ALL') 
	AND A.TML_AGMT_VOL_UT_CD = @[tml_agmt_vol_ut_cd]
#end

#if (${cntr_tpsz_cd} != 'ALL') 
	AND D.CNTR_TPSZ_CD =@[cntr_tpsz_cd]
#end

--CHM-201641252 Semi-Update에서 DG Default Setting변경(All Type추가) - (4349-04-20)
#if (${dcgo_ind_cd} == 'ALL') 
	AND ( C.DCGO_APLY_TP_CD IN ('R', 'D')
	OR	(A.DCGO_APLY_TP_CD = 'N' OR A.DCGO_APLY_TP_CD IS NULL) )
#elseif (${dcgo_ind_cd} == 'ALLDG') 
	AND C.DCGO_APLY_TP_CD IN ('R','D')
#elseif (${dcgo_ind_cd} == 'N') 
   AND (A.DCGO_APLY_TP_CD = 'N' OR A.DCGO_APLY_TP_CD IS NULL) 
#else 
   AND DECODE(@[dcgo_ind_cd], '1',C.DCGO_N1ST_CLSS_FLG, '2',C.DCGO_N2ND_CLSS_FLG, '3',C.DCGO_N3RD_CLSS_FLG, '4',C.DCGO_N4TH_CLSS_FLG, '5',C.DCGO_N5TH_CLSS_FLG,
                              '6',C.DCGO_N6TH_CLSS_FLG, '7',C.DCGO_N7TH_CLSS_FLG, '8',C.DCGO_N8TH_CLSS_FLG, '9',C.DCGO_N9TH_CLSS_FLG) = 'Y'
#end


#if (${tml_wrk_dy_cd} != '') 
	AND DECODE(@[tml_wrk_dy_cd],  'HO',B.HOL_FLG, 'SA',B.SAT_FLG, 'SU',B.SUN_FLG, 'WD',B.WKDY_FLG) = 'Y'
#end

ORDER BY LGS_COST_CD DESC, cntr_tpsz_cd, io_bnd_cd, dcgo_ind_cd, rc_flg, tml_wrk_dy_cd, ioc_cd, tml_trns_mod_cd, lane_cd, tier, calc_vol_qty, rvis_vol_qty, vol_tr_ut_cd, ctrt_rt, curr_cd			]]></sql>
			<params>
				<param name="dcgo_ind_cd" type="12" value="" out="N"/>
				<param name="tml_wrk_dy_cd" type="12" value="" out="N"/>
				<param name="agmt_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="agmt_seq" type="12" value="" out="N"/>
				<param name="agmt_ver_no" type="12" value="" out="N"/>
				<param name="cost_code" type="12" value="" out="N"/>
				<param name="tml_agmt_vol_ut_cd" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
