<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SpecialCargoQuotationManageDBDAOcheckTesTmlSoDtlCostExistRSQL">
			<desc><![CDATA[checkTesTmlSoDtlCostExist]]></desc>
			<sql><![CDATA[
-- 없으면 X , SEQ = MAX+1 (INSERT)
SELECT 
'N' FLAG 
, (SELECT TO_NUMBER(NVL(MAX(tml_so_dtl_seq),'0'))+1
    FROM TES_TML_SO_DTL
    WHERE TML_SO_OFC_CTY_CD = @[tml_so_ofc_cty_cd]
    AND   TML_SO_SEQ        = @[tml_so_seq]) SEQ
FROM DUAL 
WHERE NOT EXISTS ( SELECT * FROM TES_TML_SO_DTL
WHERE TML_SO_OFC_CTY_CD = @[tml_so_ofc_cty_cd]
AND TML_SO_SEQ = @[tml_so_seq]
AND BKG_NO = @[bkg_no]
AND LGS_COST_CD = @[lgs_cost_cd])
UNION ALL
--있으면 O , SEQ = 원래 쓰던거 (UPDATE)
SELECT 
'Y' FLAG 
, (SELECT TML_SO_DTL_SEQ FROM TES_TML_SO_DTL
    WHERE TML_SO_OFC_CTY_CD = @[tml_so_ofc_cty_cd]
    AND TML_SO_SEQ = @[tml_so_seq]
    AND BKG_NO = @[bkg_no]
    AND LGS_COST_CD = @[lgs_cost_cd]) SEQ
FROM DUAL 
WHERE EXISTS ( SELECT * FROM TES_TML_SO_DTL
WHERE TML_SO_OFC_CTY_CD = @[tml_so_ofc_cty_cd]
AND TML_SO_SEQ = @[tml_so_seq]
AND BKG_NO = @[bkg_no]
AND LGS_COST_CD = @[lgs_cost_cd])			]]></sql>
			<params>
				<param name="tml_so_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="tml_so_seq" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="lgs_cost_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
