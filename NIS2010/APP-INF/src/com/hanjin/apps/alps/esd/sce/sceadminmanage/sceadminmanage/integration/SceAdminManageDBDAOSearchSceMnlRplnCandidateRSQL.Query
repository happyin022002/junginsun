<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SceAdminManageDBDAOSearchSceMnlRplnCandidateRSQL">
			<desc><![CDATA[replan 할 LEA 결산 대상 리스트를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT 
 X.COP_COP_NO COP_NO
,'T' IO_BND_CD
,'N' RPLN_SCS_FLG
,'LEAACCT' CRE_USR_ID
,SYSDATE
,'SYSTEM'
,SYSDATE
,'T'
FROM (
    SELECT 
     XX.COP_COP_NO
    FROM (
        SELECT 
         H.PCTL_NO
        ,H.MST_COP_NO
        ,T.CRE_DT
        ,T.UPD_DT
        ,S.BKG_NO LEA_BKG_NO
        ,S.CNTR_NO
        ,P.COP_NO COP_COP_NO
        ,P.COST_ACT_GRP_SEQ
        ,P.COST_ACT_GRP_CD
        ,P.N1ST_NOD_CD
        ,P.N2ND_NOD_CD
        ,P.N3RD_NOD_CD
        ,P.N4TH_NOD_CD
        ,T.*
        FROM 
          SCE_CSR_MNTR S,
          SCE_COP_HDR H,
          SCE_PLN_SO_LIST P,
          TRS_TRSP_SVC_ORD T
        WHERE H.BKG_NO = S.BKG_NO
          AND H.CNTR_NO= S.CNTR_NO
          AND H.COP_STS_CD<>'X'
          AND T.BKG_NO = S.BKG_NO
          AND T.EQ_NO = S.CNTR_NO
          AND T.COP_NO = P.COP_NO
          AND T.COST_ACT_GRP_SEQ = P.COST_ACT_GRP_SEQ
          AND T.COST_ACT_GRP_CD = P.COST_ACT_GRP_CD
          AND T.DELT_FLG='N'  
          AND P.COP_NO = H.COP_NO
          AND P.TRSP_SO_STS_CD NOT IN ('P', 'U')
          AND NVL(T.TRSP_FRST_FLG,'N')='N' 
          AND NVL(T.RPLN_UMCH_FLG,'N')='N'
          AND ((P.N1ST_NOD_CD <> T.FM_NOD_CD))
          ) XX
    GROUP BY XX.COP_COP_NO      
) X
GROUP BY X.COP_COP_NO
UNION
SELECT 
 X.COP_COP_NO COP_NO
,'T' IO_BND_CD
,'N' RPLN_SCS_FLG
,'LEAACCT' CRE_USR_ID
,SYSDATE
,'SYSTEM'
,SYSDATE
,'T'
FROM (
    SELECT
    XX.COP_COP_NO
    FROM (
        SELECT 
         H.PCTL_NO
        ,H.MST_COP_NO
        ,T.CRE_DT
        ,T.UPD_DT
        ,S.BKG_NO LEA_BKG_NO
        ,S.CNTR_NO
        ,P.COP_NO COP_COP_NO
        ,P.COST_ACT_GRP_SEQ
        ,P.COST_ACT_GRP_CD
        ,P.N1ST_NOD_CD
        ,P.N2ND_NOD_CD
        ,P.N3RD_NOD_CD
        ,P.N4TH_NOD_CD
        ,T.*
        FROM 
          SCE_CSR_MNTR S,
          SCE_COP_HDR H,
          SCE_PLN_SO_LIST P,
          TRS_TRSP_RAIL_BIL_ORD T
        WHERE H.BKG_NO = S.BKG_NO
          AND H.CNTR_NO= S.CNTR_NO
          AND H.COP_STS_CD<>'X'
          AND T.BKG_NO = S.BKG_NO
          AND T.EQ_NO = S.CNTR_NO
          AND T.COP_NO = P.COP_NO
          AND T.COST_ACT_GRP_SEQ = P.COST_ACT_GRP_SEQ
          AND T.COST_ACT_GRP_CD = P.COST_ACT_GRP_CD
          AND T.DELT_FLG='N'  
          AND P.COP_NO = H.COP_NO
          AND P.TRSP_SO_STS_CD NOT IN ('P', 'U')
		  AND NVL(T.TRSP_FRST_FLG,'N')='N' 
          AND ((P.N1ST_NOD_CD <> T.FM_NOD_CD))
          ) XX
    GROUP BY XX.COP_COP_NO     
) X
GROUP BY X.COP_COP_NO			]]></sql>
			<params>
			</params>
		</query>
	</querys>
</sqls>
