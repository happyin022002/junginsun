<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TESeBillingManageCommonDBDAOGetSetFltFileXcldDtlRulesRSQL">
			<desc><![CDATA[VNDR단위에 호출할 EXCL Dtl RULE]]></desc>
			<sql><![CDATA[
SELECT 
X.FLT_FILE_TAG_NM, X.FLT_FILE_KEY_NM, X.QTTN_CONC_FLG, X.RPLC_VAL_FLG, X.RPLC_VAL_CTNT,
CASE 
WHEN NVL(QTTN_CONC_FLG,'N') = 'Y' AND NVL(RPLC_VAL_FLG,'N') = 'N'
THEN ''''||X.DFLT_VAL_CTNT||''''
ELSE X.DFLT_VAL_CTNT
END DFLT_VAL_CTNT,
1 RK, X.SAV_SEQ SEQ
FROM TES_EDI_RCV_RULE_MN M, TES_EDI_RCV_RULE_VNDR_MGMT V, TES_EDI_RCV_FLT_FILE_TAG T, TES_EDI_RCV_FLT_FILE_XCLD X
WHERE 1=1
AND M.EDI_RCV_RULE_MN_SEQ = V.EDI_RCV_RULE_MN_SEQ
AND M.SNDR_ID = @[sndr_id] 
AND NVL(M.DELT_FLG,'N') <> 'Y'
AND NVL(M.CFM_FLG,'N') = 'Y'
AND V.EDI_VNDR_SEQ =  @[vndr_seq] 
AND V.EDI_RCV_RULE_MN_SEQ = T.EDI_RCV_RULE_MN_SEQ
AND V.EDI_VNDR_SEQ = T.EDI_VNDR_SEQ
AND T.FLT_FILE_TAG_NM = @[tag_nm]
AND T.EDI_RCV_RULE_MN_SEQ = X.EDI_RCV_RULE_MN_SEQ
AND T.EDI_VNDR_SEQ = X.EDI_VNDR_SEQ
AND T.FLT_FILE_TAG_NM = X.FLT_FILE_TAG_NM
AND X.FLT_FILE_KEY_NM NOT IN ('CRE_USR_ID','CRE_DT','UPD_USR_ID','UPD_DT')
UNION
SELECT 
@[tag_nm] FLT_FILE_TAG_NM, 
'CRE_USR_ID' FLT_FILE_KEY_NM, 
'N' QTTN_CONC_FLG, 'N' RPLC_VAL_FLG, '' RPLC_VAL_CTNT, '''SYSTEM''' DFLT_VAL_CTNT, 2 RK, 1 SEQ
FROM DUAL 
UNION
SELECT 
@[tag_nm] FLT_FILE_TAG_NM, 
'CRE_DT' FLT_FILE_KEY_NM, 
'N' QTTN_CONC_FLG, 'N' RPLC_VAL_FLG, '' RPLC_VAL_CTNT, 'SYSDATE' DFLT_VAL_CTNT, 2 RK, 2 SEQ
FROM DUAL 
UNION
SELECT 
@[tag_nm] FLT_FILE_TAG_NM, 
'UPD_USR_ID' FLT_FILE_KEY_NM, 
'N' QTTN_CONC_FLG, 'N' RPLC_VAL_FLG, '' RPLC_VAL_CTNT, '''SYSTEM''' DFLT_VAL_CTNT, 2 RK, 3 SEQ
FROM DUAL 
UNION
SELECT 
@[tag_nm] FLT_FILE_TAG_NM, 
'UPD_DT' FLT_FILE_KEY_NM, 
'N' QTTN_CONC_FLG, 'N' RPLC_VAL_FLG, '' RPLC_VAL_CTNT, 'SYSDATE' DFLT_VAL_CTNT, 2 RK, 4 SEQ
FROM DUAL 
ORDER BY RK, SEQ, FLT_FILE_KEY_NM			]]></sql>
			<params>
				<param name="sndr_id" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
				<param name="tag_nm" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
