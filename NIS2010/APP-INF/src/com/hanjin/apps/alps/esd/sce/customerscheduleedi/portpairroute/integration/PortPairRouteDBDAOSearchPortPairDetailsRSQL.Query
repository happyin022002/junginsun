<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PortPairRouteDBDAOSearchPortPairDetailsRSQL">
			<desc><![CDATA[SearchPortPairDetails]]></desc>
			<sql><![CDATA[
SELECT 
		 ROUT_RCV_DT                                      
		,ROUT_SEQ                                         
		,CUST_TRD_PRNR_ID                               		
		,POR_CD                                           
		,ORG_LOC_CD AS POL_CD                            
		,N1ST_POL_CD                                      
		,N1ST_POD_CD                                      
		,N2ND_POL_CD                                      
		,N2ND_POD_CD                                      
		,N3RD_POL_CD                                      
		,N3RD_POD_CD                                      
		,N4TH_POL_CD                                      
		,N4TH_POD_CD                                      
		,DEST_LOC_CD AS POD_CD                                                                                    
		,DEL_CD                                             
		,UPD_IND_CD AS OCEAN_FLAG                             
		,USE_FLG                                              
		,MNL_USE_FLG
		,'' AS DELT_FLG                                          
		,CRE_USR_ID                                           
		,TO_CHAR(CRE_DT, 'YYYYMMDDHH24MI') AS CRE_DT          
		,DECODE(MNL_USE_FLG,'N',UPD_USR_ID,'')AS UPD_USR_ID                                 
		,DECODE(MNL_USE_FLG,'N',TO_CHAR(UPD_DT, 'YYYYMMDDHH24MI'),'') AS UPD_DT

		-- CHM-201326574 : added ------------>
		,
		(
			SELECT	WM_CONCAT(SLAN_CD)
			FROM	SCE_CUST_EDI_BLCK B
			WHERE	B.ROUT_RCV_DT	=	DTL.ROUT_RCV_DT	
			AND		B.ROUT_SEQ	    =	DTL.ROUT_SEQ 
            AND     B.DELT_FLG = 'N'
		)	BLOCK_LANES 
		
		--<-------------- -- CHM-201326574 : added
		
FROM	SCE_PORT_PAIR_DTL DTL
WHERE	CUST_TRD_PRNR_ID =  @[partner_id] 

/* condition - POR */
#if (${por_port_cd} != '') 
	AND		POR_CD			=	@[por_port_cd]
#end
 
/* condition - POL */
#if (${pol_port_cd} != '') 
	AND		N1ST_POL_CD		=    @[pol_port_cd]
#end

/* condition - POD */
#if (${pod_port_cd} != '')  
	AND		DEST_LOC_CD		=    @[pod_port_cd]
#end

/* condition - DEL */
#if (${del_port_cd} != '') 
	AND		DEL_CD			=	 @[del_port_cd]
#end
 
	AND CASE	WHEN @[no_use_flag] = 'Y' AND NVL(mnl_use_flg,'Y') = 'Y' AND use_flg = 'Y'  
						THEN 'Y'                                        
				WHEN @[no_use_flag] = 'N' -- AND (mnl_use_flg = 'N' OR use_flg = 'N')  AND mnl_use_flg = 'N'
						THEN 'Y'                                        
		ELSE 'N'                                        
		END			=	'Y'                                            
	AND CASE	WHEN @[ts_type] = 'A'                                   
						THEN 'Y'                                        
				WHEN @[ts_type] = 'D' AND n2nd_pod_cd IS NULL AND n3rd_pod_cd IS NULL AND n4th_pod_cd IS NULL            
						THEN 'Y'                                        
				WHEN @[ts_type] = 'T' AND ( n2nd_pod_cd IS NOT NULL OR n3rd_pod_cd IS NOT NULL)           
						THEN 'Y'                                        
		ELSE 'N'                                        
		END			=	'Y'			]]></sql>
			<params>
				<param name="partner_id" type="12" value="" out="N"/>
				<param name="por_port_cd" type="12" value="" out="N"/>
				<param name="pol_port_cd" type="12" value="" out="N"/>
				<param name="pod_port_cd" type="12" value="" out="N"/>
				<param name="del_port_cd" type="12" value="" out="N"/>
				<param name="no_use_flag" type="12" value="" out="N"/>
				<param name="ts_type" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
