<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceEdiHitDBDAOSaveSvcOrdInvUSQL">
			<desc><![CDATA[Service Order에 Invoice 맵핑]]></desc>
			<sql><![CDATA[
UPDATE TRS_TRSP_SVC_ORD A
   SET A.INV_NO = @[inv_no]
      ,A.INV_VNDR_SEQ = @[inv_vndr_seq]
      ,A.INV_CURR_CD = @[inv_curr_cd]
      ,A.TRSP_INV_CALC_LGC_TP_CD = @[trsp_inv_calc_lgc_tp_cd]
      ,A.INV_XCH_RT = TO_NUMBER(@[inv_xch_rt])
      ,A.TRSP_INV_ACT_STS_CD = @[trsp_inv_act_sts_cd]
      ,A.INV_BZC_AMT = CASE WHEN @[inv_curr_cd] IN ('KRW','JPY','TWD') THEN ROUND(((NVL(A.BZC_AMT,0) + NVL(A.NEGO_AMT,0) + NVL(A.FUEL_SCG_AMT,0)+ NVL(A.SCG_VAT_AMT,0) + NVL(A.OVR_WGT_SCG_AMT,0) + NVL(A.ETC_ADD_AMT,0) + NVL(A.TOLL_FEE_AMT,0)) * TO_NUMBER(@[inv_xch_rt])),0)
                            ELSE ROUND(((NVL(A.BZC_AMT,0) + NVL(A.NEGO_AMT,0) + NVL(A.FUEL_SCG_AMT,0) + NVL(A.SCG_VAT_AMT,0) + NVL(A.OVR_WGT_SCG_AMT,0) + NVL(A.ETC_ADD_AMT,0) + NVL(A.TOLL_FEE_AMT,0)) * TO_NUMBER(@[inv_xch_rt])),2)
                        END
      ,A.INV_ETC_ADD_AMT = 0
      ,A.UPD_DT = SYSDATE
      ,A.UPD_USR_ID = 'HIT_INV_EDI'
 	  ,A.LOCL_UPD_DT = GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC((SELECT OFC_CD FROM MDM_VENDOR WHERE VNDR_SEQ = @[inv_vndr_seq]))  
 WHERE A.TRSP_SO_OFC_CTY_CD = @[trsp_so_ofc_cty_cd]
   AND A.TRSP_SO_SEQ = @[trsp_so_seq]
   AND A.INV_NO IS NULL
   AND A.DELT_FLG = 'N'			]]></sql>
			<params>
				<param name="inv_no" type="12" value="" out="N"/>
				<param name="inv_vndr_seq" type="12" value="" out="N"/>
				<param name="inv_curr_cd" type="12" value="" out="N"/>
				<param name="trsp_inv_calc_lgc_tp_cd" type="12" value="" out="N"/>
				<param name="inv_xch_rt" type="12" value="" out="N"/>
				<param name="trsp_inv_act_sts_cd" type="12" value="" out="N"/>
				<param name="trsp_so_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="trsp_so_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
