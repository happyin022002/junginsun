<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CopDetailReceiveDBDAOSearchCopDetailNotInCrntRSQL">
			<desc><![CDATA[SearchCopDetailNotInCrnt]]></desc>
			<sql><![CDATA[
SELECT A.COP_NO             v_cop_no
      ,A.COP_DTL_SEQ        v_cop_dtl_seq
      ,A.NOD_CD             v_cop_nod_cd
      ,A.ACT_STS_CD         v_cop_act_sts_cd
      ,B.ACT_RCV_TP_CD      v_act_rcv_tp_cd
      ,B.ACT_STS_MAPG_CD    v_cop_act_sts_mapg_cd
      ,A.VSL_CD             v_vsl_cd
      ,A.SKD_VOY_NO         v_skd_voy_no
      ,A.SKD_DIR_CD         v_skd_dir_cd
      ,A.STND_EDI_STS_CD    v_act_stnd_edi_sts_cd
      ,A.ACT_STS_CD         v_act_sts_cd
      ,A.ACT_CD             v_act_cd
      ,( CASE WHEN @[IN_MVMT_STS_CD] = 'VL' AND (A.VSL_CD, A.SKD_VOY_NO, A.SKD_DIR_CD) IN ( (@[IN_CRNT_VSL_CD], @[IN_CRNT_SKD_VOY_NO], @[IN_CRNT_SKD_DIR_CD])) 
                    AND ACT_STS_CD = 'C' THEN '1' 
                WHEN @[IN_MVMT_STS_CD] = 'VL' AND (A.VSL_CD, A.SKD_VOY_NO, A.SKD_DIR_CD) IN ( (@[IN_CRNT_VSL_CD], @[IN_CRNT_SKD_VOY_NO], @[IN_CRNT_SKD_DIR_CD])) 
                    AND ACT_STS_CD != 'C' THEN '2'
                WHEN @[IN_MVMT_STS_CD] = 'VL' AND (A.VSL_CD, A.SKD_VOY_NO, A.SKD_DIR_CD) NOT IN ( (@[IN_CRNT_VSL_CD], @[IN_CRNT_SKD_VOY_NO], @[IN_CRNT_SKD_DIR_CD])) 
                    AND ACT_STS_CD = 'C' THEN '3' 
                WHEN @[IN_MVMT_STS_CD] = 'VL' AND (A.VSL_CD, A.SKD_VOY_NO, A.SKD_DIR_CD) NOT IN ( (@[IN_CRNT_VSL_CD], @[IN_CRNT_SKD_VOY_NO], @[IN_CRNT_SKD_DIR_CD])) 
                    AND ACT_STS_CD != 'C' THEN '4' 
                WHEN ((@[IN_MVMT_STS_CD] = 'VL' AND @[IN_CRNT_VSL_CD] = '' AND @[IN_CRNT_SKD_VOY_NO] = '' AND @[IN_CRNT_SKD_DIR_CD] = '') OR @[IN_MVMT_STS_CD] != 'VL')
                    AND ACT_STS_CD = 'C' THEN '5' 
                WHEN ((@[IN_MVMT_STS_CD] = 'VL' AND @[IN_CRNT_VSL_CD] = '' AND @[IN_CRNT_SKD_VOY_NO] = '' AND @[IN_CRNT_SKD_DIR_CD] = '') OR @[IN_MVMT_STS_CD] != 'VL')
                    AND ACT_STS_CD != 'C' THEN '6'                     
          ELSE '7' END )  v_chklvl
FROM   SCE_COP_DTL A
      ,SCE_ACT_ACT_MAPG B
WHERE  A.COP_NO          = @[IN_COP_NO]

AND    CASE WHEN @[IN_MVMT_STS_CD] = 'VL' AND (A.VSL_CD, A.SKD_VOY_NO, A.SKD_DIR_CD) IN ( (@[IN_CRNT_VSL_CD], @[IN_CRNT_SKD_VOY_NO], @[IN_CRNT_SKD_DIR_CD])) THEN 'TRUE'
        WHEN @[IN_MVMT_STS_CD] != 'VL' THEN 'TRUE'
        ELSE 'FALSE' END = 'TRUE'
AND    (
           (DECODE(  B.ACT_STS_MAPG_CD, 'VL', SUBSTR(A.NOD_CD, 1, 5), 
                                   'VD', SUBSTR(A.NOD_CD, 1, 5), 
                                   'AL', SUBSTR(A.NOD_CD, 1, 5), 
                                   'UR', SUBSTR(A.NOD_CD, 1, 5),
                                   'AR', DECODE(SUBSTR(A.NOD_CD,1,2),'US',SUBSTR(A.NOD_CD, 1, 5),'CA',SUBSTR(A.NOD_CD, 1, 5), A.NOD_CD),
                                   'RL', DECODE(SUBSTR(A.NOD_CD,1,2),'US',SUBSTR(A.NOD_CD, 1, 5),'CA',SUBSTR(A.NOD_CD, 1, 5), A.NOD_CD), 
                                   A.NOD_CD)         
                = DECODE(@[IN_MVMT_STS_CD], 
                                   'VL', SUBSTR(@[IN_ORG_YD_CD], 1, 5), 
                                   'VD', SUBSTR(@[IN_ORG_YD_CD], 1, 5), 
                                   'AL', SUBSTR(@[IN_ORG_YD_CD], 1, 5), 
                                   'UR', SUBSTR(@[IN_ORG_YD_CD], 1, 5), 
                                   'AR', DECODE(SUBSTR(@[IN_ORG_YD_CD],1,2),'US',SUBSTR(@[IN_ORG_YD_CD], 1, 5),'CA',SUBSTR(A.NOD_CD, 1, 5), @[IN_ORG_YD_CD]), 
                                   'RL', DECODE(SUBSTR(@[IN_ORG_YD_CD],1,2),'US',SUBSTR(@[IN_ORG_YD_CD], 1, 5),'CA',SUBSTR(A.NOD_CD, 1, 5), @[IN_ORG_YD_CD]),
                                   @[IN_ORG_YD_CD])
             ) OR
             (
                A.COP_DTL_SEQ > 6000 
                AND 
                ( 
                    DECODE(B.ACT_STS_MAPG_CD, 'IC', SUBSTR(A.NOD_CD, 1, 5),
                                              'ID', SUBSTR(A.NOD_CD, 1, 5), 
                                              'EN', SUBSTR(A.NOD_CD, 1, 5),
                                              'TN', SUBSTR(A.NOD_CD, 1, 5), A.NOD_CD )
                  = DECODE(:IN_MVMT_STS_CD, 'IC', SUBSTR(@[IN_ORG_YD_CD], 1, 5), 
                                              'ID', SUBSTR(@[IN_ORG_YD_CD], 1, 5), 
                                              'EN', SUBSTR(@[IN_ORG_YD_CD], 1, 5),
                                              'TN', SUBSTR(@[IN_ORG_YD_CD], 1, 5), @[IN_ORG_YD_CD])
                )
             )
        ) 
AND    A.ACT_CD          = B.ACT_CD
AND    B.ACT_RCV_TP_CD   = @[P_ACT_RCV_TP_CD]
AND    B.ACT_STS_MAPG_CD = @[in_mvmt_sts_cd]
ORDER BY v_chklvl, A.COP_DTL_SEQ			]]></sql>
			<params>
				<param name="IN_MVMT_STS_CD" type="12" value="" out="N"/>
				<param name="IN_CRNT_VSL_CD" type="12" value="" out="N"/>
				<param name="IN_CRNT_SKD_VOY_NO" type="12" value="" out="N"/>
				<param name="IN_CRNT_SKD_DIR_CD" type="12" value="" out="N"/>
				<param name="IN_COP_NO" type="12" value="" out="N"/>
				<param name="IN_ORG_YD_CD" type="12" value="" out="N"/>
				<param name="P_ACT_RCV_TP_CD" type="12" value="" out="N"/>
				<param name="in_mvmt_sts_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
