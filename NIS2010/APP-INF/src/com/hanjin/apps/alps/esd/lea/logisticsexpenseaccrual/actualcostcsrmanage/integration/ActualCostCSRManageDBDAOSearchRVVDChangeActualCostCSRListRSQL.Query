<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ActualCostCSRManageDBDAOSearchRVVDChangeActualCostCSRListRSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
SELECT  CSR_NO,
        INV_SYS_ID,
        BKG_NO,
        OLD_VVD_CD,
        NEW_VVD_CD,
        OLD_REV_YRMON,
        NEW_REV_YRMON,
        MODI_CSR_CRE_FLG,
        ERP_IF_FLG,
        LEA_IF_FLG,
        MODI_CSR_NO,
        EXE_YRMON,
        OLD_VSL_CD,
        OLD_SKD_VOY_NO,
        OLD_SKD_DIR_CD,
        OLD_REV_DIR_CD,
        NEW_VSL_CD,
        NEW_SKD_VOY_NO,
        NEW_SKD_DIR_CD,
        NEW_REV_DIR_CD
FROM    (SELECT ROW_NUMBER() OVER (ORDER BY L.CSR_NO ASC) NO,
                L.CSR_NO,
                L.INV_SYS_ID,
                L.BKG_NO,
                L.OLD_VSL_CD||L.OLD_SKD_VOY_NO||L.OLD_SKD_DIR_CD||L.OLD_REV_DIR_CD AS OLD_VVD_CD,
                L.NEW_VSL_CD||L.NEW_SKD_VOY_NO||L.NEW_SKD_DIR_CD||L.NEW_REV_DIR_CD AS NEW_VVD_CD,
                L.OLD_REV_YRMON,
                L.NEW_REV_YRMON,
                NVL(L.MODI_CSR_CRE_FLG, 'N') AS MODI_CSR_CRE_FLG,
                NVL(H.IF_FLG, 'N') AS ERP_IF_FLG,
                NVL(L.LEA_IF_FLG, 'N') AS LEA_IF_FLG,
                L.MODI_CSR_NO,
                L.EXE_YRMON,
                L.OLD_VSL_CD,
                L.OLD_SKD_VOY_NO,
                L.OLD_SKD_DIR_CD,
                L.OLD_REV_DIR_CD,
                L.NEW_VSL_CD,
                L.NEW_SKD_VOY_NO,
                L.NEW_SKD_DIR_CD,
                L.NEW_REV_DIR_CD
        FROM    LEA_REV_VVD_CNG L, AP_INV_HDR H
        WHERE   EXE_YRMON = REPLACE(@[frm_exe_yrmon],'-','')
        AND     H.CSR_NO(+) = L.MODI_CSR_NO

		--   DECODE(ERP_IF_FLG, 'Y', DECODE(SUBSTR(h.estm_err_rsn, 1, 3), 'LEA', 'N', 'Y'), 'N') as lea_if_flg
		--  : AP_INV_HDR.ESTM_ERR_RSN 컬럼에 TRS,TES시스템에서 LEA로 해당 CSR I/F 시 실패할 경우 LEA 문자열(처음3글자)을 남김
		--     LEA문자열이 존재하면 I/F 실패, 문자열이 없으면 I/F 성공!! => TES, TRS 에서 성공후 Y 로 UPDATE (2008225)

		#if (${frm_csr_no} != '') 
		AND L.CSR_NO = @[frm_csr_no]
		#end

		#if (${frm_bkg_no} != '') 
		AND L.BKG_NO = @[frm_bkg_no]
		#end
		)			]]></sql>
			<params>
				<param name="frm_exe_yrmon" type="12" value="" out="N"/>
				<param name="frm_csr_no" type="12" value="" out="N"/>
				<param name="frm_bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
