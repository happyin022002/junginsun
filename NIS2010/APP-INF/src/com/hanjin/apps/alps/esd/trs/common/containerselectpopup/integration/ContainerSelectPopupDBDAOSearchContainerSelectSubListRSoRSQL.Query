<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ContainerSelectPopupDBDAOSearchContainerSelectSubListRSoRSQL">
			<desc><![CDATA[S/O 번호 조회
2011.04.05 김영철 [CHM-201109654-01] Frustrate 처리된 CNTR 에 대해 두번이상 S/O 가 난 건들의 Invoice 처리 가능하도록 수정요청 ( TRO_SEQ을 조건문에 추가 )]]></desc>
			<sql><![CDATA[
SELECT                                                      
      A.TRSP_SO_OFC_CTY_CD || A.TRSP_SO_SEQ AS APPLY_SO_SEQ  
 FROM                                                        
      TRS_TRSP_SVC_ORD A 
 ,    BKG_BOOKING B                                    
 WHERE
 (
     B.BKG_NO                 = @[bkgNo]                                                                                                            
  OR B.FM_BKG_NO              = @[bkgNo]
 )
 AND A.BKG_NO                 = B.BKG_NO
 AND A.EQ_NO                  = @[eqNo]
 AND NVL2(TO_NUMBER(@[troSeq]),A.TRO_SEQ,0) = NVL(@[troSeq],0)
 AND SUBSTR(A.COST_ACT_GRP_CD,1,2)     = 'OD'
 AND DELT_FLG                 = 'N'
UNION
SELECT                                                      
      A.TRSP_SO_OFC_CTY_CD || A.TRSP_SO_SEQ AS APPLY_SO_SEQ  
 FROM                                                        
      TRS_TRSP_SVC_ORD A 
 ,    BKG_BOOKING B                                    
 WHERE
 (
     B.BKG_NO                 = @[bkgNo]                                                                                                            
  OR B.FM_BKG_NO              = @[bkgNo]
 )
 AND A.ORG_BKG_NO             = B.BKG_NO
 AND A.EQ_NO                  = @[eqNo]
 AND NVL2(TO_NUMBER(@[troSeq]),A.TRO_SEQ,0) = NVL(@[troSeq],0)
 AND SUBSTR(A.COST_ACT_GRP_CD,1,2)     = 'OD'
 AND DELT_FLG                 = 'N'
UNION

SELECT                                                      
      A.TRSP_SO_OFC_CTY_CD || A.TRSP_SO_SEQ AS APPLY_SO_SEQ  
 FROM                                                        
      TRS_TRSP_SVC_ORD A 
 ,    BKG_BOOKING B                                    
 WHERE
 (
     B.BKG_NO                 = @[bkgNo]                                                                                                            
  OR B.BKG_NO IN (SELECT X.BKG_NO
                    FROM BKG_BOOKING X
                        ,BKG_BOOKING Y
                   WHERE X.TO_BKG_NO = Y.TO_BKG_NO
                     AND Y.BKG_NO = @[bkgNo]
                     AND X.BKG_STS_CD = 'X'
                     AND Y.BKG_STS_CD = 'X' 
                     AND X.TO_BKG_NO IS NOT NULL
                     AND Y.TO_BKG_NO IS NOT NULL
                  UNION
                  SELECT DISTINCT X.TO_BKG_NO
                    FROM BKG_BOOKING X
                        ,BKG_BOOKING Y
                   WHERE X.TO_BKG_NO = Y.TO_BKG_NO
                     AND Y.BKG_NO = @[bkgNo]
                     AND X.BKG_STS_CD = 'X'
                     AND Y.BKG_STS_CD = 'X' 
                     AND X.TO_BKG_NO IS NOT NULL
                     AND Y.TO_BKG_NO IS NOT NULL
                  )
 )
 AND A.BKG_NO                 = B.BKG_NO
 AND A.EQ_NO                  = @[eqNo]
 AND NVL2(TO_NUMBER(@[troSeq]),A.TRO_SEQ,0) = NVL(@[troSeq],0)
 AND SUBSTR(A.COST_ACT_GRP_CD,1,2)     = 'OD'
 AND DELT_FLG                 = 'N'

			]]></sql>
			<params>
				<param name="bkgNo" type="12" value="" out="N"/>
				<param name="eqNo" type="12" value="" out="N"/>
				<param name="troSeq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
