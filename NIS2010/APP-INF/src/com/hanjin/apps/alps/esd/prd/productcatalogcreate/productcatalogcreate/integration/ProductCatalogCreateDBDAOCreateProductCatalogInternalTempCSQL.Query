<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ProductCatalogCreateDBDAOCreateProductCatalogInternalTempCSQL">
			<desc><![CDATA[CreateProductCatalogInternalTemp]]></desc>
			<sql><![CDATA[
INSERT ALL
WHEN PCTL_SEQ =1 THEN
    INTO PRD_PROD_CTL_MST
    (PCTL_NO, MTY_PKUP_YD_CD, POR_CD, POR_NOD_CD, POL_CD, N1ST_TS_PORT_CD, N2ND_TS_PORT_CD, N3RD_TS_PORT_CD,
    POD_CD, DEL_CD, DEL_NOD_CD, MTY_RTN_YD_CD, OB_ITCHG_CTNT, IB_ITCHG_CTNT,
    N1ST_VSL_LODG_DUE_DT,BKG_RCV_TERM_CD, BKG_DE_TERM_CD,  CMDT_CD, BKG_OFC_CD,  SC_OFC_CD,CRE_USR_ID, CRE_DT,UPD_USR_ID, UPD_DT,
    DG_SPCL_FLG,RF_SPCL_FLG,SPCL_AWK_CGO_FLG,BB_SPCL_FLG,SOC_FLG

    )
    VALUES
    (PCTL_NO,MTPU_CY,@[por] , POR,@[pol] ,N2ND_POL_CD, N3RD_POL_CD,N4TH_POL_CD,
    @[pod],@[del],DEL,MTRTN_CY,OUT_CONTENT,IN_CONTENT,
    TO_DATE(@[skd_date],'YYYYMMDD') ,@[rTerm], @[dTerm],@[com],@[bkgOffCd],@[sc_ofc],NVL(@[user_id],'System'), CRE_DT,NVL(@[user_id],'System'), UPD_DT,
    @[dg_spcl_flg],@[rf_spcl_flg],@[spcl_awk_cgo_flg],@[bb_spcl_flg],@[soc_flg]
    )
WHEN PCTL_SEQ > 0 THEN
    INTO PRD_PROD_CTL_ROUT_DTL
    ( PCTL_NO, PCTL_SEQ, ORG_NOD_CD, DEST_NOD_CD, NOD_LNK_DIV_CD, PCTL_IO_BND_CD, TRSP_MOD_CD,
    PCTL_WTR_DIV_CD, ORG_NOD_TP_CD, DEST_NOD_TP_CD, MTY_YD_FLG, ARR_ST_DT, DEP_FSH_DT, TZ_DWLL_TM_HRS,
    N1ST_VNDR_SEQ,N2ND_VNDR_SEQ, N3RD_VNDR_SEQ, VSL_SLAN_CD, CRR_CD, VSL_CD, SKD_VOY_NO,
    INLND_ROUT_CMB_FLG, INLND_ROUT_INV_BIL_PATT_CD, SKD_DIR_CD, ROUT_ORG_NOD_CD,  ROUT_DEST_NOD_CD,
    ROUT_SEQ, ORG_CLPT_IND_SEQ,DEST_CLPT_IND_SEQ,
    CRE_USR_ID, CRE_DT,UPD_USR_ID, UPD_DT ,
    RAIL_CRR_TP_CD,INLND_ROUT_INCL_STTL_FLG,TRSP_AGMT_OFC_CTY_CD,TRSP_AGMT_SEQ,AGMT_REF_NO )
    VALUES
    (PCTL_NO,PCTL_SEQ,NODE_NEW1,NODE_NEW2,NODE_NEW_KIND,OI_BND_CD,TRSP_MOD_CD,
    WTR_DIV_CD,NODE1_TP,NODE2_TP,MT_YD_FLG,A_TIME,D_TIME,TZTM_DW_HRS,
    N1ST_VNDR_SEQ,N2ND_VNDR_SEQ,N3RD_VNDR_SEQ,SLANE,CRR_CD,VSL_CD,VOY_NO,
    INLND_ROUT_CMB_FLG,INLND_ROUT_INV_BIL_PATT_CD,DIR_CD,ROUT_ORG,ROUT_DEST,
    ROUT_SEQ,ORG_PORT_SEQ,DST_PORT_SEQ,
    NVL(@[user_id],'System'), CRE_DT,NVL(@[user_id],'System'), UPD_DT,
    RAIL_CRR_TYPE,INLND_ROUT_INCL_STTL_FLG,TRSP_AGMT_OFC_CTY_CD,TRSP_AGMT_SEQ,AGMT_REF_NO)
SELECT
@[prdCtlNo]	||lpad(gp1,4,0) pctl_no, ord pctl_seq,
NODE_NEW1,NODE_NEW2,NODE_NEW_KIND,OI_BND_CD, DECODE(NODE_NEW_KIND,'L',substr(trsp_mod_cd,1,2),'X') trsp_mod_cd,
decode(trsp_mod_cd,'WD','W','VD','V') WTR_DIV_CD,
NODE1_TP,NODE2_TP,OUT_CONTENT,IN_CONTENT,MTPU_CY,MTRTN_CY,POR,DEL,N2ND_POL_CD, N3RD_POL_CD,N4TH_POL_CD,
(
CASE
WHEN F_NO2 = 0  AND NODE_NEW_KIND = 'N' AND @[rTerm] <> 'S' THEN 'Y'
WHEN F_NO2 = 33 AND NODE_NEW_KIND = 'N' AND @[dTerm] <> 'S' THEN 'Y'
ELSE 'N' END
)
MT_YD_FLG,
(CASE WHEN A_TIME IS NOT NULL THEN A_TIME
      WHEN F_NO2 = 13  THEN TO_DATE(CCT,'YYYYMMDDHH24MISS') -(SUM(TZTM_DW_HRS) OVER (PARTITION BY GP1,OI_BND_CD ORDER BY ORD DESC  ) /24) +TZTM_DW_HRS/24
      WHEN F_NO2 < 13  THEN TO_DATE(CCT,'YYYYMMDDHH24MISS') -(SUM(TZTM_DW_HRS) OVER (PARTITION BY GP1,OI_BND_CD ORDER BY ORD DESC  ) /24)  + DECODE(@[pm_f],'Y',3, 6)/24
      WHEN F_NO2 >= 20  THEN TO_DATE(POD_T,'YYYYMMDDHH24MISS') +(SUM(TZTM_DW_HRS) OVER (PARTITION BY GP1,OI_BND_CD ORDER BY ORD  ) /24) -TZTM_DW_HRS/24
END)
A_TIME,
(CASE WHEN D_TIME IS NOT NULL THEN D_TIME
      WHEN F_NO2 = 13 THEN TO_DATE(CCT,'YYYYMMDDHH24MISS') -(SUM(TZTM_DW_HRS) OVER (PARTITION BY GP1,OI_BND_CD ORDER BY ORD DESC  ) /24) +TZTM_DW_HRS/24
      WHEN F_NO2 < 13 THEN TO_DATE(CCT,'YYYYMMDDHH24MISS') -(SUM(TZTM_DW_HRS) OVER (PARTITION BY GP1,OI_BND_CD ORDER BY ORD DESC  ) /24) +TZTM_DW_HRS/24 + DECODE(@[pm_f],'Y',3, 6)/24
      WHEN F_NO2 >= 20 THEN TO_DATE(POD_T,'YYYYMMDDHH24MISS') +(SUM(TZTM_DW_HRS) OVER (PARTITION BY GP1,OI_BND_CD ORDER BY ORD  ) /24)
END)
D_TIME,
ROUND((
    (CASE WHEN D_TIME IS NOT NULL THEN D_TIME
          WHEN F_NO2 = 13 THEN TO_DATE(CCT,'YYYYMMDDHH24MISS') -(SUM(TZTM_DW_HRS) OVER (PARTITION BY GP1,OI_BND_CD ORDER BY ORD DESC  ) /24) +TZTM_DW_HRS/24
          WHEN F_NO2 < 13 THEN TO_DATE(CCT,'YYYYMMDDHH24MISS') -(SUM(TZTM_DW_HRS) OVER (PARTITION BY GP1,OI_BND_CD ORDER BY ORD DESC  ) /24) +TZTM_DW_HRS/24 + DECODE(@[pm_f],'Y',3, 6)/24
          WHEN F_NO2 >= 20 THEN TO_DATE(POD_T,'YYYYMMDDHH24MISS') +(SUM(TZTM_DW_HRS) OVER (PARTITION BY GP1,OI_BND_CD ORDER BY ORD  ) /24)
    END)  -
    (CASE WHEN A_TIME IS NOT NULL THEN A_TIME
          WHEN F_NO2 = 13  THEN TO_DATE(CCT,'YYYYMMDDHH24MISS') -(SUM(TZTM_DW_HRS) OVER (PARTITION BY GP1,OI_BND_CD ORDER BY ORD DESC  ) /24) +TZTM_DW_HRS/24
          WHEN F_NO2 < 13  THEN TO_DATE(CCT,'YYYYMMDDHH24MISS') -(SUM(TZTM_DW_HRS) OVER (PARTITION BY GP1,OI_BND_CD ORDER BY ORD DESC  ) /24)  + DECODE(@[pm_f],'Y',3, 6)/24
          WHEN F_NO2 >= 20  THEN TO_DATE(POD_T,'YYYYMMDDHH24MISS') +(SUM(TZTM_DW_HRS) OVER (PARTITION BY GP1,OI_BND_CD ORDER BY ORD  ) /24) -TZTM_DW_HRS/24
    END)
) *24)
TZTM_DW_HRS ,
(CASE WHEN NODE_NEW_KIND = 'N' THEN N1ST_VNDR_SEQ
      WHEN NODE_NEW_KIND = 'L' AND F_NO2 =0 AND @[rTerm] = 'D' THEN
        LEAD(N1ST_VNDR_SEQ, 1) OVER ( PARTITION BY GP1,NODE_NEW_KIND ORDER BY F_NO2,L_N0)
      WHEN NODE_NEW_KIND = 'L' AND F_NO2 =32 AND @[dTerm] = 'D' THEN
        LAG(N1ST_VNDR_SEQ, 1) OVER ( PARTITION BY GP1,NODE_NEW_KIND ORDER BY F_NO2,L_N0)
      ELSE N1ST_VNDR_SEQ
END
) N1ST_VNDR_SEQ,
N2ND_VNDR_SEQ,N3RD_VNDR_SEQ,SLANE,
CRR_CD,
VSL_CD,
VOY_NO,
DIR_CD,
ORG_PORT_SEQ,
DST_PORT_SEQ,
INLND_ROUT_CMB_FLG,TRIM(INLND_ROUT_INV_BIL_PATT_CD) INLND_ROUT_INV_BIL_PATT_CD,
ROUT_ORG,ROUT_DEST,ROUT_SEQ,
 @[ag_seq] COST_ACT_GRP_SEQ ,  @[user_id] CRE_USR_ID, sysdate CRE_DT , @[update_id] UPD_USR_ID, sysdate UPD_DT,
TRIM(RAIL_CRR_TYPE) RAIL_CRR_TYPE , TRIM(INLND_ROUT_INCL_STTL_FLG) INLND_ROUT_INCL_STTL_FLG,
TRIM(TRSP_AGMT_OFC_CTY_CD) TRSP_AGMT_OFC_CTY_CD, TRIM(TRSP_AGMT_SEQ) TRSP_AGMT_SEQ, TRIM(AGMT_REF_NO) AGMT_REF_NO
FROM
(
    SELECT
     GP1,F_NO2,L_N0,O1,ROW_NUMBER() over (PARTITION BY GP1 ORDER BY F_NO2,L_N0,O1) ord,
     NODE_NEW1,
     NVL((SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD = NODE_NEW1), (SELECT 'Y' FROM MDM_LSE_CO_YD WHERE LSE_CO_YD_CD = NODE_NEW1 AND F_NO2 = 42)) NODE1_TP,
     DECODE(LENGTH(NODE_NEW2),7,NODE_NEW2,SUBSTR(NODE_NEW2,3,7))  NODE_NEW2,
     NVL((SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD = DECODE(LENGTH(NODE_NEW2),7,NODE_NEW2,SUBSTR(NODE_NEW2,3,7)))
        ,(SELECT 'Y' FROM MDM_LSE_CO_YD WHERE LSE_CO_YD_CD = DECODE(LENGTH(NODE_NEW2),7,NODE_NEW2,SUBSTR(NODE_NEW2,3,7)) AND F_NO2 IN (41,42) )) NODE2_TP,
     NODE_NEW_KIND,OI_BND_CD,OUT_CONTENT,IN_CONTENT, MTPU_CY,MTRTN_CY,OB_ORG POR,IB_DEST DEL,N2ND_POL_CD, N3RD_POL_CD,N4TH_POL_CD,CCT,
    (CASE
        WHEN NODE_NEW_KIND='L' AND F_NO2 IN ( 0,32) THEN 'TD'
        WHEN NODE_NEW_KIND='L' AND F_NO2 = 1 AND @[rTerm] ='S' AND OB_SEQ= 0 THEN 'TD'
        WHEN NODE_NEW_KIND='L' AND F_NO2 = 20 AND @[dTerm] IN ('S','T','F','Y') AND IB_SEQ= 0 THEN 'TD'
        WHEN NODE_NEW_KIND='L' AND F_NO2 IN (13,15,17,19) THEN
        (
            SELECT DECODE(VSL_SVC_TP_CD, 'O', 'WD', 'VD')
            FROM MDM_VSL_SVC_LANE
            WHERE VSL_SLAN_CD = DECODE(F_NO2,13,N1ST_LANE_CD,15,N2ND_LANE_CD,17,N3RD_LANE_CD,19,N4TH_LANE_CD)
        )
       WHEN NODE_NEW_KIND='L' AND LENGTH(NODE_NEW2) > 7 THEN SUBSTR(NODE_NEW2,10,2)
       ELSE
        NVL((
           SELECT /*+ INDEX (M2 XAK1PRD_INLND_ROUT_MST) */
           D2.TRSP_MOD_CD
           FROM PRD_INLND_ROUT_MST M2, PRD_INLND_ROUT_DTL D2
           WHERE
               M2.ROUT_ORG_NOD_CD = NODE_NEW1
           AND M2.ROUT_DEST_NOD_CD = NODE_NEW2
           AND M2.ROUT_ORG_NOD_CD = D2.ROUT_ORG_NOD_CD
           AND M2.ROUT_DEST_NOD_CD = D2.ROUT_DEST_NOD_CD
           AND M2.ROUT_SEQ = D2.ROUT_SEQ
           AND M2.PCTL_IO_BND_CD = 'B'
           AND NVL(M2.DELT_FLG,'N') <> 'Y'
           AND D2.LNK_ORG_NOD_CD = NODE_NEW1
           AND D2.LNK_DEST_NOD_CD = NODE_NEW2
           AND D2.ROUT_DTL_SEQ = 1
           AND 'Y' = DECODE(NVL(M2.INLND_ROUT_BKG_FLG, 'N'), 'N', 'N', DECODE(NVL(M2.INLND_ROUT_TMP_FLG, 'N'), 'N', 'Y', 'N'))
           AND ROWNUM = 1
           ) , 'TD')
    END) trsp_mod_cd,
    (CASE
        WHEN NODE_NEW_KIND='N' AND F_NO2 IN (1,32) AND (SELECT NOD_TP_CD FROM PRD_NODE
                                                        WHERE NOD_CD = NODE_NEW1) = 'Z' THEN
        (
            SELECT CGO_HNDL_TM_HRS FROM MDM_ZONE WHERE ZN_CD = NODE_NEW1
        )
        WHEN NODE_NEW_KIND='N' AND F_NO2 = 1 AND @[rTerm] ='S' AND OB_SEQ = 0 AND
            (SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD = NODE_NEW1) <> 'Z' THEN
        0
        WHEN NODE_NEW_KIND='N' AND F_NO2 = 32 AND @[dTerm] ='S' AND IB_SEQ = 0 AND
            (SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD = NODE_NEW1) <> 'Z' THEN
        0
        WHEN NODE_NEW_KIND='N' AND (SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD = NODE_NEW1) <> 'Z' THEN
        (
            SELECT DECODE(F_NO2,33,0,DECODE(F_NO2,0,0,DECODE(OI_BND_CD, 'T', 0, DECODE(@[pm_f],'Y',
                                           3, 6)))) FROM DUAL
        )
        WHEN  NODE_NEW_KIND='L' AND @[rTerm] = 'D' AND F_NO2 = 0   THEN
        (SELECT TZTM_HRS FROM MDM_ZONE WHERE ZN_CD = NODE_NEW2 )
        WHEN  NODE_NEW_KIND='L' AND @[dTerm] = 'D' AND F_NO2 = 32  THEN
        (SELECT TZTM_HRS FROM MDM_ZONE WHERE ZN_CD = NODE_NEW1 )
        WHEN  NODE_NEW_KIND='L' AND @[rTerm] =  'S' AND F_NO2 = 0   THEN 6
        WHEN  NODE_NEW_KIND='L' AND @[rTerm] =  'S' AND F_NO2 = 1  AND OB_SEQ = 0 THEN 6
        WHEN  NODE_NEW_KIND='L' AND @[dTerm] =  'S' AND F_NO2 = 32   THEN 6
        WHEN  NODE_NEW_KIND='L' AND @[dTerm] =  'S' AND F_NO2 = 20 AND IB_SEQ = 0 THEN 6
        WHEN  NODE_NEW_KIND='L' AND @[rTerm] NOT IN ( 'D','S' ) AND F_NO2 = 0   THEN 24
        WHEN  NODE_NEW_KIND='L' AND @[dTerm] NOT IN ( 'D','S' ) AND F_NO2 = 32  THEN 24
        WHEN (F_NO2 =13 ) AND (NODE_NEW_KIND='L') THEN N1ST_TZTM_HRS
        WHEN (F_NO2 =15 ) AND (NODE_NEW_KIND='L') THEN N2ND_TZTM_HRS
        WHEN (F_NO2 =17 ) AND (NODE_NEW_KIND='L') THEN N3RD_TZTM_HRS
        WHEN (F_NO2 =19 ) AND (NODE_NEW_KIND='L') THEN N4TH_TZTM_HRS
        WHEN NODE_NEW_KIND='L' AND OI_BND_CD ='T' AND F_NO2 NOT IN (13,15,17,19) THEN 6
        ELSE
         (SELECT TZTM_HRS
            FROM PRD_INLND_EACH_LNK
           WHERE lnk_org_nod_cd = NODE_NEW1
            AND lnk_dest_nod_cd = DECODE(LENGTH(NODE_NEW2),7,NODE_NEW2,SUBSTR(NODE_NEW2,3,7))
            AND TRSP_MOD_CD = DECODE(LENGTH(NODE_NEW2),7,'TD',SUBSTR(NODE_NEW2,10,2))
            )
    END ) TZTM_DW_HRS,
    POLT1 POL_T,
    SUBSTR(TRIM(PODT1||PODT2||PODT3||PODT4),-14) POD_T ,
    A_TIME,
    D_TIME,
    ( CASE
        WHEN NODE_NEW_KIND='N' THEN
        (
            SELECT TO_CHAR(N1ST_VNDR_SEQ)
            FROM MDM_YARD
            WHERE YD_CD = NODE_NEW1
        )
        WHEN NODE_NEW_KIND='L' AND F_NO2 IN (13,15,17,19) THEN
        (
            SELECT TO_CHAR(VNDR_SEQ)
            FROM PRD_FDR_LNK
            WHERE VSL_SLAN_CD =DECODE(F_NO2,13,N1ST_LANE_CD,15,N2ND_LANE_CD,17,N3RD_LANE_CD,19,N4TH_LANE_CD)
            AND LNK_ORG_LOC_CD = SUBSTR(NODE_NEW1,1,5)
            AND LNK_DEST_LOC_CD = DECODE(LENGTH(NODE_NEW2),7,SUBSTR(NODE_NEW2,1,5),SUBSTR(NODE_NEW2,3,5))
        )
        WHEN NODE_NEW_KIND='L' AND LENGTH(NODE_NEW2) > 7 THEN DECODE(SUBSTR(NODE_NEW2,12,6),'N','',SUBSTR(NODE_NEW2,12,6))
        ELSE
           (
           SELECT /*+ INDEX (M2 XAK1PRD_INLND_ROUT_MST) */
           TO_CHAR(D2.VNDR_SEQ)
           FROM PRD_INLND_ROUT_MST M2, PRD_INLND_ROUT_DTL D2
           WHERE
               M2.ROUT_ORG_NOD_CD = NODE_NEW1
           AND M2.ROUT_DEST_NOD_CD = NODE_NEW2
           AND M2.ROUT_ORG_NOD_CD = D2.ROUT_ORG_NOD_CD
           AND M2.ROUT_DEST_NOD_CD = D2.ROUT_DEST_NOD_CD
           AND M2.ROUT_SEQ = D2.ROUT_SEQ
           AND M2.PCTL_IO_BND_CD = 'B'
           AND NVL(M2.DELT_FLG,'N') <> 'Y'
           AND D2.LNK_ORG_NOD_CD = NODE_NEW1
           AND D2.LNK_DEST_NOD_CD = NODE_NEW2
           AND D2.ROUT_DTL_SEQ = 1
           AND 'Y' = DECODE(NVL(M2.INLND_ROUT_BKG_FLG, 'N'), 'N', 'N', DECODE(NVL(M2.INLND_ROUT_TMP_FLG, 'N'), 'N', 'Y', 'N'))
           AND ROWNUM = 1
            )
    END ) N1ST_VNDR_SEQ,
    ( CASE
        WHEN NODE_NEW_KIND='N' THEN
        (
            SELECT N2ND_VNDR_SEQ
            FROM MDM_YARD
            WHERE YD_CD = NODE_NEW1
        )
     END ) N2ND_VNDR_SEQ,
    ( CASE
        WHEN NODE_NEW_KIND='N' THEN
        (
            SELECT N3RD_VNDR_SEQ
            FROM MDM_YARD
            WHERE YD_CD = NODE_NEW1
        )
     END ) N3RD_VNDR_SEQ,
    (CASE
        WHEN (F_NO2 =13 ) AND (NODE_NEW_KIND='L') THEN N1ST_LANE_CD
        WHEN (F_NO2 =15 ) AND (NODE_NEW_KIND='L') THEN N2ND_LANE_CD
        WHEN (F_NO2 =17 ) AND (NODE_NEW_KIND='L') THEN N3RD_LANE_CD
        WHEN (F_NO2 =19 ) AND (NODE_NEW_KIND='L') THEN N4TH_LANE_CD
    END ) SLANE,
    ( CASE
        WHEN F_NO2 IN (13,15,17,19) AND (NODE_NEW_KIND='L') THEN
            SUBSTR(DECODE(F_NO2,13,VVD1,15,VVD2,17,VVD3,19,VVD4,NULL),1,4)
    END ) VSL_CD,
    ( CASE
        WHEN F_NO2 IN (13,15,17,19) AND (NODE_NEW_KIND='L') THEN
            SUBSTR(DECODE(F_NO2,13,VVD1,15,VVD2,17,VVD3,19,VVD4,NULL),5,4)
    END ) VOY_NO,
    ( CASE
        WHEN F_NO2 IN (13,15,17,19) AND (NODE_NEW_KIND='L') THEN
            SUBSTR(DECODE(F_NO2,13,VVD1,15,VVD2,17,VVD3,19,VVD4,NULL),9,1)
    END ) DIR_CD,
    ( CASE
        WHEN F_NO2 IN (13,15,17,19) AND (NODE_NEW_KIND='L') THEN
            DECODE(F_NO2,13,CRR1,15,CRR2,17,CRR3,19,CRR4,NULL)
    END ) CRR_CD,

    ( CASE
        WHEN F_NO2 IN (13,15,17,19) AND (NODE_NEW_KIND='L') THEN
            DECODE(F_NO2,13,POL_SEQ1,15,POL_SEQ2,17,POL_SEQ3,19,POL_SEQ4,NULL)
    END ) ORG_PORT_SEQ,
    ( CASE
        WHEN F_NO2 IN (13,15,17,19) AND (NODE_NEW_KIND='L') THEN
            DECODE(F_NO2,13,POD_SEQ1,15,POD_SEQ2,17,POD_SEQ3,19,POD_SEQ4,NULL)
    END ) DST_PORT_SEQ,
    DECODE(LENGTH(NODE_NEW2),7,'N',SUBSTR(NODE_NEW2,18,1))  INLND_ROUT_CMB_FLG,
    DECODE(LENGTH(NODE_NEW2),7,'',SUBSTR(NODE_NEW2,19,3))  INLND_ROUT_INV_BIL_PATT_CD,
    DECODE(LENGTH(NODE_NEW2),7,'',SUBSTR(NODE_NEW2,22,3))  RAIL_CRR_TYPE,
    DECODE(LENGTH(NODE_NEW2),7,'',SUBSTR(NODE_NEW2,25,3))  TRSP_AGMT_OFC_CTY_CD,
    DECODE(LENGTH(NODE_NEW2),7,'',SUBSTR(NODE_NEW2,28,6))  TRSP_AGMT_SEQ,
    DECODE(LENGTH(NODE_NEW2),7,'',SUBSTR(NODE_NEW2,34,15))  AGMT_REF_NO,
    DECODE(LENGTH(NODE_NEW2),7,'',SUBSTR(NODE_NEW2,49,1))  INLND_ROUT_INCL_STTL_FLG,
    DECODE(OI_BND_CD,'I',IB_ORG,'O',OB_ORG,'T',ORG_LOC_CD) ROUT_ORG,
    DECODE(OI_BND_CD,'I',IB_DEST,'O',OB_DEST,'T',DEST_LOC_CD) ROUT_DEST,
    DECODE(OI_BND_CD,'I',IB_SEQ,'O',OB_SEQ,'T',OCN_SEQ) ROUT_SEQ
    FROM (
        SELECT
        GP1,  F_N0 AS F_NO2, L_N0, O1,
        (CASE LENGTH(NODE1) WHEN 7 THEN NODE1 ELSE SUBSTR(NODE1,3,7)  END ) NODE_NEW1,
        (
         CASE WHEN L_N0 = 1 THEN NODE1
              WHEN L_N0 = 2 AND F_N0 =32 AND @[dTerm] = 'S' AND IB_SEQ =0 THEN ''
              WHEN L_N0 = 2 THEN LEAD(NODE1, 1, NULL) OVER (PARTITION BY GP1 ORDER BY GP1,F_N0,L_N0,O1)
         END
        ) NODE_NEW2,
        (CASE L_N0 WHEN 1 THEN 'N' WHEN 2 THEN 'L' END) NODE_NEW_KIND,
        ( CASE
            WHEN F_N0 IN (13,15,17,19) AND (L_N0=2) THEN
                TO_DATE(DECODE(F_N0,13,POLT1,15,POLT2,17,POLT3,19,POLT4,NULL),'YYYYMMDDHH24MISS')
            WHEN F_N0 IN (15,17,19) AND (L_N0=1) THEN
                TO_DATE(DECODE(F_N0,13,POLT1,15,POLT2,17,POLT3,19,POLT4,NULL),'YYYYMMDDHH24MISS') -6/24 --CCT???
            WHEN F_N0 IN (14,16,18) AND (L_N0=2) THEN
                TO_DATE(DECODE(F_N0,14,PODT1,16,PODT2,18,PODT3,NULL),'YYYYMMDDHH24MISS') + 6/24
            WHEN F_N0 IN (14,16,18) AND (L_N0=1) THEN
                TO_DATE(DECODE(F_N0,14,PODT1,16,PODT2,18,PODT3,NULL),'YYYYMMDDHH24MISS')
        END ) A_TIME,
        ( CASE
            WHEN F_N0 IN (13,15,17,19) AND (L_N0=2) THEN
                TO_DATE(DECODE(F_N0,13,PODT1,15,PODT2,17,PODT3,19,PODT4,NULL),'YYYYMMDDHH24MISS')
            WHEN F_N0 IN (15,17,19) AND (L_N0=1) THEN
                TO_DATE(DECODE(F_N0,13,POLT1,15,POLT2,17,POLT3,19,POLT4,NULL),'YYYYMMDDHH24MISS')
            WHEN F_N0 IN (14,16,18) AND (L_N0=2) THEN
                TO_DATE(DECODE(F_N0,14,PODT1,16,PODT2,18,PODT3,NULL),'YYYYMMDDHH24MISS') + 12/24
            WHEN F_N0 IN (14,16,18) AND (L_N0=1) THEN
                TO_DATE(DECODE(F_N0,14,PODT1,16,PODT2,18,PODT3,NULL),'YYYYMMDDHH24MISS') + 6/24
        END ) D_TIME,
        (
        CASE
            WHEN F_N0 <=12 OR (F_N0 = 13 AND L_N0 =1)  THEN 'O'
            WHEN F_N0 >= 20  THEN 'I' ELSE 'T'
        END
        ) OI_BND_CD,
        N1ST_LANE_CD,N2ND_LANE_CD,N3RD_LANE_CD,N4TH_LANE_CD,N2ND_POL_CD, N3RD_POL_CD,N4TH_POL_CD,CCT,
        POLT1,PODT1,VVD1,CRR1,POL_SEQ1,POD_SEQ1,
        POLT2,PODT2,VVD2,CRR2,POL_SEQ2,POD_SEQ2,
        POLT3,PODT3,VVD3,CRR3,POL_SEQ3,POD_SEQ3,
        POLT4,PODT4,VVD4,CRR4,POL_SEQ4,POD_SEQ4,
        N1ST_TZTM_HRS ,N2ND_TZTM_HRS ,N3RD_TZTM_HRS ,N4TH_TZTM_HRS,
        IB_ORG, IB_DEST,IB_SEQ,IN_CONTENT,MTRTN_CY,DEL,
        OB_ORG, OB_DEST,OB_SEQ,OUT_CONTENT,MTPU_CY,
        ORG_LOC_CD, DEST_LOC_CD, OCN_SEQ
        FROM (
            SELECT C_POL,F_N0, GP1,NODE1,ROWNUM O1,
            N1ST_LANE_CD,N2ND_LANE_CD,N3RD_LANE_CD,N4TH_LANE_CD,N2ND_POL_CD, N3RD_POL_CD,N4TH_POL_CD,
            N1ST_TZTM_HRS,N2ND_TZTM_HRS,N3RD_TZTM_HRS,N4TH_TZTM_HRS,CCT,
            POLT1,PODT1,VVD1,CRR1,POL_SEQ1,POD_SEQ1,
            POLT2,PODT2,VVD2,CRR2,POL_SEQ2,POD_SEQ2,
            POLT3,PODT3,VVD3,CRR3,POL_SEQ3,POD_SEQ3,
            POLT4,PODT4,VVD4,CRR4,POL_SEQ4,POD_SEQ4,
            IB_ORG, IB_DEST,IB_SEQ,IN_CONTENT,MTRTN_CY,DEL,
            OB_ORG, OB_DEST,OB_SEQ,OUT_CONTENT,MTPU_CY,
            ORG_LOC_CD, DEST_LOC_CD,OCN_SEQ
            FROM
            (
                SELECT
                GP1,F_N0,
                (
                CASE F_N0
                    WHEN 0 THEN MTPU_CY
                    WHEN 1 THEN DECODE(@[rTerm],'T','',DECODE(@[rTerm],'F','',DECODE(@[por],@[pol],DECODE(OB_SEQ,0,DECODE(@[rTerm],'D',OB_ORG,'S',OB_ORG,''),OB_ORG),OB_ORG)))
                    WHEN 2 THEN OL_NODE01   WHEN 3 THEN OL_NODE02   WHEN 4 THEN OL_NODE03   WHEN 5 THEN OL_NODE04
                    WHEN 6 THEN OL_NODE05   WHEN 7 THEN OL_NODE06   WHEN 8 THEN OL_NODE07   WHEN 9 THEN OL_NODE08
                    WHEN 10 THEN OL_NODE09  WHEN 11 THEN OL_NODE10  WHEN 12 THEN NULL
                    WHEN 13 THEN DECODE(@[rTerm],'T',OB_ORG,DECODE(@[rTerm],'F',OB_ORG,NVL(POL0,POL1)))  WHEN 14 THEN DECODE(POD1,POD_NODE,'',DECODE(POD1,POL2,'',POD1))
                    WHEN 15 THEN POL2     WHEN 16 THEN DECODE(POD2,POD_NODE,'',DECODE(POD2,POL3,'',POD2))     WHEN 17 THEN POL3     WHEN 18 THEN DECODE(POD3,POD_NODE,'',DECODE(POD3,POL4,'',POD3))
                    WHEN 19 THEN POL4     WHEN 20 THEN POD_NODE      WHEN 21 THEN NULL     WHEN 22 THEN IL_NODE01
                    WHEN 23 THEN IL_NODE02  WHEN 24 THEN IL_NODE03  WHEN 25 THEN IL_NODE04  WHEN 26 THEN IL_NODE05
                    WHEN 27 THEN IL_NODE06  WHEN 28 THEN IL_NODE07  WHEN 29 THEN IL_NODE08  WHEN 30 THEN IL_NODE09
                    WHEN 31 THEN IL_NODE10
                    WHEN 32 THEN DECODE(@[dTerm],'T','',DECODE(@[dTerm],'F','',DECODE(NVL(@[pod],SUBSTR(POD_NODE,1,5)),@[del],DECODE(IB_SEQ,0,DECODE(@[dTerm],'D',DEL,'S',DEL,''),DEL),DEL)))
                    WHEN 33 THEN MTRTN_CY ELSE 'N/A'
                END
                ) NODE1, OUT_CONTENT,IN_CONTENT,
                N1ST_LANE_CD,N2ND_LANE_CD,N3RD_LANE_CD,N4TH_LANE_CD,N2ND_POL_CD, N3RD_POL_CD,N4TH_POL_CD,
                N1ST_TZTM_HRS,N2ND_TZTM_HRS,N3RD_TZTM_HRS,N4TH_TZTM_HRS,CCT,
                POLT1,PODT1,VVD1,CRR1,POL_SEQ1,POD_SEQ1,
                POLT2,PODT2,VVD2,CRR2,POL_SEQ2,POD_SEQ2,
                POLT3,PODT3,VVD3,CRR3,POL_SEQ3,POD_SEQ3,
                POLT4,PODT4,VVD4,CRR4,POL_SEQ4,POD_SEQ4,
                MTPU_CY,
                OL_NODE01,OL_NODE02,OL_NODE03,OL_NODE04,OL_NODE05,OL_NODE06,OL_NODE07,OL_NODE08,OL_NODE09,OL_NODE10,
                POL0 AS C_POL,
                IL_NODE01,IL_NODE02,IL_NODE03,IL_NODE04,IL_NODE05,IL_NODE06,IL_NODE07,IL_NODE08,IL_NODE09,IL_NODE10,
                DEL,
                MTRTN_CY,
                OB_ORG,OB_DEST,OB_PRIO_SEQ,OB_SEQ,
                IB_ORG,IB_DEST,IB_PRIO_SEQ,IB_SEQ,
                ORG_LOC_CD,DEST_LOC_CD,OCN_SEQ
                FROM (
                    SELECT
                    OB_ORG,OB_DEST,OB_SEQ,OB_PRIO_SEQ,OB_CNT,
                    (CASE WHEN @[rTerm] = 'S' AND OB_SEQ = 0 THEN NULL
                          WHEN @[emt_pk_yd] IS NOT NULL THEN @[emt_pk_yd]
                          WHEN @[rTerm] ='D' THEN (SELECT Z.REP_YD_CD FROM MDM_ZONE Z WHERE Z.ZN_CD = OB_ORG AND NVL(Z.DELT_FLG,'N') = 'N')
                          ELSE (SELECT L.MTY_PKUP_YD_CD FROM MDM_LOCATION L WHERE L.LOC_CD =@[por] AND NVL(L.DELT_FLG,'N')='N')
                    END) MTPU_CY,
                    OB_ORG AS POR,
                    MAX(DECODE(OB_DTL_SEQ, 1 , DECODE(OB_CNT, 1 , '', OB_ROUT))) OL_NODE01,
                    MAX(DECODE(OB_DTL_SEQ, 2 , DECODE(OB_CNT, 2 , '', OB_ROUT))) OL_NODE02,
                    MAX(DECODE(OB_DTL_SEQ, 3 , DECODE(OB_CNT, 3 , '', OB_ROUT))) OL_NODE03,
                    MAX(DECODE(OB_DTL_SEQ, 4 , DECODE(OB_CNT, 4 , '', OB_ROUT))) OL_NODE04,
                    MAX(DECODE(OB_DTL_SEQ, 5 , DECODE(OB_CNT, 5 , '', OB_ROUT))) OL_NODE05,
                    MAX(DECODE(OB_DTL_SEQ, 6 , DECODE(OB_CNT, 6 , '', OB_ROUT))) OL_NODE06,
                    MAX(DECODE(OB_DTL_SEQ, 7 , DECODE(OB_CNT, 7 , '', OB_ROUT))) OL_NODE07,
                    MAX(DECODE(OB_DTL_SEQ, 8 , DECODE(OB_CNT, 8 , '', OB_ROUT))) OL_NODE08,
                    MAX(DECODE(OB_DTL_SEQ, 9 , DECODE(OB_CNT, 9 , '', OB_ROUT))) OL_NODE09,
                    MAX(DECODE(OB_DTL_SEQ, 10, DECODE(OB_CNT, 10, '', OB_ROUT))) OL_NODE10,
                    DECODE(OB_SEQ,0,NULL,MAX(OB_ROUT)) AS POL0 ,
                    MAX(DECODE(OB_CNT, 1, '', DECODE(OB_CNT, 1 , '', DECODE(OB_DTL_SEQ, 1 , SUBSTR(OB_ROUT,3,7))))) ||
                    MAX(DECODE(OB_CNT, 1, '', DECODE(OB_CNT, 2 , '', DECODE(OB_DTL_SEQ, 2 , '-'||SUBSTR(OB_ROUT,3,7))))) ||
                    MAX(DECODE(OB_CNT, 1, '', DECODE(OB_CNT, 3 , '', DECODE(OB_DTL_SEQ, 3 , '-'||SUBSTR(OB_ROUT,3,7))))) ||
                    MAX(DECODE(OB_CNT, 1, '', DECODE(OB_CNT, 4 , '', DECODE(OB_DTL_SEQ, 4 , '-'||SUBSTR(OB_ROUT,3,7))))) ||
                    MAX(DECODE(OB_CNT, 1, '', DECODE(OB_CNT, 5 , '', DECODE(OB_DTL_SEQ, 5 , '-'||SUBSTR(OB_ROUT,3,7))))) ||
                    MAX(DECODE(OB_CNT, 1, '', DECODE(OB_CNT, 6 , '', DECODE(OB_DTL_SEQ, 6 , '-'||SUBSTR(OB_ROUT,3,7))))) ||
                    MAX(DECODE(OB_CNT, 1, '', DECODE(OB_CNT, 7 , '', DECODE(OB_DTL_SEQ, 7 , '-'||SUBSTR(OB_ROUT,3,7))))) ||
                    MAX(DECODE(OB_CNT, 1, '', DECODE(OB_CNT, 8 , '', DECODE(OB_DTL_SEQ, 8 , '-'||SUBSTR(OB_ROUT,3,7))))) ||
                    MAX(DECODE(OB_CNT, 1, '', DECODE(OB_CNT, 9 , '', DECODE(OB_DTL_SEQ, 9 , '-'||SUBSTR(OB_ROUT,3,7))))) ||
                    MAX(DECODE(OB_CNT, 1, '', DECODE(OB_CNT, 10, '', DECODE(OB_DTL_SEQ, 10, '-'||SUBSTR(OB_ROUT,3,7)))))
                    AS OUT_CONTENT,
                    ORG_LOC_CD,DEST_LOC_CD,OCN_SEQ,
                    N1ST_LANE_CD,N2ND_LANE_CD,N3RD_LANE_CD,N4TH_LANE_CD,N2ND_POL_CD, N3RD_POL_CD,N4TH_POL_CD,
                    N1ST_TZTM_HRS,N2ND_TZTM_HRS,N3RD_TZTM_HRS,N4TH_TZTM_HRS,CCT,
                    LNK_KNT,
                    POL1,POD1,POLT1,PODT1,VVD1,CRR1,POL_SEQ1,POD_SEQ1,
                    POL2,POD2,POLT2,PODT2,VVD2,CRR2,POL_SEQ2,POD_SEQ2,
                    POL3,POD3,POLT3,PODT3,VVD3,CRR3,POL_SEQ3,POD_SEQ3,
                    POL4,POD4,POLT4,PODT4,VVD4,CRR4,POL_SEQ4,POD_SEQ4,
                    POD_NODE,
                    CHECK_ROUT,
                    IB_ORG,IB_DEST,IB_SEQ,IB_PRIO_SEQ,IB_CNT,
                    MAX(DECODE(IB_DTL_SEQ, 1 , DECODE(IB_CNT, 1 , '', IB_ROUT))) IL_NODE01,
                    MAX(DECODE(IB_DTL_SEQ, 2 , DECODE(IB_CNT, 2 , '', IB_ROUT))) IL_NODE02,
                    MAX(DECODE(IB_DTL_SEQ, 3 , DECODE(IB_CNT, 3 , '', IB_ROUT))) IL_NODE03,
                    MAX(DECODE(IB_DTL_SEQ, 4 , DECODE(IB_CNT, 4 , '', IB_ROUT))) IL_NODE04,
                    MAX(DECODE(IB_DTL_SEQ, 5 , DECODE(IB_CNT, 5 , '', IB_ROUT))) IL_NODE05,
                    MAX(DECODE(IB_DTL_SEQ, 6 , DECODE(IB_CNT, 6 , '', IB_ROUT))) IL_NODE06,
                    MAX(DECODE(IB_DTL_SEQ, 7 , DECODE(IB_CNT, 7 , '', IB_ROUT))) IL_NODE07,
                    MAX(DECODE(IB_DTL_SEQ, 8 , DECODE(IB_CNT, 8 , '', IB_ROUT))) IL_NODE08,
                    MAX(DECODE(IB_DTL_SEQ, 9 , DECODE(IB_CNT, 9 , '', IB_ROUT))) IL_NODE09,
                    MAX(DECODE(IB_DTL_SEQ, 10, DECODE(IB_CNT, 10, '', IB_ROUT))) IL_NODE10,
                    MAX(IB_ROUT) DEL,
                    MAX(DECODE(IB_CNT, 1, '', DECODE(IB_CNT, 1 , '', DECODE(IB_DTL_SEQ, 1 , SUBSTR(IB_ROUT,3,7))))) ||
                    MAX(DECODE(IB_CNT, 1, '', DECODE(IB_CNT, 2 , '', DECODE(IB_DTL_SEQ, 2 , '-'||SUBSTR(IB_ROUT,3,7))))) ||
                    MAX(DECODE(IB_CNT, 1, '', DECODE(IB_CNT, 3 , '', DECODE(IB_DTL_SEQ, 3 , '-'||SUBSTR(IB_ROUT,3,7))))) ||
                    MAX(DECODE(IB_CNT, 1, '', DECODE(IB_CNT, 4 , '', DECODE(IB_DTL_SEQ, 4 , '-'||SUBSTR(IB_ROUT,3,7))))) ||
                    MAX(DECODE(IB_CNT, 1, '', DECODE(IB_CNT, 5 , '', DECODE(IB_DTL_SEQ, 5 , '-'||SUBSTR(IB_ROUT,3,7))))) ||
                    MAX(DECODE(IB_CNT, 1, '', DECODE(IB_CNT, 6 , '', DECODE(IB_DTL_SEQ, 6 , '-'||SUBSTR(IB_ROUT,3,7))))) ||
                    MAX(DECODE(IB_CNT, 1, '', DECODE(IB_CNT, 7 , '', DECODE(IB_DTL_SEQ, 7 , '-'||SUBSTR(IB_ROUT,3,7))))) ||
                    MAX(DECODE(IB_CNT, 1, '', DECODE(IB_CNT, 8 , '', DECODE(IB_DTL_SEQ, 8 , '-'||SUBSTR(IB_ROUT,3,7))))) ||
                    MAX(DECODE(IB_CNT, 1, '', DECODE(IB_CNT, 9 , '', DECODE(IB_DTL_SEQ, 9 , '-'||SUBSTR(IB_ROUT,3,7))))) ||
                    MAX(DECODE(IB_CNT, 1, '', DECODE(IB_CNT, 10, '', DECODE(IB_DTL_SEQ, 10, '-'||SUBSTR(IB_ROUT,3,7)))))
                    AS IN_CONTENT,
                    (CASE WHEN @[dTerm] = 'S' AND IB_SEQ = 0 THEN NULL
                          WHEN @[emt_rtn_yd] IS NOT NULL THEN @[emt_rtn_yd]
                          WHEN @[dTerm] ='D' THEN (SELECT Z.REP_YD_CD FROM MDM_ZONE Z WHERE Z.ZN_CD = IB_DEST AND NVL(Z.DELT_FLG,'N') = 'N')
                          ELSE (SELECT L.EQ_RTN_YD_CD FROM MDM_LOCATION L WHERE L.LOC_CD =@[del] AND NVL(L.DELT_FLG,'N')='N')
                    END) MTRTN_CY,
                    RANK() OVER (ORDER BY  ORG_LOC_CD,DEST_LOC_CD,OCN_SEQ, OB_ORG,OB_DEST,OB_SEQ,
                                IB_ORG,IB_DEST,IB_SEQ,POL1,POD1,POL2, POD2,POL3,POD3,POL4,POD4) GP1
                    FROM (
                        SELECT
                        OB_ORG,OB_DEST,OB_SEQ,
                        RANK() OVER (PARTITION BY ORG_LOC_CD,DEST_LOC_CD,OCN_SEQ,OB_ORG,OB_DEST ORDER BY FULL_RTN_PRIO_SEQ,OB_MODE_PRIO_SEQ,OB_OPTM_FLG,OB_BKG_FLG,OB_MODE_PRIO_SEQ,OB_TMP_FLG,OB_PRIO_SEQ) OB_RK,
                        OB_PRIO_SEQ,
                        RPAD(OD.ROUT_DTL_SEQ,2,' ')||OD.LNK_DEST_NOD_CD||OD.TRSP_MOD_CD||LPAD(NVL(OD.VNDR_SEQ,0),6,0)||
                               NVL(OD.INLND_ROUT_CMB_FLG,'N')||LPAD(NVL(OB_INLND_ROUT_INV_BIL_PATT_CD,' '),3,' ') ||
                               RPAD(NVL(OD.RAIL_CRR_TP_CD,' '),3,' ') || RPAD(NVL(OD.TRSP_AGMT_OFC_CTY_CD,' '),3,' ') || LPAD(NVL(OD.TRSP_AGMT_SEQ,0),6,0) ||
                               RPAD(NVL(OD.AGMT_REF_NO,' '),15,' ') || RPAD(NVL(OB_INLND_ROUT_INCL_STTL_FLG,' '),1,' ') OB_ROUT,
                        OD.ROUT_DTL_SEQ OB_DTL_SEQ,
                        COUNT(DISTINCT OD.ROUT_DTL_SEQ) OVER (PARTITION BY OB_ORG,OB_DEST,OB_SEQ) AS OB_CNT,
                        ORG_LOC_CD,DEST_LOC_CD,OCN_SEQ,LNK_KNT,
                        N1ST_LANE_CD,N2ND_LANE_CD,N3RD_LANE_CD,N4TH_LANE_CD,N2ND_POL_CD, N3RD_POL_CD,N4TH_POL_CD,
                        N1ST_TZTM_HRS ,N2ND_TZTM_HRS ,N3RD_TZTM_HRS ,N4TH_TZTM_HRS,CCT,
                        POL1,POD1,POLT1,PODT1,VVD1,CRR1,POL_SEQ1,POD_SEQ1,
                        POL2,POD2,POLT2,PODT2,VVD2,CRR2,POL_SEQ2,POD_SEQ2,
                        POL3,POD3,POLT3,PODT3,VVD3,CRR3,POL_SEQ3,POD_SEQ3,
                        POL4,POD4,POLT4,PODT4,VVD4,CRR4,POL_SEQ4,POD_SEQ4,
                        POD_NODE,
                        CHECK_ROUT,
                        IB_ORG,IB_DEST,IB_PRIO_SEQ,IB_SEQ,
                        RANK() OVER (PARTITION BY ORG_LOC_CD,DEST_LOC_CD,OCN_SEQ,IB_ORG,IB_DEST ORDER BY IB_MODE_PRIO_SEQ,IB_OPTM_FLG,IB_BKG_FLG,IB_TMP_FLG,IB_PRIO_SEQ ) IB_RK,
                        RPAD(ID.ROUT_DTL_SEQ,2,' ')||ID.LNK_DEST_NOD_CD||ID.TRSP_MOD_CD||LPAD(NVL(ID.VNDR_SEQ,0),6,0)||
                        NVL(ID.INLND_ROUT_CMB_FLG,'N')||LPAD(NVL(IB_INLND_ROUT_INV_BIL_PATT_CD,' '),3,' ') ||
                        RPAD(NVL(ID.RAIL_CRR_TP_CD,' '),3,' ') || RPAD(NVL(ID.TRSP_AGMT_OFC_CTY_CD,' '),3,' ') || LPAD(NVL(ID.TRSP_AGMT_SEQ,0),6,0) ||
                        RPAD(NVL(ID.AGMT_REF_NO,' '),15,' ') || RPAD(NVL(IB_INLND_ROUT_INCL_STTL_FLG,' '),1,' ') IB_ROUT,
                        ID.ROUT_DTL_SEQ IB_DTL_SEQ,
                        COUNT(DISTINCT ID.ROUT_DTL_SEQ) OVER (PARTITION BY IB_ORG,IB_DEST,IB_SEQ) AS IB_CNT
                        FROM
                        (
                            SELECT ROWNUM,
                            NVL(O.ROUT_ORG_NOD_CD,POL1) OB_ORG,
                            NVL(O.ROUT_DEST_NOD_CD,POL1) OB_DEST,
                            DECODE(NVL(@[full_rtn_yd],'X'),O.FULL_RTN_YD_CD,1,2) FULL_RTN_PRIO_SEQ,
                            DECODE(SIGN(INSTR(O.TRSP_MOD_CD,SUBSTR(@[ob_trsp_mode],1,1))),1,1,2) OB_MODE_PRIO_SEQ,
                            O.PRIO_SEQ OB_PRIO_SEQ,
                            NVL(O.ROUT_SEQ,0) OB_SEQ,
                            O.INLND_ROUT_INCL_STTL_FLG OB_INLND_ROUT_INCL_STTL_FLG,
                            O.INLND_ROUT_INV_BIL_PATT_CD OB_INLND_ROUT_INV_BIL_PATT_CD,
   					        --------------
   					        DECODE(O.INLND_ROUT_OPTM_FLG,'Y', 1, 2) OB_OPTM_FLG,
   					        DECODE(I.INLND_ROUT_OPTM_FLG,'Y', 1, 2) IB_OPTM_FLG,
   					        DECODE(NVL(O.INLND_ROUT_BKG_FLG,'N'), 'Y',1,2) OB_BKG_FLG,
   					        DECODE(NVL(I.INLND_ROUT_BKG_FLG,'N'), 'Y',1,2) IB_BKG_FLG,
                            NVL(O.INLND_ROUT_TMP_FLG,'N') OB_TMP_FLG,
                            NVL(I.INLND_ROUT_TMP_FLG,'N') IB_TMP_FLG,
   					        ----------------------
                            T.ORG_LOC_CD,T.DEST_LOC_CD,T.ROUT_SEQ OCN_SEQ,T.LNK_KNT,
                            T.N1ST_LANE_CD,T.N2ND_LANE_CD,T.N3RD_LANE_CD,T.N4TH_LANE_CD,N2ND_POL_CD, N3RD_POL_CD,N4TH_POL_CD,
                            T.N1ST_TZTM_HRS,T.N2ND_TZTM_HRS,T.N3RD_TZTM_HRS,T.N4TH_TZTM_HRS,T.CCT,
                            T.POL1,T.POD1,T.POLT1,T.PODT1,T.VVD1,T.CRR1,T.POL_SEQ1,T.POD_SEQ1,
                            T.POL2,T.POD2,T.POLT2,T.PODT2,T.VVD2,T.CRR2,T.POL_SEQ2,T.POD_SEQ2,
                            T.POL3,T.POD3,T.POLT3,T.PODT3,T.VVD3,T.CRR3,T.POL_SEQ3,T.POD_SEQ3,
                            T.POL4,T.POD4,T.POLT4,T.PODT4,T.VVD4,T.CRR4,T.POL_SEQ4,T.POD_SEQ4,
                            T.POD_NODE,
                            T.CHECK_ROUT,
                            NVL(I.ROUT_ORG_NOD_CD,T.POD_NODE) IB_ORG,
                            NVL(I.ROUT_DEST_NOD_CD,T.POD_NODE) IB_DEST,
                            DECODE(SIGN(INSTR(I.TRSP_MOD_CD,SUBSTR(@[ib_trsp_mode],1,1))),1,1,2) IB_MODE_PRIO_SEQ,
                            I.PRIO_SEQ IB_PRIO_SEQ,
                            NVL(I.ROUT_SEQ,0) IB_SEQ,
                            I.INLND_ROUT_INCL_STTL_FLG IB_INLND_ROUT_INCL_STTL_FLG,
                            I.INLND_ROUT_INV_BIL_PATT_CD IB_INLND_ROUT_INV_BIL_PATT_CD,
                            I.PCTL_IO_BND_CD,
                            (CASE WHEN O.ROUT_ORG_NOD_CD IS NULL
                                    AND @[por] = @[pol] AND @[rTerm] = 'S' AND POL1_S ='Y' THEN 'Y'
                                  WHEN O.ROUT_ORG_NOD_CD IS NULL
                                    AND @[por] = @[pol] AND @[rTerm] <> 'D' THEN 'Y'
                                  WHEN O.ROUT_ORG_NOD_CD IS NOT NULL
                                    AND (SELECT 'X' FROM PRD_NODE N
                                         WHERE N.NOD_CD = O.ROUT_ORG_NOD_CD
                                           AND DECODE(N.NOD_TP_CD,'Z','D',N.NOD_TP_CD) IN (DECODE(@[rTerm],'D','D',''),
                                                                                       DECODE(@[rTerm],'T','B','F','B','Y','B','S','B',''),
                                                                                       DECODE(@[rTerm],'T','M','F','M','Y','M','S','M',''),
                                                                                       DECODE(@[rTerm],'Y','Y','S','Y',''),
                                                                                       DECODE(@[rTerm],'Y','R','S','R',''),
                                                                                       DECODE(@[rTerm],'Y','P','') )
                                         ) = 'X'
                                         AND NVL(O.PCTL_IO_BND_CD,'I')  IN ('O','B')
                                         AND DECODE(@[rTerm],'S','Y','X') =
                                                                NVL((SELECT DECODE(@[rTerm],'S',YD_FCTY_TP_CFS_FLG,'X')
                                                                     FROM MDM_YARD
                                                                     WHERE YD_CD=O.ROUT_ORG_NOD_CD),'X')
                                         AND O.ROUT_ORG_NOD_CD  LIKE DECODE(@[rTerm],'F','','T','',
                                                                              DECODE(@[por_n],'',
                                                                                   DECODE(@[rTerm],'D',(SELECT REP_ZN_CD FROM MDM_LOCATION L WHERE LOC_CD = @[por] AND NVL(L.DELT_FLG,'N')='N'),@[por]||'%')
                                                                              ,@[por_n])
                                                                       )

                                         THEN 'Y'
                                  ELSE 'X'
                             END) ORG_CHECK,
                             (CASE WHEN I.ROUT_DEST_NOD_CD IS NULL
                                    AND @[pod] = @[del] AND @[dTerm] = 'S' AND POD_NODE_S ='Y' THEN 'Y'
                                   WHEN I.ROUT_DEST_NOD_CD IS NULL
                                    AND @[pod] = @[del] AND @[dTerm] <> 'D' THEN 'Y'
                                   WHEN I.ROUT_DEST_NOD_CD IS NOT NULL
                                    AND (SELECT 'X' FROM PRD_NODE N
                                         WHERE N.NOD_CD = I.ROUT_DEST_NOD_CD
                                           AND DECODE(N.NOD_TP_CD,'Z','D',N.NOD_TP_CD) IN (DECODE(@[dTerm],'D','D',''),
                                                                                       DECODE(@[dTerm],'T','B','F','B','Y','B','S','B',''),
                                                                                       DECODE(@[dTerm],'T','M','F','M','Y','M','S','M',''),
                                                                                       DECODE(@[dTerm],'Y','Y','S','Y',''),
                                                                                       DECODE(@[dTerm],'Y','R','S','R',''),
                                                                                       DECODE(@[dTerm],'Y','P','') )
                                         ) = 'X'
                                         AND NVL(I.PCTL_IO_BND_CD,'I') IN ('I','B')
                                         AND DECODE(@[dTerm],'S','Y','X') =
                                                                NVL((SELECT DECODE(@[dTerm],'S',YD_FCTY_TP_CFS_FLG,'X')
                                                                     FROM MDM_YARD
                                                                     WHERE YD_CD=I.ROUT_DEST_NOD_CD),'X')
                                         AND I.ROUT_DEST_NOD_CD  LIKE DECODE(@[dTerm],'F','','T','',
                                                                              DECODE(@[del_n],'',
                                                                                   DECODE(@[dTerm],'D',(SELECT REP_ZN_CD FROM MDM_LOCATION L WHERE LOC_CD = @[del] AND NVL(L.DELT_FLG,'N')='N'),@[del]||'%')
                                                                              ,@[del_n])
                                                                       )

                                         THEN 'Y'
                                  ELSE 'X'
                             END) DEST_CHECK
                                FROM (
                                SELECT ROWNUM,
                                ORG_LOC_CD,DEST_LOC_CD,ROUT_SEQ,LNK_KNT,
                                N1ST_LANE_CD,N2ND_LANE_CD,N3RD_LANE_CD,N4TH_LANE_CD,N2ND_POL_CD, N3RD_POL_CD,N4TH_POL_CD,
                                N1ST_TZTM_HRS,N2ND_TZTM_HRS,N3RD_TZTM_HRS,N4TH_TZTM_HRS,CCT,
                                POL1,POD1,POLT1,PODT1,VVD1,CRR1,POL_SEQ1,POD_SEQ1,
                                POL2,POD2,POLT2,PODT2,VVD2,CRR2,POL_SEQ2,POD_SEQ2,
                                POL3,POD3,POLT3,PODT3,VVD3,CRR3,POL_SEQ3,POD_SEQ3,
                                POL4,POD4,POLT4,PODT4,VVD4,CRR4,POL_SEQ4,POD_SEQ4,
                                POD_NODE,POL1_S,POD_NODE_S,
                                (CASE WHEN POD_NODE IS NULL THEN 'X'
                                      WHEN LNK_KNT = 4 AND ( POL4 IS NULL OR POD4 IS NULL OR POLT4 IS NULL OR PODT4 IS NULL
                                                            OR ( N4TH_SVC_TP <> 'O' AND ( VVD4 IS NULL OR CRR4 IS NULL OR POL_SEQ4 IS NULL OR  POD_SEQ4 IS NULL) )
                                                            OR ( POL3 IS NULL OR POD3 IS NULL OR POLT3 IS NULL OR PODT3 IS NULL )
                                                            OR ( N3RD_SVC_TP <> 'O' AND ( VVD3 IS NULL OR CRR3 IS NULL OR POL_SEQ3 IS NULL OR  POD_SEQ3 IS NULL) )
                                                            OR ( POL2 IS NULL OR POD2 IS NULL OR POLT2 IS NULL OR PODT2 IS NULL )
                                                            OR ( N2ND_SVC_TP <> 'O' AND ( VVD2 IS NULL OR CRR2 IS NULL OR POL_SEQ2 IS NULL OR  POD_SEQ2 IS NULL) )
                                                            OR ( POL1 IS NULL OR POD1 IS NULL OR POLT1 IS NULL OR PODT1 IS NULL )
                                                            OR ( N1ST_SVC_TP <> 'O' AND ( VVD1 IS NULL OR CRR1 IS NULL OR POL_SEQ1 IS NULL OR  POD_SEQ1 IS NULL) ) )
                                           THEN 'X'
                                      WHEN LNK_KNT = 3 AND ( POL3 IS NULL OR POD3 IS NULL OR POLT3 IS NULL OR PODT3 IS NULL
                                                            OR ( N3RD_SVC_TP <> 'O' AND ( VVD3 IS NULL OR CRR3 IS NULL OR POL_SEQ3 IS NULL OR  POD_SEQ3 IS NULL) )
                                                            OR ( POL2 IS NULL OR POD2 IS NULL OR POLT2 IS NULL OR PODT2 IS NULL )
                                                            OR ( N2ND_SVC_TP <> 'O' AND ( VVD2 IS NULL OR CRR2 IS NULL OR POL_SEQ2 IS NULL OR  POD_SEQ2 IS NULL) )
                                                            OR ( POL1 IS NULL OR POD1 IS NULL OR POLT1 IS NULL OR PODT1 IS NULL )
                                                            OR ( N1ST_SVC_TP <> 'O' AND ( VVD1 IS NULL OR CRR1 IS NULL OR POL_SEQ1 IS NULL OR  POD_SEQ1 IS NULL) ) )
                                           THEN 'X'
                                      WHEN LNK_KNT = 2 AND ( POL2 IS NULL OR POD2 IS NULL OR POLT2 IS NULL OR PODT2 IS NULL
                                                            OR ( N2ND_SVC_TP <> 'O' AND ( VVD2 IS NULL OR CRR2 IS NULL OR POL_SEQ2 IS NULL OR  POD_SEQ2 IS NULL) )
                                                            OR ( POL1 IS NULL OR POD1 IS NULL OR POLT1 IS NULL OR PODT1 IS NULL )
                                                            OR ( N1ST_SVC_TP <> 'O' AND ( VVD1 IS NULL OR CRR1 IS NULL OR POL_SEQ1 IS NULL OR  POD_SEQ1 IS NULL) ) )
                                           THEN 'X'
                                      WHEN LNK_KNT = 1 AND ( POL1 IS NULL OR POD1 IS NULL OR POLT1 IS NULL OR PODT1 IS NULL
                                                            OR ( N1ST_SVC_TP <> 'O' AND ( VVD1 IS NULL OR CRR1 IS NULL OR POL_SEQ1 IS NULL OR  POD_SEQ1 IS NULL) ) )
                                           THEN 'X'
                                    ELSE 'Y'
                                END ) CHECK_ROUT
                                FROM (
                                    SELECT /*+ NO_MERGE(B)  */
                                    ORG_LOC_CD,DEST_LOC_CD,ROUT_SEQ,LNK_KNT,
                                    N1ST_LANE_CD,N2ND_LANE_CD,N3RD_LANE_CD,N4TH_LANE_CD,N2ND_POL_CD, N3RD_POL_CD,N4TH_POL_CD,
                                    N1ST_SVC_TP,N2ND_SVC_TP, N3RD_SVC_TP,N4TH_SVC_TP,
                                    N1ST_TZTM_HRS,N2ND_TZTM_HRS,N3RD_TZTM_HRS,N4TH_TZTM_HRS,
                                    (SELECT YD_FCTY_TP_CFS_FLG
                                     FROM MDM_YARD
                                     --WHERE YD_CD=TRIM(DECODE(INSTR(SKD_STR,'POL1'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POL1')+4,7)))) POL1_S,
                                     WHERE YD_CD=TRIM(DECODE(INSTR(SKD_STR,'POL1'),0,NULL,SUBSTR(SKD_STR, 82+length('POL1'),7))) ) POL1_S,
--                                    TRIM(DECODE(INSTR(SKD_STR,'CCT'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'CCT')+3,14))) CCT,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POL1'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POL1')+4,7))) POL1,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POD1'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POD1')+4,7))) POD1,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POLT1'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POLT1')+5,14))) POLT1,
--                                    TRIM(DECODE(INSTR(SKD_STR,'PODT1'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'PODT1')+5,14))) PODT1,
--                                    TRIM(DECODE(INSTR(SKD_STR,'VVD1'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'VVD1')+4,9))) VVD1,
--                                    TRIM(DECODE(INSTR(SKD_STR,'CRR1'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'CRR1')+4,4))) CRR1,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POL_SEQ1'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POL_SEQ1')+8,2))) POL_SEQ1,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POD_SEQ1'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POD_SEQ1')+8,2))) POD_SEQ1,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POL2'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POL2')+4,7))) POL2,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POD2'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POD2')+4,7))) POD2,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POLT2'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POLT2')+5,14))) POLT2,
--                                    TRIM(DECODE(INSTR(SKD_STR,'PODT2'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'PODT2')+5,14))) PODT2,
--                                    TRIM(DECODE(INSTR(SKD_STR,'VVD2'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'VVD2')+4,9))) VVD2,
--                                    TRIM(DECODE(INSTR(SKD_STR,'CRR2'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'CRR2')+4,4))) CRR2,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POL_SEQ2'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POL_SEQ2')+8,2))) POL_SEQ2,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POD_SEQ2'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POD_SEQ2')+8,2))) POD_SEQ2,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POL3'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POL3')+4,7))) POL3,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POD3'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POD3')+4,7))) POD3,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POLT3'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POLT3')+5,14))) POLT3,
--                                    TRIM(DECODE(INSTR(SKD_STR,'PODT3'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'PODT3')+5,14))) PODT3,
--                                    TRIM(DECODE(INSTR(SKD_STR,'VVD3'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'VVD3')+4,9))) VVD3,
--                                    TRIM(DECODE(INSTR(SKD_STR,'CRR3'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'CRR3')+4,4))) CRR3,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POL_SEQ3'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POL_SEQ3')+8,2))) POL_SEQ3,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POD_SEQ3'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POD_SEQ3')+8,2))) POD_SEQ3,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POL4'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POL4')+4,7))) POL4,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POD4'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POD4')+4,7))) POD4,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POLT4'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POLT4')+5,14))) POLT4,
--                                    TRIM(DECODE(INSTR(SKD_STR,'PODT4'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'PODT4')+5,14))) PODT4,
--                                    TRIM(DECODE(INSTR(SKD_STR,'VVD4'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'VVD4')+4,9))) VVD4,
--                                    TRIM(DECODE(INSTR(SKD_STR,'CRR4'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'CRR4')+4,4))) CRR4,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POL_SEQ4'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POL_SEQ4')+8,2))) POL_SEQ4,
--                                    TRIM(DECODE(INSTR(SKD_STR,'POD_SEQ4'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POD_SEQ4')+8,2))) POD_SEQ4,
--                                    TRIM(DECODE(LNK_KNT,4,TRIM(DECODE(INSTR(SKD_STR,'POD4'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POD4')+4,7))),
--                                                   3,TRIM(DECODE(INSTR(SKD_STR,'POD3'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POD3')+4,7))),
--                                                   2,TRIM(DECODE(INSTR(SKD_STR,'POD2'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POD2')+4,7))),
--                                                   TRIM(DECODE(INSTR(SKD_STR,'POD1'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POD1')+4,7))))) POD_NODE,

----------------------------------------------------------------------------------------

                                        TRIM(DECODE(INSTR(SKD_STR,'VVD1'),0,NULL,SUBSTR(SKD_STR, 1 +length('VVD1'),9 ))) VVD1,
                                        TRIM(DECODE(INSTR(SKD_STR,'CRR1'),0,NULL,SUBSTR(SKD_STR, 14+length('CRR1'),4 ))) CRR1,
                                        TRIM(DECODE(INSTR(SKD_STR,'CCT$'),0,NULL,SUBSTR(SKD_STR,  22+length('CCT$' ),14))) CCT,
                                        TRIM(DECODE(INSTR(SKD_STR,'POLT1'),0,NULL,SUBSTR(SKD_STR,63+length('POLT1'),14))) POLT1,
                                        TRIM(DECODE(INSTR(SKD_STR,'POL1'),0,NULL,SUBSTR(SKD_STR, 82+length('POL1'),7))) POL1,
                                        TRIM(DECODE(INSTR(SKD_STR,'POL_SEQ1'),0,NULL,SUBSTR(SKD_STR,93+length('POL_SEQ1'),2))) POL_SEQ1,
                                        TRIM(DECODE(INSTR(SKD_STR,'PODT1'),0,NULL,SUBSTR(SKD_STR,103+length('PODT1'),14))) PODT1,
                                        TRIM(DECODE(INSTR(SKD_STR,'POD1'),0,NULL,SUBSTR(SKD_STR,122+length('POD1'),7))) POD1,
                                        TRIM(DECODE(INSTR(SKD_STR,'POD_SEQ1'),0,NULL,SUBSTR(SKD_STR,133+length('POD_SEQ1'),2))) POD_SEQ1,--
                                        TRIM(DECODE(INSTR(SKD_STR,'VVD2'),0,NULL,SUBSTR(SKD_STR,143+length('VVD2'),9))) VVD2,
                                        TRIM(DECODE(INSTR(SKD_STR,'CRR2'),0,NULL,SUBSTR(SKD_STR,156+length('CRR2'),4))) CRR2,
                                        TRIM(DECODE(INSTR(SKD_STR,'POLT2'),0,NULL,SUBSTR(SKD_STR,186+length('POLT2'),14))) POLT2,
                                        TRIM(DECODE(INSTR(SKD_STR,'POL2'),0,NULL,SUBSTR(SKD_STR,205+length('POL2'),7))) POL2,
                                        TRIM(DECODE(INSTR(SKD_STR,'POL_SEQ2'),0,NULL,SUBSTR(SKD_STR,216+length('POL_SEQ2'),2))) POL_SEQ2,
                                        TRIM(DECODE(INSTR(SKD_STR,'PODT2'),0,NULL,SUBSTR(SKD_STR,226+length('PODT2'),14))) PODT2,
                                        TRIM(DECODE(INSTR(SKD_STR,'POD2'),0,NULL,SUBSTR(SKD_STR,245+length('POD2'),7))) POD2,
                                        TRIM(DECODE(INSTR(SKD_STR,'POD_SEQ2'),0,NULL,SUBSTR(SKD_STR,256+length('POD_SEQ2'),2))) POD_SEQ2,--
                                        TRIM(DECODE(INSTR(SKD_STR,'VVD3'),0,NULL,SUBSTR(SKD_STR,266+length('VVD3'),9))) VVD3,
                                        TRIM(DECODE(INSTR(SKD_STR,'CRR3'),0,NULL,SUBSTR(SKD_STR,279+length('CRR3'),4))) CRR3,
                                        TRIM(DECODE(INSTR(SKD_STR,'POLT3'),0,NULL,SUBSTR(SKD_STR,309+length('POLT3'),14))) POLT3,
                                        TRIM(DECODE(INSTR(SKD_STR,'POL3'),0,NULL,SUBSTR(SKD_STR,328+length('POL3'),7))) POL3,
                                        TRIM(DECODE(INSTR(SKD_STR,'POL_SEQ3'),0,NULL,SUBSTR(SKD_STR,339+length('POL_SEQ3'),2))) POL_SEQ3,
                                        TRIM(DECODE(INSTR(SKD_STR,'PODT3'),0,NULL,SUBSTR(SKD_STR,349+length('PODT3'),14))) PODT3,
                                        TRIM(DECODE(INSTR(SKD_STR,'POD3'),0,NULL,SUBSTR(SKD_STR,368+length('POD3'),7))) POD3,
                                        TRIM(DECODE(INSTR(SKD_STR,'POD_SEQ3'),0,NULL,SUBSTR(SKD_STR,379+length('POD_SEQ3'),2))) POD_SEQ3, --
                                        TRIM(DECODE(INSTR(SKD_STR,'VVD4'),0,NULL,SUBSTR(SKD_STR,389+length('VVD4'),9))) VVD4,
                                        TRIM(DECODE(INSTR(SKD_STR,'CRR4'),0,NULL,SUBSTR(SKD_STR,402+length('CRR4'),4))) CRR4,
                                        TRIM(DECODE(INSTR(SKD_STR,'POLT4'),0,NULL,SUBSTR(SKD_STR,432+length('POLT4'),14))) POLT4,
                                        TRIM(DECODE(INSTR(SKD_STR,'POL4'),0,NULL,SUBSTR(SKD_STR,451+length('POL4'),7))) POL4,
                                        TRIM(DECODE(INSTR(SKD_STR,'POL_SEQ4'),0,NULL,SUBSTR(SKD_STR,462+length('POL_SEQ4'),2))) POL_SEQ4,
                                        TRIM(DECODE(INSTR(SKD_STR,'PODT4'),0,NULL,SUBSTR(SKD_STR,472+length('PODT4'),14))) PODT4,
                                        TRIM(DECODE(INSTR(SKD_STR,'POD4'),0,NULL,SUBSTR(SKD_STR,491+length('POD4'),7))) POD4,
                                        TRIM(DECODE(INSTR(SKD_STR,'POD_SEQ4'),0,NULL,SUBSTR(SKD_STR,502+length('POD_SEQ4'),2))) POD_SEQ4,--
                                        TRIM(DECODE(LNK_KNT,4,TRIM(DECODE(INSTR(SKD_STR,'POD4'),0,NULL,SUBSTR(SKD_STR,491+length('POD4'),7))),
                                                       3,TRIM(DECODE(INSTR(SKD_STR,'POD3'),0,NULL,SUBSTR(SKD_STR,368+length('POD3'),7))),
                                                       2,TRIM(DECODE(INSTR(SKD_STR,'POD2'),0,NULL,SUBSTR(SKD_STR,245+length('POD2'),7))),
                                                       TRIM(DECODE(INSTR(SKD_STR,'POD1'),0,NULL,SUBSTR(SKD_STR,122+length('POD1'),7))))) POD_NODE,
----------------------------------------------------------------------------------------
                                    (SELECT YD_FCTY_TP_CFS_FLG
                                     FROM MDM_YARD
--                                     WHERE YD_CD=TRIM(DECODE(LNK_KNT,4,TRIM(DECODE(INSTR(SKD_STR,'POD4'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POD4')+4,7))),
--                                                   3,TRIM(DECODE(INSTR(SKD_STR,'POD3'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POD3')+4,7))),
--                                                   2,TRIM(DECODE(INSTR(SKD_STR,'POD2'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POD2')+4,7))),
--                                                   TRIM(DECODE(INSTR(SKD_STR,'POD1'),0,NULL,SUBSTR(SKD_STR,INSTR(SKD_STR,'POD1')+4,7)))))) POD_NODE_S,
                                     WHERE YD_CD=TRIM(DECODE(LNK_KNT,4,TRIM(DECODE(INSTR(SKD_STR,'POD4'),0,NULL,SUBSTR(SKD_STR,491+length('POD4'),7))) ,
                                                   3,TRIM(DECODE(INSTR(SKD_STR,'POD3'),0,NULL,SUBSTR(SKD_STR,368+length('POD3'),7))),
                                                   2,TRIM(DECODE(INSTR(SKD_STR,'POD2'),0,NULL,SUBSTR(SKD_STR,245+length('POD2'),7))),
                                                   TRIM(DECODE(INSTR(SKD_STR,'POD1'),0,NULL,SUBSTR(SKD_STR,122+length('POD1'),7)))
                                                   ))) POD_NODE_S,
                                    SKD_STR
                                    FROM (
--=============================================================================================================================================
--  Internal    
                                        SELECT @[pol] ORG_LOC_CD, @[pod] DEST_LOC_CD, 0 ROUT_SEQ,
                                        (CASE WHEN @[pol4] IS NOT NULL THEN 4
                                              WHEN @[pol3] IS NOT NULL THEN 3
                                              WHEN @[pol2] IS NOT NULL THEN 2
                                              ELSE 1
                                        END)
                                        LNK_KNT,
                                        @[lane1] N1ST_LANE_CD,@[lane2] N2ND_LANE_CD,@[lane3] N3RD_LANE_CD,@[lane4] N4TH_LANE_CD,
                                        @[pol2] N2ND_POL_CD,@[pol3] N3RD_POL_CD,@[pol4] N4TH_POL_CD,
                                        (SELECT VSL_SVC_TP_CD FROM MDM_VSL_SVC_LANE
                                        WHERE VSL_SLAN_CD = @[lane1] ) N1ST_SVC_TP,
                                        (SELECT VSL_SVC_TP_CD FROM MDM_VSL_SVC_LANE
                                        WHERE VSL_SLAN_CD = @[lane2]) N2ND_SVC_TP,
                                        (SELECT VSL_SVC_TP_CD FROM MDM_VSL_SVC_LANE
                                        WHERE VSL_SLAN_CD = @[lane3]) N3RD_SVC_TP,
                                        (SELECT VSL_SVC_TP_CD FROM MDM_VSL_SVC_LANE
                                        WHERE VSL_SLAN_CD = @[lane4]) N4TH_SVC_TP,
                                        (CASE WHEN (SELECT VSL_SVC_TP_CD FROM MDM_VSL_SVC_LANE
                                                   WHERE VSL_SLAN_CD = @[lane1] ) ='O'
                                                 THEN (SELECT TZTM_HRS FROM PRD_FDR_LNK
                                                       WHERE LNK_ORG_LOC_CD = @[pol1]
                                                         AND LNK_DEST_LOC_CD = @[pod1]
                                                         AND VSL_SLAN_CD = @[lane1])
                                             ELSE (SELECT TZTM_HRS FROM PRD_PF_TZ_TM
                                                       WHERE FM_PORT_CD = @[pol1]
                                                         AND TO_PORT_CD = @[pod1]
                                                         AND VSL_SLAN_CD = @[lane1]
														 AND DELT_FLG <> 'Y')
                                        END)
                                        N1ST_TZTM_HRS ,
                                        (CASE WHEN (SELECT VSL_SVC_TP_CD FROM MDM_VSL_SVC_LANE
                                                   WHERE VSL_SLAN_CD = @[lane2] ) ='O'
                                                 THEN (SELECT TZTM_HRS FROM PRD_FDR_LNK
                                                       WHERE LNK_ORG_LOC_CD = @[pol2]
                                                         AND LNK_DEST_LOC_CD = @[pod2]
                                                         AND VSL_SLAN_CD = @[lane2])
                                             ELSE (SELECT TZTM_HRS FROM PRD_PF_TZ_TM
                                                       WHERE FM_PORT_CD = @[pol2]
                                                         AND TO_PORT_CD = @[pod2]
                                                         AND VSL_SLAN_CD = @[lane2]
														 AND DELT_FLG <> 'Y')
                                        END)
                                        N2ND_TZTM_HRS ,
                                        (CASE WHEN (SELECT VSL_SVC_TP_CD FROM MDM_VSL_SVC_LANE
                                                   WHERE VSL_SLAN_CD = @[lane3] ) ='O'
                                                 THEN (SELECT TZTM_HRS FROM PRD_FDR_LNK
                                                       WHERE LNK_ORG_LOC_CD = @[pol3]
                                                         AND LNK_DEST_LOC_CD = @[pod3]
                                                         AND VSL_SLAN_CD = @[lane3])
                                             ELSE (SELECT TZTM_HRS FROM PRD_PF_TZ_TM
                                                       WHERE FM_PORT_CD = @[pol3]
                                                         AND TO_PORT_CD = @[pod3]
                                                         AND VSL_SLAN_CD = @[lane3]
														 AND DELT_FLG <> 'Y')
                                        END)
                                        N3RD_TZTM_HRS ,
                                        (CASE WHEN (SELECT VSL_SVC_TP_CD FROM MDM_VSL_SVC_LANE
                                                   WHERE VSL_SLAN_CD = @[lane4] ) ='O'
                                                 THEN (SELECT TZTM_HRS FROM PRD_FDR_LNK
                                                       WHERE LNK_ORG_LOC_CD = @[pol4]
                                                         AND LNK_DEST_LOC_CD = @[pod4]
                                                         AND VSL_SLAN_CD = @[lane4])
                                             ELSE (SELECT TZTM_HRS FROM PRD_PF_TZ_TM
                                                       WHERE FM_PORT_CD = @[pol4]
                                                         AND TO_PORT_CD = @[pod4]
                                                         AND VSL_SLAN_CD = @[lane4]
														 AND DELT_FLG <> 'Y')
                                        END)
                                        N4TH_TZTM_HRS,
                                        PRD_GET_OCN_SKD_FNC(@[s_date],@[s_type],@[pol],@[pod],
                                            @[pol1],'',@[pod1],'',@[lane1],(CASE WHEN (SELECT VSL_SVC_TP_CD FROM MDM_VSL_SVC_LANE
                                                                             WHERE VSL_SLAN_CD = @[lane1] ) ='O'
                                                                           THEN (SELECT SKD_DIR_CD FROM PRD_FDR_LNK
                                                                                 WHERE LNK_ORG_LOC_CD = @[pol1]
                                                                                   AND LNK_DEST_LOC_CD = @[pod1]
                                                                                   AND VSL_SLAN_CD = @[lane1])
                                                                       ELSE (SELECT SKD_DIR_CD FROM PRD_PF_TZ_TM
                                                                                 WHERE FM_PORT_CD = @[pol1]
                                                                                   AND TO_PORT_CD = @[pod1]
                                                                                   AND VSL_SLAN_CD = @[lane1]
																				   AND DELT_FLG <> 'Y')

                                                                  END),
                                                                  (SELECT VSL_SVC_TP_CD FROM MDM_VSL_SVC_LANE
                                                                  WHERE VSL_SLAN_CD = @[lane1] ),
                                                                  @[vvd1],
                                            @[pol2],'',@[pod2],'',@[lane2],(CASE WHEN (SELECT VSL_SVC_TP_CD FROM MDM_VSL_SVC_LANE
                                                                             WHERE VSL_SLAN_CD = @[lane2] ) ='O'
                                                                           THEN (SELECT SKD_DIR_CD FROM PRD_FDR_LNK
                                                                                 WHERE LNK_ORG_LOC_CD = @[pol2]
                                                                                   AND LNK_DEST_LOC_CD = @[pod2]
                                                                                   AND VSL_SLAN_CD = @[lane2])
                                                                       ELSE (SELECT SKD_DIR_CD FROM PRD_PF_TZ_TM
                                                                                 WHERE FM_PORT_CD = @[pol2]
                                                                                   AND TO_PORT_CD = @[pod2]
                                                                                   AND VSL_SLAN_CD = @[lane2]
                                                                                   AND DELT_FLG <> 'Y')

                                                                  END),
                                                                  (SELECT VSL_SVC_TP_CD FROM MDM_VSL_SVC_LANE
                                                                  WHERE VSL_SLAN_CD = @[lane2] ),
                                                                  @[vvd2],
                                            @[pol3],'',@[pod3],'',@[lane3],(CASE WHEN (SELECT VSL_SVC_TP_CD FROM MDM_VSL_SVC_LANE
                                                                             WHERE VSL_SLAN_CD = @[lane3] ) ='O'
                                                                           THEN (SELECT SKD_DIR_CD FROM PRD_FDR_LNK
                                                                                 WHERE LNK_ORG_LOC_CD = @[pol3]
                                                                                   AND LNK_DEST_LOC_CD = @[pod3]
                                                                                   AND VSL_SLAN_CD = @[lane3])
                                                                       ELSE (SELECT SKD_DIR_CD FROM PRD_PF_TZ_TM
                                                                                 WHERE FM_PORT_CD = @[pol3]
                                                                                   AND TO_PORT_CD = @[pod3]
                                                                                   AND VSL_SLAN_CD = @[lane3]
																				   AND DELT_FLG <> 'Y')
                                                                  END),
                                                                  (SELECT VSL_SVC_TP_CD FROM MDM_VSL_SVC_LANE
                                                                  WHERE VSL_SLAN_CD = @[lane3] ),
                                                                  @[vvd3],
                                            @[pol4],'',@[pod4],'',@[lane4],(CASE WHEN (SELECT VSL_SVC_TP_CD FROM MDM_VSL_SVC_LANE
                                                                             WHERE VSL_SLAN_CD = @[lane4] ) ='O'
                                                                           THEN (SELECT SKD_DIR_CD FROM PRD_FDR_LNK
                                                                                 WHERE LNK_ORG_LOC_CD = @[pol4]
                                                                                   AND LNK_DEST_LOC_CD = @[pod4]
                                                                                   AND VSL_SLAN_CD = @[lane4])
                                                                       ELSE (SELECT SKD_DIR_CD FROM PRD_PF_TZ_TM
                                                                                 WHERE FM_PORT_CD = @[pol4]
                                                                                   AND TO_PORT_CD = @[pod4]
                                                                                   AND VSL_SLAN_CD = @[lane4]
																				   AND DELT_FLG <> 'Y')
                                                                  END),
                                                                  (SELECT VSL_SVC_TP_CD FROM MDM_VSL_SVC_LANE
                                                                  WHERE VSL_SLAN_CD = @[lane4] ),
                                                                  @[vvd4],
                                        NVL(@[cgo_tp],'AL'),'N') SKD_STR
                                        FROM DUAL
                                        WHERE NOT EXISTS
                                        (
                                           SELECT 'X' FROM PRD_MBGO_MGMT TT
                                           WHERE SUBSTR (@[pol], 1, 2) = TT.FM_CNT_CD
                                           AND DECODE(@[pol2],NULL,'D','T') = 'D'
                                           AND SUBSTR (@[pod], 1, 2) = TT.TO_CNT_CD
                                        )
--=============================================================================================================================================
                                    ) B
                                ) C
                            ) T , PRD_INLND_ROUT_MST O, PRD_INLND_ROUT_MST I
                            WHERE T.CHECK_ROUT = 'Y'
                            AND O.INLND_ROUT_BKG_FLG(+) = 'Y'
                            AND O.ROUT_DEST_NOD_CD(+)= T.POL1
                            AND @[por] = SUBSTR(O.ROUT_ORG_NOD_CD(+),1,5)
                            AND DECODE(@[rTerm],'D','X','S','X',DECODE(@[por_n],NULL,DECODE(NVL(@[so_seq],0),0,@[por],'X'),SUBSTR(@[por_n],1,5))) <> SUBSTR(O.ROUT_DEST_NOD_CD(+),1,5)
                            AND DECODE(@[rTerm],'S',DECODE(T.POL1_S,'Y','Y',O.ROUT_ORG_NOD_CD(+)) ,'X') =  DECODE(@[rTerm],'S',O.ROUT_ORG_NOD_CD(+),'X')
                            AND NVL(O.DELT_FLG(+),'N') <> 'Y'
                            AND I.INLND_ROUT_BKG_FLG(+) = 'Y'
                            AND I.ROUT_ORG_NOD_CD(+)= T.POD_NODE
                            AND DECODE(@[dTerm],'D','X','S','X',DECODE(@[pod_n],NULL,DECODE(NVL(@[so_seq],0),0,nvl(nvl(@[pod],SUBSTR(T.POD_NODE,1,5)),'X'),'X'),SUBSTR(@[pod_n],1,5))) <> SUBSTR(I.ROUT_DEST_NOD_CD(+),1,5)
                            AND DECODE(@[dTerm],'S',DECODE(T.POD_NODE_S,'Y','Y',I.ROUT_DEST_NOD_CD(+)) ,'X') =  DECODE(@[dTerm],'S',I.ROUT_DEST_NOD_CD(+),'X')
                            AND NVL(I.DELT_FLG(+),'N') <> 'Y'
                            AND I.ROUT_DEST_NOD_CD(+) LIKE @[del]||'%'
                        ) ROUT, PRD_INLND_ROUT_DTL OD,PRD_INLND_ROUT_DTL ID
                        WHERE ROUT.ORG_CHECK = 'Y'
                        AND ROUT.DEST_CHECK ='Y'
                        AND ROUT.OB_ORG =OD.ROUT_ORG_NOD_CD(+)
                        AND ROUT.OB_DEST =OD.ROUT_DEST_NOD_CD(+)
                        AND ROUT.OB_SEQ =OD.ROUT_SEQ(+)
                        AND ROUT.IB_ORG =ID.ROUT_ORG_NOD_CD(+)
                        AND ROUT.IB_DEST =ID.ROUT_DEST_NOD_CD(+)
                        AND ROUT.IB_SEQ =ID.ROUT_SEQ(+)
                    )
                WHERE IB_RK =1 AND OB_RK= 1

                GROUP BY OB_ORG,OB_ORG,OB_DEST,OB_PRIO_SEQ,OB_SEQ,OB_CNT,
                ORG_LOC_CD,DEST_LOC_CD,OCN_SEQ,LNK_KNT,
                N1ST_LANE_CD,N2ND_LANE_CD,N3RD_LANE_CD,N4TH_LANE_CD,N2ND_POL_CD, N3RD_POL_CD,N4TH_POL_CD,
                N1ST_TZTM_HRS,N2ND_TZTM_HRS,N3RD_TZTM_HRS,N4TH_TZTM_HRS,CCT,
                POL1,POD1,POLT1,PODT1,VVD1,CRR1,POL_SEQ1,POD_SEQ1,
                POL2,POD2,POLT2,PODT2,VVD2,CRR2,POL_SEQ2,POD_SEQ2,
                POL3,POD3,POLT3,PODT3,VVD3,CRR3,POL_SEQ3,POD_SEQ3,
                POL4,POD4,POLT4,PODT4,VVD4,CRR4,POL_SEQ4,POD_SEQ4,
                POD_NODE,CHECK_ROUT,
                IB_ORG,IB_DEST,IB_PRIO_SEQ,IB_SEQ,IB_CNT
                ),
                (
                SELECT CPY_NO F_N0 FROM COM_CPY_NO WHERE CPY_NO <=33
                )
                WHERE 1 = CASE WHEN @[rTerm] IN ('D','Y') THEN DECODE(MTPU_CY, NULL, 0, 1)
                               ELSE 1 END
                  AND 1 = CASE WHEN @[dTerm] IN ('D','Y') THEN DECODE(MTRTN_CY, NULL, 0, 1)
                               ELSE 1 END
            )
            WHERE TRIM(NODE1) IS NOT NULL
        ),
        (
            SELECT CPY_NO L_N0 FROM COM_CPY_NO WHERE CPY_NO IN (1,2)
        )
    )
    WHERE (F_NO2 <> 33 OR L_N0 <> 2 )
    AND NODE_NEW2 IS NOT NULL
    ORDER BY 1,2,3
)
ORDER BY GP1, ORD			]]></sql>
			<params>
				<param name="por" type="12" value="" out="N"/>
				<param name="pol" type="12" value="" out="N"/>
				<param name="pod" type="12" value="" out="N"/>
				<param name="del" type="12" value="" out="N"/>
				<param name="skd_date" type="12" value="" out="N"/>
				<param name="rTerm" type="12" value="" out="N"/>
				<param name="dTerm" type="12" value="" out="N"/>
				<param name="com" type="12" value="" out="N"/>
				<param name="bkgOffCd" type="12" value="" out="N"/>
				<param name="sc_ofc" type="12" value="" out="N"/>
				<param name="user_id" type="12" value="" out="N"/>
				<param name="dg_spcl_flg" type="12" value="" out="N"/>
				<param name="rf_spcl_flg" type="12" value="" out="N"/>
				<param name="spcl_awk_cgo_flg" type="12" value="" out="N"/>
				<param name="bb_spcl_flg" type="12" value="" out="N"/>
				<param name="soc_flg" type="12" value="" out="N"/>
				<param name="prdCtlNo" type="12" value="" out="N"/>
				<param name="pm_f" type="12" value="" out="N"/>
				<param name="ag_seq" type="12" value="" out="N"/>
				<param name="update_id" type="12" value="" out="N"/>
				<param name="emt_pk_yd" type="12" value="" out="N"/>
				<param name="emt_rtn_yd" type="12" value="" out="N"/>
				<param name="full_rtn_yd" type="12" value="" out="N"/>
				<param name="ob_trsp_mode" type="12" value="" out="N"/>
				<param name="ib_trsp_mode" type="12" value="" out="N"/>
				<param name="por_n" type="12" value="" out="N"/>
				<param name="del_n" type="12" value="" out="N"/>
				<param name="pol4" type="12" value="" out="N"/>
				<param name="pol3" type="12" value="" out="N"/>
				<param name="pol2" type="12" value="" out="N"/>
				<param name="lane1" type="12" value="" out="N"/>
				<param name="lane2" type="12" value="" out="N"/>
				<param name="lane3" type="12" value="" out="N"/>
				<param name="lane4" type="12" value="" out="N"/>
				<param name="pol1" type="12" value="" out="N"/>
				<param name="pod1" type="12" value="" out="N"/>
				<param name="pod2" type="12" value="" out="N"/>
				<param name="pod3" type="12" value="" out="N"/>
				<param name="pod4" type="12" value="" out="N"/>
				<param name="s_date" type="12" value="" out="N"/>
				<param name="s_type" type="12" value="" out="N"/>
				<param name="vvd1" type="12" value="" out="N"/>
				<param name="vvd2" type="12" value="" out="N"/>
				<param name="vvd3" type="12" value="" out="N"/>
				<param name="vvd4" type="12" value="" out="N"/>
				<param name="cgo_tp" type="12" value="" out="N"/>
				<param name="so_seq" type="12" value="" out="N"/>
				<param name="pod_n" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
