<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TESCommonDBDAOSearchCntrBkgNoOffRSQL">
			<desc><![CDATA[* 2011.08.08 윤태승 [CHM-201111118-1] MR Invoice Creation & Correction 의 Manual input 보완
* 2011.11.21 윤태승 [CHM-201111118-1] MR Invoice Creation & Correction 의 Manual input 보완]]></desc>
			<sql><![CDATA[
SELECT NVL(
(SELECT 
    CASE
    WHEN NVL(COUNT(C.CNTR_NO) OVER (), 0) > 0
    THEN 'Y'
    ELSE 'N'
    END 
    || '|' || C.CNTR_TPSZ_CD || '|' ||
    CASE
    WHEN NVL(COUNT(C.CNTR_NO) OVER (), 0) > 0
    THEN (
            SELECT 
            CASE
            WHEN X.BKG_NO IS NOT NULL THEN X.BKG_NO
            WHEN Y.BKG_NO IS NOT NULL THEN Y.BKG_NO
            WHEN C.BKG_NO IS NOT NULL THEN C.BKG_NO
            ELSE ''
            END BKG_NO
            FROM MST_CONTAINER C, 
            (
                    SELECT DISTINCT M.BKG_NO, M.CNTR_NO
                    FROM   CTM_MOVEMENT M, BKG_BOOKING B
                    WHERE  M.CNTR_NO   = @[cntr_no]
                    AND    M.ORG_YD_CD = @[yd_cd]
                    AND    CNMV_EVNT_DT BETWEEN TO_DATE(REPLACE(@[fm_prd_dt],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[to_prd_dt],'-',''),'YYYYMMDD')
                    AND    B.BKG_STS_CD IN ('F','W')
                    AND    M.BKG_NO = B.BKG_NO(+)
                    AND    NVL(M.MVMT_CRE_TP_CD,'N') <> 'C'
                    AND    ROWNUM = 1 
            ) X,
            (
                    SELECT  DISTINCT B.BKG_NO, C.CNTR_NO
                    FROM	BKG_BOOKING B, BKG_CONTAINER C
                    WHERE	B.BKG_NO   = C.BKG_NO
                    AND		C.CNTR_NO  = NVL(@[cntr_no],'')
                    AND		B.BKG_STS_CD IN ('F','W') 
                    AND     C.CRE_DT BETWEEN TO_DATE(REPLACE(@[fm_prd_dt],'-',''),'YYYYMMDD') - 7 AND TO_DATE(REPLACE(@[to_prd_dt],'-',''),'YYYYMMDD') + 7
                    AND     ROWNUM = 1    
            ) Y
            WHERE 1=1
            AND C.CNTR_NO = X.CNTR_NO(+)
            AND C.CNTR_NO = Y.CNTR_NO(+)
            AND C.CNTR_NO = @[cntr_no]  
    )
    ELSE ''
    END CNTR_CHK
FROM MST_CONTAINER C
WHERE C.CNTR_NO = @[cntr_no])
,'N') CNTR_CHK FROM DUAL			]]></sql>
			<params>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="fm_prd_dt" type="12" value="" out="N"/>
				<param name="to_prd_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
