<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DwellNotificationDBDADAOSearchDwllNtfcSvcListDtlRSQL">
			<desc><![CDATA[Email이 중복으로 등록되어 있는지를 체크한다.]]></desc>
			<sql><![CDATA[
  SELECT DWLL_CUST_CNT_CD || LPAD(DWLL_CUST_SEQ,6,0) CUST_CD, NTFC_SEQ, DELT_FLG
      , CASE WHEN @[ntfc_seq] IS NULL THEN 'ERR1' -- 이미 있는 EMAIL을 재등록 하려고 함
            WHEN @[ntfc_seq] <> NTFC_SEQ THEN 'ERR2' -- 현 EMAIL을 다른 존재하는 EMAIL로 변경하려고 함
            WHEN COUNT(1) OVER() > 1 THEN 'ERR3' -- 기존에 이미 2건이상 등록되어있음
            ELSE 'Y' END ERR_CHK
FROM SCE_DWLL_CUST_SVC_LIST
WHERE 1=1
  AND DWLL_CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
  AND DWLL_CUST_SEQ = TO_NUMBER(SUBSTR(@[cust_cd],3,6))
  AND SUBSC_EML = TRIM(@[subsc_eml])			]]></sql>
			<params>
				<param name="ntfc_seq" type="12" value="" out="N"/>
				<param name="cust_cd" type="12" value="" out="N"/>
				<param name="subsc_eml" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
