<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceManageDBDAOSearchOutstandingDetailListForInvoiceCreationRSQL">
			<desc><![CDATA[SearchOutstandingDetailListForInvoiceCreation]]></desc>
			<sql><![CDATA[
SELECT   NVL(T.IDA_SAC_CD, G.IDA_SAC_CD) AS IDA_SAC_CD
       , (
           SELECT   S.IDA_SAC_NM
           FROM     BKG_IDA_SAC_MST S
           WHERE    1 = 1
           AND      S.IDA_SAC_CD = NVL(T.IDA_SAC_CD, G.IDA_SAC_CD)
         ) AS IDA_SAC_NM
       , A.N3PTY_NO
       , A.N3PTY_BIL_TP_CD
       , TPB_GET_N3PTY_BIL_TP_NM_FNC(A.N3PTY_BIL_TP_CD) AS N3PTY_BIL_TP_NM
       , COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD01132',A.EQ_KND_CD)  EQ_KND_NM
       , A.EQ_NO
       , A.EQ_TPSZ_CD
       , A.BKG_NO	BKG_NO_ALL
       , A.BL_NO	BL_NO_ALL
       , A.VSL_CD||A.SKD_VOY_NO||SUBSTR(A.FINC_DIR_CD,1,1)	VVD
       , A.VVD_CD
       , '' MGSET_NO
       , A.YD_CD
       , ( SELECT  YD_NM
           FROM    MDM_YARD
           WHERE   YD_CD = A.YD_CD
         ) YD_NM
       , TO_CHAR(TPB_GET_LCL_DATE_FNC(( SELECT  MIN(VPS_ETD_DT)
                                        FROM    VSK_VSL_PORT_SKD
                                        WHERE   VSL_CD = A.VSL_CD
                                        AND     SKD_VOY_NO = A.SKD_VOY_NO
                                        AND     SKD_DIR_CD  = A.SKD_DIR_CD
                                        AND     YD_CD = A.YD_CD
                                      ), A.OFC_CD
                                     ),'YYYY-MM-DD HH24:MI') ATD
       , DECODE(A.FM_NOD_CD,NULL,'',A.FM_NOD_CD||'-'||A.VIA_NOD_CD||'-'||A.TO_NOD_CD||'-'||A.DOR_NOD_CD) ROUTE
       , '' NEW_EQ_NO
       , '' NEW_CNTR_SEAL_NO
       , '' CITA_NO
       , '' CNTR_WGT
       , '' N3PTY_CNTR_WGT_UT_CD
       , '' WT_HRS
       , '' NEW_VSL_CD
       , '' NEW_VVD
       , '' NEW_BKG_NO
       , '' DAMAGE_DT
       , '' REPAIR_LOCATION
       , '' LAST_FREE_DT
       , '' PKUP_DT
       , '' FT_OVR_DYS
       , A.CSR_NO
       , A.GL_DT
#if (${s_curr_cd} != '') 
	   , TPB_GET_INV_CURR_CHG_FNC(A.CFM_CURR_CD,@[s_curr_cd],A.OTS_AMT, SYSDATE) AS OTS_AMT
	   , TPB_GET_INV_CURR_CHG_FNC(A.CFM_CURR_CD,@[s_curr_cd],A.OTS_AMT, SYSDATE) AS INV_DTL_AMT
#else 
	   , A.OTS_AMT
	   , A.OTS_AMT INV_DTL_AMT
#end
	   , A.EQ_KND_CD
       , A.FM_NOD_CD
       , A.VIA_NOD_CD
       , A.TO_NOD_CD
       , A.DOR_NOD_CD
       , A.BKG_NO
       , A.BL_NO
       , A.VSL_CD
       , A.SKD_VOY_NO
       , SUBSTR(A.FINC_DIR_CD,1,1) SKD_DIR_CD
       , A.ESTM_SYS_AREA_GRP_ID ESTM_SVR_ID
       , A.OTS_AMT	ORIGINAL_INV_DTL_AMT
       , 0 SO_IF_SEQ
       , A.LGS_COST_CD
       , A.ACCT_CD
       , A.ACCT_CD ACCT_CD_ORG
       , A.SO_NO
       , A.FINC_DIR_CD
       , A.REV_AMT
       , A.OTS_DTL_SEQ
	   , A.N3PTY_EXPN_TP_CD
	   , A.N3PTY_IF_TP_CD
	   , A.ESTM_SEQ_NO
	   , A.ESTM_RVIS_NO
       , ( SELECT CUST_REF_NO_CTNT FROM BKG_REFERENCE R WHERE R.BKG_NO = A.BKG_NO AND R.CNTR_NO = A.EQ_NO AND R.BKG_REF_TP_CD ='MSLD' ) LOD_ID   
FROM     TPB_OTS_DTL A
       , TPB_OTS_GRP B
       , TPB_N3RD_PTY_BIL_TP T
       , MDM_CHARGE G
WHERE    1 = 1
AND      A.N3PTY_NO = B.N3PTY_NO
AND      A.N3PTY_BIL_TP_CD = T.N3PTY_BIL_TP_CD
AND      T.CHG_CD = G.CHG_CD(+)
AND	     A.N3PTY_NO IN ( NULL

#if (${s_dao_n3pty_no} != '')
	                  , $s_dao_n3pty_no
#end

                      )
AND      A.VNDR_CUST_DIV_CD IN ('V','C')
AND      A.N3PTY_DELT_TP_CD = 'N'
AND      EXISTS (
                  SELECT  N3PTY_NO
                  FROM    TPB_OTS_GRP_STS C
                  WHERE   C.N3PTY_NO = A.N3PTY_NO
                  AND     C.OTS_STS_LST_FLG = 'Y'
                  AND     C.OTS_STS_CD IN ('O','M','J')
         )
AND      (    B.N3PTY_INV_NO IS NULL
           OR NOT EXISTS (
                           SELECT  N3PTY_INV_NO
                           FROM    TPB_INVOICE V
                           WHERE   V.N3PTY_INV_NO = B.N3PTY_INV_NO
                         )
         )
ORDER BY A.N3PTY_BIL_TP_CD			]]></sql>
			<params>
				<param name="s_curr_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
