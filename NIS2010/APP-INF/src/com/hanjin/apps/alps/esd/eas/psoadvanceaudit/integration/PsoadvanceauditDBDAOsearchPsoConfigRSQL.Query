<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PsoadvanceauditDBDAOsearchPsoConfigRSQL">
			<desc><![CDATA[Pre-Audit Criterion setting 내역을 조회한다. ]]></desc>
			<sql><![CDATA[
SELECT CHG_TP_NM
     , ACCT_CD
     , ACCT_NM
     , COST_CD
     , COST_NM
     , LGS_COST_AUD_FLG
     , EXPN_MAX_PRMT_RTO
     , EXPN_PRMT_RTO_RSN
     , OFC_CD AS AUD_OFC_CD
	 , UPT_DT
FROM (SELECT CASE WHEN AA.CHG_TP_CD = '01' THEN 'PORT CHARGE'
                  WHEN AA.CHG_TP_CD = '02' THEN 'PORT SERVICE CHARGE'
                  WHEN AA.CHG_TP_CD = '03' THEN 'CANAL TRANSIT FEE'
                  WHEN AA.CHG_TP_CD = '04' THEN 'OTHER'
             END CHG_TP_NM
           , AA.CHG_TP_CD
           , AA.ACCT_CD
           , AA.ACCT_NM
           , AA.COST_CD
           , AA.COST_NM
           , BB.LGS_COST_AUD_FLG
           , BB.EXPN_MAX_PRMT_RTO
           , BB.EXPN_PRMT_RTO_RSN
           , AA.OFC_CD
		   , TO_CHAR(BB.CRE_DT, 'YYYY-MM-DD') UPT_DT
        FROM (SELECT CHG_TP_CD
                   , ACCT_CD
                   , ACCT_NM
                   , COST_CD
                   , COST_NM
                   , OFC_CD       
                FROM (SELECT CASE WHEN LENGTH(T2.LGS_COST_CD) > 4 AND T3.ACCT_ENG_NM NOT LIKE 'OTHER PORT%' AND SUBSTR(TO_CHAR(T2.ACCT_CD),1,4) = '5117' AND T2.ACCT_CD != '511795' THEN '01'
                                  WHEN LENGTH(T2.LGS_COST_CD) > 4 AND T3.ACCT_ENG_NM NOT LIKE 'OTHER PORT%' AND SUBSTR(TO_CHAR(T2.ACCT_CD),1,4) = '5118' THEN '02'
                                  WHEN LENGTH(T2.LGS_COST_CD) > 4 AND T3.ACCT_ENG_NM NOT LIKE 'OTHER PORT%' AND SUBSTR(TO_CHAR(T2.ACCT_CD),1,4) = '5119' THEN '03'
                                  --WHEN T2.ACCT_CD = '564611' OR T3.ACCT_ENG_NM LIKE 'OTHER PORT%' THEN '04'
        				       WHEN T2.ACCT_CD IN ('564611', '511795') OR T3.ACCT_ENG_NM LIKE 'OTHER PORT%' THEN '04'
                             END CHG_TP_CD
                            ,T2.ACCT_CD
                            ,T3.ACCT_ENG_NM AS ACCT_NM
                            ,T2.LGS_COST_CD AS COST_CD
                            ,T2.LGS_COST_FULL_NM AS COST_NM      
                        FROM TES_LGS_COST T2
                            ,MDM_ACCOUNT  T3
                       WHERE T2.ACCT_CD = T3.ACCT_CD
                       #if(${s_chg_tp_cd} != '')
                           #if(${s_chg_tp_cd} == '04')
                               AND T2.ACCT_CD <> '999999'
                           #elseif (${s_chg_tp_cd} != '04') 
                               AND (T2.ACCT_CD <> '999999' AND T2.ACCT_CD <> '511795')
                           #end
                       #end        		              
                               AND ((    LENGTH(T2.LGS_COST_CD) > 4
                                    AND T3.ACCT_ENG_NM NOT LIKE 'OTHER PORT%'
                                    AND SUBSTR(TO_CHAR(T2.ACCT_CD),1,4) IN ('5117', '5118', '5119')
                                    )
                                    OR 
                                    (
                                    T2.ACCT_CD = '564611' OR T3.ACCT_ENG_NM LIKE 'OTHER PORT%'
                                    )) 
                      ) A
                      ,(SELECT OFC_CD
                        FROM MDM_ORGANIZATION
                        WHERE  OFC_TP_CD =  'HQ'
                      ) B
            ) AA
            , EAS_PORT_SO_CHG_ACCT BB
       WHERE AA.COST_CD = BB.LGS_COST_CD(+)
       AND   AA.OFC_CD =  BB.AUD_OFC_CD(+)
#if(${s_chg_tp_cd} != '')
   #if(${s_chg_tp_cd} == '04')
       AND (AA.CHG_TP_CD = @[s_chg_tp_cd] OR AA.ACCT_CD = '511795') -- Charge Type (옵션)
   #elseif (${s_chg_tp_cd} != '04') 
       AND AA.CHG_TP_CD = @[s_chg_tp_cd] -- Charge Type (옵션)
   #end
#end       
       )
WHERE 1=1
#if(${s_auto_acd} == 'Y')
    AND LGS_COST_AUD_FLG = 'Y'
#end
#if(${s_auto_acd} == 'N')
    AND LGS_COST_AUD_FLG = 'N'
#end
#if(${s_aud_ofc_cd} != '')
    AND OFC_CD = @[s_aud_ofc_cd]
#end       
ORDER BY CHG_TP_CD, ACCT_CD, COST_CD ASC			]]></sql>
			<params>
				<param name="s_chg_tp_cd" type="12" value="" out="N"/>
				<param name="s_aud_ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
