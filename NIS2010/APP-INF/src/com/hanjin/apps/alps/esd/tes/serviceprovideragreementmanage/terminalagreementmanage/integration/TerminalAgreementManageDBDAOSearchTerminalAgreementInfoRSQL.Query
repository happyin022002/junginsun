<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TerminalAgreementManageDBDAOSearchTerminalAgreementInfoRSQL">
			<desc><![CDATA[TerminalAgreementManage화면에 대한 조회 이벤트 처리]]></desc>
			<sql><![CDATA[
SELECT	a.tml_agmt_ofc_cty_cd
-- || LPAD(a.tml_agmt_seq, 5, '0') tml_agmt_ofc_cty_cd
		, LPAD(a.tml_agmt_seq, 5, '0')	tml_agmt_seq
		, CASE WHEN LENGTH(a.tml_agmt_ver_no) = 3 
				THEN LPAD(SUBSTR( a.tml_agmt_ver_no, 0, 1 ), 2, '0') || '.' || SUBSTR( a.tml_agmt_ver_no, 2, 2 )
				ELSE SUBSTR( a.tml_agmt_ver_no, 0, 2 ) || '.' || SUBSTR( a.tml_agmt_ver_no, 3, 2 )
		  END tml_agmt_ver_no
		, a.yd_cd                                                   						
		, d.yd_nm									 										
		, LPAD(a.vndr_seq, 6, '0') vndr_seq                           						
		, e.vndr_lgl_eng_nm									 								
		, TO_CHAR(a.eff_fm_dt,'YYYY-MM-DD')	eff_fm_dt										
		, TO_CHAR(a.eff_to_dt,'YYYY-MM-DD')	eff_to_dt	 									
		, a.auto_xtd_flg											 						
		, a.ctrt_ofc_cd                                             						
		, a.agmt_rmk                                                						
		, a.tml_agmt_sts_cd                                         						
		, b.lgs_cost_cd                                             						
		, b.auto_calc_flg                                           						
		, b.tml_agmt_vol_ut_cd 																
		, b.curr_cd                                                 						
		, b.thrp_cost_cd_flg                                        						
		, b.tml_sto_agmt_tp_cd                                      						
--		, b.tml_sto_agmt_tp_cd                                      						
		, b.cmnc_hrmnt                                             	 						
		, b.tml_agmt_tp_cd 							                						
		, a.cre_ofc_cd
		, a.CRE_USR_ID
		, TO_CHAR(a.agmt_apro_dt, 'YYYY-MM-DD') agmt_apro_dt
		, TO_CHAR(a.agmt_cfm_dt, 'YYYY-MM-DD') agmt_cfm_dt
		, agmt_cfm_usr_nm
		, agmt_cfm_usr_id	 							                						
		, agmt_cfm_flg
-- 비용지급 전표 결재 기능 - 3차 추가(4347-09-25)
		, agmt_doc_no
		, agmt_doc_desc
		, agmt_doc_eff_fm_dt
		, agmt_doc_eff_to_dt
FROM	TES_TML_AGMT_HDR a
		, (SELECT	tml_agmt_ofc_cty_cd
				, tml_agmt_seq
				, tml_agmt_ver_no
				, lgs_cost_cd
				, auto_calc_flg
				, tml_agmt_vol_ut_cd       													
				, curr_cd                  													
				, thrp_cost_cd_flg
				, tml_sto_agmt_tp_cd
				, cmnc_hrmnt               													
				, tml_agmt_tp_cd           													
		FROM	TES_TML_AGMT_DTL
		WHERE	tmp_sav_flg		= 'Y'   
		AND		tml_agmt_tp_cd	= @[tml_agmt_tp_cd]
		ORDER BY cre_dt DESC
		) b
		, (SELECT	MAX(tml_agmt_ver_no) tml_agmt_ver_no,  MAX(tml_agmt_seq) tml_agmt_seq  
		FROM	TES_TML_AGMT_HDR
#if ( ${tml_agmt_ofc_cty_cd} != '' and ${tml_agmt_ver_no} != ''  ) 
		WHERE	tml_agmt_ofc_cty_cd	= @[tml_agmt_ofc_cty_cd]
		AND		tml_agmt_seq		= @[tml_agmt_seq]
		AND		tml_agmt_ver_no		= @[tml_agmt_ver_no]        				
#else 
		WHERE	yd_cd				= @[yd_cd]	
		AND		vndr_seq			= @[vndr_seq]     				
#end
		AND		delt_flg			= 'N'
		) c
 		, MDM_YARD d  
 		, MDM_VENDOR e
WHERE	a.delt_flg			= 'N'
#if ( ${tml_agmt_ofc_cty_cd} != '' and ${tml_agmt_ver_no} != '' ) 
AND		a.tml_agmt_ofc_cty_cd	= @[tml_agmt_ofc_cty_cd]
AND		a.tml_agmt_seq			= @[tml_agmt_seq]
AND		a.tml_agmt_ver_no		= @[tml_agmt_ver_no]
#else 
AND		a.yd_cd					= @[yd_cd]						            
AND		a.vndr_seq				= @[vndr_seq]				
#end
AND		a.tml_agmt_seq			= c.tml_agmt_seq				
AND		a.tml_agmt_ver_no		= c.tml_agmt_ver_no			
AND		a.tml_agmt_ofc_cty_cd	= b.tml_agmt_ofc_cty_cd(+)	
AND		a.tml_agmt_seq			= b.tml_agmt_seq(+)	 		      	
AND		a.tml_agmt_ver_no		= b.tml_agmt_ver_no(+)	    	
AND		a.yd_cd					= d.yd_cd			 											            
AND		a.vndr_seq				= e.vndr_seq			]]></sql>
			<params>
				<param name="tml_agmt_tp_cd" type="12" value="T" out="N"/>
				<param name="tml_agmt_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="tml_agmt_seq" type="2" value="" out="N"/>
				<param name="tml_agmt_ver_no" type="2" value="" out="N"/>
				<param name="yd_cd" type="12" value="SGSINKA" out="N"/>
				<param name="vndr_seq" type="2" value="112931" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
