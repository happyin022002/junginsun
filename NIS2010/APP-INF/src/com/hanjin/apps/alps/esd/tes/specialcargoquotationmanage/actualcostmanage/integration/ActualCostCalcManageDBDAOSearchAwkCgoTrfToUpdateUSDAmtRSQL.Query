<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ActualCostCalcManageDBDAOSearchAwkCgoTrfToUpdateUSDAmtRSQL">
			<desc><![CDATA[USD환율 변경으로 인한 AMT 차이를 감지하여 UPDATE 대상 조회]]></desc>
			<sql><![CDATA[
SELECT 
I.YD_CD
, I.TML_AWK_CGO_TRF_TP_CD
, I.IO_BND_CD
, I.IO_GA_CD
, I.TML_AWK_TS_CD
, I.COND_NO
, I.TML_AWK_TRF_VER_NO
, I.TML_ACT_COST_SEQ
, I.CALC_RMK
, I.LST_UPD_USR_ID
--, I.LST_UPD_DT
, I.CRE_USR_ID
, I.CRE_DT
, I.UPD_USR_ID
, TO_CHAR(SYSDATE,'YYYYMM') USD_XCH_DT
, I.MAN_LOCL_CURR_CD
, I.MAN_LOCL_AMT_20FT
, I.MAN_LOCL_AMT_40FT
, I.MAN_USD_AMT_20FT_NEW
, I.MAN_USD_AMT_40FT_NEW
, I.MAN_USD_AMT_20FT MAN_USD_AMT_20FT_OLD
, I.MAN_USD_AMT_40FT MAN_USD_AMT_40FT_OLD
, I.TMP_MAN_USD_AMT_20FT
, I.TMP_MAN_USD_AMT_40FT
,
CASE
WHEN I.CHK_DIFF_MAN_USD_AMT_20FT = 'Y'
THEN I.MAN_USD_AMT_20FT_NEW
ELSE I.MAN_USD_AMT_20FT
END MAN_USD_AMT_20FT
,
CASE
WHEN I.CHK_DIFF_MAN_USD_AMT_40FT = 'Y'
THEN I.MAN_USD_AMT_40FT_NEW
ELSE I.MAN_USD_AMT_40FT
END MAN_USD_AMT_40FT
, I.AUTO_USD_AMT_20FT
, I.AUTO_USD_AMT_40FT
, I.TTL_LOCL_CURR_CD
, I.TTL_LOCL_AMT_20FT
, I.TTL_LOCL_AMT_40FT
, I.TTL_USD_AMT_20FT_NEW
, I.TTL_USD_AMT_40FT_NEW
, I.TTL_USD_AMT_20FT TTL_USD_AMT_20FT_OLD
, I.TTL_USD_AMT_40FT TTL_USD_AMT_40FT_OLD
, I.TMP_TTL_USD_AMT_20FT
, I.TMP_TTL_USD_AMT_40FT
,
CASE
WHEN I.CHK_DIFF_TTL_USD_AMT_20FT = 'Y'
THEN I.TTL_USD_AMT_20FT_NEW
ELSE I.TTL_USD_AMT_20FT
END TTL_USD_AMT_20FT
,
CASE
WHEN I.CHK_DIFF_TTL_USD_AMT_40FT = 'Y'
THEN I.TTL_USD_AMT_40FT_NEW
ELSE I.TTL_USD_AMT_40FT
END TTL_USD_AMT_40FT
, I.APLY_RTO
, I.FML_LOCL_CURR_CD
, I.FML_LOCL_AMT_20FT
, I.FML_LOCL_AMT_40FT
, I.FML_USD_AMT_20FT_NEW
, I.FML_USD_AMT_40FT_NEW
, I.FML_USD_AMT_20FT FML_USD_AMT_20FT_OLD
, I.FML_USD_AMT_40FT FML_USD_AMT_40FT_OLD
, I.TMP_FML_USD_AMT_20FT
, I.TMP_FML_USD_AMT_40FT
,
CASE
WHEN I.CHK_DIFF_FML_USD_AMT_20FT = 'Y'
THEN I.FML_USD_AMT_20FT_NEW
ELSE I.FML_USD_AMT_20FT
END FML_USD_AMT_20FT
,
CASE
WHEN I.CHK_DIFF_FML_USD_AMT_40FT = 'Y'
THEN I.FML_USD_AMT_40FT_NEW
ELSE I.FML_USD_AMT_40FT
END FML_USD_AMT_40FT
, I.CALC_USD_AMT_20FT CALC_USD_AMT_20FT_OLD 
, I.CALC_USD_AMT_40FT CALC_USD_AMT_40FT_OLD
,
CASE
WHEN I.TML_AWK_CGO_TRF_TP_CD = 'B'
THEN CASE
     WHEN NVL(TMP_TTL_USD_AMT_20FT,0) <> 0
     THEN NVL(I.TMP_TTL_USD_AMT_20FT,0) - I.TMP_MAN_USD_AMT_20FT
     ELSE CASE
          WHEN NVL(I.APLY_RTO,0) <> 0
          THEN NVL(I.APLY_RTO,0) * 0.01 * NVL(I.TMP_MAN_USD_AMT_20FT,0) + NVL(I.TMP_FML_USD_AMT_20FT,0)
          ELSE CASE
               WHEN NVL(I.TMP_FML_USD_AMT_20FT,0) <> 0
               THEN NVL(I.TMP_FML_USD_AMT_20FT,0)
               ELSE 0
               END
          END
     END
WHEN I.TML_AWK_CGO_TRF_TP_CD = 'T'
THEN I.CALC_USD_AMT_20FT
ELSE TO_NUMBER('')
END CALC_USD_AMT_20FT
,
CASE
WHEN I.TML_AWK_CGO_TRF_TP_CD = 'B'
THEN CASE
     WHEN NVL(TMP_TTL_USD_AMT_40FT,0) <> 0
     THEN NVL(I.TMP_TTL_USD_AMT_40FT,0) - I.TMP_MAN_USD_AMT_40FT
     ELSE CASE
          WHEN NVL(I.APLY_RTO,0) <> 0
          THEN NVL(I.APLY_RTO,0) * 0.01 * NVL(I.TMP_MAN_USD_AMT_40FT,0) + NVL(I.TMP_FML_USD_AMT_40FT,0)
          ELSE CASE
               WHEN NVL(I.TMP_FML_USD_AMT_40FT,0) <> 0
               THEN NVL(I.TMP_FML_USD_AMT_40FT,0)
               ELSE 0
               END
          END
     END
WHEN I.TML_AWK_CGO_TRF_TP_CD = 'T'
THEN I.CALC_USD_AMT_40FT
ELSE TO_NUMBER('')
END CALC_USD_AMT_40FT
, I.SUM_USD_AMT_20FT SUM_USD_AMT_20FT_OLD
, I.SUM_USD_AMT_40FT SUM_USD_AMT_40FT_OLD
,
CASE
WHEN I.TML_AWK_CGO_TRF_TP_CD = 'B'
THEN CASE
     WHEN NVL(TMP_TTL_USD_AMT_20FT,0) <> 0
     THEN NVL(I.TMP_TTL_USD_AMT_20FT,0)
     ELSE CASE
          WHEN NVL(I.APLY_RTO,0) <> 0
          THEN NVL(I.TMP_MAN_USD_AMT_20FT,0) + (NVL(I.APLY_RTO,0) * 0.01 * NVL(I.TMP_MAN_USD_AMT_20FT,0)) + NVL(I.TMP_FML_USD_AMT_20FT,0)
          ELSE CASE
               WHEN NVL(I.TMP_FML_USD_AMT_20FT,0) <> 0
               THEN NVL(I.TMP_MAN_USD_AMT_20FT,0) + NVL(I.TMP_FML_USD_AMT_20FT,0)
               ELSE NVL(TMP_MAN_USD_AMT_20FT,0)
               END
          END
     END
WHEN I.TML_AWK_CGO_TRF_TP_CD = 'T'
THEN I.TMP_MAN_USD_AMT_20FT
ELSE TO_NUMBER('')
END SUM_USD_AMT_20FT
,
CASE
WHEN I.TML_AWK_CGO_TRF_TP_CD = 'B'
THEN CASE
     WHEN NVL(TMP_TTL_USD_AMT_40FT,0) <> 0
     THEN NVL(I.TMP_TTL_USD_AMT_40FT,0)
     ELSE CASE
          WHEN NVL(I.APLY_RTO,0) <> 0
          THEN NVL(I.TMP_MAN_USD_AMT_40FT,0) + (NVL(I.APLY_RTO,0) * 0.01 * NVL(I.TMP_MAN_USD_AMT_40FT,0)) + NVL(I.TMP_FML_USD_AMT_40FT,0)
          ELSE CASE
               WHEN NVL(I.TMP_FML_USD_AMT_40FT,0) <> 0
               THEN NVL(I.TMP_MAN_USD_AMT_40FT,0) + NVL(I.TMP_FML_USD_AMT_40FT,0)
               ELSE NVL(TMP_MAN_USD_AMT_40FT,0)
               END
          END
     END
WHEN I.TML_AWK_CGO_TRF_TP_CD = 'T'
THEN I.TMP_MAN_USD_AMT_40FT
ELSE TO_NUMBER('')
END SUM_USD_AMT_40FT
FROM (
SELECT 
CASE
WHEN J.TML_AWK_CGO_TRF_TP_CD = 'B'
THEN CASE
     WHEN NVL(J.MAN_USD_AMT_20FT,0) <> 0
     THEN DECODE(J.CHK_DIFF_MAN_USD_AMT_20FT,'Y',J.MAN_USD_AMT_20FT_NEW,J.MAN_USD_AMT_20FT)
     WHEN NVL(J.AUTO_USD_AMT_20FT,0) <> 0
     THEN NVL(J.AUTO_USD_AMT_20FT,0)
     ELSE TO_NUMBER('')
     END
WHEN J.TML_AWK_CGO_TRF_TP_CD = 'T'
THEN CASE
     WHEN NVL(J.MAN_USD_AMT_20FT,0) <> 0
     THEN DECODE(J.CHK_DIFF_MAN_USD_AMT_20FT,'Y',J.MAN_USD_AMT_20FT_NEW,J.MAN_USD_AMT_20FT)
     WHEN NVL(J.AUTO_USD_AMT_20FT,0) <> 0
     THEN NVL(J.AUTO_USD_AMT_20FT,0)
     ELSE TO_NUMBER('')
     END
ELSE TO_NUMBER('')
END TMP_MAN_USD_AMT_20FT
,
CASE
WHEN J.TML_AWK_CGO_TRF_TP_CD = 'B'
THEN CASE
     WHEN NVL(J.MAN_USD_AMT_40FT,0) <> 0
     THEN DECODE(J.CHK_DIFF_MAN_USD_AMT_40FT,'Y',J.MAN_USD_AMT_40FT_NEW,J.MAN_USD_AMT_40FT)
     WHEN NVL(J.AUTO_USD_AMT_40FT,0) <> 0
     THEN NVL(J.AUTO_USD_AMT_40FT,0)
     ELSE TO_NUMBER('')
     END
WHEN J.TML_AWK_CGO_TRF_TP_CD = 'T'
THEN CASE
     WHEN NVL(J.MAN_USD_AMT_40FT,0) <> 0
     THEN DECODE(J.CHK_DIFF_MAN_USD_AMT_40FT,'Y',J.MAN_USD_AMT_40FT_NEW,J.MAN_USD_AMT_40FT)
     WHEN NVL(J.AUTO_USD_AMT_40FT,0) <> 0
     THEN NVL(J.AUTO_USD_AMT_40FT,0)
     ELSE TO_NUMBER('')
     END
ELSE TO_NUMBER('')
END TMP_MAN_USD_AMT_40FT
, J.CHK_DIFF_MAN_USD_AMT_20FT
, J.CHK_DIFF_MAN_USD_AMT_40FT
, J.CHK_DIFF_TTL_USD_AMT_20FT
, J.CHK_DIFF_TTL_USD_AMT_40FT
, J.CHK_DIFF_FML_USD_AMT_20FT
, J.CHK_DIFF_FML_USD_AMT_40FT
, J.YD_CD
, J.TML_AWK_CGO_TRF_TP_CD
, J.IO_BND_CD
, J.IO_GA_CD
, J.TML_AWK_TS_CD
, J.COND_NO
, J.TML_AWK_TRF_VER_NO
, J.MAN_LOCL_CURR_CD
, J.MAN_LOCL_AMT_20FT
, J.MAN_LOCL_AMT_40FT
, J.MAN_USD_AMT_20FT_NEW
, J.MAN_USD_AMT_40FT_NEW
, J.MAN_USD_AMT_20FT
, J.MAN_USD_AMT_40FT
, J.AUTO_USD_AMT_20FT
, J.AUTO_USD_AMT_40FT
, J.TTL_LOCL_CURR_CD
, J.TTL_LOCL_AMT_20FT
, J.TTL_LOCL_AMT_40FT
, J.TTL_USD_AMT_20FT_NEW
, J.TTL_USD_AMT_40FT_NEW
, J.TTL_USD_AMT_20FT
, J.TTL_USD_AMT_40FT
,
CASE
WHEN J.TML_AWK_CGO_TRF_TP_CD = 'B'
THEN CASE
     WHEN NVL(J.TTL_USD_AMT_20FT,0) <> 0
     THEN DECODE(J.CHK_DIFF_TTL_USD_AMT_20FT,'Y',J.TTL_USD_AMT_20FT_NEW,J.TTL_USD_AMT_20FT)
     ELSE TO_NUMBER('')
     END
ELSE TO_NUMBER('')
END TMP_TTL_USD_AMT_20FT
,
CASE
WHEN J.TML_AWK_CGO_TRF_TP_CD = 'B'
THEN CASE
     WHEN NVL(J.TTL_USD_AMT_40FT,0) <> 0
     THEN DECODE(J.CHK_DIFF_TTL_USD_AMT_40FT,'Y',J.TTL_USD_AMT_40FT_NEW,J.TTL_USD_AMT_40FT)
     ELSE TO_NUMBER('')
     END
ELSE TO_NUMBER('')
END TMP_TTL_USD_AMT_40FT
, J.APLY_RTO
, J.FML_LOCL_CURR_CD
, J.FML_LOCL_AMT_20FT
, J.FML_LOCL_AMT_40FT
, J.FML_USD_AMT_20FT_NEW
, J.FML_USD_AMT_40FT_NEW
, J.FML_USD_AMT_20FT
, J.FML_USD_AMT_40FT
,
CASE
WHEN J.TML_AWK_CGO_TRF_TP_CD = 'B'
THEN CASE
     WHEN NVL(J.FML_USD_AMT_20FT,0) <> 0
     THEN DECODE(J.CHK_DIFF_FML_USD_AMT_20FT,'Y',J.FML_USD_AMT_20FT_NEW,J.FML_USD_AMT_20FT)
     ELSE TO_NUMBER('')
     END
ELSE TO_NUMBER('')
END TMP_FML_USD_AMT_20FT
,
CASE
WHEN J.TML_AWK_CGO_TRF_TP_CD = 'B'
THEN CASE
     WHEN NVL(J.FML_USD_AMT_40FT,0) <> 0
     THEN DECODE(J.CHK_DIFF_FML_USD_AMT_40FT,'Y',J.FML_USD_AMT_40FT_NEW,J.FML_USD_AMT_40FT)
     ELSE TO_NUMBER('')
     END
ELSE TO_NUMBER('')
END TMP_FML_USD_AMT_40FT
, J.CALC_USD_AMT_20FT
, J.CALC_USD_AMT_40FT
, J.SUM_USD_AMT_20FT
, J.SUM_USD_AMT_40FT
, J.TML_ACT_COST_SEQ
, J.CALC_RMK
, J.LST_UPD_USR_ID
--, J.LST_UPD_DT
, J.UPD_USR_ID
, J.CRE_USR_ID
, J.CRE_DT
FROM (
SELECT 
CASE
WHEN K.MAN_LOCL_CURR_CD IS NOT NULL AND NVL(K.MAN_LOCL_AMT_20FT,0) <> 0 AND NVL(K.MAN_USD_AMT_20FT,0) <> 0 AND NVL(K.MAN_USD_AMT_20FT_NEW,0) <> NVL(K.MAN_USD_AMT_20FT,0)
THEN 'Y'
ELSE 'N'
END CHK_DIFF_MAN_USD_AMT_20FT,
CASE
WHEN K.MAN_LOCL_CURR_CD IS NOT NULL AND NVL(K.MAN_LOCL_AMT_40FT,0) <> 0 AND NVL(K.MAN_USD_AMT_40FT,0) <> 0 AND NVL(K.MAN_USD_AMT_40FT_NEW,0) <> NVL(K.MAN_USD_AMT_40FT,0)
THEN 'Y'
ELSE 'N'
END CHK_DIFF_MAN_USD_AMT_40FT,
CASE
WHEN K.TTL_LOCL_CURR_CD IS NOT NULL AND NVL(K.TTL_LOCL_AMT_20FT,0) <> 0 AND NVL(K.TTL_USD_AMT_20FT,0) <> 0 AND NVL(K.TTL_USD_AMT_20FT_NEW,0) <> NVL(K.TTL_USD_AMT_20FT,0)
THEN 'Y'
ELSE 'N'
END CHK_DIFF_TTL_USD_AMT_20FT,
CASE
WHEN K.TTL_LOCL_CURR_CD IS NOT NULL AND NVL(K.TTL_LOCL_AMT_40FT,0) <> 0 AND NVL(K.TTL_USD_AMT_40FT,0) <> 0 AND NVL(K.TTL_USD_AMT_40FT_NEW,0) <> NVL(K.TTL_USD_AMT_40FT,0)
THEN 'Y'
ELSE 'N'
END CHK_DIFF_TTL_USD_AMT_40FT,
CASE
WHEN K.FML_LOCL_CURR_CD IS NOT NULL AND NVL(K.FML_LOCL_AMT_20FT,0) <> 0 AND NVL(K.FML_USD_AMT_20FT,0) <> 0 AND NVL(K.FML_USD_AMT_20FT_NEW,0) <> NVL(K.FML_USD_AMT_20FT,0)
THEN 'Y'
ELSE 'N'
END CHK_DIFF_FML_USD_AMT_20FT,
CASE
WHEN K.FML_LOCL_CURR_CD IS NOT NULL AND NVL(K.FML_LOCL_AMT_40FT,0) <> 0 AND NVL(K.FML_USD_AMT_40FT,0) <> 0 AND NVL(K.FML_USD_AMT_40FT_NEW,0) <> NVL(K.FML_USD_AMT_40FT,0)
THEN 'Y'    
ELSE 'N'
END CHK_DIFF_FML_USD_AMT_40FT
, K.*
FROM (
    SELECT
      AD.YD_CD ,
      X.TML_AWK_CGO_TRF_TP_CD ,
      X.IO_BND_CD,
      X.IO_GA_CD ,
      X.TML_AWK_TS_CD ,
      X.COND_NO ,
      X.TML_AWK_TRF_VER_NO ,
      X.MAN_LOCL_CURR_CD ,
      X.MAN_LOCL_AMT_20FT ,
      X.MAN_LOCL_AMT_40FT ,      
      TES_GET_USD_XCH_AMT_FNC(X.MAN_LOCL_CURR_CD,X.MAN_LOCL_AMT_20FT) MAN_USD_AMT_20FT_NEW,
      TES_GET_USD_XCH_AMT_FNC(X.MAN_LOCL_CURR_CD,X.MAN_LOCL_AMT_40FT) MAN_USD_AMT_40FT_NEW,
      X.MAN_USD_AMT_20FT ,
      X.MAN_USD_AMT_40FT ,
      X.AUTO_USD_AMT_20FT ,
      X.AUTO_USD_AMT_40FT ,
      X.TTL_LOCL_CURR_CD ,
      X.TTL_LOCL_AMT_20FT ,
      X.TTL_LOCL_AMT_40FT ,
      TES_GET_USD_XCH_AMT_FNC(X.TTL_LOCL_CURR_CD,X.TTL_LOCL_AMT_20FT) TTL_USD_AMT_20FT_NEW,
      TES_GET_USD_XCH_AMT_FNC(X.TTL_LOCL_CURR_CD,X.TTL_LOCL_AMT_40FT) TTL_USD_AMT_40FT_NEW,
      X.TTL_USD_AMT_20FT ,
      X.TTL_USD_AMT_40FT ,
      AD.APLY_RTO ,
      X.FML_LOCL_CURR_CD ,
      X.FML_LOCL_AMT_20FT ,
      X.FML_LOCL_AMT_40FT ,
      TES_GET_USD_XCH_AMT_FNC(X.FML_LOCL_CURR_CD,X.FML_LOCL_AMT_20FT) FML_USD_AMT_20FT_NEW,
      TES_GET_USD_XCH_AMT_FNC(X.FML_LOCL_CURR_CD,X.FML_LOCL_AMT_40FT) FML_USD_AMT_40FT_NEW,
      X.FML_USD_AMT_20FT ,
      X.FML_USD_AMT_40FT ,
      X.CALC_USD_AMT_20FT ,
      X.CALC_USD_AMT_40FT ,
      X.SUM_USD_AMT_20FT ,
      X.SUM_USD_AMT_40FT ,
      AD.TML_ACT_COST_SEQ,
      AD.CALC_RMK ,
      AD.LST_UPD_USR_ID ,
--      TO_CHAR(AD.LST_UPD_DT, 'YYYY-MM-DD') LST_UPD_DT ,
      AD.CRE_USR_ID,
      TO_CHAR(AD.CRE_DT, 'YYYYMMDDHH24MISS') CRE_DT,
      AD.UPD_USR_ID     
    FROM TES_AWK_CGO_TRF_HDR AH, TES_AWK_CGO_TRF_DTL AD,
      ( SELECT 
          /** HDR + DTL **/ 
          T.YD_CD,
          T.TML_AWK_CGO_TRF_TP_CD,
          T.IO_BND_CD,
          T.IO_GA_CD,
          T.TML_AWK_TS_CD,
          T.COND_NO,
          MAX(T.TML_AWK_TRF_VER_NO) TML_AWK_TRF_VER_NO,
          /** UNIT COST MANUAL (LOCL CURR) **/ 
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'M' THEN T.LOCL_CURR_CD END) MAN_LOCL_CURR_CD,
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'M' THEN DECODE(T.CNTR_SZ_CD, '2', T.LOCL_CURR_AMT, '') END) MAN_LOCL_AMT_20FT,
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'M' THEN DECODE(T.CNTR_SZ_CD, '4', T.LOCL_CURR_AMT, '') END) MAN_LOCL_AMT_40FT,
          /** UNIT COST MANUAL (USD) **/ 
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'M' THEN DECODE(T.CNTR_SZ_CD, '2', T.USD_AMT, '') END) MAN_USD_AMT_20FT,
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'M' THEN DECODE(T.CNTR_SZ_CD, '4', T.USD_AMT, '') END) MAN_USD_AMT_40FT,
          /** UNIT COST AUTO (USD) **/ 
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'A' THEN DECODE(T.CNTR_SZ_CD, '2', T.USD_AMT, '') END) AUTO_USD_AMT_20FT,
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'A' THEN DECODE(T.CNTR_SZ_CD, '4', T.USD_AMT, '') END) AUTO_USD_AMT_40FT,
          /** TOTAL (LOCL CURR) **/ 
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'T' THEN T.LOCL_CURR_CD END) TTL_LOCL_CURR_CD,
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'T' THEN DECODE(T.CNTR_SZ_CD, '2', T.LOCL_CURR_AMT, '') END) TTL_LOCL_AMT_20FT,
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'T' THEN DECODE(T.CNTR_SZ_CD, '4', T.LOCL_CURR_AMT, '') END) TTL_LOCL_AMT_40FT,
          /** TOTAL (USD) **/ 
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'T' THEN DECODE(T.CNTR_SZ_CD, '2', T.USD_AMT, '') END) TTL_USD_AMT_20FT,
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'T' THEN DECODE(T.CNTR_SZ_CD, '4', T.USD_AMT, '') END) TTL_USD_AMT_40FT,
          /** FORMULA (LOCL CURR) **/ 
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'F' THEN T.LOCL_CURR_CD END) FML_LOCL_CURR_CD,
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'F' THEN DECODE(T.CNTR_SZ_CD, '2', T.LOCL_CURR_AMT, '') END) FML_LOCL_AMT_20FT,
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'F' THEN DECODE(T.CNTR_SZ_CD, '4', T.LOCL_CURR_AMT, '') END) FML_LOCL_AMT_40FT,
          /** FORMULA (USD) **/ 
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'F' THEN DECODE(T.CNTR_SZ_CD, '2', T.USD_AMT, '') END) FML_USD_AMT_20FT,
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'F' THEN DECODE(T.CNTR_SZ_CD, '4', T.USD_AMT, '') END) FML_USD_AMT_40FT,
          /** APPLIED EXTRA COST (USD) **/ 
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'C' THEN DECODE(T.CNTR_SZ_CD, '2', T.USD_AMT, '') END) CALC_USD_AMT_20FT,
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'C' THEN DECODE(T.CNTR_SZ_CD, '4', T.USD_AMT, '') END) CALC_USD_AMT_40FT,
          /** TOTAL HANDLING COST (USD) **/ 
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'S' THEN DECODE(T.CNTR_SZ_CD, '2', T.USD_AMT, '') END) SUM_USD_AMT_20FT,
          MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'S' THEN DECODE(T.CNTR_SZ_CD, '4', T.USD_AMT, '') END) SUM_USD_AMT_40FT-- ,
        FROM TES_AWK_CGO_TRF_HDR H, TES_AWK_CGO_TRF_DTL D, TES_AWK_CGO_TRF_TP_SZ T
        WHERE 1=1
          AND H.YD_CD = D.YD_CD
          AND NVL(H.DELT_FLG, 'N') <> 'Y'
          AND D.YD_CD = T.YD_CD
          AND D.TML_AWK_CGO_TRF_TP_CD = T.TML_AWK_CGO_TRF_TP_CD
          AND D.IO_BND_CD = T.IO_BND_CD
          AND D.IO_GA_CD = T.IO_GA_CD
          AND D.TML_AWK_TS_CD = T.TML_AWK_TS_CD
          AND D.COND_NO = T.COND_NO
          AND D.TML_AWK_TRF_VER_NO = T.TML_AWK_TRF_VER_NO
          AND D.TML_AWK_TRF_VER_NO = (
            SELECT MAX(XD.TML_AWK_TRF_VER_NO)
            FROM TES_AWK_CGO_TRF_HDR XH, TES_AWK_CGO_TRF_DTL XD
            WHERE 1=1
              AND XH.YD_CD = XD.YD_CD
              AND NVL(XH.DELT_FLG, 'N') <> 'Y'
              AND XD.YD_CD = D.YD_CD
              AND XD.TML_AWK_CGO_TRF_TP_CD = D.TML_AWK_CGO_TRF_TP_CD
              AND XD.IO_BND_CD = D.IO_BND_CD
              AND XD.IO_GA_CD = D.IO_GA_CD
              AND XD.TML_AWK_TS_CD = D.TML_AWK_TS_CD
              AND XD.COND_NO = D.COND_NO )
        GROUP BY T.YD_CD, T.TML_AWK_CGO_TRF_TP_CD, T.IO_BND_CD, T.IO_GA_CD, T.TML_AWK_TS_CD, T.COND_NO ) X
    WHERE 1=1
      AND AH.YD_CD = AD.YD_CD
      AND NVL(AH.DELT_FLG, 'N') <> 'Y'
      AND AH.YD_CD >= ' '
      AND AH.YD_CD LIKE '%'||'%'
      --AND AH.YD_CD LIKE 'CNYITY1'||'%' --// test
      AND AD.TML_AWK_CGO_TRF_TP_CD = @[tml_awk_cgo_trf_tp_cd]
      AND AD.TML_AWK_TRF_VER_NO = (
        SELECT MAX(XD.TML_AWK_TRF_VER_NO)
        FROM TES_AWK_CGO_TRF_HDR XH, TES_AWK_CGO_TRF_DTL XD
        WHERE 1=1
          AND XH.YD_CD = XD.YD_CD
          AND NVL(XH.DELT_FLG, 'N') <> 'Y'
          AND XD.YD_CD = AD.YD_CD
          AND XD.TML_AWK_CGO_TRF_TP_CD = AD.TML_AWK_CGO_TRF_TP_CD
          AND XD.IO_BND_CD = AD.IO_BND_CD
          AND XD.IO_GA_CD = AD.IO_GA_CD
          AND XD.TML_AWK_TS_CD = AD.TML_AWK_TS_CD
          AND XD.COND_NO = AD.COND_NO )
      AND AD.YD_CD = X.YD_CD
      AND AD.TML_AWK_CGO_TRF_TP_CD = X.TML_AWK_CGO_TRF_TP_CD
      AND AD.IO_BND_CD = X.IO_BND_CD
      AND AD.IO_GA_CD = X.IO_GA_CD
      AND AD.TML_AWK_TS_CD = X.TML_AWK_TS_CD
      AND AD.COND_NO = X.COND_NO
) K
WHERE 1=1
) J
) I
WHERE 1=1
AND CASE
    WHEN I.CHK_DIFF_MAN_USD_AMT_20FT = 'Y' OR I.CHK_DIFF_MAN_USD_AMT_40FT = 'Y' OR I.CHK_DIFF_TTL_USD_AMT_20FT = 'Y' OR I.CHK_DIFF_TTL_USD_AMT_40FT = 'Y' OR I.CHK_DIFF_FML_USD_AMT_20FT = 'Y' OR I.CHK_DIFF_FML_USD_AMT_40FT = 'Y'
    THEN 'Y'
    ELSE 'N'
    END = 'Y'
ORDER BY I.TML_AWK_CGO_TRF_TP_CD, I.YD_CD, I.IO_BND_CD, I.IO_GA_CD, I.TML_AWK_TS_CD, I.COND_NO, I.TML_AWK_TRF_VER_NO			]]></sql>
			<params>
				<param name="tml_awk_cgo_trf_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
