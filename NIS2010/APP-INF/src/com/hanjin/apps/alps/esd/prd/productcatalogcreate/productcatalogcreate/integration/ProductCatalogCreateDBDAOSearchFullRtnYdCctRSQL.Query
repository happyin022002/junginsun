<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ProductCatalogCreateDBDAOSearchFullRtnYdCctRSQL">
			<desc><![CDATA[SearchFullRtnYdCct]]></desc>
			<sql><![CDATA[
WITH CCT AS
(
    SELECT ARR_ST_DT -12/24 AS CCT, D.ORG_NOD_CD FULL_RTN_YD_CD,M.DG_SPCL_FLG,M.RF_SPCL_FLG
    FROM PRD_PROD_CTL_ROUT_DTL D, PRD_PROD_CTL_MST M
    WHERE D.PCTL_NO = @[pctl_no] --'B0912210000296960001'
    AND D.NOD_LNK_DIV_CD ='N'
    AND D.PCTL_NO = M.PCTL_NO
    AND D.ORG_NOD_CD =m.FULL_RTN_YD_CD
    AND D.MTY_YD_FLG <> 'Y'
	AND ROWNUM = 1
)
SELECT yd_cd yd_cd1, 
CASE
     WHEN GEN IS NOT NULL AND @[from_time] IS NOT NULL AND @[to_time] IS NOT NULL THEN yd_cd || ' (rail)'
     ELSE yd_cd
END yd_cd,
CASE 
     WHEN GEN IS NOT NULL AND yd_cd = @[port] THEN @[cct]
     WHEN GEN IS NOT NULL AND @[from_time] IS NOT NULL AND @[to_time] IS NOT NULL 
		THEN TO_CHAR(TO_DATE(@[from_time] , 'YYYY/MM/DD HH24:MI:SS'),'YYYY-MM-DD HH24:MI') || ' - ' || TO_CHAR(TO_DATE(@[to_time], 'YYYY/MM/DD HH24:MI:SS'),'YYYY-MM-DD HH24:MI')
     WHEN GEN IS NOT NULL THEN TO_CHAR(TO_DATE(GEN, 'YYYY/MM/DD HH24:MI:SS'),'YYYY-MM-DD HH24:MI')
     ELSE ''
END GEN,
CASE
     WHEN RF IS NOT NULL AND yd_cd = @[port] THEN @[cct]
	 WHEN RF IS NOT NULL THEN TO_CHAR(TO_DATE(RF, 'YYYY/MM/DD HH24:MI:SS'),'YYYY-MM-DD HH24:MI')
     ELSE ''
END RF,
CASE 
     WHEN DG IS NOT NULL AND yd_cd = @[port] THEN @[cct]
     WHEN DG IS NOT NULL THEN TO_CHAR(TO_DATE(DG, 'YYYY/MM/DD HH24:MI:SS'),'YYYY-MM-DD HH24:MI')
     ELSE ''
END DG, ORD
FROM
(
	SELECT DISTINCT FULL_RTN_YD_CD yd_cd, GEN, RF, DG, ord
	FROM
	(
		SELECT FULL_RTN_YD_CD,
		DECODE(RF_SPCL_FLG,'Y',NULL,DECODE(DG_SPCL_FLG,'Y',NULL,to_char(CCT,'yyyy-mm-dd hh24:miss'))) GEN,
		DECODE(RF_SPCL_FLG,'Y', to_char(CCT,'yyyy-mm-dd HH24:MI')) RF,
		DECODE(DG_SPCL_FLG,'Y', to_char(CCT,'yyyy-mm-dd HH24:MI')) DG, 1 ord
		FROM CCT

		UNION ALL
		SELECT FULL_RTN_YD_CD , '' gen, '' rf, '' dg, 2 ord
		FROM prd_inlnd_rout_mst
			WHERE ROUT_ORG_NOD_CD LIKE @[por]||'%' AND ROUT_DEST_NOD_CD = (SELECT POL_NOD_CD FROM PRD_PROD_CTL_MST WHERE PCTL_NO = @[pctl_no])
			AND PCTL_IO_BND_CD IN ('O','B') AND NVL(DELT_FLG,'N')='N'
			AND FULL_RTN_YD_CD not in (SELECT FULL_RTN_YD_CD FROM CCT  )

		UNION ALL
		SELECT 'input' FULL_RTN_YD_CD , '' gen, '' rf, '' dg, 3 ord
		FROM dual
	) WHERE FULL_RTN_YD_CD  IS NOT NULL
) a
ORDER BY ord, yd_cd			]]></sql>
			<params>
				<param name="pctl_no" type="12" value="" out="N"/>
				<param name="from_time" type="12" value="" out="N"/>
				<param name="to_time" type="12" value="" out="N"/>
				<param name="port" type="12" value="" out="N"/>
				<param name="cct" type="12" value="" out="N"/>
				<param name="por" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
