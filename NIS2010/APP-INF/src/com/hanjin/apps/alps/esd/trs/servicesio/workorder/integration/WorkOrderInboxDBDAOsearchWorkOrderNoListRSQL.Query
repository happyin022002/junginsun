<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="WorkOrderInboxDBDAOsearchWorkOrderNoListRSQL">
			<desc><![CDATA[searchWorkOrderNoList 조회 한다.]]></desc>
			<sql><![CDATA[
SELECT
  trsp_wo_ofc_cty_cd||trsp_wo_seq trsp_wo_no
  ,trsp_so_no
  ,wo_iss_sts_cd issue_type_cd
  ,decode(wo_iss_sts_cd,'C','Correction','I','Issued','J',
	      			'Rejected','N','Cancellation','P','Partially Rejected','R','Reissued' ) issue_type_nm
  ,trsp_cost_dtl_mod_cd
  ,(select	intg_cd_val_dp_desc	from com_intg_cd_dtl
	 where	intg_cd_id = 'CD00958'
	 and	intg_cd_val_ctnt = trsp_cost_dtl_mod_cd)	trsp_kind_nm
  ,trsp_crr_mod_cd
  ,(select	intg_cd_val_dp_desc	from com_intg_cd_dtl
	where	intg_cd_id = 'CD00283'
	and	intg_cd_val_ctnt = trsp_crr_mod_cd) trsp_mode_nm
  ,wo_fmt_tp_cd trsp_so_cmb_tp_cd
  ,decode(wo_fmt_tp_cd,'CC','Combined Case 1',
			  		'CM','Combined Case 2','CY','Combined Case 2','IB','Combined Case 2',
			  		'NC','Normal','MM','Empty' ) trsp_type_nm
  ,cre_dt
  ,apnt_dt
  ,de_dt
  ,wo_opn_flg
  ,trsp_so_tp_cd
  ,tot_cnt
  ,rj_cnt
  ,so_cnt
  ,inv_cnt
  ,decode(tot_cnt,rj_cnt,'Yes',decode(rj_cnt,0,'No','Partially')) wo_rjct_flg
  ,decode(inv_cnt,0,'No',decode(so_cnt,inv_cnt,'Yes','Partially')) invoiced_flg
  ,ob_vvd_cd
  ,wo_vndr_seq
  ,decode(bid_cnt, 0, 'No', decode(so_cnt, bid_cnt, 'Yes', 'Partially')) bid_flg
FROM
(
SELECT   x.*
        ,so.trsp_so_ofc_cty_cd||so.trsp_so_seq trsp_so_no
        ,so.trsp_cost_dtl_mod_cd
        ,so.trsp_crr_mod_cd
        ,to_char(so.apnt_dt,	'YYYY-MM-DD HH24:MI:SS') apnt_dt
        ,to_char(so.de_dt,	'YYYY-MM-DD HH24:MI:SS') de_dt
        ,so.trsp_so_tp_cd
	     ,(x.rj_cnt + x.so_cnt) tot_cnt
	     ,so.ob_vvd_cd
    FROM (SELECT x1.*
                ,(SELECT count(a.trsp_wo_seq) cnt
                    FROM trs_trsp_wrk_ord_rjct_his a
                   WHERE a.trsp_wo_ofc_cty_cd = x1.trsp_wo_ofc_cty_cd
                     AND a.trsp_wo_seq = x1.trsp_wo_seq
                  ) rj_cnt
                ,(SELECT MAX(a.trsp_so_ofc_cty_cd ||'^'|| TO_CHAR(a.trsp_so_seq))
                    FROM trs_trsp_wrk_ord_rjct_his a, trs_trsp_svc_ord b
                   WHERE a.trsp_wo_ofc_cty_cd = x1.trsp_wo_ofc_cty_cd
                     AND a.trsp_wo_seq = x1.trsp_wo_seq
                     AND b.trsp_so_ofc_cty_cd = a.trsp_so_ofc_cty_cd
                     AND b.trsp_so_seq = a.trsp_so_seq
                     AND NVL(b.delt_flg, 'N') = 'N'
                  ) rj_flag
                ,(SELECT a.trsp_so_ofc_cty_cd ||'^'|| TO_CHAR(a.trsp_so_seq)
                    FROM trs_trsp_svc_ord a
                   WHERE a.trsp_wo_ofc_cty_cd = x1.trsp_wo_ofc_cty_cd
                     AND a.trsp_wo_seq = x1.trsp_wo_seq
                     AND NVL(a.delt_flg, 'N') = 'N'
#if ($eq_no.size() > 0)
    AND  a.eq_knd_cd = @[eq_knd_cd] 
	and  (1,a.eq_no) in ( 
	#foreach($eq_no_key IN ${eq_no})
		 
		#if($velocityCount < $eq_no.size()) 
			(1,'$eq_no_key') ,
		#else
			(1,'$eq_no_key')
		#end 
	#end  
    )
#end
#if ($bid_no.size() > 0)
    AND  a.spot_bid_flg = 'Y' 
	and  (1,a.spot_bid_no) in ( 
	#foreach($bid_no_key IN ${bid_no})
		#if($velocityCount < $bid_no.size()) 
			(1,'$bid_no_key') ,
		#else 
			(1,'$bid_no_key')
		#end 
	#end  
    )
#end
#if ($bkg_no.size() > 0)
	and  (1,a.bkg_no) in (
	#foreach($bkg_no_key IN ${bkg_no})
		#if($velocityCount < $bkg_no.size())
			(1,'$bkg_no_key'),
		#else
			(1,'$bkg_no_key')
		#end
	#end
    )
#end

#if ($bl_no.size() > 0)
	and  (1,a.bl_no) in (
	#foreach($bl_no_key IN ${bl_no})
        #if($velocityCount < $bl_no.size())
			(1,'$bl_no_key'),
		#else
			(1,'$bl_no_key')
		#end
	#end
    )
#end
                     AND ROWNUM = 1) so_flag
                 ,(SELECT count(a.trsp_so_ofc_cty_cd ||TO_CHAR(a.trsp_so_seq))
                     FROM trs_trsp_svc_ord a
                    WHERE a.trsp_wo_ofc_cty_cd = x1.trsp_wo_ofc_cty_cd
                      AND a.trsp_wo_seq = x1.trsp_wo_seq
                      AND NVL(a.delt_flg, 'N') = 'N'
                      ) so_cnt
                 ,(SELECT count(a.trsp_so_ofc_cty_cd ||TO_CHAR(a.trsp_so_seq))
                     FROM trs_trsp_inv_wrk invw, trs_trsp_svc_ord a
                    WHERE a.trsp_wo_ofc_cty_cd = x1.trsp_wo_ofc_cty_cd
                      AND a.trsp_wo_seq = x1.trsp_wo_seq
                      AND a.inv_no = invw.inv_no
                      AND a.inv_vndr_seq = invw.inv_vndr_seq
                      AND a.trsp_inv_act_sts_cd IS NOT NULL
                  ) inv_cnt
				 ,(SELECT count(a.trsp_so_ofc_cty_cd ||TO_CHAR(a.trsp_so_seq))
            		 FROM trs_trsp_svc_ord a
            		WHERE a.trsp_wo_ofc_cty_cd = x1.trsp_wo_ofc_cty_cd
              		  AND a.trsp_wo_seq = x1.trsp_wo_seq
              		  AND a.spot_bid_flg = 'Y'
              		  AND NVL(a.delt_flg, 'N') = 'N' 
           		  ) bid_cnt
             FROM (
                  select distinct
                         b.trsp_wo_ofc_cty_cd
                         ,b.trsp_wo_seq
                         ,b.wo_iss_sts_cd
                         ,b.wo_fmt_tp_cd
                         ,to_char(b.cre_dt, 'YYYY-MM-DD HH24:MI:SS') cre_dt
                         ,b.wo_opn_flg
						 ,b.wo_vndr_seq
                    from trs_trsp_svc_ord a
                        ,trs_trsp_wrk_ord b
                    where b.trsp_wo_ofc_cty_cd = a.trsp_wo_ofc_cty_cd
                    and b.trsp_wo_seq = a.trsp_wo_seq
                    and NVL(a.delt_flg, 'N') = 'N'
                    AND NVL(b.inter_use_flg, 'N') != 'Y'
					AND (@[vndr_dvsn] != 'S' OR (@[vndr_dvsn] = 'S'
#if ($sp_cd.size() == 1)
	AND b.wo_vndr_seq  = @[vndr_seq]
#elseif ($sp_cd.size() > 1)  
	AND (1,b.wo_vndr_seq) IN (
	#foreach($sp_cd_key in ${sp_cd}) 
		#if($velocityCount < $sp_cd.size()) 
			(1,'$sp_cd_key'),
		#else 
			(1,'$sp_cd_key')
		#end 
	#end 
	)
#end
))
#if ($trsp_wo_ofc_cty_cd.size() > 0) 
    AND (b.trsp_wo_ofc_cty_cd,b.trsp_wo_seq) in (
	#foreach($wonoKey in ${trsp_wo_ofc_cty_cd}) 
		#if($velocityCount < $trsp_wo_ofc_cty_cd.size()) 
			(substr('$wonoKey',0,3),to_number(substr('$wonoKey',4,length('$wonoKey')))),
		#else 
			(substr('$wonoKey',0,3),to_number(substr('$wonoKey',4,length('$wonoKey'))))
		#end 
	#end 
	)
#end 
#if ($eq_no.size() > 0)
    AND  a.eq_knd_cd = @[eq_knd_cd] 
	and  (1,a.eq_no) in ( 
	#foreach($eq_no_key IN ${eq_no})
		 
		#if($velocityCount < $eq_no.size()) 
			(1,'$eq_no_key') ,
		#else
			(1,'$eq_no_key')
		#end 
	#end  
    )
#end
#if ($bid_no.size() > 0)
    AND  a.spot_bid_flg = 'Y' 
	and  (1,a.spot_bid_no) in ( 
	#foreach($bid_no_key IN ${bid_no})
		#if($velocityCount < $bid_no.size()) 
			(1,'$bid_no_key') ,
		#else 
			(1,'$bid_no_key')
		#end 
	#end  
    )
#end
#if ($bkg_no.size() > 0)
	and  (1,a.bkg_no) in (
	#foreach($bkg_no_key IN ${bkg_no})
		#if($velocityCount < $bkg_no.size())
			(1,'$bkg_no_key'),
		#else
			(1,'$bkg_no_key')
		#end
	#end
    )
#end
#if ($bl_no.size() > 0)
	and  (1,a.bl_no) in (
	#foreach($bl_no_key IN ${bl_no})
        #if($velocityCount < $bl_no.size())
			(1,'$bl_no_key'),
		#else
			(1,'$bl_no_key')
		#end
	#end
    )
#end
                  union
                  select distinct
                         c.trsp_wo_ofc_cty_cd
                         ,c.trsp_wo_seq
                         ,c.wo_iss_sts_cd
                         ,c.wo_fmt_tp_cd
                         ,to_char(c.cre_dt, 'YYYY-MM-DD HH24:MI:SS') cre_dt
                         ,c.wo_opn_flg
						 ,c.wo_vndr_seq
                    from trs_trsp_svc_ord a
                        ,trs_trsp_wrk_ord_rjct_his b
                        ,trs_trsp_wrk_ord c
                    where b.trsp_so_ofc_cty_cd = a.trsp_so_ofc_cty_cd
                    and b.trsp_so_seq = a.trsp_so_seq
                    and c.trsp_wo_ofc_cty_cd = b.trsp_wo_ofc_cty_cd
                    and c.trsp_wo_seq = b.trsp_wo_seq
                    AND NVL(c.inter_use_flg, 'N') != 'Y'
					AND (@[vndr_dvsn] != 'S' OR (@[vndr_dvsn] = 'S'
#if ($sp_cd.size() == 1)
	AND b.wo_vndr_seq = @[vndr_seq]
#elseif ($sp_cd.size() > 1)  
	AND (1,b.wo_vndr_seq) IN (
	#foreach($sp_cd_key in ${sp_cd}) 
		#if($velocityCount < $sp_cd.size()) 
			(1,'$sp_cd_key'),
		#else 
			(1,'$sp_cd_key')
		#end 
	#end 
	)
#end
))
#if ($trsp_wo_ofc_cty_cd.size() > 0) 
    AND (b.trsp_wo_ofc_cty_cd,b.trsp_wo_seq) in (
	#foreach($wonoKey in ${trsp_wo_ofc_cty_cd}) 
		#if($velocityCount < $trsp_wo_ofc_cty_cd.size()) 
			(substr('$wonoKey',0,3),to_number(substr('$wonoKey',4,length('$wonoKey')))),
		#else 
			(substr('$wonoKey',0,3),to_number(substr('$wonoKey',4,length('$wonoKey'))))
		#end 
	#end 
  )
#end 
#if ($eq_no.size() > 0)
    AND  a.eq_knd_cd = @[eq_knd_cd] 
	and  (1,a.eq_no) in ( 
	#foreach($eq_no_key IN ${eq_no})
		 
		#if($velocityCount < $eq_no.size()) 
			(1,'$eq_no_key') ,
		#else
			(1,'$eq_no_key')
		#end 
	#end  
    )
#end
#if ($bid_no.size() > 0)
    AND  a.spot_bid_flg = 'Y' 
	and  (1,a.spot_bid_no) in ( 
	#foreach($bid_no_key IN ${bid_no})
		#if($velocityCount < $bid_no.size()) 
			(1,'$bid_no_key') ,
		#else 
			(1,'$bid_no_key')
		#end 
	#end  
    )
#end
#if ($bkg_no.size() > 0)
	and  (1,a.bkg_no) in (
	#foreach($bkg_no_key IN ${bkg_no})
		#if($velocityCount < $bkg_no.size())
			(1,'$bkg_no_key'),
		#else
			(1,'$bkg_no_key')
		#end
	#end
    )
#end
#if ($bl_no.size() > 0)
	and  (1,a.bl_no) in (
	#foreach($bl_no_key IN ${bl_no})
        #if($velocityCount < $bl_no.size())
			(1,'$bl_no_key'),
		#else
			(1,'$bl_no_key')
		#end
	#end
    )
#end
                 ) x1
         ) x
         ,trs_trsp_svc_ord so
    WHERE 1 = 1
      AND DECODE(so_flag, NULL, SUBSTR(rj_flag, 1, INSTR(rj_flag, '^')-1),
    					SUBSTR(so_flag, 1, INSTR(so_flag, '^')-1)) = so.trsp_so_ofc_cty_cd(+)
      AND TO_NUMBER(DECODE(so_flag, NULL, SUBSTR(rj_flag, INSTR(rj_flag, '^')+1, LENGTH(rj_flag)),
                       SUBSTR(so_flag, INSTR(so_flag, '^')+1, LENGTH(so_flag)))) = so.trsp_so_seq(+)
#if ($eq_no.size() > 0)
    AND  so.eq_knd_cd = @[eq_knd_cd] 
	and  (1,so.eq_no) in ( 
	#foreach($eq_no_key IN ${eq_no})
		#if($velocityCount < $eq_no.size()) 
			(1,'$eq_no_key') ,
		#else 
			(1,'$eq_no_key')
		#end 
	#end  
    )
#end
#if ($bid_no.size() > 0)
    AND  so.spot_bid_flg = 'Y' 
	and  (1,so.spot_bid_no) in ( 
	#foreach($bid_no_key IN ${bid_no})
		#if($velocityCount < $bid_no.size()) 
			(1,'$bid_no_key') ,
		#else 
			(1,'$bid_no_key')
		#end 
	#end  
    )
#end
#if ($bkg_no.size() > 0) 
	and  (1,so.bkg_no) in ( 
	#foreach($bkg_no_key IN ${bkg_no}) 
		
		#if($velocityCount < $bkg_no.size()) 
			(1,'$bkg_no_key'),
		#else
 			(1,'$bkg_no_key')
		#end 
	#end  
    )
#end
#if ($bl_no.size() > 0) 
	and  (1,so.bl_no) in ( 
	#foreach($bl_no_key IN ${bl_no})
        #if($velocityCount < $bl_no.size()) 
			(1,'$bl_no_key'),
		#else
			(1,'$bl_no_key')
		#end 
	#end  
    )
#end
    ORDER BY x.trsp_wo_ofc_cty_cd, x.trsp_wo_seq)			]]></sql>
			<params>
				<param name="eq_knd_cd" type="12" value="" out="N"/>
				<param name="vndr_dvsn" type="12" value="S" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
