<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="WorkOrderPreviewDBDAOSearchEdi102297DrbgHeadRSQL">
			<desc><![CDATA[SearchEdi102297DrbgHead]]></desc>
			<sql><![CDATA[
SELECT 
	NVL(WO.TRSP_WO_OFC_CTY_CD||LPAD(WO.TRSP_WO_SEQ, 17, '0'),@[trsp_wo_ofc_cty_cd]||LPAD(@[trsp_wo_seq], 17, '0')) AS WO_NO,
    DECODE (WO.WO_ISS_STS_CD, 'I', 'C', 'R', 'U', 'C', 'U', 'N', 'X') PURPOSE,
    TO_CHAR(WO.LOCL_UPD_DT, 'YYYYMMDDHH24MI') SND_DT,
    'Hanjin Transportation (PUS Brandch)' RECEIVER,
    USR.USR_NM SENDER,
    USR.XTN_PHN_NO TEL_NO,
    DECODE( SO.TRSP_CRR_MOD_CD, 'TD', 'TR', 'WD', 'BR') TRT_MODE,
    SUM(DECODE(SUBSTR(SO.EQ_TPSZ_CD, 2, 1), '2', 1, 0)) QTY_TEU_T,
    SUM(DECODE(SUBSTR(SO.EQ_TPSZ_CD, 2, 1), '2', 0, 1)) QTY_FEU_T,
    SO.CURR_CD AMT_CUR,
    SUM(NVL(SO.BZC_AMT,0)+NVL(SO.NEGO_AMT,0)+NVL(SO.ETC_ADD_AMT,0)+ NVL(SO.TOLL_FEE_AMT,0)) AMT_T,
    SO.FM_NOD_CD ORG_YD,
    SO.TO_NOD_CD DEST_YD,
    '' INS,
    WO.WO_RMK RMK
FROM BKG_VVD VVD,
    COM_USER USR,
    MDM_YARD YD,
    TRS_TRSP_WRK_ORD WO,
    TRS_TRSP_SVC_ORD SO
WHERE SO.DELT_FLG <> 'Y'
    AND WO.TRSP_WO_OFC_CTY_CD = @[trsp_wo_ofc_cty_cd]
    AND WO.TRSP_WO_SEQ = @[trsp_wo_seq]
    AND WO.TRSP_WO_OFC_CTY_CD = SO.TRSP_WO_OFC_CTY_CD
    AND WO.TRSP_WO_SEQ = SO.TRSP_WO_SEQ
    AND WO.CRE_USR_ID = USR.USR_ID
    AND SO.FM_NOD_CD = YD.YD_CD
    AND SO.BKG_NO = VVD.BKG_NO(+)
    AND SUBSTR(SO.FM_NOD_CD, 1, 5) = SUBSTR(VVD.POD_CD(+) , 1, 5)
    -- /* 2008.04.29 ETS OPEN */
    AND SO.HJL_NO IS NULL
    AND WO.HJL_NO IS NULL
GROUP BY WO.TRSP_WO_OFC_CTY_CD||LPAD( WO.TRSP_WO_SEQ, 17, '0'), 
        WO.WO_ISS_STS_CD, 
		WO.LOCL_UPD_DT, 
        USR.USR_NM, 
        USR.XTN_PHN_NO, 
        SO.TRSP_CRR_MOD_CD, 
        SO.CURR_CD, 
        SO.FM_NOD_CD , 
        SO.TO_NOD_CD , 
        WO.WO_RMK			]]></sql>
			<params>
				<param name="trsp_wo_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="trsp_wo_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
