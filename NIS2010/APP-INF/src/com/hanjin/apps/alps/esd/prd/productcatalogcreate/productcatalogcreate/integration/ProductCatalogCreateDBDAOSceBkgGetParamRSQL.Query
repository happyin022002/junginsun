<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ProductCatalogCreateDBDAOSceBkgGetParamRSQL">
			<desc><![CDATA[bkg 기준 replan 시 param 셋팅]]></desc>
			<sql><![CDATA[
SELECT COP_NO,CNTR_NO,CNTR_TPSZ_CD,PCTL_NO,DECODE(@[pc_mode],'O','Y',OB_TRO_FLG) OB_TRO_FLG,DECODE(@[pc_mode],'I','Y',IB_TRO_FLG) IB_TRO_FLG,
       DECODE(@[pc_mode],'O',@[door_zn],'I',POR_NOD_CD,
              DECODE(RCV_TERM_CD,'D',POR_NOD_CD,'S',POR_NOD_CD
                     ,DECODE(POR_CD,POL_CD,DECODE(OUT_BOUND,'%',DECODE(POL_NOD_CD, POR_NOD_CD, '', POR_NOD_CD),POR_NOD_CD),POR_NOD_CD))) POR_NOD_CD, -- 수정 20100503 
	   POL_YD_CD,
       (CASE WHEN SUBSTR(OCN_BOUND,2,5) <> SUBSTR(POL_NOD_CD,1,5)
              AND SUBSTR(OUT_BOUND,-8,5) = SUBSTR(POL_NOD_CD,1,5)
              AND SUBSTR(OUT_BOUND,-8,7) <> POL_NOD_CD
              AND NVL((SELECT 'Y' FROM PRD_NODE
                       WHERE NOD_CD =SUBSTR(OUT_BOUND,-8,7)
                       AND NOD_TP_CD IN ('M','B')),'X') = 'Y'
             THEN SUBSTR(OUT_BOUND,-8,7)          
       END) NEW_POL,
       (CASE WHEN SUBSTR(OCN_BOUND,-8,5) <> SUBSTR(POD_NOD_CD,1,5)
              AND SUBSTR(IN_BOUND,2,5) = SUBSTR(POD_NOD_CD,1,5)
              AND SUBSTR(IN_BOUND,2,7) <> POD_NOD_CD
              AND NVL((SELECT 'Y' FROM PRD_NODE
                       WHERE NOD_CD =SUBSTR(IN_BOUND,2,7)
                       AND NOD_TP_CD IN ('M','B')),'X') = 'Y'
             THEN SUBSTR(IN_BOUND,2,7)            
       END) NEW_POD, 
       '' EUR_CHECK, '' MANUAL_FLAG, 
       DECODE(@[pc_mode],'O',SUBSTR(@[door_zn],1,5),POR_CD) POR_CD,POL_CD,POD_CD,DECODE(@[pc_mode],'I',SUBSTR(@[door_zn],1,5),DEL_CD) DEL_CD,OB_TRSP_MODE,IB_TRSP_MODE,
       DECODE(@[pc_mode],'I',@[door_zn],'O',NVL(TRS_DEL_NOD_CD,DEL_NOD_CD),
              DECODE(DE_TERM_CD,'D',NVL(TRS_DEL_NOD_CD,DEL_NOD_CD),'S',NVL(TRS_DEL_NOD_CD,DEL_NOD_CD),
              DECODE(POD_CD,DEL_CD,DECODE(IN_BOUND,'%',DECODE(POD_NOD_CD, DEL_NOD_CD, '', DEL_NOD_CD)
                     ,NVL(TRS_DEL_NOD_CD,DEL_NOD_CD)),NVL(TRS_DEL_NOD_CD,DEL_NOD_CD)))) DEL_NOD_CD, -- 수정 20100503 
       DECODE(@[pc_mode],'O',@[full_rtn_cy]) FULL_RTN_YD_CD, DECODE(@[pc_mode],'I',@[full_pu_cy]) FULL_PKUP_YD_CD,
       DECODE(@[pc_mode],'O','D',RCV_TERM_CD) RCV_TERM_CD,DECODE(@[pc_mode],'I','D',DE_TERM_CD) DE_TERM_CD,NVL(@[mt_pu],MT_PU) MT_PU,NVL(@[mt_rtn],MT_RTN) MT_RTN,IO_BND_CD,
	   OB_INCL_SHTL_SO_FLG,IB_INCL_SHTL_SO_FLG,
       DECODE(@[pc_mode],'O',@[door_zn],DECODE(@[io_bnd_cd],'O',O_ROUT_ORG_NOD_CD,I_ROUT_ORG_NOD_CD)) ROUT_ORG_NOD_CD,
       DECODE(@[pc_mode],'I',@[door_zn],DECODE(@[io_bnd_cd],'O',O_ROUT_DEST_NOD_CD,I_ROUT_DEST_NOD_CD)) ROUT_DEST_NOD_CD,
       DECODE(@[io_bnd_cd],'O',O_ROUT_SEQ,I_ROUT_SEQ) ROUT_SEQ,CCT,POL_T,POD_T,OUT_BOUND,IN_BOUND,OCN_BOUND,
       T_VVD,ORG_LOC_CD,DEST_LOC_CD,OCN_SEQ,OB_TRSP_MODE,IB_TRSP_MODE, 
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N1_VVD_SEQ')+10,9)) VVD1,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N1_POLNODE')+10,5)) POL1,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N1_PODNODE')+10,5)) POD1,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N1_SLANECD')+10,3)) LANE1, 
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N2_VVD_SEQ')+10,9)) VVD2,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N2_POLNODE')+10,5)) POL2,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N2_PODNODE')+10,5)) POD2,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N2_SLANECD')+10,3)) LANE2,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N3_VVD_SEQ')+10,9)) VVD3,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N3_POLNODE')+10,5)) POL3,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N3_PODNODE')+10,5)) POD3,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N3_SLANECD')+10,3)) LANE3,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N4_VVD_SEQ')+10,9)) VVD4,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N4_POLNODE')+10,5)) POL4,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N4_PODNODE')+10,5)) POD4,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N4_SLANECD')+10,3)) LANE4,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N1_POL_SEQ')+10,1)) N1_POL_CLPT_SEQ,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N1_POD_SEQ')+10,1)) N1_POD_CLPT_SEQ,      
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N2_POL_SEQ')+10,1)) N2_POL_CLPT_SEQ,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N2_POD_SEQ')+10,1)) N2_POD_CLPT_SEQ,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N3_POL_SEQ')+10,1)) N3_POL_CLPT_SEQ,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N3_POD_SEQ')+10,1)) N3_POD_CLPT_SEQ, 
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N4_POL_SEQ')+10,1)) N4_POL_CLPT_SEQ,
       TRIM(SUBSTR(CLPT_SEQ_STR,  INSTR(CLPT_SEQ_STR,'N4_POD_SEQ')+10,1)) N4_POD_CLPT_SEQ,
       POL_ETD_DT
FROM (
    SELECT H.COP_NO,H.CNTR_NO,BC.CNTR_TPSZ_CD,B.PCTL_NO,B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD T_VVD,    
          OB_TRO_FLG,IB_TRO_FLG,
          --NVL(BC.POR_NOD_CD,H.POR_NOD_CD) POR_NOD_CD
           -- POR 추가 S 20100202 -----------
           -- YARD TERM 일때 로직 추가 
           DECODE(T2.DOR_NOD_CD,NULL,
           NVL((
                SELECT FM_NOD_CD 
                  FROM TRS_TRSP_SVC_ORD T
                 WHERE T.COP_NO = H.COP_NO
                   AND NVL(T.RPLN_UMCH_FLG,'N') <> 'Y' -- 2010.04.09 추가 by j
                   AND NVL(T.TRSP_FRST_FLG,'N') <> 'Y'
                   AND NVL(T.DELT_FLG,'N') <> 'Y'
                   AND T.DELT_FLG ='N'
				   -- AND T.BKG_RCVDE_TERM_CD ='Y'		
				   AND T.TRSP_SO_TP_CD = 'Y' 	--Supplement S/O 에 대한Seq 는 참조하지 않게.   
                   AND T.TRSP_COST_DTL_MOD_CD = 'CY'	-- TRS Mode 로 확인 #Mod 2010.05.29 by sj
                   AND T.COST_ACT_GRP_SEQ = (
                                                SELECT MIN(COST_ACT_GRP_SEQ)
                                                  FROM SCE_PLN_SO_LIST S
                                                 WHERE S.COP_NO = T.COP_NO
                                                   AND S.PCTL_IO_BND_CD= 'O'
                                                   
                                                   AND SUBSTR(T.FM_NOD_CD,1,5) = (SELECT SUBSTR(POR_NOD_CD,1,5) FROM SCE_COP_HDR WHERE COP_NO = S.COP_NO) --SUBSTR(S.N1ST_NOD_CD,1,5)
                                              )
                   
            ), NVL(BC.POR_NOD_CD,B.POR_NOD_CD)),T2.DOR_NOD_CD) POR_NOD_CD,
            -- 추가 E-----------    
          BC.POL_YD_CD, B.POL_NOD_CD,B.POD_NOD_CD,DECODE(T.DOR_NOD_CD,NULL,B.DEL_NOD_CD,T.DOR_NOD_CD) DEL_NOD_CD,
            -- DEL 추가 S 20100202-----------
           (
                SELECT TO_NOD_CD 
                  FROM TRS_TRSP_SVC_ORD T
                 WHERE T.COP_NO = H.COP_NO
                   AND NVL(T.RPLN_UMCH_FLG,'N') <> 'Y' -- 2010.04.09 추가 by j
                   AND NVL(T.TRSP_FRST_FLG,'N') <> 'Y'
                   AND NVL(T.DELT_FLG,'N') <> 'Y'
                   AND T.DELT_FLG ='N'
				   -- AND T.BKG_RCVDE_TERM_CD ='Y'				   
                   AND T.TRSP_COST_DTL_MOD_CD = 'CY'	-- TRS Mode 로 확인 #Mod 2010.05.29 by sj
                   AND T.COST_ACT_GRP_SEQ = (
                                                SELECT MAX(COST_ACT_GRP_SEQ)
                                                  FROM SCE_PLN_SO_LIST S
                                                 WHERE S.COP_NO = T.COP_NO
                                                   AND S.PCTL_IO_BND_CD = 'I'
                                                   
                                                   AND SUBSTR(T.TO_NOD_CD,1,5) = (SELECT SUBSTR(DEL_NOD_CD,1,5) FROM SCE_COP_HDR WHERE COP_NO = S.COP_NO) --DECODE(SUBSTR(S.N4TH_NOD_CD ,1,5), NULL,(DECODE(SUBSTR(S.N3RD_NOD_CD ,1,5), NULL,  SUBSTR(S.N2ND_NOD_CD ,1,5), SUBSTR(S.N3RD_NOD_CD ,1,5) ) ), S.N4TH_NOD_CD  ) -- SUBSTR(S.N1ST_NOD_CD,1,5)
                                              )
                           
            ) TRS_DEL_NOD_CD ,         
          DECODE(T2.DOR_NOD_CD,NULL,SUBSTR(B.POR_NOD_CD,1,5),SUBSTR(T2.DOR_NOD_CD,1,5)) POR_CD,SUBSTR(B.POL_NOD_CD,1,5) POL_CD,
          SUBSTR(B.POD_NOD_CD,1,5) POD_CD,DECODE(T.DOR_NOD_CD,NULL,SUBSTR(B.DEL_NOD_CD,1,5),SUBSTR(T.DOR_NOD_CD,1,5)) DEL_CD,
          DECODE(T2.DOR_NOD_CD,NULL,NVL(BC.RCV_TERM_CD,B.RCV_TERM_CD),'D')  RCV_TERM_CD, 
          DECODE(T.DOR_NOD_CD,NULL,NVL(BC.DE_TERM_CD,B.DE_TERM_CD),'D')  DE_TERM_CD,
          NVL(NVL(T2.FM_NOD_CD,PU.NOD_CD),B.MTY_PKUP_YD_CD) MT_PU, NVL(NVL(T.TO_NOD_CD,RTN.NOD_CD),B.MTY_RTN_YD_CD) MT_RTN, @[io_bnd_cd] IO_BND_CD,
          -- O/B Shuttle S/O Check
          (SELECT 'N'                                                      
           FROM TRS_TRSP_SVC_ORD T
           WHERE T.COP_NO = H.COP_NO
           AND T.TRSP_BND_CD ='O'
           AND DECODE(T.TRSP_BND_CD,'O',T.TO_NOD_CD,'I',T.FM_NOD_CD) = DECODE(T.TRSP_BND_CD,'O',B.POL_NOD_CD,'I',B.POD_NOD_CD)
           AND DECODE(T.TRSP_BND_CD,'O',SUBSTR(B.POL_NOD_CD,1,5),'I',SUBSTR(B.POD_NOD_CD,1,5)) <> DECODE(T.TRSP_BND_CD,'O',SUBSTR(B.POR_NOD_CD,1,5),'I',SUBSTR(B.DEL_NOD_CD,1,5))
           AND SUBSTR(T.FM_NOD_CD,1,5) = SUBSTR(T.TO_NOD_CD,1,5)
           AND TRIM(T.VIA_NOD_CD) IS NULL
           AND TRIM(T.DOR_NOD_CD) IS NULL
           AND NVL(T.RPLN_UMCH_FLG,'N') <> 'Y' -- 2010.04.09 추가 by j
           AND NVL(T.TRSP_FRST_FLG,'N') <> 'Y'
           AND NVL(T.DELT_FLG,'N') <> 'Y'
           AND ROWNUM =1 ) OB_INCL_SHTL_SO_FLG,
          -- I/B Shuttle S/O Check
          (SELECT 'N'                                                      
           FROM TRS_TRSP_SVC_ORD T
           WHERE T.COP_NO = H.COP_NO
           AND T.TRSP_BND_CD ='I'
           AND DECODE(T.TRSP_BND_CD,'O',T.TO_NOD_CD,'I',T.FM_NOD_CD) = DECODE(T.TRSP_BND_CD,'O',B.POL_NOD_CD,'I',B.POD_NOD_CD)
           AND DECODE(T.TRSP_BND_CD,'O',SUBSTR(B.POL_NOD_CD,1,5),'I',SUBSTR(B.POD_NOD_CD,1,5)) <> DECODE(T.TRSP_BND_CD,'O',SUBSTR(B.POR_NOD_CD,1,5),'I',SUBSTR(B.DEL_NOD_CD,1,5))
           AND SUBSTR(T.FM_NOD_CD,1,5) = SUBSTR(T.TO_NOD_CD,1,5)
           AND TRIM(T.VIA_NOD_CD) IS NULL
           AND TRIM(T.DOR_NOD_CD) IS NULL
           AND NVL(T.RPLN_UMCH_FLG,'N') <> 'Y' -- 2010.04.09 추가 by j
           AND NVL(T.TRSP_FRST_FLG,'N') <> 'Y'
           AND NVL(T.DELT_FLG,'N') <> 'Y'
           AND ROWNUM =1 ) IB_INCL_SHTL_SO_FLG,
          O.ROUT_ORG_NOD_CD O_ROUT_ORG_NOD_CD,O.ROUT_DEST_NOD_CD O_ROUT_DEST_NOD_CD,O.ROUT_SEQ O_ROUT_SEQ,
          I.ROUT_ORG_NOD_CD I_ROUT_ORG_NOD_CD,I.ROUT_DEST_NOD_CD I_ROUT_DEST_NOD_CD,I.ROUT_SEQ I_ROUT_SEQ,
          B.POL_CD ORG_LOC_CD,B.POD_CD DEST_LOC_CD,NULL OCN_SEQ, --OCN 정보
          --OCN.ROUT_ORG_NOD_CD ORG_LOC_CD,OCN.ROUT_DEST_NOD_CD DEST_LOC_CD,OCN.ROUT_SEQ OCN_SEQ, --OCN 정보
          (    
                SELECT 
                    'N1_POL_SEQ'||MAX(DECODE(VSL_SEQ,0, POL_CLPT_IND_SEQ,' ')) ||
                    'N1_POD_SEQ'||MAX(DECODE(VSL_SEQ,0, POD_CLPT_IND_SEQ,' ')) ||
                    'N1_VVD_SEQ'||MAX(DECODE(VSL_SEQ,0, VSL_CD||SKD_VOY_NO||SKD_DIR_CD,'         ')) ||
                    'N1_POLNODE'||MAX(DECODE(VSL_SEQ,0, POL_CD,'     ')) ||
                    'N1_PODNODE'||MAX(DECODE(VSL_SEQ,0, POD_CD,'     ')) ||
                    'N1_SLANECD'||MAX(DECODE(VSL_SEQ,0, SLAN_CD,'   ')) ||                    
                    'N2_POL_SEQ'||MAX(DECODE(VSL_SEQ,1, POL_CLPT_IND_SEQ,' ')) ||
                    'N2_POD_SEQ'||MAX(DECODE(VSL_SEQ,1, POD_CLPT_IND_SEQ,' ')) ||
                    'N2_VVD_SEQ'||MAX(DECODE(VSL_SEQ,1, VSL_CD||SKD_VOY_NO||SKD_DIR_CD,'         ')) ||
                    'N2_POLNODE'||MAX(DECODE(VSL_SEQ,1, POL_CD,'     ')) ||
                    'N2_PODNODE'||MAX(DECODE(VSL_SEQ,1, POD_CD,'     ')) ||
                    'N2_SLANECD'||MAX(DECODE(VSL_SEQ,1, SLAN_CD,'   ')) ||                    
                    'N3_POL_SEQ'||MAX(DECODE(VSL_SEQ,2, POL_CLPT_IND_SEQ,' ')) ||
                    'N3_POD_SEQ'||MAX(DECODE(VSL_SEQ,2, POD_CLPT_IND_SEQ,' ')) ||
                    'N3_VVD_SEQ'||MAX(DECODE(VSL_SEQ,2, VSL_CD||SKD_VOY_NO||SKD_DIR_CD,'         ')) ||
                    'N3_POLNODE'||MAX(DECODE(VSL_SEQ,2, POL_CD,'     ')) ||
                    'N3_PODNODE'||MAX(DECODE(VSL_SEQ,2, POD_CD,'     ')) ||
                    'N3_SLANECD'||MAX(DECODE(VSL_SEQ,2, SLAN_CD,'   ')) ||                    
                    'N4_POL_SEQ'||MAX(DECODE(VSL_SEQ,3, POL_CLPT_IND_SEQ,' ')) ||
                    'N4_POD_SEQ'||MAX(DECODE(VSL_SEQ,3, POD_CLPT_IND_SEQ,' ')) ||
                    'N4_VVD_SEQ'||MAX(DECODE(VSL_SEQ,3, VSL_CD||SKD_VOY_NO||SKD_DIR_CD,'         ')) || 
                    'N4_POLNODE'||MAX(DECODE(VSL_SEQ,3, POL_CD,'     ')) ||
                    'N4_PODNODE'||MAX(DECODE(VSL_SEQ,3, POD_CD,'     ')) ||
                    'N4_SLANECD'||MAX(DECODE(VSL_SEQ,3, SLAN_CD,'   ')) CLPT_SEQ
				FROM (
						-- BKG VVD Sequnce 수정 : PreVVD : VSL_PRE_PST_CD = 'S', Trunk VVD : VSL_PRE_PST_CD = 'T', PostVVD : VSL_PRE_PST_CD = 'U'
						-- VSL_PRE_PST_CD, VSL_SEQ 별로 VVD Sequence 읽도록 함.
        				SELECT (ROW_NUMBER() OVER (PARTITION BY BKG_NO ORDER BY VSL_PRE_PST_CD, VSL_SEQ) - 1) VSL_SEQ,
							BKG_NO, POL_CLPT_IND_SEQ, POD_CLPT_IND_SEQ, VSL_CD, SKD_VOY_NO, SKD_DIR_CD, POL_CD, POD_CD, SLAN_CD
       					FROM BKG_VVD B
        				WHERE B.BKG_NO = (SELECT BKG_NO FROM SCE_COP_HDR WHERE COP_NO = @[cop_no] ) 
    			)
                GROUP BY BKG_NO            
          ) CLPT_SEQ_STR,
          (SELECT TRSP_MOD_CD 
          FROM PRD_INLND_ROUT_MST 
          WHERE ROUT_ORG_NOD_CD =  O.ROUT_ORG_NOD_CD
          AND  ROUT_DEST_NOD_CD =  O.ROUT_DEST_NOD_CD
          AND ROUT_SEQ = O.ROUT_SEQ) OB_TRSP_MODE,
          (SELECT TRSP_MOD_CD 
          FROM PRD_INLND_ROUT_MST 
          WHERE ROUT_ORG_NOD_CD =  I.ROUT_ORG_NOD_CD
          AND  ROUT_DEST_NOD_CD =  I.ROUT_DEST_NOD_CD
          AND ROUT_SEQ = I.ROUT_SEQ) IB_TRSP_MODE,
          (SELECT TO_CHAR(MAX(ARR_ST_DT),'YYYYMMDDHH24MISS')
          FROM PRD_PROD_CTL_ROUT_DTL
          WHERE PCTL_NO =B.PCTL_NO
          AND PCTL_IO_BND_CD ='O') CCT ,
          (SELECT TO_CHAR(MIN(ARR_ST_DT),'YYYYMMDDHH24MISS')
          FROM PRD_PROD_CTL_ROUT_DTL
          WHERE PCTL_NO =B.PCTL_NO
          AND PCTL_IO_BND_CD ='T') POL_T, 
          (SELECT TO_CHAR(MIN(ARR_ST_DT),'YYYYMMDDHH24MISS') 
          FROM PRD_PROD_CTL_ROUT_DTL
          WHERE PCTL_NO =B.PCTL_NO
          AND PCTL_IO_BND_CD ='I') POD_T,  
          PRD_GET_COP_BND_SO_STR_FNC (H.COP_NO,'O') OUT_BOUND,
          PRD_GET_COP_BND_SO_STR_FNC (H.COP_NO,'I') IN_BOUND,
          PRD_GET_COP_BND_SO_STR_FNC (H.COP_NO,'T') OCN_BOUND,
          TO_CHAR(POL_ETD_DT,'YYYYMMDD') AS POL_ETD_DT
    FROM SCE_COP_HDR H,SCE_COP_DTL PU, SCE_COP_DTL RTN, BKG_CONTAINER BC, BKG_BOOKING B,
         PRD_PROD_CTL_MST M,PRD_PROD_CTL_ROUT_DTL O,PRD_PROD_CTL_ROUT_DTL I,PRD_PROD_CTL_ROUT_DTL OCN,TRS_TRSP_SVC_ORD T, TRS_TRSP_SVC_ORD T2
    WHERE H.COP_NO = @[cop_no] 
     AND H.BKG_NO = B.BKG_NO
     AND B.PCTL_NO = M.PCTL_NO
     AND B.PCTL_NO = O.PCTL_NO
     AND O.PCTL_IO_BND_CD = 'O'
     AND O.PCTL_SEQ = (SELECT /*+ INDEX(D2 XPKPRD_PROD_CTL_ROUT_DTL) */
                       PCTL_SEQ 
                       FROM PRD_PROD_CTL_ROUT_DTL D2
                       WHERE D2.PCTL_NO = O.PCTL_NO
                       AND D2.PCTL_IO_BND_CD = 'O' 
                       AND ROWNUM =1)                       
     AND B.PCTL_NO = I.PCTL_NO
     AND I.PCTL_IO_BND_CD = 'I'
     AND I.PCTL_SEQ = (SELECT /*+ INDEX(D2 XPKPRD_PROD_CTL_ROUT_DTL) */
                       PCTL_SEQ 
                       FROM PRD_PROD_CTL_ROUT_DTL D2
                       WHERE D2.PCTL_NO = I.PCTL_NO
                       AND D2.PCTL_IO_BND_CD = 'I' 
                       AND ROWNUM =1)
     AND B.PCTL_NO = OCN.PCTL_NO
     AND OCN.PCTL_IO_BND_CD = 'T'
     AND OCN.PCTL_SEQ = (SELECT /*+ INDEX(D2 XPKPRD_PROD_CTL_ROUT_DTL) */
                       PCTL_SEQ 
                       FROM PRD_PROD_CTL_ROUT_DTL D2
                       WHERE D2.PCTL_NO = OCN.PCTL_NO
                       AND D2.PCTL_IO_BND_CD = 'T' 
                       AND ROWNUM =1)
     AND H.COP_NO = T2.COP_NO(+)
     AND T2.TRSP_BND_CD(+) ='O'
     AND T2.DOR_NOD_CD(+) IS NOT NULL 
     AND NVL(T2.RPLN_UMCH_FLG(+),'N') <> 'Y' -- 2010.04.09 추가 by j
     AND NVL(T2.TRSP_FRST_FLG(+),'N') <> 'Y'
     AND NVL(T2.DELT_FLG(+),'N') <> 'Y'
     AND H.COP_NO = T.COP_NO(+)
     AND T.TRSP_BND_CD(+) ='I'
     AND T.DOR_NOD_CD(+) IS NOT NULL 
     AND NVL(T.RPLN_UMCH_FLG(+),'N') <> 'Y' -- 2010.04.09 추가 by j
     AND NVL(T.TRSP_FRST_FLG(+),'N') <> 'Y'
     AND NVL(T.DELT_FLG(+),'N') <> 'Y' 
     AND H.CNTR_NO = BC.CNTR_NO(+)
     AND H.BKG_NO = BC.BKG_NO(+)
     AND NVL(H.COP_STS_CD,'N') <> 'X' 
     AND H.COP_NO = PU.COP_NO(+)
     AND PU.ACT_CD(+) = 'MOTYDO'
     AND PU.ACT_DT(+) IS NOT NULL
     AND H.COP_NO = RTN.COP_NO(+)
     AND RTN.ACT_CD(+) = 'MITYAD'
     AND RTN.ACT_DT(+) IS NOT NULL  
)			]]></sql>
			<params>
				<param name="pc_mode" type="12" value="" out="N"/>
				<param name="door_zn" type="12" value="" out="N"/>
				<param name="full_rtn_cy" type="12" value="" out="N"/>
				<param name="full_pu_cy" type="12" value="" out="N"/>
				<param name="mt_pu" type="12" value="" out="N"/>
				<param name="mt_rtn" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="cop_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
