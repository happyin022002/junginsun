<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ProductCatalogCreateDBDAOSearchProductCatalogInternalMst_1RSQL">
			<desc><![CDATA[SearchProductCatalogInternalMst_1]]></desc>
			<sql><![CDATA[
SELECT   por_cd, ob_itchg_ctnt, pol_cd,
         RTRIM (   MAX (DECODE (ts.rk,
                                1, REPLACE (ts.vsl_slan_cd, '-(', '(')
                               ))
                || n1st_ts_port_cd
                || MAX (DECODE (ts.rk, 2, ts.vsl_slan_cd))
                || n2nd_ts_port_cd
                || MAX (DECODE (ts.rk, 3, ts.vsl_slan_cd))
                || n3rd_ts_port_cd
                || MAX (DECODE (ts.rk, 4, ts.vsl_slan_cd)),
                '-'
               ) ts_route,
         pod_cd, ib_itchg_ctnt, del_cd,
            LPAD (FLOOR (ttl_tztm_hrs / 24), 2, 0)
         || LPAD (MOD (ttl_tztm_hrs, 24), 2, 0) ttl_tztm_hrs,
		 DECODE(LENGTH(cnst_flg), 1, '1', '3') remark_img, DECODE(LENGTH(cnst_flg), 1, cnst_flg, '') remark, 
         round(ttl_expn_amt,2) total_cost, trnk_aval_spc,
         m.pctl_no,
         trnk_vsl_cd || trnk_skd_voy_no || trnk_skd_dir_cd trnk_vvd,
		 (select vsl_slan_cd from vsk_vsl_skd v
			where v.vsl_cd = trnk_vsl_cd
			and v.skd_voy_no = trnk_skd_voy_no
			and v.skd_dir_cd = trnk_skd_dir_cd) trnk_lane,
         mty_pkup_yd_cd, por_nod_cd, del_nod_cd ,m.PCTL_NO,
		 m.rout_cnst_seq,
		 DECODE(rout_flag, 'S', 'Standard', 'T', 'Temporary', 'V', 'Validation', 'N', 'Not Used', 'A', 'Add Call', 'D', 'Deleted', 'G', 'Guide') rout_flag,
		 DECODE(rout_flag,  'G',1, 'S', 1, 'T', 3, 'A', 4, 'V', 5, 'N', 6, 'D', 7) ord
         ,(select CNTR_TPSZ_CD from prd_prod_ctl_qty where pctl_no = m.pctl_no and rownum = 1)  cntr_tp
         ,MTY_RTN_YD_CD
		 ,TO_CHAR(N1ST_VSL_LODG_DUE_DT, 'YYYY-MM-DD') N1ST_VSL_LODG_DUE_DT
    FROM prd_prod_ctl_mst m,
         (SELECT /*+ LEADING(DTL) USE_NL(ROUT) */
				 pctl_no,
                 RANK () OVER (PARTITION BY pctl_no ORDER BY pctl_seq) rk,
                 '-(' || vsl_slan_cd || ')-' vsl_slan_cd,
				 upd_ind_cd  rout_flag
            FROM prd_prod_ctl_rout_dtl dtl, prd_ocn_rout rout
           WHERE pctl_no LIKE @[pctl_no]||'%' AND vsl_slan_cd IS NOT NULL
 			AND  dtl.rout_org_nod_cd = rout.org_loc_cd(+)
			AND	 dtl.rout_dest_nod_cd = rout.dest_loc_cd(+)
			AND	 dtl.rout_seq = rout.rout_seq(+)
		 ) ts
   WHERE m.pctl_no LIKE @[pctl_no]||'%' AND m.pctl_no = ts.pctl_no(+)
GROUP BY por_cd,
         ob_itchg_ctnt,
         pol_cd,
         n1st_ts_port_cd,
         n2nd_ts_port_cd,
         n3rd_ts_port_cd,
         pod_cd,
         ib_itchg_ctnt,
         del_cd,
            LPAD (FLOOR (ttl_tztm_hrs / 24), 2, 0)
         || LPAD (MOD (ttl_tztm_hrs, 24), 2, 0),
         ttl_expn_amt,
         trnk_aval_spc,
         cnst_flg,
         m.pctl_no,
		 m.rout_cnst_seq,
         trnk_vsl_cd, trnk_skd_voy_no, trnk_skd_dir_cd,
         mty_pkup_yd_cd,
         por_nod_cd,
         del_nod_cd,
		 rout_flag
		,MTY_RTN_YD_CD
        ,N1ST_VSL_LODG_DUE_DT
order by ord, TTL_EXPN_AMT,TTL_TZTM_HRS			]]></sql>
			<params>
				<param name="pctl_no" type="12" value="t2134123123" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
