<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="Edi315SendDBDAOSearchEventYardForReUseRSQL">
			<desc><![CDATA[-------------------------------------------------------
* History
* 2011.10.24 이경원 [CHM-201113905-01] INVALID LOCATION CODE 문의 관련 처리 요청
* 2013.07.05 최덕우 [CHM-201325106] [SCEM] Pseudo Yard EDI 발송 로직 변경 개발 요청]]></desc>
			<sql><![CDATA[
SELECT (	
		SELECT	CONTI_CD 
		FROM	MDM_LOCATION 
		WHERE	LOC_CD	=	SUBSTR(@[event_yard],1,5) 
		)	CONTI_CD,
		NOD_CD
FROM	SCE_COP_HDR	H, 
		SCE_COP_DTL	D
WHERE	H.COP_NO = D.COP_NO
	AND H.BKG_NO = @[bkg_no]
	AND H.CNTR_NO =	@[cntr_no]
	AND D.COP_DTL_SEQ = (
						CASE WHEN  @[edi_sts]  = 'MT' THEN
														(
														SELECT  /*+ INDEX_DESC ( DD XPKSCE_COP_DTL ) */
																DD.COP_DTL_SEQ 
														FROM    SCE_COP_DTL DD
														WHERE   DD.COP_NO =	H.COP_NO
															AND DD.STND_EDI_STS_CD = 'OAN'	
															AND DD.COP_DTL_SEQ < @[cop_dtl_seq]
															AND ROWNUM = 1          
														)
							WHEN  @[edi_sts]  = 'EE' THEN
														(
														SELECT  /*+ INDEX ( DD XPKSCE_COP_DTL ) */
																DD.COP_DTL_SEQ 
														FROM    SCE_COP_DTL DD
														WHERE   DD.COP_NO =	H.COP_NO
															AND DD.STND_EDI_STS_CD = 'IO'
															AND DD.COP_DTL_SEQ > @[cop_dtl_seq]
															AND ROWNUM = 1          
														)
							ELSE
									0
							END              
						)			]]></sql>
			<params>
				<param name="event_yard" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="edi_sts" type="12" value="" out="N"/>
				<param name="cop_dtl_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
