<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BkgCopManageDBDAOSearchCopCntLimitRSQL">
			<desc><![CDATA[bkg_quantity 와 bkg_container 의 type size 별 count 차이를 구해 type size 별 최대 존재 가능한 COP 개수를 return 한다.]]></desc>
			<sql><![CDATA[
select a.bkg_no, a.cntr_tpsz_cd,
  ceil(a.op_cntr_qty) as op_cntr_qty,
  nvl(cntr_cnt, 0) as cntr_cnt,
  case when ceil(a.op_cntr_qty) - nvl(cntr_cnt, 0) <0 then 0 else ceil(a.op_cntr_qty) - nvl(cntr_cnt, 0) - nvl(cop_cnt, 0) end as cop_limit
from bkg_quantity a,
  (
    select bkg_no,
      cntr_tpsz_cd,
      count(*) as cntr_cnt
    from bkg_container
    where bkg_no = @[bkg_no]
      and nvl(cntr_delt_flg, 'N') = 'N'
    group by bkg_no, cntr_tpsz_cd) b,
	(select bkg_no, cntr_tpsz_cd, count(*) as cop_cnt from sce_cop_hdr where bkg_no = @[bkg_no] and cop_sts_cd != 'X' group by bkg_no, cntr_tpsz_cd ) h
where a.bkg_no = @[bkg_no]
  and a.bkg_no = b.bkg_no (+)
  and a.cntr_tpsz_cd = b.cntr_tpsz_cd (+)
  and a.bkg_no = h.bkg_no
  and a.cntr_tpsz_cd = h.cntr_tpsz_cd			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="HAM000401600" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
