<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CSRIssueTransferSlipManageDBDAOSearchGwApprHeaderRSQL">
			<desc><![CDATA[G/W Approval I/F Header 조회]]></desc>
			<sql><![CDATA[
SELECT SUBSTR(DESCRIPTION,1,250) AS SUBJECT
      ,VATREGISTNO
      ,CSRDATE
      ,CSR_NO
      ,OFFICE
      ,PRPD_BY
      ,BUDGET
      ,PERFORMANCE
      ,RATIO
      ,PAY_TO
      ,DESCRIPTION
      ,EVIDENCE
      ,QTY
      ,INVOICE_DATE
      ,DUE_DATE
      ,AR_OFFSET_NO
      ,CSR_TYPE
      ,PAY_GROUP
      ,ASA_NO
      ,CURRENCY
      -- ,AMOUNT
      -- ,PYMT_AMT
      ,CASE WHEN (AMOUNT BETWEEN -0.999 AND -0.001) OR (AMOUNT BETWEEN 0.001 AND 0.999) THEN TO_CHAR(AMOUNT,'FM9990D999')
            WHEN AMOUNT = 0 THEN '0'
            ELSE RTRIM(TO_CHAR(AMOUNT, 'FM999,999,999,999.999'), '.')
       END AMOUNT
      ,CASE WHEN (PYMT_AMT BETWEEN -0.999 AND -0.001) OR (PYMT_AMT BETWEEN 0.001 AND 0.999) THEN TO_CHAR(PYMT_AMT,'FM9990D999')
            WHEN PYMT_AMT = 0 THEN '0'
            ELSE RTRIM(TO_CHAR(PYMT_AMT, 'FM999,999,999,999.999'), '.')
       END PYMT_AMT 
      ,APR_LINE
  FROM 
(SELECT INV_DESC AS SUBJECT
       ,'' AS VATREGISTNO
       ,TO_CHAR(SYSDATE, 'YYYY/MM/DD') AS CSRDATE
       ,CSR_NO AS CSR_NO
       ,TJ_OFC_CD AS OFFICE
       ,ATTR_CTNT10 AS PRPD_BY
       ,'' BUDGET
       ,'' PERFORMANCE
       ,'' RATIO
       ,INV_DESC AS PAY_TO
       ,(SELECT DTRB.INV_DESC
           FROM (SELECT D.INV_DESC
                   FROM AP_INV_DTRB    D
                  WHERE D.CSR_NO   = @[csr_no]
                  ORDER BY D.INV_AMT DESC
                 ) DTRB
          WHERE ROWNUM < 2
        ) DESCRIPTION
       ,ATTR_CATE_NM AS EVIDENCE
       ,(SELECT SUM(CNT) 
           FROM (SELECT COUNT(INV_NO) CNT
                   FROM TRS_TRSP_INV_WRK
                  WHERE CSR_NO    = @[csr_no]
                  UNION ALL
                 SELECT COUNT(INV_NO) CNT
                   FROM TRS_TRSP_RAIL_INV_WRK
                  WHERE CSR_NO = @[csr_no]
                )
        ) AS QTY
       ,SUBSTR(INV_DT,1,4)||'/'||SUBSTR(INV_DT,5,2)||'/'||SUBSTR(INV_DT,7,2) AS INVOICE_DATE
       ,SUBSTR(INV_TERM_DT,1,4)||'/'||SUBSTR(INV_TERM_DT,5,2)||'/'||SUBSTR(INV_TERM_DT,7,2) AS DUE_DATE
       ,'' AR_OFFSET_NO
       ,CSR_TP_CD AS CSR_TYPE
       ,PAY_GRP_LU_CD AS PAY_GROUP
       ,CASE WHEN CSR_AMT = 0 AND ATTR_CTNT2 IS NOT NULL THEN ATTR_CTNT2
        END ASA_NO
       ,CSR_CURR_CD AS CURRENCY
       ,CSR_AMT AS AMOUNT
       ,PAY_AMT AS PYMT_AMT
       ,APRO_USR_JB_TIT_CD APR_LINE
   FROM AP_INV_HDR A
  WHERE A.CSR_NO = @[csr_no]
)			]]></sql>
			<params>
				<param name="csr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
