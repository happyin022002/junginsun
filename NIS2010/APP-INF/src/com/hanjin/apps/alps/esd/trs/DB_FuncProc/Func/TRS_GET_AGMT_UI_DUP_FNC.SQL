CREATE OR REPLACE FUNCTION TRS_GET_AGMT_UI_DUP_FNC (  P_TRSP_TMP_SEQ  IN NUMBER, P_SR            IN NUMBER)RETURN VARCHAR2AUTHID CURRENT_USERIS/******************************************************************************   Name         :   TRS_GET_AGMT_UI_DUP_FNC   Purpose      :   Agreement Creation에서 UI자료 duplication을 체크하는 Function   Table        :   TRS_TRSP_AGMT_TMP   Ver          :   1.0   Date         :   2010.04.66   System       :   ALPS > TRS   Author       :   최종혁   History      :   ******************************************************************************/V_DUP    VARCHAR2(1000);R_RETURN VARCHAR2(1000);BEGIN--UI에서 중복체크SELECT  MAX(DECODE(NUM, 1, RMK))      ||MAX(DECODE(NUM, 2, RMK))      ||MAX(DECODE(NUM, 3, RMK))      ||MAX(DECODE(NUM, 4, RMK))      ||MAX(DECODE(NUM, 5, RMK))      ||MAX(DECODE(NUM, 6, RMK))      ||MAX(DECODE(NUM, 7, RMK))      ||MAX(DECODE(NUM, 8, RMK))      ||MAX(DECODE(NUM, 9, RMK))      ||MAX(DECODE(NUM,10, RMK))      ||MAX(DECODE(NUM,11, RMK))       ||MAX(DECODE(NUM,12, RMK))       ||MAX(DECODE(NUM,13, RMK))       ||MAX(DECODE(NUM,14, RMK))       ||MAX(DECODE(NUM,15, RMK)) AS RMK  INTO V_DUP  FROM (    SELECT    (        SELECT '; '||U.TRSP_AGMT_EQ_TP_CD||U.TRSP_AGMT_EQ_SZ_CD||' Line '||U.ROW_NO        FROM TRS_AGMT_TMP U        WHERE U.TRSP_AGMT_OFC_CTY_CD = T.TRSP_AGMT_OFC_CTY_CD        AND U.TRSP_AGMT_SEQ       = T.TRSP_AGMT_SEQ        AND U.AGMT_TRSP_TP_CD     = T.AGMT_TRSP_TP_CD        AND U.CGO_TP_CD           = T.CGO_TP_CD        AND U.CUST_NOMI_TRKR_FLG  = T.CUST_NOMI_TRKR_FLG        AND U.CUST_CNT_CD         = T.CUST_CNT_CD        AND U.CUST_SEQ            = T.CUST_SEQ        AND U.TRSP_COST_MOD_CD    = T.TRSP_COST_MOD_CD        AND U.AGMT_TRSP_TP_CD     = T.AGMT_TRSP_TP_CD        AND U.CMDT_GRP_CD         = T.CMDT_GRP_CD        AND U.RAIL_SVC_TP_CD      = T.RAIL_SVC_TP_CD        AND U.FM_NOD_CD           = T.FM_NOD_CD        AND U.VIA_NOD_CD          = T.VIA_NOD_CD        AND U.DOR_NOD_CD          = T.DOR_NOD_CD        AND U.TO_NOD_CD           = T.TO_NOD_CD        AND U.TRSP_AGMT_DIST      = T.TRSP_AGMT_DIST        AND U.DIST_MEAS_UT_CD     = T.DIST_MEAS_UT_CD        AND U.TRSP_DIST_TP_CD     = T.TRSP_DIST_TP_CD        AND U.TRSP_AGMT_EQ_TP_CD  = T.TRSP_AGMT_EQ_TP_CD        AND U.TRSP_AGMT_EQ_SZ_CD  = T.TRSP_AGMT_EQ_SZ_CD        AND U.EQ_KND_CD           = T.EQ_KND_CD        AND U.WTR_RCV_TERM_CD     = T.WTR_RCV_TERM_CD        AND U.WTR_DE_TERM_CD      = T.WTR_DE_TERM_CD        AND U.TRSP_AGMT_BDL_QTY   = T.TRSP_AGMT_BDL_QTY        AND U.TO_WGT              = DECODE(T.TRSP_SCG_CD, 'XX', T.TO_WGT, U.TO_WGT) -- BASIC RATE일 경우만 WEIGHT를 체크한다.        AND U.WGT_MEAS_UT_CD      = DECODE(T.TRSP_SCG_CD, 'XX', T.WGT_MEAS_UT_CD, U.WGT_MEAS_UT_CD) -- BASIC RATE일 경우만 WEIGHT를 체크한다.        AND U.TRSP_RVS_APLY_FLG   = T.TRSP_RVS_APLY_FLG        AND U.TRSP_SCG_CD         = T.TRSP_SCG_CD        AND U.TRSP_TMP_SEQ        = T.TRSP_TMP_SEQ        AND U.ROW_NO             <> T.ROW_NO        AND U.DELT_FLG            = 'N'        AND ROWNUM = 1    )    AS RMK    , ROW_NO SR    , ROWNUM NUM    FROM TRS_AGMT_TMP T    WHERE 1=1    AND T.DELT_FLG     = 'N'    AND T.TRSP_TMP_SEQ = P_TRSP_TMP_SEQ    AND T.ROW_NO       = P_SR)GROUP BY SR;IF LENGTH(V_DUP) > 1 THEN   V_DUP := ',UI DUP ERR'||V_DUP;END IF;    R_RETURN := V_DUP;RETURN R_RETURN;END ;