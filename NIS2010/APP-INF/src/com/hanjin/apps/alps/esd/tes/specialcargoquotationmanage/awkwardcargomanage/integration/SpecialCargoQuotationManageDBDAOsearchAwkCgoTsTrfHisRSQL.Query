<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SpecialCargoQuotationManageDBDAOsearchAwkCgoTsTrfHisRSQL">
			<desc><![CDATA[searchAwkCgoTsTrfHis]]></desc>
			<sql><![CDATA[
SELECT T.* FROM (
SELECT 
AD.YD_CD ,
SUBSTR(AD.YD_CD, 1, 5) PORT_CD ,
SUBSTR(AD.YD_CD, 6) TML_CD ,
X.TML_AWK_CGO_TRF_TP_CD ,
X.IO_BND_CD,
X.IO_GA_CD ,
X.TML_AWK_TS_CD ,
X.COND_NO ,
(SELECT C.COND_DESC
 FROM TES_TRF_COND C
 WHERE 1=1
 AND C.COND_NO = X.COND_NO) COND_DESC,
X.TML_AWK_TRF_VER_NO ,
X.MAN_LOCL_CURR_CD ,
X.MAN_LOCL_AMT_20FT ,
X.MAN_LOCL_AMT_40FT ,
X.MAN_USD_AMT_20FT ,
X.MAN_USD_AMT_40FT ,
X.AUTO_USD_AMT_20FT ,
X.AUTO_USD_AMT_40FT ,
X.SUM_USD_AMT_20FT ,
X.SUM_USD_AMT_40FT ,
AD.CALC_RMK ,
AD.LST_UPD_USR_ID ,
TO_CHAR(AD.LST_UPD_DT, 'YYYY-MM-DD') LST_UPD_DT
FROM TES_AWK_CGO_TRF_HDR AH, TES_AWK_CGO_TRF_DTL AD, (
    SELECT 
    /** HDR + DTL **/ T.YD_CD,
    T.TML_AWK_CGO_TRF_TP_CD,
    T.IO_BND_CD,
    T.IO_GA_CD,
    T.TML_AWK_TS_CD,
    T.COND_NO,
    T.TML_AWK_TRF_VER_NO,
    /** UNIT COST MANUAL (LOCL CURR) **/ 
    MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'M' THEN T.LOCL_CURR_CD END) MAN_LOCL_CURR_CD,
    MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'M' THEN DECODE(T.CNTR_SZ_CD, '2', T.LOCL_CURR_AMT, '') END) MAN_LOCL_AMT_20FT,
    MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'M' THEN DECODE(T.CNTR_SZ_CD, '4', T.LOCL_CURR_AMT, '') END) MAN_LOCL_AMT_40FT,
    /** UNIT COST MANUAL (USD) **/ 
    MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'M' THEN DECODE(T.CNTR_SZ_CD, '2', T.USD_AMT, '') END) MAN_USD_AMT_20FT,
    MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'M' THEN DECODE(T.CNTR_SZ_CD, '4', T.USD_AMT, '') END) MAN_USD_AMT_40FT,
    /** UNIT COST AUTO (USD) **/ 
    MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'A' THEN DECODE(T.CNTR_SZ_CD, '2', T.USD_AMT, '') END) AUTO_USD_AMT_20FT,
    MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'A' THEN DECODE(T.CNTR_SZ_CD, '4', T.USD_AMT, '') END) AUTO_USD_AMT_40FT,
    	/** TOTAL HANDLING COST (USD) **/ 
	MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'S' THEN DECODE(T.CNTR_SZ_CD, '2', T.USD_AMT, '') END) SUM_USD_AMT_20FT,
    MAX( CASE WHEN T.TML_AWK_UC_CALC_TP_CD = 'S' THEN DECODE(T.CNTR_SZ_CD, '4', T.USD_AMT, '') END) SUM_USD_AMT_40FT
	FROM TES_AWK_CGO_TRF_HDR H, TES_AWK_CGO_TRF_DTL D, TES_AWK_CGO_TRF_TP_SZ T
    WHERE 1=1
    AND H.YD_CD = D.YD_CD
    AND NVL(H.DELT_FLG, 'N') <> 'Y'
    AND D.YD_CD = T.YD_CD
    AND D.TML_AWK_CGO_TRF_TP_CD = T.TML_AWK_CGO_TRF_TP_CD
    AND D.IO_BND_CD = T.IO_BND_CD
    AND D.IO_GA_CD = T.IO_GA_CD
    AND D.TML_AWK_TS_CD = T.TML_AWK_TS_CD
    AND D.COND_NO = T.COND_NO
    AND D.TML_AWK_TRF_VER_NO = T.TML_AWK_TRF_VER_NO
    AND D.YD_CD = @[yd_cd]
    AND D.TML_AWK_CGO_TRF_TP_CD = @[tml_awk_cgo_trf_tp_cd]
    AND D.IO_BND_CD = @[io_bnd_cd]
    AND D.IO_GA_CD = @[io_ga_cd]
    AND D.TML_AWK_TS_CD = @[tml_awk_ts_cd]
	AND D.COND_NO = @[cond_no]
    GROUP BY T.YD_CD, T.TML_AWK_CGO_TRF_TP_CD, T.IO_BND_CD, T.IO_GA_CD, T.TML_AWK_TS_CD, T.COND_NO, T.TML_AWK_TRF_VER_NO ) X
WHERE 1=1
AND AH.YD_CD = AD.YD_CD
AND NVL(AH.DELT_FLG, 'N') <> 'Y'
AND AD.TML_AWK_CGO_TRF_TP_CD = @[tml_awk_cgo_trf_tp_cd]
AND AD.YD_CD = X.YD_CD
AND AD.TML_AWK_CGO_TRF_TP_CD = X.TML_AWK_CGO_TRF_TP_CD
AND AD.IO_BND_CD = X.IO_BND_CD
AND AD.IO_GA_CD = X.IO_GA_CD
AND AD.TML_AWK_TS_CD = X.TML_AWK_TS_CD
AND AD.COND_NO = X.COND_NO
AND AD.TML_AWK_TRF_VER_NO = X.TML_AWK_TRF_VER_NO
) T
ORDER BY T.PORT_CD, T.TML_CD, T.TML_AWK_CGO_TRF_TP_CD, T.IO_BND_CD, T.IO_GA_CD, T.TML_AWK_TS_CD, T.COND_NO, T.TML_AWK_TRF_VER_NO DESC			]]></sql>
			<params>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="tml_awk_cgo_trf_tp_cd" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="io_ga_cd" type="12" value="" out="N"/>
				<param name="tml_awk_ts_cd" type="12" value="" out="N"/>
				<param name="cond_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
