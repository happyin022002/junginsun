<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CreditIncentiveSummaryDBDAOSearchCreditIssueListRSQL">
			<desc><![CDATA[Search M&R, Mileage Incentive]]></desc>
			<sql><![CDATA[
SELECT CR_SRC
      ,TEAM_NM TEAM_CD
      ,BSE_YR
      ,VNDR_SEQ
      ,VNDR_NM
      ,NVL(ISS_AMT,0) ISS_AMT
      ,NVL(USD_AMT,0) USED_AMT
      ,NVL(BAL_AMT,0) BAL_AMT
  FROM (
#if (${cr_src_cd} =='')
		SELECT 'Mileage' CR_SRC
              ,A.TEAM_NM
              ,A.BSE_YR
              ,'WR' VNDR_SEQ
              ,A.BANK_NM VNDR_NM
              ,TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC('KRW',NVL(SUM(A.MLG_PNT_AMT),0)) ISS_AMT
              ,TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC('KRW',NVL(SUM(A.CSH_BAK_AMT),0)) USD_AMT
              ,TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC('KRW',NVL(SUM(A.MLG_PNT_AMT),0) - NVL(SUM(A.CSH_BAK_AMT),0)) BAL_AMT
          FROM EAS_BNF_MLG A
         WHERE A.DELT_FLG ='N'
        #if (${iss_fm_dt} !='' && ${iss_fm_dt} !='')
           AND A.MLG_ISS_DT BETWEEN TO_DATE(@[iss_fm_dt],'YYYYMMDD') AND TO_DATE(@[iss_to_dt],'YYYYMMDD')+0.9999
		#end
         GROUP BY A.TEAM_NM
                 ,A.BSE_YR  
                 ,A.BANK_NM 
        UNION ALL
        SELECT 'Refrigerator' CR_SRC
              ,X.TEAM_CD TEAM_NM
              ,X.BSE_YR
              ,X.MKR_CD VNDR_SEQ
              ,(SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL A WHERE A.INTG_CD_ID ='CD03516' AND A.INTG_CD_VAL_CTNT = X.MKR_CD)  VNDR_NM
              ,NVL(SUM(X.CR_ISS_TTL_AMT),0) ISS_AMT
              ,NVL(SUM(X.CR_USD_AMT),0) USD_AMT
              ,NVL(SUM(X.CR_ISS_TTL_AMT),0) - NVL(SUM(X.CR_USD_AMT),0) BAL_AMT
          FROM ( 
                SELECT A.CR_ISS_NO
                      ,A.TEAM_CD
				      ,TO_CHAR(A.CR_ISS_DT,'YYYY') BSE_YR
                      ,A.MKR_CD 
                      ,TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC(A.CURR_CD,NVL(A.CR_ISS_TTL_AMT,0)) CR_ISS_TTL_AMT
                      ,TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC(A.CURR_CD,NVL(SUM(B.CR_USD_AMT),0)) CR_USD_AMT
                 FROM EAS_MNR_CR_ISS A
                     ,EAS_MNR_CR_USD B
                WHERE 1=1
                  AND A.CR_ISS_NO = B.CR_ISS_NO(+)
                  AND A.DELT_FLG = 'N'
                  AND 'N' = B.DELT_FLG(+)
        #if (${iss_fm_dt} !='' && ${iss_fm_dt} !='')
           		  AND A.CR_ISS_DT BETWEEN TO_DATE(@[iss_fm_dt],'YYYYMMDD') AND TO_DATE(@[iss_to_dt],'YYYYMMDD')+0.9999
		#end
                GROUP BY A.CR_ISS_NO
                        ,A.TEAM_CD
					    ,TO_CHAR(A.CR_ISS_DT,'YYYY')
                        ,A.MKR_CD
                        ,A.CURR_CD
                        ,A.CR_ISS_TTL_AMT
              ) X
           GROUP BY X.TEAM_CD
				   ,X.BSE_YR
                   ,X.MKR_CD
#end
#if (${cr_src_cd} =='MGR')
		SELECT 'Mileage' CR_SRC
              ,A.TEAM_NM
			  ,A.BSE_YR
              ,'WR' VNDR_SEQ
              ,A.BANK_NM VNDR_NM
              ,TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC('KRW',NVL(SUM(A.MLG_PNT_AMT),0)) ISS_AMT
              ,TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC('KRW',NVL(SUM(A.CSH_BAK_AMT),0)) USD_AMT
              ,TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC('KRW',NVL(SUM(A.MLG_PNT_AMT),0) - NVL(SUM(A.CSH_BAK_AMT),0)) BAL_AMT
          FROM EAS_BNF_MLG A
         WHERE A.DELT_FLG ='N'
        #if (${iss_fm_dt} !='' && ${iss_fm_dt} !='')
           AND A.MLG_ISS_DT BETWEEN TO_DATE(@[iss_fm_dt],'YYYYMMDD') AND TO_DATE(@[iss_to_dt],'YYYYMMDD')+0.9999
		#end
         GROUP BY A.TEAM_NM
				 ,A.BSE_YR
                 ,A.BANK_NM 
#end
#if (${cr_src_cd} =='MNR')
        SELECT 'Refrigerator' CR_SRC
              ,X.TEAM_CD TEAM_NM
              ,X.BSE_YR
              ,X.MKR_CD VNDR_SEQ
              ,(SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL A WHERE A.INTG_CD_ID ='CD03516' AND A.INTG_CD_VAL_CTNT = X.MKR_CD)  VNDR_NM
              ,NVL(SUM(X.CR_ISS_TTL_AMT),0) ISS_AMT
              ,NVL(SUM(X.CR_USD_AMT),0) USD_AMT
              ,NVL(SUM(X.CR_ISS_TTL_AMT),0) - NVL(SUM(X.CR_USD_AMT),0) BAL_AMT
          FROM ( 
                SELECT A.CR_ISS_NO
                      ,A.TEAM_CD
					  ,TO_CHAR(A.CR_ISS_DT,'YYYY') BSE_YR
                      ,A.MKR_CD 
                      ,TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC(A.CURR_CD,NVL(A.CR_ISS_TTL_AMT,0)) CR_ISS_TTL_AMT
                      ,TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC(A.CURR_CD,NVL(SUM(B.CR_USD_AMT),0)) CR_USD_AMT
                 FROM EAS_MNR_CR_ISS A
                     ,EAS_MNR_CR_USD B
                WHERE 1=1
                  AND A.CR_ISS_NO = B.CR_ISS_NO(+)
                  AND A.DELT_FLG = 'N'
                  AND 'N' = B.DELT_FLG(+)
        #if (${iss_fm_dt} !='' && ${iss_fm_dt} !='')
           		  AND A.CR_ISS_DT BETWEEN TO_DATE(@[iss_fm_dt],'YYYYMMDD') AND TO_DATE(@[iss_to_dt],'YYYYMMDD')+0.9999
		#end
                GROUP BY A.CR_ISS_NO 
                        ,A.TEAM_CD
			            ,TO_CHAR(A.CR_ISS_DT,'YYYY')
                        ,A.MKR_CD
                        ,A.CURR_CD
                        ,A.CR_ISS_TTL_AMT
              ) X
           GROUP BY X.TEAM_CD
				   ,X.BSE_YR
                   ,X.MKR_CD
#end
    )
ORDER BY CR_SRC
        ,TEAM_NM
		,BSE_YR
        ,VNDR_NM			]]></sql>
			<params>
				<param name="iss_fm_dt" type="12" value="" out="N"/>
				<param name="iss_to_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
