<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DoNotificationReportDBDAOSearchDoNotificationReportListRSQL">
			<desc><![CDATA[SearchDoNotificationReportList]]></desc>
			<sql><![CDATA[
SELECT 
    CTRL_OFC_CD,
    NTC_SND_DT,
    CNTR_NO,
    CNTR_TPSZ_CD,
    FM_NOD_CD,
    FM_YARD_CD,
    TO_NOD_CD,
    TO_YARD_CD,
    DOR_NOD_CD,
    DOR_YARD_CD,
    DOR_NOD_NM,
    BKG_NO,
    BL_NO,
    SC_NO,
    TRNK_VVD_CD,
    SLAN_CD,
    IB_VVD_CD,
    ETA_DT,
    ETA_TIME,
	RAIL_ETA_DT,
	RAIL_ETA_TIME,
    CUST_SEQ,
    CUST_NM,
    NVL(EML_NO_1, FAX_NO_1) AS EML_FAX_1,
    NVL(EML_NO_2, FAX_NO_2) AS EML_FAX_2,
    NVL(EML_NO_3, FAX_NO_3) AS EML_FAX_3,
    NVL(EML_NO_4, FAX_NO_4) AS EML_FAX_4,
    NVL(EML_NO_5, FAX_NO_5) AS EML_FAX_5,
    NVL(EML_NO_6, FAX_NO_6) AS EML_FAX_6,
    NVL(EML_NO_7, FAX_NO_7) AS EML_FAX_7,
    NVL(EML_RESULT_1,FAX_RESULT_1) AS RESULT_1,
    NVL(EML_RESULT_2,FAX_RESULT_2) AS RESULT_2,
    NVL(EML_RESULT_3,FAX_RESULT_3) AS RESULT_3,
    NVL(EML_RESULT_4,FAX_RESULT_4) AS RESULT_4,
    NVL(EML_RESULT_5,FAX_RESULT_5) AS RESULT_5,
    NVL(EML_RESULT_6,FAX_RESULT_6) AS RESULT_6,
    NVL(EML_RESULT_7,FAX_RESULT_7) AS RESULT_7
FROM
    (SELECT MAX(DNSD.CTRL_OFC_CD) AS CTRL_OFC_CD,
    #if(${f_latest} == '')
       TO_CHAR(DNSD.NTC_SND_DT, 'YYYY-MM-DD') AS NTC_SND_DT,
    #else
       MAX(TO_CHAR(DNSD.NTC_SND_DT, 'YYYY-MM-DD')) AS NTC_SND_DT,
    #end   
       DNSD.CNTR_NO AS CNTR_NO,
       MAX(DNSD.CNTR_TPSZ_CD) AS CNTR_TPSZ_CD,
       MAX(SUBSTR(DNSD.FM_NOD_CD, 0, 5)) AS FM_NOD_CD,
       MAX(SUBSTR(DNSD.FM_NOD_CD, 6, 2)) AS FM_YARD_CD,
       MAX(SUBSTR(DNSD.TO_NOD_CD, 0, 5)) AS TO_NOD_CD,
       MAX(SUBSTR(DNSD.TO_NOD_CD, 6, 2)) AS TO_YARD_CD,
       MAX(SUBSTR(DNSD.DOR_NOD_CD, 0, 5)) AS DOR_NOD_CD,
       MAX(SUBSTR(DNSD.DOR_NOD_CD, 6, 2)) AS DOR_YARD_CD,
       MAX((SELECT ZN_NM
          FROM MDM_ZONE
         WHERE 1=1
           AND ZN_CD = DNSD.DOR_NOD_CD
           AND DELT_FLG = 'N'
           AND ROWNUM = 1)) AS DOR_NOD_NM,
       MAX(DNSD.BKG_NO) AS BKG_NO,
       BKGM.BL_NO AS BL_NO,
       MAX(NVL(BKGM.SC_NO, BKGM.RFA_NO)) AS SC_NO,
       MAX(BKGM.VSL_CD || BKGM.SKD_VOY_NO || BKGM.SKD_DIR_CD) AS TRNK_VVD_CD,
       MAX(BKGM.SLAN_CD) AS SLAN_CD,
       MAX(DNSD.IB_VVD_CD) AS IB_VVD_CD,
       MAX(TO_CHAR(DNSD.ETA_DT, 'YYYY-MM-DD')) AS ETA_DT,
       MAX(TO_CHAR(DNSD.ETA_DT, 'HH24:MI')) AS ETA_TIME,
	   MAX(TO_CHAR(DNSD.RAIL_ETA_DT, 'YYYY-MM-DD')) AS RAIL_ETA_DT,
	   MAX(TO_CHAR(DNSD.RAIL_ETA_DT, 'HH24:MI')) AS RAIL_ETA_TIME,
       MAX(DNSR.CUST_CNT_CD || LPAD(DNSR.CUST_SEQ,6,0)) AS CUST_SEQ,
       MAX((SELECT BCST.CUST_NM
          FROM BKG_CUSTOMER BCST
         WHERE 1=1
           AND BCST.BKG_NO = BKGM.BKG_NO
           AND BCST.CUST_SEQ = DNSR.CUST_SEQ
           AND BCST.BKG_CUST_TP_CD = DNSR.BKG_CUST_TP_CD)) AS CUST_NM,
       MAX(DECODE(DNSR.CUST_CNTC_TP_CD, 'C1', DNSR.NTC_EML , NULL)) AS EML_NO_1,
       MAX(DECODE(DNSR.CUST_CNTC_TP_CD, 'C2', DNSR.NTC_EML , NULL)) AS EML_NO_2,
       MAX(DECODE(DNSR.CUST_CNTC_TP_CD, 'B1', DNSR.NTC_EML , NULL)) AS EML_NO_3,
       MAX(DECODE(DNSR.CUST_CNTC_TP_CD, 'B2', DNSR.NTC_EML , NULL)) AS EML_NO_4,
       MAX(DECODE(DNSR.CUST_CNTC_TP_CD, 'A1', DNSR.NTC_EML , NULL)) AS EML_NO_5,
       MAX(DECODE(DNSR.CUST_CNTC_TP_CD, 'A2', DNSR.NTC_EML , NULL)) AS EML_NO_6,
       MAX(DECODE(DNSR.CUST_CNTC_TP_CD, 'AN', DNSR.NTC_EML , NULL)) AS EML_NO_7,
       MAX(DECODE(DNSR.CUST_CNTC_TP_CD, 'C1', DNSR.FAX_NO , NULL)) AS FAX_NO_1,
       MAX(DECODE(DNSR.CUST_CNTC_TP_CD, 'C2', DNSR.FAX_NO , NULL)) AS FAX_NO_2,
       MAX(DECODE(DNSR.CUST_CNTC_TP_CD, 'B1', DNSR.FAX_NO , NULL)) AS FAX_NO_3,
       MAX(DECODE(DNSR.CUST_CNTC_TP_CD, 'B2', DNSR.FAX_NO , NULL)) AS FAX_NO_4,
       MAX(DECODE(DNSR.CUST_CNTC_TP_CD, 'A1', DNSR.FAX_NO , NULL)) AS FAX_NO_5,
       MAX(DECODE(DNSR.CUST_CNTC_TP_CD, 'A2', DNSR.FAX_NO , NULL)) AS FAX_NO_6,
       MAX(DECODE(DNSR.CUST_CNTC_TP_CD, 'AN', DNSR.FAX_NO , NULL)) AS FAX_NO_7,
       MAX(BKG_COM_INTG_CD_NM_FNC('CD00960', DECODE(DNSR.CUST_CNTC_TP_CD, 'C1', EMSD.EML_PROC_STS_CD, NULL))) AS EML_RESULT_1,
       MAX(BKG_COM_INTG_CD_NM_FNC('CD00960', DECODE(DNSR.CUST_CNTC_TP_CD, 'C2', EMSD.EML_PROC_STS_CD, NULL))) AS EML_RESULT_2,
       MAX(BKG_COM_INTG_CD_NM_FNC('CD00960', DECODE(DNSR.CUST_CNTC_TP_CD, 'B1', EMSD.EML_PROC_STS_CD, NULL))) AS EML_RESULT_3,
       MAX(BKG_COM_INTG_CD_NM_FNC('CD00960', DECODE(DNSR.CUST_CNTC_TP_CD, 'B2', EMSD.EML_PROC_STS_CD, NULL))) AS EML_RESULT_4,
       MAX(BKG_COM_INTG_CD_NM_FNC('CD00960', DECODE(DNSR.CUST_CNTC_TP_CD, 'A1', EMSD.EML_PROC_STS_CD, NULL))) AS EML_RESULT_5,
       MAX(BKG_COM_INTG_CD_NM_FNC('CD00960', DECODE(DNSR.CUST_CNTC_TP_CD, 'A2', EMSD.EML_PROC_STS_CD, NULL))) AS EML_RESULT_6,
       MAX(BKG_COM_INTG_CD_NM_FNC('CD00960', DECODE(DNSR.CUST_CNTC_TP_CD, 'AN', EMSD.EML_PROC_STS_CD, NULL))) AS EML_RESULT_7,
       MAX(BKG_COM_INTG_CD_NM_FNC('CD00959', DECODE(DNSR.CUST_CNTC_TP_CD, 'C1', FXSD.FAX_PROC_STS_CD, NULL))) AS FAX_RESULT_1,
       MAX(BKG_COM_INTG_CD_NM_FNC('CD00959', DECODE(DNSR.CUST_CNTC_TP_CD, 'C2', FXSD.FAX_PROC_STS_CD, NULL))) AS FAX_RESULT_2,
       MAX(BKG_COM_INTG_CD_NM_FNC('CD00959', DECODE(DNSR.CUST_CNTC_TP_CD, 'B1', FXSD.FAX_PROC_STS_CD, NULL))) AS FAX_RESULT_3,
       MAX(BKG_COM_INTG_CD_NM_FNC('CD00959', DECODE(DNSR.CUST_CNTC_TP_CD, 'B2', FXSD.FAX_PROC_STS_CD, NULL))) AS FAX_RESULT_4,
       MAX(BKG_COM_INTG_CD_NM_FNC('CD00959', DECODE(DNSR.CUST_CNTC_TP_CD, 'A1', FXSD.FAX_PROC_STS_CD, NULL))) AS FAX_RESULT_5,
       MAX(BKG_COM_INTG_CD_NM_FNC('CD00959', DECODE(DNSR.CUST_CNTC_TP_CD, 'A2', FXSD.FAX_PROC_STS_CD, NULL))) AS FAX_RESULT_6,
       MAX(BKG_COM_INTG_CD_NM_FNC('CD00959', DECODE(DNSR.CUST_CNTC_TP_CD, 'AN', FXSD.FAX_PROC_STS_CD, NULL))) AS FAX_RESULT_7
    FROM TRS_DO_NTFC_SNT_RPT DNSR,
       TRS_DO_NTFC_SNT_RPT_DTL DNSD,
       BKG_BOOKING BKGM,
       COM_FAX_SND_INFO FXSD,
       COM_EML_SND_INFO EMSD
    WHERE 1=1
        AND DNSR.DO_NTFC_SNT_RPT_SEQ = DNSD.DO_NTFC_SNT_RPT_SEQ
        AND DNSD.BKG_NO = BKGM.BKG_NO
        AND DNSR.FAX_NTC_SND_ID = FXSD.FAX_SND_NO(+)
        AND DNSR.EML_NTC_SND_ID = EMSD.EML_SND_NO(+)

    #if(${f_sent_fm_dt} != '' && ${f_sent_to_dt} != '')
        AND DNSD.NTC_SND_DT BETWEEN TO_DATE(@[f_sent_fm_dt], 'YYYYMMDD') AND TO_DATE(@[f_sent_to_dt], 'YYYYMMDD')+0.99999
    #end
    #if ($f_ctrl_ofc_cd.size() > 0)
        AND DNSD.CTRL_OFC_CD IN (
        #foreach($key in ${f_ctrl_ofc_cd}) 
            #if($velocityCount < $f_ctrl_ofc_cd.size()) 
                '$key', 
            #else 
                '$key' 
            #end 
        #end
        )
    #end
    #if(${f_fm_node} != '') 
        AND DNSD.FM_NOD_CD LIKE @[f_fm_node]||'%'
    #end
    #if(${f_to_node} != '') 
        AND DNSD.TO_NOD_CD LIKE @[f_to_node]||'%'
    #end
    #if(${f_door} != '') 
        AND DNSD.DOR_NOD_CD LIKE @[f_door]||'%'
    #end
    #if($f_trnk_vvd.size() > 0)
		AND ((BKGM.VSL_CD, BKGM.SKD_VOY_NO, BKGM.SKD_DIR_CD) IN (
		#foreach( ${key} in ${f_trnk_vvd}) 
        	#if($velocityCount == 1)
				( SUBSTR('$key', 1, 4), SUBSTR('$key', 5, 4), SUBSTR('$key', 9))
	        #else 
    		     , ( SUBSTR('$key', 1, 4), SUBSTR('$key', 5, 4), SUBSTR('$key', 9))
			#end 
       #end
			)
		)
    #end
    #if ($f_bkg_no.size() > 0)
		AND BKGM.BKG_NO IN (
		#foreach( $key in ${f_bkg_no}) 
			#if($velocityCount < $f_bkg_no.size()) 
        		UPPER('$key'), 
        	#else 
            	UPPER('$key')
        	#end 
        #end
       )
    #end
    #if($f_cntr_no.size() > 0)    
        AND DNSD.CNTR_NO IN (
		#foreach( ${key} in ${f_cntr_no}) 
			#if($velocityCount < $f_cntr_no.size()) 
        		UPPER('${key}'), 
        	#else 
            	UPPER('${key}')
        	#end 
        #end
       )
    #end
    #if($f_sc_no.size() > 0)
        AND (BKGM.SC_NO IN (
		#foreach( ${key} in ${f_sc_no})
			#if($velocityCount < $f_sc_no.size()) 
        		UPPER('${key}'), 
        	#else 
            	UPPER('${key}')
        	#end 
        #end
       ) OR BKGM.RFA_NO IN (
		#foreach( ${key} in ${f_sc_no})
			#if($velocityCount < $f_sc_no.size()) 
        		UPPER('${key}'), 
        	#else 
            	UPPER('${key}')
        	#end 
        #end
			)
		)
    #end
    GROUP BY 
        BKGM.BL_NO
       ,DNSD.CNTR_NO
	   ,DNSR.BKG_CUST_TP_CD
       ,DNSR.CUST_SEQ 
    #if(${f_latest} == '')
       ,DNSD.NTC_SND_DT
    #end
    ORDER BY 
        BKGM.BL_NO
       ,DNSD.CNTR_NO
	   ,DNSR.BKG_CUST_TP_CD
       ,DNSR.CUST_SEQ 
    #if(${f_latest} == '')
       ,DNSD.NTC_SND_DT
    #end
 )			]]></sql>
			<params>
				<param name="f_sent_fm_dt" type="12" value="" out="N"/>
				<param name="f_sent_to_dt" type="12" value="" out="N"/>
				<param name="f_fm_node" type="12" value="" out="N"/>
				<param name="f_to_node" type="12" value="" out="N"/>
				<param name="f_door" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
