<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ProductCatalogCreateDBDAOSearchCurrentPatternOrdRSQL">
			<desc><![CDATA[ProductCatalogCreateDBDAOSearchCurrentPatternOrdRSQL.Query]]></desc>
			<sql><![CDATA[
select
PCTL_NO, BKG_NO, COP_NO, CRNT_FLG, CNTR_NO, CNTR_TPSZ_CD, COP_OP_TP_CD,
OB_ITCHG_CTNT, MTY_PKUP_YD_CD, BKG_OP_RMK, MTY_RTN_YD_CD, IB_ITCHG_CTNT,
POR_NOD_CD, OCN_ITCHG_CTNT, POL_NOD_CD, BKG_RCV_TERM_CD, BKG_DE_TERM_CD,
OB_TRO_FLG, IB_TRO_FLG, COP_PATT_ORD_NO, COP_SO_KNT,COP_MAPG_SEQ
,(
    SELECT TRSP_MOD_CD FROM PRD_INLND_ROUT_MST WHERE ROUT_ORG_NOD_CD =SUBSTR(IRG_KEY,1,7)
    AND ROUT_DEST_NOD_CD = SUBSTR(IRG_KEY,8,7)
    AND ROUT_SEQ =SUBSTR(IRG_KEY,15)  
 
) COP_PC_OB_TRSP_MOD_CD
from
(
    SELECT M.PCTL_NO, M.BKG_NO, M.COP_NO, CRNT_FLG, M.CNTR_NO, M.CNTR_TPSZ_CD, COP_OP_TP_CD,
    OB_ITCHG_CTNT, MTY_PKUP_YD_CD, BKG_OP_RMK, MTY_RTN_YD_CD, IB_ITCHG_CTNT,
    M.POR_NOD_CD, OCN_ITCHG_CTNT, M.POL_NOD_CD, BKG_RCV_TERM_CD, BKG_DE_TERM_CD,
    M.OB_TRO_FLG, M.IB_TRO_FLG, M.COP_PATT_ORD_NO, M.COP_SO_KNT,M.COP_MAPG_SEQ,
	row_number() over (partition by COP_PATT_ORD_NO order by COP_PATT_ORD_NO) rn,
	COUNT(*) OVER (PARTITION BY COP_PATT_ORD_NO) CNT
	,H.PCTL_NO COP_PC
    ,(SELECT ROUT_ORG_NOD_CD||ROUT_DEST_NOD_CD||ROUT_SEQ FROM PRD_PROD_CTL_ROUT_DTL D WHERE D.PCTL_NO =  H.PCTL_NO
    AND  PCTL_IO_BND_CD = 'O'   
    AND ROWNUM = 1 ) IRG_KEY
	
	FROM PRD_BKG_COP_MAP M, SCE_COP_HDR H 
	WHERE COP_MAPG_SEQ=@[cop_mapg_seq]
	AND M.COP_NO =H.COP_NO
)
where rn =1 
ORDER BY COP_PATT_ORD_NO,NVL(POL_NOD_CD,'AAAAA00'), CNT DESC			]]></sql>
			<params>
				<param name="cop_mapg_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
