<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ManualRegisterDBDAOSearchBkgVvdCheckRSQL">
			<desc><![CDATA[BkgVvd]]></desc>
			<sql><![CDATA[
#if (${yd_cd} !='')
SELECT V.SKD_DIR_CD||V.RLANE_DIR_CD AS FINC_DIR_CD
FROM AR_MST_REV_VVD V 
WHERE (VSL_CD, SKD_VOY_NO, SKD_DIR_CD, RLANE_DIR_CD) IN ( 
       SELECT SUBSTR(@[vvd_cd],1,4) AS VSL_CD, SUBSTR(@[vvd_cd],5,4) AS SKD_VOY_NO, 
              SUBSTR(@[vvd_cd],9,1) AS SKD_DIR_CD, AR.RLANE_DIR_CD AS RLANE_DIR_CD
       FROM AR_FINC_DIR_CONV AR,
       (  SELECT SCONTI_CD
            FROM MDM_LOCATION
           WHERE LOC_CD = @[yd_cd]
             AND DELT_FLG = 'N') LOC,
       (  SELECT SLAN_CD
            FROM BKG_VVD
           WHERE VSL_CD     = SUBSTR(@[vvd_cd],1,4)
             AND SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4)
             AND SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)
   #if (${bkg_no} !='')
             AND BKG_NO     = @[bkg_no]
   #end
             AND ROWNUM = 1) VVD
     WHERE VVD.SLAN_CD = AR.SLAN_CD
       AND LOC.SCONTI_CD = AR.SCONTI_CD
       AND AR.SLAN_DIR_CD = SUBSTR(@[vvd_cd],9,1)
     UNION ALL
     SELECT SUBSTR(@[vvd_cd],1,4) AS VSL_CD, SUBSTR(@[vvd_cd],5,4) AS SKD_VOY_NO, 
            SUBSTR(@[vvd_cd],9,1) AS SKD_DIR_CD, SUBSTR(@[vvd_cd],9,1) AS RLANE_DIR_CD
     FROM BKG_VVD
     WHERE VSL_CD   = SUBSTR(@[vvd_cd],1,4)
     AND SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4)
     AND SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)
   #if (${bkg_no} !='')
     AND BKG_NO     = @[bkg_no]
   #end
     )   
AND V.DELT_FLG ='N'
AND ROWNUM = 1
#else
SELECT DISTINCT V.SKD_DIR_CD||V.RLANE_DIR_CD  AS FINC_DIR_CD
  FROM AR_MST_REV_VVD V 
  #if (${bkg_no} !='') 
       , BKG_VVD B
 WHERE V.VSL_CD = B.VSL_CD
   AND V.SKD_VOY_NO = B.SKD_VOY_NO
   AND V.SKD_DIR_CD = B.SKD_DIR_CD
   AND V.RLANE_DIR_CD = B.SKD_DIR_CD
   AND B.BKG_NO       = @[bkg_no]
   AND B.VSL_CD       = SUBSTR(@[vvd_cd],1,4)
   AND B.SKD_VOY_NO   = SUBSTR(@[vvd_cd],5,4)
   AND B.SKD_DIR_CD   = SUBSTR(@[vvd_cd],9,1)
  #else
   WHERE V.VSL_CD   = SUBSTR(@[vvd_cd],1,4)
   AND V.SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4)
   AND V.SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)
   AND V.RLANE_DIR_CD = SUBSTR(@[vvd_cd],9,1)
  #end
   AND V.DELT_FLG ='N'
#end			]]></sql>
			<params>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
