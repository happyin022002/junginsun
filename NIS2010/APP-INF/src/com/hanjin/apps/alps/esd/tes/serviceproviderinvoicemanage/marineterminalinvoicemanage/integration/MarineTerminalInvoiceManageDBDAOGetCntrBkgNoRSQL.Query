<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MarineTerminalInvoiceManageDBDAOGetCntrBkgNoRSQL">
			<desc><![CDATA[검색조건: I/O + Yard code + 공통항차 Voyage의 Year-Month에 속한 컨테이너 VL/VD와 mapping된 Full_Bkg]]></desc>
			<sql><![CDATA[
SELECT A.BKG_NO
     , A.CNTR_NO
     , A.CNTR_TPSZ_CD
     , DECODE(BR.CONTI_CD,BD.CONTI_CD,'I','O') IOC_CD
     , CASE WHEN COUNT(FDR.FDR_POD_CD) > 0
            THEN DECODE(@[io_bnd_cd],'I',DECODE(V.POD_CD,B.POD_CD,DECODE(V.POL_CD,B.POL_CD,'L','T'),'T'),
                'O',DECODE(V.POL_CD,B.POL_CD,DECODE(V.POD_CD,B.POD_CD,'L','T'),'T'))
        ELSE 'L'
        END LOCL_TS_IND_CD
     , CASE WHEN COUNT(FDR.FDR_POD_CD) > 0
            THEN DECODE(V.VSL_PRE_PST_CD,'T','V',NULL,'O','','O',
                     DECODE(@[io_bnd_cd],'I',
                         DECODE(V.POL_CD,F.FDR_POL_CD,'B','F'),
                           DECODE(V.POD_CD,F.FDR_POD_CD,'B','F')))
        ELSE  'B'
        END TML_TRNS_MOD_CD
     , V.SLAN_CD LANE_CD
     , B.BL_NO
     , B.RCV_TERM_CD||'/'||B.DE_TERM_CD RCVDE_TERM_IND_CD
FROM (
    SELECT H.BKG_NO, H.CNTR_NO, H.CNTR_TPSZ_CD, D.ACT_DT, D.VSL_CD
    FROM SCE_COP_HDR H, SCE_COP_DTL D
    WHERE H.COP_NO = D.COP_NO
    AND D.ACT_STS_MAPG_CD = DECODE(@[io_bnd_cd],'I','VD','VL')
    AND D.NOD_CD = @[yd_cd] AND H.CNTR_NO = @[cntr_no]
    AND (TO_CHAR(D.ACT_DT,'YYMM') = @[skd_voy_no] OR TO_CHAR(D.PLN_DT,'YYMM') = @[skd_voy_no])
    ) A, BKG_VVD V, BKG_BOOKING B, MDM_LOCATION BR, MDM_LOCATION BD, TES_TML_SPCL_FDR F, TES_TML_SPCL_FDR FDR
WHERE A.BKG_NO = V.BKG_NO 
AND A.BKG_NO = B.BKG_NO
AND A.VSL_CD = V.VSL_CD
AND B.POR_CD = BR.LOC_CD(+)
AND B.POD_CD = BD.LOC_CD(+)
AND V.POD_CD = F.FDR_POD_CD(+)
AND V.POL_CD = F.FDR_POL_CD(+)
AND DECODE(@[io_bnd_cd],'I',V.POD_CD,V.POL_CD) = DECODE(@[io_bnd_cd], 'I',FDR.FDR_POD_CD(+), FDR.FDR_POL_CD(+))
GROUP BY A.BKG_NO
     , A.CNTR_NO
     , A.CNTR_TPSZ_CD
     , BR.CONTI_CD, BD.CONTI_CD
     , V.POD_CD, B.POD_CD, V.POL_CD, B.POL_CD
     , V.VSL_PRE_PST_CD, F.FDR_POL_CD, F.FDR_POD_CD
     , V.SLAN_CD
     , B.BL_NO
     , B.RCV_TERM_CD, B.DE_TERM_CD			]]></sql>
			<params>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
