<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EacMgtDBDAOSearchTPBRSQL">
			<desc><![CDATA[TPB I/F 후 TPB 정보를 조회한다]]></desc>
			<sql><![CDATA[
SELECT MAX(NVL(Y.STL_TO_CLT_CNG_OFC_CD, X.OFC_CD)) TPB_OFC_CD -- ROC office
     , MAX(CASE WHEN Z.OTS_STS_CD IN ('R','T','J') THEN COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD02799',X.OTS_STS_DTL_CD)
               ELSE COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00588',Z.OTS_STS_CD)
           END) AS OTS_STS_NM -- TPB status
     , SUM(TPB_GET_USD_AMT_FNC(D.CFM_AMT, D.CFM_CURR_CD,TPB_GET_LCL_DATE_FNC(D.CFM_DT,D.CFM_OFC_CD))) AS TPB_INV_AMT -- Recovery(US$)
     , X.N3PTY_NO
 FROM TPB_OTS_GRP X
    , TPB_ADJ_STS Y
    , TPB_OTS_GRP_STS Z
    , TPB_OTS_DTL D
WHERE X.N3PTY_NO = Y.N3PTY_NO(+)
  AND Y.STL_STS_LST_FLG(+) = 'Y' 
  AND Y.N3PTY_STL_TP_CD(+) = 'O'
  AND X.N3PTY_NO = Z.N3PTY_NO
  AND Z.OTS_STS_LST_FLG = 'Y'   
  AND X.N3PTY_NO = D.N3PTY_NO
  AND X.N3PTY_NO = @[n3pty_no]
  GROUP BY X.N3PTY_NO

			]]></sql>
			<params>
				<param name="n3pty_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
