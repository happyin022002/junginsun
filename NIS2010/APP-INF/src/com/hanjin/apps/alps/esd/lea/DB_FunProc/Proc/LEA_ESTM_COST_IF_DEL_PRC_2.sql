CREATE OR REPLACE PROCEDURE LEA_ESTM_COST_IF_DEL_PRC_2(NAME IN  CHAR )
AUTHID CURRENT_USER
IS
    V_LOG_SEQ         MIG_LOG.MIG_LOG_SEQ%TYPE;
    V_WORK_SEQ        MIG_LOG.WORK_SEQ%TYPE;
    V_SYS_NM          MIG_LOG.SYS_NM%TYPE;
    V_PROG_NM         MIG_LOG.PROG_NM%TYPE;
    V_OWN_NM          VARCHAR2(30);
    V_ENT_NM          MIG_LOG.ENT_NM%TYPE;
    V_TAB_NM          MIG_LOG.TAB_NM%TYPE;
    V_ACT_TP          MIG_LOG.ACT_TP%TYPE;
    V_INS_ROW_CNT     MIG_LOG.INS_ROW_CNT%TYPE;
    V_PRC_ROW_CNT     MIG_LOG.INS_ROW_CNT%TYPE;
    V_LOG_MSG         MIG_LOG.LOG_MSG%TYPE;
    V_LOG_MSG_MAIN    MIG_LOG.LOG_MSG%TYPE;
    V_AUTHOR_NM       MIG_LOG.AUTHOR_NM%TYPE;
    V_WORK_GRP_ID     MIG_LOG.WORK_GRP_ID%TYPE;
    V_SUB_STEP_DESC   MIG_LOG_SUB_STEP.SUB_STEP_DESC%TYPE;
    V_LOG_SUB_SEQ     MIG_LOG_SUB_STEP.MIG_LOG_SUB_SEQ%TYPE;

    V_ERRNO           MIG_LOG.ERR_TP%TYPE;
    V_ERRMSG          MIG_LOG.LOG_MSG%TYPE;
    V_ERRNO_SUB_STEP  MIG_LOG_SUB_STEP.ERR_TP%TYPE;
      
BEGIN
    V_WORK_SEQ      := 1;
      
    V_SYS_NM        := 'LEA';
    V_PROG_NM       := 'LEA_ESTM_COST_IF_2';
    V_OWN_NM        := 'NISADM';
    V_ENT_NM        := 'LEA_ESTM_COST_IF_2';
    V_TAB_NM        := 'LEA_ESTM_COST_IF_2';
    V_INS_ROW_CNT   := 0;
    V_PRC_ROW_CNT  := 0;
    V_LOG_MSG       := '';
    V_LOG_MSG_MAIN  := '';
    V_ERRNO         := '';
    V_WORK_GRP_ID   := '${WORK_GRP_ID}';

    -- LOG START
    MIG_UTL_PURGE.PRC_MIG_PGM_LOG (
    I_LOG_MODE => 'LOG_START',  I_LOG_SEQ => NULL,      I_WORK_SEQ => V_WORK_SEQ,   I_SYS_NM => V_SYS_NM,       I_PROG_NM=> V_PROG_NM,
    I_ENT_NM => V_ENT_NM,       I_TAB_NM => V_TAB_NM,   I_ACT_TP   => 'D',          I_INS_ROW_CNT => 0,         I_LOG_MSG => V_LOG_MSG_MAIN,
    I_AUTHOR_NM => V_AUTHOR_NM, O_LOG_SEQ => V_LOG_SEQ, O_ERRNO => V_ERRNO,         O_ERRMSG => V_ERRMSG,       I_WORK_GRP_ID => V_WORK_GRP_ID);

     V_SUB_STEP_DESC := 'DATA_PURGE';
              

LOOP

    -- SUB STEP LOG START
    MIG_UTL_PURGE.PRC_MIG_PGM_LOG_SUB_STEP (
    I_LOG_MODE => 'LOG_START',      I_LOG_SEQ => V_LOG_SEQ,      I_LOG_SUB_SEQ => NULL,  I_SUB_STEP_DESC => V_SUB_STEP_DESC,
    I_ACT_TP   => 'D',              I_PRC_ROW_CNT => 0,          I_LOG_MSG => NULL,
    O_LOG_SUB_SEQ => V_LOG_SUB_SEQ, O_ERRNO => V_ERRNO_SUB_STEP, O_ERRMSG => V_ERRMSG );


    DELETE  FROM LEA_ESTM_COST_IF WHERE UPD_DT BETWEEN TO_DATE('20091101', 'YYYYMMDD') AND TO_DATE('20091130', 'YYYYMMDD') 
                                        AND ROWNUM <= 10000 ;
                
    V_PRC_ROW_CNT := SQL%ROWCOUNT;
    V_INS_ROW_CNT := V_INS_ROW_CNT + V_PRC_ROW_CNT;
    COMMIT;
    -- SUB STEP LOG FINISH
    MIG_UTL_PURGE.PRC_MIG_PGM_LOG_SUB_STEP (
    I_LOG_MODE => 'LOG_FINISH',     I_LOG_SEQ => V_LOG_SEQ,      I_LOG_SUB_SEQ => V_LOG_SUB_SEQ,  I_SUB_STEP_DESC => V_SUB_STEP_DESC,
    I_PRC_ROW_CNT => V_PRC_ROW_CNT, I_LOG_MSG => V_LOG_MSG,    
    O_LOG_SUB_SEQ => V_LOG_SUB_SEQ, O_ERRNO => V_ERRNO_SUB_STEP, O_ERRMSG => V_ERRMSG  );



    EXIT WHEN V_PRC_ROW_CNT = 0 ;

END LOOP;    
    
    -- LOG FINISH
    MIG_UTL_PURGE.PRC_MIG_PGM_LOG (
    I_LOG_MODE => 'LOG_FINISH', I_LOG_SEQ => V_LOG_SEQ, I_WORK_SEQ => V_WORK_SEQ,       I_SYS_NM => V_SYS_NM,       I_PROG_NM=> V_PROG_NM,
    I_ENT_NM => V_ENT_NM,       I_TAB_NM => V_TAB_NM,   I_INS_ROW_CNT => V_INS_ROW_CNT, I_LOG_MSG => V_LOG_MSG_MAIN,     I_AUTHOR_NM => V_AUTHOR_NM,
    O_LOG_SEQ => V_LOG_SEQ,     O_ERRNO => V_ERRNO,     O_ERRMSG => V_ERRMSG );

    V_INS_ROW_CNT := 0;   -- SUB STEP PROCESS COUNT CLEAR
  

END ;
/
