<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ProductCatalogCreateDBDAOSearchPrdCnstInfoLinkRSQL">
			<desc><![CDATA[생성된 PC의 해당되는 prd_lnk_cnst_mgmt를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT NVL(C.SVC_USE_FLG, 'Y') SVC_USE_FLG
      , C.LNK_ORG_NOD_CD || ' - ' || C.LNK_DEST_NOD_CD NTWK_UT_NM
      , C.PCTL_CNST_ITM_NM ITM_NM
      , C.TRSP_MOD_CD
      , C.VSL_SLAN_CD
      , C.VSL_CD || C.SKD_VOY_NO || C.SKD_DIR_CD VVD
      , C.CNTR_TP_CD
      , C.CMDT_CD
      , C.LNK_CNST_RMK CNST_RMK
      , C.CRE_OFC_CD
      , C.CRE_USR_ID
 FROM PRD_LNK_CNST_MGMT C, PRD_PROD_CTL_QTY Q , PRD_PROD_CTL_ROUT_DTL D   
 ,PRD_PROD_CTL_MST M   
 , MDM_VSL_SVC_LANE S
 WHERE d.pctl_no = @[pctl_no]  
 AND M.PCTL_NO = D.PCTL_NO    
 AND D.NOD_LNK_DIV_CD = 'L'   
 and D.PCTL_NO = Q.PCTL_NO   
 AND D.ORG_NOD_CD LIKE C.LNK_ORG_NOD_CD||'%'   
 AND D.DEST_NOD_CD LIKE C.LNK_DEST_NOD_CD||'%'   
 AND DECODE(D.TRSP_MOD_CD, 'VD', 'WD', D.TRSP_MOD_CD) = DECODE(C.TRSP_MOD_CD, 'AL' ,DECODE(D.TRSP_MOD_CD, 'VD', 'WD', D.TRSP_MOD_CD), C.TRSP_MOD_CD )  
 AND D.VSL_SLAN_CD || ',' || DECODE(S.VSL_SVC_TP_CD, 'O', 'FDR') LIKE '%' || C.VSL_SLAN_CD || '%'
 AND NVL(D.VSL_CD || D.SKD_VOY_NO || D.SKD_DIR_CD, '#') = DECODE(C.VSL_CD || C.SKD_VOY_NO || C.SKD_DIR_CD, NULL, NVL(D.VSL_CD || D.SKD_VOY_NO || D.SKD_DIR_CD, '#'), C.VSL_CD || C.SKD_VOY_NO || C.SKD_DIR_CD)
 AND NVL(M.CMDT_CD,'X')  = NVL(C.CMDT_CD, NVL(M.CMDT_CD,'X'))    
 AND NVL(C.DELT_FLG, 'N') <> 'Y'   
 AND NVL(C.CNTR_TP_CD, Q.CNTR_TPSZ_CD)   
	= DECODE(C.CNTR_TP_CD, NULL, Q.CNTR_TPSZ_CD, DECODE(SUBSTR(Q.CNTR_TPSZ_CD, 1, 1), 'T', 'T', 'O', 'S', 'F', 'S',   
														--'D',DECODE(Q.CNTR_TPSZ_CD, 'D5', 'D5', 'D7', 'D7', Q.CNTR_TPSZ_CD),
														--'R',DECODE(Q.CNTR_TPSZ_CD, 'R2', 'R2', 'R5', 'R5', Q.CNTR_TPSZ_CD)) )
														'D',Q.CNTR_TPSZ_CD,
														'R',Q.CNTR_TPSZ_CD) )
 AND (   
                -- 사용자 요청으로 PC생성일 기준으로 변경		
			TRUNC(TO_DATE(NVL(C.EFF_FM_DT,'19000101'),'yyyy/mm/dd hh24:mi:ss')) <= M.CRE_DT AND   
			M.CRE_DT < TRUNC(TO_DATE(NVL(C.EFF_TO_DT,'25000101'),'yyyy/mm/dd hh24:mi:ss')+1)   
     ) 
AND S.VSL_SLAN_CD(+) = D.VSL_SLAN_CD
ORDER BY NVL(C.SVC_USE_FLG, 'Y')			]]></sql>
			<params>
				<param name="pctl_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
