<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DwellNotificationDBDAOAddDwllNtfcExptCSQL">
			<desc><![CDATA[Email Sending Exception List을 저장한다.]]></desc>
			<sql><![CDATA[
MERGE INTO SCE_DWLL_NTFC_CUST_EXPT T

USING ( SELECT SUBSTR(@[cust_cd],1,2) DWLL_CUST_CNT_CD
             , TO_NUMBER(SUBSTR(@[cust_cd],3,6)) DWLL_CUST_SEQ
             , @[sc_no]         SC_NO
             , CASE WHEN @[eff_dt] IS NULL THEN TO_CHAR(SYSDATE, 'YYYYMMDD') 
                    WHEN @[eff_dt] <= '09991231' THEN '09991231'
                    ELSE TO_CHAR(TO_DATE(@[eff_dt], 'YYYYMMDD')
                                  + (TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD'),'YYYYMMDD') 
                                      - TO_DATE(TO_CHAR(GLOBALDATE_PKG.TIME_CONV_FNC('KRSEL', SYSDATE, GLOBALDATE_PKG.GET_LOCCD_FNC(@[ofc_cd])), 'YYYYMMDD'),'YYYYMMDD')
                                    )
                               , 'YYYYMMDD')
                    END AS FM_EFF_DT
             , CASE WHEN @[exp_dt] IS NULL THEN '99991231'
                    WHEN @[exp_dt] >= '99991231' THEN '99991231'
                    ELSE TO_CHAR(TO_DATE(@[exp_dt], 'YYYYMMDD')
                                  + (TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD'),'YYYYMMDD') 
                                      - TO_DATE(TO_CHAR(GLOBALDATE_PKG.TIME_CONV_FNC('KRSEL', SYSDATE, GLOBALDATE_PKG.GET_LOCCD_FNC(@[ofc_cd])), 'YYYYMMDD'),'YYYYMMDD')
                                    )
                               , 'YYYYMMDD')
               END AS  TO_EFF_DT
             , DECODE(@[tml_dwll_flg],'1','Y','N')  TML_DWLL_FLG
             , DECODE(@[enr_dwll_flg],'1','Y','N')  ENR_DWLL_FLG
             , DECODE(@[dest_dwll_flg],'1','Y','N') DEST_DWLL_FLG
             , DECODE(@[vsl_dlay_flg],'1','Y','N')  VSL_DLAY_FLG
             , DECODE(@[bkg_tml_dwll_flg],'1','Y','N')  BKG_TML_DWLL_FLG
             , DECODE(@[bkg_enr_dwll_flg],'1','Y','N')  BKG_ENR_DWLL_FLG
             , DECODE(@[bkg_dest_dwll_flg],'1','Y','N') BKG_DEST_DWLL_FLG
             , DECODE(@[bkg_vsl_dlay_flg],'1','Y','N')  BKG_VSL_DLAY_FLG
        FROM DUAL )S
ON (T.DWLL_CUST_CNT_CD = S.DWLL_CUST_CNT_CD AND T.DWLL_CUST_SEQ = S.DWLL_CUST_SEQ)
WHEN MATCHED THEN
UPDATE
SET T.FM_EFF_DT       = S.FM_EFF_DT      
  , T.TO_EFF_DT       = S.TO_EFF_DT      
  , T.TML_DWLL_FLG    = S.TML_DWLL_FLG   
  , T.ENR_DWLL_FLG    = S.ENR_DWLL_FLG   
  , T.DEST_DWLL_FLG   = S.DEST_DWLL_FLG  
  , T.VSL_DLAY_FLG    = S.VSL_DLAY_FLG
  , T.DWLL_EXPT_RMK   = @[dwll_expt_rmk]
  , T.UPD_USR_ID      = @[usr_id]     
  , T.UPD_DT          = SYSDATE         
  , T.EXPT_SET_USR_ID = @[usr_id]
  , T.EXPT_SET_DT     = SYSDATE    
  , T.DELT_FLG		  = 'N'      
  , T.BKG_TML_DWLL_FLG    = S.BKG_TML_DWLL_FLG   
  , T.BKG_ENR_DWLL_FLG    = S.BKG_ENR_DWLL_FLG   
  , T.BKG_DEST_DWLL_FLG   = S.BKG_DEST_DWLL_FLG  
  , T.BKG_VSL_DLAY_FLG    = S.BKG_VSL_DLAY_FLG

WHEN NOT MATCHED THEN 
INSERT (T.SC_NO, 
        T.DWLL_CUST_CNT_CD,
        T.DWLL_CUST_SEQ,
        T.CRE_USR_ID,
        T.CRE_DT,
        T.UPD_USR_ID,
        T.UPD_DT,
        T.FM_EFF_DT,
        T.TO_EFF_DT,
        T.TML_DWLL_FLG,
        T.ENR_DWLL_FLG,
        T.DEST_DWLL_FLG,
        T.VSL_DLAY_FLG,
        T.DWLL_EXPT_RMK,
        T.EXPT_SET_USR_ID,
        T.EXPT_SET_DT,
		T.DELT_FLG,		
        T.BKG_TML_DWLL_FLG,
        T.BKG_ENR_DWLL_FLG,
        T.BKG_DEST_DWLL_FLG,
        T.BKG_VSL_DLAY_FLG )
 VALUES (S.SC_NO,
         S.DWLL_CUST_CNT_CD,
         S.DWLL_CUST_SEQ,
         @[usr_id],
         SYSDATE,
         @[usr_id],
         SYSDATE,
         S.FM_EFF_DT,
         S.TO_EFF_DT,
         S.TML_DWLL_FLG,
         S.ENR_DWLL_FLG,
         S.DEST_DWLL_FLG,
         S.VSL_DLAY_FLG,
         @[dwll_expt_rmk],
         @[usr_id],
         SYSDATE,
		 'N',
         S.BKG_TML_DWLL_FLG,
         S.BKG_ENR_DWLL_FLG,
         S.BKG_DEST_DWLL_FLG,
         S.BKG_VSL_DLAY_FLG )			]]></sql>
			<params>
				<param name="cust_cd" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
				<param name="eff_dt" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="exp_dt" type="12" value="" out="N"/>
				<param name="tml_dwll_flg" type="12" value="" out="N"/>
				<param name="enr_dwll_flg" type="12" value="" out="N"/>
				<param name="dest_dwll_flg" type="12" value="" out="N"/>
				<param name="vsl_dlay_flg" type="12" value="" out="N"/>
				<param name="bkg_tml_dwll_flg" type="12" value="" out="N"/>
				<param name="bkg_enr_dwll_flg" type="12" value="" out="N"/>
				<param name="bkg_dest_dwll_flg" type="12" value="" out="N"/>
				<param name="bkg_vsl_dlay_flg" type="12" value="" out="N"/>
				<param name="dwll_expt_rmk" type="12" value="" out="N"/>
				<param name="usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
