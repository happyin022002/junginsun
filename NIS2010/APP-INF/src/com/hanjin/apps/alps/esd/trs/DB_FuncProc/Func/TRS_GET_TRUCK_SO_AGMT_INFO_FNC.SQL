CREATE OR REPLACE FUNCTION TRS_GET_TRUCK_SO_AGMT_INFO_FNC (    IN_TRSP_SO_OFC_CTY_CD in VARCHAR2,   IN_TRSP_SO_SEQ in NUMBER,   IN_DEBUG_FLG in VARCHAR2) RETURN VARCHAR2AUTHID CURRENT_USER/*******************************************************************************   1. Object Name      : TRS_GET_SO_AGMT_INFO_FNC   2. Version          : 1.0   3. Create Date      : MAY 18, 2010   4. Sub System       : ALPS/TRS   5. Author           : POONG YEON CHO   6. Description      : GETTING FOC INFO   7. Revision History : 2010.05.18 CREATE*******************************************************************************/IS    po_trsp_agmt_ofc_cty_cd    VARCHAR2(100) ;   po_trsp_agmt_seq           NUMBER        ;   po_trsp_agmt_rt_tp_cd      VARCHAR2(100) ;   po_way_type                VARCHAR2(100) ;   po_trsp_agmt_rt_tp_nm      VARCHAR2(100) ;   po_sp_type                 VARCHAR2(100) ;   po_cust_nomi_trkr_flg      VARCHAR2(100) ;   po_cust_cnt_cd             VARCHAR2(100) ;   po_cust_seq                NUMBER        ;   po_local_curr_cd           VARCHAR2(100) ;   po_bzc_rt                  NUMBER        ;   po_fuel_scg_rt             NUMBER        ;   po_over_wgt_scg_rt         NUMBER        ;   po_hzs_scg_rt              NUMBER        ;   po_ttl_wgt_scg_rt          NUMBER        ;   po_vat_scg_rt              NUMBER        ;   po_scg1_rt                 NUMBER        ;   po_scg2_rt                 NUMBER        ;   po_scg3_rt                 VARCHAR2(4000);   po_local_curr_tot_amt      NUMBER        ;   po_usd_curr_tot_amt        NUMBER        ;   po_wtr_rcv_term_cd         VARCHAR2(100) ;   po_wtr_de_term_cd          VARCHAR2(100) ;   po_rtn_cd                  NUMBER        ;   po_rtn_msg                 VARCHAR2(100) ;   pi_cre_ofc_cd              VARCHAR2(100) ;   pi_vndr_cd                 NUMBER(30)    ;   pi_cre_dt                  DATE          ;   pi_wy_tp_cd                VARCHAR2(100) ;   pi_eq_knd_cd               VARCHAR2(100) ;   pi_eq_tpsz_cd              VARCHAR2(100) ;   pi_trsp_so_cmb_tp_cd       VARCHAR2(100) ;   pi_cgo_tp_cd               VARCHAR2(100) ;   pi_trsp_bnd_cd             VARCHAR2(100) ;   pi_trsp_crr_mod_cd         VARCHAR2(100) ;   pi_trsp_cost_dtl_mod_cd    VARCHAR2(100) ;   pi_cust_nomi_trkr_flg      VARCHAR2(100) ;   pi_cust_cnt_cd             VARCHAR2(100) ;   pi_cust_seq                NUMBER        ;   pi_rail_ssvc_tp_cd         VARCHAR2(100) ;   pi_cmdt_cd                 VARCHAR2(100) ;   pi_fm_nod_cd               VARCHAR2(100) ;   pi_via_nod_cd              VARCHAR2(100) ;   pi_dor_nod_cd              VARCHAR2(100) ;   pi_to_nod_cd               VARCHAR2(100) ;   pi_bundling_no             NUMBER        ;   pi_wgt_meas_ut_cd          VARCHAR2(100) ;   pi_cntr_wgt                NUMBER        ;   pi_trsp_agmt_ofc_cty_cd    VARCHAR2(100) ;   pi_trsp_agmt_seq           NUMBER        ;   pi_spcl_cgo_cd             VARCHAR2(100) ;   v_tmp1                     VARCHAR2(100) ;   v_tmp2                     VARCHAR2(100) ;   v_tmp3                     VARCHAR2(100) ;   vn_tmp1                    NUMBER;   V_RETURN                  VARCHAR2(9000) ;    BEGIN     SELECT A.TRSP_AGMT_OFC_CTY_CD           ,A.TRSP_AGMT_SEQ           ,A.CRE_OFC_CD           ,CASE WHEN A.HJL_NO IS NULL THEN A.VNDR_SEQ                 ELSE ( SELECT X.HJL_VNDR_SEQ                          FROM TRS_TRSP_HJL_SVC_ORD X                         WHERE 1=1                           AND X.TRSP_SO_OFC_CTY_CD = IN_TRSP_SO_OFC_CTY_CD                           AND X.TRSP_SO_SEQ = IN_TRSP_SO_SEQ                      )             END AS VNDR_SEQ           ,A.LOCL_CRE_DT           ,A.CRE_USR_ID           ,A.UPD_USR_ID           ,A.EQ_KND_CD           ,A.EQ_TPSZ_CD           ,A.CGO_TP_CD           ,A.TRSP_BND_CD           ,A.TRSP_COST_DTL_MOD_CD           ,CASE WHEN A.HJL_NO IS NOT NULL AND NVL(A.CUST_NOMI_TRKR_FLG,'N') = 'Y' THEN  'Y'                 WHEN A.HJL_NO IS NOT NULL AND NVL(A.CUST_NOMI_TRKR_FLG,'N') = 'N' THEN  'HJS'                 ELSE NVL((SELECT X.CUST_NOMI_TRKR_IND_CD                             FROM TRS_CUST_NOMI_TRKR X                                 ,BKG_BOOKING Y                            WHERE 1=1                              AND A.BKG_NO = Y.BKG_NO                              AND X.PRC_CTRT_TP_CD = DECODE(Y.SC_NO,'','R','S')                              AND X.PRC_CTRT_NO = NVL(Y.SC_NO,Y.RFA_NO)                              AND X.IO_BND_CD =  A.TRSP_BND_CD                              AND X.ORG_NOD_CD = CASE WHEN 'I' = 'I' AND LENGTH(X.ORG_NOD_CD)= 5 THEN SUBSTR(A.FM_NOD_CD,1,5)                                                      WHEN 'I' = 'I' AND LENGTH(X.ORG_NOD_CD)= 7 THEN A.FM_NOD_CD                                                      WHEN 'I' = 'O' AND LENGTH(X.ORG_NOD_CD)= 5 THEN SUBSTR(A.DOR_NOD_CD,1,5)                                                      WHEN 'I' = 'O' AND LENGTH(X.ORG_NOD_CD)= 7 THEN A.DOR_NOD_CD                                                  END                               AND X.DEST_NOD_CD = CASE WHEN 'I' = 'I' AND LENGTH(X.DEST_NOD_CD)= 5 THEN SUBSTR(A.DOR_NOD_CD,1,5)                                                       WHEN 'I' = 'I' AND LENGTH(X.DEST_NOD_CD)= 7 THEN A.DOR_NOD_CD                                                       WHEN 'I' = 'O' AND LENGTH(X.DEST_NOD_CD)= 5 THEN SUBSTR(A.TO_NOD_CD,1,5)                                                       WHEN 'I' = 'O' AND LENGTH(X.DEST_NOD_CD)= 7 THEN A.TO_NOD_CD                                                   END                               AND X.DISP_STS_CD = '03'                              AND ROWNUM =1),'HJS')             END AS CUST_NOMI_TRKR_FLG           ,NVL(SUBSTR(TRS_GET_CUST_INFO_FNC(A.BKG_NO),1,2),'XX') CUST_CNT_CD           ,NVL(SUBSTR(TRS_GET_CUST_INFO_FNC(A.BKG_NO),3),0) CUST_SEQ           ,A.CMDT_CD           ,A.FM_NOD_CD           ,A.TO_NOD_CD           ,A.DOR_NOD_CD           ,A.VIA_NOD_CD           ,0 BUNDLE_CNT           ,A.WGT_MEAS_UT_CD           ,A.CNTR_WGT           ,TRSP_CRR_MOD_CD           ,SPCL_CGO_CNTR_TP_CD      INTO  pi_trsp_agmt_ofc_cty_cd           ,pi_trsp_agmt_seq           ,pi_cre_ofc_cd            ,pi_vndr_cd           ,pi_cre_dt           ,v_tmp1, v_tmp2           ,pi_eq_knd_cd           ,pi_eq_tpsz_cd           ,pi_cgo_tp_cd           ,pi_trsp_bnd_cd           ,pi_trsp_cost_dtl_mod_cd           ,pi_cust_nomi_trkr_flg           ,pi_cust_cnt_cd           ,pi_cust_seq           ,pi_cmdt_cd           ,pi_fm_nod_cd           ,pi_to_nod_cd           ,pi_dor_nod_cd           ,pi_via_nod_cd           ,vn_tmp1           ,pi_wgt_meas_ut_cd           ,pi_cntr_wgt           ,pi_trsp_crr_mod_cd           ,pi_spcl_cgo_cd       FROM TRS_TRSP_SVC_ORD A      WHERE 1=1        AND A.TRSP_SO_OFC_CTY_CD = IN_TRSP_SO_OFC_CTY_CD        AND A.TRSP_SO_SEQ = IN_TRSP_SO_SEQ     ;TRS_AGMT_RATE_CC_PKG.GET_TRS_ALL_RATE_PRC (       'TRS'      ,pi_cre_ofc_cd      ,pi_vndr_cd      ,pi_cre_dt      ,pi_wy_tp_cd      ,pi_eq_knd_cd      ,pi_eq_tpsz_cd      ,pi_trsp_so_cmb_tp_cd      ,pi_cgo_tp_cd      ,pi_trsp_bnd_cd      ,pi_trsp_crr_mod_cd      ,pi_trsp_cost_dtl_mod_cd      ,pi_cust_nomi_trkr_flg      ,pi_cust_cnt_cd      ,pi_cust_seq      ,pi_rail_ssvc_tp_cd      ,pi_cmdt_cd      ,pi_fm_nod_cd      ,pi_via_nod_cd      ,pi_dor_nod_cd      ,pi_to_nod_cd      ,pi_bundling_no      ,pi_wgt_meas_ut_cd      ,pi_cntr_wgt      ,null -- rcv_term      ,null -- de_term      ,pi_trsp_agmt_ofc_cty_cd      ,pi_trsp_agmt_seq      ,pi_spcl_cgo_cd -- spcl_cgo_cd      ,NVL(IN_DEBUG_FLG,'N')  -- debug_flg1      ,po_trsp_agmt_ofc_cty_cd      ,po_trsp_agmt_seq      ,po_trsp_agmt_rt_tp_cd      ,po_way_type      ,po_trsp_agmt_rt_tp_nm      ,po_sp_type      ,po_cust_nomi_trkr_flg      ,po_cust_cnt_cd      ,po_cust_seq      ,po_local_curr_cd      ,po_bzc_rt      ,po_fuel_scg_rt      ,po_over_wgt_scg_rt      ,po_hzs_scg_rt      ,po_ttl_wgt_scg_rt        ,po_vat_scg_rt      ,po_scg1_rt      ,po_scg2_rt      ,po_scg3_rt        ,po_local_curr_tot_amt      ,po_usd_curr_tot_amt      ,po_wtr_rcv_term_cd      ,po_wtr_de_term_cd      ,po_rtn_cd      ,po_rtn_msg    );            V_RETURN :=  IN_TRSP_SO_OFC_CTY_CD            ||'^'||IN_TRSP_SO_SEQ            ||'^'||po_trsp_agmt_ofc_cty_cd            ||'^'||po_trsp_agmt_seq            ||'^'||po_trsp_agmt_rt_tp_cd            ||'^'||po_way_type            ||'^'||po_trsp_agmt_rt_tp_nm            ||'^'||po_sp_type            ||'^'||po_cust_nomi_trkr_flg            ||'^'||po_cust_cnt_cd            ||'^'||po_cust_seq            ||'^'||po_local_curr_cd            ||'^'||po_bzc_rt            ||'^'||po_fuel_scg_rt            ||'^'||po_over_wgt_scg_rt            ||'^'||po_hzs_scg_rt            ||'^'||po_ttl_wgt_scg_rt              ||'^'||po_vat_scg_rt            ||'^'||po_scg1_rt            ||'^'||po_scg2_rt            ||'^'||po_local_curr_tot_amt            ||'^'||po_usd_curr_tot_amt            ||'^'||po_wtr_rcv_term_cd            ||'^'||po_wtr_de_term_cd            ||'^'||po_rtn_cd            ||'^'||po_rtn_msg            ||'^'||po_scg3_rt                   ;   RETURN V_RETURN;     END;