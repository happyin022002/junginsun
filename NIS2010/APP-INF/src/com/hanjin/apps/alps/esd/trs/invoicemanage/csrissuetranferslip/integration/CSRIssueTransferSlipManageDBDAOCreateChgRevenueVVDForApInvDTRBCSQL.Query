<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CSRIssueTransferSlipManageDBDAOCreateChgRevenueVVDForApInvDTRBCSQL">
			<desc><![CDATA[CreateChgRevenueVVDForApInvDTRB]]></desc>
			<sql><![CDATA[
INSERT INTO AP_INV_DTRB (																																	
					CSR_NO                                                                                                  					
				,	LINE_SEQ                                                                                                					
				,	LINE_NO                                                                                                 					
				,	LINE_TP_LU_CD                                                                                           					
				,	INV_AMT                                                                                                 					
				,	INV_DESC                                                                                                					
				,	INV_TAX_CD                                                                                              					
				,	DTRB_COA_CO_CD                                                                                          					
				,	DTRB_COA_RGN_CD                                                                                         					
				,	DTRB_COA_CTR_CD                                                                                         					
				,	DTRB_COA_ACCT_CD                                                                                        					
				,	DTRB_COA_VVD_CD                                                                                         					
				,	DTRB_COA_INTER_CO_CD                                                                                    					
				,	DTRB_COA_FTU_N1ST_CD                                                                                    					
				,	DTRB_COA_FTU_N2ND_CD                                                                                    					
				,	ATTR_CATE_NM                                                                                            					
				,	ATTR_CTNT1                                                                                              					
				,	ATTR_CTNT2                                                                                              					
				,	ATTR_CTNT3                                                                                              					
				,	ATTR_CTNT4                                                                                              					
				,	ATTR_CTNT5                                                                                              					
				,	ATTR_CTNT6                                                                                              					
				,	ATTR_CTNT7                                                                                              					
				,	ATTR_CTNT8                                                                                              					
				,	ATTR_CTNT9                                                                                              					
				,	ATTR_CTNT10                                                                                             					
				,	ATTR_CTNT11                                                                                             					
				,	ATTR_CTNT12                                                                                             					
				,	ATTR_CTNT13                                                                                             					
				,	ATTR_CTNT14                                                                                             					
				,	ATTR_CTNT15                                                                                             					
				,	BKG_NO                                                                                                  					
				,	CNTR_TPSZ_CD                                                                                            					
				,	ACT_VVD_CD                                                                                              					
				,	PLN_SCTR_DIV_CD                                                                                         					
				,	SO_CRR_CD                                                                                               					
				,	YD_CD                                                                                                   					
				,	FTU_USE_CTNT1                                                                                           					
				,	FTU_USE_CTNT2                                                                                           					
				,	FTU_USE_CTNT3                                                                                           					
				,	FTU_USE_CTNT4                                                                                           					
				,	FTU_USE_CTNT5                                                                                           					
				,	CRE_DT                                                                                                  					
				,	CRE_USR_ID                                                                                              					
				,	EAI_EVNT_DT                                                                                             					
			)                                                                                                               					
				SELECT                                                                                                                      				
							@[NEW_CSR_NO]            							NEW_CSR_NO                                                                                    				
						,	ROWNUM       							LINE_SEQ                                                                                      				
						,	LINE_NO                                                                                                     				
						,	LINE_TP_LU_CD                                                                                               				
						,	INV_AMT                                                                                                     				
						,	INV_DESC                                                                                                    				
						,	INV_TAX_CD                                                                                                  				
						,	DTRB_COA_CO_CD                                                                                              				
						,	DTRB_COA_RGN_CD                                                                                             				
						,	DTRB_COA_CTR_CD                                                                                             				
						,	DTRB_COA_ACCT_CD                                                                                            				
						,	DTRB_COA_VVD_CD                                                                                             				
						,	DTRB_COA_INTER_CO_CD                                                                                        				
						,	DTRB_COA_FTU_N1ST_CD                                                                                        				
						,	DTRB_COA_FTU_N2ND_CD                                                                                        				
						,	ATTR_CATE_NM                                                                                                				
						,	'SELCOL_'||ATTR_CTNT1||'_'||AP_INV_DTRB_SEQ1.NEXTVAL	ATTR_CTNT1      /* invoice no. 'SELCOL_'||ATTR_CTNT1 */             
						,	ATTR_CTNT2                                                                                                  				
						,	ATTR_CTNT3                                                                                                  				
						,	ATTR_CTNT4                                                                                                  				
						,	ATTR_CTNT5                                                                                                  				
						,	ATTR_CTNT6                                                                                                  				
						,	ATTR_CTNT7                                                                                                  				
						,	ATTR_CTNT8                                                                                                  				
						,	ATTR_CTNT9                                                                                                  				
						,	ATTR_CTNT10                                                                                                 				
						,	ATTR_CTNT11                                                                                                 				
						,	ATTR_CTNT12                                                                                                 				
						,	ATTR_CTNT13                                                                                                 				
						,	ATTR_CTNT14                                                                                                 				
						,	ATTR_CTNT15                                                                                                 				
						,	BKG_NO                                                                                                      				
						,	CNTR_TPSZ_CD                                                                                                				
						,	ACT_VVD_CD                                                                                                  				
						,	PLN_SCTR_DIV_CD                                                                                             				
						,	SO_CRR_CD                                                                                                   				
						,	YD_CD                                                                                                       				
						,	FTU_USE_CTNT1                                                                                               				
						,	FTU_USE_CTNT2                                                                                               				
						,	FTU_USE_CTNT3                                                                                               				
						,	FTU_USE_CTNT4                                                                                               				
						,	FTU_USE_CTNT5                                                                                               				
						,	GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[CRE_OFC_CD]) 	CRE_DT                                                                				
						,	@[CRE_USR_ID]                                    	CRE_USR_ID                                                            				
						,	EAI_EVNT_DT                                                                                                 				
				FROM      (                                                                                                                 				
					    SELECT    * FROM (                                                                                              				
					    SELECT                                                                                                          				
									LINE_SEQ                                                                                        				
								,	LINE_NO                                                                                         				
								,	LINE_TP_LU_CD                                                                                   				
								,	INV_AMT * (-1)      		INV_AMT                                                                     				
								,	INV_DESC                                                                                        				
								,	INV_TAX_CD                                                                                      				
								,	DTRB_COA_CO_CD                                                                                  				
								,	DTRB_COA_RGN_CD                                                                                 				
								,	DTRB_COA_CTR_CD                                                                                 				
								,	DTRB_COA_ACCT_CD                                                                                				
								,	DTRB_COA_VVD_CD                                                                                 				
								,	DTRB_COA_INTER_CO_CD                                                                            				
								,	DTRB_COA_FTU_N1ST_CD                                                                            				
								,	DTRB_COA_FTU_N2ND_CD                                                                            				
								,	ATTR_CATE_NM                                                                                    				
								,	ATTR_CTNT1      							/* invoice no. 'SELCOL_'||ATTR_CTNT1 */              				
								,	ATTR_CTNT2                                                                                      				
								,	ATTR_CTNT3                                                                                      				
								,	ATTR_CTNT4                                                                                      				
								,	ATTR_CTNT5                                                                                      				
								,	ATTR_CTNT6                                                                                      				
								,	ATTR_CTNT7                                                                                      				
								,	ATTR_CTNT8                                                                                      				
								,	ATTR_CTNT9                                                                                      				
								,	ATTR_CTNT10                                                                                     				
								,	ATTR_CTNT11                                                                                     				
								,	ATTR_CTNT12                                                                                     				
								,	ATTR_CTNT13                                                                                     				
								,	ATTR_CTNT14                                                                                     				
								,	ATTR_CTNT15                                                                                     				
								,	BKG_NO                                                                                          				
								,	CNTR_TPSZ_CD                                                                                    				
								,	ACT_VVD_CD                                                                                      				
								,	PLN_SCTR_DIV_CD                                                                                 				
								,	SO_CRR_CD                                                                                       				
								,	YD_CD                                                                                           				
								,	FTU_USE_CTNT1                                                                                   				
								,	FTU_USE_CTNT2                                                                                   				
								,	FTU_USE_CTNT3                                                                                   				
								,	FTU_USE_CTNT4                                                                                   				
								,	FTU_USE_CTNT5                                                                                   				
								,	CRE_DT                                                                                          				
								,	CRE_USR_ID                                                                                      				
								,	EAI_EVNT_DT                                                                                     				
					    FROM      		AP_INV_DTRB     		D                                                                                     				
					    WHERE     		D.CSR_NO        		= @[OLD_CSR_NO]		/* Old Csr No		*/                                                               				
					    AND       		D.BKG_NO        		= @[BKG_NO]		/* Old Bkg No		*/                                                                       				
					    AND       		D.DTRB_COA_VVD_CD 		= @[DTRB_COA_VVD_CD]		/* Old R.VVD		*/                                                      				
					    ORDER BY  		D.LINE_SEQ      		ASC                                                                                   				
							, 	D.LINE_NO       		ASC                                                                                   				
					    )                                                                                                               				
																							
					    UNION ALL                                                                                                       				
																							
					    SELECT    * FROM (                                                                                              				
					    SELECT                                                                                                          				
									D.LINE_SEQ                                                                                      				
								,	D.LINE_NO                                                                                       				
								,	D.LINE_TP_LU_CD                                                                                 				
								,	D.INV_AMT                                                                                       				
								,	D.INV_DESC                                                                                      				
								,	D.INV_TAX_CD                                                                                    				
								,	D.DTRB_COA_CO_CD                                                                                				
								,	D.DTRB_COA_RGN_CD                                                                               				
								,	D.DTRB_COA_CTR_CD                                                                               				
								,	D.DTRB_COA_ACCT_CD                                                                              				
								,	R.NEW_VSL_CD||R.NEW_SKD_VOY_NO||R.NEW_SKD_DIR_CD||R.NEW_REV_DIR_CD  DTRB_COA_VVD_CD        /* changed R.VVD */	
								,	D.DTRB_COA_INTER_CO_CD                                                                          				
								,	D.DTRB_COA_FTU_N1ST_CD                                                                          				
								,	D.DTRB_COA_FTU_N2ND_CD                                                                          				
								,	D.ATTR_CATE_NM                                                                                  				
								,	D.ATTR_CTNT1          								/* invoice no. 'SELCOL_'||ATTR_CTNT1 */        				
								,	D.ATTR_CTNT2                                                                                    				
								,	D.ATTR_CTNT3                                                                                    				
								,	D.ATTR_CTNT4                                                                                    				
								,	D.ATTR_CTNT5                                                                                    				
								,	D.ATTR_CTNT6                                                                                    				
								,	D.ATTR_CTNT7                                                                                    				
								,	D.ATTR_CTNT8                                                                                    				
								,	D.ATTR_CTNT9                                                                                    				
								,	D.ATTR_CTNT10                                                                                   				
								,	D.ATTR_CTNT11                                                                                   				
								,	D.ATTR_CTNT12                                                                                   				
								,	D.ATTR_CTNT13                                                                                   				
								,	D.ATTR_CTNT14                                                                                   				
								,	D.ATTR_CTNT15                                                                                   				
								,	D.BKG_NO                                                                                        				
								,	D.CNTR_TPSZ_CD                                                                                  				
								,	R.NEW_VSL_CD||R.NEW_SKD_VOY_NO||R.NEW_SKD_DIR_CD||R.NEW_REV_DIR_CD  ACT_VVD_CD          /* changed R.VVD */		
								,	D.PLN_SCTR_DIV_CD                                                                               				
								,	D.SO_CRR_CD                                                                                     				
								,	D.YD_CD                                                                                         				
								,	D.FTU_USE_CTNT1                                                                                 				
								,	D.FTU_USE_CTNT2                                                                                 				
								,	D.FTU_USE_CTNT3                                                                                 				
								,	D.FTU_USE_CTNT4                                                                                 				
								,	D.FTU_USE_CTNT5                                                                                 				
								,	D.CRE_DT                                                                                        				
								,	D.CRE_USR_ID                                                                                    				
								,	D.EAI_EVNT_DT                                                                                   				
					    FROM      		AP_INV_DTRB     		D                                                                                     				
							, 	LEA_REV_VVD_CNG 		R                                                                                     				
					    WHERE    		D.CSR_NO        		= R.CSR_NO                                                               				
					    AND       		D.BKG_NO        		= R.BKG_NO                                                                				
					    AND       	   (R.NEW_REV_YRMON    		IS NULL                                                           						
									OR																												
									R.NEW_REV_YRMON   		<> R.OLD_REV_YRMON																		
										    )																														
					    AND       		D.CSR_NO        		= @[OLD_CSR_NO]        /* Old Csr No		*/                                                       				
					    AND       		D.BKG_NO        		= @[BKG_NO]        /* Old Bkg No		*/                                                               				
					    AND       		R.OLD_VSL_CD    		= @[OLD_VSL_CD]        /* Old Vsl No		*/                                                                        				
					    AND       		R.OLD_SKD_VOY_NO		= @[OLD_SKD_VOY_NO]        /* Old Skd Voy No	*/                                                                          				
					    AND       		R.OLD_SKD_DIR_CD		= @[OLD_SKD_DIR_CD]        /* Old Skd Dir Cd	*/                                                                          				
					    AND       		R.OLD_REV_DIR_CD		= @[OLD_REV_DIR_CD]        /* Old Rev Dir Cd	*/                                                                        				
					    ORDER BY  		D.LINE_SEQ    			ASC                                                                                     				
								,  	D.LINE_NO     			ASC                                                                                     				
					    )                                                                                                               				
																							
				    )                                                                                                                       							]]></sql>
			<params>
				<param name="NEW_CSR_NO" type="12" value="" out="N"/>
				<param name="CRE_OFC_CD" type="12" value="" out="N"/>
				<param name="CRE_USR_ID" type="12" value="" out="N"/>
				<param name="OLD_CSR_NO" type="12" value="" out="N"/>
				<param name="BKG_NO" type="12" value="" out="N"/>
				<param name="DTRB_COA_VVD_CD" type="12" value="" out="N"/>
				<param name="OLD_VSL_CD" type="12" value="" out="N"/>
				<param name="OLD_SKD_VOY_NO" type="12" value="" out="N"/>
				<param name="OLD_SKD_DIR_CD" type="12" value="" out="N"/>
				<param name="OLD_REV_DIR_CD" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
