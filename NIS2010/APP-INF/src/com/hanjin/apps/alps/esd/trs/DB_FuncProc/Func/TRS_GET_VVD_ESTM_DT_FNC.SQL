CREATE OR REPLACE FUNCTION TRS_GET_VVD_ESTM_DT_FNC  /******************************************************************************     Name         :   TRS_GET_VVD_ESTM_DT_FNC                                                                           Purpose      :   COP VVD ETA 리턴       Table        :   none                                                                                    System       :   ALPS > Transportation                                                                        History      :   Ver 1.0 박근환 2016.05.25  ******************************************************************************/    -- ===== Arguments ========================================     (      p_cop_no      IN VARCHAR     )          RETURN DATE   -- RETURN TYPE     authid current_user  IS  -- ===== DECLARE ==========================================  V_DT       DATE;      -- ===== BEGIN, EXCEPTION  ======================================    BEGIN    SELECT E_T1      INTO V_DT      FROM (          SELECT              CASE                  WHEN SUB_ACT_CD = 'V' THEN A.BEF_ESTM_DT0                  WHEN SUB_ACT_CD = 'W' THEN A.BEF_ESTM_DT              END E_T1          FROM (              SELECT BEF_ESTM_DT0, BEF_ESTM_DT, SUB_ACT_CD                  FROM (                      SELECT STND_EDI_STS_CD, SUBSTR(ACT_CD, 3, 1) SUB_ACT_CD, D.ESTM_DT ,                          LAG(D.ESTM_DT, 2) --  T/S PORT DEPATURE(WATER)/ POD ARRAIVAL (VESSEL)                                                                                                                                                                                                                                                       OVER (PARTITION BY D.COP_NO                          ORDER BY D.COP_NO, D.COP_DTL_SEQ) BEF_ESTM_DT0,                          LAG(D.ESTM_DT, 1) --  POD TEMINAL ARRIVAL(WATER)/ BERTHING(VESSEL)                                                                                                                                                                                                                                                          OVER (PARTITION BY D.COP_NO                          ORDER BY D.COP_NO, D.COP_DTL_SEQ) BEF_ESTM_DT                      FROM SCE_COP_DTL D                      WHERE D.COP_NO = p_cop_no                                                                                                                                                                                                                                                                                                                   )                  WHERE STND_EDI_STS_CD = 'UVD'                  AND ROWNUM = 1           ) A       )  ;     RETURN V_DT;    EXCEPTION      WHEN NO_DATA_FOUND      THEN          BEGIN              V_DT := NULL;          RETURN V_DT;      END;     END TRS_GET_VVD_ESTM_DT_FNC;