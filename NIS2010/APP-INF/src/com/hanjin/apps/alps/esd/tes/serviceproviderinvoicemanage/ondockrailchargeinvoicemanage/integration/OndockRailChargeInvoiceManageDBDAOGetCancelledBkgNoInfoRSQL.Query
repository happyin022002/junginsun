<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OndockRailChargeInvoiceManageDBDAOGetCancelledBkgNoInfoRSQL">
			<desc><![CDATA[GetCancelledBkgNoInfo]]></desc>
			<sql><![CDATA[
SELECT * FROM (
   SELECT  B.VSL_CD,
     B.SKD_VOY_NO,
     B.SKD_DIR_CD,
     O.BKG_NO,
     B.BL_NO,
     O.EQ_NO,
     O.EQ_TPSZ_CD,
     O.CGO_TP_CD MT,
     O.FM_NOD_CD,
     O.TO_NOD_CD
   FROM   TRS_TRSP_RAIL_BIL_ORD O, BKG_BOOKING B, BKG_DG_CGO D, SCE_CLM U, SCE_CLM V
                 , SCE_COP_HDR H, SCE_COP_DTL D, MDM_ACTIVITY M
   WHERE  1 = 1
   AND    ( O.FM_NOD_CD = @[yd_cd]  OR O.TO_NOD_CD = @[yd_cd] )
   AND    NVL(D.ACT_DT,D.ESTM_DT) >= TO_DATE(REPLACE(SUBSTR(@[wrk_dt],1,10),'-',''),'YYYYMMDD') - 7
   AND    NVL(D.ACT_DT,D.ESTM_DT) <= TO_DATE(REPLACE(SUBSTR(@[wrk_dt],1,10),'-',''),'YYYYMMDD') + 7
   AND    NVL(O.DELT_FLG,'N')  <> 'Y'
   AND    O.EQ_NO              = @[cntr_no]
   AND    O.BKG_NO             = B.BKG_NO(+)
   AND    B.BKG_STS_CD = 'X'   -- Cancelled 상태인지 확인
   AND    O.BKG_NO             = D.BKG_NO(+)
   AND    O.TRSP_SO_OFC_CTY_CD = U.TRSP_SO_OFC_CTY_CD(+)
   AND    O.TRSP_SO_SEQ        = U.TRSP_SO_SEQ(+)
   AND    O.EQ_NO              = U.CNTR_NO(+)
   AND    U.CLM_SGHT_CD(+)     = 'U'
   AND    O.TRSP_SO_OFC_CTY_CD = V.TRSP_SO_OFC_CTY_CD(+)
   AND    O.TRSP_SO_SEQ        = V.TRSP_SO_SEQ(+)
   AND    O.EQ_NO              = V.CNTR_NO(+)
   AND    V.CLM_SGHT_CD(+)     = 'V'
   AND    O.COP_NO = H.COP_NO
   AND    H.COP_NO = D.COP_NO
   AND    D.NOD_CD = @[yd_cd]
   AND    D.ACT_CD = M.ACT_CD
   AND    M.NOD_TP_CD = 'R' --// RAIL RAMP
   AND    M.BND_VSKD_SEQ_CD = @[io_bnd_cd] --// I/O BND를 받으면 사용가능하다
   --//미주지역인 경우에는 RAIL RAMP ACT중 LOAD/UNLOAD를 사용하고, 미주지역이 아닌 경우에는 Arrival/Departure를 사용한다.
   AND    (M.ACT_OP_TP_CD = DECODE(SUBSTR(@[yd_cd], 1, 2),'US','L','CA','L','A') OR M.ACT_OP_TP_CD = DECODE(SUBSTR(@[yd_cd], 1, 2),'US','U','CA','U','D'))         
   AND    O.CGO_TP_CD = @[cntr_sty_cd] 
   UNION ALL
SELECT  B.VSL_CD,
     B.SKD_VOY_NO,
     B.SKD_DIR_CD,
     O.BKG_NO,
     B.BL_NO,
     O.EQ_NO,
     O.EQ_TPSZ_CD,
     O.CGO_TP_CD MT,
     O.FM_NOD_CD,
     O.TO_NOD_CD
   FROM   TRS_TRSP_SVC_ORD O, BKG_BOOKING B, BKG_DG_CGO D, SCE_CLM U, SCE_CLM V
                 , SCE_COP_HDR H, SCE_COP_DTL D, MDM_ACTIVITY M, TRS_TRSP_WRK_ORD WO
   WHERE  1 = 1
   AND    ( O.FM_NOD_CD = @[yd_cd]  OR O.TO_NOD_CD = @[yd_cd] )
   AND    NVL(D.ACT_DT,D.ESTM_DT) >= TO_DATE(REPLACE(SUBSTR(@[wrk_dt],1,10),'-',''),'YYYYMMDD') - 7
   AND    NVL(D.ACT_DT,D.ESTM_DT) <= TO_DATE(REPLACE(SUBSTR(@[wrk_dt],1,10),'-',''),'YYYYMMDD') + 7
   AND    NVL(O.DELT_FLG,'N')  <> 'Y'
   AND    O.EQ_NO              = @[cntr_no]
   AND    O.BKG_NO             = B.BKG_NO(+)
   AND    B.BKG_STS_CD = 'X'   -- Cancelled 상태인지 확인
   AND    O.BKG_NO             = D.BKG_NO(+)
   AND    O.TRSP_SO_OFC_CTY_CD = U.TRSP_SO_OFC_CTY_CD(+)
   AND    O.TRSP_SO_SEQ        = U.TRSP_SO_SEQ(+)
   AND    O.EQ_NO              = U.CNTR_NO(+)
   AND    U.CLM_SGHT_CD(+)     = 'U'
   AND    O.TRSP_SO_TP_CD      = 'Y'
   AND    O.TRSP_CRR_MOD_CD    IN ('RD','TR','RT')
   AND    O.TRSP_COST_DTL_MOD_CD IN ('CY','DR')
   AND    O.TRSP_SO_OFC_CTY_CD = V.TRSP_SO_OFC_CTY_CD(+)
   AND    O.TRSP_SO_SEQ        = V.TRSP_SO_SEQ(+)
   AND    O.EQ_NO              = V.CNTR_NO(+)
   AND    V.CLM_SGHT_CD(+)     = 'V'
   AND    O.COP_NO = H.COP_NO
   AND    H.COP_NO = D.COP_NO
   AND    D.NOD_CD = @[yd_cd]
   AND    D.ACT_CD = M.ACT_CD
   AND    WO.TRSP_WO_OFC_CTY_CD = O.TRSP_WO_OFC_CTY_CD(+)
   AND    WO.TRSP_WO_SEQ = O.TRSP_WO_SEQ(+)
   AND    M.NOD_TP_CD = 'R' --// RAIL RAMP
   AND    M.BND_VSKD_SEQ_CD = @[io_bnd_cd] --// I/O BND를 받으면 사용가능하다
   --//미주지역인 경우에는 RAIL RAMP ACT중 LOAD/UNLOAD를 사용하고, 미주지역이 아닌 경우에는 Arrival/Departure를 사용한다.
   AND    (M.ACT_OP_TP_CD = DECODE(SUBSTR(@[yd_cd], 1, 2),'US','L','CA','L','A') OR M.ACT_OP_TP_CD = DECODE(SUBSTR(@[yd_cd], 1, 2),'US','U','CA','U','D'))
   AND    O.CGO_TP_CD = @[cntr_sty_cd]
)			]]></sql>
			<params>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="wrk_dt" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="cntr_sty_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
