<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CargoTrackingDBDAOSearchUSCargoTrackingListRSQL">
			<desc><![CDATA[CargoTracking List Selection]]></desc>
			<sql><![CDATA[
SELECT    t1.*   
  FROM     (SELECT  tcntr.cop_no             
 		    ,tcntr.trsp_so_ofc_cty_cd      
 		    ,tcntr.trsp_so_seq             
 		    ,tcntr.eq_no                   
 		    ,tcntr.ts                      
 		    ,tcntr.bkg_no                  
 		    ,tcntr.vvd                     
 		    ,tcntr.por_cd                  
 		    ,tcntr.pol_cd                  
 		    ,tcntr.pod_cd                  
 		    ,tcntr.del_cd                  
 		    ,tcntr.rd_term_cd              
 		    ,tcntr.local_ipi               
 		    ,tcntr.c_act                   
 		    ,tcntr.c_act_date              
 		    ,tcntr.c_act_time              
 		    ,tcntr.nod                     
 		    ,tcntr.vd_date                 
 		    ,tcntr.vd_time                 
 		    ,tcntr.f                       
 		    ,tcntr.o                       
 		    ,tcntr.c                       
 		    ,tcntr.hold                    
 		    ,tcntr.hold_r_date             
 		    ,tcntr.hold_r_time             
 		    ,tcntr.l_free_date             
 		    ,tcntr.l_free_time             
 		    ,tcntr.hot                     
 		    ,tcntr.rail_com                
 		    ,tcntr.fm_nod_cd               
 		    ,tcntr.rail_etd_date           
 		    ,tcntr.rail_etd_time           
 		    ,tcntr.org_out_date            
 		    ,tcntr.org_out_time            
 		    ,tcntr.to_nod_cd               
 		    ,tcntr.rail_eta_date           
 		    ,tcntr.rail_eta_time           
 		    ,tcntr.dest_in_date            
 		    ,tcntr.dest_in_time            
 		    ,tcntr.l_rail_loc              
 		    ,tcntr.l_rail_ata_date         
 		    ,tcntr.l_rail_ata_time         
 		    ,tcntr.pick_up_avail           
 		    ,tcntr.gate_out_etd_date       
 		    ,tcntr.gate_out_etd_time       
 		    ,tcntr.door_eta_date           
 		    ,tcntr.door_eta_time           
 		    ,tcntr.door_ata_date           
 		    ,tcntr.door_ata_time           
 		    ,TO_CHAR(sem.occr_dt, 'YYYY-MM-DD') expt_date                            
 		    ,TO_CHAR(sem.occr_dt, 'HH24:MI') expt_time                               
 		    ,sem.occr_nod_cd  occr_nod_cd                                           
 		    ,(select max(cop_expt_rsn_nm ) from SCE_EXPT_RSN_MST where cop_expt_rsn_cd=sem.cop_expt_rsn_cd) sts_desc      
 		    ,'' etd_rail_date                                                      
 		    ,'' etd_rail_time                                                      
 		    ,tcntr.cust_cnt_cd                                                     
 		    ,tcntr.cust_seq	                                                   
 		    ,tcntr.sc_no                                                           
 	FROM ( 
 	    SELECT                                                                 
 		 max(sch.cop_no) cop_no                                            
 		,max(srtr.trsp_so_ofc_cty_cd) trsp_so_ofc_cty_cd                   
 		,max(srtr.trsp_so_seq) trsp_so_seq                                 
 		,srtr.eq_no                                                        
 		,max(srtr.eq_tpsz_cd) ts                                           
 		,max(srtr.bkg_no) bkg_no                                           
 		,max(srtr.VVD_CD) vvd                                              
 		,max(bb.por_cd) por_cd                                             
 		,max(bb.pol_cd) pol_cd                                             
 		,max(bb.pod_cd) pod_cd                                             
 		,max(bb.del_cd) del_cd                                             
 		,max(bb.rcv_term_cd||'/'||bb.de_term_cd) rd_term_cd                
 		,DECODE(max(srtr.ib_ipi_locl_ind_cd), 'L', 'Local','I', 'IPI') local_ipi  
 		,nvl(max(ma.act_nm),'Not Start') c_act                            
 		,TO_CHAR(max(scd2.act_dt), 'YYYY-MM-DD') c_act_date               
 		,TO_CHAR(max(scd2.act_dt), 'HH24:MI') c_act_time                  
 		,max(ml.loc_nm) nod                                               
 		,TO_CHAR(max(scd3.estm_dt), 'YYYY-MM-DD') vd_date                 
 		,TO_CHAR(max(scd3.estm_dt), 'HH24:MI') vd_time                    
 		,max(euicr.FRT_CLT_FLG) f                               
 		,max(euicr.OBL_RDEM_FLG) o                            
 		,max(euicr.CSTMS_CLR_CD) c                                     
 		,'' hold                                                          
 		,'' hold_r_date                                                   
 		,'' hold_r_time                                                   
 		,TO_CHAR(max(srtr.lst_free_dt), 'YYYY-MM-DD') l_free_date         
 		,TO_CHAR(max(srtr.lst_free_dt), 'HH24:MI') l_free_time            
 		,max(srtr.bkg_hot_de_flg) hot                                     
 		,max(srtr.usa_edi_cd) rail_com                                    
 		,max(srtr.fm_nod_cd) fm_nod_cd                                    
 		,(CASE WHEN  max(scd.act_cd)  IN ('FIRRDO', 'FORRDO') THEN  TO_CHAR(max(scd.estm_dt), 'YYYY-MM-DD') END) rail_etd_date  
 		,(CASE WHEN  max(scd.act_cd)  IN ('FIRRDO', 'FORRDO') THEN  TO_CHAR(max(scd.estm_dt), 'HH24:MI')  END) rail_etd_time   
 		,TO_CHAR(max(srtr.org_gate_out_dt), 'YYYY-MM-DD') org_out_date     
 		,TO_CHAR(max(srtr.org_gate_out_dt), 'HH24:MI') org_out_time        
 		,max(srtr.to_nod_cd) to_nod_cd                                     
 		,TO_CHAR(max(scd.estm_dt), 'YYYY-MM-DD') rail_eta_date             
 		,TO_CHAR(max(scd.estm_dt), 'HH24:MI') rail_eta_time                
 		,TO_CHAR(max(srtr.dest_gate_in_dt), 'YYYY-MM-DD') dest_in_date     
 		,TO_CHAR(max(srtr.dest_gate_in_dt), 'HH24:MI') dest_in_time        
 		,max(srs.loc_cd) l_rail_loc                                        
 		,TO_CHAR(max(srtr.arr_dt), 'YYYY-MM-DD') l_rail_ata_date           
 		,TO_CHAR(max(srtr.arr_dt), 'HH24:MI') l_rail_ata_time              
 		,DECODE(max(srtr.dest_aval_dt), '', 'N', 'Y') pick_up_avail        
 		,DECODE(max(scd.act_cd), 'FITYDO', TO_CHAR(max(scd.estm_dt), 'YYYY-MM-DD')) gate_out_etd_date      
 		,DECODE(max(scd.act_cd), 'FITYDO', TO_CHAR(max(scd.estm_dt), 'HH24:MI')) gate_out_etd_time         
 		,DECODE(max(scd.act_cd), 'FITZAD', TO_CHAR(max(scd.estm_dt), 'YYYY-MM-DD HH24:MI')) door_eta_date   
 		,DECODE(max(scd.act_cd), 'FITZAD', TO_CHAR(max(scd.estm_dt), 'YYYY-MM-DD HH24:MI')) door_eta_time   
 		,DECODE(max(scd.act_cd), 'FITZAD', TO_CHAR(max(scd.act_dt), 'YYYY-MM-DD HH24:MI')) door_ata_date   
 		,DECODE(max(scd.act_cd), 'FITZAD', TO_CHAR(max(scd.act_dt), 'YYYY-MM-DD HH24:MI')) door_ata_time   
 		 ,NVL(max(sem.cop_expt_no),'NOEXPT') cop_expt_no  
 		,max(bbc.cust_cnt_cd) cust_cnt_cd                                  
 		,max(bbc.cust_seq) cust_seq	                                    
 		,max(srtr.sc_no) sc_no                                             
 	    from sce_rail_tz_rpt srtr 
 		,bkg_customer   bbc 
 		,bkg_booking    bb 
 		,sce_cop_hdr    sch 
 		,sce_cop_dtl    scd 
 		,sce_cop_dtl    scd2 
 		,sce_cop_dtl    scd3 
 		,BKG_CGO_RLSE  euicr 
 		,sce_rail_splc  srs 
 		,mdm_location   ml 
 		,mdm_activity   ma 
 		,sce_expt_mst sem  
 	    WHERE sch.bkg_no                 = bbc.bkg_no 
 	    AND   sch.cop_sts_cd             IN ('C','T') 
 	    AND   sch.cntr_no                <> 'SMCU0000000' 
 	    AND   (ml.loc_cd                  = SUBSTR(bb.del_cd,1,5) AND   ml.conti_cd  = 'M' ) 
 	    AND   scd.cop_no                 = sch.cop_no 
 	    AND   scd.act_sts_cd             = 'C' 
 	    AND   scd2.cop_no(+)             = scd.cop_no 
 	    AND   scd2.act_sts_cd(+)         = 'F' 
 	    AND   scd3.cop_no(+)             = scd.cop_no 
 	    AND   scd3.act_cd(+)             = 'FUVMUD' 
 	    AND   scd2.act_cd                = ma.act_cd(+) 
 	    AND   SUBSTR(scd2.nod_cd,1,5)    = ml.loc_cd(+) 
 	    AND   bbc.bkg_no                 = bb.bkg_no 
 	    AND   bbc.cust_cnt_cd            is not null 
 	    AND   bbc.cust_seq               is not null 
 	    AND   bbc.bkg_no                 = srtr.bkg_no(+) 
 	    AND   srtr.arr_splc_cd           = srs.splc_cd(+) 
 	    AND   bb.bl_no                   = euicr.bl_no(+) 
 	    AND   sch.cop_no                 = sem.cop_no(+)  
 	    AND   sem.cop_expt_sts_cd(+)     <> 'X'        
 	    AND   srtr.eq_no  IS NOT NULL      
   
#if (${cust_value1} != '' && ${cust_value2} != '')
 AND   bbc.cust_cnt_cd                   = @[cust_value1]

 AND   bbc.cust_seq                      = @[cust_value2] 

 AND   bbc.bkg_cust_tp_cd                IN ('S', 'C', 'N') 
#end


#if (${cust_value1} != '' && ${cust_value2} == '')

 AND   bbc.cust_cnt_cd                   = @[cust_value1] 

 AND   bbc.cust_seq                      = '' 

 AND   bbc.bkg_cust_tp_cd                IN ('S', 'C', 'N') 

#end


#if (${sc_no} != '')
 AND   srtr.sc_no                        = @[sc_no]
#end 


   #if (${date_kind} != '' && ${date_kind} == 'S' && ${fm_dt} != '' && ${to_dt} != '')
       AND     srtr.SO_CRE_DT    BETWEEN  TO_DATE(@[fm_dt], 'YYYY-MM-DD HH24:MI:SS')  AND  TO_DATE(@[to_dt], 'YYYY-MM-DD HH24:MI:SS')
   #end

   #if(${date_kind} != '' && ${date_kind} == 'A' && ${fm_dt} != '' && ${to_dt} != '')
       AND     srtr.DEST_AVAL_DT BETWEEN  TO_DATE(@[fm_dt], 'YYYY-MM-DD HH24:MI:SS')  AND  TO_DATE(@[to_dt], 'YYYY-MM-DD HH24:MI:SS') 
   #end

   #if(${date_kind} != '' && ${date_kind} == 'O'&& ${fm_dt} != '' && ${to_dt} != '')
       AND         (CASE WHEN srtr.TO_NOD_CD IN ('CAVANM2', 'USLGBPT', 'USORFM2', 'USPDXM1', 'USSAVM1', 'USTIWM1') 
                         THEN srtr.DEST_AVAL_DT 
                         ELSE srtr.DEST_GATE_OUT_DT 
                    END)        BETWEEN  TO_DATE(@[fm_dt], 'YYYY-MM-DD HH24:MI:SS')  AND  TO_DATE(@[to_dt], 'YYYY-MM-DD HH24:MI:SS') 
   #end


#if (${por_cd} != '')     
 AND    bb.por_cd                         = @[por_cd]
#end  

#if (${pol_cd} != '')  
 AND    bb.pol_cd                         = @[pol_cd]  
#end

#if (${pod_cd} != '')
 AND    bb.pod_cd                         = @[pod_cd]
#end
  
#if (${del_cd} != '')
 AND    bb.del_cd                         = @[del_cd] 
#end 

 	    GROUP BY srtr.eq_no 
 	 ) tcntr,  
 	 sce_expt_mst sem 
 	 where tcntr.cop_expt_no = sem.cop_expt_no(+)          
 	order by tcntr.bkg_no, tcntr.vvd ) t1 
   WHERE   
        1=1
#if (${i_page} != '')
       AND CEIL(rownum/3000) = @[i_page]
#else
       AND CEIL(rownum/3000) = 1
#end			]]></sql>
			<params>
				<param name="cust_value1" type="12" value="" out="N"/>
				<param name="cust_value2" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
				<param name="fm_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="por_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
				<param name="i_page" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
