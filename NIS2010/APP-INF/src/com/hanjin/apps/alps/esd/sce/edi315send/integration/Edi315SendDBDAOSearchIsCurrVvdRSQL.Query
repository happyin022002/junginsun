<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="Edi315SendDBDAOSearchIsCurrVvdRSQL">
			<desc><![CDATA[Edi315SendDBDAOSearchIsCurrVvdRSQL]]></desc>
			<sql><![CDATA[
SELECT 
         --   d.nod_cd                                                  curr_nod 
         -- ,d.cop_dtl_seq                                             curr_cop_dtl_seq
         -- ,to_char(d.estm_dt,'YYYYMMDDHH24MISS') 			   	     curr_estm_dt
         -- ,to_char(d.act_dt,'YYYYMMDDHH24MISS') 				     curr_act_dt
           bound                                                     curr_bound
          ,d.vsl_cd||d.skd_voy_no||d.skd_dir_cd                      curr_vvd 
          ,replace(mv.vsl_eng_nm, chr(39), ' ')                      vsl_nm  
          ,mv.vsl_rgst_cnt_cd                                        vsl_cnt_cd  
          ,nvl(decode(mv.LLOYD_NO, 'T.B.N.', 'TBN', 'T.B.N', 'TBN', LLOYD_NO), ' ')  lloyd_cd 


          ,ml.LOC_NM                                                 rly_name
          ,ml.LOC_CD                                                 rly_port
          ,DECODE(ml.CNT_CD, 'US', 'D', 'K')                         rly_amsqual
          ,ml.LOC_AMS_PORT_CD                                        rly_amsport




    FROM SCE_COP_DTL D, MDM_VSL_CNTR MV, MDM_LOCATION ML,
        (  
            SELECT case when  EDI_STS_SEQ <= 200 or  @[e_edi_sts] in ('BF', 'AW', 'AMO') then 'OB'  
                        when (EDI_STS_SEQ >  200 and EDI_STS_SEQ < 300 and @[e_edi_sts] <> 'VE') or @[e_edi_sts] in ('UVD') then 'OC'  
                        when (EDI_STS_SEQ >= 300 and @[e_edi_sts] not in ('BF', 'AW', 'AMO', 'UVD')) or @[e_edi_sts] = 'VE' then 'IB'  
                   END BOUND        
          
            from EDI_CGO_STND_STS  
            where EDI_STND_STS_CD = @[e_edi_sts]
        )  
    where cop_no  = @[e_cop_no]
    and (  
            ('OB' = BOUND and act_cd like 'FL%')  
            or  
            ('OC' = BOUND and nod_cd like @[e_event_yard]  and STND_EDI_STS_CD like decode(@[e_edi_sts], 'VE', 'VA%', @[e_edi_sts]||'%'))  
            or  
            ('IB' = BOUND and act_cd like 'FU%')  
        )   
    and mv.VSL_CD = d.VSL_CD
    and ml.LOC_CD = SUBSTR(nod_cd,1,5)
    and rownum = 1			]]></sql>
			<params>
				<param name="e_edi_sts" type="12" value="AG" out="N"/>
				<param name="e_cop_no" type="12" value="CCEB9320901585" out="N"/>
				<param name="e_event_yard" type="12" value="USATLR1" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
