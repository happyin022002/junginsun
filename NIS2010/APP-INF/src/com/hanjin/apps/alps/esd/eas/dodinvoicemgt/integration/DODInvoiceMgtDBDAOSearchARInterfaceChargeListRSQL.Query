<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DODInvoiceMgtDBDAOSearchARInterfaceChargeListRSQL">
			<desc><![CDATA[SearchARInterfaceChargeList]]></desc>
			<sql><![CDATA[
SELECT ROWNUM CHG_SEQ
      , CHG_CD
      , CHG_FULL_NM
      , CURR_CD
      , PER_TP_CD                     
      , TRF_RT_AMT        
      , RAT_AS_CNTR_QTY                  
	  , CHG_AMT        
      , 0 AS INV_XCH_RT
      , TVA_FLG
      , REP_CHG_CD                  
      , CHG_RMK          
      , CRE_USR_ID
      , CRE_DT
      , @[cre_usr_id] AS  UPD_USR_ID
      , NVL(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(@[ofc_cd]),SYSDATE) AS UPD_DT
FROM(
SELECT  'DOD' AS CHG_CD
       ,(SELECT CHG_NM FROM MDM_CHARGE WHERE CHG_CD='DOD') AS CHG_FULL_NM
       , A.BIL_CURR_CD AS CURR_CD
       , A.CNTR_TPSZ_CD AS PER_TP_CD                     
       , (A.BIL_AMT + nvl(A.ADD_AMT,0)) AS TRF_RT_AMT        
       , COUNT(A.CNTR_NO) AS RAT_AS_CNTR_QTY                  
	   , (SELECT SUM(B.BIL_AMT + nvl(B.ADD_AMT,0)) 
          FROM EAS_DOD_INV_DTL B 
          WHERE B.DOD_INV_NO = A.DOD_INV_NO
          AND B.CNTR_TPSZ_CD = A.CNTR_TPSZ_CD
          AND B.BIL_AMT = A.BIL_AMT
          AND nvl(B.ADD_AMT,0) = nvl(A.ADD_AMT,0)
      ) AS CHG_AMT        
       , CASE WHEN SUM(A.TAX_AMT) <> 0 THEN 'Y' ELSE 'N' END AS TVA_FLG
       , (SELECT REP_CHG_CD FROM MDM_CHARGE WHERE CHG_CD='DOD') AS REP_CHG_CD                  
       , 'DOD INVOICE CONTAINER ' AS CHG_RMK          
       , A.CRE_USR_ID
       , A.CRE_DT
FROM   EAS_DOD_INV_DTL A
WHERE DOD_INV_NO = @[dod_inv_no]
GROUP BY A.DOD_INV_NO,A.CNTR_TPSZ_CD,A.BIL_CURR_CD, A.BIL_AMT, A.ADD_AMT, A.CRE_USR_ID, A.CRE_DT
UNION ALL
SELECT  'TVA' AS CHG_CD
      , 'V.A.T RECEIVED' AS CHG_FULL_NM
      , A.BIL_CURR_CD AS CURR_CD
      , A.CNTR_TPSZ_CD AS PER_TP_CD 
      , A.TAX_AMT AS TRF_RT_AMT
      , COUNT(A.CNTR_NO) AS RAT_AS_CNTR_QTY
       ,(SELECT SUM(B.TAX_AMT) 
          FROM EAS_DOD_INV_DTL B 
          WHERE B.DOD_INV_NO = A.DOD_INV_NO
          AND B.CNTR_TPSZ_CD = A.CNTR_TPSZ_CD
          AND B.TAX_AMT = A.TAX_AMT   )  AS CHG_AMT
       , 'N'  AS TVA_FLG
       , 'XXX' AS REP_CHG_CD
       , 'DOD INVOICE CONTAINER' AS CHG_RMK
       , A.CRE_USR_ID
       , A.CRE_DT
FROM   EAS_DOD_INV_DTL A
WHERE DOD_INV_NO = @[dod_inv_no]
 GROUP BY A.DOD_INV_NO, A.CNTR_TPSZ_CD,A.BIL_CURR_CD, A.TAX_AMT, A.CRE_USR_ID, A.CRE_DT
)			]]></sql>
			<params>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="dod_inv_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
