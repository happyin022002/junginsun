<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CSRIssueTransferSlipManageDBDAOCreateApInvKRDtrbCSQL">
			<desc><![CDATA[AP Detail 테이블에 자료 입력(KR)]]></desc>
			<sql><![CDATA[
INSERT INTO		AP_INV_DTRB (																						
				CSR_NO		                                                                        
				,	TRSP_SO_TP_CD                                                                      	
				,	SO_OFC_CTY_CD                                                                      	
				,	SO_SEQ                                                                      		
				,	LINE_SEQ				                                                        	
				,	LINE_NO					                                                        	
				,	LINE_TP_LU_CD                                                                   	
				,	INV_AMT																				
				,	INV_DESC																			
				,	INV_TAX_CD																			
				,	DTRB_COA_CO_CD																		
				,	DTRB_COA_RGN_CD																		
				,	DTRB_COA_CTR_CD																		
				,	DTRB_COA_ACCT_CD																	
				,	DTRB_COA_VVD_CD																		
				,	DTRB_COA_INTER_CO_CD																
				,	DTRB_COA_FTU_N1ST_CD																
				,	DTRB_COA_FTU_N2ND_CD																
				,	ATTR_CATE_NM																		
				,	ATTR_CTNT1																			
				,	ATTR_CTNT2																			
				,	ATTR_CTNT3																			
				,	ATTR_CTNT4																			
				,	ATTR_CTNT5																			
				,	ATTR_CTNT6																			
				,	ATTR_CTNT7																			
				,	ATTR_CTNT8																			
				,	ATTR_CTNT9																			
				,	ATTR_CTNT10																			
				,	ATTR_CTNT11																			
				,	ATTR_CTNT12																			
				,	ATTR_CTNT13																			
				,	ATTR_CTNT14																			
				,	ATTR_CTNT15																			
				,	BKG_NO																				
				,	CNTR_TPSZ_CD																		
				,	ACT_VVD_CD																			
				,	PLN_SCTR_DIV_CD																		
				,	SO_CRR_CD																			
				,	YD_CD																				
				,	FTU_USE_CTNT1																		
				,	FTU_USE_CTNT2																		
				,	FTU_USE_CTNT3																		
				,	FTU_USE_CTNT4																		
				,	FTU_USE_CTNT5                                                                       
				,	CRE_DT																				
				,	CRE_USR_ID																			
				,	EAI_EVNT_DT			                                                            	
	)                                                                                                
	SELECT			CSR_NO																				
				,	TRSP_SO_TP_CD			TRSP_SO_TP_CD												
				,	TRSP_SO_OFC_CTY_CD		SO_OFC_CTY_CD												
				,	TRSP_SO_SEQ				SO_SEQ														
				,	(SELECT MAX(LINE_SEQ)+1 FROM AP_INV_DTRB WHERE CSR_NO = @[CSR_NO] ) LINE_SEQ				
				,	(SELECT MAX(LINE_NO)+1  FROM AP_INV_DTRB WHERE CSR_NO = @[CSR_NO] ) LINE_NO					
				,	LINE_TP_LU_CD																		
				,	CSR_AMT					INV_AMT														
				,	INV_DESC																			
				,	INV_TAX_CD																			
				,	DTRB_COA_CO_CD																		
				,	DTRB_COA_RGN_CD																		
				,	DTRB_COA_CTR_CD																		
				,	DTRB_COA_ACCT_CD																	
				,	DTRB_COA_VVD_CD																		
				,	DTRB_COA_INTER_CO_CD																
				,	DTRB_COA_FTU_N1ST_CD																
				,	DTRB_COA_FTU_N2ND_CD																
				,	ATTR_CATE_NM																		
				,	ATTR_CTNT1																			
				,	ATTR_CTNT2																			
				,	ATTR_CTNT3																			
				,	ATTR_CTNT4																			
				,	ATTR_CTNT5																			
				,	ATTR_CTNT6																			
				,	ATTR_CTNT7																			
				,	ATTR_CTNT8																			
				,	ATTR_CTNT9																			
				,	ATTR_CTNT10																			
				,	ATTR_CTNT11																			
				,	ATTR_CTNT12																			
				,	ATTR_CTNT13																			
				,	ATTR_CTNT14																			
				,	ATTR_CTNT15																			
				,	BKG_NO																				
				,	CNTR_TPSZ_CD																		
				,	ACT_VVD_CD																			
				,	PLN_SCTR_DIV_CD																		
				,	SO_CRR_CD																			
				,	YD_CD																				
				,	FTU_USE_CTNT1																		
				,	FTU_USE_CTNT2																		
				,	FTU_USE_CTNT3																		
				,	FTU_USE_CTNT4																		
				,	FTU_USE_CTNT5																		
				,	CRE_DT																				
				,	CRE_USR_ID																			
				,	EAI_EVNT_DT																			
	FROM			(																					
					SELECT		CSR_NO																	
							,	TRSP_SO_TP_CD															
							,	TRSP_SO_OFC_CTY_CD														
							,	TRSP_SO_SEQ																
							,	LINE_SEQ																
							,	LINE_NO																	
							,	LINE_TP_LU_CD															
							,	CSR_AMT																	
							,	INV_DESC																
							,	INV_TAX_CD																
							,	DTRB_COA_CO_CD															
							,	DTRB_COA_RGN_CD															
							,	DTRB_COA_CTR_CD															
							,	DTRB_COA_ACCT_CD														
							,	DTRB_COA_VVD_CD															
							,	DTRB_COA_INTER_CO_CD													
							,	DTRB_COA_FTU_N1ST_CD													
							,	DTRB_COA_FTU_N2ND_CD													
							,	ATTR_CATE_NM															
							,	ATTR_CTNT1																
							,	ATTR_CTNT2																
							,	ATTR_CTNT3																
							,	ATTR_CTNT4																
							,	ATTR_CTNT5																
							,	ATTR_CTNT6																
							,	ATTR_CTNT7																
							,	ATTR_CTNT8																
							,	ATTR_CTNT9																
							,	ATTR_CTNT10																
							,	ATTR_CTNT11																
							,	ATTR_CTNT12																
							,	ATTR_CTNT13																
							,	ATTR_CTNT14																
							,	ATTR_CTNT15																
							,	BKG_NO																	
							,	CNTR_TPSZ_CD															
							,	ACT_VVD_CD																
							,	PLN_SCTR_DIV_CD															
							,	SO_CRR_CD																
							,	YD_CD																	
							,	FTU_USE_CTNT1															
							,	FTU_USE_CTNT2															
							,	FTU_USE_CTNT3															
							,	FTU_USE_CTNT4															
							,	FTU_USE_CTNT5															
							,	CRE_DT																	
							,	CRE_USR_ID																
							,	EAI_EVNT_DT																
					FROM		(																		
								SELECT 		@[CSR_NO]           				CSR_NO											
										,	TRSP_SO_TP_CD																
										,	TRSP_SO_OFC_CTY_CD															
										,	TRSP_SO_SEQ																	
										,	''          				LINE_SEQ										
										,	''            				LINE_NO											
										,	'TAX'						LINE_TP_LU_CD									
										,	NVL(SUM(CSR_AMT),0)			CSR_AMT											
										,	(SELECT ACCT_ENG_NM	FROM MDM_ACCOUNT WHERE ACCT_CD = '111811' )   INV_DESC			
										,	@[INV_TAX_CD]			INV_TAX_CD										
										,	'01'						DTRB_COA_CO_CD									
										,	MAX(DTRB_COA_RGN_CD)		DTRB_COA_RGN_CD									
										,	MAX(DTRB_COA_CTR_CD)		DTRB_COA_CTR_CD									
										,	'111811'							DTRB_COA_ACCT_CD								
										,	'0000000000'				DTRB_COA_VVD_CD									
										,	MAX(DTRB_COA_INTER_CO_CD)	DTRB_COA_INTER_CO_CD							
										,	'000000'                    DTRB_COA_FTU_N1ST_CD							
										,	'000000'                    DTRB_COA_FTU_N2ND_CD							
										,	'111811'							ATTR_CATE_NM									
										,	MAX(ATTR_CTNT1)				ATTR_CTNT1																				
										,	MAX(ATTR_CTNT2)				ATTR_CTNT2																				
										,	MAX(ATTR_CTNT3)				ATTR_CTNT3																				
										,	NULL                        ATTR_CTNT4																				
										,	NULL                        ATTR_CTNT5																				
										,	NULL                        ATTR_CTNT6																				
										,	NULL                        ATTR_CTNT7																				
										,	NULL			            ATTR_CTNT8																				
										,	NULL                        ATTR_CTNT9																				
										,	NULL                        ATTR_CTNT10																				
										,	NULL                        ATTR_CTNT11																				
										,	NULL                        ATTR_CTNT12																				
										,	NULL                        ATTR_CTNT13																				
										,	NULL                        ATTR_CTNT14																				
										,	NULL                        ATTR_CTNT15																				
										,	NULL                        BKG_NO																					
										,	NULL                        CNTR_TPSZ_CD																			
										,	NULL                        ACT_VVD_CD																				
										,	NULL                        PLN_SCTR_DIV_CD																			
										,	NULL                        SO_CRR_CD																				
										,	NULL                        YD_CD																					
										,	NULL                        FTU_USE_CTNT1																			
										,	NULL                        FTU_USE_CTNT2																			
										,	NULL                        FTU_USE_CTNT3																			
										,	NULL                        FTU_USE_CTNT4																			
										,	NULL                        FTU_USE_CTNT5																			
										,	SYSDATE                     CRE_DT																					
										,	@[CRE_USR_ID]                   		CRE_USR_ID																				
										,	''                          EAI_EVNT_DT																				
								FROM		(																													
											SELECT		INV_WRK.INV_VAT_AMT						CSR_AMT															
													,	NULL	TRSP_SO_TP_CD																					
													,	NULL	TRSP_SO_OFC_CTY_CD																				
													,	NULL	TRSP_SO_SEQ																						
													,	FINC_RGN_CD								DTRB_COA_RGN_CD													
													,	AP_CTR_CD								DTRB_COA_CTR_CD													
													,	NVL(SUBS_CO_CD,'00')					DTRB_COA_INTER_CO_CD											
													,	SVC_ORD.INV_NO							ATTR_CTNT1														
													,	TO_CHAR(INV_WRK.INV_ISS_DT,'YYYYMMDD')  ATTR_CTNT2														
													,	MDM_ORG.LOC_CD							ATTR_CTNT3														
											FROM		TRS_TRSP_INV_WRK						INV_WRK																			
													,	MDM_ACCOUNT								ACCT_NM																			
													,	TRS_TRSP_SVC_ORD						SVC_ORD																			
													,	MDM_ORGANIZATION						MDM_ORG																			
													,	MDM_VENDOR								MDM_VNDR																		
											WHERE		ACCT_NM.ACCT_CD							= SVC_ORD.ACCT_CD																
											AND			INV_WRK.INV_NO							= SVC_ORD.INV_NO																
											AND			INV_WRK.INV_VNDR_SEQ					= SVC_ORD.INV_VNDR_SEQ															
											AND			MDM_ORG.OFC_CD							= INV_WRK.CRE_OFC_CD															
											AND			MDM_VNDR.VNDR_SEQ						= SVC_ORD.INV_VNDR_SEQ															
#if ($INV_NO.size() > 0) 
	AND	INV_WRK.INV_NO IN  (
		#foreach( ${key} in ${INV_NO}) 
			#if($velocityCount < $INV_NO.size()) 
				'$key', 
			#else 
				'$key' 
			#end 
		#end
	)
#end
											AND			INV_WRK.INV_VNDR_SEQ					= @[INV_VNDR_SEQ]                                   											
											AND			TRSP_INV_AUD_STS_CD						= @[TRSP_INV_AUD_STS_CD]
											AND			NVL(SVC_ORD.DELT_FLG,'N')   			= 'N'                              																	
											AND			NVL(INV_HLD_FLG,'N')    				= 'N'     																		
											AND			INV_WRK.DELT_FLG        				= 'N'       																	
											AND			'KR'									=  @[CNT_CD]
											GROUP BY    INV_WRK.INV_VAT_AMT																						
													,	FINC_RGN_CD																								
													,	AP_CTR_CD																								
													,	NVL(SUBS_CO_CD,'00')																					
													,	SVC_ORD.INV_NO																							
													,	TO_CHAR(INV_WRK.INV_ISS_DT,'YYYYMMDD')																	
													,	MDM_ORG.LOC_CD																							
								) A																																
								GROUP BY 	TRSP_SO_TP_CD																										
										,	TRSP_SO_OFC_CTY_CD																										
										,	TRSP_SO_SEQ																										
										,	DTRB_COA_RGN_CD																										
					) 																																			
		)			]]></sql>
			<params>
				<param name="CSR_NO" type="12" value="" out="N"/>
				<param name="INV_TAX_CD" type="12" value="" out="N"/>
				<param name="CRE_USR_ID" type="12" value="" out="N"/>
				<param name="INV_VNDR_SEQ" type="12" value="" out="N"/>
				<param name="TRSP_INV_AUD_STS_CD" type="12" value="" out="N"/>
				<param name="CNT_CD" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
