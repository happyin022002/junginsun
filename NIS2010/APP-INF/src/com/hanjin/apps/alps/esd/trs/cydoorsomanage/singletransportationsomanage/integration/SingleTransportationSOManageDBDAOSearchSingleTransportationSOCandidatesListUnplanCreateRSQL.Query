<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SingleTransportationSOManageDBDAOSearchSingleTransportationSOCandidatesListUnplanCreateRSQL">
			<desc><![CDATA[Unplaned S/O Candidate 선정]]></desc>
			<sql><![CDATA[
SELECT * 
 FROM ( 
   SELECT   
   B.CTRL_OFC_CD 
 , A.COP_NO                    
 , NVL(A.CNTR_NO, ' ') EQ_NO 
 , A.CNTR_TPSZ_CD  AS EQ_TPSZ_CD            
 , B.COST_ACT_GRP_SEQ          
 , B.COST_ACT_GRP_CD 
 , B.N1ST_VNDR_SEQ AS VNDR_SEQ            
 , 'TD' TRSP_CRR_MOD_CD
 , SUBSTR(B.N1ST_NOD_CD,1,5)  FM_NOD_CD 
 , SUBSTR(B.N1ST_NOD_CD,6)    FM_NOD_YARD 
 , TRS_CYDOOR_COMM_PKG.GET_SO_NODE_FNC('TO' , B.PCTL_IO_BND_CD, B.PCTL_COST_MOD_CD, B.N1ST_NOD_CD, B.N2ND_NOD_CD, B.N3RD_NOD_CD, B.N4TH_NOD_CD, 'NODE') TO_NOD_CD    
 , TRS_CYDOOR_COMM_PKG.GET_SO_NODE_FNC('TO' , B.PCTL_IO_BND_CD, B.PCTL_COST_MOD_CD, B.N1ST_NOD_CD, B.N2ND_NOD_CD, B.N3RD_NOD_CD, B.N4TH_NOD_CD, 'YARD') TO_NOD_YARD  
 , TRS_CYDOOR_COMM_PKG.GET_SO_NODE_FNC('VIA', B.PCTL_IO_BND_CD, B.PCTL_COST_MOD_CD, B.N1ST_NOD_CD, B.N2ND_NOD_CD, B.N3RD_NOD_CD, B.N4TH_NOD_CD, 'NODE') VIA_NOD_CD   
 , TRS_CYDOOR_COMM_PKG.GET_SO_NODE_FNC('VIA', B.PCTL_IO_BND_CD, B.PCTL_COST_MOD_CD, B.N1ST_NOD_CD, B.N2ND_NOD_CD, B.N3RD_NOD_CD, B.N4TH_NOD_CD, 'YARD') VIA_NOD_YARD 
 , TRS_CYDOOR_COMM_PKG.GET_SO_NODE_FNC('DOR', B.PCTL_IO_BND_CD, B.PCTL_COST_MOD_CD, B.N1ST_NOD_CD, B.N2ND_NOD_CD, B.N3RD_NOD_CD, B.N4TH_NOD_CD, 'NODE') DOR_NOD_CD   
 , TRS_CYDOOR_COMM_PKG.GET_SO_NODE_FNC('DOR', B.PCTL_IO_BND_CD, B.PCTL_COST_MOD_CD, B.N1ST_NOD_CD, B.N2ND_NOD_CD, B.N3RD_NOD_CD, B.N4TH_NOD_CD, 'YARD') DOR_NOD_YARD 
 , B.PCTL_IO_BND_CD AS TRSP_BND_CD             
 , B.INLND_ROUT_INV_BIL_PATT_CD  AS RAIL_CMB_THRU_TP_CD
 , '' CUST_CNT_CD   -- B.CUST_CNT_CD                 
 , 0 CUST_SEQ   --B.CUST_SEQ                    
 , C.SC_NO                       
 , C.RFA_NO                      
 , B.TRSP_SO_STS_CD 
 , DECODE(A.MST_COP_NO, A.COP_NO, 'P', 'X')   MST_LCL_CD
 , @[ui_conti_cd] AS FM_LOC_CONTI_CD        
 , A.BKG_NO                      
 , TO_CHAR(B.N1ST_NOD_PLN_DT, 'YYYYMMDDHH24MISS') N1ST_NOD_PLN_DT
 , DECODE(B.PCTL_IO_BND_CD, 'I',C.DE_TERM_CD, 'O',C.RCV_TERM_CD, '')   BKG_RCVDE_TERM_CD 
 , C.BL_NO 
 , C.BKG_CGO_TP_CD     
 , 'F' CGO_TP_CD     
 , (C.VSL_CD||C.SKD_VOY_NO||C.SKD_DIR_CD) TRUNKVVD 
 , C.SLAN_CD           
 , C.POR_CD POR_CD     
 , C.POL_CD POL_CD     
 , C.POD_CD POD_CD     
 , C.DEL_CD DEL_CD     
 , C.CMDT_CD           
 , B.DOR_ARR_DT        
 , DECODE(B.PCTL_COST_MOD_CD,'C','CY','Z','DR','') TRSP_COST_DTL_MOD_CD 
 , DECODE(B.PCTL_COST_MOD_CD, '', 'Y', '') UPLN_SO_FLG 
 , COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00286',B.TRSP_SO_STS_CD)            TRSP_SO_STS_NM  
 FROM SCE_COP_HDR A 
, PRD_PROD_CTL_ACT_GRP_DTL B 
, BKG_BOOKING C 
 WHERE A.PCTL_NO=B.PCTL_NO
 AND A.BKG_NO = C.BKG_NO

 #if ($arr_so_office.size() > 0) 
     AND B.CTRL_OFC_CD in (
     #foreach( ${key} in ${arr_so_office}) 
	     #if($velocityCount < $arr_so_office.size()) 
		     '$key', 
	     #else 
		     '$key' 
	     #end 
     #end
     )
 #end
 AND B.PCTL_COST_MOD_CD = 'X' AND A.CNTR_NO <> 'SMCU0000000' 
 AND B.COST_ACT_GRP_TP_CD  = 'N'
-- From Node의 Location으로 조회
#if (${frmnode} != '')
    AND SUBSTR(B.N1ST_NOD_CD,1,5) = @[frmnode]
#end

-- From Node의 Yard로 조회 
#if (${frmnodeyard} != '')
    AND SUBSTR(B.N1ST_NOD_CD,6) = @[frmnodeyard]
#end

-- Booking no로 조회
#if ($arr_bkgno.size() > 0) 
    AND A.BKG_NO in (
    #foreach( ${key} in ${arr_bkgno}) 
	    #if($velocityCount < $arr_bkgno.size()) 
	        '$key', 
	    #else 
            '$key' 
	    #end 
    #end
    )
#end

-- BL NO로 조회
#if ($arr_billno.size() > 0) 
    AND C.BL_NO in (
    #foreach( ${key} in ${arr_billno}) 
      #if($velocityCount < $arr_billno.size()) 
        '$key', 
      #else 
        '$key' 
      #end 
    #end
    )
#end

-- Container no로 조회
#if ($arr_cntrno.size() > 0) 
    AND A.CNTR_NO in (
    #foreach( ${key} in ${arr_cntrno}) 
      #if($velocityCount < $arr_cntrno.size()) 
        '$key', 
      #else 
        '$key' 
      #end 
    #end
  )
#end

-- Trunk VVD로 조회 
#if ($arr_trunkvvd.size() > 0) 
    AND (C.VSL_CD,C.SKD_VOY_NO,C.SKD_DIR_CD) in (
    #foreach( ${key} in ${arr_trunkvvd}) 
      #if($velocityCount < $arr_trunkvvd.size()) 
        (SUBSTR('$key',1,4),SUBSTR('$key',5,4),SUBSTR('$key',9,1)),
      #else 
        (SUBSTR('$key',1,4),SUBSTR('$key',5,4),SUBSTR('$key',9,1))
      #end 
    #end
)
#end

-- Contract No로 조회 
#if (${contract_no} != '' )
    #if (${contract_tp_cd} == 'S' )
        AND C.SC_NO IN (@[contract_no])
    #else
        AND C.RFA_NO IN (@[contract_no])
    #end
#end

 ) AA WHERE 1=1			]]></sql>
			<params>
				<param name="ui_conti_cd" type="12" value="" out="N"/>
				<param name="frmnode" type="12" value="" out="N"/>
				<param name="frmnodeyard" type="12" value="" out="N"/>
				<param name="contract_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
