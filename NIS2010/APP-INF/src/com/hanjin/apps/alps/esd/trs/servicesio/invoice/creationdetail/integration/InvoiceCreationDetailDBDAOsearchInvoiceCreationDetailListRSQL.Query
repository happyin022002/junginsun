<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="InvoiceCreationDetailDBDAOsearchInvoiceCreationDetailListRSQL">
			<desc><![CDATA[Invoice Creation Detail 조회]]></desc>
			<sql><![CDATA[
SELECT 		ROWNUM
			,wo_no
			,eq_no
			,eq_tpsz_nm
			,bkg_no
			,fm_yard_nm
			,via_yard_nm
			,to_yard_nm
			,dor_yard_nm
			,trsp_cost_dtl_mod_cd
			,eq_knd_cd
			,eq_tp_nm
			,eq_tpsz_cd
			,cntr_tpsz_iso_cd
			,bl_no
			,fm_nod_cd
			,via_nod_cd
			,to_nod_cd
			,dor_nod_cd
			,vndr_seq
			,prnt_vndr_seq
			,apnt_dt
			,de_dt
			,cre_ofc_cd
			,so_no
			,curr_cd
			,bzc_amt
			,nego_amt
			,toll_fee_amt
			,fuel_scg_amt
			,scg_vat_amt
			,ovr_wgt_scg_amt
			,etc_add_amt
			,inv_surcharge
			,inv_bzc_amt
			,sp_inv_rmk
			,cgo_tp_cd
			,trsp_inv_calc_lgc_tp_cd
			,inv_xch_rt
			,inv_vat_amt
 FROM (SELECT
			 SVC.trsp_wo_ofc_cty_cd || SVC.trsp_wo_seq wo_no
			,SVC.trsp_cost_dtl_mod_cd
			,(select intg_cd_val_dp_desc from com_intg_cd_dtl where intg_cd_id = 'CD00594' and intg_cd_val_ctnt = SVC.trsp_cost_dtl_mod_cd) trsp_cost_dtl_mod_nm
			,SVC.trsp_so_ofc_cty_cd || SVC.trsp_so_seq so_no
			,SVC.eq_knd_cd
			,(select intg_cd_val_dp_desc from com_intg_cd_dtl where intg_cd_id = 'CD01132' and intg_cd_val_ctnt = SVC.eq_knd_cd) eq_tp_nm
			,SVC.eq_no
			,SVC.eq_tpsz_cd
			,(select cntr_tpsz_rmk from mdm_cntr_tp_sz where cntr_tpsz_cd = SVC.eq_tpsz_cd) eq_tpsz_nm
			,(select cntr_tpsz_iso_cd from mdm_cntr_tp_sz where cntr_tpsz_cd = SVC.eq_tpsz_cd) cntr_tpsz_iso_cd
			,SVC.bkg_no
			,SVC.bl_no bl_no
			,SVC.fm_nod_cd
			,(select yd_nm from mdm_yard where yd_cd = SVC.fm_nod_cd) fm_yard_nm
			,SVC.via_nod_cd
			,(select yd_nm from mdm_yard where yd_cd = SVC.via_nod_cd) via_yard_nm
			,SVC.to_nod_cd
			,(select yd_nm from mdm_yard where yd_cd = SVC.to_nod_cd) to_yard_nm
			,SVC.dor_nod_cd
			,(select yd_nm from mdm_yard where yd_cd = SVC.dor_nod_cd) dor_yard_nm
			,SVC.vndr_seq
			,(select prnt_vndr_seq from mdm_vendor where vndr_seq = SVC.vndr_seq) prnt_vndr_seq
			,SVC.apnt_dt
			,SVC.de_dt
			,SVC.cre_ofc_cd
			,SVC.curr_cd
			,NVL(SVC.bzc_amt, 0.0) bzc_amt
			,NVL(SVC.fuel_scg_amt, 0.0) fuel_scg_amt
			,NVL(SVC.scg_vat_amt, 0.0) scg_vat_amt
			,NVL(SVC.ovr_wgt_scg_amt, 0.0) ovr_wgt_scg_amt
			,NVL(SVC.etc_add_amt, 0.0) etc_add_amt
			,NVL(SVC.nego_amt, 0.0) nego_amt
			,NVL(SVC.toll_fee_amt, 0.0) toll_fee_amt
			,NVL(SVC.inv_bzc_amt, 0.0) inv_bzc_amt
			,(select nvl(sum(inv_scg_amt),0.0) inv_surcharge from trs_trsp_scg_dtl where (trsp_so_ofc_cty_cd = SVC.trsp_so_ofc_cty_cd and trsp_so_seq = SVC.trsp_so_seq)) inv_surcharge --Invoice Surcharge
			,SVC.sp_inv_rmk
			,NVL(SVC.cgo_tp_cd,'M') cgo_tp_cd
			,SVC.inv_xch_rt
			,SVC.trsp_inv_calc_lgc_tp_cd
			,(select inv_vat_amt from trs_trsp_inv_wrk where inv_no = SVC.inv_no and inv_vndr_seq = SVC.inv_vndr_seq) inv_vat_amt
	FROM trs_trsp_svc_ord SVC
	WHERE SVC.trsp_wo_ofc_cty_cd IS NOT NULL --Work Order OFC Code
	AND SVC.trsp_wo_seq IS NOT NULL --Work Order Seq
	AND LENGTH(SVC.trsp_wo_ofc_cty_cd) = 3 --Work Order Seq
	AND SVC.trsp_so_ofc_cty_cd IS NOT NULL --Service Order OFC Code
	AND SVC.trsp_so_seq IS NOT NULL --Service Order Seq
	AND NVL(SVC.delt_flg, 'E') <> 'Y' --Service Order Delete Flag
	AND SVC.eq_no IS NOT NULL --Equipment No
	AND SVC.vndr_seq IS NOT NULL --Vendor Code
    AND SVC.vndr_seq IN ( SELECT vndr_seq
	                                FROM mdm_vendor
	                               WHERE prnt_vndr_seq = (SELECT prnt_vndr_seq
	                                                         FROM mdm_vendor
	                                                         WHERE 1=1
	                                                        AND vndr_seq = @[vndr_seq]
	                                                      )
	                           )
#if ($trsp_so_ofc_cty_cd.size() > 0) 
    AND (SVC.trsp_so_ofc_cty_cd,SVC.trsp_so_seq) in (
	#foreach($sonoKey in ${trsp_so_ofc_cty_cd}) 
		#if($velocityCount < $trsp_so_ofc_cty_cd.size()) 
			(substr('$sonoKey',0,3),to_number(substr('$sonoKey',4,length('$sonoKey')))),
		#else 
			(substr('$sonoKey',0,3),to_number(substr('$sonoKey',4,length('$sonoKey'))))
		#end 
	#end 
  )
#end 
ORDER BY wo_no, eq_no) A			]]></sql>
			<params>
				<param name="vndr_seq" type="2" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
