<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MarineTerminalInvoiceManageDBDAOMultiTerminalInvoiceVVDCSQL">
			<desc><![CDATA[MultiTerminalInvoiceVVD]]></desc>
			<sql><![CDATA[
MERGE INTO TES_TML_SO_VVD_LIST V
USING  DUAL
ON ( V.TML_SO_OFC_CTY_CD = @[tml_so_ofc_cty_cd]
    AND V.TML_SO_SEQ = @[tml_so_seq]
    AND V.VSL_CD = SUBSTR(@[vvd],1,4)
    AND V.SKD_VOY_NO = SUBSTR(@[vvd],5,4)
    AND V.SKD_DIR_CD = SUBSTR(@[vvd],9,1)
    AND V.IO_BND_CD = @[io_bnd_cd]		
	AND NVL(V.CLPT_IND_SEQ,'1') = NVL(@[clpt_ind_seq],'1')
	AND NVL(V.CALL_YD_IND_SEQ,'1') = NVL(@[call_yd_ind_seq],'1')
)
WHEN MATCHED THEN
    UPDATE
    SET UPD_USR_ID = @[userId],
        UPD_DT = SYSDATE
WHEN NOT MATCHED THEN
    INSERT (TML_SO_OFC_CTY_CD,
            TML_SO_SEQ,
            TML_SO_VVD_LIST_SEQ,
            VSL_CD,
            SKD_VOY_NO,
            SKD_DIR_CD,
            IO_BND_CD,
            ATB_DT,
            CRE_USR_ID,
            CRE_DT,
			UPD_USR_ID,
			UPD_DT,
			CLPT_IND_SEQ,
			CALL_YD_IND_SEQ
			)
    VALUES (@[tml_so_ofc_cty_cd],@[tml_so_seq], (SELECT TO_NUMBER(NVL(MAX(TML_SO_VVD_LIST_SEQ),'0'))+1
                  FROM TES_TML_SO_VVD_LIST
                  WHERE TML_SO_OFC_CTY_CD = @[tml_so_ofc_cty_cd]
                  AND TML_SO_SEQ = @[tml_so_seq]),
            SUBSTR(@[vvd],1,4), SUBSTR(@[vvd],5,4), SUBSTR(@[vvd],9,1), @[io_bnd_cd],
            TO_DATE(REPLACE(@[atb_dt],'-',''),'YYYYMMDD'), @[userId], SYSDATE, @[userId], SYSDATE,@[clpt_ind_seq],@[call_yd_ind_seq])			]]></sql>
			<params>
				<param name="tml_so_ofc_cty_cd" type="12" value="" out="N"/>
				<param name="tml_so_seq" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="clpt_ind_seq" type="12" value="" out="N"/>
				<param name="call_yd_ind_seq" type="12" value="" out="N"/>
				<param name="userId" type="12" value="" out="N"/>
				<param name="atb_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
