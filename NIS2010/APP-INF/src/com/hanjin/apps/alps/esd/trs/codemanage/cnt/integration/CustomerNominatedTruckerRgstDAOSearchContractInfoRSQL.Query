<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CustomerNominatedTruckerRgstDAOSearchContractInfoRSQL">
			<desc><![CDATA[SearchContractInfo]]></desc>
			<sql><![CDATA[
#if (${prc_ctrt_tp_cd} != 'R')
-- S/C 조회
SELECT A3.CTRT_CUST_SLS_OFC_CD AS SLS_OFC_CD
      ,A3.CTRT_CUST_SREP_CD
      ,(SELECT SREP_NM
          FROM MDM_SLS_REP
         WHERE SREP_CD = A3.CTRT_CUST_SREP_CD) CTRT_CUST_SREP_NM
      ,A3.CUST_CNT_CD|| LPAD(A3.CUST_SEQ, 6, 0) CTRT_CUST_CD
      ,(SELECT X.CUST_LGL_ENG_NM FROM MDM_CUSTOMER X WHERE X.CUST_CNT_CD = A3.CUST_CNT_CD AND X.CUST_SEQ = A3.CUST_SEQ) CTRT_CUST_NM
      ,A4.CTRT_EFF_DT
      ,A4.CTRT_EXP_DT
      ,CASE WHEN A5.FNL_MQC_QTY IS NULL THEN ''
            ELSE A5.FNL_MQC_QTY ||'/'|| (SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD00897' AND INTG_CD_VAL_CTNT = A5.CNTR_LOD_UT_CD) 
       END FNL_MQC_DESC
FROM PRI_SP_HDR A1
    ,PRI_SP_MN A2
    ,PRI_SP_CTRT_PTY A3
    ,PRI_SP_DUR A4
    ,PRI_SP_MQC A5
WHERE A1.SC_NO = @[prc_ctrt_no]
  AND A1.PROP_NO = A2.PROP_NO
  AND A2.AMDT_SEQ = (
                    SELECT MAX(AMDT_SEQ)
                      FROM PRI_SP_MN
                     WHERE PROP_NO = A1.PROP_NO
                       AND PROP_STS_CD = 'F')
  AND A2.PROP_NO  = A3.PROP_NO
  AND A2.AMDT_SEQ = A3.AMDT_SEQ
  AND A3.PRC_CTRT_PTY_TP_CD = 'C'
  AND A2.PROP_NO  = A4.PROP_NO
  AND A2.AMDT_SEQ = A4.AMDT_SEQ
  AND A2.PROP_NO  = A5.PROP_NO
  AND A2.AMDT_SEQ = A5.AMDT_SEQ
#else

-- RFA 조회
SELECT A2.RESPB_SLS_OFC_CD AS SLS_OFC_CD
      ,A2.RESPB_SREP_CD    AS CTRT_CUST_SREP_CD
      ,(SELECT SREP_NM
          FROM MDM_SLS_REP
         WHERE SREP_CD = A2.RESPB_SREP_CD) CTRT_CUST_SREP_NM 
      ,A2.CTRT_CUST_CNT_CD|| LPAD(A2.CTRT_CUST_SEQ, 6, 0) CTRT_CUST_CD
      ,(SELECT CUST_LGL_ENG_NM FROM MDM_CUSTOMER WHERE CUST_CNT_CD = A2.CTRT_CUST_CNT_CD AND CUST_SEQ = A2.CTRT_CUST_SEQ) CTRT_CUST_NM
      ,A3.CTRT_EFF_DT
      ,A3.CTRT_EXP_DT
      ,CASE WHEN A2.TGT_MVC_QTY IS NULL THEN ''
            ELSE A2.TGT_MVC_QTY ||'/'||(SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD00897' AND INTG_CD_VAL_CTNT = A2.CNTR_LOD_UT_CD) 
       END FNL_MQC_DESC
  FROM PRI_RP_HDR A1
      ,PRI_RP_MN A2
      ,PRI_RP_DUR A3
 WHERE A1.RFA_NO = @[prc_ctrt_no]
   AND A1.PROP_NO = A2.PROP_NO
   AND A2.AMDT_SEQ =  (
                       SELECT MAX(AMDT_SEQ)
                         FROM PRI_RP_MN
                        WHERE PROP_NO = A1.PROP_NO
                          AND PROP_STS_CD = 'A')
   AND A2.PROP_NO  = A3.PROP_NO
   AND A2.AMDT_SEQ = A3.AMDT_SEQ

#end
			]]></sql>
			<params>
				<param name="prc_ctrt_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
