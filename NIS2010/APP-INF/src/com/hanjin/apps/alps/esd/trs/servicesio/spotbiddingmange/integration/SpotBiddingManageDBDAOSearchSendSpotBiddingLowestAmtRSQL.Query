<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SpotBiddingManageDBDAOSearchSendSpotBiddingLowestAmtRSQL">
			<desc><![CDATA[Spot Bidding Number의 최저가 조회]]></desc>
			<sql><![CDATA[
SELECT Y.BID_NO
       ,Y.BID_CURR_CD
       ,ROUND(Y.BID_AMT,2) BID_AMT
       ,ROUND(Y.USD_AMT,2) USD_AMT
       ,Y.CURR_DT
   FROM	( SELECT RANK() OVER(PARTITION BY X.SPOT_BID_NO ORDER BY X.USD_AMT ASC,X.LOCL_UPD_DT DESC) RNK
		        ,X.SPOT_BID_NO BID_NO
       	        ,X.SPOT_BID_CURR_CD BID_CURR_CD
    	        ,X.SPOT_BID_AMT BID_AMT
   	            ,X.USD_AMT
				,X.CURR_DT
      	   FROM ( SELECT A.SPOT_BID_NO
     	                ,B.SPOT_BID_CURR_CD
         	            ,B.SPOT_BID_AMT
             	        ,TO_CHAR(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(A.CRE_OFC_CD),'YYYYMMDD HH24:MI:SS') CURR_DT
              	        ,TRS_COMMON_PKG.GET_CONVERSION_USD_AMT_FNC(B.SPOT_BID_CURR_CD,SPOT_BID_AMT,TO_CHAR(GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC(A.CRE_OFC_CD),'YYYYMMDD')) USD_AMT
                        ,B.LOCL_UPD_DT
          	        FROM TRS_SPOT_BID A
                    	,TRS_SPOT_BID_VNDR B
         	       WHERE A.SPOT_BID_NO = B.SPOT_BID_NO
            	     AND B.SPOT_BID_VNDR_STS_CD = 'S'
					 AND B.SPOT_BID_CURR_CD IS NOT NULL
                     AND B.SPOT_BID_AMT > 0
	  	    	     AND A.SPOT_BID_NO IN (
#foreach( ${key} in ${arr_bid_no}) 
	#if($velocityCount == 1)						
		'$key'
	#else
	    ,'$key'
	#end
#end
						) 
      	           ) X
       ) Y
  WHERE Y.RNK = 1			]]></sql>
			<params>
			</params>
		</query>
	</querys>
</sqls>
