<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OffdockCYInvoiceManageDBDAOSearchOffdockRevisedVolumeDoubleBillChkRSQL">
			<desc><![CDATA[Revised Volume pop up Double Billing check]]></desc>
			<sql><![CDATA[
SELECT NVL(COUNT(CNTR_NO),0) CNTR_CNT, @[cntr_no] CNTR_NO
FROM (
    SELECT B.CNTR_NO
    FROM TES_TML_SO_HDR A,
      TES_TML_SO_CNTR_LIST B
    WHERE A.TML_SO_OFC_CTY_CD = B.TML_SO_OFC_CTY_CD
      AND A.TML_SO_SEQ = B.TML_SO_SEQ
      AND A.VNDR_SEQ = @[vndr_seq]
      AND A.YD_CD = @[yd_cd]
      AND B.CNTR_NO = @[cntr_no]
      AND B.CNTR_STY_CD = @[cntr_sty_cd]
      AND A.INV_NO <> @[inv_no]
      AND NVL(A.DELT_FLG, 'N') <> 'Y'
      AND A.TML_INV_TP_CD = 'OF'
      AND A.TML_INV_RJCT_STS_CD <> 'RJ'
      AND ABS(MONTHS_BETWEEN(B.MVMT_GATE_IN_DT, TO_DATE(@[inv_gate_in_dt],'YYYYMMDDHH24MISS'))) <= 1
      AND CASE WHEN (SIGN(A.TO_PRD_DT-A.FM_PRD_DT)>0
          AND SIGN(replace(@[fm_prd_dt], '-')-A.TO_PRD_DT)>0)
      OR (SIGN(A.TO_PRD_DT-A.FM_PRD_DT)>0
          AND SIGN(A.FM_PRD_DT- replace(@[to_prd_dt], '-'))>0) THEN 'N' ELSE 'Y' END = 'Y'
      AND CASE WHEN (SIGN(B.MVMT_GATE_OUT_DT-B.MVMT_GATE_IN_DT)>0
          AND SIGN(TO_DATE(@[inv_gate_in_dt], 'YYYYMMDDHH24MISS')-B.MVMT_GATE_OUT_DT)>0)
      OR (SIGN(B.MVMT_GATE_OUT_DT-B.MVMT_GATE_IN_DT)>0
          AND SIGN(B.MVMT_GATE_IN_DT-TO_DATE(@[inv_gate_out_dt], 'YYYYMMDDHH24MISS'))>0) THEN 'N' ELSE 'Y' END = 'Y'
    UNION ALL
    SELECT B.CNTR_NO
    FROM TES_TML_SO_HDR A,
      TES_TML_SO_RVIS_LIST B
    WHERE A.TML_SO_OFC_CTY_CD = B.TML_SO_OFC_CTY_CD
      AND A.TML_SO_SEQ = B.TML_SO_SEQ
      AND A.VNDR_SEQ = @[vndr_seq]
      AND A.YD_CD = @[yd_cd]
      AND B.CNTR_NO = @[cntr_no]
      AND B.CNTR_STY_CD = @[cntr_sty_cd]
      AND A.INV_NO <> @[inv_no]
      AND NVL(A.DELT_FLG, 'N') <> 'Y'
      AND A.TML_INV_TP_CD = 'OF'
      AND A.TML_INV_RJCT_STS_CD <> 'RJ'
      AND ABS(MONTHS_BETWEEN(B.INV_GATE_IN_DT, TO_DATE(@[inv_gate_in_dt],'YYYYMMDDHH24MISS'))) <= 1
      AND CASE WHEN (SIGN(A.TO_PRD_DT-A.FM_PRD_DT)>0
          AND SIGN(replace(@[fm_prd_dt], '-')-A.TO_PRD_DT)>0)
      OR (SIGN(A.TO_PRD_DT-A.FM_PRD_DT)>0
          AND SIGN(A.FM_PRD_DT- replace(@[to_prd_dt], '-'))>0) THEN 'N' ELSE 'Y' END = 'Y'
      AND CASE WHEN (SIGN(B.INV_GATE_OUT_DT-B.INV_GATE_IN_DT)>0
          AND SIGN(TO_DATE(@[inv_gate_in_dt], 'YYYYMMDDHH24MISS')-B.INV_GATE_OUT_DT)>0)
      OR (SIGN(B.INV_GATE_OUT_DT-B.INV_GATE_IN_DT)>0
          AND SIGN(B.INV_GATE_IN_DT-TO_DATE(@[inv_gate_out_dt], 'YYYYMMDDHH24MISS'))>0) THEN 'N' ELSE 'Y' END = 'Y' )			]]></sql>
			<params>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="vndr_seq" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="cntr_sty_cd" type="12" value="" out="N"/>
				<param name="inv_no" type="12" value="" out="N"/>
				<param name="inv_gate_in_dt" type="12" value="" out="N"/>
				<param name="fm_prd_dt" type="12" value="" out="N"/>
				<param name="to_prd_dt" type="12" value="" out="N"/>
				<param name="inv_gate_out_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
