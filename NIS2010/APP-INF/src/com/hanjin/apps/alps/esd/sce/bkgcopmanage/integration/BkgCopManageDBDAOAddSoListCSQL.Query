<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BkgCopManageDBDAOAddSoListCSQL">
			<desc><![CDATA[COP Header 와 Product Catalog number 로 SCE_PLN_SO_LIST 를 생성한다.]]></desc>
			<sql><![CDATA[
INSERT INTO SCE_PLN_SO_LIST
        (
  COP_NO,
  COST_ACT_GRP_SEQ,
  COST_ACT_GRP_CD,
  CTRL_OFC_CD,
  N1ST_NOD_PLN_DT,
  N1ST_NOD_CD,
  N2ND_NOD_CD,
  N3RD_NOD_CD,
  N4TH_NOD_CD,
  PCTL_IO_BND_CD,
  PCTL_COST_MOD_CD,
  N1ST_VNDR_SEQ,
  TRSP_SO_STS_CD,
  TRSP_MOD_CD,
  INLND_ROUT_INV_BIL_PATT_CD,
  INV_BIL_PATT_DIV_FLG,
  CRE_USR_ID,
  CRE_DT,
  UPD_USR_ID,
  UPD_DT,
  DOR_ARR_DT,
  LST_NOD_PLN_DT  

        )
SELECT COP_NO,
  COST_ACT_GRP_SEQ,
  COST_ACT_GRP_CD,
  CTRL_OFC_CD,
  N1ST_NOD_PLN_DT,
  N1ST_NOD_CD,
  N2ND_NOD_CD,
  N3RD_NOD_CD,
  N4TH_NOD_CD,
  PCTL_IO_BND_CD,
  PCTL_COST_MOD_CD,
  N1ST_VNDR_SEQ,
  TRSP_SO_STS_CD,
  TRSP_MOD_CD,
  INLND_ROUT_INV_BIL_PATT_CD,
  INV_BIL_PATT_DIV_FLG,
  CRE_USR_ID,
  CRE_DT,
  UPD_USR_ID,
  UPD_DT,
  DOR_ARR_DT,
  LST_NOD_PLN_DT
FROM 
	(
		SELECT A.COP_NO COP_NO ,
     	 B.COST_ACT_GRP_SEQ COST_ACT_GRP_SEQ ,
      	 MAX(B.COST_ACT_GRP_CD ) COST_ACT_GRP_CD ,
      	 MAX(B.CTRL_OFC_CD ) CTRL_OFC_CD ,
     	 MAX(B.N1ST_NOD_PLN_DT ) N1ST_NOD_PLN_DT ,
     	 MAX(B.N1ST_NOD_CD ) N1ST_NOD_CD ,
     	 MAX(B.N2ND_NOD_CD ) N2ND_NOD_CD ,
     	 MAX(B.N3RD_NOD_CD ) N3RD_NOD_CD ,
     	 MAX(B.N4TH_NOD_CD ) N4TH_NOD_CD ,
     	 MAX(B.PCTL_IO_BND_CD ) PCTL_IO_BND_CD ,
     	 MAX(B.PCTL_COST_MOD_CD ) PCTL_COST_MOD_CD ,
     	 MAX(B.N1ST_VNDR_SEQ ) N1ST_VNDR_SEQ ,
     	 MAX(B.TRSP_SO_STS_CD ) TRSP_SO_STS_CD ,
     	 MAX(B.TRSP_MOD_CD ) TRSP_MOD_CD ,
    	 MAX(B.INLND_ROUT_INV_BIL_PATT_CD) INLND_ROUT_INV_BIL_PATT_CD ,
     	 MAX(B.INV_BIL_PATT_DIV_FLG ) INV_BIL_PATT_DIV_FLG ,
     	'SYS' CRE_USR_ID ,
     	 SYSDATE CRE_DT ,
      	'SYS' UPD_USR_ID ,
      	 SYSDATE UPD_DT ,
      	 MAX(B.DOR_ARR_DT ) DOR_ARR_DT ,
      	 MAX(B.LST_NOD_ARR_DT ) LST_NOD_PLN_DT
    	FROM SCE_COP_HDR A ,
      	  PRD_PROD_CTL_ACT_GRP_DTL B
    	WHERE A.BKG_NO = @[bkg_no]
      	AND A.COP_NO = @[cop_no]
      	AND B.PCTL_NO = A.PCTL_NO
    	GROUP BY A.COP_NO , B.COST_ACT_GRP_SEQ
	)
WHERE ((
        SELECT COUNT(*)
        FROM
			(
				SELECT A.COP_NO COP_NO ,
     	 		 B.COST_ACT_GRP_SEQ COST_ACT_GRP_SEQ ,
      	 		 MAX(B.COST_ACT_GRP_CD ) COST_ACT_GRP_CD ,
      	 		 MAX(B.CTRL_OFC_CD ) CTRL_OFC_CD ,
     			 MAX(B.N1ST_NOD_PLN_DT ) N1ST_NOD_PLN_DT ,
     	 		 MAX(B.N1ST_NOD_CD ) N1ST_NOD_CD ,
     	 		 MAX(B.N2ND_NOD_CD ) N2ND_NOD_CD ,
     	 		 MAX(B.N3RD_NOD_CD ) N3RD_NOD_CD ,
     	 		 MAX(B.N4TH_NOD_CD ) N4TH_NOD_CD ,
     	 		 MAX(B.PCTL_IO_BND_CD ) PCTL_IO_BND_CD ,
     	 		 MAX(B.PCTL_COST_MOD_CD ) PCTL_COST_MOD_CD ,
     	 		 MAX(B.N1ST_VNDR_SEQ ) N1ST_VNDR_SEQ ,
     	 		 MAX(B.TRSP_SO_STS_CD ) TRSP_SO_STS_CD ,
     			 MAX(B.TRSP_MOD_CD ) TRSP_MOD_CD ,
    			 MAX(B.INLND_ROUT_INV_BIL_PATT_CD) INLND_ROUT_INV_BIL_PATT_CD ,
     			 MAX(B.INV_BIL_PATT_DIV_FLG ) INV_BIL_PATT_DIV_FLG ,
     			'SYS' CRE_USR_ID ,
     			 SYSDATE CRE_DT ,
      			'SYS' UPD_USR_ID ,
      			 SYSDATE UPD_DT ,
      	 		 MAX(B.DOR_ARR_DT ) DOR_ARR_DT ,
      			 MAX(B.LST_NOD_ARR_DT ) LST_NOD_PLN_DT
    			FROM SCE_COP_HDR A ,
      	 		  PRD_PROD_CTL_ACT_GRP_DTL B
    			WHERE A.BKG_NO = @[bkg_no]
      			AND A.COP_NO = @[cop_no]
      			AND B.PCTL_NO = A.PCTL_NO
    			GROUP BY A.COP_NO , B.COST_ACT_GRP_SEQ
			)
        WHERE NVL(TRSP_SO_STS_CD, 'U') != 'U') > 0
      AND NVL(TRSP_SO_STS_CD, 'U') != 'U')
  OR ((
        SELECT COUNT(*)
        FROM
			(
				SELECT A.COP_NO COP_NO ,
     	 		 B.COST_ACT_GRP_SEQ COST_ACT_GRP_SEQ ,
      	 		 MAX(B.COST_ACT_GRP_CD ) COST_ACT_GRP_CD ,
      	 		 MAX(B.CTRL_OFC_CD ) CTRL_OFC_CD ,
     			 MAX(B.N1ST_NOD_PLN_DT ) N1ST_NOD_PLN_DT ,
     	 		 MAX(B.N1ST_NOD_CD ) N1ST_NOD_CD ,
     	 		 MAX(B.N2ND_NOD_CD ) N2ND_NOD_CD ,
     	 		 MAX(B.N3RD_NOD_CD ) N3RD_NOD_CD ,
     	 		 MAX(B.N4TH_NOD_CD ) N4TH_NOD_CD ,
     	 		 MAX(B.PCTL_IO_BND_CD ) PCTL_IO_BND_CD ,
     	 		 MAX(B.PCTL_COST_MOD_CD ) PCTL_COST_MOD_CD ,
     	 		 MAX(B.N1ST_VNDR_SEQ ) N1ST_VNDR_SEQ ,
     	 		 MAX(B.TRSP_SO_STS_CD ) TRSP_SO_STS_CD ,
     			 MAX(B.TRSP_MOD_CD ) TRSP_MOD_CD ,
    			 MAX(B.INLND_ROUT_INV_BIL_PATT_CD) INLND_ROUT_INV_BIL_PATT_CD ,
     			 MAX(B.INV_BIL_PATT_DIV_FLG ) INV_BIL_PATT_DIV_FLG ,
     			'SYS' CRE_USR_ID ,
     			 SYSDATE CRE_DT ,
      			'SYS' UPD_USR_ID ,
      			 SYSDATE UPD_DT ,
      	 		 MAX(B.DOR_ARR_DT ) DOR_ARR_DT ,
      			 MAX(B.LST_NOD_ARR_DT ) LST_NOD_PLN_DT
    			FROM SCE_COP_HDR A ,
      	 		  PRD_PROD_CTL_ACT_GRP_DTL B
    			WHERE A.BKG_NO = @[bkg_no]
      			AND A.COP_NO = @[cop_no]
      			AND B.PCTL_NO = A.PCTL_NO
    			GROUP BY A.COP_NO , B.COST_ACT_GRP_SEQ
			)
        WHERE NVL(TRSP_SO_STS_CD, 'U') != 'U') = 0
      AND COST_ACT_GRP_SEQ = 990)
ORDER BY COP_NO, COST_ACT_GRP_SEQ			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="TYO000001500" out="N"/>
				<param name="cop_no" type="12" value="CTYO0204009389" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
