<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="FillInEquipmentNoDBDAOsearchFillInEquipmentNoListRSQL">
			<desc><![CDATA[Fill In Equipment No List 조회 한다.]]></desc>
			<sql><![CDATA[
select DISTINCT x1.CNTR_NO,
  x1.CNTR_TPSZ_CD,
  x1.EQ_TPSZ_NM,
  x1.BKG_NO,
  x1.BKG_STATUS_CD ,
  DECODE(x2.cntr_no, NULL, X1.BKG_STATUS_NM, 'N') BKG_STATUS_NM ,
  x1.BL_NO,
  x1.ORG_BKG_NO,
  DECODE((SELECT DISTINCT EQ_NO
          FROM TRS_TRSP_SVC_ORD
          WHERE (ORG_BKG_NO = x1.ORG_BKG_NO OR BKG_NO = x1.BKG_NO)
			AND TRSP_BND_CD = 'O'
			AND TRSP_COST_DTL_MOD_CD = 'DR'
			AND DELT_FLG = 'N'
            AND x1.CNTR_NO =EQ_NO(+) ), null, 'Y', 'N') AS SO_EQ_Flg,
  DECODE((SELECT DISTINCT EQ_NO
          FROM TRS_TRSP_SVC_ORD
          WHERE (ORG_BKG_NO = x1.ORG_BKG_NO OR BKG_NO = x1.BKG_NO)
          AND TRSP_BND_CD = 'O'
          AND TRSP_COST_DTL_MOD_CD = 'DR'
          AND DELT_FLG = 'N'
          AND x1.CNTR_NO =EQ_NO(+) ), null, 'Y', 'N') AS SO_EQ_Flg,
  DECODE((SELECT VNDR_SEQ
          FROM CTM_MOVEMENT
          WHERE 1=1
            AND BKG_NO = X1.BKG_NO
            AND CNTR_NO = X1.CNTR_NO
            AND MVMT_STS_CD = 'OC'
            AND ROWNUM = 1), '','Y', DECODE((SELECT USA_EDI_CD 
                                             FROM MDM_VENDOR
                                             WHERE 1=1
                                               AND VNDR_SEQ = (SELECT VNDR_SEQ
                                                               FROM CTM_MOVEMENT
                                                               WHERE 1=1
                                                                 AND BKG_NO = X1.BKG_NO
                                                                 AND CNTR_NO = X1.CNTR_NO
                                                                 AND MVMT_STS_CD = 'OC'
                                                                 AND ROWNUM = 1)),( SELECT USA_EDI_CD
                                                                                    FROM MDM_VENDOR
                                                                                    WHERE 1=1
                                                                                      AND VNDR_SEQ = @[vndr_seq]) ,'Y', 'N')) CTM_SCAC_CHK_FLG
from (
    SELECT DISTINCT BC.CNTR_NO,
      BC.CNTR_TPSZ_CD,
      (
        SELECT CNTR_TPSZ_RMK
        FROM MDM_CNTR_TP_SZ
        WHERE CNTR_TPSZ_CD = BC.CNTR_TPSZ_CD) AS EQ_TPSZ_NM,
      BK.BKG_NO,
      BK.BKG_STS_CD BKG_STATUS_CD,
      (
        SELECT INTG_CD_VAL_DP_DESC
        FROM COM_INTG_CD_DTL
        WHERE INTG_CD_ID = 'CD00769'
          AND INTG_CD_VAL_CTNT = BK.BKG_STS_CD) BKG_STATUS_NM,
      BK.BL_NO bl_no ,
      SO.ORG_BKG_NO
    FROM (
        SELECT S.TRSP_SO_OFC_CTY_CD,
          S.TRSP_SO_SEQ,
          S.TRSP_WO_OFC_CTY_CD,
          S.TRSP_WO_SEQ,
          S.TRSP_COST_DTL_MOD_CD,
          S.BKG_NO,
          S.EQ_NO,
          S.EQ_TPSZ_CD,
          S.ORG_BKG_NO
        FROM TRS_TRSP_SVC_ORD S
        WHERE S.TRSP_WO_OFC_CTY_CD IS NOT NULL
          AND S.TRSP_WO_SEQ IS NOT NULL ) SO,
      TRS_TRSP_WRK_ORD WO,
      BKG_BOOKING BK ,
      BKG_CONTAINER BC
    WHERE 1 = 1
      AND WO.TRSP_WO_OFC_CTY_CD = SO.TRSP_WO_OFC_CTY_CD
      AND WO.TRSP_WO_SEQ = SO.TRSP_WO_SEQ
      AND WO.DELT_FLG = 'N'
      AND SO.TRSP_COST_DTL_MOD_CD = 'DR'
	  AND ( DECODE(bc.cntr_tpsz_cd, so.EQ_TPSZ_CD, 'Y', (
                                                        SELECT DECODE(count(prov_cntr_tpsz_cd), 0, 'N', 'Y')
                                                        FROM SCE_COP_CNTR_REPO_RULE
                                                        WHERE ACT_FLG = 'Y'
                                                        AND CNTR_TPSZ_CD = so.EQ_TPSZ_CD) ) ) = 'Y'
      AND (SO.BKG_NO = BC.BKG_NO
          OR SO.ORG_BKG_NO = BC.BKG_NO)
      AND BC.BKG_NO = BK.BKG_NO
      AND BK.BKG_STS_CD != 'X'
      AND wo.wo_vndr_seq IN (
        SELECT vndr_seq
        FROM mdm_vendor
        WHERE prnt_vndr_seq = (
            SELECT prnt_vndr_seq
            FROM mdm_vendor
            WHERE 1=1
              AND vndr_seq = @[vndr_seq] ) )
      AND (wo.trsp_wo_ofc_cty_cd,
          wo.trsp_wo_seq) = ((@[trsp_wo_ofc_cty_cd],
              @[trsp_wo_seq])) ) x1,
  (
    SELECT CNTR_NO,
      CNTR_TPSZ_CD,
      eq_tpsz_nm,
      bkg_no,
      BKG_STATUS_CD,
      BKG_STATUS_NM,
      BL_NO,
      org_bkg_no
    FROM (
        SELECT so.eq_NO CNTR_NO,
          so.eq_TPSZ_CD CNTR_TPSZ_CD,
          (
            SELECT cntr_tpsz_rmk
            FROM mdm_cntr_tp_sz
            WHERE cntr_tpsz_cd = so.eq_TPSZ_CD) AS eq_tpsz_nm,
          so.bkg_no,
          BK.BKG_STS_CD BKG_STATUS_CD,
          (
            SELECT INTG_CD_VAL_DP_DESC
            FROM COM_INTG_CD_DTL
            WHERE INTG_CD_ID = 'CD00769'
              AND INTG_CD_VAL_CTNT = BK.BKG_STS_CD) BKG_STATUS_NM,
          BK.BL_NO bl_no,
          so.org_bkg_no
        FROM BKG_BOOKING BK,
          (
            select wo.TRSP_WO_OFC_CTY_CD,
              wo.TRSP_WO_SEQ,
              EQ_NO,
              BKG_NO,
              so.org_bkg_no,
              so.EQ_TPSZ_CD
            from TRS_TRSP_SVC_ORD so,
              TRS_TRSP_WRK_ORD wo
            where 1=1
              AND wo.trsp_wo_ofc_cty_cd = so.trsp_wo_ofc_cty_cd
              AND wo.trsp_wo_seq = so.trsp_wo_seq
              AND WO.DELT_FLG = 'N'
              AND (so.bkg_no ) IN (
                SELECT bkg_no
                FROM trs_trsp_svc_ord
                WHERE 1 = 1
                  AND trsp_wo_ofc_cty_cd = @[trsp_wo_ofc_cty_cd]
                  AND trsp_wo_seq = @[trsp_wo_seq]
                union all
                SELECT org_bkg_no
                FROM trs_trsp_svc_ord
                WHERE 1 = 1
                  AND trsp_wo_ofc_cty_cd = @[trsp_wo_ofc_cty_cd]
                  AND trsp_wo_seq = @[trsp_wo_seq] )
              AND (wo.trsp_wo_ofc_cty_cd,
                  wo.trsp_wo_seq) = ((@[trsp_wo_ofc_cty_cd],
                      @[trsp_wo_seq]))
              AND so.trsp_cost_dtl_mod_cd = 'DR'
              AND wo.wo_vndr_seq IN (
                SELECT vndr_seq
                FROM mdm_vendor
                WHERE prnt_vndr_seq = (
                    SELECT prnt_vndr_seq
                    FROM mdm_vendor
                    WHERE 1=1
                      AND vndr_seq = @[vndr_seq] ) ) ) so
        where 1=1
          and so.bkg_no = bk.bkg_no
          AND bk.bkg_sts_cd != 'X'
          and so.eq_NO is not null )) x2
where x1.cntr_no = x2.cntr_no(+)			]]></sql>
			<params>
				<param name="vndr_seq" type="2" value="190857" out="N"/>
				<param name="trsp_wo_ofc_cty_cd" type="12" value="CHI" out="N"/>
				<param name="trsp_wo_seq" type="2" value="5300946" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
