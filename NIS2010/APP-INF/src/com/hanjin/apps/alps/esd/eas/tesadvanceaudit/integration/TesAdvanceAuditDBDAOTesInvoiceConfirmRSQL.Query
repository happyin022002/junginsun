<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TesAdvanceAuditDBDAOTesInvoiceConfirmRSQL">
			<desc><![CDATA[TesInvoiceConfirm]]></desc>
			<sql><![CDATA[
SELECT   
    RHQ_CD
  , INV_OFC_CD
  , COST_OFC_CD
  , TML_INV_TP_CD
  , YD_CD
  , VNDR_SEQ
  , INV_NO
  , EXPN_AUD_SEQ
  , TO_CHAR(ISS_DT, 'YYYY-MM-DD') AS ISS_DT
  , TO_CHAR(INV_CFM_DT, 'YYYY-MM-DD') AS INV_CFM_DT
  , VSL_CD
  , SKD_VOY_NO
  , SKD_DIR_CD
  , VSL_CD || SKD_VOY_NO || SKD_DIR_CD AS VVD
  , IO_BND_CD
  , ATB_DT
  , FM_PRD_DT
  , TO_PRD_DT
  , BAT_VOL_RSLT_CD
  , BAT_AMT_RSLT_CD
  , BAT_ESTM_VOL_RSLT_CD
  , EXPN_AUD_STS_CD
  , (SELECT CICD.INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL CICD WHERE CICD.INTG_CD_ID = 'CD03348' AND CICD.INTG_CD_VAL_CTNT = EXPN_AUD_STS_CD) AS EXPN_AUD_STS_NM
FROM EAS_TML_AUD
WHERE 1=1
  AND NVL(AUTO_EXPN_AUD_STS_CD,' ') <> 'X'
  -- 1. RHQ
#if (${s_rhq_ofc_cd} != '')
  AND RHQ_CD = @[s_rhq_ofc_cd]
#end
  -- 2. INVOICE OFFICE
#if (${s_inv_ofc_cd} != '')
  AND INV_OFC_CD   = @[s_inv_ofc_cd]
#end
  -- 3. CONFIRM DATE
  AND INV_CFM_DT BETWEEN TO_DATE(REPLACE(@[s_from_inv_cfm_dt],'-',''),'YYYYMMDD') AND TO_DATE(REPLACE(@[s_to_inv_cfm_dt],'-',''),'YYYYMMDD') + 0.99999
  -- 5. INVOICE NO.
#if (${s_inv_no} != '')
  AND INV_NO    = @[s_inv_no]
#end  
-- 4. BATCH RESULT 
#if (${s_bat_rslt_cd} == 'S')
  AND BAT_VOL_RSLT_CD = 'S' AND BAT_AMT_RSLT_CD = 'S' AND BAT_ESTM_VOL_RSLT_CD = 'S'
#elseif (${s_bat_rslt_cd} == 'F')
  AND (BAT_VOL_RSLT_CD = 'F' OR BAT_AMT_RSLT_CD = 'F' OR BAT_ESTM_VOL_RSLT_CD = 'F')
#end			]]></sql>
			<params>
				<param name="s_rhq_ofc_cd" type="12" value="" out="N"/>
				<param name="s_inv_ofc_cd" type="12" value="" out="N"/>
				<param name="s_from_inv_cfm_dt" type="12" value="" out="N"/>
				<param name="s_to_inv_cfm_dt" type="12" value="" out="N"/>
				<param name="s_inv_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
