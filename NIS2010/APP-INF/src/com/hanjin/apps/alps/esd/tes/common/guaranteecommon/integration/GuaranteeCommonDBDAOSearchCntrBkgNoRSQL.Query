<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GuaranteeCommonDBDAOSearchCntrBkgNoRSQL">
			<desc><![CDATA[Container No.로 BKG No. 조회]]></desc>
			<sql><![CDATA[
SELECT  (SELECT
        LTRIM(MAX(SYS_CONNECT_BY_PATH(BKG_NO,'|')),'|')
        FROM    (
                SELECT  ROWNUM ROW_ID, Z.BKG_NO
                FROM    (   
						#if (${cre_flg} == 'I') 
						SELECT  'N/A' BKG_NO FROM DUAL
						UNION ALL
						#end
                        SELECT BB.BKG_NO
                        FROM (
                            SELECT  DISTINCT B.BKG_NO
                            FROM	BKG_BOOKING B, BKG_CONTAINER C, CTM_MOVEMENT D
                            WHERE	B.BKG_NO   = C.BKG_NO
                            AND     C.CNTR_NO  = D.CNTR_NO
                            AND     C.CNTR_NO  = NVL(@[cntr_no],'')
                            AND     D.OB_CNTR_FLG  = 'N'  
                            AND     B.BKG_STS_CD IN ('F','W')   
                            AND     SUBSTR(D.ORG_YD_CD,1,2) IN ('US','CA')
                            AND     (SUBSTR(B.POR_NOD_CD,1,2) IN ('US','CA') OR SUBSTR(B.DEL_NOD_CD,1,2) IN ('US','CA'))
                            AND     D.CNMV_EVNT_DT BETWEEN TO_DATE(TO_CHAR(SYSDATE - 365, 'YYYYMMDD'), 'YYYY-MM-DD')  AND  TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD'),'YYYY-MM-DD') + 0.99999
							AND     B.CRE_DT BETWEEN TO_DATE(TO_CHAR(SYSDATE - 545, 'YYYYMMDD'), 'YYYY-MM-DD')  AND  TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD'),'YYYY-MM-DD') + 0.99999
                            UNION 
                            SELECT DISTINCT B.BKG_NO
                            FROM BKG_BOOKING B, BKG_CONTAINER C
                            WHERE	B.BKG_NO   = C.BKG_NO
                            AND     C.CNTR_NO  = NVL(@[cntr_no],'')
                            AND     B.BKG_STS_CD IN ('F','W') 
                            AND     SUBSTR(B.POD_CD,1,2) IN ('US','CA')
                            AND     C.CNMV_STS_CD = 'VL') BB
                        ) Z
                )
        CONNECT BY PRIOR ROW_ID = ROW_ID - 1
        START WITH ROW_ID = 1
        ) BKG_NO_LIST
FROM DUAL			]]></sql>
			<params>
				<param name="cntr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
