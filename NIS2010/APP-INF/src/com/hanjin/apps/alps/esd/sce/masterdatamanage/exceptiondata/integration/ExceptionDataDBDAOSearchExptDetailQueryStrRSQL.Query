<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ExceptionDataDBDAOSearchExptDetailQueryStrRSQL">
			<desc><![CDATA[select querystr]]></desc>
			<sql><![CDATA[
SELECT SUBSTR(MIN(CUR_FMACT_CD),1,8) F_FM_EXPT_CD, SUBSTR(MIN(CUR_FMACT_CD),1,3)||'00000' F_COP_EXPT_TP_DTL_CD
	      ,(CASE WHEN COUNT(SUBSTR(CUR_FMACT_CD,1,8)) >= 2 AND SUBSTR(MIN(CUR_FMACT_CD),9,1) = 'N' AND SUBSTR(MAX(CUR_FMACT_CD),9,1) = 'Y' 
	             THEN 'Y' ELSE SUBSTR(MIN(CUR_FMACT_CD),9,1) END) F_VALIDATION, '' F_TO_EXPT_CD  
FROM   (SELECT (CASE WHEN FA.CHK_FMACT = 'Y' THEN MIN(FA.CHK_FMACT_NO)||FA.CHK_FMACT ELSE MAX(FA.CHK_FMACT_NO)||FA.CHK_FMACT END) CUR_FMACT_CD
	     FROM   (SELECT  /* INPUT From Activity Code */
		           (CASE WHEN SUBSTR(F.EXPT_CD,1,4) = D.CUR_DTL_CD || '1'
			             THEN (CASE WHEN F.EXPT_CD_NM = @[f_cop_expt_tp_dtl_nm]  THEN 'Y' ELSE 'N' END) 		--'FTVMUD'
	 		             ELSE 'N' END) CHK_FMACT 
		          	,(CASE WHEN SUBSTR(F.EXPT_CD,1,4) = D.CUR_DTL_CD || '1' 
			        		THEN (CASE WHEN F.EXPT_CD_NM = @[f_cop_expt_tp_dtl_nm] THEN MAX(F.EXPT_CD) ELSE MAX(TO_NUMBER(SUBSTR(F.EXPT_CD,1,6))+1)||'00' END) 		--'FTVMUD'
			        		ELSE D.CUR_DTL_CD || '10100' END) CHK_FMACT_NO 
	            FROM   SCE_EXPT_CD F,
	               (SELECT ( CASE WHEN MAX(SUBSTR(CHK_DTL_NM,9,1)) = 'Y' 
	                         THEN SUBSTR(MIN(CHK_DTL_CD),1,3) 
	                         ELSE SUBSTR(MAX(CHK_DTL_CD),1,3) END ) CUR_DTL_CD
	                FROM  ( SELECT  --INPUT ExceptionTypeDeail Name 
	                              (CASE WHEN DTP.EXPT_CD_NM = @[f_cop_expt_tp_dtl_nm] THEN 'Y' ELSE 'N' END) CHK_DTL_NM			--'ETD Delay Exception' 
	                             ,(CASE WHEN DTP.EXPT_CD_NM = @[f_cop_expt_tp_dtl_nm] THEN MAX(DTP.EXPT_CD)||'Y' ELSE MAX(TO_NUMBER(SUBSTR(DTP.EXPT_CD,1,3))+1)||'00000'||'N' END) CHK_DTL_CD		--'ETD Delay Exception' 
	                        FROM ( SELECT EXPT_CD, SUBSTR(EXPT_CD,1,1) EXPT_TP_CD, SUBSTR(EXPT_CD,1,3) EXPT_TP_DTL_CD, EXPT_CD_NM   
	                               FROM SCE_EXPT_CD  
	                               WHERE EXPT_CD LIKE '%00000' AND ACT_FLG = 'Y' AND EXPT_CD NOT LIKE '%0000000' ) DTP 
	                        WHERE DTP.EXPT_TP_CD = @[f_cop_expt_tp_cd]      --INPUT EXPT_TP 		--'2'
	                        GROUP BY DTP.EXPT_CD_NM  ) 
	               ) D 		
		    WHERE  F.EXPT_CD NOT LIKE '%00000'
		    AND    F.ACT_FLG = 'Y'
		    AND    SUBSTR(F.EXPT_CD,1,1) = SUBSTR(D.CUR_DTL_CD,1,1)
		    GROUP BY F.EXPT_CD, F.EXPT_CD_NM, D.CUR_DTL_CD) FA
	GROUP BY FA.CHK_FMACT )			]]></sql>
			<params>
				<param name="f_cop_expt_tp_dtl_nm" type="12" value="" out="N"/>
				<param name="f_cop_expt_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
