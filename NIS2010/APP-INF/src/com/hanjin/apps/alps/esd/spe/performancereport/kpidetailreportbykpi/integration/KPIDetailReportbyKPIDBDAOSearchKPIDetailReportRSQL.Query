<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="KPIDetailReportbyKPIDBDAOSearchKPIDetailReportRSQL">
			<desc><![CDATA[KPI Detail Report by KPI 데이터를 조회한다]]></desc>
			<sql><![CDATA[
SELECT A.EG_ID
     , A.EG_NM
     , B.SP_KPI_ID
     , c.SP_KPI_NM
     , B.EV_YR
     , LPAD(B.SP_SEQ, 6, '0') AS SP_SEQ 
     , (SELECT VNDR_LGL_ENG_NM FROM MDM_VENDOR WHERE DELT_FLG = 'N' AND VNDR_SEQ = B.SP_SEQ)AS SP_NM     
     , B.JAN_RTO
     , B.FEB_RTO
     , B.MAR_RTO
     , B.APR_RTO
     , B.MAY_RTO
     , B.JUN_RTO
     , B.JUL_RTO
     , B.AUG_RTO
     , B.SEP_RTO
     , B.OCT_RTO
     , B.NOV_RTO
     , B.DEC_RTO
     , B.RSLT_SCRE_RTO
     , D.KPI_WGT_RTO
     , C.SP_KPI_TP_CD
     , (SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD03370' AND INTG_CD_VAL_CTNT = c.SP_KPI_TP_CD) AS SP_KPI_TP_NM     
     , CASE  WHEN C.SP_KPI_TP_CD != 'P' THEN D.KPI_TGT_RTO 
                 ELSE (SELECT ROUND(SUM(KPI_TGT_RTO)/COUNT(1),2) FROM SPE_EV_GRP_TML_PROD_TGT WHERE EG_ID = A.EG_ID AND SP_SEQ = B.SP_SEQ)
      END AS KPI_TGT_RTO     
  FROM SPE_EV_GRP A
     , SPE_EV_GRP_KPI_PERF B
     , SPE_SP_SVC_CATE_KPI C
     , SPE_EV_GRP_KPI_PERF_TGT D
 WHERE 1=1
   AND A.EG_ID = B.EG_ID
   AND B.SP_KPI_ID = C.SP_KPI_ID
   AND B.EG_ID = D.EG_ID
   AND B.SP_KPI_ID = D.SP_KPI_ID   
   AND B.EV_YR = D.EV_YR
   AND B.EV_YR = @[s_ev_yr]
   AND A.EG_RHQ_CD = @[s_eg_rhq_cd]
   AND A.EG_OFC_CD = @[s_eg_ofc_cd]
   AND A.EV_SVC_CATE_CD = @[s_ev_svc_cate_cd]
#if(${s_sp_kpi_id}!='')
   AND B.SP_KPI_ID IN (
  		 #foreach($key IN ${list_sp_kpi_id})
  		  	#if($velocityCount < $list_sp_kpi_id.size())
  				'$key', 
  			#else 
  				'$key' 
  			#end 
  		#end 
                   )
#end

#if(${s_sp_seq}!='')
   AND B.SP_SEQ = @[s_sp_seq]
#end			]]></sql>
			<params>
				<param name="s_ev_yr" type="12" value="" out="N"/>
				<param name="s_eg_rhq_cd" type="12" value="" out="N"/>
				<param name="s_eg_ofc_cd" type="12" value="" out="N"/>
				<param name="s_ev_svc_cate_cd" type="12" value="" out="N"/>
				<param name="s_sp_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
