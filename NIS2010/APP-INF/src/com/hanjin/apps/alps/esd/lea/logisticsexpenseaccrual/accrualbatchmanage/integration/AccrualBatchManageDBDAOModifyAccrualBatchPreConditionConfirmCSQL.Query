<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AccrualBatchManageDBDAOModifyAccrualBatchPreConditionConfirmCSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
-------------------------------------------------------------------------------
-- 수행년월 기준으로 각각의 Revenue YearMonth별 Account Code 별로 입력된
-- Estimated, Accrual Cost 값만을 추려 마지막 Confirm(반드시 한번만 Click)시 
-- GL_ACCL_IF테이블에 Insert 처리(Manual Input FLAG를 반드시 확인 후 처리 할것!)
-- 공통항차(CNTC)의 VVD Type은 'RV' 임
-------------------------------------------------------------------------------
INSERT INTO GL_ACCL_ITRM_IF
(EXE_YRMON, SYS_SRC_ID, REV_YRMON, ACCT_CD, ACCL_SEQ, BIZ_UT_ID, VSL_CD, SKD_VOY_NO,
SKD_DIR_CD, REV_DIR_CD, ESTM_VVD_TP_CD, ESTM_IOC_DIV_CD, ESTM_VVD_HDR_ID,
ESTM_BC_DIV_CD, NOD_CD, ESTM_COST_AMT, ACT_COST_AMT, ACCL_COST_AMT, CRE_USR_ID, CRE_DT,
UPD_USR_ID, UPD_DT	)
SELECT	A.EXE_YRMON, 'ESD', A.REV_YRMON, A.ACCT_CD, (B.ACCL_SEQ + ROWNUM), 'CNTR', 'CNTC',
		SUBSTR(REV_YRMON, 3, 4), 'M', 'M', 'RV', 'XX', '99999', 'C', 'HQCOL',
		SUM (A.ESTM_COST_AMT), DECODE(A.ACCT_CD , '512181', SUM(A.PRE_ACT_COST_AMT), '512381', SUM(A.PRE_ACT_COST_AMT), 0 ),
		SUM (A.ACCL_COST_AMT), 'UI_MNL_SAV',
		SYSDATE, 'UI_MNL_SAV', SYSDATE 
FROM	LEA_ACCT_COST_AMT A,
		(SELECT /*+ INDEX_DESC(GL_ACCL_ITRM_IF XAK1GL_ACCL_ITRM_IF) */
		ACCL_SEQ
		FROM GL_ACCL_ITRM_IF
		WHERE EXE_YRMON = REPLACE(@[frm_exe_yrmon],'-')  AND ROWNUM = 1) B
WHERE	A.EXE_YRMON = REPLACE(@[frm_exe_yrmon],'-') 
AND		A.ACCL_AUTO_CD = 'M'  
AND		A.MNL_INP_FLG = 'Y'   --Manual Rep Account 로 입력한 계정(Account Code)
GROUP BY	A.EXE_YRMON, A.REV_YRMON, A.ACCT_CD, (B.ACCL_SEQ + ROWNUM), SUBSTR (REV_YRMON, 3, 4)			]]></sql>
			<params>
				<param name="frm_exe_yrmon" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
