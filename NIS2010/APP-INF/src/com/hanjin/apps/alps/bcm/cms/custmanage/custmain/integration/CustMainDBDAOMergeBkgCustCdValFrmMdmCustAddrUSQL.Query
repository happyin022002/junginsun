<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CustMainDBDAOMergeBkgCustCdValFrmMdmCustAddrUSQL">
			<desc><![CDATA[Merge cust addr]]></desc>
			<sql><![CDATA[
MERGE INTO BKG_CUST_CD_VAL a										
 USING ( select cust_cnt_cd, cust_seq, MC.CUST_LGL_ENG_NM, MC.NMD_CUST_FLG, MC.DELT_FLG from mdm_customer mc where mc.cust_cnt_cd = @[cust_cnt_cd] and mc.cust_seq = @[cust_seq] ) b           
 ON (a.cust_cnt_cd = b.cust_cnt_cd and a.cust_seq = b.cust_seq )  
 WHEN MATCHED THEN                                                
 UPDATE                                                           
 SET      
    VAL_CUST_NM = BKG_IB_CUST_NM_VAL_FNC(B.CUST_CNT_CD, B.CUST_LGL_ENG_NM)
    ,VAL_CUST_ADDR = NVL((
							SELECT /*+ INDEX_DESC(ADDR XPKMDM_CUST_ADDR) */
                     ADDR.BZET_ADDR
                FROM MDM_CUST_ADDR ADDR 
               WHERE ADDR.PRMRY_CHK_FLG = 'Y'
                 AND ADDR.DELT_FLG = 'N'
                 AND ADDR.CUST_CNT_CD = B.CUST_CNT_CD
                 AND ADDR.CUST_SEQ = B.CUST_SEQ
                 AND ADDR.ADDR_TP_CD ='1'
                 AND ROWNUM = 1 
					), VAL_CUST_ADDR )
    ,NMD_CUST_FLG = B.NMD_CUST_FLG
    ,DELT_FLG = B.DELT_FLG
    ,upd_usr_id  = NVL(@[upd_usr_id], 'SYSTEM')
 	  ,upd_dt      = sysdate
 WHEN NOT MATCHED THEN                                            
 INSERT                                                           
 (                                                                
    CUST_CNT_CD
    ,CUST_SEQ
    ,VAL_CUST_NM
    ,VAL_CUST_ADDR
    ,NMD_CUST_FLG
    ,DELT_FLG
    ,CRE_USR_ID
    ,CRE_DT
    ,UPD_USR_ID
    ,UPD_DT
 )                                                                
 values                                                           
 (                                                                
 	B.CUST_CNT_CD
 	,B.CUST_SEQ
 	,BKG_IB_CUST_NM_VAL_FNC(B.CUST_CNT_CD, B.CUST_LGL_ENG_NM)
  ,  (  	SELECT /*+ INDEX_DESC(ADDR XPKMDM_CUST_ADDR) */
			           ADDR.BZET_ADDR
		      FROM MDM_CUST_ADDR ADDR 
         WHERE ADDR.PRMRY_CHK_FLG = 'Y'
           AND ADDR.DELT_FLG = 'N'
           AND ADDR.CUST_CNT_CD = B.CUST_CNT_CD
           AND ADDR.CUST_SEQ = B.CUST_SEQ
           AND ADDR.ADDR_TP_CD ='1'
           AND ROWNUM = 1 )
 	,B.NMD_CUST_FLG
 	,B.DELT_FLG
 	,NVL(@[cre_usr_id], 'SYSTEM')
 	,NVL(to_date(@[cre_dt],'yyyymmddhh24miss'), sysdate)
 	,NVL(@[upd_usr_id], 'SYSTEM')
 	,NVL(to_date(@[upd_dt],'yyyymmddhh24miss'), sysdate)               			
 )			]]></sql>
			<params>
				<param name="cust_cnt_cd" type="12" value="" out="N"/>
				<param name="cust_seq" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="cre_dt" type="12" value="" out="N"/>
				<param name="upd_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
