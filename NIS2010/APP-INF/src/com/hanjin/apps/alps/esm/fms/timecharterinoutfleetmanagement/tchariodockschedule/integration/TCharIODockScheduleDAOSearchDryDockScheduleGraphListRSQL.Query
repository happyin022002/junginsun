<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharIODockScheduleDAOSearchDryDockScheduleGraphListRSQL">
			<desc><![CDATA[D/dock Schedule Review / Graph]]></desc>
			<sql><![CDATA[
select a.vsl_cd,
		d.slan_cd,
		b.vsl_dznd_capa
		
		#if (${reflection_cd} == "I")
		
			,max(case when phs_out_dt <= @[fst_year]||'0131' and phs_in_dt >= @[fst_year]||'0101' then a.flet_dck_svey_tp_cd else '' end) ym1_01
			,max(case when phs_out_dt <= @[fst_year]||'0231' and phs_in_dt >= @[fst_year]||'0201' then a.flet_dck_svey_tp_cd else '' end) ym1_02
			,max(case when phs_out_dt <= @[fst_year]||'0331' and phs_in_dt >= @[fst_year]||'0301' then a.flet_dck_svey_tp_cd else '' end) ym1_03
			,max(case when phs_out_dt <= @[fst_year]||'0431' and phs_in_dt >= @[fst_year]||'0401' then a.flet_dck_svey_tp_cd else '' end) ym1_04
			,max(case when phs_out_dt <= @[fst_year]||'0531' and phs_in_dt >= @[fst_year]||'0501' then a.flet_dck_svey_tp_cd else '' end) ym1_05
			,max(case when phs_out_dt <= @[fst_year]||'0631' and phs_in_dt >= @[fst_year]||'0601' then a.flet_dck_svey_tp_cd else '' end) ym1_06
			,max(case when phs_out_dt <= @[fst_year]||'0731' and phs_in_dt >= @[fst_year]||'0701' then a.flet_dck_svey_tp_cd else '' end) ym1_07
			,max(case when phs_out_dt <= @[fst_year]||'0831' and phs_in_dt >= @[fst_year]||'0801' then a.flet_dck_svey_tp_cd else '' end) ym1_08
			,max(case when phs_out_dt <= @[fst_year]||'0931' and phs_in_dt >= @[fst_year]||'0901' then a.flet_dck_svey_tp_cd else '' end) ym1_09
			,max(case when phs_out_dt <= @[fst_year]||'1031' and phs_in_dt >= @[fst_year]||'1001' then a.flet_dck_svey_tp_cd else '' end) ym1_10
			,max(case when phs_out_dt <= @[fst_year]||'1131' and phs_in_dt >= @[fst_year]||'1101' then a.flet_dck_svey_tp_cd else '' end) ym1_11
			,max(case when phs_out_dt <= @[fst_year]||'1231' and phs_in_dt >= @[fst_year]||'1201' then a.flet_dck_svey_tp_cd else '' end) ym1_12

			#if (${snd_year} != "")

			,max(case when phs_out_dt <= @[snd_year]||'0131' and phs_in_dt >= @[snd_year]||'0101' then a.flet_dck_svey_tp_cd else '' end) ym2_01
			,max(case when phs_out_dt <= @[snd_year]||'0231' and phs_in_dt >= @[snd_year]||'0201' then a.flet_dck_svey_tp_cd else '' end) ym2_02
			,max(case when phs_out_dt <= @[snd_year]||'0331' and phs_in_dt >= @[snd_year]||'0301' then a.flet_dck_svey_tp_cd else '' end) ym2_03
			,max(case when phs_out_dt <= @[snd_year]||'0431' and phs_in_dt >= @[snd_year]||'0401' then a.flet_dck_svey_tp_cd else '' end) ym2_04
			,max(case when phs_out_dt <= @[snd_year]||'0531' and phs_in_dt >= @[snd_year]||'0501' then a.flet_dck_svey_tp_cd else '' end) ym2_05
			,max(case when phs_out_dt <= @[snd_year]||'0631' and phs_in_dt >= @[snd_year]||'0601' then a.flet_dck_svey_tp_cd else '' end) ym2_06
			,max(case when phs_out_dt <= @[snd_year]||'0731' and phs_in_dt >= @[snd_year]||'0701' then a.flet_dck_svey_tp_cd else '' end) ym2_07
			,max(case when phs_out_dt <= @[snd_year]||'0831' and phs_in_dt >= @[snd_year]||'0801' then a.flet_dck_svey_tp_cd else '' end) ym2_08
			,max(case when phs_out_dt <= @[snd_year]||'0931' and phs_in_dt >= @[snd_year]||'0901' then a.flet_dck_svey_tp_cd else '' end) ym2_09
			,max(case when phs_out_dt <= @[snd_year]||'1031' and phs_in_dt >= @[snd_year]||'1001' then a.flet_dck_svey_tp_cd else '' end) ym2_10
			,max(case when phs_out_dt <= @[snd_year]||'1131' and phs_in_dt >= @[snd_year]||'1101' then a.flet_dck_svey_tp_cd else '' end) ym2_11
			,max(case when phs_out_dt <= @[snd_year]||'1231' and phs_in_dt >= @[snd_year]||'1201' then a.flet_dck_svey_tp_cd else '' end) ym2_12

			#end
			
			#if (${trd_year} != "")

			,max(case when phs_out_dt <= @[trd_year]||'0131' and phs_in_dt >= @[trd_year]||'0101' then a.flet_dck_svey_tp_cd else '' end) ym3_01
			,max(case when phs_out_dt <= @[trd_year]||'0231' and phs_in_dt >= @[trd_year]||'0201' then a.flet_dck_svey_tp_cd else '' end) ym3_02
			,max(case when phs_out_dt <= @[trd_year]||'0331' and phs_in_dt >= @[trd_year]||'0301' then a.flet_dck_svey_tp_cd else '' end) ym3_03
			,max(case when phs_out_dt <= @[trd_year]||'0431' and phs_in_dt >= @[trd_year]||'0401' then a.flet_dck_svey_tp_cd else '' end) ym3_04
			,max(case when phs_out_dt <= @[trd_year]||'0531' and phs_in_dt >= @[trd_year]||'0501' then a.flet_dck_svey_tp_cd else '' end) ym3_05
			,max(case when phs_out_dt <= @[trd_year]||'0631' and phs_in_dt >= @[trd_year]||'0601' then a.flet_dck_svey_tp_cd else '' end) ym3_06
			,max(case when phs_out_dt <= @[trd_year]||'0731' and phs_in_dt >= @[trd_year]||'0701' then a.flet_dck_svey_tp_cd else '' end) ym3_07
			,max(case when phs_out_dt <= @[trd_year]||'0831' and phs_in_dt >= @[trd_year]||'0801' then a.flet_dck_svey_tp_cd else '' end) ym3_08
			,max(case when phs_out_dt <= @[trd_year]||'0931' and phs_in_dt >= @[trd_year]||'0901' then a.flet_dck_svey_tp_cd else '' end) ym3_09
			,max(case when phs_out_dt <= @[trd_year]||'1031' and phs_in_dt >= @[trd_year]||'1001' then a.flet_dck_svey_tp_cd else '' end) ym3_10
			,max(case when phs_out_dt <= @[trd_year]||'1131' and phs_in_dt >= @[trd_year]||'1101' then a.flet_dck_svey_tp_cd else '' end) ym3_11
			,max(case when phs_out_dt <= @[trd_year]||'1231' and phs_in_dt >= @[trd_year]||'1201' then a.flet_dck_svey_tp_cd else '' end) ym3_12

			#end
		
		#else
		
			,max(case when dck_fm_dt <= last_day(to_date(@[fst_year]||'01','yyyymm')) and dck_to_dt >= to_date(@[fst_year]||'0101','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym1_01
			,max(case when dck_fm_dt <= last_day(to_date(@[fst_year]||'02','yyyymm')) and dck_to_dt >= to_date(@[fst_year]||'0201','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym1_02
			,max(case when dck_fm_dt <= last_day(to_date(@[fst_year]||'03','yyyymm')) and dck_to_dt >= to_date(@[fst_year]||'0301','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym1_03
			,max(case when dck_fm_dt <= last_day(to_date(@[fst_year]||'04','yyyymm')) and dck_to_dt >= to_date(@[fst_year]||'0401','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym1_04
			,max(case when dck_fm_dt <= last_day(to_date(@[fst_year]||'05','yyyymm')) and dck_to_dt >= to_date(@[fst_year]||'0501','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym1_05
			,max(case when dck_fm_dt <= last_day(to_date(@[fst_year]||'06','yyyymm')) and dck_to_dt >= to_date(@[fst_year]||'0601','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym1_06
			,max(case when dck_fm_dt <= last_day(to_date(@[fst_year]||'07','yyyymm')) and dck_to_dt >= to_date(@[fst_year]||'0701','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym1_07
			,max(case when dck_fm_dt <= last_day(to_date(@[fst_year]||'08','yyyymm')) and dck_to_dt >= to_date(@[fst_year]||'0801','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym1_08
			,max(case when dck_fm_dt <= last_day(to_date(@[fst_year]||'09','yyyymm')) and dck_to_dt >= to_date(@[fst_year]||'0901','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym1_09
			,max(case when dck_fm_dt <= last_day(to_date(@[fst_year]||'10','yyyymm')) and dck_to_dt >= to_date(@[fst_year]||'1001','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym1_10
			,max(case when dck_fm_dt <= last_day(to_date(@[fst_year]||'11','yyyymm')) and dck_to_dt >= to_date(@[fst_year]||'1101','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym1_11
			,max(case when dck_fm_dt <= last_day(to_date(@[fst_year]||'12','yyyymm')) and dck_to_dt >= to_date(@[fst_year]||'1201','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym1_12

			#if (${snd_year} != "")

			,max(case when dck_fm_dt <= last_day(to_date(@[snd_year]||'01','yyyymm')) and dck_to_dt >= to_date(@[snd_year]||'0101','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym2_01
			,max(case when dck_fm_dt <= last_day(to_date(@[snd_year]||'02','yyyymm')) and dck_to_dt >= to_date(@[snd_year]||'0201','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym2_02
			,max(case when dck_fm_dt <= last_day(to_date(@[snd_year]||'03','yyyymm')) and dck_to_dt >= to_date(@[snd_year]||'0301','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym2_03
			,max(case when dck_fm_dt <= last_day(to_date(@[snd_year]||'04','yyyymm')) and dck_to_dt >= to_date(@[snd_year]||'0401','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym2_04
			,max(case when dck_fm_dt <= last_day(to_date(@[snd_year]||'05','yyyymm')) and dck_to_dt >= to_date(@[snd_year]||'0501','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym2_05
			,max(case when dck_fm_dt <= last_day(to_date(@[snd_year]||'06','yyyymm')) and dck_to_dt >= to_date(@[snd_year]||'0601','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym2_06
			,max(case when dck_fm_dt <= last_day(to_date(@[snd_year]||'07','yyyymm')) and dck_to_dt >= to_date(@[snd_year]||'0701','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym2_07
			,max(case when dck_fm_dt <= last_day(to_date(@[snd_year]||'08','yyyymm')) and dck_to_dt >= to_date(@[snd_year]||'0801','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym2_08
			,max(case when dck_fm_dt <= last_day(to_date(@[snd_year]||'09','yyyymm')) and dck_to_dt >= to_date(@[snd_year]||'0901','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym2_09
			,max(case when dck_fm_dt <= last_day(to_date(@[snd_year]||'10','yyyymm')) and dck_to_dt >= to_date(@[snd_year]||'1001','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym2_10
			,max(case when dck_fm_dt <= last_day(to_date(@[snd_year]||'11','yyyymm')) and dck_to_dt >= to_date(@[snd_year]||'1101','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym2_11
			,max(case when dck_fm_dt <= last_day(to_date(@[snd_year]||'12','yyyymm')) and dck_to_dt >= to_date(@[snd_year]||'1201','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym2_12

			#end
			
			#if (${trd_year} != "")

			,max(case when dck_fm_dt <= last_day(to_date(@[trd_year]||'01','yyyymm')) and dck_to_dt >= to_date(@[trd_year]||'0101','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym3_01
			,max(case when dck_fm_dt <= last_day(to_date(@[trd_year]||'02','yyyymm')) and dck_to_dt >= to_date(@[trd_year]||'0201','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym3_02
			,max(case when dck_fm_dt <= last_day(to_date(@[trd_year]||'03','yyyymm')) and dck_to_dt >= to_date(@[trd_year]||'0301','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym3_03
			,max(case when dck_fm_dt <= last_day(to_date(@[trd_year]||'04','yyyymm')) and dck_to_dt >= to_date(@[trd_year]||'0401','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym3_04
			,max(case when dck_fm_dt <= last_day(to_date(@[trd_year]||'05','yyyymm')) and dck_to_dt >= to_date(@[trd_year]||'0501','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym3_05
			,max(case when dck_fm_dt <= last_day(to_date(@[trd_year]||'06','yyyymm')) and dck_to_dt >= to_date(@[trd_year]||'0601','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym3_06
			,max(case when dck_fm_dt <= last_day(to_date(@[trd_year]||'07','yyyymm')) and dck_to_dt >= to_date(@[trd_year]||'0701','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym3_07
			,max(case when dck_fm_dt <= last_day(to_date(@[trd_year]||'08','yyyymm')) and dck_to_dt >= to_date(@[trd_year]||'0801','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym3_08
			,max(case when dck_fm_dt <= last_day(to_date(@[trd_year]||'09','yyyymm')) and dck_to_dt >= to_date(@[trd_year]||'0901','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym3_09
			,max(case when dck_fm_dt <= last_day(to_date(@[trd_year]||'10','yyyymm')) and dck_to_dt >= to_date(@[trd_year]||'1001','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym3_10
			,max(case when dck_fm_dt <= last_day(to_date(@[trd_year]||'11','yyyymm')) and dck_to_dt >= to_date(@[trd_year]||'1101','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym3_11
			,max(case when dck_fm_dt <= last_day(to_date(@[trd_year]||'12','yyyymm')) and dck_to_dt >= to_date(@[trd_year]||'1201','yyyymmdd') then a.flet_dck_svey_tp_cd else '' end) ym3_12

			#end
		
		#end
		
		from fms_dck_skd a, fms_contract b,
			(select vsl_cd, flet_ctrt_no
			from (
					select vsl_cd, flet_ctrt_no, row_number() over(partition by vsl_cd order by flet_ctrt_no desc) row_num
					from fms_contract
					where flet_ctrt_tp_cd <> 'TO'
				)
			where row_num = 1
			union all
			select vsl_cd, flet_ctrt_no
			from (
					select vsl_cd, flet_ctrt_no, row_number() over(partition by vsl_cd order by flet_ctrt_no desc) row_num
					from fms_id_vsl a
					where not exists (select null from fms_contract where flet_ctrt_tp_cd <> 'TO' and vsl_cd = a.vsl_cd)
				)
			where row_num = 1
			) c,
			(select vsl_cd, slan_cd
			 from (
					select vsl_cd, slan_cd, vps_eta_dt, row_number() over(partition by vsl_cd order by vps_eta_dt desc) lane_num
					from vsk_vsl_port_skd
					where vps_eta_dt between to_date(@[fr_duration]||'0101','yyyymmdd') and to_date(@[to_duration]||'1231','yyyymmdd')
				)
			 where lane_num = 1) d

		#if (${ownr_seq} != "")
			 ,(select vndr_seq from mdm_vendor
			 	where flet_mgmt_ownr_vndr_seq = @[ownr_seq]) e
		#end

		where a.vsl_cd = c.vsl_cd(+)
		and   a.vsl_cd = d.vsl_cd(+)
		and   b.flet_ctrt_no(+) = c.flet_ctrt_no
		#if (${flet_ctrt_tp_cd} != "")
		and   b.flet_ctrt_tp_cd like @[flet_ctrt_tp_cd]||'%'
		#end
		#if (${vsl_dznd_capa_fr} != "")
		and   b.vsl_dznd_capa >= @[vsl_dznd_capa_fr]
		#end
		#if (${vsl_dznd_capa_to} != "")
		and   b.vsl_dznd_capa <= @[vsl_dznd_capa_to]
		#end
		
		#if (${lane_cd} != "")
		and   d.slan_cd like @[lane_cd]||'%'
		#end

		#if (${ownr_seq} != "")
		and   b.vndr_seq = e.vndr_seq
		#end
		and	  a.vsl_cd like @[vsl_cd]||'%'
		and   a.dck_sel_cd = 'E'
		and   a.flet_dck_svey_tp_cd like @[flet_dck_svey_tp_cd]||'%'
		
		#if (${reflection_cd} == "I")
		
		and a.phs_out_dt <= @[to_duration]||'1231' and a.phs_in_dt >= @[fr_duration]
		
		#else
		
		and a.dck_fm_dt <= to_date(@[to_duration]||'1231','yyyymmdd') and a.dck_to_dt >= to_date(@[fr_duration]||'0101','yyyymmdd')
		
		#end
group by a.vsl_cd,
		d.slan_cd,
		b.vsl_dznd_capa			]]></sql>
			<params>
				<param name="fst_year" type="12" value="" out="N"/>
				<param name="snd_year" type="12" value="" out="N"/>
				<param name="trd_year" type="12" value="" out="N"/>
				<param name="fr_duration" type="12" value="" out="N"/>
				<param name="to_duration" type="12" value="" out="N"/>
				<param name="ownr_seq" type="12" value="" out="N"/>
				<param name="flet_ctrt_tp_cd" type="12" value="" out="N"/>
				<param name="vsl_dznd_capa_fr" type="12" value="" out="N"/>
				<param name="vsl_dznd_capa_to" type="12" value="" out="N"/>
				<param name="lane_cd" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="flet_dck_svey_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
