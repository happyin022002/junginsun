<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOInvoiceDBDAOSearchNewOwnerAccountListRSQL">
			<desc><![CDATA[[ESM_FMS_0097] (New) Owner's Account : Retrieve]]></desc>
			<sql><![CDATA[
SELECT NVL(A.OA_STL_STS_CD, 'BL') OA_STL_STS_CD, 
       (SELECT COUNT(F.FILE_SAV_ID) CNT
        FROM FMS_OWNR_ACCT_ATCH_FILE F
        WHERE 1 = 1
          AND F.ATCH_FILE_OA_LNK_ID = A.SLP_TP_CD||A.SLP_FUNC_CD||A.SLP_OFC_CD||A.SLP_ISS_DT||A.SLP_SER_NO||A.SLP_SEQ_NO
        ) ATTACH,
       
       (SELECT I.ACCT_ITM_NM
        FROM FMS_ACCT_ITM I 
        WHERE 1 = 1
          AND I.ACCT_CD = '962111'
          AND A.ACCT_ITM_SEQ = I.ACCT_ITM_SEQ) ACCT_ITM_NM,
        
       A.ACCT_CD,
       C.OA_LOC_CD,
       A.ACCT_ITM_SEQ,
       
       A.AP_DESC,
       A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD||A.REV_DIR_CD VVD,
       A.N1ST_AMT USD_AMT,
       A.N2ND_CURR_CD LCL,
       A.N2ND_AMT AMOUNT,
       
       A.SLP_TP_CD||A.SLP_FUNC_CD||A.SLP_OFC_CD||A.SLP_ISS_DT||A.SLP_SER_NO||A.SLP_SEQ_NO CSR_SLIP_NO,
	   A.SLP_TP_CD||A.SLP_FUNC_CD||A.SLP_OFC_CD||A.SLP_ISS_DT||A.SLP_SER_NO||A.SLP_SEQ_NO COND_CSR_SLIP_NO,

       A.EFF_DT,
          
       A.LOCL_XCH_RT_AMT EX_RATE,
       
      A.PAIR_SLP_TP_CD||A.PAIR_SLP_FUNC_CD||A.PAIR_SLP_OFC_CD||A.PAIR_SLP_ISS_DT||A.PAIR_SLP_SER_NO||A.PAIR_SLP_SEQ_NO MATCHING_CSR_SLIP_NO,

       (SELECT D.OA_INTER_MM_DESC
        FROM FMS_CONSULTATION D
        WHERE 1 = 1
          AND D.SLP_TP_CD = A.SLP_TP_CD
          AND D.SLP_FUNC_CD = A.SLP_FUNC_CD
          AND D.SLP_OFC_CD = A.SLP_OFC_CD
          AND D.SLP_ISS_DT = A.SLP_ISS_DT
          AND D.SLP_SER_NO = A.SLP_SER_NO) INTERNAL_MEMO,
          
       (SELECT C.PPAY_HIR_NO
        FROM FMS_CONSULTATION C
        WHERE 1 = 1
          AND A.CSUL_SLP_TP_CD = C.SLP_TP_CD
          AND A.CSUL_SLP_FUNC_CD = C.SLP_FUNC_CD
          AND A.CSUL_SLP_OFC_CD = C.SLP_OFC_CD
          AND A.CSUL_SLP_ISS_DT = C.SLP_ISS_DT
          AND A.CSUL_SLP_SER_NO = C.SLP_SER_NO) PPAY_HIR_NO

       ,'' USR_ID,A.VSL_CD,A.SKD_VOY_NO,A.SKD_DIR_CD,A.REV_DIR_CD
FROM FMS_OWNR_ACCT_SLP A,
     FMS_CSUL_SLP C
WHERE 1 = 1
  AND A.SLP_TP_CD = C.SLP_TP_CD(+)
  AND A.SLP_FUNC_CD = C.SLP_FUNC_CD(+)
  AND A.SLP_OFC_CD = C.SLP_OFC_CD(+)
  AND A.SLP_ISS_DT = C.SLP_ISS_DT(+)
  AND A.SLP_SER_NO = C.SLP_SER_NO(+)
  AND A.SLP_SEQ_NO = C.SLP_SEQ_NO(+)
  AND A.ACCT_CD = '111071'
  AND SUBSTR(A.EFF_DT, 1, 6) BETWEEN @[eff_dt1]  AND @[eff_dt2]

#if(${vsl_cd} != '')
  AND A.VSL_CD = @[vsl_cd]
#end

#if(${vel_acct_itm_seq} != '') 
  AND A.ACCT_ITM_SEQ IN 
(
  #foreach($vel_acct_itm_seq IN ${list_acct_itm_seq})
    #if($list_acct_itm_seq.hasNext()) '$vel_acct_itm_seq', #else '$vel_acct_itm_seq' #end
  #end
)
#end

#if(${loc_cd} != '')
  AND C.OA_LOC_CD = @[loc_cd]
#end


#if(${vel_cmb_sttlmnt} != '')
  AND NVL(A.OA_STL_STS_CD, 'BL') IN
(
  #foreach($vel_cmb_sttlmnt IN ${list_cmb_settlmnt})
    #if($list_cmb_settlmnt.hasNext()) '$vel_cmb_sttlmnt', #else '$vel_cmb_sttlmnt' #end
  #end
)
#end			]]></sql>
			<params>
				<param name="eff_dt1" type="12" value="" out="N"/>
				<param name="eff_dt2" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
