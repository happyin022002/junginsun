<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SpecialCargoReceiptDBDAODgCgoListVORSQL">
			<desc><![CDATA[DgCgoListVO]]></desc>
			<sql><![CDATA[
#if (${ca_flg}== 'Y')

SELECT
A.IMDG_COMP_GRP_CD
,	A.CNTR_VOL_QTY
,	A.IMDG_SUBS_RSK_LBL_CD4
,	A.BKG_NO
,	A.DCGO_SEQ
,	DENSE_RANK() OVER (PARTITION BY A.BKG_NO ORDER BY A.DG_CNTR_SEQ) AS DG_CNTR_SEQ
,   A.DG_CNTR_SEQ AS DG_CNTR_SEQ2
,	ROW_NUMBER() OVER (PARTITION BY A.BKG_NO, A.DG_CNTR_SEQ ORDER BY A.DG_CNTR_SEQ, A.CNTR_CGO_SEQ) AS CNTR_CGO_SEQ
,	A.CNTR_NO
,	A.CNTR_TPSZ_CD
,	A.IMDG_UN_NO
,	A.IMDG_UN_NO_SEQ
,   (  SELECT   SUBSTR(XMLAGG(XMLELEMENT(X, '/' || IMDG_SPCL_PROVI_NO) ORDER BY DP_SEQ).EXTRACT('//text()'), 2)
       FROM     SCG_IMDG_UN_NO_SPCL_PROVI
       WHERE 	IMDG_UN_NO  = A.IMDG_UN_NO 
       AND 	    IMDG_UN_NO_SEQ = A.IMDG_UN_NO_SEQ
       GROUP BY IMDG_UN_NO, IMDG_UN_NO_SEQ
    ) SPCL_PROVI_NO
,	A.IMDG_CLSS_CD
,	A.IMDG_SUBS_RSK_LBL_CD1
,	A.IMDG_SUBS_RSK_LBL_CD2
,	A.IMDG_SUBS_RSK_LBL_CD3
,	A.IMDG_LMT_QTY_FLG
,	A.IMDG_EXPT_QTY_FLG
,	A.NET_WGT
,	A.GRS_WGT
,	A.WGT_UT_CD
,	A.FLSH_PNT_CDO_TEMP
,	A.PRP_SHP_NM
,	A.HZD_DESC
,	A.HZD_CTNT
,   (
       SELECT   SUBSTR(XMLAGG(XMLELEMENT(NM, '|' || M.IMDG_SEGR_GRP_NM) ORDER BY M.IMDG_SEGR_GRP_NO).EXTRACT('//text()'), 2)
       FROM     SCG_IMDG_SEGR_GRP_DTL D
               ,SCG_IMDG_SEGR_GRP M
       WHERE    1 = 1
       AND      D.IMDG_SEGR_GRP_NO = M.IMDG_SEGR_GRP_NO
       AND      D.IMDG_UN_NO = A.IMDG_UN_NO
    ) DFLT_SEGR_GRP_NM
,	A.STWG_TEMP_CTNT
,	A.MEAS_QTY
,	A.MEAS_UT_CD
,	A.CLOD_FLG
,	A.SPCL_STWG_RQST_DESC
,	A.DCGO_STS_CD
,	A.CGO_LCL_FLG
,	A.EMER_CNTC_PHN_NO_CTNT
,	A.EMER_CNTC_PSON_NM
,	A.DCGO_RQST_GRP_EML1
,	A.DCGO_RQST_GRP_EML2
,	A.EMER_TEMP_CTNT
,	A.CTRL_TEMP_CTNT
,	A.EMS_NO
,	A.EMER_RSPN_GID_NO
,	A.EMER_RSPN_GID_CHR_NO
,	A.IMDG_PCK_GRP_CD
,	A.MRN_POLUT_FLG
,	A.PSA_NO
,	A.CERTI_NO
,	A.IN_IMDG_PCK_QTY1
,	A.IN_IMDG_PCK_CD1
,	A.IN_IMDG_PCK_QTY2
,	A.IN_IMDG_PCK_CD2
,	A.INTMD_IMDG_PCK_QTY1
,	A.INTMD_IMDG_PCK_CD1
,	A.INTMD_IMDG_PCK_QTY2
,	A.INTMD_IMDG_PCK_CD2
,	A.OUT_IMDG_PCK_QTY1
,	A.OUT_IMDG_PCK_CD1
,	A.OUT_IMDG_PCK_QTY2
,	A.OUT_IMDG_PCK_CD2
,	'0' MAX_IN_PCK_QTY
,	A.MAX_IN_PCK_TP_CD
,	A.CNEE_DTL_DESC
,	A.NET_EXPLO_WGT
,	A.RADA_SKD_NO
,	A.RADA_AMT
,	A.RADA_UT_CD
,	A.RADA_TRSP_NO
,	A.RC_FLG
,	A.AWK_CGO_FLG
,	A.BB_CGO_FLG
,	A.RC_SEQ
,	A.AWK_CGO_SEQ
,	A.BB_CGO_SEQ
,	A.HCDG_FLG
,	A.HCDG_DPND_QTY_FLG
,	A.RQST_DT
,	A.RQST_USR_ID
,   (SELECT M.APRO_REF_NO 
       FROM SCG_AUTHORIZATION M 
           ,(SELECT MAX(SPCL_CGO_APRO_RQST_SEQ) SPCL_CGO_APRO_RQST_SEQ
                  , MIN(VSL_PRE_PST_CD||VSL_SEQ) VSL_PRE_PST_CD
                  , MAX(SPCL_CGO_AUTH_SEQ) AS SPCL_CGO_AUTH_SEQ
                  , DCGO_SEQ
              FROM SCG_AUTHORIZATION 
             WHERE BKG_NO = @[bkg_no]
               AND SPCL_CGO_CATE_CD = 'DG'
             GROUP BY DCGO_SEQ) N 
      WHERE M.SPCL_CGO_APRO_RQST_SEQ = N.SPCL_CGO_APRO_RQST_SEQ 
        AND M.VSL_PRE_PST_CD||M.VSL_SEQ = N.VSL_PRE_PST_CD 
        AND M.SPCL_CGO_AUTH_SEQ = N.SPCL_CGO_AUTH_SEQ
        AND M.DCGO_SEQ = N.DCGO_SEQ
        AND M.BKG_NO = @[bkg_no]
        AND M.DCGO_SEQ = A.DCGO_SEQ) APLY_NO
,	A.SPCL_CGO_APRO_CD
,	A.DIFF_RMK
,	A.CRE_USR_ID
,	A.CRE_DT
,	A.UPD_USR_ID
,	A.UPD_DT
,	A.SPCL_RQST_FLG
,	A.SPCL_RQST_DESC
,   B.POR_CD
,   B.DEL_CD
,   B.RCV_TERM_CD
,   B.DE_TERM_CD
,   (SELECT substr(CNTR_TPSZ_DESC, 1, 4) from mdm_cntr_tp_sz where cntr_tpsz_cd = A.CNTR_TPSZ_CD) EQ_TPSZ
,   (SELECT IMDG_PCK_DESC FROM SCG_IMDG_PCK_CD WHERE IMDG_PCK_CD = IN_IMDG_PCK_CD1) IN_IMDG_PCK_DESC1
,   (SELECT IMDG_PCK_DESC FROM SCG_IMDG_PCK_CD WHERE IMDG_PCK_CD = IN_IMDG_PCK_CD2) IN_IMDG_PCK_DESC2
,   (SELECT IMDG_PCK_DESC FROM SCG_IMDG_PCK_CD WHERE IMDG_PCK_CD = INTMD_IMDG_PCK_CD1) INTMD_IMDG_PCK_DESC1
,   (SELECT IMDG_PCK_DESC FROM SCG_IMDG_PCK_CD WHERE IMDG_PCK_CD = INTMD_IMDG_PCK_CD2) INTMD_IMDG_PCK_DESC2
,   (SELECT IMDG_PCK_DESC FROM SCG_IMDG_PCK_CD WHERE IMDG_PCK_CD = OUT_IMDG_PCK_CD1) OUT_IMDG_PCK_DESC1
,   (SELECT IMDG_PCK_DESC FROM SCG_IMDG_PCK_CD WHERE IMDG_PCK_CD = OUT_IMDG_PCK_CD2) OUT_IMDG_PCK_DESC2
,   (SELECT IMDG_SPCL_PROVI_NO FROM SCG_IMDG_UN_NO_SPCL_PROVI WHERE IMDG_UN_NO = A.IMDG_UN_NO AND IMDG_UN_NO_SEQ = A.IMDG_UN_NO_SEQ AND IMDG_SPCL_PROVI_NO = '274') IMDG_SPCL_PROVI_NO
,   (SELECT A3.IMDG_CRR_RSTR_EXPT_CD FROM BKG_VVD A1, MDM_VSL_CNTR A2, SCG_IMDG_CRR_RSTR A3 WHERE A1.VSL_CD = A2.VSL_CD AND A1.BKG_NO = @[bkg_no] AND A2.CRR_CD = A3.VSL_OPR_TP_CD AND A3.IMDG_CRR_RSTR_EXPT_CD = 'R' AND C.IMDG_UN_NO = NVL(A3.IMDG_UN_NO, C.IMDG_UN_NO) AND C.IMDG_UN_NO_SEQ  = NVL(A3.IMDG_UN_NO_SEQ , C.IMDG_UN_NO_SEQ) AND C.IMDG_CLSS_CD = NVL(A3.IMDG_CLSS_CD,C.IMDG_CLSS_CD) AND ROWNUM =1) IMDG_CRR_RSTR_EXPT_CD 
,	C.HCDG_PCK_RSTR_DESC
,   C.HCDG_INTMD_BC_RSTR_DESC
,   C.HCDG_TNK_RSTR_DESC
,   C.IMDG_MRN_POLUT_CD
,	C.IMDG_EXPT_QTY_CD
,   CONCAT(C.IMDG_LMT_QTY, C.IMDG_LMT_QTY_MEAS_UT_CD) LTD_QTY
,	A.GRS_CAPA_QTY
,   (SELECT '1'
		FROM BKG_BKG_HIS B
			,MDM_LOCATION L1
			,MDM_LOCATION L2
			,MDM_LOCATION L3
			,MDM_LOCATION L4
		WHERE B.BKG_NO = A.BKG_NO
		AND B.CORR_NO = 'TMP0000001'
		AND B.POR_CD = L1.LOC_CD
		AND B.POL_CD = L2.LOC_CD
		AND B.POD_CD = L3.LOC_CD
		AND B.DEL_CD = L4.LOC_CD
		AND (
				(
					(L1.CONTI_CD = 'E' OR L2.CONTI_CD = 'E')
				AND (   B.RCV_TERM_CD IN ('D','H')
					OR (    B.POR_CD <> B.POL_CD
						AND NVL(L1.CALL_PORT_FLG, 'N') <> 'Y'
						)
					)
				)
				OR (
					(L3.CONTI_CD = 'E' OR L4.CONTI_CD = 'E')
					AND (  B.DE_TERM_CD IN ('D','H')
						OR (    B.POD_CD <> B.DEL_CD
							AND NVL(L4.CALL_PORT_FLG, 'N') <> 'Y'
							)							
						)
					)
				)
			) HCDG_QTY
FROM 	BKG_DG_CGO_HIS A, BKG_BKG_HIS B, SCG_IMDG_UN_NO C
WHERE	A.BKG_NO = @[bkg_no]
AND A.CORR_NO = 'TMP0000001'
AND	A.BKG_NO = B.BKG_NO
AND A.CORR_NO = B.CORR_NO
AND A.IMDG_UN_NO = C.IMDG_UN_NO(+)
AND A.IMDG_UN_NO_SEQ =  C.IMDG_UN_NO_SEQ(+)


#else

SELECT
A.IMDG_COMP_GRP_CD
,	A.CNTR_VOL_QTY
,	A.IMDG_SUBS_RSK_LBL_CD4
,	A.BKG_NO
,	A.DCGO_SEQ
,	DENSE_RANK() OVER (PARTITION BY A.BKG_NO ORDER BY A.DG_CNTR_SEQ) AS DG_CNTR_SEQ
,	A.DG_CNTR_SEQ AS DG_CNTR_SEQ2
,	ROW_NUMBER() OVER (PARTITION BY A.BKG_NO, A.DG_CNTR_SEQ ORDER BY A.DG_CNTR_SEQ, A.CNTR_CGO_SEQ) AS CNTR_CGO_SEQ
,	A.CNTR_NO
,	A.CNTR_TPSZ_CD
,	A.IMDG_UN_NO
,	A.IMDG_UN_NO_SEQ
,   (SELECT 	 SUBSTR(XMLAGG(XMLELEMENT(X, '/' || IMDG_SPCL_PROVI_NO) ORDER BY DP_SEQ).EXTRACT('//text()'), 2)
                FROM     SCG_IMDG_UN_NO_SPCL_PROVI
                WHERE 	 IMDG_UN_NO  = A.IMDG_UN_NO
                AND 	 IMDG_UN_NO_SEQ = A.IMDG_UN_NO_SEQ
                GROUP BY IMDG_UN_NO, IMDG_UN_NO_SEQ
    ) SPCL_PROVI_NO
,	A.IMDG_CLSS_CD
,	A.IMDG_SUBS_RSK_LBL_CD1
,	A.IMDG_SUBS_RSK_LBL_CD2
,	A.IMDG_SUBS_RSK_LBL_CD3
,	A.IMDG_LMT_QTY_FLG
,	A.IMDG_EXPT_QTY_FLG
,	A.NET_WGT
,	A.GRS_WGT
,	A.WGT_UT_CD
,	A.FLSH_PNT_CDO_TEMP
,	A.PRP_SHP_NM
,	A.HZD_DESC
,	A.HZD_CTNT
,   (
       SELECT   SUBSTR(XMLAGG(XMLELEMENT(NM, '|' || M.IMDG_SEGR_GRP_NM) ORDER BY M.IMDG_SEGR_GRP_NO).EXTRACT('//text()'), 2)
       FROM     SCG_IMDG_SEGR_GRP_DTL D
               ,SCG_IMDG_SEGR_GRP M
       WHERE    1 = 1
       AND      D.IMDG_SEGR_GRP_NO = M.IMDG_SEGR_GRP_NO
       AND      D.IMDG_UN_NO = A.IMDG_UN_NO
    ) DFLT_SEGR_GRP_NM
,	A.STWG_TEMP_CTNT
,	A.MEAS_QTY
,	A.MEAS_UT_CD
,	A.CLOD_FLG
,	A.SPCL_STWG_RQST_DESC
,	A.DCGO_STS_CD
,	A.CGO_LCL_FLG
,	A.EMER_CNTC_PHN_NO_CTNT
,	A.EMER_CNTC_PSON_NM
,	A.DCGO_RQST_GRP_EML1
,	A.DCGO_RQST_GRP_EML2
,	A.EMER_TEMP_CTNT
,	A.CTRL_TEMP_CTNT
,	A.EMS_NO
,	A.EMER_RSPN_GID_NO
,	A.EMER_RSPN_GID_CHR_NO
,	A.IMDG_PCK_GRP_CD
,	A.MRN_POLUT_FLG
,	A.PSA_NO
,	A.CERTI_NO
,	A.IN_IMDG_PCK_QTY1
,	A.IN_IMDG_PCK_CD1
,	A.IN_IMDG_PCK_QTY2
,	A.IN_IMDG_PCK_CD2
,	A.INTMD_IMDG_PCK_QTY1
,	A.INTMD_IMDG_PCK_CD1
,	A.INTMD_IMDG_PCK_QTY2
,	A.INTMD_IMDG_PCK_CD2
,	A.OUT_IMDG_PCK_QTY1
,	A.OUT_IMDG_PCK_CD1
,	A.OUT_IMDG_PCK_QTY2
,	A.OUT_IMDG_PCK_CD2
,	'0' MAX_IN_PCK_QTY
,	A.MAX_IN_PCK_TP_CD
,	A.CNEE_DTL_DESC
,	A.NET_EXPLO_WGT
,	A.RADA_SKD_NO
,	A.RADA_AMT
,	A.RADA_UT_CD
,	A.RADA_TRSP_NO
,	A.RC_FLG
,	A.AWK_CGO_FLG
,	A.BB_CGO_FLG
,	A.RC_SEQ
,	A.AWK_CGO_SEQ
,	A.BB_CGO_SEQ
,	A.HCDG_FLG
,	A.HCDG_DPND_QTY_FLG
,	A.RQST_DT
,	A.RQST_USR_ID
,   (SELECT M.APRO_REF_NO 
       FROM SCG_AUTHORIZATION M 
           ,(SELECT MAX(SPCL_CGO_APRO_RQST_SEQ) SPCL_CGO_APRO_RQST_SEQ
                  , MIN(VSL_PRE_PST_CD||VSL_SEQ) VSL_PRE_PST_CD
                  , MAX(SPCL_CGO_AUTH_SEQ) AS SPCL_CGO_AUTH_SEQ
                  , DCGO_SEQ
              FROM SCG_AUTHORIZATION 
             WHERE BKG_NO = @[bkg_no] 
               AND SPCL_CGO_CATE_CD = 'DG'
             GROUP BY DCGO_SEQ) N 
      WHERE M.SPCL_CGO_APRO_RQST_SEQ = N.SPCL_CGO_APRO_RQST_SEQ 
        AND M.VSL_PRE_PST_CD||M.VSL_SEQ = N.VSL_PRE_PST_CD 
        AND M.SPCL_CGO_AUTH_SEQ = N.SPCL_CGO_AUTH_SEQ
        AND M.DCGO_SEQ = N.DCGO_SEQ
        AND M.BKG_NO = @[bkg_no]
        AND M.DCGO_SEQ = A.DCGO_SEQ) APLY_NO
,	A.SPCL_CGO_APRO_CD
,	A.DIFF_RMK
,	A.CRE_USR_ID
,	A.CRE_DT
,	A.UPD_USR_ID
,	A.UPD_DT
,	A.SPCL_RQST_FLG
,	A.SPCL_RQST_DESC
,   B.POR_CD
,   B.DEL_CD
,   B.RCV_TERM_CD
,   B.DE_TERM_CD
,   (SELECT substr(CNTR_TPSZ_DESC, 1, 4) from mdm_cntr_tp_sz where cntr_tpsz_cd = A.CNTR_TPSZ_CD) EQ_TPSZ
,   (SELECT IMDG_PCK_DESC FROM SCG_IMDG_PCK_CD WHERE IMDG_PCK_CD = IN_IMDG_PCK_CD1) IN_IMDG_PCK_DESC1
,   (SELECT IMDG_PCK_DESC FROM SCG_IMDG_PCK_CD WHERE IMDG_PCK_CD = IN_IMDG_PCK_CD2) IN_IMDG_PCK_DESC2
,   (SELECT IMDG_PCK_DESC FROM SCG_IMDG_PCK_CD WHERE IMDG_PCK_CD = INTMD_IMDG_PCK_CD1) INTMD_IMDG_PCK_DESC1
,   (SELECT IMDG_PCK_DESC FROM SCG_IMDG_PCK_CD WHERE IMDG_PCK_CD = INTMD_IMDG_PCK_CD2) INTMD_IMDG_PCK_DESC2
,   (SELECT IMDG_PCK_DESC FROM SCG_IMDG_PCK_CD WHERE IMDG_PCK_CD = OUT_IMDG_PCK_CD1) OUT_IMDG_PCK_DESC1
,   (SELECT IMDG_PCK_DESC FROM SCG_IMDG_PCK_CD WHERE IMDG_PCK_CD = OUT_IMDG_PCK_CD2) OUT_IMDG_PCK_DESC2
,   (SELECT IMDG_SPCL_PROVI_NO FROM SCG_IMDG_UN_NO_SPCL_PROVI WHERE IMDG_UN_NO = A.IMDG_UN_NO AND IMDG_UN_NO_SEQ = A.IMDG_UN_NO_SEQ AND IMDG_SPCL_PROVI_NO = '274') IMDG_SPCL_PROVI_NO
,   (SELECT A2.CRR_CD FROM BKG_VVD A1, MDM_VSL_CNTR A2, SCG_IMDG_CRR_RSTR A3 WHERE A1.VSL_CD = A2.VSL_CD AND A1.BKG_NO = @[bkg_no] AND A2.CRR_CD = A3.VSL_OPR_TP_CD AND A3.IMDG_CRR_RSTR_EXPT_CD = 'R' AND C.IMDG_UN_NO = NVL(A3.IMDG_UN_NO, C.IMDG_UN_NO) AND C.IMDG_UN_NO_SEQ  = NVL(A3.IMDG_UN_NO_SEQ , C.IMDG_UN_NO_SEQ) AND C.IMDG_CLSS_CD = NVL(A3.IMDG_CLSS_CD,C.IMDG_CLSS_CD) AND ROWNUM =1) CRR_CD
,   C.HCDG_PCK_RSTR_DESC
,   C.HCDG_INTMD_BC_RSTR_DESC
,   C.HCDG_TNK_RSTR_DESC
,   C.IMDG_MRN_POLUT_CD
,	C.IMDG_EXPT_QTY_CD
,	A.GRS_CAPA_QTY
,   CONCAT(C.IMDG_LMT_QTY, C.IMDG_LMT_QTY_MEAS_UT_CD) LTD_QTY
,   (SELECT '1'
		FROM BKG_BOOKING B
			,MDM_LOCATION L1
			,MDM_LOCATION L2
			,MDM_LOCATION L3
			,MDM_LOCATION L4
		WHERE B.BKG_NO = A.BKG_NO
		AND B.POR_CD = L1.LOC_CD
		AND B.POL_CD = L2.LOC_CD
		AND B.POD_CD = L3.LOC_CD
		AND B.DEL_CD = L4.LOC_CD
		AND (
				(
					(L1.CONTI_CD = 'E' OR L2.CONTI_CD = 'E')
				AND (   B.RCV_TERM_CD IN ('D','H')
					OR (    B.POR_CD <> B.POL_CD
						AND NVL(L1.CALL_PORT_FLG, 'N') <> 'Y'
					)
				)
			)
			OR (
				(L3.CONTI_CD = 'E' OR L4.CONTI_CD = 'E')
					AND (  B.DE_TERM_CD IN ('D','H')
						OR (    B.POD_CD <> B.DEL_CD
							AND NVL(L4.CALL_PORT_FLG, 'N') <> 'Y'
						)
					)
				)
			)
) HCDG_QTY
FROM 	BKG_DG_CGO A, BKG_BOOKING B, SCG_IMDG_UN_NO C
WHERE	A.BKG_NO = @[bkg_no]
AND	A.BKG_NO = B.BKG_NO
AND A.IMDG_UN_NO = C.IMDG_UN_NO(+)
AND A.IMDG_UN_NO_SEQ =  C.IMDG_UN_NO_SEQ(+)


#end			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
