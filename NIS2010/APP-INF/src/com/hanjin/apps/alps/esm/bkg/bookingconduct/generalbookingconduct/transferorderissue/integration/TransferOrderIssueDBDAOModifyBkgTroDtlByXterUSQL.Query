<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TransferOrderIssueDBDAOModifyBkgTroDtlByXterUSQL">
			<desc><![CDATA[TransferOrderIssueDBDAOModifyBkgTroDtlByXterUSQL]]></desc>
			<sql><![CDATA[
UPDATE BKG_TRO_DTL SET 
	CNTR_TPSZ_CD = @[cntr_tpsz_cd]
,	TRO_QTY      = @[tro_qty]
#if (${dor_arr_dt} != '') 
,	DOR_ARR_DT = TO_DATE(@[dor_arr_dt], 'YYYY-MM-DD HH24:MI') 
#else 
,	DOR_ARR_DT = @[dor_arr_dt]
#end
,	PKUP_LOC_CD = nvl(@[pkup_loc_cd], (select substr(MTY_PKUP_YD_CD, 1, 5) from bkg_booking where bkg_no = @[bkg_no]))

#if (${pkup_yd_cd} != '') 
,	PKUP_YD_CD = @[pkup_loc_cd]||@[pkup_yd_cd]
#else 
,	PKUP_YD_CD = nvl(@[pkup_yd_cd], (select MTY_PKUP_YD_CD from bkg_booking where bkg_no = @[bkg_no]))
#end
,	RTN_LOC_CD = nvl(@[rtn_loc_cd], (select substr(FULL_RTN_YD_CD, 1, 5) from bkg_booking where bkg_no = @[bkg_no]))

#if (${rtn_yd_cd} != '') 
,	RTN_YD_CD = @[rtn_loc_cd]||@[rtn_yd_cd]
#else 
,	RTN_YD_CD = nvl(@[rtn_yd_cd], (select FULL_RTN_YD_CD from bkg_booking where bkg_no = @[bkg_no]))
#end

--,	CNTR_NO
--,	CMDT_CD
--,	PCTL_NO
,	UPD_USR_ID = @[upd_usr_id]
,	UPD_DT = sysdate 
WHERE BKG_NO      = @[bkg_no]
  AND IO_BND_CD   = 'O'
  AND RTN_TRO_FLG = 'N'
  AND TRO_SEQ     = @[tro_seq]
  AND TRO_SUB_SEQ = @[tro_sub_seq]
  AND TRO_SEQ IN (SELECT TRO_SEQ 
					FROM BKG_TRO 
				   WHERE BKG_NO      = @[bkg_no]
					 AND IO_BND_CD   = 'O'
					 AND RTN_TRO_FLG = 'N'
					 AND TRO_SEQ     = @[tro_seq]
					 AND NVL(CXL_FLG, 'N') = 'N')			]]></sql>
			<params>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="tro_qty" type="12" value="" out="N"/>
				<param name="dor_arr_dt" type="12" value="" out="N"/>
				<param name="pkup_loc_cd" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="pkup_yd_cd" type="12" value="" out="N"/>
				<param name="rtn_loc_cd" type="12" value="" out="N"/>
				<param name="rtn_yd_cd" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="tro_seq" type="12" value="" out="N"/>
				<param name="tro_sub_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
