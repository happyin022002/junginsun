<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ModelManageDBDAOSearchSMPCustHistoryRSQL">
			<desc><![CDATA[Customer History 를 조회한다.
[CHM-201322502-01] SPC 프로젝트 - 성수기 선복운영 개선을 위한 T/F추진
2014.02.04 [CHM-201428383-01] RFA 로직 추가]]></desc>
			<sql><![CDATA[
SELECT MODI_GDT,
       MODI_USR_ID,
       MODI_USR_NM,
       VER_SEQ,
       CNG_ITM_NM,
       CUST_GRP_ID,
       CUST_GRP_NM,
       CUST_CD,
       CUST_NM,
       SC_NO,
       RFA_NO,
       WK_MQC_QTY,
       CUST_CTRL_CD,
       OLD_CUST_GRP_ID,
       OLD_CUST_GRP_NM,
       OLD_CUST_CD,
       OLD_CUST_NM,
       OLD_SC_NO,
       OLD_RFA_NO,
       OLD_WK_MQC_QTY,
       OLD_CUST_CTRL_CD
  FROM (
        SELECT TO_CHAR(MODI_GDT, 'YYYY-MM-DD HH24:MI:SS')         AS MODI_GDT   ,
               DECODE(MODI_USR_ID, 'SYSTEM', '', MODI_USR_ID)     AS MODI_USR_ID,
               DECODE(MODI_USR_ID, 'SYSTEM', '', (SELECT USR_NM
                                                    FROM COM_USER
                                                   WHERE USR_ID = MODI_USR_ID)) AS MODI_USR_NM,
               VER_SEQ                                                          ,
               CNG_ITM_NM                                                       ,
               H.CUST_GRP_ID                                                    ,
               (SELECT CUST_GRP_NM                  	      	
                  FROM MDM_CUST_PERF_GRP            	      	
                 WHERE CUST_GRP_ID = H.CUST_GRP_ID) 	          AS CUST_GRP_NM,
               H.CUST_CNT_CD||TO_CHAR(H.CUST_SEQ, 'FM000000')     AS CUST_CD    ,
               C1.CUST_LGL_ENG_NM                      	          AS CUST_NM    ,       
               SC_NO                                                            ,
               RFA_NO                                                           ,
               WK_MQC_QTY                                                       ,
               CUST_CTRL_CD                                                     ,
               OLD_CUST_GRP_ID                                                  ,
               (SELECT CUST_GRP_NM                  	      	   
                  FROM MDM_CUST_PERF_GRP            	      	
                 WHERE CUST_GRP_ID = H.OLD_CUST_GRP_ID) 	      AS OLD_CUST_GRP_NM,
               OLD_CUST_CNT_CD||TO_CHAR(OLD_CUST_SEQ, 'FM000000') AS OLD_CUST_CD    ,
               C2.CUST_LGL_ENG_NM                      	          AS OLD_CUST_NM    ,       
               OLD_SC_NO                                                        ,
               OLD_RFA_NO                                                       ,
               OLD_WK_MQC_QTY                                                   ,
               OLD_CUST_CTRL_CD
          FROM SPC_MDL_CUST_CTRL_HIS H ,
               MDM_CUSTOMER          C1,
               MDM_CUSTOMER          C2
         WHERE TRD_CD        = @[trade]
           AND COST_YRWK     = @[season] 
        #if(${version} != '')
           AND VER_SEQ       = @[version]
        #end
        #if(${acct_cd} != '')
           AND H.CUST_CNT_CD||TO_CHAR(H.CUST_SEQ, 'FM000000') IN (${acct_cd})
        #end
        #if(${grp_acct} != '')
           AND H.CUST_GRP_ID   IN (${grp_acct})
        #end
           AND H.CUST_CNT_CD     = C1.CUST_CNT_CD(+)
           AND H.CUST_SEQ        = C1.CUST_SEQ   (+)
           AND H.OLD_CUST_CNT_CD = C2.CUST_CNT_CD(+)
           AND H.OLD_CUST_SEQ    = C2.CUST_SEQ   (+)
        )
 ORDER BY MODI_GDT DESC,
          CUST_GRP_NM, 
          CUST_NM, 
          SC_NO,
          RFA_NO			]]></sql>
			<params>
				<param name="trade" type="12" value="TPS" out="N"/>
				<param name="season" type="12" value="201248" out="N"/>
				<param name="version" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
