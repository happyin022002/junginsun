<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PerformanceReportDBDAODocQueueBkgHistListVOCSQL">
			<desc><![CDATA[2011.11.11 정선용 [CHM-201113594] DPCS-SI Turn Time레포트 및 Draft B/L전송후 Amendment S/I PIC변경
                SR Amend Type 조회로직 수정 ]]></desc>
			<sql><![CDATA[
INSERT INTO BKG_SR_CRNT_RQST (
	SR_KND_CD
,	SR_NO
,	BKG_NO
,	SR_AMD_TP_CD
,	SR_AMD_SEQ
,	SR_URG_CD
,	SR_AMD_KND_CD
,	IMG_PG_NO
,	DIFF_RMK

--,   SR_WRK_STS_DT
--,   SR_WRK_STS_CD
--,   SR_WRK_STS_USR_ID
,	RCV_OFC_CD
,	IMG_FILE_IP
,	IMG_FILE_PATH_CTNT
,	IMG_FILE_NM

,	CRE_FLG
,	CUST_INP_FLG
,	CHG_INP_FLG
,	CNTR_INP_FLG
,	CNTR_MF_INP_FLG
,	DCGO_INP_FLG
,	AWK_CGO_INP_FLG
,	RC_INP_FLG
,	BB_CGO_INP_FLG
,	RLY_PORT_INP_FLG
,	NEW_BKG_CRE_FLG
,	SPLIT_FLG

,	BL_INFO_INP_FLG
,	BL_RT_FLG
,	BL_AUD_FLG
,	BL_DRFT_FAX_OUT_FLG

,	HBL_INFO_INP_FLG
,	MK_DESC_INP_FLG
,	CRE_USR_ID
,	CRE_DT
,	UPD_USR_ID
,	UPD_DT

,	FAX_LOG_REF_NO
,  SPLIT_STS_CD
,  BL_SPLIT_NO
,  BL_SPLIT_TTL_KNT
,  SR_DUE_DT
,  FNT_OFC_EML
) SELECT 
	@[sr_knd_cd]
,	@[sr_no]
,	@[bkg_no]
,   (SELECT CASE WHEN @[sr_amd_tp_cd] IN ('O','A','R') THEN DECODE(CORR_FLG,'R','R','N',SR_AMD_TP)
			     ELSE @[sr_amd_tp_cd]
			     END SR_AMD_TP_CD
	 FROM ( SELECT (SELECT DECODE(COUNT(*),0,'O','A') 
			        FROM BKG_SR_CRNT_RQST 
			        WHERE BKG_NO = @[bkg_no]) SR_AMD_TP,
			       NVL((SELECT CASE WHEN BL_AUD_FLG = 'Y' AND  BL_DRFT_FAX_OUT_FLG = 'Y' THEN 'R'
                                    ELSE 'N'
                                    END 
			            FROM BKG_SR_CRNT_RQST
			            WHERE BKG_NO = @[bkg_no]
			            AND SR_AMD_SEQ = (SELECT MAX(SR_AMD_SEQ) 
			                              FROM BKG_SR_CRNT_RQST
			                              WHERE BKG_NO = @[bkg_no]
									      AND BL_AUD_FLG = 'Y'
										  AND BL_DRFT_FAX_OUT_FLG = 'Y')),'N') CORR_FLG
			FROM DUAL))
,	@[sr_amd_seq]
,	@[sr_urg_cd]
,	@[sr_amd_knd_cd]
,	@[img_pg_no]
,	@[diff_rmk]
,	rcv_ofc_cd
,	img_file_ip
,	img_file_path_ctnt
,	@[img_file_nm]
,	'N'
,	'N'
,	'N'
,	'N'
,	'N'
,	'N'
,	'N'
,	'N'
,	'N'
,	'N'
,	'N'
,	'N'
,	'N'
,	'N'
,	'N'
,	'N'
,	'N'
,	'N'
,	@[upd_usr_id]
,	SYSDATE
,	@[upd_usr_id]
,	SYSDATE

,	FAX_LOG_REF_NO
,  @[split_flg]
,  @[bl_split_no]
,  to_number(@[bl_split_ttl_knt])
,  @[sr_due_dt]
,  @[fnt_ofc_eml]
FROM	BKG_SR_FAX
WHERE 	SR_NO =@[sr_no]
AND		SR_KND_CD = 'F'
AND     FAX_LOG_REF_NO = @[fax_log_ref_no]			]]></sql>
			<params>
				<param name="sr_knd_cd" type="12" value="" out="N"/>
				<param name="sr_no" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="sr_amd_tp_cd" type="12" value="" out="N"/>
				<param name="sr_amd_seq" type="2" value="" out="N"/>
				<param name="sr_urg_cd" type="12" value="" out="N"/>
				<param name="sr_amd_knd_cd" type="12" value="" out="N"/>
				<param name="img_pg_no" type="12" value="" out="N"/>
				<param name="diff_rmk" type="12" value="" out="N"/>
				<param name="img_file_nm" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="split_flg" type="12" value="" out="N"/>
				<param name="bl_split_no" type="2" value="" out="N"/>
				<param name="bl_split_ttl_knt" type="12" value="" out="N"/>
				<param name="sr_due_dt" type="91" value="" out="N"/>
				<param name="fnt_ofc_eml" type="12" value="" out="N"/>
				<param name="fax_log_ref_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
