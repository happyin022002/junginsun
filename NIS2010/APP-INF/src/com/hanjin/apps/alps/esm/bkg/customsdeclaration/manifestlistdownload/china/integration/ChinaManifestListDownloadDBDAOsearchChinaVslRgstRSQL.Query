<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChinaManifestListDownloadDBDAOsearchChinaVslRgstRSQL">
			<desc><![CDATA[]]></desc>
			<sql><![CDATA[
SELECT VVD,
       SLAN_CD,
       CRR_CD,
       VSL_ENG_NM,
       LLOYD_NO,
       VSL_CD,
#if (${search_div} == 'PUBLIC')
       IB_SKD_VOY_NO,
       IB_SKD_DIR_NM,
       OB_SKD_VOY_NO,
       OB_SKD_DIR_NM,
#end
       MAX(ETA_DT) AS ETA_DT,
       MAX(ETB_DT) AS ETB_DT,
       MAX(ETD_DT) AS ETD_DT

  FROM (

        SELECT DISTINCT
               SKD.VSL_CD||SKD.SKD_VOY_NO||SKD.SKD_DIR_CD AS VVD,
               SKD.SLAN_CD,
#if (${search_div} == 'PORT')
               DECODE(
                      (SELECT T1.ACT_CRR_CD
                         FROM VSK_VSL_SKD T1
                        WHERE 1 = 1
                          AND SKD.VSL_CD = T1.VSL_CD
                          AND SKD.SKD_VOY_NO = T1.SKD_VOY_NO
                          AND SKD.SKD_DIR_CD = T1.SKD_DIR_CD),
                      NULL,
                      CNTR.CRR_CD ,
                      (SELECT T1.ACT_CRR_CD
                         FROM VSK_VSL_SKD T1
                        WHERE 1 = 1
                          AND SKD.VSL_CD = T1.VSL_CD
                          AND SKD.SKD_VOY_NO = T1.SKD_VOY_NO
                          AND SKD.SKD_DIR_CD = T1.SKD_DIR_CD)
                     ) AS CRR_CD,
#elseif (${search_div} == 'PUBLIC')
               VVD.CRR_CD,
#end
               CNTR.VSL_ENG_NM,
               CNTR.LLOYD_NO,
               SKD.VSL_CD,
#if (${search_div} == 'PUBLIC')
               VVD.IB_SKD_VOY_NO,
               VVD.IB_SKD_DIR_NM,
               VVD.OB_SKD_VOY_NO,
               VVD.OB_SKD_DIR_NM,
#end
               TO_CHAR(SKD.VPS_ETA_DT, 'YYYY-MM-DD') AS ETA_DT,
               TO_CHAR(SKD.VPS_ETB_DT, 'YYYY-MM-DD') AS ETB_DT,
               TO_CHAR(SKD.VPS_ETD_DT, 'YYYY-MM-DD') AS ETD_DT

          FROM VSK_VSL_PORT_SKD SKD,
               MDM_VSL_SVC_LANE LANE,
#if (${search_div} == 'PUBLIC')
               BKG_CSTMS_CHN_CORR_VVD VVD,
#end
               MDM_VSL_CNTR CNTR

         WHERE SKD.VPS_PORT_CD = @[port_cd]
           AND SKD.VPS_ETB_DT BETWEEN TO_DATE(@[date_fm], 'YYYY-MM-DD') AND TO_DATE(@[date_to], 'YYYY-MM-DD') + 0.99999
           AND SKD.SLAN_CD = LANE.VSL_SLAN_CD(+)
           AND LANE.VSL_SVC_TP_CD <> 'O'
           AND SKD.VSL_CD = CNTR.VSL_CD(+)
#if (${search_div} == 'PUBLIC')
           AND SKD.VSL_CD = VVD.VSL_CD
           AND SKD.SKD_VOY_NO = VVD.SKD_VOY_NO
           AND SKD.SKD_DIR_CD = VVD.SKD_DIR_CD
           AND SKD.VPS_PORT_CD = VVD.PORT_CD
#end
#if (${vvd} != '')
           AND SKD.VSL_CD = SUBSTR(@[vvd], 1, 4)
           AND SKD.SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
           AND SKD.SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
#end
                 )
 GROUP BY VVD,
          SLAN_CD,
          CRR_CD,
          VSL_ENG_NM,
          VSL_CD,
#if (${search_div} == 'PUBLIC')
          IB_SKD_VOY_NO,
          IB_SKD_DIR_NM,
          OB_SKD_VOY_NO,
          OB_SKD_DIR_NM,

#end
          LLOYD_NO

 ORDER BY ETA_DT			]]></sql>
			<params>
				<param name="port_cd" type="12" value="" out="N"/>
				<param name="date_fm" type="12" value="" out="N"/>
				<param name="date_to" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
