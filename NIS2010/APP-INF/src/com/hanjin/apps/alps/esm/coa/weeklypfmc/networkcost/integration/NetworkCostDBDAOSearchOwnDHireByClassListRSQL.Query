<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="NetworkCostDBDAOSearchOwnDHireByClassListRSQL">
			<desc><![CDATA[History------------------------------------
2010.11.09 이행지 [CHM-201007027-01] AVG-Hire by Own VSL 메뉴 수정요청
]]></desc>
			<sql><![CDATA[
SELECT
     C2.COST_YRMON                      COST_YRMON
#if (${yrType} == 'yrwk')
   , C2.COST_WK                         COST_WK
#else
   , ''                         COST_WK
#end
   , C2.VSL_CLSS_CAPA                   VSL_CLSS_CAPA
   #foreach(${keys} IN ${keyList})
      ,NVL(SUM(DECODE(C1.STND_COST_CD,'$keys',C1.DHIR_AMT)),0) t$keys
   #end
   ,''
   , C1.OWN_VSL_RMK                     OWN_VSL_RMK
  FROM COA_OWN_VSL_DLY_HIR C1
     , (SELECT
        #if (${yrType} == 'yrwk')
            DISTINCT B1.SLS_YRMON    COST_YRMON
		#else
            DISTINCT B1.COST_YRMON   COST_YRMON
		#end
		#if (${yrType} == 'yrwk')
           ,B1.COST_WK              COST_WK
        #end
           ,B2.VSL_CLSS_CAPA        VSL_CLSS_CAPA
          FROM COA_MON_VVD B1
              ,(SELECT
                    A1.VSL_SEQ         VSL_SEQ
                   ,A1.VSL_CD          VSL_CD
                   ,A1.VSL_TP_CD       VSL_TP_CD
                   ,A1.VSL_OSHP_CD     VSL_OSHP_CD
                   ,A1.VOP_CD          VOP_CD
                   ,A1.PORT_CLSS_CAPA  PORT_CLSS_CAPA
                   ,A1.VSL_CLSS_CAPA   VSL_CLSS_CAPA
                   ,A1.VSL_RETN_FM_DT  FM_DT
                   ,A1.VSL_RETN_TO_DT  TO_DT
                  FROM COA_VSL_RGST A1
                 WHERE 1 = 1
                   AND NVL(A1.DELT_FLG, 'N') = 'N'
               ) B2
         WHERE 1 = 1
           #if (${yrType} == 'yrwk')
              AND B1.SLS_YRMON LIKE @[sls_yrmon]||'%'
              AND B1.COST_WK = @[cost_wk]
           #else
              AND B1.COST_YRMON LIKE @[sls_yrmon]||@[cost_wk]
           #end
           AND B1.VSL_CD       = B2.VSL_CD
           AND B1.DELT_FLG     <> 'Y'
           AND B2.VSL_TP_CD    = 'C'
           AND B2.VSL_OSHP_CD  = 'OWN'
           AND TO_CHAR(B1.N1ST_LODG_PORT_ETD_DT, 'YYYYMMDD')
                       BETWEEN NVL(TO_CHAR(B2.FM_DT, 'YYYYMMDD'), '19000101')
                       AND     NVL(TO_CHAR(B2.TO_DT, 'YYYYMMDD'), '99991231')
           AND B2.VSL_CD = NVL(@[vsl_cd], B2.VSL_CD)
		   AND B1.SUB_TRD_CD <> 'IP'
       ) C2
 WHERE 1 = 1
   AND C2.COST_YRMON    = C1.COST_YRMON(+)
   AND C1.VSL_CD(+)     ='XXXX'
   AND C2.VSL_CLSS_CAPA = C1.VSL_CLSS_CAPA(+)
 GROUP BY C2.COST_YRMON
#if (${yrType} == 'yrwk')
        , C2.COST_WK
#end
        , C2.VSL_CLSS_CAPA
        , C1.OWN_VSL_RMK
 ORDER BY C2.COST_YRMON
#if (${yrType} == 'yrwk')
        , C2.COST_WK
#end
        , C2.VSL_CLSS_CAPA			]]></sql>
			<params>
				<param name="sls_yrmon" type="12" value="" out="Y"/>
				<param name="cost_wk" type="12" value="" out="Y"/>
				<param name="vsl_cd" type="12" value="" out="Y"/>
			</params>
		</query>
	</querys>
</sqls>
