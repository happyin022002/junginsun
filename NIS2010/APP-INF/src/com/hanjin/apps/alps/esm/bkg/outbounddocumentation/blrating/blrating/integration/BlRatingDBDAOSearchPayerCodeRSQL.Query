<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BlRatingDBDAOSearchPayerCodeRSQL">
			<desc><![CDATA[SearchPayerCode]]></desc>
			<sql><![CDATA[
SELECT 
BKG_NO,
CASE 
    WHEN BKG_CUST_TP_CD ='S' THEN 'SHIPPER'
	WHEN BKG_CUST_TP_CD ='F' THEN 'FOWARDER'
    WHEN BKG_CUST_TP_CD ='C' THEN 'CONSIGNEE'
    WHEN BKG_CUST_TP_CD ='N' THEN 'NOTIFY'
    WHEN BKG_CUST_TP_CD ='R' THEN 'REP. CUSTOMER' 
END  AS BKG_CUST_TP_CD,
OFC_CD,
CUST_CNT_CD,
CUST_SEQ,
CUST_NM
FROM (

#if (${call_type} == 'PPD') 
	#if (${ca_flg} == 'Y') 
		SELECT ROWNUM,A.* FROM 
		(
		--FAD
		SELECT B.BKG_NO BKG_NO,
				10 AS FLG,
				'F' AS BKG_CUST_TP_CD,
				BKG_OFC_CD OFC_CD,
				C.CUST_CNT_CD,
				C.CUST_SEQ,
				C.CUST_LGL_ENG_NM AS CUST_NM
		FROM    BKG_BKG_HIS B,
				BKG_CUST_HIS F,
				MDM_CUSTOMER C,
				MDM_LOCATION M
		WHERE  B.BKG_NO = @[bkg_no]
		AND    B.BKG_NO = F.BKG_NO
		AND    F.BKG_CUST_TP_CD = 'F'
		AND    F.CUST_CNT_CD = C.CUST_CNT_CD
		AND    F.CUST_SEQ = C.CUST_SEQ
		AND    B.CORR_NO='TMP0000001'
		AND    F.CORR_NO='TMP0000001'
		AND    C.DELT_FLG ='N'
		AND    B.POR_CD = M.LOC_CD
		AND    M.CONTI_CD IN( 'F','E')
		AND    M.DELT_FLG ='N'
		AND    EXISTS( SELECT 'Y' FROM MDM_LOCATION L
						WHERE L.CNT_CD = F.CUST_CNT_CD
						  AND L.CONTI_CD ='E'
						  AND ROWNUM = 1)

		UNION 
		--PPD
		SELECT BKG.BKG_NO BKG_NO,
				11 AS FLG,
				'S' AS BKG_CUST_TP_CD,
				CR_CLT_OFC_CD AS OFC_CD,
				BCUST.CUST_CNT_CD CUST_CNT_CD,
				BCUST.CUST_SEQ CUST_SEQ,
				BCUST.CUST_LGL_ENG_NM CUST_NM
		FROM   MDM_CR_CUST CUST,
			   BKG_BKG_HIS BKG,
			   (SELECT S.CUST_CNT_CD, S.CUST_SEQ, C.CUST_LGL_ENG_NM
			   FROM BKG_CUST_HIS S, 
					MDM_CUSTOMER C
				WHERE  S.BKG_NO = @[bkg_no]
				AND S.BKG_CUST_TP_CD = 'S'
				AND S.CUST_CNT_CD = C.CUST_CNT_CD
				AND S.CUST_SEQ = C.CUST_SEQ
				AND S.CORR_NO='TMP0000001'
				) BCUST
		WHERE  BKG.BKG_NO = @[bkg_no]
		AND    (CUST.CUST_CNT_CD, CUST.CUST_SEQ) = (SELECT CUST_CNT_CD, CUST_SEQ
											FROM   BKG_BKG_HIS B, BKG_CUST_HIS S
											WHERE  B.BKG_NO = @[bkg_no] 
											AND S.BKG_NO = B.BKG_NO 
											AND S.BKG_CUST_TP_CD = 'S'
											AND B.CORR_NO='TMP0000001'
											AND S.CORR_NO='TMP0000001')
		AND    0 < CUST.OB_CR_TERM_DYS
		AND    CUST.CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] 		AND    CORR_NO='TMP0000001')
		AND    CUST.CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] 		AND    CORR_NO='TMP0000001')
		AND    BKG.CORR_NO='TMP0000001'
		UNION
		--PPD OFFICE CODE2
		SELECT B.BKG_NO BKG_NO,
				12 AS FLG,
				'S' AS BKG_CUST_TP_CD,
				BKG_OFC_CD OFC_CD,
				C.CUST_CNT_CD,
				C.CUST_SEQ,
				C.CUST_LGL_ENG_NM AS CUST_NM
		FROM    BKG_BKG_HIS B,
				BKG_CUST_HIS S,
				MDM_CUSTOMER C
		WHERE  B.BKG_NO = @[bkg_no]
		AND    S.BKG_NO = B.BKG_NO
		AND    S.BKG_CUST_TP_CD = 'S'
		AND    S.CUST_CNT_CD = C.CUST_CNT_CD
		AND    S.CUST_SEQ = C.CUST_SEQ
		AND    B.CORR_NO='TMP0000001'
		AND    S.CORR_NO='TMP0000001'
		ORDER BY FLG
		) A
		WHERE 
		ROWNUM = 1
	#else

		SELECT ROWNUM,A.* FROM 
		(
		--FAD
		SELECT B.BKG_NO BKG_NO,
				10 AS FLG,
				'F' AS BKG_CUST_TP_CD,
				BKG_OFC_CD OFC_CD,
				C.CUST_CNT_CD,
				C.CUST_SEQ,
				C.CUST_LGL_ENG_NM AS CUST_NM
		FROM    BKG_BOOKING B,
				BKG_CUSTOMER F,
				MDM_CUSTOMER C,
				MDM_LOCATION M
		WHERE  B.BKG_NO = @[bkg_no]
		AND    B.BKG_NO = F.BKG_NO
		AND    F.BKG_CUST_TP_CD = 'F'
		AND    F.CUST_CNT_CD = C.CUST_CNT_CD
		AND    F.CUST_SEQ = C.CUST_SEQ
		AND    C.DELT_FLG ='N'
		AND    B.POR_CD = M.LOC_CD
		AND    M.CONTI_CD IN( 'F','E')
		AND    M.DELT_FLG ='N'
		AND    EXISTS( SELECT 'Y' FROM MDM_LOCATION L
						WHERE L.CNT_CD = F.CUST_CNT_CD
						  AND L.CONTI_CD ='E'
						  AND ROWNUM = 1)

		UNION 
		--PPD
		SELECT BKG.BKG_NO BKG_NO,
				11 AS FLG,
				'S' AS BKG_CUST_TP_CD,
				CR_CLT_OFC_CD AS OFC_CD,
				BCUST.CUST_CNT_CD CUST_CNT_CD,
				BCUST.CUST_SEQ CUST_SEQ,
				BCUST.CUST_LGL_ENG_NM CUST_NM
		FROM   MDM_CR_CUST CUST,
			   BKG_BOOKING BKG,
			   (SELECT S.CUST_CNT_CD, S.CUST_SEQ, C.CUST_LGL_ENG_NM
			   FROM BKG_CUSTOMER S, 
					MDM_CUSTOMER C
				WHERE  S.BKG_NO = @[bkg_no]
				AND S.BKG_CUST_TP_CD = 'S'
				AND S.CUST_CNT_CD = C.CUST_CNT_CD
				AND S.CUST_SEQ = C.CUST_SEQ
				) BCUST
		WHERE  BKG.BKG_NO = @[bkg_no]
		AND    (CUST.CUST_CNT_CD, CUST.CUST_SEQ) = (SELECT CUST_CNT_CD, CUST_SEQ
											FROM   BKG_BOOKING B, BKG_CUSTOMER S
											WHERE  B.BKG_NO = @[bkg_no] 
											AND S.BKG_NO = B.BKG_NO 
											AND S.BKG_CUST_TP_CD = 'S')
		AND    0 < CUST.OB_CR_TERM_DYS
		AND    CUST.CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])
		AND    CUST.CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])
		UNION
		--PPD OFFICE CODE2
		SELECT B.BKG_NO BKG_NO,
				12 AS FLG,
				'S' AS BKG_CUST_TP_CD,
				BKG_OFC_CD OFC_CD,
				C.CUST_CNT_CD,
				C.CUST_SEQ,
				C.CUST_LGL_ENG_NM AS CUST_NM
		FROM    BKG_BOOKING B,
				BKG_CUSTOMER S,
				MDM_CUSTOMER C
		WHERE  B.BKG_NO = @[bkg_no]
		AND    S.BKG_NO = B.BKG_NO
		AND    S.BKG_CUST_TP_CD = 'S'
		AND    S.CUST_CNT_CD = C.CUST_CNT_CD
		AND    S.CUST_SEQ = C.CUST_SEQ
		ORDER BY FLG
		) A
		WHERE 
		ROWNUM = 1
#end




#else
	#if (${ca_flg} == 'Y') 
		SELECT ROWNUM,A.* FROM 
		(
		--CCT
		SELECT  BKG.BKG_NO AS BKG_NO,
				21 AS FLG,
				'C' AS BKG_CUST_TP_CD,
				CR_CLT_OFC_CD AS OFC_CD,
				BCUST.CUST_CNT_CD AS CUST_CNT_CD,
				BCUST.CUST_SEQ AS CUST_SEQ,
				MCUST.CUST_LGL_ENG_NM AS CUST_NM
		FROM    MDM_CR_CUST CUST,
				BKG_BKG_HIS BKG,
				BKG_CUST_HIS BCUST,
				MDM_CUSTOMER MCUST
		WHERE  BKG.BKG_NO = @[bkg_no]
		AND    BKG.BKG_NO = BCUST.BKG_NO
		AND    BCUST.BKG_CUST_TP_CD = 'C'
		AND    CUST.CUST_CNT_CD = BCUST.CUST_CNT_CD
		AND    CUST.CUST_SEQ = BCUST.CUST_SEQ
		AND    BCUST.CUST_CNT_CD = MCUST.CUST_CNT_CD
		AND    BCUST.CUST_SEQ = MCUST.CUST_SEQ    
		AND    IB_CR_TERM_DYS > 0
		AND    BKG.CORR_NO='TMP0000001'
		AND    CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] 		AND    CORR_NO='TMP0000001')
		AND    CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] 		AND    CORR_NO='TMP0000001')
		UNION
		--CCT OFFICE CODE2
		SELECT B.BKG_NO BKG_NO,
				22 AS FLG,
				'C' AS BKG_CUST_TP_CD,
				FINC_CTRL_OFC_CD AS OFC_CD,
				S.CUST_CNT_CD  AS CUST_CNT_CD,
				NVL(S.CUST_SEQ,'1') AS CUST_SEQ,
				C.CUST_LGL_ENG_NM AS CUST_NM
		FROM    MDM_LOCATION M, 
				BKG_BKG_HIS B, 
				BKG_CUST_HIS S,
				MDM_CUSTOMER C
		WHERE  B.BKG_NO = @[bkg_no]
		AND    S.BKG_NO = B.BKG_NO
		AND    S.BKG_CUST_TP_CD = 'C'
		AND    S.CUST_CNT_CD = C.CUST_CNT_CD
		AND    S.CUST_SEQ = C.CUST_SEQ
		AND    B.DEL_CD = M.LOC_CD
		AND    M.DELT_FLG = 'N'
		AND    B.CORR_NO='TMP0000001'
		AND    S.CORR_NO='TMP0000001'
		UNION
		--REP CUSTOMER
		SELECT BKG_NO,
				31 AS FLG,
				'R'AS BKG_CUST_TP_CD,
				(SELECT  FINC_CTRL_OFC_CD
					FROM MDM_LOCATION
					WHERE LOC_CD = (SELECT DEL_CD
									FROM  BKG_BKG_HIS
									WHERE BKG_NO =@[bkg_no]
									AND CORR_NO='TMP0000001')) AS OFC_CD,
				REP_CUST_CNT_CD AS CUST_CNT_CD,
				REP_CUST_SEQ AS CUST_SEQ,
				MCUST.CUST_LGL_ENG_NM AS CUST_NM
		FROM   MDM_ORGANIZATION OFC, 
				BKG_BKG_HIS BKG,
				MDM_CUSTOMER MCUST
		WHERE  BKG.BKG_NO = @[bkg_no]
		AND    REP_CUST_CNT_CD = MCUST.CUST_CNT_CD
		AND    REP_CUST_SEQ = MCUST.CUST_SEQ
		AND    BKG.CORR_NO='TMP0000001'
		AND    OFC.OFC_CD = NVL((SELECT CR_CLT_OFC_CD
								FROM MDM_CR_CUST
								WHERE (CUST_CNT_CD, CUST_SEQ) = (SELECT CUST_CNT_CD, CUST_SEQ
																	FROM   BKG_BKG_HIS B,
																			BKG_CUST_HIS C
																	WHERE  B.BKG_NO = @[bkg_no]
																	AND    C.BKG_NO = B.BKG_NO
																	AND    C.BKG_CUST_TP_CD = 'C'
																	AND    B.CORR_NO='TMP0000001'
																	AND    C.CORR_NO='TMP0000001')
								AND 0 < IB_CR_TERM_DYS
								AND CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] 		AND    CORR_NO='TMP0000001')
								AND CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no] 		AND    CORR_NO='TMP0000001')),
							(SELECT  FINC_CTRL_OFC_CD
								FROM MDM_LOCATION
								WHERE LOC_CD = (SELECT DEL_CD
												FROM  BKG_BKG_HIS
												WHERE BKG_NO =@[bkg_no]
												AND CORR_NO='TMP0000001')
							)
							)
							ORDER BY FLG
		) A
		WHERE 
		ROWNUM = 1
	#else
		SELECT ROWNUM,A.* FROM 
		(
		--CCT
		SELECT  BKG.BKG_NO AS BKG_NO,
				21 AS FLG,
				'C' AS BKG_CUST_TP_CD,
				CR_CLT_OFC_CD AS OFC_CD,
				BCUST.CUST_CNT_CD AS CUST_CNT_CD,
				BCUST.CUST_SEQ AS CUST_SEQ,
				MCUST.CUST_LGL_ENG_NM AS CUST_NM
		FROM    MDM_CR_CUST CUST,
				BKG_BOOKING BKG,
				BKG_CUSTOMER BCUST,
				MDM_CUSTOMER MCUST
		WHERE  BKG.BKG_NO = @[bkg_no]
		AND    BKG.BKG_NO = BCUST.BKG_NO
		AND    BCUST.BKG_CUST_TP_CD = 'C'
		AND    CUST.CUST_CNT_CD = BCUST.CUST_CNT_CD
		AND    CUST.CUST_SEQ = BCUST.CUST_SEQ
		AND    BCUST.CUST_CNT_CD = MCUST.CUST_CNT_CD
		AND    BCUST.CUST_SEQ = MCUST.CUST_SEQ    
		AND    IB_CR_TERM_DYS > 0
		AND    CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])
		AND    CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])
		UNION
		--CCT OFFICE CODE2
		SELECT B.BKG_NO BKG_NO,
				22 AS FLG,
				'C' AS BKG_CUST_TP_CD,
				FINC_CTRL_OFC_CD AS OFC_CD,
				S.CUST_CNT_CD  AS CUST_CNT_CD,
				NVL(S.CUST_SEQ,'1') AS CUST_SEQ,
				C.CUST_LGL_ENG_NM AS CUST_NM
		FROM    MDM_LOCATION M, 
				BKG_BOOKING B, 
				BKG_CUSTOMER S,
				MDM_CUSTOMER C
		WHERE  B.BKG_NO = @[bkg_no]
		AND    S.BKG_NO = B.BKG_NO
		AND    S.BKG_CUST_TP_CD = 'C'
		AND    S.CUST_CNT_CD = C.CUST_CNT_CD
		AND    S.CUST_SEQ = C.CUST_SEQ
		AND    B.DEL_CD = M.LOC_CD
		AND    M.DELT_FLG = 'N'
		UNION
		--REP CUSTOMER
		SELECT BKG_NO,
				31 AS FLG,
				'R'AS BKG_CUST_TP_CD,
				(SELECT  FINC_CTRL_OFC_CD
					FROM MDM_LOCATION
					WHERE LOC_CD = (SELECT DEL_CD
									FROM  BKG_BOOKING
									WHERE BKG_NO =@[bkg_no])) AS OFC_CD,
				REP_CUST_CNT_CD AS CUST_CNT_CD,
				REP_CUST_SEQ AS CUST_SEQ,
				MCUST.CUST_LGL_ENG_NM AS CUST_NM
		FROM   MDM_ORGANIZATION OFC, 
				BKG_BOOKING BKG,
				MDM_CUSTOMER MCUST
		WHERE  BKG.BKG_NO = @[bkg_no]
		AND    REP_CUST_CNT_CD = MCUST.CUST_CNT_CD
		AND    REP_CUST_SEQ = MCUST.CUST_SEQ
		AND    OFC.OFC_CD = NVL((SELECT CR_CLT_OFC_CD
								FROM MDM_CR_CUST
								WHERE (CUST_CNT_CD, CUST_SEQ) = (SELECT CUST_CNT_CD, CUST_SEQ
																	FROM   BKG_BOOKING B,
																			BKG_CUSTOMER C
																	WHERE  B.BKG_NO = @[bkg_no]
																	AND    C.BKG_NO = B.BKG_NO
																	AND    C.BKG_CUST_TP_CD = 'C')
								AND 0 < IB_CR_TERM_DYS
								AND CR_ST_DT  <= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])
								AND CR_END_DT >= (SELECT TO_CHAR(BKG_CRE_DT,'RRRRMMDD') FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])),
							(SELECT  FINC_CTRL_OFC_CD
								FROM MDM_LOCATION
								WHERE LOC_CD = (SELECT DEL_CD
												FROM  BKG_BOOKING
												WHERE BKG_NO =@[bkg_no])
							)
							)
							ORDER BY FLG
		) A
		WHERE 
		ROWNUM = 1
	#end
#end
)			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
