<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SpaceAllocationManageDBDAOSearchTargetCustAllocRSQL">
			<desc><![CDATA[Season 내 first version의 적용 시작 주차 이후에 기입력되어 있는 Alloc을 조회합니다.

2014.01.03 진마리아 [SRM-201341166] Yield Group의 확대]]></desc>
			<sql><![CDATA[
SELECT RLANE_CD
      ,DIR_CD
      ,VSL_CD
      ,SKD_VOY_NO
      ,SKD_DIR_CD
      ,SLS_OFC_CD
      ,POL_YD_CD
      ,POD_YD_CD
      ,TS_FLG
      ,MNL_FLG
      ,CUST_CNT_CD
      ,CUST_SEQ
      ,(
          SELECT /*+INDEX (G XPKSPC_MDL_CUST_CTRL_GRP) */
                  CUST_CTRL_CD
             FROM SPC_MDL_CUST_CTRL_GRP G
            WHERE TRD_CD = A.TRD_CD
              AND COST_YRWK = (SELECT /*+INDEX_DESC (M XPKSPC_MDL_VER_MST) */
                                      M.COST_YRWK
                                 FROM SPC_MDL_VER_MST M
                                WHERE @[ver_st_yrwk] BETWEEN M.VER_ST_YRWK AND M.VER_END_YRWK
                                  AND M.CFM_FLG = 'Y'
                                  AND M.TRD_CD  = G.TRD_CD
                                  AND ROWNUM    = 1
                              )
              AND CUST_CTRL_CD LIKE A.CUST_CTRL_CD||'%'
              AND ROWNUM = 1
       ) AS CUST_CTRL_CD
      ,IOC_CD
      ,REP_TRD_CD
      ,REP_SUB_TRD_CD
      ,TRD_CD
      ,SUB_TRD_CD
      ,SLS_RHQ_CD
      ,SLS_RGN_OFC_CD
      ,ASGN_TTL_QTY
      ,ASGN_20FT_QTY
      ,ASGN_40FT_QTY
      ,ASGN_40FT_HC_QTY
      ,ASGN_45FT_HC_QTY
      ,ASGN_53FT_QTY
      ,ASGN_RF_QTY
      ,ASGN_TTL_WGT
      ,BKG_AVAL_TTL_QTY
      ,BKG_AVAL_20FT_QTY
      ,BKG_AVAL_40FT_QTY
      ,BKG_AVAL_40FT_HC_QTY
      ,BKG_AVAL_45FT_HC_QTY
      ,BKG_AVAL_53FT_QTY
      ,BKG_AVAL_RF_QTY
      ,BKG_AVAL_TTL_WGT
      ,MNL_ALOC_RMK
      ,ALOC_USR_ID
      ,ALOC_GDT
      ,SLS_AQ_CD
      ,FCAST_TTL_QTY
      ,FCAST_40FT_HC_QTY
      ,FCAST_45FT_HC_QTY
      ,FCAST_53FT_QTY
      ,FCAST_RF_QTY
      ,FCAST_TTL_WGT
      ,USD_BKG_TTL_QTY
      ,USD_BKG_20FT_QTY
      ,USD_BKG_40FT_QTY
      ,USD_BKG_40FT_HC_QTY
      ,USD_BKG_45FT_HC_QTY
      ,USD_BKG_53FT_QTY
      ,USD_BKG_RF_QTY
      ,USD_BKG_TTL_WGT
      ,SPC_CTRL_ALOC_RMK
      ,SPC_CTRL_ALOC_POL_RMK
      ,SPC_CTRL_ALOC_POD_RMK
      ,POL_IND_SEQ
      ,POD_IND_SEQ
      ,POL_YD_IND_SEQ
      ,POD_YD_IND_SEQ
      ,CRE_USR_ID
      ,CRE_DT
      ,UPD_USR_ID
      ,UPD_DT
  FROM (
          SELECT A.RLANE_CD
                ,A.DIR_CD
                ,A.VSL_CD
                ,A.SKD_VOY_NO
                ,SKD_DIR_CD
                ,SLS_OFC_CD
                ,POL_YD_CD
                ,POD_YD_CD
                ,TS_FLG
                ,MNL_FLG
                ,CUST_CNT_CD
                ,CUST_SEQ
                ,SUBSTR(CUST_CTRL_CD,1,1) AS CUST_CTRL_CD
                ,A.IOC_CD
                ,MAX(A.REP_TRD_CD)         AS REP_TRD_CD
                ,MAX(A.REP_SUB_TRD_CD)     AS REP_SUB_TRD_CD
                ,MAX(A.TRD_CD)             AS TRD_CD
                ,MAX(A.SUB_TRD_CD)         AS SUB_TRD_CD
                ,MAX(SLS_RHQ_CD)           AS SLS_RHQ_CD
                ,MAX(SLS_RGN_OFC_CD)       AS SLS_RGN_OFC_CD
                ,SUM(ASGN_TTL_QTY)         AS ASGN_TTL_QTY
                ,SUM(ASGN_20FT_QTY)        AS ASGN_20FT_QTY
                ,SUM(ASGN_40FT_QTY)        AS ASGN_40FT_QTY
                ,SUM(ASGN_40FT_HC_QTY)     AS ASGN_40FT_HC_QTY
                ,SUM(ASGN_45FT_HC_QTY)     AS ASGN_45FT_HC_QTY
                ,SUM(ASGN_53FT_QTY)        AS ASGN_53FT_QTY
                ,SUM(ASGN_RF_QTY)          AS ASGN_RF_QTY
                ,SUM(ASGN_TTL_WGT)         AS ASGN_TTL_WGT
                ,SUM(BKG_AVAL_TTL_QTY)     AS BKG_AVAL_TTL_QTY
                ,SUM(BKG_AVAL_20FT_QTY)    AS BKG_AVAL_20FT_QTY
                ,SUM(BKG_AVAL_40FT_QTY)    AS BKG_AVAL_40FT_QTY
                ,SUM(BKG_AVAL_40FT_HC_QTY) AS BKG_AVAL_40FT_HC_QTY
                ,SUM(BKG_AVAL_45FT_HC_QTY) AS BKG_AVAL_45FT_HC_QTY
                ,SUM(BKG_AVAL_53FT_QTY)    AS BKG_AVAL_53FT_QTY
                ,SUM(BKG_AVAL_RF_QTY)      AS BKG_AVAL_RF_QTY
                ,SUM(BKG_AVAL_TTL_WGT)     AS BKG_AVAL_TTL_WGT
                ,MAX(MNL_ALOC_RMK)         AS MNL_ALOC_RMK
                ,MAX(ALOC_USR_ID)          AS ALOC_USR_ID
                ,MAX(TO_CHAR(ALOC_GDT,'YYYYMMDDHH24MI')) AS ALOC_GDT
                ,MAX(SLS_AQ_CD)            AS SLS_AQ_CD
                ,SUM(FCAST_TTL_QTY)        AS FCAST_TTL_QTY
                ,SUM(FCAST_40FT_HC_QTY)    AS FCAST_40FT_HC_QTY
                ,SUM(FCAST_45FT_HC_QTY)    AS FCAST_45FT_HC_QTY
                ,SUM(FCAST_53FT_QTY)       AS FCAST_53FT_QTY
                ,SUM(FCAST_RF_QTY)         AS FCAST_RF_QTY
                ,SUM(FCAST_TTL_WGT)        AS FCAST_TTL_WGT
                ,SUM(USD_BKG_TTL_QTY)      AS USD_BKG_TTL_QTY
                ,SUM(USD_BKG_20FT_QTY)     AS USD_BKG_20FT_QTY
                ,SUM(USD_BKG_40FT_QTY)     AS USD_BKG_40FT_QTY
                ,SUM(USD_BKG_40FT_HC_QTY)  AS USD_BKG_40FT_HC_QTY
                ,SUM(USD_BKG_45FT_HC_QTY)  AS USD_BKG_45FT_HC_QTY
                ,SUM(USD_BKG_53FT_QTY)     AS USD_BKG_53FT_QTY
                ,SUM(USD_BKG_RF_QTY)       AS USD_BKG_RF_QTY
                ,SUM(USD_BKG_TTL_WGT)      AS USD_BKG_TTL_WGT
                ,MAX(SPC_CTRL_ALOC_RMK)    AS SPC_CTRL_ALOC_RMK
                ,MAX(SPC_CTRL_ALOC_POL_RMK)AS SPC_CTRL_ALOC_POL_RMK
                ,MAX(SPC_CTRL_ALOC_POD_RMK)AS SPC_CTRL_ALOC_POD_RMK
                ,MAX(POL_IND_SEQ)          AS POL_IND_SEQ
                ,MAX(POD_IND_SEQ)          AS POD_IND_SEQ
                ,MAX(POL_YD_IND_SEQ)       AS POL_YD_IND_SEQ
                ,MAX(POD_YD_IND_SEQ)       AS POD_YD_IND_SEQ
                ,MAX(A.CRE_USR_ID)         AS CRE_USR_ID
                ,MAX(TO_CHAR(A.CRE_DT,'YYYYMMDDHH24MI')) AS CRE_DT
                ,MAX(A.UPD_USR_ID)         AS UPD_USR_ID
                ,MAX(TO_CHAR(A.UPD_DT,'YYYYMMDDHH24MI')) AS UPD_DT
            FROM SPC_ALOC_CUST_POL_POD A, MAS_MON_VVD C
           WHERE A.RLANE_CD   = C.RLANE_CD
             AND A.DIR_CD     = C.DIR_CD
             AND A.VSL_CD     = C.VSL_CD
             AND A.SKD_VOY_NO = C.SKD_VOY_NO
             AND A.SKD_DIR_CD = C.DIR_CD
             AND A.IOC_CD     = C.IOC_CD
             AND A.TRD_CD     = C.TRD_CD
             AND A.REP_TRD_CD = @[trd_cd]
             AND SUBSTR(C.SLS_YRMON,1,4)||C.COST_WK >= @[ver_st_yrwk]
             AND NVL(A.CUST_CTRL_CD,' ') <> 'C'
        --   AND A.IOC_TS_CD  = 'O'
        GROUP BY A.RLANE_CD
                ,A.DIR_CD
                ,A.VSL_CD
                ,A.SKD_VOY_NO
                ,SKD_DIR_CD
                ,SLS_OFC_CD
                ,POL_YD_CD
                ,POD_YD_CD
                ,TS_FLG
                ,MNL_FLG
                ,CUST_CNT_CD
                ,CUST_SEQ
                ,SUBSTR(CUST_CTRL_CD,1,1)
                ,A.IOC_CD
       ) A			]]></sql>
			<params>
				<param name="ver_st_yrwk" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
