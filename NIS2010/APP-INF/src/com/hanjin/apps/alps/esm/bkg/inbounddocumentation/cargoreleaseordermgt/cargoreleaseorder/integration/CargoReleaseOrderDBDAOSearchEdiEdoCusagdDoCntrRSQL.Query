<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CargoReleaseOrderDBDAOSearchEdiEdoCusagdDoCntrRSQL">
			<desc><![CDATA[Booking Container 정보를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT '{CNTR_INFO'                                     || CHR(10)
      ||'CNTR_NO:'       || CNTR_NO                     || CHR(10)
      ||'CNTRTS_CD:'     || CNTR_TPSZ_CD                || CHR(10)
      ||'FT_END_DT:'     || NVL(CRNT_DEM_FT_END_DT,' ') || CHR(10) /* 기존 부정확한 일자인  VPS_ETA_DT +Reefer는 + 5일, 기타 +8일로 전송 하던 것을  제공하지 않음 2018. 2.27 */
      ||'OLD_FT_END_DT:' || NVL(PRE_DEM_FT_END_DT ,' ') || CHR(10)
      ||'}CNTR_INFO'     || CHR(10)      
FROM  
   ( 
         SELECT  BCNTR.CNTR_NO       
                ,BCNTR.CNTR_TPSZ_CD  
                ,PRE_DEM_FT_END_DT
                ,CRNT_DEM_FT_END_DT
        FROM    BKG_CONTAINER    BCNTR,
                (
                  SELECT BKG_NO                                                     
                        ,CNTR_NO                                                    
                        ,DECODE( PRE_DEM_FT_END_DT, CRNT_DEM_FT_END_DT, '', PRE_DEM_FT_END_DT) PRE_DEM_FT_END_DT
                        ,CRNT_DEM_FT_END_DT
                  FROM (      
                         SELECT  BKG_NO                                            AS BKG_NO   
                                ,CNTR_NO                                           AS CNTR_NO  
                                ,TO_CHAR(PRE_DEM_FT_END_DT,'YYYYMMDD')           AS PRE_DEM_FT_END_DT    
                                ,TO_CHAR(CRNT_DEM_FT_END_DT,'YYYYMMDD')          AS CRNT_DEM_FT_END_DT    
                                ,EDO_HIS_SEQ                                       AS EDO_HIS_SEQ
                                ,MAX(EDO_HIS_SEQ) OVER (PARTITION BY CNTR.BKG_NO,CNTR.CNTR_NO ) AS MAX_EDO_HIS_SEQ      
                              FROM BKG_EDO_DEM_HIS CNTR      
                              WHERE BKG_NO = @[bkg_no]
                    
                  ) WHERE EDO_HIS_SEQ= MAX_EDO_HIS_SEQ
        
                )  DMT_CALC
        WHERE   BCNTR.bkg_NO        = @[bkg_no]
        AND     DMT_CALC.BKG_NO(+)  = BCNTR.BKG_NO
        AND     DMT_CALC.CNTR_NO(+) = BCNTR.CNTR_NO 
  )			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
