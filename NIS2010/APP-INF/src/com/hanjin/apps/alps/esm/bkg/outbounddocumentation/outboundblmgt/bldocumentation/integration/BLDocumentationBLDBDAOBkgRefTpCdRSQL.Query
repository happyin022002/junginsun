<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLDocumentationBLDBDAOBkgRefTpCdRSQL">
			<desc><![CDATA[BkgRefTpCd]]></desc>
			<sql><![CDATA[
SELECT BKG_JOIN_FNC(CURSOR(SELECT A.BKG_REF_TP_ML_CD
                             FROM (SELECT DECODE(B.BKG_REF_TP_CD,
                                                'BKPO','POB',
                                                'CTPO','POC',
                                                'CMPO','POM',
                                                'HINV','INV',
                                                'HPDP','DPT',
                                                'LCNO','LCN',
                                                'HPSH','SHP',
                                                'HPPN','PRT',
												'MSLD','MSL',
                                                'INCO','INC','N') AS BKG_REF_TP_ML_CD
                                    FROM BKG_BOOKING A
                                        ,BKG_REFERENCE B
                                   WHERE A.BKG_NO = B.BKG_NO(+)
                                     AND A.BKG_NO = @[bkg_no]

                                   UNION 
                                
                                   SELECT COLUMN_VALUE AS BKG_REF_TP_ML_CD FROM TABLE (BKG_SPLIT_FNC(('POB,POC,POM,MSL'),',')) 
                                    WHERE 1=1
                                      AND EXISTS (SELECT 'POYN' AS BKG_REF_TP_CD 
                                                    FROM BKG_REFERENCE
                                                   WHERE BKG_NO = @[bkg_no]
                                                     AND BKG_REF_TP_CD IN ('BKPO','LCNO','HINV','LCDT','HPDP','CTPO','INCO','MSLD')
                                                     AND CUST_REF_NO_CTNT IS NOT NULL  
                                                  )   
                                
                                   UNION
                                 
                                   SELECT 'SHP' AS BKG_REF_TP_ML_CD
                                     FROM BKG_REF_DTL
                                    WHERE BKG_NO = @[bkg_no]
                                      AND DE_NO IS NOT NULL

                                   UNION

                                   SELECT 'PRT' AS BKG_REF_TP_ML_CD
                                     FROM BKG_REF_DTL
                                    WHERE BKG_NO = @[bkg_no]
                                      AND PRT_NO IS NOT NULL
                                   ) A
                            #if (${r_po_other_mdt_itm} != '' && $r_po_other_mdt_itm.size() > 0)
                            WHERE A.BKG_REF_TP_ML_CD IN ( NULL
	                                                     #foreach($r_po_other_mdt_itm IN ${r_po_other_mdt_itm})
	 	                                 	             	#if($velocityCount < $r_po_other_mdt_itm.size())
	 	                                    				,'$r_po_other_mdt_itm',
	 	                                    				#else
	 	                                    				,'$r_po_other_mdt_itm'
	 	                                    			 	#end
	                                     				 #end
	                                                     )
                            #end
                            ORDER BY A.BKG_REF_TP_ML_CD
                           )
                    ) 
  FROM DUAL			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
