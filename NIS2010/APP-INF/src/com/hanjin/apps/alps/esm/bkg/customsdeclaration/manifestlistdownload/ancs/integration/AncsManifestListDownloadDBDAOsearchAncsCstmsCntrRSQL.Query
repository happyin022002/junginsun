<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AncsManifestListDownloadDBDAOsearchAncsCstmsCntrRSQL">
			<desc><![CDATA[s]]></desc>
			<sql><![CDATA[
SELECT CNTR.CNTR_NO ,
  CNTR.ANR_MSG_STS_CD ,
  DECODE(NVL(CNTR.ANR_MSG_STS_CD, 'N'), 'A', 'Y', 'N' ) AS BL_ACK ,
  CNTR.ORG_RCV_TERM_CD ,
  CNTR.DEST_DE_TERM_CD ,
  CNTR_LOG.SND_STS_CD || CNTR_LOG.RCV_STS_CD AS CNTR_LAST_EDI
--,DECODE(NVL(CNTR_LOG.SND_STS_CD, 'N') || NVL(CNTR_LOG.RCV_STS_CD, 'N'),'NN','Initial','ON','SENDING', 'OA', 'Sent', 'OE', 'Error(O)', 'CN','Cancelling','CA','Cancelled','CE','Error(C)') CNTR_LAST_EDI2
  ,CNTR_EDI_SND_RCV_STS.ATTR_CTNT2 AS CNTR_LAST_EDI2,
  CNTR.CNTR_TPSZ_CD ,
  CNTR.PCK_QTY ,
  CNTR.PCK_TP_CD ,
  CNTR.CNTR_WGT ,
  CNTR.WGT_UT_CD ,
  CNTR.BKG_NO ,
  CNTR.VSL_CD || CNTR.SKD_VOY_NO || CNTR.SKD_DIR_CD AS VVD
FROM BKG_CSTMS_ANR_BL BL,
  BKG_CSTMS_ANR_CNTR CNTR,
  (     SELECT BB.BKG_NO,
      BB.CNTR_NO,
      AA.EDI_SND_STS_CD AS SND_STS_CD,
      BB.EDI_RCV_STS_CD AS RCV_STS_CD
    FROM BKG_CSTMS_ANR_EDI_HIS AA,
      BKG_CSTMS_ANR_CNTR_LOG BB,
      (
        SELECT D.MSG_TP_CD,
          D.ANR_DECL_NO,
          D.BKG_NO,
          D.CNTR_NO,
          MAX(D.REF_SEQ) MAX_REF_SEQ
        FROM BKG_CSTMS_ANR_VVD A,
          BKG_CSTMS_ANR_BL B,
          BKG_CSTMS_ANR_EDI_HIS C,
          BKG_CSTMS_ANR_CNTR_LOG D
        WHERE 1=1
          AND B.VSL_CD = A.VSL_CD
          AND B.SKD_VOY_NO = A.SKD_VOY_NO
          AND B.SKD_DIR_CD = A.SKD_DIR_CD
          AND B.BL_NO = @[bl_no]
          AND C.MSG_TP_CD = 'C'
          AND C.ANR_DECL_NO = A.SVC_RQST_NO || A.LLOYD_TP_CD || A.LLOYD_NO
          AND D.MSG_TP_CD = C.MSG_TP_CD
          AND D.ANR_DECL_NO = C.ANR_DECL_NO
          AND D.REF_SEQ = C.REF_SEQ
          AND D.VSL_CD = B.VSL_CD
          AND D.SKD_VOY_NO = B.SKD_VOY_NO
          AND D.SKD_DIR_CD = B.SKD_DIR_CD
          AND D.BKG_NO = B.BKG_NO
        GROUP BY D.MSG_TP_CD, D.ANR_DECL_NO, D.BKG_NO, D.CNTR_NO) CC
    WHERE AA.MSG_TP_CD(+) = CC.MSG_TP_CD
      AND AA.ANR_DECL_NO(+) = CC.ANR_DECL_NO
      AND AA.REF_SEQ(+) = CC.MAX_REF_SEQ
      AND BB.MSG_TP_CD(+) = CC.MSG_TP_CD
      AND BB.ANR_DECL_NO(+) = CC.ANR_DECL_NO
      AND BB.REF_SEQ(+) = CC.MAX_REF_SEQ
      AND BB.BKG_NO(+) = CC.BKG_NO
      AND BB.CNTR_NO(+) = CC.CNTR_NO ) CNTR_LOG,
  BKG_HRD_CDG_CTNT CNTR_EDI_SND_RCV_STS
  , BKG_VVD A_VVD
WHERE BL.BL_NO = @[bl_no]
  AND BL.VSL_CD = CNTR.VSL_CD
  AND BL.SKD_VOY_NO = CNTR.SKD_VOY_NO
  AND BL.SKD_DIR_CD = CNTR.SKD_DIR_CD
  AND BL.BKG_NO = CNTR.BKG_NO
  AND CNTR_LOG.CNTR_NO (+) = CNTR.CNTR_NO

  AND BL.BL_NO = A_VVD.BKG_NO
  AND BL.VSL_CD = A_VVD.VSL_CD
  AND BL.SKD_VOY_NO = A_VVD.SKD_VOY_NO
  AND BL.SKD_DIR_CD = A_VVD.SKD_DIR_CD

  AND CNTR_EDI_SND_RCV_STS.HRD_CDG_ID(+) = 'ANR_CSTMS_EDI_STS_CD'
  AND CNTR_EDI_SND_RCV_STS.ATTR_CTNT1(+) = NVL(CNTR_LOG.SND_STS_CD, 'N') || NVL(CNTR_LOG.RCV_STS_CD, 'N')			]]></sql>
			<params>
				<param name="bl_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
