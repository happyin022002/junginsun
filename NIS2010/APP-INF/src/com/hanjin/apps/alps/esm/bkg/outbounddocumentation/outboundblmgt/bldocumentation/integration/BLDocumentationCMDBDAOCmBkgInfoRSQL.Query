<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLDocumentationCMDBDAOCmBkgInfoRSQL">
			<desc><![CDATA[select]]></desc>
			<sql><![CDATA[
#if (${ca_flg} == 'Y') 
SELECT A.BKG_NO
,      A.BL_NO || NVL(A.BL_TP_CD, DECODE(E.OBL_SRND_FLG, 'Y', 'S', NULL)) AS BL_NO
,      A.BL_TP_CD
,      A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD T_VVD
,      A.VSL_CD 
,      A.SKD_VOY_NO
,      A.SKD_DIR_CD
,      A.BKG_CGO_TP_CD
,      A.POR_CD
,      A.POL_CD
,      A.POD_CD
,      A.DEL_CD
,      A.PRE_RLY_PORT_CD
,      A.PST_RLY_PORT_CD
,      A.RCV_TERM_CD BKG_RCV_TERM_CD
,      A.DE_TERM_CD BKG_DE_TERM_CD
,      A.CMDT_CD
,      A.REP_CMDT_CD
,      A.BKG_STS_CD 
,      (SELECT CMDT_NM FROM MDM_COMMODITY WHERE CMDT_CD=A.CMDT_CD) CMDT_NM
,      B.BDR_FLG 
,      NVL2(B.CORR_NO, 'Y', 'N') CORR_FLG
,      'N' HTS_FLG
,      B.PCK_QTY BKG_PCK_QTY
,      B.PCK_TP_CD  BKG_PCK_UNIT
,      B.ACT_WGT BKG_WGT_QTY
,      B.WGT_UT_CD  BKG_WGT_UNIT
,      B.MEAS_QTY BKG_MEAS_QTY
,      B.MEAS_UT_CD BKG_MEAS_UNIT
,      C.CUST_CNT_CD SHPR_CNT_CD
,      C.CUST_SEQ SHPR_SEQ
,      C.CUST_NM SHPR_NM
,      D.CUST_CNT_CD CNEE_CNT_CD
,      D.CUST_SEQ CNEE_SEQ
,      D.CUST_NM CNEE_NM
,      (SELECT MK_DESC FROM BKG_BL_MK_DESC_HIS WHERE BKG_NO = A.BKG_NO AND CORR_NO='TMP0000001' AND MK_SEQ=1) BKG_MK_DESC
,      (SELECT CSTMS_DESC FROM BKG_BL_DOC_HIS WHERE BKG_NO = A.BKG_NO AND CORR_NO='TMP0000001') BKG_CSTMS_DESC
,      (SELECT 'Y' FROM BKG_VVD_HIS VVD WHERE VVD.BKG_NO = A.BKG_NO AND CORR_NO='TMP0000001'  AND VSL_PRE_PST_CD||VSL_SEQ<>'S1' AND POL_CD='MYPKG') MYPKG_FLG
,      (SELECT 'Y' FROM BKG_VVD_HIS VVD
        WHERE BKG_NO = A.BKG_NO 
          AND POL_CD = 'MYPKG'
          AND VVD.CORR_NO='TMP0000001'
          AND EXISTS (SELECT 'Y' FROM BKG_BKG_HIS BK WHERE BK.BKG_NO = VVD.BKG_NO AND BK.POL_CD <> 'MYPKG' AND BK.POD_CD <> 'MYPKG' AND BK.CORR_NO='TMP0000001')
          AND ROWNUM = 1 ) MYPKG_FLG
,      A.CRE_USR_ID
,      A.UPD_USR_ID
,	   DECODE((SELECT CONTI_CD FROM MDM_LOCATION WHERE LOC_CD = A.POD_CD),'E','Y','N') EUR_FLG
,	   (SELECT 'Y' 
          FROM BKG_VVD_HIS BK 
         WHERE BK.BKG_NO = A.BKG_NO
           AND BK.CORR_NO = 'TMP0000001'
           AND BK.POD_CD LIKE 'DE%'
           AND A.BKG_CGO_TP_CD = 'F'
           AND ROWNUM = 1
       ) DE_FLG
,	   (SELECT 'Y' 
          FROM BKG_HRD_CDG_CTNT HRD
         WHERE A.POD_CD LIKE HRD.ATTR_CTNT1 || '%'
           AND HRD.HRD_CDG_ID = 'HS_EU_CNT'
           AND A.BKG_CGO_TP_CD = 'F'
           AND ROWNUM = 1 
       ) HS_EU_FLG
,	  NVL((SELECT 'Y' 
          FROM BKG_VVD_HIS BK 
         WHERE BK.BKG_NO = A.BKG_NO
           AND BK.CORR_NO = 'TMP0000001'
           AND BK.POD_CD LIKE 'TR%'
           AND ROWNUM = 1 
       ),'N') TR_FLG
 ,  (SELECT CASE WHEN COUNT(1) > 0 THEN 'Y'
            ELSE 'N' END AS
       FROM	BKG_VVD_HIS VVD
      WHERE BKG_NO = A.BKG_NO
        AND VVD.CORR_NO = 'TMP0000001'
        AND	POD_CD IN 
       (SELECT	vps_port_cd --POD에 들리기 이전이라면
          FROM	vsk_vsl_port_skd
         WHERE	vsl_cd		= VVD.VSL_CD
           AND	skd_voy_no	= VVD.SKD_VOY_NO
           AND	skd_dir_cd	= VVD.SKD_DIR_CD
           AND	clpt_ind_seq= '1'
           AND	clpt_seq	>=
            (SELECT	MIN(clpt_seq) --처음 CANADA를 들리는 port가
               FROM	vsk_vsl_port_skd
              WHERE	vsl_cd		= VVD.VSL_CD
                AND	skd_voy_no	= VVD.SKD_VOY_NO
                AND	skd_dir_cd	= VVD.SKD_DIR_CD
                AND	vps_port_cd	LIKE 'US%'
                AND	nvl(skd_cng_sts_cd, ' ') <> 'S'
                AND	clpt_seq	>= 
                (SELECT	MAX(clpt_seq) --출항 port 이후에
                   FROM	vsk_vsl_port_skd
                  WHERE	vsl_cd		= VVD.VSL_CD
                    AND	skd_voy_no	= VVD.SKD_VOY_NO
                    AND	skd_dir_cd	= VVD.SKD_DIR_CD
                    AND	vps_port_cd	LIKE VVD.POL_CD 
                    AND	nvl(skd_cng_sts_cd, ' ') <> 'S') ) )
       AND SUBSTR(VVD.POL_CD, 1, 2) <> 'US'--POL이 CANADA일 때는 제외
       AND SUBSTR(VVD.POD_CD, 1, 2) <> 'US'--POD가 CANADA일 때는 제외  
      ) AS US_FROB_FLG  
     ,NVL(( SELECT 'Y'
              FROM DUAL
             WHERE A.POD_CD like 'RU%'
               AND (SUBSTR(A.POR_CD,1,2) IN ('US','CA', 'AU')
               OR SUBSTR(A.POR_CD,1,2) IN (SELECT A.CNT_CD
                                            FROM MDM_COUNTRY A
                                               , MDM_SUBCONTINENT B
                                               , MDM_CONTINENT C
                                            WHERE 1 = 1 
                                            AND A.SCONTI_CD=B.SCONTI_CD 
                                            AND B.CONTI_CD=C.CONTI_CD
                                            AND NVL(A.DELT_FLG,'N') <> 'Y'
                                            AND NVL(B.DELT_FLG,'N') <> 'Y'
                                            AND NVL(C.DELT_FLG,'N') <> 'Y'
                                            AND UPPER(B.CONTI_CD) LIKE UPPER('E') || '%'))),'N') RU_FLG 
FROM   BKG_BKG_HIS A, BKG_BL_DOC_HIS B, BKG_CUST_HIS C, BKG_CUST_HIS D, BKG_BL_ISS_HIS E
WHERE  B.BKG_NO = A.BKG_NO
AND    B.CORR_NO = 'TMP0000001'
AND    C.BKG_NO = A.BKG_NO
AND    C.CORR_NO = 'TMP0000001'
AND    C.BKG_CUST_TP_CD = 'S'
AND    D.BKG_NO = A.BKG_NO
AND    D.CORR_NO = 'TMP0000001'
AND    D.BKG_CUST_TP_CD = 'C'
AND    E.BKG_NO(+) = A.BKG_NO
AND    E.CORR_NO(+) = A.CORR_NO
AND    A.BKG_NO = @[bkg_no]
AND    A.CORR_NO = 'TMP0000001'
#else 
SELECT A.BKG_NO
,      A.BL_NO || NVL(A.BL_TP_CD, DECODE(E.OBL_SRND_FLG, 'Y', 'S', NULL)) AS BL_NO
,      A.BL_TP_CD
,      A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD T_VVD
,      A.VSL_CD
,      A.SKD_VOY_NO
,      A.SKD_DIR_CD
,      A.BKG_CGO_TP_CD
,      A.POR_CD
,      A.POL_CD
,      A.POD_CD
,      A.DEL_CD
,      A.PRE_RLY_PORT_CD
,      A.PST_RLY_PORT_CD
,      A.RCV_TERM_CD BKG_RCV_TERM_CD
,      A.DE_TERM_CD BKG_DE_TERM_CD
,      A.CMDT_CD
,      A.REP_CMDT_CD
,      A.BKG_STS_CD 
,      (SELECT CMDT_NM FROM MDM_COMMODITY WHERE CMDT_CD=A.CMDT_CD) CMDT_NM
,      B.BDR_FLG 
,      NVL2(B.CORR_NO, 'Y', 'N') CORR_FLG
,      'N' HTS_FLG
,      B.PCK_QTY BKG_PCK_QTY
,      B.PCK_TP_CD  BKG_PCK_UNIT
,      B.ACT_WGT BKG_WGT_QTY
,      B.WGT_UT_CD  BKG_WGT_UNIT
,      B.MEAS_QTY BKG_MEAS_QTY
,      B.MEAS_UT_CD BKG_MEAS_UNIT
,      C.CUST_CNT_CD SHPR_CNT_CD
,      C.CUST_SEQ SHPR_SEQ
,      C.CUST_NM SHPR_NM
,      D.CUST_CNT_CD CNEE_CNT_CD
,      D.CUST_SEQ CNEE_SEQ
,      D.CUST_NM CNEE_NM
,      (SELECT MK_DESC FROM BKG_BL_MK_DESC WHERE BKG_NO = A.BKG_NO AND MK_SEQ = 1) BKG_MK_DESC
,      (SELECT CSTMS_DESC FROM BKG_BL_DOC WHERE BKG_NO = A.BKG_NO) BKG_CSTMS_DESC
,      (SELECT 'Y' FROM BKG_VVD VVD
        WHERE BKG_NO = A.BKG_NO 
          AND POL_CD = 'MYPKG'
          AND EXISTS (SELECT 'Y' FROM BKG_BOOKING BK WHERE BK.BKG_NO = VVD.BKG_NO AND BK.POL_CD <> 'MYPKG' AND BK.POD_CD <> 'MYPKG')
          AND ROWNUM = 1 ) MYPKG_FLG
,      A.CRE_USR_ID
,      A.UPD_USR_ID
,	   DECODE((SELECT CONTI_CD FROM MDM_LOCATION WHERE LOC_CD = A.POD_CD),'E','Y','N') EUR_FLG
,	   (SELECT 'Y' 
          FROM BKG_VVD BK 
         WHERE BK.BKG_NO = A.BKG_NO
           AND BK.POD_CD LIKE 'DE%'
           AND A.BKG_CGO_TP_CD = 'F'
           AND ROWNUM = 1 
       ) DE_FLG
,	   (SELECT 'Y' 
          FROM BKG_HRD_CDG_CTNT HRD
         WHERE A.POD_CD LIKE HRD.ATTR_CTNT1 || '%'
           AND HRD.HRD_CDG_ID = 'HS_EU_CNT'
           AND A.BKG_CGO_TP_CD = 'F'
           AND ROWNUM = 1 
       ) HS_EU_FLG
,	  NVL((SELECT 'Y' 
          FROM BKG_VVD BK 
         WHERE BK.BKG_NO = A.BKG_NO
           AND BK.POD_CD LIKE 'TR%'
           AND ROWNUM = 1 
       ),'N') TR_FLG
 ,  (SELECT CASE WHEN COUNT(1) > 0 THEN 'Y'
            ELSE 'N' END AS
       FROM	BKG_VVD VVD
      WHERE BKG_NO = A.BKG_NO
        AND	POD_CD IN 
       (SELECT	vps_port_cd --POD에 들리기 이전이라면
          FROM	vsk_vsl_port_skd
         WHERE	vsl_cd		= VVD.VSL_CD
           AND	skd_voy_no	= VVD.SKD_VOY_NO
           AND	skd_dir_cd	= VVD.SKD_DIR_CD
           AND	clpt_ind_seq= '1'
           AND	clpt_seq	>=
            (SELECT	MIN(clpt_seq) --처음 CANADA를 들리는 port가
               FROM	vsk_vsl_port_skd
              WHERE	vsl_cd		= VVD.VSL_CD
                AND	skd_voy_no	= VVD.SKD_VOY_NO
                AND	skd_dir_cd	= VVD.SKD_DIR_CD
                AND	vps_port_cd	LIKE 'US%'
                AND	nvl(skd_cng_sts_cd, ' ') <> 'S'
                AND	clpt_seq	>= 
                (SELECT	MAX(clpt_seq) --출항 port 이후에
                   FROM	vsk_vsl_port_skd
                  WHERE	vsl_cd		= VVD.VSL_CD
                    AND	skd_voy_no	= VVD.SKD_VOY_NO
                    AND	skd_dir_cd	= VVD.SKD_DIR_CD
                    AND	vps_port_cd	LIKE VVD.POL_CD 
                    AND	nvl(skd_cng_sts_cd, ' ') <> 'S') ) )
       AND SUBSTR(VVD.POL_CD, 1, 2) <> 'US'--POL이 CANADA일 때는 제외
       AND SUBSTR(VVD.POD_CD, 1, 2) <> 'US'--POD가 CANADA일 때는 제외  
      ) AS US_FROB_FLG    
     ,NVL(( SELECT 'Y'
              FROM DUAL
             WHERE A.POD_CD like 'RU%'
               AND (SUBSTR(A.POR_CD,1,2) IN ('US','CA', 'AU')
               OR SUBSTR(A.POR_CD,1,2) IN (SELECT A.CNT_CD
                                            FROM MDM_COUNTRY A
                                               , MDM_SUBCONTINENT B
                                               , MDM_CONTINENT C
                                            WHERE 1 = 1 
                                            AND A.SCONTI_CD=B.SCONTI_CD 
                                            AND B.CONTI_CD=C.CONTI_CD
                                            AND NVL(A.DELT_FLG,'N') <> 'Y'
                                            AND NVL(B.DELT_FLG,'N') <> 'Y'
                                            AND NVL(C.DELT_FLG,'N') <> 'Y'
                                            AND UPPER(B.CONTI_CD) LIKE UPPER('E') || '%'))),'N') RU_FLG   
FROM   BKG_BOOKING A, BKG_BL_DOC B, BKG_CUSTOMER C, BKG_CUSTOMER D, BKG_BL_ISS E
WHERE  B.BKG_NO = A.BKG_NO
AND    C.BKG_NO = A.BKG_NO
AND    C.BKG_CUST_TP_CD = 'S'
AND    D.BKG_NO = A.BKG_NO
AND    D.BKG_CUST_TP_CD = 'C'
AND    E.BKG_NO(+) = A.BKG_NO
AND    A.BKG_NO = @[bkg_no]
#end			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
