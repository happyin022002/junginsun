<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="NetworkCostDBDAOAverageUCVesselUtMergeUSQL">
			<desc><![CDATA[ESM_MAS_0335에서 UPDATE 시 호출]]></desc>
			<sql><![CDATA[
MERGE INTO MAS_POOL_UT_COST M1 USING
(SELECT COST_YRMON
      , STND_COST_CD
      , TRD_CD
      , SUB_TRD_CD
      , RLANE_CD
      , DIR_CD
      , HUL_BND_CD
      , MIN(EFF_FM_YRMON) AS EFF_FM_YRMON
      , MAX(EFF_TO_YRMON) AS EFF_TO_YRMON
      , NVL(SUM(TTL_AMT), 0) AS TTL_AMT
      , NVL(SUM(VVD_BSA_CAPA), 0) AS TGT_LOD_QTY
      , DECODE(NVL(SUM(VVD_BSA_CAPA), 0), 0, 0, NVL(SUM(TTL_AMT), 0)/NVL(SUM(VVD_BSA_CAPA), 0)) AS TEU_UC_AMT
      , @[upd_usr_id] UPD_USR_ID
      , SYSDATE UPD_DT
   FROM MAS_POOL_UT_COST_DTL
  WHERE COST_YRMON   = REPLACE(@[cost_yrmon], '-', '')
    AND STND_COST_CD = @[stnd_cost_cd]
    AND TRD_CD       = @[trd_cd]
    AND SUB_TRD_CD   = @[sub_trd_cd]
    AND RLANE_CD     = @[rlane_cd]
    AND DIR_CD       = @[dir_cd]
GROUP BY COST_YRMON
      , STND_COST_CD
      , TRD_CD
      , SUB_TRD_CD
      , RLANE_CD
      , DIR_CD
      , HUL_BND_CD
) S1 
ON (   M1.COST_YRMON    = S1.COST_YRMON 
   AND M1.STND_COST_CD  = S1.STND_COST_CD 
   AND M1.TRD_CD        = S1.TRD_CD 
   AND M1.SUB_TRD_CD    = S1.SUB_TRD_CD 
   AND M1.RLANE_CD      = S1.RLANE_CD 
   AND M1.DIR_CD        = S1.DIR_CD )
WHEN MATCHED THEN
         UPDATE
            SET M1.HUL_BND_CD   = S1.HUL_BND_CD
              , M1.EFF_FM_YRMON = S1.EFF_FM_YRMON
              , M1.EFF_TO_YRMON = S1.EFF_TO_YRMON
              , M1.TTL_AMT      = S1.TTL_AMT
              , M1.TGT_LOD_QTY  = S1.TGT_LOD_QTY
              , M1.TEU_UC_AMT   = S1.TEU_UC_AMT
              , M1.UPD_USR_ID   = S1.UPD_USR_ID
              , M1.UPD_DT       = S1.UPD_DT			]]></sql>
			<params>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="cost_yrmon" type="12" value="" out="N"/>
				<param name="stnd_cost_cd" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="sub_trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
