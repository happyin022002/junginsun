<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UnmatchBLDBDAOSearchStopOffBkgListforAuditRSQL">
			<desc><![CDATA[UI_BKG_1405 화면에서 사용하는 SQL]]></desc>
			<sql><![CDATA[
SELECT B.BKG_NO,
       S.CUST_CNT_CD||LPAD(S.CUST_SEQ,6,'0') SHPR_CD,
       NVL((SELECT CUST_LGL_ENG_NM 
        FROM MDM_CUSTOMER 
        WHERE CUST_CNT_CD = S.CUST_CNT_CD 
        AND CUST_SEQ = S.CUST_SEQ
       ),' ')  AS SHPR_NM, /* 머지 위해 공백 추가 */
       NVL(R.BKG_CTRT_TP_CD,' ') AS BKG_CTRT_TP_CD,  /* Contract Type. Hidden (R : RFA, S : S/C, T : TARIFF) */
       NVL(CASE WHEN R.BKG_CTRT_TP_CD = 'R' THEN B.RFA_NO
            WHEN R.BKG_CTRT_TP_CD = 'S' THEN B.SC_NO
            WHEN R.BKG_CTRT_TP_CD = 'T' THEN B.TAA_NO
       END,' ') AS CTRT_NO,
       NVL(B.SVC_SCP_CD,' ') AS SVC_SCP_CD, 
       B.POR_CD,
       B.POL_CD,
       B.POD_CD,
       B.DEL_CD,
       NVL((SELECT CMDT_NM FROM MDM_COMMODITY WHERE CMDT_CD = B.CMDT_CD),' ') CMDT_NM, /* 머지 위해 공백 추가 */
       NVL(B.STOP_OFF_LOC_CD,' ')   AS STOP_OFF_LOC_CD,
       NVL(B.STOP_OFF_DIFF_RMK,' ') AS STOP_OFF_DIFF_RMK,
       NVL(B.INTER_RMK,' ')         AS INTER_RMK,
       NVL(B.XTER_RMK,' ')          AS XTER_RMK,
       NVL(R.RT_INTER_RMK,' ')      AS RT_INTER_RMK,
       NVL(R.DIFF_RMK,' ')          AS DIFF_RMK,
       C.CHG_CD, 
       C.CURR_CD,
       C.RAT_UT_CD,
       C.RAT_AS_QTY,
       C.CHG_UT_AMT,
       C.CHG_AMT
FROM BKG_RATE R 
     JOIN BKG_BOOKING B ON ( R.BKG_NO = B.BKG_NO
                             AND B.BKG_STS_CD <> 'X'
                             AND B.BKG_CGO_TP_CD = 'F'
                             AND B.STOP_OFF_LOC_CD IS NOT NULL  -- Stop Off 정보가 있는 BKG만 조회

                            )
                            
     JOIN BKG_CUSTOMER S ON ( R.BKG_NO = S.BKG_NO
                              AND S.BKG_CUST_TP_CD = 'S'
                             )
                             
     LEFT OUTER JOIN BKG_CHG_RT C ON ( R.BKG_NO = C.BKG_NO
                                       AND CHG_CD IN ('MIS','MSC')
                                       AND FRT_INCL_XCLD_DIV_CD = 'N'
                                     )
WHERE R.RT_APLY_DT BETWEEN TO_DATE(REPLACE(@[fm_dt],'-',''), 'YYYYMMDD') AND TO_DATE(REPLACE(@[to_dt],'-',''), 'YYYYMMDD') + 0.99999			]]></sql>
			<params>
				<param name="fm_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
