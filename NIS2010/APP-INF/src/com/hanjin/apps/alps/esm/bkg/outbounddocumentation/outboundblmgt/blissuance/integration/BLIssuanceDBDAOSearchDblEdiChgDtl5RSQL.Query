<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLIssuanceDBDAOSearchDblEdiChgDtl5RSQL">
			<desc><![CDATA[BLIssuanceDBDAOSearchDblEdiChgDtl5RSQL]]></desc>
			<sql><![CDATA[
SELECT 
        '{CHARGE_TTL' || CHR(10)
       || 'PPD_TOTAL:' || SUM(PPD) || CHR(10) 
       || 'CCT_TOTAL:' || SUM(CCT) || CHR(10) 
       || 'TOTAL_CUR:' || CURR || CHR(10) 
       || 'LCL_TOT_AMT:' || CHR(10) 
       || 'CGO_RCV_DT:'  || CHR(10) 
       || 'ACT_CUST:' || CHR(10) 
       || '}CHARGE_TTL' || CHR(10)
FROM (       
SELECT 
       DECODE(IO_BND_CD, 'O', ROUND(CHG.CHG_AMT/DECODE(CHG.CURR_CD,'USD',1,DECODE(NVL(USD_XCH_RT,1),0,1,NVL(USD_XCH_RT,1))),2), 0) PPD,
       0 CCT, 
       DECODE(NVL(MN.USD_XCH_RT,1),0,CHG.CURR_CD,1,CHG.CURR_CD,'USD') CURR 
FROM   INV_AR_MN MN,
       INV_AR_CHG CHG
WHERE  MN.AR_IF_NO = CHG.AR_IF_NO
AND    MN.BL_SRC_NO = @[bkg_no]
AND    NVL(MN.INV_DELT_DIV_CD, 'N') <> 'Y'
AND    MN.REV_TP_CD <> 'M'
)
WHERE PPD <> 0 
GROUP BY CURR
UNION ALL
SELECT 
        '{CHARGE_TTL' || CHR(10)
       || 'PPD_TOTAL:' || SUM(PPD) || CHR(10) 
       || 'CCT_TOTAL:' || SUM(CCT) || CHR(10) 
       || 'TOTAL_CUR:' || CURR || CHR(10) 
       || 'LCL_TOT_AMT:' || CHR(10) 
       || 'CGO_RCV_DT:'  || CHR(10) 
       || 'ACT_CUST:' || CHR(10) 
       || '}CHARGE_TTL' || CHR(10)
FROM (       
SELECT 
       0 PPD,
       DECODE(IO_BND_CD, 'I', ROUND(CHG.CHG_AMT/DECODE(CHG.CURR_CD,'USD',1,DECODE(NVL(USD_XCH_RT,1),0,1,NVL(USD_XCH_RT,1))),2), 0) CCT, 
       DECODE(NVL(MN.USD_XCH_RT,1),0,CHG.CURR_CD,1,CHG.CURR_CD,'USD') CURR 
FROM   INV_AR_MN MN,
       INV_AR_CHG CHG
WHERE  MN.AR_IF_NO = CHG.AR_IF_NO
AND    MN.BL_SRC_NO = @[bkg_no]
AND    NVL(MN.INV_DELT_DIV_CD, 'N') <> 'Y'
AND    MN.REV_TP_CD <> 'M'
)
WHERE CCT <> 0 
GROUP BY CURR			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
