<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="FmsFileUploadDBDAOSearchAtchFileLnkIdRSQL">
			<desc><![CDATA[첨부파일 ID 조회]]></desc>
			<sql><![CDATA[
#if(${vnor_itm_seq} != '')
    SELECT CASE WHEN (
                        SELECT COUNT(D2.ATCH_FILE_FLET_LNK_ID) 
                        FROM FMS_VNOR_ITM D2
                        WHERE 1=1
                        AND D2.VSL_CD = @[vsl_cd]
                        AND D2.VNOR_SEQ = @[vnor_seq]
                        AND D2.VNOR_ITM_SEQ = @[vnor_itm_seq]
                     ) > 0 AND F.ATCH_FILE_LNK_ID IS NOT NULL THEN F.ATCH_FILE_LNK_ID
                ELSE (
                        SELECT 
                           '0090_'|| NVL((SELECT LPAD(MAX(SUBSTR(ATCH_FILE_LNK_ID, 6)) + 1, 5, 0) 
                                       FROM FMS_ATCH_FILE 
                                      WHERE ATCH_FILE_LNK_ID LIKE '0090%'
                                     ), '00001')  
                        FROM DUAL  
                     )
                END ATCH_FILE_LNK_ID
    FROM FMS_VNOR_ITM D, FMS_ATCH_FILE F
    WHERE 1=1
    AND D.VSL_CD = @[vsl_cd]
    AND D.VNOR_SEQ = @[vnor_seq]
    AND D.VNOR_ITM_SEQ = @[vnor_itm_seq]
    AND D.ATCH_FILE_FLET_LNK_ID = F.ATCH_FILE_LNK_ID(+)
    AND ROWNUM = 1
#else
    SELECT CASE WHEN (
                        SELECT COUNT(D2.ATCH_FILE_FLET_LNK_ID) 
                        FROM FMS_BUNKER D2
                        WHERE 1=1
                        AND D2.FLET_CTRT_NO = @[vsl_cd]
                        AND D2.BNK_SEQ = @[vnor_seq]
                     ) > 0 AND F.ATCH_FILE_LNK_ID IS NOT NULL THEN F.ATCH_FILE_LNK_ID
                ELSE (
                        SELECT 
                           '0050_'|| NVL((SELECT LPAD(MAX(SUBSTR(ATCH_FILE_LNK_ID, 6)) + 1, 5, 0) 
                                       FROM FMS_ATCH_FILE 
                                      WHERE ATCH_FILE_LNK_ID LIKE '0050%'
                                     ), '00001')  
                        FROM DUAL   
                     )
                END ATCH_FILE_LNK_ID
    FROM FMS_BUNKER D, FMS_ATCH_FILE F
    WHERE 1=1
    AND D.FLET_CTRT_NO = @[vsl_cd]
    AND D.BNK_SEQ = @[vnor_seq]
    AND D.ATCH_FILE_FLET_LNK_ID = F.ATCH_FILE_LNK_ID(+)
    AND ROWNUM = 1
#end			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="vnor_seq" type="12" value="" out="N"/>
				<param name="vnor_itm_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
