<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RFARateQuotationDBDAORsltPriRqRtCmdtRoutVORSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
SELECT  A2.QTTN_NO
,       A2.QTTN_VER_NO
,       A2.CMDT_HDR_SEQ
,       A2.ROUT_SEQ
,       A2.ORG_ROUT_PNT_LOC_DEF_CD            
,       A2.ORG_ROUT_VIA_PORT_DEF_CD          
,       A2.DEST_ROUT_VIA_PORT_DEF_CD         
,       A2.DEST_ROUT_PNT_LOC_DEF_CD           
,		@[src_info_cd] || '.' || ROWNUM AS SEQ
,		A2.ORG_CY_DOR_RT_TP_CD
,		A2.DEST_CY_DOR_RT_TP_CD	
,		A2.ORG_BSE_PORT_LOC_CD
,		A2.DEST_BSE_PORT_LOC_CD	
FROM	(		
		SELECT  A1.QTTN_NO
		,       A1.QTTN_VER_NO
		,       A1.CMDT_HDR_SEQ
		,       A1.ROUT_SEQ
		,       B1.ROUT_PNT_LOC_DEF_CD AS ORG_ROUT_PNT_LOC_DEF_CD            --ORIGIN PNT
		,       C1.ROUT_VIA_PORT_DEF_CD AS ORG_ROUT_VIA_PORT_DEF_CD          --ORIGIN VIA
		,       D1.ROUT_VIA_PORT_DEF_CD AS DEST_ROUT_VIA_PORT_DEF_CD         --DEST VIA
		,       E1.ROUT_PNT_LOC_DEF_CD AS DEST_ROUT_PNT_LOC_DEF_CD           --DEST PNT
		,		A1.ORG_CY_DOR_RT_TP_CD
		,		A1.DEST_CY_DOR_RT_TP_CD
		,		B1.ORG_BSE_PORT_LOC_CD
		,		E1.DEST_BSE_PORT_LOC_CD
		FROM
		        PRI_RQ_RT_CMDT_ROUT A1
		        , (
		        --ORIGIN POINT
		        SELECT  QTTN_NO
		        ,       QTTN_VER_NO
		        ,       CMDT_HDR_SEQ
		        ,       ROUT_SEQ
		        ,       ORG_DEST_TP_CD
		        ,       SUBSTR(MAX(SYS_CONNECT_BY_PATH(ROUT_PNT_LOC_DEF_CD, ',')),2) AS ROUT_PNT_LOC_DEF_CD
		        ,       SUBSTR(MAX(SYS_CONNECT_BY_PATH(BSE_PORT_LOC_CD, ',')),2) AS ORG_BSE_PORT_LOC_CD
		        FROM    (
		                SELECT  A.QTTN_NO
		                ,       A.QTTN_VER_NO
		                ,       A.CMDT_HDR_SEQ
		                ,       A.ROUT_SEQ
		                ,       A.ORG_DEST_TP_CD
		                ,       ROUT_PNT_LOC_TP_CD
						,       A.ROUT_PNT_LOC_DEF_CD
					    ,		A.BSE_PORT_LOC_CD
		                ,       ROW_NUMBER() OVER(PARTITION BY A.QTTN_NO, A.QTTN_VER_NO, A.CMDT_HDR_SEQ, A.ROUT_SEQ, A.ORG_DEST_TP_CD
		                        ORDER BY DECODE(A.ROUT_PNT_LOC_TP_CD, 'C','1','R','2','G','3','L','4'),  A.ROUT_PNT_LOC_DEF_CD,
		                                        A.QTTN_NO, A.QTTN_VER_NO, A.CMDT_HDR_SEQ, A.ROUT_SEQ) AS RN
		                FROM    PRI_RQ_RT_ROUT_PNT A
		                WHERE   1=1
		                AND   A.QTTN_NO = @[qttn_no]
		                AND   A.QTTN_VER_NO = @[qttn_ver_no]
		                AND   A.CMDT_HDR_SEQ = @[cmdt_hdr_seq]
		                AND   A.ORG_DEST_TP_CD = 'O'
		        )
		        START WITH RN = 1
		        CONNECT BY PRIOR ROUT_SEQ = ROUT_SEQ
		        AND PRIOR RN = RN - 1
		        GROUP BY QTTN_NO
		        ,        QTTN_VER_NO
		        ,        CMDT_HDR_SEQ
		        ,        ROUT_SEQ
		        ,        ORG_DEST_TP_CD
		        ) B1
		        ,       (
		        --ORIGIN VIA
		        SELECT  QTTN_NO
		        ,       QTTN_VER_NO
		        ,       CMDT_HDR_SEQ
		        ,       ROUT_SEQ
		        ,       ORG_DEST_TP_CD
		        ,       SUBSTR(MAX(SYS_CONNECT_BY_PATH(ROUT_VIA_PORT_DEF_CD, ',')),2) AS ROUT_VIA_PORT_DEF_CD
		        FROM    (
		                SELECT  A.QTTN_NO
		                ,       A.QTTN_VER_NO
		                ,       A.CMDT_HDR_SEQ
		                ,       A.ROUT_SEQ
		                ,       A.ORG_DEST_TP_CD
		                ,       A.ROUT_VIA_PORT_DEF_CD
		                ,       ROW_NUMBER() OVER(PARTITION BY A.QTTN_NO, A.QTTN_VER_NO, A.CMDT_HDR_SEQ, A.ROUT_SEQ, A.ORG_DEST_TP_CD
		                        ORDER BY DECODE(A.ROUT_VIA_PORT_TP_CD, 'C','1','R','2','G','3','L','4'),  A.ROUT_VIA_PORT_DEF_CD,
		                                        A.QTTN_NO, A.QTTN_VER_NO, A.CMDT_HDR_SEQ, A.ROUT_SEQ) AS RN
		                FROM    PRI_RQ_RT_ROUT_VIA A
		                WHERE   1=1
		                AND   A.QTTN_NO = @[qttn_no]
		                AND   A.QTTN_VER_NO = @[qttn_ver_no]
		                AND   A.CMDT_HDR_SEQ = @[cmdt_hdr_seq]
		                AND   A.ORG_DEST_TP_CD = 'O'
		        )
		        START WITH RN = 1
		        CONNECT BY PRIOR ROUT_SEQ = ROUT_SEQ
		        AND PRIOR RN = RN - 1
		        GROUP BY QTTN_NO
		        ,        QTTN_VER_NO
		        ,        CMDT_HDR_SEQ
		        ,        ROUT_SEQ
		        ,        ORG_DEST_TP_CD
		        ) C1
		        ,       (
		        --DEST VIA
		        SELECT  QTTN_NO
		        ,       QTTN_VER_NO
		        ,       CMDT_HDR_SEQ
		        ,       ROUT_SEQ
		        ,       ORG_DEST_TP_CD
		        ,       SUBSTR(MAX(SYS_CONNECT_BY_PATH(ROUT_VIA_PORT_DEF_CD, ',')),2) AS ROUT_VIA_PORT_DEF_CD
		        FROM    (
		                SELECT  A.QTTN_NO
		                ,       A.QTTN_VER_NO
		                ,       A.CMDT_HDR_SEQ
		                ,       A.ROUT_SEQ
		                ,       A.ORG_DEST_TP_CD
		                ,       A.ROUT_VIA_PORT_DEF_CD
		                ,       ROW_NUMBER() OVER(PARTITION BY A.QTTN_NO, A.QTTN_VER_NO, A.CMDT_HDR_SEQ, A.ROUT_SEQ, A.ORG_DEST_TP_CD
		                        ORDER BY DECODE(A.ROUT_VIA_PORT_TP_CD, 'C','1','R','2','G','3','L','4'),  A.ROUT_VIA_PORT_DEF_CD,
		                                        A.QTTN_NO, A.QTTN_VER_NO, A.CMDT_HDR_SEQ, A.ROUT_SEQ) AS RN
		                FROM    PRI_RQ_RT_ROUT_VIA A
		                WHERE   1=1
		                AND   A.QTTN_NO = @[qttn_no]
		                AND   A.QTTN_VER_NO = @[qttn_ver_no]
		                AND   A.CMDT_HDR_SEQ = @[cmdt_hdr_seq]
		                AND   A.ORG_DEST_TP_CD = 'D'
		        )
		        START WITH RN = 1
		        CONNECT BY PRIOR ROUT_SEQ = ROUT_SEQ
		        AND PRIOR RN = RN - 1
		        GROUP BY QTTN_NO
		        ,        QTTN_VER_NO
		        ,        CMDT_HDR_SEQ
		        ,        ROUT_SEQ
		        ,        ORG_DEST_TP_CD
		        ) D1
		        ,       (
		        --DEST POINT
		        SELECT  QTTN_NO
		        ,       QTTN_VER_NO
		        ,       CMDT_HDR_SEQ
		        ,       ROUT_SEQ
		        ,       ORG_DEST_TP_CD
		        ,       SUBSTR(MAX(SYS_CONNECT_BY_PATH(ROUT_PNT_LOC_DEF_CD, ',')),2) AS ROUT_PNT_LOC_DEF_CD
		        ,       SUBSTR(MAX(SYS_CONNECT_BY_PATH(BSE_PORT_LOC_CD, ',')),2) AS DEST_BSE_PORT_LOC_CD
		        FROM    (
		                SELECT  A.QTTN_NO
		                ,       A.QTTN_VER_NO
		                ,       A.CMDT_HDR_SEQ
		                ,       A.ROUT_SEQ
		                ,       A.ORG_DEST_TP_CD
		                ,       ROUT_PNT_LOC_TP_CD
						,		A.ROUT_PNT_LOC_DEF_CD
					    ,		A.BSE_PORT_LOC_CD
		                ,       ROW_NUMBER() OVER(PARTITION BY A.QTTN_NO, A.QTTN_VER_NO, A.CMDT_HDR_SEQ, A.ROUT_SEQ, A.ORG_DEST_TP_CD
		                        ORDER BY DECODE(A.ROUT_PNT_LOC_TP_CD, 'C','1','R','2','G','3','L','4'),  A.ROUT_PNT_LOC_DEF_CD,
		                                        A.QTTN_NO, A.QTTN_VER_NO, A.CMDT_HDR_SEQ, A.ROUT_SEQ) AS RN
		                FROM    PRI_RQ_RT_ROUT_PNT A
		                WHERE   1=1
		                AND   A.QTTN_NO = @[qttn_no]
		                AND   A.QTTN_VER_NO = @[qttn_ver_no]
		                AND   A.CMDT_HDR_SEQ = @[cmdt_hdr_seq]
		                AND   A.ORG_DEST_TP_CD = 'D'
		        )
		        START WITH RN = 1
		        CONNECT BY PRIOR ROUT_SEQ = ROUT_SEQ
		        AND PRIOR RN = RN - 1
		        GROUP BY QTTN_NO
		        ,        QTTN_VER_NO
		        ,        CMDT_HDR_SEQ
		        ,        ROUT_SEQ
		        ,        ORG_DEST_TP_CD
		        ) E1
		WHERE   A1.QTTN_NO = B1.QTTN_NO(+)
		AND     A1.QTTN_VER_NO = B1.QTTN_VER_NO(+)
		AND     A1.CMDT_HDR_SEQ = B1.CMDT_HDR_SEQ(+)
		AND     A1.ROUT_SEQ = B1.ROUT_SEQ(+)
		
		AND     A1.QTTN_NO = C1.QTTN_NO(+)
		AND     A1.QTTN_VER_NO = C1.QTTN_VER_NO(+)
		AND     A1.CMDT_HDR_SEQ = C1.CMDT_HDR_SEQ(+)
		AND     A1.ROUT_SEQ = C1.ROUT_SEQ(+)
		
		AND     A1.QTTN_NO = D1.QTTN_NO(+)
		AND     A1.QTTN_VER_NO = D1.QTTN_VER_NO(+)
		AND     A1.CMDT_HDR_SEQ = D1.CMDT_HDR_SEQ(+)
		AND     A1.ROUT_SEQ = D1.ROUT_SEQ(+)
		
		AND     A1.QTTN_NO = E1.QTTN_NO(+)
		AND     A1.QTTN_VER_NO = E1.QTTN_VER_NO(+)
		AND     A1.CMDT_HDR_SEQ = E1.CMDT_HDR_SEQ(+)
		AND     A1.ROUT_SEQ = E1.ROUT_SEQ(+)
		
		AND     A1.QTTN_NO = @[qttn_no]
		AND     A1.QTTN_VER_NO = @[qttn_ver_no]
		AND     A1.CMDT_HDR_SEQ = @[cmdt_hdr_seq]
		
		ORDER BY A1.ROUT_SEQ
		) A2			]]></sql>
			<params>
				<param name="src_info_cd" type="12" value="" out="N"/>
				<param name="qttn_no" type="12" value="" out="N"/>
				<param name="qttn_ver_no" type="12" value="" out="N"/>
				<param name="cmdt_hdr_seq" type="2" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
