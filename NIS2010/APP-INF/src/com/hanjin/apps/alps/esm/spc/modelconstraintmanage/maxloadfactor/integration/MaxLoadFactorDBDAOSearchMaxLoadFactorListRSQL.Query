<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MaxLoadFactorDBDAOSearchMaxLoadFactorListRSQL">
			<desc><![CDATA[MAX L/F 데이터 조회]]></desc>
			<sql><![CDATA[
  SELECT /*+ INDEX(B) */
         A.TRD_CD          AS TRD_CD    ,
         A.SUB_TRD_CD      AS SUB_TRD_CD,
         A.RLANE_CD        AS RLANE_CD  ,
         A.VSL_SLAN_DIR_CD AS DIR_CD    ,
         DECODE(B.BSE_YR, NULL, 100, MAX(DECODE(B.VOY_DIFF_WK, '01', B.MAX_LDF_RTO))) AS LDF_01,
         DECODE(B.BSE_YR, NULL, 100, MAX(DECODE(B.VOY_DIFF_WK, '02', B.MAX_LDF_RTO))) AS LDF_02,
         DECODE(B.BSE_YR, NULL, 100, MAX(DECODE(B.VOY_DIFF_WK, '03', B.MAX_LDF_RTO))) AS LDF_03,
         DECODE(B.BSE_YR, NULL, 100, MAX(DECODE(B.VOY_DIFF_WK, '04', B.MAX_LDF_RTO))) AS LDF_04,
         DECODE(B.BSE_YR, NULL, 100, MAX(DECODE(B.VOY_DIFF_WK, '05', B.MAX_LDF_RTO))) AS LDF_05,
         DECODE(B.BSE_YR, NULL, 'I', 'R') AS STAT_CD,
         'Y'      AS PROTECT_FLG,
          @[year] AS BSE_YR
    FROM (
            SELECT /*+ INDEX(BB) INDEX(CC) */
                   DISTINCT
                   BB.TRD_CD         ,
                   BB.SUB_TRD_CD     ,
                   AA.RLANE_CD       ,
                   BB.VSL_SLAN_DIR_CD,
                   AA.DELT_FLG
              FROM MDM_REV_LANE     AA,
                   MDM_DTL_REV_LANE BB,
                   MDM_VSL_SVC_LANE CC
             WHERE AA.RLANE_CD        = BB.RLANE_CD
               AND AA.VSL_TP_CD       = 'C'
               AND BB.VSL_SLAN_DIR_CD > '!'
               AND AA.REP_TRD_CD      = BB.TRD_CD
               AND BB.TRD_CD         <> 'COM'
               AND AA.VSL_SLAN_CD     = CC.VSL_SLAN_CD
               AND CC.VSL_SVC_TP_CD  <> 'O'
               AND DECODE(CC.VSL_SVC_TP_CD, 'I', CC.CO_CD, '1') = DECODE(CC.VSL_SVC_TP_CD, 'I', 'H', '1')
         ) A,
         SPC_MAX_LOD_FCTR B
   WHERE B.BSE_YR      (+) = @[year]
     AND B.VOY_DIFF_WK (+) > '0'
     AND B.RLANE_CD    (+) = A.RLANE_CD
     AND B.DIR_CD      (+) = A.VSL_SLAN_DIR_CD
     AND DECODE(B.BSE_YR, NULL, A.DELT_FLG, '1') = DECODE(B.BSE_YR, NULL, 'N', '1')
#if (${rep_trade} != '')
     AND A.TRD_CD = @[rep_trade]
#end

#if (${sub_trade} != '')
     AND A.SUB_TRD_CD = @[sub_trade]
#end

#if (${lane} != '')
     AND A.RLANE_CD = @[lane]
#end

#if (${bound} != '')
     AND A.VSL_SLAN_DIR_CD = @[bound]
#end
GROUP BY A.TRD_CD         ,
         A.SUB_TRD_CD     ,
         A.RLANE_CD       ,
         A.VSL_SLAN_DIR_CD,
         B.BSE_YR
ORDER BY A.TRD_CD    ,
         A.SUB_TRD_CD,
         A.RLANE_CD  ,
         A.VSL_SLAN_DIR_CD			]]></sql>
			<params>
				<param name="year" type="12" value="" out="N"/>
				<param name="rep_trade" type="12" value="" out="N"/>
				<param name="sub_trade" type="12" value="" out="N"/>
				<param name="lane" type="12" value="" out="N"/>
				<param name="bound" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
