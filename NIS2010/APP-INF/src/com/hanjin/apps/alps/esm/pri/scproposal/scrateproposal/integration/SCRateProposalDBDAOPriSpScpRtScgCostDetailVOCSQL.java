/*=========================================================
*Copyright(c) 2015 CyberLogitec
*@FileName : SCRateProposalDBDAOPriSpScpRtScgCostDetailVOCSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2015.06.24
*@LastModifier : 최성환
*@LastVersion : 1.0
* 2015.06.24 최성환
* 1.0 Creation
=========================================================*/
package com.hanjin.apps.alps.esm.pri.scproposal.scrateproposal.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.hanjin.framework.support.db.ISQLTemplate;

/**
 *
 * @author Sunghwan Choi
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class SCRateProposalDBDAOPriSpScpRtScgCostDetailVOCSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * 2013.04.25 [CHM-201324203] 전윤주 Contract date 비교하여 surcharge calculate 하는 로직 추가
	  * 2015.03.09 전지예 [CHM-201534137] Percent Base CHG Creation 보완
	  * 2015.06.30 최성환 [CHM-201536493] Split03-주간 MAS Open에 따른 타모듈 프로그램 적용 요청
	  * </pre>
	  */
	public SCRateProposalDBDAOPriSpScpRtScgCostDetailVOCSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("cmdt_hdr_seq",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("gen_spcl_rt_tp_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("upd_usr_id",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("prop_no",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("amdt_seq",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("svc_scp_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("rout_seq",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.hanjin.apps.alps.esm.pri.scproposal.scrateproposal.integration").append("\n"); 
		query.append("FileName : SCRateProposalDBDAOPriSpScpRtScgCostDetailVOCSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("MERGE INTO PRI_SP_SCP_RT_SCG A" ).append("\n"); 
		query.append("USING (" ).append("\n"); 
		query.append("WITH" ).append("\n"); 
		query.append("BQ AS   /*★ */" ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("SELECT BQ_SEQ       ," ).append("\n"); 
		query.append("    CTRT_TP_CD     ," ).append("\n"); 
		query.append("    PROP_NO       ," ).append("\n"); 
		query.append("    AMDT_SEQ      ," ).append("\n"); 
		query.append("    SVC_SCP_CD     ," ).append("\n"); 
		query.append("    GEN_SPCL_RT_TP_CD  ," ).append("\n"); 
		query.append("    CMDT_HDR_SEQ    ," ).append("\n"); 
		query.append("    ROUT_SEQ      ," ).append("\n"); 
		query.append("    RT_SEQ       ," ).append("\n"); 
		query.append("    CURR_CD		," ).append("\n"); 
		query.append("    PROP_FRT_RT_AMT   ," ).append("\n"); 
		query.append("    DIR_CALL_FLG    ," ).append("\n"); 
		query.append("    CTRT_CNTR_TPSZ_CD  ," ).append("\n"); 
		query.append("    CTRT_CNTR_SZ_CD   ," ).append("\n"); 
		query.append("    PRC_CGO_TP_CD    ," ).append("\n"); 
		query.append("    POR_CD       ," ).append("\n"); 
		query.append("    POR_STE_CD     ," ).append("\n"); 
		query.append("    POR_RGN_CD     ," ).append("\n"); 
		query.append("    POR_CNT_CD     ," ).append("\n"); 
		query.append("    POR_CONTI_CD    ," ).append("\n"); 
		query.append("    POL_CD       ," ).append("\n"); 
		query.append("    POL_STE_CD     ," ).append("\n"); 
		query.append("    POL_RGN_CD     ," ).append("\n"); 
		query.append("    POL_CNT_CD     ," ).append("\n"); 
		query.append("    POL_CONTI_CD    ," ).append("\n"); 
		query.append("    POD_CD       ," ).append("\n"); 
		query.append("    POD_STE_CD     ," ).append("\n"); 
		query.append("    POD_RGN_CD     ," ).append("\n"); 
		query.append("    POD_CNT_CD     ," ).append("\n"); 
		query.append("    POD_CONTI_CD    ," ).append("\n"); 
		query.append("    DEL_CD       ," ).append("\n"); 
		query.append("    DEL_STE_CD     ," ).append("\n"); 
		query.append("    DEL_RGN_CD     ," ).append("\n"); 
		query.append("    DEL_CNT_CD     ," ).append("\n"); 
		query.append("    DEL_CONTI_CD    ," ).append("\n"); 
		query.append("    RCV_TERM_CD     ," ).append("\n"); 
		query.append("    DE_TERM_CD     ," ).append("\n"); 
		query.append("    N1ST_FINC_VVD_CD  ," ).append("\n"); 
		query.append("    N2ND_FINC_VVD_CD  ," ).append("\n"); 
		query.append("    N3RD_FINC_VVD_CD  ," ).append("\n"); 
		query.append("    N4TH_FINC_VVD_CD  ," ).append("\n"); 
		query.append("    N1ST_RLANE_CD    ," ).append("\n"); 
		query.append("    N2ND_RLANE_CD    ," ).append("\n"); 
		query.append("    N3RD_RLANE_CD    ," ).append("\n"); 
		query.append("    N4TH_RLANE_CD    ," ).append("\n"); 
		query.append("    N1ST_POL_CONTI_CD          ," ).append("\n"); 
		query.append("    N2ND_POL_CONTI_CD          ," ).append("\n"); 
		query.append("    N3RD_POL_CONTI_CD          ," ).append("\n"); 
		query.append("    N4TH_POL_CONTI_CD          ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    N1ST_POD_CONTI_CD          ," ).append("\n"); 
		query.append("    N2ND_POD_CONTI_CD          ," ).append("\n"); 
		query.append("    N3RD_POD_CONTI_CD          ," ).append("\n"); 
		query.append("    N4TH_POD_CONTI_CD          ," ).append("\n"); 
		query.append("    " ).append("\n"); 
		query.append("    N1ST_POL_CD          ," ).append("\n"); 
		query.append("    N2ND_POL_CD          ," ).append("\n"); 
		query.append("    N3RD_POL_CD          ," ).append("\n"); 
		query.append("    N4TH_POL_CD          ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    N1ST_POD_CD          ," ).append("\n"); 
		query.append("    N2ND_POD_CD          ," ).append("\n"); 
		query.append("    N3RD_POD_CD          ," ).append("\n"); 
		query.append("    N4TH_POD_CD          ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    N1ST_TS_PORT_CD   ," ).append("\n"); 
		query.append("    N2ND_TS_PORT_CD   ," ).append("\n"); 
		query.append("    N3RD_TS_PORT_CD   ," ).append("\n"); 
		query.append("    CML_ZN_CD      ," ).append("\n"); 
		query.append("    USA_SVC_MOD_CD   ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    CASE" ).append("\n"); 
		query.append("    WHEN ORG_TRNS_MOD_CD = 'TD' THEN 'T'" ).append("\n"); 
		query.append("    WHEN ORG_TRNS_MOD_CD = 'RD' THEN 'R'" ).append("\n"); 
		query.append("    WHEN ORG_TRNS_MOD_CD = 'WD' THEN  DECODE(POR_CD, POL_CD,'F', 'B')" ).append("\n"); 
		query.append("    WHEN ORG_TRNS_MOD_CD = 'TR' THEN 'A'" ).append("\n"); 
		query.append("    WHEN ORG_TRNS_MOD_CD = 'TW' THEN  DECODE(POR_CD, POL_CD,'E', 'U')" ).append("\n"); 
		query.append("    END ORG_TRNS_MOD_CD ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    CASE" ).append("\n"); 
		query.append("    WHEN DEST_TRNS_MOD_CD = 'TD' THEN 'T'" ).append("\n"); 
		query.append("    WHEN DEST_TRNS_MOD_CD = 'RD' THEN 'R'" ).append("\n"); 
		query.append("    WHEN DEST_TRNS_MOD_CD = 'WD' THEN  DECODE(DEL_CD, POD_CD,'F', 'B')" ).append("\n"); 
		query.append("    WHEN DEST_TRNS_MOD_CD = 'TR' THEN 'A'" ).append("\n"); 
		query.append("    WHEN DEST_TRNS_MOD_CD = 'TW' THEN  DECODE(DEL_CD, POD_CD,'E', 'U')" ).append("\n"); 
		query.append("    END DEST_TRNS_MOD_CD ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    PRD_RD_CNT," ).append("\n"); 
		query.append("    CUST_TP_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("FROM  (" ).append("\n"); 
		query.append("    SELECT ROWNUM BQ_SEQ     ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        'S' CTRT_TP_CD    ," ).append("\n"); 
		query.append("        RT.PROP_NO      ," ).append("\n"); 
		query.append("        RT.AMDT_SEQ      ," ).append("\n"); 
		query.append("        RT.SVC_SCP_CD     ," ).append("\n"); 
		query.append("        RT.GEN_SPCL_RT_TP_CD ," ).append("\n"); 
		query.append("        RT.CMDT_HDR_SEQ    ," ).append("\n"); 
		query.append("        RT.ROUT_SEQ      ," ).append("\n"); 
		query.append("        RT.RT_SEQ       ," ).append("\n"); 
		query.append("        RT.CURR_CD		," ).append("\n"); 
		query.append("        RT.PROP_FRT_RT_AMT  ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        RD.DIR_CALL_FLG    ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        CASE" ).append("\n"); 
		query.append("        WHEN RT.RAT_UT_CD = '20' THEN 'D2'" ).append("\n"); 
		query.append("        WHEN RT.RAT_UT_CD = '40' THEN 'D4'" ).append("\n"); 
		query.append("        WHEN RT.RAT_UT_CD = 'HC' THEN 'D5'" ).append("\n"); 
		query.append("        WHEN RT.RAT_UT_CD = '45' THEN 'D7'" ).append("\n"); 
		query.append("        WHEN RT.RAT_UT_CD = 'BL' THEN 'F4'" ).append("\n"); 
		query.append("        ELSE RT.RAT_UT_CD" ).append("\n"); 
		query.append("        END CTRT_CNTR_TPSZ_CD ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        ( SELECT A.CNTR_SZ_CD FROM PRI_RAT_UT A WHERE A.RAT_UT_CD = CASE" ).append("\n"); 
		query.append("                                         WHEN RT.RAT_UT_CD = '20' THEN 'D2'" ).append("\n"); 
		query.append("                                         WHEN RT.RAT_UT_CD = '40' THEN 'D4'" ).append("\n"); 
		query.append("                                         WHEN RT.RAT_UT_CD = 'HC' THEN 'D5'" ).append("\n"); 
		query.append("                                         WHEN RT.RAT_UT_CD = '45' THEN 'D7'" ).append("\n"); 
		query.append("                                         WHEN RT.RAT_UT_CD = 'BL' THEN 'F4'" ).append("\n"); 
		query.append("                                         ELSE RT.RAT_UT_CD" ).append("\n"); 
		query.append("                                         END ) CTRT_CNTR_SZ_CD ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        RT.PRC_CGO_TP_CD  ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        RC.POR_CD              ," ).append("\n"); 
		query.append("        L1.CNT_CD||L1.STE_CD POR_STE_CD  ," ).append("\n"); 
		query.append("        L1.RGN_CD       POR_RGN_CD  ," ).append("\n"); 
		query.append("        L1.CNT_CD       POR_CNT_CD  ," ).append("\n"); 
		query.append("        L1.CONTI_CD      POR_CONTI_CD ," ).append("\n"); 
		query.append("        RC.POL_CD              ," ).append("\n"); 
		query.append("        L2.CNT_CD||L2.STE_CD POL_STE_CD  ," ).append("\n"); 
		query.append("        L2.RGN_CD       POL_RGN_CD  ," ).append("\n"); 
		query.append("        L2.CNT_CD       POL_CNT_CD  ," ).append("\n"); 
		query.append("        L2.CONTI_CD      POL_CONTI_CD ," ).append("\n"); 
		query.append("        RC.POD_CD              ," ).append("\n"); 
		query.append("        L3.CNT_CD||L3.STE_CD POD_STE_CD  ," ).append("\n"); 
		query.append("        L3.RGN_CD       POD_RGN_CD  ," ).append("\n"); 
		query.append("        L3.CNT_CD       POD_CNT_CD  ," ).append("\n"); 
		query.append("        L3.CONTI_CD      POD_CONTI_CD ," ).append("\n"); 
		query.append("        RC.DEL_CD              ," ).append("\n"); 
		query.append("        L4.CNT_CD||L4.STE_CD DEL_STE_CD  ," ).append("\n"); 
		query.append("        L4.RGN_CD       DEL_RGN_CD  ," ).append("\n"); 
		query.append("        L4.CNT_CD       DEL_CNT_CD  ," ).append("\n"); 
		query.append("        L4.CONTI_CD      DEL_CONTI_CD ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("		/* T : Tackle, I : Free In, N : Liner In, S : CFS */" ).append("\n"); 
		query.append("        DECODE( RC.BKG_RCV_TERM_CD, 'T', 'Y', 'I', 'Y', 'N', 'Y', 'S', 'Y', RC.BKG_RCV_TERM_CD ) RCV_TERM_CD   ," ).append("\n"); 
		query.append("		/* T : Tackle, O : Free Out, U : Liner Out, S : CFS */" ).append("\n"); 
		query.append("        DECODE( RC.BKG_DE_TERM_CD, 'T', 'Y', 'O', 'Y', 'U', 'Y', 'S', 'Y', RC.BKG_DE_TERM_CD ) DE_TERM_CD   ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        RC.N1ST_FINC_VVD_CD         ," ).append("\n"); 
		query.append("        RC.N2ND_FINC_VVD_CD         ," ).append("\n"); 
		query.append("        RC.N3RD_FINC_VVD_CD         ," ).append("\n"); 
		query.append("        RC.N4TH_FINC_VVD_CD         ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        RC.N1ST_RLANE_CD          ," ).append("\n"); 
		query.append("        RC.N2ND_RLANE_CD          ," ).append("\n"); 
		query.append("        RC.N3RD_RLANE_CD          ," ).append("\n"); 
		query.append("        RC.N4TH_RLANE_CD          ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        (SELECT A.CONTI_CD FROM MDM_LOCATION A WHERE A.LOC_CD = RC.POL_CD)  				AS N1ST_POL_CONTI_CD          ," ).append("\n"); 
		query.append("        (SELECT A.CONTI_CD FROM MDM_LOCATION A WHERE A.LOC_CD = RC.N1ST_TS_PORT_CD) 		AS N2ND_POL_CONTI_CD          ," ).append("\n"); 
		query.append("        (SELECT A.CONTI_CD FROM MDM_LOCATION A WHERE A.LOC_CD = RC.N2ND_TS_PORT_CD) 		AS N3RD_POL_CONTI_CD          ," ).append("\n"); 
		query.append("        (SELECT A.CONTI_CD FROM MDM_LOCATION A WHERE A.LOC_CD = RC.N3RD_TS_PORT_CD) 		AS N4TH_POL_CONTI_CD          ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        (SELECT A.CONTI_CD FROM MDM_LOCATION A WHERE A.LOC_CD = NVL(RC.N1ST_TS_PORT_CD, RC.POD_CD)) 				AS N1ST_POD_CONTI_CD          ," ).append("\n"); 
		query.append("        (SELECT A.CONTI_CD FROM MDM_LOCATION A WHERE A.LOC_CD = NVL(RC.N2ND_TS_PORT_CD, DECODE(RC.N1ST_TS_PORT_CD, NULL, NULL, RC.POD_CD))) AS N2ND_POD_CONTI_CD          ," ).append("\n"); 
		query.append("        (SELECT A.CONTI_CD FROM MDM_LOCATION A WHERE A.LOC_CD = NVL(RC.N3RD_TS_PORT_CD, DECODE(RC.N2ND_TS_PORT_CD, NULL, NULL, RC.POD_CD))) AS N3RD_POD_CONTI_CD          ," ).append("\n"); 
		query.append("        (SELECT A.CONTI_CD FROM MDM_LOCATION A WHERE A.LOC_CD = DECODE(RC.N3RD_TS_PORT_CD, NULL, NULL, RC.POD_CD)) AS N4TH_POD_CONTI_CD          ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        RC.POL_CD  				AS N1ST_POL_CD          ," ).append("\n"); 
		query.append("        RC.N1ST_TS_PORT_CD 		AS N2ND_POL_CD          ," ).append("\n"); 
		query.append("        RC.N2ND_TS_PORT_CD 		AS N3RD_POL_CD          ," ).append("\n"); 
		query.append("        RC.N3RD_TS_PORT_CD 		AS N4TH_POL_CD          ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        NVL(RC.N1ST_TS_PORT_CD, RC.POD_CD) 				                            AS N1ST_POD_CD          ," ).append("\n"); 
		query.append("        NVL(RC.N2ND_TS_PORT_CD, DECODE(RC.N1ST_TS_PORT_CD, NULL, NULL, RC.POD_CD))  AS N2ND_POD_CD          ," ).append("\n"); 
		query.append("        NVL(RC.N3RD_TS_PORT_CD, DECODE(RC.N2ND_TS_PORT_CD, NULL, NULL, RC.POD_CD))  AS N3RD_POD_CD          ," ).append("\n"); 
		query.append("        DECODE(RC.N3RD_TS_PORT_CD, NULL, NULL, RC.POD_CD)                           AS N4TH_POD_CD          ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        RC.N1ST_TS_PORT_CD         ," ).append("\n"); 
		query.append("        RC.N2ND_TS_PORT_CD         ," ).append("\n"); 
		query.append("        RC.N3RD_TS_PORT_CD         ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        CASE" ).append("\n"); 
		query.append("        WHEN L4.CML_ZN_FLG = 'Y' AND L3.RGN_CD IN ( 'UAG', 'UAN', 'UAS' ) THEN 'CZ'" ).append("\n"); 
		query.append("        ELSE 'NN'" ).append("\n"); 
		query.append("        END CML_ZN_CD   ," ).append("\n"); 
		query.append("        CASE" ).append("\n"); 
		query.append("        WHEN L3.CNT_CD IN ( 'US', 'CA' ) AND RC.POD_CD = RC.DEL_CD AND RC.BKG_DE_TERM_CD NOT IN ( 'D', 'H' ) THEN 'PO'" ).append("\n"); 
		query.append("        WHEN L3.CNT_CD IN ( 'US', 'CA' ) THEN NVL(( SELECT SUBSTR(SVC_MOD_CD, 1, 2) FROM MAS_USA_SVC_MOD A WHERE A.ORG_RGN_CD = L3.RGN_CD AND A.DEST_RGN_CD = L4.RGN_CD ), 'OT')" ).append("\n"); 
		query.append("        WHEN L2.CNT_CD IN ( 'US', 'CA' ) AND RC.POL_CD = RC.POR_CD AND RC.BKG_RCV_TERM_CD NOT IN ( 'D', 'H' ) THEN 'PO'" ).append("\n"); 
		query.append("        WHEN L2.CNT_CD IN ( 'US', 'CA' ) THEN NVL(( SELECT SUBSTR(SVC_MOD_CD, 1, 2) FROM MAS_USA_SVC_MOD A WHERE A.ORG_RGN_CD = L2.RGN_CD AND A.DEST_RGN_CD = L1.RGN_CD ), 'OT')" ).append("\n"); 
		query.append("        END  USA_SVC_MOD_CD , -- PO(port), LO(local), IP(IPI), ML(MLB), OT(other)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        ( SELECT SUBSTR(AC.ACT_GRP_CD, 3, 2) FROM PRI_PRS_USD_ROUT_ACT_COST AC WHERE AC.ROUT_CS_NO = RC.ROUT_CS_NO AND AC.ROUT_CS_SRC_DT = RC.ROUT_CS_SRC_DT AND AC.N1ST_NOD_CD LIKE RC.POR_CD||'%' AND ROWNUM = 1 ) ORG_TRNS_MOD_CD ," ).append("\n"); 
		query.append("        ( SELECT SUBSTR(AC.ACT_GRP_CD, 3, 2) FROM PRI_PRS_USD_ROUT_ACT_COST AC WHERE AC.ROUT_CS_NO = RC.ROUT_CS_NO AND AC.ROUT_CS_SRC_DT = RC.ROUT_CS_SRC_DT AND COALESCE(AC.N4TH_NOD_CD, AC.N3RD_NOD_CD, AC.N2ND_NOD_CD) LIKE RC.DEL_CD||'%' AND ROWNUM = 1 ) DEST_TRNS_MOD_CD ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        NVL(RC.TRSP_RAIL_DIR_KNT, 0)	PRD_RD_CNT,	-- PRD에서  rail direct 갯수 " ).append("\n"); 
		query.append("/*        ( SELECT COUNT(1) FROM PRD_PROD_CTL_ROUT_DTL A WHERE A.PCTL_NO = RC.PCTL_NO AND A.TRSP_MOD_CD = 'RD' ) PRD_RD_CNT, -- PRD에서  rail direct 갯수 */ " ).append("\n"); 
		query.append("        ( SELECT PRC_CTRT_CUST_TP_CD FROM PRI_SP_CTRT_CUST_TP WHERE  PROP_NO = @[prop_no] AND AMDT_SEQ = @[amdt_seq] AND PRC_CTRT_PTY_TP_CD = 'C' ) CUST_TP_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    FROM  PRI_SP_SCP_RT          RT  ," ).append("\n"); 
		query.append("        PRI_SP_SCP_RT_ROUT_DIR   RD ," ).append("\n"); 
		query.append("        PRI_SP_SCP_RT_USD_ROUT_CS   RR  ," ).append("\n"); 
		query.append("        PRI_PRS_USD_ROUT_CS_INFO    RC ," ).append("\n"); 
		query.append("        MDM_LOCATION        L1 ," ).append("\n"); 
		query.append("        MDM_LOCATION        L2 ," ).append("\n"); 
		query.append("        MDM_LOCATION        L3 ," ).append("\n"); 
		query.append("        MDM_LOCATION        L4" ).append("\n"); 
		query.append("    WHERE   RD.PROP_NO       = RT.PROP_NO" ).append("\n"); 
		query.append("    AND   RD.AMDT_SEQ             = RT.AMDT_SEQ" ).append("\n"); 
		query.append("    AND   RD.SVC_SCP_CD           = RT.SVC_SCP_CD" ).append("\n"); 
		query.append("    AND   RD.GEN_SPCL_RT_TP_CD    = RT.GEN_SPCL_RT_TP_CD" ).append("\n"); 
		query.append("    AND   RD.CMDT_HDR_SEQ         = RT.CMDT_HDR_SEQ" ).append("\n"); 
		query.append("    AND   RD.ROUT_SEQ             = RT.ROUT_SEQ" ).append("\n"); 
		query.append("    AND   RR.PROP_NO              = RT.PROP_NO" ).append("\n"); 
		query.append("    AND   RR.AMDT_SEQ             = RT.AMDT_SEQ" ).append("\n"); 
		query.append("    AND   RR.SVC_SCP_CD           = RT.SVC_SCP_CD" ).append("\n"); 
		query.append("    AND   RR.GEN_SPCL_RT_TP_CD    = RT.GEN_SPCL_RT_TP_CD" ).append("\n"); 
		query.append("    AND   RR.CMDT_HDR_SEQ         = RT.CMDT_HDR_SEQ" ).append("\n"); 
		query.append("    AND   RR.ROUT_SEQ             = RT.ROUT_SEQ" ).append("\n"); 
		query.append("    AND   RR.RT_SEQ               = RT.RT_SEQ" ).append("\n"); 
		query.append("    AND   RR.USD_ROUT_CS_SEL_FLG  = 'Y'" ).append("\n"); 
		query.append("    AND   RC.ROUT_CS_NO           = RR.ROUT_CS_NO" ).append("\n"); 
		query.append("    AND   RC.ROUT_CS_SRC_DT       = RR.ROUT_CS_SRC_DT" ).append("\n"); 
		query.append("    AND   L1.LOC_CD        = RC.POR_CD" ).append("\n"); 
		query.append("    AND   L2.LOC_CD        = RC.POL_CD" ).append("\n"); 
		query.append("    AND   L3.LOC_CD        = RC.POD_CD" ).append("\n"); 
		query.append("    AND   L4.LOC_CD        = RC.DEL_CD" ).append("\n"); 
		query.append("    AND   RT.PROP_NO = @[prop_no]" ).append("\n"); 
		query.append("    AND   RT.AMDT_SEQ = @[amdt_seq]" ).append("\n"); 
		query.append("    AND   RT.SVC_SCP_CD = @[svc_scp_cd]" ).append("\n"); 
		query.append("    AND   RT.GEN_SPCL_RT_TP_CD = @[gen_spcl_rt_tp_cd]" ).append("\n"); 
		query.append("#if(${is_online_call})" ).append("\n"); 
		query.append("    AND   RT.CMDT_HDR_SEQ = @[cmdt_hdr_seq]" ).append("\n"); 
		query.append("    AND   RT.ROUT_SEQ = @[rout_seq]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("    AND   RT.PRC_PROG_STS_CD IN ( 'I', 'R' )" ).append("\n"); 
		query.append("    AND   RT.SRC_INFO_CD <> 'AD'" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append(") ," ).append("\n"); 
		query.append("GL AS (" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("GROUP LOCATION 을 SELECT 한다." ).append("\n"); 
		query.append("S/C 의 경우는 NOTE CONVERSION 에서 사용하는 GROUP LOCATION ( 'EAST', 'WEST' ) 도 포함시킨다." ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("SELECT G.PRC_GRP_LOC_CD ," ).append("\n"); 
		query.append("        D.LOC_CD" ).append("\n"); 
		query.append("FROM   PRI_SP_SCP_GRP_LOC    G ," ).append("\n"); 
		query.append("     PRI_SP_SCP_GRP_LOC_DTL D" ).append("\n"); 
		query.append("WHERE  D.PROP_NO     = G.PROP_NO" ).append("\n"); 
		query.append("AND   D.AMDT_SEQ    = G.AMDT_SEQ" ).append("\n"); 
		query.append("AND   D.SVC_SCP_CD   = G.SVC_SCP_CD" ).append("\n"); 
		query.append("AND   D.GRP_LOC_SEQ   = G.GRP_LOC_SEQ" ).append("\n"); 
		query.append("AND   D.SRC_INFO_CD   <> 'AD'" ).append("\n"); 
		query.append("AND   G.PROP_NO = @[prop_no]" ).append("\n"); 
		query.append("AND   G.AMDT_SEQ = @[amdt_seq]" ).append("\n"); 
		query.append("AND   G.SVC_SCP_CD = @[svc_scp_cd]" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("/* 이 부분은 OFT 에는 적용하지 않고, SURCHARGE 중에서는 S/C 인 경우에만 적용한다. */" ).append("\n"); 
		query.append("UNION ALL" ).append("\n"); 
		query.append("SELECT G.NOTE_CONV_GRP_LOC_CD PRC_GRP_LOC_CD ," ).append("\n"); 
		query.append("    D.LOC_CD" ).append("\n"); 
		query.append("FROM  PRI_NOTE_CONV_GRP_LOC   G , /* note conv에서만 쓰는 group loc (계약에는 만들지 않는 코드 임- 임시로 이곳에 만들어 놓고 쓰고 있음.) */" ).append("\n"); 
		query.append("    PRI_NOTE_CONV_GRP_LOC_DTL D" ).append("\n"); 
		query.append("WHERE  D.PRC_CTRT_TP_CD    = G.PRC_CTRT_TP_CD" ).append("\n"); 
		query.append("AND   D.NOTE_CONV_GRP_LOC_CD = G.NOTE_CONV_GRP_LOC_CD" ).append("\n"); 
		query.append("AND   G.PRC_CTRT_TP_CD    = 'S'" ).append("\n"); 
		query.append(") ," ).append("\n"); 
		query.append("NC AS (" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("BOOKING 에 해당하는 NOTE CONVERSION 을 SELECT 한다." ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("SELECT BQ.BQ_SEQ       ," ).append("\n"); 
		query.append("    NC.NOTE_CONV_MAPG_ID ," ).append("\n"); 
		query.append("    NC.NOTE_CONV_SEQ   ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    NC.NOTE_CONV_TP_CD          ," ).append("\n"); 
		query.append("    (	SELECT A.PRIO_SEQ FROM PRI_NOTE_CONV_TP A WHERE A.PRC_CTRT_TP_CD = BQ.CTRT_TP_CD AND A.NOTE_CONV_TP_CD = NC.NOTE_CONV_TP_CD ) CONV_TP_PRIO	," ).append("\n"); 
		query.append("    NC.CHG_RULE_TP_CD           ," ).append("\n"); 
		query.append("    NC.NOTE_CONV_CHG_CD         ," ).append("\n"); 
		query.append("    NC.NOTE_CONV_RULE_CD        ," ).append("\n"); 
		query.append("    NC.RT_APPL_TP_CD            ," ).append("\n"); 
		query.append("    NC.RT_OP_CD                 ," ).append("\n"); 
		query.append("    NC.CURR_CD                  ," ).append("\n"); 
		query.append("    NC.FRT_RT_AMT               ," ).append("\n"); 
		query.append("    NC.PAY_TERM_CD              ," ).append("\n"); 
		query.append("    NC.BKG_RAT_UT_CD      ," ).append("\n"); 
		query.append("    NC.BKG_PRC_CGO_TP_CD    ," ).append("\n"); 
		query.append("    ROW_NUMBER() OVER ( PARTITION BY BQ.BQ_SEQ, NC.CHG_RULE_TP_CD, NC.NOTE_CONV_CHG_CD, NC.NOTE_CONV_RULE_CD, DECODE(NC.CHG_RULE_TP_CD, 'C', NC.BKG_RAT_UT_CD)" ).append("\n"); 
		query.append("              ORDER BY" ).append("\n"); 
		query.append("               ( SELECT A.PRIO_SEQ FROM PRI_NOTE_CONV_TP A WHERE A.PRC_CTRT_TP_CD = BQ.CTRT_TP_CD AND A.NOTE_CONV_TP_CD = NC.NOTE_CONV_TP_CD ) ," ).append("\n"); 
		query.append("                DECODE(BKG_POR_TP_CD, 'L', 600, 'G', 500, 'T', 400, 'R', 300, 'C', 200, 0)" ).append("\n"); 
		query.append("                + DECODE(BKG_POL_TP_CD, 'L', 600, 'G', 500, 'T', 400, 'R', 300, 'C', 200, 0)" ).append("\n"); 
		query.append("                + DECODE(BKG_POD_TP_CD, 'L', 600, 'G', 500, 'T', 400, 'R', 300, 'C', 200, 0)" ).append("\n"); 
		query.append("                + DECODE(BKG_DEL_TP_CD, 'L', 600, 'G', 500, 'T', 400, 'R', 300, 'C', 200, 0)" ).append("\n"); 
		query.append("                + DECODE(BKG_RAT_UT_CD, '20', 5, '40', 5, 'HC', 5, '53', 5, 'BL', 4, 'BX', 4, NULL, 4, 6)" ).append("\n"); 
		query.append("                + DECODE(BKG_PRC_CGO_TP_CD  , NULL, 0, 1)" ).append("\n"); 
		query.append("                + DECODE(BKG_USA_SVC_MOD_CD  , NULL, 0, 1)" ).append("\n"); 
		query.append("                + DECODE(BKG_ORG_TRSP_MOD_CD , NULL, 0, 1)" ).append("\n"); 
		query.append("                + DECODE(BKG_DEST_TRSP_MOD_CD , NULL, 0, 1)" ).append("\n"); 
		query.append("                + DECODE(BKG_RCV_TERM_CD   , NULL, 0, 1)" ).append("\n"); 
		query.append("                + DECODE(BKG_DE_TERM_CD    , NULL, 0, 1)" ).append("\n"); 
		query.append("                + DECODE(BKG_SLAN_CD     , NULL, 0, 1)" ).append("\n"); 
		query.append("                + DECODE(BKG_VSL_CD      , NULL, 0, 1)" ).append("\n"); 
		query.append("                + DECODE(BKG_ACT_CUST_CNT_CD , NULL, 0, 1)" ).append("\n"); 
		query.append("                + DECODE(BKG_TS_PORT_DEF_CD  , NULL, 0, 1) DESC ," ).append("\n"); 
		query.append("               NC.FRT_RT_AMT     ," ).append("\n"); 
		query.append("               NC.NOTE_CONV_MAPG_ID ," ).append("\n"); 
		query.append("               NC.NOTE_CONV_SEQ" ).append("\n"); 
		query.append("              ) ROW_NUMBER ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    NVL(NC.CONV_RAT_UT_CD, BQ.CTRT_CNTR_TPSZ_CD) CONV_RAT_UT_CD      ," ).append("\n"); 
		query.append("    NC.CONV_PRC_CGO_TP_CD    ," ).append("\n"); 
		query.append("    NVL(NC.CONV_ORG_LOC_TP_CD, 'L')        CONV_ORG_LOC_TP_CD        ," ).append("\n"); 
		query.append("    NVL(NC.CONV_ORG_LOC_DEF_CD, BQ.POR_CD)       CONV_ORG_LOC_DEF_CD       ," ).append("\n"); 
		query.append("    NVL(NC.CONV_ORG_VIA_LOC_TP_CD, 'L')      CONV_ORG_VIA_LOC_TP_CD    ," ).append("\n"); 
		query.append("    NVL(NC.CONV_ORG_VIA_LOC_DEF_CD, BQ.POL_CD)  CONV_ORG_VIA_LOC_DEF_CD   ," ).append("\n"); 
		query.append("    NVL(NC.CONV_DEST_VIA_LOC_TP_CD, 'L')     CONV_DEST_VIA_LOC_TP_CD   ," ).append("\n"); 
		query.append("    NVL(NC.CONV_DEST_VIA_LOC_DEF_CD, BQ.POD_CD)  CONV_DEST_VIA_LOC_DEF_CD ," ).append("\n"); 
		query.append("    NVL(NC.CONV_DEST_LOC_TP_CD, 'L')       CONV_DEST_LOC_TP_CD     ," ).append("\n"); 
		query.append("    NVL(NC.CONV_DEST_LOC_DEF_CD, BQ.DEL_CD)      CONV_DEST_LOC_DEF_CD      ," ).append("\n"); 
		query.append("    NVL(NC.CONV_PRC_RCV_TERM_CD, BQ.RCV_TERM_CD) CONV_PRC_RCV_TERM_CD      ," ).append("\n"); 
		query.append("    NVL(NC.CONV_PRC_DE_TERM_CD, BQ.DE_TERM_CD)  CONV_PRC_DE_TERM_CD" ).append("\n"); 
		query.append("FROM  BQ ," ).append("\n"); 
		query.append("    (" ).append("\n"); 
		query.append("    SELECT NC.*" ).append("\n"); 
		query.append("    FROM  PRI_SC_NOTE_CONV NC				/* special & commodity & route note */" ).append("\n"); 
		query.append("    WHERE NC.PROP_NO = @[prop_no]" ).append("\n"); 
		query.append("    AND   NC.AMDT_SEQ = @[amdt_seq]" ).append("\n"); 
		query.append("    AND   NC.SVC_SCP_CD = @[svc_scp_cd]" ).append("\n"); 
		query.append("-- 2010.02.24 NOTE 는 날짜 의미 없음. ( 김진철 과장 )    " ).append("\n"); 
		query.append("--    AND   TO_DATE(SYSDATE) BETWEEN NC.EFF_DT AND NC.EXP_DT + 0.99999  /* 0.99999 는 23시 59분 59초를 의미 */" ).append("\n"); 
		query.append("    UNION ALL" ).append("\n"); 
		query.append("    SELECT NC.*" ).append("\n"); 
		query.append("    FROM  PRI_SC_NOTE_CONV NC				/* standard note ( sc guideline ) */" ).append("\n"); 
		query.append("    WHERE  NC.SVC_SCP_CD  = @[svc_scp_cd]" ).append("\n"); 
		query.append("    AND   NC.NOTE_HDR_SEQ = ( SELECT A.NOTE_HDR_SEQ FROM PRI_SP_SCP_MN A WHERE A.PROP_NO =  @[prop_no] AND A.AMDT_SEQ = @[amdt_seq] AND A.SVC_SCP_CD = @[svc_scp_cd] )" ).append("\n"); 
		query.append("-- 2010.02.24 NOTE 는 날짜 의미 없음. ( 김진철 과장 )    " ).append("\n"); 
		query.append("--    AND   TO_DATE(SYSDATE) BETWEEN NC.EFF_DT AND NC.EXP_DT + 0.99999  /* 0.99999 는 23시 59분 59초를 의미 */" ).append("\n"); 
		query.append("    ) NC             ," ).append("\n"); 
		query.append("    MDM_CHARGE        MC" ).append("\n"); 
		query.append("WHERE  MC.CHG_CD(+)      = NC.NOTE_CONV_CHG_CD" ).append("\n"); 
		query.append("AND   (" ).append("\n"); 
		query.append("      (" ).append("\n"); 
		query.append("        NC.NOTE_CONV_TP_CD  IN ( 'T', 'P' ) /* T: statndard note, P: special note */" ).append("\n"); 
		query.append("      AND NVL(NC.GEN_SPCL_RT_TP_CD, BQ.GEN_SPCL_RT_TP_CD) = BQ.GEN_SPCL_RT_TP_CD" ).append("\n"); 
		query.append("      )" ).append("\n"); 
		query.append("    OR NC.NOTE_CONV_MAPG_ID IN" ).append("\n"); 
		query.append("      (" ).append("\n"); 
		query.append("      SELECT CN.NOTE_CONV_MAPG_ID" ).append("\n"); 
		query.append("      FROM  PRI_SP_SCP_RT_CNOTE CN			/* commodity note */" ).append("\n"); 
		query.append("      WHERE  CN.PROP_NO      = BQ.PROP_NO" ).append("\n"); 
		query.append("      AND   CN.AMDT_SEQ      = BQ.AMDT_SEQ" ).append("\n"); 
		query.append("      AND   CN.SVC_SCP_CD     = BQ.SVC_SCP_CD" ).append("\n"); 
		query.append("      AND   CN.GEN_SPCL_RT_TP_CD = BQ.GEN_SPCL_RT_TP_CD" ).append("\n"); 
		query.append("      AND   CN.CMDT_HDR_SEQ    = BQ.CMDT_HDR_SEQ" ).append("\n"); 
		query.append("      AND   CN.SRC_INFO_CD(+)    <> 'AD'" ).append("\n"); 
		query.append("      UNION ALL" ).append("\n"); 
		query.append("      SELECT RN.NOTE_CONV_MAPG_ID			/* route note */" ).append("\n"); 
		query.append("      FROM  PRI_SP_SCP_RT_CMDT_RNOTE RN" ).append("\n"); 
		query.append("      WHERE  RN.PROP_NO      = BQ.PROP_NO" ).append("\n"); 
		query.append("      AND   RN.AMDT_SEQ      = BQ.AMDT_SEQ" ).append("\n"); 
		query.append("      AND   RN.SVC_SCP_CD     = BQ.SVC_SCP_CD" ).append("\n"); 
		query.append("      AND   RN.GEN_SPCL_RT_TP_CD = BQ.GEN_SPCL_RT_TP_CD" ).append("\n"); 
		query.append("      AND   RN.CMDT_HDR_SEQ    = BQ.CMDT_HDR_SEQ" ).append("\n"); 
		query.append("      AND   RN.ROUT_SEQ      = BQ.ROUT_SEQ" ).append("\n"); 
		query.append("      AND   RN.SRC_INFO_CD(+)    <> 'AD'" ).append("\n"); 
		query.append("      )" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("NOT RULE CODE 는 SURCHARGE 에서만 사용되며," ).append("\n"); 
		query.append("TYP RULE CODE 는 OFT 에 사용되는 것이 기본이지만, SURCHARGE 에서도 사용된다." ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("AND   (" ).append("\n"); 
		query.append("      NC.CHG_RULE_TP_CD   = 'C'		/* charge */" ).append("\n"); 
		query.append("    OR" ).append("\n"); 
		query.append("      (" ).append("\n"); 
		query.append("        NC.CHG_RULE_TP_CD   = 'R'	/* rule */" ).append("\n"); 
		query.append("      AND NC.NOTE_CONV_RULE_CD IN ( 'NOT', 'TYP' ) /* surcharge 에 해당되는 rule만 포함 */" ).append("\n"); 
		query.append("      )" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("< RATING UNIT >" ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("AND (" ).append("\n"); 
		query.append("      (" ).append("\n"); 
		query.append("        NC.CHG_RULE_TP_CD  = 'C'" ).append("\n"); 
		query.append("      AND NC.BKG_RAT_UT_CD  NOT IN ( 'MT', 'CM' )" ).append("\n"); 
		query.append("      )" ).append("\n"); 
		query.append("    OR (" ).append("\n"); 
		query.append("          NC.BKG_RAT_UT_CD IS NULL" ).append("\n"); 
		query.append("         OR NC.BKG_RAT_UT_CD = BQ.CTRT_CNTR_TPSZ_CD " ).append("\n"); 
		query.append("         OR NC.BKG_RAT_UT_CD IN ( 'BX', 'BL' ) " ).append("\n"); 
		query.append("            OR" ).append("\n"); 
		query.append("           (" ).append("\n"); 
		query.append("                NC.BKG_RAT_UT_CD IN ( '20', '40', 'HC', '45', '53' )" ).append("\n"); 
		query.append("            AND ( SELECT A.CNTR_SZ_CD FROM PRI_RAT_UT A WHERE A.RAT_UT_CD = NC.BKG_RAT_UT_CD ) = BQ.CTRT_CNTR_SZ_CD" ).append("\n"); 
		query.append("           )" ).append("\n"); 
		query.append("       )" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("< CARGO TYPE >" ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("AND   (" ).append("\n"); 
		query.append("      NC.BKG_PRC_CGO_TP_CD IS NULL" ).append("\n"); 
		query.append("    OR NC.BKG_PRC_CGO_TP_CD = BQ.PRC_CGO_TP_CD" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("< ROUTE >" ).append("\n"); 
		query.append("STANDARD NOTE 의 경우는 GROUP 을 사용하지 않으므로," ).append("\n"); 
		query.append("STANDARD NOTE 를 위한 특별한 고려가 필요하지 않음." ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("/* POR */" ).append("\n"); 
		query.append("AND   (" ).append("\n"); 
		query.append("      NC.BKG_POR_DEF_CD IS NULL" ).append("\n"); 
		query.append("    OR NC.BKG_POR_DEF_CD = DECODE(NC.BKG_POR_TP_CD, 'L', BQ.POR_CD, 'T', BQ.POR_STE_CD, 'R', BQ.POR_RGN_CD, 'C', BQ.POR_CNT_CD)" ).append("\n"); 
		query.append("    OR (" ).append("\n"); 
		query.append("        NC.BKG_POR_TP_CD = 'G'" ).append("\n"); 
		query.append("      AND EXISTS (" ).append("\n"); 
		query.append("            SELECT 'X'" ).append("\n"); 
		query.append("            FROM   GL" ).append("\n"); 
		query.append("            WHERE  GL.PRC_GRP_LOC_CD = NC.BKG_POR_DEF_CD" ).append("\n"); 
		query.append("            AND   GL.LOC_CD     = BQ.POR_CD" ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("      )" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("/* POL */" ).append("\n"); 
		query.append("AND   (" ).append("\n"); 
		query.append("      NC.BKG_POL_DEF_CD IS NULL" ).append("\n"); 
		query.append("    OR NC.BKG_POL_DEF_CD = DECODE(NC.BKG_POL_TP_CD, 'L', BQ.POL_CD, 'T', BQ.POL_STE_CD, 'R', BQ.POL_RGN_CD, 'C', BQ.POL_CNT_CD)" ).append("\n"); 
		query.append("    OR (" ).append("\n"); 
		query.append("        NC.BKG_POL_TP_CD = 'G'" ).append("\n"); 
		query.append("      AND EXISTS (" ).append("\n"); 
		query.append("            SELECT 'X'" ).append("\n"); 
		query.append("            FROM   GL" ).append("\n"); 
		query.append("            WHERE  GL.PRC_GRP_LOC_CD = NC.BKG_POL_DEF_CD" ).append("\n"); 
		query.append("            AND   GL.LOC_CD     = BQ.POL_CD" ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("      )" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("/* POD */" ).append("\n"); 
		query.append("AND   (" ).append("\n"); 
		query.append("      NC.BKG_POD_DEF_CD IS NULL" ).append("\n"); 
		query.append("    OR NC.BKG_POD_DEF_CD = DECODE(NC.BKG_POD_TP_CD, 'L', BQ.POD_CD, 'T', BQ.POD_STE_CD, 'R', BQ.POD_RGN_CD, 'C', BQ.POD_CNT_CD)" ).append("\n"); 
		query.append("    OR (" ).append("\n"); 
		query.append("        NC.BKG_POD_TP_CD = 'G'" ).append("\n"); 
		query.append("      AND EXISTS (" ).append("\n"); 
		query.append("            SELECT 'X'" ).append("\n"); 
		query.append("            FROM   GL" ).append("\n"); 
		query.append("            WHERE  GL.PRC_GRP_LOC_CD = NC.BKG_POD_DEF_CD" ).append("\n"); 
		query.append("            AND   GL.LOC_CD     = BQ.POD_CD" ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("      )" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("/* DEL */" ).append("\n"); 
		query.append("AND   (" ).append("\n"); 
		query.append("      NC.BKG_DEL_DEF_CD IS NULL" ).append("\n"); 
		query.append("    OR NC.BKG_DEL_DEF_CD = DECODE(NC.BKG_DEL_TP_CD, 'L', BQ.DEL_CD, 'T', BQ.DEL_STE_CD, 'R', BQ.DEL_RGN_CD, 'C', BQ.DEL_CNT_CD)" ).append("\n"); 
		query.append("    OR (" ).append("\n"); 
		query.append("        NC.BKG_DEL_TP_CD = 'G'" ).append("\n"); 
		query.append("      AND EXISTS (" ).append("\n"); 
		query.append("            SELECT 'X'" ).append("\n"); 
		query.append("            FROM   GL" ).append("\n"); 
		query.append("            WHERE  GL.PRC_GRP_LOC_CD = NC.BKG_DEL_DEF_CD" ).append("\n"); 
		query.append("            AND   GL.LOC_CD     = BQ.DEL_CD" ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("      )" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("< LANE & VVD >" ).append("\n"); 
		query.append("TRUNK, T/S 구분없이 LANE 이나 VVD 가 존재하는지 여부로 판단한다." ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("AND   (" ).append("\n"); 
		query.append("      NC.BKG_SLAN_CD IS NULL" ).append("\n"); 
		query.append("    OR NC.BKG_SLAN_CD IN ( BQ.N1ST_RLANE_CD, BQ.N2ND_RLANE_CD, BQ.N3RD_RLANE_CD, BQ.N4TH_RLANE_CD )" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("AND   (  NC.BKG_VSL_CD IS NULL" ).append("\n"); 
		query.append("    OR NC.BKG_VSL_CD||NC.BKG_SKD_VOY_NO||NC.BKG_SKD_DIR_CD IN ( BQ.N1ST_FINC_VVD_CD, BQ.N2ND_FINC_VVD_CD, BQ.N3RD_FINC_VVD_CD, BQ.N4TH_FINC_VVD_CD )" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("< T/S PORT >" ).append("\n"); 
		query.append("T/S 가 발생하는 PORT 를 대상으로 한다." ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("AND   (" ).append("\n"); 
		query.append("      NC.BKG_TS_PORT_DEF_CD IS NULL" ).append("\n"); 
		query.append("    OR NC.BKG_TS_PORT_DEF_CD IN" ).append("\n"); 
		query.append("      (" ).append("\n"); 
		query.append("      SELECT DECODE(NC.BKG_TS_PORT_TP_CD, 'L', A.LOC_CD, 'T', A.CNT_CD||A.STE_CD, 'R', A.RGN_CD, 'C', A.CNT_CD)" ).append("\n"); 
		query.append("      FROM  MDM_LOCATION  A" ).append("\n"); 
		query.append("      WHERE  A.LOC_CD IN ( BQ.N1ST_TS_PORT_CD, BQ.N2ND_TS_PORT_CD, BQ.N3RD_TS_PORT_CD )" ).append("\n"); 
		query.append("      )" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("< OFT 해당 여부 확인 >" ).append("\n"); 
		query.append("선택된 OFT 와 일치하는 것만 대상으로 함." ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("AND   (" ).append("\n"); 
		query.append("      NC.RULE_APPL_CHG_TP_CD IS NULL" ).append("\n"); 
		query.append("    OR NC.RULE_APPL_CHG_TP_CD = 'S'      /* SURCHARGE 를 대상으로 함 */" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("<  USA SVC MOD >" ).append("\n"); 
		query.append("NOTE CONV 에서는 USA SVC MOD CD 에, COMMERCIAL ZONE 도 같이 합쳐서 사용한다." ).append("\n"); 
		query.append("따라서 NOTE CONV 의 USA SVC MOD CD 가 'CZ' 이면 BKG 의 COMMERCIAL ZONE CD 와 비교한다." ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("AND   (" ).append("\n"); 
		query.append("      NC.BKG_USA_SVC_MOD_CD IS NULL" ).append("\n"); 
		query.append("    OR NC.BKG_USA_SVC_MOD_CD = DECODE(NC.BKG_USA_SVC_MOD_CD, 'CZ', BQ.CML_ZN_CD, BQ.USA_SVC_MOD_CD )" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("/* ORG TRANS MOD */" ).append("\n"); 
		query.append("AND   (" ).append("\n"); 
		query.append("      NC.BKG_ORG_TRSP_MOD_CD IS NULL" ).append("\n"); 
		query.append("    OR NC.BKG_ORG_TRSP_MOD_CD = BQ.ORG_TRNS_MOD_CD" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("/* DEST TRANS MOD */" ).append("\n"); 
		query.append("AND   (" ).append("\n"); 
		query.append("      NC.BKG_DEST_TRSP_MOD_CD IS NULL" ).append("\n"); 
		query.append("    OR NC.BKG_DEST_TRSP_MOD_CD = BQ.DEST_TRNS_MOD_CD" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("R/D TERM CHECK ( MDM_CHARGE 의 R/D TERM CHECK 포함 )" ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("AND   (" ).append("\n"); 
		query.append("      NC.BKG_RCV_TERM_CD = BQ.RCV_TERM_CD" ).append("\n"); 
		query.append("    OR (" ).append("\n"); 
		query.append("        NC.BKG_RCV_TERM_CD IS NULL" ).append("\n"); 
		query.append("      AND BQ.RCV_TERM_CD IN ( DECODE(NC.CHG_RULE_TP_CD, 'R', BQ.RCV_TERM_CD), DECODE(MC.NA_RD_TERM_FLG, 'Y', BQ.RCV_TERM_CD), DECODE(MC.CY_RD_TERM_FLG, 'Y', 'Y'), DECODE(MC.DOR_RD_TERM_FLG, 'Y', 'D'), DECODE(MC.CFS_RD_TERM_FLG, 'Y', 'S'), DECODE(MC.TKL_TML_FLG, 'Y', 'T') )" ).append("\n"); 
		query.append("      )" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("AND   (" ).append("\n"); 
		query.append("      NC.BKG_DE_TERM_CD  = BQ.DE_TERM_CD" ).append("\n"); 
		query.append("    OR (" ).append("\n"); 
		query.append("        NC.BKG_DE_TERM_CD IS NULL" ).append("\n"); 
		query.append("      AND BQ.DE_TERM_CD  IN ( DECODE(NC.CHG_RULE_TP_CD, 'R', BQ.DE_TERM_CD), DECODE(MC.NA_RD_TERM_FLG, 'Y', BQ.DE_TERM_CD), DECODE(MC.CY_RD_TERM_FLG, 'Y', 'Y'), DECODE(MC.DOR_RD_TERM_FLG, 'Y', 'D'), DECODE(MC.CFS_RD_TERM_FLG, 'Y', 'S'), DECODE(MC.TKL_TML_FLG, 'Y', 'T') )" ).append("\n"); 
		query.append("      )" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append(") ," ).append("\n"); 
		query.append("NC_P AS /*★ */" ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("적용될 CONVERSION 이 같은 NOTE_CONV_TP_CD 에서 하나의 NOTE_CONV_RULE_CD 가 되도록 우선순위가 낮은 것을 제거한다." ).append("\n"); 
		query.append("우선순위가 똑같은 경우에는 NOTE_CONV_MAPG_ID||LPAD(NOTE_CONV_SEQ, 6, '0') 가 적은 것을 우선한다." ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("'TYP' 1개의 RULE CODE 를 가진 BKG DATA 를 UNION ALL 로 추가한다." ).append("\n"); 
		query.append("이 부분은 계약과 BKG 를 직접 비교하지 않고, NOTE CONV 와만 비교하도록 하기 위함이다." ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("SELECT NC.BQ_SEQ          ," ).append("\n"); 
		query.append("    NC.NOTE_CONV_MAPG_ID    ," ).append("\n"); 
		query.append("    NC.NOTE_CONV_SEQ      ," ).append("\n"); 
		query.append("    'C' BKG_CONV_TP_CD     ," ).append("\n"); 
		query.append("    NC.NOTE_CONV_TP_CD     ," ).append("\n"); 
		query.append("    NC.CONV_TP_PRIO			," ).append("\n"); 
		query.append("    NC.CHG_RULE_TP_CD           ," ).append("\n"); 
		query.append("    NC.NOTE_CONV_CHG_CD         ," ).append("\n"); 
		query.append("    NC.NOTE_CONV_RULE_CD    ," ).append("\n"); 
		query.append("    NC.CONV_RAT_UT_CD      ," ).append("\n"); 
		query.append("    ( SELECT A.CNTR_SZ_CD FROM PRI_RAT_UT A WHERE A.RAT_UT_CD = NC.CONV_RAT_UT_CD ) CONV_RAT_UT_SZ_CD  ," ).append("\n"); 
		query.append("    NC.CONV_PRC_CGO_TP_CD    ," ).append("\n"); 
		query.append("    NC.CONV_ORG_LOC_TP_CD    ," ).append("\n"); 
		query.append("    NC.CONV_ORG_LOC_DEF_CD   ," ).append("\n"); 
		query.append("    NC.CONV_ORG_VIA_LOC_TP_CD  ," ).append("\n"); 
		query.append("    NC.CONV_ORG_VIA_LOC_DEF_CD ," ).append("\n"); 
		query.append("    NC.CONV_DEST_VIA_LOC_TP_CD ," ).append("\n"); 
		query.append("    NC.CONV_DEST_VIA_LOC_DEF_CD ," ).append("\n"); 
		query.append("    NC.CONV_DEST_LOC_TP_CD   ," ).append("\n"); 
		query.append("    NC.CONV_DEST_LOC_DEF_CD   ," ).append("\n"); 
		query.append("    NC.CONV_PRC_RCV_TERM_CD   ," ).append("\n"); 
		query.append("    NC.CONV_PRC_DE_TERM_CD   ," ).append("\n"); 
		query.append("    NC.BKG_RAT_UT_CD      ," ).append("\n"); 
		query.append("    NC.BKG_PRC_CGO_TP_CD    ," ).append("\n"); 
		query.append("    NC.RT_APPL_TP_CD      ," ).append("\n"); 
		query.append("    NC.RT_OP_CD         ," ).append("\n"); 
		query.append("    NC.CURR_CD         ," ).append("\n"); 
		query.append("    NC.FRT_RT_AMT        ," ).append("\n"); 
		query.append("    NC.PAY_TERM_CD" ).append("\n"); 
		query.append("FROM  NC" ).append("\n"); 
		query.append("WHERE  ROW_NUMBER = 1" ).append("\n"); 
		query.append("UNION ALL" ).append("\n"); 
		query.append("SELECT BQ.BQ_SEQ                    ," ).append("\n"); 
		query.append("    NULL         NOTE_CONV_MAPG_ID     ," ).append("\n"); 
		query.append("    NULL         NOTE_CONV_SEQ       ," ).append("\n"); 
		query.append("    'B'          BKG_CONV_TP_CD      ," ).append("\n"); 
		query.append("    NULL         NOTE_CONV_TP_CD      ," ).append("\n"); 
		query.append("    0			 CONV_TP_PRIO			," ).append("\n"); 
		query.append("    'R'          CHG_RULE_TP_CD            ," ).append("\n"); 
		query.append("    NULL         NOTE_CONV_CHG_CD     ," ).append("\n"); 
		query.append("    RC.NOTE_CONV_RULE_CD NOTE_CONV_RULE_CD     , /* TYP */" ).append("\n"); 
		query.append("    BQ.CTRT_CNTR_TPSZ_CD CONV_RAT_UT_CD      ," ).append("\n"); 
		query.append("    ( SELECT A.CNTR_SZ_CD FROM PRI_RAT_UT A WHERE A.RAT_UT_CD = BQ.CTRT_CNTR_TPSZ_CD ) CONV_RAT_UT_SZ_CD  ," ).append("\n"); 
		query.append("    BQ.PRC_CGO_TP_CD   CONV_PRC_CGO_TP_CD    ," ).append("\n"); 
		query.append("    'L'          CONV_ORG_LOC_TP_CD    ," ).append("\n"); 
		query.append("    BQ.POR_CD    CONV_ORG_LOC_DEF_CD    ," ).append("\n"); 
		query.append("    'L'          CONV_ORG_VIA_LOC_TP_CD  ," ).append("\n"); 
		query.append("    BQ.POL_CD    CONV_ORG_VIA_LOC_DEF_CD  ," ).append("\n"); 
		query.append("    'L'          CONV_DEST_VIA_LOC_TP_CD  ," ).append("\n"); 
		query.append("    BQ.POD_CD    CONV_DEST_VIA_LOC_DEF_CD ," ).append("\n"); 
		query.append("    'L'          CONV_DEST_LOC_TP_CD    ," ).append("\n"); 
		query.append("    BQ.DEL_CD    CONV_DEST_LOC_DEF_CD   ," ).append("\n"); 
		query.append("    BQ.RCV_TERM_CD    CONV_PRC_RCV_TERM_CD   ," ).append("\n"); 
		query.append("    BQ.DE_TERM_CD     CONV_PRC_DE_TERM_CD    ," ).append("\n"); 
		query.append("    BQ.CTRT_CNTR_TPSZ_CD BKG_RAT_UT_CD       ," ).append("\n"); 
		query.append("    BQ.PRC_CGO_TP_CD   BKG_PRC_CGO_TP_CD     ," ).append("\n"); 
		query.append("    NULL         RT_APPL_TP_CD       ," ).append("\n"); 
		query.append("    NULL         RT_OP_CD         ," ).append("\n"); 
		query.append("    NULL         CURR_CD          ," ).append("\n"); 
		query.append("    NULL         FRT_RT_AMT        ," ).append("\n"); 
		query.append("    NULL         PAY_TERM_CD" ).append("\n"); 
		query.append("FROM  BQ ," ).append("\n"); 
		query.append("    (" ).append("\n"); 
		query.append("    SELECT 'TYP' NOTE_CONV_RULE_CD FROM DUAL" ).append("\n"); 
		query.append("    ) RC" ).append("\n"); 
		query.append(") ," ).append("\n"); 
		query.append("C1 AS (" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("< CONVERSION SURCHARGE >" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("S Subject        : Tariff Surcharge 를 적용하겠다." ).append("\n"); 
		query.append("I Include        : Subjrect 와 동일 ( 단, 표시만 'I' )" ).append("\n"); 
		query.append("F Fix Amount     : 고정 값" ).append("\n"); 
		query.append("A Adjust Adjust  : Tariff Surcharge 에 계산 공식 적용 + - * /, Lower 는 더 낮은값, Higher 는 더 높은 값." ).append("\n"); 
		query.append("N Not Applicable : Tariff Surcharge 도 적용하지 않겠다." ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("MTCH_PRIO 가 같은데.. CMDT 와 ROUT 만의 MTCH_PRIO 도 같으면 ERROR 로직 발생해야하는데.." ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("SELECT C1.BQ_SEQ       ," ).append("\n"); 
		query.append("    C1.SEL_TP_CD      ," ).append("\n"); 
		query.append("    C1.SEL_TP_PRIO     ," ).append("\n"); 
		query.append("    C1.CHG_CD       ," ).append("\n"); 
		query.append("/* 2010.03.24 ADD */" ).append("\n"); 
		query.append("    CASE" ).append("\n"); 
		query.append("	WHEN C1.RAT_UT_CD = 'PC' AND SP.FLT_PCT_TP_CD = 'P' THEN SP.FLT_PCT_TP_CD" ).append("\n"); 
		query.append("	ELSE 'F'" ).append("\n"); 
		query.append("	END	FLT_PCT_TP_CD				," ).append("\n"); 
		query.append("	CASE" ).append("\n"); 
		query.append("	WHEN C1.RAT_UT_CD = 'PC' AND SP.FLT_PCT_TP_CD = 'P' THEN SP.PCT_BSE_CD" ).append("\n"); 
		query.append("	ELSE NULL" ).append("\n"); 
		query.append("	END	PCT_BSE_CD					," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    C1.RT_APPL_TP_CD    ," ).append("\n"); 
		query.append("    C1.RT_OP_CD      ," ).append("\n"); 
		query.append("    C1.CURR_CD             ," ).append("\n"); 
		query.append("    C1.FRT_RT_AMT     ," ).append("\n"); 
		query.append("    C1.TYP_BKG_CONV_TP_CD ," ).append("\n"); 
		query.append("    C1.RAT_UT_CD      ," ).append("\n"); 
		query.append("    C1.PRC_CGO_TP_CD    ," ).append("\n"); 
		query.append("    C1.RT_INCL_FLG" ).append("\n"); 
		query.append("FROM  (" ).append("\n"); 
		query.append("    SELECT C.BQ_SEQ       ," ).append("\n"); 
		query.append("        'C'         SEL_TP_CD      ," ).append("\n"); 
		query.append("        1          SEL_TP_PRIO     ," ).append("\n"); 
		query.append("		/* charge code 별루 unique 하게 걸러짐     앗싸~!!!!!!*/" ).append("\n"); 
		query.append("        ROW_NUMBER() OVER ( PARTITION BY C.BQ_SEQ, C.NOTE_CONV_CHG_CD" ).append("\n"); 
		query.append("                  ORDER BY" ).append("\n"); 
		query.append("                   ( SELECT A.PRIO_SEQ FROM PRI_NOTE_CONV_TP A WHERE A.PRC_CTRT_TP_CD = BQ.CTRT_TP_CD AND A.NOTE_CONV_TP_CD = C.NOTE_CONV_TP_CD ) ," ).append("\n"); 
		query.append("                   DECODE(C_TYP.BKG_CONV_TP_CD, 'B', 10, 'C', 0)" ).append("\n"); 
		query.append("                   + DECODE(C.BKG_RAT_UT_CD, '20', 5, '40', 5, 'HC', 5, '45', 5, '53', 5, 'BL', 4, 'BX', 4, 'PC', 4, 'CM', 4, 'MT', 4, 'RM', 4, NULL, 4, 6) DESC" ).append("\n"); 
		query.append("                 ) ROW_NUMBER     ," ).append("\n"); 
		query.append("    " ).append("\n"); 
		query.append("        C.NOTE_CONV_CHG_CD CHG_CD       ," ).append("\n"); 
		query.append("        NULL        FLT_PCT_TP_CD    ," ).append("\n"); 
		query.append("        NULL        PCT_BSE_CD     ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        C.RT_APPL_TP_CD             ," ).append("\n"); 
		query.append("        C.RT_OP_CD               ," ).append("\n"); 
		query.append("        C.CURR_CD                      ," ).append("\n"); 
		query.append("/* 2010.03.24 ADD */" ).append("\n"); 
		query.append("        BQ.SVC_SCP_CD           ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        CASE" ).append("\n"); 
		query.append("        WHEN C_TYP.BKG_CONV_TP_CD = 'C' AND C_TYP.RT_OP_CD = '+' THEN C.FRT_RT_AMT + C_TYP.FRT_RT_AMT" ).append("\n"); 
		query.append("        WHEN C_TYP.BKG_CONV_TP_CD = 'C' AND C_TYP.RT_OP_CD = '-' THEN C.FRT_RT_AMT - C_TYP.FRT_RT_AMT" ).append("\n"); 
		query.append("        WHEN C_TYP.BKG_CONV_TP_CD = 'C' AND C_TYP.RT_OP_CD = '*' THEN C.FRT_RT_AMT * C_TYP.FRT_RT_AMT" ).append("\n"); 
		query.append("        WHEN C_TYP.BKG_CONV_TP_CD = 'C' AND C_TYP.RT_OP_CD = '/' THEN C.FRT_RT_AMT / C_TYP.FRT_RT_AMT" ).append("\n"); 
		query.append("        WHEN C_TYP.BKG_CONV_TP_CD = 'B' THEN C.FRT_RT_AMT" ).append("\n"); 
		query.append("        END FRT_RT_AMT             ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        C_TYP.BKG_CONV_TP_CD TYP_BKG_CONV_TP_CD ," ).append("\n"); 
		query.append("        C.BKG_RAT_UT_CD    RAT_UT_CD      ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        C.BKG_PRC_CGO_TP_CD  PRC_CGO_TP_CD    ," ).append("\n"); 
		query.append("        CASE WHEN C_NOT.RT_APPL_TP_CD = 'I' AND C.NOTE_CONV_CHG_CD NOT IN ( 'WHF', 'AST', 'GST', 'VDT', 'VTT', 'GRI', 'OAR', 'DAR', 'OIH', 'DIH' )" ).append("\n"); 
		query.append("			 THEN 'Y' ELSE	DECODE(C.RT_APPL_TP_CD, 'I', 'Y', 'N')" ).append("\n"); 
		query.append("		END	RT_INCL_FLG	," ).append("\n"); 
		query.append("		DECODE(C_NOT.BKG_CONV_TP_CD, 'C', 'Y', 'N') NOT_RULE_FLG	" ).append("\n"); 
		query.append("    FROM  BQ     ," ).append("\n"); 
		query.append("        NC_P C   ,  /* charge */" ).append("\n"); 
		query.append("        NC_P C_TYP, /* type */" ).append("\n"); 
		query.append("        NC_P C_NOT  /* not */" ).append("\n"); 
		query.append("    WHERE  C.BQ_SEQ        = BQ.BQ_SEQ" ).append("\n"); 
		query.append("    AND   C.CHG_RULE_TP_CD    = 'C' " ).append("\n"); 
		query.append("    AND   C_TYP.BQ_SEQ      = BQ.BQ_SEQ" ).append("\n"); 
		query.append("    AND   C_TYP.NOTE_CONV_RULE_CD = 'TYP'" ).append("\n"); 
		query.append("    AND   C_NOT.BQ_SEQ(+)      = C.BQ_SEQ" ).append("\n"); 
		query.append("    AND   C_NOT.NOTE_CONV_RULE_CD(+) = 'NOT'" ).append("\n"); 
		query.append("    AND   C_NOT.CONV_TP_PRIO(+) < C.CONV_TP_PRIO" ).append("\n"); 
		query.append("    " ).append("\n"); 
		query.append("    " ).append("\n"); 
		query.append("    /* RATING UNIT */" ).append("\n"); 
		query.append("    AND     (" ).append("\n"); 
		query.append("			C.BKG_RAT_UT_CD	IS NULL" ).append("\n"); 
		query.append("              OR  C.BKG_RAT_UT_CD = C_TYP.CONV_RAT_UT_CD" ).append("\n"); 
		query.append("/* 2010.03.24 ADD */" ).append("\n"); 
		query.append("              OR C.BKG_RAT_UT_CD IN ( 'BX', 'BL', 'PC' )" ).append("\n"); 
		query.append("              OR" ).append("\n"); 
		query.append("              (" ).append("\n"); 
		query.append("                C.BKG_RAT_UT_CD IN ( '20', '40', 'HC', '45', '53' )" ).append("\n"); 
		query.append("              AND ( SELECT A.CNTR_SZ_CD FROM PRI_RAT_UT A WHERE A.RAT_UT_CD = C.BKG_RAT_UT_CD ) = C_TYP.CONV_RAT_UT_SZ_CD" ).append("\n"); 
		query.append("              )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    ) C1 ," ).append("\n"); 
		query.append("/* 2010.03.24 ADD */" ).append("\n"); 
		query.append("     PRI_SCG_PRF	SP" ).append("\n"); 
		query.append("WHERE SP.SVC_SCP_CD(+)	= C1.SVC_SCP_CD		/* BKG_SVC_SCP_CD 를 사용한다. */" ).append("\n"); 
		query.append("AND	SP.CHG_CD(+)		= C1.CHG_CD" ).append("\n"); 
		query.append("AND C1.ROW_NUMBER = 1" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("NOT RULE 적용" ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("AND	NOT	(" ).append("\n"); 
		query.append("			C1.NOT_RULE_FLG	= 'Y'" ).append("\n"); 
		query.append("		AND	C1.RT_INCL_FLG		= 'N'" ).append("\n"); 
		query.append("		AND	C1.CHG_CD			NOT IN ( 'WHF', 'AST', 'GST', 'VDT', 'VTT', 'GRI', 'OAR', 'DAR', 'OIH', 'DIH' )" ).append("\n"); 
		query.append("		)" ).append("\n"); 
		query.append(") ," ).append("\n"); 
		query.append("G2 AS (" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("< GOH >" ).append("\n"); 
		query.append("BAR TYPE 별 ROW 구분 있음." ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("TYPE RULE CODE 가 적용되기는 하지만, 운임 계산은 하지 않고, 계약서에 있는 운임을 그대로 사용한다." ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("- BKG Special Cargo 정보 중 Hanger 정보가 있고, S/C상에 해당하는 GOH 운임이 존재하는 경우 Rating" ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("SELECT BQ_SEQ       ," ).append("\n"); 
		query.append("    SEL_TP_CD      ," ).append("\n"); 
		query.append("    SEL_TP_PRIO     ," ).append("\n"); 
		query.append("    CHG_CD       ," ).append("\n"); 
		query.append("    FLT_PCT_TP_CD    ," ).append("\n"); 
		query.append("    PCT_BSE_CD     ," ).append("\n"); 
		query.append("    RT_APPL_TP_CD    ," ).append("\n"); 
		query.append("    RT_OP_CD      ," ).append("\n"); 
		query.append("    CURR_CD             ," ).append("\n"); 
		query.append("    FRT_RT_AMT     ," ).append("\n"); 
		query.append("    TYP_BKG_CONV_TP_CD ," ).append("\n"); 
		query.append("    RAT_UT_CD      ," ).append("\n"); 
		query.append("    PRC_CGO_TP_CD    ," ).append("\n"); 
		query.append("    RT_INCL_FLG     ," ).append("\n"); 
		query.append("    NOT_RULE_FLG" ).append("\n"); 
		query.append("FROM  (" ).append("\n"); 
		query.append("    SELECT BQ.BQ_SEQ         ," ).append("\n"); 
		query.append("        'G'  SEL_TP_CD      ," ).append("\n"); 
		query.append("        2    SEL_TP_PRIO     ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        ROW_NUMBER() OVER ( PARTITION BY BQ.BQ_SEQ" ).append("\n"); 
		query.append("                  ORDER BY" ).append("\n"); 
		query.append("                   DECODE(C_TYP.BKG_CONV_TP_CD, 'B', 2000, 'C', 1000, 0)" ).append("\n"); 
		query.append("                    + DECODE(GH.ROUT_PNT_LOC_TP_CD, 'L', 600, 'G', 500, 'T', 400, 'R', 300, 'C', 200, 0)" ).append("\n"); 
		query.append("                    + DECODE(GH.RAT_UT_CD, '20', 5, '40', 5, 'HC', 5, '45', 5, '53', 5, 'BX', 4, 'BL', 3, NULL, 0, 6) DESC" ).append("\n"); 
		query.append("                 ) ROW_NUMBER ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        'GOH' CHG_CD       ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        NULL FLT_PCT_TP_CD    ," ).append("\n"); 
		query.append("        NULL PCT_BSE_CD     ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        NULL RT_APPL_TP_CD    ," ).append("\n"); 
		query.append("        NULL RT_OP_CD      ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        GH.CURR_CD        ," ).append("\n"); 
		query.append("        GH.FNL_FRT_RT_AMT  FRT_RT_AMT ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        C_TYP.BKG_CONV_TP_CD TYP_BKG_CONV_TP_CD ," ).append("\n"); 
		query.append("        GH.RAT_UT_CD       ," ).append("\n"); 
		query.append("        NULL PRC_CGO_TP_CD    ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        'N' RT_INCL_FLG      ," ).append("\n"); 
		query.append("        'N' NOT_RULE_FLG" ).append("\n"); 
		query.append("    FROM  BQ            ," ).append("\n"); 
		query.append("        PRI_SP_SCP_GOH_CHG GH  ," ).append("\n"); 
		query.append("        NC_P        C_TYP" ).append("\n"); 
		query.append("    WHERE  GH.PROP_NO       = BQ.PROP_NO" ).append("\n"); 
		query.append("    AND   GH.AMDT_SEQ       = BQ.AMDT_SEQ" ).append("\n"); 
		query.append("    AND   GH.SVC_SCP_CD      = BQ.SVC_SCP_CD" ).append("\n"); 
		query.append("    AND   C_TYP.BQ_SEQ      = BQ.BQ_SEQ" ).append("\n"); 
		query.append("    AND   C_TYP.NOTE_CONV_RULE_CD = 'TYP'" ).append("\n"); 
		query.append("    /* POR */" ).append("\n"); 
		query.append("    AND   (" ).append("\n"); 
		query.append("          GH.ROUT_PNT_LOC_DEF_CD = DECODE(GH.ROUT_PNT_LOC_TP_CD, 'L', BQ.POR_CD, 'T', BQ.POR_STE_CD, 'R', BQ.POR_RGN_CD, 'C', BQ.POR_CNT_CD)" ).append("\n"); 
		query.append("        OR (" ).append("\n"); 
		query.append("            GH.ROUT_PNT_LOC_TP_CD = 'G'" ).append("\n"); 
		query.append("          AND EXISTS (" ).append("\n"); 
		query.append("                SELECT 'X'" ).append("\n"); 
		query.append("                FROM   GL" ).append("\n"); 
		query.append("                WHERE  GL.PRC_GRP_LOC_CD = GH.ROUT_PNT_LOC_DEF_CD" ).append("\n"); 
		query.append("                AND   GL.LOC_CD     = BQ.POR_CD" ).append("\n"); 
		query.append("                )" ).append("\n"); 
		query.append("          )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    /* RATING UNIT */" ).append("\n"); 
		query.append("    AND     (" ).append("\n"); 
		query.append("            GH.RAT_UT_CD = C_TYP.CONV_RAT_UT_CD" ).append("\n"); 
		query.append("              OR GH.RAT_UT_CD IN ( 'BL', 'BX', 'PC', 'RM' )" ).append("\n"); 
		query.append("              OR" ).append("\n"); 
		query.append("              (" ).append("\n"); 
		query.append("                GH.RAT_UT_CD IN ( '20', '40', 'HC', '45', '53' )" ).append("\n"); 
		query.append("              AND ( SELECT A.CNTR_SZ_CD FROM PRI_RAT_UT A WHERE A.RAT_UT_CD = GH.RAT_UT_CD ) = C_TYP.CONV_RAT_UT_SZ_CD" ).append("\n"); 
		query.append("              )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("< RT_APPL_TP_CD = 'N' (Not Applicable) >" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("S Subject" ).append("\n"); 
		query.append("I Include (SUBJECT 와 동일       단, 금액이 이미 OFT에 포함되어 있으므로 보이기만 할뿐 추가로 계산되어지지 않는다!! ** PRS에서 계산되어 지면 안됨.)" ).append("\n"); 
		query.append("F Fix Amount" ).append("\n"); 
		query.append("A Adjust" ).append("\n"); 
		query.append("N Not Applicable ( 해당 CHARGE 적용 하지 않는다. 해당 CHARGE 는 TARIFF에서 제외! )" ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("    AND   NOT EXISTS (   /* (Not Applicable) */" ).append("\n"); 
		query.append("              SELECT 'X'" ).append("\n"); 
		query.append("              FROM  C1" ).append("\n"); 
		query.append("              WHERE  C1.BQ_SEQ     = BQ.BQ_SEQ" ).append("\n"); 
		query.append("              AND   C1.CHG_CD     = 'GOH'" ).append("\n"); 
		query.append("              AND   C1.RT_APPL_TP_CD = 'N'  " ).append("\n"); 
		query.append("              )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("WHERE  ROW_NUMBER = 1" ).append("\n"); 
		query.append(") ," ).append("\n"); 
		query.append("S3 AS" ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("< TARIFF SURCHARGE >" ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("SELECT BQ_SEQ       ," ).append("\n"); 
		query.append("    SEL_TP_CD      ," ).append("\n"); 
		query.append("    SEL_TP_PRIO     ," ).append("\n"); 
		query.append("    CHG_CD       ," ).append("\n"); 
		query.append("    FLT_PCT_TP_CD    ," ).append("\n"); 
		query.append("    PCT_BSE_CD     ," ).append("\n"); 
		query.append("    RT_APPL_TP_CD    ," ).append("\n"); 
		query.append("    RT_OP_CD      ," ).append("\n"); 
		query.append("    CURR_CD             ," ).append("\n"); 
		query.append("    FRT_RT_AMT     ," ).append("\n"); 
		query.append("    TYP_BKG_CONV_TP_CD ," ).append("\n"); 
		query.append("    RAT_UT_CD      ," ).append("\n"); 
		query.append("    PRC_CGO_TP_CD    ," ).append("\n"); 
		query.append("    RT_INCL_FLG     ," ).append("\n"); 
		query.append("    NOT_RULE_FLG" ).append("\n"); 
		query.append("FROM  (" ).append("\n"); 
		query.append("    SELECT BQ.BQ_SEQ         ," ).append("\n"); 
		query.append("        'S'  SEL_TP_CD      ," ).append("\n"); 
		query.append("        3    SEL_TP_PRIO     ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        ROW_NUMBER() OVER ( PARTITION BY BQ.BQ_SEQ, SP.CHG_CD" ).append("\n"); 
		query.append("                  ORDER BY" ).append("\n"); 
		query.append("                    DECODE(SR.POR_TP_CD, 'L', 600, 'G', 500, 'T', 400, 'R', 300, 'C', 200, 0)" ).append("\n"); 
		query.append("                    + DECODE(SR.POL_TP_CD, 'L', 600, 'G', 500, 'T', 400, 'R', 300, 'C', 200, 0)" ).append("\n"); 
		query.append("                    + DECODE(SR.POD_TP_CD, 'L', 600, 'G', 500, 'T', 400, 'R', 300, 'C', 200, 0)" ).append("\n"); 
		query.append("                    + DECODE(SR.DEL_TP_CD, 'L', 600, 'G', 500, 'T', 400, 'R', 300, 'C', 200, 0)" ).append("\n"); 
		query.append("                    + DECODE(C_TYP.BKG_CONV_TP_CD, 'B', 10, 'C', 0)" ).append("\n"); 
		query.append("                    + DECODE(SR.RAT_UT_CD, '20', 5, '40', 5, 'HC', 5, '53', 5, 'BL', 4, 'BX', 4, 'PC', 4, 'CM', 4, 'MT', 4, 'RM', 4, NULL, 4, 6)" ).append("\n"); 
		query.append("                    + DECODE(SR.PRC_CGO_TP_CD    , NULL, 0, 1)" ).append("\n"); 
		query.append("                    + DECODE(SR.USA_SVC_MOD_CD   , NULL, 0, 1)" ).append("\n"); 
		query.append("                    + DECODE(SR.ORG_TRSP_MOD_CD   , NULL, 0, 1)" ).append("\n"); 
		query.append("                    + DECODE(SR.DEST_TRSP_MOD_CD  , NULL, 0, 1)" ).append("\n"); 
		query.append("                    + DECODE(SR.PRC_RCV_TERM_CD   , NULL, 0, 1)" ).append("\n"); 
		query.append("                    + DECODE(SR.PRC_DE_TERM_CD   , NULL, 0, 1)" ).append("\n"); 
		query.append("                    + DECODE(SR.VSL_SLAN_CD     , NULL, 0, 1)" ).append("\n"); 
		query.append("                    + DECODE(SR.TS_PORT_CD     , NULL, 0, 1)" ).append("\n"); 
		query.append("                    + DECODE(SR.SUB_TRD_CD     , NULL, 0, 1) DESC," ).append("\n"); 
		query.append("                     NVL(SR.CTRT_DT, TO_DATE('19000101','YYYYMMDD')) DESC" ).append("\n"); 
		query.append("                 ) ROW_NUMBER ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        SP.CHG_CD         ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        SP.FLT_PCT_TP_CD     ," ).append("\n"); 
		query.append("        SP.PCT_BSE_CD       ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        NULL RT_APPL_TP_CD    ," ).append("\n"); 
		query.append("        NULL RT_OP_CD      ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        SR.CURR_CD        ," ).append("\n"); 
		query.append("        CASE" ).append("\n"); 
		query.append("        WHEN C_TYP.BKG_CONV_TP_CD = 'C' AND C_TYP.RT_OP_CD = '+' THEN SR.SCG_AMT + C_TYP.FRT_RT_AMT" ).append("\n"); 
		query.append("        WHEN C_TYP.BKG_CONV_TP_CD = 'C' AND C_TYP.RT_OP_CD = '-' THEN SR.SCG_AMT - C_TYP.FRT_RT_AMT" ).append("\n"); 
		query.append("        WHEN C_TYP.BKG_CONV_TP_CD = 'C' AND C_TYP.RT_OP_CD = '*' THEN SR.SCG_AMT * C_TYP.FRT_RT_AMT" ).append("\n"); 
		query.append("        WHEN C_TYP.BKG_CONV_TP_CD = 'C' AND C_TYP.RT_OP_CD = '/' THEN SR.SCG_AMT / C_TYP.FRT_RT_AMT" ).append("\n"); 
		query.append("        WHEN C_TYP.BKG_CONV_TP_CD = 'B' THEN SR.SCG_AMT" ).append("\n"); 
		query.append("        END FRT_RT_AMT      ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        C_TYP.BKG_CONV_TP_CD TYP_BKG_CONV_TP_CD ," ).append("\n"); 
		query.append("        SR.RAT_UT_CD       ," ).append("\n"); 
		query.append("        SR.PRC_CGO_TP_CD     ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        CASE WHEN C_NOT.RT_APPL_TP_CD = 'I' AND SP.CHG_CD NOT IN ( 'WHF', 'AST', 'GST', 'VDT', 'VTT', 'GRI', 'OAR', 'DAR', 'OIH', 'DIH' )" ).append("\n"); 
		query.append("			 THEN 'Y' ELSE	'N'" ).append("\n"); 
		query.append("		END	RT_INCL_FLG	 ," ).append("\n"); 
		query.append("        DECODE(C_NOT.BKG_CONV_TP_CD, 'C', 'Y', 'N') NOT_RULE_FLG" ).append("\n"); 
		query.append("    FROM  BQ         ," ).append("\n"); 
		query.append("        PRI_SCG_PRF  SP  ," ).append("\n"); 
		query.append("        MDM_CHARGE  MC  ," ).append("\n"); 
		query.append("        PRI_SCG_RT  SR  ," ).append("\n"); 
		query.append("        NC_P     C_TYP ,     /* RATING UNIT CONVERSION */" ).append("\n"); 
		query.append("        NC_P     C_NOT" ).append("\n"); 
		query.append("    WHERE  SP.SVC_SCP_CD        = BQ.SVC_SCP_CD" ).append("\n"); 
		query.append("    AND   MC.CHG_CD          = SP.CHG_CD" ).append("\n"); 
		query.append("    AND   MC.AUTO_RAT_FLG       = 'Y'" ).append("\n"); 
		query.append("    AND   SR.SVC_SCP_CD        = SP.SVC_SCP_CD" ).append("\n"); 
		query.append("    AND   SR.CHG_CD          = SP.CHG_CD" ).append("\n"); 
		query.append("    AND   TO_DATE(SYSDATE)      BETWEEN SR.EFF_DT AND SR.EXP_DT + 0.99999  /* 0.99999 는 23시 59분 59초를 의미 */" ).append("\n"); 
		query.append("    AND   SR.WDR_FLG         = 'N'" ).append("\n"); 
		query.append("    AND   SR.DELT_FLG         = 'N'" ).append("\n"); 
		query.append("    AND   C_TYP.BQ_SEQ        = BQ.BQ_SEQ" ).append("\n"); 
		query.append("    AND   C_TYP.NOTE_CONV_RULE_CD   = 'TYP'" ).append("\n"); 
		query.append("    AND   C_NOT.BQ_SEQ(+)       = BQ.BQ_SEQ" ).append("\n"); 
		query.append("    AND   C_NOT.NOTE_CONV_RULE_CD(+) = 'NOT'" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("R/D TERM CHECK ( MDM_CHARGE 의 R/D TERM CHECK 포함 )" ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("    AND   (" ).append("\n"); 
		query.append("          SR.PRC_RCV_TERM_CD = BQ.RCV_TERM_CD" ).append("\n"); 
		query.append("        OR (" ).append("\n"); 
		query.append("            ( SP.RCV_DE_TERM_USE_FLG = 'N' OR SR.PRC_RCV_TERM_CD IS NULL )" ).append("\n"); 
		query.append("          AND BQ.RCV_TERM_CD IN ( DECODE(MC.NA_RD_TERM_FLG, 'Y', BQ.RCV_TERM_CD), DECODE(MC.CY_RD_TERM_FLG, 'Y', 'Y'), DECODE(MC.DOR_RD_TERM_FLG, 'Y', 'D'), DECODE(MC.CFS_RD_TERM_FLG, 'Y', 'S'), DECODE(MC.TKL_TML_FLG, 'Y', 'T') )" ).append("\n"); 
		query.append("          )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    AND   (" ).append("\n"); 
		query.append("          SR.PRC_DE_TERM_CD  = BQ.DE_TERM_CD" ).append("\n"); 
		query.append("        OR (" ).append("\n"); 
		query.append("            ( SP.RCV_DE_TERM_USE_FLG = 'N' OR SR.PRC_DE_TERM_CD IS NULL )" ).append("\n"); 
		query.append("          AND BQ.DE_TERM_CD  IN ( DECODE(MC.NA_RD_TERM_FLG, 'Y', BQ.DE_TERM_CD), DECODE(MC.CY_RD_TERM_FLG, 'Y', 'Y'), DECODE(MC.DOR_RD_TERM_FLG, 'Y', 'D'), DECODE(MC.CFS_RD_TERM_FLG, 'Y', 'S'), DECODE(MC.TKL_TML_FLG, 'Y', 'T') )" ).append("\n"); 
		query.append("          )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    /* POR */" ).append("\n"); 
		query.append("    AND   (" ).append("\n"); 
		query.append("          SP.POR_USE_FLG = 'N'" ).append("\n"); 
		query.append("        OR SR.POR_DEF_CD  IS NULL" ).append("\n"); 
		query.append("        OR  SR.POR_DEF_CD  = DECODE(SR.POR_TP_CD, 'L', BQ.POR_CD, 'T', BQ.POR_STE_CD, 'R', BQ.POR_RGN_CD, 'C', BQ.POR_CNT_CD)" ).append("\n"); 
		query.append("        OR (" ).append("\n"); 
		query.append("            SR.POR_TP_CD = 'G'" ).append("\n"); 
		query.append("          AND EXISTS (" ).append("\n"); 
		query.append("                SELECT 'X'" ).append("\n"); 
		query.append("                FROM  PRI_SCG_GRP_LOC   GL ," ).append("\n"); 
		query.append("                    PRI_SCG_GRP_LOC_DTL GD" ).append("\n"); 
		query.append("                WHERE  GD.SVC_SCP_CD   = GL.SVC_SCP_CD" ).append("\n"); 
		query.append("                AND   GD.CHG_CD     = GL.CHG_CD" ).append("\n"); 
		query.append("                AND   GD.GRP_LOC_SEQ  = GL.GRP_LOC_SEQ" ).append("\n"); 
		query.append("                AND   GL.SVC_SCP_CD   = SR.SVC_SCP_CD" ).append("\n"); 
		query.append("                AND   GL.CHG_CD     = SR.CHG_CD" ).append("\n"); 
		query.append("                AND   GL.SCG_GRP_LOC_CD = SR.POR_DEF_CD" ).append("\n"); 
		query.append("                AND   GD.DTL_LOC_DEF_CD = DECODE(GD.DTL_LOC_TP_CD, 'L', BQ.POR_CD, 'T', BQ.POR_STE_CD, 'R', BQ.POR_RGN_CD, 'C', BQ.POR_CNT_CD)" ).append("\n"); 
		query.append("                )" ).append("\n"); 
		query.append("          )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    /* POL */" ).append("\n"); 
		query.append("    AND   (" ).append("\n"); 
		query.append("          SP.POL_USE_FLG = 'N'" ).append("\n"); 
		query.append("        OR SR.POL_DEF_CD  IS NULL" ).append("\n"); 
		query.append("        OR  SR.POL_DEF_CD  = DECODE(SR.POL_TP_CD, 'L', BQ.POL_CD, 'T', BQ.POL_STE_CD, 'R', BQ.POL_RGN_CD, 'C', BQ.POL_CNT_CD)" ).append("\n"); 
		query.append("        OR (" ).append("\n"); 
		query.append("            SR.POL_TP_CD = 'G'" ).append("\n"); 
		query.append("          AND EXISTS (" ).append("\n"); 
		query.append("                SELECT 'X'" ).append("\n"); 
		query.append("                FROM  PRI_SCG_GRP_LOC   GL ," ).append("\n"); 
		query.append("                    PRI_SCG_GRP_LOC_DTL GD" ).append("\n"); 
		query.append("                WHERE  GD.SVC_SCP_CD   = GL.SVC_SCP_CD" ).append("\n"); 
		query.append("                AND   GD.CHG_CD     = GL.CHG_CD" ).append("\n"); 
		query.append("                AND   GD.GRP_LOC_SEQ  = GL.GRP_LOC_SEQ" ).append("\n"); 
		query.append("                AND   GL.SVC_SCP_CD   = SR.SVC_SCP_CD" ).append("\n"); 
		query.append("                AND   GL.CHG_CD     = SR.CHG_CD" ).append("\n"); 
		query.append("                AND   GL.SCG_GRP_LOC_CD = SR.POL_DEF_CD" ).append("\n"); 
		query.append("                AND   GD.DTL_LOC_DEF_CD = DECODE(GD.DTL_LOC_TP_CD, 'L', BQ.POL_CD, 'T', BQ.POL_STE_CD, 'R', BQ.POL_RGN_CD, 'C', BQ.POL_CNT_CD)" ).append("\n"); 
		query.append("                )" ).append("\n"); 
		query.append("          )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    /* POD */" ).append("\n"); 
		query.append("    AND   (" ).append("\n"); 
		query.append("          SP.POD_USE_FLG = 'N'" ).append("\n"); 
		query.append("        OR SR.POD_DEF_CD  IS NULL" ).append("\n"); 
		query.append("        OR  SR.POD_DEF_CD  = DECODE(SR.POD_TP_CD, 'L', BQ.POD_CD, 'T', BQ.POD_STE_CD, 'R', BQ.POD_RGN_CD, 'C', BQ.POD_CNT_CD)" ).append("\n"); 
		query.append("        OR (" ).append("\n"); 
		query.append("            SR.POD_TP_CD = 'G'" ).append("\n"); 
		query.append("          AND EXISTS (" ).append("\n"); 
		query.append("                SELECT 'X'" ).append("\n"); 
		query.append("                FROM  PRI_SCG_GRP_LOC   GL ," ).append("\n"); 
		query.append("                    PRI_SCG_GRP_LOC_DTL GD" ).append("\n"); 
		query.append("                WHERE  GD.SVC_SCP_CD   = GL.SVC_SCP_CD" ).append("\n"); 
		query.append("                AND   GD.CHG_CD     = GL.CHG_CD" ).append("\n"); 
		query.append("                AND   GD.GRP_LOC_SEQ  = GL.GRP_LOC_SEQ" ).append("\n"); 
		query.append("                AND   GL.SVC_SCP_CD   = SR.SVC_SCP_CD" ).append("\n"); 
		query.append("                AND   GL.CHG_CD     = SR.CHG_CD" ).append("\n"); 
		query.append("                AND   GL.SCG_GRP_LOC_CD = SR.POD_DEF_CD" ).append("\n"); 
		query.append("                AND   GD.DTL_LOC_DEF_CD = DECODE(GD.DTL_LOC_TP_CD, 'L', BQ.POD_CD, 'T', BQ.POD_STE_CD, 'R', BQ.POD_RGN_CD, 'C', BQ.POD_CNT_CD)" ).append("\n"); 
		query.append("                )" ).append("\n"); 
		query.append("          )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    /* DEL */" ).append("\n"); 
		query.append("    AND   (" ).append("\n"); 
		query.append("          SP.DEL_USE_FLG = 'N'" ).append("\n"); 
		query.append("        OR SR.DEL_DEF_CD  IS NULL" ).append("\n"); 
		query.append("        OR  SR.DEL_DEF_CD  = DECODE(SR.DEL_TP_CD, 'L', BQ.DEL_CD, 'T', BQ.DEL_STE_CD, 'R', BQ.DEL_RGN_CD, 'C', BQ.DEL_CNT_CD)" ).append("\n"); 
		query.append("        OR (" ).append("\n"); 
		query.append("            SR.DEL_TP_CD = 'G'" ).append("\n"); 
		query.append("          AND EXISTS (" ).append("\n"); 
		query.append("                SELECT 'X'" ).append("\n"); 
		query.append("                FROM  PRI_SCG_GRP_LOC   GL ," ).append("\n"); 
		query.append("                    PRI_SCG_GRP_LOC_DTL GD" ).append("\n"); 
		query.append("                WHERE  GD.SVC_SCP_CD   = GL.SVC_SCP_CD" ).append("\n"); 
		query.append("                AND   GD.CHG_CD     = GL.CHG_CD" ).append("\n"); 
		query.append("                AND   GD.GRP_LOC_SEQ  = GL.GRP_LOC_SEQ" ).append("\n"); 
		query.append("                AND   GL.SVC_SCP_CD   = SR.SVC_SCP_CD" ).append("\n"); 
		query.append("                AND   GL.CHG_CD     = SR.CHG_CD" ).append("\n"); 
		query.append("                AND   GL.SCG_GRP_LOC_CD = SR.DEL_DEF_CD" ).append("\n"); 
		query.append("                AND   GD.DTL_LOC_DEF_CD = DECODE(GD.DTL_LOC_TP_CD, 'L', BQ.DEL_CD, 'T', BQ.DEL_STE_CD, 'R', BQ.DEL_RGN_CD, 'C', BQ.DEL_CNT_CD)" ).append("\n"); 
		query.append("                )" ).append("\n"); 
		query.append("          )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("	/* SUB TRADE */" ).append("\n"); 
		query.append("    AND   (" ).append("\n"); 
		query.append("          SP.SUB_TRD_USE_FLG = 'N'" ).append("\n"); 
		query.append("        OR SR.SUB_TRD_CD    IS NULL" ).append("\n"); 
		query.append("        OR SR.SUB_TRD_CD    IN" ).append("\n"); 
		query.append("          (" ).append("\n"); 
		query.append("          SELECT DL.SUB_TRD_CD" ).append("\n"); 
		query.append("          FROM   MDM_DTL_REV_LANE  DL" ).append("\n"); 
		query.append("          WHERE (DL.RLANE_CD, DL.VSL_SLAN_DIR_CD, DL.FM_CONTI_CD, DL.TO_CONTI_CD ) IN " ).append("\n"); 
		query.append("          		(SELECT BQ.N1ST_RLANE_CD, SUBSTR(BQ.N1ST_FINC_VVD_CD, 9,1), BQ.N1ST_POL_CONTI_CD, BQ.N1ST_POD_CONTI_CD  FROM DUAL  " ).append("\n"); 
		query.append("          		 UNION ALL" ).append("\n"); 
		query.append("          		 SELECT BQ.N2ND_RLANE_CD, SUBSTR(BQ.N2ND_FINC_VVD_CD, 9,1), BQ.N2ND_POL_CONTI_CD, BQ.N2ND_POD_CONTI_CD  FROM DUAL" ).append("\n"); 
		query.append("          		 UNION ALL" ).append("\n"); 
		query.append("          		 SELECT BQ.N3RD_RLANE_CD, SUBSTR(BQ.N3RD_FINC_VVD_CD, 9,1), BQ.N3RD_POL_CONTI_CD, BQ.N3RD_POD_CONTI_CD  FROM DUAL" ).append("\n"); 
		query.append("          		 UNION ALL" ).append("\n"); 
		query.append("          		 SELECT BQ.N4TH_RLANE_CD, SUBSTR(BQ.N4TH_FINC_VVD_CD, 9,1), BQ.N4TH_POL_CONTI_CD, BQ.N4TH_POD_CONTI_CD  FROM DUAL" ).append("\n"); 
		query.append("          		 ) " ).append("\n"); 
		query.append("          AND   DL.DELT_FLG     = 'N'" ).append("\n"); 
		query.append("          )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    /* LANE */" ).append("\n"); 
		query.append("    AND   (" ).append("\n"); 
		query.append("          SP.SLAN_USE_FLG = 'N'" ).append("\n"); 
		query.append("        OR SR.VSL_SLAN_CD IS NULL" ).append("\n"); 
		query.append("        OR SR.VSL_SLAN_CD IN ( BQ.N1ST_RLANE_CD, BQ.N2ND_RLANE_CD, BQ.N3RD_RLANE_CD, BQ.N4TH_RLANE_CD )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    /* T/S PORT */" ).append("\n"); 
		query.append("    AND   (" ).append("\n"); 
		query.append("          SP.TS_PORT_USE_FLG = 'N'" ).append("\n"); 
		query.append("        OR SR.TS_PORT_CD    IS NULL" ).append("\n"); 
		query.append("        OR SR.TS_PORT_CD    IN ( BQ.N1ST_TS_PORT_CD, BQ.N2ND_TS_PORT_CD, BQ.N3RD_TS_PORT_CD )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    /* ORG TRANS MODE */" ).append("\n"); 
		query.append("    AND   (" ).append("\n"); 
		query.append("          SP.TRNS_MOD_USE_FLG = 'N'" ).append("\n"); 
		query.append("        OR SR.ORG_TRSP_MOD_CD IS NULL" ).append("\n"); 
		query.append("        OR SR.ORG_TRSP_MOD_CD = BQ.ORG_TRNS_MOD_CD" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    /* DEST TRANS MODE */" ).append("\n"); 
		query.append("    AND   (" ).append("\n"); 
		query.append("          SP.TRNS_MOD_USE_FLG = 'N'" ).append("\n"); 
		query.append("        OR SR.DEST_TRSP_MOD_CD IS NULL" ).append("\n"); 
		query.append("        OR SR.DEST_TRSP_MOD_CD = BQ.DEST_TRNS_MOD_CD" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    /* USA SVC MODE */" ).append("\n"); 
		query.append("    AND   (" ).append("\n"); 
		query.append("          SP.USA_SVC_MOD_USE_FLG = 'N'" ).append("\n"); 
		query.append("        OR SR.USA_SVC_MOD_CD    IS NULL" ).append("\n"); 
		query.append("        OR SR.USA_SVC_MOD_CD    = DECODE(SR.USA_SVC_MOD_CD, 'CZ', BQ.CML_ZN_CD, BQ.USA_SVC_MOD_CD )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("< CANAL >" ).append("\n"); 
		query.append("P : PAPAC" ).append("\n"); 
		query.append("S : EGSUC" ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("    AND	(" ).append("\n"); 
		query.append("          SP.CNL_TZ_FLG  = 'N'" ).append("\n"); 
		query.append("        OR SR.CNL_TZ_CD  IS NULL" ).append("\n"); 
		query.append("        OR EXISTS (" ).append("\n"); 
		query.append("              SELECT 'X'" ).append("\n"); 
		query.append("              FROM   VSK_VSL_PORT_SKD S1 ," ).append("\n"); 
		query.append("                  VSK_VSL_PORT_SKD S2 ," ).append("\n"); 
		query.append("                  VSK_VSL_PORT_SKD S3" ).append("\n"); 
		query.append("              WHERE S1.VSL_CD    = SUBSTR(BQ.N1ST_FINC_VVD_CD,1,4)" ).append("\n"); 
		query.append("              AND   S1.SKD_VOY_NO  = SUBSTR(BQ.N1ST_FINC_VVD_CD,5,4)" ).append("\n"); 
		query.append("              AND   S1.SKD_DIR_CD  = SUBSTR(BQ.N1ST_FINC_VVD_CD,9,1)" ).append("\n"); 
		query.append("              AND   S1.VPS_PORT_CD = BQ.N1ST_POL_CD" ).append("\n"); 
		query.append("--              AND   S1.CLPT_IND_SEQ = BV.POL_CLPT_IND_SEQ" ).append("\n"); 
		query.append("              AND   S2.VSL_CD    = SUBSTR(BQ.N1ST_FINC_VVD_CD,1,4)" ).append("\n"); 
		query.append("              AND   S2.SKD_VOY_NO  = SUBSTR(BQ.N1ST_FINC_VVD_CD,5,4)" ).append("\n"); 
		query.append("              AND   S2.SKD_DIR_CD  = SUBSTR(BQ.N1ST_FINC_VVD_CD,9,1)" ).append("\n"); 
		query.append("              AND   S2.VPS_PORT_CD = BQ.N1ST_POD_CD" ).append("\n"); 
		query.append("--              AND   S2.CLPT_IND_SEQ = BV.POD_CLPT_IND_SEQ" ).append("\n"); 
		query.append("              AND   S3.VSL_CD    = SUBSTR(BQ.N1ST_FINC_VVD_CD,1,4)" ).append("\n"); 
		query.append("              AND   S3.SKD_VOY_NO  = SUBSTR(BQ.N1ST_FINC_VVD_CD,5,4)" ).append("\n"); 
		query.append("              AND   S3.SKD_DIR_CD  = SUBSTR(BQ.N1ST_FINC_VVD_CD,9,1)" ).append("\n"); 
		query.append("              AND   S3.VPS_PORT_CD = DECODE(SR.CNL_TZ_CD, 'P', 'PAPAC', 'S', 'EGSUC')" ).append("\n"); 
		query.append("              AND   S3.CLPT_SEQ   BETWEEN S1.CLPT_SEQ AND S2.CLPT_SEQ " ).append("\n"); 
		query.append("            UNION ALL" ).append("\n"); 
		query.append("              SELECT 'X'" ).append("\n"); 
		query.append("              FROM   VSK_VSL_PORT_SKD S1 ," ).append("\n"); 
		query.append("                  VSK_VSL_PORT_SKD S2 ," ).append("\n"); 
		query.append("                  VSK_VSL_PORT_SKD S3" ).append("\n"); 
		query.append("              WHERE S1.VSL_CD    = SUBSTR(BQ.N2ND_FINC_VVD_CD,1,4)" ).append("\n"); 
		query.append("              AND   S1.SKD_VOY_NO  = SUBSTR(BQ.N2ND_FINC_VVD_CD,5,4)" ).append("\n"); 
		query.append("              AND   S1.SKD_DIR_CD  = SUBSTR(BQ.N2ND_FINC_VVD_CD,9,1)" ).append("\n"); 
		query.append("              AND   S1.VPS_PORT_CD = BQ.N2ND_POL_CD" ).append("\n"); 
		query.append("--              AND   S1.CLPT_IND_SEQ = BV.POL_CLPT_IND_SEQ" ).append("\n"); 
		query.append("              AND   S2.VSL_CD    = SUBSTR(BQ.N2ND_FINC_VVD_CD,1,4)" ).append("\n"); 
		query.append("              AND   S2.SKD_VOY_NO  = SUBSTR(BQ.N2ND_FINC_VVD_CD,5,4)" ).append("\n"); 
		query.append("              AND   S2.SKD_DIR_CD  = SUBSTR(BQ.N2ND_FINC_VVD_CD,9,1)" ).append("\n"); 
		query.append("              AND   S2.VPS_PORT_CD = BQ.N2ND_POD_CD" ).append("\n"); 
		query.append("--              AND   S2.CLPT_IND_SEQ = BV.POD_CLPT_IND_SEQ" ).append("\n"); 
		query.append("              AND   S3.VSL_CD    = SUBSTR(BQ.N2ND_FINC_VVD_CD,1,4)" ).append("\n"); 
		query.append("              AND   S3.SKD_VOY_NO  = SUBSTR(BQ.N2ND_FINC_VVD_CD,5,4)" ).append("\n"); 
		query.append("              AND   S3.SKD_DIR_CD  = SUBSTR(BQ.N2ND_FINC_VVD_CD,9,1)" ).append("\n"); 
		query.append("              AND   S3.VPS_PORT_CD = DECODE(SR.CNL_TZ_CD, 'P', 'PAPAC', 'S', 'EGSUC')" ).append("\n"); 
		query.append("              AND   S3.CLPT_SEQ   BETWEEN S1.CLPT_SEQ AND S2.CLPT_SEQ                                         " ).append("\n"); 
		query.append("            UNION ALL" ).append("\n"); 
		query.append("              SELECT 'X'" ).append("\n"); 
		query.append("              FROM   VSK_VSL_PORT_SKD S1 ," ).append("\n"); 
		query.append("                  VSK_VSL_PORT_SKD S2 ," ).append("\n"); 
		query.append("                  VSK_VSL_PORT_SKD S3" ).append("\n"); 
		query.append("              WHERE S1.VSL_CD    = SUBSTR(BQ.N3RD_FINC_VVD_CD,1,4)" ).append("\n"); 
		query.append("              AND   S1.SKD_VOY_NO  = SUBSTR(BQ.N3RD_FINC_VVD_CD,5,4)" ).append("\n"); 
		query.append("              AND   S1.SKD_DIR_CD  = SUBSTR(BQ.N3RD_FINC_VVD_CD,9,1)" ).append("\n"); 
		query.append("              AND   S1.VPS_PORT_CD = BQ.N3RD_POL_CD" ).append("\n"); 
		query.append("--              AND   S1.CLPT_IND_SEQ = BV.POL_CLPT_IND_SEQ" ).append("\n"); 
		query.append("              AND   S2.VSL_CD    = SUBSTR(BQ.N3RD_FINC_VVD_CD,1,4)" ).append("\n"); 
		query.append("              AND   S2.SKD_VOY_NO  = SUBSTR(BQ.N3RD_FINC_VVD_CD,5,4)" ).append("\n"); 
		query.append("              AND   S2.SKD_DIR_CD  = SUBSTR(BQ.N3RD_FINC_VVD_CD,9,1)" ).append("\n"); 
		query.append("              AND   S2.VPS_PORT_CD = BQ.N3RD_POD_CD" ).append("\n"); 
		query.append("--              AND   S2.CLPT_IND_SEQ = BV.POD_CLPT_IND_SEQ" ).append("\n"); 
		query.append("              AND   S3.VSL_CD    = SUBSTR(BQ.N3RD_FINC_VVD_CD,1,4)" ).append("\n"); 
		query.append("              AND   S3.SKD_VOY_NO  = SUBSTR(BQ.N3RD_FINC_VVD_CD,5,4)" ).append("\n"); 
		query.append("              AND   S3.SKD_DIR_CD  = SUBSTR(BQ.N3RD_FINC_VVD_CD,9,1)" ).append("\n"); 
		query.append("              AND   S3.VPS_PORT_CD = DECODE(SR.CNL_TZ_CD, 'P', 'PAPAC', 'S', 'EGSUC')" ).append("\n"); 
		query.append("              AND   S3.CLPT_SEQ   BETWEEN S1.CLPT_SEQ AND S2.CLPT_SEQ                                         " ).append("\n"); 
		query.append("            UNION ALL" ).append("\n"); 
		query.append("              SELECT 'X'" ).append("\n"); 
		query.append("              FROM   VSK_VSL_PORT_SKD S1 ," ).append("\n"); 
		query.append("                  VSK_VSL_PORT_SKD S2 ," ).append("\n"); 
		query.append("                  VSK_VSL_PORT_SKD S3" ).append("\n"); 
		query.append("              WHERE S1.VSL_CD    = SUBSTR(BQ.N4TH_FINC_VVD_CD,1,4)" ).append("\n"); 
		query.append("              AND   S1.SKD_VOY_NO  = SUBSTR(BQ.N4TH_FINC_VVD_CD,5,4)" ).append("\n"); 
		query.append("              AND   S1.SKD_DIR_CD  = SUBSTR(BQ.N4TH_FINC_VVD_CD,9,1)" ).append("\n"); 
		query.append("              AND   S1.VPS_PORT_CD = BQ.N4TH_POL_CD" ).append("\n"); 
		query.append("--              AND   S1.CLPT_IND_SEQ = BV.POL_CLPT_IND_SEQ" ).append("\n"); 
		query.append("              AND   S2.VSL_CD    = SUBSTR(BQ.N4TH_FINC_VVD_CD,1,4)" ).append("\n"); 
		query.append("              AND   S2.SKD_VOY_NO  = SUBSTR(BQ.N4TH_FINC_VVD_CD,5,4)" ).append("\n"); 
		query.append("              AND   S2.SKD_DIR_CD  = SUBSTR(BQ.N4TH_FINC_VVD_CD,9,1)" ).append("\n"); 
		query.append("              AND   S2.VPS_PORT_CD = BQ.N4TH_POD_CD" ).append("\n"); 
		query.append("--              AND   S2.CLPT_IND_SEQ = BV.POD_CLPT_IND_SEQ" ).append("\n"); 
		query.append("              AND   S3.VSL_CD    = SUBSTR(BQ.N4TH_FINC_VVD_CD,1,4)" ).append("\n"); 
		query.append("              AND   S3.SKD_VOY_NO  = SUBSTR(BQ.N4TH_FINC_VVD_CD,5,4)" ).append("\n"); 
		query.append("              AND   S3.SKD_DIR_CD  = SUBSTR(BQ.N4TH_FINC_VVD_CD,9,1)" ).append("\n"); 
		query.append("              AND   S3.VPS_PORT_CD = DECODE(SR.CNL_TZ_CD, 'P', 'PAPAC', 'S', 'EGSUC')" ).append("\n"); 
		query.append("              AND   S3.CLPT_SEQ   BETWEEN S1.CLPT_SEQ AND S2.CLPT_SEQ                                         " ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    ) " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    /* CARGO TYPE */" ).append("\n"); 
		query.append("    AND   (" ).append("\n"); 
		query.append("          SR.PRC_CGO_TP_CD IS NULL" ).append("\n"); 
		query.append("        OR SR.PRC_CGO_TP_CD = BQ.PRC_CGO_TP_CD" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("     /* CONTRACT DATE [CHM-201324203] */" ).append("\n"); 
		query.append("     AND     (" ).append("\n"); 
		query.append("            SP.CTRT_DT_USE_FLG = 'N'" ).append("\n"); 
		query.append("           OR  SR.CTRT_DT IS NULL" ).append("\n"); 
		query.append("           OR  SR.CTRT_DT <= (SELECT CTRT_EFF_DT " ).append("\n"); 
		query.append("                               FROM PRI_SP_DUR" ).append("\n"); 
		query.append("                              WHERE PROP_NO = BQ.PROP_NO" ).append("\n"); 
		query.append("                                AND AMDT_SEQ = BQ.AMDT_SEQ)" ).append("\n"); 
		query.append("             )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    /* RATING UNIT */" ).append("\n"); 
		query.append("    AND     (" ).append("\n"); 
		query.append("          SR.RAT_UT_CD IN ( 'BL', 'BX', 'PC', 'RM' )" ).append("\n"); 
		query.append("        OR SR.RAT_UT_CD = C_TYP.CONV_RAT_UT_CD" ).append("\n"); 
		query.append("            OR (" ).append("\n"); 
		query.append("                SR.RAT_UT_CD IN ( '20', '40', 'HC', '45', '53' )" ).append("\n"); 
		query.append("              AND ( SELECT A.CNTR_SZ_CD FROM PRI_RAT_UT A WHERE A.RAT_UT_CD = SR.RAT_UT_CD ) = C_TYP.CONV_RAT_UT_SZ_CD" ).append("\n"); 
		query.append("              )" ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("< RT_APPL_TP_CD = 'N' (Not Applicable) >" ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("    AND   NOT EXISTS (" ).append("\n"); 
		query.append("              SELECT 'X'" ).append("\n"); 
		query.append("              FROM  C1" ).append("\n"); 
		query.append("              WHERE  C1.BQ_SEQ     = BQ.BQ_SEQ" ).append("\n"); 
		query.append("              AND   C1.CHG_CD     = SP.CHG_CD" ).append("\n"); 
		query.append("              AND   C1.RT_APPL_TP_CD = 'N'" ).append("\n"); 
		query.append("              )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("< GOH >" ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("    AND   NOT EXISTS (" ).append("\n"); 
		query.append("              SELECT 'X'" ).append("\n"); 
		query.append("              FROM  G2" ).append("\n"); 
		query.append("              WHERE  G2.BQ_SEQ     = BQ.BQ_SEQ" ).append("\n"); 
		query.append("              AND   G2.CHG_CD     = SP.CHG_CD" ).append("\n"); 
		query.append("              )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("WHERE  ROW_NUMBER = 1" ).append("\n"); 
		query.append(") ," ).append("\n"); 
		query.append("SG AS (" ).append("\n"); 
		query.append("SELECT BQ_SEQ       ," ).append("\n"); 
		query.append("    SEL_TP_CD      ," ).append("\n"); 
		query.append("    SEL_TP_PRIO     ," ).append("\n"); 
		query.append("    CHG_CD       ," ).append("\n"); 
		query.append("    FLT_PCT_TP_CD    ," ).append("\n"); 
		query.append("    PCT_BSE_CD     ," ).append("\n"); 
		query.append("    RT_APPL_TP_CD    ," ).append("\n"); 
		query.append("    RT_OP_CD      ," ).append("\n"); 
		query.append("    CURR_CD             ," ).append("\n"); 
		query.append("    FRT_RT_AMT     ," ).append("\n"); 
		query.append("    TYP_BKG_CONV_TP_CD ," ).append("\n"); 
		query.append("    RAT_UT_CD      ," ).append("\n"); 
		query.append("    PRC_CGO_TP_CD    ," ).append("\n"); 
		query.append("    RT_INCL_FLG" ).append("\n"); 
		query.append("FROM  C1" ).append("\n"); 
		query.append("WHERE  RT_APPL_TP_CD  = 'F'" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("TARIFF SURCHARGE 에 0 으로 등록된 것이 있으면 NOTE CONVERSION 에 입력된 것을 받지 않는다." ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("AND   CHG_CD     NOT IN ( SELECT CHG_CD FROM S3 WHERE S3.BQ_SEQ = C1.BQ_SEQ AND S3.FRT_RT_AMT = 0 )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("UNION ALL" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("SELECT BQ_SEQ       ," ).append("\n"); 
		query.append("    SEL_TP_CD      ," ).append("\n"); 
		query.append("    SEL_TP_PRIO     ," ).append("\n"); 
		query.append("    CHG_CD       ," ).append("\n"); 
		query.append("    FLT_PCT_TP_CD    ," ).append("\n"); 
		query.append("    PCT_BSE_CD     ," ).append("\n"); 
		query.append("    RT_APPL_TP_CD    ," ).append("\n"); 
		query.append("    RT_OP_CD      ," ).append("\n"); 
		query.append("    CURR_CD             ," ).append("\n"); 
		query.append("    FRT_RT_AMT     ," ).append("\n"); 
		query.append("    TYP_BKG_CONV_TP_CD ," ).append("\n"); 
		query.append("    RAT_UT_CD      ," ).append("\n"); 
		query.append("    PRC_CGO_TP_CD    ," ).append("\n"); 
		query.append("    RT_INCL_FLG" ).append("\n"); 
		query.append("FROM  (" ).append("\n"); 
		query.append("    SELECT SG.BQ_SEQ       ," ).append("\n"); 
		query.append("        SG.SEL_TP_CD     ," ).append("\n"); 
		query.append("        SG.SEL_TP_PRIO    ," ).append("\n"); 
		query.append("        SG.CHG_CD       ," ).append("\n"); 
		query.append("        SG.FLT_PCT_TP_CD   ," ).append("\n"); 
		query.append("        SG.PCT_BSE_CD     ," ).append("\n"); 
		query.append("        C1.RT_APPL_TP_CD   ," ).append("\n"); 
		query.append("        NULL RT_OP_CD    ," ).append("\n"); 
		query.append("        SG.CURR_CD           ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        CASE" ).append("\n"); 
		query.append("        WHEN C1.RT_APPL_TP_CD = 'A' AND C1.RT_OP_CD = '+' THEN SG.FRT_RT_AMT + C1.FRT_RT_AMT" ).append("\n"); 
		query.append("        WHEN C1.RT_APPL_TP_CD = 'A' AND C1.RT_OP_CD = '-' THEN SG.FRT_RT_AMT - C1.FRT_RT_AMT" ).append("\n"); 
		query.append("        WHEN C1.RT_APPL_TP_CD = 'A' AND C1.RT_OP_CD = '*' THEN SG.FRT_RT_AMT * C1.FRT_RT_AMT" ).append("\n"); 
		query.append("        WHEN C1.RT_APPL_TP_CD = 'A' AND C1.RT_OP_CD = '/' THEN SG.FRT_RT_AMT / C1.FRT_RT_AMT" ).append("\n"); 
		query.append("        WHEN C1.RT_APPL_TP_CD = 'A' AND C1.RT_OP_CD = '>' THEN GREATEST(SG.FRT_RT_AMT, C1.FRT_RT_AMT)" ).append("\n"); 
		query.append("        WHEN C1.RT_APPL_TP_CD = 'A' AND C1.RT_OP_CD = '<' THEN LEAST(SG.FRT_RT_AMT, C1.FRT_RT_AMT)" ).append("\n"); 
		query.append("        ELSE SG.FRT_RT_AMT" ).append("\n"); 
		query.append("        END FRT_RT_AMT    ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        SG.TYP_BKG_CONV_TP_CD ," ).append("\n"); 
		query.append("        SG.RAT_UT_CD     ," ).append("\n"); 
		query.append("        SG.PRC_CGO_TP_CD   ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        NVL(C1.RT_INCL_FLG, SG.RT_INCL_FLG) RT_INCL_FLG ," ).append("\n"); 
		query.append("        SG.NOT_RULE_FLG" ).append("\n"); 
		query.append("    FROM  (" ).append("\n"); 
		query.append("        SELECT * FROM G2 /* GOH */" ).append("\n"); 
		query.append("        UNION ALL" ).append("\n"); 
		query.append("        SELECT * FROM S3 /* TARIFF SURCHARGE */" ).append("\n"); 
		query.append("        ) SG ," ).append("\n"); 
		query.append("        ( SELECT * FROM C1 WHERE RT_APPL_TP_CD IN ( 'S', 'I', 'A' ) ) C1" ).append("\n"); 
		query.append("    WHERE  C1.BQ_SEQ(+)    = SG.BQ_SEQ" ).append("\n"); 
		query.append("    AND   C1.CHG_CD(+)    = SG.CHG_CD" ).append("\n"); 
		query.append("    ) SG" ).append("\n"); 
		query.append("WHERE  NOT EXISTS (" ).append("\n"); 
		query.append("          SELECT 'X'" ).append("\n"); 
		query.append("          FROM  C1" ).append("\n"); 
		query.append("          WHERE  C1.BQ_SEQ     = SG.BQ_SEQ" ).append("\n"); 
		query.append("          AND   C1.CHG_CD     = SG.CHG_CD" ).append("\n"); 
		query.append("          AND   C1.RT_APPL_TP_CD = 'F'" ).append("\n"); 
		query.append("          )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("NOT RULE 적용" ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("AND   NOT (" ).append("\n"); 
		query.append("        SG.RT_APPL_TP_CD IS NULL" ).append("\n"); 
		query.append("      AND SG.NOT_RULE_FLG  = 'Y'" ).append("\n"); 
		query.append("      AND SG.RT_INCL_FLG  = 'N'" ).append("\n"); 
		query.append("      AND SG.CHG_CD NOT IN ( 'WHF', 'AST', 'GST', 'VDT', 'VTT', 'GRI', 'OAR', 'DAR', 'OIH', 'DIH' )" ).append("\n"); 
		query.append("      )" ).append("\n"); 
		query.append(") ," ).append("\n"); 
		query.append("GS AS" ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("SELECT BQ.BQ_SEQ       ," ).append("\n"); 
		query.append("    BQ.PROP_NO      ," ).append("\n"); 
		query.append("    BQ.AMDT_SEQ      ," ).append("\n"); 
		query.append("    BQ.SVC_SCP_CD     ," ).append("\n"); 
		query.append("    BQ.GEN_SPCL_RT_TP_CD ," ).append("\n"); 
		query.append("    BQ.CMDT_HDR_SEQ    ," ).append("\n"); 
		query.append("    BQ.ROUT_SEQ      ," ).append("\n"); 
		query.append("    BQ.RT_SEQ       ," ).append("\n"); 
		query.append("	SG.RT_INCL_FLG , /* 2010.03.23 ADD */" ).append("\n"); 
		query.append("    SG.CHG_CD       ," ).append("\n"); 
		query.append("    SG.FLT_PCT_TP_CD   ," ).append("\n"); 
		query.append("    SG.PCT_BSE_CD     ," ).append("\n"); 
		query.append("    SG.CURR_CD      ," ).append("\n"); 
		query.append("    CASE" ).append("\n"); 
		query.append("    WHEN SG.RAT_UT_CD = 'PC' THEN 0 -- 나중에 구해야 한다." ).append("\n"); 
		query.append("    WHEN SG.RT_INCL_FLG = 'Y' THEN 0 " ).append("\n"); 
		query.append("    ELSE SG.FRT_RT_AMT" ).append("\n"); 
		query.append("    END CHG_UT_AMT    ," ).append("\n"); 
		query.append("    CASE" ).append("\n"); 
		query.append("    WHEN SG.RAT_UT_CD = 'BL' THEN 1" ).append("\n"); 
		query.append("    WHEN SG.RAT_UT_CD = 'PC' THEN SG.FRT_RT_AMT" ).append("\n"); 
		query.append("    WHEN SG.RAT_UT_CD = 'RM' THEN BQ.PRD_RD_CNT" ).append("\n"); 
		query.append("    ELSE 1" ).append("\n"); 
		query.append("    END RAT_AS_QTY    ," ).append("\n"); 
		query.append("    SG.RAT_UT_CD     ," ).append("\n"); 
		query.append("    0 CHG_AMT       ," ).append("\n"); 
		query.append("    BQ.PRC_CGO_TP_CD CGO_TP_CD ," ).append("\n"); 
		query.append("    BQ.RCV_TERM_CD    ," ).append("\n"); 
		query.append("    BQ.DE_TERM_CD	," ).append("\n"); 
		query.append("    BQ.POR_CNT_CD   ," ).append("\n"); 
		query.append("    BQ.DEL_CNT_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("FROM  BQ ," ).append("\n"); 
		query.append("    SG" ).append("\n"); 
		query.append("WHERE  SG.BQ_SEQ  = BQ.BQ_SEQ" ).append("\n"); 
		query.append("  AND  SG.CHG_CD NOT IN ( DECODE(BQ.CUST_TP_CD, 'N', 'XXX', 'NMS' )) /* CUSTOMER TYPE 이 NVOCC 인 경우만 NMS 존재 */" ).append("\n"); 
		query.append(") ," ).append("\n"); 
		query.append("FN AS" ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("GENERAL SURCHARGE" ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("SELECT BQ_SEQ       ," ).append("\n"); 
		query.append("    PROP_NO       ," ).append("\n"); 
		query.append("    AMDT_SEQ      ," ).append("\n"); 
		query.append("    SVC_SCP_CD     ," ).append("\n"); 
		query.append("    GEN_SPCL_RT_TP_CD  ," ).append("\n"); 
		query.append("    CMDT_HDR_SEQ    ," ).append("\n"); 
		query.append("    ROUT_SEQ      ," ).append("\n"); 
		query.append("    RT_SEQ       ," ).append("\n"); 
		query.append("	RT_INCL_FLG , /* 2010.03.23 ADD */" ).append("\n"); 
		query.append("    CHG_CD       ," ).append("\n"); 
		query.append("    FLT_PCT_TP_CD    ," ).append("\n"); 
		query.append("    PCT_BSE_CD     ," ).append("\n"); 
		query.append("    CURR_CD       ," ).append("\n"); 
		query.append("    CHG_UT_AMT     ," ).append("\n"); 
		query.append("    RAT_AS_QTY     ," ).append("\n"); 
		query.append("    RAT_UT_CD      ," ).append("\n"); 
		query.append("    CHG_UT_AMT * RAT_AS_QTY CHG_AMT ," ).append("\n"); 
		query.append("    CGO_TP_CD      ," ).append("\n"); 
		query.append("    RCV_TERM_CD     ," ).append("\n"); 
		query.append("    DE_TERM_CD      ," ).append("\n"); 
		query.append("    POR_CNT_CD      ," ).append("\n"); 
		query.append("    DEL_CNT_CD" ).append("\n"); 
		query.append("FROM  GS" ).append("\n"); 
		query.append("WHERE  CHG_CD  NOT IN (" ).append("\n"); 
		query.append("             'ACT'" ).append("\n"); 
		query.append("             )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("UNION ALL" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("/*******************************************************************************************" ).append("\n"); 
		query.append("ACT" ).append("\n"); 
		query.append("*******************************************************************************************/" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("SELECT GS.BQ_SEQ        ," ).append("\n"); 
		query.append("    GS.PROP_NO       ," ).append("\n"); 
		query.append("    GS.AMDT_SEQ       ," ).append("\n"); 
		query.append("    GS.SVC_SCP_CD      ," ).append("\n"); 
		query.append("    GS.GEN_SPCL_RT_TP_CD  ," ).append("\n"); 
		query.append("    GS.CMDT_HDR_SEQ     ," ).append("\n"); 
		query.append("    GS.ROUT_SEQ       ," ).append("\n"); 
		query.append("    GS.RT_SEQ        ," ).append("\n"); 
		query.append("	GS.RT_INCL_FLG     , /* 2010.03.23 ADD */" ).append("\n"); 
		query.append("    GS.CHG_CD        ," ).append("\n"); 
		query.append("    GS.FLT_PCT_TP_CD    ," ).append("\n"); 
		query.append("    GS.PCT_BSE_CD      ," ).append("\n"); 
		query.append("    GS.CURR_CD       ," ).append("\n"); 
		query.append("    GS.CHG_UT_AMT      ," ).append("\n"); 
		query.append("    GS.RAT_AS_QTY      ," ).append("\n"); 
		query.append("    GS.RAT_UT_CD      ," ).append("\n"); 
		query.append("    GS.CHG_UT_AMT * GS.RAT_AS_QTY CHG_AMT ," ).append("\n"); 
		query.append("    GS.CGO_TP_CD      ," ).append("\n"); 
		query.append("    GS.RCV_TERM_CD     ," ).append("\n"); 
		query.append("    GS.DE_TERM_CD		," ).append("\n"); 
		query.append("    GS.POR_CNT_CD      ," ).append("\n"); 
		query.append("    GS.DEL_CNT_CD" ).append("\n"); 
		query.append("FROM  BQ ," ).append("\n"); 
		query.append("    GS" ).append("\n"); 
		query.append("WHERE GS.BQ_SEQ = BQ.BQ_SEQ" ).append("\n"); 
		query.append("AND   GS.CHG_CD = 'ACT'" ).append("\n"); 
		query.append("AND     (" ).append("\n"); 
		query.append("        (" ).append("\n"); 
		query.append("          BQ.SVC_SCP_CD    = 'TPE'" ).append("\n"); 
		query.append("        AND BQ.POD_CD      IN ( 'USLGB', 'USLAX' )" ).append("\n"); 
		query.append("        AND BQ.POD_CD      <> BQ.DEL_CD" ).append("\n"); 
		query.append("        AND BQ.DEST_TRNS_MOD_CD IN ( 'R', 'A' )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    OR   (" ).append("\n"); 
		query.append("          BQ.SVC_SCP_CD    = 'TPW'" ).append("\n"); 
		query.append("        AND BQ.POL_CD      IN ( 'USLGB', 'USLAX' )" ).append("\n"); 
		query.append("        AND BQ.POL_CD      <> BQ.POR_CD" ).append("\n"); 
		query.append("        AND BQ.ORG_TRNS_MOD_CD IN ( 'R', 'A' )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    OR   (" ).append("\n"); 
		query.append("          BQ.SVC_SCP_CD    <> 'TPE'" ).append("\n"); 
		query.append("        AND BQ.DEL_CNT_CD    = 'US'" ).append("\n"); 
		query.append("        AND BQ.POD_CD      IN ( 'USNYC', 'USSAV', 'USCHS', 'USORF', 'USBOS' )" ).append("\n"); 
		query.append("        AND EXISTS (" ).append("\n"); 
		query.append("              SELECT 'X'" ).append("\n"); 
		query.append("              FROM  PRD_INLND_ROUT_MST IR" ).append("\n"); 
		query.append("              WHERE  IR.ROUT_ORG_NOD_CD    LIKE BQ.POD_CD||'%'" ).append("\n"); 
		query.append("              AND   IR.ROUT_DEST_NOD_CD  LIKE BQ.DEL_CD||'%'" ).append("\n"); 
		query.append("              AND   IR.PCTL_IO_BND_CD   = 'I'" ).append("\n"); 
		query.append("              AND   IR.HUB_NOD_CD     LIKE 'USLGB'||'%'" ).append("\n"); 
		query.append("              AND   IR.INLND_ROUT_BKG_FLG = 'Y'" ).append("\n"); 
		query.append("              AND   NVL(IR.DELT_FLG, 'N') = 'N'" ).append("\n"); 
		query.append("              )" ).append("\n"); 
		query.append("        AND BQ.DEST_TRNS_MOD_CD IN ( 'R', 'A' )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    OR   (" ).append("\n"); 
		query.append("          BQ.SVC_SCP_CD    <> 'TPW'" ).append("\n"); 
		query.append("        AND BQ.POR_CNT_CD    = 'US'" ).append("\n"); 
		query.append("        AND BQ.POL_CD      IN ( 'USNYC', 'USSAV', 'USCHS', 'USORF', 'USBOS' )" ).append("\n"); 
		query.append("        AND EXISTS (" ).append("\n"); 
		query.append("              SELECT 'X'" ).append("\n"); 
		query.append("              FROM  PRD_INLND_ROUT_MST IR" ).append("\n"); 
		query.append("              WHERE  IR.ROUT_ORG_NOD_CD    LIKE BQ.POR_CD||'%'" ).append("\n"); 
		query.append("              AND   IR.ROUT_DEST_NOD_CD  LIKE BQ.POL_CD||'%'" ).append("\n"); 
		query.append("              AND   IR.PCTL_IO_BND_CD   = 'O'" ).append("\n"); 
		query.append("              AND   IR.HUB_NOD_CD     LIKE 'USLGB'||'%'" ).append("\n"); 
		query.append("              AND   IR.INLND_ROUT_BKG_FLG = 'Y'" ).append("\n"); 
		query.append("              AND   NVL(IR.DELT_FLG, 'N') = 'N'" ).append("\n"); 
		query.append("              )" ).append("\n"); 
		query.append("        AND BQ.ORG_TRNS_MOD_CD IN ( 'R', 'A' )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("SELECT FN.PROP_NO   ," ).append("\n"); 
		query.append("    FN.AMDT_SEQ     ," ).append("\n"); 
		query.append("    FN.SVC_SCP_CD   ," ).append("\n"); 
		query.append("    FN.GEN_SPCL_RT_TP_CD ," ).append("\n"); 
		query.append("    FN.CMDT_HDR_SEQ ," ).append("\n"); 
		query.append("    FN.ROUT_SEQ     ," ).append("\n"); 
		query.append("    FN.RT_SEQ       ," ).append("\n"); 
		query.append("	FN.RT_INCL_FLG  AS RT_INCL_FLG, /* 2010.03.23 ADD */" ).append("\n"); 
		query.append("    FN.CHG_CD       ," ).append("\n"); 
		query.append("    FN.RAT_UT_CD    ," ).append("\n"); 
		query.append("    NVL(FN.CURR_CD, 'USD') AS CURR_CD  ," ).append("\n"); 
		query.append("    NVL(CASE" ).append("\n"); 
		query.append("    WHEN FN.RT_INCL_FLG = 'N' AND FN.RAT_UT_CD = 'PC' THEN NVL(F1.CHG_AMT, 0) * FN.RAT_AS_QTY / 100" ).append("\n"); 
		query.append("    ELSE FN.CHG_AMT END, 0)             AS TRF_SCG_AMT  ," ).append("\n"); 
		query.append("    NVL(CASE" ).append("\n"); 
		query.append("    WHEN FN.RT_INCL_FLG = 'N' AND FN.RAT_UT_CD = 'PC' THEN NVL(F1.CHG_AMT, 0) * FN.RAT_AS_QTY / 100" ).append("\n"); 
		query.append("    ELSE FN.CHG_AMT END, 0)             AS ADJ_SCG_AMT  ," ).append("\n"); 
		query.append("    NVL(CASE" ).append("\n"); 
		query.append("    WHEN FN.RT_INCL_FLG = 'N' AND FN.RAT_UT_CD = 'PC' THEN NVL(F1.CHG_AMT, 0) * FN.RAT_AS_QTY / 100" ).append("\n"); 
		query.append("    ELSE FN.CHG_AMT" ).append("\n"); 
		query.append("    END, 0) / DECODE(NVL(USD_LOCL_XCH_RT,0), 0, 1, USD_LOCL_XCH_RT) AS ADJ_SCG_USD_AMT ," ).append("\n"); 
		query.append("    NULL          AS TRF_SCG_RMK," ).append("\n"); 
		query.append("    'T'             AS TRF_ADJ_TP_CD," ).append("\n"); 
		query.append("    'N'             AS ADJ_FLG," ).append("\n"); 
		query.append("    'BATCH'         AS CRE_USR_ID," ).append("\n"); 
		query.append("    SYSDATE         AS CRE_DT," ).append("\n"); 
		query.append("    'BATCH'         AS UPD_USR_ID," ).append("\n"); 
		query.append("    SYSDATE         AS UPD_DT" ).append("\n"); 
		query.append("FROM  FN ," ).append("\n"); 
		query.append("  (" ).append("\n"); 
		query.append("    SELECT BQ_SEQ  ," ).append("\n"); 
		query.append("        CHG_CD    ," ).append("\n"); 
		query.append("        SUM(CHG_AMT) CHG_AMT" ).append("\n"); 
		query.append("    FROM  (" ).append("\n"); 
		query.append("        SELECT F1.BQ_SEQ ," ).append("\n"); 
		query.append("            F1.CHG_CD    ," ).append("\n"); 
		query.append("            F2.CHG_AMT CHG_AMT" ).append("\n"); 
		query.append("        FROM  FN F1 ," ).append("\n"); 
		query.append("            FN F2" ).append("\n"); 
		query.append("        WHERE  F2.BQ_SEQ = F1.BQ_SEQ" ).append("\n"); 
		query.append("        AND   F2.CHG_CD    IN ( SELECT CHG_CD FROM PRI_SCG_PCT_BSE_CHG A WHERE A.PCT_BSE_CD = F1.PCT_BSE_CD AND SYSDATE BETWEEN EFF_DT AND EXP_DT )" ).append("\n"); 
		query.append("        AND   F2.CURR_CD   = F1.CURR_CD" ).append("\n"); 
		query.append("        AND   (" ).append("\n"); 
		query.append("              F1.CHG_CD  <> 'VTT'" ).append("\n"); 
		query.append("            OR	F2.CHG_CD	NOT IN ( DECODE(F1.POR_CNT_CD, 'VN', 'DTH', 'XXX'), DECODE(F1.POR_CNT_CD, 'VN', 'DDC', 'XXX'), DECODE(F1.DEL_CNT_CD, 'VN', 'OTH', 'XXX'), DECODE(F1.DEL_CNT_CD, 'VN', 'ORC', 'XXX') )" ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("        AND   F2.RAT_UT_CD  <> 'PC'" ).append("\n"); 
		query.append("        AND   F1.RAT_UT_CD  = 'PC'" ).append("\n"); 
		query.append("        UNION ALL" ).append("\n"); 
		query.append("        SELECT F1.BQ_SEQ ," ).append("\n"); 
		query.append("            F1.CHG_CD    ," ).append("\n"); 
		query.append("            F2.PROP_FRT_RT_AMT CHG_AMT" ).append("\n"); 
		query.append("        FROM  FN F1 ," ).append("\n"); 
		query.append("              BQ F2" ).append("\n"); 
		query.append("        WHERE  F2.BQ_SEQ = F1.BQ_SEQ" ).append("\n"); 
		query.append("        AND   'OFT'   IN ( SELECT CHG_CD FROM PRI_SCG_PCT_BSE_CHG A WHERE A.PCT_BSE_CD = F1.PCT_BSE_CD AND SYSDATE BETWEEN EFF_DT AND EXP_DT )" ).append("\n"); 
		query.append("        AND   F2.CURR_CD   = F1.CURR_CD" ).append("\n"); 
		query.append("        AND   F2.CTRT_CNTR_TPSZ_CD <> 'PC'" ).append("\n"); 
		query.append("        AND   F1.RAT_UT_CD     = 'PC'" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    GROUP BY" ).append("\n"); 
		query.append("        BQ_SEQ  ," ).append("\n"); 
		query.append("        CHG_CD" ).append("\n"); 
		query.append("    ) F1," ).append("\n"); 
		query.append("    (SELECT USD_LOCL_XCH_RT AS USD_LOCL_XCH_RT, CURR_CD FROM GL_MON_XCH_RT" ).append("\n"); 
		query.append("      WHERE ACCT_XCH_RT_YRMON = LEAST(TO_CHAR(SYSDATE, 'YYYYMM'), ( SELECT MAX(ACCT_XCH_RT_YRMON) FROM GL_MON_XCH_RT )) " ).append("\n"); 
		query.append("        AND ACCT_XCH_RT_LVL  = '1' ) XR    " ).append("\n"); 
		query.append("WHERE  F1.BQ_SEQ(+) = FN.BQ_SEQ" ).append("\n"); 
		query.append("AND   F1.CHG_CD(+)  = FN.CHG_CD" ).append("\n"); 
		query.append("AND   XR.CURR_CD(+) = FN.CURR_CD" ).append("\n"); 
		query.append("AND   FN.CHG_CD NOT IN ( 'GRI', 'GOH', 'WHF', 'GST', 'AST', 'VDT', 'VTT', 'WSC' )" ).append("\n"); 
		query.append("AND  (CASE WHEN FN.SVC_SCP_CD IN ( 'ACW','MXW','TAE','TPW' ) AND FN.CHG_CD = 'CAF' THEN 'N'" ).append("\n"); 
		query.append("           WHEN FN.SVC_SCP_CD IN ( 'ASE','ASW','TAE','TAW','TPE','TPW' ) AND FN.CHG_CD = 'CUC' THEN 'N'" ).append("\n"); 
		query.append("           WHEN FN.SVC_SCP_CD IN ( 'TPE','MXE','ACE' ) AND FN.CHG_CD = 'DDC' THEN 'N' " ).append("\n"); 
		query.append("           WHEN FN.SVC_SCP_CD IN ( 'TPE','MXE','ACE' ) AND FN.CHG_CD = 'EPS' THEN 'N'" ).append("\n"); 
		query.append("           WHEN FN.SVC_SCP_CD IN ( 'TPE','MXE','ACE' ) AND FN.CHG_CD = 'ERC' THEN 'N'" ).append("\n"); 
		query.append("           ELSE 'Y' END ) = 'Y'" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append(") B" ).append("\n"); 
		query.append("ON (    A.PROP_NO = B.PROP_NO" ).append("\n"); 
		query.append("    AND A.AMDT_SEQ = B.AMDT_SEQ" ).append("\n"); 
		query.append("    AND A.SVC_SCP_CD = B.SVC_SCP_CD" ).append("\n"); 
		query.append("    AND A.GEN_SPCL_RT_TP_CD = B.GEN_SPCL_RT_TP_CD" ).append("\n"); 
		query.append("    AND A.CMDT_HDR_SEQ = B.CMDT_HDR_SEQ" ).append("\n"); 
		query.append("    AND A.ROUT_SEQ = B.ROUT_SEQ" ).append("\n"); 
		query.append("    AND A.RT_SEQ = B.RT_SEQ" ).append("\n"); 
		query.append("    AND A.CHG_CD = B.CHG_CD     )  " ).append("\n"); 
		query.append("WHEN MATCHED THEN" ).append("\n"); 
		query.append("UPDATE SET A.TRF_SCG_AMT =  B.TRF_SCG_AMT," ).append("\n"); 
		query.append("		   A.UPD_USR_ID = @[upd_usr_id]," ).append("\n"); 
		query.append("		   A.UPD_DT = SYSDATE" ).append("\n"); 
		query.append("    " ).append("\n"); 
		query.append("WHEN NOT MATCHED THEN" ).append("\n"); 
		query.append("INSERT " ).append("\n"); 
		query.append("    (A.PROP_NO, A.AMDT_SEQ, A.SVC_SCP_CD, A.GEN_SPCL_RT_TP_CD, A.CMDT_HDR_SEQ, A.ROUT_SEQ, A.RT_SEQ," ).append("\n"); 
		query.append("    A.CHG_CD, A.BKG_RAT_UT_CD, A.CURR_CD, A.TRF_SCG_AMT, A.ADJ_SCG_AMT, A.ADJ_SCG_USD_AMT, A.TRF_SCG_RMK, " ).append("\n"); 
		query.append("    A.TRF_ADJ_TP_CD, A.ADJ_FLG, A.CRE_USR_ID, A.CRE_DT, A.UPD_USR_ID, A.UPD_DT )" ).append("\n"); 
		query.append("VALUES " ).append("\n"); 
		query.append("    (B.PROP_NO, B.AMDT_SEQ, B.SVC_SCP_CD, B.GEN_SPCL_RT_TP_CD, B.CMDT_HDR_SEQ, B.ROUT_SEQ, B.RT_SEQ," ).append("\n"); 
		query.append("    B.CHG_CD, B.RAT_UT_CD, B.CURR_CD, B.TRF_SCG_AMT, B.ADJ_SCG_AMT, B.ADJ_SCG_USD_AMT, NULL," ).append("\n"); 
		query.append("    'T', 'N', @[upd_usr_id], SYSDATE, @[upd_usr_id], SYSDATE )" ).append("\n"); 

	}
}