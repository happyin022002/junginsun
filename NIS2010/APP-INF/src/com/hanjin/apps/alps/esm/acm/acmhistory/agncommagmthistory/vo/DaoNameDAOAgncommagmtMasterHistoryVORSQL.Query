<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DaoNameDAOAgncommagmtMasterHistoryVORSQL">
			<desc><![CDATA[AgncommagmtMasterHistoryVO]]></desc>
			<sql><![CDATA[
SELECT
'' as CRE_DT_TM,
'' as CRE_GDT_TM,
'' AS AGMT_HIS_NO,
B.AGN_AGMT_NO,
A.ITEM, 
DECODE(A.SEQ,
1,MAX(DECODE(B.HIS_DIV, 'C', B.EFF_DT)),
2,MAX(DECODE(B.HIS_DIV, 'C', B.AGN_AGMT_RMK)),
3,MAX(DECODE(B.HIS_DIV, 'C', B.DELT_FLG))
) AS CURRENT_VALUE,
DECODE(A.SEQ,
1,MAX(DECODE(B.HIS_DIV, 'P', B.EFF_DT)),
2,MAX(DECODE(B.HIS_DIV, 'P', B.AGN_AGMT_RMK)),
3,MAX(DECODE(B.HIS_DIV, 'P', B.DELT_FLG))
) AS PREVIOUS_VALUE,
MAX(DECODE(B.HIS_DIV, 'C', B.CRE_USR_ID)) AS CRE_USR_ID,
MAX(DECODE(B.HIS_DIV, 'C', B.CRE_DT)) AS CRE_DT,
MAX(DECODE(B.HIS_DIV, 'C', B.CRE_GDT)) AS CRE_GDT
FROM (
SELECT 1 AS SEQ, 'Effective Date' AS ITEM FROM DUAL UNION ALL
SELECT 2 AS SEQ, 'Remark' FROM DUAL UNION ALL
SELECT 3 AS SEQ, 'Del' FROM DUAL
) A,
(
SELECT 
       A.AGN_AGMT_NO,
       DECODE(A.AGMT_HIS_NO,B.AGMT_HIS_NO,'C','P') HIS_DIV,
       DECODE(A.AGMT_FM_DT_CD, 'S', 'SA Date', 'B', 'BKG', 'R', 'Rev Month') || ' / ' || TO_CHAR(TO_DATE(A.AGMT_FM_DT, 'YYYYMMDD'), 'YYYY-MM-DD') ||
       ' ~ ' || DECODE(A.AGMT_TO_DT_CD, 'S', 'SA Date', 'B', 'BKG', 'R', 'Rev Month') || ' / ' || TO_CHAR(TO_DATE(A.AGMT_TO_DT, 'YYYYMMDD'), 'YYYY-MM-DD') EFF_DT,
       A.AGN_AGMT_RMK,
       NVL(A.DELT_FLG, 'N') AS DELT_FLG,
       A.CRE_USR_ID,
       TO_CHAR(A.CRE_DT, 'YYYY-MM-DD HH24:MI') AS CRE_DT,
       TO_CHAR(A.CRE_GDT, 'YYYY-MM-DD HH24:MI') AS CRE_GDT
  FROM ACM_AGN_AGMT_MST_HIS A,
      (SELECT
            AGN_AGMT_NO, MAX(AGMT_HIS_NO) AS AGMT_HIS_NO
        FROM ACM_AGN_AGMT_MST_HIS
        WHERE AGN_AGMT_NO = @[agn_agmt_no]
        GROUP BY AGN_AGMT_NO) B
 WHERE A.AGN_AGMT_NO = @[agn_agmt_no]
 AND A.AGN_AGMT_NO = B.AGN_AGMT_NO
 AND A.AGMT_HIS_NO >= B.AGMT_HIS_NO -1
 ) B
 GROUP BY B.AGN_AGMT_NO, A.SEQ, A.ITEM
 ORDER BY A.SEQ			]]></sql>
			<params>
				<param name="agn_agmt_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
