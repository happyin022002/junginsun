<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CsScreenDBDAOsearchUsCntrSoDtlInfoRSQL">
			<desc><![CDATA[고객 응대를 위한 Container별 S/O & W/O 발행 Status 상세 정보를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT SUBQ.CNTR_NO
      ,SUBQ.SP_CODE
      ,SUBQ.SP_NAME
      ,SUBQ.SP_TEL_NO
      ,SUBQ.COST_MODE
      ,SUBQ.NOD_CD
      ,SUBQ.STS_CD
      ,SUBQ.OFC_CD
      ,SUBQ.USR_ID
      ,USR.USR_NM
      ,SUBQ.SO_NO
      ,SUBQ.SO_DATE
      ,SUBQ.WO_NO
      ,SUBQ.WO_DATE
FROM      
(
    SELECT SORD.EQ_NO                              AS  CNTR_NO
          ,SORD.TRSP_SO_OFC_CTY_CD                 AS  TRSP_SO_OFC_CTY_CD
          ,SORD.TRSP_SO_SEQ                        AS  TRSP_SO_SEQ
          ,SORD.VNDR_SEQ                           AS  SP_CODE     -- S/P CODE  
          ,VD.VNDR_ABBR_NM                         AS  SP_NAME   -- S/P NAME 
          ,VD_CNTC.PHN_NO                          AS  SP_TEL_NO  -- S/P TEL NO. 
          ,COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00744',TRSP_COST_DTL_MOD_CD) AS  COST_MODE  
          ,CASE WHEN SORD.TRSP_BND_CD = 'O'  
             THEN SORD.FM_NOD_CD||' - ' ||DECODE(NVL(SORD.DOR_NOD_CD, ''), '', '', SORD.DOR_NOD_CD||' - ')||DECODE(NVL(SORD.VIA_NOD_CD, ''), '', '', SORD.VIA_NOD_CD||' - ')||SORD.TO_NOD_CD  
             ELSE SORD.FM_NOD_CD||' - ' ||DECODE(NVL(SORD.VIA_NOD_CD, ''), '', '', SORD.VIA_NOD_CD||' - ')||DECODE(NVL(SORD.DOR_NOD_CD, ''), '', '', SORD.DOR_NOD_CD||' - ')||SORD.TO_NOD_CD  
           END      AS  NOD_CD                     -- FROM-TO                                                      
          ,CID.INTG_CD_VAL_DP_DESC                     AS  STS_CD       -- S/O STATUS  
          ,SORD.CRE_OFC_CD                             AS  OFC_CD       -- OFFICE                                 
          ,SORD.CRE_USR_ID                             AS  USR_ID       -- USER ID                             
          ,SORD.TRSP_SO_OFC_CTY_CD||SORD.TRSP_SO_SEQ   AS  SO_NO        -- S/O NO                                 
          ,TO_CHAR(SORD.LOCL_CRE_DT, 'YYYY-MM-DD HH24:MI')    AS  SO_DATE      -- S/O DATE 
          ,SORD.TRSP_WO_OFC_CTY_CD||SORD.TRSP_WO_SEQ   AS  WO_NO        -- W/O NO                       
          ,TO_CHAR(WORD.LOCL_CRE_DT, 'YYYY-MM-DD HH24:MI:SS') AS  WO_DATE      -- W/O DATE    
    FROM BKG_CONTAINER     BCNTR
        ,TRS_TRSP_SVC_ORD  SORD  
        ,TRS_TRSP_WRK_ORD  WORD 
        ,MDM_VENDOR        VD  
        ,MDM_VNDR_CNTC_PNT VD_CNTC  
        ,COM_USER          USR
        ,COM_INTG_CD_DTL   CID
    WHERE BCNTR.BKG_NO              = @[bkg_no]
      AND SORD.BKG_NO               = BCNTR.BKG_NO
      AND SORD.EQ_NO                = BCNTR.CNTR_NO  
      AND SORD.TRSP_BND_CD          = 'I'  
      AND SORD.DELT_FLG             = 'N' 
      AND WORD.TRSP_WO_OFC_CTY_CD   = SORD.TRSP_WO_OFC_CTY_CD  
      AND WORD.TRSP_WO_SEQ          = SORD.TRSP_WO_SEQ 
      AND VD.VNDR_SEQ (+)           = SORD.VNDR_SEQ       
      AND VD_CNTC.VNDR_SEQ(+)       = SORD.VNDR_SEQ
      AND VD.DELT_FLG (+)           = 'N'           
      AND VD_CNTC.PRMRY_CHK_FLG (+) = 'Y'   
      AND VD_CNTC.PHN_NO(+)        IS NOT NULL            
      AND VD_CNTC.DELT_FLG (+)      = 'N'   
      AND USR.USR_ID (+)            = SORD.CRE_USR_ID
      AND CID.INTG_CD_VAL_CTNT(+)   = SORD.TRSP_SO_STS_CD
      AND CID.INTG_CD_ID(+)         = 'CD00275'
    UNION 
    SELECT CNTR_NO                         
          ,TRSP_SO_OFC_CTY_CD              
          ,TRSP_SO_SEQ                     
          ,SP_CODE             
          ,SP_NAME            
          ,SP_TEL_NO        
          ,COST_MODE                       
          ,NOD_CD                           
          ,STS_CD          
          ,OFC_CD              
          ,USR_ID             
          ,SO_NO                
          ,SO_DATE           
          ,WO_NO              
          ,WO_DATE       
    FROM (
     	SELECT  TORD.EQ_NO                                                              AS  CNTR_NO
    	       ,TORD.TRSP_SO_OFC_CTY_CD                                                 AS  TRSP_SO_OFC_CTY_CD
    	       ,TORD.TRSP_SO_SEQ                                                        AS  TRSP_SO_SEQ
    	       ,MAX(VD.VNDR_SEQ )                       				AS  SP_CODE     -- S/P CODE  
    	       ,MAX(VD.VNDR_ABBR_NM)                    				AS  SP_NAME  -- S/P NAME 
    	       ,MAX(VD_CNT.PHN_NO )                     				AS  SP_TEL_NO -- S/P TEL NO. 
    	       ,MAX(COMMCODE_PKG.GET_COMDTL_NAME_FNC('CD00744',TRSP_COST_DTL_MOD_CD) )  AS  COST_MODE  
    	       ,MAX(DECODE(TVDR.SUB_RAIL_SEQ, 1, TVDR.FM_NOD_CD))|| ' - '|| 
    	        MAX(DECODE(TVDR.SUB_RAIL_SEQ, 1, TVDR.TO_NOD_CD))|| 
    	        MAX(DECODE(TVDR.SUB_RAIL_SEQ, 2, ' - '||TVDR.TO_NOD_CD))|| 
    	        MAX(DECODE(TVDR.SUB_RAIL_SEQ, 3, ' - '||TVDR.TO_NOD_CD))      		AS NOD_CD      
    	       ,MAX(CID.INTG_CD_VAL_DP_DESC)                       			AS  STS_CD       -- S/O STATUS                                  
    	       ,MAX(TORD.CRE_OFC_CD )                              			AS  OFC_CD       -- OFFICE                                 
    	       ,MAX(TORD.CRE_USR_ID  )                             			AS  USR_ID     -- USER ID    
    	       ,MAX(TORD.TRSP_SO_OFC_CTY_CD||TORD.TRSP_SO_SEQ)     			AS  SO_NO        -- S/O NO                                 
    	        ,TO_CHAR(MAX(TORD.LOCL_CRE_DT), 'YYYY-MM-DD HH24:MI')      		AS  SO_DATE       -- S/O DATE 
    	       ,''                                                 			AS  WO_NO        -- W/O NO                       
    	       ,TO_CHAR (MAX(WO.LOCL_CRE_DT), 'YYYY-MM-DD HH24:MI:SS') 	AS  WO_DATE      -- W/O DATE  
    	FROM  BKG_CONTAINER BCNTR
    	     ,TRS_TRSP_RAIL_BIL_ORD TORD       
             ,TRS_TRSP_EDI_RAIL_ORD WO             
    	     ,TRS_TRSP_RAIL_BIL_VNDR_SET TVDR     
    	     ,MDM_VNDR_CNTC_PNT VD_CNT                     
    	     ,MDM_VENDOR  VD      
    	     ,COM_INTG_CD_DTL   CID
    	WHERE BCNTR.BKG_NO               = @[bkg_no]
    	  AND TORD.BKG_NO                = BCNTR.BKG_NO
    	  AND TORD.EQ_NO                 = BCNTR.CNTR_NO   
    	  AND TORD.TRSP_BND_CD           = 'I'
          AND TORD.EQ_KND_CD             = 'U'  
          AND TORD.DELT_FLG              = 'N'   
    	  AND WO.TRSP_SO_OFC_CTY_CD(+)   = TORD.TRSP_SO_OFC_CTY_CD 
          AND WO.TRSP_SO_SEQ(+)          = TORD.TRSP_SO_SEQ 
          AND WO.BIL_ISS_KNT(+)          = TORD.BIL_ISS_KNT 
          AND WO.DELT_FLG(+)             = 'N'
    	  AND VD_CNT.PRMRY_CHK_FLG (+)   = 'Y'                            
    	  AND VD_CNT.PHN_NO           IS NOT NULL                      
    	  AND TVDR.TRSP_SO_OFC_CTY_CD(+) = TORD.TRSP_SO_OFC_CTY_CD                     
    	  AND TVDR.TRSP_SO_SEQ(+)        = TORD.TRSP_SO_SEQ         
    	  AND TVDR.TRSP_MOD_CD(+)        = 'RD'                      
    	  AND VD.VNDR_SEQ (+)            = TVDR.VNDR_SEQ       
    	  AND VD_CNT.VNDR_SEQ(+)         = TVDR.VNDR_SEQ
    	  AND VD.DELT_FLG (+)            = 'N'           
    	  AND VD_CNT.PRMRY_CHK_FLG (+)   = 'Y'   
    	  AND VD_CNT.PHN_NO           IS NOT NULL            
    	  AND VD_CNT.DELT_FLG (+)        = 'N'   	
          AND CID.INTG_CD_VAL_CTNT(+)    = DECODE (WO.BIL_ISS_STS_CD   , 'X', 'N' , WO.BIL_ISS_STS_CD )
    	  AND CID.INTG_CD_ID(+)          = 'CD00804'              
    	  GROUP BY TORD.EQ_NO,
    	           TORD.TRSP_SO_OFC_CTY_CD,                            
    	           TORD.TRSP_SO_SEQ
     )	           
)SUBQ
 LEFT OUTER JOIN COM_USER USR 
    ON( USR.USR_ID  = SUBQ.USR_ID )
ORDER BY 1,2 DESC			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
