/*=========================================================
*Copyright(c) 2010 CyberLogitec
*@FileName : CMSummaryDBDAORsltPrsCmSummaryHistoryVORSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2010.05.18
*@LastModifier : 송민석
*@LastVersion : 1.0
* 2010.05.18 송민석
* 1.0 Creation
=========================================================*/
package com.hanjin.apps.alps.esm.pri.profitabilitysimulation.cmsummary.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.hanjin.framework.support.db.ISQLTemplate;

/**
 *
 * @author SONG MIN SEOK
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class CMSummaryDBDAORsltPrsCmSummaryHistoryVORSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  *    
	  * </pre>
	  */
	public CMSummaryDBDAORsltPrsCmSummaryHistoryVORSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("frm_ctrt_exp_dt",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("frm_prop_srep_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("frm_prop_ofc_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("frm_ctrt_eff_dt",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("frm_pfmc_unit",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("frm_svc_scp_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("frm_prop_apro_ofc_cd",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.hanjin.apps.alps.esm.pri.profitabilitysimulation.cmsummary.integration").append("\n"); 
		query.append("FileName : CMSummaryDBDAORsltPrsCmSummaryHistoryVORSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("WITH VW_SC_MAIN_NEW_SET AS (" ).append("\n"); 
		query.append("	SELECT	HDR.SC_NO, MN.PROP_OFC_CD" ).append("\n"); 
		query.append("		,(SELECT M_ORG.OFC_ENG_NM FROM MDM_ORGANIZATION M_ORG WHERE MN.PROP_OFC_CD = M_ORG.OFC_CD) AS PROP_OFC_NM--  AS PROP_OFC_NM -- REQUEST OFFICE" ).append("\n"); 
		query.append("		, PTY.CUST_CNT_CD" ).append("\n"); 
		query.append("		, PTY.CUST_SEQ" ).append("\n"); 
		query.append("		, MN.PROP_NO" ).append("\n"); 
		query.append("		, MN.AMDT_SEQ" ).append("\n"); 
		query.append("		, DECODE(MN.AMDT_SEQ,0,MN.PROP_NO,HDR.SC_NO || '-' || TO_CHAR(MN.AMDT_SEQ,'FM000')) AS CONTRACT_NO" ).append("\n"); 
		query.append("		, DUR.CTRT_EFF_DT, DUR.CTRT_EXP_DT" ).append("\n"); 
		query.append("		, PTY.CTRT_PTY_NM -- CTRT_PTY_NM								-- CUSTOMER NAME" ).append("\n"); 
		query.append("		, (" ).append("\n"); 
		query.append("			CASE WHEN MQ.CNTR_LOD_UT_CD = 'F' AND @[frm_pfmc_unit] = 'TEU' THEN" ).append("\n"); 
		query.append("			MQ.PROP_MQC_QTY * 2" ).append("\n"); 
		query.append("			WHEN MQ.CNTR_LOD_UT_CD = 'T' AND @[frm_pfmc_unit] = 'FEU' THEN" ).append("\n"); 
		query.append("			MQ.PROP_MQC_QTY /2" ).append("\n"); 
		query.append("			ELSE MQ.PROP_MQC_QTY" ).append("\n"); 
		query.append("			END" ).append("\n"); 
		query.append("		) PROP_MQC_QTY  -- PROP_MQC_QTY								-- MQC( TARGET VVD )" ).append("\n"); 
		query.append("		, SCP_MN.SVC_SCP_CD" ).append("\n"); 
		query.append("		, CTP.PRC_CTRT_CUST_TP_CD AS CUST_TP_CD" ).append("\n"); 
		query.append("		,MN.PROP_APRO_OFC_CD AS PROP_APRO_OFC_CD" ).append("\n"); 
		query.append("		,MN.RESPB_SREP_CD AS RESPB_SREP_CD" ).append("\n"); 
		query.append("		" ).append("\n"); 
		query.append("	FROM	PRI_SP_MN MN" ).append("\n"); 
		query.append("		, PRI_SP_HDR HDR" ).append("\n"); 
		query.append("		, PRI_SP_CTRT_PTY PTY" ).append("\n"); 
		query.append("		, PRI_SP_MQC MQ" ).append("\n"); 
		query.append("		, PRI_SP_SCP_DUR DUR" ).append("\n"); 
		query.append("		, PRI_SP_SCP_MN SCP_MN" ).append("\n"); 
		query.append("		, PRI_SP_CTRT_CUST_TP CTP" ).append("\n"); 
		query.append("	WHERE	MN.PROP_NO   = HDR.PROP_NO" ).append("\n"); 
		query.append("		AND MN.PROP_NO = PTY.PROP_NO" ).append("\n"); 
		query.append("		AND MN.AMDT_SEQ = PTY.AMDT_SEQ" ).append("\n"); 
		query.append("		AND PTY.PRC_CTRT_PTY_TP_CD = 'C'" ).append("\n"); 
		query.append("		AND MN.PROP_NO = MQ.PROP_NO" ).append("\n"); 
		query.append("		AND MN.AMDT_SEQ = MQ.AMDT_SEQ" ).append("\n"); 
		query.append("		AND MN.PROP_NO = DUR.PROP_NO" ).append("\n"); 
		query.append("		AND MN.AMDT_SEQ = DUR.AMDT_SEQ" ).append("\n"); 
		query.append("		AND MN.PROP_NO = SCP_MN.PROP_NO" ).append("\n"); 
		query.append("		AND MN.AMDT_SEQ = SCP_MN.AMDT_SEQ" ).append("\n"); 
		query.append("		AND MN.PROP_NO = CTP.PROP_NO" ).append("\n"); 
		query.append("		AND MN.AMDT_SEQ = CTP.AMDT_SEQ" ).append("\n"); 
		query.append("		AND CTP.PRC_CTRT_PTY_TP_CD = 'C'" ).append("\n"); 
		query.append("		AND SCP_MN.SVC_SCP_CD = DUR.SVC_SCP_CD" ).append("\n"); 
		query.append("	#if(${frm_contract_type} == 'B' || ${frm_contract_type} == 'S')" ).append("\n"); 
		query.append("		AND 1=1" ).append("\n"); 
		query.append("	#else" ).append("\n"); 
		query.append("		AND 1=0" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("		  " ).append("\n"); 
		query.append("	#if(${frm_customer_type} == 'B')" ).append("\n"); 
		query.append("				AND CTP.PRC_CTRT_CUST_TP_CD IN ('I','A','O')" ).append("\n"); 
		query.append("	#elseif(${frm_customer_type} == 'N')" ).append("\n"); 
		query.append("				AND CTP.PRC_CTRT_CUST_TP_CD IN ('N')" ).append("\n"); 
		query.append("	#else " ).append("\n"); 
		query.append("			AND CTP.PRC_CTRT_CUST_TP_CD IN ('I','A','O','N')" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	#if(${frm_prop_ofc_cd} != '')" ).append("\n"); 
		query.append("				AND MN.PROP_OFC_CD = @[frm_prop_ofc_cd]" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	#if(${frm_prop_srep_cd} != '')" ).append("\n"); 
		query.append("				AND MN.RESPB_SREP_CD = @[frm_prop_srep_cd]" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	#if(${frm_prop_apro_ofc_cd} != '')" ).append("\n"); 
		query.append("				AND MN.PROP_APRO_OFC_CD = @[frm_prop_apro_ofc_cd]" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	#if(${frm_ctrt_eff_dt} != '' )" ).append("\n"); 
		query.append("		AND DUR.CTRT_EFF_DT >= TO_DATE(@[frm_ctrt_eff_dt],'YYYY-MM-DD')" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("	#if ( ${frm_ctrt_exp_dt} != '' )" ).append("\n"); 
		query.append("		AND DUR.CTRT_EXP_DT  <= TO_DATE(@[frm_ctrt_exp_dt],'YYYY-MM-DD') " ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	#if(${frm_svc_scp_cd} != '' )" ).append("\n"); 
		query.append("				AND SCP_MN.SVC_SCP_CD = @[frm_svc_scp_cd]" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("			-- STATUS" ).append("\n"); 
		query.append("	#if (${frm_status} == 'Q') " ).append("\n"); 
		query.append("				AND  MN.PROP_STS_CD IN ( 'I', 'Q', 'R' ) /* REQUESTED */" ).append("\n"); 
		query.append("	#elseif(${frm_status} == 'A') " ).append("\n"); 
		query.append("				AND  MN.PROP_STS_CD IN ( 'A' ,'F') /* APPROVED */" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	#if( $cust_list.size() != 0 ) " ).append("\n"); 
		query.append("		AND (PTY.CUST_CNT_CD , PTY.CUST_SEQ) IN (" ).append("\n"); 
		query.append("		#foreach( ${key} in ${cust_list}) " ).append("\n"); 
		query.append("			#if($velocityCount != 1 ) " ).append("\n"); 
		query.append("				UNION ALL" ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			SELECT " ).append("\n"); 
		query.append("					substr('$key',1,2),substr('$key',3)" ).append("\n"); 
		query.append("			FROM DUAL" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		)" ).append("\n"); 
		query.append("	#end " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("," ).append("\n"); 
		query.append("VW_RFA_MAIN_NEW_SET AS (" ).append("\n"); 
		query.append("	SELECT	/*+ USE_HASH(MN HDR DUR SCP_MN M_ORG CUST ) */  MN.PROP_OFC_CD" ).append("\n"); 
		query.append("		,(SELECT M_ORG.OFC_ENG_NM FROM MDM_ORGANIZATION M_ORG WHERE MN.PROP_OFC_CD = M_ORG.OFC_CD) AS PROP_OFC_NM" ).append("\n"); 
		query.append("		, MN.CTRT_CUST_CNT_CD AS CUST_CNT_CD" ).append("\n"); 
		query.append("		, MN.CTRT_CUST_SEQ AS CUST_SEQ" ).append("\n"); 
		query.append("		, MN.PROP_NO" ).append("\n"); 
		query.append("		, MN.AMDT_SEQ" ).append("\n"); 
		query.append("		, DUR.CTRT_EFF_DT, DUR.CTRT_EXP_DT" ).append("\n"); 
		query.append("		, DECODE(MN.AMDT_SEQ,0,MN.PROP_NO,HDR.RFA_NO || '-' || TO_CHAR(MN.AMDT_SEQ,'FM000')) AS CONTRACT_NO" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("		,(SELECT CUST.CUST_LGL_ENG_NM" ).append("\n"); 
		query.append("		  FROM MDM_CUSTOMER CUST" ).append("\n"); 
		query.append("		  WHERE CUST_CNT_CD = MN.CTRT_CUST_CNT_CD" ).append("\n"); 
		query.append("			 AND CUST.CUST_SEQ = MN.CTRT_CUST_SEQ ) AS CTRT_PTY_NM" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("		, (" ).append("\n"); 
		query.append("			CASE WHEN MN.CNTR_LOD_UT_CD = 'F' AND @[frm_pfmc_unit] = 'TEU' THEN" ).append("\n"); 
		query.append("			MN.TGT_MVC_QTY * 2" ).append("\n"); 
		query.append("			WHEN MN.CNTR_LOD_UT_CD = 'T' AND @[frm_pfmc_unit] = 'FEU' THEN" ).append("\n"); 
		query.append("			MN.TGT_MVC_QTY /2" ).append("\n"); 
		query.append("			ELSE MN.TGT_MVC_QTY" ).append("\n"); 
		query.append("			END" ).append("\n"); 
		query.append("		) PROP_MQC_QTY  -- PROP_MQC_QTY								-- MQC( TARGET VVD )" ).append("\n"); 
		query.append("		, SCP_MN.SVC_SCP_CD" ).append("\n"); 
		query.append("		, MN.PRC_CTRT_CUST_TP_CD AS CUST_TP_CD" ).append("\n"); 
		query.append("		,MN.PROP_APRO_OFC_CD AS PROP_APRO_OFC_CD" ).append("\n"); 
		query.append("		,MN.RESPB_SREP_CD AS RESPB_SREP_CD" ).append("\n"); 
		query.append("                ,HDR.RFA_NO" ).append("\n"); 
		query.append("	FROM	PRI_RP_MN MN" ).append("\n"); 
		query.append("		, PRI_RP_HDR HDR" ).append("\n"); 
		query.append("		, PRI_RP_SCP_DUR DUR" ).append("\n"); 
		query.append("		, PRI_RP_SCP_MN SCP_MN" ).append("\n"); 
		query.append("	WHERE	MN.PROP_NO   = HDR.PROP_NO" ).append("\n"); 
		query.append("		AND MN.AMDT_SEQ = 0" ).append("\n"); 
		query.append("		AND MN.PROP_NO = DUR.PROP_NO" ).append("\n"); 
		query.append("		AND MN.AMDT_SEQ = DUR.AMDT_SEQ" ).append("\n"); 
		query.append("		AND MN.PROP_NO = SCP_MN.PROP_NO" ).append("\n"); 
		query.append("		AND MN.AMDT_SEQ = SCP_MN.AMDT_SEQ" ).append("\n"); 
		query.append("		AND SCP_MN.SVC_SCP_CD = DUR.SVC_SCP_CD" ).append("\n"); 
		query.append("	#if(${frm_contract_type} == 'B' || ${frm_contract_type} == 'R')" ).append("\n"); 
		query.append("		AND 1=1" ).append("\n"); 
		query.append("	#else" ).append("\n"); 
		query.append("		AND 1=0" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("	#if(${frm_customer_type} == 'B')" ).append("\n"); 
		query.append("				AND MN.PRC_CTRT_CUST_TP_CD IN ('I','A','O')" ).append("\n"); 
		query.append("	#elseif(${frm_customer_type} == 'N')" ).append("\n"); 
		query.append("				AND MN.PRC_CTRT_CUST_TP_CD IN ('N')" ).append("\n"); 
		query.append("	#else " ).append("\n"); 
		query.append("			AND MN.PRC_CTRT_CUST_TP_CD IN ('I','A','O','N')" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	#if(${frm_prop_ofc_cd} != '')" ).append("\n"); 
		query.append("				AND MN.PROP_OFC_CD = @[frm_prop_ofc_cd]" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	#if(${frm_prop_srep_cd} != '')" ).append("\n"); 
		query.append("				AND MN.RESPB_SREP_CD = @[frm_prop_srep_cd]" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	#if(${frm_prop_apro_ofc_cd} != '')" ).append("\n"); 
		query.append("				AND MN.PROP_APRO_OFC_CD = @[frm_prop_apro_ofc_cd]" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	#if(${frm_ctrt_eff_dt} != '' )" ).append("\n"); 
		query.append("		AND DUR.CTRT_EFF_DT >= TO_DATE(@[frm_ctrt_eff_dt],'YYYY-MM-DD')" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("	#if ( ${frm_ctrt_exp_dt} != '' )" ).append("\n"); 
		query.append("		AND DUR.CTRT_EXP_DT  <= TO_DATE(@[frm_ctrt_exp_dt],'YYYY-MM-DD') " ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	#if(${frm_svc_scp_cd} != '' )" ).append("\n"); 
		query.append("				AND SCP_MN.SVC_SCP_CD = @[frm_svc_scp_cd]" ).append("\n"); 
		query.append("				AND DUR.SVC_SCP_CD = @[frm_svc_scp_cd]" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("			-- STATUS" ).append("\n"); 
		query.append("	#if (${frm_status} == 'Q') " ).append("\n"); 
		query.append("				AND  MN.PROP_STS_CD IN ( 'I', 'Q', 'R' ) /* REQUESTED */" ).append("\n"); 
		query.append("	#elseif(${frm_status} == 'A') " ).append("\n"); 
		query.append("				AND  MN.PROP_STS_CD IN ( 'A' ) /* APPROVED */" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("	#if( $cust_list.size() != 0 ) " ).append("\n"); 
		query.append("		AND (MN.CTRT_CUST_CNT_CD ,MN.CTRT_CUST_SEQ) IN (" ).append("\n"); 
		query.append("		#foreach( ${key} in ${cust_list}) " ).append("\n"); 
		query.append("			#if($velocityCount != 1 ) " ).append("\n"); 
		query.append("				UNION ALL" ).append("\n"); 
		query.append("			#end" ).append("\n"); 
		query.append("			SELECT " ).append("\n"); 
		query.append("					substr('$key',1,2),substr('$key',3)" ).append("\n"); 
		query.append("			FROM DUAL" ).append("\n"); 
		query.append("		#end" ).append("\n"); 
		query.append("		)" ).append("\n"); 
		query.append("	#end " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("SELECT SC_NO" ).append("\n"); 
		query.append("	, CONTRACT_NM" ).append("\n"); 
		query.append("	, CONTRACT_BASIS" ).append("\n"); 
		query.append("	, SORT_KEY" ).append("\n"); 
		query.append("	, PROP_OFC_NM" ).append("\n"); 
		query.append("	, PROP_NO" ).append("\n"); 
		query.append("	, AMDT_SEQ" ).append("\n"); 
		query.append("	, CONTRACT_NO" ).append("\n"); 
		query.append("	, CUST_CNT_CD || TO_CHAR(CUST_SEQ,'FM000000') || ' - ' || CTRT_PTY_NM AS CUST_NM" ).append("\n"); 
		query.append("	, CUST_CNT_CD" ).append("\n"); 
		query.append("	, CUST_SEQ" ).append("\n"); 
		query.append("	, TO_CHAR(CTRT_EFF_DT,'YYYY-MM-DD') || '~' || TO_CHAR( CTRT_EXP_DT,'YYYY-MM-DD') AS DURATION" ).append("\n"); 
		query.append("	, CTRT_PTY_NM" ).append("\n"); 
		query.append("	, PROP_MQC_QTY	 " ).append("\n"); 
		query.append("	, LOAD          " ).append("\n"); 
		query.append("	, CM_OFFICE	 " ).append("\n"); 
		query.append("	, CM_TRADE " ).append("\n"); 
		query.append("	, OP " ).append("\n"); 
		query.append("	, CMPB_OFFICE " ).append("\n"); 
		query.append("	, CMPB_TRADE	 " ).append("\n"); 
		query.append("	, OPB	" ).append("\n"); 
		query.append("	, dense_rank() over(  order by  CONTRACT_NM DESC,PROP_NO  ) as seq" ).append("\n"); 
		query.append("	, (" ).append("\n"); 
		query.append("		SELECT INTG_CD_VAL_DP_DESC " ).append("\n"); 
		query.append("		FROM COM_INTG_CD_DTL  " ).append("\n"); 
		query.append("		WHERE INTG_CD_ID = 'CD01714'" ).append("\n"); 
		query.append("			AND INTG_CD_VAL_CTNT = CUST_TP_CD" ).append("\n"); 
		query.append("	  ) AS CUST_TP_CD         " ).append("\n"); 
		query.append("	, SUBSTR(REPLACE(MAX(TO_CHAR(AMDT_SEQ,'FM000') || RESPB_SREP_CD) OVER ( PARTITION BY PROP_NO   ),'-',''),4) AS RESPB_SREP_CD     " ).append("\n"); 
		query.append("	, SUBSTR(REPLACE(MAX(TO_CHAR(AMDT_SEQ,'FM000') || PROP_APRO_OFC_CD) OVER ( PARTITION BY PROP_NO   ),'-',''),4) AS PROP_APRO_OFC_CD" ).append("\n"); 
		query.append("	, SUBSTR(REPLACE(MAX(TO_CHAR(AMDT_SEQ,'FM000') || PROP_OFC_CD) OVER ( PARTITION BY PROP_NO   ),'-',''),4) AS PROP_OFC_CD" ).append("\n"); 
		query.append("FROM (	" ).append("\n"); 
		query.append("	SELECT SC_NO" ).append("\n"); 
		query.append("		, 'SC' AS CONTRACT_NM" ).append("\n"); 
		query.append("		, DECODE(AMDT_SEQ,0,'Proposal','Amendment') AS CONTRACT_BASIS" ).append("\n"); 
		query.append("		, DECODE(AMDT_SEQ,0,2,3) AS SORT_KEY" ).append("\n"); 
		query.append("		, PROP_OFC_CD" ).append("\n"); 
		query.append("		, PROP_OFC_NM" ).append("\n"); 
		query.append("		, PROP_NO" ).append("\n"); 
		query.append("		, AMDT_SEQ" ).append("\n"); 
		query.append("		, CONTRACT_NO" ).append("\n"); 
		query.append("		, CUST_CNT_CD" ).append("\n"); 
		query.append("		, CUST_SEQ" ).append("\n"); 
		query.append("		, CTRT_EFF_DT" ).append("\n"); 
		query.append("		, CTRT_EXP_DT" ).append("\n"); 
		query.append("		, CTRT_PTY_NM	 " ).append("\n"); 
		query.append("		, PROP_MQC_QTY	 " ).append("\n"); 
		query.append("		, LOAD          " ).append("\n"); 
		query.append("		, CM_OFFICE	 " ).append("\n"); 
		query.append("		, CM_TRADE " ).append("\n"); 
		query.append("		, OP " ).append("\n"); 
		query.append("		, CMPB_OFFICE " ).append("\n"); 
		query.append("		, CMPB_TRADE	 " ).append("\n"); 
		query.append("		, OPB	 " ).append("\n"); 
		query.append("		, CUST_TP_CD           " ).append("\n"); 
		query.append("		, PROP_APRO_OFC_CD" ).append("\n"); 
		query.append("		, RESPB_SREP_CD   " ).append("\n"); 
		query.append("	FROM (" ).append("\n"); 
		query.append("                SELECT	SC_NO" ).append("\n"); 
		query.append("                        , PROP_OFC_CD" ).append("\n"); 
		query.append("                        , PROP_OFC_NM" ).append("\n"); 
		query.append("                        , PROP_NO" ).append("\n"); 
		query.append("                        , AMDT_SEQ" ).append("\n"); 
		query.append("                        , CONTRACT_NO" ).append("\n"); 
		query.append("                        , CUST_CNT_CD" ).append("\n"); 
		query.append("                        , CUST_SEQ" ).append("\n"); 
		query.append("                        , CTRT_EFF_DT" ).append("\n"); 
		query.append("                        , CTRT_EXP_DT" ).append("\n"); 
		query.append("                        , CTRT_PTY_NM						-- CUSTOMER NAME" ).append("\n"); 
		query.append("                        , CUST_TP_CD           " ).append("\n"); 
		query.append("                        , PROP_APRO_OFC_CD" ).append("\n"); 
		query.append("                        , RESPB_SREP_CD      " ).append("\n"); 
		query.append("                        , PROP_MQC_QTY						-- MQC( TARGET VVD )" ).append("\n"); 
		query.append("                        , DECODE(AMDT_SEQ,0,LOAD,AMDT_LOAD) AS LOAD              -- LOAD(NEW)" ).append("\n"); 
		query.append("                        , DECODE(AMDT_SEQ,0,CM_OFFICE,AMDT_CM_OFFICE) AS CM_OFFICE	-- OFFICE PROPIT/CM" ).append("\n"); 
		query.append("                        , DECODE(AMDT_SEQ,0,CM_TRADE,AMDT_CM_TRADE) AS CM_TRADE	-- TRADE PROPIT/CM" ).append("\n"); 
		query.append("                        , DECODE(AMDT_SEQ,0,OP,AMDT_OP) AS OP	-- OP(NEW)" ).append("\n"); 
		query.append("                        , DECODE(AMDT_SEQ,0,CMPB_OFFICE,AMDT_CMPB_OFFICE) AS CMPB_OFFICE	-- OFFICE PROPIT/CMPB" ).append("\n"); 
		query.append("                        , DECODE(AMDT_SEQ,0,CMPB_TRADE,AMDT_CMPB_TRADE) AS CMPB_TRADE	-- TRADE PROPIT/CMPB" ).append("\n"); 
		query.append("                        , DECODE(AMDT_SEQ,0,OPB,AMDT_OPB) AS OPB	-- OPB(NEW)" ).append("\n"); 
		query.append("                FROM (" ).append("\n"); 
		query.append("                        SELECT" ).append("\n"); 
		query.append("                                SC_NO" ).append("\n"); 
		query.append("                                , PROP_OFC_CD" ).append("\n"); 
		query.append("                                , MAX(PROP_OFC_NM) AS PROP_OFC_NM -- REQUEST OFFICE" ).append("\n"); 
		query.append("                                , PROP_NO" ).append("\n"); 
		query.append("                                , AMDT_SEQ" ).append("\n"); 
		query.append("                                , CONTRACT_NO" ).append("\n"); 
		query.append("                                , CUST_CNT_CD" ).append("\n"); 
		query.append("                                , CUST_SEQ" ).append("\n"); 
		query.append("                                , CTRT_EFF_DT, CTRT_EXP_DT" ).append("\n"); 
		query.append("                                , MAX(CTRT_PTY_NM) AS CTRT_PTY_NM								-- CUSTOMER NAME" ).append("\n"); 
		query.append("                                , MAX(PROP_MQC_QTY) AS PROP_MQC_QTY								-- MQC( TARGET VVD )" ).append("\n"); 
		query.append("                                , MAX(CUST_TP_CD  ) AS CUST_TP_CD" ).append("\n"); 
		query.append("                                , MAX(PROP_APRO_OFC_CD ) AS PROP_APRO_OFC_CD" ).append("\n"); 
		query.append("                                , MAX(RESPB_SREP_CD ) AS RESPB_SREP_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                , SUM(PRS_ESTM_LOD_QTY) AS LOAD-- LOAD(NEW)" ).append("\n"); 
		query.append("                                , SUM(ESTM_RESPB_CM_AMT) AS CM_OFFICE	   -- Office Profit -- CM(NEW)" ).append("\n"); 
		query.append("                                , SUM(ESTM_PFIT_CM_AMT) AS CM_TRADE	   -- Trade Profit -- CM(NEW)" ).append("\n"); 
		query.append("                                , SUM(ESTM_RESPB_OP_AMT) AS OP	    --OP(NEW)" ).append("\n"); 
		query.append("                                , DECODE( SUM(PRS_ESTM_LOD_QTY), 0 , 0, SUM(ESTM_RESPB_CM_AMT) / SUM(PRS_ESTM_LOD_QTY)) AS CMPB_OFFICE	-- OFFICE PROPIT/CMPB" ).append("\n"); 
		query.append("                                , DECODE( SUM(PRS_ESTM_LOD_QTY), 0 , 0, SUM(ESTM_PFIT_CM_AMT) /  SUM(PRS_ESTM_LOD_QTY)) AS CMPB_TRADE	-- TRADE PROPIT/CM" ).append("\n"); 
		query.append("                                , DECODE( SUM(PRS_ESTM_LOD_QTY), 0 , 0, SUM(ESTM_RESPB_OP_AMT) / SUM(PRS_ESTM_LOD_QTY)) AS OPB	 --OPB(NEW)" ).append("\n"); 
		query.append("                                , SUM(PRS_AMDT_LOD_QTY) AS AMDT_LOAD-- LOAD(NEW)" ).append("\n"); 
		query.append("                                , SUM(AMDT_RESPB_CM_AMT) AS AMDT_CM_OFFICE	   -- Office Profit -- CM(NEW)" ).append("\n"); 
		query.append("                                , SUM(AMDT_PFIT_CM_AMT) AS AMDT_CM_TRADE	   -- Trade Profit -- CM(NEW)" ).append("\n"); 
		query.append("                                , SUM(AMDT_RESPB_OP_AMT) AS AMDT_OP	    --OP(NEW)" ).append("\n"); 
		query.append("                                , DECODE( SUM(AMDT_RESPB_OP_AMT), 0 ,0, SUM(AMDT_RESPB_CM_AMT) / SUM(PRS_AMDT_LOD_QTY)) AS AMDT_CMPB_OFFICE	-- OFFICE PROPIT/CMPB" ).append("\n"); 
		query.append("                                , DECODE( SUM(AMDT_RESPB_OP_AMT), 0 ,0, SUM(AMDT_PFIT_CM_AMT) / SUM(PRS_AMDT_LOD_QTY)) AS AMDT_CMPB_TRADE	-- TRADE PROPIT/CM" ).append("\n"); 
		query.append("                                , DECODE( SUM(AMDT_RESPB_OP_AMT), 0 ,0, SUM(AMDT_RESPB_OP_AMT) / SUM(PRS_AMDT_LOD_QTY)) AS AMDT_OPB	 --OPB(NEW)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                        FROM (" ).append("\n"); 
		query.append("                                SELECT " ).append("\n"); 
		query.append("                                          MN_SET.SC_NO" ).append("\n"); 
		query.append("                                        , MN_SET.PROP_OFC_CD" ).append("\n"); 
		query.append("                                        , MN_SET.PROP_OFC_NM --  AS PROP_OFC_NM -- REQUEST OFFICE" ).append("\n"); 
		query.append("                                        , MN_SET.CUST_CNT_CD" ).append("\n"); 
		query.append("                                        , MN_SET.CUST_SEQ" ).append("\n"); 
		query.append("                                        , MN_SET.PROP_NO" ).append("\n"); 
		query.append("                                        , MN_SET.AMDT_SEQ" ).append("\n"); 
		query.append("                                        , MN_SET.CONTRACT_NO" ).append("\n"); 
		query.append("                                        , MN_SET.CTRT_EFF_DT" ).append("\n"); 
		query.append("                                        , MN_SET.CTRT_EXP_DT" ).append("\n"); 
		query.append("                                        , MN_SET.CTRT_PTY_NM -- CUSTOMER NAME" ).append("\n"); 
		query.append("                                        , MN_SET.CUST_TP_CD  " ).append("\n"); 
		query.append("                                        , MN_SET.PROP_APRO_OFC_CD " ).append("\n"); 
		query.append("                                        , MN_SET.RESPB_SREP_CD " ).append("\n"); 
		query.append("                                        , MN_SET.PROP_MQC_QTY  -- PROP_MQC_QTY								-- MQC( TARGET VVD )" ).append("\n"); 
		query.append("                                        , MN.PRS_ESTM_LOD_QTY -- LOAD(NEW)" ).append("\n"); 
		query.append("                                        , MN.ESTM_RESPB_CM_AMT  -- AS CM_NEW_OFFICE" ).append("\n"); 
		query.append("                                        , MN.ESTM_PFIT_CM_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                                        , MN.ESTM_RESPB_OP_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                                        , MN.PRS_AMDT_LOD_QTY" ).append("\n"); 
		query.append("                                        , MN.AMDT_RESPB_CM_AMT  -- AS CM_NEW_OFFICE" ).append("\n"); 
		query.append("                                        , MN.AMDT_PFIT_CM_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                                        , MN.AMDT_RESPB_OP_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                                FROM VW_SC_MAIN_NEW_SET MN_SET" ).append("\n"); 
		query.append("                                     , (" ).append("\n"); 
		query.append("                                        SELECT	MN.SC_NO" ).append("\n"); 
		query.append("                                                , MN.PROP_OFC_CD" ).append("\n"); 
		query.append("                                                , MN.PROP_OFC_NM --  AS PROP_OFC_NM -- REQUEST OFFICE" ).append("\n"); 
		query.append("                                                , MN.CUST_CNT_CD" ).append("\n"); 
		query.append("                                                , MN.CUST_SEQ" ).append("\n"); 
		query.append("                                                , MN.PROP_NO" ).append("\n"); 
		query.append("                                                , MN.AMDT_SEQ" ).append("\n"); 
		query.append("                                                , MN.SVC_SCP_CD" ).append("\n"); 
		query.append("                                                , MN.CONTRACT_NO" ).append("\n"); 
		query.append("                                                , MN.CTRT_EFF_DT, MN.CTRT_EXP_DT" ).append("\n"); 
		query.append("                                                , MN.CTRT_PTY_NM -- CUSTOMER NAME" ).append("\n"); 
		query.append("                                                , MN.CUST_TP_CD  " ).append("\n"); 
		query.append("                                                , MN.PROP_APRO_OFC_CD " ).append("\n"); 
		query.append("                                                , MN.RESPB_SREP_CD " ).append("\n"); 
		query.append("                                                , MN.PROP_MQC_QTY  -- PROP_MQC_QTY								-- MQC( TARGET VVD )" ).append("\n"); 
		query.append("                                                , CMDT_ROUT.PRS_ESTM_LOD_QTY  / DECODE(@[frm_pfmc_unit],'FEU',2,'TEU',1) AS PRS_ESTM_LOD_QTY -- LOAD(NEW)" ).append("\n"); 
		query.append("                                                , CASE WHEN SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,2,1) = '2' OR SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,1,1) = '2'" ).append("\n"); 
		query.append("                                                        THEN CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_RESPB_CMPB_AMT" ).append("\n"); 
		query.append("                                                        ELSE" ).append("\n"); 
		query.append("                                                        CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_RESPB_CMPB_AMT  / 2" ).append("\n"); 
		query.append("                                                END  AS ESTM_RESPB_CM_AMT  -- AS CM_NEW_OFFICE" ).append("\n"); 
		query.append("                                                , CASE WHEN SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,2,1) = '2' OR SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,1,1) = '2'" ).append("\n"); 
		query.append("                                                        THEN CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_PFIT_CMPB_AMT" ).append("\n"); 
		query.append("                                                        ELSE" ).append("\n"); 
		query.append("                                                        CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_PFIT_CMPB_AMT  / 2" ).append("\n"); 
		query.append("                                                END  AS ESTM_PFIT_CM_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                                                , CASE WHEN SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,2,1) = '2' OR SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,1,1) = '2'" ).append("\n"); 
		query.append("                                                        THEN CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_RESPB_OPB_AMT" ).append("\n"); 
		query.append("                                                        ELSE" ).append("\n"); 
		query.append("                                                        CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_RESPB_OPB_AMT  / 2" ).append("\n"); 
		query.append("                                                END  AS ESTM_RESPB_OP_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                                , (CMDT_ROUT.PRS_RMN_LOD_QTY+CMDT_ROUT.PRS_CRNT_LOD_QTY)  / DECODE(@[frm_pfmc_unit],'FEU',2,'TEU',1) AS PRS_AMDT_LOD_QTY -- LOAD(NEW)" ).append("\n"); 
		query.append("                                                , (CMDT_ROUT.PRS_RMN_LOD_QTY * CMDT_ROUT.PRS_RMN_RESPB_CMPB_AMT +  CMDT_ROUT.PRS_CRNT_LOD_QTY * CMDT_ROUT.PRS_CRNT_RESPB_CMPB_AMT)  AS AMDT_RESPB_CM_AMT  -- AS CM_NEW_OFFICE" ).append("\n"); 
		query.append("                                                , (CMDT_ROUT.PRS_RMN_LOD_QTY * CMDT_ROUT.PRS_RMN_PFIT_CMPB_AMT + CMDT_ROUT.PRS_CRNT_LOD_QTY * CMDT_ROUT.PRS_CRNT_PFIT_CMPB_AMT) AS AMDT_PFIT_CM_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                                                , (CMDT_ROUT.PRS_RMN_LOD_QTY * CMDT_ROUT.PRS_CRNT_RESPB_OPB_AMT + CMDT_ROUT.PRS_CRNT_LOD_QTY * CMDT_ROUT.PRS_CRNT_RESPB_OPB_AMT) AS AMDT_RESPB_OP_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                        FROM	VW_SC_MAIN_NEW_SET MN" ).append("\n"); 
		query.append("                                                , PRI_SP_SCP_RT_CMDT_ROUT CMDT_ROUT" ).append("\n"); 
		query.append("                                        WHERE	 MN.PROP_NO = CMDT_ROUT.PROP_NO" ).append("\n"); 
		query.append("                                                AND MN.AMDT_SEQ = CMDT_ROUT.AMDT_SEQ" ).append("\n"); 
		query.append("                                                AND MN.SVC_SCP_CD = CMDT_ROUT.SVC_SCP_CD" ).append("\n"); 
		query.append("                                                #if(${frm_contract_type} == 'B' || ${frm_contract_type} == 'S')" ).append("\n"); 
		query.append("                                                        AND 1=1" ).append("\n"); 
		query.append("                                                #else" ).append("\n"); 
		query.append("                                                        AND 1=0" ).append("\n"); 
		query.append("                                                #end" ).append("\n"); 
		query.append("                                                -- BY CARGO TYPE" ).append("\n"); 
		query.append("                                                #if (${crg_tp_str} != '' )" ).append("\n"); 
		query.append("                                                        AND CMDT_ROUT.PRS_CGO_TP_CD IN ( ${crg_tp_str} )" ).append("\n"); 
		query.append("                                                #end" ).append("\n"); 
		query.append("                                    ) MN" ).append("\n"); 
		query.append("                                WHERE MN_SET.PROP_NO = MN.PROP_NO(+)" ).append("\n"); 
		query.append("                                     AND  MN_SET.AMDT_SEQ = MN.AMDT_SEQ(+)" ).append("\n"); 
		query.append("                                     AND  MN_SET.SVC_SCP_CD = MN.SVC_SCP_CD(+)" ).append("\n"); 
		query.append("                        )" ).append("\n"); 
		query.append("                        GROUP BY SC_NO,PROP_OFC_CD,CUST_CNT_CD,CUST_SEQ, PROP_NO, AMDT_SEQ, CTRT_EFF_DT, CTRT_EXP_DT,CONTRACT_NO" ).append("\n"); 
		query.append("                )" ).append("\n"); 
		query.append("        )  " ).append("\n"); 
		query.append("	UNION ALL " ).append("\n"); 
		query.append("	SELECT SC_NO" ).append("\n"); 
		query.append("		, 'SC' AS CONTRACT_NM" ).append("\n"); 
		query.append("		, 'Quotation' AS CONTRACT_BASIS" ).append("\n"); 
		query.append("		, 1 AS SORT_KEY" ).append("\n"); 
		query.append("		, PROP_OFC_CD" ).append("\n"); 
		query.append("		, PROP_OFC_NM" ).append("\n"); 
		query.append("		, PROP_NO" ).append("\n"); 
		query.append("		, -1 AS AMDT_SEQ" ).append("\n"); 
		query.append("		, CONTRACT_NO" ).append("\n"); 
		query.append("		, CUST_CNT_CD" ).append("\n"); 
		query.append("		, CUST_SEQ" ).append("\n"); 
		query.append("		, EFF_DT" ).append("\n"); 
		query.append("		, EXP_DT" ).append("\n"); 
		query.append("		, CTRT_PTY_NM	 " ).append("\n"); 
		query.append("		, PROP_MQC_QTY	 " ).append("\n"); 
		query.append("		, LOAD          " ).append("\n"); 
		query.append("		, CM_OFFICE	 " ).append("\n"); 
		query.append("		, CM_TRADE " ).append("\n"); 
		query.append("		, OP " ).append("\n"); 
		query.append("		, CMPB_OFFICE " ).append("\n"); 
		query.append("		, CMPB_TRADE	 " ).append("\n"); 
		query.append("		, OPB	 " ).append("\n"); 
		query.append("		, CUST_TP_CD           " ).append("\n"); 
		query.append("		, PROP_APRO_OFC_CD" ).append("\n"); 
		query.append("		, RESPB_SREP_CD      " ).append("\n"); 
		query.append("	FROM (" ).append("\n"); 
		query.append("                SELECT" ).append("\n"); 
		query.append("                        SC_NO" ).append("\n"); 
		query.append("                        , PROP_OFC_CD" ).append("\n"); 
		query.append("                        , MAX(PROP_OFC_NM) AS PROP_OFC_NM -- REQUEST OFFICE" ).append("\n"); 
		query.append("                        , PROP_NO" ).append("\n"); 
		query.append("                        , AMDT_SEQ" ).append("\n"); 
		query.append("                        , CONTRACT_NO" ).append("\n"); 
		query.append("                        , CUST_CNT_CD" ).append("\n"); 
		query.append("                        , CUST_SEQ" ).append("\n"); 
		query.append("                        , EFF_DT, EXP_DT" ).append("\n"); 
		query.append("                        , MAX(CTRT_PTY_NM) AS CTRT_PTY_NM								-- CUSTOMER NAME" ).append("\n"); 
		query.append("                        , MAX(ESTM_MQC_QTY) AS PROP_MQC_QTY								-- MQC( TARGET VVD )" ).append("\n"); 
		query.append("                        , MAX(CUST_TP_CD ) AS CUST_TP_CD" ).append("\n"); 
		query.append("                        , MAX(PROP_APRO_OFC_CD) AS PROP_APRO_OFC_CD" ).append("\n"); 
		query.append("                        , MAX(QTTN_SREP_CD ) AS RESPB_SREP_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                        , SUM(PRS_ESTM_LOD_QTY) AS LOAD-- LOAD(NEW)" ).append("\n"); 
		query.append("                        , SUM(ESTM_RESPB_CM_AMT) AS CM_OFFICE	   -- Office Profit -- CM(NEW)" ).append("\n"); 
		query.append("                        , SUM(ESTM_PFIT_CM_AMT) AS CM_TRADE	   -- Trade Profit -- CM(NEW)" ).append("\n"); 
		query.append("                        , SUM(ESTM_RESPB_OP_AMT) AS OP	    --OP(NEW)" ).append("\n"); 
		query.append("                        , DECODE(SUM(PRS_ESTM_LOD_QTY),0,0,SUM(ESTM_RESPB_CM_AMT) / SUM(PRS_ESTM_LOD_QTY)) AS CMPB_OFFICE	-- OFFICE PROPIT/CMPB" ).append("\n"); 
		query.append("                        , DECODE(SUM(PRS_ESTM_LOD_QTY),0,0,SUM(ESTM_PFIT_CM_AMT) / SUM(PRS_ESTM_LOD_QTY)) AS CMPB_TRADE	-- TRADE PROPIT/CM" ).append("\n"); 
		query.append("                        , DECODE(SUM(PRS_ESTM_LOD_QTY),0,0,SUM(ESTM_RESPB_OP_AMT) / SUM(PRS_ESTM_LOD_QTY)) AS OPB	 --OPB(NEW)" ).append("\n"); 
		query.append("                FROM (" ).append("\n"); 
		query.append("                        SELECT SC_SET.SC_NO" ).append("\n"); 
		query.append("                                , HDR.QTTN_OFC_CD AS PROP_OFC_CD" ).append("\n"); 
		query.append("				,(SELECT M_ORG.OFC_ENG_NM FROM MDM_ORGANIZATION M_ORG WHERE HDR.QTTN_OFC_CD = M_ORG.OFC_CD) AS PROP_OFC_NM -- REQUEST OFFICE" ).append("\n"); 
		query.append("                                , MN.CUST_CNT_CD" ).append("\n"); 
		query.append("                                , MN.CUST_SEQ" ).append("\n"); 
		query.append("                                , MN.PROP_NO" ).append("\n"); 
		query.append("                                , -1 AS AMDT_SEQ" ).append("\n"); 
		query.append("                                , MN.QTTN_NO || MN.QTTN_VER_NO AS CONTRACT_NO" ).append("\n"); 
		query.append("                                , MN.EFF_DT, MN.EXP_DT" ).append("\n"); 
		query.append("                                ,(  SELECT CUST.CUST_LGL_ENG_NM" ).append("\n"); 
		query.append("                                    FROM MDM_CUSTOMER CUST" ).append("\n"); 
		query.append("                                    WHERE MN.CUST_CNT_CD = CUST.CUST_CNT_CD" ).append("\n"); 
		query.append("                                       AND MN.CUST_SEQ = CUST.CUST_SEQ ) AS CTRT_PTY_NM" ).append("\n"); 
		query.append("                                , (" ).append("\n"); 
		query.append("                                        CASE WHEN MN.CNTR_LOD_UT_CD = 'F' AND @[frm_pfmc_unit] = 'TEU' THEN" ).append("\n"); 
		query.append("                                                MN.ESTM_MQC_QTY * 2" ).append("\n"); 
		query.append("                                        WHEN MN.CNTR_LOD_UT_CD = 'T' AND @[frm_pfmc_unit] = 'FEU' THEN" ).append("\n"); 
		query.append("                                                MN.ESTM_MQC_QTY /2" ).append("\n"); 
		query.append("                                        ELSE MN.ESTM_MQC_QTY" ).append("\n"); 
		query.append("                                        END" ).append("\n"); 
		query.append("                                ) ESTM_MQC_QTY  -- PROP_MQC_QTY								-- MQC( TARGET VVD )" ).append("\n"); 
		query.append("                                , MN.SVC_SCP_CD" ).append("\n"); 
		query.append("                                , ( MN.PRC_CUST_TP_CD) AS CUST_TP_CD" ).append("\n"); 
		query.append("                                ,'' AS PROP_APRO_OFC_CD" ).append("\n"); 
		query.append("                                ,(MN.QTTN_SREP_CD) AS QTTN_SREP_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                ---" ).append("\n"); 
		query.append("                                , MN_DT.PRS_ESTM_LOD_QTY -- LOAD(NEW)" ).append("\n"); 
		query.append("                                , MN_DT.ESTM_RESPB_CM_AMT  -- AS CM_NEW_OFFICE" ).append("\n"); 
		query.append("                                , MN_DT.ESTM_PFIT_CM_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                                , MN_DT.ESTM_RESPB_OP_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                        FROM PRI_SQ_MN MN" ).append("\n"); 
		query.append("                             , PRI_SQ_HDR HDR" ).append("\n"); 
		query.append("                             , ( SELECT DISTINCT PROP_NO,SC_NO FROM VW_SC_MAIN_NEW_SET ) SC_SET" ).append("\n"); 
		query.append("                             , (" ).append("\n"); 
		query.append("                                SELECT	SC_SET.SC_NO, MN.QTTN_NO, MN.QTTN_VER_NO" ).append("\n"); 
		query.append("                                        , CMDT_ROUT.PRS_ESTM_LOD_QTY  / DECODE(@[frm_pfmc_unit],'FEU',2,'TEU',1) AS PRS_ESTM_LOD_QTY -- LOAD(NEW)" ).append("\n"); 
		query.append("                                        , CASE WHEN SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,2,1) = '2' OR SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,1,1) = '2'" ).append("\n"); 
		query.append("                                                THEN CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_RESPB_CMPB_AMT" ).append("\n"); 
		query.append("                                                ELSE" ).append("\n"); 
		query.append("                                                CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_RESPB_CMPB_AMT  / 2" ).append("\n"); 
		query.append("                                        END  AS ESTM_RESPB_CM_AMT  -- AS CM_NEW_OFFICE" ).append("\n"); 
		query.append("                                        , CASE WHEN SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,2,1) = '2' OR SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,1,1) = '2'" ).append("\n"); 
		query.append("                                                THEN CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_PFIT_CMPB_AMT" ).append("\n"); 
		query.append("                                                ELSE" ).append("\n"); 
		query.append("                                                CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_PFIT_CMPB_AMT  / 2" ).append("\n"); 
		query.append("                                        END  AS ESTM_PFIT_CM_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                                        , CASE WHEN SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,2,1) = '2' OR SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,1,1) = '2'" ).append("\n"); 
		query.append("                                                THEN CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_RESPB_OPB_AMT" ).append("\n"); 
		query.append("                                                ELSE" ).append("\n"); 
		query.append("                                                CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_RESPB_OPB_AMT  / 2" ).append("\n"); 
		query.append("                                        END  AS ESTM_RESPB_OP_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                                FROM	PRI_SQ_MN MN" ).append("\n"); 
		query.append("                                        ,( SELECT DISTINCT PROP_NO,SC_NO FROM VW_SC_MAIN_NEW_SET ) SC_SET" ).append("\n"); 
		query.append("                                        , PRI_SQ_RT_CMDT_ROUT CMDT_ROUT" ).append("\n"); 
		query.append("                                WHERE	" ).append("\n"); 
		query.append("                                          MN.PROP_NO = SC_SET.PROP_NO" ).append("\n"); 
		query.append("                                        AND MN.SVC_SCP_CD = @[frm_svc_scp_cd]" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                        AND MN.QTTN_NO = CMDT_ROUT.QTTN_NO" ).append("\n"); 
		query.append("                                        AND MN.QTTN_VER_NO = CMDT_ROUT.QTTN_VER_NO" ).append("\n"); 
		query.append("                                        #if(${frm_contract_type} == 'B' || ${frm_contract_type} == 'S')" ).append("\n"); 
		query.append("                                                AND 1=1" ).append("\n"); 
		query.append("                                        #else" ).append("\n"); 
		query.append("                                                AND 1=0" ).append("\n"); 
		query.append("                                        #end" ).append("\n"); 
		query.append("                                        -- BY CARGO TYPE" ).append("\n"); 
		query.append("                                        #if (${crg_tp_str} != '' )" ).append("\n"); 
		query.append("                                             AND CMDT_ROUT.PRS_CGO_TP_CD IN ( ${crg_tp_str} )" ).append("\n"); 
		query.append("                                        #end" ).append("\n"); 
		query.append("                            ) MN_DT" ).append("\n"); 
		query.append("                        WHERE  MN.PROP_NO = SC_SET.PROP_NO" ).append("\n"); 
		query.append("                               AND MN.QTTN_NO   = HDR.QTTN_NO" ).append("\n"); 
		query.append("                               AND MN.QTTN_NO = MN_DT.QTTN_NO(+)" ).append("\n"); 
		query.append("                               AND MN.QTTN_VER_NO = MN_DT.QTTN_VER_NO(+)" ).append("\n"); 
		query.append("                )" ).append("\n"); 
		query.append("                GROUP BY SC_NO,PROP_OFC_CD,CUST_CNT_CD,CUST_SEQ, PROP_NO, AMDT_SEQ, EFF_DT, EXP_DT,CONTRACT_NO" ).append("\n"); 
		query.append("        )  " ).append("\n"); 
		query.append("        ----------------------------------------------------------------------------------------------------------------------------------" ).append("\n"); 
		query.append("        -- RFA 시작" ).append("\n"); 
		query.append("        ----------------------------------------------------------------------------------------------------------------------------------" ).append("\n"); 
		query.append("        UNION ALL" ).append("\n"); 
		query.append("	SELECT RFA_NO" ).append("\n"); 
		query.append("		, 'RFA' AS CONTRACT_NM" ).append("\n"); 
		query.append("		, DECODE(AMDT_SEQ,0,'Proposal','Amendment') AS CONTRACT_BASIS" ).append("\n"); 
		query.append("		, DECODE(AMDT_SEQ,0,2,3) AS SORT_KEY" ).append("\n"); 
		query.append("		, PROP_OFC_CD" ).append("\n"); 
		query.append("		, PROP_OFC_NM" ).append("\n"); 
		query.append("		, PROP_NO" ).append("\n"); 
		query.append("		, AMDT_SEQ" ).append("\n"); 
		query.append("		, CONTRACT_NO" ).append("\n"); 
		query.append("		, CUST_CNT_CD" ).append("\n"); 
		query.append("		, CUST_SEQ" ).append("\n"); 
		query.append("		, CTRT_EFF_DT" ).append("\n"); 
		query.append("		, CTRT_EXP_DT" ).append("\n"); 
		query.append("		, CTRT_PTY_NM	 " ).append("\n"); 
		query.append("		, PROP_MQC_QTY	 " ).append("\n"); 
		query.append("		, LOAD          " ).append("\n"); 
		query.append("		, CM_OFFICE	 " ).append("\n"); 
		query.append("		, CM_TRADE " ).append("\n"); 
		query.append("		, OP " ).append("\n"); 
		query.append("		, CMPB_OFFICE " ).append("\n"); 
		query.append("		, CMPB_TRADE	 " ).append("\n"); 
		query.append("		, OPB	 " ).append("\n"); 
		query.append("		, CUST_TP_CD           " ).append("\n"); 
		query.append("		, PROP_APRO_OFC_CD" ).append("\n"); 
		query.append("		, RESPB_SREP_CD   " ).append("\n"); 
		query.append("	FROM (" ).append("\n"); 
		query.append("		 SELECT" ).append("\n"); 
		query.append("			PROP_OFC_CD" ).append("\n"); 
		query.append("			, MAX(PROP_OFC_NM) AS PROP_OFC_NM -- REQUEST OFFICE" ).append("\n"); 
		query.append("			, PROP_NO" ).append("\n"); 
		query.append("			, AMDT_SEQ" ).append("\n"); 
		query.append("			, CUST_CNT_CD" ).append("\n"); 
		query.append("			, CUST_SEQ" ).append("\n"); 
		query.append("			, CTRT_EFF_DT, CTRT_EXP_DT" ).append("\n"); 
		query.append("			, MAX(CTRT_PTY_NM) AS CTRT_PTY_NM								-- CUSTOMER NAME" ).append("\n"); 
		query.append("			, MAX(PROP_MQC_QTY) AS PROP_MQC_QTY								-- MQC( TARGET VVD )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                        , SUM(PRS_ESTM_LOD_QTY) AS LOAD-- LOAD(NEW)" ).append("\n"); 
		query.append("                        , SUM(ESTM_RESPB_CM_AMT) AS CM_OFFICE	   -- Office Profit -- CM(NEW)" ).append("\n"); 
		query.append("                        , SUM(ESTM_PFIT_CM_AMT) AS CM_TRADE	   -- Trade Profit -- CM(NEW)" ).append("\n"); 
		query.append("                        , SUM(ESTM_RESPB_OP_AMT) AS OP	    --OP(NEW)" ).append("\n"); 
		query.append("                        , DECODE( SUM(PRS_ESTM_LOD_QTY), 0 , 0, SUM(ESTM_RESPB_CM_AMT) / SUM(PRS_ESTM_LOD_QTY)) AS CMPB_OFFICE	-- OFFICE PROPIT/CMPB" ).append("\n"); 
		query.append("                        , DECODE( SUM(PRS_ESTM_LOD_QTY), 0 , 0, SUM(ESTM_PFIT_CM_AMT) /  SUM(PRS_ESTM_LOD_QTY)) AS CMPB_TRADE	-- TRADE PROPIT/CM" ).append("\n"); 
		query.append("                        , DECODE( SUM(PRS_ESTM_LOD_QTY), 0 , 0, SUM(ESTM_RESPB_OP_AMT) / SUM(PRS_ESTM_LOD_QTY)) AS OPB	 --OPB(NEW)" ).append("\n"); 
		query.append("                        , SUM(PRS_AMDT_LOD_QTY) AS AMDT_LOAD-- LOAD(NEW)" ).append("\n"); 
		query.append("                        , SUM(AMDT_RESPB_CM_AMT) AS AMDT_CM_OFFICE	   -- Office Profit -- CM(NEW)" ).append("\n"); 
		query.append("                        , SUM(AMDT_PFIT_CM_AMT) AS AMDT_CM_TRADE	   -- Trade Profit -- CM(NEW)" ).append("\n"); 
		query.append("                        , SUM(AMDT_RESPB_OP_AMT) AS AMDT_OP	    --OP(NEW)" ).append("\n"); 
		query.append("                        , DECODE( SUM(AMDT_RESPB_OP_AMT), 0 ,0, SUM(AMDT_RESPB_CM_AMT) / SUM(PRS_AMDT_LOD_QTY)) AS AMDT_CMPB_OFFICE	-- OFFICE PROPIT/CMPB" ).append("\n"); 
		query.append("                        , DECODE( SUM(AMDT_RESPB_OP_AMT), 0 ,0, SUM(AMDT_PFIT_CM_AMT) / SUM(PRS_AMDT_LOD_QTY)) AS AMDT_CMPB_TRADE	-- TRADE PROPIT/CM" ).append("\n"); 
		query.append("                        , DECODE( SUM(AMDT_RESPB_OP_AMT), 0 ,0, SUM(AMDT_RESPB_OP_AMT) / SUM(PRS_AMDT_LOD_QTY)) AS AMDT_OPB	 --OPB(NEW)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                        , CONTRACT_NO" ).append("\n"); 
		query.append("                         , MAX(CUST_TP_CD ) AS CUST_TP_CD" ).append("\n"); 
		query.append("                        , MAX(PROP_APRO_OFC_CD ) AS PROP_APRO_OFC_CD" ).append("\n"); 
		query.append("                        , MAX(RESPB_SREP_CD ) AS RESPB_SREP_CD" ).append("\n"); 
		query.append("						, RFA_NO" ).append("\n"); 
		query.append("		FROM (" ).append("\n"); 
		query.append("                        SELECT MN_SET.PROP_OFC_CD" ).append("\n"); 
		query.append("                                , MN_SET.PROP_OFC_NM --  AS PROP_OFC_NM -- REQUEST OFFICE" ).append("\n"); 
		query.append("                                , MN_SET.CUST_CNT_CD" ).append("\n"); 
		query.append("                                , MN_SET.CUST_SEQ" ).append("\n"); 
		query.append("                                , MN_SET.PROP_NO" ).append("\n"); 
		query.append("                                , MN_SET.AMDT_SEQ" ).append("\n"); 
		query.append("                                , MN_SET.CTRT_EFF_DT, MN.CTRT_EXP_DT" ).append("\n"); 
		query.append("                                , MN_SET.CTRT_PTY_NM -- CTRT_PTY_NM								-- CUSTOMER NAME" ).append("\n"); 
		query.append("                                , MN_SET.PROP_MQC_QTY  -- PROP_MQC_QTY								-- MQC( TARGET VVD )" ).append("\n"); 
		query.append("                                , MN_SET.CONTRACT_NO" ).append("\n"); 
		query.append("                                , MN_SET.CUST_TP_CD" ).append("\n"); 
		query.append("                                , MN_SET.PROP_APRO_OFC_CD" ).append("\n"); 
		query.append("                                , MN_SET.RESPB_SREP_CD" ).append("\n"); 
		query.append("                                , MN_SET.RFA_NO" ).append("\n"); 
		query.append("                                , MN_SET.SVC_SCP_CD" ).append("\n"); 
		query.append("                                , MN.PRS_ESTM_LOD_QTY -- LOAD(NEW)" ).append("\n"); 
		query.append("                                , MN.ESTM_RESPB_CM_AMT  -- AS CM_NEW_OFFICE" ).append("\n"); 
		query.append("                                , MN.ESTM_PFIT_CM_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                                , MN.ESTM_RESPB_OP_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                                , MN.PRS_AMDT_LOD_QTY" ).append("\n"); 
		query.append("                                , MN.AMDT_RESPB_CM_AMT  -- AS CM_NEW_OFFICE" ).append("\n"); 
		query.append("                                , MN.AMDT_PFIT_CM_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                                , MN.AMDT_RESPB_OP_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                        FROM VW_RFA_MAIN_NEW_SET MN_SET" ).append("\n"); 
		query.append("                             ,(" ).append("\n"); 
		query.append("                                SELECT	MN.PROP_OFC_CD" ).append("\n"); 
		query.append("                                        , MN.PROP_OFC_NM --  AS PROP_OFC_NM -- REQUEST OFFICE" ).append("\n"); 
		query.append("                                        , MN.CUST_CNT_CD" ).append("\n"); 
		query.append("                                        , MN.CUST_SEQ" ).append("\n"); 
		query.append("                                        , MN.PROP_NO" ).append("\n"); 
		query.append("                                        , MN.AMDT_SEQ" ).append("\n"); 
		query.append("                                        , MN.CTRT_EFF_DT, MN.CTRT_EXP_DT" ).append("\n"); 
		query.append("                                        , MN.CTRT_PTY_NM -- CTRT_PTY_NM								-- CUSTOMER NAME" ).append("\n"); 
		query.append("                                        , MN.PROP_MQC_QTY  -- PROP_MQC_QTY								-- MQC( TARGET VVD )" ).append("\n"); 
		query.append("                                        , CMDT_ROUT.PRS_ESTM_LOD_QTY  / DECODE(@[frm_pfmc_unit],'FEU',2,'TEU',1) AS PRS_ESTM_LOD_QTY -- LOAD(NEW)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                        , CASE WHEN SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,2,1) = '2' OR SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,1,1) = '2'" ).append("\n"); 
		query.append("                                        THEN CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_RESPB_CMPB_AMT" ).append("\n"); 
		query.append("                                        ELSE" ).append("\n"); 
		query.append("                                        CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_RESPB_CMPB_AMT  / 2" ).append("\n"); 
		query.append("                                        END  AS ESTM_RESPB_CM_AMT  -- AS CM_NEW_OFFICE" ).append("\n"); 
		query.append("                                        , CASE WHEN SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,2,1) = '2' OR SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,1,1) = '2'" ).append("\n"); 
		query.append("                                        THEN CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_PFIT_CMPB_AMT" ).append("\n"); 
		query.append("                                        ELSE" ).append("\n"); 
		query.append("                                        CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_PFIT_CMPB_AMT  / 2" ).append("\n"); 
		query.append("                                        END  AS ESTM_PFIT_CM_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                                        , CASE WHEN SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,2,1) = '2' OR SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,1,1) = '2'" ).append("\n"); 
		query.append("                                        THEN CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_RESPB_OPB_AMT" ).append("\n"); 
		query.append("                                        ELSE" ).append("\n"); 
		query.append("                                        CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_RESPB_OPB_AMT  / 2" ).append("\n"); 
		query.append("                                        END  AS ESTM_RESPB_OP_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                        " ).append("\n"); 
		query.append("                                        , (CMDT_ROUT.PRS_RMN_LOD_QTY+CMDT_ROUT.PRS_CRNT_LOD_QTY)  / DECODE('TEU','FEU',2,'TEU',1) AS PRS_AMDT_LOD_QTY -- LOAD(NEW)" ).append("\n"); 
		query.append("                                        ,  (CMDT_ROUT.PRS_RMN_LOD_QTY * CMDT_ROUT.PRS_RMN_RESPB_CMPB_AMT +  CMDT_ROUT.PRS_CRNT_LOD_QTY * CMDT_ROUT.PRS_CRNT_RESPB_CMPB_AMT)  AS AMDT_RESPB_CM_AMT  -- AS CM_NEW_OFFICE" ).append("\n"); 
		query.append("                                        ,  (CMDT_ROUT.PRS_RMN_LOD_QTY * CMDT_ROUT.PRS_RMN_PFIT_CMPB_AMT + CMDT_ROUT.PRS_CRNT_LOD_QTY * CMDT_ROUT.PRS_CRNT_PFIT_CMPB_AMT)  AS AMDT_PFIT_CM_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                                        ,  (CMDT_ROUT.PRS_RMN_LOD_QTY * CMDT_ROUT.PRS_CRNT_RESPB_OPB_AMT + CMDT_ROUT.PRS_CRNT_LOD_QTY * CMDT_ROUT.PRS_CRNT_RESPB_OPB_AMT)  AS AMDT_RESPB_OP_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                                        , MN.CONTRACT_NO" ).append("\n"); 
		query.append("                                        , MN.CUST_TP_CD" ).append("\n"); 
		query.append("                                        , MN.PROP_APRO_OFC_CD" ).append("\n"); 
		query.append("                                        , MN.RESPB_SREP_CD" ).append("\n"); 
		query.append("                                        , MN.RFA_NO" ).append("\n"); 
		query.append("                                        , MN.SVC_SCP_CD" ).append("\n"); 
		query.append("                                FROM	VW_RFA_MAIN_NEW_SET MN" ).append("\n"); 
		query.append("                                        , PRI_RP_SCP_RT_CMDT_ROUT CMDT_ROUT" ).append("\n"); 
		query.append("                                WHERE	 MN.PROP_NO = CMDT_ROUT.PROP_NO" ).append("\n"); 
		query.append("                                        AND MN.AMDT_SEQ = CMDT_ROUT.AMDT_SEQ" ).append("\n"); 
		query.append("                                        AND MN.SVC_SCP_CD = CMDT_ROUT.SVC_SCP_CD" ).append("\n"); 
		query.append("                                        #if(${frm_contract_type} == 'B' || ${frm_contract_type} == 'R')" ).append("\n"); 
		query.append("                                                AND 1=1" ).append("\n"); 
		query.append("                                        #else" ).append("\n"); 
		query.append("                                                AND 1=0" ).append("\n"); 
		query.append("                                        #end" ).append("\n"); 
		query.append("                                        -- BY CARGO TYPE" ).append("\n"); 
		query.append("                                        #if (${crg_tp_str} != '' )" ).append("\n"); 
		query.append("                                                AND CMDT_ROUT.PRS_CGO_TP_CD IN ( ${crg_tp_str} )" ).append("\n"); 
		query.append("                                        #end" ).append("\n"); 
		query.append("                              ) MN" ).append("\n"); 
		query.append("                              WHERE MN_SET.PROP_NO = MN.PROP_NO(+)" ).append("\n"); 
		query.append("                                  AND   MN_SET.AMDT_SEQ = MN.AMDT_SEQ(+)" ).append("\n"); 
		query.append("                                  AND  MN_SET.SVC_SCP_CD = MN.SVC_SCP_CD(+)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("		)" ).append("\n"); 
		query.append("		GROUP BY RFA_NO,PROP_OFC_CD,CUST_CNT_CD,CUST_SEQ, PROP_NO, AMDT_SEQ, CTRT_EFF_DT, CTRT_EXP_DT,CONTRACT_NO " ).append("\n"); 
		query.append("        )  " ).append("\n"); 
		query.append("	UNION ALL " ).append("\n"); 
		query.append("	SELECT RFA_NO" ).append("\n"); 
		query.append("		, 'RFA' AS CONTRACT_NM" ).append("\n"); 
		query.append("		, 'Quotation' AS CONTRACT_BASIS" ).append("\n"); 
		query.append("		, 1 AS SORT_KEY" ).append("\n"); 
		query.append("		, PROP_OFC_CD" ).append("\n"); 
		query.append("		, PROP_OFC_NM" ).append("\n"); 
		query.append("		, PROP_NO" ).append("\n"); 
		query.append("		, -1 AS AMDT_SEQ" ).append("\n"); 
		query.append("		, CONTRACT_NO" ).append("\n"); 
		query.append("		, CUST_CNT_CD" ).append("\n"); 
		query.append("		, CUST_SEQ" ).append("\n"); 
		query.append("		, EFF_DT" ).append("\n"); 
		query.append("		, EXP_DT" ).append("\n"); 
		query.append("		, CTRT_PTY_NM	 " ).append("\n"); 
		query.append("		, PROP_MQC_QTY	 " ).append("\n"); 
		query.append("		, LOAD          " ).append("\n"); 
		query.append("		, CM_OFFICE	 " ).append("\n"); 
		query.append("		, CM_TRADE " ).append("\n"); 
		query.append("		, OP " ).append("\n"); 
		query.append("		, CMPB_OFFICE " ).append("\n"); 
		query.append("		, CMPB_TRADE	 " ).append("\n"); 
		query.append("		, OPB	 " ).append("\n"); 
		query.append("		, CUST_TP_CD           " ).append("\n"); 
		query.append("		, PROP_APRO_OFC_CD" ).append("\n"); 
		query.append("		, RESPB_SREP_CD      " ).append("\n"); 
		query.append("	FROM (" ).append("\n"); 
		query.append("                SELECT" ).append("\n"); 
		query.append("                        RFA_NO" ).append("\n"); 
		query.append("                        , PROP_OFC_CD" ).append("\n"); 
		query.append("                        , MAX(PROP_OFC_NM) AS PROP_OFC_NM -- REQUEST OFFICE" ).append("\n"); 
		query.append("                        , PROP_NO" ).append("\n"); 
		query.append("                        , AMDT_SEQ" ).append("\n"); 
		query.append("                        , CONTRACT_NO" ).append("\n"); 
		query.append("                        , CUST_CNT_CD" ).append("\n"); 
		query.append("                        , CUST_SEQ" ).append("\n"); 
		query.append("                        , EFF_DT, EXP_DT" ).append("\n"); 
		query.append("                        , MAX(CTRT_PTY_NM) AS CTRT_PTY_NM								-- CUSTOMER NAME" ).append("\n"); 
		query.append("                        , MAX(ESTM_MQC_QTY) AS PROP_MQC_QTY								-- MQC( TARGET VVD )" ).append("\n"); 
		query.append("                        , MAX(CUST_TP_CD ) AS CUST_TP_CD" ).append("\n"); 
		query.append("                        , MAX(PROP_APRO_OFC_CD) AS PROP_APRO_OFC_CD" ).append("\n"); 
		query.append("                        , MAX(QTTN_SREP_CD ) AS RESPB_SREP_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                        , SUM(PRS_ESTM_LOD_QTY) AS LOAD-- LOAD(NEW)" ).append("\n"); 
		query.append("                        , SUM(ESTM_RESPB_CM_AMT) AS CM_OFFICE	   -- Office Profit -- CM(NEW)" ).append("\n"); 
		query.append("                        , SUM(ESTM_PFIT_CM_AMT) AS CM_TRADE	   -- Trade Profit -- CM(NEW)" ).append("\n"); 
		query.append("                        , SUM(ESTM_RESPB_OP_AMT) AS OP	    --OP(NEW)" ).append("\n"); 
		query.append("                        , DECODE(SUM(PRS_ESTM_LOD_QTY),0,0,SUM(ESTM_RESPB_CM_AMT) / SUM(PRS_ESTM_LOD_QTY)) AS CMPB_OFFICE	-- OFFICE PROPIT/CMPB" ).append("\n"); 
		query.append("                        , DECODE(SUM(PRS_ESTM_LOD_QTY),0,0,SUM(ESTM_PFIT_CM_AMT) / SUM(PRS_ESTM_LOD_QTY)) AS CMPB_TRADE	-- TRADE PROPIT/CM" ).append("\n"); 
		query.append("                        , DECODE(SUM(PRS_ESTM_LOD_QTY),0,0,SUM(ESTM_RESPB_OP_AMT) / SUM(PRS_ESTM_LOD_QTY)) AS OPB	 --OPB(NEW)" ).append("\n"); 
		query.append("                FROM (" ).append("\n"); 
		query.append("                        SELECT " ).append("\n"); 
		query.append("                                SC_SET.RFA_NO" ).append("\n"); 
		query.append("                                , HDR.QTTN_OFC_CD AS PROP_OFC_CD" ).append("\n"); 
		query.append("				, (SELECT M_ORG.OFC_ENG_NM FROM MDM_ORGANIZATION M_ORG WHERE HDR.QTTN_OFC_CD = M_ORG.OFC_CD) AS PROP_OFC_NM" ).append("\n"); 
		query.append("                                , MN.CUST_CNT_CD" ).append("\n"); 
		query.append("                                , MN.CUST_SEQ" ).append("\n"); 
		query.append("                                , MN.PROP_NO" ).append("\n"); 
		query.append("                                , -1 AS AMDT_SEQ" ).append("\n"); 
		query.append("                                , MN.QTTN_NO || MN.QTTN_VER_NO AS CONTRACT_NO" ).append("\n"); 
		query.append("                                , MN.EFF_DT, MN.EXP_DT					" ).append("\n"); 
		query.append("				,(   SELECT CUST.CUST_LGL_ENG_NM" ).append("\n"); 
		query.append("                                     FROM MDM_CUSTOMER CUST" ).append("\n"); 
		query.append("                                     WHERE MN.CUST_CNT_CD = CUST.CUST_CNT_CD" ).append("\n"); 
		query.append("                                         AND MN.CUST_SEQ = CUST.CUST_SEQ ) AS CTRT_PTY_NM  -- CUSTOMER NAME" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                , (" ).append("\n"); 
		query.append("                                        CASE WHEN MN.CNTR_LOD_UT_CD = 'F' AND @[frm_pfmc_unit] = 'TEU' THEN" ).append("\n"); 
		query.append("                                                MN.ESTM_MQC_QTY * 2" ).append("\n"); 
		query.append("                                        WHEN MN.CNTR_LOD_UT_CD = 'T' AND @[frm_pfmc_unit] = 'FEU' THEN" ).append("\n"); 
		query.append("                                                MN.ESTM_MQC_QTY /2" ).append("\n"); 
		query.append("                                        ELSE MN.ESTM_MQC_QTY" ).append("\n"); 
		query.append("                                        END" ).append("\n"); 
		query.append("                                ) ESTM_MQC_QTY  -- PROP_MQC_QTY								-- MQC( TARGET VVD )" ).append("\n"); 
		query.append("                                , MN.SVC_SCP_CD" ).append("\n"); 
		query.append("                                , ( MN.PRC_CUST_TP_CD) AS CUST_TP_CD" ).append("\n"); 
		query.append("                                ,'' AS PROP_APRO_OFC_CD" ).append("\n"); 
		query.append("                                ,(MN.QTTN_SREP_CD) AS QTTN_SREP_CD" ).append("\n"); 
		query.append("                                , MN_DT.PRS_ESTM_LOD_QTY -- LOAD(NEW)" ).append("\n"); 
		query.append("                                , MN_DT.ESTM_RESPB_CM_AMT  -- AS CM_NEW_OFFICE" ).append("\n"); 
		query.append("                                , MN_DT.ESTM_PFIT_CM_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                                , MN_DT.ESTM_RESPB_OP_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                        FROM PRI_RQ_MN MN" ).append("\n"); 
		query.append("                              , PRI_RQ_HDR HDR" ).append("\n"); 
		query.append("                              ,( SELECT DISTINCT PROP_NO,RFA_NO FROM VW_RFA_MAIN_NEW_SET ) SC_SET" ).append("\n"); 
		query.append("                              ,(" ).append("\n"); 
		query.append("                                SELECT	MN.QTTN_NO,MN.QTTN_VER_NO" ).append("\n"); 
		query.append("                                        , CMDT_ROUT.PRS_ESTM_LOD_QTY  / DECODE(@[frm_pfmc_unit],'FEU',2,'TEU',1) AS PRS_ESTM_LOD_QTY -- LOAD(NEW)" ).append("\n"); 
		query.append("                                        , CASE WHEN SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,2,1) = '2' OR SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,1,1) = '2'" ).append("\n"); 
		query.append("                                                THEN CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_RESPB_CMPB_AMT" ).append("\n"); 
		query.append("                                                ELSE" ).append("\n"); 
		query.append("                                                CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_RESPB_CMPB_AMT  / 2" ).append("\n"); 
		query.append("                                        END  AS ESTM_RESPB_CM_AMT  -- AS CM_NEW_OFFICE" ).append("\n"); 
		query.append("                                        , CASE WHEN SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,2,1) = '2' OR SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,1,1) = '2'" ).append("\n"); 
		query.append("                                                THEN CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_PFIT_CMPB_AMT" ).append("\n"); 
		query.append("                                                ELSE" ).append("\n"); 
		query.append("                                                CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_PFIT_CMPB_AMT  / 2" ).append("\n"); 
		query.append("                                        END  AS ESTM_PFIT_CM_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                                        , CASE WHEN SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,2,1) = '2' OR SUBSTR(CMDT_ROUT.PRS_RAT_UT_CD,1,1) = '2'" ).append("\n"); 
		query.append("                                                THEN CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_RESPB_OPB_AMT" ).append("\n"); 
		query.append("                                                ELSE" ).append("\n"); 
		query.append("                                                CMDT_ROUT.PRS_ESTM_LOD_QTY * CMDT_ROUT.PRS_ESTM_RESPB_OPB_AMT  / 2" ).append("\n"); 
		query.append("                                        END  AS ESTM_RESPB_OP_AMT    --  CM_NEW_OP_TRADE" ).append("\n"); 
		query.append("                                FROM	PRI_RQ_MN MN" ).append("\n"); 
		query.append("                                        ,( SELECT DISTINCT PROP_NO,RFA_NO FROM VW_RFA_MAIN_NEW_SET ) SC_SET" ).append("\n"); 
		query.append("                                        , PRI_RQ_RT_CMDT_ROUT CMDT_ROUT" ).append("\n"); 
		query.append("                                WHERE	 MN.PROP_NO = SC_SET.PROP_NO" ).append("\n"); 
		query.append("                                        AND MN.QTTN_NO = CMDT_ROUT.QTTN_NO" ).append("\n"); 
		query.append("                                        AND MN.QTTN_VER_NO = CMDT_ROUT.QTTN_VER_NO" ).append("\n"); 
		query.append("                                        #if(${frm_contract_type} == 'B' || ${frm_contract_type} == 'R')" ).append("\n"); 
		query.append("                                                AND 1=1" ).append("\n"); 
		query.append("                                        #else" ).append("\n"); 
		query.append("                                                AND 1=0" ).append("\n"); 
		query.append("                                        #end" ).append("\n"); 
		query.append("                                        -- BY CARGO TYPE" ).append("\n"); 
		query.append("                                        #if (${crg_tp_str} != '' )" ).append("\n"); 
		query.append("                                             AND CMDT_ROUT.PRS_CGO_TP_CD IN ( ${crg_tp_str} )" ).append("\n"); 
		query.append("                                        #end" ).append("\n"); 
		query.append("                              ) MN_DT       " ).append("\n"); 
		query.append("                        WHERE MN.QTTN_NO   = HDR.QTTN_NO" ).append("\n"); 
		query.append("                                AND MN.PROP_NO = SC_SET.PROP_NO" ).append("\n"); 
		query.append("                                AND MN.QTTN_NO = MN_DT.QTTN_NO(+)" ).append("\n"); 
		query.append("                                AND MN.QTTN_VER_NO = MN_DT.QTTN_VER_NO(+)" ).append("\n"); 
		query.append("                )" ).append("\n"); 
		query.append("                GROUP BY RFA_NO,PROP_OFC_CD,CUST_CNT_CD,CUST_SEQ, PROP_NO, AMDT_SEQ, EFF_DT, EXP_DT,CONTRACT_NO" ).append("\n"); 
		query.append("        )  " ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("ORDER BY CONTRACT_NM DESC,PROP_NO , SORT_KEY,AMDT_SEQ" ).append("\n"); 

	}
}