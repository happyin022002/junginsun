<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOConsultationDBDAOCustomInterfaceStatusVOCSQL">
			<desc><![CDATA[A/P에서 취소 했을 경우 전표에 대한 취소 전표를 Master 생성한다]]></desc>
			<sql><![CDATA[
INSERT INTO FMS_CONSULTATION (
	SLP_TP_CD
,	SLP_FUNC_CD
,	SLP_OFC_CD
,	SLP_ISS_DT
,	SLP_SER_NO
,	FLET_CTRT_NO
,	CSR_CURR_CD
,	CSR_AMT
,	CSR_USR_ID
,	CSR_DESC
,	DIFF_AMT
,	DIFF_DESC
,	RQST_AMT
,	RQST_DT
,	EFF_DT
,	EVID_TP_CD
,	APRO_FLG
,	APRO_DT
,	CXL_FLG
,	CXL_DESC
,	MNL_TP_FLG
,	VAT_SLP_TP_CD
,	VAT_SLP_FUNC_CD
,	VAT_SLP_OFC_CD
,	VAT_SLP_ISS_DT
,	VAT_SLP_SER_NO
,	PPAY_HIR_NO
,	CRE_USR_ID
,	CRE_DT
,	UPD_USR_ID
,	UPD_DT
)
SELECT 
	@[slp_tp_cd] SLP_TP_CD
,	@[slp_func_cd] SLP_FUNC_CD
,	@[slp_ofc_cd] SLP_OFC_CD
,	@[slp_iss_dt] SLP_ISS_DT
,	@[slp_ser_no] SLP_SER_NO
,	FLET_CTRT_NO
,	CSR_CURR_CD
,	CSR_AMT*-1
,	CSR_USR_ID
,	CSR_DESC
,	DIFF_AMT*-1
,	DIFF_DESC
,	RQST_AMT*-1
,	RQST_DT
#if (${org_slp_tp_cd} == '07')
,	EFF_DT
#else
, (SELECT TO_CHAR(DECODE(A.CNT, 1, DECODE(SUBSTR(MAX_EFF, 1, 6), 
                                TO_CHAR(SYSDATE, 'YYYYMM'), SYSDATE, 
                                TO_DATE(MAX_EFF, 'YYYYMMDD')), TO_DATE(MIN_EFF, 'YYYYMMDD')), 'YYYYMMDD') EFF_DT
    FROM (SELECT TO_CHAR(MIN(LAST_DAY(TO_DATE(EFF_YRMON, 'YYYYMM'))), 'YYYYMMDD') MIN_EFF,
                 TO_CHAR(MAX(TRUNC(TO_DATE(EFF_YRMON, 'YYYYMM'), 'MONTH')), 'YYYYMMDD') MAX_EFF,
                 COUNT(P.EFF_YRMON) CNT
            FROM AP_PERIOD P
           WHERE P.SYS_DIV_CD = '18'
             AND P.AR_AP_DIV_CD = 'R'
             AND P.CLZ_STS_CD = 'O'
             AND OFC_CD = (SELECT S.AR_HD_QTR_OFC_CD
                    FROM MDM_ORGANIZATION S
                   WHERE S.OFC_CD = @[slp_ofc_cd]))A) EFF_DT  
#end
,	EVID_TP_CD
#if (${org_slp_tp_cd} == '07')
,	'Y' APRO_FLG
,	SYSDATE APRO_DT
#else
,	'N' APRO_FLG
,	'' APRO_DT
#end
,	CXL_FLG
,	CXL_DESC
,	MNL_TP_FLG
,	VAT_SLP_TP_CD
,	VAT_SLP_FUNC_CD
,	VAT_SLP_OFC_CD
,	VAT_SLP_ISS_DT
,	VAT_SLP_SER_NO
,	PPAY_HIR_NO
,	@[cre_usr_id] CRE_USR_ID
,	SYSDATE
,	@[cre_usr_id] UPD_USR_ID
,	SYSDATE
FROM FMS_CONSULTATION
WHERE	SLP_TP_CD = @[org_slp_tp_cd]
AND	SLP_FUNC_CD = @[org_slp_func_cd]
AND	SLP_OFC_CD = @[org_slp_ofc_cd]
AND	SLP_ISS_DT = @[org_slp_iss_dt]
AND	SLP_SER_NO = @[org_slp_ser_no]			]]></sql>
			<params>
				<param name="slp_tp_cd" type="12" value="" out="N"/>
				<param name="slp_func_cd" type="12" value="" out="N"/>
				<param name="slp_ofc_cd" type="12" value="" out="N"/>
				<param name="slp_iss_dt" type="12" value="" out="N"/>
				<param name="slp_ser_no" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="org_slp_tp_cd" type="12" value="" out="N"/>
				<param name="org_slp_func_cd" type="12" value="" out="N"/>
				<param name="org_slp_ofc_cd" type="12" value="" out="N"/>
				<param name="org_slp_iss_dt" type="12" value="" out="N"/>
				<param name="org_slp_ser_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
