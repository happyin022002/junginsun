<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ConstraintMasterDBDAOAddFixedFlagInfoByPriCSQL">
			<desc><![CDATA[Pri에서 Fixed Flag가 체크된 계약의 계약NO 정보 I/F 받는다.
2015.07.03 이혜민 [CHM-201536633] Control Option management 보완요청 (Fixed Rate관련)]]></desc>
			<sql><![CDATA[
INSERT INTO SPC_ALOC_LANE_CTRL_OPT_DTL
           (  TRD_CD
            , SUB_TRD_CD
            , RLANE_CD
            , DIR_CD
            , ALOC_CTRL_TP_CD 
            , CTRL_LOC_ACCT_CD 
            , ALOC_CTRL_DTL_CD 
            , SC_NO 
            , RFA_NO 
            , CRE_USR_ID
            , CRE_DT
            , UPD_USR_ID
            , UPD_DT
            , CTRL_FX_RT_FLG
           )
SELECT DISTINCT 
         A3.TRD_CD
       , A3.SUB_TRD_CD
       , A3.RLANE_CD
       , A3.DIR_CD
       , 'F' AS ALOC_CTRL_TP_CD
       , A5.SC_NO AS CTRL_LOC_ACCT_CD
       , A5.SC_NO AS ALOC_CTRL_DTL_CD
       , '*' AS SC_NO
       , '*' AS RFA_NO
       , @[cre_usr_id] AS CRE_USR_ID
       , SYSDATE AS CRE_DT
       , @[cre_usr_id] AS UPD_USR_ID
       , SYSDATE AS UPD_DT
       , 'Y' AS CTRL_FX_RT_FLG
FROM PRI_SP_SCP_MN 			A1
    ,PRI_SP_SCP_RT_CMDT_HDR A2
    ,SPC_ALOC_LANE_CTRL_OPT A3
    ,MDM_SVC_SCP_LANE       A4
	,PRI_SP_HDR 			A5
WHERE A1.PROP_NO            = A2.PROP_NO
AND A1.AMDT_SEQ             = A2.AMDT_SEQ
AND A1.SVC_SCP_CD           = A2.SVC_SCP_CD
AND NVL(A2.FX_RT_FLG,'N')   = 'Y'
AND A1.PROP_NO              = @[prop_no]
AND A1.AMDT_SEQ             = @[amdt_seq]
AND SUBSTR(A3.RLANE_CD,1,3) = A4.VSL_SLAN_CD
AND A4.DELT_FLG             = 'N'
AND A1.SVC_SCP_CD           = A4.SVC_SCP_CD
AND A1.PROP_NO              = A5.PROP_NO
--SPC_ALOC_LANE_CTRL_OPT_DTL 테이블에 없을때만 insert
 AND NOT EXISTS (SELECT * 
                 FROM SPC_ALOC_LANE_CTRL_OPT_DTL C1
                 WHERE C1.TRD_CD            = A3.TRD_CD
                 AND   C1.SUB_TRD_CD        = A3.SUB_TRD_CD
                 AND   C1.RLANE_CD          = A3.RLANE_CD
                 AND   C1.DIR_CD            = A3.DIR_CD
                 AND   C1.ALOC_CTRL_TP_CD   = 'F'
                 AND   C1.CTRL_LOC_ACCT_CD  = A5.SC_NO
                )			]]></sql>
			<params>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="prop_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
