<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCProposalMainDBDAOPriSpScpMnPrsCalcFlgOnRtUSQL">
			<desc><![CDATA[Rate수정시 Scope Main테이블의 PrsCalc.컬럼업데이트]]></desc>
			<sql><![CDATA[
UPDATE PRI_SP_SCP_MN M
   SET PRS_GEN_RT_CMPB_CALC_FLG  = NVL((SELECT DECODE(COUNT(*)
                                                    ,0
                                                    ,'N'
                                                    ,M.PRS_GEN_RT_CMPB_CALC_FLG)
                                         FROM PRI_SP_SCP_RT R
                                        WHERE R.PROP_NO = M.PROP_NO
                                          AND R.AMDT_SEQ = M.AMDT_SEQ
                                          AND R.SVC_SCP_CD = M.SVC_SCP_CD
                                          AND R.GEN_SPCL_RT_TP_CD = 'G'
                                          AND R.AMDT_SEQ =
                                              R.N1ST_CMNC_AMDT_SEQ
                                          AND R.SRC_INFO_CD <> 'AD'
                                        GROUP BY R.PROP_NO
                                                ,R.AMDT_SEQ
                                                ,R.SVC_SCP_CD
                                                ,R.GEN_SPCL_RT_TP_CD)
                                      ,'N')
      ,PRS_SPCL_RT_CMPB_CALC_FLG = NVL((SELECT DECODE(COUNT(*)
                                                    ,0
                                                    ,'N'
                                                    ,M.PRS_SPCL_RT_CMPB_CALC_FLG)
                                         FROM PRI_SP_SCP_RT R
                                        WHERE R.PROP_NO = M.PROP_NO
                                          AND R.AMDT_SEQ = M.AMDT_SEQ
                                          AND R.SVC_SCP_CD = M.SVC_SCP_CD
                                          AND R.GEN_SPCL_RT_TP_CD = 'S'
                                          AND R.AMDT_SEQ =
                                              R.N1ST_CMNC_AMDT_SEQ
                                          AND R.SRC_INFO_CD <> 'AD'
                                        GROUP BY R.PROP_NO
                                                ,R.AMDT_SEQ
                                                ,R.SVC_SCP_CD
                                                ,R.GEN_SPCL_RT_TP_CD)
                                      ,'N')
 WHERE PROP_NO = @[prop_no]
   AND AMDT_SEQ = @[amdt_seq]
   AND SVC_SCP_CD = @[svc_scp_cd]			]]></sql>
			<params>
				<param name="prop_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="12" value="" out="N"/>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
