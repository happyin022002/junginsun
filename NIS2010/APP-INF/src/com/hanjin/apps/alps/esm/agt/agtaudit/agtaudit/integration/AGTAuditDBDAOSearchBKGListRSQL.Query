<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AGTAuditDBDAOSearchBKGListRSQL">
			<desc><![CDATA[SearchBKGList]]></desc>
			<sql><![CDATA[
SELECT
           BL_NO                                                       AS BL_NO,
           BKG_NO                                                      AS BKG_NO,
           VSL_CD||SKD_VOY_NO||SKD_DIR_CD                              AS VVD,
           BKG_STS_CD,
           BKG_OFC_CD,
           TO_CHAR(BKG_CRE_DT,'YYYY-MM-DD')                            AS BKG_CRE_DT,
         (     SELECT
                      COUNT(1)
                 FROM AGT_AGN_COMM      X,
                      AGT_COMM_BKG_INFO Y
                WHERE X.BKG_NO          = Y.BKG_NO
                  AND X.BKG_NO          = A.BKG_NO
                  AND X.AR_OFC_CD       = @[ar_ofc_cd]
                  AND X.AGN_CD          = @[agn_cd]
#if(${sts_cd} == '1')
                  AND X.COMM_PROC_STS_CD
                   IN
                    ( 'CS','CE','IC','CA'
                    )
#elseif(${sts_cd} == '2')
                  AND X.COMM_PROC_STS_CD IN ('RS','RM')
#elseif(${sts_cd} == '3')
                  AND X.COMM_PROC_STS_CD = 'AS'
#elseif(${sts_cd} == '4')
                  AND X.COMM_PROC_STS_CD = 'IF'
                  AND X.AC_IF_DT IS NOT NULL
#end
#if(${s_bl_no} != '')
                  AND Y.BL_NO LIKE '%' || @[s_bl_no] || '%'
#elseif(${bl_nos} != '')
                  AND Y.BL_NO
                   IN
                    ( ${bl_nos}
                    )
#end
         )                                                             AS AGT_COMM_CNT,
         (     SELECT
                      COMM_PROC_RSLT_RSN
                 FROM AGT_COMM_BKG_INFO
                WHERE BKG_NO = A.BKG_NO
         )                                                             AS COMM_PROC_RSLT_RSN
      FROM BKG_BOOKING A
     WHERE 1=1
#if(${search_dt_fr} != '')
       AND A.CRE_DT >= TO_DATE(@[search_dt_fr],'YYYY-MM-DD')
#end
#if(${search_dt_to} != '')
       AND A.CRE_DT <= TO_DATE(@[search_dt_to],'YYYY-MM-DD')
#end
#if(${s_bl_no} != '')
       AND A.BL_NO LIKE '%' || @[s_bl_no] || '%'
#elseif(${bl_nos} != '')
       AND A.BL_NO
        IN
         ( ${bl_nos}
         )
#end
  ORDER BY 1			]]></sql>
			<params>
				<param name="ar_ofc_cd" type="12" value="" out="Y"/>
				<param name="agn_cd" type="12" value="" out="Y"/>
				<param name="s_bl_no" type="12" value="" out="Y"/>
				<param name="search_dt_fr" type="12" value="" out="Y"/>
				<param name="search_dt_to" type="12" value="" out="Y"/>
			</params>
		</query>
	</querys>
</sqls>
