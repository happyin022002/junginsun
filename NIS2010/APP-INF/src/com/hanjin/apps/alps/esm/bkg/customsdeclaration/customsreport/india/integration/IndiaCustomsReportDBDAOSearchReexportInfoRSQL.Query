<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="IndiaCustomsReportDBDAOSearchReexportInfoRSQL">
			<desc><![CDATA[ReexportInfo 생성을 위해 사용]]></desc>
			<sql><![CDATA[
SELECT SEQ, CNTR_NO, ISO_CD, IMP_VSL, VSL_VOY, IGM_NO, IGM_DT, EXP_VSL, SKD_VOY_NO, PC_NO, PC_DT, VPS_ETD_DT
FROM
    (
    SELECT RANK() OVER(PARTITION BY BC.BKG_NO, BC.CNTR_NO  ORDER BY BC.BKG_NO, CM.CNTR_NO, CM.CNMV_ID_NO DESC) SEQ,
           BC.BKG_NO, BC.CNMV_CYC_NO, BV.POL_CD,
           BC.CNTR_NO, 
           (SELECT CNTR_TPSZ_ISO_CD 
            FROM MDM_CNTR_TP_SZ
            WHERE BC.CNTR_TPSZ_CD = CNTR_TPSZ_CD) ISO_CD,        
           (SELECT VSL_ENG_NM FROM MDM_VSL_CNTR
            WHERE VSL_CD = CM.CRNT_VSL_CD) IMP_VSL,
            CM.CRNT_SKD_VOY_NO VSL_VOY,
            BIV.IDA_DECL_VSL_NO IGM_NO,
            TO_CHAR(BIV.VSL_DECL_DT, 'YYYY-MM-DD') IGM_DT,
           (SELECT VSL_ENG_NM FROM MDM_VSL_CNTR
            WHERE VSL_CD = BV.VSL_CD) EXP_VSL,
           BV.SKD_VOY_NO,
           '' PC_NO,
           '' PC_DT,
           TO_CHAR(VPS.VPS_ETD_DT, 'YYYY-MM-DD') VPS_ETD_DT             
    FROM VSK_VSL_PORT_SKD VPS, BKG_VVD BV, BKG_CONTAINER BC, CTM_MOVEMENT CM, BKG_CSTMS_IDA_VSL BIV 
    WHERE 1=1 
    --1. 기간 조건(M)
    AND VPS_ETD_DT BETWEEN TO_DATE(@[from_dt], 'YYYY-MM-DD') AND TO_DATE(@[to_dt], 'YYYY-MM-DD') + 0.99999
    --2. VVD 조건(O)
    AND VPS.VSL_CD 		= SUBSTR(@[export_vvd], 1, 4)
    AND	VPS.SKD_VOY_NO 	= SUBSTR(@[export_vvd], 5, 4)
    AND	VPS.SKD_DIR_CD 	= SUBSTR(@[export_vvd], 9, 1)
    --3. POL 조건(M)
    AND BV.POL_CD LIKE @[pol]||'%'
    AND VPS.VSL_CD 		= BV.VSL_CD
    AND	VPS.SKD_VOY_NO 	= BV.SKD_VOY_NO
    AND	VPS.SKD_DIR_CD 	= BV.SKD_DIR_CD
    AND VPS.VPS_PORT_CD = BV.POL_CD
    AND BV.BKG_NO = BC.BKG_NO
    AND BC.CNTR_NO = CM.CNTR_NO
    AND BC.CNMV_YR = CM.CNMV_YR
    AND BC.CNMV_CYC_NO >= CM.CNMV_CYC_NO
    AND CM.MVMT_STS_CD = 'VD'     
    AND CM.ORG_YD_CD LIKE 'IN%'
    AND BIV.VSL_CD = CM.CRNT_VSL_CD
    AND BIV.SKD_VOY_NO = CM.CRNT_SKD_VOY_NO
    AND BIV.SKD_DIR_CD = CM.CRNT_SKD_DIR_CD
    AND BIV.POD_CD = SUBSTR(CM.ORG_YD_CD, 1, 5)
    AND EXISTS (SELECT 'A' FROM CTM_MOVEMENT CTM
                WHERE  CTM.CNTR_NO = CM.CNTR_NO
                AND    CTM.CNMV_CYC_NO = CM.CNMV_CYC_NO
                AND    CTM.MVMT_STS_CD = 'VL'
                AND    CTM.ORG_YD_CD NOT LIKE 'IN%')
    )        
 WHERE SEQ = 1			]]></sql>
			<params>
				<param name="from_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="export_vvd" type="12" value="" out="N"/>
				<param name="pol" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
