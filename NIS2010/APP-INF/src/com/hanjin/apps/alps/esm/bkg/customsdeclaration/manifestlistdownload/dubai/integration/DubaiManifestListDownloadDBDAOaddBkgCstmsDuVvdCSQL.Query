<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DubaiManifestListDownloadDBDAOaddBkgCstmsDuVvdCSQL">
			<desc><![CDATA[addBkgCstmsDuVvd]]></desc>
			<sql><![CDATA[
INSERT 
  INTO BKG_CSTMS_DU_VVD
      (
       VSL_CD
      ,SKD_VOY_NO
      ,SKD_DIR_CD
      ,POD_CD
      ,CLPT_SEQ
      ,POL_CD
      ,VSL_NM
      ,DU_LINE_ID
      ,DU_VOY_AGN_ID
      ,DU_ROTN_NO
      ,ETA_DT
      ,DU_MSG_TP_ID
      ,DU_INSTL_NO
      ,DU_MF_SEQ_NO
      ,DU_MRN_NO
      ,CRE_USR_ID
      ,UPD_USR_ID
      )
      (
       SELECT V.VSL_CD
             ,V.SKD_VOY_NO
             ,V.SKD_DIR_CD
             ,V.POD_CD
             ,S.CLPT_SEQ
             ,V.POL_CD
             ,C.VSL_ENG_NM
             ,'SML'
             ,CASE WHEN @[pod_cd] = 'AESHJ' OR @[pod_cd] = 'AEKLF' THEN 'H0533'
                  ELSE 'H0012' END
             ,@[rotn_no]
             ,TO_DATE(@[eta_dt], 'YYYY-MM-DD')
             ,'MFI'
             ,@[instl_no]
             ,0
             ,@[mrn_no]
             ,@[upd_usr_id]
             ,@[upd_usr_id]
         FROM (
                SELECT V.VSL_CD
		              ,V.SKD_VOY_NO
		              ,V.SKD_DIR_CD
		              ,V.POD_CD
		              ,MIN(V.POL_CD) AS POL_CD
                  FROM BKG_BOOKING B
                      ,BKG_VVD V
                 WHERE B.BKG_NO =V.BKG_NO
                   AND B.BKG_STS_CD IN ('F','W')
                   AND B.BL_NO IS NOT NULL
               #if (${bl_no} != '') 
                   AND B.BL_NO = @[bl_no]
                   AND V.POD_CD LIKE 'AE%'
               #end
               #if (${vvd} != '') 
                   AND V.VSL_CD = SUBSTR(@[vvd],1,4)
                   AND V.SKD_VOY_NO = SUBSTR(@[vvd],5,4)
                   AND V.SKD_DIR_CD = SUBSTR(@[vvd],9,1)
               #end
               #if (${pol_cd} != '') 
                   AND V.POL_CD = @[pol_cd]
               #end
               #if (${pod_cd} != '') 
                   AND V.POD_CD = @[pod_cd]
               #end
               #if (${cgo_type} == 'F') 
                   AND B.BKG_CGO_TP_CD = @[cgo_type]
               #elseif (${cgo_type} == 'M') 
                   AND B.BKG_CGO_TP_CD IN ('R', 'P')
               #end
              GROUP BY V.VSL_CD
		              ,V.SKD_VOY_NO
		              ,V.SKD_DIR_CD
		              ,V.POD_CD
               ) V
             ,VSK_VSL_PORT_SKD S
             ,MDM_VSL_CNTR C
        WHERE V.VSL_CD = S.VSL_CD
          AND V.SKD_VOY_NO = S.SKD_VOY_NO
          AND V.SKD_DIR_CD = S.SKD_DIR_CD
          AND V.POD_CD = S.VPS_PORT_CD
          AND S.CLPT_IND_SEQ = '1'
          AND V.VSL_CD = C.VSL_CD
      )			]]></sql>
			<params>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="rotn_no" type="12" value="" out="N"/>
				<param name="eta_dt" type="12" value="" out="N"/>
				<param name="instl_no" type="12" value="" out="N"/>
				<param name="mrn_no" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="cgo_type" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
