<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BATManagementDBDAOSearchBatchManagementListRSQL">
			<desc><![CDATA[Batch Management 정보를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT
    BAT_ITM_NM,
    CRE_USR_ID,
    COMM_TP_CD,
    N_CNT,
    COM_CNT,
    TOT_BKG_CNT,
    STAT_DT,
    STAT_TM,
    BAT_DESC
FROM (
    SELECT
          A.CRE_USR_ID,
          A.COMM_TP_CD,
          SUM(CASE WHEN A.BAT_FLG = 'N' THEN 1 ELSE 0 END) AS N_CNT,
          COUNT(A.BKG_NO) AS TOT_BKG_CNT,
          SUM(CASE WHEN A.BAT_END_DT IS NOT NULL THEN 1 ELSE 0 END) AS COM_CNT,
          TO_CHAR( MIN(CASE WHEN A.BAT_FLG IN ('P','Y') THEN A.UPD_DT ELSE NULL END), 'YYYY-MM-DD' ) AS STAT_DT,
          TO_CHAR( MIN(CASE WHEN A.BAT_FLG IN ('P','Y') THEN A.UPD_DT ELSE NULL END), 'HH24:MI'    ) AS STAT_TM,
          A.BAT_DESC,
          A.BAT_ITM_NM,
          MAX(A.CRE_DT) AS CRE_DT
    FROM  ACM_CALC_BAT A
    WHERE COMM_TP_CD <> 'S'
    AND   BKG_NO IS NOT NULL
    AND   BAT_FLG    NOT IN ('Z','X' ) -- Z : 중복실행 방지 Flag, X : BDR Update Flag
    GROUP BY A.CRE_USR_ID, A.COMM_TP_CD, A.BAT_DESC, A.BAT_ITM_NM
)
WHERE 1=1
AND   COM_CNT <> TOT_BKG_CNT
ORDER BY CRE_DT,CRE_USR_ID			]]></sql>
			<params>
			</params>
		</query>
	</querys>
</sqls>
