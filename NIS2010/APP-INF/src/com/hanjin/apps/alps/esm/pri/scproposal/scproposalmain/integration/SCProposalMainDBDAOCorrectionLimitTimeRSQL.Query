<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCProposalMainDBDAOCorrectionLimitTimeRSQL">
			<desc><![CDATA[* 2017.04.11 송민석 처음 생성
* 2017.11.28 송민석 [CSR-2620] 체크기간을 48시간에서 10일로 변경함]]></desc>
			<sql><![CDATA[
/* 10day 기준으로 변경함. 10일 기간중 종료 날짜가 주말일경우 48시간을 더 늘려줌 */
SELECT trunc(((86400*(DATE_AFTER_10DAY-US_EST_SYS_DT))/60)/60)  etc1
    ,trunc((86400*(DATE_AFTER_10DAY-US_EST_SYS_DT))/60)-(trunc(((86400*(DATE_AFTER_10DAY-US_EST_SYS_DT))/60)/60)*60) etc2
  FROM (
        SELECT GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC('NYCSC') US_EST_SYS_DT --현재 미 동부 시간 filing 기준  
              ,DATE_AFTER_10DAY        
          FROM (         
                SELECT 
                     CASE 
                       WHEN AFTER_10_DATE = '1' OR AFTER_10_DATE = '7' 
                           THEN AFTER_10DAY_DT + 2 --주말이 중간에 있는 경우 2일 추가
                       ELSE
                           FMC_FILE_CFM_DT + 10 -- 기본은 filing 날짜 + 10일 추가
                     END AS DATE_AFTER_10DAY          
                 FROM(SELECT TO_CHAR(MAX(FMC_FILE_CFM_DT), 'D') CFM_DAY
                            ,TO_CHAR(MAX(FMC_FILE_CFM_DT) + 10, 'D') AFTER_10_DATE 
                            ,MAX(FMC_FILE_CFM_DT) FMC_FILE_CFM_DT
                            ,MAX(FMC_FILE_CFM_DT) + 10 AFTER_10DAY_DT
                       FROM  PRI_SP_FILE_PROG     A1
                      WHERE PROP_NO = @[prop_no]
                        AND AMDT_SEQ = @[amdt_seq]
                      )
               ) 
        )


/* 기존 48시간 기준 쿼리
SELECT trunc(((86400*(DATE_AFTER_48-US_EST_SYS_DT))/60)/60)  etc1
    ,trunc((86400*(DATE_AFTER_48-US_EST_SYS_DT))/60)-(trunc(((86400*(DATE_AFTER_48-US_EST_SYS_DT))/60)/60)*60) etc2
  FROM (
        SELECT GLOBALDATE_PKG.TIME_LOCAL_OFC_FNC('NYCSC') US_EST_SYS_DT --현재 미 동부 시간 filing 기준  
              ,DATE_AFTER_48        
          FROM (         
                SELECT 
                     CASE 
                       WHEN CFM_DAY = '1' 
                           THEN TO_DATE(TO_CHAR(FMC_FILE_CFM_DT +0 + 2 , 'YYYY-MM-DD') || '23:59:59', 'YYYY-MM-DD HH24:MI:SS') --일요일 filing 이면 화요일 23:59:59까지
                       WHEN CFM_DAY = '7'   
                           THEN TO_DATE(TO_CHAR(FMC_FILE_CFM_DT +1 + 2 , 'YYYY-MM-DD') || '23:59:59', 'YYYY-MM-DD HH24:MI:SS') --토요일 filing 이면 화요일 23:59:59 까지    
                       WHEN AFTER_48_DAY = '1' OR AFTER_48_DAY = '7' 
                           THEN AFTER_48_DT + 2 --주말이 중간에 있는 경우 2일 추가
                       ELSE
                           FMC_FILE_CFM_DT + 2 -- 기본은 filing 날짜 + 2일 추가
                     END AS DATE_AFTER_48          
                 FROM(SELECT TO_CHAR(MAX(FMC_FILE_CFM_DT), 'D') CFM_DAY
                            ,TO_CHAR(MAX(FMC_FILE_CFM_DT) + 2, 'D') AFTER_48_DAY 
                            ,MAX(FMC_FILE_CFM_DT) FMC_FILE_CFM_DT
                            ,MAX(FMC_FILE_CFM_DT) + 2 AFTER_48_DT
                       FROM  PRI_SP_FILE_PROG     A1
                      WHERE PROP_NO = [prop_no]
                        AND AMDT_SEQ = [amdt_seq]
                      )
               ) 
        )
*/			]]></sql>
			<params>
				<param name="prop_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
