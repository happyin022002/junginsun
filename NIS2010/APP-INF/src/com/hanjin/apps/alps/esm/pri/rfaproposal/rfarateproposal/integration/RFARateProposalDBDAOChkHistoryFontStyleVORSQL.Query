<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RFARateProposalDBDAOChkHistoryFontStyleVORSQL">
			<desc><![CDATA[Rate의 General(CY)와 IHC의 FONT STYLE를 조회합니다. (History)]]></desc>
			<sql><![CDATA[
WITH G1 AS
 (SELECT 'G' INTG_CD_VAL_CTNT
    FROM DUAL
  UNION ALL
  SELECT 'A' INTG_CD_VAL_CTNT FROM DUAL)
SELECT INTG_CD_VAL_CTNT,
       TOT_CNT,
       decode(INTG_CD_VAL_CTNT, 'G', CASE
                 WHEN AMDT_CNT = ACPT_CNT AND AMDT_CNT > 0 THEN
                  'blue'
                 ELSE
                  'nothing'
               end, CASE
                 WHEN AMDT_CNT = ACPT_CNT AND AMDT_CNT > 0 THEN
                  'blue'
                 ELSE
                  'nothing'
               end) FONT_STYLE
  FROM (SELECT G1.INTG_CD_VAL_CTNT,
               NVL(C.ACPT_CNT, 0) + NVL(C.NOT_ACPT_CNT, 0) AS RATE_CNT,
               NVL(C.AMDT_CNT, 0) AS AMDT_CNT,
               NVL(ACPT_CNT, 0) AS ACPT_CNT,
               NVL(NOT_ACPT_CNT, 0) AS NOT_ACPT_CNT,
               CASE
                 WHEN C.AMDT_CNT > 0 THEN
                  'Y'
                 ELSE
                  'N'
               END AS AMDT_FLG,
               DECODE(NOT_ACPT_CNT, 0, 'Y', 'N') AS ACPT_FLG,
               (SELECT COUNT(*)
                  FROM PRI_RP_SCP_RT_CMDT_HDR H
                 WHERE H.PROP_NO = @[prop_no]
                       AND H.AMDT_SEQ = @[amdt_seq]
                       AND H.SVC_SCP_CD = @[svc_scp_cd]
                       AND NVL(H.FIC_RT_TP_CD, 'G') = G1.INTG_CD_VAL_CTNT) TOT_CNT
          FROM (SELECT FIC_RT_TP_CD,
                       COUNT(N1ST_CMNC_AMDT_SEQ) AS AMDT_CNT,
                       SUM(DECODE(PRC_PROG_STS_CD, 'A', 1, 0)) AS ACPT_CNT,
                       SUM(DECODE(PRC_PROG_STS_CD, 'A', 0, 1)) AS NOT_ACPT_CNT
                  FROM (SELECT B.PROP_NO,
                               B.AMDT_SEQ,
                               B.SVC_SCP_CD,
                               NVL(A.FIC_RT_TP_CD, 'G') FIC_RT_TP_CD,
                               B.N1ST_CMNC_AMDT_SEQ,
                               B.PRC_PROG_STS_CD
                          FROM PRI_RP_SCP_RT_CMDT_HDR A,
                               PRI_RP_SCP_RT_CMDT     B
                         WHERE A.PROP_NO = @[prop_no]
                               AND A.AMDT_SEQ = @[amdt_seq]
                               AND A.SVC_SCP_CD = @[svc_scp_cd]
                               AND A.PROP_NO = B.PROP_NO
                               AND A.AMDT_SEQ = B.AMDT_SEQ
                               AND A.SVC_SCP_CD = B.SVC_SCP_CD
                               AND A.CMDT_HDR_SEQ = B.CMDT_HDR_SEQ
                               AND B.N1ST_CMNC_AMDT_SEQ = @[amdt_seq]
                        UNION ALL
                        SELECT B.PROP_NO,
                               B.AMDT_SEQ,
                               B.SVC_SCP_CD,
                               NVL(A.FIC_RT_TP_CD, 'G') FIC_RT_TP_CD,
                               B.N1ST_CMNC_AMDT_SEQ,
                               B.PRC_PROG_STS_CD
                          FROM PRI_RP_SCP_RT_CMDT_HDR A,
                               PRI_RP_SCP_RT_CNOTE    B
                         WHERE A.PROP_NO = B.PROP_NO
                               AND A.AMDT_SEQ = B.AMDT_SEQ
                               AND A.SVC_SCP_CD = B.SVC_SCP_CD
                               AND A.CMDT_HDR_SEQ = B.CMDT_HDR_SEQ
                               AND A.PROP_NO = @[prop_no]
                               AND A.AMDT_SEQ = @[amdt_seq]
                               AND A.SVC_SCP_CD = @[svc_scp_cd]
                               AND B.N1ST_CMNC_AMDT_SEQ = @[amdt_seq]
                        UNION ALL
                        SELECT B.PROP_NO,
                               B.AMDT_SEQ,
                               B.SVC_SCP_CD,
                               NVL(A.FIC_RT_TP_CD, 'G') FIC_RT_TP_CD,
                               B.N1ST_CMNC_AMDT_SEQ,
                               B.PRC_PROG_STS_CD
                          FROM PRI_RP_SCP_RT_CMDT_HDR A,
                               PRI_RP_SCP_RT_ACT_CUST B
                         WHERE A.PROP_NO = B.PROP_NO
                               AND A.AMDT_SEQ = B.AMDT_SEQ
                               AND A.SVC_SCP_CD = B.SVC_SCP_CD
                               AND A.CMDT_HDR_SEQ = B.CMDT_HDR_SEQ
                               AND A.PROP_NO = @[prop_no]
                               AND A.AMDT_SEQ = @[amdt_seq]
                               AND A.SVC_SCP_CD = @[svc_scp_cd]
                               AND B.N1ST_CMNC_AMDT_SEQ = @[amdt_seq]
                        UNION ALL
                        SELECT B.PROP_NO,
                               B.AMDT_SEQ,
                               B.SVC_SCP_CD,
                               NVL(A.FIC_RT_TP_CD, 'G') FIC_RT_TP_CD,
                               C.N1ST_CMNC_AMDT_SEQ,
                               C.PRC_PROG_STS_CD
                          FROM PRI_RP_SCP_RT_CMDT_HDR  A,
                               PRI_RP_SCP_RT_CMDT_ROUT B,
                               PRI_RP_SCP_RT_ROUT_PNT  C
                         WHERE A.PROP_NO = B.PROP_NO
                               AND A.AMDT_SEQ = B.AMDT_SEQ
                               AND A.SVC_SCP_CD = B.SVC_SCP_CD
                               AND A.CMDT_HDR_SEQ = B.CMDT_HDR_SEQ
                               AND B.PROP_NO = C.PROP_NO
                               AND B.AMDT_SEQ = C.AMDT_SEQ
                               AND B.SVC_SCP_CD = C.SVC_SCP_CD
                               AND B.CMDT_HDR_SEQ = C.CMDT_HDR_SEQ
                               AND B.ROUT_SEQ = C.ROUT_SEQ
                               AND A.PROP_NO = @[prop_no]
                               AND A.AMDT_SEQ = @[amdt_seq]
                               AND A.SVC_SCP_CD = @[svc_scp_cd]
                               AND C.N1ST_CMNC_AMDT_SEQ = @[amdt_seq]
                        UNION ALL
                        SELECT B.PROP_NO,
                               B.AMDT_SEQ,
                               B.SVC_SCP_CD,
                               NVL(A.FIC_RT_TP_CD, 'G') FIC_RT_TP_CD,
                               C.N1ST_CMNC_AMDT_SEQ,
                               C.PRC_PROG_STS_CD
                          FROM PRI_RP_SCP_RT_CMDT_HDR  A,
                               PRI_RP_SCP_RT_CMDT_ROUT B,
                               PRI_RP_SCP_RT_ROUT_VIA  C
                         WHERE A.PROP_NO = B.PROP_NO
                               AND A.AMDT_SEQ = B.AMDT_SEQ
                               AND A.SVC_SCP_CD = B.SVC_SCP_CD
                               AND A.CMDT_HDR_SEQ = B.CMDT_HDR_SEQ
                               AND B.PROP_NO = C.PROP_NO
                               AND B.AMDT_SEQ = C.AMDT_SEQ
                               AND B.SVC_SCP_CD = C.SVC_SCP_CD
                               AND B.CMDT_HDR_SEQ = C.CMDT_HDR_SEQ
                               AND B.ROUT_SEQ = C.ROUT_SEQ
                               AND A.PROP_NO = @[prop_no]
                               AND A.AMDT_SEQ = @[amdt_seq]
                               AND A.SVC_SCP_CD = @[svc_scp_cd]
                               AND C.N1ST_CMNC_AMDT_SEQ = @[amdt_seq]
                        UNION ALL
                        SELECT B.PROP_NO,
                               B.AMDT_SEQ,
                               B.SVC_SCP_CD,
                               NVL(A.FIC_RT_TP_CD, 'G') FIC_RT_TP_CD,
                               C.N1ST_CMNC_AMDT_SEQ,
                               C.PRC_PROG_STS_CD
                          FROM PRI_RP_SCP_RT_CMDT_HDR  A,
                               PRI_RP_SCP_RT_CMDT_ROUT B,
                               PRI_RP_SCP_RT           C
                         WHERE A.PROP_NO = B.PROP_NO
                               AND A.AMDT_SEQ = B.AMDT_SEQ
                               AND A.SVC_SCP_CD = B.SVC_SCP_CD
                               AND A.CMDT_HDR_SEQ = B.CMDT_HDR_SEQ
                               AND B.PROP_NO = C.PROP_NO
                               AND B.AMDT_SEQ = C.AMDT_SEQ
                               AND B.SVC_SCP_CD = C.SVC_SCP_CD
                               AND B.CMDT_HDR_SEQ = C.CMDT_HDR_SEQ
                               AND B.ROUT_SEQ = C.ROUT_SEQ
                               AND A.PROP_NO = @[prop_no]
                               AND A.AMDT_SEQ = @[amdt_seq]
                               AND A.SVC_SCP_CD = @[svc_scp_cd]
                               AND C.N1ST_CMNC_AMDT_SEQ = @[amdt_seq]
                        UNION ALL
                        SELECT B.PROP_NO,
                               B.AMDT_SEQ,
                               B.SVC_SCP_CD,
                               NVL(A.FIC_RT_TP_CD, 'G') FIC_RT_TP_CD,
                               C.N1ST_CMNC_AMDT_SEQ,
                               C.PRC_PROG_STS_CD
                          FROM PRI_RP_SCP_RT_CMDT_HDR   A,
                               PRI_RP_SCP_RT_CMDT_ROUT  B,
                               PRI_RP_SCP_RT_CMDT_RNOTE C
                         WHERE A.PROP_NO = B.PROP_NO
                               AND A.AMDT_SEQ = B.AMDT_SEQ
                               AND A.SVC_SCP_CD = B.SVC_SCP_CD
                               AND A.CMDT_HDR_SEQ = B.CMDT_HDR_SEQ
                               AND B.PROP_NO = C.PROP_NO
                               AND B.AMDT_SEQ = C.AMDT_SEQ
                               AND B.SVC_SCP_CD = C.SVC_SCP_CD
                               AND B.CMDT_HDR_SEQ = C.CMDT_HDR_SEQ
                               AND B.ROUT_SEQ = C.ROUT_SEQ
                               AND A.PROP_NO = @[prop_no]
                               AND A.AMDT_SEQ = @[amdt_seq]
                               AND A.SVC_SCP_CD = @[svc_scp_cd]
                               AND C.N1ST_CMNC_AMDT_SEQ = @[amdt_seq]) G
                 GROUP BY PROP_NO,
                          AMDT_SEQ,
                          SVC_SCP_CD,
                          FIC_RT_TP_CD) C,
               G1
         WHERE G1.INTG_CD_VAL_CTNT = C.FIC_RT_TP_CD(+)
         ORDER BY FIC_RT_TP_CD)			]]></sql>
			<params>
				<param name="prop_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="12" value="" out="N"/>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
