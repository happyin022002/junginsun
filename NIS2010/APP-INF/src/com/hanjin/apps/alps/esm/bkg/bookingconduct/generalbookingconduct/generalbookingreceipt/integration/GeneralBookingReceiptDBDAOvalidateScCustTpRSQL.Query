<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingReceiptDBDAOvalidateScCustTpRSQL">
			<desc><![CDATA[GeneralBookingReceiptDBDAOvalidateScCustTp]]></desc>
			<sql><![CDATA[
SELECT SUM(CNT) AS CNT
FROM (
#if (${rf_flg} == 'S') 
        SELECT COUNT(1) AS CNT 
          FROM PRI_SP_CTRT_CUST_TP 
         WHERE ( PROP_NO,AMDT_SEQ ) IN (
	#if (${ca_flg} != 'Y') 
                                         SELECT MAX(SP.PROP_NO) PROP_NO, MAX(AMDT_SEQ) AMDT_SEQ
                                           FROM BKG_BOOKING BKG, PRI_SP_HDR HDR, PRI_SP_MN SP
                                          WHERE BKG.BKG_NO  = @[bkg_no]
                                            AND BKG.SC_NO   = HDR.SC_NO
                                            AND HDR.PROP_NO = SP.PROP_NO 
                                            AND BKG.CMDT_CD IN ('000004', '000002')
	#else
                                         SELECT MAX(SP.PROP_NO) PROP_NO, MAX(AMDT_SEQ) AMDT_SEQ
                                           FROM BKG_BKG_HIS BKG, PRI_SP_HDR HDR, PRI_SP_MN SP
                                          WHERE BKG.BKG_NO  = @[bkg_no]
                                            AND BKG.CORR_NO = 'TMP0000001'
                                            AND BKG.SC_NO   = HDR.SC_NO
                                            AND HDR.PROP_NO = SP.PROP_NO 
                                            AND BKG.CMDT_CD IN ('000004', '000002')
	#end
																		  )
           AND PRC_CTRT_CUST_TP_CD = 'I'
#else
	#if (${ca_flg} != 'Y')
        SELECT COUNT(1) AS CNT
          FROM BKG_BOOKING BKG, MDM_CUSTOMER MDM, BKG_CUSTOMER CUST
        WHERE BKG.BKG_NO 		  = @[bkg_no]
          AND BKG.BKG_NO 		  = CUST.BKG_NO
          AND CUST.BKG_CUST_TP_CD = 'S'
          AND CUST.CUST_CNT_CD 	  = MDM.CUST_CNT_CD
          AND CUST.CUST_SEQ 	  = MDM.CUST_SEQ
		  AND BKG.RFA_NO 		  IS NOT NULL
          AND BKG.CMDT_CD 		  IN ('000004', '000002')
          AND MDM.RVIS_CNTR_CUST_TP_CD = 'B'
	#else
        SELECT COUNT(1) AS CNT
          FROM BKG_BKG_HIS BKG, MDM_CUSTOMER MDM, BKG_CUST_HIS CUST
        WHERE BKG.BKG_NO  		  = @[bkg_no]
          AND BKG.CORR_NO 		  = 'TMP0000001'
          AND BKG.BKG_NO 		  = CUST.BKG_NO
          AND BKG.CORR_NO 		  = CUST.CORR_NO
          AND CUST.BKG_CUST_TP_CD = 'S'
          AND CUST.CUST_CNT_CD 	  = MDM.CUST_CNT_CD
          AND CUST.CUST_SEQ 	  = MDM.CUST_SEQ
		  AND BKG.RFA_NO 		  IS NOT NULL
          AND BKG.CMDT_CD 		  IN ('000004', '000002')
          AND MDM.RVIS_CNTR_CUST_TP_CD = 'B'
	#end
#end
      )			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
