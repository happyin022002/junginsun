<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="OPMasterDBDAOMultiHistoryLaneCSQL">
			<desc><![CDATA[MultiHistoryLane INSERT
History -----------------------------------------------------------------
2010.06.17 이행지 Lane History Insert시 Seq를 기존 DB에서 MAX+1 하던 것을 화면상의 Seq로 대체해서 저장하도록 변경
2016.03.03 Create Lane Table, Create Vessel Table history 자동 관리]]></desc>
			<sql><![CDATA[
#if (${auto_flg} == 'Y')
MERGE INTO MAS_LANE_TP_HIS B
USING ( SELECT TRD_CD, RLANE_CD, DIR_CD, LANE_APLY_FM_DT
    FROM MAS_LANE_TP_HIS 
    WHERE TRD_CD = @[trd_cd]
    AND RLANE_CD = @[rlane_cd]
    AND DIR_CD = @[dir_cd]
    AND LANE_SEQ = (SELECT MAX(LANE_SEQ) 
                    FROM MAS_LANE_TP_HIS 
                    WHERE TRD_CD = @[trd_cd]
                    AND RLANE_CD = @[rlane_cd]
                    AND DIR_CD = @[dir_cd] )
    ) A
ON ( A.TRD_CD = B.TRD_CD
AND A.RLANE_CD = B.RLANE_CD
AND A.DIR_CD = B.DIR_CD
AND B.LANE_SEQ = (SELECT MAX(LANE_SEQ) 
                    FROM MAS_LANE_TP_HIS 
                    WHERE TRD_CD = @[trd_cd]
                    AND RLANE_CD = @[rlane_cd]
                    AND DIR_CD = @[dir_cd] )
AND A.TRD_CD = @[trd_cd]
AND A.RLANE_CD = @[rlane_cd]
AND A.DIR_CD = @[dir_cd]
AND A.LANE_APLY_FM_DT = TO_CHAR(SYSDATE, 'YYYYMMDD'))
WHEN MATCHED THEN
UPDATE SET VSL_LANE_TP_CD = @[vsl_lane_tp_cd]
, STUP_FLG = DECODE(@[stup_flg], '0', 'N', '1', 'Y', @[stup_flg])
, UPD_USR_ID = @[upd_usr_id]
, UPD_DT = SYSDATE
, OP_LANE_TP_CD = @[op_lane_tp_cd]
WHEN NOT MATCHED THEN
INSERT (
      TRD_CD
     ,RLANE_CD
     ,DIR_CD
     ,IOC_CD
     ,LANE_SEQ
     ,VSL_LANE_TP_CD
     ,STUP_FLG
     ,VVD_CD
     ,LANE_APLY_FM_DT
     ,LANE_APLY_TO_DT
     ,CRE_USR_ID
     ,CRE_DT
     ,UPD_USR_ID
     ,UPD_DT
     ,OP_LANE_TP_CD
)VALUES(
      @[trd_cd]
     ,@[rlane_cd]
     ,@[dir_cd]
     ,@[ioc_cd]
     ,(SELECT NVL(MAX(LANE_SEQ)+1, 1) FROM MAS_LANE_TP_HIS WHERE TRD_CD = @[trd_cd] AND RLANE_CD = @[rlane_cd] AND DIR_CD = @[dir_cd] AND IOC_CD = @[ioc_cd])
     ,@[vsl_lane_tp_cd]
     ,DECODE(@[stup_flg], '0', 'N', '1', 'Y', @[stup_flg])
     ,NULL
     ,TO_CHAR(SYSDATE, 'YYYYMMDD')
     ,'99991231'
     ,@[upd_usr_id]
     ,SYSDATE
     ,@[upd_usr_id]
     ,SYSDATE
     ,@[op_lane_tp_cd]
)
#else
INSERT INTO MAS_LANE_TP_HIS (
      TRD_CD
     ,RLANE_CD
     ,DIR_CD
     ,IOC_CD
     ,LANE_SEQ
     ,VSL_LANE_TP_CD
     ,STUP_FLG
     ,VVD_CD
     ,LANE_APLY_FM_DT
     ,LANE_APLY_TO_DT
     ,CRE_USR_ID
     ,CRE_DT
     ,UPD_USR_ID
     ,UPD_DT
     ,OP_LANE_TP_CD
)VALUES(
      @[trd_cd]
     ,@[rlane_cd]
     ,@[dir_cd]
     ,@[ioc_cd]
     ,@[lane_seq]
     ,@[vsl_lane_tp_cd]
     ,DECODE(@[stup_flg], '0', 'N', '1', 'Y', @[stup_flg])
     ,@[vvd_cd]
     ,@[lane_aply_fm_dt]
     ,@[lane_aply_to_dt]
     ,@[cre_usr_id]
     ,SYSDATE
     ,@[upd_usr_id]
     ,SYSDATE
     ,@[op_lane_tp_cd]
)
#end			]]></sql>
			<params>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
				<param name="vsl_lane_tp_cd" type="12" value="" out="N"/>
				<param name="stup_flg" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="op_lane_tp_cd" type="12" value="" out="N"/>
				<param name="ioc_cd" type="12" value="" out="N"/>
				<param name="lane_seq" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="lane_aply_fm_dt" type="12" value="" out="N"/>
				<param name="lane_aply_to_dt" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
