<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UnmatchBLDBDAOCheckOihDihRatAsQtyRSQL">
			<desc><![CDATA[India지역 AutoRating 후 OIH, DIH Manual 입력시 Rate As Qty를 제대로 입력했는지 여부 판단]]></desc>
			<sql><![CDATA[
SELECT  DECODE(
            DECODE(OFT_RAT_AS_QTY1, NVL(OIH_RAT_AS_QTY1,OFT_RAT_AS_QTY1), 0, 1) +
            DECODE(OFT_RAT_AS_QTY1, NVL(DIH_RAT_AS_QTY1,OFT_RAT_AS_QTY1), 0, 1) +
            DECODE(OFT_RAT_AS_QTY2, NVL(OIH_RAT_AS_QTY2,OFT_RAT_AS_QTY2), 0, 1) +
            DECODE(OFT_RAT_AS_QTY2, NVL(DIH_RAT_AS_QTY2,OFT_RAT_AS_QTY2), 0, 1) , 0, 'Y', 'N') IH_PASS
FROM
(
    SELECT 
           (
            SELECT  SUM(NVL(RAT_AS_QTY,0))
            FROM    BKG_CHG_RT
            WHERE   BKG_NO        = @[bkg_no]
            AND     @[ca_flg]     = 'N'
            AND     CHG_CD = 'OFT'
           ) OFT_RAT_AS_QTY1,
           (
            SELECT  SUM(NVL(RAT_AS_QTY,0))
            FROM    BKG_CHG_RT
            WHERE   BKG_NO        = @[bkg_no]
            AND     @[ca_flg]     = 'N'
            AND     CHG_CD = 'OIH'
           ) OIH_RAT_AS_QTY1,
           (
            SELECT  SUM(NVL(RAT_AS_QTY,0))
            FROM    BKG_CHG_RT
            WHERE   BKG_NO        = @[bkg_no]
            AND     @[ca_flg]     = 'N'
            AND     CHG_CD = 'DIH'
           ) DIH_RAT_AS_QTY1,
           (
            SELECT  SUM(NVL(RAT_AS_QTY,0))
            FROM    BKG_CHG_RT_HIS
            WHERE   BKG_NO        = @[bkg_no]
            AND     CORR_NO       = 'TMP0000001'  -- CORRECTION 중인 DATA 를 나타내는 고정된 상수값
            AND     @[ca_flg]     = 'Y'
            AND     CHG_CD = 'OFT'
           ) OFT_RAT_AS_QTY2,
           (
            SELECT  SUM(NVL(RAT_AS_QTY,0))
            FROM    BKG_CHG_RT_HIS
            WHERE   BKG_NO        = @[bkg_no]
            AND     CORR_NO       = 'TMP0000001'  -- CORRECTION 중인 DATA 를 나타내는 고정된 상수값
            AND     @[ca_flg]     = 'Y'
            AND     CHG_CD = 'OIH'
           ) OIH_RAT_AS_QTY2,
           (
            SELECT  SUM(NVL(RAT_AS_QTY,0))
            FROM    BKG_CHG_RT_HIS
            WHERE   BKG_NO        = @[bkg_no]
            AND     CORR_NO       = 'TMP0000001'  -- CORRECTION 중인 DATA 를 나타내는 고정된 상수값
            AND     @[ca_flg]     = 'Y'
            AND     CHG_CD = 'DIH'
           ) DIH_RAT_AS_QTY2
    FROM   DUAL
)
			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="ca_flg" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
