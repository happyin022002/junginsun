<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UnmatchBLDBDAOFilteredUnmatchBkgCountRSQL">
			<desc><![CDATA[~ 2017/03/27   : Filterd Bkg count
2017/03/28 ~   : Total Bkg Count (by Application date)
2017/05/18 ~   : Total Bkg Count (by Port Closing Date)]]></desc>
			<sql><![CDATA[
SELECT    COUNT(BK.BKG_NO) AS BKG_COUNT
    FROM      BKG_BOOKING BK
            , BKG_RATE BR
            , BKG_BL_DOC DOC
            , BKG_VVD VVD
            , VSK_VSL_PORT_SKD VPS
            , (
               SELECT  /*+ NO_MERGE */ LVL.* 
                 FROM BKG_OFC_LVL_V  LVL 
                WHERE 1=1
#if (${rct_rhq_cd} != '')
                  AND LVL.REGION = @[rct_rhq_cd]
#end
              ) LVL
    WHERE   BK.BKG_NO            = BR.BKG_NO
    AND     BK.BKG_NO            = DOC.BKG_NO(+)
    AND     BK.POL_CD            = VVD.POL_CD
    AND     BK.BKG_NO            = VVD.BKG_NO
    AND     VPS.VSL_CD           = VVD.VSL_CD
    AND     VPS.SKD_VOY_NO       = VVD.SKD_VOY_NO
    AND     VPS.SKD_DIR_CD       = VVD.SKD_DIR_CD
    AND     VPS.CLPT_IND_SEQ     = VVD.POL_CLPT_IND_SEQ
    AND	    VPS.VPS_PORT_CD      = VVD.POL_CD
    AND     BK.BKG_OFC_CD        = LVL.OFC_CD
    AND     BK.BKG_CGO_TP_CD    = 'F'
    AND     BK.PORT_CLZ_DT BETWEEN TO_DATE(@[rt_aply_dt_from],'YYYY-MM-DD') AND TO_DATE(@[rt_aply_dt_to],'YYYY-MM-DD') + 0.99999
    AND     3 = (SELECT COUNT(*) FROM BKG_CUSTOMER WHERE BKG_NO = BK.BKG_NO AND BKG_CUST_TP_CD IN ('S', 'C', 'N'))
#if (${rct_ofc_cd} != '') 
    AND     BK.BKG_OFC_CD = @[rct_ofc_cd]
#end
#if (${conti_cd} != '')
    AND     BK.POR_CD  IN (SELECT LOC_CD FROM MDM_LOCATION WHERE CONTI_CD=@[conti_cd])
#end
#if (${conti_cd2} != '')
    AND     BK.DEL_CD IN(SELECT LOC_CD FROM MDM_LOCATION WHERE CONTI_CD=@[conti_cd2])
#end
#if (${vvd_cd} != '') 
    AND     VVD.VSL_CD		= SUBSTR(@[vvd_cd],1,4)
    AND		VVD.SKD_VOY_NO	= SUBSTR(@[vvd_cd],5,4)
    AND		VVD.SKD_DIR_CD	= SUBSTR(@[vvd_cd],9,1)
#end
#if (${bkg_ctrt_tp_cd} != '') 
    AND     BR.BKG_CTRT_TP_CD = @[bkg_ctrt_tp_cd]
#end
#if (${bdr_status_cd} != '')
    AND 	DOC.BDR_FLG = @[bdr_status_cd]
#end
#if (${rater_id} != '')
    AND	    BR.UPD_USR_ID LIKE @[rater_id] || '%'
#end
#if (${contract_no} != '') 
    AND     DECODE(BR.BKG_CTRT_TP_CD, 'T', BK.TAA_NO, 'R', BK.RFA_NO, 'S', BK.SC_NO) = @[contract_no]
#end			]]></sql>
			<params>
				<param name="rct_rhq_cd" type="12" value="" out="N"/>
				<param name="rt_aply_dt_from" type="12" value="" out="N"/>
				<param name="rt_aply_dt_to" type="12" value="" out="N"/>
				<param name="rct_ofc_cd" type="12" value="" out="N"/>
				<param name="conti_cd" type="12" value="" out="N"/>
				<param name="conti_cd2" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="bkg_ctrt_tp_cd" type="12" value="" out="N"/>
				<param name="bdr_status_cd" type="12" value="" out="N"/>
				<param name="rater_id" type="12" value="" out="N"/>
				<param name="contract_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
