<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="FeederChargeGuideLineDBDAOSearchFDRMainRSQL">
			<desc><![CDATA[Search FDR Main
2013.02.27 전윤주 [CHM-201323352] creation, confirm staff 이름이 보이도록 수정 ]]></desc>
			<sql><![CDATA[
WITH MAX_FDR AS (
    SELECT HDR.FDR_TRF_NO
         , MAX(MN.AMDT_SEQ) AMDT_SEQ
      FROM PRI_TRF_FDR_MN MN
         , (    SELECT MAX(FDR_TRF_NO) FDR_TRF_NO
                  FROM PRI_TRF_FDR_HDR
                 WHERE 1=1
                   AND SVC_SCP_CD   = @[svc_scp_cd]
                   AND ORG_DEST_TP_CD = @[org_dest_tp_cd]
                   AND RHQ_CD = @[rhq_cd]
           ) HDR
     WHERE 1=1
       AND MN.FDR_TRF_NO = HDR.FDR_TRF_NO
       AND MN.ORG_DEST_TP_CD = @[org_dest_tp_cd]
     GROUP BY HDR.FDR_TRF_NO
)

SELECT MN.SVC_SCP_CD
     , MN.ORG_DEST_TP_CD
     , MN.FDR_TRF_NO
     , MN.AMDT_SEQ
     , TO_CHAR(MN.CRE_DT,'YYYYMMDD') CRE_DT
     , TO_CHAR(MN.EFF_DT,'YYYYMMDD') EFF_DT
     , TO_CHAR(MN.EXP_DT,'YYYYMMDD') EXP_DT
     , TO_CHAR(MN.CFM_DT,'YYYYMMDD') CFM_DT
     , MN.FIC_PROP_STS_CD
	 , (SELECT INTG_CD_VAL_DP_DESC 
          FROM COM_INTG_CD_DTL 
         WHERE INTG_CD_ID = 'CD03045' 
           AND INTG_CD_VAL_CTNT = MN.FIC_PROP_STS_CD) FIC_PROP_STS_NM
     , MN.TRF_CURR_CD
     , MN.LOCL_CURR_CD      
     , DECODE((SELECT USR_NM FROM COM_USER WHERE USR_ID = MN.CFM_USR_ID) || ' / ' || MN.CFM_OFC_CD,' / ', ''
             ,(SELECT USR_NM FROM COM_USER WHERE USR_ID = MN.CFM_USR_ID) || ' / ' || MN.CFM_OFC_CD ) AS CFM_USR 
     , MN.CFM_OFC_CD
     , MN.CFM_USR_ID
     , DECODE((SELECT USR_NM FROM COM_USER WHERE USR_ID = MN.CRE_USR_ID) || ' / ' || MN.CRE_OFC_CD,' / ', ''
             ,(SELECT USR_NM FROM COM_USER WHERE USR_ID = MN.CRE_USR_ID) || ' / ' || MN.CRE_OFC_CD )AS CRE_USR
     , MN.CRE_USR_ID
     , MN.UPD_USR_ID
     , MN.UPD_DT
     , MN.PRC_IO_BND_CD
     , (SELECT COUNT(*)
          FROM TRS_FDR_DG_COST_TRF
         WHERE 1=1
           AND COST_TRF_NO  = (SELECT FDR_COST_TRF_NO
                                 FROM PRI_TRF_FDR_COST_VER_MAPG
                                WHERE 1=1
                                  AND FDR_TRF_NO = SUB.FDR_TRF_NO
                                  AND SVC_SCP_CD = @[svc_scp_cd]
                                  AND ORG_DEST_TP_CD = @[org_dest_tp_cd] 
                              )
           AND ROWNUM = 1
       ) DG_COUNT
	 , '' AMDT_EFF
     , '' TOBE_AMDT_SEQ
     , '' RHQ_CD
     , '' MAX_COST_TRF_NO
     , '' CHECK_COST_TRF_NO
  FROM PRI_TRF_FDR_MN MN
     , MAX_FDR SUB
 WHERE 1 = 1
   AND MN.SVC_SCP_CD = @[svc_scp_cd]
   AND MN.ORG_DEST_TP_CD = @[org_dest_tp_cd]
   AND MN.AMDT_SEQ   = SUB.AMDT_SEQ
   AND MN.FDR_TRF_NO = SUB.FDR_TRF_NO			]]></sql>
			<params>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="org_dest_tp_cd" type="12" value="" out="N"/>
				<param name="rhq_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
