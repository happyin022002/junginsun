<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="KeyAccountKpiDBDAOModifyKpiUploadUSQL">
			<desc><![CDATA[ModifyKpiUpload
[CHM-201535626] (SQM) TPS 자리수 Validation]]></desc>
			<sql><![CDATA[
MERGE INTO SQM_KEY_ACCT_CFM_QTA X
USING  (
        SELECT
               @[bse_tp_cd] AS BSE_TP_CD
              ,@[bse_yr]    AS BSE_YR
              ,DECODE(@[bse_tp_cd], 'Y', '00', @[bse_qtr_cd])AS BSE_QTR_CD
              ,SUBSTR(@[acct_tgt_cd], 1, 1) AS ACCT_TGT_CD
              ,SUBSTR(@[trd_bnd_cd], 1, 3) AS TRD_CD
              ,DECODE( SUBSTR(@[trd_bnd_cd], 4, 1) , null, 'X', SUBSTR(@[trd_bnd_cd], 4, 1) ) AS DIR_CD
              ,DECODE( SUBSTR(@[trd_bnd_cd], 4, 1) , null, 'X', SUBSTR(@[trd_bnd_cd], 4, 1) ) AS CONV_DIR_CD
			  ,@[bse_wk]      AS BSE_WK
              ,@[cust_grp_id] AS CUST_GRP_ID
              ,@[lod_qty]     AS LOD_QTY
              ,@[ra_cmpb_amt] AS RA_CMPB_AMT
          FROM DUAL
        ) Y
ON (        X.BSE_TP_CD     = Y.BSE_TP_CD
        AND X.BSE_YR        = Y.BSE_YR
        AND X.BSE_QTR_CD    = Y.BSE_QTR_CD
        AND X.ACCT_TGT_CD   = Y.ACCT_TGT_CD
        AND X.TRD_CD        = Y.TRD_CD
        AND X.CONV_DIR_CD   = Y.CONV_DIR_CD
        AND X.CUST_GRP_ID   = Y.CUST_GRP_ID
		AND X.BSE_WK		= Y.BSE_WK

)
WHEN MATCHED THEN
    UPDATE SET
       X.LOD_QTY     = Y.LOD_QTY
      ,X.RA_CMPB_AMT = Y.RA_CMPB_AMT
      ,UPD_USR_ID    = @[upd_usr_id]
      ,UPD_DT        = SYSDATE
WHEN NOT MATCHED THEN
    INSERT (
             X.BSE_TP_CD
            ,X.BSE_YR
            ,X.BSE_QTR_CD
            ,X.ACCT_TGT_CD
            ,X.TRD_CD
            ,X.DIR_CD
            ,X.CONV_DIR_CD
			,X.BSE_WK
            ,X.CUST_GRP_ID
            ,X.LOD_QTY
            ,X.RA_CMPB_AMT
            ,X.CRE_USR_ID
            ,X.CRE_DT
            ,X.UPD_USR_ID
            ,X.UPD_DT
            )
    VALUES (
             Y.BSE_TP_CD
            ,Y.BSE_YR
            ,Y.BSE_QTR_CD
            ,Y.ACCT_TGT_CD
            ,Y.TRD_CD
            ,Y.DIR_CD
            ,Y.CONV_DIR_CD
			,Y.BSE_WK
            ,Y.CUST_GRP_ID
            ,Y.LOD_QTY
            ,Y.RA_CMPB_AMT
            ,@[cre_usr_id]
            ,SYSDATE
            ,@[upd_usr_id]
            ,SYSDATE
        )			]]></sql>
			<params>
				<param name="bse_tp_cd" type="12" value="" out="N"/>
				<param name="bse_yr" type="12" value="" out="N"/>
				<param name="bse_qtr_cd" type="12" value="" out="N"/>
				<param name="acct_tgt_cd" type="12" value="" out="N"/>
				<param name="trd_bnd_cd" type="12" value="" out="N"/>
				<param name="bse_wk" type="12" value="" out="N"/>
				<param name="cust_grp_id" type="12" value="" out="N"/>
				<param name="lod_qty" type="12" value="" out="N"/>
				<param name="ra_cmpb_amt" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
