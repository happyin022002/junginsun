<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EBookingReceiptDBDAOSearchXterPoMdtItmRSQL">
			<desc><![CDATA[PO NO 기준 ITEM 조회]]></desc>
			<sql><![CDATA[
SELECT SUBSTR(MAX(SYS_CONNECT_BY_PATH(ITEM, ',')), 2) AS PATH_ITEM
  FROM (SELECT ROWNUM AS RID, ITEM
          FROM (SELECT DISTINCT DTL.BKG_MDT_ITM_CD AS ITEM
                  FROM (SELECT MDT_ITM_SEQ
                          FROM (SELECT A1.BKG_NO,
                                       DECODE(A2.BKG_CUST_TP_CD,'S','SH','C','CN','N','NT','') AS MDT_CUST_TP_CD,
                                       NVL(A2.CUST_CNT_CD, '0') AS CUST_CNT_CD,
                                       NVL(A2.CUST_SEQ, '0') AS CUST_SEQ,
                                       NVL(A1.SC_NO, '0') AS SC_NO,
                                       NVL(A1.RFA_NO, '0') AS RFA_NO,
                                       NVL(A1.SVC_SCP_CD, '0') AS SVC_SCP_CD,
                                       NVL(A1.POR_CD, '0') AS POR_CD,
                                       NVL(A1.DEL_CD, '0') AS DEL_CD,
                                       NVL(A3.CUST_GRP_ID, '0') AS CUST_GRP_ID
                                  FROM --BKG_BOOKING  A1,
                                       (SELECT @[bkg_no] AS BKG_NO, @[sc_no] AS SC_NO, @[rfa_no] AS RFA_NO, 
                                               @[svc_scp_cd] AS SVC_SCP_CD, @[por_cd] AS POR_CD, @[del_cd] AS DEL_CD
                                       FROM DUAL) A1, 
                                       --BKG_CUSTOMER A2,
                                       (SELECT 'S' AS BKG_CUST_TP_CD, @[sh_cust_cnt_cd] AS CUST_CNT_CD, @[sh_cust_seq] AS CUST_SEQ
                                        FROM DUAL
                                        union all
                                        SELECT 'C' AS BKG_CUST_TP_CD, @[cn_cust_cnt_cd] AS CUST_CNT_CD, @[cn_cust_seq] AS CUST_SEQ
                                        FROM DUAL
                                        union all
                                        SELECT 'N' AS BKG_CUST_TP_CD, @[nf_cust_cnt_cd] AS CUST_CNT_CD, @[nf_cust_seq] AS CUST_SEQ
                                        FROM DUAL) A2,
                                       MDM_CUSTOMER A3
                                 WHERE 
                                       A2.CUST_CNT_CD = A3.CUST_CNT_CD
                                   AND A2.CUST_SEQ = A3.CUST_SEQ) B1,
                               (SELECT MDT_ITM_SEQ,
                                       DECODE(CUST_GRP_ID,
                                              'G',
                                              CUST_GRP_ID || '-' || CUST_CNT_CD ||
                                              LPAD(CUST_SEQ, 6, 0)) AS CUST_GRP_ID,
                                       MDT_CUST_TP_CD,
                                       CUST_CNT_CD,
                                       CUST_SEQ,
                                       SC_NO,
                                       RFA_NO,
                                       SVC_SCP_CD,
                                       POR_CD,
                                       DEL_CD
                                  FROM BKG_MDT_ITM) B2
                         WHERE 1 = 1
                           AND B1.MDT_CUST_TP_CD =
                               DECODE(B2.MDT_CUST_TP_CD,
                                      'Al',
                                      B1.MDT_CUST_TP_CD,
                                      B2.MDT_CUST_TP_CD)
                           AND B1.CUST_GRP_ID =
                               NVL(B2.CUST_GRP_ID, B1.CUST_GRP_ID)
                           AND B1.CUST_CNT_CD =
                               NVL(B2.CUST_CNT_CD, B1.CUST_CNT_CD)
                           AND B1.CUST_SEQ = NVL(B2.CUST_SEQ, B1.CUST_SEQ)
                           AND B1.SC_NO = NVL(B2.SC_NO, B1.SC_NO)
                           AND B1.RFA_NO = NVL(B2.RFA_NO, B1.RFA_NO)
                           AND B1.SVC_SCP_CD =
                               NVL(B2.SVC_SCP_CD, B1.SVC_SCP_CD)
                           AND B1.POR_CD LIKE B2.POR_CD || '%'
                           AND B1.DEL_CD LIKE B2.DEL_CD || '%') ITM,
                       BKG_MDT_ITM_DTL DTL
                 WHERE ITM.MDT_ITM_SEQ = DTL.MDT_ITM_SEQ))
 START WITH RID = 1
CONNECT BY PRIOR RID + 1 = RID			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
				<param name="rfa_no" type="12" value="" out="N"/>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="por_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
				<param name="sh_cust_cnt_cd" type="12" value="" out="N"/>
				<param name="sh_cust_seq" type="12" value="" out="N"/>
				<param name="cn_cust_cnt_cd" type="12" value="" out="N"/>
				<param name="cn_cust_seq" type="12" value="" out="N"/>
				<param name="nf_cust_cnt_cd" type="12" value="" out="N"/>
				<param name="nf_cust_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
