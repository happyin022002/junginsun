<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BlRatingDBDAOSearchApprovalRequestMailBodyRSQL">
			<desc><![CDATA[Approval Request 메일 내용을 조회합니다.(HTML형식으로 조회됨)
!!!! 주의 !!!!!
SQL 수정 후 반드시 java 파일 확인할것!
"  는 \" 으로 변경되어야 정상적으로 SQL이 실행됩니다!!!!]]></desc>
			<sql><![CDATA[
SELECT 
'<html>
<head>
<title></title>
</head>
'
||
#if (${mail_type} == 'Q') 
@[chg_cd]||' Charges for '||B.BKG_NO||' needs to be exempted as below reason.<br>
Please, review and approve if reasonable.<p>'
#end
#if(${mail_type} == 'A')
'Your request for '||@[chg_cd]||' exemption has been approved and '||@[chg_cd]||' deleted from ('||B.BKG_NO||') <p>'
#end
#if(${mail_type} == 'R')
'Your request for '||@[chg_cd]||' exemption has been rejected. So '||@[chg_cd]||' will not be deleted from ('||B.BKG_NO||') <p>'
#end
||
'Requestor : '||U.USR_NM ||' / '||U.OFC_CD||'<br>
BKG No : '||B.BKG_NO||'<br>
Shipper : '||S.CUST_CNT_CD||LPAD(S.CUST_SEQ,6,'0')||' '||MS.CUST_LGL_ENG_NM||'<br>
Consignee : '||C.CUST_CNT_CD||LPAD(C.CUST_SEQ,6,'0')||' '||MC.CUST_LGL_ENG_NM||'<br>
Contract No : '|| DECODE(R.BKG_CTRT_TP_CD,'S',B.SC_NO,'R',B.RFA_NO,'T',B.TAA_NO)||'<br>
C.Rep : '||B.CTRT_SREP_CD||' '||CR.OFC_CD||' / '||CR.SREP_NM||'<br>
L.Rep : '||B.OB_SREP_CD||' '||LR.OFC_CD||' / '||LR.SREP_NM||'<p>
Exemption Reason : '||V.INTG_CD_VAL_DESC||'<p>
Amend Amount<br>
<table border=\"1\" cellspacing=\"0\">
	<tr>
		<td width=\"50\" align=\"center\">Charge</td>
		<td width=\"50\" align=\"center\">Cur</td>
		<td width=\"50\" align=\"center\">Per </td>
		<td width=\"130\" align=\"center\">As-Is Amount</td>
		<td width=\"130\" align=\"center\">To-Be Amount</td>
		<td width=\"130\" align=\"center\">Diff</td>
	</tr>
' MAIL_BODY
FROM BKG_BOOKING B, BKG_RATE R,
     BKG_CHG_AMD_AUTH A, COM_INTG_CD_DTL V, 
     COM_USER U,
     BKG_CUSTOMER S, BKG_CUSTOMER C,
     MDM_CUSTOMER MS, MDM_CUSTOMER MC,
     MDM_SLS_REP CR, MDM_SLS_REP LR
WHERE B.BKG_NO = @[bkg_no]
AND B.BKG_NO = A.BKG_NO
AND A.CHG_AMD_SEQ = (SELECT MAX(CHG_AMD_SEQ) 
                     FROM BKG_CHG_AMD_AUTH 
                     WHERE BKG_NO = B.BKG_NO)
AND V.INTG_CD_ID = 'CD03364'
AND A.CHG_AMD_RSN_CD = V.INTG_CD_VAL_CTNT
AND A.RQST_USR_ID = U.USR_ID
AND B.BKG_NO = R.BKG_NO
AND B.BKG_NO = S.BKG_NO
AND S.BKG_CUST_TP_CD = 'S'
AND B.BKG_NO = C.BKG_NO 
AND C.BKG_CUST_TP_CD = 'C'
AND S.CUST_CNT_CD = MS.CUST_CNT_CD(+)
AND S.CUST_SEQ = MS.CUST_SEQ(+)
AND C.CUST_CNT_CD = MC.CUST_CNT_CD(+)
AND C.CUST_SEQ = MC.CUST_SEQ(+)
AND B.CTRT_SREP_CD = CR.SREP_CD
AND B.OB_SREP_CD = LR.SREP_CD
UNION ALL
(SELECT '
    <tr>
        <td align=\"center\">'||D.CHG_CD||'</td>
        <td align=\"center\">'||D.CURR_CD||'</td>
        <td align=\"center\">'||D.RAT_UT_CD||'</td>
        <td align=\"right\">'||TRIM(TO_CHAR(D.CRNT_CHG_AMT,'999,999,999.99'))||'</td>
        <td align=\"right\">'||TRIM(TO_CHAR(D.AMD_CHG_AMT,'999,999,999.99'))||'</td>
        <td align=\"right\">'||TRIM(TO_CHAR(D.DIFF_CHG_AMT,'999,999,999.99'))||'</td>
    </tr>' MAIL_BODY
FROM BKG_CHG_AMD_AUTH_DTL D
WHERE BKG_NO = @[bkg_no]
AND D.CHG_AMD_SEQ = (SELECT MAX(CHG_AMD_SEQ) 
                     FROM BKG_CHG_AMD_AUTH 
                     WHERE BKG_NO = D.BKG_NO))
UNION ALL
SELECT
'</table><p>
Remarks : '||A.CHG_AMD_RMK||'
</html>' MAIL_BODY
FROM BKG_CHG_AMD_AUTH A
WHERE a.BKG_NO = @[bkg_no]
AND A.CHG_AMD_SEQ = (SELECT MAX(CHG_AMD_SEQ) 
                     FROM BKG_CHG_AMD_AUTH 
                     WHERE BKG_NO = A.BKG_NO)			]]></sql>
			<params>
				<param name="chg_cd" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
