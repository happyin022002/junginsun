<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CMPBGuidelineDBDAORsltRtListVerticalExcelVORSQL">
			<desc><![CDATA[Vertical Excel]]></desc>
			<sql><![CDATA[
SELECT A.ROUT_ROWKEY
      ,A.ROUT_DP_SEQ
      ,A.VSL_SLAN_CD
      ,A.PRC_CMDT_DEF_CD
      ,A.PRC_CMDT_DEF_NM
      ,A.ORG_ROUT_PNT_LOC_DEF_CD
      ,A.ORG_ROUT_PNT_LOC_DEF_NM
      ,A.ORG_RCV_DE_TERM_NM
      ,A.ORG_ROUT_VIA_PORT_DEF_CD
      ,A.DEST_ROUT_VIA_PORT_DEF_CD
      ,A.DEST_ROUT_PNT_LOC_DEF_CD
      ,A.DEST_ROUT_PNT_LOC_DEF_NM
      ,A.DEST_RCV_DE_TERM_NM
      ,A.RAT_UT_CD
      ,A.PRC_CGO_TP_CD
      ,A.CURR_CD
      ,A.CMPB_AMT
      ,A.MQC_RNG_FM_QTY
      ,A.MQC_RNG_TO_QTY
	  ,(TO_NUMBER(SUBSTR(A.ROUT_ROWKEY, 1, INSTR(A.ROUT_ROWKEY, '|', 1, 1) - 1)) || ';' || 
	  (
		SELECT COUNT(A.VSL_SLAN_CD)
		FROM (
        		SELECT  DISTINCT
        				A1.VSL_SLAN_CD
        		FROM    MDM_SVC_SCP_LANE A1
        		,       MDM_VSL_SVC_LANE B1
        		WHERE   A1.VSL_SLAN_CD = B1.VSL_SLAN_CD
        		AND     A1.SVC_SCP_CD = @[svc_scp_cd]
        		AND     A1.DELT_FLG = 'N'
        		AND     B1.DELT_FLG = 'N'
        		AND     B1.VSL_TP_CD = 'C'
     		 ) A 
		) ) AS CNT_SVC_LANE 	
  FROM (SELECT S.ROUT_ROWKEY
              ,A.ROUT_DP_SEQ
              ,B.VSL_SLAN_CD
              ,C.PRC_CMDT_DEF_CD
              ,C.PRC_CMDT_DEF_NM
              ,D.ROUT_PNT_LOC_DEF_CD AS ORG_ROUT_PNT_LOC_DEF_CD
              ,D.ROUT_PNT_LOC_DEF_NM AS ORG_ROUT_PNT_LOC_DEF_NM
              ,D.RCV_DE_TERM_NM AS ORG_RCV_DE_TERM_NM
              ,E.ROUT_VIA_PORT_DEF_CD AS ORG_ROUT_VIA_PORT_DEF_CD
              ,F.ROUT_VIA_PORT_DEF_CD AS DEST_ROUT_VIA_PORT_DEF_CD
              ,G.ROUT_PNT_LOC_DEF_CD AS DEST_ROUT_PNT_LOC_DEF_CD
              ,G.ROUT_PNT_LOC_DEF_NM AS DEST_ROUT_PNT_LOC_DEF_NM
              ,G.RCV_DE_TERM_NM AS DEST_RCV_DE_TERM_NM
              ,H.RAT_UT_CD
              ,H.PRC_CGO_TP_CD
              ,H.CURR_CD
              ,H.CMPB_AMT
              ,H.MQC_RNG_FM_QTY
              ,H.MQC_RNG_TO_QTY
		FROM (SELECT BSE_SEQ
                     ,LPAD(BSE_SEQ, 5, '0') || '|' ||
                      LPAD(ROW_NUMBER()
                           OVER(PARTITION BY SVC_SCP_CD, CRE_OFC_CD, GLINE_SEQ, PRS_CUST_TP_CD, BSE_SEQ ORDER BY BSE_SEQ)
                          ,5
                          ,'0') AS ROUT_ROWKEY
                 FROM PRI_CMPB_GLINE_SVC_LANE
                WHERE SVC_SCP_CD = @[svc_scp_cd]
                  AND CRE_OFC_CD = @[cre_ofc_cd]
                  AND GLINE_SEQ = @[gline_seq]
                  AND PRS_CUST_TP_CD = @[prs_cust_tp_cd]
                UNION
               SELECT BSE_SEQ
                     ,LPAD(BSE_SEQ, 5, '0') || '|' ||
                      LPAD(ROW_NUMBER()
                           OVER(PARTITION BY SVC_SCP_CD, CRE_OFC_CD, GLINE_SEQ, PRS_CUST_TP_CD, BSE_SEQ ORDER BY BSE_SEQ)
                          ,5
                          ,'0') AS ROUT_ROWKEY
                 FROM PRI_CMPB_GLINE_CMDT
                WHERE SVC_SCP_CD = @[svc_scp_cd]
                  AND CRE_OFC_CD = @[cre_ofc_cd]
                  AND GLINE_SEQ = @[gline_seq]
                  AND PRS_CUST_TP_CD = @[prs_cust_tp_cd]
               UNION
               SELECT BSE_SEQ
                     ,LPAD(BSE_SEQ, 5, '0') || '|' ||
                      LPAD(ROW_NUMBER()
                           OVER(PARTITION BY SVC_SCP_CD, CRE_OFC_CD, GLINE_SEQ, PRS_CUST_TP_CD, BSE_SEQ ORDER BY BSE_SEQ)
                          ,5
                          ,'0') AS ROUT_ROWKEY
                 FROM PRI_CMPB_GLINE_ROUT_PNT
                WHERE SVC_SCP_CD = @[svc_scp_cd]
                  AND CRE_OFC_CD = @[cre_ofc_cd]
                  AND GLINE_SEQ = @[gline_seq]
                  AND PRS_CUST_TP_CD = @[prs_cust_tp_cd]
                  AND ORG_DEST_TP_CD = 'O'
               UNION
               SELECT BSE_SEQ
                     ,LPAD(BSE_SEQ, 5, '0') || '|' ||
                      LPAD(ROW_NUMBER()
                           OVER(PARTITION BY SVC_SCP_CD, CRE_OFC_CD, GLINE_SEQ, PRS_CUST_TP_CD, BSE_SEQ ORDER BY BSE_SEQ)
                          ,5
                          ,'0') AS ROUT_ROWKEY
                 FROM PRI_CMPB_GLINE_ROUT_VIA
                WHERE SVC_SCP_CD = @[svc_scp_cd]
                  AND CRE_OFC_CD = @[cre_ofc_cd]
                  AND GLINE_SEQ = @[gline_seq]
                  AND PRS_CUST_TP_CD = @[prs_cust_tp_cd]
                  AND ORG_DEST_TP_CD = 'O'
               UNION
               SELECT BSE_SEQ
                     ,LPAD(BSE_SEQ, 5, '0') || '|' ||
                      LPAD(ROW_NUMBER()
                           OVER(PARTITION BY SVC_SCP_CD, CRE_OFC_CD, GLINE_SEQ, PRS_CUST_TP_CD, BSE_SEQ ORDER BY BSE_SEQ)
                          ,5
                          ,'0') AS ROUT_ROWKEY
                 FROM PRI_CMPB_GLINE_ROUT_PNT
                WHERE SVC_SCP_CD = @[svc_scp_cd]
                  AND CRE_OFC_CD = @[cre_ofc_cd]
                  AND GLINE_SEQ = @[gline_seq]
                  AND PRS_CUST_TP_CD = @[prs_cust_tp_cd]
                  AND ORG_DEST_TP_CD = 'D'
               UNION
               SELECT BSE_SEQ
                     ,LPAD(BSE_SEQ, 5, '0') || '|' ||
                      LPAD(ROW_NUMBER()
                           OVER(PARTITION BY SVC_SCP_CD, CRE_OFC_CD, GLINE_SEQ, PRS_CUST_TP_CD, BSE_SEQ ORDER BY BSE_SEQ)
                          ,5
                          ,'0') AS ROUT_ROWKEY
                 FROM PRI_CMPB_GLINE_ROUT_VIA
                WHERE SVC_SCP_CD = @[svc_scp_cd]
                  AND CRE_OFC_CD = @[cre_ofc_cd]
                  AND GLINE_SEQ = @[gline_seq]
                  AND PRS_CUST_TP_CD = @[prs_cust_tp_cd]
                  AND ORG_DEST_TP_CD = 'D'
               UNION   
               SELECT BSE_SEQ
                     ,LPAD(BSE_SEQ, 5, '0') || '|' ||
                      LPAD(ROW_NUMBER()
                           OVER(PARTITION BY SVC_SCP_CD, CRE_OFC_CD, GLINE_SEQ, PRS_CUST_TP_CD, BSE_SEQ ORDER BY BSE_SEQ)
                          ,5
                          ,'0') AS ROUT_ROWKEY
                 FROM PRI_CMPB_GLINE_AMT
                WHERE SVC_SCP_CD = @[svc_scp_cd]
                  AND CRE_OFC_CD = @[cre_ofc_cd]
                  AND GLINE_SEQ = @[gline_seq]
                  AND PRS_CUST_TP_CD = @[prs_cust_tp_cd]
              ) S
              --BSE
             ,(SELECT ROW_NUMBER() OVER(PARTITION BY T.SVC_SCP_CD, T.CRE_OFC_CD, T.GLINE_SEQ, T.PRS_CUST_TP_CD
                                        ORDER BY T.BSE_SEQ) AS ROUT_DP_SEQ
                      ,LPAD(T.BSE_SEQ, 5, '0') || '|' || '00001' AS ROUT_ROWKEY
                 FROM PRI_CMPB_GLINE_BSE T
                WHERE SVC_SCP_CD = @[svc_scp_cd]
                  AND CRE_OFC_CD = @[cre_ofc_cd]
                  AND GLINE_SEQ = @[gline_seq]
                  AND PRS_CUST_TP_CD = @[prs_cust_tp_cd]
              ) A
               --SVC LANE
             ,(SELECT T.BSE_SEQ
        			,T.VSL_SLAN_CD
        			,LPAD(T.BSE_SEQ, 5, '0') || '|' ||
        				LPAD(ROW_NUMBER()
       				OVER(PARTITION BY T.SVC_SCP_CD, T.CRE_OFC_CD, T.GLINE_SEQ, T.PRS_CUST_TP_CD, T.BSE_SEQ ORDER BY NULL)
        			,5
        			,'0') AS ROUT_ROWKEY
        		 FROM PRI_CMPB_GLINE_SVC_LANE T
			   WHERE T.SVC_SCP_CD = @[svc_scp_cd]
                 AND T.CRE_OFC_CD = @[cre_ofc_cd]
                 AND T.GLINE_SEQ = @[gline_seq]
                 AND T.PRS_CUST_TP_CD = @[prs_cust_tp_cd]
			  ) B
              --CMDT
             ,(SELECT T.BSE_SEQ
                     ,T.PRC_CMDT_DEF_CD
                     ,  DECODE(T.PRC_CMDT_TP_CD,
                              'G',                                            
                              (SELECT PRC_GRP_CMDT_DESC                       --GROUP COMMODITY
                                 FROM PRI_CMPB_GRP_CMDT
                                WHERE SVC_SCP_CD = T.SVC_SCP_CD
                                  AND   CRE_OFC_CD = T.CRE_OFC_CD
                                  AND   GLINE_SEQ = T.GLINE_SEQ
                                  AND   PRC_GRP_CMDT_CD = T.PRC_CMDT_DEF_CD
                                  AND   ROWNUM = 1),
                              'R',
                              (SELECT REP_CMDT_NM                             --REP COMMODITY
                                 FROM MDM_REP_CMDT
                                WHERE REP_CMDT_CD = T.PRC_CMDT_DEF_CD
                                  AND ROWNUM = 1),
                              'C',
                              (SELECT CMDT_NM                                  --COMMODITY
                                 FROM MDM_COMMODITY
                                WHERE CMDT_CD = T.PRC_CMDT_DEF_CD
                                  AND ROWNUM = 1)) AS PRC_CMDT_DEF_NM
                     
                     ,LPAD(T.BSE_SEQ, 5, '0') || '|' ||
                      LPAD(ROW_NUMBER() OVER(PARTITION BY T.SVC_SCP_CD, T.CRE_OFC_CD, T.GLINE_SEQ, T.PRS_CUST_TP_CD, T.BSE_SEQ
                                             ORDER BY DECODE(T.PRC_CMDT_TP_CD, 'G', 1, 'R', 2, 'C', 3, 99),T.PRC_CMDT_DEF_CD)
                          ,5
                          ,'0') AS ROUT_ROWKEY
                 FROM PRI_CMPB_GLINE_CMDT T
                WHERE T.SVC_SCP_CD = @[svc_scp_cd]
                  AND T.CRE_OFC_CD = @[cre_ofc_cd]
                  AND T.GLINE_SEQ = @[gline_seq]
                  AND T.PRS_CUST_TP_CD = @[prs_cust_tp_cd]
               ) C
               --ROUT PNT ORIGIN
             ,(SELECT T.BSE_SEQ
                     ,T.ROUT_PNT_LOC_DEF_CD
                     ,	DECODE(T.ROUT_PNT_LOC_TP_CD,
                              'G',                                                 --GROUP LOCATION
                			  (SELECT PRC_GRP_LOC_DESC
                				 FROM PRI_CMPB_GRP_LOC
                				WHERE SVC_SCP_CD = T.SVC_SCP_CD
                				  AND GLINE_SEQ = T.GLINE_SEQ
                				  AND PRC_GRP_LOC_CD = T.ROUT_PNT_LOC_DEF_CD
                				  AND ROWNUM = 1),
                              'R',
                              (SELECT RGN_NM                                       --REGION
                                 FROM MDM_REGION
                                WHERE RGN_CD = T.ROUT_PNT_LOC_DEF_CD
                                  AND ROWNUM = 1),
                              'C',                                                 --COUNTRY
                              (SELECT CNT_NM
                                 FROM MDM_COUNTRY
                                WHERE CNT_CD = T.ROUT_PNT_LOC_DEF_CD
                                  AND ROWNUM = 1),
                              'L',                                                 --LOCATION    
                              (SELECT LOC_NM
                                 FROM MDM_LOCATION
                                WHERE LOC_CD = T.ROUT_PNT_LOC_DEF_CD
                                  AND ROWNUM = 1)) AS ROUT_PNT_LOC_DEF_NM
                     ,(SELECT INTG_CD_VAL_DP_DESC
                         FROM COM_INTG_CD_DTL
                        WHERE INTG_CD_ID = 'CD02139'
                          AND INTG_CD_VAL_CTNT = T.RCV_DE_TERM_CD
                          AND ROWNUM = 1) AS RCV_DE_TERM_NM
                     ,LPAD(T.BSE_SEQ, 5, '0') || '|' ||
                      LPAD(ROW_NUMBER() OVER(PARTITION BY T.SVC_SCP_CD, T.CRE_OFC_CD, T.GLINE_SEQ, T.PRS_CUST_TP_CD, T.BSE_SEQ
                                             ORDER BY DECODE(T.ROUT_PNT_LOC_TP_CD, 'C', '1', 'R', '2', 'G', '3', 'L', '4', 99),T.ROUT_PNT_LOC_DEF_CD)
                          ,5
                          ,'0') AS ROUT_ROWKEY
                 FROM PRI_CMPB_GLINE_ROUT_PNT T
                WHERE T.SVC_SCP_CD = @[svc_scp_cd]
                  AND T.CRE_OFC_CD = @[cre_ofc_cd]
                  AND T.GLINE_SEQ = @[gline_seq]
                  AND T.PRS_CUST_TP_CD = @[prs_cust_tp_cd]
                  AND T.ORG_DEST_TP_CD = 'O'
              ) D
              --ROUT VIA ORIGIN
             ,(SELECT T.BSE_SEQ
                     ,T.ROUT_VIA_PORT_DEF_CD
                     ,LPAD(T.BSE_SEQ, 5, '0') || '|' ||
                      LPAD(ROW_NUMBER() OVER(PARTITION BY T.SVC_SCP_CD, T.CRE_OFC_CD, T.GLINE_SEQ, T.PRS_CUST_TP_CD, T.BSE_SEQ
                                             ORDER BY DECODE(T.ROUT_VIA_PORT_TP_CD, 'C', '1', 'R', '2', 'G', '3', 'L', '4', 99),T.ROUT_VIA_PORT_DEF_CD)
                          ,5
                          ,'0') AS ROUT_ROWKEY
                 FROM PRI_CMPB_GLINE_ROUT_VIA T
                WHERE T.SVC_SCP_CD = @[svc_scp_cd]
                  AND T.CRE_OFC_CD = @[cre_ofc_cd]
                  AND T.GLINE_SEQ = @[gline_seq]
                  AND T.PRS_CUST_TP_CD = @[prs_cust_tp_cd]
                  AND T.ORG_DEST_TP_CD = 'O'
              ) E
              --ROUT VIA DEST
             ,(SELECT T.BSE_SEQ
                     ,T.ROUT_VIA_PORT_DEF_CD
                     ,LPAD(T.BSE_SEQ, 5, '0') || '|' ||
                      LPAD(ROW_NUMBER() OVER(PARTITION BY T.SVC_SCP_CD, T.CRE_OFC_CD, T.GLINE_SEQ, T.PRS_CUST_TP_CD, T.BSE_SEQ
                                             ORDER BY DECODE(T.ROUT_VIA_PORT_TP_CD, 'C', '1', 'R', '2', 'G', '3', 'L', '4', 99),T.ROUT_VIA_PORT_DEF_CD)
                          ,5
                          ,'0') AS ROUT_ROWKEY
                 FROM PRI_CMPB_GLINE_ROUT_VIA T
                WHERE T.SVC_SCP_CD = @[svc_scp_cd]
                  AND T.CRE_OFC_CD = @[cre_ofc_cd]
                  AND T.GLINE_SEQ = @[gline_seq]
                  AND T.PRS_CUST_TP_CD = @[prs_cust_tp_cd]
                  AND T.ORG_DEST_TP_CD = 'D'
              ) F
              --ROUT PNT DEST
             ,(SELECT T.BSE_SEQ
                     ,T.ROUT_PNT_LOC_DEF_CD
                     ,	DECODE(T.ROUT_PNT_LOC_TP_CD,
                              'G',                                                 --GROUP LOCATION
                			  (SELECT PRC_GRP_LOC_DESC
                				 FROM PRI_CMPB_GRP_LOC
                				WHERE SVC_SCP_CD = T.SVC_SCP_CD
                				  AND GLINE_SEQ = T.GLINE_SEQ
                				  AND PRC_GRP_LOC_CD = T.ROUT_PNT_LOC_DEF_CD
                				  AND ROWNUM = 1),
                              'R',
                              (SELECT RGN_NM                                       --REGION
                                 FROM MDM_REGION
                                WHERE RGN_CD = T.ROUT_PNT_LOC_DEF_CD
                                  AND ROWNUM = 1),
                              'C',                                                 --COUNTRY
                              (SELECT CNT_NM
                                 FROM MDM_COUNTRY
                                WHERE CNT_CD = T.ROUT_PNT_LOC_DEF_CD
                                  AND ROWNUM = 1),
                              'L',                                                 --LOCATION    
                              (SELECT LOC_NM
                                 FROM MDM_LOCATION
                                WHERE LOC_CD = T.ROUT_PNT_LOC_DEF_CD
                                  AND ROWNUM = 1)) AS ROUT_PNT_LOC_DEF_NM
                     ,(SELECT INTG_CD_VAL_DP_DESC
                         FROM COM_INTG_CD_DTL
                        WHERE INTG_CD_ID = 'CD02139'
                          AND INTG_CD_VAL_CTNT = T.RCV_DE_TERM_CD
                          AND ROWNUM = 1) AS RCV_DE_TERM_NM
                     ,LPAD(T.BSE_SEQ, 5, '0') || '|' ||
                      LPAD(ROW_NUMBER() OVER(PARTITION BY T.SVC_SCP_CD, T.CRE_OFC_CD, T.GLINE_SEQ, T.PRS_CUST_TP_CD, T.BSE_SEQ
                                             ORDER BY DECODE(T.ROUT_PNT_LOC_TP_CD, 'C', '1', 'R', '2', 'G', '3', 'L', '4', 99),T.ROUT_PNT_LOC_DEF_CD)
                          ,5
                          ,'0') AS ROUT_ROWKEY
                 FROM PRI_CMPB_GLINE_ROUT_PNT T
                WHERE T.SVC_SCP_CD = @[svc_scp_cd]
                  AND T.CRE_OFC_CD = @[cre_ofc_cd]
                  AND T.GLINE_SEQ = @[gline_seq]
                  AND T.PRS_CUST_TP_CD = @[prs_cust_tp_cd]
                  AND T.ORG_DEST_TP_CD = 'D'
              ) G
             ,(SELECT T.BSE_SEQ
                     ,T.RAT_UT_CD
                     ,T.PRC_CGO_TP_CD
                     ,T.CURR_CD
                     ,T.MQC_RNG_FM_QTY
                     ,T.MQC_RNG_TO_QTY
                     ,T.CMPB_AMT
                     ,LPAD(T.BSE_SEQ, 5, '0') || '|' ||
                      LPAD(ROW_NUMBER() OVER(PARTITION BY T.SVC_SCP_CD, T.CRE_OFC_CD, T.GLINE_SEQ, T.PRS_CUST_TP_CD, T.BSE_SEQ 
                                             ORDER BY T.MQC_RNG_FM_QTY,T.MQC_RNG_TO_QTY,T.RAT_UT_CD,T.PRC_CGO_TP_CD,T.CURR_CD)
                          ,5
                          ,'0') AS ROUT_ROWKEY
                 FROM PRI_CMPB_GLINE_AMT T
                WHERE T.SVC_SCP_CD = @[svc_scp_cd]
                  AND T.CRE_OFC_CD = @[cre_ofc_cd]
                  AND T.GLINE_SEQ = @[gline_seq]
                  AND T.PRS_CUST_TP_CD = @[prs_cust_tp_cd]
              ) H			 
        WHERE S.ROUT_ROWKEY = A.ROUT_ROWKEY(+)
          AND S.ROUT_ROWKEY = B.ROUT_ROWKEY(+)
          AND S.ROUT_ROWKEY = C.ROUT_ROWKEY(+)
          AND S.ROUT_ROWKEY = D.ROUT_ROWKEY(+)
          AND S.ROUT_ROWKEY = E.ROUT_ROWKEY(+)
          AND S.ROUT_ROWKEY = F.ROUT_ROWKEY(+)
          AND S.ROUT_ROWKEY = G.ROUT_ROWKEY(+)
          AND S.ROUT_ROWKEY = H.ROUT_ROWKEY(+)
		ORDER BY S.ROUT_ROWKEY) A			]]></sql>
			<params>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="cre_ofc_cd" type="12" value="" out="N"/>
				<param name="gline_seq" type="12" value="" out="N"/>
				<param name="prs_cust_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
