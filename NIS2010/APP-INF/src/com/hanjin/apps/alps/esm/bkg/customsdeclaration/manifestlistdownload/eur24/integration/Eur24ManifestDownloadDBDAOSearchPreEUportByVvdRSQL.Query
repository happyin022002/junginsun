<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="Eur24ManifestDownloadDBDAOSearchPreEUportByVvdRSQL">
			<desc><![CDATA[Finland (IE344) 용 / VVD 입력 후 FIKTK 이전의 EU port 를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT VPS_PORT_CD          AS P_FI_POL_CD
     , SUBSTR(YD_CD, 6, 2)  AS P_FI_POL_YARD_CD
  FROM BKG_CSTMS_CD_CONV_CTNT D
     , (SELECT *
          FROM VSK_VSL_PORT_SKD C
             , (SELECT B.VSL_CD, B.SKD_VOY_NO, B.SKD_DIR_CD, MAX(B.CLPT_SEQ) AS CLPT_SEQ
                  FROM VSK_VSL_PORT_SKD A
                     , VSK_VSL_PORT_SKD B
                 WHERE 1=1
                   AND A.VSL_CD = SUBSTR(@[p_fi_vvd_cd], 1, 4)
                   AND A.SKD_VOY_NO = SUBSTR(@[p_fi_vvd_cd], 5, 4)
                   AND A.SKD_DIR_CD = SUBSTR(@[p_fi_vvd_cd], 9, 1)
                   AND NVL(A.SKD_CNG_STS_CD, 'X') <> 'S'
                   AND A.VPS_PORT_CD = @[p_fi_pod_cd]
                   AND A.VSL_CD = B.VSL_CD
                   AND A.SKD_VOY_NO = B.SKD_VOY_NO
                   AND A.SKD_DIR_CD = B.SKD_DIR_CD
                   AND NVL(B.SKD_CNG_STS_CD, 'X') <> 'S'
                   AND B.CLPT_SEQ < A.CLPT_SEQ
              GROUP BY B.VSL_CD, B.SKD_VOY_NO, B.SKD_DIR_CD
               ) AB
         WHERE 1=1
           AND C.VSL_CD = AB.VSL_CD
           AND C.SKD_VOY_NO = AB.SKD_VOY_NO
           AND C.SKD_DIR_CD = AB.SKD_DIR_CD
           AND NVL(C.SKD_CNG_STS_CD, 'X') <> 'S'
           AND C.CLPT_SEQ = AB.CLPT_SEQ
       ) ABC
 WHERE 1=1
   AND D.CSTMS_DIV_ID = 'EU_MEMBER_CNT'
   AND D.CNT_CD = 'EU'
   AND SUBSTR(ABC.VPS_PORT_CD, 1, 2) = D.ATTR_CTNT1			]]></sql>
			<params>
				<param name="p_fi_vvd_cd" type="12" value="" out="N"/>
				<param name="p_fi_pod_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
