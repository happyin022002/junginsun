<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SPCManageDBDAOModifySpcSlotInfoByVvdOnVesselUSQL">
			<desc><![CDATA[Inquiry by VVD에서 Manual 로 값 입력시 BSA_VVD_OTR_CRR 에 값 수정/입력

2016.01.29 김성욱 [CHM-201539410] BSA System 개선의 건 / 동일 날짜에 서로 다른 항차 BSA 입력 가능 실현]]></desc>
			<sql><![CDATA[
MERGE INTO BSA_VVD_OTR_CRR A
USING (
	SELECT 
	 @[trd_cd] TRD_CD
		 , @[lane_cd] RLANE_CD
		 , @[dir_cd] SKD_DIR_CD
		 , @[vsl_cd] VSL_CD
		 , @[voy_no] SKD_VOY_NO 
		 , @[jb_cd] BSA_OP_JB_CD
		 , @[crr_cd] CRR_CD
        FROM DUAL
) B
ON (
	    A.TRD_CD       = B.TRD_CD
	AND A.RLANE_CD     = B.RLANE_CD
	AND A.SKD_DIR_CD   = B.SKD_DIR_CD
	AND A.VSL_CD       = B.VSL_CD
	AND A.SKD_VOY_NO   = B.SKD_VOY_NO
	AND A.BSA_OP_JB_CD = B.BSA_OP_JB_CD
	AND A.CRR_CD       = B.CRR_CD
)
WHEN MATCHED THEN
	UPDATE
#if (${crr_cd} != 'SML')
	SET CRR_BSA_CAPA = CRR_BSA_CAPA + TO_NUMBER(@[def_value])
	, SPC_CTRL_SLT_CAPA = SPC_CTRL_SLT_CAPA + TO_NUMBER(@[def_value])
#else
#if (${type} == 'SC')
	SET CRR_BSA_CAPA = @[fnl_hjs_bsa_capa_sc]
	, SPC_CTRL_SLT_CAPA = @[fnl_hjs_bsa_capa_sc]
#else
	SET CRR_BSA_CAPA = @[fnl_hjs_bsa_capa]
	, SPC_CTRL_SLT_CAPA = @[fnl_hjs_bsa_capa]
#end

#end
	, UPD_DT = SYSDATE
	, UPD_USR_ID = @[upd_usr_id]
WHEN NOT MATCHED THEN
	INSERT (
		TRD_CD, RLANE_CD, VSL_CD, SKD_VOY_NO, SKD_DIR_CD,
		BSA_OP_JB_CD, CRR_CD, CRR_BSA_CAPA, SPC_CTRL_SLT_CAPA,
		CRE_USR_ID, CRE_DT, UPD_USR_ID, UPD_DT
	) VALUES (
		@[trd_cd] , @[lane_cd] , @[vsl_cd] , @[voy_no] , @[dir_cd]
		, @[jb_cd] , @[crr_cd] , @[crr_bsa_capa] , @[crr_bsa_capa]
		, @[upd_usr_id] , SYSDATE , @[upd_usr_id] , SYSDATE
	)			]]></sql>
			<params>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="lane_cd" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="voy_no" type="12" value="" out="N"/>
				<param name="jb_cd" type="12" value="" out="N"/>
				<param name="crr_cd" type="12" value="" out="N"/>
				<param name="def_value" type="12" value="" out="N"/>
				<param name="fnl_hjs_bsa_capa_sc" type="12" value="" out="N"/>
				<param name="fnl_hjs_bsa_capa" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="crr_bsa_capa" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
