<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SpclPlanningDBDAOCreateBasicCmcbCSQL">
			<desc><![CDATA[SpclPlanningDBDAOCreateBasicCmcb]]></desc>
			<sql><![CDATA[
INSERT INTO SQM_SPCL_LANE_OFC_COST (
             BSE_TP_CD
            ,BSE_YR
            ,BSE_QTR_CD
            ,SPCL_TGT_CD
            ,TRD_CD
            ,RLANE_CD
            ,DIR_CD
            ,RGN_OFC_CD
            ,RHQ_CD
            ,CONV_DIR_CD
            ,GID_PA_CM_UC_AMT
            ,GID_RA_CM_UC_AMT
            ,PA_CM_UC_AMT
            ,RA_CM_UC_AMT
            ,LOD_POTN_RTO
            ,REV_POTN_RTO
            ,CRE_USR_ID
            ,CRE_DT
            ,UPD_USR_ID
            ,UPD_DT
            )
SELECT B2.BSE_TP_CD
      ,B2.BSE_YR
      ,B2.BSE_QTR_CD
      ,@[f_spcl_tgt_cd] AS QTA_TGT_CD
      ,B2.TRD_CD
      ,B2.RLANE_CD
      ,B2.DIR_CD
      ,B2.RGN_OFC_CD
      ,B2.RHQ_CD
      ,B2.CONV_DIR_CD
      ,NVL(ROUND(B1.PA_CM_UC_AMT,0), 0) AS GID_PA_CM_UC_AMT
      ,NVL(ROUND(B1.RA_CM_UC_AMT,0), 0) AS GID_RA_CM_UC_AMT
      ,NVL(ROUND(B1.PA_CM_UC_AMT,0), 0) AS PA_CM_UC_AMT
      ,NVL(ROUND(B1.RA_CM_UC_AMT,0), 0) AS RA_CM_UC_AMT
      ,NVL(B1.LOD_POTN_RTO, 0) AS LOD_POTN_RTO
      ,NVL(B1.REV_POTN_RTO, 0) AS REV_POTN_RTO
      ,@[usr_id]  AS CRE_USR_ID
      ,SYSDATE    AS CRE_DT
      ,@[usr_id]  AS UPD_USR_ID
      ,SYSDATE    AS UPD_DT
  FROM SQM_PERF_IF B1
        ,(
          SELECT DISTINCT
                 A1.BSE_TP_CD
                ,A1.BSE_YR
                ,DECODE( A1.BSE_TP_CD, 'Y', A2.CPY_NO || 'Q', @[f_bse_qtr_cd]) AS BSE_QTR_CD
                ,A1.TRD_CD
                ,A1.RLANE_CD
                ,NVL(A3.CONV_DIR_CD, A1.DIR_CD) AS CONV_DIR_CD
                ,A1.DIR_CD
                ,A1.RHQ_CD
                ,A1.RGN_OFC_CD
           FROM SQM_PERF_IF A1
               ,COM_CPY_NO A2
               ,SQM_DIR_CONV A3
           WHERE 1=1
             AND A1.BSE_TP_CD     = A3.BSE_TP_CD(+)
             AND A1.BSE_YR        = A3.BSE_YR(+)
             AND A1.TRD_CD        = A3.TRD_CD(+)
             AND A1.RLANE_CD      = A3.RLANE_CD(+)
             AND A1.DIR_CD        = A3.DIR_CD(+)
             AND A1.BSE_TP_CD     = @[f_bse_tp_cd]
             AND A1.BSE_YR        = @[f_bse_yr]
             AND A1.BSE_QTR_CD    = DECODE(A1.BSE_TP_CD, 'Y', A1.BSE_QTR_CD, @[f_bse_qtr_cd])
             AND A3.BSE_QTR_CD(+) = DECODE(A1.BSE_TP_CD, 'Y', '00', @[f_bse_qtr_cd])
             AND A1.QTA_TGT_CD    = @[f_spcl_tgt_cd]
             AND A1.OFC_VW_CD     = 'C'
             AND A1.SQM_LVL_CD    = '2'
             AND A2.CPY_NO        BETWEEN '1' AND DECODE( A1.BSE_TP_CD, 'Y','4','1')
       ) B2
 WHERE 1=1
   AND B2.BSE_TP_CD      = B1.BSE_TP_CD(+)
   AND B2.BSE_YR         = B1.BSE_YR(+)
   AND B2.BSE_QTR_CD     = B1.BSE_QTR_CD(+)
   AND B2.TRD_CD         = B1.TRD_CD(+)
   AND B2.RLANE_CD       = B1.RLANE_CD(+)
   AND B2.DIR_CD         = B1.DIR_CD(+)
   AND B2.RHQ_CD         = B1.RHQ_CD(+)
   AND B2.RGN_OFC_CD     = B1.RGN_OFC_CD(+)
   AND B1.QTA_TGT_CD(+)  = @[f_spcl_tgt_cd]  -- S, R 필수
   AND B1.OFC_VW_CD(+)   = 'C'
   AND B1.SQM_LVL_CD(+)  = '2'
  ORDER BY TRD_CD, RLANE_CD, DIR_CD, RHQ_CD, RGN_OFC_CD, BSE_QTR_CD			]]></sql>
			<params>
				<param name="f_spcl_tgt_cd" type="12" value="" out="N"/>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="f_bse_qtr_cd" type="12" value="" out="N"/>
				<param name="f_bse_tp_cd" type="12" value="" out="N"/>
				<param name="f_bse_yr" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
