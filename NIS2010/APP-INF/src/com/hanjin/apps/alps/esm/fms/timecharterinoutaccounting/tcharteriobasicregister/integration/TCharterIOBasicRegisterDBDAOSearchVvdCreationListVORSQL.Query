<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOBasicRegisterDBDAOSearchVvdCreationListVORSQL">
			<desc><![CDATA[Vvd Creation List]]></desc>
			<sql><![CDATA[
SELECT 	'I' ibflag,
		A.REV_YRMON, A.VSL_CD,A.SKD_VOY_NO,A.SKD_DIR_CD,A.RLANE_DIR_CD REV_DIR_CD,A.SLAN_CD,A.RLANE_CD,
		A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD||A.RLANE_DIR_CD VVD_CD,
		TO_CHAR(DECODE(CS.VPS_ETD_DT,NULL, FMS_VVDDT_FNC(A.VSL_CD,A.SKD_VOY_NO,A.SKD_DIR_CD,A.ST_PORT_CD),CS.VPS_ETD_DT),'YYYYMMDD') VST_DT,
		TO_CHAR(DECODE(CE.VPS_ETD_DT,NULL, FMS_VVDDT_FNC(A.VSL_CD,A.SKD_VOY_NO,A.SKD_DIR_CD,A.FNL_PORT_CD),CE.VPS_ETD_DT),'YYYYMMDD') VED_DT
FROM (
		SELECT 	DISTINCT AR.REV_YRMON, AR.VSL_CD,AR.SKD_VOY_NO,AR.SKD_DIR_CD,AR.RLANE_DIR_CD,AR.SLAN_CD,AR.RLANE_CD,
				B.ST_PORT_CD, B.FNL_PORT_CD
		FROM   	FMS_BSE_PORT B,
				(SELECT VSL_CD FROM FMS_CONTRACT
				WHERE  FLET_CTRT_TP_CD = 'TI' AND FLET_CTRT_FACT_CD = 'ACT'
				UNION ALL
				SELECT FI.VSL_CD FROM FMS_CONTRACT FC, FMS_ID_VSL FI
				WHERE FC.FLET_CTRT_NO = FI.FLET_CTRT_NO
				AND FLET_CTRT_TP_CD = 'TI' AND FC.FLET_CTRT_FACT_CD = 'ACT' AND FI.USE_FLG = 'Y') FC, AR_MST_REV_VVD AR
		WHERE  	FC.VSL_CD		= AR.VSL_CD
		AND    	AR.REV_YRMON	= @[rev_yrmon]
		AND		AR.RLANE_CD      = B.RLANE_CD(+)
		AND		AR.SKD_DIR_CD  	= B.SKD_DIR_CD(+)
		AND		AR.RLANE_DIR_CD	= B.REV_DIR_CD(+)
		AND		AR.SLAN_CD	= B.SLAN_CD(+)) A,
		(SELECT AR.VSL_CD, AR.SKD_VOY_NO, AR.SKD_DIR_CD, AR.SLAN_CD, B.VPS_PORT_CD,
				MAX(B.VPS_ETD_DT) VPS_ETD_DT
		FROM   AR_MST_REV_VVD AR,  VSK_VSL_PORT_SKD B
		WHERE  AR.VSL_CD = B.VSL_CD
		AND    AR.SKD_VOY_NO = B.SKD_VOY_NO
		AND    AR.SKD_DIR_CD = B.SKD_DIR_CD
		AND    AR.REV_YRMON	= @[rev_yrmon]
		AND    NVL(B.SKD_CNG_STS_CD,'Z') <> 'S'
		AND	EXISTS (SELECT NULL FROM FMS_CONTRACT
					WHERE  VSL_CD = AR.VSL_CD AND FLET_CTRT_FACT_CD = 'ACT'
					UNION ALL
					SELECT NULL FROM FMS_CONTRACT FC, FMS_ID_VSL FI
					WHERE FI.VSL_CD = AR.VSL_CD AND FC.FLET_CTRT_NO = FI.FLET_CTRT_NO
					AND FC.FLET_CTRT_FACT_CD = 'ACT' AND FI.USE_FLG = 'Y')
		GROUP BY AR.VSL_CD, AR.SKD_VOY_NO, AR.SKD_DIR_CD, AR.SLAN_CD, B.VPS_PORT_CD) CS,
		(SELECT AR.VSL_CD, AR.SKD_VOY_NO, AR.SKD_DIR_CD, AR.SLAN_CD, B.VPS_PORT_CD,
				MAX(B.VPS_ETD_DT) VPS_ETD_DT
		FROM   AR_MST_REV_VVD AR,  VSK_VSL_PORT_SKD B
		WHERE  AR.VSL_CD = B.VSL_CD
		AND    AR.SKD_VOY_NO = B.SKD_VOY_NO
		AND    AR.SKD_DIR_CD = B.SKD_DIR_CD
		AND    AR.REV_YRMON	= @[rev_yrmon]
		AND    NVL(B.SKD_CNG_STS_CD,'Z') <> 'S'
		AND	EXISTS (SELECT NULL FROM FMS_CONTRACT
					WHERE  VSL_CD = AR.VSL_CD AND FLET_CTRT_FACT_CD = 'ACT'
					UNION ALL
					SELECT NULL FROM FMS_CONTRACT FC, FMS_ID_VSL FI
					WHERE FI.VSL_CD = AR.VSL_CD AND FC.FLET_CTRT_NO = FI.FLET_CTRT_NO
					AND FC.FLET_CTRT_FACT_CD = 'ACT' AND FI.USE_FLG = 'Y')
		GROUP BY AR.VSL_CD, AR.SKD_VOY_NO, AR.SKD_DIR_CD, AR.SLAN_CD, B.VPS_PORT_CD) CE
WHERE 	A.VSL_CD = CS.VSL_CD(+)
AND		A.SKD_VOY_NO = CS.SKD_VOY_NO(+)
AND		A.SKD_DIR_CD = CS.SKD_DIR_CD(+)
AND		A.SLAN_CD = CS.SLAN_CD(+)
AND		A.ST_PORT_CD = CS.VPS_PORT_CD(+)
AND 	A.VSL_CD = CE.VSL_CD(+)
AND		A.SKD_VOY_NO = CE.SKD_VOY_NO(+)
AND		A.SKD_DIR_CD = CE.SKD_DIR_CD(+)
AND		A.SLAN_CD = CE.SLAN_CD(+)
AND		A.FNL_PORT_CD = CE.VPS_PORT_CD(+)
ORDER BY 2,3,4,5
			]]></sql>
			<params>
				<param name="rev_yrmon" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
