<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PerformanceReportDBDAOSearchEBkgSiUploadStsListByDealyRSQL">
			<desc><![CDATA[e-BKG & S/I Upload Status Report - ESM_BKG_0226
Report Type이 Delay Report]]></desc>
			<sql><![CDATA[
--2.kind='Dealy'
--Delay_Report
  
  
SELECT DELAY_DATE.REGION_CD
,      DELAY_DATE.GSO
,      DELAY_DATE.BKG_OFC
,      DELAY_DATE.MON
,      TO_CHAR(DELAY_DATE.DELAY) DELAY
,      DELAY_DATE.BKG_TTL B_TTL
,      TO_CHAR(SUM(DECODE(DOC,'B',DECODE(STS,'N',0,1),0))) B_R
,      TO_CHAR(TRUNC((SUM(DECODE(DOC,'B',DECODE(STS,'N',0,1),0))/DECODE(DELAY_DATE.BKG_TTL,0,1,DELAY_DATE.BKG_TTL)),4)*100) || '%' B_PF
,      DELAY_DATE.SI_TTL S_TTL
,      TO_CHAR(SUM(DECODE(DOC,'S',DECODE(STS,'N',0,1),0))) S_R
,      TO_CHAR(TRUNC((SUM(DECODE(DOC,'S',DECODE(STS,'N',0,1),0))/DECODE(DELAY_DATE.SI_TTL,0,1,DELAY_DATE.SI_TTL)),4)*100) || '%' S_PF
,      DECODE(DELAY_DATE.DELAY,'3',1,'6',2,'12',3,'24',4,'48',5,6) SORT
FROM   (
        ------------------------------------------------------------------------------------------------------------------------- 
        SELECT  REGION_CD
        ,       GSO
        ,       BKG_OFC
        ,       MON
        ,       DOC_TP_CD DOC
        ,       BKG_UPLD_STS_CD STS
        ,       XTER_RQST_NO REF_NO
        ,       BKG_NO
        ,       LS_FROM_DT
        ,       LS_TO_DT
        ,       POR_CD
        ,       POL_CD
        ,       POD_CD
        ,       DEL_CD
        ,       DECODE(TO_CHAR(TRUNC(BKG_E_BKG_DELAY_TIME_FNC(B.CNT_CD, TO_DATE(LS_FROM_DT,'YYYY-MM-DD HH24:MI:SS'), TO_DATE(LS_TO_DT,'YYYY-MM-DD HH24:MI:SS'))/3)) ,'0','3','1','6','2','12','3','12','4','24','5','24','6','24','7','24','8','48','9','48','10','48','11','48','12','48','13','48','14','48','15','48','OVER 48' ) DELAY
        FROM   
                                    ----B START--------------------------------------------------------------------------------------------------------------------- 
                                    (SELECT  AAA.REGION_CD
                                    ,       AAA.GSO
                                    ,       AAA.BKG_OFC

#if (${duration} == 'M') 
	#if (${duration_month} != '') 
									,       TO_CHAR(TO_DATE(@[duration_year] ||  @[duration_month] || '01','YYYY-MM-DD'),'YYYY-MM') MON
	#end
#end
#if (${duration} == 'W') 
	#if (${duration_from_week} != '') 
									,		TO_CHAR(BKG_GET_CONV_DT_FNC('FR_WEEK',@[duration_year],@[duration_from_week]),'YYYY-MM') MON
	#end
	
#end

#if (${duration} == 'D') 
	#if (${duration_from_dt} != '') 
								  	 ,       TO_CHAR(TO_DATE(@[duration_from_dt],'YYYY-MM-DD'),'YYYY-MM') MON
	#end

#end

                                    ,       AAA.DOC_TP_CD
                                    ,       AAA.BKG_UPLD_STS_CD
                                    ,       AAA.XTER_RQST_NO
                                    ,       AAA.BKG_NO
                                    ,       AAA.LS_FROM_DT
                                    ,       AAA.LS_TO_DT
                                    ,       BBB.CNT_CD
                                    ,       AAA.POR_CD
                                    ,       AAA.POL_CD
                                    ,       AAA.POD_CD
                                    ,       AAA.DEL_CD
                                    ,       DECODE(TO_CHAR(TO_DATE(LS_FROM_DT,'YYYY-MM-DD HH24:MI:SS'),'D'),1,TO_DATE(SUBSTR(LS_FROM_DT,1,10),'YYYY-MM-DD')+1.375,7,TO_DATE(SUBSTR(LS_FROM_DT,1,10),'YYYY-MM-DD')+2.375,TO_DATE(LS_FROM_DT,'YYYY-MM-DD HH24:MI:SS')) FF_DT
                                    ,       DECODE(TO_CHAR(TO_DATE(LS_TO_DT,'YYYY-MM-DD HH24:MI:SS'),'D'),1,TO_DATE(SUBSTR(LS_TO_DT,1,10),'YYYY-MM-DD')+1.375,7,TO_DATE(SUBSTR(LS_TO_DT,1,10),'YYYY-MM-DD')+2.375,TO_DATE(LS_TO_DT,'YYYY-MM-DD HH24:MI:SS')) TT_DT
                                    FROM (
                                            -----AAA START-------------------------------------------------------------------------------------------------------------------- 
                                            SELECT A_IB.REGION_CD
                                            ,      AIBKG.XTER_RQST_NO
                                            ,      AIBKG.XTER_RQST_SEQ
                                            ,      AIBKG.BKG_NO
                                            ,      A_IB.GSO
                                            ,      A_IB.BKG_OFC
                                            ,      TO_CHAR(DECODE(A_IB.BKG_OFC,'PHXSA', AIBKG.RQST_DT - 0.125, 'MAASO', AIBKG.RQST_DT -0.1042,'JKTBA', AIBKG.RQST_DT -0.0417,AIBKG.RQST_DT),'YYYY-MM-DD HH24:MI:SS') LS_FROM_DT
                                            ,      NVL(TO_CHAR(DECODE(A_IB.BKG_OFC,'PHXSA', MIN(AIBKG.UPLD_DT) - 0.125, 'MAASO', MIN(AIBKG.UPLD_DT) -0.1042, 'JKTBA', MIN(AIBKG.UPLD_DT) -0.0417, MIN(AIBKG.UPLD_DT)),'YYYY-MM-DD HH24:MI:SS'),TO_CHAR(SYSDATE,'YYYY-MM-DD HH24:MI:SS')) LS_TO_DT
                                            ,      AIBKG.DOC_TP_CD
                                            ,      A_IB.BKG_UPLD_STS_CD
                                            ,      A_IB.POR_CD
                                            ,      A_IB.POL_CD
                                            ,      A_IB.POD_CD
                                            ,      A_IB.DEL_CD
                                            FROM BKG_XTER_RQST_MST AIBKG
                                                 -----A_IB START--------------------------------------------------------------------------------------------------------------------                                            
                                            ,    ( SELECT IB_NO.REGION_CD
                                                 ,        IBKG.XTER_RQST_NO
                                                 ,        IBKG.XTER_RQST_SEQ
                                                 ,        IBKG.BKG_NO
                                                 ,        MAX(IBKG.UPLD_DT)  UPLD_DT
                                                 ,        IB_NO.BKG_OFC 
                                                 ,        IB_NO.GSO
                                                 ,        IB_NO.DOC_TP_CD
                                                 ,        IB_NO.BKG_STS_CD
                                                 ,        DECODE(MAX(DECODE(NVL(IBKG.BKG_UPLD_STS_CD,'A'),'F','D','R','C','D','B','A')),'A','N','B','D','C','R','D','F') BKG_UPLD_STS_CD 
                                                            /* A - PENDING, B - DELETE, C - REJECT, D - FORM */
                                                 ,        IB_NO.POR_CD
                                                 ,        IB_NO.POL_CD
                                                 ,        IB_NO.POD_CD
                                                 ,        IB_NO.DEL_CD
                                                 FROM BKG_XTER_RQST_MST IBKG
                                                     ------IB_NO START------------------------------------------------------------------------------------------------------------------- 
                                                 ,   ( SELECT	A.XTER_RQST_NO  
                                                       ,      OFC.REGION REGION_CD
                                                       ,      A.BKG_OFC_CD BKG_OFC 
					   								   ,	  OFC.GSO GSO
                                                       ,      A.BKG_NO
                                                       ,      A.DOC_TP_CD
                                                       ,      A.BKG_STS_CD
                                                       ,      A.POR_CD
                                                       ,      A.POL_CD
                                                       ,      A.POD_CD
                                                       ,      A.DEL_CD
                                                        FROM	(
                                                                ----A START--------------------------------------------------------------------------------------------------------------------- 
                                                            		SELECT	A.XTER_RQST_NO
                                                                ,       A.DOC_TP_CD
                                                                ,       BKG.BKG_STS_CD
                                                                ,       A.XTER_RQST_SEQ
                                                                ,       A.BKG_NO
                                                                ,       NVL(CUSTS.CUST_CNT_CD,  NVL(A.PRNT_CNT_CD,  B.CNT_CD )) CNT_CDH 
                                                                ,       NVL(CUSTS.CUST_SEQ, NVL(A.PRNT_CUST_SEQ, B.CUST_SEQ)) CUST_CDH 
                                                                ,       BKG.BKG_OFC_CD              
                                                                ,       A.POR_CD   IB_POR_CD       
                                                                ,       A.POL_CD   IB_POL_CD        
                                                                ,       A.POD_CD   IB_POD_CD        
                                                                ,       A.DEL_CD   IB_DEL_CD        
                                                                ,       A.UPLD_DT                  
                                                                ,       DECODE(NVL(BKG.POR_CD,' '),' ',A.POR_CD,BKG.POR_CD) POR_CD 
                                                                ,       DECODE(NVL(BKG.POL_CD,' '),' ',A.POL_CD,BKG.POL_CD) POL_CD 
                                                                ,       DECODE(NVL(BKG.POD_CD,' '),' ',A.POD_CD,BKG.POD_CD) POD_CD 
                                                                ,       DECODE(NVL(BKG.DEL_CD,' '),' ',A.DEL_CD,BKG.DEL_CD) DEL_CD 
                                                                FROM		BKG_XTER_RQST_MST A 
                                                                ,       BKG_XTER_CUST B  
                                                                ,       BKG_BOOKING BKG  
                                                                ,       BKG_CUSTOMER CUSTS 
                                                                WHERE		B.XTER_RQST_NO(+) = A.XTER_RQST_NO 
                                                                AND		  B.XTER_RQST_SEQ(+) = A.XTER_RQST_SEQ 
																AND    		B.XTER_SNDR_ID(+) = A.XTER_SNDR_ID
                                                                AND		  A.XTER_BKG_RQST_STS_CD != 'T' 
                                                                AND		  B.XTER_CUST_TP_CD      = 'S' 
                                                                AND		  A.BKG_NO = BKG.BKG_NO(+)   
                                                                AND		  A.BKG_NO = CUSTS.BKG_NO(+)  
                                                                AND		  CUSTS.BKG_CUST_TP_CD  = 'S'  
                                                                AND		  NVL(A.XTER_BL_TP_CD,' ') != 'H'  
                                                                AND     A.DOC_TP_CD IN ('B','S')  

#if (${doc_tp_b} != '' && ${doc_tp_s} == '') 
								  								AND     A.DOC_TP_CD = @[doc_tp_b]
#end
#if (${doc_tp_s} != '' && ${doc_tp_b} == '') 
								  								AND     A.DOC_TP_CD = @[doc_tp_s]
#end
                                                                AND     A.DOC_TP_CD  NOT IN ('F')         
                                                                AND     A.XTER_BKG_RQST_STS_CD IN ('C','U','X')    

#if (${duration} == 'M') 
	#if (${duration_month} != '') 
									AND    A.RQST_DT >= BKG_GET_CONV_DT_FNC('FR_MON',@[duration_year],@[duration_month])
									AND    A.RQST_DT <= BKG_GET_CONV_DT_FNC('TO_MON',@[duration_year],@[duration_month]) + 0.99999
	#end
#end
#if (${duration} == 'W') 
	#if (${duration_from_week} != '') 
									AND    A.RQST_DT>= BKG_GET_CONV_DT_FNC('FR_WEEK',@[duration_year],@[duration_from_week])
	#end
	#if (${duration_to_week} != '')         
       							 	AND    A.RQST_DT <= BKG_GET_CONV_DT_FNC('TO_WEEK',@[duration_year],@[duration_to_week]) + 0.99999
	#end
#end

#if (${duration} == 'D') 
	#if (${duration_from_dt} != '') 
								  	AND    A.RQST_DT   >= TO_DATE(@[duration_from_dt], 'YYYY-MM-DD') 
	#end

	#if (${duration_to_dt} != '') 
								  	AND    A.RQST_DT <= TO_DATE(@[duration_to_dt], 'YYYY-MM-DD') + 0.99999 
	#end  
#end

#if (${bkg_upld_sts_cd} != 'All' && ${bkg_upld_sts_cd} != '') 
       AND A.BKG_UPLD_STS_CD IN ( ${bkg_upld_sts_cd} )
#end

#if (${bkg_ofc} != '') 
								  								AND     BKG.BKG_OFC_CD = @[bkg_ofc]
#end
#if (${sal_ofc} != '') 
                                 								AND     BKG.OB_SLS_OFC_CD = @[sal_ofc]-- SALES OFFICE         
#end
#if (${por_cd} != '') 
								  								AND     A.POR_CD = @[por_cd]
#end
#if (${pol_cd} != '') 
                              	  								AND     A.POL_CD = @[pol_cd]
#end
#if (${pod_cd} != '') 
                              	  								AND     A.POD_CD = @[pod_cd]
#end
#if (${del_cd} != '') 
                              	  								AND     A.DEL_CD = @[del_cd]
#end
                                                                
																) A
                                                                ----A END--------------------------------------------------------------------------------------------------------------------- 
                                                        ,(      SELECT MC.* 
                                                                FROM    MDM_CUSTOMER MC   
                                                                WHERE   MC.NMD_CUST_FLG != 'Y' 
                                                                ) CUSTH
                                                                ----OFC START--------------------------------------------------------------------------------------------------------------------- 
                                                        ,       BKG_OFC_LVL_V OFC
                                                                -----OFC END--------------------------------------------------------------------------------------------------------------------                             
                                                        WHERE	  A.CNT_CDH	=	CUSTH.CUST_CNT_CD(+)
                                                        AND	    A.CUST_CDH	=	CUSTH.CUST_SEQ(+)
                                                        AND     A.BKG_OFC_CD = OFC.OFC_CD --MDM_LOCATION
#if (${region_cd} != '') 								AND     OFC.REGION = @[region_cd]  --REGION  
#end
				
#if (${gso} != '') 
														AND		OFC.GSO	=	@[gso]
#end	  
                                                         
                                                        GROUP BY    A.XTER_RQST_NO,OFC.REGION, A.BKG_OFC_CD
                                                                    ,A.BKG_NO
																	,OFC.GSO
											                       ,A.DOC_TP_CD, A.BKG_STS_CD,A.POR_CD, A.POL_CD, A.POD_CD, A.DEL_CD, A.XTER_RQST_SEQ
                                                        ) IB_NO
                                                        ----IB_NO END---------------------------------------------------------------------------------------------------------------------          
                                              WHERE     IBKG.XTER_RQST_NO = IB_NO.XTER_RQST_NO
                                              AND       IBKG.XTER_RQST_NO = IB_NO.XTER_RQST_NO
                                              AND       IBKG.BKG_NO       = IB_NO.BKG_NO
                                              AND       IBKG.DOC_TP_CD    = IB_NO.DOC_TP_CD  
											  AND       IBKG.BKG_UPLD_STS_CD <> 'D'

#if (${duration} == 'M') 
	#if (${duration_month} != '') 
									AND    IBKG.RQST_DT >= BKG_GET_CONV_DT_FNC('FR_MON',@[duration_year],@[duration_month])
									AND    IBKG.RQST_DT <= BKG_GET_CONV_DT_FNC('TO_MON',@[duration_year],@[duration_month]) + 0.99999
	#end
#end
#if (${duration} == 'W') 
	#if (${duration_from_week} != '') 
									AND    IBKG.RQST_DT>= BKG_GET_CONV_DT_FNC('FR_WEEK',@[duration_year],@[duration_from_week])
	#end
	#if (${duration_to_week} != '')         
       							 	AND    IBKG.RQST_DT <= BKG_GET_CONV_DT_FNC('TO_WEEK',@[duration_year],@[duration_to_week]) + 0.99999
	#end
#end

#if (${duration} == 'D') 
	#if (${duration_from_dt} != '') 
								  	AND    IBKG.RQST_DT   >= TO_DATE(@[duration_from_dt], 'YYYY-MM-DD') 
	#end

	#if (${duration_to_dt} != '') 
								  	AND    IBKG.RQST_DT <= TO_DATE(@[duration_to_dt], 'YYYY-MM-DD') + 0.99999 
	#end  
#end
        
                                              AND       XTER_BKG_RQST_STS_CD IN ('C','U','X')
                                              GROUP BY  IB_NO.REGION_CD,IBKG.XTER_RQST_NO, IBKG.BKG_NO,  IB_NO.BKG_OFC, IB_NO.GSO
                                                       ,IB_NO.DOC_TP_CD, IB_NO.BKG_STS_CD,
                                                        IB_NO.POR_CD, IB_NO.POL_CD, IB_NO.POD_CD, IB_NO.DEL_CD,IBKG.XTER_RQST_SEQ
                                              ) A_IB
                                              -----A_IB END--------------------------------------------------------------------------------------------------------------------          
                                                
                                      WHERE     AIBKG.XTER_RQST_NO = A_IB.XTER_RQST_NO
                                      AND       AIBKG.XTER_RQST_SEQ = A_IB.XTER_RQST_SEQ
                                      AND       AIBKG.BKG_NO = A_IB.BKG_NO
#if (${duration} == 'M') 
	#if (${duration_month} != '') 
									AND    AIBKG.UPLD_DT >= BKG_GET_CONV_DT_FNC('FR_MON',@[duration_year],@[duration_month])
									AND    AIBKG.UPLD_DT <= BKG_GET_CONV_DT_FNC('TO_MON',@[duration_year],@[duration_month]) + 0.99999
	#end
#end
#if (${duration} == 'W') 
	#if (${duration_from_week} != '') 
									AND    AIBKG.UPLD_DT >= BKG_GET_CONV_DT_FNC('FR_WEEK',@[duration_year],@[duration_from_week])
	#end
	#if (${duration_to_week} != '')         
       							 	AND    AIBKG.UPLD_DT <= BKG_GET_CONV_DT_FNC('TO_WEEK',@[duration_year],@[duration_to_week]) + 0.99999
	#end
#end

#if (${duration} == 'D') 
	#if (${duration_from_dt} != '') 
								  	AND    AIBKG.UPLD_DT   >= TO_DATE(@[duration_from_dt], 'YYYY-MM-DD') 
	#end

	#if (${duration_to_dt} != '') 
								  	AND    AIBKG.UPLD_DT <= TO_DATE(@[duration_to_dt], 'YYYY-MM-DD') + 0.99999 
	#end  
#end

                                       AND       AIBKG.DOC_TP_CD = A_IB.DOC_TP_CD
                                      GROUP BY  A_IB.REGION_CD
                                      ,         AIBKG.XTER_RQST_NO
                                      ,         AIBKG.XTER_RQST_SEQ
                                      ,         AIBKG.BKG_NO
                                      ,         A_IB.GSO
                                      ,         A_IB.BKG_OFC
                                      ,         TO_CHAR(DECODE(A_IB.BKG_OFC,'PHXSA', AIBKG.RQST_DT - 0.125,'MAASO', AIBKG.RQST_DT -0.1042,'JKTBA', AIBKG.RQST_DT -0.0417,AIBKG.RQST_DT),'YYYY-MM-DD HH24:MI:SS')
                                      ,         AIBKG.DOC_TP_CD
                                      ,         A_IB.BKG_UPLD_STS_CD
                                      ,         A_IB.POR_CD
                                      ,         A_IB.POL_CD
                                      ,         A_IB.POD_CD
                                      ,         A_IB.DEL_CD
                                      ORDER BY  BKG_OFC ) AAA
                                      -----AAA END --------------------------------------------------------------------------------------------------------------------          
                              ,       MDM_LOCATION BBB
                              ,       MDM_ORGANIZATION CCC
                              WHERE   AAA.BKG_OFC = CCC.OFC_CD
                              AND     CCC.LOC_CD = BBB.LOC_CD
                              ) B
                              ---B END----------------------------------------------------------------------------------------------------------------------          
                      ) DELAY_RT
     ------DELAY_RT END-------------------------------------------------------------------------------------------------------------------                               
     ------DELAY_DATE START-------------------------------------------------------------------------------------------------------------------                               
,(    SELECT A.REGION_CD
      ,      A.GSO
      ,      A.BKG_OFC
      ,      B.DELAY
      
#if (${duration} == 'M') 
	#if (${duration_month} != '') 
		,       TO_CHAR(TO_DATE(@[duration_year] ||  @[duration_month] || '01','YYYY-MM-DD'),'YYYY-MM') MON
	#end
#end
#if (${duration} == 'W') 
	#if (${duration_from_week} != '') 
		,		TO_CHAR(BKG_GET_CONV_DT_FNC('FR_WEEK',@[duration_year],@[duration_from_week]),'YYYY-MM') MON
	#end
	
#end

#if (${duration} == 'D') 
	#if (${duration_from_dt} != '') 
		,       TO_CHAR(TO_DATE(@[duration_from_dt],'YYYY-MM-DD'),'YYYY-MM') MON
	#end

#end
      ,      A.BKG_TTL BKG_TTL
      ,      A.SI_TTL SI_TTL
             ----A START ---------------------------------------------------------------------------------------------------------------------                    
      FROM   (SELECT  IB_NO.REGION_CD
             ,        IB_NO.GSO
             ,        IB_NO.BKG_OFC
             ,        SUM(B_D) BKG_TTL
             ,        SUM(S_D) SI_TTL
             FROM     (
                      -------IB_NO START ------------------------------------------------------------------------------------------------------------------                    
                      SELECT  OFC.REGION REGION_CD
                      ,        A.XTER_RQST_NO
                      ,        A.BKG_OFC_CD BKG_OFC
					  ,		   OFC.GSO GSO
                      ,        DECODE(A.DOC_TP_CD,'B',1,0) B_D
                      ,        DECODE(A.DOC_TP_CD,'S',1,0) S_D
                      ,        A.DOC_TP_CD
                      ,        A.BKG_NO
                               -----A START--------------------------------------------------------------------------------------------------------------------                    
                       FROM	(
                                ----A START--------------------------------------------------------------------------------------------------------------------- 
                            		SELECT	A.XTER_RQST_NO
                                ,       A.DOC_TP_CD
                                ,       BKG.BKG_STS_CD
                                ,       A.XTER_RQST_SEQ
                                ,       A.BKG_NO
                                ,       NVL(CUSTS.CUST_CNT_CD,  NVL(A.PRNT_CNT_CD,  B.CNT_CD )) CNT_CDH 
                                ,       NVL(CUSTS.CUST_SEQ, NVL(A.PRNT_CUST_SEQ, B.CUST_SEQ)) CUST_CDH 
                                ,       BKG.BKG_OFC_CD              
                                ,       A.POR_CD   IB_POR_CD       
                                ,       A.POL_CD   IB_POL_CD        
                                ,       A.POD_CD   IB_POD_CD        
                                ,       A.DEL_CD   IB_DEL_CD        
                                ,       A.UPLD_DT                  
                                ,       DECODE(NVL(BKG.POR_CD,' '),' ',A.POR_CD,BKG.POR_CD) POR_CD 
                                ,       DECODE(NVL(BKG.POL_CD,' '),' ',A.POL_CD,BKG.POL_CD) POL_CD 
                                ,       DECODE(NVL(BKG.POD_CD,' '),' ',A.POD_CD,BKG.POD_CD) POD_CD 
                                ,       DECODE(NVL(BKG.DEL_CD,' '),' ',A.DEL_CD,BKG.DEL_CD) DEL_CD 
                                FROM		BKG_XTER_RQST_MST A 
                                ,       BKG_XTER_CUST B  
                                ,       BKG_BOOKING BKG  
                                ,       BKG_CUSTOMER CUSTS 
                                WHERE		B.XTER_RQST_NO(+) = A.XTER_RQST_NO 
                                AND		  B.XTER_RQST_SEQ(+) = A.XTER_RQST_SEQ 
								AND    		B.XTER_SNDR_ID(+) = A.XTER_SNDR_ID
                                AND		  A.XTER_BKG_RQST_STS_CD != 'T' 
                                AND		  B.XTER_CUST_TP_CD      = 'S' 
                                AND		  A.BKG_NO = BKG.BKG_NO(+)   
                                AND		  A.BKG_NO = CUSTS.BKG_NO(+)  
                                AND		  CUSTS.BKG_CUST_TP_CD  = 'S'  
                                AND		  NVL(A.XTER_BL_TP_CD,' ') != 'H'  
                                AND     A.DOC_TP_CD IN ('B','S')  
#if (${doc_tp_b} != '' && ${doc_tp_s} == '') 
								AND     A.DOC_TP_CD = @[doc_tp_b]
#end
#if (${doc_tp_s} != '' && ${doc_tp_b} == '') 
								AND     A.DOC_TP_CD = @[doc_tp_s]
#end
                                AND     A.DOC_TP_CD  NOT IN ('F')         
                                AND     A.XTER_BKG_RQST_STS_CD IN ('C','U','X')    

#if (${duration} == 'M') 
	#if (${duration_month} != '') 
								AND    A.RQST_DT >= BKG_GET_CONV_DT_FNC('FR_MON',@[duration_year],@[duration_month])
								AND    A.RQST_DT <= BKG_GET_CONV_DT_FNC('TO_MON',@[duration_year],@[duration_month]) + 0.99999
	#end
#end
#if (${duration} == 'W') 
	#if (${duration_from_week} != '') 
								AND    A.RQST_DT>= BKG_GET_CONV_DT_FNC('FR_WEEK',@[duration_year],@[duration_from_week])
	#end
	#if (${duration_to_week} != '')         
       							AND    A.RQST_DT <= BKG_GET_CONV_DT_FNC('TO_WEEK',@[duration_year],@[duration_to_week])
	#end
#end

#if (${duration} == 'D') 
	#if (${duration_from_dt} != '') 
								AND    A.RQST_DT   >= TO_DATE(@[duration_from_dt], 'YYYY-MM-DD') 
	#end

	#if (${duration_to_dt} != '') 
								AND    A.RQST_DT <= TO_DATE(@[duration_to_dt], 'YYYY-MM-DD') + 0.99999 
	#end  
#end
#if (${bkg_upld_sts_cd} != 'All' && ${bkg_upld_sts_cd} != '') 
       AND A.BKG_UPLD_STS_CD IN ( ${bkg_upld_sts_cd} )
#end
#if (${bkg_ofc} != '') 
								AND     BKG.BKG_OFC_CD = @[bkg_ofc]
#end
#if (${sal_ofc} != '') 
                                AND     BKG.OB_SLS_OFC_CD = @[sal_ofc]-- SALES OFFICE         
#end
#if (${por_cd} != '') 
								AND     A.POR_CD = @[por_cd]
#end
#if (${pol_cd} != '') 
                              	AND     A.POL_CD = @[pol_cd]
#end
#if (${pod_cd} != '') 
                              	AND     A.POD_CD = @[pod_cd]
#end
#if (${del_cd} != '') 
                        		AND     A.DEL_CD = @[del_cd]
#end

                                ) A
                                ----A END--------------------------------------------------------------------------------------------------------------------- 
                        ,(      SELECT MC.* 
                                FROM    MDM_CUSTOMER MC   
                                WHERE   MC.NMD_CUST_FLG != 'Y' 
                                ) CUSTH
                                ----OFC START--------------------------------------------------------------------------------------------------------------------- 
                        ,       BKG_OFC_LVL_V OFC
                                -----OFC END--------------------------------------------------------------------------------------------------------------------                             
                        WHERE	  A.CNT_CDH	=	CUSTH.CUST_CNT_CD(+)
                        AND	    A.CUST_CDH	=	CUSTH.CUST_SEQ(+)
                        AND     A.BKG_OFC_CD = OFC.OFC_CD --MDM_LOCATION
#if (${region_cd} != '') 
					  	AND     OFC.REGION = @[region_cd]  --REGION  
#end
				
#if (${gso} != '') 
						AND		OFC.GSO =	@[gso]
#end	  
                       
                        GROUP BY    OFC.REGION,A.XTER_RQST_NO
									, A.BKG_OFC_CD
									,A.BKG_NO
									,OFC.GSO
                                  ,A.DOC_TP_CD, A.BKG_STS_CD,A.POR_CD, A.POL_CD, A.POD_CD, A.DEL_CD
                        ) IB_NO
                        ------IB_NO END-------------------------------------------------------------------------------------------------------------------                             
              GROUP BY IB_NO.REGION_CD,IB_NO.GSO, IB_NO.BKG_OFC ) A
              -----A END--------------------------------------------------------------------------------------------------------------------                    
      ,     ( SELECT '3' DELAY FROM DUAL
              UNION ALL
              SELECT '6' DELAY FROM DUAL
              UNION ALL
              SELECT '12' DELAY FROM DUAL
              UNION ALL
              SELECT '24' DELAY FROM DUAL
              UNION ALL
              SELECT '48' DELAY FROM DUAL
              UNION ALL
              SELECT 'OVER 48' DELAY FROM DUAL ) B 
              -----B END-------------------------------------------------------------------------------------------------------------------- 
     ) DELAY_DATE                   
     -----DELAY_DATE END-------------------------------------------------------------------------------------------------------------------- 
WHERE     DELAY_RT.GSO (+) = DELAY_DATE.GSO
AND       DELAY_RT.BKG_OFC (+) = DELAY_DATE.BKG_OFC
AND       DELAY_RT.MON (+) = DELAY_DATE.MON
AND       DELAY_RT.DELAY (+) = DELAY_DATE.DELAY
GROUP BY  DELAY_DATE.REGION_CD,DELAY_DATE.GSO, DELAY_DATE.BKG_OFC, DELAY_DATE.MON, DELAY_DATE.DELAY, DELAY_DATE.BKG_TTL, DELAY_DATE.SI_TTL, DECODE(DELAY_DATE.DELAY,'3',1,'6',2,'12',3,'24',4,'48',5,6) 
ORDER BY  DELAY_DATE.REGION_CD,DELAY_DATE.GSO, DELAY_DATE.BKG_OFC, DELAY_DATE.MON, DECODE(DELAY_DATE.DELAY,'3',1,'6',2,'12',3,'24',4,'48',5,6)			]]></sql>
			<params>
				<param name="duration_year" type="12" value="" out="N"/>
				<param name="duration_month" type="12" value="" out="N"/>
				<param name="duration_from_week" type="12" value="" out="N"/>
				<param name="duration_from_dt" type="12" value="" out="N"/>
				<param name="doc_tp_b" type="12" value="" out="N"/>
				<param name="doc_tp_s" type="12" value="" out="N"/>
				<param name="duration_to_week" type="12" value="" out="N"/>
				<param name="duration_to_dt" type="12" value="" out="N"/>
				<param name="bkg_ofc" type="12" value="" out="N"/>
				<param name="sal_ofc" type="12" value="" out="N"/>
				<param name="por_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
				<param name="region_cd" type="12" value="" out="N"/>
				<param name="gso" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
