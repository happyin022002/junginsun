/*=========================================================
*Copyright(c) 2017 CyberLogitec
*@FileName : QtaAdjustmentDBDAOCreatePotnAdjustmentCSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2017.01.18
*@LastModifier : 
*@LastVersion : 1.0
* 2017.01.18 
* 1.0 Creation
=========================================================*/
package com.hanjin.apps.alps.esm.sqm.adjustment.qtaadjustment.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.hanjin.framework.support.db.ISQLTemplate;

/**
 *
 * @author 
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class QtaAdjustmentDBDAOCreatePotnAdjustmentCSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * [QTA Adjustment by VVD]
	  * [Portion Adjustment by Head Office]
	  * [Portion Adjustment by RHQ] 에서 확정데이터를 [재생성] 합니다
	  * 
	  * * 2014.01.09 박은주 [CHM-201428372] SELBB, TYOBB 조직 LEVEL 변경 건
	  * * 2014.09.11 이혜민 [CHM-201431936] 신규 Office Add시 Alloc받은 VVD에 상관없이 I로 insert가 되는 문제 수정
	  * * 2015.02.27 이혜민 Creation시 Week 기준이던 것을 SLS_YR+BSE_WK 로 기준으로 변경
	  * * 2015.06.15 김용습 [CHM-201536164] 주간 MAS Open에 따른 타모듈 프로그램 적용 요청
	  * * 2015.08.10 김용습 [CHM-201536994] Split24-[그룹사 표준 코드 시행] SML 프로그램 대응 및 데이타 마이그레이션 작업 요청
	  * 2016.03.22 CHM-201640708 Office별 포션 자동 입력 로직 수정
	  * 2016.05.18 잘못된 주차 PORTION을 읽는 버그 수정
	  * 2016.06.15 SELCMI 예외처리로직 추가
	  * </pre>
	  */
	public QtaAdjustmentDBDAOCreatePotnAdjustmentCSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_ofc_vw_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_usr_id",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("mas_vvd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_bse_tp_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_bse_qtr_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_bse_yr",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("rlane_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_trd_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_dir_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_conv_dir_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_trd_dir",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("ofc_cd",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.hanjin.apps.alps.esm.sqm.adjustment.qtaadjustment.integration").append("\n"); 
		query.append("FileName : QtaAdjustmentDBDAOCreatePotnAdjustmentCSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("INSERT INTO SQM_CFM_QTA (" ).append("\n"); 
		query.append("     QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("    ,BSE_TP_CD" ).append("\n"); 
		query.append("    ,BSE_YR" ).append("\n"); 
		query.append("    ,BSE_QTR_CD" ).append("\n"); 
		query.append("    ,OFC_VW_CD" ).append("\n"); 
		query.append("    ,QTA_TGT_CD" ).append("\n"); 
		query.append("    ,TRD_CD" ).append("\n"); 
		query.append("    ,RLANE_CD" ).append("\n"); 
		query.append("    ,DIR_CD" ).append("\n"); 
		query.append("    ,VSL_CD" ).append("\n"); 
		query.append("    ,SKD_VOY_NO" ).append("\n"); 
		query.append("    ,SKD_DIR_CD" ).append("\n"); 
		query.append("    ,RGN_OFC_CD" ).append("\n"); 
		query.append("    ,RHQ_CD" ).append("\n"); 
		query.append("    ,AQ_CD" ).append("\n"); 
		query.append("    ,CONV_DIR_CD" ).append("\n"); 
		query.append("    ,LOD_QTY" ).append("\n"); 
		query.append("    ,GRS_RPB_REV" ).append("\n"); 
		query.append("    ,PA_CM_UC_AMT" ).append("\n"); 
		query.append("    ,RA_CM_UC_AMT" ).append("\n"); 
		query.append("    ,SQM_CNG_TP_CD" ).append("\n"); 
		query.append("    ,CRE_USR_ID" ).append("\n"); 
		query.append("    ,CRE_DT" ).append("\n"); 
		query.append("    ,UPD_USR_ID" ).append("\n"); 
		query.append("    ,UPD_DT" ).append("\n"); 
		query.append(") " ).append("\n"); 
		query.append("#if (${ibflag} == 'I')" ).append("\n"); 
		query.append("SELECT Q.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("      ,Q.BSE_TP_CD" ).append("\n"); 
		query.append("      ,Q.BSE_YR" ).append("\n"); 
		query.append("      ,Q.BSE_QTR_CD" ).append("\n"); 
		query.append("      ,Q.OFC_VW_CD" ).append("\n"); 
		query.append("      ,Q.QTA_TGT_CD" ).append("\n"); 
		query.append("      ,Q.TRD_CD" ).append("\n"); 
		query.append("      ,Q.RLANE_CD" ).append("\n"); 
		query.append("      ,Q.DIR_CD" ).append("\n"); 
		query.append("      ,SUBSTR(@[mas_vvd], 1, 4) AS VSL_CD    " ).append("\n"); 
		query.append("      ,SUBSTR(@[mas_vvd], 5, 4) AS SKD_VOY_NO" ).append("\n"); 
		query.append("      ,SUBSTR(@[mas_vvd], 9, 1) AS SKD_DIR_CD" ).append("\n"); 
		query.append("      ,Q.RGN_OFC_CD" ).append("\n"); 
		query.append("      ,Q.RHQ_CD" ).append("\n"); 
		query.append("      ,Q.AQ_CD" ).append("\n"); 
		query.append("      ,Q.CONV_DIR_CD" ).append("\n"); 
		query.append("      ,Q.LOD_QTY" ).append("\n"); 
		query.append("      ,Q.GRS_RPB_REV" ).append("\n"); 
		query.append("      ,Q.PA_CM_UC_AMT" ).append("\n"); 
		query.append("      ,Q.RA_CM_UC_AMT" ).append("\n"); 
		query.append("      ,Q.SQM_CNG_TP_CD" ).append("\n"); 
		query.append("      ,Q.CRE_USR_ID" ).append("\n"); 
		query.append("      ,Q.CRE_DT" ).append("\n"); 
		query.append("      ,Q.UPD_USR_ID" ).append("\n"); 
		query.append("      ,Q.UPD_DT" ).append("\n"); 
		query.append("  FROM (" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("SELECT QTA_RLSE_VER_NO" ).append("\n"); 
		query.append(",BSE_TP_CD " ).append("\n"); 
		query.append(",BSE_YR" ).append("\n"); 
		query.append(",BSE_QTR_CD" ).append("\n"); 
		query.append(",OFC_VW_CD" ).append("\n"); 
		query.append(",QTA_TGT_CD" ).append("\n"); 
		query.append(",TRD_CD" ).append("\n"); 
		query.append(",RLANE_CD" ).append("\n"); 
		query.append(",DIR_CD" ).append("\n"); 
		query.append(",VSL_CD" ).append("\n"); 
		query.append(",SKD_VOY_NO" ).append("\n"); 
		query.append(",SKD_DIR_CD" ).append("\n"); 
		query.append(",RGN_OFC_CD" ).append("\n"); 
		query.append(",DECODE(BSE_YR||BSE_QTR_CD, '20141Q', DECODE(RGN_OFC_CD, 'SELSC', 'SELIB', 'TYOSC', 'TYOIB', RHQ_CD), RHQ_CD) AS RHQ_CD" ).append("\n"); 
		query.append(",AQ_CD" ).append("\n"); 
		query.append(",CONV_DIR_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("--,RHQ_RNK" ).append("\n"); 
		query.append("--,LOD_RNK" ).append("\n"); 
		query.append("--,LOD_QTY" ).append("\n"); 
		query.append("--,DECODE(LOD_QTY, 0,0, OFC_REV/LOD_QTY) AS GRS_RPB_REV" ).append("\n"); 
		query.append(",CASE WHEN OLD_OFC_LOD = 0 AND LOD_RNK = 1 THEN LOD_QTY" ).append("\n"); 
		query.append("      ELSE OLD_OFC_LOD END AS LOD_QTY" ).append("\n"); 
		query.append(",CASE WHEN OLD_OFC_LOD = 0 AND LOD_RNK = 1 THEN NVL(TOTAL_REV*NVL(CFM_RATIO, NVL(PLAN_RATIO,0))/DECODE(LOD_QTY, 0, NULL, LOD_QTY), 0)" ).append("\n"); 
		query.append("      ELSE DECODE(OLD_OFC_LOD, 0,0, NVL(OLD_OFC_REV/DECODE(OLD_OFC_LOD,0,NULL,OLD_OFC_LOD),0)) END AS GRS_RPB_REV" ).append("\n"); 
		query.append("--,CASE WHEN LOD_QTY = 0 THEN 0" ).append("\n"); 
		query.append("--	WHEN RHQ_RNK||LOD_RNK = '11' THEN GRS_RPB_REV - NVL(((SUM(LOD_QTY*GRS_RPB_REV) OVER (PARTITION BY OFC_VW_CD, VSL_CD, SKD_VOY_NO, SKD_DIR_CD) - ( SELECT AA.GRS_REV FROM SQM_CFM_TGT_VVD AA" ).append("\n"); 
		query.append("--                                                                                            WHERE AA.QTA_RLSE_VER_NO = Z.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("--                                                                                            AND AA.BSE_TP_CD = Z.BSE_TP_CD" ).append("\n"); 
		query.append("--                                                                                            AND AA.BSE_YR = Z.BSE_YR" ).append("\n"); 
		query.append("--                                                                                            AND AA.BSE_QTR_CD = Z.BSE_QTR_CD" ).append("\n"); 
		query.append("--                                                                                            AND AA.TRD_CD = Z.TRD_CD" ).append("\n"); 
		query.append("--                                                                                            AND AA.RLANE_CD = Z.RLANE_CD" ).append("\n"); 
		query.append("--                                                                                            AND AA.DIR_CD = Z.DIR_CD" ).append("\n"); 
		query.append("--                                                                                            AND AA.VSL_CD = Z.VSL_CD" ).append("\n"); 
		query.append("--                                                                                            AND AA.SKD_VOY_NO = Z.SKD_VOY_NO" ).append("\n"); 
		query.append("--                                                                                            AND AA.SKD_DIR_CD = Z.SKD_DIR_CD" ).append("\n"); 
		query.append("--                                                                                            AND AA.QTA_TGT_CD = 'D'))/LOD_QTY),0)" ).append("\n"); 
		query.append("--    ELSE GRS_RPB_REV END AS GRS_RPB_REV" ).append("\n"); 
		query.append(",PA_CM_UC_AMT" ).append("\n"); 
		query.append(",RA_CM_UC_AMT" ).append("\n"); 
		query.append(",'I' AS SQM_CNG_TP_CD" ).append("\n"); 
		query.append(",@[f_usr_id] AS CRE_USR_ID" ).append("\n"); 
		query.append(",SYSDATE     AS CRE_DT" ).append("\n"); 
		query.append(",@[f_usr_id] AS UPD_USR_ID" ).append("\n"); 
		query.append(",SYSDATE     AS UPD_DT " ).append("\n"); 
		query.append("FROM" ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("        SELECT QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("              ,BSE_TP_CD " ).append("\n"); 
		query.append("              ,BSE_YR" ).append("\n"); 
		query.append("              ,BSE_QTR_CD" ).append("\n"); 
		query.append("              ,OFC_VW_CD" ).append("\n"); 
		query.append("              ,QTA_TGT_CD" ).append("\n"); 
		query.append("              ,TRD_CD" ).append("\n"); 
		query.append("              ,RLANE_CD" ).append("\n"); 
		query.append("              ,DIR_CD" ).append("\n"); 
		query.append("              ,VSL_CD" ).append("\n"); 
		query.append("              ,SKD_VOY_NO" ).append("\n"); 
		query.append("              ,SKD_DIR_CD" ).append("\n"); 
		query.append("              ,RGN_OFC_CD" ).append("\n"); 
		query.append("              ,DECODE(BSE_YR||BSE_QTR_CD, '20141Q', DECODE(RGN_OFC_CD, 'SELSC', 'SELIB', 'TYOSC', 'TYOIB', RHQ_CD), RHQ_CD) AS RHQ_CD" ).append("\n"); 
		query.append("              ,AQ_CD" ).append("\n"); 
		query.append("              ,CONV_DIR_CD" ).append("\n"); 
		query.append("              " ).append("\n"); 
		query.append("              ,RHQ_RNK" ).append("\n"); 
		query.append("              ,LOD_RNK" ).append("\n"); 
		query.append("              ,OLD_OFC_LOD" ).append("\n"); 
		query.append("              ,OLD_OFC_REV" ).append("\n"); 
		query.append("              ,TOTAL_REV" ).append("\n"); 
		query.append("--              ,LOD_QTY" ).append("\n"); 
		query.append("--              ,DECODE(LOD_QTY, 0,0, OFC_REV/LOD_QTY) AS GRS_RPB_REV" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("              ,(SELECT DISTINCT REV_POTN_RTO/100 FROM SQM_CFM_QTA_POTN_MGMT K" ).append("\n"); 
		query.append("                WHERE K.QTA_RLSE_VER_NO = Z.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                    AND K.BSE_TP_CD = Z.BSE_TP_CD" ).append("\n"); 
		query.append("                    AND K.BSE_YR = Z.BSE_YR" ).append("\n"); 
		query.append("                    AND K.BSE_QTR_CD = Z.BSE_QTR_CD" ).append("\n"); 
		query.append("                    AND K.OFC_VW_CD = Z.OFC_VW_CD" ).append("\n"); 
		query.append("                    AND K.QTA_STEP_CD = '02'" ).append("\n"); 
		query.append("                    AND K.TRD_CD = Z.TRD_CD" ).append("\n"); 
		query.append("                    AND K.RLANE_CD = Z.RLANE_CD" ).append("\n"); 
		query.append("                    AND K.DIR_CD = Z.DIR_CD" ).append("\n"); 
		query.append("                    AND K.RHQ_CD = Z.RHQ_CD" ).append("\n"); 
		query.append("                    AND K.RGN_OFC_CD = Z.RHQ_CD" ).append("\n"); 
		query.append("                    AND ROWNUM < 2" ).append("\n"); 
		query.append("                    AND VVD_WK BETWEEN SUBSTR(K.APLY_FM_YRWK, 5, 2) AND SUBSTR(K.APLY_TO_YRWK, 5, 2)) AS CFM_RATIO" ).append("\n"); 
		query.append("                    " ).append("\n"); 
		query.append("             ,(SELECT DISTINCT REV_POTN_RTO/100 FROM SQM_QTA_POTN_MGMT L" ).append("\n"); 
		query.append("                WHERE L.BSE_TP_CD = Z.BSE_TP_CD" ).append("\n"); 
		query.append("                    AND L.BSE_YR = Z.BSE_YR" ).append("\n"); 
		query.append("                    AND L.BSE_QTR_CD = Z.BSE_QTR_CD" ).append("\n"); 
		query.append("                    AND L.OFC_VW_CD = Z.OFC_VW_CD" ).append("\n"); 
		query.append("                    AND L.QTA_STEP_CD = '02'" ).append("\n"); 
		query.append("                    AND L.RHQ_CD = Z.RHQ_CD" ).append("\n"); 
		query.append("                    AND L.RGN_OFC_CD = Z.RHQ_CD" ).append("\n"); 
		query.append("                    AND L.TRD_CD = Z.TRD_CD" ).append("\n"); 
		query.append("                    AND L.RLANE_CD = Z.RLANE_CD" ).append("\n"); 
		query.append("                    AND L.DIR_CD = Z.DIR_CD" ).append("\n"); 
		query.append("                    AND ROWNUM < 2) AS PLAN_RATIO" ).append("\n"); 
		query.append("                    " ).append("\n"); 
		query.append("            ,CASE WHEN RHQ_RNK||LOD_RNK = '11' THEN LOD_QTY - " ).append("\n"); 
		query.append("                                                    ((SUM(LOD_QTY) OVER (PARTITION BY OFC_VW_CD, VSL_CD, SKD_VOY_NO, SKD_DIR_CD)) - " ).append("\n"); 
		query.append("                                                    (SELECT AA.LOD_QTY FROM SQM_CFM_TGT_VVD AA" ).append("\n"); 
		query.append("                                                    WHERE AA.QTA_RLSE_VER_NO = Z.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                    AND AA.BSE_TP_CD = Z.BSE_TP_CD" ).append("\n"); 
		query.append("                                                    AND AA.BSE_YR = Z.BSE_YR" ).append("\n"); 
		query.append("                                                    AND AA.BSE_QTR_CD = Z.BSE_QTR_CD" ).append("\n"); 
		query.append("                                                    AND AA.TRD_CD = Z.TRD_CD" ).append("\n"); 
		query.append("                                                    AND AA.RLANE_CD = Z.RLANE_CD" ).append("\n"); 
		query.append("                                                    AND AA.DIR_CD = Z.DIR_CD" ).append("\n"); 
		query.append("                                                    AND AA.VSL_CD = Z.VSL_CD" ).append("\n"); 
		query.append("                                                    AND AA.SKD_VOY_NO = Z.SKD_VOY_NO" ).append("\n"); 
		query.append("                                                    AND AA.SKD_DIR_CD = Z.SKD_DIR_CD" ).append("\n"); 
		query.append("                                                    AND AA.QTA_TGT_CD = 'D')) ELSE LOD_QTY END AS LOD_QTY" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("--            ,CASE WHEN RHQ_RNK||LOD_RNK = '11' THEN DECODE((LOD_QTY - " ).append("\n"); 
		query.append("--                                                    ((SUM(LOD_QTY) OVER (PARTITION BY OFC_VW_CD, VSL_CD, SKD_VOY_NO, SKD_DIR_CD)) - " ).append("\n"); 
		query.append("--                                                    (SELECT AA.LOD_QTY FROM SQM_CFM_TGT_VVD AA" ).append("\n"); 
		query.append("--                                                    WHERE AA.QTA_RLSE_VER_NO = Z.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("--                                                    AND AA.BSE_TP_CD = Z.BSE_TP_CD" ).append("\n"); 
		query.append("--                                                    AND AA.BSE_YR = Z.BSE_YR" ).append("\n"); 
		query.append("--                                                    AND AA.BSE_QTR_CD = Z.BSE_QTR_CD" ).append("\n"); 
		query.append("--                                                    AND AA.TRD_CD = Z.TRD_CD" ).append("\n"); 
		query.append("--                                                    AND AA.RLANE_CD = Z.RLANE_CD" ).append("\n"); 
		query.append("--                                                    AND AA.DIR_CD = Z.DIR_CD" ).append("\n"); 
		query.append("--                                                    AND AA.VSL_CD = Z.VSL_CD" ).append("\n"); 
		query.append("--                                                    AND AA.SKD_VOY_NO = Z.SKD_VOY_NO" ).append("\n"); 
		query.append("--                                                    AND AA.SKD_DIR_CD = Z.SKD_DIR_CD" ).append("\n"); 
		query.append("--                                                    AND AA.QTA_TGT_CD = 'D'))), 0,0, OFC_REV/(LOD_QTY - " ).append("\n"); 
		query.append("--                                                    ((SUM(LOD_QTY) OVER (PARTITION BY OFC_VW_CD, VSL_CD, SKD_VOY_NO, SKD_DIR_CD)) - " ).append("\n"); 
		query.append("--                                                    (SELECT AA.LOD_QTY FROM SQM_CFM_TGT_VVD AA" ).append("\n"); 
		query.append("--                                                    WHERE AA.QTA_RLSE_VER_NO = Z.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("--                                                    AND AA.BSE_TP_CD = Z.BSE_TP_CD" ).append("\n"); 
		query.append("--                                                    AND AA.BSE_YR = Z.BSE_YR" ).append("\n"); 
		query.append("--                                                    AND AA.BSE_QTR_CD = Z.BSE_QTR_CD" ).append("\n"); 
		query.append("--                                                    AND AA.TRD_CD = Z.TRD_CD" ).append("\n"); 
		query.append("--                                                    AND AA.RLANE_CD = Z.RLANE_CD" ).append("\n"); 
		query.append("--                                                    AND AA.DIR_CD = Z.DIR_CD" ).append("\n"); 
		query.append("--                                                    AND AA.VSL_CD = Z.VSL_CD" ).append("\n"); 
		query.append("--                                                    AND AA.SKD_VOY_NO = Z.SKD_VOY_NO" ).append("\n"); 
		query.append("--                                                    AND AA.SKD_DIR_CD = Z.SKD_DIR_CD" ).append("\n"); 
		query.append("--                                                    AND AA.QTA_TGT_CD = 'D')))) - DECODE((LOD_QTY - " ).append("\n"); 
		query.append("--                                                    ((SUM(LOD_QTY) OVER (PARTITION BY OFC_VW_CD, VSL_CD, SKD_VOY_NO, SKD_DIR_CD)) - " ).append("\n"); 
		query.append("--                                                    (SELECT AA.LOD_QTY FROM SQM_CFM_TGT_VVD AA" ).append("\n"); 
		query.append("--                                                    WHERE AA.QTA_RLSE_VER_NO = Z.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("--                                                    AND AA.BSE_TP_CD = Z.BSE_TP_CD" ).append("\n"); 
		query.append("--                                                    AND AA.BSE_YR = Z.BSE_YR" ).append("\n"); 
		query.append("--                                                    AND AA.BSE_QTR_CD = Z.BSE_QTR_CD" ).append("\n"); 
		query.append("--                                                    AND AA.TRD_CD = Z.TRD_CD" ).append("\n"); 
		query.append("--                                                    AND AA.RLANE_CD = Z.RLANE_CD" ).append("\n"); 
		query.append("--                                                    AND AA.DIR_CD = Z.DIR_CD" ).append("\n"); 
		query.append("--                                                    AND AA.VSL_CD = Z.VSL_CD" ).append("\n"); 
		query.append("--                                                    AND AA.SKD_VOY_NO = Z.SKD_VOY_NO" ).append("\n"); 
		query.append("--                                                    AND AA.SKD_DIR_CD = Z.SKD_DIR_CD" ).append("\n"); 
		query.append("--                                                    AND AA.QTA_TGT_CD = 'D'))),0,0,(SUM(OFC_REV) OVER (PARTITION BY OFC_VW_CD, VSL_CD, SKD_VOY_NO, SKD_DIR_CD)" ).append("\n"); 
		query.append("--                                                      - (SELECT AA.GRS_REV FROM SQM_CFM_TGT_VVD AA" ).append("\n"); 
		query.append("--                                                                                            WHERE AA.QTA_RLSE_VER_NO = Z.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("--                                                                                            AND AA.BSE_TP_CD = Z.BSE_TP_CD" ).append("\n"); 
		query.append("--                                                                                            AND AA.BSE_YR = Z.BSE_YR" ).append("\n"); 
		query.append("--                                                                                            AND AA.BSE_QTR_CD = Z.BSE_QTR_CD" ).append("\n"); 
		query.append("--                                                                                            AND AA.TRD_CD = Z.TRD_CD" ).append("\n"); 
		query.append("--                                                                                            AND AA.RLANE_CD = Z.RLANE_CD" ).append("\n"); 
		query.append("--                                                                                            AND AA.DIR_CD = Z.DIR_CD" ).append("\n"); 
		query.append("--                                                                                            AND AA.VSL_CD = Z.VSL_CD" ).append("\n"); 
		query.append("--                                                                                            AND AA.SKD_VOY_NO = Z.SKD_VOY_NO" ).append("\n"); 
		query.append("--                                                                                            AND AA.SKD_DIR_CD = Z.SKD_DIR_CD" ).append("\n"); 
		query.append("--                                                                                            AND AA.QTA_TGT_CD = 'D'))/(LOD_QTY - " ).append("\n"); 
		query.append("--                                                    ((SUM(LOD_QTY) OVER (PARTITION BY OFC_VW_CD, VSL_CD, SKD_VOY_NO, SKD_DIR_CD)) - " ).append("\n"); 
		query.append("--                                                    (SELECT AA.LOD_QTY FROM SQM_CFM_TGT_VVD AA" ).append("\n"); 
		query.append("--                                                    WHERE AA.QTA_RLSE_VER_NO = Z.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("--                                                    AND AA.BSE_TP_CD = Z.BSE_TP_CD" ).append("\n"); 
		query.append("--                                                    AND AA.BSE_YR = Z.BSE_YR" ).append("\n"); 
		query.append("--                                                    AND AA.BSE_QTR_CD = Z.BSE_QTR_CD" ).append("\n"); 
		query.append("--                                                    AND AA.TRD_CD = Z.TRD_CD" ).append("\n"); 
		query.append("--                                                    AND AA.RLANE_CD = Z.RLANE_CD" ).append("\n"); 
		query.append("--                                                    AND AA.DIR_CD = Z.DIR_CD" ).append("\n"); 
		query.append("--                                                    AND AA.VSL_CD = Z.VSL_CD" ).append("\n"); 
		query.append("--                                                    AND AA.SKD_VOY_NO = Z.SKD_VOY_NO" ).append("\n"); 
		query.append("--                                                    AND AA.SKD_DIR_CD = Z.SKD_DIR_CD" ).append("\n"); 
		query.append("--                                                    AND AA.QTA_TGT_CD = 'D')))) ELSE DECODE((DECODE(OLD_OFC_LOD||LOD_RNK,'01',LOD_QTY,OLD_OFC_LOD)),0,0, NVL((OFC_REV/(DECODE(OLD_OFC_LOD||LOD_RNK,'01',LOD_QTY,OLD_OFC_LOD))),0)) END AS GRS_RPB_REV" ).append("\n"); 
		query.append("              ,PA_CM_UC_AMT" ).append("\n"); 
		query.append("              ,RA_CM_UC_AMT                     " ).append("\n"); 
		query.append("          FROM (          " ).append("\n"); 
		query.append("          " ).append("\n"); 
		query.append("#if (${f_gubun} != 'RHQ' || ${f_gubun} == 'VVD')          " ).append("\n"); 
		query.append("WITH RATIO AS" ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("SELECT QTA_RLSE_VER_NO" ).append("\n"); 
		query.append(", BSE_TP_CD" ).append("\n"); 
		query.append(", BSE_QTR_CD" ).append("\n"); 
		query.append(", OFC_VW_CD" ).append("\n"); 
		query.append(", QTA_TGT_CD" ).append("\n"); 
		query.append(", TRD_CD" ).append("\n"); 
		query.append(", RLANE_CD" ).append("\n"); 
		query.append(", DIR_CD" ).append("\n"); 
		query.append(", BSE_WK" ).append("\n"); 
		query.append(", VSL_CD" ).append("\n"); 
		query.append(", SKD_VOY_NO" ).append("\n"); 
		query.append(", SKD_DIR_CD" ).append("\n"); 
		query.append(", NVL((100-SUM(LOAD_PORTION))/100, 0) AS LOAD_RATIO -- 지역 오피스까지 포션이 배부된 RHQ들의 총 포션의 합의 백분율(전체100에서 지역오피스 레벨까지 포션이 배부되지 않은 RHQ의 포션을 뺀 수치)" ).append("\n"); 
		query.append(", NVL((100-SUM(REV_PORTION))/100, 0) AS REV_RATIO -- 지역 오피스까지 포션이 배부된 RHQ들의 총 포션의 합의 백분율(전체100에서 지역오피스 레벨까지 포션이 배부되지 않은 RHQ의 포션을 뺀 수치)" ).append("\n"); 
		query.append("FROM" ).append("\n"); 
		query.append("    (" ).append("\n"); 
		query.append("    SELECT KK.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("    , KK.BSE_TP_CD" ).append("\n"); 
		query.append("    , KK.BSE_QTR_CD" ).append("\n"); 
		query.append("    , KK.OFC_VW_CD" ).append("\n"); 
		query.append("    , KK.QTA_TGT_CD" ).append("\n"); 
		query.append("    , KK.TRD_CD" ).append("\n"); 
		query.append("    , KK.RLANE_CD" ).append("\n"); 
		query.append("    , KK.DIR_CD" ).append("\n"); 
		query.append("    , KK.BSE_WK" ).append("\n"); 
		query.append("    , KK.VSL_CD" ).append("\n"); 
		query.append("    , KK.SKD_VOY_NO" ).append("\n"); 
		query.append("    , KK.SKD_DIR_CD" ).append("\n"); 
		query.append("    , KK.RHQ_CD" ).append("\n"); 
		query.append("    , KK.OFC_LOD" ).append("\n"); 
		query.append("    , KK.OFC_REV" ).append("\n"); 
		query.append("    ,(SELECT CQP.LOD_POTN_RTO FROM SQM_CFM_QTA_POTN_MGMT CQP " ).append("\n"); 
		query.append("    WHERE CQP.QTA_RLSE_VER_NO = KK.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("    AND CQP.BSE_TP_CD = KK.BSE_TP_CD" ).append("\n"); 
		query.append("    --AND CQP.BSE_YR = KK.BSE_YR" ).append("\n"); 
		query.append("    AND CQP.BSE_QTR_CD = KK.BSE_QTR_CD" ).append("\n"); 
		query.append("    AND CQP.OFC_VW_CD = KK.OFC_VW_CD" ).append("\n"); 
		query.append("    AND CQP.QTA_STEP_CD = '02'" ).append("\n"); 
		query.append("    AND CQP.TRD_CD = KK.TRD_CD" ).append("\n"); 
		query.append("    AND CQP.RLANE_CD = KK.RLANE_CD" ).append("\n"); 
		query.append("    AND CQP.DIR_CD = KK.DIR_CD" ).append("\n"); 
		query.append("    AND CQP.RHQ_CD = KK.RHQ_CD" ).append("\n"); 
		query.append("    AND CQP.RGN_OFC_CD = KK.RHQ_CD" ).append("\n"); 
		query.append("    AND KK.BSE_WK BETWEEN SUBSTR(CQP.APLY_FM_YRWK, 5, 2) AND SUBSTR(CQP.APLY_TO_YRWK, 5, 2)) LOAD_PORTION" ).append("\n"); 
		query.append("    ,(SELECT CQP.REV_POTN_RTO FROM SQM_CFM_QTA_POTN_MGMT CQP " ).append("\n"); 
		query.append("    WHERE CQP.QTA_RLSE_VER_NO = KK.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("    AND CQP.BSE_TP_CD = KK.BSE_TP_CD" ).append("\n"); 
		query.append("    --AND CQP.BSE_YR = KK.BSE_YR" ).append("\n"); 
		query.append("    AND CQP.BSE_QTR_CD = KK.BSE_QTR_CD" ).append("\n"); 
		query.append("    AND CQP.OFC_VW_CD = KK.OFC_VW_CD" ).append("\n"); 
		query.append("    AND CQP.QTA_STEP_CD = '02'" ).append("\n"); 
		query.append("    AND CQP.TRD_CD = KK.TRD_CD" ).append("\n"); 
		query.append("    AND CQP.RLANE_CD = KK.RLANE_CD" ).append("\n"); 
		query.append("    AND CQP.DIR_CD = KK.DIR_CD" ).append("\n"); 
		query.append("    AND CQP.RHQ_CD = KK.RHQ_CD" ).append("\n"); 
		query.append("    AND CQP.RGN_OFC_CD = KK.RHQ_CD" ).append("\n"); 
		query.append("    AND KK.BSE_WK BETWEEN SUBSTR(CQP.APLY_FM_YRWK, 5, 2) AND SUBSTR(CQP.APLY_TO_YRWK, 5, 2)) REV_PORTION" ).append("\n"); 
		query.append("    FROM        " ).append("\n"); 
		query.append("    (SELECT QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("    , BSE_TP_CD" ).append("\n"); 
		query.append("    , BSE_QTR_CD" ).append("\n"); 
		query.append("    , OFC_VW_CD" ).append("\n"); 
		query.append("    , QTA_TGT_CD" ).append("\n"); 
		query.append("    , TRD_CD" ).append("\n"); 
		query.append("    , RLANE_CD" ).append("\n"); 
		query.append("    , DIR_CD" ).append("\n"); 
		query.append("    , BSE_WK" ).append("\n"); 
		query.append("    , VSL_CD" ).append("\n"); 
		query.append("    , SKD_VOY_NO" ).append("\n"); 
		query.append("    , SKD_DIR_CD" ).append("\n"); 
		query.append("    , RHQ_CD" ).append("\n"); 
		query.append("    , SUM(OFC_LOD) OFC_LOD" ).append("\n"); 
		query.append("    , SUM(OFC_REV) OFC_REV" ).append("\n"); 
		query.append("    FROM" ).append("\n"); 
		query.append("    (" ).append("\n"); 
		query.append("    SELECT SUBSTR(E1.BSE_YR,-2)||E1.BSE_QTR_CD||'02' AS QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("        ,E1.BSE_TP_CD" ).append("\n"); 
		query.append("        ,E1.BSE_YR" ).append("\n"); 
		query.append("        ,E1.BSE_QTR_CD" ).append("\n"); 
		query.append("        ,E1.OFC_VW_CD" ).append("\n"); 
		query.append("        ,E1.QTA_TGT_CD" ).append("\n"); 
		query.append("        ,E1.TRD_CD" ).append("\n"); 
		query.append("        ,E1.RLANE_CD" ).append("\n"); 
		query.append("        ,E1.DIR_CD" ).append("\n"); 
		query.append("        ,E1.BSE_WK" ).append("\n"); 
		query.append("        ,E1.SLS_YRWK" ).append("\n"); 
		query.append("        ,E1.SUB_TRD_CD" ).append("\n"); 
		query.append("        ,E1.HUL_BND_CD" ).append("\n"); 
		query.append("        ,E1.OB_DIV_CD" ).append("\n"); 
		query.append("        ,E1.FNL_BSA_CAPA" ).append("\n"); 
		query.append("        ,E1.VSL_CD" ).append("\n"); 
		query.append("        ,E1.SKD_VOY_NO" ).append("\n"); 
		query.append("        ,E1.SKD_DIR_CD" ).append("\n"); 
		query.append("        ,E1.RGN_OFC_CD" ).append("\n"); 
		query.append("        ,E1.RHQ_CD" ).append("\n"); 
		query.append("        ,E1.CONV_DIR_CD" ).append("\n"); 
		query.append("        ,(E1.RHQ_QTY - SUM(ROUND(E1.RHQ_QTY * NVL(E3.LOD_POTN_RTO / 100, E1.OFC_LOD_RTO), 0)) OVER (PARTITION BY E1.BSE_TP_CD, E1.BSE_YR, E1.BSE_QTR_CD, E1.OFC_VW_CD, E1.TRD_CD, E1.RLANE_CD, E1.CONV_DIR_CD, E1.VSL_CD, E1.SKD_VOY_NO, E1.RHQ_CD)) AS RHQ_LOD_DIFF" ).append("\n"); 
		query.append("        ,ROUND(E1.RHQ_QTY * (NVL(E3.LOD_POTN_RTO / 100, E1.OFC_LOD_RTO)), 0) AS OFC_LOD" ).append("\n"); 
		query.append("        ,DECODE(RHQ_QTY, 0, 0, RHQ_REV * NVL(E3.REV_POTN_RTO / 100, E1.OFC_REV_RTO)) AS OFC_REV" ).append("\n"); 
		query.append("        ,SUM(ROUND(E1.RHQ_QTY * (NVL(E3.LOD_POTN_RTO / 100, E1.OFC_LOD_RTO)), 0)) OVER (PARTITION BY E1.BSE_TP_CD, E1.BSE_YR, E1.BSE_QTR_CD, E1.OFC_VW_CD, E1.TRD_CD, E1.RLANE_CD, E1.CONV_DIR_CD, E1.VSL_CD, E1.SKD_VOY_NO, E1.RHQ_CD) AS RHQ_LOD_SUM" ).append("\n"); 
		query.append("        ,SUM(DECODE(RHQ_QTY, 0, 0, RHQ_REV * NVL(E3.REV_POTN_RTO / 100, E1.OFC_REV_RTO))) OVER (PARTITION BY E1.BSE_TP_CD, E1.BSE_YR, E1.BSE_QTR_CD, E1.OFC_VW_CD, E1.TRD_CD, E1.RLANE_CD, E1.CONV_DIR_CD, E1.VSL_CD, E1.SKD_VOY_NO, E1.RHQ_CD) AS RHQ_REV_SUM" ).append("\n"); 
		query.append("        ,E2.PA_CM_UC_AMT" ).append("\n"); 
		query.append("        ,E2.RA_CM_UC_AMT" ).append("\n"); 
		query.append("        ,NVL(E3.LOD_POTN_RTO / 100, E1.OFC_LOD_RTO) AS OFC_LOD_RTO" ).append("\n"); 
		query.append("        ,NVL(E3.REV_POTN_RTO / 100, E1.OFC_REV_RTO) AS OFC_REV_RTO" ).append("\n"); 
		query.append("        ,E1.RHQ_LOD_RTO" ).append("\n"); 
		query.append("        ,E1.RHQ_REV_RTO" ).append("\n"); 
		query.append("        ,E1.RHQ_RNK" ).append("\n"); 
		query.append("        ,E1.RHQ_QTY" ).append("\n"); 
		query.append("        ,E1.RHQ_REV" ).append("\n"); 
		query.append("        ,E1.ORG_LOD" ).append("\n"); 
		query.append("        ,E1.ORG_REV" ).append("\n"); 
		query.append("        ,ROW_NUMBER() OVER (PARTITION BY E1.BSE_TP_CD, E1.BSE_YR, E1.BSE_QTR_CD, E1.OFC_VW_CD, E1.RHQ_CD, E1.TRD_CD, E1.DIR_CD, E1.RLANE_CD, E1.VSL_CD, E1.SKD_VOY_NO ORDER BY NVL(E3.LOD_POTN_RTO / 100, E1.OFC_LOD_RTO) DESC, E1.RGN_OFC_CD) AS LOD_RNK" ).append("\n"); 
		query.append("        ,ROW_NUMBER() OVER (PARTITION BY E1.BSE_TP_CD, E1.BSE_YR, E1.BSE_QTR_CD, E1.OFC_VW_CD, E1.RHQ_CD, E1.TRD_CD, E1.DIR_CD, E1.RLANE_CD, E1.VSL_CD, E1.SKD_VOY_NO ORDER BY NVL(E3.REV_POTN_RTO / 100, E1.OFC_REV_RTO) DESC, E1.RGN_OFC_CD) AS REV_RNK" ).append("\n"); 
		query.append("    FROM (" ).append("\n"); 
		query.append("          SELECT D2.BSE_TP_CD" ).append("\n"); 
		query.append("                ,D2.BSE_YR" ).append("\n"); 
		query.append("                ,D2.BSE_QTR_CD" ).append("\n"); 
		query.append("                ,D2.OFC_VW_CD" ).append("\n"); 
		query.append("                ,D1.QTA_STEP_CD" ).append("\n"); 
		query.append("                ,D2.TRD_CD" ).append("\n"); 
		query.append("                ,D2.RLANE_CD" ).append("\n"); 
		query.append("                ,D1.DIR_CD" ).append("\n"); 
		query.append("                ,D2.SUB_TRD_CD" ).append("\n"); 
		query.append("                ,D2.HUL_BND_CD" ).append("\n"); 
		query.append("                ,D2.OB_DIV_CD" ).append("\n"); 
		query.append("                ,D2.FNL_BSA_CAPA                                            " ).append("\n"); 
		query.append("                ,D2.VSL_CD" ).append("\n"); 
		query.append("                ,D2.SKD_VOY_NO" ).append("\n"); 
		query.append("                ,D2.SKD_DIR_CD" ).append("\n"); 
		query.append("                ,D2.BSE_WK" ).append("\n"); 
		query.append("                ,D2.SLS_YRWK" ).append("\n"); 
		query.append("                ,D1.RGN_OFC_CD" ).append("\n"); 
		query.append("                ,D2.RHQ_CD" ).append("\n"); 
		query.append("                ,D2.CONV_DIR_CD" ).append("\n"); 
		query.append("                ,D1.OFC_LOD_RTO" ).append("\n"); 
		query.append("                ,D1.OFC_REV_RTO" ).append("\n"); 
		query.append("                ,D2.RHQ_QTY" ).append("\n"); 
		query.append("                ,D2.RHQ_REV" ).append("\n"); 
		query.append("                ,D2.QTA_TGT_CD" ).append("\n"); 
		query.append("                ,D2.RHQ_RNK" ).append("\n"); 
		query.append("                ,D2.RHQ_LOD_RTO" ).append("\n"); 
		query.append("                ,D2.RHQ_REV_RTO" ).append("\n"); 
		query.append("                ,D2.ORG_LOD" ).append("\n"); 
		query.append("                ,D2.ORG_REV" ).append("\n"); 
		query.append("            FROM (" ).append("\n"); 
		query.append("                  SELECT A1.BSE_TP_CD" ).append("\n"); 
		query.append("                        ,A1.BSE_YR" ).append("\n"); 
		query.append("                        ,A1.BSE_QTR_CD" ).append("\n"); 
		query.append("                        ,A1.OFC_VW_CD" ).append("\n"); 
		query.append("                        ,NVL(A2.QTA_STEP_CD, DECODE(A1.OFC_VW_CD, 'L', '03', DECODE(A4.OB_DIV_CD, 'N', '04', 'O', '05'))) AS QTA_STEP_CD" ).append("\n"); 
		query.append("                        ,A1.TRD_CD" ).append("\n"); 
		query.append("                        ,A1.DIR_CD" ).append("\n"); 
		query.append("                        ,NVL(A3.CONV_DIR_CD, A1.DIR_CD) AS CONV_DIR_CD" ).append("\n"); 
		query.append("                        ,A1.RLANE_CD" ).append("\n"); 
		query.append("                        ,A1.RHQ_CD" ).append("\n"); 
		query.append("                        ,A1.RGN_OFC_CD" ).append("\n"); 
		query.append("                        ,NVL(A2.LOD_POTN_RTO,0) / 100 AS OFC_LOD_RTO" ).append("\n"); 
		query.append("                        ,NVL(A2.REV_POTN_RTO,0) / 100 AS OFC_REV_RTO" ).append("\n"); 
		query.append("                    FROM SQM_QTA_LANE_OFC A1" ).append("\n"); 
		query.append("                        ,SQM_QTA_POTN_MGMT A2" ).append("\n"); 
		query.append("                        ,SQM_DIR_CONV A3" ).append("\n"); 
		query.append("                        ,SQM_DAT_RLT A4" ).append("\n"); 
		query.append("                   WHERE 1=1" ).append("\n"); 
		query.append("                     AND A1.BSE_TP_CD   = A2.BSE_TP_CD(+)" ).append("\n"); 
		query.append("                     AND A1.BSE_YR      = A2.BSE_YR(+)" ).append("\n"); 
		query.append("                     AND A1.BSE_QTR_CD  = A2.BSE_QTR_CD(+)" ).append("\n"); 
		query.append("                     AND A1.OFC_VW_CD   = A2.OFC_VW_CD(+)" ).append("\n"); 
		query.append("                     AND A1.TRD_CD      = A2.TRD_CD(+)" ).append("\n"); 
		query.append("                     AND A1.DIR_CD      = A2.DIR_CD(+)" ).append("\n"); 
		query.append("                     AND A1.RHQ_CD      = A2.RHQ_CD(+)" ).append("\n"); 
		query.append("                     AND A1.RLANE_CD    = A2.RLANE_CD(+)" ).append("\n"); 
		query.append("                     AND A1.RGN_OFC_CD  = A2.RGN_OFC_CD(+)" ).append("\n"); 
		query.append("                     " ).append("\n"); 
		query.append("                     AND A1.BSE_TP_CD   = A3.BSE_TP_CD(+)" ).append("\n"); 
		query.append("                     AND A1.BSE_YR      = A3.BSE_YR(+)" ).append("\n"); 
		query.append("                     AND A1.BSE_QTR_CD  = A3.BSE_QTR_CD(+)" ).append("\n"); 
		query.append("                     AND A1.TRD_CD      = A3.TRD_CD(+)" ).append("\n"); 
		query.append("                     AND A1.RLANE_CD    = A3.RLANE_CD(+)" ).append("\n"); 
		query.append("                     AND A1.DIR_CD      = A3.DIR_CD(+)" ).append("\n"); 
		query.append("                     " ).append("\n"); 
		query.append("                     AND A1.BSE_TP_CD   = A4.BSE_TP_CD" ).append("\n"); 
		query.append("                     AND A1.BSE_YR      = A4.BSE_YR" ).append("\n"); 
		query.append("                     AND A1.BSE_QTR_CD  = A4.BSE_QTR_CD" ).append("\n"); 
		query.append("                     AND A1.OFC_VW_CD   = A4.OFC_VW_CD" ).append("\n"); 
		query.append("                     AND A1.TRD_CD      = A4.TRD_CD" ).append("\n"); 
		query.append("                     AND A1.RLANE_CD    = DECODE(UPPER(A4.RLANE_CD),'ALL',A1.RLANE_CD, A4.RLANE_CD)" ).append("\n"); 
		query.append("                     AND A1.RHQ_CD      = A4.RHQ_CD" ).append("\n"); 
		query.append("                     AND NVL(A3.CONV_DIR_CD, A1.DIR_CD) = A4.CONV_DIR_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                     AND A1.BSE_TP_CD   = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                     AND A1.BSE_YR      = @[f_bse_yr]" ).append("\n"); 
		query.append("                     AND A1.BSE_QTR_CD  = DECODE(@[f_bse_tp_cd],'Y','00',@[f_bse_qtr_cd])" ).append("\n"); 
		query.append("    #if (${f_ofc_vw_cd} != '' && ${f_ofc_vw_cd} != 'All')" ).append("\n"); 
		query.append("                     AND A1.OFC_VW_CD   = @[f_ofc_vw_cd]" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("    #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                     AND A1.TRD_CD      = @[f_trd_cd]" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("    #if (${rlane_cd} != '' && ${rlane_cd} != 'All')" ).append("\n"); 
		query.append("                     AND A1.RLANE_CD    = @[rlane_cd] -- Adjustment by VVD" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("    #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                     AND A1.RLANE_CD    IN (${f_rlane_cd})-- Portion Adjustment by HO/RHQ" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("    #if (${f_dir_cd} != '' && ${f_dir_cd} != 'All')" ).append("\n"); 
		query.append("                     AND A1.DIR_CD      = @[f_dir_cd]" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("    #if (${f_click} != 'on' && ${f_conv_dir_cd} != '' && ${f_conv_dir_cd} != 'All')" ).append("\n"); 
		query.append("                     AND NVL(A3.CONV_DIR_CD, A1.DIR_CD) = @[f_conv_dir_cd]" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("                     AND A1.SQM_ACT_FLG = 'Y'" ).append("\n"); 
		query.append("                     AND A2.QTA_STEP_CD(+) <> '02'" ).append("\n"); 
		query.append("                  ) D1" ).append("\n"); 
		query.append("                ,(" ).append("\n"); 
		query.append("                  SELECT C1.BSE_TP_CD" ).append("\n"); 
		query.append("                        ,C1.BSE_YR" ).append("\n"); 
		query.append("                        ,C1.BSE_QTR_CD" ).append("\n"); 
		query.append("                        ,C1.OFC_VW_CD" ).append("\n"); 
		query.append("                        ,C1.QTA_TGT_CD" ).append("\n"); 
		query.append("                        ,C1.TRD_CD" ).append("\n"); 
		query.append("                        ,C1.SUB_TRD_CD" ).append("\n"); 
		query.append("                        ,C1.HUL_BND_CD" ).append("\n"); 
		query.append("                        ,C1.OB_DIV_CD" ).append("\n"); 
		query.append("                        ,C1.FNL_BSA_CAPA" ).append("\n"); 
		query.append("                        ,C1.RLANE_CD" ).append("\n"); 
		query.append("                        ,C1.CONV_DIR_CD" ).append("\n"); 
		query.append("                        ,C1.DIR_CD" ).append("\n"); 
		query.append("                        ,C1.BSE_WK" ).append("\n"); 
		query.append("                        ,C1.SLS_YRWK" ).append("\n"); 
		query.append("                        ,C1.VSL_CD" ).append("\n"); 
		query.append("                        ,C1.SKD_VOY_NO" ).append("\n"); 
		query.append("                        ,C1.SKD_DIR_CD" ).append("\n"); 
		query.append("                        ,C1.RHQ_CD" ).append("\n"); 
		query.append("                        ,C1.LOAD_RNK AS RHQ_RNK" ).append("\n"); 
		query.append("                        ,DECODE(C1.LOAD_RNK, '1', C1.RHQ_QTY + (C1.ORG_VVD_BSA - C1.SUM_RHQ_QTY), C1.RHQ_QTY) AS RHQ_QTY" ).append("\n"); 
		query.append("                        ,C1.GRS_REV * C1.RHQ_REV_RTO AS RHQ_REV" ).append("\n"); 
		query.append("                        ,C1.RHQ_REV_RTO" ).append("\n"); 
		query.append("                        ,C1.RHQ_LOD_RTO" ).append("\n"); 
		query.append("                        ,C1.ORG_VVD_BSA AS ORG_LOD" ).append("\n"); 
		query.append("                        ,C1.GRS_REV AS ORG_REV" ).append("\n"); 
		query.append("                   FROM (" ).append("\n"); 
		query.append("                         SELECT B2.BSE_TP_CD" ).append("\n"); 
		query.append("                               ,B2.BSE_YR" ).append("\n"); 
		query.append("                               ,B2.BSE_QTR_CD" ).append("\n"); 
		query.append("                               ,B2.OFC_VW_CD" ).append("\n"); 
		query.append("                               ,B2.QTA_TGT_CD" ).append("\n"); 
		query.append("                               ,B2.TRD_CD" ).append("\n"); 
		query.append("                               ,B2.SUB_TRD_CD" ).append("\n"); 
		query.append("                               ,B2.HUL_BND_CD" ).append("\n"); 
		query.append("                               ,B2.OB_DIV_CD" ).append("\n"); 
		query.append("                               ,B2.FNL_BSA_CAPA                                                           " ).append("\n"); 
		query.append("                               ,B2.RLANE_CD" ).append("\n"); 
		query.append("                               ,B2.CONV_DIR_CD" ).append("\n"); 
		query.append("                               ,B2.DIR_CD" ).append("\n"); 
		query.append("                               ,B2.BSE_WK" ).append("\n"); 
		query.append("                               ,B2.SLS_YRWK" ).append("\n"); 
		query.append("                               ,SUBSTR(B1.APLY_FM_YRWK,-2) AS APLY_FM_WK" ).append("\n"); 
		query.append("                               ,SUBSTR(B1.APLY_TO_YRWK,-2) AS APLY_TO_WK" ).append("\n"); 
		query.append("                               ,B1.APLY_FM_YRWK" ).append("\n"); 
		query.append("                               ,B1.APLY_TO_YRWK" ).append("\n"); 
		query.append("                               ,B2.VSL_CD" ).append("\n"); 
		query.append("                               ,B2.SKD_VOY_NO" ).append("\n"); 
		query.append("                               ,B2.SKD_DIR_CD" ).append("\n"); 
		query.append("                               ,B2.RHQ_CD" ).append("\n"); 
		query.append("                               ,NVL(B1.LOD_POTN_RTO,B2.RHQ_LOD_RTO) /100 AS RHQ_LOD_RTO" ).append("\n"); 
		query.append("                               ,NVL(B1.REV_POTN_RTO,B2.RHQ_REV_RTO) /100 AS RHQ_REV_RTO" ).append("\n"); 
		query.append("                               ,B2.GRS_REV" ).append("\n"); 
		query.append("                               -- RHQ 별 물량을 구하기" ).append("\n"); 
		query.append("                               ,B2.LOD_QTY AS ORG_VVD_BSA" ).append("\n"); 
		query.append("                               ,ROUND(B2.LOD_QTY * NVL(NVL(B1.LOD_POTN_RTO,B2.RHQ_LOD_RTO),0)/100, 0) AS RHQ_QTY" ).append("\n"); 
		query.append("                               ,SUM(ROUND(B2.LOD_QTY * NVL(NVL(B1.LOD_POTN_RTO,B2.RHQ_LOD_RTO),0)/100, 0)) OVER (PARTITION BY B2.OFC_VW_CD,B2.TRD_CD,B2.RLANE_CD,B2.CONV_DIR_CD,B2.VSL_CD || B2.SKD_VOY_NO || B2.SKD_DIR_CD) AS SUM_RHQ_QTY" ).append("\n"); 
		query.append("                               ,ROW_NUMBER() OVER (PARTITION BY B2.OFC_VW_CD,B2.TRD_CD,B2.RLANE_CD,B2.CONV_DIR_CD,B2.VSL_CD || B2.SKD_VOY_NO || B2.SKD_DIR_CD ORDER BY NVL(B1.LOD_POTN_RTO,B2.RHQ_LOD_RTO) DESC, B1.RHQ_CD) LOAD_RNK" ).append("\n"); 
		query.append("                           FROM SQM_CFM_QTA_POTN_MGMT B1" ).append("\n"); 
		query.append("                               ,(" ).append("\n"); 
		query.append("                                 SELECT DISTINCT " ).append("\n"); 
		query.append("                                        A1.BSE_TP_CD" ).append("\n"); 
		query.append("                                       ,A1.BSE_YR" ).append("\n"); 
		query.append("                                       ,A1.BSE_QTR_CD" ).append("\n"); 
		query.append("                                       ,A5.OFC_VW_CD" ).append("\n"); 
		query.append("                                       ,NVL(A2.QTA_STEP_CD, '02') AS QTA_STEP_CD" ).append("\n"); 
		query.append("                                       ,A1.TRD_CD" ).append("\n"); 
		query.append("                                       ,A1.SUB_TRD_CD" ).append("\n"); 
		query.append("                                       ,A1.RLANE_CD" ).append("\n"); 
		query.append("                                       ,A4.HUL_BND_CD" ).append("\n"); 
		query.append("                                       ,A3.OB_DIV_CD" ).append("\n"); 
		query.append("                                       ,A1.FNL_BSA_CAPA " ).append("\n"); 
		query.append("                                       ,A1.CONV_DIR_CD" ).append("\n"); 
		query.append("                                       ,A1.DIR_CD" ).append("\n"); 
		query.append("                                       ,A1.BSE_WK" ).append("\n"); 
		query.append("                                       ,A1.SLS_YRMON" ).append("\n"); 
		query.append("                                       ,SUBSTR(A1.SLS_YRMON,0,4)||A1.BSE_WK AS SLS_YRWK" ).append("\n"); 
		query.append("                                       ,A1.VSL_CD" ).append("\n"); 
		query.append("                                       ,A1.SKD_VOY_NO" ).append("\n"); 
		query.append("                                       ,A1.SKD_DIR_CD" ).append("\n"); 
		query.append("                                       ,A5.RHQ_CD" ).append("\n"); 
		query.append("                                       ,NVL(A2.LOD_POTN_RTO, 0) AS RHQ_LOD_RTO" ).append("\n"); 
		query.append("                                       ,NVL(A2.REV_POTN_RTO, 0) AS RHQ_REV_RTO" ).append("\n"); 
		query.append("                                       ,A1.GRS_REV" ).append("\n"); 
		query.append("                                       ,A1.LOD_QTY" ).append("\n"); 
		query.append("                                       ,A1.QTA_TGT_CD" ).append("\n"); 
		query.append("                                   FROM SQM_CFM_TGT_VVD A1" ).append("\n"); 
		query.append("                                       ,SQM_QTA_LANE_OFC A5" ).append("\n"); 
		query.append("                                       ,SQM_QTA_POTN_MGMT A2" ).append("\n"); 
		query.append("                                       ,SQM_DAT_RLT A3" ).append("\n"); 
		query.append("                                       ,MAS_LANE_RGST A4" ).append("\n"); 
		query.append("                                  WHERE 1=1" ).append("\n"); 
		query.append("                                    AND A1.BSE_TP_CD     = A5.BSE_TP_CD" ).append("\n"); 
		query.append("                                    AND A1.BSE_YR        = A5.BSE_YR" ).append("\n"); 
		query.append("                                    AND A1.BSE_QTR_CD    = A5.BSE_QTR_CD" ).append("\n"); 
		query.append("                                    AND A1.TRD_CD        = A5.TRD_CD" ).append("\n"); 
		query.append("                                    AND A1.RLANE_CD      = A5.RLANE_CD" ).append("\n"); 
		query.append("                                    AND A1.DIR_CD        = A5.DIR_CD" ).append("\n"); 
		query.append("                                    AND A5.SQM_ACT_FLG   = 'Y'" ).append("\n"); 
		query.append("                                    " ).append("\n"); 
		query.append("                                    AND A5.BSE_TP_CD     = A2.BSE_TP_CD(+)" ).append("\n"); 
		query.append("                                    AND A5.BSE_YR        = A2.BSE_YR(+)" ).append("\n"); 
		query.append("                                    AND A5.BSE_QTR_CD    = A2.BSE_QTR_CD(+)" ).append("\n"); 
		query.append("                                    AND A5.OFC_VW_CD     = A2.OFC_VW_CD(+)" ).append("\n"); 
		query.append("                                    AND A5.TRD_CD        = A2.TRD_CD(+)" ).append("\n"); 
		query.append("                                    AND A5.RLANE_CD      = A2.RLANE_CD(+)" ).append("\n"); 
		query.append("                                    AND A5.DIR_CD        = A2.DIR_CD(+)" ).append("\n"); 
		query.append("                                    AND A5.RHQ_CD        = A2.RHQ_CD(+)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                    AND A5.BSE_TP_CD     = A3.BSE_TP_CD" ).append("\n"); 
		query.append("                                    AND A5.BSE_YR        = A3.BSE_YR" ).append("\n"); 
		query.append("                                    AND A5.BSE_QTR_CD    = A3.BSE_QTR_CD" ).append("\n"); 
		query.append("                                    AND A5.OFC_VW_CD     = A3.OFC_VW_CD" ).append("\n"); 
		query.append("                                    AND A5.TRD_CD        = A3.TRD_CD" ).append("\n"); 
		query.append("                                    AND A5.RLANE_CD      = DECODE(UPPER(A3.RLANE_CD),'ALL',A5.RLANE_CD, A3.RLANE_CD)" ).append("\n"); 
		query.append("                                    AND A1.CONV_DIR_CD   = A3.CONV_DIR_CD" ).append("\n"); 
		query.append("                                    AND A5.RHQ_CD        = A3.RHQ_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                    AND A1.RLANE_CD      = A4.RLANE_CD" ).append("\n"); 
		query.append("                                    AND A1.DIR_CD        = A4.DIR_CD" ).append("\n"); 
		query.append("                                    AND A1.TRD_CD        = A4.TRD_CD" ).append("\n"); 
		query.append("                                    AND A1.IOC_CD        = A4.IOC_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                    AND A1.QTA_RLSE_VER_NO = (SELECT QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                                FROM SQM_QTA_RLSE_VER" ).append("\n"); 
		query.append("                                                               WHERE BSE_TP_CD  = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                                 AND BSE_YR     = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                                 AND BSE_QTR_CD = DECODE(@[f_bse_tp_cd],'Y','00',@[f_bse_qtr_cd])" ).append("\n"); 
		query.append("                                                                 AND SQM_VER_STS_CD = 'R'" ).append("\n"); 
		query.append("                                                              )" ).append("\n"); 
		query.append("                                    AND A1.BSE_TP_CD     = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                    AND A1.BSE_YR        = @[f_bse_yr]" ).append("\n"); 
		query.append("                                    AND A1.BSE_QTR_CD    = DECODE(@[f_bse_tp_cd],'Y','00',@[f_bse_qtr_cd])" ).append("\n"); 
		query.append("                                    AND A2.QTA_STEP_CD(+)= '02'" ).append("\n"); 
		query.append("                                    AND A2.QTA_STEP_CD(+)= '02'" ).append("\n"); 
		query.append("    #if (${f_ofc_vw_cd} != '' && ${f_ofc_vw_cd} != 'All')" ).append("\n"); 
		query.append("                                    AND A5.OFC_VW_CD     = @[f_ofc_vw_cd]" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("                                    AND A1.QTA_TGT_CD    = 'D'" ).append("\n"); 
		query.append("    #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                                    AND A1.TRD_CD        = @[f_trd_cd]" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("    #if (${rlane_cd} != '' && ${rlane_cd} != 'All')" ).append("\n"); 
		query.append("                                    AND A1.RLANE_CD      = @[rlane_cd] -- Adjustment by VVD" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("    #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                                    AND A1.RLANE_CD      IN (${f_rlane_cd})-- Portion Adjustment by HO/RHQ" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("    #if (${f_dir_cd} != '' && ${f_dir_cd} != 'All')" ).append("\n"); 
		query.append("                                    AND A1.DIR_CD        = @[f_dir_cd]" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("    #if (${f_click} != 'on' && ${f_conv_dir_cd} != '' && ${f_conv_dir_cd} != 'All')" ).append("\n"); 
		query.append("                                    AND A1.CONV_DIR_CD   = @[f_conv_dir_cd]" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("    #if (${f_click} == 'on' && ${f_trd_dir} != '' && ${f_trd_dir} != 'All')" ).append("\n"); 
		query.append("                                    AND A4.HUL_BND_CD    = @[f_trd_dir]" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("    #if (${mas_vvd} != '')" ).append("\n"); 
		query.append("                                    AND A1.VSL_CD || A1.SKD_VOY_NO || A1.SKD_DIR_CD = @[mas_vvd]" ).append("\n"); 
		query.append("    #end" ).append("\n"); 
		query.append("                                 ) B2" ).append("\n"); 
		query.append("                          WHERE 1=1" ).append("\n"); 
		query.append("                            AND B2.BSE_TP_CD     = B1.BSE_TP_CD(+)" ).append("\n"); 
		query.append("                            AND B2.BSE_YR        = B1.BSE_YR(+)" ).append("\n"); 
		query.append("                            AND B2.BSE_QTR_CD    = B1.BSE_QTR_CD(+)" ).append("\n"); 
		query.append("                            AND B2.OFC_VW_CD     = B1.OFC_VW_CD(+)" ).append("\n"); 
		query.append("                            AND B2.QTA_STEP_CD   = B1.QTA_STEP_CD(+)" ).append("\n"); 
		query.append("                            AND B2.TRD_CD        = B1.TRD_CD(+)" ).append("\n"); 
		query.append("                            AND B2.RLANE_CD      = B1.RLANE_CD(+)" ).append("\n"); 
		query.append("                            AND B2.DIR_CD        = B1.DIR_CD(+)" ).append("\n"); 
		query.append("                            AND B2.RHQ_CD        = B1.RHQ_CD(+)" ).append("\n"); 
		query.append("    --                                                                AND B2.BSE_WK        BETWEEN SUBSTR(B1.APLY_FM_YRWK(+),-2) AND SUBSTR(B1.APLY_TO_YRWK(+),-2)" ).append("\n"); 
		query.append("                            AND B2.SLS_YRWK        BETWEEN B1.APLY_FM_YRWK(+) AND B1.APLY_TO_YRWK(+)" ).append("\n"); 
		query.append("                          ORDER BY B2.OFC_VW_CD, B2.BSE_WK, B2.RHQ_CD" ).append("\n"); 
		query.append("                         ) C1" ).append("\n"); 
		query.append("                  ) D2" ).append("\n"); 
		query.append("           WHERE 1=1" ).append("\n"); 
		query.append("             AND D1.BSE_TP_CD   = D2.BSE_TP_CD" ).append("\n"); 
		query.append("             AND D1.BSE_YR      = D2.BSE_YR" ).append("\n"); 
		query.append("             AND D1.BSE_QTR_CD  = D2.BSE_QTR_CD" ).append("\n"); 
		query.append("             AND D1.OFC_VW_CD   = D2.OFC_VW_CD" ).append("\n"); 
		query.append("             AND D1.TRD_CD      = D2.TRD_CD" ).append("\n"); 
		query.append("             AND D1.RLANE_CD    = D2.RLANE_CD" ).append("\n"); 
		query.append("             AND D1.DIR_CD      = D2.DIR_CD" ).append("\n"); 
		query.append("             AND D1.RHQ_CD      = D2.RHQ_CD" ).append("\n"); 
		query.append("          ) E1" ).append("\n"); 
		query.append("        ,SQM_QTA_LANE_OFC_COST E2" ).append("\n"); 
		query.append("        ,SQM_CFM_QTA_POTN_MGMT E3" ).append("\n"); 
		query.append("    WHERE 1=1" ).append("\n"); 
		query.append("     AND E1.BSE_TP_CD   = E2.BSE_TP_CD" ).append("\n"); 
		query.append("     AND E1.BSE_YR      = E2.BSE_YR" ).append("\n"); 
		query.append("     AND E1.BSE_QTR_CD  = E2.BSE_QTR_CD" ).append("\n"); 
		query.append("     AND E1.OFC_VW_CD   = E2.OFC_VW_CD" ).append("\n"); 
		query.append("     AND E1.TRD_CD      = E2.TRD_CD" ).append("\n"); 
		query.append("     AND E1.RLANE_CD    = E2.RLANE_CD" ).append("\n"); 
		query.append("     AND E1.DIR_CD      = E2.DIR_CD" ).append("\n"); 
		query.append("     AND E1.RHQ_CD      = E2.RHQ_CD" ).append("\n"); 
		query.append("     AND E1.RGN_OFC_CD  = E2.RGN_OFC_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("     AND E1.BSE_TP_CD     = E3.BSE_TP_CD(+)" ).append("\n"); 
		query.append("     AND E1.BSE_YR        = E3.BSE_YR(+)" ).append("\n"); 
		query.append("     AND E1.BSE_QTR_CD    = E3.BSE_QTR_CD(+)" ).append("\n"); 
		query.append("     AND E1.OFC_VW_CD     = E3.OFC_VW_CD(+)" ).append("\n"); 
		query.append("     AND E1.QTA_STEP_CD   = E3.QTA_STEP_CD(+)" ).append("\n"); 
		query.append("     AND E1.TRD_CD        = E3.TRD_CD(+)" ).append("\n"); 
		query.append("     AND E1.RLANE_CD      = E3.RLANE_CD(+)" ).append("\n"); 
		query.append("     AND E1.DIR_CD        = E3.DIR_CD(+)" ).append("\n"); 
		query.append("     AND E1.RHQ_CD        = E3.RHQ_CD(+)" ).append("\n"); 
		query.append("     AND E1.RGN_OFC_CD    = E3.RGN_OFC_CD(+)" ).append("\n"); 
		query.append("    --                                         AND E1.BSE_WK        BETWEEN SUBSTR(E3.APLY_FM_YRWK(+),-2) AND SUBSTR(E3.APLY_TO_YRWK(+),-2)" ).append("\n"); 
		query.append("     AND E1.SLS_YRWK        BETWEEN E3.APLY_FM_YRWK(+) AND E3.APLY_TO_YRWK(+)" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("    GROUP BY QTA_RLSE_VER_NO,BSE_TP_CD,BSE_QTR_CD,OFC_VW_CD,QTA_TGT_CD,TRD_CD,RLANE_CD,DIR_CD,BSE_WK,VSL_CD,SKD_VOY_NO,SKD_DIR_CD,RHQ_CD" ).append("\n"); 
		query.append("    ) KK" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("WHERE OFC_LOD = 0 OR OFC_REV = 0" ).append("\n"); 
		query.append("GROUP BY QTA_RLSE_VER_NO, BSE_TP_CD, BSE_QTR_CD, OFC_VW_CD, QTA_TGT_CD, TRD_CD, RLANE_CD, DIR_CD, BSE_WK, VSL_CD, SKD_VOY_NO, SKD_DIR_CD" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("--WITH 끝" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("              " ).append("\n"); 
		query.append("                  SELECT QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                        ,BSE_TP_CD " ).append("\n"); 
		query.append("                        ,BSE_YR" ).append("\n"); 
		query.append("                        ,BSE_QTR_CD" ).append("\n"); 
		query.append("                        ,OFC_VW_CD" ).append("\n"); 
		query.append("                        ,QTA_TGT_CD" ).append("\n"); 
		query.append("                        ,TRD_CD" ).append("\n"); 
		query.append("                        ,RLANE_CD" ).append("\n"); 
		query.append("                        ,DIR_CD" ).append("\n"); 
		query.append("                        ,BSE_WK" ).append("\n"); 
		query.append("                        ,SUB_TRD_CD" ).append("\n"); 
		query.append("                        ,HUL_BND_CD" ).append("\n"); 
		query.append("                        ,OB_DIV_CD" ).append("\n"); 
		query.append("                        ,FNL_BSA_CAPA" ).append("\n"); 
		query.append("                        ,VSL_CD" ).append("\n"); 
		query.append("                        ,SKD_VOY_NO" ).append("\n"); 
		query.append("                        ,SKD_DIR_CD" ).append("\n"); 
		query.append("                        ,RGN_OFC_CD" ).append("\n"); 
		query.append("                        ,RHQ_CD" ).append("\n"); 
		query.append("                        ,AQ_CD" ).append("\n"); 
		query.append("                        ,CONV_DIR_CD" ).append("\n"); 
		query.append("                        " ).append("\n"); 
		query.append("                        ,RHQ_RNK" ).append("\n"); 
		query.append("                        ,LOD_RNK" ).append("\n"); 
		query.append("                        ,OFC_LOD AS OLD_OFC_LOD" ).append("\n"); 
		query.append("                        ,ORG_LOD" ).append("\n"); 
		query.append("                        ,VVD_LOD_SUM" ).append("\n"); 
		query.append("                        ,ORG_REV" ).append("\n"); 
		query.append("                        ,VVD_REV_SUM" ).append("\n"); 
		query.append("                        ,OFC_REV AS OLD_OFC_REV" ).append("\n"); 
		query.append("                        ,BSE_WK AS VVD_WK" ).append("\n"); 
		query.append("                        ,ORG_REV AS TOTAL_REV" ).append("\n"); 
		query.append("                        " ).append("\n"); 
		query.append("#if (${f_gubun} == 'RHQ')" ).append("\n"); 
		query.append("                         -- RHQ에서 Creation할 경우 VVD 전체 물량에 대한 DIFF를 확인 할 수 없기 때문에 RHQ 전체 물량에 대한 DIFF까지만 처리한다." ).append("\n"); 
		query.append("                        ,OFC_LOD AS LOD_QTY" ).append("\n"); 
		query.append("                        ,OFC_REV" ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("                         -- HO, adjustment by VVD에서 Creation 할 경우 VVD전체 물량에 대해서 RHQ에서 유실되는경우 보정하기 위해서" ).append("\n"); 
		query.append("--                        ,DECODE(ROUND(ORG_LOD - VVD_LOD_SUM), 0, OFC_LOD, DECODE(RHQ_RNK, 1, DECODE(LOD_RNK, 1, OFC_LOD + ROUND(ORG_LOD - VVD_LOD_SUM), OFC_LOD), OFC_LOD)) AS LOD_QTY" ).append("\n"); 
		query.append("--                        ,DECODE((ORG_REV - VVD_REV_SUM), 0, OFC_REV, DECODE(RHQ_RNK, 1, DECODE(LOD_RNK, 1, OFC_REV + (ORG_REV - VVD_REV_SUM), OFC_REV), OFC_REV)) AS OFC_REV" ).append("\n"); 
		query.append("                        --,DECODE((SELECT 'CFM PORTION EXIST' FROM SQM_CFM_QTA_POTN_MGMT CP WHERE CP.BSE_TP_CD = T.BSE_TP_CD AND CP.BSE_YR = T.BSE_YR AND CP.BSE_QTR_CD = T.BSE_QTR_CD AND CP.OFC_VW_CD = T.OFC_VW_CD AND CP.QTA_STEP_CD = '02' AND CP.TRD_CD = T.TRD_CD AND CP.RLANE_CD = T.RLANE_CD AND CP.DIR_CD = T.DIR_CD AND ROWNUM < 2), NULL, OFC_LOD, DECODE(OFC_LOD, 0, DECODE((SELECT CP.LOD_POTN_RTO FROM SQM_CFM_QTA_POTN_MGMT CP WHERE CP.BSE_TP_CD = T.BSE_TP_CD AND CP.BSE_YR = T.BSE_YR AND CP.BSE_QTR_CD = T.BSE_QTR_CD AND CP.OFC_VW_CD = T.OFC_VW_CD AND CP.QTA_STEP_CD = '02' AND CP.TRD_CD = T.TRD_CD AND CP.RLANE_CD = T.RLANE_CD AND CP.DIR_CD = T.DIR_CD AND CP.RHQ_CD = T.RHQ_CD AND ROWNUM < 2),0,0,DECODE(LOD_RNK, 1, NVL((OFC_LOD + ROUND(ORG_LOD - DECODE(OFC_LOD, 0, 0, VVD_LOD_SUM)))*NVL((SELECT DISTINCT CP.LOD_POTN_RTO/100 FROM SQM_CFM_QTA_POTN_MGMT CP WHERE CP.BSE_TP_CD = T.BSE_TP_CD AND CP.BSE_YR = T.BSE_YR AND CP.BSE_QTR_CD = T.BSE_QTR_CD AND CP.OFC_VW_CD = T.OFC_VW_CD AND CP.QTA_STEP_CD = '02' AND CP.TRD_CD = T.TRD_CD AND CP.RLANE_CD = T.RLANE_CD AND CP.DIR_CD = T.DIR_CD AND CP.RHQ_CD = T.RHQ_CD AND ROWNUM < 2),1),0), OFC_LOD)), DECODE(RHQ_RNK, 1, DECODE(LOD_RNK, 1, (OFC_LOD + ROUND(ORG_LOD - VVD_LOD_SUM))*NVL((SELECT R.LOAD_RATIO FROM RATIO R WHERE R.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO AND R.BSE_TP_CD = T.BSE_TP_CD AND R.BSE_QTR_CD = T.BSE_QTR_CD AND R.OFC_VW_CD = T.OFC_VW_CD AND R.QTA_TGT_CD = T.QTA_TGT_CD AND R.TRD_CD = T.TRD_CD AND R.RLANE_CD =T.RLANE_CD AND R.DIR_CD = T.DIR_CD AND R.BSE_WK = T.BSE_WK AND R.VSL_CD = T.VSL_CD AND R.SKD_VOY_NO = T.SKD_VOY_NO AND R.SKD_DIR_CD = T.SKD_DIR_CD),1), OFC_LOD*NVL((SELECT R.LOAD_RATIO FROM RATIO R WHERE R.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO AND R.BSE_TP_CD = T.BSE_TP_CD AND R.BSE_QTR_CD = T.BSE_QTR_CD AND R.OFC_VW_CD = T.OFC_VW_CD AND R.QTA_TGT_CD = T.QTA_TGT_CD AND R.TRD_CD = T.TRD_CD AND R.RLANE_CD =T.RLANE_CD AND R.DIR_CD = T.DIR_CD AND R.BSE_WK = T.BSE_WK AND R.VSL_CD = T.VSL_CD AND R.SKD_VOY_NO = T.SKD_VOY_NO AND R.SKD_DIR_CD = T.SKD_DIR_CD),1)), OFC_LOD*NVL((SELECT R.LOAD_RATIO FROM RATIO R WHERE R.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO AND R.BSE_TP_CD = T.BSE_TP_CD AND R.BSE_QTR_CD = T.BSE_QTR_CD AND R.OFC_VW_CD = T.OFC_VW_CD AND R.QTA_TGT_CD = T.QTA_TGT_CD AND R.TRD_CD = T.TRD_CD AND R.RLANE_CD =T.RLANE_CD AND R.DIR_CD = T.DIR_CD AND R.BSE_WK = T.BSE_WK AND R.VSL_CD = T.VSL_CD AND R.SKD_VOY_NO = T.SKD_VOY_NO AND R.SKD_DIR_CD = T.SKD_DIR_CD),1)))) AS LOD_QTY" ).append("\n"); 
		query.append("                        --,DECODE((SELECT 'CFM PORTION EXIST' FROM SQM_CFM_QTA_POTN_MGMT CP WHERE CP.BSE_TP_CD = T.BSE_TP_CD AND CP.BSE_YR = T.BSE_YR AND CP.BSE_QTR_CD = T.BSE_QTR_CD AND CP.OFC_VW_CD = T.OFC_VW_CD AND CP.QTA_STEP_CD = '02' AND CP.TRD_CD = T.TRD_CD AND CP.RLANE_CD = T.RLANE_CD AND CP.DIR_CD = T.DIR_CD AND ROWNUM < 2), NULL, OFC_REV, DECODE(OFC_REV, 0, DECODE((SELECT CP.REV_POTN_RTO FROM SQM_CFM_QTA_POTN_MGMT CP WHERE CP.BSE_TP_CD = T.BSE_TP_CD AND CP.BSE_YR = T.BSE_YR AND CP.BSE_QTR_CD = T.BSE_QTR_CD AND CP.OFC_VW_CD = T.OFC_VW_CD AND CP.QTA_STEP_CD = '02' AND CP.TRD_CD = T.TRD_CD AND CP.RLANE_CD = T.RLANE_CD AND CP.DIR_CD = T.DIR_CD AND CP.RHQ_CD = T.RHQ_CD AND ROWNUM < 2),0,0,DECODE(LOD_RNK, 1, NVL((OFC_REV + (ORG_REV - DECODE(OFC_REV, 0, 0, VVD_REV_SUM)))*NVL((SELECT DISTINCT CP.REV_POTN_RTO/100 FROM SQM_CFM_QTA_POTN_MGMT CP WHERE CP.BSE_TP_CD = T.BSE_TP_CD AND CP.BSE_YR = T.BSE_YR AND CP.BSE_QTR_CD = T.BSE_QTR_CD AND CP.OFC_VW_CD = T.OFC_VW_CD AND CP.QTA_STEP_CD = '02' AND CP.TRD_CD = T.TRD_CD AND CP.RLANE_CD = T.RLANE_CD AND CP.DIR_CD = T.DIR_CD AND CP.RHQ_CD = T.RHQ_CD AND ROWNUM < 2),1),0), OFC_REV)), DECODE(RHQ_RNK, 1, DECODE(LOD_RNK, 1, (OFC_REV + (ORG_REV - VVD_REV_SUM))*NVL((SELECT R.REV_RATIO FROM RATIO R WHERE R.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO AND R.BSE_TP_CD = T.BSE_TP_CD AND R.BSE_QTR_CD = T.BSE_QTR_CD AND R.OFC_VW_CD = T.OFC_VW_CD AND R.QTA_TGT_CD = T.QTA_TGT_CD AND R.TRD_CD = T.TRD_CD AND R.RLANE_CD =T.RLANE_CD AND R.DIR_CD = T.DIR_CD AND R.BSE_WK = T.BSE_WK AND R.VSL_CD = T.VSL_CD AND R.SKD_VOY_NO = T.SKD_VOY_NO AND R.SKD_DIR_CD = T.SKD_DIR_CD),1), OFC_REV*NVL((SELECT R.REV_RATIO FROM RATIO R WHERE R.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO AND R.BSE_TP_CD = T.BSE_TP_CD AND R.BSE_QTR_CD = T.BSE_QTR_CD AND R.OFC_VW_CD = T.OFC_VW_CD AND R.QTA_TGT_CD = T.QTA_TGT_CD AND R.TRD_CD = T.TRD_CD AND R.RLANE_CD =T.RLANE_CD AND R.DIR_CD = T.DIR_CD AND R.BSE_WK = T.BSE_WK AND R.VSL_CD = T.VSL_CD AND R.SKD_VOY_NO = T.SKD_VOY_NO AND R.SKD_DIR_CD = T.SKD_DIR_CD),1)), OFC_REV*NVL((SELECT R.REV_RATIO FROM RATIO R WHERE R.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO AND R.BSE_TP_CD = T.BSE_TP_CD AND R.BSE_QTR_CD = T.BSE_QTR_CD AND R.OFC_VW_CD = T.OFC_VW_CD AND R.QTA_TGT_CD = T.QTA_TGT_CD AND R.TRD_CD = T.TRD_CD AND R.RLANE_CD =T.RLANE_CD AND R.DIR_CD = T.DIR_CD AND R.BSE_WK = T.BSE_WK AND R.VSL_CD = T.VSL_CD AND R.SKD_VOY_NO = T.SKD_VOY_NO AND R.SKD_DIR_CD = T.SKD_DIR_CD),1)))) AS OFC_REV" ).append("\n"); 
		query.append("                        --,DECODE((SELECT 'CFM PORTION EXIST' FROM SQM_CFM_QTA_POTN_MGMT CP WHERE CP.BSE_TP_CD = T.BSE_TP_CD AND CP.BSE_YR = T.BSE_YR AND CP.BSE_QTR_CD = T.BSE_QTR_CD AND CP.OFC_VW_CD = T.OFC_VW_CD AND CP.QTA_STEP_CD = '02' AND CP.TRD_CD = T.TRD_CD AND CP.RLANE_CD = T.RLANE_CD AND CP.DIR_CD = T.DIR_CD AND ROWNUM < 2), NULL, OFC_LOD, DECODE(OFC_LOD, 0, DECODE((SELECT CP.LOD_POTN_RTO FROM SQM_CFM_QTA_POTN_MGMT CP WHERE CP.BSE_TP_CD = T.BSE_TP_CD AND CP.BSE_YR = T.BSE_YR AND CP.BSE_QTR_CD = T.BSE_QTR_CD AND CP.OFC_VW_CD = T.OFC_VW_CD AND CP.QTA_STEP_CD = '02' AND CP.TRD_CD = T.TRD_CD AND CP.RLANE_CD = T.RLANE_CD AND CP.DIR_CD = T.DIR_CD AND CP.RHQ_CD = T.RHQ_CD AND ROWNUM < 2),0,0,DECODE(LOD_RNK, 1, NVL((OFC_LOD + ROUND(ORG_LOD - DECODE(OFC_LOD, 0, 0, VVD_LOD_SUM)))*NVL((SELECT DISTINCT CP.LOD_POTN_RTO/100 FROM SQM_CFM_QTA_POTN_MGMT CP WHERE CP.BSE_TP_CD = T.BSE_TP_CD AND CP.BSE_YR = T.BSE_YR AND CP.BSE_QTR_CD = T.BSE_QTR_CD AND CP.OFC_VW_CD = T.OFC_VW_CD AND CP.QTA_STEP_CD = '02' AND CP.TRD_CD = T.TRD_CD AND CP.RLANE_CD = T.RLANE_CD AND CP.DIR_CD = T.DIR_CD AND CP.RHQ_CD = T.RHQ_CD AND ROWNUM < 2),1),0), OFC_LOD)), DECODE(RHQ_RNK, 1, DECODE(LOD_RNK, 1, (OFC_LOD + ROUND(ORG_LOD - VVD_LOD_SUM))*NVL((SELECT R.LOAD_RATIO FROM RATIO R WHERE R.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO AND R.BSE_TP_CD = T.BSE_TP_CD AND R.BSE_QTR_CD = T.BSE_QTR_CD AND R.OFC_VW_CD = T.OFC_VW_CD AND R.QTA_TGT_CD = T.QTA_TGT_CD AND R.TRD_CD = T.TRD_CD AND R.RLANE_CD =T.RLANE_CD AND R.DIR_CD = T.DIR_CD AND R.BSE_WK = T.BSE_WK AND R.VSL_CD = T.VSL_CD AND R.SKD_VOY_NO = T.SKD_VOY_NO AND R.SKD_DIR_CD = T.SKD_DIR_CD),1), OFC_LOD*NVL((SELECT R.LOAD_RATIO FROM RATIO R WHERE R.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO AND R.BSE_TP_CD = T.BSE_TP_CD AND R.BSE_QTR_CD = T.BSE_QTR_CD AND R.OFC_VW_CD = T.OFC_VW_CD AND R.QTA_TGT_CD = T.QTA_TGT_CD AND R.TRD_CD = T.TRD_CD AND R.RLANE_CD =T.RLANE_CD AND R.DIR_CD = T.DIR_CD AND R.BSE_WK = T.BSE_WK AND R.VSL_CD = T.VSL_CD AND R.SKD_VOY_NO = T.SKD_VOY_NO AND R.SKD_DIR_CD = T.SKD_DIR_CD),1)), OFC_LOD))) AS LOD_QTY" ).append("\n"); 
		query.append("                        --,DECODE((SELECT 'CFM PORTION EXIST' FROM SQM_CFM_QTA_POTN_MGMT CP WHERE CP.BSE_TP_CD = T.BSE_TP_CD AND CP.BSE_YR = T.BSE_YR AND CP.BSE_QTR_CD = T.BSE_QTR_CD AND CP.OFC_VW_CD = T.OFC_VW_CD AND CP.QTA_STEP_CD = '02' AND CP.TRD_CD = T.TRD_CD AND CP.RLANE_CD = T.RLANE_CD AND CP.DIR_CD = T.DIR_CD AND ROWNUM < 2), NULL, OFC_REV, DECODE(OFC_REV, 0, DECODE((SELECT CP.REV_POTN_RTO FROM SQM_CFM_QTA_POTN_MGMT CP WHERE CP.BSE_TP_CD = T.BSE_TP_CD AND CP.BSE_YR = T.BSE_YR AND CP.BSE_QTR_CD = T.BSE_QTR_CD AND CP.OFC_VW_CD = T.OFC_VW_CD AND CP.QTA_STEP_CD = '02' AND CP.TRD_CD = T.TRD_CD AND CP.RLANE_CD = T.RLANE_CD AND CP.DIR_CD = T.DIR_CD AND CP.RHQ_CD = T.RHQ_CD AND ROWNUM < 2),0,0,DECODE(LOD_RNK, 1, NVL((OFC_REV + (ORG_REV - DECODE(OFC_REV, 0, 0, VVD_REV_SUM)))*NVL((SELECT DISTINCT CP.REV_POTN_RTO/100 FROM SQM_CFM_QTA_POTN_MGMT CP WHERE CP.BSE_TP_CD = T.BSE_TP_CD AND CP.BSE_YR = T.BSE_YR AND CP.BSE_QTR_CD = T.BSE_QTR_CD AND CP.OFC_VW_CD = T.OFC_VW_CD AND CP.QTA_STEP_CD = '02' AND CP.TRD_CD = T.TRD_CD AND CP.RLANE_CD = T.RLANE_CD AND CP.DIR_CD = T.DIR_CD AND CP.RHQ_CD = T.RHQ_CD AND ROWNUM < 2),1),0), OFC_REV)), DECODE(RHQ_RNK, 1, DECODE(LOD_RNK, 1, (OFC_REV + (ORG_REV - VVD_REV_SUM))*NVL((SELECT R.REV_RATIO FROM RATIO R WHERE R.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO AND R.BSE_TP_CD = T.BSE_TP_CD AND R.BSE_QTR_CD = T.BSE_QTR_CD AND R.OFC_VW_CD = T.OFC_VW_CD AND R.QTA_TGT_CD = T.QTA_TGT_CD AND R.TRD_CD = T.TRD_CD AND R.RLANE_CD =T.RLANE_CD AND R.DIR_CD = T.DIR_CD AND R.BSE_WK = T.BSE_WK AND R.VSL_CD = T.VSL_CD AND R.SKD_VOY_NO = T.SKD_VOY_NO AND R.SKD_DIR_CD = T.SKD_DIR_CD),1), OFC_REV*NVL((SELECT R.REV_RATIO FROM RATIO R WHERE R.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO AND R.BSE_TP_CD = T.BSE_TP_CD AND R.BSE_QTR_CD = T.BSE_QTR_CD AND R.OFC_VW_CD = T.OFC_VW_CD AND R.QTA_TGT_CD = T.QTA_TGT_CD AND R.TRD_CD = T.TRD_CD AND R.RLANE_CD =T.RLANE_CD AND R.DIR_CD = T.DIR_CD AND R.BSE_WK = T.BSE_WK AND R.VSL_CD = T.VSL_CD AND R.SKD_VOY_NO = T.SKD_VOY_NO AND R.SKD_DIR_CD = T.SKD_DIR_CD),1)), OFC_REV))) AS OFC_REV" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                        ,ROUND(DECODE((SELECT 'CFM PORTION EXIST' FROM SQM_CFM_QTA_POTN_MGMT CP WHERE CP.BSE_TP_CD = T.BSE_TP_CD AND CP.BSE_YR = T.BSE_YR AND CP.BSE_QTR_CD = T.BSE_QTR_CD AND CP.OFC_VW_CD = T.OFC_VW_CD AND CP.QTA_STEP_CD = '02' AND CP.TRD_CD = T.TRD_CD AND CP.RLANE_CD = T.RLANE_CD AND CP.DIR_CD = T.DIR_CD AND (T.BSE_YR||T.BSE_WK BETWEEN CP.APLY_FM_YRWK AND CP.APLY_TO_YRWK) AND ROWNUM < 2), NULL, DECODE(ROUND(ORG_LOD - VVD_LOD_SUM), 0, OFC_LOD, DECODE(RHQ_RNK, 1, DECODE(LOD_RNK, 1, OFC_LOD + ROUND(ORG_LOD - VVD_LOD_SUM), OFC_LOD), OFC_LOD)), " ).append("\n"); 
		query.append("                            DECODE(OFC_LOD, 0, DECODE((SELECT CP.LOD_POTN_RTO FROM SQM_CFM_QTA_POTN_MGMT CP WHERE CP.BSE_TP_CD = T.BSE_TP_CD AND CP.BSE_YR = T.BSE_YR AND CP.BSE_QTR_CD = T.BSE_QTR_CD AND CP.OFC_VW_CD = T.OFC_VW_CD AND CP.QTA_STEP_CD = '02' AND CP.TRD_CD = T.TRD_CD AND CP.RLANE_CD = T.RLANE_CD AND CP.DIR_CD = T.DIR_CD AND CP.RHQ_CD = T.RHQ_CD AND (T.BSE_YR||T.BSE_WK BETWEEN CP.APLY_FM_YRWK AND CP.APLY_TO_YRWK) AND ROWNUM < 2),0,0," ).append("\n"); 
		query.append("                                DECODE(LOD_RNK, 1, DECODE(ROUND(ORG_LOD - VVD_LOD_SUM),0,OFC_LOD,NVL((OFC_LOD + ROUND(ORG_LOD - DECODE(OFC_LOD, 0, 0, VVD_LOD_SUM)))*NVL((SELECT DISTINCT CP.LOD_POTN_RTO/100 FROM SQM_CFM_QTA_POTN_MGMT CP WHERE CP.BSE_TP_CD = T.BSE_TP_CD AND CP.BSE_YR = T.BSE_YR AND CP.BSE_QTR_CD = T.BSE_QTR_CD AND CP.OFC_VW_CD = T.OFC_VW_CD AND CP.QTA_STEP_CD = '02' AND CP.TRD_CD = T.TRD_CD AND CP.RLANE_CD = T.RLANE_CD AND CP.DIR_CD = T.DIR_CD AND CP.RHQ_CD = T.RHQ_CD AND (T.BSE_YR||T.BSE_WK BETWEEN CP.APLY_FM_YRWK AND CP.APLY_TO_YRWK) AND ROWNUM < 2),1),0)), OFC_LOD)), " ).append("\n"); 
		query.append("                                    DECODE(RHQ_RNK, 1, DECODE(LOD_RNK, 1, (OFC_LOD + ROUND(ORG_LOD - VVD_LOD_SUM))*NVL(DECODE((SELECT R.LOAD_RATIO FROM RATIO R WHERE R.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO AND R.BSE_TP_CD = T.BSE_TP_CD AND R.BSE_QTR_CD = T.BSE_QTR_CD AND R.OFC_VW_CD = T.OFC_VW_CD AND R.QTA_TGT_CD = T.QTA_TGT_CD AND R.TRD_CD = T.TRD_CD AND R.RLANE_CD =T.RLANE_CD AND R.DIR_CD = T.DIR_CD AND R.BSE_WK = T.BSE_WK AND R.VSL_CD = T.VSL_CD AND R.SKD_VOY_NO = T.SKD_VOY_NO AND R.SKD_DIR_CD = T.SKD_DIR_CD),0,(SELECT PLANNING.LOD_POTN_RTO/100 FROM SQM_QTA_POTN_MGMT PLANNING WHERE PLANNING.BSE_TP_CD = T.BSE_TP_CD AND PLANNING.BSE_YR = T.BSE_YR AND PLANNING.BSE_QTR_CD = T.BSE_QTR_CD AND PLANNING.OFC_VW_CD = T.OFC_VW_CD AND PLANNING.QTA_STEP_CD = '02' and PLANNING.RHQ_CD = T.RHQ_CD AND PLANNING.RGN_OFC_CD = T.RHQ_CD AND PLANNING.TRD_CD = T.TRD_CD AND PLANNING.RLANE_CD = T.RLANE_CD AND PLANNING.DIR_CD = T.DIR_CD),(SELECT R.LOAD_RATIO FROM RATIO R WHERE R.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO AND R.BSE_TP_CD = T.BSE_TP_CD AND R.BSE_QTR_CD = T.BSE_QTR_CD AND R.OFC_VW_CD = T.OFC_VW_CD AND R.QTA_TGT_CD = T.QTA_TGT_CD AND R.TRD_CD = T.TRD_CD AND R.RLANE_CD =T.RLANE_CD AND R.DIR_CD = T.DIR_CD AND R.BSE_WK = T.BSE_WK AND R.VSL_CD = T.VSL_CD AND R.SKD_VOY_NO = T.SKD_VOY_NO AND R.SKD_DIR_CD = T.SKD_DIR_CD)),1), " ).append("\n"); 
		query.append("                                        OFC_LOD*NVL(DECODE((SELECT R.LOAD_RATIO FROM RATIO R WHERE R.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO AND R.BSE_TP_CD = T.BSE_TP_CD AND R.BSE_QTR_CD = T.BSE_QTR_CD AND R.OFC_VW_CD = T.OFC_VW_CD AND R.QTA_TGT_CD = T.QTA_TGT_CD AND R.TRD_CD = T.TRD_CD AND R.RLANE_CD =T.RLANE_CD AND R.DIR_CD = T.DIR_CD AND R.BSE_WK = T.BSE_WK AND R.VSL_CD = T.VSL_CD AND R.SKD_VOY_NO = T.SKD_VOY_NO AND R.SKD_DIR_CD = T.SKD_DIR_CD),0,(SELECT PLANNING.LOD_POTN_RTO/100 FROM SQM_QTA_POTN_MGMT PLANNING WHERE PLANNING.BSE_TP_CD = T.BSE_TP_CD AND PLANNING.BSE_YR = T.BSE_YR AND PLANNING.BSE_QTR_CD = T.BSE_QTR_CD AND PLANNING.OFC_VW_CD = T.OFC_VW_CD AND PLANNING.QTA_STEP_CD = '02' and PLANNING.RHQ_CD = T.RHQ_CD AND PLANNING.RGN_OFC_CD = T.RHQ_CD AND PLANNING.TRD_CD = T.TRD_CD AND PLANNING.RLANE_CD = T.RLANE_CD AND PLANNING.DIR_CD = T.DIR_CD),(SELECT R.LOAD_RATIO FROM RATIO R WHERE R.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO AND R.BSE_TP_CD = T.BSE_TP_CD AND R.BSE_QTR_CD = T.BSE_QTR_CD AND R.OFC_VW_CD = T.OFC_VW_CD AND R.QTA_TGT_CD = T.QTA_TGT_CD AND R.TRD_CD = T.TRD_CD AND R.RLANE_CD =T.RLANE_CD AND R.DIR_CD = T.DIR_CD AND R.BSE_WK = T.BSE_WK AND R.VSL_CD = T.VSL_CD AND R.SKD_VOY_NO = T.SKD_VOY_NO AND R.SKD_DIR_CD = T.SKD_DIR_CD)),1)), " ).append("\n"); 
		query.append("                                           OFC_LOD)))) AS LOD_QTY" ).append("\n"); 
		query.append("                                                " ).append("\n"); 
		query.append("                        ,DECODE((SELECT 'CFM PORTION EXIST' FROM SQM_CFM_QTA_POTN_MGMT CP WHERE CP.BSE_TP_CD = T.BSE_TP_CD AND CP.BSE_YR = T.BSE_YR AND CP.BSE_QTR_CD = T.BSE_QTR_CD AND CP.OFC_VW_CD = T.OFC_VW_CD AND CP.QTA_STEP_CD = '02' AND CP.TRD_CD = T.TRD_CD AND CP.RLANE_CD = T.RLANE_CD AND CP.DIR_CD = T.DIR_CD AND (T.BSE_YR||T.BSE_WK BETWEEN CP.APLY_FM_YRWK AND CP.APLY_TO_YRWK) AND ROWNUM < 2), NULL, DECODE((ORG_REV - VVD_REV_SUM), 0, OFC_REV, DECODE(RHQ_RNK, 1, DECODE(LOD_RNK, 1, OFC_REV + (ORG_REV - VVD_REV_SUM), OFC_REV), OFC_REV)), " ).append("\n"); 
		query.append("                            DECODE(OFC_REV, 0, DECODE((SELECT CP.REV_POTN_RTO FROM SQM_CFM_QTA_POTN_MGMT CP WHERE CP.BSE_TP_CD = T.BSE_TP_CD AND CP.BSE_YR = T.BSE_YR AND CP.BSE_QTR_CD = T.BSE_QTR_CD AND CP.OFC_VW_CD = T.OFC_VW_CD AND CP.QTA_STEP_CD = '02' AND CP.TRD_CD = T.TRD_CD AND CP.RLANE_CD = T.RLANE_CD AND CP.DIR_CD = T.DIR_CD AND CP.RHQ_CD = T.RHQ_CD AND (T.BSE_YR||T.BSE_WK BETWEEN CP.APLY_FM_YRWK AND CP.APLY_TO_YRWK) AND ROWNUM < 2),0,0," ).append("\n"); 
		query.append("                                DECODE(LOD_RNK, 1, DECODE((ORG_REV - VVD_REV_SUM),0,OFC_REV,NVL((OFC_REV + (ORG_REV - DECODE(OFC_REV, 0, 0, VVD_REV_SUM)))*NVL((SELECT DISTINCT CP.REV_POTN_RTO/100 FROM SQM_CFM_QTA_POTN_MGMT CP WHERE CP.BSE_TP_CD = T.BSE_TP_CD AND CP.BSE_YR = T.BSE_YR AND CP.BSE_QTR_CD = T.BSE_QTR_CD AND CP.OFC_VW_CD = T.OFC_VW_CD AND CP.QTA_STEP_CD = '02' AND CP.TRD_CD = T.TRD_CD AND CP.RLANE_CD = T.RLANE_CD AND CP.DIR_CD = T.DIR_CD AND CP.RHQ_CD = T.RHQ_CD AND (T.BSE_YR||T.BSE_WK BETWEEN CP.APLY_FM_YRWK AND CP.APLY_TO_YRWK) AND ROWNUM < 2),1),0)), OFC_REV)), " ).append("\n"); 
		query.append("                                    DECODE(RHQ_RNK, 1, DECODE(LOD_RNK, 1, (OFC_REV + (ORG_REV - VVD_REV_SUM))*NVL(DECODE((SELECT R.REV_RATIO FROM RATIO R WHERE R.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO AND R.BSE_TP_CD = T.BSE_TP_CD AND R.BSE_QTR_CD = T.BSE_QTR_CD AND R.OFC_VW_CD = T.OFC_VW_CD AND R.QTA_TGT_CD = T.QTA_TGT_CD AND R.TRD_CD = T.TRD_CD AND R.RLANE_CD =T.RLANE_CD AND R.DIR_CD = T.DIR_CD AND R.BSE_WK = T.BSE_WK AND R.VSL_CD = T.VSL_CD AND R.SKD_VOY_NO = T.SKD_VOY_NO AND R.SKD_DIR_CD = T.SKD_DIR_CD),0,(SELECT PLANNING.REV_POTN_RTO FROM SQM_QTA_POTN_MGMT PLANNING WHERE PLANNING.BSE_TP_CD = T.BSE_TP_CD AND PLANNING.BSE_YR = T.BSE_YR AND PLANNING.BSE_QTR_CD = T.BSE_QTR_CD AND PLANNING.OFC_VW_CD = T.OFC_VW_CD AND PLANNING.QTA_STEP_CD = '02' and PLANNING.RHQ_CD = T.RHQ_CD AND PLANNING.RGN_OFC_CD = T.RHQ_CD AND PLANNING.TRD_CD = T.TRD_CD AND PLANNING.RLANE_CD = T.RLANE_CD AND PLANNING.DIR_CD = T.DIR_CD),(SELECT R.REV_RATIO FROM RATIO R WHERE R.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO AND R.BSE_TP_CD = T.BSE_TP_CD AND R.BSE_QTR_CD = T.BSE_QTR_CD AND R.OFC_VW_CD = T.OFC_VW_CD AND R.QTA_TGT_CD = T.QTA_TGT_CD AND R.TRD_CD = T.TRD_CD AND R.RLANE_CD =T.RLANE_CD AND R.DIR_CD = T.DIR_CD AND R.BSE_WK = T.BSE_WK AND R.VSL_CD = T.VSL_CD AND R.SKD_VOY_NO = T.SKD_VOY_NO AND R.SKD_DIR_CD = T.SKD_DIR_CD)),1), " ).append("\n"); 
		query.append("                                        OFC_REV*NVL(DECODE((SELECT R.REV_RATIO FROM RATIO R WHERE R.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO AND R.BSE_TP_CD = T.BSE_TP_CD AND R.BSE_QTR_CD = T.BSE_QTR_CD AND R.OFC_VW_CD = T.OFC_VW_CD AND R.QTA_TGT_CD = T.QTA_TGT_CD AND R.TRD_CD = T.TRD_CD AND R.RLANE_CD =T.RLANE_CD AND R.DIR_CD = T.DIR_CD AND R.BSE_WK = T.BSE_WK AND R.VSL_CD = T.VSL_CD AND R.SKD_VOY_NO = T.SKD_VOY_NO AND R.SKD_DIR_CD = T.SKD_DIR_CD),(SELECT PLANNING.REV_POTN_RTO FROM SQM_QTA_POTN_MGMT PLANNING WHERE PLANNING.BSE_TP_CD = T.BSE_TP_CD AND PLANNING.BSE_YR = T.BSE_YR AND PLANNING.BSE_QTR_CD = T.BSE_QTR_CD AND PLANNING.OFC_VW_CD = T.OFC_VW_CD AND PLANNING.QTA_STEP_CD = '02' and PLANNING.RHQ_CD = T.RHQ_CD AND PLANNING.RGN_OFC_CD = T.RHQ_CD AND PLANNING.TRD_CD = T.TRD_CD AND PLANNING.RLANE_CD = T.RLANE_CD AND PLANNING.DIR_CD = T.DIR_CD),(SELECT R.REV_RATIO FROM RATIO R WHERE R.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO AND R.BSE_TP_CD = T.BSE_TP_CD AND R.BSE_QTR_CD = T.BSE_QTR_CD AND R.OFC_VW_CD = T.OFC_VW_CD AND R.QTA_TGT_CD = T.QTA_TGT_CD AND R.TRD_CD = T.TRD_CD AND R.RLANE_CD =T.RLANE_CD AND R.DIR_CD = T.DIR_CD AND R.BSE_WK = T.BSE_WK AND R.VSL_CD = T.VSL_CD AND R.SKD_VOY_NO = T.SKD_VOY_NO AND R.SKD_DIR_CD = T.SKD_DIR_CD)),1)), " ).append("\n"); 
		query.append("                                            OFC_REV))) AS OFC_REV" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                        ,PA_CM_UC_AMT" ).append("\n"); 
		query.append("                        ,RA_CM_UC_AMT" ).append("\n"); 
		query.append("                    FROM (" ).append("\n"); 
		query.append("                            SELECT QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                  ,BSE_TP_CD" ).append("\n"); 
		query.append("                                  ,BSE_YR" ).append("\n"); 
		query.append("                                  ,BSE_QTR_CD" ).append("\n"); 
		query.append("                                  ,OFC_VW_CD" ).append("\n"); 
		query.append("                                  ,QTA_TGT_CD" ).append("\n"); 
		query.append("                                  ,TRD_CD" ).append("\n"); 
		query.append("                                  ,RLANE_CD" ).append("\n"); 
		query.append("                                  ,DIR_CD" ).append("\n"); 
		query.append("                                  ,BSE_WK" ).append("\n"); 
		query.append("                                  ,SUB_TRD_CD" ).append("\n"); 
		query.append("                                  ,HUL_BND_CD" ).append("\n"); 
		query.append("                                  ,OB_DIV_CD" ).append("\n"); 
		query.append("                                  ,FNL_BSA_CAPA" ).append("\n"); 
		query.append("                                  ,VSL_CD" ).append("\n"); 
		query.append("                                  ,SKD_VOY_NO" ).append("\n"); 
		query.append("                                  ,SKD_DIR_CD" ).append("\n"); 
		query.append("                                  ,RGN_OFC_CD" ).append("\n"); 
		query.append("                                  ,RHQ_CD" ).append("\n"); 
		query.append("                                  ,NVL(( SELECT V.N3RD_PRNT_OFC_CD" ).append("\n"); 
		query.append("                                       FROM SQM_ORGANIZATION_V V" ).append("\n"); 
		query.append("                                      WHERE V.OFC_CD   = RGN_OFC_CD" ).append("\n"); 
		query.append("                                        AND V.DELT_FLG = 'N'" ).append("\n"); 
		query.append("                                   ),'') AS AQ_CD" ).append("\n"); 
		query.append("                                  ,CONV_DIR_CD" ).append("\n"); 
		query.append("                                  ,ROW_NUMBER() OVER (PARTITION BY BSE_TP_CD, BSE_YR, BSE_QTR_CD, OFC_VW_CD, TRD_CD, RLANE_CD, CONV_DIR_CD, VSL_CD || SKD_VOY_NO || SKD_DIR_CD, RHQ_CD ORDER BY OFC_LOD DESC, RGN_OFC_CD) AS LOD_RNK" ).append("\n"); 
		query.append("                                  ,OFC_LOD as old_ofc_cd" ).append("\n"); 
		query.append("                                  ,ROUND(RHQ_QTY - RHQ_LOD_SUM) diff" ).append("\n"); 
		query.append("                                  -- OFFICE 별 물량에 RHQ 별 DIFF가 존재할 경우 LOAD RNK가 1인 것에 물량을 가감한다." ).append("\n"); 
		query.append("                                  ,DECODE(OFC_LOD_RTO, 0, 0, DECODE(LOD_RNK, 1, OFC_LOD + ROUND(RHQ_QTY - RHQ_LOD_SUM), OFC_LOD)) AS OFC_LOD" ).append("\n"); 
		query.append("                                  ,SUM(DECODE(OFC_LOD_RTO, 0, 0, DECODE(LOD_RNK, 1, OFC_LOD + ROUND(RHQ_QTY - RHQ_LOD_SUM), OFC_LOD))) OVER (PARTITION BY BSE_TP_CD, BSE_YR, BSE_QTR_CD, OFC_VW_CD, TRD_CD, RLANE_CD, CONV_DIR_CD, VSL_CD, SKD_VOY_NO, RHQ_CD) AS RHQ_LOD_SUM" ).append("\n"); 
		query.append("                                  ,SUM(DECODE(OFC_LOD_RTO, 0, 0, DECODE(LOD_RNK, 1, OFC_LOD + ROUND(RHQ_QTY - RHQ_LOD_SUM), OFC_LOD))) OVER (PARTITION BY BSE_TP_CD, BSE_YR, BSE_QTR_CD, OFC_VW_CD, TRD_CD, RLANE_CD, CONV_DIR_CD, VSL_CD, SKD_VOY_NO) AS VVD_LOD_SUM" ).append("\n"); 
		query.append("                                  -- OFFICE 별 물량에 존재할 경우 RHQ 별 REV DIFF가 존재할 경우 REV RNK가 1인 것에 물량을 가감한다." ).append("\n"); 
		query.append("                                  ,DECODE(DECODE(OFC_LOD_RTO, 0, 0, DECODE(LOD_RNK, 1, OFC_LOD + ROUND(RHQ_QTY - RHQ_LOD_SUM), OFC_LOD))" ).append("\n"); 
		query.append("                                         ,0, 0" ).append("\n"); 
		query.append("                                         ,DECODE(REV_RNK, 1, OFC_REV + (RHQ_REV - RHQ_REV_SUM), OFC_REV)) AS OFC_REV" ).append("\n"); 
		query.append("                                  ,SUM(DECODE(DECODE(OFC_LOD_RTO, 0, 0, DECODE(LOD_RNK, 1, OFC_LOD + ROUND(RHQ_QTY - RHQ_LOD_SUM), OFC_LOD))" ).append("\n"); 
		query.append("                                             ,0, 0" ).append("\n"); 
		query.append("                                             ,DECODE(REV_RNK, 1, OFC_REV + (RHQ_REV - RHQ_REV_SUM), OFC_REV))) OVER (PARTITION BY BSE_TP_CD, BSE_YR, BSE_QTR_CD, OFC_VW_CD, TRD_CD, RLANE_CD, CONV_DIR_CD, VSL_CD, SKD_VOY_NO, RHQ_CD) AS RHQ_REV_SUM" ).append("\n"); 
		query.append("                                  ,SUM(DECODE(DECODE(OFC_LOD_RTO, 0, 0, DECODE(LOD_RNK, 1, OFC_LOD + ROUND(RHQ_QTY - RHQ_LOD_SUM), OFC_LOD))" ).append("\n"); 
		query.append("                                             ,0, 0" ).append("\n"); 
		query.append("                                             ,DECODE(REV_RNK, 1, OFC_REV + (RHQ_REV - RHQ_REV_SUM), OFC_REV))) OVER (PARTITION BY BSE_TP_CD, BSE_YR, BSE_QTR_CD, OFC_VW_CD, TRD_CD, RLANE_CD, CONV_DIR_CD, VSL_CD, SKD_VOY_NO) AS VVD_REV_SUM" ).append("\n"); 
		query.append("                                  ,PA_CM_UC_AMT" ).append("\n"); 
		query.append("                                  ,RA_CM_UC_AMT" ).append("\n"); 
		query.append("                                  ,'I' AS SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                  ,RHQ_RNK" ).append("\n"); 
		query.append("                                  ,OFC_LOD_RTO" ).append("\n"); 
		query.append("                                  ,OFC_REV_RTO" ).append("\n"); 
		query.append("                                  ,RHQ_LOD_RTO" ).append("\n"); 
		query.append("                                  ,RHQ_REV_RTO" ).append("\n"); 
		query.append("                                  ,RHQ_QTY" ).append("\n"); 
		query.append("                                  ,RHQ_REV AS ORG_RHQ_REV" ).append("\n"); 
		query.append("                                  ,ORG_LOD" ).append("\n"); 
		query.append("                                  ,ORG_REV " ).append("\n"); 
		query.append("                              FROM (" ).append("\n"); 
		query.append("                                      SELECT SUBSTR(E1.BSE_YR,-2)||E1.BSE_QTR_CD||'02' AS QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                            ,E1.BSE_TP_CD" ).append("\n"); 
		query.append("                                            ,E1.BSE_YR" ).append("\n"); 
		query.append("                                            ,E1.BSE_QTR_CD" ).append("\n"); 
		query.append("                                            ,E1.OFC_VW_CD" ).append("\n"); 
		query.append("                                            ,E1.QTA_TGT_CD" ).append("\n"); 
		query.append("                                            ,E1.TRD_CD" ).append("\n"); 
		query.append("                                            ,E1.RLANE_CD" ).append("\n"); 
		query.append("                                            ,E1.DIR_CD" ).append("\n"); 
		query.append("                                            ,E1.BSE_WK" ).append("\n"); 
		query.append("                                            ,E1.SLS_YRWK" ).append("\n"); 
		query.append("                                            ,E1.SUB_TRD_CD" ).append("\n"); 
		query.append("                                            ,E1.HUL_BND_CD" ).append("\n"); 
		query.append("                                            ,E1.OB_DIV_CD" ).append("\n"); 
		query.append("                                            ,E1.FNL_BSA_CAPA" ).append("\n"); 
		query.append("                                            ,E1.VSL_CD" ).append("\n"); 
		query.append("                                            ,E1.SKD_VOY_NO" ).append("\n"); 
		query.append("                                            ,E1.SKD_DIR_CD" ).append("\n"); 
		query.append("                                            ,E1.RGN_OFC_CD" ).append("\n"); 
		query.append("                                            ,E1.RHQ_CD" ).append("\n"); 
		query.append("                                            ,E1.CONV_DIR_CD" ).append("\n"); 
		query.append("                                            ,(E1.RHQ_QTY - SUM(ROUND(E1.RHQ_QTY * NVL(E3.LOD_POTN_RTO / 100, E1.OFC_LOD_RTO), 0)) OVER (PARTITION BY E1.BSE_TP_CD, E1.BSE_YR, E1.BSE_QTR_CD, E1.OFC_VW_CD, E1.TRD_CD, E1.RLANE_CD, E1.CONV_DIR_CD, E1.VSL_CD, E1.SKD_VOY_NO, E1.RHQ_CD)) AS RHQ_LOD_DIFF" ).append("\n"); 
		query.append("                                            ,ROUND(E1.RHQ_QTY * (NVL(E3.LOD_POTN_RTO / 100, E1.OFC_LOD_RTO)), 0) AS OFC_LOD" ).append("\n"); 
		query.append("                                            ,DECODE(RHQ_QTY, 0, 0, RHQ_REV * NVL(E3.REV_POTN_RTO / 100, E1.OFC_REV_RTO)) AS OFC_REV" ).append("\n"); 
		query.append("                                            ,SUM(ROUND(E1.RHQ_QTY * (NVL(E3.LOD_POTN_RTO / 100, E1.OFC_LOD_RTO)), 0)) OVER (PARTITION BY E1.BSE_TP_CD, E1.BSE_YR, E1.BSE_QTR_CD, E1.OFC_VW_CD, E1.TRD_CD, E1.RLANE_CD, E1.CONV_DIR_CD, E1.VSL_CD, E1.SKD_VOY_NO, E1.RHQ_CD) AS RHQ_LOD_SUM" ).append("\n"); 
		query.append("                                            ,SUM(DECODE(RHQ_QTY, 0, 0, RHQ_REV * NVL(E3.REV_POTN_RTO / 100, E1.OFC_REV_RTO))) OVER (PARTITION BY E1.BSE_TP_CD, E1.BSE_YR, E1.BSE_QTR_CD, E1.OFC_VW_CD, E1.TRD_CD, E1.RLANE_CD, E1.CONV_DIR_CD, E1.VSL_CD, E1.SKD_VOY_NO, E1.RHQ_CD) AS RHQ_REV_SUM" ).append("\n"); 
		query.append("                                            ,E2.PA_CM_UC_AMT" ).append("\n"); 
		query.append("                                            ,E2.RA_CM_UC_AMT" ).append("\n"); 
		query.append("                                            ,NVL(E3.LOD_POTN_RTO / 100, E1.OFC_LOD_RTO) AS OFC_LOD_RTO" ).append("\n"); 
		query.append("                                            ,NVL(E3.REV_POTN_RTO / 100, E1.OFC_REV_RTO) AS OFC_REV_RTO" ).append("\n"); 
		query.append("                                            ,E1.RHQ_LOD_RTO" ).append("\n"); 
		query.append("                                            ,E1.RHQ_REV_RTO" ).append("\n"); 
		query.append("                                            ,E1.RHQ_RNK" ).append("\n"); 
		query.append("                                            ,E1.RHQ_QTY" ).append("\n"); 
		query.append("                                            ,E1.RHQ_REV" ).append("\n"); 
		query.append("                                            ,E1.ORG_LOD" ).append("\n"); 
		query.append("                                            ,E1.ORG_REV" ).append("\n"); 
		query.append("                                            ,ROW_NUMBER() OVER (PARTITION BY E1.BSE_TP_CD, E1.BSE_YR, E1.BSE_QTR_CD, E1.OFC_VW_CD, E1.RHQ_CD, E1.TRD_CD, E1.DIR_CD, E1.RLANE_CD, E1.VSL_CD, E1.SKD_VOY_NO ORDER BY NVL(E3.LOD_POTN_RTO / 100, E1.OFC_LOD_RTO) DESC, E1.RGN_OFC_CD) AS LOD_RNK" ).append("\n"); 
		query.append("                                            ,ROW_NUMBER() OVER (PARTITION BY E1.BSE_TP_CD, E1.BSE_YR, E1.BSE_QTR_CD, E1.OFC_VW_CD, E1.RHQ_CD, E1.TRD_CD, E1.DIR_CD, E1.RLANE_CD, E1.VSL_CD, E1.SKD_VOY_NO ORDER BY NVL(E3.REV_POTN_RTO / 100, E1.OFC_REV_RTO) DESC, E1.RGN_OFC_CD) AS REV_RNK" ).append("\n"); 
		query.append("                                        FROM (" ).append("\n"); 
		query.append("                                              SELECT D2.BSE_TP_CD" ).append("\n"); 
		query.append("                                                    ,D2.BSE_YR" ).append("\n"); 
		query.append("                                                    ,D2.BSE_QTR_CD" ).append("\n"); 
		query.append("                                                    ,D2.OFC_VW_CD" ).append("\n"); 
		query.append("                                                    ,D1.QTA_STEP_CD" ).append("\n"); 
		query.append("                                                    ,D2.TRD_CD" ).append("\n"); 
		query.append("                                                    ,D2.RLANE_CD" ).append("\n"); 
		query.append("                                                    ,D1.DIR_CD" ).append("\n"); 
		query.append("                                                    ,D2.SUB_TRD_CD" ).append("\n"); 
		query.append("                                                    ,D2.HUL_BND_CD" ).append("\n"); 
		query.append("                                                    ,D2.OB_DIV_CD" ).append("\n"); 
		query.append("                                                    ,D2.FNL_BSA_CAPA                                            " ).append("\n"); 
		query.append("                                                    ,D2.VSL_CD" ).append("\n"); 
		query.append("                                                    ,D2.SKD_VOY_NO" ).append("\n"); 
		query.append("                                                    ,D2.SKD_DIR_CD" ).append("\n"); 
		query.append("                                                    ,D2.BSE_WK" ).append("\n"); 
		query.append("                                                    ,D2.SLS_YRWK" ).append("\n"); 
		query.append("                                                    ,D1.RGN_OFC_CD" ).append("\n"); 
		query.append("                                                    ,D2.RHQ_CD" ).append("\n"); 
		query.append("                                                    ,D2.CONV_DIR_CD" ).append("\n"); 
		query.append("                                                    ,D1.OFC_LOD_RTO" ).append("\n"); 
		query.append("                                                    ,D1.OFC_REV_RTO" ).append("\n"); 
		query.append("                                                    ,D2.RHQ_QTY" ).append("\n"); 
		query.append("                                                    ,D2.RHQ_REV" ).append("\n"); 
		query.append("                                                    ,D2.QTA_TGT_CD" ).append("\n"); 
		query.append("                                                    ,D2.RHQ_RNK" ).append("\n"); 
		query.append("                                                    ,D2.RHQ_LOD_RTO" ).append("\n"); 
		query.append("                                                    ,D2.RHQ_REV_RTO" ).append("\n"); 
		query.append("                                                    ,D2.ORG_LOD" ).append("\n"); 
		query.append("                                                    ,D2.ORG_REV" ).append("\n"); 
		query.append("                                                FROM (" ).append("\n"); 
		query.append("                                                      SELECT A1.BSE_TP_CD" ).append("\n"); 
		query.append("                                                            ,A1.BSE_YR" ).append("\n"); 
		query.append("                                                            ,A1.BSE_QTR_CD" ).append("\n"); 
		query.append("                                                            ,A1.OFC_VW_CD" ).append("\n"); 
		query.append("                                                            ,NVL(A2.QTA_STEP_CD, DECODE(A1.OFC_VW_CD, 'L', '03', DECODE(A4.OB_DIV_CD, 'N', '04', 'O', '05'))) AS QTA_STEP_CD" ).append("\n"); 
		query.append("                                                            ,A1.TRD_CD" ).append("\n"); 
		query.append("                                                            ,A1.DIR_CD" ).append("\n"); 
		query.append("                                                            ,NVL(A3.CONV_DIR_CD, A1.DIR_CD) AS CONV_DIR_CD" ).append("\n"); 
		query.append("                                                            ,A1.RLANE_CD" ).append("\n"); 
		query.append("                                                            ,A1.RHQ_CD" ).append("\n"); 
		query.append("                                                            ,A1.RGN_OFC_CD" ).append("\n"); 
		query.append("                                                            ,NVL(A2.LOD_POTN_RTO,0) / 100 AS OFC_LOD_RTO" ).append("\n"); 
		query.append("                                                            ,NVL(A2.REV_POTN_RTO,0) / 100 AS OFC_REV_RTO" ).append("\n"); 
		query.append("                                                        FROM SQM_QTA_LANE_OFC A1" ).append("\n"); 
		query.append("                                                            ,SQM_QTA_POTN_MGMT A2" ).append("\n"); 
		query.append("                                                            ,SQM_DIR_CONV A3" ).append("\n"); 
		query.append("                                                            ,SQM_DAT_RLT A4" ).append("\n"); 
		query.append("                                                       WHERE 1=1" ).append("\n"); 
		query.append("                                                         AND A1.BSE_TP_CD   = A2.BSE_TP_CD(+)" ).append("\n"); 
		query.append("                                                         AND A1.BSE_YR      = A2.BSE_YR(+)" ).append("\n"); 
		query.append("                                                         AND A1.BSE_QTR_CD  = A2.BSE_QTR_CD(+)" ).append("\n"); 
		query.append("                                                         AND A1.OFC_VW_CD   = A2.OFC_VW_CD(+)" ).append("\n"); 
		query.append("                                                         AND A1.TRD_CD      = A2.TRD_CD(+)" ).append("\n"); 
		query.append("                                                         AND A1.DIR_CD      = A2.DIR_CD(+)" ).append("\n"); 
		query.append("                                                         AND A1.RHQ_CD      = A2.RHQ_CD(+)" ).append("\n"); 
		query.append("                                                         AND A1.RLANE_CD    = A2.RLANE_CD(+)" ).append("\n"); 
		query.append("                                                         AND A1.RGN_OFC_CD  = A2.RGN_OFC_CD(+)" ).append("\n"); 
		query.append("                                                         " ).append("\n"); 
		query.append("                                                         AND A1.BSE_TP_CD   = A3.BSE_TP_CD(+)" ).append("\n"); 
		query.append("                                                         AND A1.BSE_YR      = A3.BSE_YR(+)" ).append("\n"); 
		query.append("                                                         AND A1.BSE_QTR_CD  = A3.BSE_QTR_CD(+)" ).append("\n"); 
		query.append("                                                         AND A1.TRD_CD      = A3.TRD_CD(+)" ).append("\n"); 
		query.append("                                                         AND A1.RLANE_CD    = A3.RLANE_CD(+)" ).append("\n"); 
		query.append("                                                         AND A1.DIR_CD      = A3.DIR_CD(+)" ).append("\n"); 
		query.append("                                                         " ).append("\n"); 
		query.append("                                                         AND A1.BSE_TP_CD   = A4.BSE_TP_CD" ).append("\n"); 
		query.append("                                                         AND A1.BSE_YR      = A4.BSE_YR" ).append("\n"); 
		query.append("                                                         AND A1.BSE_QTR_CD  = A4.BSE_QTR_CD" ).append("\n"); 
		query.append("                                                         AND A1.OFC_VW_CD   = A4.OFC_VW_CD" ).append("\n"); 
		query.append("                                                         AND A1.TRD_CD      = A4.TRD_CD" ).append("\n"); 
		query.append("                                                         AND A1.RLANE_CD    = DECODE(UPPER(A4.RLANE_CD),'ALL',A1.RLANE_CD, A4.RLANE_CD)" ).append("\n"); 
		query.append("                                                         AND A1.RHQ_CD      = A4.RHQ_CD" ).append("\n"); 
		query.append("                                                         AND NVL(A3.CONV_DIR_CD, A1.DIR_CD) = A4.CONV_DIR_CD" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("                                                         AND A1.BSE_TP_CD   = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                         AND A1.BSE_YR      = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                         AND A1.BSE_QTR_CD  = DECODE(@[f_bse_tp_cd],'Y','00',@[f_bse_qtr_cd])" ).append("\n"); 
		query.append("#if (${f_gubun} == 'RHQ')" ).append("\n"); 
		query.append("                                                         AND A1.RHQ_CD      = (SELECT CASE WHEN @[ofc_cd] IN (SELECT INTG_CD_VAL_CTNT FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD03255') THEN A1.RHQ_CD" ).append("\n"); 
		query.append("                                                                                      ELSE DECODE(@[ofc_cd], 'SELCMI', A1.RHQ_CD, @[ofc_cd])" ).append("\n"); 
		query.append("                                                                                       END RHQ_CD" ).append("\n"); 
		query.append("                                                                                 FROM DUAL)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${f_ofc_vw_cd} != '' && ${f_ofc_vw_cd} != 'All')" ).append("\n"); 
		query.append("                                                         AND A1.OFC_VW_CD   = @[f_ofc_vw_cd]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                                                         AND A1.TRD_CD      = @[f_trd_cd]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${rlane_cd} != '' && ${rlane_cd} != 'All')" ).append("\n"); 
		query.append("                                                         AND A1.RLANE_CD    = @[rlane_cd] -- Adjustment by VVD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                                                         AND A1.RLANE_CD    IN (${f_rlane_cd})-- Portion Adjustment by HO/RHQ" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${f_dir_cd} != '' && ${f_dir_cd} != 'All')" ).append("\n"); 
		query.append("                                                         AND A1.DIR_CD      = @[f_dir_cd]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${f_click} != 'on' && ${f_conv_dir_cd} != '' && ${f_conv_dir_cd} != 'All')" ).append("\n"); 
		query.append("                                                         AND NVL(A3.CONV_DIR_CD, A1.DIR_CD) = @[f_conv_dir_cd]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                                                         AND A1.SQM_ACT_FLG = 'Y'" ).append("\n"); 
		query.append("                                                         AND A2.QTA_STEP_CD(+) <> '02'" ).append("\n"); 
		query.append("                                                      ) D1" ).append("\n"); 
		query.append("                                                    ,(" ).append("\n"); 
		query.append("                                                      SELECT C1.BSE_TP_CD" ).append("\n"); 
		query.append("                                                            ,C1.BSE_YR" ).append("\n"); 
		query.append("                                                            ,C1.BSE_QTR_CD" ).append("\n"); 
		query.append("                                                            ,C1.OFC_VW_CD" ).append("\n"); 
		query.append("                                                            ,C1.QTA_TGT_CD" ).append("\n"); 
		query.append("                                                            ,C1.TRD_CD" ).append("\n"); 
		query.append("                                                            ,C1.SUB_TRD_CD" ).append("\n"); 
		query.append("                                                            ,C1.HUL_BND_CD" ).append("\n"); 
		query.append("                                                            ,C1.OB_DIV_CD" ).append("\n"); 
		query.append("                                                            ,C1.FNL_BSA_CAPA" ).append("\n"); 
		query.append("                                                            ,C1.RLANE_CD" ).append("\n"); 
		query.append("                                                            ,C1.CONV_DIR_CD" ).append("\n"); 
		query.append("                                                            ,C1.DIR_CD" ).append("\n"); 
		query.append("                                                            ,C1.BSE_WK" ).append("\n"); 
		query.append("                                                            ,C1.SLS_YRWK" ).append("\n"); 
		query.append("                                                            ,C1.VSL_CD" ).append("\n"); 
		query.append("                                                            ,C1.SKD_VOY_NO" ).append("\n"); 
		query.append("                                                            ,C1.SKD_DIR_CD" ).append("\n"); 
		query.append("                                                            ,C1.RHQ_CD" ).append("\n"); 
		query.append("                                                            ,C1.LOAD_RNK AS RHQ_RNK" ).append("\n"); 
		query.append("                                                            ,DECODE(C1.LOAD_RNK, '1', C1.RHQ_QTY + (C1.ORG_VVD_BSA - C1.SUM_RHQ_QTY), C1.RHQ_QTY) AS RHQ_QTY" ).append("\n"); 
		query.append("                                                            ,C1.GRS_REV * C1.RHQ_REV_RTO AS RHQ_REV" ).append("\n"); 
		query.append("                                                            ,C1.RHQ_REV_RTO" ).append("\n"); 
		query.append("                                                            ,C1.RHQ_LOD_RTO" ).append("\n"); 
		query.append("                                                            ,C1.ORG_VVD_BSA AS ORG_LOD" ).append("\n"); 
		query.append("                                                            ,C1.GRS_REV AS ORG_REV" ).append("\n"); 
		query.append("                                                       FROM (" ).append("\n"); 
		query.append("                                                             SELECT B2.BSE_TP_CD" ).append("\n"); 
		query.append("                                                                   ,B2.BSE_YR" ).append("\n"); 
		query.append("                                                                   ,B2.BSE_QTR_CD" ).append("\n"); 
		query.append("                                                                   ,B2.OFC_VW_CD" ).append("\n"); 
		query.append("                                                                   ,B2.QTA_TGT_CD" ).append("\n"); 
		query.append("                                                                   ,B2.TRD_CD" ).append("\n"); 
		query.append("                                                                   ,B2.SUB_TRD_CD" ).append("\n"); 
		query.append("                                                                   ,B2.HUL_BND_CD" ).append("\n"); 
		query.append("                                                                   ,B2.OB_DIV_CD" ).append("\n"); 
		query.append("                                                                   ,B2.FNL_BSA_CAPA                                                           " ).append("\n"); 
		query.append("                                                                   ,B2.RLANE_CD" ).append("\n"); 
		query.append("                                                                   ,B2.CONV_DIR_CD" ).append("\n"); 
		query.append("                                                                   ,B2.DIR_CD" ).append("\n"); 
		query.append("                                                                   ,B2.BSE_WK" ).append("\n"); 
		query.append("                                                                   ,B2.SLS_YRWK" ).append("\n"); 
		query.append("                                                                   ,SUBSTR(B1.APLY_FM_YRWK,-2) AS APLY_FM_WK" ).append("\n"); 
		query.append("                                                                   ,SUBSTR(B1.APLY_TO_YRWK,-2) AS APLY_TO_WK" ).append("\n"); 
		query.append("                                                                   ,B1.APLY_FM_YRWK" ).append("\n"); 
		query.append("                                                                   ,B1.APLY_TO_YRWK" ).append("\n"); 
		query.append("                                                                   ,B2.VSL_CD" ).append("\n"); 
		query.append("                                                                   ,B2.SKD_VOY_NO" ).append("\n"); 
		query.append("                                                                   ,B2.SKD_DIR_CD" ).append("\n"); 
		query.append("                                                                   ,B2.RHQ_CD" ).append("\n"); 
		query.append("                                                                   ,NVL(B1.LOD_POTN_RTO,B2.RHQ_LOD_RTO) /100 AS RHQ_LOD_RTO" ).append("\n"); 
		query.append("                                                                   ,NVL(B1.REV_POTN_RTO,B2.RHQ_REV_RTO) /100 AS RHQ_REV_RTO" ).append("\n"); 
		query.append("                                                                   ,B2.GRS_REV" ).append("\n"); 
		query.append("                                                                   -- RHQ 별 물량을 구하기" ).append("\n"); 
		query.append("                                                                   ,B2.LOD_QTY AS ORG_VVD_BSA" ).append("\n"); 
		query.append("                                                                   ,ROUND(B2.LOD_QTY * NVL(NVL(B1.LOD_POTN_RTO,B2.RHQ_LOD_RTO),0)/100, 0) AS RHQ_QTY" ).append("\n"); 
		query.append("                                                                   ,SUM(ROUND(B2.LOD_QTY * NVL(NVL(B1.LOD_POTN_RTO,B2.RHQ_LOD_RTO),0)/100, 0)) OVER (PARTITION BY B2.OFC_VW_CD,B2.TRD_CD,B2.RLANE_CD,B2.CONV_DIR_CD,B2.VSL_CD || B2.SKD_VOY_NO || B2.SKD_DIR_CD) AS SUM_RHQ_QTY" ).append("\n"); 
		query.append("                                                                   ,ROW_NUMBER() OVER (PARTITION BY B2.OFC_VW_CD,B2.TRD_CD,B2.RLANE_CD,B2.CONV_DIR_CD,B2.VSL_CD || B2.SKD_VOY_NO || B2.SKD_DIR_CD ORDER BY NVL(B1.LOD_POTN_RTO,B2.RHQ_LOD_RTO) DESC, B1.RHQ_CD) LOAD_RNK" ).append("\n"); 
		query.append("                                                               FROM SQM_CFM_QTA_POTN_MGMT B1" ).append("\n"); 
		query.append("                                                                   ,(" ).append("\n"); 
		query.append("                                                                     SELECT DISTINCT " ).append("\n"); 
		query.append("                                                                            A1.BSE_TP_CD" ).append("\n"); 
		query.append("                                                                           ,A1.BSE_YR" ).append("\n"); 
		query.append("                                                                           ,A1.BSE_QTR_CD" ).append("\n"); 
		query.append("                                                                           ,A5.OFC_VW_CD" ).append("\n"); 
		query.append("                                                                           ,NVL(A2.QTA_STEP_CD, '02') AS QTA_STEP_CD" ).append("\n"); 
		query.append("                                                                           ,A1.TRD_CD" ).append("\n"); 
		query.append("                                                                           ,A1.SUB_TRD_CD" ).append("\n"); 
		query.append("                                                                           ,A1.RLANE_CD" ).append("\n"); 
		query.append("                                                                           ,A4.HUL_BND_CD" ).append("\n"); 
		query.append("                                                                           ,A3.OB_DIV_CD" ).append("\n"); 
		query.append("                                                                           ,A1.FNL_BSA_CAPA " ).append("\n"); 
		query.append("                                                                           ,A1.CONV_DIR_CD" ).append("\n"); 
		query.append("                                                                           ,A1.DIR_CD" ).append("\n"); 
		query.append("                                                                           ,A1.BSE_WK" ).append("\n"); 
		query.append("                                                                           ,A1.SLS_YRMON" ).append("\n"); 
		query.append("                                                                           ,SUBSTR(A1.SLS_YRMON,0,4)||A1.BSE_WK AS SLS_YRWK" ).append("\n"); 
		query.append("                                                                           ,A1.VSL_CD" ).append("\n"); 
		query.append("                                                                           ,A1.SKD_VOY_NO" ).append("\n"); 
		query.append("                                                                           ,A1.SKD_DIR_CD" ).append("\n"); 
		query.append("                                                                           ,A5.RHQ_CD" ).append("\n"); 
		query.append("                                                                           ,NVL(A2.LOD_POTN_RTO, 0) AS RHQ_LOD_RTO" ).append("\n"); 
		query.append("                                                                           ,NVL(A2.REV_POTN_RTO, 0) AS RHQ_REV_RTO" ).append("\n"); 
		query.append("                                                                           ,A1.GRS_REV" ).append("\n"); 
		query.append("                                                                           ,A1.LOD_QTY" ).append("\n"); 
		query.append("                                                                           ,A1.QTA_TGT_CD" ).append("\n"); 
		query.append("                                                                       FROM SQM_CFM_TGT_VVD A1" ).append("\n"); 
		query.append("                                                                           ,SQM_QTA_LANE_OFC A5" ).append("\n"); 
		query.append("                                                                           ,SQM_QTA_POTN_MGMT A2" ).append("\n"); 
		query.append("                                                                           ,SQM_DAT_RLT A3" ).append("\n"); 
		query.append("                                                                           ,MAS_LANE_RGST A4" ).append("\n"); 
		query.append("                                                                      WHERE 1=1" ).append("\n"); 
		query.append("                                                                        AND A1.BSE_TP_CD     = A5.BSE_TP_CD" ).append("\n"); 
		query.append("                                                                        AND A1.BSE_YR        = A5.BSE_YR" ).append("\n"); 
		query.append("                                                                        AND A1.BSE_QTR_CD    = A5.BSE_QTR_CD" ).append("\n"); 
		query.append("                                                                        AND A1.TRD_CD        = A5.TRD_CD" ).append("\n"); 
		query.append("                                                                        AND A1.RLANE_CD      = A5.RLANE_CD" ).append("\n"); 
		query.append("                                                                        AND A1.DIR_CD        = A5.DIR_CD" ).append("\n"); 
		query.append("                                                                        AND A5.SQM_ACT_FLG   = 'Y'" ).append("\n"); 
		query.append("                                                                        " ).append("\n"); 
		query.append("                                                                        AND A5.BSE_TP_CD     = A2.BSE_TP_CD(+)" ).append("\n"); 
		query.append("                                                                        AND A5.BSE_YR        = A2.BSE_YR(+)" ).append("\n"); 
		query.append("                                                                        AND A5.BSE_QTR_CD    = A2.BSE_QTR_CD(+)" ).append("\n"); 
		query.append("                                                                        AND A5.OFC_VW_CD     = A2.OFC_VW_CD(+)" ).append("\n"); 
		query.append("                                                                        AND A5.TRD_CD        = A2.TRD_CD(+)" ).append("\n"); 
		query.append("                                                                        AND A5.RLANE_CD      = A2.RLANE_CD(+)" ).append("\n"); 
		query.append("                                                                        AND A5.DIR_CD        = A2.DIR_CD(+)" ).append("\n"); 
		query.append("                                                                        AND A5.RHQ_CD        = A2.RHQ_CD(+)" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("                                                                        AND A5.BSE_TP_CD     = A3.BSE_TP_CD" ).append("\n"); 
		query.append("                                                                        AND A5.BSE_YR        = A3.BSE_YR" ).append("\n"); 
		query.append("                                                                        AND A5.BSE_QTR_CD    = A3.BSE_QTR_CD" ).append("\n"); 
		query.append("                                                                        AND A5.OFC_VW_CD     = A3.OFC_VW_CD" ).append("\n"); 
		query.append("                                                                        AND A5.TRD_CD        = A3.TRD_CD" ).append("\n"); 
		query.append("                                                                        AND A5.RLANE_CD      = DECODE(UPPER(A3.RLANE_CD),'ALL',A5.RLANE_CD, A3.RLANE_CD)" ).append("\n"); 
		query.append("                                                                        AND A1.CONV_DIR_CD   = A3.CONV_DIR_CD" ).append("\n"); 
		query.append("                                                                        AND A5.RHQ_CD        = A3.RHQ_CD" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("                                                                        AND A1.RLANE_CD      = A4.RLANE_CD" ).append("\n"); 
		query.append("                                                                        AND A1.DIR_CD        = A4.DIR_CD" ).append("\n"); 
		query.append("                                                                        AND A1.TRD_CD        = A4.TRD_CD" ).append("\n"); 
		query.append("                                                                        AND A1.IOC_CD        = A4.IOC_CD" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("                                                                        AND A1.QTA_RLSE_VER_NO = (SELECT QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                                                                    FROM SQM_QTA_RLSE_VER" ).append("\n"); 
		query.append("                                                                                                   WHERE BSE_TP_CD  = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                                                                     AND BSE_YR     = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                                                                     AND BSE_QTR_CD = DECODE(@[f_bse_tp_cd],'Y','00',@[f_bse_qtr_cd])" ).append("\n"); 
		query.append("                                                                                                     AND SQM_VER_STS_CD = 'R'" ).append("\n"); 
		query.append("                                                                                                  )" ).append("\n"); 
		query.append("                                                                        AND A1.BSE_TP_CD     = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                                        AND A1.BSE_YR        = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                                        AND A1.BSE_QTR_CD    = DECODE(@[f_bse_tp_cd],'Y','00',@[f_bse_qtr_cd])" ).append("\n"); 
		query.append("                                                                        AND A2.QTA_STEP_CD(+)= '02'" ).append("\n"); 
		query.append("#if (${f_gubun} == 'HO')" ).append("\n"); 
		query.append("                                                                        AND A3.TEAM_CD       = (SELECT CASE WHEN @[ofc_cd] IN (SELECT INTG_CD_VAL_CTNT FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD03255') THEN A3.TEAM_CD" ).append("\n"); 
		query.append("                                                                                                            ELSE @[ofc_cd]" ).append("\n"); 
		query.append("                                                                                                       END TEAM_CD" ).append("\n"); 
		query.append("                                                                                                FROM DUAL)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${f_ofc_vw_cd} != '' && ${f_ofc_vw_cd} != 'All')" ).append("\n"); 
		query.append("                                                                        AND A5.OFC_VW_CD     = @[f_ofc_vw_cd]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                                                                        AND A1.QTA_TGT_CD    = 'D'" ).append("\n"); 
		query.append("#if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                                                                        AND A1.TRD_CD        = @[f_trd_cd]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${rlane_cd} != '' && ${rlane_cd} != 'All')" ).append("\n"); 
		query.append("                                                                        AND A1.RLANE_CD      = @[rlane_cd] -- Adjustment by VVD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                                                                        AND A1.RLANE_CD      IN (${f_rlane_cd})-- Portion Adjustment by HO/RHQ" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${f_dir_cd} != '' && ${f_dir_cd} != 'All')" ).append("\n"); 
		query.append("                                                                        AND A1.DIR_CD        = @[f_dir_cd]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${f_click} != 'on' && ${f_conv_dir_cd} != '' && ${f_conv_dir_cd} != 'All')" ).append("\n"); 
		query.append("                                                                        AND A1.CONV_DIR_CD   = @[f_conv_dir_cd]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${f_click} == 'on' && ${f_trd_dir} != '' && ${f_trd_dir} != 'All')" ).append("\n"); 
		query.append("                                                                        AND A4.HUL_BND_CD    = @[f_trd_dir]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${mas_vvd} != '')" ).append("\n"); 
		query.append("                                                                        AND A1.VSL_CD || A1.SKD_VOY_NO || A1.SKD_DIR_CD = @[mas_vvd]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                                                                     ) B2" ).append("\n"); 
		query.append("                                                              WHERE 1=1" ).append("\n"); 
		query.append("                                                                AND B2.BSE_TP_CD     = B1.BSE_TP_CD(+)" ).append("\n"); 
		query.append("                                                                AND B2.BSE_YR        = B1.BSE_YR(+)" ).append("\n"); 
		query.append("                                                                AND B2.BSE_QTR_CD    = B1.BSE_QTR_CD(+)" ).append("\n"); 
		query.append("                                                                AND B2.OFC_VW_CD     = B1.OFC_VW_CD(+)" ).append("\n"); 
		query.append("                                                                AND B2.QTA_STEP_CD   = B1.QTA_STEP_CD(+)" ).append("\n"); 
		query.append("                                                                AND B2.TRD_CD        = B1.TRD_CD(+)" ).append("\n"); 
		query.append("                                                                AND B2.RLANE_CD      = B1.RLANE_CD(+)" ).append("\n"); 
		query.append("                                                                AND B2.DIR_CD        = B1.DIR_CD(+)" ).append("\n"); 
		query.append("                                                                AND B2.RHQ_CD        = B1.RHQ_CD(+)" ).append("\n"); 
		query.append("--                                                                AND B2.BSE_WK        BETWEEN SUBSTR(B1.APLY_FM_YRWK(+),-2) AND SUBSTR(B1.APLY_TO_YRWK(+),-2)" ).append("\n"); 
		query.append("                                                                AND B2.SLS_YRWK        BETWEEN B1.APLY_FM_YRWK(+) AND B1.APLY_TO_YRWK(+)" ).append("\n"); 
		query.append("                                                              ORDER BY B2.OFC_VW_CD, B2.BSE_WK, B2.RHQ_CD" ).append("\n"); 
		query.append("                                                             ) C1" ).append("\n"); 
		query.append("                                                      ) D2" ).append("\n"); 
		query.append("                                               WHERE 1=1" ).append("\n"); 
		query.append("                                                 AND D1.BSE_TP_CD   = D2.BSE_TP_CD" ).append("\n"); 
		query.append("                                                 AND D1.BSE_YR      = D2.BSE_YR" ).append("\n"); 
		query.append("                                                 AND D1.BSE_QTR_CD  = D2.BSE_QTR_CD" ).append("\n"); 
		query.append("                                                 AND D1.OFC_VW_CD   = D2.OFC_VW_CD" ).append("\n"); 
		query.append("                                                 AND D1.TRD_CD      = D2.TRD_CD" ).append("\n"); 
		query.append("                                                 AND D1.RLANE_CD    = D2.RLANE_CD" ).append("\n"); 
		query.append("                                                 AND D1.DIR_CD      = D2.DIR_CD" ).append("\n"); 
		query.append("                                                 AND D1.RHQ_CD      = D2.RHQ_CD" ).append("\n"); 
		query.append("                                              ) E1" ).append("\n"); 
		query.append("                                            ,SQM_QTA_LANE_OFC_COST E2" ).append("\n"); 
		query.append("                                            ,SQM_CFM_QTA_POTN_MGMT E3" ).append("\n"); 
		query.append("                                       WHERE 1=1" ).append("\n"); 
		query.append("                                         AND E1.BSE_TP_CD   = E2.BSE_TP_CD" ).append("\n"); 
		query.append("                                         AND E1.BSE_YR      = E2.BSE_YR" ).append("\n"); 
		query.append("                                         AND E1.BSE_QTR_CD  = E2.BSE_QTR_CD" ).append("\n"); 
		query.append("                                         AND E1.OFC_VW_CD   = E2.OFC_VW_CD" ).append("\n"); 
		query.append("                                         AND E1.TRD_CD      = E2.TRD_CD" ).append("\n"); 
		query.append("                                         AND E1.RLANE_CD    = E2.RLANE_CD" ).append("\n"); 
		query.append("                                         AND E1.DIR_CD      = E2.DIR_CD" ).append("\n"); 
		query.append("                                         AND E1.RHQ_CD      = E2.RHQ_CD" ).append("\n"); 
		query.append("                                         AND E1.RGN_OFC_CD  = E2.RGN_OFC_CD" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("                                         AND E1.BSE_TP_CD     = E3.BSE_TP_CD(+)" ).append("\n"); 
		query.append("                                         AND E1.BSE_YR        = E3.BSE_YR(+)" ).append("\n"); 
		query.append("                                         AND E1.BSE_QTR_CD    = E3.BSE_QTR_CD(+)" ).append("\n"); 
		query.append("                                         AND E1.OFC_VW_CD     = E3.OFC_VW_CD(+)" ).append("\n"); 
		query.append("                                         AND E1.QTA_STEP_CD   = E3.QTA_STEP_CD(+)" ).append("\n"); 
		query.append("                                         AND E1.TRD_CD        = E3.TRD_CD(+)" ).append("\n"); 
		query.append("                                         AND E1.RLANE_CD      = E3.RLANE_CD(+)" ).append("\n"); 
		query.append("                                         AND E1.DIR_CD        = E3.DIR_CD(+)" ).append("\n"); 
		query.append("                                         AND E1.RHQ_CD        = E3.RHQ_CD(+)" ).append("\n"); 
		query.append("                                         AND E1.RGN_OFC_CD    = E3.RGN_OFC_CD(+)" ).append("\n"); 
		query.append("--                                         AND E1.BSE_WK        BETWEEN SUBSTR(E3.APLY_FM_YRWK(+),-2) AND SUBSTR(E3.APLY_TO_YRWK(+),-2)" ).append("\n"); 
		query.append("                                         AND E1.SLS_YRWK        BETWEEN E3.APLY_FM_YRWK(+) AND E3.APLY_TO_YRWK(+)" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("                                       ORDER BY E1.OFC_VW_CD, E1.TRD_CD, E1.RLANE_CD, E1.CONV_DIR_CD, E1.VSL_CD, E1.SKD_VOY_NO, E1.SKD_DIR_CD, E1.RHQ_CD, E1.RGN_OFC_CD" ).append("\n"); 
		query.append("                                   )" ).append("\n"); 
		query.append("                         ) T" ).append("\n"); 
		query.append("#if (${f_gubun} != '')" ).append("\n"); 
		query.append("                   WHERE NOT EXISTS ( SELECT 'X'" ).append("\n"); 
		query.append("                                        FROM SQM_CFM_QTA C" ).append("\n"); 
		query.append("                                       WHERE C.QTA_RLSE_VER_NO = T.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                         AND C.BSE_TP_CD       = T.BSE_TP_CD" ).append("\n"); 
		query.append("                                         AND C.BSE_YR          = T.BSE_YR" ).append("\n"); 
		query.append("                                         AND C.BSE_QTR_CD      = T.BSE_QTR_CD" ).append("\n"); 
		query.append("                                         AND C.OFC_VW_CD       = T.OFC_VW_CD" ).append("\n"); 
		query.append("                                         AND C.QTA_TGT_CD      = T.QTA_TGT_CD" ).append("\n"); 
		query.append("                                         AND C.TRD_CD          = T.TRD_CD" ).append("\n"); 
		query.append("                                         AND C.RLANE_CD        = T.RLANE_CD" ).append("\n"); 
		query.append("                                         AND C.DIR_CD          = T.DIR_CD" ).append("\n"); 
		query.append("                                         AND C.VSL_CD          = T.VSL_CD" ).append("\n"); 
		query.append("                                         AND C.SKD_VOY_NO      = T.SKD_VOY_NO" ).append("\n"); 
		query.append("                                         AND C.SKD_DIR_CD      = T.SKD_DIR_CD" ).append("\n"); 
		query.append("										 AND C.RHQ_CD          = T.RHQ_CD" ).append("\n"); 
		query.append("                                     )" ).append("\n"); 
		query.append("#end              " ).append("\n"); 
		query.append("               ) Z" ).append("\n"); 
		query.append(")Z" ).append("\n"); 
		query.append("WHERE Z.DIR_CD = Z.SKD_DIR_CD" ).append("\n"); 
		query.append("#if (${ibflag} == 'I')" ).append("\n"); 
		query.append("       ) Q" ).append("\n"); 
		query.append("#end" ).append("\n"); 

	}
}