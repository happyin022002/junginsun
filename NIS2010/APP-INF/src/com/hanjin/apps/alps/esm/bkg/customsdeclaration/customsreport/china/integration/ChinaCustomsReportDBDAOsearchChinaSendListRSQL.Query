<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChinaCustomsReportDBDAOsearchChinaSendListRSQL">
			<desc><![CDATA[CHINA 세관 전송 LIST]]></desc>
			<sql><![CDATA[
SELECT * 
FROM (  SELECT S1.*, ROWNUM RN, COUNT(*) OVER() AS TOTAL,
			(SELECT AR_HD_QTR_OFC_CD
    	 	 FROM MDM_ORGANIZATION
    	 	 WHERE OFC_CD = S1.SND_OFC_CD
    	 	 AND DELT_FLG = 'N'
    		 ) RHQ 
		FROM (
		SELECT 	DISTINCT DECODE(BKG_CSTMS_CHN_SND_LOG.CHN_MF_SND_IND_CD,'O','O1','D','O2','P','P1') SEND_INDICATOR, 
				DECODE(BKG_CSTMS_CHN_SND_LOG.TRSM_MSG_TP_ID,'9','Original(POL)','0','Other Original(POD)','3','Delete','5','Change') SEND_INDICATOR_NM, 
				TO_CHAR(BKG_CSTMS_CHN_SND_LOG.MF_SND_DT,'YYYY-MM-DD HH24:MI:SS') SND_DT, 
				BKG_CSTMS_CHN_SND_LOG.MF_SND_OFC_CD SND_OFC_CD, 
				BKG_CSTMS_CHN_SND_LOG.MF_SND_USR_ID SND_USR_ID, 
				BKG_CSTMS_CHN_SND_LOG.VSL_CD||BKG_CSTMS_CHN_SND_LOG.SKD_VOY_NO||BKG_CSTMS_CHN_SND_LOG.SKD_DIR_CD VVD_CD, 
				BKG_CSTMS_CHN_SND_LOG.BKG_POL_CD POL_CD, 
				TO_CHAR(BKG_CSTMS_CHN_SND_LOG.CRE_DT,'YYYY-MM-DD HH24:MI:SS') UP_DT, 
				COM_INTG_CD_DTL.INTG_CD_VAL_DP_DESC ACK_TP, 
				BKG_CSTMS_CHN_SND_LOG.ACK_CTNT ACK_CONT, 
				TO_CHAR(BKG_CSTMS_CHN_SND_LOG.ACK_RCV_DT,'YYYY-MM-DD HH24:MI:SS') ACK_DT,
				BKG_CSTMS_CHN_SND_LOG.EDI_REF_ID,
				S_POD.POD_CD
		FROM 	BKG_CSTMS_CHN_SND_LOG,
				BKG_CSTMS_CHN_SND_LOG_BL,
				COM_INTG_CD_DTL,
				(	SELECT	EDI_REF_ID, 
							LTRIM(SYS_CONNECT_BY_PATH(BKG_POD_CD,','),',') POD_CD
  					FROM 	(	SELECT	B.EDI_REF_ID, 
										B.BKG_POD_CD,
                						ROW_NUMBER() OVER(PARTITION BY B.EDI_REF_ID ORDER BY B.BKG_POD_CD ) RNUM, 
                						COUNT(*)   OVER( PARTITION BY B.EDI_REF_ID ) CNT
           						FROM 	BKG_CSTMS_CHN_SND_LOG A, 
										BKG_CSTMS_CHN_SND_LOG_BL B
            					WHERE 	A.EDI_REF_ID = B.EDI_REF_ID
#if (${date_check} != '')
								AND 	A.MF_SND_DT BETWEEN TO_DATE(@[start_snd_dt],'YYYY-MM-DD HH24:MI') 
								AND 	TO_DATE(@[end_snd_dt],'YYYY-MM-DD HH24:MI')
#end
								AND 	A.CHN_MF_SND_IND_CD LIKE SUBSTR(@[send_indicator],1,1)||'%'
								AND 	A.TRSM_MSG_TP_ID LIKE SUBSTR(@[send_indicator],2,1)||'%'
								AND 	NVL(A.VSL_CD,'%') LIKE NVL(SUBSTR(@[vvd_cd],1,4),'%')||'%' 
								AND 	NVL(A.SKD_VOY_NO,'%') LIKE NVL(SUBSTR(@[vvd_cd],5,4),'%')||'%' 
								AND 	NVL(A.SKD_DIR_CD,'%') LIKE NVL(SUBSTR(@[vvd_cd],9,1),'%')||'%'
								AND 	NVL(A.BKG_POL_CD,'%') LIKE @[pol_cd]||'%' 
								AND 	NVL(A.MF_SND_OFC_CD,'%') LIKE @[ofc_cd]||'%' 
								AND 	NVL(A.MF_SND_USR_ID,'%') LIKE @[usr_id]||'%'
								AND		NVL(B.BKG_POD_CD,'%') LIKE @[pod_cd]||'%'
            					GROUP BY B.EDI_REF_ID,B.BKG_POD_CD	)
 					WHERE LEVEL = CNT
					CONNECT BY RNUM = PRIOR RNUM + 1
   					AND EDI_REF_ID = PRIOR EDI_REF_ID) S_POD
WHERE	BKG_CSTMS_CHN_SND_LOG.EDI_REF_ID			= BKG_CSTMS_CHN_SND_LOG_BL.EDI_REF_ID
AND		BKG_CSTMS_CHN_SND_LOG.EDI_REF_ID			= S_POD.EDI_REF_ID
AND		BKG_CSTMS_CHN_SND_LOG.CHN_CSTMS_ACK_TP_CD 	= COM_INTG_CD_DTL.INTG_CD_VAL_CTNT(+)
#if (${date_check} != '')
AND MF_SND_DT BETWEEN TO_DATE(@[start_snd_dt],'YYYY-MM-DD HH24:MI') 
AND TO_DATE(@[end_snd_dt],'YYYY-MM-DD HH24:MI')
#end
AND BKG_CSTMS_CHN_SND_LOG.CHN_MF_SND_IND_CD LIKE SUBSTR(@[send_indicator],1,1)||'%'
AND BKG_CSTMS_CHN_SND_LOG.TRSM_MSG_TP_ID LIKE SUBSTR(@[send_indicator],2,1)||'%'
AND NVL(BKG_CSTMS_CHN_SND_LOG.VSL_CD,'%') LIKE NVL(SUBSTR(@[vvd_cd],1,4),'%')||'%' 
AND NVL(BKG_CSTMS_CHN_SND_LOG.SKD_VOY_NO,'%') LIKE NVL(SUBSTR(@[vvd_cd],5,4),'%')||'%' 
AND NVL(BKG_CSTMS_CHN_SND_LOG.SKD_DIR_CD,'%') LIKE NVL(SUBSTR(@[vvd_cd],9,1),'%')||'%'
AND NVL(BKG_CSTMS_CHN_SND_LOG.BKG_POL_CD,'%') LIKE @[pol_cd]||'%' 
AND NVL(BKG_CSTMS_CHN_SND_LOG.MF_SND_OFC_CD,'%') LIKE @[ofc_cd]||'%' 
AND NVL(BKG_CSTMS_CHN_SND_LOG.MF_SND_USR_ID,'%') LIKE @[usr_id]||'%'
AND	NVL(BKG_CSTMS_CHN_SND_LOG_BL.BKG_POD_CD,'%') LIKE @[pod_cd]||'%'
AND INTG_CD_ID(+) = 'CD02300'
) S1 )
WHERE 1=1
#if (${rhq_ofc_cd} != '') 
AND RHQ = @[rhq_ofc_cd]
#end
AND RN BETWEEN @[startno] AND @[endno]			]]></sql>
			<params>
				<param name="start_snd_dt" type="12" value="" out="N"/>
				<param name="end_snd_dt" type="12" value="" out="N"/>
				<param name="send_indicator" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="rhq_ofc_cd" type="12" value="" out="N"/>
				<param name="startno" type="12" value="" out="N"/>
				<param name="endno" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
