<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="KrWharfageDecMgtDBDAOsearchKrWhfDecExptBlkVolRSQL">
			<desc><![CDATA[s]]></desc>
			<sql><![CDATA[
SELECT SUM(CASE WHEN @[size_id] = '20' THEN BB.BLK_TEU_QTY
                WHEN @[size_id] = '40' THEN BB.BLK_FEU_QTY
                WHEN @[size_id] = '45' THEN BB.BLK_45FT_QTY
           END) AS BLK_QTY
  FROM (SELECT A.VSL_CD, A.SKD_VOY_NO, A.SKD_DIR_CD, A.WHF_BND_CD, A.BL_NO, MAX(CHG_RT_SEQ) CHG_RT_SEQ
          FROM BKG_KR_WHF_BL A, BKG_KR_WHF_RT B
         WHERE A.VSL_CD = SUBSTR(@[vvd], 1, 4)
           AND A.SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
           AND A.SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
           AND A.WHF_BND_CD IN (DECODE(@[whf_bnd_cd], 'IN', 'II','ON', 'OO', @[whf_bnd_cd]), DECODE(@[whf_bnd_cd], 'IN', 'IT','ON', 'OT', @[whf_bnd_cd]), DECODE(@[whf_bnd_cd], 'IN', 'IM','ON', 'OM', @[whf_bnd_cd]))
           AND A.WHF_BL_STS_CD != 'D'
           AND B.VSL_CD = A.VSL_CD
           AND B.SKD_VOY_NO = A.SKD_VOY_NO
           AND B.SKD_DIR_CD = A.SKD_DIR_CD
           AND B.WHF_BND_CD = A.WHF_BND_CD
           AND B.KR_WHF_EXPT_CD = 'B'
           AND B.PORT_CD = @[port_cd]
         GROUP BY A.VSL_CD, A.SKD_VOY_NO, A.SKD_DIR_CD, A.WHF_BND_CD, A.BL_NO) AA,
        BKG_KR_WHF_RT BB
  WHERE BB.VSL_CD = AA.VSL_CD
    AND BB.SKD_VOY_NO = AA.SKD_VOY_NO
    AND BB.SKD_DIR_CD = AA.SKD_DIR_CD
    AND BB.WHF_BND_CD = AA.WHF_BND_cD
    AND BB.BL_NO = AA.BL_NO
    AND BB.CHG_RT_SEQ = AA.CHG_RT_SEQ			]]></sql>
			<params>
				<param name="size_id" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="whf_bnd_cd" type="12" value="" out="N"/>
				<param name="port_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
