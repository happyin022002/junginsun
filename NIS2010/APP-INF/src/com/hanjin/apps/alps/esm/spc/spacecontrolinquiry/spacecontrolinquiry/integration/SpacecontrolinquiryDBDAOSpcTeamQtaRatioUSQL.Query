<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SpacecontrolinquiryDBDAOSpcTeamQtaRatioUSQL">
			<desc><![CDATA[한국지점 팀별 QTA Ratio 수정]]></desc>
			<sql><![CDATA[
MERGE INTO SPC_TEAM_QTA_RTO R
USING (
        SELECT @[trd_cd] AS TRD_CD,
               @[sub_trd_cd] AS SUB_TRD_CD,
               @[rlane_cd] AS RLANE_CD,
               @[sls_rep_ofc_team_cd] AS SLS_REP_OFC_TEAM_CD,
               @[qta_aply_cd] AS QTA_APLY_CD,
               (SELECT DISTINCT SLS_OFC_CD
                  FROM SPC_SLS_REP_TEAM_IF
                 WHERE NVL(SLS_REP_OFC_TEAM_CD, SLS_OFC_CD) = DECODE(@[sls_rep_ofc_team_cd], 'OTHER', 'SELSCA', @[sls_rep_ofc_team_cd])) AS SLS_OFC_CD,               
               (SELECT DISTINCT SLS_RGN_OFC_CD
                  FROM SPC_SLS_REP_TEAM_IF
                 WHERE NVL(SLS_REP_OFC_TEAM_CD, SLS_OFC_CD) = DECODE(@[sls_rep_ofc_team_cd], 'OTHER', 'SELSCA', @[sls_rep_ofc_team_cd])) AS SLS_RGN_OFC_CD,
               NVL(@[bse_yr], ' ') AS BSE_YR,
               NVL(@[bse_qtr_cd], ' ') AS BSE_QTR_CD,
               NVL(@[vsl_cd], ' ') AS VSL_CD,
               NVL(@[skd_voy_no], ' ') AS SKD_VOY_NO,
               NVL(@[skd_dir_cd], ' ') AS SKD_DIR_CD,
               @[team_qta_rto] AS TEAM_QTA_RTO,
               @[cre_usr_id] AS USR_ID,
               SYSDATE AS CRE_DT
           FROM DUAL
       ) C
  ON ( 
            R.TRD_CD = C.TRD_CD
        AND R.SUB_TRD_CD = C.SUB_TRD_CD
        AND R.RLANE_CD = C.RLANE_CD
        AND R.SLS_REP_OFC_TEAM_CD = C.SLS_REP_OFC_TEAM_CD
#if(${qta_aply_cd} == 'Q')
        AND R.BSE_YR = C.BSE_YR
        AND R.BSE_QTR_CD = C.BSE_QTR_CD
#elseif(${qta_alpy_cd} == 'V')
        AND R.VSL_CD = C.VSL_CD
        AND R.SKD_VOY_NO = C.SKD_VOY_NO
        AND R.SKD_DIR_CD = C.SKD_DIR_CD
#end
     )
 WHEN MATCHED THEN
      UPDATE 
         SET R.TEAM_QTA_RTO = C.TEAM_QTA_RTO,
             R.UPD_USR_ID   = C.USR_ID,
             R.UPD_DT       = SYSDATE
 WHEN NOT MATCHED THEN    
    INSERT 
    (
     TRD_CD, 
     SUB_TRD_CD, 
     RLANE_CD, 
     SLS_REP_OFC_TEAM_CD, 
     QTA_APLY_CD, 
     BSE_YR, 
     BSE_QTR_CD, 
     VSL_CD, 
     SKD_VOY_NO, 
     SKD_DIR_CD, 
     SLS_RGN_OFC_CD, 
     SLS_OFC_CD, 
     TEAM_QTA_RTO, 
     CRE_USR_ID, 
     CRE_DT, 
     UPD_USR_ID, 
     UPD_DT
    )
    VALUES( 
         C.TRD_CD, 
         C.SUB_TRD_CD, 
         C.RLANE_CD, 
         C.SLS_REP_OFC_TEAM_CD, 
         C.QTA_APLY_CD, 
         C.BSE_YR, 
         C.BSE_QTR_CD, 
         C.VSL_CD, 
         C.SKD_VOY_NO, 
         C.SKD_DIR_CD, 
         C.SLS_RGN_OFC_CD, 
         C.SLS_OFC_CD, 
         C.TEAM_QTA_RTO, 
         C.USR_ID, 
         SYSDATE, 
         C.USR_ID, 
         SYSDATE
    )			]]></sql>
			<params>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="sub_trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="sls_rep_ofc_team_cd" type="12" value="" out="N"/>
				<param name="qta_aply_cd" type="12" value="" out="N"/>
				<param name="bse_yr" type="12" value="" out="N"/>
				<param name="bse_qtr_cd" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="team_qta_rto" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
