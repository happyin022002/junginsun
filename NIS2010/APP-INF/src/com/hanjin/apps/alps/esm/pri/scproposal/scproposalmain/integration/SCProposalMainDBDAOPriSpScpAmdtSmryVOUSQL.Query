<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCProposalMainDBDAOPriSpScpAmdtSmryVOUSQL">
			<desc><![CDATA[PriSpScpAmdtSmryVO]]></desc>
			<sql><![CDATA[
UPDATE PRI_SP_SCP_AMDT_SMRY UPD
SET 
    ( AMDT_FLG  ,ACPT_FLG ) = 
        (
            SELECT
				DECODE(COUNT(SRC.AMDT_SEQ),0,'N','','N','Y'), 
				DECODE(MAX(SRC.PRC_PROG_STS_CD),'A','Y','N')
            FROM
#if(${prop_scp_term_tp_cd} == "11") 
				PRI_SP_SCP_DUR SRC,
#elseif(${prop_scp_term_tp_cd} == "12") 
				PRI_SP_SCP_MQC SRC,
#elseif(${prop_scp_term_tp_cd} == "13") 
				PRI_SP_SCP_GRP_LOC_DTL SRC,
#elseif(${prop_scp_term_tp_cd} == "14") 
				PRI_SP_SCP_GRP_CMDT_DTL SRC,
#elseif(${prop_scp_term_tp_cd} == "15") 
				PRI_SP_SCP_LODG_AGN SRC,
#elseif(${prop_scp_term_tp_cd} == "31" || ${prop_scp_term_tp_cd} == "32") 
                PRI_SP_SCP_NOTE_CTNT SRC,
#elseif(${prop_scp_term_tp_cd} == "41" || ${prop_scp_term_tp_cd} == "42") 
				PRI_SP_SCP_ROUT_PNT SRC,
#elseif(${prop_scp_term_tp_cd} == "51" || ${prop_scp_term_tp_cd} == "52" || 
		 ${prop_scp_term_tp_cd} == "61" || ${prop_scp_term_tp_cd} == "62") 
				PRI_SP_SCP_TRSP_ADD_CHG SRC,
#elseif(${prop_scp_term_tp_cd} == "16") 
				PRI_SP_SCP_GOH_CHG SRC,
#elseif(${prop_scp_term_tp_cd} == "71" || ${prop_scp_term_tp_cd} == "72") 
                (SELECT PROP_NO, AMDT_SEQ, SVC_SCP_CD, N1ST_CMNC_AMDT_SEQ, PRC_PROG_STS_CD, GEN_SPCL_RT_TP_CD
                   FROM PRI_SP_SCP_RT_ACT_CUST
                 UNION ALL
                 SELECT PROP_NO, AMDT_SEQ, SVC_SCP_CD, N1ST_CMNC_AMDT_SEQ, PRC_PROG_STS_CD, GEN_SPCL_RT_TP_CD
                   FROM PRI_SP_SCP_RT_CNOTE
                 UNION ALL
                 SELECT PROP_NO, AMDT_SEQ, SVC_SCP_CD, N1ST_CMNC_AMDT_SEQ, PRC_PROG_STS_CD, GEN_SPCL_RT_TP_CD
                   FROM PRI_SP_SCP_RT_CMDT
                 UNION ALL
                 SELECT PROP_NO, AMDT_SEQ, SVC_SCP_CD, N1ST_CMNC_AMDT_SEQ, PRC_PROG_STS_CD, GEN_SPCL_RT_TP_CD
                   FROM PRI_SP_SCP_RT
                 UNION ALL
                 SELECT PROP_NO, AMDT_SEQ, SVC_SCP_CD, N1ST_CMNC_AMDT_SEQ, PRC_PROG_STS_CD, GEN_SPCL_RT_TP_CD
                   FROM PRI_SP_SCP_RT_ROUT_DIR
                 UNION ALL
                 SELECT PROP_NO, AMDT_SEQ, SVC_SCP_CD, N1ST_CMNC_AMDT_SEQ, PRC_PROG_STS_CD, GEN_SPCL_RT_TP_CD
                   FROM PRI_SP_SCP_RT_CMDT_RNOTE
                 UNION ALL
                 SELECT PROP_NO, AMDT_SEQ, SVC_SCP_CD, N1ST_CMNC_AMDT_SEQ, PRC_PROG_STS_CD, GEN_SPCL_RT_TP_CD
                   FROM PRI_SP_SCP_RT_ROUT_PNT
                 UNION ALL
                 SELECT PROP_NO, AMDT_SEQ, SVC_SCP_CD, N1ST_CMNC_AMDT_SEQ, PRC_PROG_STS_CD, GEN_SPCL_RT_TP_CD
                   FROM PRI_SP_SCP_RT_ROUT_VIA) SRC,
#end 
				PRI_SP_SCP_MN MN
            WHERE 
				SRC.PROP_NO 		= UPD.PROP_NO
            AND SRC.AMDT_SEQ 		= UPD.AMDT_SEQ
            AND SRC.SVC_SCP_CD 		= UPD.SVC_SCP_CD
            AND SRC.PROP_NO 		= MN.PROP_NO
            AND SRC.AMDT_SEQ 		= MN.AMDT_SEQ
            AND SRC.SVC_SCP_CD 		= UPD.SVC_SCP_CD
            AND SRC.N1ST_CMNC_AMDT_SEQ 	= MN.AMDT_SEQ
#if(${prop_scp_term_tp_cd} == "31") 
            AND SRC.NOTE_TP_CD 	= 'T'
#elseif(${prop_scp_term_tp_cd} == "32") 
            AND SRC.NOTE_TP_CD 	= 'P'
#elseif(${prop_scp_term_tp_cd} == "41") 
            AND SRC.ORG_DEST_TP_CD 	= 'O'
#elseif(${prop_scp_term_tp_cd} == "42") 
            AND SRC.ORG_DEST_TP_CD 	= 'D'
#elseif(${prop_scp_term_tp_cd} == "51") 
            AND SRC.ADD_CHG_TP_CD 	= 'A'
            AND SRC.ORG_DEST_TP_CD 	= 'O'
#elseif(${prop_scp_term_tp_cd} == "52") 
            AND SRC.ADD_CHG_TP_CD 	= 'A'
            AND SRC.ORG_DEST_TP_CD 	= 'D'
#elseif(${prop_scp_term_tp_cd} == "61") 
            AND SRC.ADD_CHG_TP_CD 	= 'I'
            AND SRC.ORG_DEST_TP_CD 	= 'O'
#elseif(${prop_scp_term_tp_cd} == "62") 
            AND SRC.ADD_CHG_TP_CD 	= 'I'
            AND SRC.ORG_DEST_TP_CD 	= 'D'
#elseif(${prop_scp_term_tp_cd} == "71") 
            AND SRC.GEN_SPCL_RT_TP_CD 	= 'G'
#elseif(${prop_scp_term_tp_cd} == "72") 
            AND SRC.GEN_SPCL_RT_TP_CD 	= 'S'
#end 
        )
WHERE
    PROP_NO    = @[prop_no]
AND AMDT_SEQ   = @[amdt_seq]
AND SVC_SCP_CD = @[svc_scp_cd] 
AND PROP_SCP_TERM_TP_CD = @[prop_scp_term_tp_cd]			]]></sql>
			<params>
				<param name="prop_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="12" value="" out="N"/>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="prop_scp_term_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
