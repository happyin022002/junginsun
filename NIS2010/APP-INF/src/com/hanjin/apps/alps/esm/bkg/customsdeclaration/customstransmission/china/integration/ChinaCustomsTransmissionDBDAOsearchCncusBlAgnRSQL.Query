<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChinaCustomsTransmissionDBDAOsearchCncusBlAgnRSQL">
			<desc><![CDATA[ChinaCncusBlListVO]]></desc>
			<sql><![CDATA[
SELECT	/*+ ORDERED */                                                                                                                                               
	     ST.BL_NO                                                                                                                                                    
		,MAX (  ST.BL_NO                                                                                                                                            
                ||CHR(9)||TO_CHAR(NVL(BL_OBRD_DT,(SELECT MAX(V.VPS_ETB_DT)
                                   				  FROM VSK_VSL_PORT_SKD V, BKG_VVD B
                                   				  WHERE V.VSL_CD = ST.VSL_CD 
                                   				  AND V.SKD_VOY_NO = ST.SKD_VOY_NO 
                                   				  AND V.SKD_DIR_CD = ST.SKD_DIR_CD 
                                   				  AND V.VPS_PORT_CD = ST.PORT_CD
                                   				  AND B.BKG_NO = ST.BKG_NO AND B.VSL_CD = V.VSL_CD AND B.SKD_VOY_NO = V.SKD_VOY_NO AND B.SKD_DIR_CD = V.SKD_DIR_CD
                                   				  AND V.CLPT_IND_SEQ = DECODE(B.POL_CD,ST.PORT_CD,B.POL_CLPT_IND_SEQ,B.POD_CLPT_IND_SEQ))), 'YYYYMMDD')		                                                                                                 
                ||CHR(9)||TO_CHAR(ST.BL_POD_ETA_DT, 'YYYYMMDD')                                                                                                     
                ||CHR(9)||TO_CHAR(ST.BL_ISS_DT, 'YYYYMMDD')		                                                                                                 
                ||CHR(9)||ST.BL_ISS_OFC_CD	                                                                                                                         
                ||CHR(9)||LOC5.LOC_NM                                                                                                                               
                ||CHR(9)||ST.POR_CD		                                                                                                                         
                ||CHR(9)||LOC1.LOC_NM	                                                                                                                             
                ||CHR(9)||ST.BKG_POL_CD		                                                                                                                     
                ||CHR(9)||LOC2.LOC_NM	                                                                                                                             
                ||CHR(9)||ST.BKG_POD_CD                                                                                                                             
                ||CHR(9)||LOC3.LOC_NM	                                                                                                                             
                ||CHR(9)||ST.DEL_CD		                                                                                                                         
                ||CHR(9)||LOC4.LOC_NM	                                                                                                                             
                ||CHR(9)||ST.CHN_CSTMS_TRSP_MOD_CD	                                                                                                                 
                ||CHR(9)||ST.RCV_TERM_CD||ST.DE_TERM_CD                                                                                                             
				#if (${trans_mode} == 'O')                                                                                                                           
                ||CHR(9)||DECODE(ST.FRT_TERM_CD,'P','PP','C','CC')                                                                                                  
				#else                                                                                                                                                
                ||CHR(9)||ST.FRT_TERM_CD                                                                                                                            
				#end						                                                                                                                         
                ||CHR(9)||TRIM(S.CUST_NM)                                                                                                                           
                ||CHR(9)||TRIM(S.CUST_ADDR)                                                                                                                         
                ||CHR(9)||''                         			                                                                                                     
                ||CHR(9)||''                                                                                                                                        
                ||CHR(9)||''    							                                                                                                         
                ||CHR(9)||TRIM(C.CUST_NM)               	                                                                                                         
                ||CHR(9)||TRIM(C.CUST_ADDR)             	                                                                                                         
                ||CHR(9)||''                         			                                                                                                     
                ||CHR(9)||''                         			                                                                                                     
                ||CHR(9)||''                         			                                                                                                     
                ||CHR(9)||TRIM(N.CUST_NM)                                                                                                                           
                ||CHR(9)||TRIM(N.CUST_ADDR)                                                                                                                         
                ||CHR(9)||''                         			                                                                                                     
                ||CHR(9)||''                                                                                                                                        
                ||CHR(9)||''						                                                                                                       
                ||CHR(9)||ST.POD_ROUT_DESC                                                                                                            
                --||CHR(9)||REPLACE(ST.POD_ROUT_DESC,';',CHR(9))                                                                                                     
                ||CHR(9)||NVL(TRIM(ST.CSTMS_DESC),'N/M')                                                                                                                             
                ||CHR(9)||SUBSTR(SM.BL_MK_DESC, 1, INSTR(SM.BL_MK_DESC, CHR(9), 1,1)-2)                                                                            
                ||CHR(9)||SUBSTR(SM.BL_MK_DESC, INSTR(SM.BL_MK_DESC, CHR(9), 1, 1)+1,	INSTR(SM.BL_MK_DESC, CHR(9), 1, 2) - INSTR(SM.BL_MK_DESC, CHR(9),	1, 1) -2)
                ||CHR(9)||SUBSTR(SM.BL_MK_DESC, INSTR(SM.BL_MK_DESC, CHR(9), 1, 2)+1, INSTR(SM.BL_MK_DESC, CHR(9), 1, 3) - INSTR(SM.BL_MK_DESC, CHR(9), 1, 2) -2)
                ||CHR(9)||SUBSTR(SM.BL_MK_DESC, INSTR(SM.BL_MK_DESC, CHR(9), 1, 3)+1, INSTR(SM.BL_MK_DESC, CHR(9), 1, 4) - INSTR(SM.BL_MK_DESC, CHR(9), 1, 3) -2)
                ||CHR(9)||SUBSTR(SM.BL_MK_DESC, INSTR(SM.BL_MK_DESC, CHR(9), 1, 4)+1, INSTR(SM.BL_MK_DESC, CHR(9), 1, 5) - INSTR(SM.BL_MK_DESC, CHR(9), 1, 4) -2)
                ||CHR(9)||ST.ACT_WGT					                                                                                                             
                ||CHR(9)||ST.PCK_QTY	                                                                                                                             
                ||CHR(9)||ST.PCK_TP_CD
				||CHR(9)||NVL2(RF.BL_NO,'Y','N')				                                                                                                                 
                ||CHR(9)||DECODE(RF.FDO_TEMP, NULL, DECODE(RF.CDO_TEMP, NULL, 0, RF.CDO_TEMP), RF.FDO_TEMP)  
                ||CHR(9)||DECODE(RF.FDO_TEMP, NULL, 'C', 'F')                                                                                                     
                ||CHR(9)||ST.MEAS_QTY		                                                                                                             
                ||CHR(9)||'1'	
                ||CHR(9)||DECODE(S.RGST_NO, NULL, ''
										        , '9999+'||S.RGST_NO
                ||CHR(9)||DECODE(C.RGST_NO, NULL, ''
												, DECODE(C.CO_CHN_TP_CD), 'U', 'USCI+'||C.RGST_NO
												 						, 'O', 'OC+'||C.RGST_NO
												  						, 'B', '9999+'||C.RGST_NO
												  	 						 , '9999+'||C.RGST_NO
														)
								) 
                ||CHR(9)||DECODE(N.RGST_NO, NULL, ''
												, DECODE(N.CO_CHN_TP_CD, 'U', 'USCI+'||N.RGST_NO
												  						 'O', 'OC+'||N.RGST_NO
												  						 'B', '9999+'||N.RGST_NO
													 						, '9999+'||N.RGST_NO
														)
								)
		  ) BL_DATA                                                                                                                            
FROM	BKG_CSTMS_CHN_BL ST,                                                                                                                                         
    	BKG_CSTMS_CHN_CUST C,                                                                                                                                        
    	BKG_CSTMS_CHN_CUST S,                                                                                                                                        
    	BKG_CSTMS_CHN_CUST N,                                                                                                                                        
    	MDM_LOCATION LOC1,                                                                                                                                           
    	MDM_LOCATION LOC2,                                                                                                                                           
    	MDM_LOCATION LOC3,                                                                                                                                           
    	MDM_LOCATION LOC4,                                                                                                                                           
    	MDM_LOCATION LOC5,                                                                                                                                           
    	BKG_CSTMS_CHN_RF RF,                                                                                                                                         
        ( SELECT  BL_NO, DBMS_LOB.SUBSTR( BL_MK_DESC, DBMS_LOB.GetLength(BL_MK_DESC) ) BL_MK_DESC                                                                    
          FROM    BKG_CSTMS_CHN_MK                                                                                                                                   
          WHERE	  1=1                                                                                                                                                  
		  AND   ( #foreach($field_id in ${field_list})                                                                                                               
      				#if($velocityCount > 1)                                                                                                                          
      				OR #end      BL_NO IN ( $field_id )                                                                                                              
      			  #end                                                                                                                                               
		  )
          AND     CHN_MF_SND_IND_CD  =	@[trans_mode]
		) SM                                                                                                                                                  
WHERE	1=1                                                                                                                                                          
AND ( #foreach($field_id in ${field_list})                                                                                                                           
      	#if($velocityCount > 1)                                                                                                                                      
      	OR #end      ST.BL_NO IN ( $field_id )                                                                                                                       
      #end                                                                                                                                                           
)                                                                                                                                                                    
AND	    ST.CHN_MF_SND_IND_CD  =	@[trans_mode]   /*24hr*/                                                                            
AND	    ST.BKG_POD_CD		  =	@[pod] 			/*24hr*/
AND	    ST.BL_NO		      =	C.BL_NO(+)
AND	    ST.CHN_MF_SND_IND_CD  =	C.CHN_MF_SND_IND_CD(+)
AND	    C.BKG_CUST_TP_CD(+)	  =	'C'
AND	    ST.BL_NO		      =	S.BL_NO(+)
AND	    ST.CHN_MF_SND_IND_CD  =	S.CHN_MF_SND_IND_CD(+)
AND	    S.BKG_CUST_TP_CD(+)	  =	'S'
AND	    ST.BL_NO		      =	N.BL_NO(+)
AND	    ST.CHN_MF_SND_IND_CD  =	N.CHN_MF_SND_IND_CD(+)                                                                                                                          
AND	    N.BKG_CUST_TP_CD(+)	  =	'N'                                                                                                                                  
AND	    ST.POR_CD		      =	LOC1.LOC_CD                                                                                                                          
ANd	    ST.BKG_POL_CD	      =	LOC2.LOC_CD                                                                                                                          
AND	    ST.BKG_POD_CD	      =	LOC3.LOC_CD                                                                                                                          
AND	    ST.DEL_CD	      	  =	LOC4.LOC_CD                                                                                                                          
AND	    ST.BL_ISS_OFC_CD      =	LOC5.LOC_CD(+)                                                                                                                       
AND	    ST.BL_NO		      =	SM.BL_NO(+)                                                                                                                          
AND	    ST.BL_NO		      =	RF.BL_NO(+)                                                                                                                          
AND	    ST.CHN_MF_SND_IND_CD  =	RF.CHN_MF_SND_IND_CD(+)                                                                                                              
GROUP BY ST.BL_NO			]]></sql>
			<params>
				<param name="trans_mode" type="12" value="" out="N"/>
				<param name="pod" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
