<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AGTCommDBDAOGrsNetCDVORSQL">
			<desc><![CDATA[ESM_AGT_0012  화면의 GrsNetCD/Net Ocean Revenue 조회]]></desc>
			<sql><![CDATA[
SELECT
GRSNET_GUBUN,
AC_TP_CD,
NVL
(
(
               SELECT
                      'Y'
                 FROM MDM_LOCATION                  POL,
                      MDM_LOCATION                  POD,
                      GL_MON_XCH_RT                 GXR,
                      AGT_CHG_DDCT_REF              DDT,
                    (
                          SELECT
                                 BKG.BKG_NO,
                                 BKG.POL_CD,
                                 BKG.POD_CD,
                                 @[ac_seq]       AS AC_SEQ,                                          --:AC_SEQ
                                 @[sail_arr_dt]  AS SA_DT                                            --:SA_DT
                            FROM BKG_BOOKING BKG
                           WHERE BKG.BKG_NO        = @[bkg_no]                                          --:BKG_NO
                             AND NVL (@[ar_ofc_cd], ' ')                                             --:AR_OFC_CD
                              IN
                               (
                                 'AISBA', 'BAHBA', 'BKKBB', 'BOMBA', 'BOMBB', 'CGPBA', 'CMBBB',
                                 'DACBB', 'DXBBA', 'JEDBA', 'JKTBA', 'JKTBB', 'JORBA', 'KHIBA',
                                 'KWIBA', 'MNLBA', 'OMNBA', 'PKGBB', 'PNHBA', 'RGNBA', 'SGNBB',
                                 'SINBB', 'SINWA', 'SYDBA', 'SYDBB', 'THRBA', 'TPEBB', 'DXBBB'
                               )
                    ) INP
                WHERE DDT.BKG_NO                    = INP.BKG_NO
                  AND DDT.AC_SEQ                    = INP.AC_SEQ
                  AND POL.LOC_CD                    = INP.POL_CD
                  AND POD.LOC_CD                    = INP.POD_CD
                  AND GXR.CURR_CD                   = DDT.CURR_CD
                  AND GXR.ACCT_XCH_RT_LVL           = '1'
                  AND GXR.ACCT_XCH_RT_YRMON
                    =
                 CASE
                 WHEN INP.SA_DT IS NULL
                   OR 1 = SIGN (TO_DATE (SUBSTR (INP.SA_DT, 1, 6), 'YYYYMM') - SYSDATE)
                 THEN TO_CHAR (SYSDATE, 'YYYYMM')
                 ELSE SUBSTR (INP.SA_DT, 1, 6)
                  END
                  AND EXISTS
                    (
                          SELECT
                                 'X'
                            FROM AGT_CHG_DDCT_REF DD2
                           WHERE DD2.CHG_CD       = 'BAF'
                             AND DD2.BKG_NO       = INP.BKG_NO
                       UNION ALL
                          SELECT
                                 'X'
                            FROM BKG_CHG_RT BR2
                           WHERE BR2.CHG_CD       = 'BAF'
                             AND NVL (BR2.FRT_INCL_XCLD_DIV_CD, 'N')
                              IN
                               (
                                'N', 'E'
                               )
                             AND BR2.BKG_NO       = INP.BKG_NO
                    )
---------------------------------------------------------------------------------------------------
                  AND DDT.CHG_CD                    = 'FRC'
                  AND INP.SA_DT                    >= '20100101'
                  AND
                    ( POL.CONTI_CD
                   IN 
                    (
                      'E', 'F'
                    )
                   OR POD.CONTI_CD
                   IN 
                    (
                      'E', 'F'
                    )
                    )
---------------------------------------------------------------------------------------------------
                  AND ROWNUM = 1
)
,'N'
) AS FRC_FLG
FROM
(
SELECT
GRS_NET_DIV_CD AS GRSNET_GUBUN,
AC_TP_CD,
AR_OFC_CD,
BKG_NO,
SAIL_ARR_DT
FROM AGT_AGN_COMM
WHERE BKG_NO    = @[bkg_no]
AND AGN_CD    = @[ar_ofc_cd]
AND IO_BND_CD = @[io_bnd_cd]
AND AC_TP_CD
NOT IN
(
'C', 'D'
)
AND ROWNUM = 1
ORDER BY AC_TP_CD
) X			]]></sql>
			<params>
				<param name="ac_seq" type="12" value="" out="N"/>
				<param name="sail_arr_dt" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="Y"/>
				<param name="ar_ofc_cd" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="Y"/>
			</params>
		</query>
	</querys>
</sqls>
