<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DashboardDBDAOSearchDashboardByCustRSQL">
			<desc><![CDATA[Customer 기준으로 대시보드 리스트를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT
  DEST
, BKG_OFC_CD  
, NVL(MIN(CNT_1),'0/0') CNT_VSL_SKD
, NVL(MIN(LMT_1),0) LMT_VSL_SKD
, NVL(MIN(CNT_2),'0/0') CNT_DWL_NTFC
, NVL(MIN(LMT_2),0) LMT_DWL_NTFC
, NVL(MIN(CNT_3),'0/0') CNT_PORT_SKIP
, NVL(MIN(LMT_3),0) LMT_PORT_SKIP
, NVL(MIN(CNT_4),'0/0') CNT_TPB
, NVL(MIN(LMT_4),0) LMT_TPB
, NVL(MIN(CNT_5),'0/0') CNT_NOT_UPD_CNTR
, NVL(MIN(LMT_5),0) LMT_NOT_UPD_CNTR
, NVL(MIN(CNT_6),'0/0') CNT_OBL_RLS
, NVL(MIN(LMT_6),0) LMT_OBL_RLS
, NVL(MIN(CNT_7),'0/0') CNT_WT_BKG
, NVL(MIN(LMT_7),0) LMT_WT_BKG
, NVL(MIN(CNT_8),'0/0') CNT_CUST_ADV_FX_SND
, NVL(MIN(LMT_8),0) LMT_CUST_ADV_FX_SND
, NVL(MIN(CNT_9),'0/0') CNT_CNTR_FNL_CFM
, NVL(MIN(LMT_9),0) LMT_CNTR_FNL_CFM
, NVL(MIN(CNT_10),'0/0') CNT_RATE
, NVL(MIN(LMT_10),0) LMT_RATE
, NVL(MIN(CNT_11),'0/0') CNT_RDN
, NVL(MIN(LMT_11),0) LMT_RDN
, NVL(MIN(CNT_12),'0/0') CNT_US_HLD
, NVL(MIN(LMT_12),0) LMT_US_HLD
, NVL(MIN(CNT_13),'0/0') CNT_EUR_HLD
, NVL(MIN(LMT_13),0) LMT_EUR_HLD
, NVL(MIN(CNT_14),'0/0') CNT_301_TML
, NVL(MIN(LMT_14),0) LMT_301_TML
, NVL(MIN(CNT_15),'0/0') CNT_BKR_HLD
, NVL(MIN(LMT_15),0) LMT_BKR_HLD
, NVL(MIN(CNT_16),'0/0') CNT_COD
, NVL(MIN(LMT_16),0) LMT_COD
, NVL(MIN(CNT_17),'0/0') CNT_NW_WB_BL_INSTR
, NVL(MIN(LMT_17),0) LMT_NW_WB_BL_INSTR
, NVL(MIN(CNT_18),'0/0') CNT_VSL_SKD_CHG
, NVL(MIN(LMT_18),0) LMT_VSL_SKD_CHG
, NVL(MIN(CNT_19),'0/0') CNT_VSL_SKD_DLY_NTC
, NVL(MIN(LMT_19),0) LMT_VSL_SKD_DLY_NTC
, NVL(MIN(CNT_20),'0/0') CNT_E_SI_RJT
, NVL(MIN(LMT_20),0) LMT_E_SI_RJT
, NVL(MIN(CNT_21),'0/0') CNT_BKG_RCP_NTC
, NVL(MIN(LMT_21),0) LMT_BKG_RCP_NTC
, NVL(MIN(CNT_22),'0/0') CNT_DEM_DET
, NVL(MIN(LMT_22),0) LMT_DEM_DET
, NVL(MIN(CNT_23),'0/0') CNT_OCN_DEL
, NVL(MIN(LMT_23),0) LMT_OCN_DEL
, NVL(MIN(CNT_24),'0/0') CNT_IRG_DEL
, NVL(MIN(LMT_24),0) LMT_IRG_DEL
, NVL(MIN(CNT_25),'0/0') CNT_ARR_NTC
, NVL(MIN(LMT_25),0) LMT_ARR_NTC
, NVL(MIN(CNT_26),'0/0') CNT_SPCL_CGO_APR
, NVL(MIN(LMT_26),0) LMT_SPCL_CGO_APR
, NVL(MIN(CNT_30),'0/0') CNT_PHSE_OUT
, NVL(MIN(LMT_30),0) LMT_PHSE_OUT
, NVL(MIN(CNT_31),'0/0') CNT_301_CUST
, NVL(MIN(LMT_31),0) LMT_301_CUST
, NVL(MIN(CNT_40),'0/0') CNT_VL_UNMTCH
, NVL(MIN(LMT_40),0) LMT_VL_UNMTCH
, NVL(MIN(CNT_41),'0/0') CNT_VD_UNMTCH
, NVL(MIN(LMT_41),0) LMT_VD_UNMTCH
, NVL(MIN(CNT_50),'0/0') CNT_310
, NVL(MIN(LMT_50),0) LMT_310
, NVL(MIN(CNT_51),'0/0') CNT_DRFT_BL
, NVL(MIN(LMT_51),0) LMT_DRFT_BL
, NVL(MIN(CNT_61),'0/0') CNT_LNK_CNSTR
, NVL(MIN(LMT_61),0) LMT_LNK_CNSTR
, NVL(MIN(CNT_62),'0/0') CNT_NOD_CNSTR
, NVL(MIN(LMT_62),0) LMT_NOD_CNSTR
, NVL(MIN(CNT_63),'0/0') CNT_ROUT_CNSTR
, NVL(MIN(LMT_63),0) LMT_ROUT_CNSTR
, NVL(MIN(CNT_64),'0/0') CNT_PRD_CNSTR
, NVL(MIN(LMT_64),0) LMT_PRD_CNSTR
FROM
(
SELECT
  C.DEST
, BKG_OFC_CD  
, DECODE(C.DBD_IRR_TP_CD,1,C.TOT_CNT) CNT_1
, DECODE(C.DBD_IRR_TP_CD,1,S.LMT_STEP_NO) LMT_1
, DECODE(C.DBD_IRR_TP_CD,2,C.TOT_CNT) CNT_2
, DECODE(C.DBD_IRR_TP_CD,2,S.LMT_STEP_NO) LMT_2
, DECODE(C.DBD_IRR_TP_CD,3,C.TOT_CNT) CNT_3
, DECODE(C.DBD_IRR_TP_CD,3,S.LMT_STEP_NO) LMT_3
, DECODE(C.DBD_IRR_TP_CD,4,C.TOT_CNT) CNT_4
, DECODE(C.DBD_IRR_TP_CD,4,S.LMT_STEP_NO) LMT_4
, DECODE(C.DBD_IRR_TP_CD,5,C.TOT_CNT) CNT_5
, DECODE(C.DBD_IRR_TP_CD,5,S.LMT_STEP_NO) LMT_5
, DECODE(C.DBD_IRR_TP_CD,6,C.TOT_CNT) CNT_6
, DECODE(C.DBD_IRR_TP_CD,6,S.LMT_STEP_NO) LMT_6
, DECODE(C.DBD_IRR_TP_CD,7,C.TOT_CNT) CNT_7
, DECODE(C.DBD_IRR_TP_CD,7,S.LMT_STEP_NO) LMT_7
, DECODE(C.DBD_IRR_TP_CD,8,C.TOT_CNT) CNT_8
, DECODE(C.DBD_IRR_TP_CD,8,S.LMT_STEP_NO) LMT_8
, DECODE(C.DBD_IRR_TP_CD,9,C.TOT_CNT) CNT_9
, DECODE(C.DBD_IRR_TP_CD,9,S.LMT_STEP_NO) LMT_9
, DECODE(C.DBD_IRR_TP_CD,10,C.TOT_CNT) CNT_10
, DECODE(C.DBD_IRR_TP_CD,10,S.LMT_STEP_NO) LMT_10
, DECODE(C.DBD_IRR_TP_CD,11,C.TOT_CNT) CNT_11
, DECODE(C.DBD_IRR_TP_CD,11,S.LMT_STEP_NO) LMT_11
, DECODE(C.DBD_IRR_TP_CD,12,C.TOT_CNT) CNT_12
, DECODE(C.DBD_IRR_TP_CD,12,S.LMT_STEP_NO) LMT_12
, DECODE(C.DBD_IRR_TP_CD,13,C.TOT_CNT) CNT_13
, DECODE(C.DBD_IRR_TP_CD,13,S.LMT_STEP_NO) LMT_13
, DECODE(C.DBD_IRR_TP_CD,14,C.TOT_CNT) CNT_14
, DECODE(C.DBD_IRR_TP_CD,14,S.LMT_STEP_NO) LMT_14
, DECODE(C.DBD_IRR_TP_CD,15,C.TOT_CNT) CNT_15
, DECODE(C.DBD_IRR_TP_CD,15,S.LMT_STEP_NO) LMT_15
, DECODE(C.DBD_IRR_TP_CD,16,C.TOT_CNT) CNT_16
, DECODE(C.DBD_IRR_TP_CD,16,S.LMT_STEP_NO) LMT_16
, DECODE(C.DBD_IRR_TP_CD,17,C.TOT_CNT) CNT_17
, DECODE(C.DBD_IRR_TP_CD,17,S.LMT_STEP_NO) LMT_17
, DECODE(C.DBD_IRR_TP_CD,18,C.TOT_CNT) CNT_18
, DECODE(C.DBD_IRR_TP_CD,18,S.LMT_STEP_NO) LMT_18
, DECODE(C.DBD_IRR_TP_CD,19,C.TOT_CNT) CNT_19
, DECODE(C.DBD_IRR_TP_CD,19,S.LMT_STEP_NO) LMT_19
, DECODE(C.DBD_IRR_TP_CD,20,C.TOT_CNT) CNT_20
, DECODE(C.DBD_IRR_TP_CD,20,S.LMT_STEP_NO) LMT_20
, DECODE(C.DBD_IRR_TP_CD,21,C.TOT_CNT) CNT_21
, DECODE(C.DBD_IRR_TP_CD,21,S.LMT_STEP_NO) LMT_21
, DECODE(C.DBD_IRR_TP_CD,22,C.TOT_CNT) CNT_22
, DECODE(C.DBD_IRR_TP_CD,22,S.LMT_STEP_NO) LMT_22
, DECODE(C.DBD_IRR_TP_CD,23,C.TOT_CNT) CNT_23
, DECODE(C.DBD_IRR_TP_CD,23,S.LMT_STEP_NO) LMT_23
, DECODE(C.DBD_IRR_TP_CD,24,C.TOT_CNT) CNT_24
, DECODE(C.DBD_IRR_TP_CD,24,S.LMT_STEP_NO) LMT_24
, DECODE(C.DBD_IRR_TP_CD,25,C.TOT_CNT) CNT_25
, DECODE(C.DBD_IRR_TP_CD,25,S.LMT_STEP_NO) LMT_25
, DECODE(C.DBD_IRR_TP_CD,26,C.TOT_CNT) CNT_26
, DECODE(C.DBD_IRR_TP_CD,26,S.LMT_STEP_NO) LMT_26
, DECODE(C.DBD_IRR_TP_CD,30,C.TOT_CNT) CNT_30
, DECODE(C.DBD_IRR_TP_CD,30,S.LMT_STEP_NO) LMT_30
, DECODE(C.DBD_IRR_TP_CD,31,C.TOT_CNT) CNT_31
, DECODE(C.DBD_IRR_TP_CD,31,S.LMT_STEP_NO) LMT_31
, DECODE(C.DBD_IRR_TP_CD,40,C.TOT_CNT) CNT_40
, DECODE(C.DBD_IRR_TP_CD,40,S.LMT_STEP_NO) LMT_40
, DECODE(C.DBD_IRR_TP_CD,41,C.TOT_CNT) CNT_41
, DECODE(C.DBD_IRR_TP_CD,41,S.LMT_STEP_NO) LMT_41
, DECODE(C.DBD_IRR_TP_CD,50,C.TOT_CNT) CNT_50
, DECODE(C.DBD_IRR_TP_CD,50,S.LMT_STEP_NO) LMT_50
, DECODE(C.DBD_IRR_TP_CD,51,C.TOT_CNT) CNT_51
, DECODE(C.DBD_IRR_TP_CD,51,S.LMT_STEP_NO) LMT_51
, DECODE(C.DBD_IRR_TP_CD,61,C.TOT_CNT) CNT_61
, DECODE(C.DBD_IRR_TP_CD,61,S.LMT_STEP_NO) LMT_61
, DECODE(C.DBD_IRR_TP_CD,62,C.TOT_CNT) CNT_62
, DECODE(C.DBD_IRR_TP_CD,62,S.LMT_STEP_NO) LMT_62
, DECODE(C.DBD_IRR_TP_CD,63,C.TOT_CNT) CNT_63
, DECODE(C.DBD_IRR_TP_CD,63,S.LMT_STEP_NO) LMT_63
, DECODE(C.DBD_IRR_TP_CD,64,C.TOT_CNT) CNT_64
, DECODE(C.DBD_IRR_TP_CD,64,S.LMT_STEP_NO) LMT_64
FROM
(
    SELECT
      A2.DBD_IRR_TP_CD
    , A2.BKG_OFC_CD
    , A2.DEST
    , A2.CNT
    , A2.CNT||'/'||A1.CNT TOT_CNT
    FROM
        (
        SELECT
          N.BKG_OFC_CD
        , SUBSTR(B.POD_NOD_CD, 1,2) DEST
        , COUNT(N.BKG_NO) CNT
        FROM BKG_DBD_BAT A
        , BKG_DBD_BAT_CNDDT N
        , BKG_BOOKING B
        WHERE 1=1
        AND A.BAT_STS_CD = 'S'
        AND A.DBD_CRE_DT = N.DBD_CRE_DT
        AND A.DBD_CRE_SEQ = N.DBD_CRE_SEQ
        AND N.BKG_NO = B.BKG_NO
#if (${c_kind} == 'cust')
	AND EXISTS (SELECT 'X' FROM BKG_CUSTOMER CU WHERE B.BKG_NO = CU.BKG_NO
	#if (${combo_cust} != 'Z' && ${combo_cust} != '')
                   AND CU.BKG_CUST_TP_CD = @[combo_cust]
	#end
	#if (${f_cust_cd} != '')
                   AND (CU.CUST_CNT_CD,CU.CUST_SEQ) IN (( SUBSTR(@[f_cust_cd],1,2),SUBSTR(@[f_cust_cd],3) ))
	#end       )
#elseif (${c_kind} == 'gcust')
	AND EXISTS (SELECT 'X' FROM BKG_CUSTOMER CU, MDM_CUSTOMER M WHERE B.BKG_NO = CU.BKG_NO
                   AND CU.CUST_CNT_CD = M.CUST_CNT_CD
                   AND CU.CUST_SEQ = M.CUST_SEQ
	#if (${combo_gcust} != 'Z' && ${combo_gcust} != '')
                   AND CU.BKG_CUST_TP_CD = @[combo_gcust]
	#end
	#if (${f_gcust_cd} != '')
                   AND M.CUST_GRP_ID = @[f_gcust_cd]
	#end       )
#elseif (${c_kind} == 'ctrt')
	#if (${combo_ctrt} == 'S')
	AND C.SC_NO = @[f_ctrt_no]
	#elseif (${combo_ctrt} == 'R')
    AND C.RFA_NO = @[f_ctrt_no]
	#elseif (${combo_ctrt} == 'T')
    AND C.TAA_NO = @[f_ctrt_no]
	#else
    AND @[f_ctrt_no] IN (C.SC_NO, C.RFA_NO, C.TAA_NO)
    #end
#elseif (${c_kind} == 'bkgno')
	#if (${f_bkg_no} != '')
	AND C.BKG_NO = @[f_bkg_no]
	#end
#end
#if (${f_pol_nod_cd} != '')
	AND C.POL_NOD_CD LIKE @[f_pol_nod_cd]||'%'
#end
#if (${f_pod_nod_cd} != '')
	AND C.POD_NOD_CD LIKE @[f_pod_nod_cd]||'%'
#end
#if (${f_vvd} != '')
AND EXISTS (SELECT 'X' FROM BKG_VVD V WHERE 1=1
               AND B.BKG_NO = V.BKG_NO
               AND (V.VSL_CD,V.SKD_VOY_NO,V.SKD_DIR_CD) IN ((SUBSTR(@[f_vvd],1,4),SUBSTR(@[f_vvd],5,4),SUBSTR(@[f_vvd],9,1)))
            )
#end
        GROUP BY
        N.BKG_OFC_CD
        , SUBSTR(B.POD_NOD_CD, 1,2)
        ) A1
    ,	(
        SELECT
          B.DBD_IRR_TP_CD
        , SUBSTR(C.POD_NOD_CD, 1,2) DEST
        , B.BKG_OFC_CD
        , COUNT(B.BKG_NO) CNT
        FROM BKG_DBD_BAT A
        , BKG_DBD_RPT B
        , BKG_BOOKING C
        WHERE 1=1
        AND A.BAT_STS_CD = 'S'
        AND A.DBD_CRE_DT = B.DBD_CRE_DT
        AND A.DBD_CRE_SEQ = B.DBD_CRE_SEQ
        AND B.BKG_NO = C.BKG_NO
#if (${c_kind} == 'cust')
	AND EXISTS (SELECT 'X' FROM BKG_CUSTOMER CU WHERE B.BKG_NO = CU.BKG_NO
	#if (${combo_cust} != 'Z' && ${combo_cust} != '')
                   AND CU.BKG_CUST_TP_CD = @[combo_cust]
	#end
	#if (${f_cust_cd} != '')
                   AND (CU.CUST_CNT_CD,CU.CUST_SEQ) IN (( SUBSTR(@[f_cust_cd],1,2),SUBSTR(@[f_cust_cd],3) ))
	#end       )
#elseif (${c_kind} == 'gcust')
	AND EXISTS (SELECT 'X' FROM BKG_CUSTOMER CU, MDM_CUSTOMER M WHERE B.BKG_NO = CU.BKG_NO
                   AND CU.CUST_CNT_CD = M.CUST_CNT_CD
                   AND CU.CUST_SEQ = M.CUST_SEQ
	#if (${combo_gcust} != 'Z' && ${combo_gcust} != '')
                   AND CU.BKG_CUST_TP_CD = @[combo_gcust]
	#end
	#if (${f_gcust_cd} != '')
                   AND M.CUST_GRP_ID = @[f_gcust_cd]
	#end       )
#elseif (${c_kind} == 'ctrt')
	#if (${combo_ctrt} == 'S')
	AND C.SC_NO = @[f_ctrt_no]
	#elseif (${combo_ctrt} == 'R')
    AND C.RFA_NO = @[f_ctrt_no]
	#elseif (${combo_ctrt} == 'T')
    AND C.TAA_NO = @[f_ctrt_no]
	#else
    AND @[f_ctrt_no] IN (C.SC_NO, C.RFA_NO, C.TAA_NO)
    #end
#elseif (${c_kind} == 'bkgno')
	#if (${f_bkg_no} != '')
	AND C.BKG_NO = @[f_bkg_no]
	#end
#end
#if (${f_pol_nod_cd} != '')
	AND C.POL_NOD_CD LIKE @[f_pol_nod_cd]||'%'
#end
#if (${f_pod_nod_cd} != '')
	AND C.POD_NOD_CD LIKE @[f_pod_nod_cd]||'%'
#end
#if (${f_vvd} != '')
AND EXISTS (SELECT 'X' FROM BKG_VVD V WHERE 1=1
               AND B.BKG_NO = V.BKG_NO
               AND (V.VSL_CD,V.SKD_VOY_NO,V.SKD_DIR_CD) IN ((SUBSTR(@[f_vvd],1,4),SUBSTR(@[f_vvd],5,4),SUBSTR(@[f_vvd],9,1)))
            )
#end
        GROUP BY
          DBD_IRR_TP_CD
        , SUBSTR(POD_NOD_CD, 1,2)
        , B.BKG_OFC_CD
    ) A2
    WHERE 1=1
    AND A1.BKG_OFC_CD = A2.BKG_OFC_CD
    AND A1.DEST = A2.DEST
) C,
(
    SELECT B.* FROM
    (
        SELECT
          ROW_NUMBER() OVER (PARTITION BY DBD_IRR_TP_CD, LMT_STEP_NO ORDER BY DECODE(BKG_DBD_SET_TP_CD,'U', 1, 'D', 2, 3)) PROT
        , DBD_IRR_TP_CD
        , BKG_DBD_SET_TP_CD
        , LMT_STEP_NO
        , FM_VAL
        , TO_VAL
        FROM BKG_DBD_SET
        WHERE 1=1
        AND (BKG_DBD_SET_TP_CD='U' AND (CRE_USR_ID = @[f_usr_id]))
         OR BKG_DBD_SET_TP_CD = 'D'
    ) B
    WHERE PROT = 1
) S
WHERE C.DBD_IRR_TP_CD = S.DBD_IRR_TP_CD
AND C.CNT BETWEEN S.FM_VAL AND S.TO_VAL
ORDER BY   C.DEST, C.BKG_OFC_CD, TO_NUMBER(C.DBD_IRR_TP_CD)
)
GROUP BY DEST, BKG_OFC_CD
ORDER BY DEST			]]></sql>
			<params>
				<param name="combo_cust" type="12" value="" out="N"/>
				<param name="f_cust_cd" type="12" value="" out="N"/>
				<param name="combo_gcust" type="12" value="" out="N"/>
				<param name="f_gcust_cd" type="12" value="" out="N"/>
				<param name="f_ctrt_no" type="12" value="" out="N"/>
				<param name="f_bkg_no" type="12" value="" out="N"/>
				<param name="f_pol_nod_cd" type="12" value="" out="N"/>
				<param name="f_pod_nod_cd" type="12" value="" out="N"/>
				<param name="f_vvd" type="12" value="" out="N"/>
				<param name="f_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
