<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BSAYearlyPlanDBDAOCoaVslRgstVORSQL">
			<desc><![CDATA[vsl_cd select
2015.06.08 김용습 [CHM-201536164] 주간 MAS Open에 따른 타모듈 프로그램 적용 요청]]></desc>
			<sql><![CDATA[
SELECT DISTINCT  B1.VSL_CD
   FROM (SELECT A1.vsl_cd                                      AS vsl_cd
               ,SUM(A1.STND_LDB_CAPA + NVL(A2.SUB_TRD_CAPA,0)) AS capa
           FROM MAS_VSL_RGST A1
               ,MAS_VSL_SUB_TRD_CAPA A2
          WHERE A1.VSL_CD = A2.VSL_CD(+)
          GROUP BY A1.VSL_CD
        ) B1
       ,(
         SELECT MIN(COST_YR||COST_WK) FM_PRD
              , MAX(cost_yr||cost_wk) TO_PRD
           FROM MAS_WK_PRD
          WHERE COST_YR = @[f_year]
            AND COST_WK BETWEEN @[f_fm_wk] AND @[f_to_wk]
        ) B2
       ,MAS_MON_VVD_YRY_PLN B3
  WHERE B1.VSL_CD   = B3.VSL_CD
    AND B1.CAPA     = 0
    AND B3.DELT_FLG = 'N'

    #if (${f_seltrade} != '')
      AND B3.TRD_CD = @[f_seltrade]
    #end

    #if (${f_selrlane} != '')
      AND B3.RLANE_CD = @[f_selrlane]
    #end

    #if (${f_seldir} != '')
      AND B3.DIR_CD = @[f_seldir]
    #end

    #if (${f_selioc} != '')
      AND B3.IOC_CD = @[f_selioc]
    #end

    #if (${f_selslane}!= '')
      AND B3.SLAN_CD = @[f_selslane]
    #end

    AND SUBSTR(B3.COST_YRMON,1,4)||B3.COST_WK BETWEEN B2.FM_PRD AND B2.TO_PRD			]]></sql>
			<params>
				<param name="f_year" type="12" value="" out="N"/>
				<param name="f_fm_wk" type="12" value="" out="N"/>
				<param name="f_to_wk" type="12" value="" out="N"/>
				<param name="f_seltrade" type="12" value="" out="N"/>
				<param name="f_selrlane" type="12" value="" out="N"/>
				<param name="f_seldir" type="12" value="" out="N"/>
				<param name="f_selioc" type="12" value="" out="N"/>
				<param name="f_selslane" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
