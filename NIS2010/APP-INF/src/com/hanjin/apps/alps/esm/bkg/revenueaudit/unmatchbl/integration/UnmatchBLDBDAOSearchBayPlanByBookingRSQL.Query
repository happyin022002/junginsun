<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UnmatchBLDBDAOSearchBayPlanByBookingRSQL">
			<desc><![CDATA[BKG별 Bay Plan을 조회한다.]]></desc>
			<sql><![CDATA[
SELECT VVD, POL_CD, POD_CD, CNTR_NO, POSITION,
       VSL_PRE_PST_CD, VSL_SEQ,
       SUM (CASE WHEN ACT_SLOT <> '' THEN TO_NUMBER(ACT_SLOT)
                 WHEN x * y * z > 0  THEN (x + 1) * (y + 1) * (z + 1) - s
                 WHEN x * y > 0      THEN (x + 1) * (y + 1) * s - s
                 WHEN x * z > 0      THEN (x + 1) * (z + 1) - 1 + x * (s - 1)
                 WHEN y * z > 0      THEN (y + 1) * (z + 1) - 1 + y * (s - 1)
                 WHEN x + y > 0      THEN (x + y + 1) * s - s
                 WHEN z > 0          THEN z
                 ELSE 0
             END / 2
             ) AS VOID_VOL,
      '' BKG_NO
FROM (  SELECT BV.VSL_CD||BV.SKD_VOY_NO||BV.SKD_DIR_CD VVD,
               BP.POL POL_CD, 
               BP.POD POD_CD, 
               BP.ID CNTR_NO, 
               BP.BAY||'-'||BP.ROWW||'-'||BP.TIER POSITION,
               NVL (OVP_SLOT, 0) + NVL (OVS_SLOT, 0) AS X,
               NVL (OVH_SLOT, 0) AS Y,
               NVL (OVA_SLOT, 0) + NVL (OVF_SLOT, 0) AS Z,
               (2 - MOD (BAY, 2)) AS S,
               ACT_SLOT,
               BV.VSL_PRE_PST_CD, 
               BV.VSL_SEQ
        FROM BKG_VVD BV, BKG_CONTAINER BC, BAY_PLAN BP
        WHERE BV.BKG_NO = @[bkg_no]
        AND BV.BKG_NO = BC.BKG_NO
        AND BV.VSL_CD = BP.VSL_CD
        AND BV.SKD_VOY_NO = BP.VOY_NO
        AND BV.SKD_DIR_CD = BP.DIR_CD
        AND BV.POL_CD = BP.PORT_CD
        AND BV.POL_CD = BP.POL
        AND BV.POL_CLPT_IND_SEQ = BP.CALL_IND
        AND BP.PLAN_TYPE = 'F'
        AND BC.CNTR_NO = BP.ID
)
GROUP BY VVD, POL_CD, POD_CD, CNTR_NO, POSITION,
         VSL_PRE_PST_CD, VSL_SEQ
ORDER BY CNTR_NO, VSL_PRE_PST_CD, VSL_SEQ			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
