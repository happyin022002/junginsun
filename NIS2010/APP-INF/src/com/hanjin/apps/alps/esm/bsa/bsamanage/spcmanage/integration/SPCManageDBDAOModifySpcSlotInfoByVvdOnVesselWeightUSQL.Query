<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SPCManageDBDAOModifySpcSlotInfoByVvdOnVesselWeightUSQL">
			<desc><![CDATA[SPCManageDBDAOModifySpcSlotInfoByVvdOnVesselWeight]]></desc>
			<sql><![CDATA[
MERGE INTO BSA_VVD_OTR_CRR A
USING (
	SELECT 
	 @[trd_cd] TRD_CD
		 , @[lane_cd] RLANE_CD
		 , @[dir_cd] SKD_DIR_CD
		 , @[vsl_cd] VSL_CD
		 , @[voy_no] SKD_VOY_NO 
		 , '009' BSA_OP_JB_CD
		 , @[crr_cd] CRR_CD
        FROM DUAL
) B
ON (
	    A.TRD_CD       = B.TRD_CD
	AND A.RLANE_CD     = B.RLANE_CD
	AND A.SKD_DIR_CD   = B.SKD_DIR_CD
	AND A.VSL_CD       = B.VSL_CD
	AND A.SKD_VOY_NO   = B.SKD_VOY_NO
	AND A.BSA_OP_JB_CD = B.BSA_OP_JB_CD
	AND A.CRR_CD       = B.CRR_CD
)
WHEN MATCHED THEN
	UPDATE
#if (${crr_cd} != 'SML')
	SET CRR_BSA_CAPA = (SELECT CRR_BSA_CAPA 
                            FROM BSA_VVD_OTR_CRR 
                            WHERE TRD_CD = @[trd_cd] 
                                AND RLANE_CD = @[lane_cd]
                                AND VSL_CD = @[vsl_cd]
                                AND SKD_VOY_NO = @[voy_no]
                                AND SKD_DIR_CD = @[dir_cd]
                                AND BSA_OP_JB_CD = '007' --앞 쿼리에서 이미 변경된 CRR_BSA_CAPA가 007에 반영되었으므로 여기서는 그대로 불러서 씀
                                AND CRR_CD = @[crr_cd])*(SELECT CRR_BSA_CAPA 
                                                            FROM BSA_VVD_OTR_CRR 
                                                            WHERE TRD_CD = @[trd_cd] 
                                                                AND RLANE_CD = @[lane_cd]
                                                                AND VSL_CD = @[vsl_cd]
                                                                AND SKD_VOY_NO = @[voy_no]
                                                                AND SKD_DIR_CD = @[dir_cd]
                                                                AND BSA_OP_JB_CD = '008'
                                                                AND CRR_CD = @[crr_cd])
#else
#if (${type} == 'SC')
	SET CRR_BSA_CAPA = @[fnl_hjs_bsa_capa_sc]*(SELECT CRR_BSA_CAPA 
                                                FROM BSA_VVD_OTR_CRR 
                                                WHERE TRD_CD = @[trd_cd] 
                                                    AND RLANE_CD = @[lane_cd]
                                                    AND VSL_CD = @[vsl_cd]
                                                    AND SKD_VOY_NO = @[voy_no]
                                                    AND SKD_DIR_CD = @[dir_cd]
                                                    AND BSA_OP_JB_CD = '008'
                                                    AND CRR_CD = @[crr_cd])
#else
	SET CRR_BSA_CAPA = @[fnl_hjs_bsa_capa]*(SELECT CRR_BSA_CAPA 
                                            FROM BSA_VVD_OTR_CRR 
                                            WHERE TRD_CD = @[trd_cd] 
                                                AND RLANE_CD = @[lane_cd]
                                                AND VSL_CD = @[vsl_cd]
                                                AND SKD_VOY_NO = @[voy_no]
                                                AND SKD_DIR_CD = @[dir_cd]
                                                AND BSA_OP_JB_CD = '008'
                                                AND CRR_CD = @[crr_cd])
#end

#end
	, UPD_DT = SYSDATE
	, UPD_USR_ID = @[upd_usr_id]			]]></sql>
			<params>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="lane_cd" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="voy_no" type="12" value="" out="N"/>
				<param name="crr_cd" type="12" value="" out="N"/>
				<param name="fnl_hjs_bsa_capa_sc" type="12" value="" out="N"/>
				<param name="fnl_hjs_bsa_capa" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
