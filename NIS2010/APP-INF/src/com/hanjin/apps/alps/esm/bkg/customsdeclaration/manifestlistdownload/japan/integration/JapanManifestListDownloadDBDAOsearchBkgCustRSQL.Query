<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="JapanManifestListDownloadDBDAOsearchBkgCustRSQL">
			<desc><![CDATA[searchBkgCust]]></desc>
			<sql><![CDATA[
SELECT
       BL_NO
     , BL_SPLIT_NO
     , BKG_CUST_TP_CD
     , CASE WHEN BKG_CUST_TP_CD = 'C' AND CUST_TO_ORD_FLG   ='Y' THEN MAX(DECODE(BKG_CUST_TP_CD,'N',CUST_CNT_CD,NULL)) OVER()
            ELSE CUST_CNT_CD
       END AS CUST_CNT_CD
     , CUST_SEQ
     , CASE WHEN BKG_CUST_TP_CD = 'C' AND CUST_TO_ORD_FLG   ='Y' THEN 'TO ORDER'
            WHEN BKG_CUST_TP_CD = 'N' AND SAM_CNEE_NTFY_FLG ='Y' THEN MAX(DECODE(BKG_CUST_TP_CD,'C',CUST_NM,NULL)) OVER()
            ELSE CUST_NM
       END AS CUST_NM
     , CASE WHEN BKG_CUST_TP_CD = 'C' AND CUST_TO_ORD_FLG   ='Y' THEN 'TO ORDER'
            WHEN BKG_CUST_TP_CD = 'N' AND SAM_CNEE_NTFY_FLG ='Y' THEN MAX(DECODE(BKG_CUST_TP_CD,'C',CUST_ADDR,NULL)) OVER()
            ELSE CUST_ADDR
       END AS CUST_ADDR      
     , CUST_ZIP_ID
     , FAX_NO
     , CASE WHEN BKG_CUST_TP_CD = 'C' AND CUST_TO_ORD_FLG   ='Y' THEN 'TO ORDER'
            WHEN BKG_CUST_TP_CD = 'N' AND SAM_CNEE_NTFY_FLG ='Y' THEN MAX(DECODE(BKG_CUST_TP_CD,'C',PHN_NO,NULL)) OVER()
            ELSE PHN_NO
       END AS PHN_NO      
     
FROM (
      SELECT A.BL_NO,
             '  ' AS BL_SPLIT_NO,
             B.BKG_CUST_TP_CD,
             B.CUST_CNT_CD,
             B.CUST_SEQ,
             REPLACE(REPLACE(NVL(UPPER(B.CUST_NM), ''), CHR(180), CHR(39)), '’', '''') AS CUST_NM,
             REPLACE(REPLACE(NVL(UPPER(B.CUST_ADDR), ''), CHR(180), CHR(39)), '’', '''') AS CUST_ADDR,
             B.CUST_ZIP_ID,
             B.CUST_FAX_NO AS FAX_NO,
--(2017.08.08)수정시작
             REGEXP_REPLACE(EORI_NO,'[^0-9]','') AS PHN_NO,
--(2017.08.08)수정완료
             CUST_TO_ORD_FLG,    -- 수하인인 정해지지 않은 무기명 B/L,지시식 B/L
             SAM_CNEE_NTFY_FLG  -- NOTIFY가 CONSIGNEE와 같다는 FLAG
 
        FROM BKG_BOOKING A,
             BKG_CUSTOMER B
 
       WHERE A.BKG_NO = @[bkg_no] 
         AND A.BKG_NO = B.BKG_NO
         AND (B.BKG_CUST_TP_CD = 'S' OR B.BKG_CUST_TP_CD = 'C' OR B.BKG_CUST_TP_CD = 'N')
  
 )
ORDER BY BKG_CUST_TP_CD			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
