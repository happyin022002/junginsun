<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCRoutePointProposalDBDAORsltRoutPntLocHistoryTypeVORSQL">
			<desc><![CDATA[ORIGIN & DESTINATION에 데이터가 존재하는지 조회한다.
2012.02.23 이석준[CHM-201216153-01] S/C Amendment History 화면 기능 개선 요청]]></desc>
			<sql><![CDATA[
SELECT PROP_NO
     , AMDT_SEQ
     , SVC_SCP_CD
     , 'O' ORG_DEST_TP_CD
     , COUNT(N1ST_CMNC_AMDT_SEQ) AMEND_CNT
  FROM PRI_SP_SCP_ROUT_PNT
 WHERE AMDT_SEQ         = @[amdt_seq]
   AND SVC_SCP_CD       = @[svc_scp_cd]
   AND PROP_NO			= @[prop_no]
   AND ORG_DEST_TP_CD	= 'O'

   AND (( SELECT LGCY_IF_FLG 
			FROM PRI_SP_MN 
		   WHERE PROP_NO  = @[prop_no] 
			 AND AMDT_SEQ = @[amdt_seq] ) = 'N' OR SRC_INFO_CD <> 'AD' ) 
   AND N1ST_CMNC_AMDT_SEQ = DECODE(( SELECT LGCY_IF_FLG 
									   FROM PRI_SP_MN 
		   							  WHERE PROP_NO  = @[prop_no] 
			 							AND AMDT_SEQ = @[amdt_seq] ), 'N', AMDT_SEQ, N1ST_CMNC_AMDT_SEQ) 
 GROUP BY PROP_NO, AMDT_SEQ, SVC_SCP_CD
 
UNION ALL

SELECT PROP_NO
     , AMDT_SEQ
     , SVC_SCP_CD
     , 'D' ORG_DEST_TP_CD
     , COUNT(N1ST_CMNC_AMDT_SEQ) AMEND_CNT
  FROM PRI_SP_SCP_ROUT_PNT
 WHERE AMDT_SEQ         = @[amdt_seq]
   AND SVC_SCP_CD       = @[svc_scp_cd]
   AND PROP_NO			= @[prop_no]
   AND ORG_DEST_TP_CD	= 'D'

   AND (( SELECT LGCY_IF_FLG 
			FROM PRI_SP_MN 
		   WHERE PROP_NO  = @[prop_no] 
			 AND AMDT_SEQ = @[amdt_seq] ) = 'N' OR SRC_INFO_CD <> 'AD' ) 
   AND N1ST_CMNC_AMDT_SEQ = DECODE(( SELECT LGCY_IF_FLG 
									   FROM PRI_SP_MN 
		   							  WHERE PROP_NO  = @[prop_no] 
			 							AND AMDT_SEQ = @[amdt_seq] ), 'N', AMDT_SEQ, N1ST_CMNC_AMDT_SEQ) 
 #if (${con_flg} == '0') 
AND  0=0
#else
AND 1=1
#end
 GROUP BY PROP_NO, AMDT_SEQ, SVC_SCP_CD			]]></sql>
			<params>
				<param name="amdt_seq" type="12" value="" out="N"/>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="prop_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
