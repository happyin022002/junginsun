<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SPCLCmpnApprovalDBDAOSearchSPCLCmpnApprovalMasterListRSQL">
			<desc><![CDATA[SPCLCmpnApprovalMaster]]></desc>
			<sql><![CDATA[
SELECT
           A.CUST_CNT_CD,
           TO_CHAR(A.CUST_SEQ,'FM000000') AS CUST_SEQ,
           A.CUST_CNT_CD||TO_CHAR(A.CUST_SEQ,'FM000000')         AS CUST_CNT_SEQ,
           TO_CHAR(A.VNDR_SEQ,'FM000000')                        AS VNDR_SEQ,
           B.CUST_LGL_ENG_NM                                     AS FWDR_NAME,
           COUNT(*)                                              AS TOT_CNT,
           ROUND(SUM(IF_AMT), 2)                                 AS NET_AMT,
           NVL(AVG(INV_TAX_RT), 0)                               AS VAT,
           ROUND(SUM(IF_AMT + (IF_AMT * NVL(INV_TAX_RT, 0) / 100)), 2) AS TOT_AMT,
           A.VNDR_SEQ,
           A.AP_OFC_CD,
           A.CSR_NO,
           TO_CHAR(A.IF_DT,'YYYYMMDD')                           AS IF_DATE,
           DECODE(D.IF_FLG,'Y','Success',D.IF_ERR_RSN)           AS IF_RSN,
           DECODE(D.RCV_ERR_FLG,'Y','Success',D.RCV_ERR_RSN)     AS RCV_RSN,
           D.IF_FLG                                              AS IF_FLG,
           D.RCV_ERR_FLG                                         AS RCV_FLG,
           D.PAY_AMT,
           D.PAY_DT,
           D.FTU_USE_CTNT1,
           D.PAY_MZD_LU_CD,
           F.GEN_PAY_TERM_CD                                     AS VNDR_TERM_NM,
           NVL(LTRIM(F.subs_co_cd),'00')                         AS COA_INTER_COMPY_CD ,
           NVL(LTRIM(F.vndr_locl_lang_nm),F.vndr_lgl_eng_nm)     AS INV_DESC
      FROM ACM_SPCL_CMPN      A,
           MDM_CUSTOMER       B,
           ACM_AGN_BKG_INFO   C,
           AP_INV_HDR         D,
           MDM_VENDOR         F
     WHERE A.CUST_CNT_CD      = B.CUST_CNT_CD
       AND A.CUST_SEQ         = B.CUST_SEQ
       AND A.BKG_NO           = C.BKG_NO
       AND A.CRE_USR_ID      != 'COST'
       AND A.AP_OFC_CD        IS NOT NULL
       AND C.BL_NO            IS NOT NULL
       AND A.CSR_NO           = D.CSR_NO(+)
       AND A.VNDR_SEQ         = F.VNDR_SEQ
       AND A.AR_OFC_CD        = @[ar_ofc_cd]
#if(${date_div} == 'C')
       AND C.BKG_CRE_DT
   BETWEEN TO_DATE(REPLACE(@[date_fm],'-', ''),'YYYYMMDD')
       AND TO_DATE(REPLACE(@[date_to],'-', ''),'YYYYMMDD')+0.99999
#elseif(${date_div} == 'E')
       AND A.VSL_DEP_DT
   BETWEEN TO_DATE(REPLACE(@[date_fm],'-', ''),'YYYYMMDD')
       AND TO_DATE(REPLACE(@[date_to],'-', ''),'YYYYMMDD')+0.99999
#elseif(${date_div} == 'I')
       AND A.IF_DT
   BETWEEN TO_DATE(REPLACE(@[date_fm],'-', ''),'YYYYMMDD')
       AND TO_DATE(REPLACE(@[date_to],'-', ''),'YYYYMMDD')+0.99999
#end
#if(${if_opt} == 'CS')
       AND A.SPCL_CMPN_STS_CD     = 'CS'
       AND NVL(A.PAY_CHK_FLG,'N') = 'Y'
#elseif(${if_opt} == 'PS')
       AND A.SPCL_CMPN_STS_CD IN ( 'IF', @[if_opt] )
#else
       AND A.SPCL_CMPN_STS_CD = @[if_opt]
#end
#if(${ff_cnt_seq} != '')
       AND A.CUST_CNT_CD      = substr(@[ff_cnt_seq], 0, 2)
       AND A.CUST_SEQ         = substr(@[ff_cnt_seq], 3, 6)
#end
#if(${bl_no} != '')
       AND C.BL_NO
        IN
         ( $bl_no
         )
#end
 GROUP BY A.CUST_CNT_CD,
          A.CUST_SEQ,
          A.CUST_CNT_CD||TO_CHAR(A.CUST_SEQ,'FM000000'),
          TO_CHAR(A.VNDR_SEQ,'FM000000'),
          B.CUST_LGL_ENG_NM,
          A.VNDR_SEQ,
          A.AP_OFC_CD,
          A.CSR_NO,
          TO_CHAR(A.IF_DT,'YYYYMMDD'),
          DECODE(D.IF_FLG,'Y','Success',D.IF_ERR_RSN),
          DECODE(D.RCV_ERR_FLG,'Y','Success',D.RCV_ERR_RSN),
          D.IF_FLG,
          D.RCV_ERR_FLG,
          D.PAY_AMT,
          D.PAY_DT,
          D.FTU_USE_CTNT1,
          D.PAY_MZD_LU_CD,
          F.GEN_PAY_TERM_CD,
          NVL(LTRIM(F.subs_co_cd),'00'),
          NVL(LTRIM(F.vndr_locl_lang_nm),F.vndr_lgl_eng_nm)
 ORDER BY 1			]]></sql>
			<params>
				<param name="ar_ofc_cd" type="12" value="" out="N"/>
				<param name="date_fm" type="12" value="" out="N"/>
				<param name="date_to" type="12" value="" out="N"/>
				<param name="if_opt" type="12" value="" out="N"/>
				<param name="ff_cnt_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
