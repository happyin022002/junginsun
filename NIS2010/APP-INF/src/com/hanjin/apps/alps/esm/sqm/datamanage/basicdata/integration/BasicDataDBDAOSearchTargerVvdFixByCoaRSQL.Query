<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BasicDataDBDAOSearchTargerVvdFixByCoaRSQL">
			<desc><![CDATA[Target VVD List를 조회

* 2015.06.15 김용습 [CHM-201536164] 주간 MAS Open에 따른 타모듈 프로그램 적용 요청
2016.05.24 김용습 wk가 아니라 month기준으로 조회되도록 함
2016.05.24 김용습 mas에서 vvd가져올때 연도는 sls_yrmon, 월은 cost_yrmon 기준]]></desc>
			<sql><![CDATA[
SELECT @[f_bse_yr] BSE_YR
      ,@[f_bse_qtr_cd] BSE_QTR_CD
      ,VVD.TRD_CD
      ,VVD.RLANE_CD
      ,VVD.DIR_CD
      ,VVD.VSL_CD||VVD.SKD_VOY_NO||VVD.DIR_CD VVD
      ,VVD.VSL_CD
      ,VVD.SKD_VOY_NO
      ,VVD.DIR_CD SKD_DIR_CD
      ,SUBSTR(VVD.COST_YRMON,5,6) BSE_MON
      ,VVD.COST_WK BSE_WK
      ,VVD.SUB_TRD_CD
      ,VVD.IOC_CD
      ,NVL(BSA.FNL_HJS_BSA_CAPA,0) AS FNL_BSA_CAPA
  FROM MAS_MON_VVD VVD
      ,BSA_VVD_MST BSA
      ,SQM_QTA_LANE_MGMT LANE
 WHERE 1=1
   AND SUBSTR(VVD.SLS_YRMON,0,4) = @[f_bse_yr]
   AND SUBSTR(VVD.COST_YRMON, 5) BETWEEN (CASE WHEN @[f_bse_qtr_cd] = '1Q' THEN '01' WHEN @[f_bse_qtr_cd] = '2Q' THEN '04' WHEN @[f_bse_qtr_cd] = '3Q' THEN '07' WHEN @[f_bse_qtr_cd] = '4Q' THEN '10' ELSE '01' END) 
                                              AND (CASE WHEN @[f_bse_qtr_cd] = '1Q' THEN '03' WHEN @[f_bse_qtr_cd] = '2Q' THEN '06' WHEN @[f_bse_qtr_cd] = '3Q' THEN '09' WHEN @[f_bse_qtr_cd] = '4Q' THEN '12' ELSE '12' END)
   AND VVD.TRD_CD       = BSA.TRD_CD(+)
   AND VVD.RLANE_CD     = BSA.RLANE_CD(+)
   AND VVD.VSL_CD       = BSA.VSL_CD(+)
   AND VVD.SKD_VOY_NO   = BSA.SKD_VOY_NO(+)
   AND VVD.DIR_CD       = BSA.SKD_DIR_CD(+)
   AND VVD.TRD_CD       = LANE.TRD_CD
   AND VVD.RLANE_CD     = LANE.RLANE_CD
   AND VVD.SUB_TRD_CD   = LANE.SUB_TRD_CD
   AND VVD.IOC_CD       = DECODE(VVD.RLANE_CD,'RBCCO','I',VVD.IOC_CD)
   AND VVD.DIR_CD       = NVL(LANE.LANE_DIR_CD,VVD.DIR_CD)
#if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')
  AND VVD.TRD_CD        = @[f_trd_cd]
#end
#if (${f_dir_cd} != '' && ${f_dir_cd} != 'All')
  AND VVD.DIR_CD        = @[f_dir_cd]
#end
#if (${f_sub_trd_cd} != '' && ${f_sub_trd_cd} != 'All')
  AND VVD.SUB_TRD_CD    = @[f_sub_trd_cd]
#end
#if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')
  AND VVD.RLANE_CD      = @[f_rlane_cd]
#end
   AND VVD.DELT_FLG     = 'N'
   AND LANE.SQM_ACT_FLG = 'Y'
ORDER BY VVD.TRD_CD
        ,VVD.DIR_CD
        ,VVD.SUB_TRD_CD
        ,VVD.RLANE_CD
        ,BSE_MON
        ,VVD.COST_WK			]]></sql>
			<params>
				<param name="f_bse_yr" type="12" value="" out="N"/>
				<param name="f_bse_qtr_cd" type="12" value="" out="N"/>
				<param name="f_trd_cd" type="12" value="" out="N"/>
				<param name="f_dir_cd" type="12" value="" out="N"/>
				<param name="f_sub_trd_cd" type="12" value="" out="N"/>
				<param name="f_rlane_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
