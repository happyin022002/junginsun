<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RFAProposalMainDBDAOPriRpScpAmdtSmryAmd2CSQL">
			<desc><![CDATA[Summary에 IHC(73)가 없는 경우 IHC 추가]]></desc>
			<sql><![CDATA[
MERGE INTO PRI_RP_SCP_AMDT_SMRY A
USING (
    SELECT A.PROP_NO, A.AMDT_SEQ, A.SVC_SCP_CD, INTG_CD_VAL_CTNT
      FROM PRI_RP_SCP_AMDT_SMRY A, COM_INTG_CD_DTL B
     WHERE PROP_NO	 = @[prop_no]
       AND AMDT_SEQ = @[amdt_seq]
       AND INTG_CD_ID = 'CD01740'
       AND INTG_CD_VAL_CTNT = '73' -- IHC
       AND PROP_SCP_TERM_TP_CD IN ('71', '73')
) B
ON (
    A.PROP_NO = B.PROP_NO
AND A.AMDT_SEQ = B.AMDT_SEQ
AND A.PROP_SCP_TERM_TP_CD = B.INTG_CD_VAL_CTNT
)
-- IHC가 없는 경우
WHEN NOT MATCHED THEN
INSERT (
    A.PROP_NO,
    A.AMDT_SEQ,
    A.SVC_SCP_CD,
    A.PROP_SCP_TERM_TP_CD,
    A.AMDT_FLG,
    A.ACPT_FLG,
    A.CRE_USR_ID,
    A.CRE_DT,
    A.UPD_USR_ID,
    A.UPD_DT
)
VALUES
(
    B.PROP_NO,
    B.AMDT_SEQ+1,
    B.SVC_SCP_CD,
    '73',
    'N',
    'N',
    @[cre_usr_id],
    SYSDATE,
    @[upd_usr_id],
    SYSDATE
)			]]></sql>
			<params>
				<param name="prop_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
