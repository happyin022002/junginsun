<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingReceiptDBDAOCheckNewChinaCustomerRSQL">
			<desc><![CDATA[GeneralBookingReceiptDBCheckNewChinaCustomer]]></desc>
			<sql><![CDATA[
SELECT COUNT(1) CNT
  FROM ( SELECT 'Y' -- SHPR
           FROM DUAL
          WHERE NOT EXISTS ( select 1 
                               from bkg_booking  bk
                                  , bkg_customer cust
                              where bk.bkg_no = cust.bkg_no
                                and bk.bkg_cre_Dt > sysdate - 180
                                and bk.bkg_sts_cd <> 'X'
                                and bk.bkg_cgo_tp_cd <> 'P'
                                and cust.CUST_CNT_CD = @[s_cust_cnt_cd]
                                AND CUST_SEQ = @[s_cust_seq]     
                                AND ROWNUM = 1
                           )
            AND 0 < LENGTH(@[s_cust_cnt_cd])
            AND 0 < @[s_cust_seq]  

         UNION ALL

         SELECT 'Y' -- CNEE
           FROM DUAL
          WHERE NOT EXISTS ( select 1 
                               from bkg_booking  bk
                                  , bkg_customer cust
                              where bk.bkg_no = cust.bkg_no
                                and bk.bkg_cre_Dt > sysdate - 180
                                and bk.bkg_sts_cd <> 'X'
                                and bk.bkg_cgo_tp_cd <> 'P'
                                and cust.CUST_CNT_CD = @[c_cust_cnt_cd]
                                AND CUST_SEQ = @[c_cust_seq]     
                                AND ROWNUM = 1
                           )
            AND 0 < LENGTH(@[c_cust_cnt_cd])
            AND 0 < @[c_cust_seq]  

         UNION ALL

         SELECT 'Y' -- FWDR
           FROM DUAL
          WHERE NOT EXISTS ( select 1 
                               from bkg_booking  bk
                                  , bkg_customer cust
                              where bk.bkg_no = cust.bkg_no
                                and bk.bkg_cre_Dt > sysdate - 180
                                and bk.bkg_sts_cd <> 'X'
                                and bk.bkg_cgo_tp_cd <> 'P'
                                and cust.CUST_CNT_CD = @[f_cust_cnt_cd]
                                AND CUST_SEQ = @[f_cust_seq]     
                                AND ROWNUM = 1
                           )
            AND 0 < LENGTH(@[f_cust_cnt_cd])
            AND 0 < @[f_cust_seq]         
       ) CUST
       
     -- L.OFC 가 북중국 지역
     , ( SELECT RGN_CD 
           FROM MDM_SLS_REP      REP
              , MDM_ORGANIZATION ORG
              , MDM_LOCATION     LOC
          WHERE REP.OFC_CD  = ORG.OFC_CD
            AND ORG.OFC_TP_CD IN ('BS','BB')
            AND LOC.LOC_CD  = ORG.LOC_CD
            AND RGN_CD      = 'CNN' -- 북중국
            AND REP.SREP_CD  = @[ob_srep_cd]

         UNION ALL
     -- L.OFC 가 서남아 지역
         SELECT ORG.OFC_CD
           FROM MDM_SLS_REP      REP
              , MDM_ORGANIZATION ORG
          WHERE REP.OFC_CD  = ORG.OFC_CD
            AND ORG.OFC_TP_CD IN ('BS','BB')
            AND ORG.AR_HD_QTR_OFC_CD ='SINRS' 
            AND REP.SREP_CD  = @[ob_srep_cd]
       )
 WHERE NOT EXISTS (SELECT 1 
                     FROM BKG_HRD_CDG_CTNT 
                    WHERE HRD_CDG_ID = 'BKG_VALIDATION'
                      AND ATTR_CTNT1 = 'CNN_NEW_CUST_APRO'
                      AND ATTR_CTNT2 = 'OFF')			]]></sql>
			<params>
				<param name="s_cust_cnt_cd" type="12" value="" out="N"/>
				<param name="s_cust_seq" type="12" value="" out="N"/>
				<param name="c_cust_cnt_cd" type="12" value="" out="N"/>
				<param name="c_cust_seq" type="12" value="" out="N"/>
				<param name="f_cust_cnt_cd" type="12" value="" out="N"/>
				<param name="f_cust_seq" type="12" value="" out="N"/>
				<param name="ob_srep_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
