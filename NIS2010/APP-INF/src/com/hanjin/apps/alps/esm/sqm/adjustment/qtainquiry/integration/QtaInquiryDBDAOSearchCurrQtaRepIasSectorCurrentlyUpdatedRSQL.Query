<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="QtaInquiryDBDAOSearchCurrQtaRepIasSectorCurrentlyUpdatedRSQL">
			<desc><![CDATA[QTA Inquiry_Yearly Current QTA Report for IAS Sector화면에서 Currently Updated 체크하고 조회시 타는 쿼리

* 2015.10.16 김용습 [CHM-201538306] [CSR 전환건] QTA Inquiry_Yearly Current QTA Report의 "Y/Q" 칼럼관련 Retrieve 로직 수정
* 2016.03.15 최성민 [CHM-201640194] QTA Set up by Head Office for IAS Sector_Summary VVD 중복 계산 관련 로직 수정]]></desc>
			<sql><![CDATA[
SELECT BSE_YR
,BSE_QTR_CD
,OFC_VW_CD
,TRD_CD
,SUB_TRD_CD
,IAS_RGN_CD
,RLANE_CD
,DIR_CD
,HUL_BND_CD
,BSE_MON
#if (${f_chk_week} == 'W')      
,BSE_WK
#if (${f_bse_tp_cd} == 'Q')  
,SLS_YRMON
#end
#end
#if (${f_chk_vvd} == 'V' )      
,VVD
#end
,SUM(TOT_BSA_CAPA) AS TOT_BSA_CAPA
#if (${f_ofc_lvl} == '02')   
,RHQ_CD
#elseif (${f_ofc_lvl} == '03') 
,RHQ_CD
,RGN_OFC_CD
#end
#if (${f_chk_pair} == 'Y')
,POL_CD
,POD_CD
,SQM_MN_SCTR_FLG
#end
,SUM(LOD_QTY) AS LOD_QTY
,DECODE(SUM(LOD_QTY),0,0,SUM(GRS_REV)/SUM(LOD_QTY)) AS REV_RPB
,SUM(GRS_REV) AS GRS_REV 
,SUM(PA_CM_COST) AS PA_CM_COST
,SUM(RA_CM_COST) AS RA_CM_COST
,DECODE(SUM(LOD_QTY)*SUM(PA_CM_COST),0,0,SUM(PA_CM_COST)/SUM(LOD_QTY)) AS PA_CMCB
,DECODE(SUM(LOD_QTY)*SUM(RA_CM_COST),0,0,SUM(RA_CM_COST)/SUM(LOD_QTY)) AS RA_CMCB
,SUM(PA_CM) AS PA_CM
,SUM(RA_CM) AS RA_CM
,DECODE(SUM(LOD_QTY)*SUM(PA_CM),0,0,SUM(PA_CM)/SUM(LOD_QTY)) AS PA_CMPB
,DECODE(SUM(LOD_QTY)*SUM(RA_CM),0,0,SUM(RA_CM)/SUM(LOD_QTY)) AS RA_CMPB 
FROM
(
SELECT BSE_YR
,DECODE(BSE_QTR_CD, 'Y', 'Y', VVD_QUARTER) AS BSE_QTR_CD
,OFC_VW_CD
,TRD_CD
,SUB_TRD_CD
,IAS_RGN_CD
,RLANE_CD
,DIR_CD
,HUL_BND_CD
,BSE_MON
#if (${f_chk_week} == 'W')      
,BSE_WK
#if (${f_bse_tp_cd} == 'Q')  
,SLS_YRMON
#end
#end
#if (${f_chk_vvd} == 'V' )      
,VVD
#end
,TOT_BSA_CAPA
#if (${f_ofc_lvl} == '02')   
,RHQ_CD
#elseif (${f_ofc_lvl} == '03') 
,RHQ_CD
,RGN_OFC_CD
#end
#if (${f_chk_pair} == 'Y')
,POL_CD
,POD_CD
,SQM_MN_SCTR_FLG
#end
,LOD_QTY
,REV_RPB
,GRS_REV
,PA_CM_COST
,RA_CM_COST
,PA_CMCB
,RA_CMCB
,PA_CM
,RA_CM
,PA_CMPB
,RA_CMPB  
FROM
(
SELECT BSE_YR
,BSE_QTR_CD
,OFC_VW_CD
,TRD_CD
,SUB_TRD_CD
,IAS_RGN_CD
,RLANE_CD
,DIR_CD
,HUL_BND_CD
,BSE_MON
,CASE WHEN BSE_MON = '01' THEN '1Q'
    WHEN BSE_MON = '02' THEN '1Q'
    WHEN BSE_MON = '03' THEN '1Q'
    WHEN BSE_MON = '04' THEN '2Q'
    WHEN BSE_MON = '05' THEN '2Q'
    WHEN BSE_MON = '06' THEN '2Q'
    WHEN BSE_MON = '07' THEN '3Q'
    WHEN BSE_MON = '08' THEN '3Q'
    WHEN BSE_MON = '09' THEN '3Q'
    WHEN BSE_MON = '10' THEN '4Q'
    WHEN BSE_MON = '11' THEN '4Q'
    WHEN BSE_MON = '12' THEN '4Q' END AS VVD_QUARTER
#if (${f_chk_week} == 'W')      
,BSE_WK
#if (${f_bse_tp_cd} == 'Q')  
,SLS_YRMON
#end
#end
#if (${f_chk_vvd} == 'V' )      
,VVD
#end
,TOT_BSA_CAPA
#if (${f_ofc_lvl} == '02')   
,RHQ_CD
#elseif (${f_ofc_lvl} == '03') 
,RHQ_CD
,RGN_OFC_CD
#end
#if (${f_chk_pair} == 'Y')
,POL_CD
,POD_CD
,SQM_MN_SCTR_FLG
#end
,LOD_QTY
,REV_RPB
,GRS_REV
,PA_CM_COST
,RA_CM_COST
,PA_CMCB
,RA_CMCB
,PA_CM
,RA_CM
,PA_CMPB
,RA_CMPB 
FROM
(
(
SELECT  
      A1.BSE_YR
      ,A1.BSE_QTR_CD
      ,(SELECT INTG_CD_VAL_DP_DESC AS NAME
        FROM COM_INTG_CD_DTL
        WHERE INTG_CD_ID  = 'CD00940'
        AND INTG_CD_VAL_CTNT = A1.OFC_VW_CD) OFC_VW_CD
      ,A1.TRD_CD
      ,A1.SUB_TRD_CD
      ,(SELECT INTG_CD_VAL_DP_DESC
		FROM COM_INTG_CD_DTL
		WHERE INTG_CD_ID = 'CD03218'
		AND INTG_CD_VAL_CTNT = A4.IAS_RGN_CD) IAS_RGN_CD
      ,A1.RLANE_CD
      ,A1.DIR_CD
      ,DECODE(A4.HUL_BND_CD, 'HH', 'H/H', 'BH', 'B/H') HUL_BND_CD
      ,A3.BSE_MON
#if (${f_chk_week} == 'W')      
      ,A3.BSE_WK
#if (${f_bse_tp_cd} == 'Q')  
      ,A3.SLS_YRMON
#end
#end
#if (${f_chk_vvd} == 'V' )      
      ,A1.VSL_CD||A1.SKD_VOY_NO||A1.SKD_DIR_CD AS VVD
#end
      ,A3.TOT_BSA_CAPA
#if (${f_ofc_lvl} == '02')   
      ,A1.RHQ_CD
#elseif (${f_ofc_lvl} == '03') 
      ,A1.RHQ_CD
      ,A1.RGN_OFC_CD
#end
#if (${f_chk_pair} == 'Y')
      ,A1.POL_CD
      ,A1.POD_CD
      ,DECODE(NVL(A2.SQM_MN_SCTR_FLG, 'N'), 'Y', 'Main', 'N', 'Sector') SQM_MN_SCTR_FLG
#end
      ,SUM(A1.LOD_QTY) AS LOD_QTY
      ,DECODE(SUM(A1.LOD_QTY),0,0, SUM(A1.LOD_QTY * A1.GRS_RPB_REV)/SUM(A1.LOD_QTY)) AS REV_RPB
      ,SUM(A1.LOD_QTY * A1.GRS_RPB_REV) AS GRS_REV
      ,SUM(A1.PA_CM_UC_AMT * A1.LOD_QTY) PA_CM_COST
      ,SUM(A1.RA_CM_UC_AMT * A1.LOD_QTY) RA_CM_COST
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.PA_CM_UC_AMT * A1.LOD_QTY) / SUM(A1.LOD_QTY))) AS PA_CMCB
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.RA_CM_UC_AMT * A1.LOD_QTY) / SUM(A1.LOD_QTY))) AS RA_CMCB
      ,SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.PA_CM_UC_AMT * A1.LOD_QTY) AS PA_CM
      ,SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.RA_CM_UC_AMT * A1.LOD_QTY) AS RA_CM
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.PA_CM_UC_AMT*A1.LOD_QTY))/SUM(A1.LOD_QTY)) AS PA_CMPB
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.RA_CM_UC_AMT*A1.LOD_QTY))/SUM(A1.LOD_QTY)) AS RA_CMPB 
FROM SQM_SCTR_CFM_QTA A1
#if (${f_chk_pair} == 'Y')
     ,SQM_SCTR_PAIR_MGMT A2
#end
     ,(SELECT BSE_TP_CD
              ,BSE_YR
              ,BSE_QTR_CD
              ,TRD_CD
              ,RLANE_CD
              ,DIR_CD
              ,VSL_CD
              ,SKD_VOY_NO
              ,SKD_DIR_CD
#if(${f_chk_week} == 'W' && ${f_chk_vvd} == 'V')
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, BSE_WK, VSL_CD || SKD_VOY_NO || SKD_DIR_CD) AS TOT_BSA_CAPA
#elseif (${f_chk_week} == 'W')
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, BSE_WK) AS TOT_BSA_CAPA
#elseif (${f_chk_vvd} == 'V')
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, VSL_CD || SKD_VOY_NO || SKD_DIR_CD) AS TOT_BSA_CAPA
#else
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON) AS TOT_BSA_CAPA
#end
              ,BSE_MON
              ,SUB_TRD_CD
#if(${f_chk_week} != 'W')
              ,'' AS BSE_WK
#else
              ,BSE_WK
#end
              ,MIN(SLS_YRMON) OVER (PARTITION BY BSE_TP_CD, BSE_YR, BSE_QTR_CD, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, BSE_WK) AS SLS_YRMON
        FROM SQM_CFM_TGT_VVD
        WHERE 1=1
        AND SUBSTR(QTA_RLSE_VER_NO, -2) = '02'
        AND BSE_TP_CD = 'Q'
        AND BSE_YR = @[f_bse_yr]
        AND BSE_QTR_CD = DECODE('Q', 'Y', '00', '1Q')
        AND TRD_CD       = 'IAS'
#if (${f_sub_trd_cd} != '' && ${f_sub_trd_cd} != 'All')
        AND SUB_TRD_CD = @[f_sub_trd_cd]
#end
#if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')
        AND RLANE_CD   = @[f_rlane_cd]
#end
#if (${chk_week} == 'W')
#if (${f_fm_wk} != '' && ${f_to_wk} != '')
        AND BSE_WK BETWEEN ${f_fm_wk} AND ${f_to_wk}
#end
#else 
#if (${f_fm_mon} != '' && ${f_to_mon} != '')
        AND BSE_MON BETWEEN ${f_fm_mon} AND ${f_to_mon}
#end
#end
#if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')
        AND DIR_CD     = @[f_dir_cd]
#end
        ) A3
        ,MAS_LANE_RGST A4

WHERE 1=1
AND A1.QTA_RLSE_VER_NO = DECODE('Q', 'Y', SUBSTR(@[f_bse_yr], 3)||'0002', SUBSTR(@[f_bse_yr], 3)||'1Q'||'02')
AND A1.BSE_TP_CD = 'Q'
AND A1.BSE_YR = @[f_bse_yr]
AND A1.BSE_QTR_CD = DECODE('Q', 'Y', '00', '1Q')
AND A1.OFC_VW_CD = @[f_ofc_vw_cd]
AND A4.DELT_FLG = 'N'
#if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')
AND A1.RLANE_CD = @[f_rlane_cd]
#end
#if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')
AND A1.DIR_CD   = @[f_dir_cd]
#end
#if (${f_ofc_lvl} != '01' && ${f_rhq_cd} != '' && ${f_rhq_cd} != 'All')
   AND A1.RHQ_CD          = @[f_rhq_cd]
#end
#if (${f_ofc_lvl} == '03' && ${f_rgn_ofc_cd} != '' && ${f_rgn_ofc_cd} != 'All')
   AND A1.RGN_OFC_CD      = @[f_rgn_ofc_cd]
#end
#if (${f_pol_cd} != '' && ${f_pol_cd} != 'All')
AND A1.POL_CD = @[f_pol_cd]
#end
#if (${f_pod_cd} != '' && ${f_pod_cd} != 'All')
AND A1.POD_CD = @[f_pod_cd]
#end
#if (${f_ias_rgn_cd} != '' && ${f_ias_rgn_cd} != 'All')
AND A4.IAS_RGN_CD  = @[f_ias_rgn_cd]
#end
#if (${f_trd_dir} == 'on' && ${f_hul_bnd_cd} != '' && ${f_hul_bnd_cd} != 'All')
AND A4.HUL_BND_CD  = @[f_hul_bnd_cd]
#end
#if (${f_chk_pair} == 'Y')
#if (${f_sqm_mn_sctr_flg} != '' && ${f_sqm_mn_sctr_flg} != 'All')
AND NVL(A2.SQM_MN_SCTR_FLG, 'N') = @[f_sqm_mn_sctr_flg]
#end
AND A1.BSE_TP_CD  = A2.BSE_TP_CD
AND A1.BSE_YR     = A2.BSE_YR
AND A1.BSE_QTR_CD = A2.BSE_QTR_CD
AND A1.RLANE_CD   = A2.RLANE_CD
AND A1.DIR_CD     = A2.DIR_CD
AND A1.PF_GRP_CD  = A2.PF_GRP_CD
AND A1.POL_CD     = A2.POL_CD
AND A1.POD_CD     = A2.POD_CD
#end

AND A1.LOD_QTY   <> 0
AND A1.BSE_TP_CD  = A3.BSE_TP_CD
AND A1.BSE_YR     = A3.BSE_YR
AND A1.BSE_QTR_CD = A3.BSE_QTR_CD
AND A1.SUB_TRD_CD = A3.SUB_TRD_CD
AND A1.RLANE_CD   = A3.RLANE_CD
AND A1.DIR_CD     = A3.DIR_CD
AND A1.VSL_CD     = A3.VSL_CD
AND A1.SKD_VOY_NO = A3.SKD_VOY_NO
AND A1.SKD_DIR_CD = A3.SKD_DIR_CD

AND A1.TRD_CD       = A4.TRD_CD
AND A1.SUB_TRD_CD   = A4.SUB_TRD_CD
AND A1.RLANE_CD     = A4.RLANE_CD
AND A1.DIR_CD       = A4.DIR_CD  
#if(${f_chk_week} == 'W')
AND (A3.BSE_MON != '01' OR TO_NUMBER(A3.BSE_WK) < 40)
#end

GROUP BY A1.BSE_TP_CD
      ,A1.BSE_YR
      ,A1.BSE_QTR_CD
      ,A1.OFC_VW_CD
      ,A1.RLANE_CD
      ,A1.DIR_CD
      ,A3.BSE_MON
      ,A3.TOT_BSA_CAPA
      ,IAS_RGN_CD
      ,A4.HUL_BND_CD
      ,A1.TRD_CD
      ,A1.SUB_TRD_CD
#if (${f_ofc_lvl} == '02')   
      ,A1.RHQ_CD
#elseif (${f_ofc_lvl} == '03') 
      ,A1.RHQ_CD
      ,A1.RGN_OFC_CD
#end
#if (${f_chk_pair} == 'Y')
      ,A1.POL_CD
      ,A1.POD_CD
      ,A1.POL_CALL_SEQ
      ,A1.POD_CALL_SEQ
      ,SQM_MN_SCTR_FLG
#end
#if (${f_chk_vvd} == 'V' )
      ,A1.VSL_CD||A1.SKD_VOY_NO||A1.SKD_DIR_CD
#end
#if (${f_chk_week} == 'W')      
      ,A3.BSE_WK
#if (${f_bse_tp_cd} == 'Q')  
      ,A3.SLS_YRMON
#end
#end

)
UNION ALL
(
SELECT  
      A1.BSE_YR
      ,A1.BSE_QTR_CD
      ,(SELECT INTG_CD_VAL_DP_DESC AS NAME
        FROM COM_INTG_CD_DTL
        WHERE INTG_CD_ID  = 'CD00940'
        AND INTG_CD_VAL_CTNT = A1.OFC_VW_CD) OFC_VW_CD
      ,A1.TRD_CD
      ,A1.SUB_TRD_CD
      ,(SELECT INTG_CD_VAL_DP_DESC
		FROM COM_INTG_CD_DTL
		WHERE INTG_CD_ID = 'CD03218'
		AND INTG_CD_VAL_CTNT = A4.IAS_RGN_CD) IAS_RGN_CD
      ,A1.RLANE_CD
      ,A1.DIR_CD
      ,DECODE(A4.HUL_BND_CD, 'HH', 'H/H', 'BH', 'B/H') HUL_BND_CD
      ,A3.BSE_MON
#if (${f_chk_week} == 'W')      
      ,A3.BSE_WK
#if (${f_bse_tp_cd} == 'Q')  
      ,A3.SLS_YRMON
#end
#end
#if (${f_chk_vvd} == 'V' )      
      ,A1.VSL_CD||A1.SKD_VOY_NO||A1.SKD_DIR_CD AS VVD
#end
      ,A3.TOT_BSA_CAPA
#if (${f_ofc_lvl} == '02')   
      ,A1.RHQ_CD
#elseif (${f_ofc_lvl} == '03') 
      ,A1.RHQ_CD
      ,A1.RGN_OFC_CD
#end
#if (${f_chk_pair} == 'Y')
      ,A1.POL_CD
      ,A1.POD_CD
      ,DECODE(NVL(A2.SQM_MN_SCTR_FLG, 'N'), 'Y', 'Main', 'N', 'Sector') SQM_MN_SCTR_FLG
#end
      ,SUM(A1.LOD_QTY) AS LOD_QTY
      ,DECODE(SUM(A1.LOD_QTY),0,0, SUM(A1.LOD_QTY * A1.GRS_RPB_REV)/SUM(A1.LOD_QTY)) AS REV_RPB
      ,SUM(A1.LOD_QTY * A1.GRS_RPB_REV) AS GRS_REV
      ,SUM(A1.PA_CM_UC_AMT * A1.LOD_QTY) PA_CM_COST
      ,SUM(A1.RA_CM_UC_AMT * A1.LOD_QTY) RA_CM_COST
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.PA_CM_UC_AMT * A1.LOD_QTY) / SUM(A1.LOD_QTY))) AS PA_CMCB
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.RA_CM_UC_AMT * A1.LOD_QTY) / SUM(A1.LOD_QTY))) AS RA_CMCB
      ,SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.PA_CM_UC_AMT * A1.LOD_QTY) AS PA_CM
      ,SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.RA_CM_UC_AMT * A1.LOD_QTY) AS RA_CM
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.PA_CM_UC_AMT*A1.LOD_QTY))/SUM(A1.LOD_QTY)) AS PA_CMPB
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.RA_CM_UC_AMT*A1.LOD_QTY))/SUM(A1.LOD_QTY)) AS RA_CMPB 
FROM SQM_SCTR_CFM_QTA A1
#if (${f_chk_pair} == 'Y')
     ,SQM_SCTR_PAIR_MGMT A2
#end
     ,(SELECT BSE_TP_CD
              ,BSE_YR
              ,BSE_QTR_CD
              ,TRD_CD
              ,RLANE_CD
              ,DIR_CD
              ,VSL_CD
              ,SKD_VOY_NO
              ,SKD_DIR_CD
#if(${f_chk_week} == 'W' && ${f_chk_vvd} == 'V')
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, BSE_WK, VSL_CD || SKD_VOY_NO || SKD_DIR_CD) AS TOT_BSA_CAPA
#elseif (${f_chk_week} == 'W')
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, BSE_WK) AS TOT_BSA_CAPA
#elseif (${f_chk_vvd} == 'V')
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, VSL_CD || SKD_VOY_NO || SKD_DIR_CD) AS TOT_BSA_CAPA
#else
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON) AS TOT_BSA_CAPA
#end
              ,BSE_MON
              ,SUB_TRD_CD
#if(${f_chk_week} != 'W')
              ,'' AS BSE_WK
#else
              ,BSE_WK
#end
              ,MIN(SLS_YRMON) OVER (PARTITION BY BSE_TP_CD, BSE_YR, BSE_QTR_CD, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, BSE_WK) AS SLS_YRMON
        FROM SQM_CFM_TGT_VVD
        WHERE 1=1
        AND SUBSTR(QTA_RLSE_VER_NO, -2) = '02'
        AND BSE_TP_CD = 'Q'
        AND BSE_YR = @[f_bse_yr]
        AND BSE_QTR_CD = DECODE('Q', 'Y', '00', '2Q')
        AND TRD_CD       = 'IAS'
#if (${f_sub_trd_cd} != '' && ${f_sub_trd_cd} != 'All')
        AND SUB_TRD_CD = @[f_sub_trd_cd]
#end
#if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')
        AND RLANE_CD   = @[f_rlane_cd]
#end
#if (${chk_week} == 'W')
#if (${f_fm_wk} != '' && ${f_to_wk} != '')
        AND BSE_WK BETWEEN ${f_fm_wk} AND ${f_to_wk}
#end
#else 
#if (${f_fm_mon} != '' && ${f_to_mon} != '')
        AND BSE_MON BETWEEN ${f_fm_mon} AND ${f_to_mon}
#end
#end
#if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')
        AND DIR_CD     = @[f_dir_cd]
#end
        ) A3
        ,MAS_LANE_RGST A4

WHERE 1=1
AND A1.QTA_RLSE_VER_NO = DECODE('Q', 'Y', SUBSTR(@[f_bse_yr], 3)||'0002', SUBSTR(@[f_bse_yr], 3)||'2Q'||'02')
AND A1.BSE_TP_CD = 'Q'
AND A1.BSE_YR = @[f_bse_yr]
AND A1.BSE_QTR_CD = DECODE('Q', 'Y', '00', '2Q')
AND A1.OFC_VW_CD = @[f_ofc_vw_cd]
AND A4.DELT_FLG = 'N'
#if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')
AND A1.RLANE_CD = @[f_rlane_cd]
#end
#if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')
AND A1.DIR_CD   = @[f_dir_cd]
#end
#if (${f_ofc_lvl} != '01' && ${f_rhq_cd} != '' && ${f_rhq_cd} != 'All')
   AND A1.RHQ_CD          = @[f_rhq_cd]
#end
#if (${f_ofc_lvl} == '03' && ${f_rgn_ofc_cd} != '' && ${f_rgn_ofc_cd} != 'All')
   AND A1.RGN_OFC_CD      = @[f_rgn_ofc_cd]
#end
#if (${f_pol_cd} != '' && ${f_pol_cd} != 'All')
AND A1.POL_CD = @[f_pol_cd]
#end
#if (${f_pod_cd} != '' && ${f_pod_cd} != 'All')
AND A1.POD_CD = @[f_pod_cd]
#end
#if (${f_ias_rgn_cd} != '' && ${f_ias_rgn_cd} != 'All')
AND A4.IAS_RGN_CD  = @[f_ias_rgn_cd]
#end
#if (${f_trd_dir} == 'on' && ${f_hul_bnd_cd} != '' && ${f_hul_bnd_cd} != 'All')
AND A4.HUL_BND_CD  = @[f_hul_bnd_cd]
#end
#if (${f_chk_pair} == 'Y')
#if (${f_sqm_mn_sctr_flg} != '' && ${f_sqm_mn_sctr_flg} != 'All')
AND NVL(A2.SQM_MN_SCTR_FLG, 'N') = @[f_sqm_mn_sctr_flg]
#end
AND A1.BSE_TP_CD  = A2.BSE_TP_CD
AND A1.BSE_YR     = A2.BSE_YR
AND A1.BSE_QTR_CD = A2.BSE_QTR_CD
AND A1.RLANE_CD   = A2.RLANE_CD
AND A1.DIR_CD     = A2.DIR_CD
AND A1.PF_GRP_CD  = A2.PF_GRP_CD
AND A1.POL_CD     = A2.POL_CD
AND A1.POD_CD     = A2.POD_CD
#end

AND A1.LOD_QTY   <> 0
AND A1.BSE_TP_CD  = A3.BSE_TP_CD
AND A1.BSE_YR     = A3.BSE_YR
AND A1.BSE_QTR_CD = A3.BSE_QTR_CD
AND A1.SUB_TRD_CD = A3.SUB_TRD_CD
AND A1.RLANE_CD   = A3.RLANE_CD
AND A1.DIR_CD     = A3.DIR_CD
AND A1.VSL_CD     = A3.VSL_CD
AND A1.SKD_VOY_NO = A3.SKD_VOY_NO
AND A1.SKD_DIR_CD = A3.SKD_DIR_CD

AND A1.TRD_CD       = A4.TRD_CD
AND A1.SUB_TRD_CD   = A4.SUB_TRD_CD
AND A1.RLANE_CD     = A4.RLANE_CD
AND A1.DIR_CD       = A4.DIR_CD  

GROUP BY A1.BSE_TP_CD
      ,A1.BSE_YR
      ,A1.BSE_QTR_CD
      ,A1.OFC_VW_CD
      ,A1.RLANE_CD
      ,A1.DIR_CD
      ,A3.BSE_MON
      ,A3.TOT_BSA_CAPA
      ,IAS_RGN_CD
      ,A4.HUL_BND_CD
      ,A1.TRD_CD
      ,A1.SUB_TRD_CD
#if (${f_ofc_lvl} == '02')   
      ,A1.RHQ_CD
#elseif (${f_ofc_lvl} == '03') 
      ,A1.RHQ_CD
      ,A1.RGN_OFC_CD
#end
#if (${f_chk_pair} == 'Y')
      ,A1.POL_CD
      ,A1.POD_CD
      ,A1.POL_CALL_SEQ
      ,A1.POD_CALL_SEQ
      ,SQM_MN_SCTR_FLG
#end
#if (${f_chk_vvd} == 'V' )
      ,A1.VSL_CD||A1.SKD_VOY_NO||A1.SKD_DIR_CD
#end
#if (${f_chk_week} == 'W')      
      ,A3.BSE_WK
#if (${f_bse_tp_cd} == 'Q')  
      ,A3.SLS_YRMON
#end
#end
)
UNION ALL
(
SELECT  
      A1.BSE_YR
      ,A1.BSE_QTR_CD
      ,(SELECT INTG_CD_VAL_DP_DESC AS NAME
        FROM COM_INTG_CD_DTL
        WHERE INTG_CD_ID  = 'CD00940'
        AND INTG_CD_VAL_CTNT = A1.OFC_VW_CD) OFC_VW_CD
      ,A1.TRD_CD
      ,A1.SUB_TRD_CD
      ,(SELECT INTG_CD_VAL_DP_DESC
		FROM COM_INTG_CD_DTL
		WHERE INTG_CD_ID = 'CD03218'
		AND INTG_CD_VAL_CTNT = A4.IAS_RGN_CD) IAS_RGN_CD
      ,A1.RLANE_CD
      ,A1.DIR_CD
      ,DECODE(A4.HUL_BND_CD, 'HH', 'H/H', 'BH', 'B/H') HUL_BND_CD
      ,A3.BSE_MON
#if (${f_chk_week} == 'W')      
      ,A3.BSE_WK
#if (${f_bse_tp_cd} == 'Q')  
      ,A3.SLS_YRMON
#end
#end
#if (${f_chk_vvd} == 'V' )      
      ,A1.VSL_CD||A1.SKD_VOY_NO||A1.SKD_DIR_CD AS VVD
#end
      ,A3.TOT_BSA_CAPA
#if (${f_ofc_lvl} == '02')   
      ,A1.RHQ_CD
#elseif (${f_ofc_lvl} == '03') 
      ,A1.RHQ_CD
      ,A1.RGN_OFC_CD
#end
#if (${f_chk_pair} == 'Y')
      ,A1.POL_CD
      ,A1.POD_CD
      ,DECODE(NVL(A2.SQM_MN_SCTR_FLG, 'N'), 'Y', 'Main', 'N', 'Sector') SQM_MN_SCTR_FLG
#end
      ,SUM(A1.LOD_QTY) AS LOD_QTY
      ,DECODE(SUM(A1.LOD_QTY),0,0, SUM(A1.LOD_QTY * A1.GRS_RPB_REV)/SUM(A1.LOD_QTY)) AS REV_RPB
      ,SUM(A1.LOD_QTY * A1.GRS_RPB_REV) AS GRS_REV
      ,SUM(A1.PA_CM_UC_AMT * A1.LOD_QTY) PA_CM_COST
      ,SUM(A1.RA_CM_UC_AMT * A1.LOD_QTY) RA_CM_COST
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.PA_CM_UC_AMT * A1.LOD_QTY) / SUM(A1.LOD_QTY))) AS PA_CMCB
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.RA_CM_UC_AMT * A1.LOD_QTY) / SUM(A1.LOD_QTY))) AS RA_CMCB
      ,SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.PA_CM_UC_AMT * A1.LOD_QTY) AS PA_CM
      ,SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.RA_CM_UC_AMT * A1.LOD_QTY) AS RA_CM
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.PA_CM_UC_AMT*A1.LOD_QTY))/SUM(A1.LOD_QTY)) AS PA_CMPB
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.RA_CM_UC_AMT*A1.LOD_QTY))/SUM(A1.LOD_QTY)) AS RA_CMPB 
FROM SQM_SCTR_CFM_QTA A1
#if (${f_chk_pair} == 'Y')
     ,SQM_SCTR_PAIR_MGMT A2
#end
     ,(SELECT BSE_TP_CD
              ,BSE_YR
              ,BSE_QTR_CD
              ,TRD_CD
              ,RLANE_CD
              ,DIR_CD
              ,VSL_CD
              ,SKD_VOY_NO
              ,SKD_DIR_CD
#if(${f_chk_week} == 'W' && ${f_chk_vvd} == 'V')
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, BSE_WK, VSL_CD || SKD_VOY_NO || SKD_DIR_CD) AS TOT_BSA_CAPA
#elseif (${f_chk_week} == 'W')
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, BSE_WK) AS TOT_BSA_CAPA
#elseif (${f_chk_vvd} == 'V')
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, VSL_CD || SKD_VOY_NO || SKD_DIR_CD) AS TOT_BSA_CAPA
#else
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON) AS TOT_BSA_CAPA
#end
              ,BSE_MON
              ,SUB_TRD_CD
#if(${f_chk_week} != 'W')
              ,'' AS BSE_WK
#else
              ,BSE_WK
#end
              ,MIN(SLS_YRMON) OVER (PARTITION BY BSE_TP_CD, BSE_YR, BSE_QTR_CD, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, BSE_WK) AS SLS_YRMON
        FROM SQM_CFM_TGT_VVD
        WHERE 1=1
        AND SUBSTR(QTA_RLSE_VER_NO, -2) = '02'
        AND BSE_TP_CD = 'Q'
        AND BSE_YR = @[f_bse_yr]
        AND BSE_QTR_CD = DECODE('Q', 'Y', '00', '3Q')
        AND TRD_CD       = 'IAS'
#if (${f_sub_trd_cd} != '' && ${f_sub_trd_cd} != 'All')
        AND SUB_TRD_CD = @[f_sub_trd_cd]
#end
#if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')
        AND RLANE_CD   = @[f_rlane_cd]
#end
#if (${chk_week} == 'W')
#if (${f_fm_wk} != '' && ${f_to_wk} != '')
        AND BSE_WK BETWEEN ${f_fm_wk} AND ${f_to_wk}
#end
#else 
#if (${f_fm_mon} != '' && ${f_to_mon} != '')
        AND BSE_MON BETWEEN ${f_fm_mon} AND ${f_to_mon}
#end
#end
#if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')
        AND DIR_CD     = @[f_dir_cd]
#end
        ) A3
        ,MAS_LANE_RGST A4

WHERE 1=1
AND A1.QTA_RLSE_VER_NO = DECODE('Q', 'Y', SUBSTR(@[f_bse_yr], 3)||'0002', SUBSTR(@[f_bse_yr], 3)||'3Q'||'02')
AND A1.BSE_TP_CD = 'Q'
AND A1.BSE_YR = @[f_bse_yr]
AND A1.BSE_QTR_CD = DECODE('Q', 'Y', '00', '3Q')
AND A1.OFC_VW_CD = @[f_ofc_vw_cd]
AND A4.DELT_FLG = 'N'
#if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')
AND A1.RLANE_CD = @[f_rlane_cd]
#end
#if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')
AND A1.DIR_CD   = @[f_dir_cd]
#end
#if (${f_ofc_lvl} != '01' && ${f_rhq_cd} != '' && ${f_rhq_cd} != 'All')
   AND A1.RHQ_CD          = @[f_rhq_cd]
#end
#if (${f_ofc_lvl} == '03' && ${f_rgn_ofc_cd} != '' && ${f_rgn_ofc_cd} != 'All')
   AND A1.RGN_OFC_CD      = @[f_rgn_ofc_cd]
#end
#if (${f_pol_cd} != '' && ${f_pol_cd} != 'All')
AND A1.POL_CD = @[f_pol_cd]
#end
#if (${f_pod_cd} != '' && ${f_pod_cd} != 'All')
AND A1.POD_CD = @[f_pod_cd]
#end
#if (${f_ias_rgn_cd} != '' && ${f_ias_rgn_cd} != 'All')
AND A4.IAS_RGN_CD  = @[f_ias_rgn_cd]
#end
#if (${f_trd_dir} == 'on' && ${f_hul_bnd_cd} != '' && ${f_hul_bnd_cd} != 'All')
AND A4.HUL_BND_CD  = @[f_hul_bnd_cd]
#end
#if (${f_chk_pair} == 'Y')
#if (${f_sqm_mn_sctr_flg} != '' && ${f_sqm_mn_sctr_flg} != 'All')
AND NVL(A2.SQM_MN_SCTR_FLG, 'N') = @[f_sqm_mn_sctr_flg]
#end
AND A1.BSE_TP_CD  = A2.BSE_TP_CD
AND A1.BSE_YR     = A2.BSE_YR
AND A1.BSE_QTR_CD = A2.BSE_QTR_CD
AND A1.RLANE_CD   = A2.RLANE_CD
AND A1.DIR_CD     = A2.DIR_CD
AND A1.PF_GRP_CD  = A2.PF_GRP_CD
AND A1.POL_CD     = A2.POL_CD
AND A1.POD_CD     = A2.POD_CD
#end

AND A1.LOD_QTY   <> 0
AND A1.BSE_TP_CD  = A3.BSE_TP_CD
AND A1.BSE_YR     = A3.BSE_YR
AND A1.BSE_QTR_CD = A3.BSE_QTR_CD
AND A1.SUB_TRD_CD = A3.SUB_TRD_CD
AND A1.RLANE_CD   = A3.RLANE_CD
AND A1.DIR_CD     = A3.DIR_CD
AND A1.VSL_CD     = A3.VSL_CD
AND A1.SKD_VOY_NO = A3.SKD_VOY_NO
AND A1.SKD_DIR_CD = A3.SKD_DIR_CD

AND A1.TRD_CD       = A4.TRD_CD
AND A1.SUB_TRD_CD   = A4.SUB_TRD_CD
AND A1.RLANE_CD     = A4.RLANE_CD
AND A1.DIR_CD       = A4.DIR_CD  

GROUP BY A1.BSE_TP_CD
      ,A1.BSE_YR
      ,A1.BSE_QTR_CD
      ,A1.OFC_VW_CD
      ,A1.RLANE_CD
      ,A1.DIR_CD
      ,A3.BSE_MON
      ,A3.TOT_BSA_CAPA
      ,IAS_RGN_CD
      ,A4.HUL_BND_CD
      ,A1.TRD_CD
      ,A1.SUB_TRD_CD
#if (${f_ofc_lvl} == '02')   
      ,A1.RHQ_CD
#elseif (${f_ofc_lvl} == '03') 
      ,A1.RHQ_CD
      ,A1.RGN_OFC_CD
#end
#if (${f_chk_pair} == 'Y')
      ,A1.POL_CD
      ,A1.POD_CD
      ,A1.POL_CALL_SEQ
      ,A1.POD_CALL_SEQ
      ,SQM_MN_SCTR_FLG
#end
#if (${f_chk_vvd} == 'V' )
      ,A1.VSL_CD||A1.SKD_VOY_NO||A1.SKD_DIR_CD
#end
#if (${f_chk_week} == 'W')      
      ,A3.BSE_WK
#if (${f_bse_tp_cd} == 'Q')  
      ,A3.SLS_YRMON
#end
#end
)
UNION ALL
(
SELECT  
      A1.BSE_YR
      ,A1.BSE_QTR_CD
      ,(SELECT INTG_CD_VAL_DP_DESC AS NAME
        FROM COM_INTG_CD_DTL
        WHERE INTG_CD_ID  = 'CD00940'
        AND INTG_CD_VAL_CTNT = A1.OFC_VW_CD) OFC_VW_CD
      ,A1.TRD_CD
      ,A1.SUB_TRD_CD
      ,(SELECT INTG_CD_VAL_DP_DESC
		FROM COM_INTG_CD_DTL
		WHERE INTG_CD_ID = 'CD03218'
		AND INTG_CD_VAL_CTNT = A4.IAS_RGN_CD) IAS_RGN_CD
      ,A1.RLANE_CD
      ,A1.DIR_CD
      ,DECODE(A4.HUL_BND_CD, 'HH', 'H/H', 'BH', 'B/H') HUL_BND_CD
      ,A3.BSE_MON
#if (${f_chk_week} == 'W')      
      ,A3.BSE_WK
#if (${f_bse_tp_cd} == 'Q')  
      ,A3.SLS_YRMON
#end
#end
#if (${f_chk_vvd} == 'V' )      
      ,A1.VSL_CD||A1.SKD_VOY_NO||A1.SKD_DIR_CD AS VVD
#end
      ,A3.TOT_BSA_CAPA
#if (${f_ofc_lvl} == '02')   
      ,A1.RHQ_CD
#elseif (${f_ofc_lvl} == '03') 
      ,A1.RHQ_CD
      ,A1.RGN_OFC_CD
#end
#if (${f_chk_pair} == 'Y')
      ,A1.POL_CD
      ,A1.POD_CD
      ,DECODE(NVL(A2.SQM_MN_SCTR_FLG, 'N'), 'Y', 'Main', 'N', 'Sector') SQM_MN_SCTR_FLG
#end
      ,SUM(A1.LOD_QTY) AS LOD_QTY
      ,DECODE(SUM(A1.LOD_QTY),0,0, SUM(A1.LOD_QTY * A1.GRS_RPB_REV)/SUM(A1.LOD_QTY)) AS REV_RPB
      ,SUM(A1.LOD_QTY * A1.GRS_RPB_REV) AS GRS_REV
      ,SUM(A1.PA_CM_UC_AMT * A1.LOD_QTY) PA_CM_COST
      ,SUM(A1.RA_CM_UC_AMT * A1.LOD_QTY) RA_CM_COST
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.PA_CM_UC_AMT * A1.LOD_QTY) / SUM(A1.LOD_QTY))) AS PA_CMCB
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.RA_CM_UC_AMT * A1.LOD_QTY) / SUM(A1.LOD_QTY))) AS RA_CMCB
      ,SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.PA_CM_UC_AMT * A1.LOD_QTY) AS PA_CM
      ,SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.RA_CM_UC_AMT * A1.LOD_QTY) AS RA_CM
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.PA_CM_UC_AMT*A1.LOD_QTY))/SUM(A1.LOD_QTY)) AS PA_CMPB
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.RA_CM_UC_AMT*A1.LOD_QTY))/SUM(A1.LOD_QTY)) AS RA_CMPB 
FROM SQM_SCTR_CFM_QTA A1
#if (${f_chk_pair} == 'Y')
     ,SQM_SCTR_PAIR_MGMT A2
#end
     ,(SELECT BSE_TP_CD
              ,BSE_YR
              ,BSE_QTR_CD
              ,TRD_CD
              ,RLANE_CD
              ,DIR_CD
              ,VSL_CD
              ,SKD_VOY_NO
              ,SKD_DIR_CD
#if(${f_chk_week} == 'W' && ${f_chk_vvd} == 'V')
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, BSE_WK, VSL_CD || SKD_VOY_NO || SKD_DIR_CD) AS TOT_BSA_CAPA
#elseif (${f_chk_week} == 'W')
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, BSE_WK) AS TOT_BSA_CAPA
#elseif (${f_chk_vvd} == 'V')
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, VSL_CD || SKD_VOY_NO || SKD_DIR_CD) AS TOT_BSA_CAPA
#else
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON) AS TOT_BSA_CAPA
#end
              ,BSE_MON
              ,SUB_TRD_CD
#if(${f_chk_week} != 'W')
              ,'' AS BSE_WK
#else
              ,BSE_WK
#end
              ,MIN(SLS_YRMON) OVER (PARTITION BY BSE_TP_CD, BSE_YR, BSE_QTR_CD, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, BSE_WK) AS SLS_YRMON
        FROM SQM_CFM_TGT_VVD
        WHERE 1=1
        AND SUBSTR(QTA_RLSE_VER_NO, -2) = '02'
        AND BSE_TP_CD = 'Q'
        AND BSE_YR = @[f_bse_yr]
        AND BSE_QTR_CD = DECODE('Q', 'Y', '00', '4Q')
        AND TRD_CD       = 'IAS'
#if (${f_sub_trd_cd} != '' && ${f_sub_trd_cd} != 'All')
        AND SUB_TRD_CD = @[f_sub_trd_cd]
#end
#if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')
        AND RLANE_CD   = @[f_rlane_cd]
#end
#if (${chk_week} == 'W')
#if (${f_fm_wk} != '' && ${f_to_wk} != '')
        AND BSE_WK BETWEEN ${f_fm_wk} AND ${f_to_wk}
#end
#else 
#if (${f_fm_mon} != '' && ${f_to_mon} != '')
        AND BSE_MON BETWEEN ${f_fm_mon} AND ${f_to_mon}
#end
#end
#if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')
        AND DIR_CD     = @[f_dir_cd]
#end
        ) A3
        ,MAS_LANE_RGST A4

WHERE 1=1
AND A1.QTA_RLSE_VER_NO = DECODE('Q', 'Y', SUBSTR(@[f_bse_yr], 3)||'0002', SUBSTR(@[f_bse_yr], 3)||'4Q'||'02')
AND A1.BSE_TP_CD = 'Q'
AND A1.BSE_YR = @[f_bse_yr]
AND A1.BSE_QTR_CD = DECODE('Q', 'Y', '00', '4Q')
AND A1.OFC_VW_CD = @[f_ofc_vw_cd]
AND A4.DELT_FLG = 'N'
#if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')
AND A1.RLANE_CD = @[f_rlane_cd]
#end
#if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')
AND A1.DIR_CD   = @[f_dir_cd]
#end
#if (${f_ofc_lvl} != '01' && ${f_rhq_cd} != '' && ${f_rhq_cd} != 'All')
   AND A1.RHQ_CD          = @[f_rhq_cd]
#end
#if (${f_ofc_lvl} == '03' && ${f_rgn_ofc_cd} != '' && ${f_rgn_ofc_cd} != 'All')
   AND A1.RGN_OFC_CD      = @[f_rgn_ofc_cd]
#end
#if (${f_pol_cd} != '' && ${f_pol_cd} != 'All')
AND A1.POL_CD = @[f_pol_cd]
#end
#if (${f_pod_cd} != '' && ${f_pod_cd} != 'All')
AND A1.POD_CD = @[f_pod_cd]
#end
#if (${f_ias_rgn_cd} != '' && ${f_ias_rgn_cd} != 'All')
AND A4.IAS_RGN_CD  = @[f_ias_rgn_cd]
#end
#if (${f_trd_dir} == 'on' && ${f_hul_bnd_cd} != '' && ${f_hul_bnd_cd} != 'All')
AND A4.HUL_BND_CD  = @[f_hul_bnd_cd]
#end
#if (${f_chk_pair} == 'Y')
#if (${f_sqm_mn_sctr_flg} != '' && ${f_sqm_mn_sctr_flg} != 'All')
AND NVL(A2.SQM_MN_SCTR_FLG, 'N') = @[f_sqm_mn_sctr_flg]
#end
AND A1.BSE_TP_CD  = A2.BSE_TP_CD
AND A1.BSE_YR     = A2.BSE_YR
AND A1.BSE_QTR_CD = A2.BSE_QTR_CD
AND A1.RLANE_CD   = A2.RLANE_CD
AND A1.DIR_CD     = A2.DIR_CD
AND A1.PF_GRP_CD  = A2.PF_GRP_CD
AND A1.POL_CD     = A2.POL_CD
AND A1.POD_CD     = A2.POD_CD
#end

AND A1.LOD_QTY   <> 0
AND A1.BSE_TP_CD  = A3.BSE_TP_CD
AND A1.BSE_YR     = A3.BSE_YR
AND A1.BSE_QTR_CD = A3.BSE_QTR_CD
AND A1.SUB_TRD_CD = A3.SUB_TRD_CD
AND A1.RLANE_CD   = A3.RLANE_CD
AND A1.DIR_CD     = A3.DIR_CD
AND A1.VSL_CD     = A3.VSL_CD
AND A1.SKD_VOY_NO = A3.SKD_VOY_NO
AND A1.SKD_DIR_CD = A3.SKD_DIR_CD

AND A1.TRD_CD       = A4.TRD_CD
AND A1.SUB_TRD_CD   = A4.SUB_TRD_CD
AND A1.RLANE_CD     = A4.RLANE_CD
AND A1.DIR_CD       = A4.DIR_CD  
#if(${f_chk_week} == 'W')
AND (A3.BSE_MON != '12' OR TO_NUMBER(A3.BSE_WK) > 40)
#end

GROUP BY A1.BSE_TP_CD
      ,A1.BSE_YR
      ,A1.BSE_QTR_CD
      ,A1.OFC_VW_CD
      ,A1.RLANE_CD
      ,A1.DIR_CD
      ,A3.BSE_MON
      ,A3.TOT_BSA_CAPA
      ,IAS_RGN_CD
      ,A4.HUL_BND_CD
      ,A1.TRD_CD
      ,A1.SUB_TRD_CD
#if (${f_ofc_lvl} == '02')   
      ,A1.RHQ_CD
#elseif (${f_ofc_lvl} == '03') 
      ,A1.RHQ_CD
      ,A1.RGN_OFC_CD
#end
#if (${f_chk_pair} == 'Y')
      ,A1.POL_CD
      ,A1.POD_CD
      ,A1.POL_CALL_SEQ
      ,A1.POD_CALL_SEQ
      ,SQM_MN_SCTR_FLG
#end
#if (${f_chk_vvd} == 'V' )
      ,A1.VSL_CD||A1.SKD_VOY_NO||A1.SKD_DIR_CD
#end
#if (${f_chk_week} == 'W')      
      ,A3.BSE_WK
#if (${f_bse_tp_cd} == 'Q')  
      ,A3.SLS_YRMON
#end
#end
)
##UNION ALL
##(
##SELECT  
##      A1.BSE_YR
##      ,A1.BSE_QTR_CD
##      ,(SELECT INTG_CD_VAL_DP_DESC AS NAME
##        FROM COM_INTG_CD_DTL
##        WHERE INTG_CD_ID  = 'CD00940'
##        AND INTG_CD_VAL_CTNT = A1.OFC_VW_CD) OFC_VW_CD
##      ,A1.TRD_CD
##      ,A1.SUB_TRD_CD
##      ,(SELECT INTG_CD_VAL_DP_DESC
##		FROM COM_INTG_CD_DTL
##		WHERE INTG_CD_ID = 'CD03218'
##		AND INTG_CD_VAL_CTNT = A4.IAS_RGN_CD) IAS_RGN_CD
##      ,A1.RLANE_CD
##      ,A1.DIR_CD
##      ,DECODE(A4.HUL_BND_CD, 'HH', 'H/H', 'BH', 'B/H') HUL_BND_CD
##      ,A3.BSE_MON
###if (${f_chk_week} == 'W')      
##      ,A3.BSE_WK
###if (${f_bse_tp_cd} == 'Q')  
##      ,A3.SLS_YRMON
###end
###end
###if (${f_chk_vvd} == 'V' )      
##      ,A1.VSL_CD||A1.SKD_VOY_NO||A1.SKD_DIR_CD AS VVD
###end
##      ,A3.TOT_BSA_CAPA
###if (${f_ofc_lvl} == '02')   
##      ,A1.RHQ_CD
###elseif (${f_ofc_lvl} == '03') 
##      ,A1.RHQ_CD
##      ,A1.RGN_OFC_CD
###end
###if (${f_chk_pair} == 'Y')
##      ,A1.POL_CD
##      ,A1.POD_CD
##      ,DECODE(NVL(A2.SQM_MN_SCTR_FLG, 'N'), 'Y', 'Main', 'N', 'Sector') SQM_MN_SCTR_FLG
###end
##      ,SUM(A1.LOD_QTY) AS LOD_QTY
##      ,DECODE(SUM(A1.LOD_QTY),0,0, SUM(A1.LOD_QTY * A1.GRS_RPB_REV)/SUM(A1.LOD_QTY)) AS REV_RPB
##      ,SUM(A1.LOD_QTY * A1.GRS_RPB_REV) AS GRS_REV
##      ,SUM(A1.PA_CM_UC_AMT * A1.LOD_QTY) PA_CM_COST
##      ,SUM(A1.RA_CM_UC_AMT * A1.LOD_QTY) RA_CM_COST
##      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.PA_CM_UC_AMT * A1.LOD_QTY) / SUM(A1.LOD_QTY))) AS PA_CMCB
##      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.RA_CM_UC_AMT * A1.LOD_QTY) / SUM(A1.LOD_QTY))) AS RA_CMCB
##      ,SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.PA_CM_UC_AMT * A1.LOD_QTY) AS PA_CM
##      ,SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.RA_CM_UC_AMT * A1.LOD_QTY) AS RA_CM
##      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.PA_CM_UC_AMT*A1.LOD_QTY))/SUM(A1.LOD_QTY)) AS PA_CMPB
##      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.RA_CM_UC_AMT*A1.LOD_QTY))/SUM(A1.LOD_QTY)) AS RA_CMPB 
##FROM SQM_SCTR_CFM_QTA A1
###if (${f_chk_pair} == 'Y')
##     ,SQM_SCTR_PAIR_MGMT A2
###end
##     ,(SELECT BSE_TP_CD
##              ,BSE_YR
##              ,BSE_QTR_CD
##              ,TRD_CD
##              ,RLANE_CD
##              ,DIR_CD
##              ,VSL_CD
##              ,SKD_VOY_NO
##              ,SKD_DIR_CD
###if(${f_chk_week} == 'W' && ${f_chk_vvd} == 'V')
##              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, BSE_WK, VSL_CD || SKD_VOY_NO || SKD_DIR_CD) AS TOT_BSA_CAPA
###elseif (${f_chk_week} == 'W')
##              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, BSE_WK) AS TOT_BSA_CAPA
###elseif (${f_chk_vvd} == 'V')
##              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, VSL_CD || SKD_VOY_NO || SKD_DIR_CD) AS TOT_BSA_CAPA
###else
##              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON) AS TOT_BSA_CAPA
###end
##              ,BSE_MON
##              ,SUB_TRD_CD
###if(${f_chk_week} != 'W')
##              ,'' AS BSE_WK
###else
##              ,BSE_WK
###end
##              ,MIN(SLS_YRMON) OVER (PARTITION BY BSE_TP_CD, BSE_YR, BSE_QTR_CD, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, BSE_WK) AS SLS_YRMON
##        FROM SQM_CFM_TGT_VVD
##        WHERE 1=1
##        AND SUBSTR(QTA_RLSE_VER_NO, -2) = '02'
##        AND BSE_TP_CD = 'Q'
##        AND BSE_YR = @[f_bse_yr]
##        AND BSE_QTR_CD = DECODE('Q', 'Y', '00', '4Q')
##        AND TRD_CD       = 'IAS'
###if (${f_sub_trd_cd} != '' && ${f_sub_trd_cd} != 'All')
##        AND SUB_TRD_CD = @[f_sub_trd_cd]
###end
###if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')
##        AND RLANE_CD   = @[f_rlane_cd]
###end
###if (${chk_week} == 'W')
###if (${f_fm_wk} != '' && ${f_to_wk} != '')
##        AND BSE_WK BETWEEN ${f_fm_wk} AND ${f_to_wk}
###end
###else 
###if (${f_fm_mon} != '' && ${f_to_mon} != '')
##        AND BSE_MON BETWEEN ${f_fm_mon} AND ${f_to_mon}
###end
###end
###if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')
##        AND DIR_CD     = @[f_dir_cd]
###end
##        ) A3
##        ,MAS_LANE_RGST A4
##
##WHERE 1=1
##AND A1.QTA_RLSE_VER_NO = DECODE('Q', 'Y', SUBSTR(@[f_bse_yr], 3)||'0002', SUBSTR(@[f_bse_yr], 3)||'4Q'||'02')
##AND A1.BSE_TP_CD = 'Q'
##AND A1.BSE_YR = @[f_bse_yr]
##AND A1.BSE_QTR_CD = DECODE('Q', 'Y', '00', '4Q')
##AND A1.OFC_VW_CD = @[f_ofc_vw_cd]
##AND A4.DELT_FLG = 'N'
###if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')
##AND A1.RLANE_CD = @[f_rlane_cd]
###end
###if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')
##AND A1.DIR_CD   = @[f_dir_cd]
###end
###if (${f_ofc_lvl} != '01' && ${f_rhq_cd} != '' && ${f_rhq_cd} != 'All')
##   AND A1.RHQ_CD          = @[f_rhq_cd]
###end
###if (${f_ofc_lvl} == '03' && ${f_rgn_ofc_cd} != '' && ${f_rgn_ofc_cd} != 'All')
##   AND A1.RGN_OFC_CD      = @[f_rgn_ofc_cd]
###end
###if (${f_pol_cd} != '' && ${f_pol_cd} != 'All')
##AND A1.POL_CD = @[f_pol_cd]
###end
###if (${f_pod_cd} != '' && ${f_pod_cd} != 'All')
##AND A1.POD_CD = @[f_pod_cd]
###end
###if (${f_ias_rgn_cd} != '' && ${f_ias_rgn_cd} != 'All')
##AND A4.IAS_RGN_CD  = @[f_ias_rgn_cd]
###end
###if (${f_trd_dir} == 'on' && ${f_hul_bnd_cd} != '' && ${f_hul_bnd_cd} != 'All')
##AND A4.HUL_BND_CD  = @[f_hul_bnd_cd]
###end
###if (${f_chk_pair} == 'Y')
###if (${f_sqm_mn_sctr_flg} != '' && ${f_sqm_mn_sctr_flg} != 'All')
##AND NVL(A2.SQM_MN_SCTR_FLG, 'N') = @[f_sqm_mn_sctr_flg]
###end
##AND A1.BSE_TP_CD  = A2.BSE_TP_CD
##AND A1.BSE_YR     = A2.BSE_YR
##AND A1.BSE_QTR_CD = A2.BSE_QTR_CD
##AND A1.RLANE_CD   = A2.RLANE_CD
##AND A1.DIR_CD     = A2.DIR_CD
##AND A1.PF_GRP_CD  = A2.PF_GRP_CD
##AND A1.POL_CD     = A2.POL_CD
##AND A1.POD_CD     = A2.POD_CD
###end
##
##AND A1.BSE_TP_CD  = A3.BSE_TP_CD
##AND A1.BSE_YR     = A3.BSE_YR
##AND A1.BSE_QTR_CD = A3.BSE_QTR_CD
##AND A1.SUB_TRD_CD = A3.SUB_TRD_CD
##AND A1.RLANE_CD   = A3.RLANE_CD
##AND A1.DIR_CD     = A3.DIR_CD
##AND A1.VSL_CD     = A3.VSL_CD
##AND A1.SKD_VOY_NO = A3.SKD_VOY_NO
##AND A1.SKD_DIR_CD = A3.SKD_DIR_CD
##
##AND A1.TRD_CD       = A4.TRD_CD
##AND A1.SUB_TRD_CD   = A4.SUB_TRD_CD
##AND A1.RLANE_CD     = A4.RLANE_CD
##AND A1.DIR_CD       = A4.DIR_CD  
##AND A3.BSE_MON != '12' 
###if(${f_chk_week} == 'W')
##AND TO_NUMBER(A3.BSE_WK) < 40
###end
##
##GROUP BY A1.BSE_TP_CD
##      ,A1.BSE_YR
##      ,A1.BSE_QTR_CD
##      ,A1.OFC_VW_CD
##      ,A1.RLANE_CD
##      ,A1.DIR_CD
##      ,A3.BSE_MON
##      ,A3.TOT_BSA_CAPA
##      ,IAS_RGN_CD
##      ,A4.HUL_BND_CD
##      ,A1.TRD_CD
##      ,A1.SUB_TRD_CD
###if (${f_ofc_lvl} == '02')   
##      ,A1.RHQ_CD
###elseif (${f_ofc_lvl} == '03') 
##      ,A1.RHQ_CD
##      ,A1.RGN_OFC_CD
###end
###if (${f_chk_pair} == 'Y')
##      ,A1.POL_CD
##      ,A1.POD_CD
##      ,A1.POL_CALL_SEQ
##      ,A1.POD_CALL_SEQ
##      ,SQM_MN_SCTR_FLG
###end
###if (${f_chk_vvd} == 'V' )
##      ,A1.VSL_CD||A1.SKD_VOY_NO||A1.SKD_DIR_CD
###end
###if (${f_chk_week} == 'W')      
##      ,A3.BSE_WK
###if (${f_bse_tp_cd} == 'Q')  
##      ,A3.SLS_YRMON
###end
###end
##)
UNION ALL
(
SELECT  
      A1.BSE_YR
	  ,DECODE(A1.BSE_QTR_CD, '00', 'Y', A1.BSE_QTR_CD) BSE_QTR_CD
#if (${f_bse_tp_cd} == 'Q')
      ,A1.BSE_QTR_CD
#end
      ,(SELECT INTG_CD_VAL_DP_DESC AS NAME
        FROM COM_INTG_CD_DTL
        WHERE INTG_CD_ID  = 'CD00940'
        AND INTG_CD_VAL_CTNT = A1.OFC_VW_CD) OFC_VW_CD
      ,A1.TRD_CD
      ,A1.SUB_TRD_CD
      ,(SELECT INTG_CD_VAL_DP_DESC
		FROM COM_INTG_CD_DTL
		WHERE INTG_CD_ID = 'CD03218'
		AND INTG_CD_VAL_CTNT = A4.IAS_RGN_CD) IAS_RGN_CD
      ,A1.RLANE_CD
      ,A1.DIR_CD
      ,DECODE(A4.HUL_BND_CD, 'HH', 'H/H', 'BH', 'B/H') HUL_BND_CD
      ,A3.BSE_MON
#if (${f_chk_week} == 'W')      
      ,A3.BSE_WK
#if (${f_bse_tp_cd} == 'Q')  
      ,A3.SLS_YRMON
#end
#end
#if (${f_chk_vvd} == 'V' )      
      ,A1.VSL_CD||A1.SKD_VOY_NO||A1.SKD_DIR_CD AS VVD
#end
      ,A3.TOT_BSA_CAPA
#if (${f_ofc_lvl} == '02')   
      ,A1.RHQ_CD
#elseif (${f_ofc_lvl} == '03') 
      ,A1.RHQ_CD
      ,A1.RGN_OFC_CD
#end
#if (${f_chk_pair} == 'Y')
      ,A1.POL_CD
      ,A1.POD_CD
      ,DECODE(NVL(A2.SQM_MN_SCTR_FLG, 'N'), 'Y', 'Main', 'N', 'Sector') SQM_MN_SCTR_FLG
#end
      ,SUM(A1.LOD_QTY) AS LOD_QTY
      ,DECODE(SUM(A1.LOD_QTY),0,0, SUM(A1.LOD_QTY * A1.GRS_RPB_REV)/SUM(A1.LOD_QTY)) AS REV_RPB
      ,SUM(A1.LOD_QTY * A1.GRS_RPB_REV) AS GRS_REV
      ,SUM(A1.PA_CM_UC_AMT * A1.LOD_QTY) PA_CM_COST
      ,SUM(A1.RA_CM_UC_AMT * A1.LOD_QTY) RA_CM_COST
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.PA_CM_UC_AMT * A1.LOD_QTY) / SUM(A1.LOD_QTY))) AS PA_CMCB
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.RA_CM_UC_AMT * A1.LOD_QTY) / SUM(A1.LOD_QTY))) AS RA_CMCB
      ,SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.PA_CM_UC_AMT * A1.LOD_QTY) AS PA_CM
      ,SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.RA_CM_UC_AMT * A1.LOD_QTY) AS RA_CM
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.PA_CM_UC_AMT*A1.LOD_QTY))/SUM(A1.LOD_QTY)) AS PA_CMPB
      ,DECODE(SUM(A1.LOD_QTY),0,0, (SUM(A1.LOD_QTY * A1.GRS_RPB_REV) - SUM(A1.RA_CM_UC_AMT*A1.LOD_QTY))/SUM(A1.LOD_QTY)) AS RA_CMPB 
FROM SQM_SCTR_CFM_QTA A1
#if (${f_chk_pair} == 'Y')
     ,SQM_SCTR_PAIR_MGMT A2
#end
     ,(SELECT BSE_TP_CD
              ,BSE_YR
              ,BSE_QTR_CD
              ,TRD_CD
              ,RLANE_CD
              ,DIR_CD
              ,VSL_CD
              ,SKD_VOY_NO
              ,SKD_DIR_CD
#if(${f_chk_week} == 'W' && ${f_chk_vvd} == 'V')
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, BSE_WK, VSL_CD || SKD_VOY_NO || SKD_DIR_CD) AS TOT_BSA_CAPA
#elseif (${f_chk_week} == 'W')
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, BSE_WK) AS TOT_BSA_CAPA
#elseif (${f_chk_vvd} == 'V')
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, VSL_CD || SKD_VOY_NO || SKD_DIR_CD) AS TOT_BSA_CAPA
#else
              ,SUM(FNL_BSA_CAPA) OVER (PARTITION BY BSE_YR, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON) AS TOT_BSA_CAPA
#end
              ,BSE_MON
              ,SUB_TRD_CD
#if(${f_chk_week} != 'W')
              ,'' AS BSE_WK
#else
              ,BSE_WK
#end
              ,MIN(SLS_YRMON) OVER (PARTITION BY BSE_TP_CD, BSE_YR, BSE_QTR_CD, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, BSE_MON, BSE_WK) AS SLS_YRMON
        FROM SQM_CFM_TGT_VVD
        WHERE 1=1
        AND SUBSTR(QTA_RLSE_VER_NO, -2) = '02'
        AND BSE_TP_CD = @[f_bse_tp_cd]
        AND BSE_YR = @[f_bse_yr]
        AND BSE_QTR_CD = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])
        AND TRD_CD       = 'IAS'	
	    AND BSE_MON > DECODE((SELECT MAX(SUBSTR(QTA_RLSE_VER_NO,3,1)) FROM SQM_CFM_TGT_VVD WHERE BSE_TP_CD = 'Q' AND BSE_YR = @[f_bse_yr]),1,3,2,6,3,9,4,12)
        AND (BSE_MON != 12 OR BSE_WK > 40)
#if (${f_sub_trd_cd} != '' && ${f_sub_trd_cd} != 'All')
        AND SUB_TRD_CD = @[f_sub_trd_cd]
#end
#if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')
        AND RLANE_CD   = @[f_rlane_cd]
#end
#if (${chk_week} == 'W')
#if (${f_fm_wk} != '' && ${f_to_wk} != '')
        AND BSE_WK BETWEEN ${f_fm_wk} AND ${f_to_wk}
#end
#else 
#if (${f_fm_mon} != '' && ${f_to_mon} != '')
        AND BSE_MON BETWEEN ${f_fm_mon} AND ${f_to_mon}
#end
#end
#if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')
        AND DIR_CD     = @[f_dir_cd]
#end
        ) A3
        ,MAS_LANE_RGST A4

WHERE 1=1
AND A1.QTA_RLSE_VER_NO = DECODE(@[f_bse_tp_cd], 'Y', SUBSTR(@[f_bse_yr], 3)||'0002', SUBSTR(@[f_bse_yr], 3)||@[f_bse_qtr_cd]||'02')
AND A1.BSE_TP_CD = @[f_bse_tp_cd]
AND A1.BSE_YR = @[f_bse_yr]
AND A1.BSE_QTR_CD = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])
AND A1.OFC_VW_CD = @[f_ofc_vw_cd]
AND A4.DELT_FLG = 'N'
#if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')
AND A1.RLANE_CD = @[f_rlane_cd]
#end
#if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')
AND A1.DIR_CD   = @[f_dir_cd]
#end
#if (${f_ofc_lvl} != '01' && ${f_rhq_cd} != '' && ${f_rhq_cd} != 'All')
   AND A1.RHQ_CD          = @[f_rhq_cd]
#end
#if (${f_ofc_lvl} == '03' && ${f_rgn_ofc_cd} != '' && ${f_rgn_ofc_cd} != 'All')
   AND A1.RGN_OFC_CD      = @[f_rgn_ofc_cd]
#end
#if (${f_pol_cd} != '' && ${f_pol_cd} != 'All')
AND A1.POL_CD = @[f_pol_cd]
#end
#if (${f_pod_cd} != '' && ${f_pod_cd} != 'All')
AND A1.POD_CD = @[f_pod_cd]
#end
#if (${f_ias_rgn_cd} != '' && ${f_ias_rgn_cd} != 'All')
AND A4.IAS_RGN_CD  = @[f_ias_rgn_cd]
#end
#if (${f_trd_dir} == 'on' && ${f_hul_bnd_cd} != '' && ${f_hul_bnd_cd} != 'All')
AND A4.HUL_BND_CD  = @[f_hul_bnd_cd]
#end
#if (${f_chk_pair} == 'Y')
#if (${f_sqm_mn_sctr_flg} != '' && ${f_sqm_mn_sctr_flg} != 'All')
AND NVL(A2.SQM_MN_SCTR_FLG, 'N') = @[f_sqm_mn_sctr_flg]
#end
AND A1.BSE_TP_CD  = A2.BSE_TP_CD
AND A1.BSE_YR     = A2.BSE_YR
AND A1.BSE_QTR_CD = A2.BSE_QTR_CD
AND A1.RLANE_CD   = A2.RLANE_CD
AND A1.DIR_CD     = A2.DIR_CD
AND A1.PF_GRP_CD  = A2.PF_GRP_CD
AND A1.POL_CD     = A2.POL_CD
AND A1.POD_CD     = A2.POD_CD
#end

AND A1.LOD_QTY   <> 0
AND A1.BSE_TP_CD  = A3.BSE_TP_CD
AND A1.BSE_YR     = A3.BSE_YR
AND A1.BSE_QTR_CD = A3.BSE_QTR_CD
AND A1.SUB_TRD_CD = A3.SUB_TRD_CD
AND A1.RLANE_CD   = A3.RLANE_CD
AND A1.DIR_CD     = A3.DIR_CD
AND A1.VSL_CD     = A3.VSL_CD
AND A1.SKD_VOY_NO = A3.SKD_VOY_NO
AND A1.SKD_DIR_CD = A3.SKD_DIR_CD

AND A1.TRD_CD       = A4.TRD_CD
AND A1.SUB_TRD_CD   = A4.SUB_TRD_CD
AND A1.RLANE_CD     = A4.RLANE_CD
AND A1.DIR_CD       = A4.DIR_CD  
#if(${f_chk_week} == 'W')
AND (A3.BSE_MON != '12' OR TO_NUMBER(A3.BSE_WK) > 40)
#end

GROUP BY A1.BSE_TP_CD
      ,A1.BSE_YR
      ,A1.BSE_QTR_CD
      ,A1.OFC_VW_CD
      ,A1.RLANE_CD
      ,A1.DIR_CD
      ,A3.BSE_MON
      ,A3.TOT_BSA_CAPA
      ,IAS_RGN_CD
      ,A4.HUL_BND_CD
      ,A1.TRD_CD
      ,A1.SUB_TRD_CD
#if (${f_ofc_lvl} == '02')   
      ,A1.RHQ_CD
#elseif (${f_ofc_lvl} == '03') 
      ,A1.RHQ_CD
      ,A1.RGN_OFC_CD
#end
#if (${f_chk_pair} == 'Y')
      ,A1.POL_CD
      ,A1.POD_CD
      ,A1.POL_CALL_SEQ
      ,A1.POD_CALL_SEQ
      ,SQM_MN_SCTR_FLG
#end
#if (${f_chk_vvd} == 'V' )
      ,A1.VSL_CD||A1.SKD_VOY_NO||A1.SKD_DIR_CD
#end
#if (${f_chk_week} == 'W')      
      ,A3.BSE_WK
#if (${f_bse_tp_cd} == 'Q')  
      ,A3.SLS_YRMON
#end
#end
)
)
)
)

GROUP BY BSE_YR
,BSE_QTR_CD
,OFC_VW_CD
,RLANE_CD
,DIR_CD
,BSE_MON
,IAS_RGN_CD
,HUL_BND_CD
,TRD_CD
,SUB_TRD_CD
#if (${f_ofc_lvl} == '02')   
,RHQ_CD
#elseif (${f_ofc_lvl} == '03') 
,RHQ_CD
,RGN_OFC_CD
#end
#if (${f_chk_pair} == 'Y')
,POL_CD
,POD_CD
##,POL_CALL_SEQ
##,POD_CALL_SEQ
,SQM_MN_SCTR_FLG
#end
#if (${f_chk_vvd} == 'V' )
,VVD
#end
#if (${f_chk_week} == 'W')      
,BSE_WK
#if (${f_bse_tp_cd} == 'Q')  
,SLS_YRMON
#end
#end
ORDER BY SUB_TRD_CD
, IAS_RGN_CD
, RLANE_CD
, DIR_CD
, BSE_QTR_CD
, BSE_MON
#if (${f_chk_week} == 'W')
#if (${f_bse_tp_cd} == 'Q')  
, NVL(SUBSTR(SLS_YRMON,0,4),BSE_YR)   
#end   
, BSE_WK
#end
#if (${f_chk_vvd} == 'V' )
, VVD
#end
#if (${f_ofc_lvl} == '02')  
, RHQ_CD
#elseif (${f_ofc_lvl} == '03') 
, RHQ_CD, RGN_OFC_CD
#end
#if (${f_chk_pair} == 'Y')
, POL_CD
, POD_CD
#end			]]></sql>
			<params>
				<param name="f_bse_yr" type="12" value="" out="N"/>
				<param name="f_sub_trd_cd" type="12" value="" out="N"/>
				<param name="f_rlane_cd" type="12" value="" out="N"/>
				<param name="f_dir_cd" type="12" value="" out="N"/>
				<param name="f_ofc_vw_cd" type="12" value="" out="N"/>
				<param name="f_rhq_cd" type="12" value="" out="N"/>
				<param name="f_rgn_ofc_cd" type="12" value="" out="N"/>
				<param name="f_pol_cd" type="12" value="" out="N"/>
				<param name="f_pod_cd" type="12" value="" out="N"/>
				<param name="f_ias_rgn_cd" type="12" value="" out="N"/>
				<param name="f_hul_bnd_cd" type="12" value="" out="N"/>
				<param name="f_sqm_mn_sctr_flg" type="12" value="" out="N"/>
				<param name="f_bse_tp_cd" type="12" value="" out="N"/>
				<param name="f_bse_qtr_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
