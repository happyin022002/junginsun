<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SpecialCargoReceiptDBDAOValidateDGSubLabelByUNNoRSQL">
			<desc><![CDATA[UN No에 해당되는 SUB Label이 설정되지 않거나, 맞지 않은 값이 설정되었는지 
여부를 체크한다.]]></desc>
			<sql><![CDATA[
SELECT dg.bkg_no,
       dg.cntr_no,
       dg.imdg_un_no,
       dg.imdg_un_no_seq,
       nvl(dg.imdg_subs_rsk_lbl_cd1, 'N') srl1,
       nvl(dg.imdg_subs_rsk_lbl_cd2, 'N') srl2,
       nvl(dg.imdg_subs_rsk_lbl_cd3, 'N') srl3,
       nvl(dg.imdg_subs_rsk_lbl_cd4, 'N') srl4,
       case when dg.imdg_subs_rsk_lbl_cd1 is null
             and dg.imdg_subs_rsk_lbl_cd2 is null
             and dg.imdg_subs_rsk_lbl_cd3 is null
             and dg.imdg_subs_rsk_lbl_cd4 is null then bhcn.attr_ctnt5||'['||dg.imdg_clss_cd||']'||bhcn.attr_ctnt7
       else bhcn.attr_ctnt6||bhcn.attr_ctnt7
       end w_msg
FROM bkg_dg_cgo dg
     ,bkg_hrd_cdg_ctnt bhcn
WHERE bkg_no = @[bkg_no]
AND BHCN.HRD_CDG_ID = 'DG_SUB_LABEL_CHECK'
AND BHCN.ATTR_CTNT1 = 'Y'
AND nvl(dg.spcl_cgo_apro_cd,'N') <> 'C'
AND (nvl((SELECT IMDG_SUBS_RSK_LBL_CD
          FROM (SELECT ROW_NUMBER() OVER(PARTITION BY IMDG_UN_NO, IMDG_UN_NO_SEQ ORDER BY IMDG_SUBS_RSK_LBL_CD) RNUM,
                       IMDG_UN_NO,
                       IMDG_UN_NO_SEQ,
                       IMDG_SUBS_RSK_LBL_CD
                FROM SCG_IMDG_SUBS_RSK_LBL
                WHERE IMDG_SUBS_RSK_LBL_CD <> 0)
          WHERE IMDG_UN_NO = dg.IMDG_UN_NO
          AND IMDG_UN_NO_SEQ = dg.IMDG_UN_NO_SEQ
          AND rnum = 1),'N') <> nvl(dg.imdg_subs_rsk_lbl_cd1, 'N')
  or nvl((SELECT IMDG_SUBS_RSK_LBL_CD
          FROM (SELECT ROW_NUMBER() OVER(PARTITION BY IMDG_UN_NO, IMDG_UN_NO_SEQ ORDER BY IMDG_SUBS_RSK_LBL_CD) RNUM,
                       IMDG_UN_NO,
                       IMDG_UN_NO_SEQ,
                       IMDG_SUBS_RSK_LBL_CD
                FROM SCG_IMDG_SUBS_RSK_LBL
                WHERE IMDG_SUBS_RSK_LBL_CD <> 0)
          WHERE IMDG_UN_NO = dg.IMDG_UN_NO
          AND IMDG_UN_NO_SEQ = dg.IMDG_UN_NO_SEQ
          AND rnum = 2),'N') <> nvl(dg.imdg_subs_rsk_lbl_cd2, 'N')
  or nvl((SELECT IMDG_SUBS_RSK_LBL_CD
          FROM (SELECT ROW_NUMBER() OVER(PARTITION BY IMDG_UN_NO, IMDG_UN_NO_SEQ ORDER BY IMDG_SUBS_RSK_LBL_CD) RNUM,
                       IMDG_UN_NO,
                       IMDG_UN_NO_SEQ,
                       IMDG_SUBS_RSK_LBL_CD
                FROM SCG_IMDG_SUBS_RSK_LBL
                WHERE IMDG_SUBS_RSK_LBL_CD <> 0)
          WHERE IMDG_UN_NO = dg.IMDG_UN_NO
          AND IMDG_UN_NO_SEQ = dg.IMDG_UN_NO_SEQ
          AND rnum = 3),'N') <> nvl(dg.imdg_subs_rsk_lbl_cd3, 'N')
  or nvl((SELECT IMDG_SUBS_RSK_LBL_CD
          FROM (SELECT ROW_NUMBER() OVER(PARTITION BY IMDG_UN_NO, IMDG_UN_NO_SEQ ORDER BY IMDG_SUBS_RSK_LBL_CD) RNUM,
                       IMDG_UN_NO,
                       IMDG_UN_NO_SEQ,
                       IMDG_SUBS_RSK_LBL_CD
                FROM SCG_IMDG_SUBS_RSK_LBL
                WHERE IMDG_SUBS_RSK_LBL_CD <> 0)
          WHERE IMDG_UN_NO = dg.IMDG_UN_NO
          AND IMDG_UN_NO_SEQ = dg.IMDG_UN_NO_SEQ
          AND rnum = 4),'N') <> nvl(dg.imdg_subs_rsk_lbl_cd4, 'N'))
AND rownum = 1			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
