<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CsScreenDBDAOsearchCntrSoDtlInfoRSQL">
			<desc><![CDATA[고객 응대를 위한 Container별 S/O & W/O 발행 Status 상세 정보를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT SORD.VNDR_SEQ             SP_CODE     -- S/P CODE  
      ,SORD.EQ_NO                CNTR_NO
      ,VD.VNDR_LGL_ENG_NM        SP_NAME   -- S/P NAME 
      ,VD_CNTC.PHN_NO            SP_TEL_NO  -- S/P TEL NO. 
      ,VD_CNTC.FAX_NO            SP_FAX_NO   -- FROM-TO  
      ,(CASE WHEN SUBSTR(SORD.COST_ACT_GRP_CD,2,1) = 'D' THEN 'DOOR'     
          WHEN SUBSTR(SORD.COST_ACT_GRP_CD,3,1) = 'W' THEN 'WATER'   
          WHEN SUBSTR(SORD.COST_ACT_GRP_CD,3,1) = 'R' THEN 'RAIL'   
          WHEN SUBSTR(SORD.COST_ACT_GRP_CD,3,1) = 'T' THEN   
          ( CASE WHEN TRSP_BND_CD = 'T' THEN 'SHUTTLE'   
                 WHEN SUBSTR(FM_NOD_CD,1,5) = SUBSTR(TO_NOD_CD,1,5) AND    
                     (SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD = DECODE(SORD.TRSP_BND_CD,'O',TO_NOD_CD,'I',FM_NOD_CD)) IN ('M','B') THEN   
                      'SHUTTLE'   
                 ELSE 'ADDITIONAL'      
            END)   
         ELSE 'NULL'            
      END ) COST_MODE                    -- COST MODE
   ,CASE WHEN SORD.TRSP_BND_CD = 'O'  
         THEN SORD.FM_NOD_CD||' - ' ||DECODE(NVL(SORD.DOR_NOD_CD, ''), '', '', SORD.DOR_NOD_CD||' - ')||DECODE(NVL(SORD.VIA_NOD_CD, ''), '', '', SORD.VIA_NOD_CD||' - ')||SORD.TO_NOD_CD  
         ELSE SORD.FM_NOD_CD||' - ' ||DECODE(NVL(SORD.VIA_NOD_CD, ''), '', '', SORD.VIA_NOD_CD||' - ')||DECODE(NVL(SORD.DOR_NOD_CD, ''), '', '', SORD.DOR_NOD_CD||' - ')||SORD.TO_NOD_CD  
    END       NOD_CD                     -- FROM-TO                                                      
  ,DECODE(TRSP_SO_STS_CD,'P','SO PLANNED' 
                                ,'C','S/O ISSUE'  
                                ,'I','W/O ISSUE'  
                                ,'EXCUTED')     STS_CD       -- S/O STATUS  
  ,SORD.CRE_OFC_CD                              OFC_CD       -- OFFICE                                 
  ,SORD.CRE_USR_ID                              USR_ID       -- USER ID                             
  ,SORD.TRSP_SO_OFC_CTY_CD||SORD.TRSP_SO_SEQ    SO_NO        -- S/O NO                                 
  ,TO_CHAR(SORD.LOCL_CRE_DT, 'YYYYMMDD HH24:MI:SS')  SO_DATE      -- S/O DATE 
  ,SORD.TRSP_WO_OFC_CTY_CD||SORD.TRSP_WO_SEQ    WO_NO        -- W/O NO                       
  ,TO_CHAR(WORD.LOCL_CRE_DT, 'YYYYMMDD HH24:MI:SS')  WO_DATE      -- W/O DATE    
  ,USR.USR_NM                                   USR_NM
FROM BKG_CONTAINER BCNTR
    ,TRS_TRSP_SVC_ORD  SORD  
    ,TRS_TRSP_WRK_ORD  WORD  
    ,MDM_VENDOR        VD  
    ,MDM_VNDR_CNTC_PNT VD_CNTC  
    ,COM_USER          USR
WHERE BCNTR.BKG_NO            = @[bkg_no]
  AND SORD.BKG_NO             = BCNTR.BKG_NO
  AND SORD.EQ_NO              = BCNTR.CNTR_NO  
  AND SORD.TRSP_BND_CD        = 'I'  
  AND SORD.TRSP_WO_OFC_CTY_CD = WORD.TRSP_WO_OFC_CTY_CD  
  AND SORD.TRSP_WO_SEQ        = WORD.TRSP_WO_SEQ  
  AND SORD.DELT_FLG           = 'N'
  AND VD.VNDR_SEQ(+)          = SORD.VNDR_SEQ
  AND VD.DELT_FLG (+)         = 'N'           
  AND VD_CNTC.VNDR_SEQ(+)     = SORD.VNDR_SEQ
  AND VD_CNTC.PHN_NO      IS NOT NULL            
  AND VD_CNTC.DELT_FLG (+)    = 'N' 
  AND SORD.CRE_USR_ID         = USR.USR_ID (+)
ORDER BY SORD.VNDR_SEQ, SORD.CRE_DT DESC			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
