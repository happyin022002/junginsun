<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCReportDBDAORsltSearchKoreaMOTListRSQL">
			<desc><![CDATA[Korea MOT]]></desc>
			<sql><![CDATA[
SELECT CTRT_TYPE 			AS CTRT_TYPE
     , CTRT_NO 				AS CTRT_NO
     , PROP_NO 				AS PROP_NO
     , AMDT_SEQ				AS AMDT_SEQ
     , CUST_NM 				AS CUST_NM
     , PROP_OFC_CD 			AS PROP_OFC_CD
     , PROP_APRO_OFC_CD 	AS PROP_APRO_OFC_cD
     , CTRT_EFF_DT 			AS CTRT_EFF_DT
     , CTRT_EXP_DT 			AS CTRT_EXP_DT
	 , AMDT_EFF_DT 			AS AMDT_EFF_DT
     , PROP_STS_CD 			AS PROP_STS_CD
     , FILE_APRO_DT 		AS FILE_APRO_DT
     , '' AS DATE_BY
     , '' AS F_EFF_DT
     , '' AS F_EXP_DT
     , '' AS APVL_OFC
     , '' AS F_CTRT_TP
     , '' AS F_CTRT_TP_R
     , '' AS F_CTRT_TP_S
	 , '' AS IBFLAG
  FROM
(SELECT 'RFA'                					    AS CTRT_TYPE
     , RFA_NO                   					AS CTRT_NO
     , MN.PROP_NO               					AS PROP_NO
     , MN.AMDT_SEQ              					AS AMDT_SEQ
     , CUST.CUST_LGL_ENG_NM				 			AS CUST_NM
     , PROP_OFC_CD									AS PROP_OFC_CD
     , PROP_APRO_OFC_CD								AS PROP_APRO_OFC_CD
     , TO_CHAR(DUR.CTRT_EFF_DT, 'YYYY-MM-DD') 		AS CTRT_EFF_DT
     , TO_CHAR(DUR.CTRT_EXP_DT, 'YYYY-MM-DD') 		AS CTRT_EXP_DT
     , TO_CHAR(MN.EFF_DT, 'YYYY-MM-DD')				AS AMDT_EFF_DT
     , DECODE(MN.PROP_STS_CD,'A','Approved')		AS PROP_STS_CD
     , TO_CHAR(PROP_APRO_DT,'YYYY-MM-DD')			AS FILE_APRO_DT
  FROM PRI_RP_HDR HDR
      ,PRI_RP_MN MN
      ,PRI_RP_DUR DUR
      ,MDM_CUSTOMER CUST
      ,COM_INTG_CD_DTL STS_CD
 WHERE MN.PROP_NO = HDR.PROP_NO
   AND MN.PROP_NO = DUR.PROP_NO
   AND MN.AMDT_SEQ = DUR.AMDT_SEQ
   AND CUST.CUST_CNT_CD        = MN.CTRT_CUST_CNT_CD
   AND CUST.CUST_SEQ           = MN.CTRT_CUST_SEQ
   AND CUST.CNTR_DIV_FLG 	   = 'Y' 
   AND STS_CD.INTG_CD_ID = 'CD01722'
   AND STS_CD.INTG_CD_VAL_CTNT = MN.PROP_STS_CD
----------------------------------------------------------------------------------
-- 기본 조건
   AND CTRT_EXP_DT - CTRT_EFF_DT >= 90 -- 계약기간 90일 이상인 것만
   AND MN.PROP_STS_CD = 'A' -- Approved
   AND DUR.PRC_PROG_STS_CD = 'A' --Approved
   AND RFA_CTRT_TP_CD IN ('C', 'S', 'B') -- RFA Type 조건
   AND PROP_OFC_CD IN ('SELSC', 'PUSSC', 'PUSBS') -- R.OFC 조건
----------------------------------------------------------------------------------
-- Date by
#if( ${date_by} != '2')
  AND PROP_APRO_DT BETWEEN TO_DATE(@[f_eff_dt],'YYYY-MM-DD') AND TO_DATE(@[f_exp_dt],'YYYY-MM-DD')+0.99999
#else
  AND MN.EFF_DT              <= TO_DATE(@[f_exp_dt], 'YYYY-MM-DD') -- Effective Date(To)
  AND MN.EXP_DT              >= TO_DATE(@[f_eff_dt], 'YYYY-MM-DD') -- Effective Date(From)
#end

-- Apvl Ofc
#if( ${apvl_ofc} != '' )
  AND PROP_APRO_OFC_CD = @[apvl_ofc]
#end

#if( ${f_ctrt_tp_r} != 'RFA')
  AND 1=2
#end
----------------------------------------------------------------------------------

UNION ALL

SELECT 'SC'													AS CTRT_TYPE
     , SH.SC_NO                   							AS CTRT_NO
     , SM.PROP_NO               							AS PROP_NO
     , SM.AMDT_SEQ              							AS AMDT_SEQ
     , SP.CTRT_PTY_NM	 									AS CUST_NM
     , SM.PROP_OFC_CD 										AS PROP_OFC_CD
     , SM.PROP_APRO_OFC_CD 									AS PROP_APRO_OFC_CD
     , TO_CHAR(DUR.CTRT_EFF_DT, 'YYYY-MM-DD') 				AS CTRT_EFF_DT
     , TO_CHAR(DUR.CTRT_EXP_DT, 'YYYY-MM-DD') 				AS CTRT_EXP_DT
     , TO_CHAR(SM.EFF_DT, 'YYYY-MM-DD')						AS AMDT_EFF_DT
     , DECODE(SM.PROP_STS_CD,'F','Filed')					AS PROP_STS_CD
     , TO_CHAR(SM.FILE_DT, 'YYYY-MM-DD')					AS FILE_APRO_DT
  FROM PRI_SP_MN SM,
       PRI_SP_HDR SH,
       PRI_SP_CTRT_PTY SP,
       PRI_SP_DUR DUR
 WHERE SM.PROP_NO = SH.PROP_NO
   AND SM.PROP_NO = SP.PROP_NO
   AND SM.AMDT_SEQ = SP.AMDT_SEQ
   AND SM.PROP_NO = DUR.PROP_NO
   AND SM.AMDT_SEQ = DUR.AMDT_SEQ
   AND SP.PRC_CTRT_PTY_TP_CD = 'C'
-----------------------------------------------------------------------------
-- 기본 조건
   AND CTRT_EXP_DT - CTRT_EFF_DT >= 90 -- 계약기간 90일 이상인 것만
   AND SM.PROP_STS_CD = 'F' -- Filed
   AND PROP_OFC_CD IN ('SELSC', 'PUSSC', 'PUSBS')  -- R.OFC 조건
-----------------------------------------------------------------------------
-- Date by
#if( ${date_by} != '2')
  AND SM.FILE_DT BETWEEN TO_DATE(@[f_eff_dt],'YYYY-MM-DD') AND TO_DATE(@[f_exp_dt],'YYYY-MM-DD')+0.99999
#else
  AND SM.EFF_DT              <= TO_DATE(@[f_exp_dt], 'YYYY-MM-DD') -- Effective Date(To)
  AND SM.EXP_DT              >= TO_DATE(@[f_eff_dt], 'YYYY-MM-DD') -- Effective Date(From)
#end
-- Apvl Ofc
#if( ${apvl_ofc} != '' )
  AND SM.PROP_APRO_OFC_CD = @[apvl_ofc]
#end

#if( ${f_ctrt_tp_s} != 'SC')
  AND 1=2
#end
)			]]></sql>
			<params>
				<param name="f_eff_dt" type="12" value="" out="N"/>
				<param name="f_exp_dt" type="12" value="" out="N"/>
				<param name="apvl_ofc" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
