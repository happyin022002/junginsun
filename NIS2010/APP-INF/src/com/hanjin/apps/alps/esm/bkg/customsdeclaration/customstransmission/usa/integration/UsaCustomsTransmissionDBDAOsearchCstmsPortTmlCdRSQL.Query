<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UsaCustomsTransmissionDBDAOsearchCstmsPortTmlCdRSQL">
			<desc><![CDATA[UsaCustomsTransmissionDBDAOsearchCstmsPortTmlCdRSQL]]></desc>
			<sql><![CDATA[
SELECT 
	( SELECT ATTR_CTNT2 FROM BKG_CSTMS_CD_CONV_CTNT
	  WHERE CNT_CD='US'
	  AND CSTMS_DIV_ID='AMS_TML_CD_MAP'
	  AND ATTR_CTNT1= YD_CD
	  AND ROWNUM=1
	) AMS_TML_CD
  FROM (
 
    #if (${pre_pod_cd} == 'US')
        SELECT YD_CD
              ,ROW_NUMBER() OVER(ORDER BY CLPT_SEQ) AS RNUM
          FROM VSK_VSL_PORT_SKD
         WHERE 1=1 
           AND VPS_PORT_CD   LIKE 'US%'
           AND VSL_CD        = SUBSTR(@[vvd], 1, 4)
           AND SKD_VOY_NO    = SUBSTR(@[vvd], 5, 4)
           AND SKD_DIR_CD    = SUBSTR(@[vvd], 9, 1)
		   AND VPS_PORT_cD =  @[pod_cd]
  
    #else 
	    #if (${pre_pol_cd} == 'CA')
	        SELECT S.YD_CD
	              ,ROW_NUMBER() OVER(ORDER BY S.CLPT_SEQ) AS RNUM
	          FROM (
	               SELECT CLPT_SEQ
	                 FROM VSK_VSL_PORT_SKD
	                WHERE 1=1
	                  AND VSL_CD        = SUBSTR(@[vvd], 1, 4)
	                  AND SKD_VOY_NO    = SUBSTR(@[vvd], 5, 4)
	                  AND SKD_DIR_CD    = SUBSTR(@[vvd], 9, 1)
	                  AND VPS_PORT_CD   = @[pol_cd]
	                  AND CLPT_IND_SEQ  = '1'
	               ) P
	              ,VSK_VSL_PORT_SKD S
	         WHERE 1=1
	           AND S.VSL_CD        = SUBSTR(@[vvd], 1, 4)
	           AND S.SKD_VOY_NO    = SUBSTR(@[vvd], 5, 4)
	           AND S.SKD_DIR_CD    = SUBSTR(@[vvd], 9, 1)
	           AND S.VPS_PORT_CD   LIKE 'US%'
	           AND S.CLPT_SEQ > P.CLPT_SEQ
	    #else 
	        SELECT YD_CD
	              ,ROW_NUMBER() OVER(ORDER BY CLPT_SEQ) AS RNUM
	          FROM VSK_VSL_PORT_SKD
	         WHERE 1=1
	           AND VPS_PORT_CD   LIKE 'US%'
	           AND VSL_CD        = SUBSTR(@[vvd], 1, 4)
	           AND SKD_VOY_NO    = SUBSTR(@[vvd], 5, 4)
	           AND SKD_DIR_CD    = SUBSTR(@[vvd], 9, 1)
	    #end
    #end
)
WHERE RNUM = 1			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
