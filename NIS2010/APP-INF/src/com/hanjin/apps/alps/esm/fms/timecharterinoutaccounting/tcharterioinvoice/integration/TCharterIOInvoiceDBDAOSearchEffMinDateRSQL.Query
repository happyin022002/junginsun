<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOInvoiceDBDAOSearchEffMinDateRSQL">
			<desc><![CDATA[마감 테이블 MIN 오픈 날짜 자동 처리를 위해서 조회를 한다.]]></desc>
			<sql><![CDATA[
SELECT TO_CHAR(DECODE(A.CNT, 1, MAX_EFF, MIN_EFF),'YYYYMMDD') EFF_DT,
       SUBSTR(TO_CHAR(SYSDATE, 'YYYYMMDD'),3) SYS_DT
FROM
(
  SELECT MIN(LAST_DAY(TO_DATE(EFF_YRMON, 'YYYYMM'))) MIN_EFF,
         MAX(TRUNC(TO_DATE(EFF_YRMON, 'YYYYMM'), 'MONTH')) MAX_EFF,
         COUNT(P.EFF_YRMON) CNT
  FROM   AP_PERIOD P
  WHERE  P.SYS_DIV_CD   = '17'
    AND  P.AR_AP_DIV_CD = 'P'
    AND  P.CLZ_STS_CD   = 'O'  
    AND  OFC_CD =  (SELECT S.AR_HD_QTR_OFC_CD
                    FROM   MDM_ORGANIZATION S
                    WHERE  S.OFC_CD = @[ofc_cd])
) A 			]]></sql>
			<params>
				<param name="ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
