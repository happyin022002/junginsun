<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingReceiptDBDAOSearchSpclWaitRsnRSQL">
			<desc><![CDATA[SearchSpclWaitRsn]]></desc>
			<sql><![CDATA[
select case when spcl_not_auth_cnt > 0 then 'Y'
            when spcl_cnt = 0 and chk_flag <> 'N' then 'Y' ELSE 'N' end WT_RSN_SPCL_CGO_FLG
from 
    (select sum(spcl_not_auth_cnt) spcl_not_auth_cnt, sum(spcl_cnt) spcl_cnt
    from
        (SELECT sum(decode(NVL(spcl_cgo_apro_Cd, 'X'), 'Y', 0, 'C', 0, 1)) spcl_not_auth_cnt, count(1) spcl_cnt
#if (${ca_flg}== 'Y')
        FROM  bkg_dg_cgo_his
#else
        FROM  bkg_dg_cgo
#end            
        where bkg_no = @[bkg_no]
#if (${ca_flg}== 'Y')
		AND   CORR_NO = 'TMP0000001'
#end
        UNION
        SELECT sum(decode(NVL(spcl_cgo_apro_Cd, 'X'), 'Y', 0, 'C', 0, 1)) spcl_not_auth_cnt, count(1) spcl_cnt
#if (${ca_flg}== 'Y')
        FROM  bkg_rf_cgo_his
#else
        FROM bkg_rf_cgo 
#end            
        where bkg_no = @[bkg_no]
#if (${ca_flg}== 'Y')
		AND   CORR_NO = 'TMP0000001'
#end
        UNION
        SELECT sum(decode(NVL(spcl_cgo_apro_Cd, 'X'), 'Y', 0, 'C', 0, 1)) spcl_not_auth_cnt, count(1) spcl_cnt
#if (${ca_flg}== 'Y')
        FROM  bkg_awk_cgo_his
#else
        FROM  bkg_awk_cgo
#end            
        where bkg_no = @[bkg_no]
#if (${ca_flg}== 'Y')
		AND   CORR_NO = 'TMP0000001'
#end
        UNION
        SELECT sum(decode(NVL(spcl_cgo_apro_Cd, 'X'), 'Y', 0, 'C', 0, 1)) spcl_not_auth_cnt, count(1) spcl_cnt
#if (${ca_flg}== 'Y')
        FROM  bkg_bb_cgo_his
#else
        FROM  bkg_bb_cgo
#end         
        where bkg_no = @[bkg_no]
#if (${ca_flg}== 'Y')
		AND   CORR_NO = 'TMP0000001'
#end
        )
    ) approval,
    (select bkg_no, nvl(decode(dcgo_flg,    'N', '', 'Y')||
                        decode(rc_flg,      'N', '', 'Y')||
                        decode(awk_cgo_flg, 'N', '', 'Y')||
                        decode(bb_cgo_flg,  'N', '', 'Y'), 'N') CHK_FLaG --하나도 없어야 'N'
#if (${ca_flg}== 'Y')
        FROM  bkg_bkg_his
#else
        from bkg_booking
#end 
    
    where bkg_no = @[bkg_no]
#if (${ca_flg}== 'Y')
    AND   CORR_NO = 'TMP0000001'
#end
) chk			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="SEL901763601" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
