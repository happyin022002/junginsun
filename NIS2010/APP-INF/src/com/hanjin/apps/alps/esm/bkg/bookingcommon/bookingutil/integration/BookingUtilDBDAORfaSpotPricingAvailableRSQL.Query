<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingUtilDBDAORfaSpotPricingAvailableRSQL">
			<desc><![CDATA[RfaSpotPricingAvailable]]></desc>
			<sql><![CDATA[
SELECT CASE WHEN PROP_OFC_CD IN (SELECT ATTR_CTNT1 
								   FROM BKG_HRD_CDG_CTNT
 								  WHERE HRD_CDG_ID = 'SPOT_VALID_EXPT') THEN 'Y'
            ELSE DECODE(PROP_OFC_CD, OB_SLS_OFC_CD, 'Y', PRNT_OFC_CD, 'Y', 'N') END OUTPUT_TEXT
FROM   (
            SELECT  MAX(PROP_OFC_CD) PROP_OFC_CD, MAX(OB_SLS_OFC_CD) OB_SLS_OFC_CD, MAX(PRNT_OFC_CD) PRNT_OFC_CD
            FROM    (
                      SELECT PROP_OFC_CD,
                             '' OB_SLS_OFC_CD,
                             '' PRNT_OFC_CD
                      FROM   PRI_RP_HDR  HD, 
                             PRI_RP_MN   MN
                      WHERE  1=1
                      AND    HD.RFA_NO = @[rfa_no]
                      AND    HD.PROP_NO = MN.PROP_NO
                      AND    MN.PROP_STS_CD ='A'
                      AND    TO_DATE(@[date],'YYYYMMDD') BETWEEN MN.EFF_DT AND MN.EXP_DT
                      AND    MN.RFA_CTRT_TP_CD = 'G'
                      AND    ROWNUM =1
                      UNION ALL                          
                      SELECT '' PROP_OFC_CD, 
                             OB_SLS_OFC_CD, 
                             '' PRNT_OFC_CD
                      FROM   BKG_BOOKING
                      WHERE  BKG_NO = @[bkg_no]
                      UNION ALL  
                      SELECT '' PROP_OFC_CD,
                             '' OB_SLS_OFC_CD,
                             ORG.PRNT_OFC_CD
                      FROM   BKG_BOOKING BK, MDM_ORGANIZATION ORG
                      WHERE  BK.BKG_NO = @[bkg_no]
                      AND    BK.OB_SLS_OFC_CD = ORG.OFC_CD
                      AND    ROWNUM = 1
                    )
        )			]]></sql>
			<params>
				<param name="rfa_no" type="12" value="" out="N"/>
				<param name="date" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
