<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOConsultationDBDAOFmsVvdListByManualSlipRSQL">
			<desc><![CDATA[Manual Slip â€“ Brokerage / Window Select]]></desc>
			<sql><![CDATA[
SELECT VVD_CD
  FROM (
  	    SELECT VVD_CD
		  FROM (
				SELECT    FV.VSL_CD 
					   || FV.SKD_VOY_NO 
					   || FV.SKD_DIR_CD 
					   || FV.REV_DIR_CD VVD_CD,
					   FV.VST_DT,
					   FV.VED_DT
				  FROM FMS_CONTRACT FC, FMS_VVD FV
				 WHERE FC.FLET_CTRT_NO = @[flet_ctrt_no]
				   AND FC.VSL_CD = FV.VSL_CD
				   AND FV.VST_DT >= (SELECT MIN(VST_DT) 
									   FROM FMS_VVD
									  WHERE VSL_CD = FC.VSL_CD)
				   AND FV.VED_DT <= (SELECT MAX(VED_DT) 
									   FROM FMS_VVD
									  WHERE VSL_CD = FC.VSL_CD)
			   ) WHERE (   REPLACE(@[eff_dt],'-','') BETWEEN VST_DT AND VED_DT
					    OR REPLACE(@[exp_dt],'-','') BETWEEN VST_DT AND VED_DT
					   )
		UNION ALL
		SELECT VVD_CD
		  FROM (
				SELECT    FV.VSL_CD 
					   || FV.SKD_VOY_NO 
					   || FV.SKD_DIR_CD 
					   || FV.REV_DIR_CD VVD_CD,
					   FV.VST_DT,
					   FV.VED_DT
				  FROM FMS_ID_VSL FI, FMS_VVD FV 
				 WHERE FI.FLET_CTRT_NO = @[flet_ctrt_no]
				   AND FI.USE_FLG = 'Y'
				   AND FI.VSL_CD = FV.VSL_CD
				   AND FV.VST_DT >= (SELECT MIN(VST_DT) 
									   FROM FMS_VVD
									  WHERE VSL_CD = FI.VSL_CD)
				   AND FV.VED_DT <= (SELECT MAX(VED_DT) 
									   FROM FMS_VVD
									  WHERE VSL_CD = FI.VSL_CD)
			   ) WHERE (   REPLACE(@[eff_dt],'-','') BETWEEN VST_DT AND VED_DT
					    OR REPLACE(@[exp_dt],'-','') BETWEEN VST_DT AND VED_DT
					   )
	   )			]]></sql>
			<params>
				<param name="flet_ctrt_no" type="12" value="" out="N"/>
				<param name="eff_dt" type="12" value="" out="N"/>
				<param name="exp_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
