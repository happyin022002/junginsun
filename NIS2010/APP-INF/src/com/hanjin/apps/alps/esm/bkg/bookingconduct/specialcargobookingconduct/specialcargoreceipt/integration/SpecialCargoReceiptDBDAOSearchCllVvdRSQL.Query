<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SpecialCargoReceiptDBDAOSearchCllVvdRSQL">
			<desc><![CDATA[Booking에 해당하는 CLL VVD를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT  SUBSTR(XMLAGG(XMLELEMENT(VVD, ',' || VVD) ORDER BY VVD).EXTRACT('//text()'),2) CLL_VVD
FROM    (
            SELECT  VSL_CD||SKD_VOY_NO||SKD_DIR_CD VVD, COUNT(*) CNT 
            FROM    BKG_CSTMS_TML_CLL
            WHERE   (   VSL_CD, SKD_VOY_NO, SKD_DIR_CD ,PORT_CD, BKG_NO) IN (  SELECT  VSL_CD, SKD_VOY_NO, SKD_DIR_CD, POL_CD, BKG_NO 
                                                                            FROM    (   SELECT  VSL_CD, 
                                                                                                SKD_VOY_NO, 
                                                                                                SKD_DIR_CD, 
                                                                                                POL_CD, 
                                                                                                BKG_NO, 
                                                                                                ROW_NUMBER() OVER (ORDER BY VSL_PRE_PST_CD||VSL_SEQ) RN 
                                                                                        FROM    BKG_VVD
                                                                                        WHERE   BKG_NO = @[bkg_no])
                                                                            WHERE RN > 1)
            GROUP BY VSL_CD||SKD_VOY_NO||SKD_DIR_CD                                                                
            UNION ALL
            SELECT  VSL_CD||SKD_VOY_NO||SKD_DIR_CD VVD, COUNT(*) CNT 
            FROM    BKG_CSTMS_TML_KR_CLL
            WHERE   (   VSL_CD, SKD_VOY_NO, SKD_DIR_CD ,POL_CD, BKG_NO) IN (   SELECT  VSL_CD, SKD_VOY_NO, SKD_DIR_CD, POL_CD, BKG_NO 
                                                                            FROM    (   SELECT  VSL_CD, 
                                                                                                SKD_VOY_NO, 
                                                                                                SKD_DIR_CD, 
                                                                                                POL_CD, 
                                                                                                BKG_NO, 
                                                                                                ROW_NUMBER() OVER (ORDER BY VSL_PRE_PST_CD||VSL_SEQ) RN 
                                                                                        FROM    BKG_VVD
                                                                                        WHERE BKG_NO = @[bkg_no])
                                                                            WHERE RN > 1)
            GROUP BY VSL_CD||SKD_VOY_NO||SKD_DIR_CD
        )
			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
