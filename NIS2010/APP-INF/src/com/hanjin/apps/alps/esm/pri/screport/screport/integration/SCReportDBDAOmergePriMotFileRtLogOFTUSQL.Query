<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCReportDBDAOmergePriMotFileRtLogOFTUSQL">
			<desc><![CDATA[일별 데이터 중에서 OFT 가 Null or Zero 인 경우들에 대해 MOT Tariff 를 Matching 하여 OFT 와 Remark 를 Update 
PRI_MOT_FILE_RT_LOG.MOT_FILE_RT_AMT  = PRI_MOT_TRF_RT.MOT_TRF_RT_AMT
PRI_MOT_FILE_RT_LOG.MOT_FILE_RMK = 'TARIFF']]></desc>
			<sql><![CDATA[
MERGE INTO PRI_MOT_FILE_RT_LOG X
    USING
        (
            SELECT  A.BAT_EXE_DT,
                    A.MOT_FILE_RT_LOG_SEQ,
                    C.MOT_TRF_RT_AMT AS OFT_AMT
            FROM    PRI_MOT_FILE_RT_LOG A
                ,   PRI_MOT_FILE_LOC_PPT B
                ,   PRI_MOT_TRF_MN M
                ,   PRI_MOT_TRF_RT C
            WHERE   A.BAT_EXE_DT = TO_DATE (@[exec_dt], 'YYYY-MM-DD' )
            AND   ( A.MOT_FILE_RT_AMT IS NULL OR A.MOT_FILE_RT_AMT = 0 )
            
            AND     A.MOT_FILE_DEST_CD = B.MOT_FILE_LOC_CD
            AND     B.ORG_DEST_TP_CD = 'D'    
            AND     B.SVC_SCP_CD = M.SVC_SCP_CD
            AND     M.MOT_TRF_SEQ = ( SELECT MAX ( X.MOT_TRF_SEQ ) FROM PRI_MOT_TRF_MN X WHERE X.SVC_SCP_CD = B.SVC_SCP_CD AND X.EFF_DT <= A.BAT_EXE_DT AND X.CFM_FLG = 'Y' )
            
            AND     M.SVC_SCP_CD = C.SVC_SCP_CD
            AND     M.MOT_TRF_SEQ = C.MOT_TRF_SEQ
            AND     C.RT_SEQ = (    SELECT  MAX ( X.RT_SEQ ) 
                                    FROM    PRI_MOT_TRF_RT X
                                    WHERE   X.SVC_SCP_CD = M.SVC_SCP_CD
                                    AND     X.MOT_TRF_SEQ = M.MOT_TRF_SEQ
                                    AND     X.MOT_TRF_ORG_CD = A.MOT_FILE_ORG_CD
                                    AND     X.MOT_TRF_DEST_CD = A.MOT_FILE_DEST_CD
                                    AND     X.MOT_TRF_CNTR_TP_CD = A.MOT_FILE_CNTR_TP_CD
                                    AND     X.MOT_TRF_CMDT_TP_CD = A.MOT_FILE_CMDT_TP_CD
                                    AND     X.MOT_TRF_CNTR_SZ_CD = A.MOT_FILE_CNTR_SZ_CD )
        ) A
    ON (
         X.BAT_EXE_DT = A.BAT_EXE_DT
        AND X.MOT_FILE_RT_LOG_SEQ = A.MOT_FILE_RT_LOG_SEQ
        )
    WHEN     MATCHED THEN    
    UPDATE  SET X.MOT_FILE_RT_AMT = A.OFT_AMT
            ,   X.MOT_FILE_RMK    = 'TARIFF'			]]></sql>
			<params>
				<param name="exec_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
