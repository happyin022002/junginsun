<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="StatusReportDBDAOsearchWarningReportListRSQL">
			<desc><![CDATA[StatusReportDBDAOsearchWarningReportListRSQL]]></desc>
			<sql><![CDATA[
SELECT 
--BV.POL_CD, BV.POD_CD,
BB.BKG_NO
,BLCK_KW_TP_CD,BLCK_KW_TP_SEQ
,BB.BL_NO
,BB.OB_SLS_OFC_CD
,BB.CTRT_OFC_CD
,OP_CNTR_QTY
,INTER_XTER_RMK_KW_NM
,SHPR_SEQ
,FWRD_SEQ
,CNEE_SEQ
,BM.POR_CD
,BM.POL_CD
,BM.POD_CD
,BM.DEL_CD
,BM.CMDT_CD
,BM.CSTMS_DESC_KW_NM
,BM.CMDT_DESC_KW_NM
,BM.CUST_DESC_KW_NM
,BM.CNTR_MF_GDS_DESC_KW_NM
,REPLACE(BM.SHPR_KW_NM ,CHR(13)||CHR(10),' ')SHPR_NAME
,REPLACE(BM.FWRD_KW_NM ,CHR(13)||CHR(10),' ')FFDR_NAME
,REPLACE(BM.CNEE_KW_NM ,CHR(13)||CHR(10),' ')CNEE_NAME
, NVL(DECODE(BM.SHPR_CNT_CD||BM.SHPR_SEQ,'',' ',SUBSTR(BM.SHPR_CNT_CD||BM.SHPR_SEQ,1,2)||LTRIM(TO_CHAR(SUBSTR(BM.SHPR_CNT_CD||BM.SHPR_SEQ,3),'000000'))),' ') AS SHIPPER
, NVL(DECODE(BM.FWRD_CNT_CD||BM.FWRD_SEQ,'',' ',SUBSTR(BM.FWRD_CNT_CD||BM.FWRD_SEQ,1,2)||LTRIM(TO_CHAR(SUBSTR(BM.FWRD_CNT_CD||BM.FWRD_SEQ,3),'000000'))),' ') AS FFDR
, NVL(DECODE(BM.CNEE_CNT_CD||BM.CNEE_SEQ,'',' ',SUBSTR(BM.CNEE_CNT_CD||BM.CNEE_SEQ,1,2)||LTRIM(TO_CHAR(SUBSTR(BM.CNEE_CNT_CD||BM.CNEE_SEQ,3),'000000'))),' ') AS CONSIGNEE

--,REPLACE(S.CUST_NM ,CHR(13)||CHR(10),' ')SHPR_NAME
--,REPLACE(F.CUST_NM ,CHR(13)||CHR(10),' ')FFDR_NAME
--,REPLACE(C.CUST_NM ,CHR(13)||CHR(10),' ')CNEE_NAME
--, NVL(DECODE(S.CUST_CNT_CD||S.CUST_SEQ,'',' ',SUBSTR(S.CUST_CNT_CD||S.CUST_SEQ,1,2)||LTRIM(TO_CHAR(SUBSTR(S.CUST_CNT_CD||S.CUST_SEQ,3),'000000'))),' ') AS SHIPPER
--, NVL(DECODE(F.CUST_CNT_CD||F.CUST_SEQ,'',' ',SUBSTR(F.CUST_CNT_CD||F.CUST_SEQ,1,2)||LTRIM(TO_CHAR(SUBSTR(F.CUST_CNT_CD||F.CUST_SEQ,3),'000000'))),' ') AS FFDR
--, NVL(DECODE(C.CUST_CNT_CD||C.CUST_SEQ,'',' ',SUBSTR(C.CUST_CNT_CD||C.CUST_SEQ,1,2)||LTRIM(TO_CHAR(SUBSTR(C.CUST_CNT_CD||C.CUST_SEQ,3),'000000'))),' ') AS CONSIGNEE


FROM BKG_BOOKING BB 
, BKG_VVD BV
, BKG_BLCK_LIST_MNTR BM 
, BKG_CUSTOMER S
, BKG_CUSTOMER F
, BKG_CUSTOMER C
WHERE 1=1
-----------------------------------------------------------------------------1st vvd etd--
#if (${board_from_dt} != '')
AND bm.bkg_no --bb.BKG_NO
 IN ( SELECT DISTINCT BKG.BKG_NO
		FROM BKG_VVD VVD, BKG_BOOKING BKG
	   WHERE ( VVD.VSL_CD,VVD.SKD_VOY_NO,VVD.SKD_DIR_CD,VVD.POL_CD,VVD.POL_CLPT_IND_SEQ ) IN
            		     ( SELECT A.VSL_CD,A.SKD_VOY_NO,A.SKD_DIR_CD,A.VPS_PORT_CD,A.CLPT_IND_SEQ
            				 FROM VSK_VSL_PORT_SKD A
            				WHERE A.VPS_ETD_DT >= TO_DATE(@[board_from_dt] , 'YYYY-MM-DD')
            				  AND A.VPS_ETD_DT <= TO_DATE(@[board_to_dt] , 'YYYY-MM-DD') +0.99999)
		 AND BB.BKG_NO  = BKG.BKG_NO
		 AND VVD.BKG_NO = BKG.BKG_NO
		 AND VVD.POL_CD = BKG.POL_CD
		 AND ( VVD.VSL_PRE_PST_CD, VVD.VSL_SEQ) IN ( ('S',1),('T',0) )
	)
#end

-----------------------------------------------------------------------------last vvd eta--
#if (${eta_from_dt} != '')

AND bm.bkg_no  --bb.BKG_NO
 IN ( SELECT DISTINCT BKG.BKG_NO
		FROM BKG_VVD VVD, BKG_BOOKING BKG
	   WHERE ( VVD.VSL_CD,VVD.SKD_VOY_NO,VVD.SKD_DIR_CD,VVD.POD_CD,VVD.POD_CLPT_IND_SEQ ) IN
		     ( SELECT A.VSL_CD,A.SKD_VOY_NO,A.SKD_DIR_CD,A.VPS_PORT_CD,A.CLPT_IND_SEQ
				 FROM VSK_VSL_PORT_SKD A
				WHERE A.VPS_ETA_DT >= TO_DATE(@[eta_from_dt], 'YYYY-MM-DD')
				  AND A.VPS_ETA_DT <= TO_DATE(@[eta_to_dt], 'YYYY-MM-DD') +0.99999)
		 AND BB.BKG_NO  = BKG.BKG_NO
		 AND VVD.BKG_NO = BKG.BKG_NO
		 AND VVD.POD_CD = BKG.POD_CD
		 AND VVD.VSL_PRE_PST_CD IN ('T','U')
		 AND (VVD.VSL_PRE_PST_CD, VVD.VSL_SEQ) = (SELECT /*+ INDEX_DESC (VVD2 XPKBKG_VVD) */ VVD2.VSL_PRE_PST_CD, VVD2.VSL_SEQ
													 FROM BKG_VVD VVD2
													WHERE VVD2.BKG_NO = VVD.BKG_NO
													  AND VVD2.VSL_PRE_PST_CD IN ('T','U')
													  AND ROWNUM = 1)
	)
#end
----------------------------------------------------------------------------------------------------

and bb.bkg_no = bm.bkg_no 
AND S.BKG_CUST_TP_CD ='S'
AND BB.BKG_NO = S.BKG_NO
AND F.BKG_CUST_TP_CD(+) ='F'
AND BB.BKG_NO = F.BKG_NO(+)
AND C.BKG_CUST_TP_CD ='C'
AND BB.BKG_NO = C.BKG_NO

AND NVL(BB.NEW_CUST_APRO_FLG,'X') = DECODE(@[warn_cust_s],'S','Y',NVL(BB.NEW_CUST_APRO_FLG,'X'))

and bb.bkg_no = bv.bkg_no
AND     nvl(bv.VSL_CD ,'X')     = decode(@[vvd_cd] , null, nvl(bv.VSL_CD,'X'), SUBSTR(@[vvd_cd] , 1, 4))
AND     nvl(bv.SKD_VOY_NO ,'X') = decode(@[vvd_cd] , null, nvl(bv.SKD_VOY_NO,'X'),  SUBSTR(@[vvd_cd] , 5, 4))
AND     nvl(bv.SKD_DIR_CD ,'X') = decode(@[vvd_cd] , null, nvl(bv.SKD_DIR_CD,'X'), SUBSTR(@[vvd_cd] , 9, 1))
and     bv.VSL_PRE_PST_CD = case
                                when @[trunk_flag] ='Y' then 'T'      /* trunk flag */
                                when length(@[lane_cd]) > 0 then 'T'  /* lane */
                                else bv.VSL_PRE_PST_CD
                            end  /* trunk flag */
and bv.SLAN_CD = nvl(@[lane_cd] , bv.SLAN_CD )/* lane */
and bv.SKD_DIR_CD = nvl(@[dir_cd], bv.SKD_DIR_CD )  /*dir */
--------------POL 처리 --------------------------------------------------------
and bv.pol_cd LIKE nvl(@[pol_cd], bv.pol_cd)||'%' /*pol*/
and bv.pol_cd = decode(@[pol_local] ,'Y',bb.pol_cd, bv.pol_cd )/*pol_local*/
and 'Y' = case when @[pol_ts] = 'Y' then 
            case when  instr(bb.pol_cd, bv.pol_cd ) = 0 then 'Y'
                 else 'N'
            end
          else 'Y'
          end /* pol_ts */
AND SUBSTR(bv.POL_YD_CD,-2) = nvl(@[pol_yard_cd],SUBSTR(bv.POL_YD_CD,-2)) /* pol_yard_cd */
--------------POD 처리 --------------------------------------------------------
and bv.pod_cd like nvl(@[pod_cd], bv.pod_cd)||'%' /*pod*/
and bv.pod_cd = decode(@[pod_local] ,'Y',bb.pod_cd, bv.pod_cd )/*pod_local*/
and 'Y' = case when @[pod_ts] = 'Y' then 
            case when  instr(bb.pod_cd, bv.pod_cd ) = 0 then 'Y'
                 else 'N'
            end
          else 'Y'
          end /* pod_ts */          
AND SUBSTR(bv.POD_YD_CD,-2) = nvl(@[pod_yard_cd], SUBSTR(bv.POD_YD_CD,-2))/* pod_yard_cd*/
-----------------------------------------------------------------------POR,DEL --------
and bb.POR_CD like nvl(@[por_cd], bb.por_cd)||'%' /* por_cd */
and bb.del_cd like nvl(@[del_cd], bb.del_cd)||'%'  /* del_cd */

-----------------------------------------------------------------------------bkg create date--
#if (${bkg_from_dt} != '')
/* bkg_from_dt    */
AND BB.BKG_CRE_DT >= TO_DATE(@[bkg_from_dt],'YYYY-MM-DD')
#end

#if (${bkg_to_dt} != '')
/* bkg_to_dt      */
AND BB.BKG_CRE_DT <= TO_DATE(@[bkg_to_dt],'YYYY-MM-DD') +0.99999
#end
                                           
#if (${b_ofc_cd} != '')
/* b_ofc_cd       *//* b_ofc_cd_sub   */
#if(${b_ofc_cd_sub} != '')

 AND BB.BKG_OFC_CD IN ( ${b_ofc_cd_sub} )
#else
 AND BB.BKG_OFC_CD IN ( ${b_ofc_cd} )
#end
#end


#if (${l_ofc_cd} != '')
/* l_ofc_cd *//* l_ofc_cd_sub */
#if(${l_ofc_cd_sub} != '')
 AND BB.OB_SLS_OFC_CD   IN ( SELECT OFC_N8TH_LVL_CD
                              FROM   DMT_OFC_LVL_V
                              WHERE @[l_ofc_cd] IN (OFC_N1ST_LVL_CD, OFC_N2ND_LVL_CD, OFC_N3RD_LVL_CD, OFC_N4TH_LVL_CD,
                                                    OFC_N5TH_LVL_CD, OFC_N6TH_LVL_CD, OFC_N7TH_LVL_CD, OFC_N8TH_LVL_CD)
                            )
#else
 AND BB.OB_SLS_OFC_CD = @[l_ofc_cd]
#end
#end


#if (${c_ofc_cd} != '')
/* c_ofc_cd *//* c_ofc_cd_sub */
#if(${c_ofc_cd_sub} != '')
 AND BB.CTRT_OFC_CD   IN ( SELECT OFC_N8TH_LVL_CD
                         FROM   DMT_OFC_LVL_V
                         WHERE @[c_ofc_cd] IN (OFC_N1ST_LVL_CD, OFC_N2ND_LVL_CD, OFC_N3RD_LVL_CD, OFC_N4TH_LVL_CD,
                                                    OFC_N5TH_LVL_CD, OFC_N6TH_LVL_CD, OFC_N7TH_LVL_CD, OFC_N8TH_LVL_CD)
                       )
#else
 AND BB.CTRT_OFC_CD = @[c_ofc_cd]
#end
#end


AND BLCK_KW_TP_CD IN (
		DECODE(@[warn_cust_b],'B','BLA',''),
        DECODE(@[warn_cust_y],'Y','YEL',''),
        DECODE(@[warn_cust_c],'C','CAL',''),
        DECODE(@[warn_cust_i],'I','SAN',''),
        DECODE(@[warn_cargo_p],'P','POT',''),
        DECODE(@[warn_cargo_m],'M','MIS',''),
	    DECODE(@[warn_cust_b], NULL, 
							   DECODE(@[warn_cust_y], NULL,
							   DECODE(@[warn_cust_c], NULL,
                               DECODE(@[warn_cargo_p], NULL,
                               DECODE(@[warn_cust_i], NULL,
                               DECODE(@[warn_cargo_m], NULL, BLCK_KW_TP_CD))))))  	
)
ORDER BY BB.BKG_NO,BLCK_KW_TP_CD,BLCK_KW_TP_SEQ			]]></sql>
			<params>
				<param name="board_from_dt" type="12" value="" out="N"/>
				<param name="board_to_dt" type="12" value="" out="N"/>
				<param name="eta_from_dt" type="12" value="" out="N"/>
				<param name="eta_to_dt" type="12" value="" out="N"/>
				<param name="warn_cust_s" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="trunk_flag" type="12" value="" out="N"/>
				<param name="lane_cd" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pol_local" type="12" value="" out="N"/>
				<param name="pol_ts" type="12" value="" out="N"/>
				<param name="pol_yard_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="pod_local" type="12" value="" out="N"/>
				<param name="pod_ts" type="12" value="" out="N"/>
				<param name="pod_yard_cd" type="12" value="" out="N"/>
				<param name="por_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
				<param name="bkg_from_dt" type="12" value="" out="N"/>
				<param name="bkg_to_dt" type="12" value="" out="N"/>
				<param name="l_ofc_cd" type="12" value="" out="N"/>
				<param name="c_ofc_cd" type="12" value="" out="N"/>
				<param name="warn_cust_b" type="12" value="" out="N"/>
				<param name="warn_cust_y" type="12" value="" out="N"/>
				<param name="warn_cust_c" type="12" value="" out="N"/>
				<param name="warn_cust_i" type="12" value="" out="N"/>
				<param name="warn_cargo_p" type="12" value="" out="N"/>
				<param name="warn_cargo_m" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
