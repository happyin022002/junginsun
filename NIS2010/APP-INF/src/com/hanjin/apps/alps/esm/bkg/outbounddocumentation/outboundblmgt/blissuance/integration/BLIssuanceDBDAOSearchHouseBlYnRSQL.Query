<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLIssuanceDBDAOSearchHouseBlYnRSQL">
			<desc><![CDATA[House B/L YN]]></desc>
			<sql><![CDATA[
SELECT DECODE(COUNT(1), 0, 'N', 'Y') AS NVO_HBS_YN
      ,DECODE(MAX(HBL_TP),'B','B',DECODE(MAX(HBL_TP2),'B','B','A')) AS HBL_TP
  FROM (
        SELECT CASE WHEN GDS_DESC_LINE = 1 AND LENGTH(GDS_DESC) < 329 THEN 'A'
                    WHEN GDS_DESC_LINE > 1 AND GDS_DESC_LINE < 9 THEN 'A'
                    WHEN GDS_DESC_LINE = 0 THEN 'A'
                    ELSE 'B'
                    END AS HBL_TP,
               CASE WHEN MK_DESC_LINE = 1 AND LENGTH(MK_DESC) < 329 THEN 'A'
                    WHEN MK_DESC_LINE > 1 AND LENGTH(MK_DESC) < 9 THEN 'A'
                    WHEN MK_DESC_LINE = 0 THEN 'A'
                    ELSE 'B'
                    END AS HBL_TP2
        FROM (  
              SELECT MK_DESC  
                    ,GDS_DESC  
                    ,DECODE(LENGTH(MK_DESC), NULL, 0, ((LENGTH(MK_DESC) - LENGTH(REPLACE(MK_DESC, CHR(13)||CHR(10)))) / LENGTH(CHR(13)||CHR(10)) + 1)) AS MK_DESC_LINE  
                    ,DECODE(LENGTH(GDS_DESC), NULL, 0, ((LENGTH(GDS_DESC) - LENGTH(REPLACE(GDS_DESC, CHR(13)||CHR(10)))) / LENGTH(CHR(13)||CHR(10)) + 1)) AS GDS_DESC_LINE  
                    ,length(GDS_DESC)
                FROM (  
                      SELECT REGEXP_REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REGEXP_REPLACE(BL_MK_DESC,'[[:cntrl:]]{104,}',CHR(13)||CHR(10)),CHR(96),CHR(39)), CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)), '[[:space:]]+$', '')  AS MK_DESC  
                            ,REGEXP_REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REGEXP_REPLACE(BL_GDS_DESC,'[[:cntrl:]]{104,}',CHR(13)||CHR(10)),CHR(96),CHR(39)), CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)), '[[:space:]]+$', '') AS GDS_DESC  
                        FROM BKG_HBL  
                       WHERE BKG_NO = @[bkg_no]
                     )  
            )  
 )			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
