<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="KorManifestListDBDAOsearchCgoSpecRSQL">
			<desc><![CDATA[Cargo Spec 자동 조회를 위해 POL, POD가 "KR"로 시작되는 값의 Sum을 구해서 1이상이면 Cargo Spec 자동 조회 조건 충족함.]]></desc>
			<sql><![CDATA[
SELECT DECODE(SUM(DECODE(SUBSTR(T1.POL_CD,1,2),'KR',DECODE(SUBSTR(T1.POD_CD,1,2),'KR',1,0),0)), 0, ' ',
              SUM(DECODE(SUBSTR(T1.POL_CD,1,2),'KR',DECODE(SUBSTR(T1.POD_CD,1,2),'KR',1,0),0))) CGO_SPEC
FROM BKG_VVD T1,
    (SELECT S2.VSL_CD, S2.SKD_VOY_NO, S2.SKD_DIR_CD, S2.VPS_PORT_CD, S2.SLAN_CD, MAX(S2.VPS_ETD_DT) VPS_ETD_DT
    FROM BKG_VVD S1, VSK_VSL_PORT_SKD S2
    WHERE S1.BKG_NO      = @[bkg_no]
    AND S1.VSL_CD        = S2.VSL_CD(+)
    AND S1.SKD_VOY_NO    = S2.SKD_VOY_NO(+)
    AND S1.SKD_DIR_CD    = S2.SKD_DIR_CD(+)
    AND S1.POL_CD       = S2.VPS_PORT_CD(+)
    GROUP BY S2.VSL_CD, S2.SKD_VOY_NO, S2.SKD_DIR_CD, S2.VPS_PORT_CD, S2.SLAN_CD) T2,
    (SELECT S2.VSL_CD, S2.SKD_VOY_NO, S2.SKD_DIR_CD, S2.VPS_PORT_CD, MIN(S2.VPS_ETA_DT) VPS_ETA_DT
    FROM BKG_VVD S1, VSK_VSL_PORT_SKD S2
    WHERE S1.BKG_NO      = @[bkg_no]
    AND S1.VSL_CD        = S2.VSL_CD(+)
    AND S1.SKD_VOY_NO    = S2.SKD_VOY_NO(+)
    AND S1.SKD_DIR_CD    = S2.SKD_DIR_CD(+)
    AND S1.POD_CD        = S2.VPS_PORT_CD(+)
    GROUP BY S2.VSL_CD, S2.SKD_VOY_NO, S2.SKD_DIR_CD, S2.VPS_PORT_CD) T3
WHERE T1.BKG_NO      = @[bkg_no]
AND T1.VSL_CD        = T2.VSL_CD(+)
AND T1.SKD_VOY_NO    = T2.SKD_VOY_NO(+)
AND T1.SKD_DIR_CD    = T2.SKD_DIR_CD(+)
AND T1.POL_CD        = T2.VPS_PORT_CD(+)
AND T1.VSL_CD        = T3.VSL_CD(+)
AND T1.SKD_VOY_NO    = T3.SKD_VOY_NO(+)
AND T1.SKD_DIR_CD    = T3.SKD_DIR_CD(+)
AND T1.POD_CD        = T3.VPS_PORT_CD(+)			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
