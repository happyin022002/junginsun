<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingUtilDBDAOSearchOfcChgProcRSQL">
			<desc><![CDATA[SearchOfcChgProc
2010.11.22 이일민 [CHM-201005869-01] Collection Office / Code자동 업데이트 관련 수정 요청 (Customer Code 변경 및 B/L Issue 화면 연동)]]></desc>
			<sql><![CDATA[
SELECT NVL(DECODE(@[type],
           'R',
           (SELECT CASE WHEN 'Y' = @[ca_flg]
                        THEN (SELECT 'N'
                                FROM BKG_RT_HIS
                               WHERE @[bkg_no] = BKG_NO
                                 AND 'TMP0000001' = CORR_NO
                                 AND @[ppd_rcv_ofc_cd] = PPD_RCV_OFC_CD)
                        ELSE (SELECT 'N'
                                FROM BKG_RATE
                               WHERE @[bkg_no] = BKG_NO
                                 AND @[ppd_rcv_ofc_cd] = PPD_RCV_OFC_CD)
                   END
              FROM DUAL),
           'C',
           (SELECT CASE WHEN 'Y' = @[ca_flg]
                        THEN (SELECT CASE WHEN COUNT(1) =
                                               MAX((SELECT COUNT(1)
                                                      FROM BKG_CUST_HIS
                                                     WHERE BKG_NO = B.BKG_NO
                                                       AND CORR_NO = B.CORR_NO
                                                       AND 'S' = BKG_CUST_TP_CD))
                                          THEN 'N' ELSE 'Y' END
                                FROM BKG_BKG_HIS A,
                                     BKG_CUST_HIS B
                               WHERE @[bkg_no] = A.BKG_NO
                                 AND 'TMP0000001' = A.CORR_NO
                                 AND B.BKG_NO = A.BKG_NO
                                 AND B.CORR_NO = A.CORR_NO
                                 AND @[cust_to_ord_flg] = A.CUST_TO_ORD_FLG
                                 AND 'S'||@[sh_cust_cnt_cd]||@[sh_cust_seq] = B.BKG_CUST_TP_CD||B.CUST_CNT_CD||LPAD(B.CUST_SEQ,6,0))
                        ELSE (SELECT CASE WHEN COUNT(1) =
                                               MAX((SELECT COUNT(1)
                                                      FROM BKG_CUSTOMER
                                                     WHERE BKG_NO = B.BKG_NO
                                                       AND 'S' = BKG_CUST_TP_CD))
                                          THEN 'N' ELSE 'Y' END
                                FROM BKG_BOOKING A,
                                     BKG_CUSTOMER B
                               WHERE @[bkg_no] = A.BKG_NO
                                 AND B.BKG_NO = A.BKG_NO
                                 AND @[cust_to_ord_flg] = A.CUST_TO_ORD_FLG
                                 AND 'S'||@[sh_cust_cnt_cd]||@[sh_cust_seq] = B.BKG_CUST_TP_CD||B.CUST_CNT_CD||LPAD(B.CUST_SEQ,6,0))
                   END
              FROM DUAL),
           'M',
           (SELECT CASE WHEN 'Y' = @[ca_flg]
                        THEN (SELECT CASE WHEN 1 = COUNT(1) THEN 'N' ELSE 'Y' END
                                FROM BKG_BKG_HIS A,
                                     BKG_CUST_HIS B
                               WHERE @[bkg_no] = A.BKG_NO
                                 AND 'TMP0000001' = A.CORR_NO
                                 AND B.BKG_NO = A.BKG_NO
                                 AND B.CORR_NO = A.CORR_NO
                                 AND NVL(@[cust_to_ord_flg],A.CUST_TO_ORD_FLG) = A.CUST_TO_ORD_FLG
                                 AND 'S'||@[sh_cust_cnt_cd]||@[sh_cust_seq] = B.BKG_CUST_TP_CD||B.CUST_CNT_CD||LPAD(B.CUST_SEQ,6,0))
                        ELSE (SELECT CASE WHEN 1 = COUNT(1) THEN 'N' ELSE 'Y' END
                                FROM BKG_BOOKING A,
                                     BKG_CUSTOMER B
                               WHERE @[bkg_no] = A.BKG_NO
                                 AND B.BKG_NO = A.BKG_NO
                                 AND NVL(@[cust_to_ord_flg],A.CUST_TO_ORD_FLG) = A.CUST_TO_ORD_FLG
                                 AND 'S'||@[sh_cust_cnt_cd]||@[sh_cust_seq] = B.BKG_CUST_TP_CD||B.CUST_CNT_CD||LPAD(B.CUST_SEQ,6,0))
                   END
              FROM DUAL)
       ),'Y') AS OFC_CHG_PPD_PROC,
       NVL(DECODE(@[type],
           'R',
           (SELECT CASE WHEN 'Y' = @[ca_flg]
                        THEN (SELECT 'N'
                                FROM BKG_RT_HIS
                               WHERE @[bkg_no] = BKG_NO
                                 AND 'TMP0000001' = CORR_NO
                                 AND @[clt_ofc_cd] = CLT_OFC_CD)
                        ELSE (SELECT 'N'
                                FROM BKG_RATE
                               WHERE @[bkg_no] = BKG_NO
                                 AND @[clt_ofc_cd] = CLT_OFC_CD)
                   END
              FROM DUAL),
           'C',
           (SELECT CASE WHEN 'Y' = @[ca_flg]
                        THEN (SELECT CASE WHEN COUNT(1) =
                                               MAX((SELECT COUNT(1)
                                                      FROM BKG_CUST_HIS
                                                     WHERE BKG_NO = B.BKG_NO
                                                       AND CORR_NO = B.CORR_NO
                                                       AND BKG_CUST_TP_CD IN ('C','N')))
                                          THEN 'N' ELSE 'Y' END
                                FROM BKG_BKG_HIS A,
                                     BKG_CUST_HIS B
                               WHERE @[bkg_no] = A.BKG_NO
                                 AND 'TMP0000001' = A.CORR_NO
                                 AND B.BKG_NO = A.BKG_NO
                                 AND B.CORR_NO = A.CORR_NO
                                 AND @[cust_to_ord_flg] = A.CUST_TO_ORD_FLG
                                 AND B.BKG_CUST_TP_CD||B.CUST_CNT_CD||LPAD(B.CUST_SEQ,6,0) IN
                                     ('C'||@[cn_cust_cnt_cd]||@[cn_cust_seq],
                                      'N'||@[nf_cust_cnt_cd]||@[nf_cust_seq]))
                        ELSE (SELECT CASE WHEN COUNT(1) =
                                               MAX((SELECT COUNT(1)
                                                      FROM BKG_CUSTOMER
                                                     WHERE BKG_NO = B.BKG_NO
                                                       AND BKG_CUST_TP_CD IN ('C','N')))
                                          THEN 'N' ELSE 'Y' END
                                FROM BKG_BOOKING A,
                                     BKG_CUSTOMER B
                               WHERE @[bkg_no] = A.BKG_NO
                                 AND B.BKG_NO = A.BKG_NO
                                 AND @[cust_to_ord_flg] = A.CUST_TO_ORD_FLG
                                 AND B.BKG_CUST_TP_CD||B.CUST_CNT_CD||LPAD(B.CUST_SEQ,6,0) IN
                                     ('C'||@[cn_cust_cnt_cd]||@[cn_cust_seq],
                                      'N'||@[nf_cust_cnt_cd]||@[nf_cust_seq]))
                   END
              FROM DUAL),
           'M',
           (SELECT CASE WHEN 'Y' = @[ca_flg]
                        THEN (SELECT CASE WHEN 1 = COUNT(1) THEN 'N' ELSE 'Y' END
                                FROM BKG_BKG_HIS A,
                                     BKG_CUST_HIS B
                               WHERE @[bkg_no] = A.BKG_NO
                                 AND 'TMP0000001' = A.CORR_NO
                                 AND B.BKG_NO = A.BKG_NO
                                 AND B.CORR_NO = A.CORR_NO
                                 AND NVL(@[cust_to_ord_flg],A.CUST_TO_ORD_FLG) = A.CUST_TO_ORD_FLG
                                 AND 'C'||@[cn_cust_cnt_cd]||@[cn_cust_seq] = B.BKG_CUST_TP_CD||B.CUST_CNT_CD||LPAD(B.CUST_SEQ,6,0))
                        ELSE (SELECT CASE WHEN 1 = COUNT(1) THEN 'N' ELSE 'Y' END
                                FROM BKG_BOOKING A,
                                     BKG_CUSTOMER B
                               WHERE @[bkg_no] = A.BKG_NO
                                 AND B.BKG_NO = A.BKG_NO
                                 AND NVL(@[cust_to_ord_flg],A.CUST_TO_ORD_FLG) = A.CUST_TO_ORD_FLG
                                 AND 'C'||@[cn_cust_cnt_cd]||@[cn_cust_seq] = B.BKG_CUST_TP_CD||B.CUST_CNT_CD||LPAD(B.CUST_SEQ,6,0))
                   END
              FROM DUAL)
       ),'Y') AS OFC_CHG_CCT_PROC
  FROM DUAL			]]></sql>
			<params>
				<param name="type" type="12" value="" out="N"/>
				<param name="ca_flg" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="ppd_rcv_ofc_cd" type="12" value="" out="N"/>
				<param name="cust_to_ord_flg" type="12" value="" out="N"/>
				<param name="sh_cust_cnt_cd" type="12" value="" out="N"/>
				<param name="sh_cust_seq" type="12" value="" out="N"/>
				<param name="clt_ofc_cd" type="12" value="" out="N"/>
				<param name="cn_cust_cnt_cd" type="12" value="" out="N"/>
				<param name="cn_cust_seq" type="12" value="" out="N"/>
				<param name="nf_cust_cnt_cd" type="12" value="" out="N"/>
				<param name="nf_cust_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
