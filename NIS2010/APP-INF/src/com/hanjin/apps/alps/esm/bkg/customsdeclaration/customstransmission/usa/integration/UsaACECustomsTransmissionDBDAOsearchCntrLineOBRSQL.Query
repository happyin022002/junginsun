<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UsaACECustomsTransmissionDBDAOsearchCntrLineOBRSQL">
			<desc><![CDATA[UsaACECustomsTransmissionDBDAOsearchCntrLineOBRSQL]]></desc>
			<sql><![CDATA[
SELECT 
       B.BKG_NO BL_NO,
       RPAD(
       'C01'||
       RPAD(C.CNTR_NO, 14, ' ')||
       RPAD(NVL(DECODE(C.CNTR_NO, S.CNTR_NO, S.SEAL_NO1), '999'), 15, ' ')||
	   RPAD(NVL(DECODE(C.CNTR_NO, S.CNTR_NO, S.SEAL_NO2), ' '), 15, ' ')||
	 ( SELECT DECODE(MAX(ATTR_CTNT2),'','  ',MAX(ATTR_CTNT2)) AS ATTR_CTNT2 FROM BKG_CSTMS_cD_cONV_CTNT
		WHERE CNT_CD = 'US'
		AND CSTMS_DIV_ID = 'ACE_CNTR_EQ_DESC_CD'
		AND ATTR_CTNT1 = C.CNTR_TPSZ_CD )||
	 ( SELECT LPAD(NVL(MAX(ATTR_CTNT2),'     '),5) AS ATTR_CTNT2 FROM BKG_CSTMS_CD_CONV_CTNT
		WHERE CNT_CD='US'
		AND CSTMS_DIV_ID='CNTR_SPEC_INFO'
		AND ATTR_CTNT1 = C.CNTR_TPSZ_CD)||
     ( SELECT LPAD(NVL(MAX(ATTR_CTNT3),'        '),8) AS ATTR_CTNT3 FROM BKG_CSTMS_CD_CONV_CTNT
        WHERE CNT_CD='US'
        AND CSTMS_DIV_ID='CNTR_SPEC_INFO'
        AND ATTR_CTNT1 = C.CNTR_TPSZ_CD)||
     ( SELECT LPAD(NVL(MAX(ATTR_CTNT4),'        '),8) AS ATTR_CTNT4 FROM BKG_CSTMS_CD_CONV_CTNT
        WHERE CNT_CD='US'
        AND CSTMS_DIV_ID='CNTR_SPEC_INFO'
        AND ATTR_CTNT1 = C.CNTR_TPSZ_CD)||
     ( SELECT LPAD(NVL(MAX(ATTR_CTNT5),'    '),4) AS ATTR_CTNT5 FROM BKG_CSTMS_CD_CONV_CTNT
		WHERE CNT_CD='US'
		AND CSTMS_DIV_ID='CNTR_SPEC_INFO'
		AND ATTR_CTNT1 = C.CNTR_TPSZ_CD )||
       DECODE(K.BKG_CGO_TP_CD, 'M', 'E', 'L')||
       DECODE(K.BB_CGO_FLG,
	      'Y', 'BB',
	      DECODE(NVL(K.RCV_TERM_CD,' ')||NVL(K.DE_TERM_CD,' '),
		     'YY','CY',
		     'YD','PH',
		     'DY','HP',
		     'DD','HH',
		     'SY','CS',
		     'YS','CS',
		     'SD','CS',
		     'DS','CS',
		     'MM','MD',
		     'TT','PP',
		     'HH','HL',
		     '  '))||
       '   ',80,' ')||CHR(10) BUF3,
       RPAD(
       'C02'||
       RPAD( (SELECT X.VIN_CTNT FROM BKG_XPT_IMP_LIC X WHERE X.BKG_NO = B.BKG_NO AND X.IO_BND_CD = 'O' AND X.CNT_CD = 'US' AND ROWNUM = 1), 30, ' ')||
       '   ',80,' ')||CHR(10) BUF32,
       RPAD(
       'C03'||
	   RPAD(NVL(DECODE(C.CNTR_NO, S.CNTR_NO, S.SEAL_NO3), ' '), 15, ' ')||
	   RPAD(NVL(DECODE(C.CNTR_NO, S.CNTR_NO, S.SEAL_NO4), ' '), 15, ' ')||
	   RPAD(NVL(DECODE(C.CNTR_NO, S.CNTR_NO, S.SEAL_NO5), ' '), 15, ' ')||
	   RPAD(NVL(DECODE(C.CNTR_NO, S.CNTR_NO, S.SEAL_NO6), ' '), 15, ' ')||
       '   ',80,' ')||CHR(10) BUF33,
       NVL(LENGTH(S.SEAL_NO3),0) BUF33_CHKECK,
       C.CNTR_NO CNTR_NO
  FROM 
	(
	SELECT A.BKG_NO, A.CNTR_NO, 
		MAX(DECODE(A.RANK_SEAL, 1, BKG_SPCLCHAR_CONV_FNC(SEAL_NO ,'X'))) SEAL_NO1,
		MAX(DECODE(A.RANK_SEAL, 2, BKG_SPCLCHAR_CONV_FNC(SEAL_NO ,'X'))) SEAL_NO2,
		MAX(DECODE(A.RANK_SEAL, 3, BKG_SPCLCHAR_CONV_FNC(SEAL_NO ,'X'))) SEAL_NO3,
		MAX(DECODE(A.RANK_SEAL, 4, BKG_SPCLCHAR_CONV_FNC(SEAL_NO ,'X'))) SEAL_NO4,
		MAX(DECODE(A.RANK_SEAL, 5, BKG_SPCLCHAR_CONV_FNC(SEAL_NO ,'X'))) SEAL_NO5,
		MAX(DECODE(A.RANK_SEAL, 6, BKG_SPCLCHAR_CONV_FNC(SEAL_NO ,'X'))) SEAL_NO6
	FROM(
		SELECT A.BKG_NO, CT.CNTR_NO, S.CNTR_SEAL_NO SEAL_NO,
    RANK() OVER(PARTITION BY A.BKG_NO, CT.CNTR_NO ORDER BY A.BKG_NO, S.CNTR_NO, S.CNTR_SEAL_NO DESC) RANK_SEAL
		FROM (SELECT DISTINCT COLUMN_VALUE BKG_NO FROM TABLE(BKG_SPLIT_CLOB_FNC(${bl_no},',')) WHERE COLUMN_VALUE IS NOT NULL) A,
    BKG_CNTR_SEAL_NO S,
			BKG_CONTAINER CT
		WHERE A.BKG_NO = CT.BKG_NO (+)
			AND CT.BKG_NO = S.BKG_NO(+)
			AND CT.CNTR_NO = S.CNTR_NO(+) 
			--AND S.CSTMS_DIV_ID(+)= 'CTM'
		) A
	GROUP BY A.BKG_NO, A.CNTR_NO
	) S,
	BKG_VVD B, BKG_CONTAINER C, BKG_BOOKING K 
 WHERE 1=1
	AND B.BKG_NO 	= S.BKG_NO
	AND C.CNTR_NO	= S.CNTR_NO
	AND B.BKG_NO     = C.BKG_NO
	AND B.BKG_NO     = K.BKG_NO
    AND B.VSL_CD     = SUBSTR(@[vvd],1,4) 
    AND B.SKD_VOY_NO = SUBSTR(@[vvd],5,4) 
    AND B.SKD_DIR_CD = SUBSTR(@[vvd],9,1)
	--AND C.IBD_CNTR_STS_CD  = 'A'			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
