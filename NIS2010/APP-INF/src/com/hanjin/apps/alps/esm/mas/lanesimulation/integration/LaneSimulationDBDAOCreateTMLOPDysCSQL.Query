<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="LaneSimulationDBDAOCreateTMLOPDysCSQL">
			<desc><![CDATA[TMLOPDys creatation]]></desc>
			<sql><![CDATA[
	INSERT INTO MAS_SIM_TML_OP_DYS
    	 SELECT @[f_sim_dt] SIM_DT 
    	       ,@[f_sim_no] SIM_NO 
    	       ,D1.SECT_NO 
    	       ,D1.TML_CD 
    	       ,D1.VSL_DBL_CALL_SEQ 
    	       ,D1.SKD_DIR_CD 
    	       ,D1.TRD_CD 
    	       ,D1.RLANE_CD 
    	       ,D1.SEQ 
    	       ,D1.IOC_CD 
    	       ,DECODE(D1.SEQ,1,ABS(NVL(D1.PORT_DYS,0) * D1.RTO)*0.5,ABS(NVL(D1.PORT_DYS,0) * D1.RTO)) PORT_DYS -- 첫포트의 PORT DAYS는 50%
    	       ,ABS(NVL(D1.SEA_DYS,0) * DECODE(D1.TURN_PORT_IND_CD, 'F', 0 
    	                                                             ,DECODE(D1.IS_SEA_DYS_100_PCT, 'Y', 1,D1.RTO) 
    	                                      ) 
    	           ) SEA_DYS 
    	       ,DECODE(D1.SEQ,1,ABS(NVL(D1.PORT_DYS,0) * D1.RTO)*0.5,ABS(NVL(D1.PORT_DYS,0) * D1.RTO)) 
    	       +ABS(NVL(D1.SEA_DYS,0) * DECODE(D1.TURN_PORT_IND_CD, 'F', 0 
    	                                                             ,DECODE(D1.IS_SEA_DYS_100_PCT, 'Y', 1,D1.RTO) 
    	                                      ) 
    	           ) TOT_DYS 
    	       ,DECODE(D1.SEQ, 1, 0.5, D1.RTO) RTO 
    	       ,@[upd_usr_id] 
    	       ,SYSDATE 
    	       ,@[upd_usr_id] 
    	       ,SYSDATE 
    	   FROM ( 
    	         SELECT C1.SLAN_CD 
    	               ,C1.SECT_NO 
    	               ,C1.TRD_CD 
    	               ,C1.RLANE_CD 
    	               ,C1.SKD_DIR_CD 
    	               ,C1.TML_CD 
    	               ,C1.IOC_CD 
    	               ,C1.SEQ 
    	               ,C1.PORT_DYS 
    	               ,C1.SEA_DYS 
    	               ,C1.TURN_PORT_IND_CD 
    	               ,C1.TO_TURN_PORT_IND_CD 
    	               ,C1.VSL_DBL_CALL_SEQ 
    	               -- 1. 대륙이 바끼는 경우 운항일수 100% 적용 
    	               -- 2. IMS 의 내륙이고 SUB CONTI 가 바끼는 경우 운항일수 100% 적용 
    	               -- 3. ASIA <-> AUSTAILIA 구간인 경우 운항일수 100% 적용 
    	               -- (!주의) AUSTAILIA 의 CONTI 는 'A' 이다. 
    	               --         SUB CONTI 'AO' 국가는 많지만 운항을 안하기 때문에 SUB CONTI 로만 조건가능함 
    	               ,CASE WHEN (C1.FM_CONTI_CD <> C1.TO_CONTI_CD) 
    	                       OR (C1.TRD_CD = 'IMS' AND C1.FM_SCONTI_CD <> C1.TO_SCONTI_CD) 
    	                       OR (    C1.FM_CONTI_CD = 'A' 
    	                           AND C1.FM_SCONTI_CD <> C1.TO_SCONTI_CD 
    	                           AND (C1.FM_SCONTI_CD = 'AO' OR C1.TO_SCONTI_CD = 'AO') 
    	                          ) THEN 'Y' 
    	                     WHEN (C1.TURN_PORT_IND_CD = 'Y' AND C1.TO_TURN_PORT_IND_CD = 'N' AND C1.FM_CONTI_CD='A' AND C1.TO_CONTI_CD='A') THEN 'Y' 
    	                     WHEN (C1.IS_PRE_EGSUZ = 'Y' OR IS_PRE_PAPAC = 'Y') THEN 'Y' 
    	                     ELSE 'N' 
    	                END IS_SEA_DYS_100_PCT 
    	               ,DECODE(SIGN(C1.MIX_RTO) ,1, C1.MIX_RTO 
    	                                        ,DECODE(SIGN(C1.EGSUZ_RTO),1,C1.EGSUZ_RTO 
    	                                                                  ,DECODE(SIGN(C1.PNDLM_RTO), 1, C1.PNDLM_RTO, C1.OTHER_RTO) 
    	                                               ) 
    	                      ) RTO 
    	               ,DECODE(SIGN(C1.MIX_RTO) ,1, 'MIX_RTO' 
    	                                        ,DECODE(SIGN(C1.EGSUZ_RTO), 1, 'EGSUZ_RTO' 
    	                                                                  ,DECODE(SIGN(C1.PNDLM_RTO), 1, 'PNDLM_RTO', 'OTHER_RTO') 
    	                                               ) 
    	                      ) APPLY_RTO_NM 
    	           FROM ( 
    	                 SELECT B1.SLAN_CD 
    	                       ,B2.SECT_NO 
    	                       ,B2.TRD_CD 
    	                       ,B2.RLANE_CD 
    	                       ,B2.SKD_DIR_CD 
    	                       ,B1.TML_CD 
    	                       ,B1.SEQ 
    	                       ,B2.IOC_CD 
    	                       ,B1.PORT_DYS 
    	                       ,B1.SEA_DYS 
    	                       ,B1.TURN_PORT_IND_CD 
    	                       ,B1.TO_TURN_PORT_IND_CD 
    	                       ,B1.VSL_DBL_CALL_SEQ 
    	                       ,B1.FM_CONTI_CD 
    	                       ,B1.TO_CONTI_CD 
    	                       ,B1.FM_SCONTI_CD 
    	                       ,B1.TO_SCONTI_CD 
    	                       ,B2.FM_CNT 
    	                       ,B2.TO_CNT 
    	                       ,CASE WHEN (B1.SLAN_CD = 'MIX' OR B1.SLAN_CD = 'IMU') 
    	                              AND (B2.TRD_CD = 'TAS') 
    	                              AND (B1.FM_CONTI_CD = 'A' OR B1.PORT_CD = 'EGSUZ') THEN 'Y' 
    	                             ELSE 'N' 
    	                        END MIX_CASE 
    	                       -- MIX LANE에서 SAJED,AEKLF PORT는 APPLY RATIO 100% 적용 
    	                       ,CASE WHEN (B1.SLAN_CD = 'MIX') 
    	                              AND (B1.PORT_CD = 'SAJED' OR B1.PORT_CD = 'AEKLF') THEN 1 
    	                             ELSE 0 
    	                        END MIX_RTO 
    	                       -- 수에즈/파나마 운하 APPLY RATIO 100% 
    	                       ,CASE WHEN (B1.PORT_CD = 'EGSUZ') THEN 1 
    	                             ELSE 0 
    	                        END EGSUZ_RTO 
    	                       ,CASE WHEN (B1.PORT_CD = 'PAPAC') THEN 1 
    	                             ELSE 0 
    	                        END PAPAC_RTO 
    	                       -- 대륙을 3개를 운항하는 VVD - APPLY RATIO 50% 적용 
    	                       ,CASE WHEN (B1.PNDLM_CNT >= 3) THEN 0.5 
    	                             ELSE 0 
    	                        END PNDLM_RTO 
    	                       -- TURN_PORT_IND_CD 가 'Y' 이면 RATIO는 50% 아니면 100% 적용 
    	                       -- TURN_PORT_IND_CD 가 'Y'->'N' 이면 RATIO는 100% 적용 
    	                       ,CASE WHEN B1.TURN_PORT_IND_CD = 'N' THEN 1 
    	                             ELSE 0.5 
    	                        END OTHER_RTO 
    	                       ,CASE WHEN (B1.SKD_DIR_CD = 'E' 
    	                              AND LEAD(B1.PORT_CD) OVER(ORDER BY B1.SEQ) = 'EGSUZ') THEN 'Y' 
    	                             ELSE 'N' 
    	                        END IS_PRE_EGSUZ 
    	                       ,CASE WHEN (B1.SKD_DIR_CD = 'W' 
    	                              AND LEAD(B1.PORT_CD) OVER(ORDER BY B1.SEQ) = 'PAPAC') THEN 'Y' 
    	                             ELSE 'N' 
    	                        END IS_PRE_PAPAC 
    	                   FROM (-- TMNL 정보를 가지고 E/B, W/B 정보를 구분한다. 
    	                SELECT B1.SLAN_CD 
    	                      ,B1.TML_CD 
    	                      ,B1.PORT_CD 
    	                      ,B1.SKD_DIR_CD 
    	                      ,B1.SECT_NO 
    	                      ,ROW_NUMBER() OVER (ORDER BY B1.SECT_NO,B1.PORT_SEQ) SEQ 
    	                      ,ROW_NUMBER() OVER (PARTITION BY B1.SECT_NO ORDER BY B1.PORT_SEQ) PORT_SEQ 
    	                      ,B1.PORT_DYS 
    	                      ,B1.IOC_CD 
    	 				     ,DECODE(ROW_NUMBER() OVER(PARTITION BY SKD_DIR_CD ORDER BY SECT_NO, PORT_SEQ),
    	 											   COUNT(*) OVER(PARTITION BY SKD_DIR_CD),
    	 										       '0', SEA_DYS) SEA_DYS
    	                      ,B1.TURN_PORT_IND_CD 
    	                      ,NVL(LEAD(B1.TURN_PORT_IND_CD) OVER(PARTITION BY B1.SKD_DIR_CD ORDER BY B1.SECT_NO,B1.PORT_SEQ),' ') AS TO_TURN_PORT_IND_CD 
    	                      ,B1.VSL_DBL_CALL_SEQ 
    	                      ,B1.CONTI_CD AS FM_CONTI_CD 
    	                      ,B1.SCONTI_CD AS FM_SCONTI_CD 
    	                      ,NVL(LEAD(B1.CONTI_CD) OVER(PARTITION BY B1.SKD_DIR_CD ORDER BY B1.SECT_NO,B1.PORT_SEQ),' ') AS TO_CONTI_CD -- NEXT PORT의 CONTI 정보를 조회 
    	                      ,NVL(LEAD(B1.SCONTI_CD) OVER(PARTITION BY B1.SKD_DIR_CD ORDER BY B1.SECT_NO,B1.PORT_SEQ),' ') AS TO_SCONTI_CD -- NEXT PORT의 CONTI 정보를 조회 
    	                      ,COUNT(DISTINCT B1.CONTI_CD) OVER() PNDLM_CNT 
    	                  FROM ( 
    	                         -- TURN_PORT_IND_CD = Y 인 PORT 정보일 경우 ROW를 하나 더 만들고 BOUND를 반대로 만들어 주고 SEQ + MAX_SEQ 해서 SEQ를 구해준다 
    	                         SELECT /*+ LEADING(A1 A2 A4 A3) USE_NL(A1 A2) USE_HASH(A2) */
                                        DISTINCT 
    	                                @[f_slan_cd] AS SLAN_CD 
    	                               ,DECODE(A3.NUM, 1, A1.TML_CD 
    	                                             , 2, A1.TML_CD 
    	                                       ) TML_CD 
    	                               ,DECODE(A3.NUM, 1, SUBSTR(A1.TML_CD,1,5) 
    	                                             , 2, SUBSTR(A1.TML_CD,1,5) 
    	                                       ) PORT_CD 
    	                               ,DECODE(A3.NUM, 1, DECODE(A1.TURN_PORT_IND_CD, 'Y', DECODE(A1.SKD_DIR_CD,'E','W','E') , A1.SKD_DIR_CD) 
    	                                             , 2, A1.SKD_DIR_CD 
    	                                       ) SKD_DIR_CD 
    	                               ,DECODE(A3.NUM, 1, DECODE(A1.TURN_PORT_IND_CD, 'Y', A1.PORT_SEQ+MAX(A1.PORT_SEQ)OVER(), A1.PORT_SEQ) 
    	                                             , 2, A1.PORT_SEQ 
    	                                       ) PORT_SEQ 
    	                               ,DECODE(A3.NUM, 1, DECODE(A1.TURN_PORT_IND_CD, 'Y', A4.OTR_SECT, A4.SECT_NO) 
    	                                             , 2, A4.SECT_NO 
    	                                       ) SECT_NO 
    	                               ,A1.PORT_DYS 
    	                               ,A1.SEA_DYS 
    	                               ,A4.IOC_CD 
    	                               ,A1.TURN_PORT_IND_CD 
    	                               ,A1.VSL_DBL_CALL_SEQ 
    	                               ,DECODE(@[f_slan_cd],'INX',DECODE(A2.CONTI_CD,'F','A',A2.CONTI_CD) 
    	                                            ,'RES',DECODE(A2.CONTI_CD,'F','A',A2.CONTI_CD) 
    	                                            ,DECODE(A2.CONTI_CD,'F','E',A2.CONTI_CD) 
    	                                       ) CONTI_CD 
    	                               ,A2.SCONTI_CD 
    	                           FROM MAS_SIM_TML_INFO A1 
    	                               ,( 
    	                                 SELECT SECT_NO 
    	                                       ,NVL(LEAD(SECT_NO) OVER(ORDER BY SECT_NO) -- NEXT ROW의 SECTION NUMBER 조회 
    	                                           ,LAG(SECT_NO,1,0) OVER(ORDER BY SECT_NO) -- PREVIOUS ROW의 SECTION NUMBER 조회 
    	                                           ) OTR_SECT -- E/B, W/B 각각 서로의 SECTION NUMBER 정보를 조회 
    	                                       ,SKD_DIR_CD 
    	                                       ,IOC_CD 
    	                                   FROM( -- E/B, W/B 의 SECTION NUMBER의 최소값을 구한다. 
    	                                         SELECT MIN(SECT_NO) SECT_NO 
    	                                               ,SKD_DIR_CD 
    	                                               ,IOC_CD 
    	                                           FROM MAS_SIM_SVC_LANE 
    	                                          WHERE SIM_DT = @[f_sim_dt] 
    	                                            AND SIM_NO = @[f_sim_no] 
    	                                          GROUP BY SKD_DIR_CD,IOC_CD 
    	                                        ) 
    	                                 ) A4 
    	                               ,MDM_LOCATION A2 
    	                               ,(SELECT CPY_NO NUM FROM COM_CPY_NO WHERE CPY_NO BETWEEN 1 AND 2) A3 
    	                          WHERE 1=1 
    	                            AND A1.SKD_DIR_CD = A4.SKD_DIR_CD 
    	                            AND substr(A1.TML_CD,1,5) = A2.LOC_CD 
    	                            AND A1.SIM_DT     = @[f_sim_dt] 
    	                            AND A1.SIM_NO     = @[f_sim_no] 
    	                         ) B1 
    	                  ORDER BY B1.SECT_NO, B1.PORT_SEQ 
    	               ) B1 
    	                       ,( -- TRAD, RLANE, BOUND 별 포트정보 
    	                 SELECT DISTINCT A2.SECT_NO 
    	                       ,A2.TRD_CD 
    	                       ,A2.RLANE_CD 
    	                       ,A2.IOC_CD 
    	                       ,A1.SKD_DIR_CD 
                               ,CASE WHEN A1.IOC_CD = 'O' THEN LAG(A1.SEQ+1,1,1) OVER(ORDER BY A1.SECT_NO, A1.SEQ) 
                                     WHEN A1.IOC_CD = 'I' THEN MIN(A1.SEQ) OVER(PARTITION BY  A1.SKD_DIR_CD)
                                END FM_CNT 
                               ,CASE WHEN A1.IOC_CD = 'O' THEN LEAD(A1.SEQ,1) OVER(ORDER BY A1.SECT_NO, A1.SEQ) 
                                     WHEN A1.IOC_CD = 'I' THEN MAX(A1.SEQ) OVER(PARTITION BY A1.SKD_DIR_CD) 
                               END TO_CNT 
                           FROM (-- TMNL 정보를 가지고 E/B, W/B 정보를 구분한다. 
    	                SELECT B1.SLAN_CD 
    	                      ,B1.TML_CD 
    	                      ,B1.PORT_CD 
    	                      ,B1.SKD_DIR_CD 
    	                      ,B1.SECT_NO 
    	                      ,ROW_NUMBER() OVER (ORDER BY B1.SECT_NO,B1.PORT_SEQ) SEQ 
    	                      ,ROW_NUMBER() OVER (PARTITION BY B1.SECT_NO ORDER BY B1.PORT_SEQ) PORT_SEQ 
    	                      ,B1.PORT_DYS 
    	                      ,B1.IOC_CD 
    	 				     ,DECODE(ROW_NUMBER() OVER(PARTITION BY SKD_DIR_CD ORDER BY SECT_NO, PORT_SEQ),
    	 											   COUNT(*) OVER(PARTITION BY SKD_DIR_CD),
    	 										       '0', SEA_DYS) SEA_DYS
    	                      ,B1.TURN_PORT_IND_CD 
    	                      ,NVL(LEAD(B1.TURN_PORT_IND_CD) OVER(PARTITION BY B1.SKD_DIR_CD ORDER BY B1.SECT_NO,B1.PORT_SEQ),' ') AS TO_TURN_PORT_IND_CD 
    	                      ,B1.VSL_DBL_CALL_SEQ 
    	                      ,B1.CONTI_CD AS FM_CONTI_CD 
    	                      ,B1.SCONTI_CD AS FM_SCONTI_CD 
    	                      ,NVL(LEAD(B1.CONTI_CD) OVER(PARTITION BY B1.SKD_DIR_CD ORDER BY B1.SECT_NO,B1.PORT_SEQ),' ') AS TO_CONTI_CD -- NEXT PORT의 CONTI 정보를 조회 
    	                      ,NVL(LEAD(B1.SCONTI_CD) OVER(PARTITION BY B1.SKD_DIR_CD ORDER BY B1.SECT_NO,B1.PORT_SEQ),' ') AS TO_SCONTI_CD -- NEXT PORT의 CONTI 정보를 조회 
    	                      ,COUNT(DISTINCT B1.CONTI_CD) OVER() PNDLM_CNT 
    	                  FROM ( 
    	                         -- TURN_PORT_IND_CD = Y 인 PORT 정보일 경우 ROW를 하나 더 만들고 BOUND를 반대로 만들어 주고 SEQ + MAX_SEQ 해서 SEQ를 구해준다 
    	                         SELECT /*+ LEADING(A1 A2 A4 A3) USE_NL(A1 A2) USE_HASH(A2) */
                                        DISTINCT 
    	                                @[f_slan_cd] AS SLAN_CD 
    	                               ,DECODE(A3.NUM, 1, A1.TML_CD 
    	                                             , 2, A1.TML_CD 
    	                                       ) TML_CD 
    	                               ,DECODE(A3.NUM, 1, SUBSTR(A1.TML_CD,1,5) 
    	                                             , 2, SUBSTR(A1.TML_CD,1,5) 
    	                                       ) PORT_CD 
    	                               ,DECODE(A3.NUM, 1, DECODE(A1.TURN_PORT_IND_CD, 'Y', DECODE(A1.SKD_DIR_CD,'E','W','E') , A1.SKD_DIR_CD) 
    	                                             , 2, A1.SKD_DIR_CD 
    	                                       ) SKD_DIR_CD 
    	                               ,DECODE(A3.NUM, 1, DECODE(A1.TURN_PORT_IND_CD, 'Y', A1.PORT_SEQ+MAX(A1.PORT_SEQ)OVER(), A1.PORT_SEQ) 
    	                                             , 2, A1.PORT_SEQ 
    	                                       ) PORT_SEQ 
    	                               ,DECODE(A3.NUM, 1, DECODE(A1.TURN_PORT_IND_CD, 'Y', A4.OTR_SECT, A4.SECT_NO) 
    	                                             , 2, A4.SECT_NO 
    	                                       ) SECT_NO 
    	                               ,A1.PORT_DYS 
    	                               ,A1.SEA_DYS 
    	                               ,A4.IOC_CD 
    	                               ,A1.TURN_PORT_IND_CD 
    	                               ,A1.VSL_DBL_CALL_SEQ 
    	                               ,DECODE(@[f_slan_cd],'INX',DECODE(A2.CONTI_CD,'F','A',A2.CONTI_CD) 
    	                                            ,'RES',DECODE(A2.CONTI_CD,'F','A',A2.CONTI_CD) 
    	                                            ,DECODE(A2.CONTI_CD,'F','E',A2.CONTI_CD) 
    	                                       ) CONTI_CD 
    	                               ,A2.SCONTI_CD 
    	                           FROM MAS_SIM_TML_INFO A1 
    	                               ,( 
    	                                 SELECT SECT_NO 
    	                                       ,NVL(LEAD(SECT_NO) OVER(ORDER BY SECT_NO) -- NEXT ROW의 SECTION NUMBER 조회 
    	                                           ,LAG(SECT_NO,1,0) OVER(ORDER BY SECT_NO) -- PREVIOUS ROW의 SECTION NUMBER 조회 
    	                                           ) OTR_SECT -- E/B, W/B 각각 서로의 SECTION NUMBER 정보를 조회 
    	                                       ,SKD_DIR_CD 
    	                                       ,IOC_CD 
    	                                   FROM( -- E/B, W/B 의 SECTION NUMBER의 최소값을 구한다. 
    	                                         SELECT MIN(SECT_NO) SECT_NO 
    	                                               ,SKD_DIR_CD 
    	                                               ,IOC_CD 
    	                                           FROM MAS_SIM_SVC_LANE 
    	                                          WHERE SIM_DT = @[f_sim_dt] 
    	                                            AND SIM_NO = @[f_sim_no] 
    	                                          GROUP BY SKD_DIR_CD,IOC_CD 
    	                                        ) 
    	                                 ) A4 
    	                               ,MDM_LOCATION A2 
    	                               ,(SELECT CPY_NO NUM FROM COM_CPY_NO WHERE CPY_NO BETWEEN 1 AND 2) A3 
    	                          WHERE 1=1 
    	                            AND A1.SKD_DIR_CD = A4.SKD_DIR_CD 
    	                            AND substr(A1.TML_CD,1,5) = A2.LOC_CD
    	                            AND A1.SIM_DT     = @[f_sim_dt] 
    	                            AND A1.SIM_NO     = @[f_sim_no] 
    	                         ) B1 
    	                  ORDER BY B1.SECT_NO, B1.PORT_SEQ 
    	               ) A1 
                               ,(-- 행당 서비스에 TRADE, RLANE, BOUND 별 FROM CONTI, TO CONTI 정보를 조회한다 
    	               SELECT DISTINCT 
    	                      A1.TRD_CD 
    	                     ,A1.RLANE_CD 
    	                     ,A1.IOC_CD 
    	                     ,A1.VSL_SLAN_DIR_CD SKD_DIR_CD 
    	                     ,DECODE(@[f_slan_cd],'INX', DECODE(A1.FM_CONTI_CD,'F','A',A1.FM_CONTI_CD) 
    	                                  ,'RES', DECODE(A1.FM_CONTI_CD,'F','A',A1.FM_CONTI_CD) 
    	                                  ,DECODE(A1.FM_CONTI_CD,'F','E',A1.FM_CONTI_CD) 
    	                             ) FM_CONTI_CD 
    	                     ,DECODE(@[f_slan_cd],'INX', DECODE(A1.TO_CONTI_CD,'F','A',A1.TO_CONTI_CD) 
    	                                  ,'RES', DECODE(A1.TO_CONTI_CD,'F','A',A1.TO_CONTI_CD) 
    	                                  ,DECODE(A1.TO_CONTI_CD,'F','E',A1.TO_CONTI_CD) 
    	                             ) TO_CONTI_CD 
    	                     ,A2.SECT_NO 
                        FROM ( 
                              SELECT RLANE_CD, VSL_SLAN_DIR_CD, IOC_CD, FM_CONTI_CD, TO_CONTI_CD, TRD_CD, SUB_TRD_CD 
                                FROM MDM_DTL_REV_LANE 
                               WHERE DELT_FLG        = 'N' 
                               UNION ALL 
                              SELECT RLANE_CD, SKD_DIR_CD, IOC_CD, FM_CONTI_CD, TO_CONTI_CD, TRD_CD, SUB_TRD_CD 
                                FROM MAS_SIM_DTL_REV_LANE 
                             ) A1 
    	                     ,MAS_SIM_SVC_LANE A2 
    	                WHERE 1=1 
    	                  AND A1.TRD_CD          = A2.TRD_CD 
    	                  AND A1.RLANE_CD        = A2.RLANE_CD 
    	                  AND A1.VSL_SLAN_DIR_CD = A2.SKD_DIR_CD 
    	                  AND A1.IOC_CD          = A2.IOC_CD 
    	                  AND A2.SIM_DT          = @[f_sim_dt] 
    	                  AND A2.SIM_NO          = @[f_sim_no] 
    	              ) A2 
                          WHERE 1=1 
                            AND A1.SKD_DIR_CD  = A2.SKD_DIR_CD(+) 
                            AND A1.FM_CONTI_CD = A2.FM_CONTI_CD(+) 
                            AND A1.TO_CONTI_CD = A2.TO_CONTI_CD(+) 
                            AND ((A1.FM_CONTI_CD <> A1.TO_CONTI_CD AND A1.IOC_CD = 'O') 
                             OR  (A1.IOC_CD = 'I')) 
    	                ) B2 
    	                  WHERE 1=1 
    	                    AND B1.SEQ    BETWEEN B2.FM_CNT AND B2.TO_CNT 
    	                    AND B2.TRD_CD IS NOT NULL 
    	                  ORDER BY B2.SECT_NO, B2.FM_CNT,B1.SEQ 
    	                 ) C1 
    	          WHERE C1.MIX_CASE = 'N' 
    	        ) D1			]]></sql>
			<params>
				<param name="f_sim_dt" type="12" value="" out="Y"/>
				<param name="f_sim_no" type="12" value="" out="Y"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="f_slan_cd" type="12" value="" out="Y"/>
			</params>
		</query>
	</querys>
</sqls>
