<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLDocumentationCMDBDAOAddBkgBlDocCSQL">
			<desc><![CDATA[BKG_BL_DOC 저장]]></desc>
			<sql><![CDATA[
INSERT INTO bkg_bl_doc
        (bkg_no
		, act_wgt
		, act_wgt_prn_flg
		, wgt_ut_cd
        , MEAS_QTY
        , MEAS_UT_CD
        , bl_mv_tp_NM
        , vsl_nm
        , pre_vsl_nm
        , por_cd
        , por_nm
        , pol_cd
        , pol_nm
        , pod_cd
        , pod_nm
        , del_cd
        , del_nm
        , fnl_dest_nm
        , cre_usr_id
        , cre_dt
        , upd_usr_id
        , upd_dt)
select bk.bkg_no
		, @[act_wgt]
		, 'Y'
		, @[wgt_ut_cd]
        , 0
        , NVL((SELECT MEAS_UT_CD FROM BKG_USR_DFLT_SET WHERE USR_ID = @[cre_usr_id]),'CBM') AS MEAS_UT_CD
		, @[bl_mv_tp_nm]
		, (select vsl_eng_nm||' '||bk.skd_voy_no ||bk.skd_dir_cd from mdm_vsl_cntr where vsl_cd = bk.vsl_cd) vsl_nm
		, (select vsl_eng_nm||' '||vvd.skd_voy_no||vvd.skd_dir_cd
		     from mdm_vsl_cntr vsl, bkg_vvd vvd 
		    where vsl.vsl_cd         = vvd.vsl_cd
		      and vvd.vsl_pre_pst_cd = 'S'
		      and vvd.vsl_seq        = '1'
		      and vvd.bkg_no         = bk.bkg_no) pre_vsl_nm      
		, bk.por_cd
-- 기존에는 pod/del에 대해서만 YARD_NM_CONV 로직 적용 추후에 por/del에 대해서만 로직 2 적용
        , NVL((SELECT ATTR_CTNT2 FROM BKG_HRD_CDG_CTNT WHERE HRD_CDG_ID = 'YARD_NM_CONV' AND ATTR_CTNT1 = BK.POR_NOD_CD AND ATTR_CTNT3 = '2')
		  	 ,(select LOC_NM from mdm_location where loc_cd = bk.por_cd)) AS por_nm
		, bk.pol_cd
		, (select LOC_NM from mdm_location where loc_cd = bk.pol_cd) pol_nm
		, bk.pod_cd
		, NVL( (SELECT ATTR_CTNT2 FROM BKG_HRD_CDG_CTNT WHERE HRD_CDG_ID = 'YARD_NM_CONV' AND ATTR_CTNT1 = BK.POD_NOD_CD AND ATTR_CTNT3 = '1')
		      ,(select LOC_NM from mdm_location where loc_cd = bk.pod_cd)) pod_nm
		, bk.del_cd
--		, decode(bk.rcv_term_cd, 'Y', nvl(del_nm.attr_ctnt2, del.loc_nm), del.loc_nm) del_nm
-- NEW DELHI set 추가 Y term인 경우에 한해서	
		, decode(bk.rcv_term_cd, 'Y', decode(NVL(bk.del_nod_cd, ' '), 
										'INDELY1', 'ICD TUGHLAKABAD,NEW DELHI',
										'INDELY2', 'ICD PATPARGANJ, NEW DELHI',
		  								NVL( (SELECT ATTR_CTNT2 FROM BKG_HRD_CDG_CTNT WHERE HRD_CDG_ID = 'YARD_NM_CONV' AND ATTR_CTNT1 = BK.DEL_NOD_CD)
		  								    ,(select LOC_NM from mdm_location where loc_cd = bk.del_cd))),
								 NVL( (SELECT ATTR_CTNT2 FROM BKG_HRD_CDG_CTNT WHERE HRD_CDG_ID = 'YARD_NM_CONV' AND ATTR_CTNT1 = BK.DEL_NOD_CD)
		  						     ,(select LOC_NM from mdm_location where loc_cd = bk.del_cd))) AS DEL_NM
		, nvl(@[fnl_dest_nm],
          (select final_nm.attr_ctnt2
		     from bkg_hrd_cdg_ctnt final_nm
		    where bk.pod_cd         = final_nm.attr_ctnt1(+)
		      and 'BL_FINAL_NAME'   = final_nm.hrd_cdg_id(+))) final_nm
		, @[cre_usr_id]
		, sysdate
		, @[upd_usr_id]
		, sysdate
  from bkg_booking bk
		, mdm_location del
		, bkg_hrd_cdg_ctnt del_nm
 where bk.bkg_no        = @[bkg_no]
   and bk.del_cd        = del.loc_cd	
   and bk.del_cd||SUBSTR(bk.del_nod_cd, 6, 2) = del_nm.attr_ctnt1(+)
   and 'BL_DEL_NAME'            = del_nm.hrd_cdg_id(+)			]]></sql>
			<params>
				<param name="act_wgt" type="12" value=" " out="N"/>
				<param name="wgt_ut_cd" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="bl_mv_tp_nm" type="12" value="" out="N"/>
				<param name="fnl_dest_nm" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
