<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="NetworkCostDBDAOSearchDailyHireListRSQL">
			<desc><![CDATA[SearchDailyHireList SELECT]]></desc>
			<sql><![CDATA[
SELECT
    FLAG                FLAG
   ,COST_YRMON          COST_YRMON
   ,COST_WK             COST_WK
   ,VSL_CD              VSL_CD
   ,CHRG_CTRT_NO        CHRG_CTRT_NO
   ,CHRG_CTRT_SEQ       CHRG_CTRT_SEQ
   ,NUM                 NUM
   ,CTRT_EFF_FM_DT      CTRT_EFF_FM_DT
   ,CTRT_EFF_TO_DT      CTRT_EFF_TO_DT
   ,N1ST_HIR_RT         N1ST_HIR_RT
   ,N1ST_CURR_CD        N1ST_CURR_CD
   ,N2ND_HIR_RT         N2ND_HIR_RT
   ,N2ND_CURR_CD        N2ND_CURR_CD
   ,CHRG_DHIR_AMT       CHRG_DHIR_AMT
FROM (
        SELECT 
             DECODE(NVL(C1.VSL_CD,''),'','I', 'R' )                                                                     FLAG
           , C3.COST_YRMON                                                                                              COST_YRMON
           , C3.COST_WK                                                                                                 COST_WK
           , C3.VSL_CD                                                                                                  VSL_CD
           , C2.CHRG_CTRT_NO                                                                                            CHRG_CTRT_NO
           , C2.CHRG_CTRT_SEQ                                                                                           CHRG_CTRT_SEQ
           , ROW_NUMBER() OVER (PARTITION BY C3.COST_YRMON, C3.VSL_CD, C2.CHRG_CTRT_NO ORDER BY C2.CHRG_CTRT_SEQ DESC)  NUM
           , C2.CTRT_EFF_FM_DT                                                                                          CTRT_EFF_FM_DT
           , C2.CTRT_EFF_TO_DT                                                                                          CTRT_EFF_TO_DT
           , C2.N1ST_HIR_RT                                                                                             N1ST_HIR_RT
           , C2.N1ST_CURR_CD                                                                                            N1ST_CURR_CD
           , C2.N2ND_HIR_RT                                                                                             N2ND_HIR_RT
           , C2.N2ND_CURR_CD                                                                                            N2ND_CURR_CD
           , NVL (C1.CHRG_DHIR_AMT, 0)                                                                                  CHRG_DHIR_AMT
          FROM MAS_CHRG_VSL_DLY_HIR C1
             , MAS_VSL_CHRG_IF C2
             , (
                SELECT
                #if (${yrType} == 'yrwk')
                     DISTINCT MIN(B1.SLS_YRMON) OVER() MIN_YRMON
                   , B1.SLS_YRMON COST_YRMON
                #else
                     DISTINCT MIN(B1.COST_YRMON) OVER() MIN_YRMON
                   , B1.COST_YRMON COST_YRMON
                #end
                   , B1.COST_WK
                   , B1.VSL_CD
                  FROM MAS_MON_VVD B1
                     ,(
                       SELECT
                           A1.VSL_SEQ        VSL_SEQ
                          ,A1.VSL_CD         VSL_CD
                          ,A1.VSL_TP_CD      VSL_TP_CD
                          ,A1.VSL_OSHP_CD    VSL_OSHP_CD
                          ,A1.VOP_CD         VOP_CD
                          ,A1.PORT_CLSS_CAPA PORT_CLSS_CAPA
                          ,A1.VSL_CLSS_CAPA  VSL_CLSS_CAPA
                          ,A1.VSL_APLY_FM_DT FM_DT
                          ,A1.VSL_APLY_TO_DT TO_DT
                         FROM MAS_VSL_RGST A1
                        WHERE 1 = 1
                          AND NVL(A1.DELT_FLG, 'N') = 'N'
                      ) B2
                 #if (${yrType} == 'yrwk')
                    WHERE B1.SLS_YRMON  LIKE @[sls_yrmon]||'%'
                      AND B1.COST_WK = @[cost_wk]
                 #else
                    WHERE B1.COST_YRMON  LIKE @[sls_yrmon]||@[cost_wk]
                 #end

                 AND B1.VSL_CD      = B2.VSL_CD
                 AND B1.VSL_CD      LIKE @[vsl_cd] || '%'
                 AND B1.DELT_FLG   <> 'Y'
                 AND B2.VSL_TP_CD   = 'C'
                 AND B2.VSL_OSHP_CD = 'CHT'
                 AND TO_CHAR(B1.N1ST_LODG_PORT_ETD_DT, 'YYYYMMDD')
                     BETWEEN NVL(TO_CHAR(B2.FM_DT, 'YYYYMMDD'), '19000101')
                     AND     NVL(TO_CHAR(B2.TO_DT, 'YYYYMMDD'), '99991231')
				AND B1.SUB_TRD_CD <> 'IP'
               ) C3
         #if (${rtnRow} >= 2)
       WHERE C3.COST_YRMON = C2.COST_YRMON(+)
         #else
       WHERE C3.MIN_YRMON = C2.COST_YRMON(+)
         #end

         AND C3.VSL_CD     = C2.VSL_CD(+)
         AND C3.COST_YRMON = C1.COST_YRMON(+)
         AND C3.VSL_CD     = C1.VSL_CD(+)
      )
  WHERE NUM = 1
  ORDER BY COST_YRMON
          ,COST_WK
          ,VSL_CD
          ,CHRG_CTRT_NO			]]></sql>
			<params>
				<param name="sls_yrmon" type="12" value="" out="Y"/>
				<param name="cost_wk" type="12" value="" out="Y"/>
				<param name="vsl_cd" type="12" value="" out="Y"/>
			</params>
		</query>
	</querys>
</sqls>
