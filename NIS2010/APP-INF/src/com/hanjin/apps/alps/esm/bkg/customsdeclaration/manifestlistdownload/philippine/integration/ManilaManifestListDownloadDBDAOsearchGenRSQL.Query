<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ManilaManifestListDownloadDBDAOsearchGenRSQL">
			<desc><![CDATA[Piliphine Manifest 화면의 Gen Tab의 정보 조회]]></desc>
			<sql><![CDATA[
SELECT REG_NO,
       ETA_DT,
	   ETA_TM,
       POR_CD,
	   DEL_CD,
	   CRR_CD,
	   CRR_NM,
	   CRR_ADDR1,
  	   CRR_ADDR2,
	   CRR_ADDR3,
	   CRR_ADDR4,
	   TRSP_MOD,
	   TRSP_ID,
	   TRSP_NTLT,
	   PLZ_REG,
	   TRSP_REG_NO,
	   TRSP_REG_DT,
	   VVD,
	   POR,
	   MST_INFO2,
	   NET_TON,
	   GRS_TON,
       TOT_BL,
       TOT_CNTR,
       ROWNUM AS SEQ     
  FROM (SELECT REG_NO,
               ETA_DT,
               ETA_TM,
               POR_CD,
               DEL_CD,
               CRR_CD,
               CRR_NM,
               CRR_ADDR1,
               CRR_ADDR2,
               CRR_ADDR3,
               CRR_ADDR4,
               TRSP_MOD,
               TRSP_ID,
               TRSP_NTLT,
               PLZ_REG,
               TRSP_REG_NO,
               TRSP_REG_DT,
               VVD,
               POR,
               MST_INFO2,
               NET_TON,
               GRS_TON,      
               COUNT(BL_NO) AS TOT_BL,
               SUM(CNTR_CNT) AS TOT_CNTR
  		  FROM (SELECT @[reg_no]||'-'||TO_CHAR(SYSDATE, 'YY') AS REG_NO,
	            	   TO_CHAR(VPS.VPS_ETA_DT,'YYYYMMDD') AS ETA_DT,
			   		   TO_CHAR(VPS.VPS_ETA_DT,'HH24:MI:SS') AS ETA_TM,
			   		   NVL(VVD.POL_CD, 'XXXXX') AS POR_CD,
	           		   VVD.POD_CD AS DEL_CD, 
			   		   SUBSTR(@[reg_no], 1,3) AS CRR_CD,
	           		   NVL(SUBSTR(MVC.VSL_ENG_NM,1,10), 'NO CARRIER NAME SPECIFIED') AS CRR_NM,
			   		   '' AS CRR_ADDR1,
			   		   '' AS CRR_ADDR2,
			   	 	   '' AS CRR_ADDR3,
			   		   '' AS CRR_ADDR4,
			   		   '1' AS TRSP_MOD,
	           		   NVL(SUBSTR(MVC.VSL_ENG_NM,1,10), 'NO VESSEL NAME SPECIFIED') AS TRSP_ID,
			   		   NVL(VSL_RGST_CNT_CD, 'PH') AS TRSP_NTLT,
			   		   '' AS PLZ_REG,
			   		   '' AS TRSP_REG_NO,
			   		   '' AS TRSP_REG_DT,
			   		   NVL(VVD.VSL_CD||VVD.SKD_VOY_NO||VVD.SKD_DIR_CD, 'NO VOYAGE NUMBER SPECIFIED') AS VVD,
			   		   NVL(VVD.POL_CD, 'NO COUNTRY OF ORIGIN SPECIFIED') AS POR,
			   		   '' AS MST_INFO2,
			   		   '' AS NET_TON,
			   		   '' AS GRS_TON,
                       VVD.BKG_NO BL_NO,
                       COUNT(CNT.CNTR_NO) CNTR_CNT
	     		  FROM VSK_VSL_PORT_SKD VPS,
	           		   MDM_VSL_CNTR MVC,
	           		   BKG_VVD VVD,
                       BKG_BOOKING BKG,
                       BKG_CONTAINER CNT
	     		 WHERE MVC.VSL_CD        = VVD.VSL_CD
	       		   AND VPS.VSL_CD        = VVD.VSL_CD
	       		   AND VPS.SKD_VOY_NO    = VVD.SKD_VOY_NO
	       		   AND VPS.SKD_DIR_CD    = VVD.SKD_DIR_CD
				   AND VPS.VPS_PORT_CD   = VVD.POD_CD
                   AND VVD.BKG_NO        = BKG.BKG_NO
                   AND VVD.BKG_NO        = CNT.BKG_NO(+)
                   AND BKG.BKG_STS_CD IN ('F','W') 
#if (${vsl_cd}!= '') 	
           		   AND VVD.VSL_CD        = @[vsl_cd] 
#end
#if (${skd_voy_no}!= '') 
           		   AND VVD.SKD_VOY_NO    = @[skd_voy_no]
#end
#if (${skd_dir_cd}!= '') 
           		   AND VVD.SKD_DIR_CD    = @[skd_dir_cd]
#end
#if (${pol_cd}!= '') 
		           AND VVD.POL_CD        = @[pol_cd] 
#end
#if (${pod_cd}!= '') 
			       AND VVD.POD_CD        = @[pod_cd] 
#end
                 GROUP BY VVD.BKG_NO, VVD.POD_CD, VPS.VPS_ETA_DT, VVD.POL_CD, MVC.VSL_ENG_NM, VSL_RGST_CNT_CD, VVD.VSL_CD, VVD.SKD_VOY_NO, VVD.SKD_DIR_CD
			  )
         GROUP BY POR_CD, REG_NO, ETA_DT, ETA_TM, DEL_CD, CRR_CD, CRR_NM, CRR_ADDR1, CRR_ADDR2, CRR_ADDR3, CRR_ADDR4, TRSP_MOD, 
                  TRSP_ID, TRSP_NTLT, PLZ_REG, TRSP_REG_NO, TRSP_REG_DT, VVD, POR, MST_INFO2, NET_TON, GRS_TON  
		)			]]></sql>
			<params>
				<param name="reg_no" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
