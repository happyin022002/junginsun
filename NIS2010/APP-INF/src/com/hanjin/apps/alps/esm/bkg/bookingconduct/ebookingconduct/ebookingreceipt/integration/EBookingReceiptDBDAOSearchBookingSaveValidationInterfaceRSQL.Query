<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EBookingReceiptDBDAOSearchBookingSaveValidationInterfaceRSQL">
			<desc><![CDATA[external request 처리를 위해 external rqst의 Booking 정보를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT CASE WHEN     M.POR_CD = B.POR_CD AND M.POL_CD = B.POL_CD 
                 AND M.POD_CD = B.POD_CD AND M.DEL_CD = B.DEL_CD 
                 AND M.CMDT_CD = B.CMDT_CD 
                 AND (M.CTRT_NO = B.SC_NO OR M.CTRT_NO = B.RFA_NO OR M.CTRT_NO = B.TAA_NO)
                 AND S.CNT_CD = SH.CUST_CNT_CD AND S.CUST_SEQ = SH.CUST_SEQ
                 AND M.VSL_CD||M.SKD_VOY_NO||M.SKD_DIR_CD = B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD
                 THEN 'N'
             ELSE 'Y'
       END ALOC_CHK_FLG,  -- qty  변경케이스는 Manual Upload대상이어서 체크대상에서 제외함
       CASE WHEN M.VSL_CD||M.SKD_VOY_NO||M.SKD_DIR_CD = B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD
                AND M.POD_CD = B.POD_CD 
                AND M.POD_NOD_CD = B.POD_NOD_CD
                THEN 'N'
             ELSE 'Y'
       END CHECK_TS_CLOSE_FLAG,
       CASE WHEN 0 < (SELECT COUNT(CHG_CD) FROM BKG_CHG_RT WHERE BKG_NO = M.BKG_NO) THEN 'Y'
            ELSE 'N'
       END IS_RATED_FLG,
       'Y' MODIFY_FLAG,
       'Y' CONTACT_MODIFY_FLAG,
       'Y' CUSTOMER_MODIFY_FLAG,
       'Y' QTY_MODIFY_FLAG,
       'Y' ROUTE_MODIFY_FLAG,
	   'N' CUST_NTC_FLG       
FROM BKG_XTER_RQST_MST M, BKG_XTER_CUST S,
     BKG_BOOKING B, BKG_CUSTOMER SH
WHERE M.XTER_SNDR_ID = @[xter_sndr_id]
AND M.XTER_RQST_NO = @[xter_rqst_no]
AND M.XTER_RQST_SEQ = @[xter_rqst_seq]
AND M.XTER_SNDR_ID = S.XTER_SNDR_ID(+)
AND M.XTER_RQST_NO = S.XTER_RQST_NO(+)
AND M.XTER_RQST_SEQ = S.XTER_RQST_SEQ(+)
AND M.BKG_NO = B.BKG_NO(+)
AND B.BKG_NO = SH.BKG_NO(+)
AND 'S' = SH.BKG_CUST_TP_CD(+)			]]></sql>
			<params>
				<param name="xter_sndr_id" type="12" value="" out="N"/>
				<param name="xter_rqst_no" type="12" value="" out="N"/>
				<param name="xter_rqst_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
