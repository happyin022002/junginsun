<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingMasterMgtDBDAOSearchRestrictCmdtListRSQL">
			<desc><![CDATA[BKG_IMP_RSTR_CMDT 조회]]></desc>
			<sql><![CDATA[
SELECT 
	CMDT.RGN_OFC_CD,
	CMDT.CNT_CD,
	DECODE(CMDT.LOC_CD,'*****','ALL',CMDT.LOC_CD) LOC_CD,
	CMDT.DP_SEQ,
	RSTR_CMDT_NM,
	PROHI_CMDT_NM,
	TO_CHAR(EFF_DT,'YYYY-MM-DD') EFF_DT,
	TO_CHAR(EXP_DT,'YYYY-MM-DD') EXP_DT,
	WEB_SITE_URL,
	INTER_RMK,
	BKG_JOIN_FNC(CURSOR(SELECT FILE_NM FROM BKG_IMP_IMG_STO WHERE RGN_OFC_CD = CMDT.RGN_OFC_CD and LOC_CD = CMDT.LOC_CD and DP_SEQ = CMDT.DP_SEQ and CNT_CD = CMDT.CNT_CD)) FILE_UPLD_NM,
    FILE_SAV.FILE_SAV_ID,
	UPD_USR_ID,
	TO_CHAR(UPD_DT,'YYYY-MM-DD HH24:MI:SS') UPD_DT,
	RSTR_CMDT_GRP_NM,
	DECODE(NVL(TS_FLG, 'N'), 'N', 0,  1) TS_FLG,
	DECODE(NVL(FROB_FLG, 'N'), 'N', 0,  1) FROB_FLG
FROM BKG_IMP_RSTR_CMDT CMDT,
	(SELECT
		RGN_OFC_CD,
		CNT_CD,
		LOC_CD,
		DP_SEQ,
		IMG.FILE_SAV_ID
	 FROM 
		BKG_IMP_IMG_STO IMG,
		COM_UPLD_FILE UPLD
	 WHERE 
		IMG.FILE_SAV_ID = UPLD.FILE_SAV_ID(+)
	 ) FILE_SAV
WHERE 
	CMDT.RGN_OFC_CD = FILE_SAV.RGN_OFC_CD(+) 
AND CMDT.LOC_CD     = FILE_SAV.LOC_CD(+) 
AND CMDT.DP_SEQ     = FILE_SAV.DP_SEQ(+) 
AND CMDT.CNT_CD     = FILE_SAV.CNT_CD(+)

#if (${rgn_ofc_cd} != 'ALL') 
  AND CMDT.RGN_OFC_CD = @[rgn_ofc_cd]
#end

#if (${cnt_cd} != '')
 AND CMDT.CNT_CD = @[cnt_cd]
#end

#if (${loc_cd} != '')
	AND ((CMDT.LOC_CD LIKE DECODE(@[loc_cd],'ALL','*****',@[loc_cd]) || '%' ) OR (CMDT.CNT_CD = SUBSTR(DECODE(@[loc_cd],'ALL','*****',@[loc_cd]),1,2) AND CMDT.LOC_CD = '*****'))
#end

#if (${eff_dt} != '')
 AND TO_DATE(@[eff_dt],'YYYY-MM-DD') BETWEEN EFF_DT AND NVL(EXP_DT,TO_DATE('9999-12-31','YYYY-MM-DD'))
#end

#if (${commodities} != '')
 AND ((UPPER(RSTR_CMDT_NM) LIKE UPPER(@[commodities])||'%') OR (UPPER(PROHI_CMDT_NM) LIKE UPPER(@[commodities])||'%'))
#end
ORDER BY RGN_OFC_CD, CNT_CD, LOC_CD, RSTR_CMDT_NM, PROHI_CMDT_NM			]]></sql>
			<params>
				<param name="rgn_ofc_cd" type="12" value="" out="N"/>
				<param name="cnt_cd" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
				<param name="eff_dt" type="12" value="" out="N"/>
				<param name="commodities" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
