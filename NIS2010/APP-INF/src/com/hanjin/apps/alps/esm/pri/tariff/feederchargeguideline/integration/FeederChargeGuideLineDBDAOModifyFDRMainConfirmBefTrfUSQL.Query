<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="FeederChargeGuideLineDBDAOModifyFDRMainConfirmBefTrfUSQL">
			<desc><![CDATA[Modify FDR Main Confirm BefTrf]]></desc>
			<sql><![CDATA[
UPDATE PRI_TRF_FDR_MN
   SET EXP_DT     = TO_DATE(@[eff_dt], 'YYYY-MM-DD')-1
     , UPD_USR_ID = @[upd_usr_id]
     , UPD_DT     = SYSDATE
 WHERE ( SVC_SCP_CD, FDR_TRF_NO, AMDT_SEQ, ORG_DEST_TP_CD ) IN      
    (
        SELECT MN.SVC_SCP_CD
             , TRF.FDR_TRF_NO
             , MAX(MN.AMDT_SEQ) AMDT_SEQ
             , MN.ORG_DEST_TP_CD
          FROM PRI_TRF_FDR_MN MN
             , (SELECT MAX(MN.FDR_TRF_NO) FDR_TRF_NO
                     , MN.SVC_SCP_CD
                     , MN.ORG_DEST_TP_CD
                  FROM PRI_TRF_FDR_HDR HDR
                     , PRI_TRF_FDR_MN MN
                 WHERE 1=1
                   AND MN.SVC_SCP_CD   = @[svc_scp_cd]
                   AND MN.ORG_DEST_TP_CD = @[org_dest_tp_cd] 
                   AND MN.FIC_PROP_STS_CD = 'C'
                   AND MN.SVC_SCP_CD = HDR.SVC_SCP_CD
                   AND MN.FDR_TRF_NO = HDR.FDR_TRF_NO     
                   AND MN.ORG_DEST_TP_CD = HDR.ORG_DEST_TP_CD
                   AND HDR.RHQ_CD = @[rhq_cd]
              GROUP BY MN.SVC_SCP_CD, MN.ORG_DEST_TP_CD
               ) TRF
         WHERE 1=1
           AND MN.FDR_TRF_NO = TRF.FDR_TRF_NO
           AND MN.SVC_SCP_CD = TRF.SVC_SCP_CD
           AND MN.ORG_DEST_TP_CD = TRF.ORG_DEST_TP_CD
      GROUP BY MN.SVC_SCP_CD, TRF.FDR_TRF_NO, MN.ORG_DEST_TP_CD
    )			]]></sql>
			<params>
				<param name="eff_dt" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="org_dest_tp_cd" type="12" value="" out="N"/>
				<param name="rhq_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
