/*=========================================================
*Copyright(c) 2015 CyberLogitec
*@FileName : AGNCommRequestDBDAOModifyCoaComCostAmtUSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2015.06.24
*@LastModifier : 
*@LastVersion : 1.0
* 2015.06.24 
* 1.0 Creation
=========================================================*/
package com.hanjin.apps.alps.esm.acm.acmrequest.agncommrequest.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.hanjin.framework.support.db.ISQLTemplate;

/**
 *
 * @author 
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class AGNCommRequestDBDAOModifyCoaComCostAmtUSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * ModifyCoaComCostAmt
	  * </pre>
	  */
	public AGNCommRequestDBDAOModifyCoaComCostAmtUSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("bkg_no",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.hanjin.apps.alps.esm.acm.acmrequest.agncommrequest.integration").append("\n"); 
		query.append("FileName : AGNCommRequestDBDAOModifyCoaComCostAmtUSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("UPDATE /*+ bypass_ujvc */ " ).append("\n"); 
		query.append("         (" ).append("\n"); 
		query.append("               SELECT " ).append("\n"); 
		query.append("                      CPA.ESTM_UC_AMT                                      AS CPA_ESTM_UC_AMT, " ).append("\n"); 
		query.append("                 CASE " ).append("\n"); 
		query.append("                 WHEN SIGN (CST.UNIT_COST) = -1 " ).append("\n"); 
		query.append("                 THEN 0 " ).append("\n"); 
		query.append("                 ELSE CST.UNIT_COST " ).append("\n"); 
		query.append("                  END                                                      AS CST_ESTM_UC_AMT, " ).append("\n"); 
		query.append("                      CPA.RESPB_UC_AMT                                     AS CPA_RESPB_UC_AMT, " ).append("\n"); 
		query.append("                 CASE " ).append("\n"); 
		query.append("                 WHEN SIGN (CST.UNIT_COST) = -1 " ).append("\n"); 
		query.append("                 THEN 0 " ).append("\n"); 
		query.append("                 ELSE CST.UNIT_COST " ).append("\n"); 
		query.append("                  END                                                      AS CST_RESPB_UC_AMT, " ).append("\n"); 
		query.append("                      CPA.COST_ASS_BSE_CD                                  AS CPA_COST_ASS_BSE_CD, " ).append("\n"); 
		query.append("                      'C'                                                  AS CST_COST_ASS_BSE_CD " ).append("\n"); 
		query.append("                 FROM MAS_COM_COST_PARA CPA, " ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                          SELECT " ).append("\n"); 
		query.append("                                 AGT.BKG_NO, " ).append("\n"); 
		query.append("                                 PCT.PCTL_NO, " ).append("\n"); 
		query.append("                                 AGT.COMM_STND_COST_CD, " ).append("\n"); 
		query.append("                                 AGT.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("                                 SUM (AGT.UNIT_COST) AS UNIT_COST " ).append("\n"); 
		query.append("                            FROM " ).append("\n"); 
		query.append("                               (" ).append("\n"); 
		query.append("                                     SELECT " ).append("\n"); 
		query.append("                                            DST.BKG_NO, " ).append("\n"); 
		query.append("                                            DST.COMM_STND_COST_CD, " ).append("\n"); 
		query.append("                                            DST.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("                                       CASE " ).append("\n"); 
		query.append("                                       WHEN DST.OP_CNTR_QTY = 0 " ).append("\n"); 
		query.append("                                       THEN 0 " ).append("\n"); 
		query.append("                                       WHEN DST.QTY_RATIO = 1 " ).append("\n"); 
		query.append("                                       THEN ROUND (DST.UNIT_COST / DST.OP_CNTR_QTY, 2) " ).append("\n"); 
		query.append("                                       WHEN DST.RNUM = DST.MNUM " ).append("\n"); 
		query.append("                                       THEN ROUND " ).append("\n"); 
		query.append("                                          ( " ).append("\n"); 
		query.append("                                          ( DST.UNIT_COST " ).append("\n"); 
		query.append("                                          + ROUND (DST.UNIT_COST * DST.QTY_RATIO, 2) " ).append("\n"); 
		query.append("                                          - SUM (ROUND (DST.UNIT_COST * DST.QTY_RATIO, 2)) " ).append("\n"); 
		query.append("                                            OVER " ).append("\n"); 
		query.append("                                          ( " ).append("\n"); 
		query.append("                                  PARTITION " ).append("\n"); 
		query.append("                                         BY DST.BKG_NO, " ).append("\n"); 
		query.append("                                            DST.COMM_STND_COST_CD " ).append("\n"); 
		query.append("                                   ORDER BY DST.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("                                          ) " ).append("\n"); 
		query.append("                                          ) " ).append("\n"); 
		query.append("                                          / DST.OP_CNTR_QTY " ).append("\n"); 
		query.append("                                          , 2 " ).append("\n"); 
		query.append("                                          ) " ).append("\n"); 
		query.append("                                       ELSE ROUND (DST.UNIT_COST * DST.QTY_RATIO / DST.OP_CNTR_QTY, 2) " ).append("\n"); 
		query.append("                                        END                                          AS UNIT_COST " ).append("\n"); 
		query.append("                                       FROM " ).append("\n"); 
		query.append("                                          ( " ).append("\n"); 
		query.append("                                                SELECT " ).append("\n"); 
		query.append("                                                       AGN.BKG_NO, " ).append("\n"); 
		query.append("                                                       AGN.COMM_STND_COST_CD, " ).append("\n"); 
		query.append("                                                       TZD.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("                                                       TZD.QTY_RATIO, " ).append("\n"); 
		query.append("                                                       TZD.OP_CNTR_QTY, " ).append("\n"); 
		query.append("                                                       ROUND " ).append("\n"); 
		query.append("                                                     ( SUM " ).append("\n"); 
		query.append("                                                     ( " ).append("\n"); 
		query.append("                                                  CASE " ).append("\n"); 
		query.append("                                                  WHEN SUBSTR (AGN.AGN_CD, 4, 2) = 'BB' " ).append("\n"); 
		query.append("                                                  THEN 0 " ).append("\n"); 
		query.append("                                                  WHEN TZD.OP_CNTR_QTY           = 0 " ).append("\n"); 
		query.append("                                                  THEN 0 " ).append("\n"); 
		query.append("                                                  ELSE AGN.IF_AMT " ).append("\n"); 
		query.append("                                                   END " ).append("\n"); 
		query.append("                                                     ) " ).append("\n"); 
		query.append("                                                     , 2 " ).append("\n"); 
		query.append("                                                     )                                                     AS UNIT_COST, " ).append("\n"); 
		query.append("                                                       TZD.RNUM, " ).append("\n"); 
		query.append("                                                       TZD.MNUM " ).append("\n"); 
		query.append("                                                  FROM ACM_AGN_COMM AGN, " ).append("\n"); 
		query.append("                                                     ( " ).append("\n"); 
		query.append("                                                           SELECT " ).append("\n"); 
		query.append("                                                                  INF.BKG_NO, " ).append("\n"); 
		query.append("                                                                  QTY.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("                                                                  SUM (QTY.OP_CNTR_QTY)                   AS OP_CNTR_QTY, " ).append("\n"); 
		query.append("                                                                  RATIO_TO_REPORT " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                                  SUM " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                             CASE " ).append("\n"); 
		query.append("                                                             WHEN SUBSTR (QTY.CNTR_TPSZ_CD, 2, 1) = '2' " ).append("\n"); 
		query.append("                                                             THEN QTY.OP_CNTR_QTY " ).append("\n"); 
		query.append("                                                             ELSE QTY.OP_CNTR_QTY * 2 " ).append("\n"); 
		query.append("                                                              END " ).append("\n"); 
		query.append("                                                                ) " ).append("\n"); 
		query.append("                                                                ) " ).append("\n"); 
		query.append("                                                                  OVER " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                        PARTITION " ).append("\n"); 
		query.append("                                                               BY INF.BKG_NO " ).append("\n"); 
		query.append("                                                                )                                         AS QTY_RATIO, " ).append("\n"); 
		query.append("                                                                  RANK() OVER " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                        PARTITION " ).append("\n"); 
		query.append("                                                               BY INF.BKG_NO " ).append("\n"); 
		query.append("                                                         ORDER BY QTY.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("                                                                )                                         AS RNUM, " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                                       SELECT " ).append("\n"); 
		query.append("                                                                             COUNT (DISTINCT QTY.CNTR_TPSZ_CD) " ).append("\n"); 
		query.append("                                                                       FROM BKG_BL_DOC     DOC, " ).append("\n"); 
		query.append("                                                                            BKG_BOOKING    BKG, " ).append("\n"); 
		query.append("                                                                            BKG_BOOKING    BK2, " ).append("\n"); 
		query.append("                                                                            BKG_QUANTITY   QTY " ).append("\n"); 
		query.append("                                                                      WHERE DOC.BKG_NO              = QTY.BKG_NO " ).append("\n"); 
		query.append("                                                                        AND " ).append("\n"); 
		query.append("                                                                          ( " ).append("\n"); 
		query.append("                                                                            DOC.BKG_NO              = BKG.BKG_NO " ).append("\n"); 
		query.append("                                                                         OR " ).append("\n"); 
		query.append("                                                                            DOC.MST_CVRD_BL_NO      = BKG.BL_NO " ).append("\n"); 
		query.append("                                                                          ) " ).append("\n"); 
		query.append("                                                                        AND DOC.BKG_NO              = BK2.BKG_NO " ).append("\n"); 
		query.append("                                                                        AND BK2.BL_NO_TP          <>  '9' " ).append("\n"); 
		query.append("                                                                        AND BK2.BKG_STS_CD        <>  'X' " ).append("\n"); 
		query.append("                                                                        AND BKG.BKG_NO              = INF.BKG_NO " ).append("\n"); 
		query.append("                                                                        AND QTY.CNTR_TPSZ_CD NOT LIKE 'Q%' " ).append("\n"); 
		query.append("                                                                )                                             AS MNUM " ).append("\n"); 
		query.append("                                                             FROM ACM_AGN_BKG_INFO INF, " ).append("\n"); 
		query.append("                                                                  BKG_QUANTITY      QTY " ).append("\n"); 
		query.append("                                                            WHERE INF.BKG_NO          =  @[bkg_no] --:BKG_NO " ).append("\n"); 
		query.append("                                                              AND QTY.BKG_NO " ).append("\n"); 
		query.append("                                                               IN " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                                      SELECT " ).append("\n"); 
		query.append("                                                                             DOC.BKG_NO " ).append("\n"); 
		query.append("                                                                        FROM BKG_BL_DOC    DOC, " ).append("\n"); 
		query.append("                                                                             BKG_BOOKING   BKG, " ).append("\n"); 
		query.append("                                                                             BKG_BOOKING   BK2 " ).append("\n"); 
		query.append("                                                                       WHERE BKG.BKG_NO       = INF.BKG_NO " ).append("\n"); 
		query.append("                                                                         AND " ).append("\n"); 
		query.append("                                                                           ( " ).append("\n"); 
		query.append("                                                                             BKG.BKG_NO       = DOC.BKG_NO " ).append("\n"); 
		query.append("                                                                          OR " ).append("\n"); 
		query.append("                                                                             BKG.BL_NO        = DOC.MST_CVRD_BL_NO " ).append("\n"); 
		query.append("                                                                           ) " ).append("\n"); 
		query.append("                                                                         AND BK2.BKG_NO       = DOC.BKG_NO " ).append("\n"); 
		query.append("                                                                         AND BK2.BL_NO_TP   <>  '9' " ).append("\n"); 
		query.append("                                                                         AND BK2.BKG_STS_CD <>  'X' " ).append("\n"); 
		query.append("                                                                ) " ).append("\n"); 
		query.append("                                                              AND QTY.CNTR_TPSZ_CD NOT LIKE 'Q%' " ).append("\n"); 
		query.append("                                                         GROUP BY INF.BKG_NO, " ).append("\n"); 
		query.append("                                                                  QTY.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("                                                     ) TZD " ).append("\n"); 
		query.append("                                                 WHERE AGN.BKG_NO       = TZD.BKG_NO " ).append("\n"); 
		query.append("                                                   AND AGN.AC_TP_CD   <>  'N' " ).append("\n"); 
		query.append("                                              GROUP BY AGN.BKG_NO, " ).append("\n"); 
		query.append("                                                       AGN.COMM_STND_COST_CD, " ).append("\n"); 
		query.append("                                                       TZD.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("                                                       TZD.MNUM, " ).append("\n"); 
		query.append("                                                       TZD.RNUM, " ).append("\n"); 
		query.append("                                                       TZD.QTY_RATIO, " ).append("\n"); 
		query.append("                                                       TZD.OP_CNTR_QTY " ).append("\n"); 
		query.append("                                                HAVING COMM_STND_COST_CD IS NOT NULL " ).append("\n"); 
		query.append("                                              ORDER BY AGN.COMM_STND_COST_CD, " ).append("\n"); 
		query.append("                                                       TZD.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("                                          ) DST " ).append("\n"); 
		query.append("                                  UNION ALL " ).append("\n"); 
		query.append("                                     SELECT " ).append("\n"); 
		query.append("                                            DST.BKG_NO, " ).append("\n"); 
		query.append("                                            '512641'                                  AS COMM_STND_COST_CD, " ).append("\n"); 
		query.append("                                            DST.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("                                       CASE " ).append("\n"); 
		query.append("                                       WHEN DST.OP_CNTR_QTY = 0 " ).append("\n"); 
		query.append("                                       THEN 0 " ).append("\n"); 
		query.append("                                       WHEN DST.QTY_RATIO = 1 " ).append("\n"); 
		query.append("                                       THEN ROUND (DST.UNIT_COST / DST.OP_CNTR_QTY, 2) " ).append("\n"); 
		query.append("                                       WHEN DST.RNUM = DST.MNUM " ).append("\n"); 
		query.append("                                       THEN ROUND " ).append("\n"); 
		query.append("                                          ( " ).append("\n"); 
		query.append("                                          ( DST.UNIT_COST " ).append("\n"); 
		query.append("                                          + ROUND (DST.UNIT_COST * DST.QTY_RATIO, 2) " ).append("\n"); 
		query.append("                                          - SUM (ROUND (DST.UNIT_COST * DST.QTY_RATIO, 2)) " ).append("\n"); 
		query.append("                                            OVER " ).append("\n"); 
		query.append("                                          ( " ).append("\n"); 
		query.append("                                  PARTITION " ).append("\n"); 
		query.append("                                         BY DST.BKG_NO, " ).append("\n"); 
		query.append("                                            DST.COMM_STND_COST_CD " ).append("\n"); 
		query.append("                                   ORDER BY DST.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("                                          ) " ).append("\n"); 
		query.append("                                          ) " ).append("\n"); 
		query.append("                                          / DST.OP_CNTR_QTY " ).append("\n"); 
		query.append("                                          , 2 " ).append("\n"); 
		query.append("                                          ) " ).append("\n"); 
		query.append("                                       ELSE ROUND (DST.UNIT_COST * DST.QTY_RATIO / DST.OP_CNTR_QTY, 2) " ).append("\n"); 
		query.append("                                        END                                          AS UNIT_COST " ).append("\n"); 
		query.append("                                       FROM " ).append("\n"); 
		query.append("                                          ( " ).append("\n"); 
		query.append("                                                SELECT " ).append("\n"); 
		query.append("                                                       BRO.BKG_NO, " ).append("\n"); 
		query.append("                                                       BRO.COMM_STND_COST_CD, " ).append("\n"); 
		query.append("                                                       TZD.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("                                                       TZD.QTY_RATIO, " ).append("\n"); 
		query.append("                                                       ROUND (SUM (BRO.IF_AMT), 2)                AS UNIT_COST, " ).append("\n"); 
		query.append("                                                       TZD.OP_CNTR_QTY, " ).append("\n"); 
		query.append("                                                       TZD.RNUM, " ).append("\n"); 
		query.append("                                                       TZD.MNUM " ).append("\n"); 
		query.append("                                                  FROM ACM_FF_CMPN BRO, " ).append("\n"); 
		query.append("                                                     ( " ).append("\n"); 
		query.append("                                                           SELECT " ).append("\n"); 
		query.append("                                                                  INF.BKG_NO, " ).append("\n"); 
		query.append("                                                                  QTY.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("                                                                  SUM (QTY.OP_CNTR_QTY)                   AS OP_CNTR_QTY, " ).append("\n"); 
		query.append("                                                                  RATIO_TO_REPORT " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                                  SUM " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                             CASE " ).append("\n"); 
		query.append("                                                             WHEN SUBSTR (QTY.CNTR_TPSZ_CD, 2, 1) = '2' " ).append("\n"); 
		query.append("                                                             THEN QTY.OP_CNTR_QTY " ).append("\n"); 
		query.append("                                                             ELSE QTY.OP_CNTR_QTY * 2 " ).append("\n"); 
		query.append("                                                              END " ).append("\n"); 
		query.append("                                                                ) " ).append("\n"); 
		query.append("                                                                ) " ).append("\n"); 
		query.append("                                                                  OVER " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                        PARTITION " ).append("\n"); 
		query.append("                                                               BY INF.BKG_NO " ).append("\n"); 
		query.append("                                                                )                                         AS QTY_RATIO, " ).append("\n"); 
		query.append("                                                                  RANK() OVER " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                        PARTITION " ).append("\n"); 
		query.append("                                                               BY INF.BKG_NO " ).append("\n"); 
		query.append("                                                         ORDER BY QTY.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("                                                                )                                         AS RNUM, " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                                       SELECT " ).append("\n"); 
		query.append("                                                                             COUNT (DISTINCT QTY.CNTR_TPSZ_CD) " ).append("\n"); 
		query.append("                                                                       FROM BKG_BL_DOC     DOC, " ).append("\n"); 
		query.append("                                                                            BKG_BOOKING    BKG, " ).append("\n"); 
		query.append("                                                                            BKG_BOOKING    BK2, " ).append("\n"); 
		query.append("                                                                            BKG_QUANTITY   QTY " ).append("\n"); 
		query.append("                                                                      WHERE DOC.BKG_NO         = QTY.BKG_NO " ).append("\n"); 
		query.append("                                                                        AND " ).append("\n"); 
		query.append("                                                                          ( " ).append("\n"); 
		query.append("                                                                            DOC.BKG_NO         = BKG.BKG_NO " ).append("\n"); 
		query.append("                                                                         OR " ).append("\n"); 
		query.append("                                                                            DOC.MST_CVRD_BL_NO = BKG.BL_NO " ).append("\n"); 
		query.append("                                                                          ) " ).append("\n"); 
		query.append("                                                                        AND DOC.BKG_NO         = BK2.BKG_NO " ).append("\n"); 
		query.append("                                                                        AND BK2.BL_NO_TP     <>  '9' " ).append("\n"); 
		query.append("                                                                        AND BK2.BKG_STS_CD   <>  'X' " ).append("\n"); 
		query.append("                                                                        AND BKG.BKG_NO         = INF.BKG_NO " ).append("\n"); 
		query.append("                                                                        AND QTY.CNTR_TPSZ_CD NOT LIKE 'Q%' " ).append("\n"); 
		query.append("                                                                )                                             AS MNUM " ).append("\n"); 
		query.append("                                                             FROM ACM_AGN_BKG_INFO INF, " ).append("\n"); 
		query.append("                                                                  BKG_QUANTITY      QTY " ).append("\n"); 
		query.append("                                                            WHERE INF.BKG_NO          =  @[bkg_no] --:BKG_NO " ).append("\n"); 
		query.append("                                                              AND QTY.BKG_NO " ).append("\n"); 
		query.append("                                                               IN " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                                      SELECT " ).append("\n"); 
		query.append("                                                                             DOC.BKG_NO " ).append("\n"); 
		query.append("                                                                        FROM BKG_BL_DOC    DOC, " ).append("\n"); 
		query.append("                                                                             BKG_BOOKING   BKG, " ).append("\n"); 
		query.append("                                                                             BKG_BOOKING   BK2 " ).append("\n"); 
		query.append("                                                                       WHERE BKG.BKG_NO      = INF.BKG_NO " ).append("\n"); 
		query.append("                                                                         AND " ).append("\n"); 
		query.append("                                                                           ( " ).append("\n"); 
		query.append("                                                                             BKG.BKG_NO      = DOC.BKG_NO " ).append("\n"); 
		query.append("                                                                          OR " ).append("\n"); 
		query.append("                                                                             BKG.BL_NO       = DOC.MST_CVRD_BL_NO " ).append("\n"); 
		query.append("                                                                           ) " ).append("\n"); 
		query.append("                                                                         AND BK2.BKG_NO      = DOC.BKG_NO " ).append("\n"); 
		query.append("                                                                         AND BK2.BL_NO_TP   <> '9' " ).append("\n"); 
		query.append("                                                                         AND BK2.BKG_STS_CD <> 'X' " ).append("\n"); 
		query.append("                                                                ) " ).append("\n"); 
		query.append("                                                              AND QTY.CNTR_TPSZ_CD NOT LIKE 'Q%' " ).append("\n"); 
		query.append("                                                         GROUP BY INF.BKG_NO, " ).append("\n"); 
		query.append("                                                                  QTY.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("                                                     ) TZD " ).append("\n"); 
		query.append("                                                 WHERE BRO.BKG_NO       = TZD.BKG_NO " ).append("\n"); 
		query.append("                                              GROUP BY BRO.BKG_NO, " ).append("\n"); 
		query.append("                                                       BRO.COMM_STND_COST_CD, " ).append("\n"); 
		query.append("                                                       TZD.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("                                                       TZD.MNUM, " ).append("\n"); 
		query.append("                                                       TZD.RNUM, " ).append("\n"); 
		query.append("                                                       TZD.QTY_RATIO, " ).append("\n"); 
		query.append("                                                       TZD.OP_CNTR_QTY " ).append("\n"); 
		query.append("                                              ORDER BY BRO.COMM_STND_COST_CD, " ).append("\n"); 
		query.append("                                                       TZD.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("                                          ) DST " ).append("\n"); 
		query.append("                                  UNION ALL " ).append("\n"); 
		query.append("                                     SELECT " ).append("\n"); 
		query.append("                                            DST.BKG_NO, " ).append("\n"); 
		query.append("                                            '512641'                                  AS COMM_STND_COST_CD, " ).append("\n"); 
		query.append("                                            DST.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("                                       CASE " ).append("\n"); 
		query.append("                                       WHEN DST.OP_CNTR_QTY = 0 " ).append("\n"); 
		query.append("                                       THEN 0 " ).append("\n"); 
		query.append("                                       WHEN DST.QTY_RATIO = 1 " ).append("\n"); 
		query.append("                                       THEN ROUND (DST.UNIT_COST / DST.OP_CNTR_QTY, 2) " ).append("\n"); 
		query.append("                                       WHEN DST.RNUM = DST.MNUM " ).append("\n"); 
		query.append("                                       THEN ROUND " ).append("\n"); 
		query.append("                                          ( " ).append("\n"); 
		query.append("                                          ( DST.UNIT_COST " ).append("\n"); 
		query.append("                                          + ROUND (DST.UNIT_COST * DST.QTY_RATIO, 2) " ).append("\n"); 
		query.append("                                          - SUM (ROUND (DST.UNIT_COST * DST.QTY_RATIO, 2)) " ).append("\n"); 
		query.append("                                            OVER " ).append("\n"); 
		query.append("                                          ( " ).append("\n"); 
		query.append("                                  PARTITION " ).append("\n"); 
		query.append("                                         BY DST.BKG_NO, " ).append("\n"); 
		query.append("                                            DST.COMM_STND_COST_CD " ).append("\n"); 
		query.append("                                   ORDER BY DST.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("                                          ) " ).append("\n"); 
		query.append("                                          ) " ).append("\n"); 
		query.append("                                          / DST.OP_CNTR_QTY " ).append("\n"); 
		query.append("                                          , 2 " ).append("\n"); 
		query.append("                                          ) " ).append("\n"); 
		query.append("                                       ELSE ROUND (DST.UNIT_COST * DST.QTY_RATIO / DST.OP_CNTR_QTY, 2) " ).append("\n"); 
		query.append("                                        END                                          AS UNIT_COST " ).append("\n"); 
		query.append("                                       FROM " ).append("\n"); 
		query.append("                                          ( " ).append("\n"); 
		query.append("                                                SELECT " ).append("\n"); 
		query.append("                                                       FAC.BKG_NO, " ).append("\n"); 
		query.append("                                                       FAC.COMM_STND_COST_CD, " ).append("\n"); 
		query.append("                                                       TZD.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("                                                       TZD.QTY_RATIO, " ).append("\n"); 
		query.append("                                                       ROUND (SUM (FAC.IF_AMT), 2)                AS UNIT_COST, " ).append("\n"); 
		query.append("                                                       TZD.OP_CNTR_QTY, " ).append("\n"); 
		query.append("                                                       TZD.RNUM, " ).append("\n"); 
		query.append("                                                       TZD.MNUM " ).append("\n"); 
		query.append("                                                  FROM ACM_FAC_COMM FAC, " ).append("\n"); 
		query.append("                                                     ( " ).append("\n"); 
		query.append("                                                           SELECT " ).append("\n"); 
		query.append("                                                                  INF.BKG_NO, " ).append("\n"); 
		query.append("                                                                  QTY.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("                                                                  SUM (QTY.OP_CNTR_QTY)                   AS OP_CNTR_QTY, " ).append("\n"); 
		query.append("                                                                  RATIO_TO_REPORT " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                                  SUM " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                             CASE " ).append("\n"); 
		query.append("                                                             WHEN SUBSTR (QTY.CNTR_TPSZ_CD, 2, 1) = '2' " ).append("\n"); 
		query.append("                                                             THEN QTY.OP_CNTR_QTY " ).append("\n"); 
		query.append("                                                             ELSE QTY.OP_CNTR_QTY * 2 " ).append("\n"); 
		query.append("                                                              END " ).append("\n"); 
		query.append("                                                                ) " ).append("\n"); 
		query.append("                                                                ) " ).append("\n"); 
		query.append("                                                                  OVER " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                        PARTITION " ).append("\n"); 
		query.append("                                                               BY INF.BKG_NO " ).append("\n"); 
		query.append("                                                                )                                         AS QTY_RATIO, " ).append("\n"); 
		query.append("                                                                  RANK() OVER " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                        PARTITION " ).append("\n"); 
		query.append("                                                               BY INF.BKG_NO " ).append("\n"); 
		query.append("                                                         ORDER BY QTY.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("                                                                )                                         AS RNUM, " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                                       SELECT " ).append("\n"); 
		query.append("                                                                             COUNT (DISTINCT QTY.CNTR_TPSZ_CD) " ).append("\n"); 
		query.append("                                                                       FROM BKG_BL_DOC     DOC, " ).append("\n"); 
		query.append("                                                                            BKG_BOOKING    BKG, " ).append("\n"); 
		query.append("                                                                            BKG_BOOKING    BK2, " ).append("\n"); 
		query.append("                                                                            BKG_QUANTITY   QTY " ).append("\n"); 
		query.append("                                                                      WHERE DOC.BKG_NO         = QTY.BKG_NO " ).append("\n"); 
		query.append("                                                                        AND " ).append("\n"); 
		query.append("                                                                          ( " ).append("\n"); 
		query.append("                                                                            DOC.BKG_NO         = BKG.BKG_NO " ).append("\n"); 
		query.append("                                                                         OR " ).append("\n"); 
		query.append("                                                                            DOC.MST_CVRD_BL_NO = BKG.BL_NO " ).append("\n"); 
		query.append("                                                                          ) " ).append("\n"); 
		query.append("                                                                        AND DOC.BKG_NO         = BK2.BKG_NO " ).append("\n"); 
		query.append("                                                                        AND BK2.BL_NO_TP     <>  '9' " ).append("\n"); 
		query.append("                                                                        AND BK2.BKG_STS_CD   <>  'X' " ).append("\n"); 
		query.append("                                                                        AND BKG.BKG_NO         = INF.BKG_NO " ).append("\n"); 
		query.append("                                                                        AND QTY.CNTR_TPSZ_CD NOT LIKE 'Q%' " ).append("\n"); 
		query.append("                                                                )                                             AS MNUM " ).append("\n"); 
		query.append("                                                             FROM ACM_AGN_BKG_INFO INF, " ).append("\n"); 
		query.append("                                                                  BKG_QUANTITY      QTY " ).append("\n"); 
		query.append("                                                            WHERE INF.BKG_NO          =  @[bkg_no] --:BKG_NO " ).append("\n"); 
		query.append("                                                              AND QTY.BKG_NO " ).append("\n"); 
		query.append("                                                               IN " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                                      SELECT " ).append("\n"); 
		query.append("                                                                             DOC.BKG_NO " ).append("\n"); 
		query.append("                                                                        FROM BKG_BL_DOC    DOC, " ).append("\n"); 
		query.append("                                                                             BKG_BOOKING   BKG, " ).append("\n"); 
		query.append("                                                                             BKG_BOOKING   BK2 " ).append("\n"); 
		query.append("                                                                       WHERE BKG.BKG_NO      = INF.BKG_NO " ).append("\n"); 
		query.append("                                                                         AND " ).append("\n"); 
		query.append("                                                                           ( " ).append("\n"); 
		query.append("                                                                             BKG.BKG_NO      = DOC.BKG_NO " ).append("\n"); 
		query.append("                                                                          OR " ).append("\n"); 
		query.append("                                                                             BKG.BL_NO       = DOC.MST_CVRD_BL_NO " ).append("\n"); 
		query.append("                                                                           ) " ).append("\n"); 
		query.append("                                                                         AND BK2.BKG_NO      = DOC.BKG_NO " ).append("\n"); 
		query.append("                                                                         AND BK2.BL_NO_TP   <> '9' " ).append("\n"); 
		query.append("                                                                         AND BK2.BKG_STS_CD <> 'X' " ).append("\n"); 
		query.append("                                                                ) " ).append("\n"); 
		query.append("                                                              AND QTY.CNTR_TPSZ_CD NOT LIKE 'Q%' " ).append("\n"); 
		query.append("                                                         GROUP BY INF.BKG_NO, " ).append("\n"); 
		query.append("                                                                  QTY.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("                                                     ) TZD " ).append("\n"); 
		query.append("                                                 WHERE FAC.BKG_NO       = TZD.BKG_NO " ).append("\n"); 
		query.append("                                              GROUP BY FAC.BKG_NO, " ).append("\n"); 
		query.append("                                                       FAC.COMM_STND_COST_CD, " ).append("\n"); 
		query.append("                                                       TZD.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("                                                       TZD.MNUM, " ).append("\n"); 
		query.append("                                                       TZD.RNUM, " ).append("\n"); 
		query.append("                                                       TZD.QTY_RATIO, " ).append("\n"); 
		query.append("                                                       TZD.OP_CNTR_QTY " ).append("\n"); 
		query.append("                                              ORDER BY FAC.COMM_STND_COST_CD, " ).append("\n"); 
		query.append("                                                       TZD.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("                                          ) DST " ).append("\n"); 
		query.append("                                  UNION ALL " ).append("\n"); 
		query.append("                                     SELECT " ).append("\n"); 
		query.append("                                            DST.BKG_NO, " ).append("\n"); 
		query.append("                                            '512641'                                  AS COMM_STND_COST_CD, " ).append("\n"); 
		query.append("                                            DST.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("                                       CASE " ).append("\n"); 
		query.append("                                       WHEN DST.OP_CNTR_QTY = 0 " ).append("\n"); 
		query.append("                                       THEN 0 " ).append("\n"); 
		query.append("                                       WHEN DST.QTY_RATIO = 1 " ).append("\n"); 
		query.append("                                       THEN ROUND (DST.UNIT_COST / DST.OP_CNTR_QTY, 2) " ).append("\n"); 
		query.append("                                       WHEN DST.RNUM = DST.MNUM " ).append("\n"); 
		query.append("                                       THEN ROUND " ).append("\n"); 
		query.append("                                          ( " ).append("\n"); 
		query.append("                                          ( DST.UNIT_COST " ).append("\n"); 
		query.append("                                          + ROUND (DST.UNIT_COST * DST.QTY_RATIO, 2) " ).append("\n"); 
		query.append("                                          - SUM (ROUND (DST.UNIT_COST * DST.QTY_RATIO, 2)) " ).append("\n"); 
		query.append("                                            OVER " ).append("\n"); 
		query.append("                                          ( " ).append("\n"); 
		query.append("                                  PARTITION " ).append("\n"); 
		query.append("                                         BY DST.BKG_NO, " ).append("\n"); 
		query.append("                                            DST.COMM_STND_COST_CD " ).append("\n"); 
		query.append("                                   ORDER BY DST.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("                                          ) " ).append("\n"); 
		query.append("                                          ) " ).append("\n"); 
		query.append("                                          / DST.OP_CNTR_QTY " ).append("\n"); 
		query.append("                                          , 2 " ).append("\n"); 
		query.append("                                          ) " ).append("\n"); 
		query.append("                                       ELSE ROUND (DST.UNIT_COST * DST.QTY_RATIO / DST.OP_CNTR_QTY, 2) " ).append("\n"); 
		query.append("                                        END                                          AS UNIT_COST " ).append("\n"); 
		query.append("                                       FROM " ).append("\n"); 
		query.append("                                          (" ).append("\n"); 
		query.append("                                                SELECT " ).append("\n"); 
		query.append("                                                       CPN.BKG_NO, " ).append("\n"); 
		query.append("                                                       CPN.COMM_STND_COST_CD, " ).append("\n"); 
		query.append("                                                       TZD.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("                                                       TZD.QTY_RATIO, " ).append("\n"); 
		query.append("                                                       ROUND (SUM (CPN.IF_AMT), 2)                AS UNIT_COST, " ).append("\n"); 
		query.append("                                                       TZD.OP_CNTR_QTY, " ).append("\n"); 
		query.append("                                                       TZD.RNUM, " ).append("\n"); 
		query.append("                                                       TZD.MNUM " ).append("\n"); 
		query.append("                                                  FROM ACM_SPCL_CMPN CPN, " ).append("\n"); 
		query.append("                                                     ( " ).append("\n"); 
		query.append("                                                           SELECT " ).append("\n"); 
		query.append("                                                                  INF.BKG_NO, " ).append("\n"); 
		query.append("                                                                  QTY.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("                                                                  SUM (QTY.OP_CNTR_QTY)                   AS OP_CNTR_QTY, " ).append("\n"); 
		query.append("                                                                  RATIO_TO_REPORT " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                                  SUM " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                             CASE " ).append("\n"); 
		query.append("                                                             WHEN SUBSTR (QTY.CNTR_TPSZ_CD, 2, 1) = '2' " ).append("\n"); 
		query.append("                                                             THEN QTY.OP_CNTR_QTY " ).append("\n"); 
		query.append("                                                             ELSE QTY.OP_CNTR_QTY * 2 " ).append("\n"); 
		query.append("                                                              END " ).append("\n"); 
		query.append("                                                                ) " ).append("\n"); 
		query.append("                                                                ) " ).append("\n"); 
		query.append("                                                                  OVER " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                        PARTITION " ).append("\n"); 
		query.append("                                                               BY INF.BKG_NO " ).append("\n"); 
		query.append("                                                                )                                         AS QTY_RATIO, " ).append("\n"); 
		query.append("                                                                  RANK() OVER " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                        PARTITION " ).append("\n"); 
		query.append("                                                               BY INF.BKG_NO " ).append("\n"); 
		query.append("                                                         ORDER BY QTY.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("                                                                )                                         AS RNUM, " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                                       SELECT " ).append("\n"); 
		query.append("                                                                             COUNT (DISTINCT QTY.CNTR_TPSZ_CD) " ).append("\n"); 
		query.append("                                                                       FROM BKG_BL_DOC     DOC, " ).append("\n"); 
		query.append("                                                                            BKG_BOOKING    BKG, " ).append("\n"); 
		query.append("                                                                            BKG_BOOKING    BK2, " ).append("\n"); 
		query.append("                                                                            BKG_QUANTITY   QTY " ).append("\n"); 
		query.append("                                                                      WHERE DOC.BKG_NO         = QTY.BKG_NO " ).append("\n"); 
		query.append("                                                                        AND " ).append("\n"); 
		query.append("                                                                          ( " ).append("\n"); 
		query.append("                                                                            DOC.BKG_NO         = BKG.BKG_NO " ).append("\n"); 
		query.append("                                                                         OR " ).append("\n"); 
		query.append("                                                                            DOC.MST_CVRD_BL_NO = BKG.BL_NO " ).append("\n"); 
		query.append("                                                                          ) " ).append("\n"); 
		query.append("                                                                        AND DOC.BKG_NO         = BK2.BKG_NO " ).append("\n"); 
		query.append("                                                                        AND BK2.BL_NO_TP     <>  '9' " ).append("\n"); 
		query.append("                                                                        AND BK2.BKG_STS_CD   <>  'X' " ).append("\n"); 
		query.append("                                                                        AND BKG.BKG_NO         = INF.BKG_NO " ).append("\n"); 
		query.append("                                                                        AND QTY.CNTR_TPSZ_CD NOT LIKE 'Q%' " ).append("\n"); 
		query.append("                                                                )                                             AS MNUM " ).append("\n"); 
		query.append("                                                             FROM ACM_AGN_BKG_INFO INF, " ).append("\n"); 
		query.append("                                                                  BKG_QUANTITY      QTY " ).append("\n"); 
		query.append("                                                            WHERE INF.BKG_NO          =  @[bkg_no] --:BKG_NO " ).append("\n"); 
		query.append("                                                              AND QTY.BKG_NO " ).append("\n"); 
		query.append("                                                               IN " ).append("\n"); 
		query.append("                                                                ( " ).append("\n"); 
		query.append("                                                                      SELECT " ).append("\n"); 
		query.append("                                                                             DOC.BKG_NO " ).append("\n"); 
		query.append("                                                                        FROM BKG_BL_DOC    DOC, " ).append("\n"); 
		query.append("                                                                             BKG_BOOKING   BKG, " ).append("\n"); 
		query.append("                                                                             BKG_BOOKING   BK2 " ).append("\n"); 
		query.append("                                                                       WHERE BKG.BKG_NO      = INF.BKG_NO " ).append("\n"); 
		query.append("                                                                         AND " ).append("\n"); 
		query.append("                                                                           ( " ).append("\n"); 
		query.append("                                                                             BKG.BKG_NO      = DOC.BKG_NO " ).append("\n"); 
		query.append("                                                                          OR " ).append("\n"); 
		query.append("                                                                             BKG.BL_NO       = DOC.MST_CVRD_BL_NO " ).append("\n"); 
		query.append("                                                                           ) " ).append("\n"); 
		query.append("                                                                         AND BK2.BKG_NO      = DOC.BKG_NO " ).append("\n"); 
		query.append("                                                                         AND BK2.BL_NO_TP   <> '9' " ).append("\n"); 
		query.append("                                                                         AND BK2.BKG_STS_CD <> 'X' " ).append("\n"); 
		query.append("                                                                ) " ).append("\n"); 
		query.append("                                                              AND QTY.CNTR_TPSZ_CD NOT LIKE 'Q%' " ).append("\n"); 
		query.append("                                                         GROUP BY INF.BKG_NO, " ).append("\n"); 
		query.append("                                                                  QTY.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("                                                     ) TZD " ).append("\n"); 
		query.append("                                                 WHERE CPN.BKG_NO       = TZD.BKG_NO " ).append("\n"); 
		query.append("                                              GROUP BY CPN.BKG_NO, " ).append("\n"); 
		query.append("                                                       CPN.COMM_STND_COST_CD, " ).append("\n"); 
		query.append("                                                       TZD.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("                                                       TZD.MNUM, " ).append("\n"); 
		query.append("                                                       TZD.RNUM, " ).append("\n"); 
		query.append("                                                       TZD.QTY_RATIO, " ).append("\n"); 
		query.append("                                                       TZD.OP_CNTR_QTY " ).append("\n"); 
		query.append("                                              ORDER BY CPN.COMM_STND_COST_CD, " ).append("\n"); 
		query.append("                                                       TZD.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("                                          ) DST " ).append("\n"); 
		query.append("                               ) AGT, " ).append("\n"); 
		query.append("                               ( " ).append("\n"); 
		query.append("                                     SELECT " ).append("\n"); 
		query.append("                                   DISTINCT PAR.PCTL_NO, " ).append("\n"); 
		query.append("                                            PAR.BKG_NO " ).append("\n"); 
		query.append("                                       FROM MAS_COM_PARA      PAR, " ).append("\n"); 
		query.append("                                            MAS_COM_COST_PARA CPA " ).append("\n"); 
		query.append("                                      WHERE PAR.PCTL_NO         = CPA.PCTL_NO " ).append("\n"); 
		query.append("                                        AND PAR.BKG_NO          =  @[bkg_no] --:BKG_NO " ).append("\n"); 
		query.append("                               ) PCT " ).append("\n"); 
		query.append("                           WHERE AGT.BKG_NO = PCT.BKG_NO " ).append("\n"); 
		query.append("                        GROUP BY AGT.BKG_NO, " ).append("\n"); 
		query.append("                                 AGT.COMM_STND_COST_CD, " ).append("\n"); 
		query.append("                                 AGT.CNTR_TPSZ_CD, " ).append("\n"); 
		query.append("                                 PCT.PCTL_NO " ).append("\n"); 
		query.append("                    ) CST " ).append("\n"); 
		query.append("               WHERE CPA.PCTL_NO           = CST.PCTL_NO " ).append("\n"); 
		query.append("                 AND CPA.MAS_COST_SRC_CD   = CST.COMM_STND_COST_CD " ).append("\n"); 
		query.append("                 AND CPA.CNTR_TPSZ_CD      = CST.CNTR_TPSZ_CD " ).append("\n"); 
		query.append("                 AND CPA.COST_SRC_SYS_CD   = 'AGT' " ).append("\n"); 
		query.append("                 AND CPA.STND_COST_CD      = '51401011' " ).append("\n"); 
		query.append("         ) " ).append("\n"); 
		query.append("       SET CPA_ESTM_UC_AMT     = CST_ESTM_UC_AMT, " ).append("\n"); 
		query.append("           CPA_RESPB_UC_AMT    = CST_RESPB_UC_AMT, " ).append("\n"); 
		query.append("           CPA_COST_ASS_BSE_CD = CST_COST_ASS_BSE_CD" ).append("\n"); 

	}
}