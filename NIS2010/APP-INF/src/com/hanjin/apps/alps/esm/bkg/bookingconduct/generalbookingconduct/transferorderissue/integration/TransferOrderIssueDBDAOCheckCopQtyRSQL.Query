<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TransferOrderIssueDBDAOCheckCopQtyRSQL">
			<desc><![CDATA[cop qty와 tro qty 중 tro qty가 더 많은지 확인]]></desc>
			<sql><![CDATA[
SELECT CASE WHEN @[tro_qty] > CNT THEN 'Y'
       ELSE 'N'
       END AS CFM_BLOCK_FLG
  FROM (
        SELECT COUNT(*) CNT
          FROM (
                SELECT *
                  FROM SCE_COP_HDR
                 WHERE BKG_NO = @[bkg_no]
                   AND COP_STS_CD <> 'X'
                   AND CNTR_TPSZ_CD = @[cntr_tpsz_cd]
                   AND 'N' = (SELECT FLEX_HGT_FLG FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])
                UNION ALL
                SELECT M.*
                  FROM SCE_COP_HDR M
                 WHERE M.BKG_NO = @[bkg_no]
                   AND M.COP_STS_CD <> 'X'
                   AND M.CNTR_TPSZ_CD IN (SELECT CNTR_TPSZ_CD
                                          FROM SCE_COP_CNTR_REPO_RULE
                                         WHERE (CNTR_TPSZ_CD = M.CNTR_TPSZ_CD
                                            OR PROV_CNTR_TPSZ_CD = M.CNTR_TPSZ_CD)
                                           AND (CNTR_TPSZ_CD = @[cntr_tpsz_cd]
                                            OR PROV_CNTR_TPSZ_CD = @[cntr_tpsz_cd])
                                           AND NVL(ACT_FLG, 'N') = 'Y')
                   AND 'Y' = (SELECT FLEX_HGT_FLG FROM BKG_BOOKING WHERE BKG_NO = @[bkg_no])
               )
        )
 WHERE 'ON' = (SELECT ATTR_CTNT2  
                 FROM BKG_HRD_CDG_CTNT 
                WHERE HRD_CDG_ID = 'BKG_VALIDATION' 
                  AND ATTR_CTNT1 = 'TRO_QTY_CFM')			]]></sql>
			<params>
				<param name="tro_qty" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
