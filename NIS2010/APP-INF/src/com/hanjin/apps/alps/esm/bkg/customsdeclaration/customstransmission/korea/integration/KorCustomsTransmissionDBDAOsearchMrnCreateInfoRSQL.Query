<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="KorCustomsTransmissionDBDAOsearchMrnCreateInfoRSQL">
			<desc><![CDATA[MRN Create를 위한 조회를 한다.]]></desc>
			<sql><![CDATA[
#if(${mrn_yn} != 'N')

SELECT NVL(mani.MRN_NO,' ')         MRN_NO
     , NVL(mani.MRN_CHK_NO, ' ')    MRN_CHK_NO
     , NVL(mani.PORT_CD,' ')        PORT_CD
     , NVL(mani.IO_BND_CD,' ')      IO_BND_CD
     , NVL(mani.VSL_CD,' ')         VSL_CD
     , NVL(mani.skd_voy_no,' ')     SKD_VOY_NO
     , NVL(mani.skd_dir_cd,' ')     SKD_DIR_CD
	 , NVL(vsl.SLAN_CD, ' ') LANE
     , NVL(mani.VSL_CD,' ') || NVL(mani.skd_voy_no,' ') || NVL(mani.skd_dir_cd,' ') VVD
     , NVL(v.CALL_SGN_NO,' ')       CALL_SGN_NO
     , NVL(TO_CHAR(vsl.vps_eta_dt,'YYYY-MM-DD'),' ') VPS_ETA_DT
     , NVL(TO_CHAR(vsl.vps_etd_dt,'YYYY-MM-DD'),' ') VPS_ETD_DT
  FROM BKG_CSTMS_KR_MF_REF_NO mani
     , VSK_VSL_PORT_SKD vsl 
     , MDM_VSL_CNTR v
 WHERE mani.VSL_CD = v.VSL_CD  
   AND mani.VSL_CD = vsl.VSL_CD  
   AND mani.skd_voy_no = vsl.skd_voy_no  
   AND mani.skd_dir_cd = vsl.skd_dir_cd  
   AND vsl.CLPT_IND_SEQ = '1' 
   AND mani.PORT_CD = vsl.VPS_PORT_CD    

#if(${port_cd} != '')
   AND mani.PORT_CD like @[port_cd]||'%'
#end

#if(${lane} != '')
   AND vsl.SLAN_CD like @[lane]||'%'
#end


#if(${io_bnd_cd} != '')
   AND mani.IO_BND_CD = @[io_bnd_cd]
#end

#if(${vvd1} != '')
   AND mani.VSL_CD 	   LIKE SUBSTR(@[vvd1],1,4)||'%'
   AND mani.SKD_VOY_NO LIKE SUBSTR(@[vvd1],5,4)||'%'
   AND mani.SKD_DIR_CD LIKE SUBSTR(@[vvd1],9,1)||'%'
#end

#if(${crr_cd} != 'H')
   AND v.CRR_CD <> 'SML'
#else
   AND v.CRR_CD = 'SML'
#end

#if(${from_dt} != '')
   AND VSL.VPS_ETA_DT > TO_DATE(@[from_dt],'YYYY-MM-DD')   
#end

#if(${to_dt} != '')
  AND VSL.VPS_ETA_DT < TO_DATE(@[to_dt],'YYYY-MM-DD')+0.99999
#end


#else
   SELECT
         '' MRN_NO
       , '' MRN_CHK_NO
       , @[port_cd] PORT_CD
       , @[io_bnd_cd] IO_BND_CD
       , vsl.VSL_CD VSL_CD
       , vsl.SKD_VOY_NO SKD_VOY_NO
       , vsl.SKD_DIR_cD SKD_DIR_CD
       , NVL(vsl.SLAN_CD, ' ') LANE
       , NVL(vsl.VSL_CD,' ') || NVL(vsl.skd_voy_no,' ') || NVL(vsl.skd_dir_cd,' ') VVD
       , NVL(v.CALL_SGN_NO,' ')       CALL_SGN_NO
       , NVL(TO_CHAR(vsl.vps_eta_dt,'YYYY-MM-DD'),' ') VPS_ETA_DT
       , NVL(TO_CHAR(vsl.vps_etd_dt,'YYYY-MM-DD'),' ') VPS_ETD_DT
   FROM VSK_VSL_PORT_SKD vsl 
     , MDM_VSL_CNTR v 
   WHERE vsl.CLPT_IND_SEQ = '1' 
   AND v.VSL_CD =vsl.VSL_CD
   AND NOT EXISTS (SELECT 'X' FROM BKG_CSTMS_KR_MF_REF_NO BCK
                   WHERE BCK.VSL_CD = VSL.VSL_CD
                   AND   BCK.SKD_VOY_NO = VSL.SKD_VOY_NO
                   AND   BCK.SKD_DIR_CD = VSL.SKD_DIR_CD
                   AND   BCK.PORT_CD = @[port_cd]
                   AND   BCK.IO_BND_CD = @[io_bnd_cd])

#if(${port_cd} != '')
   AND vsl.VPS_PORT_CD like @[port_cd]||'%'
#end

#if(${lane} != '')
   AND vsl.SLAN_CD like @[lane]||'%'
#end

#if(${crr_cd} != 'H')
   AND v.CRR_CD <> 'SML'
#else
   AND v.CRR_CD = 'SML'
#end

#if(${vvd1} != '')
   AND vsl.VSL_CD 	   LIKE SUBSTR(@[vvd1],1,4)||'%'
   AND vsl.SKD_VOY_NO LIKE SUBSTR(@[vvd1],5,4)||'%'
   AND vsl.SKD_DIR_CD LIKE SUBSTR(@[vvd1],9,1)||'%'
#end


#if(${from_dt} != '')
   AND VSL.VPS_ETA_DT > TO_DATE(@[from_dt],'YYYY-MM-DD')   
#end

#if(${to_dt} != '')
  AND VSL.VPS_ETA_DT < TO_DATE(@[to_dt],'YYYY-MM-DD')+0.99999
#end


#end			]]></sql>
			<params>
				<param name="port_cd" type="12" value="" out="N"/>
				<param name="lane" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="vvd1" type="12" value="" out="N"/>
				<param name="from_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
