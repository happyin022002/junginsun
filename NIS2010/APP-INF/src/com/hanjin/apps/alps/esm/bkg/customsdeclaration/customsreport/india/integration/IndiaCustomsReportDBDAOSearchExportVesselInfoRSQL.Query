<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="IndiaCustomsReportDBDAOSearchExportVesselInfoRSQL">
			<desc><![CDATA[SearchExportVesselInfo 생성을 위해 사용]]></desc>
			<sql><![CDATA[
SELECT 
       BC.BKG_NO, BC.CNMV_CYC_NO, BB.POL_NOD_CD, BB.BKG_CGO_TP_CD,
       BC.CNTR_NO, 
       BC.MEAS_QTY, 
       (SELECT CNTR_TPSZ_ISO_CD 
        FROM MDM_CNTR_TP_SZ
        WHERE BC.CNTR_TPSZ_CD = CNTR_TPSZ_CD) ISO_CD,
       (SELECT DISTINCT IMDG_CLSS_CD 
        FROM BKG_DG_CGO BDC
        WHERE BC.BKG_NO = BDC.BKG_NO 
        AND BC.CNTR_NO = BDC.CNTR_NO 
        AND ROWNUM = 1) IMO, 
        NVL(SUBSTR(BB.PRE_RLY_PORT_CD, 3, 5), NVL(SUBSTR(BB.PST_RLY_PORT_CD, 3, 5), SUBSTR(BB.POD_CD, 3, 5))) TS_LOC,
       DECODE(BB.BKG_CGO_TP_CD, 'E', 'E', 'P', 'E', DECODE(BB.POR_CD, BB.POL_CD, 'I', 'F')) STS, 
       BB.POD_CD FPD,
       SUBSTR(BB.POR_CD, 3, 5) ORIGIN,
       BB.VSL_CD||BB.SKD_VOY_NO||BB.SKD_DIR_CD VVD,
       DECODE(BB.BKG_CGO_TP_CD, 'F', BS.CUST_NM, 'MTY REPO') SHIPPER,
       '' DOCS_DT,
       (SELECT MAX(TO_CHAR(CNMV_EVNT_DT, 'YYYY-MM-DD HH24:MI:SS')) 
        FROM CTM_MOVEMENT
        WHERE  BC.CNTR_NO = CNTR_NO
        AND BC.CNMV_YR = CNMV_YR
        AND BC.CNMV_CYC_NO >= CNMV_CYC_NO
        AND MVMT_STS_CD = DECODE(BB.BKG_CGO_TP_CD, 'F' ,'OC', 'R' ,'OC', 'MT')
        AND BB.POL_NOD_CD = ORG_YD_CD) EVENT_DT,
       BB.XTER_RMK               
FROM VSK_VSL_PORT_SKD VPS, BKG_BOOKING BB, BKG_CONTAINER BC, BKG_CUSTOMER BS, BKG_VVD BV
WHERE 1=1 
--1. 기간 조건(M)
AND VPS_ETD_DT BETWEEN TO_DATE(@[from_dt], 'YYYY-MM-DD') AND TO_DATE(@[to_dt], 'YYYY-MM-DD') + 0.99999
--2. VVD 조건(O)
AND VPS.VSL_CD 		= SUBSTR(@[export_vvd], 1, 4)
AND	VPS.SKD_VOY_NO 	= SUBSTR(@[export_vvd], 5, 4)
AND	VPS.SKD_DIR_CD 	= SUBSTR(@[export_vvd], 9, 1)
--3. POL 조건(M)
AND BB.POL_CD LIKE @[pol]||'%'
--4. 터미널 선택 조건(M)은 select시 사용

AND VPS.VSL_CD 		= BV.VSL_CD
AND	VPS.SKD_VOY_NO 	= BV.SKD_VOY_NO
AND	VPS.SKD_DIR_CD 	= BV.SKD_DIR_CD
AND VPS.VPS_PORT_CD = BV.POL_CD
AND BB.BKG_NO = BC.BKG_NO
AND	BB.BKG_STS_CD	   <>  'X'
AND BB.BKG_NO       = BS.BKG_NO
AND BV.BKG_NO       = BB.BKG_NO
AND BS.BKG_CUST_TP_CD = 'S'			]]></sql>
			<params>
				<param name="from_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="export_vvd" type="12" value="" out="N"/>
				<param name="pol" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
