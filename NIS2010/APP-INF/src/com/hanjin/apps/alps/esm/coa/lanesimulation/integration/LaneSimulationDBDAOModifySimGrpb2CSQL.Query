<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="LaneSimulationDBDAOModifySimGrpb2CSQL">
			<desc><![CDATA[Sim Grpb2 머지]]></desc>
			<sql><![CDATA[
MERGE INTO COA_SIM_SVC_LANE A1 
    	 USING ( 
    	       SELECT SIM_DT, SIM_NO, SECT_NO, SUM(GRS_RPB_REV) GRS_RPB_REV, SUM(PORT_PAIR_LOD_QTY*GRS_RPB_REV) GRS_REV 
    	         FROM COA_SIM_VOL_PRJ 
    	        WHERE SIM_DT = @[sim_dt] 
    	          AND SIM_NO = @[sim_no] 
    	        GROUP BY SIM_DT, SIM_NO, SECT_NO 
    	      ) A2 
    	   ON ( 
    	           A1.SIM_DT  = A2.SIM_DT 
    	       AND A1.SIM_NO  = A2.SIM_NO 
    	       AND A1.SECT_NO = A2.SECT_NO 
    	      ) 
    	 WHEN MATCHED THEN 
    	     UPDATE 
    	        SET A1.GRS_RPB_REV = A2.GRS_REV/A1.LOD_TTL_QTY 
    	           ,A1.GRS_TTL_REV = A2.GRS_REV 
    	           ,A1.UPD_USR_ID  = @[upd_usr_id] 
    	           ,A1.UPD_DT      = SYSDATE			]]></sql>
			<params>
				<param name="sim_dt" type="12" value="" out="Y"/>
				<param name="sim_no" type="12" value="" out="Y"/>
				<param name="upd_usr_id" type="12" value="" out="Y"/>
			</params>
		</query>
	</querys>
</sqls>
