<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLIssuanceDBDAOSearchBlIssInfo1RSQL">
			<desc><![CDATA[SearchBlIssInfo1]]></desc>
			<sql><![CDATA[
SELECT 
DECODE(NVL(CHN_AGN_CD, '*'), '*', DECODE(RT_BL_TP_CD, 'C', 1, 'B', 1, CHG_IND.CNT), 1)
||'|'|| MK_IND.CNT
||'|'|| CHG_PPD_IND.CNT
||'|'|| CHG_PPD_THIRD_IND.CNT
||'|'|| NVL(MND.MND_CNT, 0)
||'|'|| NVL(RATE.RATE_CNT, 0)
||'|'|| NVL(CNTR.CNTR_CNT, 0)
||'|'|| NVL(CUST.CUST_CNT, 0)
AS 
BL_NOT_READY
FROM 			
BKG_BOOKING BKG ,			
(SELECT     A.BKG_NO, C.RT_BL_TP_CD, COUNT(B.BKG_NO) CNT			
 FROM       BKG_BOOKING A, 			
            BKG_CHG_RT B,
            BKG_RATE C			
 WHERE      A.BKG_NO = @[bkg_no]			
 AND        A.BKG_NO = B.BKG_NO(+)
 AND        A.BKG_NO = C.BKG_NO(+)			
 GROUP BY   A.BKG_NO , C.RT_BL_TP_CD) CHG_IND,			
(SELECT     A.BKG_NO, COUNT(B.BKG_NO) CNT			
 FROM       BKG_BOOKING A, 			
            BKG_BL_MK_DESC B			
 WHERE      A.BKG_NO = @[bkg_no]			
 AND        A.BKG_NO = B.BKG_NO(+)			
 GROUP BY   A.BKG_NO ) MK_IND,			
(SELECT     A.BKG_NO, COUNT(B.BKG_NO) CNT			
 FROM       BKG_BOOKING A, 			
            BKG_CHG_RT B			
 WHERE      A.BKG_NO = @[bkg_no]			
 AND        A.BKG_NO = B.BKG_NO(+)			
 AND        B.FRT_TERM_CD (+) = 'P'			
 AND        B.N3PTY_RCV_OFC_CD(+) IS NULL			
 GROUP BY   A.BKG_NO ) CHG_PPD_IND, 			
(SELECT     A.BKG_NO, COUNT(B.BKG_NO) CNT			
 FROM       BKG_BOOKING A, 			
            BKG_CHG_RT B			
 WHERE      A.BKG_NO = @[bkg_no]			
 AND        A.BKG_NO = B.BKG_NO(+)			
 AND        B.FRT_TERM_CD (+) = 'P'			
 AND        B.N3PTY_RCV_OFC_CD(+) IS NOT NULL			
 GROUP BY   A.BKG_NO ) CHG_PPD_THIRD_IND, 
(SELECT     A.BKG_NO BKG_NO, 
            --DECODE((NVL(B.PCK_QTY, '0')||NVL(B.ACT_WGT, '0')||NVL(B.CSTMS_DESC, '*')), '00*', 0, 1) MND_CNT 
			DECODE(NVL(B.CSTMS_DESC, '*'), '*', 0, 1) MND_CNT 
 FROM       BKG_BOOKING A, BKG_BL_DOC B
 WHERE      A.BKG_NO = @[bkg_no]
 AND        A.BKG_NO = B.BKG_NO(+) ) MND,
(SELECT     A.BKG_NO, 
            DECODE(NVL(B.RT_BL_TP_CD, 'N'), 'C', 1, 'B', 1, COUNT(C.BKG_NO)) RATE_CNT
 FROM       BKG_BOOKING A,
            BKG_RATE B,
            BKG_CHG_RT C
 WHERE      A.BKG_NO = @[bkg_no]
 AND        A.BKG_NO = B.BKG_NO(+)  
 AND        A.BKG_NO = C.BKG_NO(+)
 GROUP BY   A.BKG_NO, B.RT_BL_TP_CD) RATE,
(SELECT     A.BKG_NO, 
            NVL(COUNT(B.CNTR_NO), 0) CNTR_CNT
 FROM       BKG_BOOKING A, BKG_CONTAINER B
 WHERE      A.BKG_NO = @[bkg_no]
 AND        A.BKG_NO = B.BKG_NO(+)
 GROUP BY   A.BKG_NO ) CNTR,
(SELECT     A.BKG_NO, 
            DECODE(NVL(CUST_NM, '*'), '*', 0, 1) CUST_CNT
 FROM       BKG_BOOKING A, BKG_CUSTOMER B
 WHERE      A.BKG_NO = @[bkg_no]
 AND        A.BKG_NO = B.BKG_NO(+)
 AND        BKG_CUST_TP_CD(+) = 'C') CUST	
WHERE   BKG.BKG_NO = @[bkg_no]			
AND     BKG.BKG_NO = CHG_IND.BKG_NO			
AND     BKG.BKG_NO = MK_IND.BKG_NO
AND     BKG.BKG_NO = CHG_PPD_IND.BKG_NO
AND     BKG.BKG_NO = CHG_PPD_THIRD_IND.BKG_NO
AND     BKG.BKG_NO = MND.BKG_NO(+)
AND     BKG.BKG_NO = RATE.BKG_NO(+)
AND     BKG.BKG_NO = CNTR.BKG_NO(+)
AND     BKG.BKG_NO = CUST.BKG_NO(+)			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
