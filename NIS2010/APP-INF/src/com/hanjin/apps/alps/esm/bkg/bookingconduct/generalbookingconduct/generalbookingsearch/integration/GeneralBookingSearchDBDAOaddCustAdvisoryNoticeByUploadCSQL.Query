<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingSearchDBDAOaddCustAdvisoryNoticeByUploadCSQL">
			<desc><![CDATA[War, Vessel Damage, Vessel dealy 등 Emergemcy Case 가 발생 한 VVD 별 BL,Container 정보를 등록한다.]]></desc>
			<sql><![CDATA[
INSERT INTO BKG_CUST_AVC_NTC_BL
 ( SELECT  A.BL_NO         AS BL_NO
          ,A.POL_CD
          ,A.POD_CD
          ,'N'              AS AVC_NTC_SND_FLG
          ,@[cre_usr_id]    AS CRE_USR_ID
          ,SYSDATE          AS CRE_DT
          ,@[upd_usr_id]    AS UPD_USR_ID
          ,SYSDATE          AS UPD_DT
		  , 'E'			    AS SRC_DAT_TP_CD
  FROM 
        (
            SELECT DISTINCT BK.BKG_NO,
                            BK.BL_NO,                  
                            BK.POL_CD,
                            BK.POD_CD
                    
             FROM (
                   SELECT DISTINCT BK.BKG_NO,
                           BK.BL_NO                   
                   FROM BKG_BOOKING BK,
                        BKG_VVD     BV
                   WHERE BV.VSL_CD     = SUBSTR(@[vvd], 1,4)
                   AND   BV.SKD_VOY_NO = SUBSTR(@[vvd], 5,4)
                   AND   BV.SKD_DIR_CD IN (${dir_sts_cd})
                   AND   BK.BKG_NO = BV.BKG_NO
                   AND   BK.BKG_STS_CD <>'X'

	 		 	  AND NOT EXISTS (SELECT '*' FROM BKG_CUST_AVC_NTC_BL A
									WHERE A.SRC_DAT_TP_CD = 'E'
                				    AND A.BL_NO = BK.BL_NO
                			      )
             ) BV
             , BKG_CUST_AVC_NTC_CNTR BC
             , BKG_BOOKING BK
             WHERE 1=1
             AND   BC.BL_NO = BV.BL_NO
             AND   BK.BL_NO = BV.BL_NO
			 AND   BC.SRC_DAT_TP_CD = 'E'

          
        ) A
)			]]></sql>
			<params>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
