<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="NetworkCostDBDAOMASCreateMonitorRSQL">
			<desc><![CDATA[MAS Create Monitor 를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT  @[f_year]||@[f_fm_mon] AS COST_YRMON
       ,@[f_year]||@[f_fm_wk] AS COST_WK
       ,CASE WHEN SUBSTR(CM_UC_CD,1,2) IN ('CH','OS','OT') THEN
             CASE WHEN CM_UC_CD != 'CHZC' THEN
                  ''
             ELSE
                  TO_CHAR(to_DATE(@[f_year]||@[f_fm_mon],'YYYYMM'),'Q')||'Q'
             END
        ELSE
             ''
        END AS COST_QTR 
       ,MGRP_COST_CD_DESC
       ,STND_COST_NM
       ,COST_CRE_STS_CD
       ,UPD_USR_ID 
       ,UPD_DT
       ,ACCT_DP_SEQ
       ,MGRP_COST_CD
  FROM (        
        SELECT         
                DTL.COST_YRMON      
               ,SUBSTR(DTL.COST_YRMON,1,4)||DTL.COST_WK AS COST_WK
			   ,DECODE(NVL(DTL.COST_WK,'00'),'',DTL.COST_WK) AS QTR
               ,MST.MGRP_COST_CD_DESC AS MGRP_COST_CD_DESC
               ,MST.STND_COST_NM      AS STND_COST_NM
               ,DECODE(NVL(DTL.COST_CRE_STS_CD,'N'),'C','Success','E','Error','N','Not Create','P','Processing') AS COST_CRE_STS_CD
               ,DTL.UPD_USR_ID 
               ,DTL.UPD_DT
               ,LPAD(ACCT_DP_SEQ,2,'0') AS ACCT_DP_SEQ
               ,MST.MGRP_COST_CD
               ,MST.CM_UC_CD
          FROM MAS_UT_COST_CRE_MST MST,
               MAS_UT_COST_CRE_STS DTL
         WHERE MST.CM_UC_CD = DTL.CM_UC_CD(+)
        #if(${f_chkprd} =='M') 
           AND (DTL.COST_YRMON(+) = @[f_year]||@[f_fm_mon])
           AND SUBSTR(MST.CM_UC_CD,1,2) NOT IN ('CH','OS','OT')
           AND MST.CM_UC_CD NOT IN ('OW17', 'OW07', 'OW12', 'OW09')

        #elseif (${f_chkprd} =='W')
           AND SUBSTR(DTL.COST_YRMON(+),1,4)||DTL.COST_WK(+) = @[f_year]||@[f_fm_wk]
           AND SUBSTR(MST.CM_UC_CD,1,2) NOT IN ('AC', 'DM', 'CH', 'OS', 'OT', 'OF', 'OC', 'OV', 'OL')
        #end
        
        #if(${f_chkcost} =='NT') 
               AND MST.MGRP_COST_CD IN ('NT','NP')
        #elseif(${f_chkcost} =='PO') 
               AND MST.MGRP_COST_CD IN ('PO','NP')
        #else
           AND MST.MGRP_COST_CD = @[f_chkcost]
        #end
           
        #if(${f_chkprd} =='M') 
            UNION ALL
            
            SELECT             
                    DTL.COST_YRMON 
			       ,SUBSTR(DTL.COST_YRMON,1,4)||DTL.COST_WK AS COST_WK
       			   ,DECODE(NVL(DTL.COST_WK,'00'),'',DTL.COST_WK) AS QTR
                   ,MST.MGRP_COST_CD_DESC AS MENU
                   ,MST.STND_COST_NM      AS STND_COST_NM
                   ,DECODE(NVL(DTL.COST_CRE_STS_CD,'N'),'C','Success','E','Error','N','Not Create','P','Processing') AS COST_CRE_STS_CD
                   ,DTL.UPD_USR_ID 
                   ,DTL.UPD_DT
                   ,LPAD(ACCT_DP_SEQ,2,'0') AS ACCT_DP_SEQ
                   ,MST.MGRP_COST_CD
                   ,MST.CM_UC_CD
              FROM MAS_UT_COST_CRE_MST MST,
                   MAS_UT_COST_CRE_STS DTL
             WHERE MST.CM_UC_CD = DTL.CM_UC_CD(+)
               AND substr(DTL.COST_YRMON(+),1,4) = @[f_year]
               AND DTL.COST_WK(+) = TO_CHAR(to_DATE(@[f_year]||@[f_fm_mon],'YYYYMM'),'Q')||'Q'
               AND SUBSTR(MST.CM_UC_CD,1,2) IN ('CH','OS','OT')
               AND MST.CM_UC_CD NOT IN ('OW17', 'OW07', 'OW12', 'OW09')
            #if(${f_chkcost} =='NT') 
               AND MST.MGRP_COST_CD IN ('NT','NP')
            #elseif(${f_chkcost} =='PO') 
               AND MST.MGRP_COST_CD IN ('PO','NP')
            #else
               AND MST.MGRP_COST_CD = @[f_chkcost]
            #end
        #end
       )
 ORDER BY ACCT_DP_SEQ ASC			]]></sql>
			<params>
				<param name="f_year" type="12" value="" out="N"/>
				<param name="f_fm_mon" type="12" value="" out="N"/>
				<param name="f_fm_wk" type="12" value="" out="N"/>
				<param name="f_chkcost" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
