<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CLLCDLManifestDBDAOsearchCllCdlCheckForUSRSQL">
			<desc><![CDATA[CllCdlCheckUsaVO]]></desc>
			<sql><![CDATA[
SELECT 	KIND, 
		BKG_NO,
		POL,
		POD,
		BKG_QTY1, 
		DECODE(BKG_QTY2, 0, '', BKG_QTY2) AS BKG_QTY2,
		FPOD,
	 	SHPR_NM,
	 	CNTR_NO, 
	 	CMDT_NM, 
	 	SPECIAL,
	 	RNUM,
		' ' AS MATCH
FROM (
    SELECT  'A' AS KIND, 
        	BKG.BKG_NO, 
    		'' AS POL,
    		'' AS POD,
    	    DECODE( SUBSTR(QTY.CNTR_TPSZ_CD,2,1), '2','20','7','45','40') AS BKG_QTY1, 
      		#if (${tmnl_type} == 'COSCO') 
          		0 AS BKG_QTY2,						/* COSCO */
          		SUBSTR(BKG.POD_CD,3,3) AS FPOD, 	/* COSCO */
      		#elseif (${tmnl_type} == 'GPA') 
          		0 AS BKG_QTY2,						/* GPA */
        		SUBSTR(VVD.POD_CD,3,3) AS FPOD, 	/* GPA */
			#else
        		QTY.OP_CNTR_QTY AS BKG_QTY2, 		/* General, TTI */
        		VVD.POD_CD AS FPOD, 				/* General, TTI */
      		#end
        	REPLACE(REPLACE(REPLACE(CUST.CUST_NM, CHR(10), ''), CHR(13), ''), CHR(9), '') AS SHPR_NM, 
        	CNTR.CNTR_NO, 
        	SUBSTR(REP.CMDT_NM, 1, 30) AS CMDT_NM, 
      		#if (${tmnl_type} != 'GPA') 
        		REPLACE(DECODE(SIGN(FDO_TEMP),0,'+',1,'+')||TO_CHAR(RF.FDO_TEMP,'000.00')||DECODE(RF.FDO_TEMP,NULL,'','F'),' ','') AS SPECIAL, 	/* General, TTI, COSCO */
      		#else  
          		'' AS SPECIAL, 	/* GPA */
      		#end
            ROW_NUMBER() OVER(ORDER BY VVD.POD_CD, BKG.BKG_NO, CNTR.CNTR_NO) AS RNUM
    FROM    BKG_BOOKING BKG, 
            BKG_QUANTITY QTY, 
            BKG_CUSTOMER CUST, 
            BKG_VVD VVD, 
            BKG_CONTAINER CNTR, 
            MDM_COMMODITY REP, 
            BKG_RF_CGO RF 
    WHERE  BKG.BKG_NO = VVD.BKG_NO  
      AND  NVL(BKG.BKG_STS_CD,'N') <> 'X' 
      AND  BKG.BKG_NO = QTY.BKG_NO  
      AND  BKG.BKG_NO = CUST.BKG_NO  
      AND  BKG.BKG_NO = CNTR.BKG_NO  
      AND  QTY.CNTR_TPSZ_CD = CNTR.CNTR_TPSZ_CD  
      AND  BKG.CMDT_CD = REP.CMDT_CD(+)  
      AND  CUST.BKG_CUST_TP_CD = 'S' 
      AND  VVD.VSL_PRE_PST_CD = 'T' 
      AND  CNTR.BKG_NO = RF.BKG_NO(+) 
      AND  CNTR.CNTR_NO = RF.CNTR_NO(+) 
	  AND  VVD.VSL_CD = SUBSTR(@[vvd],1,4)
	  AND  VVD.SKD_VOY_NO =  SUBSTR(@[vvd],5,4)
	  AND  VVD.SKD_DIR_CD =  SUBSTR(@[vvd],9,1)
	  #if (${pol_cd} != '') 
	  AND  VVD.POL_CD =  @[pol_cd] 
	  #end
	  #if (${pod_cd} != '') 
	  AND  VVD.POD_CD =  @[pod_cd]
	  #end
	  #if (${inc_mty} == 'N') 
	  AND  (NVL(bkg.bkg_cgo_tp_cd,'Q') <>'P')  --Including Empty Unchecked인 경우
	  #end
    UNION ALL
    SELECT  ' ' AS KIND, 
        	'' AS BKG_NO,  
    		'' AS POL,
    		'' AS POD,
    		'' AS BKG_QTY1, 
    		0  AS BKG_QTY2, 
    		'' AS FPOD,
    		'' AS SHPR_NM,
    		'' AS CNTR_NO,
    		'' AS CMDT_NM, 
    		'' AS SPECIAL,
            ROW_NUMBER() OVER(ORDER BY VVD.POD_CD, BKG.BKG_NO, CNTR.CNTR_NO) AS RNUM
    FROM    BKG_BOOKING BKG,
            BKG_QUANTITY QTY, 
            BKG_CUSTOMER CUST, 
            BKG_VVD VVD, 
            BKG_CONTAINER CNTR, 
            MDM_COMMODITY REP, 
            BKG_RF_CGO RF 
    WHERE  BKG.BKG_NO = VVD.BKG_NO  
      AND  NVL(BKG.BKG_STS_CD,'N') <> 'X' 
      AND  BKG.BKG_NO = QTY.BKG_NO  
      AND  BKG.BKG_NO = CUST.BKG_NO  
      AND  BKG.BKG_NO = CNTR.BKG_NO  
      AND  QTY.CNTR_TPSZ_CD = CNTR.CNTR_TPSZ_CD  
      AND  BKG.CMDT_CD = REP.CMDT_CD(+)  
      AND  CUST.BKG_CUST_TP_CD = 'S' 
      AND  VVD.VSL_PRE_PST_CD = 'T' 
      AND  CNTR.BKG_NO = RF.BKG_NO(+) 
      AND  CNTR.CNTR_NO = RF.CNTR_NO(+) 
	  AND  VVD.VSL_CD = SUBSTR(@[vvd],1,4)
	  AND  VVD.SKD_VOY_NO =  SUBSTR(@[vvd],5,4)
	  AND  VVD.SKD_DIR_CD =  SUBSTR(@[vvd],9,1)
	  #if (${pol_cd} != '') 
	  AND  VVD.POL_CD =  @[pol_cd] 
	  #end
	  #if (${pod_cd} != '') 
	  AND  VVD.POD_CD =  @[pod_cd]
	  #end
	  #if (${inc_mty} == 'N') 
	  AND  (NVL(bkg.bkg_cgo_tp_cd,'Q') <>'P')  --Including Empty Unchecked인 경우
	  #end
)
ORDER BY RNUM, KIND DESC			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
