<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLDocumentationBLDBDAOSearchCntrTpForDZRSQL">
			<desc><![CDATA[BLDocumentationBLDBDAOSearchCntrTpForDZRSQL]]></desc>
			<sql><![CDATA[
#if (${ca_flg} == 'Y')
SELECT CASE WHEN ETD.CNT = 0 THEN 'DZ'
            WHEN ETD.CNT>0 and CNTR.DRY_CNTR > 0  AND  CNTR.SPCL_CNTR > 0 THEN 'M'
            WHEN ETD.CNT>0 and CNTR.DRY_CNTR > 0  AND  CNTR.SPCL_CNTR = 0 THEN 'D'
            WHEN ETD.CNT>0 and CNTR.SPCL_CNTR > 0 AND  CNTR.DRY_CNTR = 0 THEN 'S'
            ELSE ''
            END AS CNTR_TP
  FROM 
    (
    SELECT SUM(DECODE(DECODE(CNTR.RD_CGO_FLG,'Y','D',SUBSTR(CNTR.CNTR_TPSZ_CD,0,1)),'D',1,0)) DRY_CNTR
          ,SUM(DECODE(DECODE(CNTR.RD_CGO_FLG,'Y','D',SUBSTR(CNTR.CNTR_TPSZ_CD,0,1)),'D',0,1)) SPCL_CNTR
      FROM BKG_CNTR_HIS CNTR 
     WHERE 1=1
       AND CNTR.BKG_NO = @[bkg_no] 
       AND CNTR.CORR_NO = 'TMP0000001'
    )CNTR
   ,(
    SELECT COUNT(*) CNT
     FROM BKG_VVD_HIS VVD, VSK_VSL_PORT_SKD VSK
    WHERE 1=1
     AND VVD.BKG_NO = @[bkg_no] 
     AND VVD.CORR_NO = 'TMP0000001'
     AND VVD.VSL_CD = VSK.VSL_CD
     AND VVD.SKD_VOY_NO = VSK.SKD_VOY_NO
     AND VVD.SKD_DIR_CD = VSK.SKD_DIR_CD
     AND VVD.POL_CD = VSK.VPS_PORT_CD
     AND VVD.POL_CLPT_IND_SEQ = VSK.CLPT_IND_SEQ
     AND VVD.VSL_PRE_PST_CD||VVD.VSL_SEQ = ( SELECT MIN(VSL_PRE_PST_CD||VSL_SEQ) FROM BKG_VVD_HIS VVD2 WHERE VVD2.BKG_NO = VVD.BKG_NO AND VVD2.CORR_NO= VVD.CORR_NO)
     AND VSK.VPS_ETD_DT >= TO_DATE('201501010000','YYYYMMDDHH24MISS')) ETD
#else
SELECT CASE WHEN ETD.CNT = 0 THEN 'DZ'
            WHEN ETD.CNT>0 and CNTR.DRY_CNTR > 0  AND  CNTR.SPCL_CNTR > 0 THEN 'M'
            WHEN ETD.CNT>0 and CNTR.DRY_CNTR > 0  AND  CNTR.SPCL_CNTR = 0 THEN 'D'
            WHEN ETD.CNT>0 and CNTR.SPCL_CNTR > 0 AND  CNTR.DRY_CNTR = 0 THEN 'S'
            ELSE ''
            END AS CNTR_TP
  FROM 
    (
    SELECT SUM(DECODE(DECODE(CNTR.RD_CGO_FLG,'Y','D',SUBSTR(CNTR.CNTR_TPSZ_CD,0,1)),'D',1,0)) DRY_CNTR
          ,SUM(DECODE(DECODE(CNTR.RD_CGO_FLG,'Y','D',SUBSTR(CNTR.CNTR_TPSZ_CD,0,1)),'D',0,1)) SPCL_CNTR
      FROM BKG_CONTAINER CNTR
    WHERE CNTR.BKG_NO = @[bkg_no] 
    ) CNTR
   ,(
    SELECT COUNT(*) CNT
     FROM BKG_VVD VVD, VSK_VSL_PORT_SKD VSK
    WHERE 1=1
     AND VVD.BKG_NO = @[bkg_no] 
     AND VVD.VSL_CD = VSK.VSL_CD
     AND VVD.SKD_VOY_NO = VSK.SKD_VOY_NO
     AND VVD.SKD_DIR_CD = VSK.SKD_DIR_CD
     AND VVD.POL_CD = VSK.VPS_PORT_CD
     AND VVD.POL_CLPT_IND_SEQ = VSK.CLPT_IND_SEQ
     AND VVD.VSL_PRE_PST_CD||VVD.VSL_SEQ = ( SELECT MIN(VSL_PRE_PST_CD||VSL_SEQ) FROM BKG_VVD VVD2 WHERE VVD2.BKG_NO = VVD.BKG_NO)
     AND VSK.VPS_ETD_DT >= TO_DATE('201501010000','YYYYMMDDHH24MISS')) ETD
#end			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
