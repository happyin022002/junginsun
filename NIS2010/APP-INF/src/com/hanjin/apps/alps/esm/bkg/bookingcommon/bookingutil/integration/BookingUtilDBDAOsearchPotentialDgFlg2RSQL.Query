<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingUtilDBDAOsearchPotentialDgFlg2RSQL">
			<desc><![CDATA[potential DG화물목록을 체크한다.
어디서 걸린 것인지 체크하기 위해 걸린 키워드 앞에 해당하는 컬럼붙여서 구분]]></desc>
			<sql><![CDATA[
SELECT DECODE ((SELECT 'Y'
                    FROM BKG_DG_CGO 
                   WHERE BKG_NO = @[bkg_no]
                     AND ROWNUM = 1),'Y','N','','Y') flg
       ,NVL(BKG_JOIN_FNC(CURSOR((SELECT BLCK_KW_NM 
              FROM (
                    #if (${div_cd}== 'MND' || ${div_cd}== 'All')
                        SELECT CASE WHEN BHCC.BLCK_KW_NM is not null then 'MND_CSTMS_'||BHCC.BLCK_KW_NM END BLCK_KW_NM 
                        FROM BKG_BLCK_KW_LIST BHCC
                        #if (${ca_flg}== 'Y')
                             ,BKG_BL_DOC_HIS BBD
                        WHERE BBD.BKG_NO = @[bkg_no]
                        AND BBD.CORR_NO = 'TMP0000001'
                        #else
                              ,BKG_BL_DOC BBD
                        WHERE BBD.BKG_NO = @[bkg_no]
                        #end     
                        AND BHCC.BLCK_KW_TP_CD = 'MIS'
                        AND UPPER(BBD.CSTMS_DESC) LIKE '%'||BHCC.BLCK_KW_NM||'%'
                        UNION ALL
                        SELECT CASE WHEN BHCC.BLCK_KW_NM is not null THEN 'MND_CMDT_'||BHCC.BLCK_KW_NM END BLCK_KW_NM
                        FROM BKG_BLCK_KW_LIST BHCC
                        #if (${ca_flg}== 'Y')
                             ,BKG_BL_MK_DESC_HIS BBM
                        WHERE BBM.BKG_NO = @[bkg_no]
                        AND BBM.CORR_NO = 'TMP0000001'
                        #else
                              ,BKG_BL_MK_DESC BBM
                        WHERE BBM.BKG_NO = @[bkg_no]
                        #end   
                        AND BLCK_KW_TP_CD = 'MIS'
                        AND BBM.BKG_NO = @[bkg_no]
                        AND UPPER(BBM.CMDT_DESC) LIKE '%'||BHCC.BLCK_KW_NM||'%'
                    #end  
                    #if (${div_cd}== 'All')
                        UNION ALL
                    #end  
                    #if (${div_cd}== 'CM' || ${div_cd}== 'All')
                        SELECT BHCC.BLCK_KW_NM
                        FROM BKG_BLCK_KW_LIST BHCC
                        #if (${ca_flg}== 'Y')
                            ,BKG_CNTR_MF_DESC_HIS BBMD
                        WHERE BBMD.BKG_NO = @[bkg_no]
                        AND BBMD.CORR_NO = 'TMP0000001'
                        #else
                             ,BKG_CNTR_MF_DESC BBMD
                        WHERE BBMD.BKG_NO = @[bkg_no]
                        #end   
                        AND BHCC.BLCK_KW_TP_CD = 'MIS'
                        AND UPPER(BBMD.CNTR_MF_GDS_DESC) LIKE '%'||BHCC.BLCK_KW_NM||'%'
                    #end
                    #if (${div_cd}== 'All')
                        UNION ALL
                    #end  
                    #if (${div_cd}== 'RMK' || ${div_cd}== 'All')
                        SELECT BHCC.BLCK_KW_NM
                        FROM BKG_BLCK_KW_LIST BHCC
                        #if (${ca_flg}== 'Y')
                            ,BKG_BKG_HIS BB
                        WHERE BB.BKG_NO = @[bkg_no]
                        AND BB.CORR_NO = 'TMP0000001'
                        #else
                            ,BKG_BOOKING BB
                        WHERE BB.BKG_NO = @[bkg_no]
                        #end  
                        AND BLCK_KW_TP_CD = 'MIS'
                        AND (UPPER(BB.XTER_RMK) LIKE '%'||BHCC.BLCK_KW_NM||'%'
                        OR UPPER(BB.INTER_RMK) LIKE '%'||BHCC.BLCK_KW_NM||'%')
                    #end  
                        )))),'') RSLT
FROM DUAL			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
