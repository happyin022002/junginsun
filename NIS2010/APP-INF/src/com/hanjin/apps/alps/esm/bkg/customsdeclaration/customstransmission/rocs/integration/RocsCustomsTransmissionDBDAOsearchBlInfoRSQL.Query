<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RocsCustomsTransmissionDBDAOsearchBlInfoRSQL">
			<desc><![CDATA[ROCS(ROTTERDAM) 세관 신고용 B/L 일반 정보를 조회한다.
1. 2011.01.11 이수진 [CHM-201007774] EUR 24HR 관련 구주 세관 시스템 MRN 정보 추가 요청
    : MRN 정보 추가]]></desc>
			<sql><![CDATA[
SELECT R.HEAD_CD
     , R.VVD
     , R.FLAG
     , R.WGT
     , R.WGT_U
	 , R.FRT_OPT
	 , R.BL_NO
	 , E.MVMT_REF_NO MRN_NO
     , R.T1_IND
     , R.SCAC
     , R.LLOYD_CD
     , R.POD
     , R.BERTH_CD
     , R.POD_ETA
     , R.POL
     , R.POL_ATD
     , R.PRE
     , R.POST    
     , R.POR
     , R.DEL_CD
     , R.SS_REF_NO
     , R.SENDER_ID
     , R.SENDER_CD
     , R.CARRIER_ID
     , R.CARRIER
     , R.SHPR_EORI
     , R.SHPR_NAME
     , R.SHPR_ADDR_STR
     , R.SHPR_ADDR_CITY
     , R.SHPR_ADDR_PLC
     , R.SHPR_ADDR_CNTRY
     , R.SHPR_ADDR
     , R.CNEE_EORI
     , R.CNEE_NAME
     , R.CNEE_ADDR_STR
     , R.CNEE_ADDR_CITY
     , R.CNEE_ADDR_PLC
     , R.CNEE_ADDR_CNTRY
     , R.CNEE_ADDR
     , R.NTFY_EORI
     , R.NTFY_NAME
     , R.NTFY_ADDR_STR
     , R.NTFY_ADDR_CITY
     , R.NTFY_ADDR_PLC
     , R.NTFY_ADDR_CNTRY
     , R.NTFY_ADDR
     , R.VSL_CALL_REF_NO
     , R.BKG_NO
  FROM(
      SELECT A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD||'-'||B.BL_NO HEAD_CD, 
                A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD VVD,
                @[kind] FLAG,
                TO_CHAR(DECODE(B.BKG_TTL_QTY_UT_CD,'LBS',ROUND(NVL(B.BKG_TTL_QTY,0)*0.4536,0),B.BKG_TTL_QTY)) WGT,
                'KGS' WGT_U,
                DECODE(B.FRT_TERM_CD,'C','CC','P','PO','  ') FRT_OPT,
                B.BL_NO,
                DECODE(B.T1_DOC_CD,null,'0',B.T1_DOC_CD) T1_IND,
               'SMLM' SCAC,
                C.LLOYD_NO LLOYD_CD,
               'NLRTM' POD,
               A.BRTH_CTNT BERTH_CD,
               TO_CHAR(B.ETA_DT,'yyyymmdd') POD_ETA,
			   X.LOC_CD POL,
--               DECODE(B.PRE_RLY_PORT_CD,null,BKG_RTM_BL_POL_LOC.UN_LOC_CD,' ',BKG_RTM_BL_POL_LOC.UN_LOC_CD,BKG_RTM_BL_PRE_RLY.UN_LOC_CD) POL,
               TO_CHAR(B.ETD_DT,'yyyymmdd') POL_ATD,
               BKG_RTM_BL_POL_LOC.UN_LOC_CD PRE,
               BKG_RTM_BL_POD_LOC.UN_LOC_CD POST,    
               LR.LOC_NM POR,
               LD.LOC_NM DEL_CD,
               A.VSL_CALL_REF_NO SS_REF_NO,
               'NL24182360' SENDER_ID,
               'SM LINE CORPORATION' SENDER_CD,
               'NL24182360' CARRIER_ID,
               'SM LINE CORPORATION' CARRIER,
				B.SHPR_EORI_NO SHPR_EORI,
                REPLACE(SUBSTR(B.SHPR_ADDR,1,INSTR(B.SHPR_ADDR,@[dif_char])-1),CHR(13)||CHR(10),' ') SHPR_NAME,
				B.SHPR_ST_NM SHPR_ADDR_STR,
				B.SHPR_CTY_NM SHPR_ADDR_CITY,
				B.SHPR_ZIP_ID SHPR_ADDR_PLC,
				B.SHPR_CSTMS_DECL_CNT_CD SHPR_ADDR_CNTRY,
                REPLACE(SUBSTR(B.SHPR_ADDR,INSTR(B.SHPR_ADDR,@[dif_char])+2,LENGTH(B.SHPR_ADDR)-instr(B.SHPR_ADDR,@[dif_char])+1),CHR(13)||CHR(10),' ') SHPR_ADDR,
				B.CNEE_EORI_NO CNEE_EORI,
                REPLACE(SUBSTR(B.CNEE_ADDR,1,INSTR(B.CNEE_ADDR,@[dif_char])-1),CHR(13)||CHR(10),' ') CNEE_NAME,
				B.CNEE_ST_NM CNEE_ADDR_STR,
				B.CNEE_CTY_NM CNEE_ADDR_CITY,
				B.CNEE_ZIP_ID CNEE_ADDR_PLC,
				B.CNEE_CSTMS_DECL_CNT_CD CNEE_ADDR_CNTRY,
                REPLACE(SUBSTR(B.CNEE_ADDR,INSTR(B.CNEE_ADDR,@[dif_char])+2,LENGTH(B.CNEE_ADDR)-instr(B.CNEE_ADDR,@[dif_char])+1),CHR(13)||CHR(10),' ') CNEE_ADDR,
				B.NTFY_EORI_NO NTFY_EORI,
                REPLACE(SUBSTR(B.NTFY_ADDR,1,INSTR(B.NTFY_ADDR,@[dif_char])-1),CHR(13)||CHR(10),' ') NTFY_NAME,
				B.NTFY_ST_NM NTFY_ADDR_STR,
				B.NTFY_CTY_NM NTFY_ADDR_CITY,
				B.NTFY_ZIP_ID NTFY_ADDR_PLC,
				B.NTFY_CSTMS_DECL_CNT_CD NTFY_ADDR_CNTRY,
                REPLACE(SUBSTR(B.NTFY_ADDR,INSTR(B.NTFY_ADDR,@[dif_char])+2,LENGTH(B.NTFY_ADDR)-instr(B.NTFY_ADDR,@[dif_char])+1),CHR(13)||CHR(10),' ') NTFY_ADDR,
               B.VSL_CALL_REF_NO,
               B.BKG_NO, 
               A.VSL_CD,A.SKD_VOY_NO,A.SKD_DIR_CD
          FROM BKG_CSTMS_RTM_VSL A,BKG_CSTMS_RTM_BL B,MDM_VSL_CNTR C, MDM_LOCATION LR, MDM_LOCATION LD, 
               MDM_LOCATION BKG_RTM_BL_POL_LOC,
               MDM_LOCATION BKG_RTM_BL_POD_LOC,
               MDM_LOCATION BKG_RTM_BL_PRE_RLY,
               (SELECT BKG_NO BKG_NO, POL_CD LOC_CD
                  FROM   BKG_VVD
                  WHERE POD_CD 		= 'NLRTM') X
         WHERE A.VSL_CALL_REF_NO = B.VSL_CALL_REF_NO
	   AND A.VSL_CALL_REF_STS_CD <> 'C'
		#if(${vsl_cd} != '')
	   AND A.VSL_CD = @[vsl_cd]
       AND A.SKD_VOY_NO = @[skd_voy_no]
       AND A.SKD_DIR_CD = @[skd_dir_cd]
		#else
	   AND A.VSL_CALL_REF_NO =@[frm_crn_number] 
       AND A.VSL_CD = B.VSL_CD
       AND A.SKD_VOY_NO = B.SKD_VOY_NO
       AND A.SKD_DIR_CD = B.SKD_DIR_CD
		#end
	   AND B.BL_NO = SUBSTR(@[bl_no],0,12)
	   AND C.VSL_CD = A.VSL_CD
	   AND B.POR_CD = LR.LOC_CD
	   AND B.DEL_CD = LD.LOC_CD
	   AND B.POL_CD = BKG_RTM_BL_POL_LOC.LOC_CD
	   AND B.POD_CD = BKG_RTM_BL_POD_LOC.LOC_CD
	   AND B.BKG_NO = X.BKG_NO(+)	   
	   AND X.LOC_CD = BKG_RTM_BL_PRE_RLY.LOC_CD(+)
     )R,
    (SELECT VSL_CD,SKD_VOY_NO,SKD_DIR_CD, BL_NO, POD_CD, MVMT_REF_NO  FROM BKG_CSTMS_EUR_BL WHERE POD_CD = 'NLRTM' )E
      WHERE R.VSL_CD = E.VSL_CD(+)
        AND R.SKD_VOY_NO = E.SKD_VOY_NO(+)
        AND R.SKD_DIR_CD = E.SKD_DIR_CD(+)
        AND R.BL_NO = E.BL_NO(+)			]]></sql>
			<params>
				<param name="kind" type="12" value="" out="N"/>
				<param name="dif_char" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="frm_crn_number" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
