<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CargoReleaseOrderDBDAOSearchDemDetFreetimeEndDtRSQL">
			<desc><![CDATA[DemDet의 Free Time End Date 값을 조회한다.]]></desc>
			<sql><![CDATA[
SELECT   BCNTR.BKG_NO                                       AS BKG_NO
        ,BCNTR.CNTR_NO                                      AS CNTR_NO
        ,TO_CHAR(DMT_CALC.DMIF_END_DT,'YYYY/MM/DD')         AS FT_END_DT
FROM    BKG_CONTAINER    BCNTR,
        ( 
            SELECT   C.CNTR_NO
                    ,C.CNTR_CYC_NO
                    ,MAX(DECODE(NVL(INVM1.DMDT_AR_IF_CD, 'N'),'Y', TO_MVMT_DT,'N', FT_END_DT))   AS DMIF_END_DT
            FROM    DMT_CHG_CALC    C,
                    DMT_INV_MN  INVM1
            WHERE   (SYS_AREA_GRP_ID,CNTR_NO,CNTR_CYC_NO) IN
                    ( SELECT SYS_AREA_GRP_ID,CNTR_NO,CNTR_CYC_NO FROM DMT_CHG_BKG_CNTR WHERE BKG_NO = @[bkg_no])
            AND     C.DMDT_INV_NO        = INVM1.DMDT_INV_NO(+)
            AND     C.SYS_AREA_GRP_ID = 'KOR'
            AND C.DMDT_CHG_STS_CD IN ('F', 'C', 'I', 'L', 'N', 'U')  
            AND (   ( C.DMDT_TRF_CD = 'DMIF'  AND C.DMDT_CHG_LOC_DIV_CD = 'POD')
                 OR ( C.DMDT_TRF_CD = 'CTIC'  AND C.DMDT_CHG_LOC_DIV_CD = 'DEL')
                 )
           
            AND NOT (C.DUL_TP_EXPT_FLG  = 'Y' AND SUBSTR(C.DMDT_TRF_CD, 1, 1) = 'D')
            AND C.DMDT_CHG_LOC_DIV_CD	<> 'SZP'  

            GROUP BY C.CNTR_NO, C.CNTR_CYC_NO
        )   DMT_CALC
WHERE   BCNTR.BKG_NO          = @[bkg_no] 
AND     BCNTR.CNTR_NO         = DMT_CALC.CNTR_NO(+)
AND     BCNTR.CNMV_CYC_NO     = DMT_CALC.CNTR_CYC_NO(+)			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
