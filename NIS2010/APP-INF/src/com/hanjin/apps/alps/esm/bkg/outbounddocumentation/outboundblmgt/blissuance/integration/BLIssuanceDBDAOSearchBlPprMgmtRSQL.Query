<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLIssuanceDBDAOSearchBlPprMgmtRSQL">
			<desc><![CDATA[BLIssuanceDBDAOSearchBlPprMgmtRSQL]]></desc>
			<sql><![CDATA[
SELECT PPR.DTRB_YR
      ,PPR.RHQ_CD
      ,PPR.OFC_CD
      ,PPR.CUST_CNT_CD
      ,PPR.CUST_SEQ
      ,MDM.CUST_LGL_ENG_NM AS CUST_NM
      ,PPR.CUST_DTRB_KNT
      ,NVL((SELECT /*+ INDEX(AUTH XAK01BKG_INET_BL_PRN_AUTH) */ count(*) * 3
             FROM BKG_INET_BL_PRN_AUTH AUTH
            WHERE AUTH.AUTH_DT IS NOT NULL
              AND AUTH.N1ST_PRN_DT IS NOT NULL
              AND AUTH.DELT_FLG = 'N'
              AND AUTH.PRN_CUST_CNT_CD = PPR.CUST_CNT_CD
              AND AUTH.PRN_CUST_SEQ = PPR.CUST_SEQ
#if (${cre_from_dt} != '' && ${cre_from_dt} != '') 
              AND AUTH.N1ST_PRN_DT >= TO_DATE(@[cre_from_dt], 'YYYY-MM-DD')
              AND AUTH.N1ST_PRN_DT < TO_DATE(@[cre_to_dt], 'YYYY-MM-DD') + 1
#else
              AND AUTH.N1ST_PRN_DT >= DECODE(@[dtrb_yr],'2015',TO_DATE('20150401','YYYYMMDD'),TO_DATE(@[dtrb_yr]||'0101','YYYYMMDD'))
              AND AUTH.N1ST_PRN_DT < DECODE(@[dtrb_yr],'2015',TO_DATE('20160101','YYYYMMDD'),SYSDATE) 
#end   
        ),0) AS CUST_WDR_KNT
      ,NVL((SELECT /*+ INDEX(AUTH XAK01BKG_INET_BL_PRN_AUTH) */ count(*) * 3
             FROM BKG_INET_BL_PRN_AUTH AUTH
            WHERE AUTH.AUTH_DT IS NOT NULL
              AND AUTH.N1ST_PRN_DT IS NOT NULL
              AND AUTH.DELT_FLG = 'N'
              AND AUTH.PRN_CUST_CNT_CD = PPR.CUST_CNT_CD
              AND AUTH.PRN_CUST_SEQ = PPR.CUST_SEQ
              AND AUTH.N1ST_PRN_DT >= DECODE(@[dtrb_yr],'2015',TO_DATE('20150401','YYYYMMDD'),TO_DATE(@[dtrb_yr]||'0101','YYYYMMDD'))
              AND AUTH.N1ST_PRN_DT < DECODE(@[dtrb_yr],'2015',TO_DATE('20160101','YYYYMMDD'),SYSDATE) 
        ),0) AS CUST_ACCM_WDR_KNT
      ,TO_CHAR(PPR.UPD_DT,'YYYY.MM.DD') AS UPD_DT
  FROM BKG_CUST_BL_PPR_MGMT PPR
      ,MDM_CUSTOMER MDM
 WHERE PPR.DTRB_YR = @[dtrb_yr]
#if (${rhq_cd} != '') 
   AND PPR.RHQ_CD = @[rhq_cd]
#end   
#if (${ofc_cd} != '') 
   AND PPR.OFC_CD = @[ofc_cd]
#end   
#if (${cust_cnt_cd} != '') 
   AND PPR.CUST_CNT_CD = @[cust_cnt_cd]
#end 
#if (${cust_seq} != '') 
   AND PPR.CUST_SEQ = @[cust_seq]
#end 
   AND PPR.CUST_CNT_CD = MDM.CUST_CNT_CD
   AND PPR.CUST_SEQ = MDM.CUST_SEQ
#if (${cust_nm} != '') 
   AND MDM.CUST_LGL_ENG_NM LIKE '%'||@[cust_nm]||'%'
#end
ORDER BY PPR.DTRB_YR
        ,PPR.RHQ_CD
        ,PPR.OFC_CD
        ,PPR.CUST_CNT_CD
        ,PPR.CUST_SEQ			]]></sql>
			<params>
				<param name="cre_from_dt" type="12" value="" out="N"/>
				<param name="cre_to_dt" type="12" value="" out="N"/>
				<param name="dtrb_yr" type="12" value="" out="N"/>
				<param name="rhq_cd" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="cust_cnt_cd" type="12" value="" out="N"/>
				<param name="cust_seq" type="12" value="" out="N"/>
				<param name="cust_nm" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
