<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CargoReleaseOrderDBDAOsearchEdiRcvSndIdCrRSQL">
			<desc><![CDATA[...]]></desc>
			<sql><![CDATA[
SELECT 'CR' AS EDI_MSG_ID, E.EDI_RCV_ID, E.EDI_SND_ID, E.YD_CD
  FROM BKG_CGO_RLSE     A,
       BKG_BOOKING      B,
       BKG_VVD          C,
       VSK_VSL_PORT_SKD D,
       BKG_EDI_YD       E
 WHERE A.BL_NO       = @[bl_no]
   AND A.BL_NO       = B.BL_NO
   AND B.BKG_NO      = C.BKG_NO
   AND C.VSL_CD      = D.VSL_CD
   AND C.SKD_VOY_NO  = D.SKD_VOY_NO
   AND C.SKD_DIR_CD  = D.SKD_DIR_CD
   AND D.VPS_PORT_CD LIKE 'US%'  
   AND C.SLAN_CD     = D.SLAN_CD
   AND D.VPS_PORT_CD = @[pod_cd]
   AND SUBSTR(E.YD_CD,6) = NVL( @[bkg_pod_yd_cd] , SUBSTR(E.YD_CD,6) )
   AND D.YD_CD       = E.YD_CD
   AND (E.FULL_RLSE_EDI_CD = '1' OR E.FULL_RLSE_EDI_CD = '2')
   AND ROWNUM	= 1
   AND 'CR1'    = @[edi_knd] 
UNION   
SELECT 'CR' AS EDI_MSG_ID, E.EDI_RCV_ID, E.EDI_SND_ID, E.YD_CD
  FROM BKG_CGO_RLSE     A,
       BKG_BOOKING      B,
       BKG_VVD          C,
       VSK_VSL_PORT_SKD D,
       BKG_EDI_YD       E
 WHERE A.BL_NO       = @[bl_no]
   AND A.FRT_CLT_FLG  = 'Y'
   AND A.OBL_RDEM_FLG = 'Y'
   AND A.BL_NO       = B.BL_NO
   AND B.BKG_NO      = C.BKG_NO
   AND C.VSL_CD      = D.VSL_CD
   AND C.SKD_VOY_NO  = D.SKD_VOY_NO
   AND C.SKD_DIR_CD  = D.SKD_DIR_CD
   AND D.VPS_PORT_CD LIKE 'US%'  
   AND C.SLAN_CD     = D.SLAN_CD
   AND D.VPS_PORT_CD = @[pod_cd]
   AND SUBSTR(E.YD_CD,6) = NVL( @[bkg_pod_yd_cd] , SUBSTR(E.YD_CD,6) )
   AND D.YD_CD       = E.YD_CD
   AND E.FULL_RLSE_EDI_CD = DECODE(SUBSTR(B.POD_CD,1,2),'CA','2','1')
   AND ROWNUM	      = 1
   AND 'CR2'    = @[edi_knd] 
UNION
SELECT 'CR' AS EDI_MSG_ID, C.EDI_RCV_ID, C.EDI_SND_ID, C.YD_CD 
  FROM BKG_CGO_RLSE A,
       BKG_BOOKING  B,
       BKG_EDI_YD   C
 WHERE A.BL_NO        = @[bl_no] 
   AND A.BL_NO        = B.BL_NO
   AND A.FRT_CLT_FLG  = 'Y'
   AND A.OBL_RDEM_FLG = 'Y'
   AND DECODE(A.CSTMS_CLR_CD,'Y','Y',
                             'T','Y',
                             'E','Y',
                             'I','Y',
                             'W','Y',
                             'P','Y','N') = 'Y'
   AND C.PORT_CD = @[pod_cd]
   AND SUBSTR(C.YD_CD,6) = NVL( @[bkg_pod_yd_cd] , SUBSTR(C.YD_CD,6) )
   AND B.SLAN_CD IN (C.SLAN_CD1,C.SLAN_CD2,C.SLAN_CD3,C.SLAN_CD4,C.SLAN_CD5,
                     C.SLAN_CD6,C.SLAN_CD7,C.SLAN_CD8,C.SLAN_CD9,C.SLAN_CD10)
   AND C.FULL_RLSE_EDI_CD = '2'
   AND ROWNUM	      = 1
   AND 'CR3'    = @[edi_knd] 
UNION
SELECT 'CR' AS EDI_MSG_ID, E.EDI_RCV_ID, E.EDI_SND_ID, E.YD_CD
  FROM BKG_CGO_RLSE     A,
       BKG_BOOKING      B,
       BKG_VVD          C,
       VSK_VSL_PORT_SKD D,
       BKG_EDI_YD       E
 WHERE A.BL_NO       = @[bl_no]
   AND A.BL_NO       = B.BL_NO
   AND B.BKG_NO      = C.BKG_NO
   AND C.VSL_CD      = D.VSL_CD
   AND C.SKD_VOY_NO  = D.SKD_VOY_NO
   AND C.SKD_DIR_CD  = D.SKD_DIR_CD
   AND D.VPS_PORT_CD LIKE 'US%'  
   AND C.SLAN_CD     = D.SLAN_CD
   AND D.VPS_PORT_CD = @[pod_cd]
   AND SUBSTR(E.YD_CD,6) = NVL( @[bkg_pod_yd_cd] , SUBSTR(E.YD_CD,6) )
   AND D.YD_CD       = E.YD_CD
   AND ROWNUM	          = 1
   AND 'CR4'              = @[edi_knd]			]]></sql>
			<params>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="bkg_pod_yd_cd" type="12" value="" out="N"/>
				<param name="edi_knd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
