/*=========================================================
*Copyright(c) 2016 CyberLogitec
*@FileName : QtaAdjustmentDBDAOCompareWithRHQRSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2016.06.21
*@LastModifier : 
*@LastVersion : 1.0
* 2016.06.21 
* 1.0 Creation
=========================================================*/
package com.hanjin.apps.alps.esm.sqm.adjustment.qtaadjustment.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.hanjin.framework.support.db.ISQLTemplate;

/**
 *
 * @author 
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class QtaAdjustmentDBDAOCompareWithRHQRSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * * 2015.07.22 김용습 [CHM-201537172] [CSR 전환건] QTA Adjustment by VVD 화면 내 신규 기능 추가
	  * QTA Adjustment by VVD과 Portion Adjustment by RHQ의 결과를 비교하여 QTA Adjustment by VVD 화면에 뿌려줌
	  * * 2015.09.09 김용습 [CHM-201537818] QTA Adjustment by VVD, QTA Adjustment by VVD for IAS Sector 두 화면내 칼럼 수정
	  * 2016.03.22 CHM-201640709 Adjusted 클릭시 Contract 컬럼을 Contract O/B와 Contract N/OB로 나눠서 보여주도록 로직 수정
	  * </pre>
	  */
	public QtaAdjustmentDBDAOCompareWithRHQRSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_hul_bnd_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_bse_tp_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_bse_qtr_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_bse_yr",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_bse_wk",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_portion_link",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_trd_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_fm_wk",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_dir_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_conv_dir_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_trd_dir",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_rlane_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("f_to_wk",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.hanjin.apps.alps.esm.sqm.adjustment.qtaadjustment.integration").append("\n"); 
		query.append("FileName : QtaAdjustmentDBDAOCompareWithRHQRSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("SELECT 'COMPARISON_WITH_RHQ_LOADING_'||COMPARISON_WITH_RHQ_L AS RHQL_RESULT" ).append("\n"); 
		query.append("	,'COMPARISON_WITH_RHQ_OUT_CONTRACT_'||COMPARISON_WITH_RHQ_O_C AS RHQOC_RESULT" ).append("\n"); 
		query.append("    ,'COMPARISON_WITH_RHQ_NONOUT_CONTRACT_'||COMPARISON_WITH_RHQ_N_C AS RHQNC_RESULT" ).append("\n"); 
		query.append("FROM" ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("    SELECT COMPARISON_WITH_RHQ_L, COMPARISON_WITH_RHQ_O_C, COMPARISON_WITH_RHQ_N_C" ).append("\n"); 
		query.append("    FROM" ).append("\n"); 
		query.append("    (" ).append("\n"); 
		query.append("        WITH PORTION_ADJUST_RHQ_L AS" ).append("\n"); 
		query.append("        (" ).append("\n"); 
		query.append("            (" ).append("\n"); 
		query.append("                SELECT TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, MIN(RHQ_APLY_FM_YRWK_L) AS RHQ_APLY_FM_YRWK_L, MAX(RHQ_APLY_TO_YRWK_L) AS RHQ_APLY_TO_YRWK_L " ).append("\n"); 
		query.append("                FROM" ).append("\n"); 
		query.append("                (" ).append("\n"); 
		query.append("                    SELECT A2.TRD_CD, A2.SUB_TRD_CD, A2.RLANE_CD, A2.DIR_CD, A2.APLY_FM_YRWK AS RHQ_APLY_FM_YRWK_L, A2.APLY_TO_YRWK AS RHQ_APLY_TO_YRWK_L" ).append("\n"); 
		query.append("                      FROM SQM_QTA_LANE_OFC A1" ).append("\n"); 
		query.append("                          ,SQM_CFM_QTA_POTN_MGMT A2" ).append("\n"); 
		query.append("                          ,SQM_DAT_RLT A3" ).append("\n"); 
		query.append("                          ,MAS_LANE_RGST A4" ).append("\n"); 
		query.append("                     WHERE 1=1" ).append("\n"); 
		query.append("                       AND A2.TRD_CD       = A4.TRD_CD" ).append("\n"); 
		query.append("                       AND A2.RLANE_CD     = A4.RLANE_CD" ).append("\n"); 
		query.append("                       AND A2.DIR_CD       = A4.DIR_CD" ).append("\n"); 
		query.append("                       AND A4.DELT_FLG     = 'N'" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                       AND A2.BSE_TP_CD    = A3.BSE_TP_CD" ).append("\n"); 
		query.append("                       AND A2.BSE_YR       = A3.BSE_YR" ).append("\n"); 
		query.append("                       AND A2.BSE_QTR_CD   = A3.BSE_QTR_CD" ).append("\n"); 
		query.append("                       AND A2.OFC_VW_CD    = A3.OFC_VW_CD" ).append("\n"); 
		query.append("                       AND A2.TRD_CD       = A3.TRD_CD" ).append("\n"); 
		query.append("                       AND A2.CONV_DIR_CD  = A3.CONV_DIR_CD" ).append("\n"); 
		query.append("                       AND A2.RHQ_CD       = A3.RHQ_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                       AND A1.BSE_TP_CD    = A2.BSE_TP_CD" ).append("\n"); 
		query.append("                       AND A1.BSE_YR       = A2.BSE_YR" ).append("\n"); 
		query.append("                       AND A1.BSE_QTR_CD   = A2.BSE_QTR_CD" ).append("\n"); 
		query.append("                       AND A1.OFC_VW_CD    = A2.OFC_VW_CD" ).append("\n"); 
		query.append("                       AND A1.RHQ_CD       = A2.RHQ_CD" ).append("\n"); 
		query.append("                       AND A1.RGN_OFC_CD   = A2.RGN_OFC_CD" ).append("\n"); 
		query.append("                       AND A1.TRD_CD       = A2.TRD_CD" ).append("\n"); 
		query.append("                       AND A1.RLANE_CD     = A2.RLANE_CD" ).append("\n"); 
		query.append("                       AND A1.DIR_CD       = A2.DIR_CD" ).append("\n"); 
		query.append("                       AND A1.SQM_ACT_FLG  = 'Y'" ).append("\n"); 
		query.append("                       AND A2.BSE_TP_CD    = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                       AND A2.BSE_YR       = @[f_bse_yr]" ).append("\n"); 
		query.append("                       AND A2.BSE_QTR_CD   = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])" ).append("\n"); 
		query.append("                       AND A2.OFC_VW_CD    = 'L'" ).append("\n"); 
		query.append("                       AND A2.QTA_STEP_CD  <> '02'" ).append("\n"); 
		query.append("                    #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                       AND A2.TRD_CD       = @[f_trd_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                       AND A2.RLANE_CD     = @[f_rlane_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_click} != 'on' && ${f_conv_dir_cd} != '' && ${f_conv_dir_cd} != 'All')" ).append("\n"); 
		query.append("                       AND A2.CONV_DIR_CD  = @[f_conv_dir_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_click} == 'on' && ${f_trd_dir} != '' && ${f_trd_dir} != 'All')" ).append("\n"); 
		query.append("                       AND A4.HUL_BND_CD  = @[f_trd_dir]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                        GROUP BY A2.TRD_CD, A2.SUB_TRD_CD, A2.RLANE_CD, A2.DIR_CD, A2.APLY_FM_YRWK, A2.APLY_TO_YRWK" ).append("\n"); 
		query.append("                )" ).append("\n"); 
		query.append("                GROUP BY TRD_CD , SUB_TRD_CD, RLANE_CD, DIR_CD  " ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("            UNION ALL" ).append("\n"); 
		query.append("            (   " ).append("\n"); 
		query.append("                SELECT TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, '999999' AS RHQ_APLY_FM_YRWK_L, '999999' AS RHQ_APLY_TO_YRWK_L" ).append("\n"); 
		query.append("                FROM" ).append("\n"); 
		query.append("                (" ).append("\n"); 
		query.append("                    SELECT distinct A2.TRD_CD, A2.SUB_TRD_CD, A2.RLANE_CD, A2.DIR_CD, A2.TRD_CD||A2.SUB_TRD_CD||A2.RLANE_CD||A2.DIR_CD AS TSRD" ).append("\n"); 
		query.append("                        FROM MAS_LANE_RGST A1, " ).append("\n"); 
		query.append("                             (" ).append("\n"); 
		query.append("                               SELECT O_QTA_RLSE_VER_NO  AS QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                     ,O_TRD_CD           AS TRD_CD" ).append("\n"); 
		query.append("                                     ,O_RLANE_CD         AS RLANE_CD" ).append("\n"); 
		query.append("                                     ,O_SUB_TRD_CD       AS SUB_TRD_CD" ).append("\n"); 
		query.append("                                     ,O_DIR_CD           AS DIR_CD" ).append("\n"); 
		query.append("                                     ,O_IOC_CD           AS IOC_CD" ).append("\n"); 
		query.append("                                     ,O_VVD" ).append("\n"); 
		query.append("                                     ,MAX(SLS_YR)        AS SLS_YR" ).append("\n"); 
		query.append("                                     ,MAX(SLS_YRMON)     AS SLS_YRMON" ).append("\n"); 
		query.append("                                     ,MAX(BSE_YR)        AS BSE_YR" ).append("\n"); 
		query.append("                                     ,MAX(BSE_MON)       AS BSE_MON" ).append("\n"); 
		query.append("                                     ,MAX(BSE_WK)        AS BSE_WK" ).append("\n"); 
		query.append("                                     ,MAX(VVD)           AS VVD" ).append("\n"); 
		query.append("                                     ,MAX(SQM_CNG_TP_CD) AS SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                     ,MAX(FNL_BSA_CAPA)  AS FNL_BSA_CAPA" ).append("\n"); 
		query.append("                                     ,MAX(LOD_QTY)       AS LOD_QTY" ).append("\n"); 
		query.append("                                     ,MAX(GRS_REV)       AS GRS_REV" ).append("\n"); 
		query.append("                                     ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE MAS_COST_YR             END) AS MAS_COST_YR" ).append("\n"); 
		query.append("                                     ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE MAS_COST_YRMON          END) AS MAS_COST_YRMON" ).append("\n"); 
		query.append("                                     ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE MAS_MON                END) AS MAS_BSE_MON" ).append("\n"); 
		query.append("                                     ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE COST_WK                END) AS MAS_BSE_WK" ).append("\n"); 
		query.append("                                     ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE MAS_VVD                END) AS MAS_VVD" ).append("\n"); 
		query.append("                                     ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE FNL_HJS_BSA_CAPA || '' END) AS MAS_FNL_BSA_CAPA" ).append("\n"); 
		query.append("                                     ,CASE WHEN MAX(SQM_INFO) = MAX(MAS_INFO) THEN 'R'" ).append("\n"); 
		query.append("                                           WHEN NVL(MAX(SQM_INFO), '*') = '*' THEN 'I'" ).append("\n"); 
		query.append("                                           WHEN NVL(MAX(MAS_INFO), '*') = '*' THEN 'D'" ).append("\n"); 
		query.append("                                                                              ELSE 'U'" ).append("\n"); 
		query.append("                                      END AS FLAG" ).append("\n"); 
		query.append("                                     ,MAX(SQM_INFO) AS SQM_INFO" ).append("\n"); 
		query.append("                                     ,MAX(MAS_INFO) AS MAS_INFO" ).append("\n"); 
		query.append("                                 FROM (" ).append("\n"); 
		query.append("                                         SELECT B1.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                               ,B1.TRD_CD" ).append("\n"); 
		query.append("                                               ,B1.DIR_CD" ).append("\n"); 
		query.append("                                               ,B1.SUB_TRD_CD" ).append("\n"); 
		query.append("                                               ,B1.RLANE_CD" ).append("\n"); 
		query.append("                                               ,B1.BSE_YR" ).append("\n"); 
		query.append("                                               ,B1.BSE_MON" ).append("\n"); 
		query.append("                                               ,B1.BSE_WK" ).append("\n"); 
		query.append("                                               ,B1.SLS_YRMON" ).append("\n"); 
		query.append("                                               ,SUBSTR(B1.SLS_YRMON,0,4) AS SLS_YR" ).append("\n"); 
		query.append("                                               ,B1.VSL_CD || B1.SKD_VOY_NO || B1.DIR_CD AS VVD" ).append("\n"); 
		query.append("                                               ,B1.SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                               ,B1.FNL_BSA_CAPA" ).append("\n"); 
		query.append("                                               ,B1.LOD_QTY" ).append("\n"); 
		query.append("                                               ,B1.GRS_REV" ).append("\n"); 
		query.append("                                               ,B2.COST_YRMON AS MAS_COST_YRMON" ).append("\n"); 
		query.append("                                               ,SUBSTR(B2.COST_YRMON,0,4) AS MAS_COST_YR" ).append("\n"); 
		query.append("                                               ,SUBSTR(B2.YRMON, -2) AS MAS_MON" ).append("\n"); 
		query.append("                                               ,B2.COST_WK" ).append("\n"); 
		query.append("                                               ,B2.VSL_CD || B2.SKD_VOY_NO || B2.DIR_CD AS MAS_VVD" ).append("\n"); 
		query.append("                                               ,B2.FNL_HJS_BSA_CAPA" ).append("\n"); 
		query.append("                                               ,B1.TRD_CD || B1.SUB_TRD_CD || B1.RLANE_CD || B1.DIR_CD || B1.VSL_CD || B1.SKD_VOY_NO || B1.DIR_CD || B1.BSE_WK || B1.FNL_BSA_CAPA || B1.SLS_YRMON AS SQM_INFO" ).append("\n"); 
		query.append("                                               ,B2.TRD_CD || B2.SUB_TRD_CD || B2.RLANE_CD || B2.DIR_CD || B2.VSL_CD || B2.SKD_VOY_NO || B2.DIR_CD || B2.COST_WK || B2.FNL_HJS_BSA_CAPA || B2.COST_YRMON AS MAS_INFO" ).append("\n"); 
		query.append("                                               ,NVL(B1.QTA_RLSE_VER_NO, B2.QTA_RLSE_VER_NO)       AS O_QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                               ,NVL(B1.TRD_CD         , B2.TRD_CD)                AS O_TRD_CD" ).append("\n"); 
		query.append("                                               ,NVL(B1.RLANE_CD       , B2.RLANE_CD)              AS O_RLANE_CD" ).append("\n"); 
		query.append("                                               ,NVL(B1.SUB_TRD_CD     , B2.SUB_TRD_CD)            AS O_SUB_TRD_CD" ).append("\n"); 
		query.append("                                               ,NVL(B1.IOC_CD         , B2.IOC_CD)                AS O_IOC_CD" ).append("\n"); 
		query.append("                                               ,NVL(B1.DIR_CD         , B2.DIR_CD)                AS O_DIR_CD" ).append("\n"); 
		query.append("                                               ,NVL(B1.BSE_MON        , SUBSTR(B2.YRMON, -2))     AS O_BSE_MON" ).append("\n"); 
		query.append("                                               ,NVL(B1.BSE_WK         , B2.COST_WK)               AS O_BSE_WK" ).append("\n"); 
		query.append("                                               ,NVL(B1.VSL_CD || B1.SKD_VOY_NO || B1.DIR_CD, B2.VSL_CD || B2.SKD_VOY_NO || B2.DIR_CD) AS O_VVD" ).append("\n"); 
		query.append("                                           FROM (" ).append("\n"); 
		query.append("                                                  SELECT " ).append("\n"); 
		query.append("                                                         V.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                        ,V.TRD_CD" ).append("\n"); 
		query.append("                                                        ,V.DIR_CD" ).append("\n"); 
		query.append("                                                        ,V.SUB_TRD_CD" ).append("\n"); 
		query.append("                                                        ,V.RLANE_CD" ).append("\n"); 
		query.append("                                                        ,V.BSE_YR" ).append("\n"); 
		query.append("                                                        ,V.BSE_MON" ).append("\n"); 
		query.append("                                                        ,V.BSE_WK" ).append("\n"); 
		query.append("                                                        ,V.SLS_YRMON" ).append("\n"); 
		query.append("                                                        ,V.VSL_CD" ).append("\n"); 
		query.append("                                                        ,V.SKD_VOY_NO" ).append("\n"); 
		query.append("                                                        ,V.FNL_BSA_CAPA" ).append("\n"); 
		query.append("                                                        ,Q.LOD_QTY" ).append("\n"); 
		query.append("                                                        ,Q.GRS_REV" ).append("\n"); 
		query.append("                                                        ,V.IOC_CD" ).append("\n"); 
		query.append("                                                        ,Q.SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                                    FROM SQM_CFM_TGT_VVD V" ).append("\n"); 
		query.append("                                                        ,(" ).append("\n"); 
		query.append("                                                          SELECT QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                                ,TRD_CD" ).append("\n"); 
		query.append("                                                                ,RLANE_CD" ).append("\n"); 
		query.append("                                                                ,DIR_CD" ).append("\n"); 
		query.append("                                                                ,VSL_CD" ).append("\n"); 
		query.append("                                                                ,SKD_VOY_NO" ).append("\n"); 
		query.append("                                                                ,SKD_DIR_CD" ).append("\n"); 
		query.append("                                                                ,SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                                                ,SUM(LOD_QTY) AS LOD_QTY" ).append("\n"); 
		query.append("                                                                ,ROUND(SUM(LOD_QTY*GRS_RPB_REV)) AS GRS_REV" ).append("\n"); 
		query.append("                                                            FROM SQM_CFM_QTA" ).append("\n"); 
		query.append("                                                           WHERE 1=1" ).append("\n"); 
		query.append("                                                             AND QTA_RLSE_VER_NO = ( SELECT QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                                                       FROM SQM_QTA_RLSE_VER" ).append("\n"); 
		query.append("                                                                                      WHERE BSE_TP_CD      = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                                                        AND BSE_YR         = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                                                        AND BSE_QTR_CD     = @[f_bse_qtr_cd]" ).append("\n"); 
		query.append("                                                                                        AND SQM_VER_STS_CD = 'R' )" ).append("\n"); 
		query.append("                                                             AND OFC_VW_CD       = 'L'" ).append("\n"); 
		query.append("                    #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                                                             AND TRD_CD          = @[f_trd_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                                                             AND RLANE_CD        = @[f_rlane_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')" ).append("\n"); 
		query.append("                                                             AND DIR_CD          = @[f_dir_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                                                           GROUP BY QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                                   ,TRD_CD" ).append("\n"); 
		query.append("                                                                   ,RLANE_CD" ).append("\n"); 
		query.append("                                                                   ,DIR_CD" ).append("\n"); 
		query.append("                                                                   ,VSL_CD" ).append("\n"); 
		query.append("                                                                   ,SKD_VOY_NO" ).append("\n"); 
		query.append("                                                                   ,SKD_DIR_CD" ).append("\n"); 
		query.append("                                                                   ,SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                                         ) Q" ).append("\n"); 
		query.append("                                                   WHERE 1=1" ).append("\n"); 
		query.append("                                                     AND V.QTA_RLSE_VER_NO = Q.QTA_RLSE_VER_NO(+)" ).append("\n"); 
		query.append("                                                     AND V.TRD_CD          = Q.TRD_CD(+)" ).append("\n"); 
		query.append("                                                     AND V.RLANE_CD        = Q.RLANE_CD(+)" ).append("\n"); 
		query.append("                                                     AND V.DIR_CD          = Q.DIR_CD(+)" ).append("\n"); 
		query.append("                                                     AND V.VSL_CD          = Q.VSL_CD(+)" ).append("\n"); 
		query.append("                                                     AND V.SKD_VOY_NO      = Q.SKD_VOY_NO(+)" ).append("\n"); 
		query.append("                                                     AND V.SKD_DIR_CD      = Q.SKD_DIR_CD(+)" ).append("\n"); 
		query.append("                                                     AND V.QTA_RLSE_VER_NO = SUBSTR(@[f_bse_yr],-2) ||@[f_bse_qtr_cd]||'02'" ).append("\n"); 
		query.append("                                                     AND V.BSE_TP_CD       = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                     AND V.BSE_YR          = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                     AND V.BSE_QTR_CD      = @[f_bse_qtr_cd]" ).append("\n"); 
		query.append("                    #if (${f_bse_wk} != '')" ).append("\n"); 
		query.append("                                                     AND V.BSE_WK          = @[f_bse_wk]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                                                     AND V.TRD_CD          = @[f_trd_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                                                     AND V.RLANE_CD        = @[f_rlane_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')" ).append("\n"); 
		query.append("                                                     AND V.DIR_CD          = @[f_dir_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("--                                                     AND 1 = CASE WHEN V.BSE_YR || v.BSE_QTR_CD > '20142Q'" ).append("\n"); 
		query.append("--                                                                       THEN (SELECT NVL((" ).append("\n"); 
		query.append("--                                                                                        SELECT DISTINCT 0" ).append("\n"); 
		query.append("--                                                                                          FROM SQM_SCTR_PAIR_MGMT S1" ).append("\n"); 
		query.append("--                                                                                         WHERE 1=1" ).append("\n"); 
		query.append("--                                                                                           AND S1.BSE_TP_CD  = V.BSE_TP_CD" ).append("\n"); 
		query.append("--                                                                                           AND S1.BSE_YR     = V.BSE_YR" ).append("\n"); 
		query.append("--                                                                                           AND S1.BSE_QTR_CD = V.BSE_QTR_CD" ).append("\n"); 
		query.append("--                                                                                           AND S1.TRD_CD     = V.TRD_CD" ).append("\n"); 
		query.append("--                                                                                           AND S1.RLANE_CD   = V.RLANE_CD" ).append("\n"); 
		query.append("--                                                                                           AND S1.DIR_CD     = V.DIR_CD" ).append("\n"); 
		query.append("--                                                                                        ),1)" ).append("\n"); 
		query.append("--                                                                            FROM DUAL)" ).append("\n"); 
		query.append("--                                                                  ELSE 1" ).append("\n"); 
		query.append("--                                                             END" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                                ) B1" ).append("\n"); 
		query.append("                                                FULL OUTER JOIN" ).append("\n"); 
		query.append("                                                (" ).append("\n"); 
		query.append("                                                  SELECT " ).append("\n"); 
		query.append("                                                         A3.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                        ,A1.TRD_CD" ).append("\n"); 
		query.append("                                                        ,A1.SUB_TRD_CD" ).append("\n"); 
		query.append("                                                        ,A1.RLANE_CD" ).append("\n"); 
		query.append("                                                        ,A1.DIR_CD" ).append("\n"); 
		query.append("                                                        ,A1.VSL_CD" ).append("\n"); 
		query.append("                                                        ,A1.SKD_VOY_NO" ).append("\n"); 
		query.append("                                                        ,A1.COST_YRMON" ).append("\n"); 
		query.append("                                                        ,DECODE(A3.BSE_YR, '2014', A1.SLS_YRMON, A1.COST_YRMON) YRMON" ).append("\n"); 
		query.append("                                                        ,A1.COST_WK" ).append("\n"); 
		query.append("                                                        ,A1.IOC_CD" ).append("\n"); 
		query.append("                                                        ,ROUND(NVL(A2.FNL_HJS_BSA_CAPA, 0)) AS FNL_HJS_BSA_CAPA" ).append("\n"); 
		query.append("                                                    FROM MAS_MON_VVD       A1" ).append("\n"); 
		query.append("                                                        ,BSA_VVD_MST       A2" ).append("\n"); 
		query.append("                                                        ,(" ).append("\n"); 
		query.append("                                                           SELECT DISTINCT" ).append("\n"); 
		query.append("                                                                  S1.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                                 ,S2.BSE_TP_CD" ).append("\n"); 
		query.append("                                                                 ,S2.BSE_YR" ).append("\n"); 
		query.append("                                                                 ,S2.BSE_QTR_CD" ).append("\n"); 
		query.append("                                                                 ,S2.TRD_CD" ).append("\n"); 
		query.append("                                                                 ,S2.RLANE_CD" ).append("\n"); 
		query.append("                                                                 ,S2.DIR_CD" ).append("\n"); 
		query.append("                                                             FROM SQM_QTA_RLSE_VER S1" ).append("\n"); 
		query.append("                    #if (${f_cond_tp} == '1')" ).append("\n"); 
		query.append("                                                                  -- 해당 분기의 LANE-OFFICE RELATION SETTING 한 노선의 정보를 걸어준다" ).append("\n"); 
		query.append("                                                                  -- (2013년간 데이터를 제외한 모든 분기를 걸어주면됨 현재는 현재 분기와 미래 판매목표만 걸어주고 있음)" ).append("\n"); 
		query.append("                                                                 ,SQM_QTA_LANE_OFC S2" ).append("\n"); 
		query.append("                    #else" ).append("\n"); 
		query.append("                                                                  -- 2013년도 데이터는  LANE-OFFICE RELATION SETTING 정보가 없기 때문에 TARGET VVD 정보를 걸어서 노선정보를 가져온다." ).append("\n"); 
		query.append("                                                                 ,SQM_CFM_TGT_VVD S2" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                                                            WHERE 1=1" ).append("\n"); 
		query.append("                                                              AND S1.BSE_TP_CD      = S2.BSE_TP_CD" ).append("\n"); 
		query.append("                                                              AND S1.BSE_YR         = S2.BSE_YR" ).append("\n"); 
		query.append("                                                              AND S1.BSE_QTR_CD     = S2.BSE_QTR_CD" ).append("\n"); 
		query.append("                                                              AND S1.SQM_VER_STS_CD = 'R'" ).append("\n"); 
		query.append("                                                              AND S2.BSE_TP_CD      = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                              AND S2.BSE_YR         = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                              AND S2.BSE_QTR_CD     = @[f_bse_qtr_cd]" ).append("\n"); 
		query.append("                    #if (${f_cond_tp} == '1')" ).append("\n"); 
		query.append("                                                              AND S2.OFC_VW_CD      = 'L'" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                                                              AND S2.TRD_CD         = @[f_trd_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                                                              AND S2.RLANE_CD       = @[f_rlane_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')" ).append("\n"); 
		query.append("                                                              AND S2.DIR_CD         = @[f_dir_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("--                                                              AND 1 = CASE WHEN S2.BSE_YR || S2.BSE_QTR_CD > '20142Q'" ).append("\n"); 
		query.append("--                                                                                THEN (SELECT NVL((" ).append("\n"); 
		query.append("--                                                                                                 SELECT 0" ).append("\n"); 
		query.append("--                                                                                                   FROM SQM_SCTR_PAIR_MGMT X1" ).append("\n"); 
		query.append("--                                                                                                  WHERE 1=1" ).append("\n"); 
		query.append("--                                                                                                    AND X1.BSE_TP_CD  = S2.BSE_TP_CD" ).append("\n"); 
		query.append("--                                                                                                    AND X1.BSE_YR     = S2.BSE_YR" ).append("\n"); 
		query.append("--                                                                                                    AND X1.BSE_QTR_CD = S2.BSE_QTR_CD" ).append("\n"); 
		query.append("--                                                                                                    AND X1.TRD_CD     = S2.TRD_CD" ).append("\n"); 
		query.append("--                                                                                                    AND X1.RLANE_CD   = S2.RLANE_CD" ).append("\n"); 
		query.append("--                                                                                                    AND X1.DIR_CD     = S2.DIR_CD" ).append("\n"); 
		query.append("--                                                                                                 ),1)" ).append("\n"); 
		query.append("--                                                                                     FROM DUAL)" ).append("\n"); 
		query.append("--                                                                           ELSE 1" ).append("\n"); 
		query.append("--                                                                      END" ).append("\n"); 
		query.append("                                                          ) A3" ).append("\n"); 
		query.append("                                                   WHERE A1.TRD_CD         = A2.TRD_CD     (+)" ).append("\n"); 
		query.append("                                                     AND A1.RLANE_CD       = A2.RLANE_CD   (+)" ).append("\n"); 
		query.append("                                                     AND A1.VSL_CD         = A2.VSL_CD     (+)" ).append("\n"); 
		query.append("                                                     AND A1.SKD_VOY_NO     = A2.SKD_VOY_NO (+)" ).append("\n"); 
		query.append("                                                     AND A1.DIR_CD         = A2.SKD_DIR_CD (+)" ).append("\n"); 
		query.append("                                                     AND A1.IOC_CD         = A2.IOC_CD     (+)" ).append("\n"); 
		query.append("                                                     AND A1.TRD_CD         = A3.TRD_CD" ).append("\n"); 
		query.append("                                                     AND A1.RLANE_CD       = A3.RLANE_CD" ).append("\n"); 
		query.append("                                                     AND A1.DIR_CD         = A3.DIR_CD" ).append("\n"); 
		query.append("                    #if (${f_bse_wk} != '')" ).append("\n"); 
		query.append("                                                     AND A1.COST_WK        = @[f_bse_wk]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                                                     AND A1.DELT_FLG       = 'N'" ).append("\n"); 
		query.append("                                                     AND A1.IOC_CD         = DECODE(A1.RLANE_CD, 'RBCCO', 'I', A1.IOC_CD) -- RBCCO 노선은 IOC_CD = 'I' 인것만" ).append("\n"); 
		query.append("                                                     -- 2013년 : SLS_YRMON / 2014년 : Week / 2015년~ : COST_YRMON (COA 이행 데이터 기준이 다름)" ).append("\n"); 
		query.append("                                                     AND CASE WHEN '2013' = A3.BSE_YR THEN A1.SLS_YRMON WHEN '2014' = A3.BSE_YR THEN SUBSTR(A1.SLS_YRMON, 1, 4)||A1.COST_WK ELSE A1.COST_YRMON END " ).append("\n"); 
		query.append("                                                         BETWEEN CASE WHEN '2014' = A3.BSE_YR THEN @[f_bse_yr]||@[f_fm_wk] ELSE @[f_bse_yr]||DECODE(@[f_bse_qtr_cd],'1Q','01','2Q','04','3Q','07','4Q','10') END " ).append("\n"); 
		query.append("                                                             AND CASE WHEN '2014' = A3.BSE_YR THEN @[f_bse_yr]||@[f_to_wk] ELSE @[f_bse_yr]||DECODE(@[f_bse_qtr_cd],'1Q','03','2Q','06','3Q','09','4Q','12') END " ).append("\n"); 
		query.append("                                                     AND NOT EXISTS ( SELECT 1" ).append("\n"); 
		query.append("                                                                        FROM SQM_QTA_TGT_VVD S1" ).append("\n"); 
		query.append("                                                                       WHERE S1.BSE_TP_CD  = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                                         AND S1.BSE_YR     = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                                         AND S1.BSE_QTR_CD = @[f_bse_qtr_cd]" ).append("\n"); 
		query.append("                                                                         AND S1.DELT_FLG   = 'Y'" ).append("\n"); 
		query.append("                                                                         AND A1.TRD_CD     = S1.TRD_CD" ).append("\n"); 
		query.append("                                                                         AND A1.RLANE_CD   = S1.RLANE_CD" ).append("\n"); 
		query.append("                                                                         AND A1.VSL_CD     = S1.VSL_CD" ).append("\n"); 
		query.append("                                                                         AND A1.SKD_VOY_NO = S1.SKD_VOY_NO" ).append("\n"); 
		query.append("                                                                         AND A1.DIR_CD     = S1.DIR_CD" ).append("\n"); 
		query.append("                                                                    )" ).append("\n"); 
		query.append("                                                ) B2" ).append("\n"); 
		query.append("                                             ON B1.QTA_RLSE_VER_NO = B2.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                            AND B1.TRD_CD          = B2.TRD_CD" ).append("\n"); 
		query.append("                                            AND B1.SUB_TRD_CD      = B2.SUB_TRD_CD" ).append("\n"); 
		query.append("                                            AND B1.DIR_CD          = B2.DIR_CD" ).append("\n"); 
		query.append("                                            AND B1.RLANE_CD        = B2.RLANE_CD" ).append("\n"); 
		query.append("                                            AND B1.IOC_CD          = B2.IOC_CD" ).append("\n"); 
		query.append("                                            AND B1.VSL_CD          = B2.VSL_CD" ).append("\n"); 
		query.append("                                            AND B1.SKD_VOY_NO      = B2.SKD_VOY_NO" ).append("\n"); 
		query.append("                                      )" ).append("\n"); 
		query.append("                             GROUP BY O_QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                     ,O_TRD_CD" ).append("\n"); 
		query.append("                                     ,O_RLANE_CD" ).append("\n"); 
		query.append("                                     ,O_SUB_TRD_CD" ).append("\n"); 
		query.append("                                     ,O_DIR_CD" ).append("\n"); 
		query.append("                                     ,O_IOC_CD" ).append("\n"); 
		query.append("                                     ,O_VVD" ).append("\n"); 
		query.append("                             )A2" ).append("\n"); 
		query.append("                    WHERE A1.TRD_CD         = A2.TRD_CD" ).append("\n"); 
		query.append("                    AND A1.SUB_TRD_CD       = A2.SUB_TRD_CD" ).append("\n"); 
		query.append("                    AND A1.RLANE_CD         = A2.RLANE_CD" ).append("\n"); 
		query.append("                    AND A1.DIR_CD           = A2.DIR_CD" ).append("\n"); 
		query.append("                    AND A1.IOC_CD           = A2.IOC_CD" ).append("\n"); 
		query.append("                    #if (${f_portion_link} != '' && ${f_portion_link} != 'All')" ).append("\n"); 
		query.append("                    AND DECODE(SQM_CNG_TP_CD, 'I', 'Y', 'N') = @[f_portion_link]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_trd_dir} == 'on' && ${f_hul_bnd_cd} != '' && ${f_hul_bnd_cd} != 'All')" ).append("\n"); 
		query.append("                    AND A1.HUL_BND_CD               		 = @[f_hul_bnd_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                )" ).append("\n"); 
		query.append("                WHERE TSRD NOT IN" ).append("\n"); 
		query.append("                (" ).append("\n"); 
		query.append("                    SELECT DISTINCT A2.TRD_CD||A2.SUB_TRD_CD||A2.RLANE_CD||A2.DIR_CD" ).append("\n"); 
		query.append("                      FROM SQM_QTA_LANE_OFC A1" ).append("\n"); 
		query.append("                          ,SQM_CFM_QTA_POTN_MGMT A2" ).append("\n"); 
		query.append("                          ,SQM_DAT_RLT A3" ).append("\n"); 
		query.append("                          ,MAS_LANE_RGST A4" ).append("\n"); 
		query.append("                     WHERE 1=1" ).append("\n"); 
		query.append("                       AND A2.TRD_CD       = A4.TRD_CD" ).append("\n"); 
		query.append("                       AND A2.RLANE_CD     = A4.RLANE_CD" ).append("\n"); 
		query.append("                       AND A2.DIR_CD       = A4.DIR_CD" ).append("\n"); 
		query.append("                       AND A4.DELT_FLG     = 'N'" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                       AND A2.BSE_TP_CD    = A3.BSE_TP_CD" ).append("\n"); 
		query.append("                       AND A2.BSE_YR       = A3.BSE_YR" ).append("\n"); 
		query.append("                       AND A2.BSE_QTR_CD   = A3.BSE_QTR_CD" ).append("\n"); 
		query.append("                       AND A2.OFC_VW_CD    = A3.OFC_VW_CD" ).append("\n"); 
		query.append("                       AND A2.TRD_CD       = A3.TRD_CD" ).append("\n"); 
		query.append("                       AND A2.CONV_DIR_CD  = A3.CONV_DIR_CD" ).append("\n"); 
		query.append("                       AND A2.RHQ_CD       = A3.RHQ_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                       AND A1.BSE_TP_CD    = A2.BSE_TP_CD" ).append("\n"); 
		query.append("                       AND A1.BSE_YR       = A2.BSE_YR" ).append("\n"); 
		query.append("                       AND A1.BSE_QTR_CD   = A2.BSE_QTR_CD" ).append("\n"); 
		query.append("                       AND A1.OFC_VW_CD    = A2.OFC_VW_CD" ).append("\n"); 
		query.append("                       AND A1.RHQ_CD       = A2.RHQ_CD" ).append("\n"); 
		query.append("                       AND A1.RGN_OFC_CD   = A2.RGN_OFC_CD" ).append("\n"); 
		query.append("                       AND A1.TRD_CD       = A2.TRD_CD" ).append("\n"); 
		query.append("                       AND A1.RLANE_CD     = A2.RLANE_CD" ).append("\n"); 
		query.append("                       AND A1.DIR_CD       = A2.DIR_CD" ).append("\n"); 
		query.append("                       AND A1.SQM_ACT_FLG  = 'Y'" ).append("\n"); 
		query.append("                       AND A2.BSE_TP_CD    = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                       AND A2.BSE_YR       = @[f_bse_yr]" ).append("\n"); 
		query.append("                       AND A2.BSE_QTR_CD   = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])" ).append("\n"); 
		query.append("                       AND A2.OFC_VW_CD    = 'L'" ).append("\n"); 
		query.append("                       AND A2.QTA_STEP_CD  <> '02'" ).append("\n"); 
		query.append("                    #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                       AND A2.TRD_CD       = @[f_trd_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                       AND A2.RLANE_CD     = @[f_rlane_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_click} != 'on' && ${f_conv_dir_cd} != '' && ${f_conv_dir_cd} != 'All')" ).append("\n"); 
		query.append("                       AND A2.CONV_DIR_CD  = @[f_conv_dir_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_click} == 'on' && ${f_trd_dir} != '' && ${f_trd_dir} != 'All')" ).append("\n"); 
		query.append("                       AND A4.HUL_BND_CD  = @[f_trd_dir]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                )" ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        , PORTION_ADJUST_RHQ_O_C AS" ).append("\n"); 
		query.append("        (" ).append("\n"); 
		query.append("            (" ).append("\n"); 
		query.append("                SELECT TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, MIN(RHQ_APLY_FM_YRWK_O_C) AS RHQ_APLY_FM_YRWK_O_C, MAX(RHQ_APLY_TO_YRWK_O_C) AS RHQ_APLY_TO_YRWK_O_C " ).append("\n"); 
		query.append("                FROM" ).append("\n"); 
		query.append("                (" ).append("\n"); 
		query.append("                    SELECT A2.TRD_CD, A2.SUB_TRD_CD, A2.RLANE_CD, A2.DIR_CD, A2.APLY_FM_YRWK AS RHQ_APLY_FM_YRWK_O_C, A2.APLY_TO_YRWK AS RHQ_APLY_TO_YRWK_O_C" ).append("\n"); 
		query.append("                      FROM SQM_QTA_LANE_OFC A1" ).append("\n"); 
		query.append("                          ,SQM_CFM_QTA_POTN_MGMT A2" ).append("\n"); 
		query.append("                          ,SQM_DAT_RLT A3" ).append("\n"); 
		query.append("                          ,MAS_LANE_RGST A4" ).append("\n"); 
		query.append("                     WHERE 1=1" ).append("\n"); 
		query.append("                       AND A2.TRD_CD       = A4.TRD_CD" ).append("\n"); 
		query.append("                       AND A2.RLANE_CD     = A4.RLANE_CD" ).append("\n"); 
		query.append("                       AND A2.DIR_CD       = A4.DIR_CD" ).append("\n"); 
		query.append("                       AND A4.DELT_FLG     = 'N'" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                       AND A2.BSE_TP_CD    = A3.BSE_TP_CD" ).append("\n"); 
		query.append("                       AND A2.BSE_YR       = A3.BSE_YR" ).append("\n"); 
		query.append("                       AND A2.BSE_QTR_CD   = A3.BSE_QTR_CD" ).append("\n"); 
		query.append("                       AND A2.OFC_VW_CD    = A3.OFC_VW_CD" ).append("\n"); 
		query.append("                       AND A2.TRD_CD       = A3.TRD_CD" ).append("\n"); 
		query.append("                       AND A2.CONV_DIR_CD  = A3.CONV_DIR_CD" ).append("\n"); 
		query.append("                       AND A2.RHQ_CD       = A3.RHQ_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                       AND A1.BSE_TP_CD    = A2.BSE_TP_CD" ).append("\n"); 
		query.append("                       AND A1.BSE_YR       = A2.BSE_YR" ).append("\n"); 
		query.append("                       AND A1.BSE_QTR_CD   = A2.BSE_QTR_CD" ).append("\n"); 
		query.append("                       AND A1.OFC_VW_CD    = A2.OFC_VW_CD" ).append("\n"); 
		query.append("                       AND A1.RHQ_CD       = A2.RHQ_CD" ).append("\n"); 
		query.append("                       AND A1.RGN_OFC_CD   = A2.RGN_OFC_CD" ).append("\n"); 
		query.append("                       AND A1.TRD_CD       = A2.TRD_CD" ).append("\n"); 
		query.append("                       AND A1.RLANE_CD     = A2.RLANE_CD" ).append("\n"); 
		query.append("                       AND A1.DIR_CD       = A2.DIR_CD" ).append("\n"); 
		query.append("                       AND A1.SQM_ACT_FLG  = 'Y'" ).append("\n"); 
		query.append("                       AND A2.BSE_TP_CD    = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                       AND A2.BSE_YR       = @[f_bse_yr]" ).append("\n"); 
		query.append("                       AND A2.BSE_QTR_CD   = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])" ).append("\n"); 
		query.append("                       AND A2.OFC_VW_CD    = 'C'" ).append("\n"); 
		query.append("                       AND A2.QTA_STEP_CD  = '05' --OUTBOUND가 05이고 N.OUTBOUNT가 04임" ).append("\n"); 
		query.append("                    #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                       AND A2.TRD_CD       = @[f_trd_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                       AND A2.RLANE_CD     = @[f_rlane_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_click} != 'on' && ${f_conv_dir_cd} != '' && ${f_conv_dir_cd} != 'All')" ).append("\n"); 
		query.append("                       AND A2.CONV_DIR_CD  = @[f_conv_dir_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_click} == 'on' && ${f_trd_dir} != '' && ${f_trd_dir} != 'All')" ).append("\n"); 
		query.append("                       AND A4.HUL_BND_CD  = @[f_trd_dir]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                        GROUP BY A2.TRD_CD, A2.SUB_TRD_CD, A2.RLANE_CD, A2.DIR_CD, A2.APLY_FM_YRWK, A2.APLY_TO_YRWK" ).append("\n"); 
		query.append("                )" ).append("\n"); 
		query.append("                GROUP BY TRD_CD , SUB_TRD_CD, RLANE_CD, DIR_CD" ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("            UNION ALL" ).append("\n"); 
		query.append("            (           " ).append("\n"); 
		query.append("                SELECT TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, '999999' AS RHQ_APLY_FM_YRWK_O_C, '999999' AS RHQ_APLY_TO_YRWK_O_C" ).append("\n"); 
		query.append("                    FROM" ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                        SELECT DISTINCT A2.TRD_CD, A2.SUB_TRD_CD, A2.RLANE_CD, A2.DIR_CD, A2.TRD_CD||A2.SUB_TRD_CD||A2.RLANE_CD||A2.DIR_CD AS TSRD" ).append("\n"); 
		query.append("                            FROM MAS_LANE_RGST A1, " ).append("\n"); 
		query.append("                                 (" ).append("\n"); 
		query.append("                                   SELECT O_QTA_RLSE_VER_NO  AS QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                         ,O_TRD_CD           AS TRD_CD" ).append("\n"); 
		query.append("                                         ,O_RLANE_CD         AS RLANE_CD" ).append("\n"); 
		query.append("                                         ,O_SUB_TRD_CD       AS SUB_TRD_CD" ).append("\n"); 
		query.append("                                         ,O_DIR_CD           AS DIR_CD" ).append("\n"); 
		query.append("                                         ,O_IOC_CD           AS IOC_CD" ).append("\n"); 
		query.append("                                         ,O_VVD" ).append("\n"); 
		query.append("                                         ,MAX(SLS_YR)        AS SLS_YR" ).append("\n"); 
		query.append("                                         ,MAX(SLS_YRMON)     AS SLS_YRMON" ).append("\n"); 
		query.append("                                         ,MAX(BSE_YR)        AS BSE_YR" ).append("\n"); 
		query.append("                                         ,MAX(BSE_MON)       AS BSE_MON" ).append("\n"); 
		query.append("                                         ,MAX(BSE_WK)        AS BSE_WK" ).append("\n"); 
		query.append("                                         ,MAX(VVD)           AS VVD" ).append("\n"); 
		query.append("                                         ,MAX(SQM_CNG_TP_CD) AS SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                         ,MAX(FNL_BSA_CAPA)  AS FNL_BSA_CAPA" ).append("\n"); 
		query.append("                                         ,MAX(LOD_QTY)       AS LOD_QTY" ).append("\n"); 
		query.append("                                         ,MAX(GRS_REV)       AS GRS_REV" ).append("\n"); 
		query.append("                                         ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE MAS_COST_YR             END) AS MAS_COST_YR" ).append("\n"); 
		query.append("                                         ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE MAS_COST_YRMON          END) AS MAS_COST_YRMON" ).append("\n"); 
		query.append("                                         ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE MAS_MON                END) AS MAS_BSE_MON" ).append("\n"); 
		query.append("                                         ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE COST_WK                END) AS MAS_BSE_WK" ).append("\n"); 
		query.append("                                         ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE MAS_VVD                END) AS MAS_VVD" ).append("\n"); 
		query.append("                                         ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE FNL_HJS_BSA_CAPA || '' END) AS MAS_FNL_BSA_CAPA" ).append("\n"); 
		query.append("                                         ,CASE WHEN MAX(SQM_INFO) = MAX(MAS_INFO) THEN 'R'" ).append("\n"); 
		query.append("                                               WHEN NVL(MAX(SQM_INFO), '*') = '*' THEN 'I'" ).append("\n"); 
		query.append("                                               WHEN NVL(MAX(MAS_INFO), '*') = '*' THEN 'D'" ).append("\n"); 
		query.append("                                                                                  ELSE 'U'" ).append("\n"); 
		query.append("                                          END AS FLAG" ).append("\n"); 
		query.append("                                         ,MAX(SQM_INFO) AS SQM_INFO" ).append("\n"); 
		query.append("                                         ,MAX(MAS_INFO) AS MAS_INFO" ).append("\n"); 
		query.append("                                     FROM (" ).append("\n"); 
		query.append("                                             SELECT B1.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                   ,B1.TRD_CD" ).append("\n"); 
		query.append("                                                   ,B1.DIR_CD" ).append("\n"); 
		query.append("                                                   ,B1.SUB_TRD_CD" ).append("\n"); 
		query.append("                                                   ,B1.RLANE_CD" ).append("\n"); 
		query.append("                                                   ,B1.BSE_YR" ).append("\n"); 
		query.append("                                                   ,B1.BSE_MON" ).append("\n"); 
		query.append("                                                   ,B1.BSE_WK" ).append("\n"); 
		query.append("                                                   ,B1.SLS_YRMON" ).append("\n"); 
		query.append("                                                   ,SUBSTR(B1.SLS_YRMON,0,4) AS SLS_YR" ).append("\n"); 
		query.append("                                                   ,B1.VSL_CD || B1.SKD_VOY_NO || B1.DIR_CD AS VVD" ).append("\n"); 
		query.append("                                                   ,B1.SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                                   ,B1.FNL_BSA_CAPA" ).append("\n"); 
		query.append("                                                   ,B1.LOD_QTY" ).append("\n"); 
		query.append("                                                   ,B1.GRS_REV" ).append("\n"); 
		query.append("                                                   ,B2.COST_YRMON AS MAS_COST_YRMON" ).append("\n"); 
		query.append("                                                   ,SUBSTR(B2.COST_YRMON,0,4) AS MAS_COST_YR" ).append("\n"); 
		query.append("                                                   ,SUBSTR(B2.YRMON, -2) AS MAS_MON" ).append("\n"); 
		query.append("                                                   ,B2.COST_WK" ).append("\n"); 
		query.append("                                                   ,B2.VSL_CD || B2.SKD_VOY_NO || B2.DIR_CD AS MAS_VVD" ).append("\n"); 
		query.append("                                                   ,B2.FNL_HJS_BSA_CAPA" ).append("\n"); 
		query.append("                                                   ,B1.TRD_CD || B1.SUB_TRD_CD || B1.RLANE_CD || B1.DIR_CD || B1.VSL_CD || B1.SKD_VOY_NO || B1.DIR_CD || B1.BSE_WK || B1.FNL_BSA_CAPA || B1.SLS_YRMON AS SQM_INFO" ).append("\n"); 
		query.append("                                                   ,B2.TRD_CD || B2.SUB_TRD_CD || B2.RLANE_CD || B2.DIR_CD || B2.VSL_CD || B2.SKD_VOY_NO || B2.DIR_CD || B2.COST_WK || B2.FNL_HJS_BSA_CAPA || B2.COST_YRMON AS MAS_INFO" ).append("\n"); 
		query.append("                                                   ,NVL(B1.QTA_RLSE_VER_NO, B2.QTA_RLSE_VER_NO)       AS O_QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                   ,NVL(B1.TRD_CD         , B2.TRD_CD)                AS O_TRD_CD" ).append("\n"); 
		query.append("                                                   ,NVL(B1.RLANE_CD       , B2.RLANE_CD)              AS O_RLANE_CD" ).append("\n"); 
		query.append("                                                   ,NVL(B1.SUB_TRD_CD     , B2.SUB_TRD_CD)            AS O_SUB_TRD_CD" ).append("\n"); 
		query.append("                                                   ,NVL(B1.IOC_CD         , B2.IOC_CD)                AS O_IOC_CD" ).append("\n"); 
		query.append("                                                   ,NVL(B1.DIR_CD         , B2.DIR_CD)                AS O_DIR_CD" ).append("\n"); 
		query.append("                                                   ,NVL(B1.BSE_MON        , SUBSTR(B2.YRMON, -2))     AS O_BSE_MON" ).append("\n"); 
		query.append("                                                   ,NVL(B1.BSE_WK         , B2.COST_WK)               AS O_BSE_WK" ).append("\n"); 
		query.append("                                                   ,NVL(B1.VSL_CD || B1.SKD_VOY_NO || B1.DIR_CD, B2.VSL_CD || B2.SKD_VOY_NO || B2.DIR_CD) AS O_VVD" ).append("\n"); 
		query.append("                                               FROM (" ).append("\n"); 
		query.append("                                                      SELECT " ).append("\n"); 
		query.append("                                                             V.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                            ,V.TRD_CD" ).append("\n"); 
		query.append("                                                            ,V.DIR_CD" ).append("\n"); 
		query.append("                                                            ,V.SUB_TRD_CD" ).append("\n"); 
		query.append("                                                            ,V.RLANE_CD" ).append("\n"); 
		query.append("                                                            ,V.BSE_YR" ).append("\n"); 
		query.append("                                                            ,V.BSE_MON" ).append("\n"); 
		query.append("                                                            ,V.BSE_WK" ).append("\n"); 
		query.append("                                                            ,V.SLS_YRMON" ).append("\n"); 
		query.append("                                                            ,V.VSL_CD" ).append("\n"); 
		query.append("                                                            ,V.SKD_VOY_NO" ).append("\n"); 
		query.append("                                                            ,V.FNL_BSA_CAPA" ).append("\n"); 
		query.append("                                                            ,Q.LOD_QTY" ).append("\n"); 
		query.append("                                                            ,Q.GRS_REV" ).append("\n"); 
		query.append("                                                            ,V.IOC_CD" ).append("\n"); 
		query.append("                                                            ,Q.SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                                        FROM SQM_CFM_TGT_VVD V" ).append("\n"); 
		query.append("                                                            ,(" ).append("\n"); 
		query.append("                                                              SELECT QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                                    ,TRD_CD" ).append("\n"); 
		query.append("                                                                    ,RLANE_CD" ).append("\n"); 
		query.append("                                                                    ,DIR_CD" ).append("\n"); 
		query.append("                                                                    ,VSL_CD" ).append("\n"); 
		query.append("                                                                    ,SKD_VOY_NO" ).append("\n"); 
		query.append("                                                                    ,SKD_DIR_CD" ).append("\n"); 
		query.append("                                                                    ,SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                                                    ,SUM(LOD_QTY) AS LOD_QTY" ).append("\n"); 
		query.append("                                                                    ,ROUND(SUM(LOD_QTY*GRS_RPB_REV)) AS GRS_REV" ).append("\n"); 
		query.append("                                                                FROM SQM_CFM_QTA" ).append("\n"); 
		query.append("                                                               WHERE 1=1" ).append("\n"); 
		query.append("                                                                 AND QTA_RLSE_VER_NO = ( SELECT QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                                                           FROM SQM_QTA_RLSE_VER" ).append("\n"); 
		query.append("                                                                                          WHERE BSE_TP_CD      = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                                                            AND BSE_YR         = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                                                            AND BSE_QTR_CD     = @[f_bse_qtr_cd]" ).append("\n"); 
		query.append("                                                                                            AND SQM_VER_STS_CD = 'R' )" ).append("\n"); 
		query.append("                                                                 AND OFC_VW_CD       = 'L'" ).append("\n"); 
		query.append("                        #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                                                                 AND TRD_CD          = @[f_trd_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                                                                 AND RLANE_CD        = @[f_rlane_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')" ).append("\n"); 
		query.append("                                                                 AND DIR_CD          = @[f_dir_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                                                               GROUP BY QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                                       ,TRD_CD" ).append("\n"); 
		query.append("                                                                       ,RLANE_CD" ).append("\n"); 
		query.append("                                                                       ,DIR_CD" ).append("\n"); 
		query.append("                                                                       ,VSL_CD" ).append("\n"); 
		query.append("                                                                       ,SKD_VOY_NO" ).append("\n"); 
		query.append("                                                                       ,SKD_DIR_CD" ).append("\n"); 
		query.append("                                                                       ,SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                                             ) Q" ).append("\n"); 
		query.append("                                                       WHERE 1=1" ).append("\n"); 
		query.append("                                                         AND V.QTA_RLSE_VER_NO = Q.QTA_RLSE_VER_NO(+)" ).append("\n"); 
		query.append("                                                         AND V.TRD_CD          = Q.TRD_CD(+)" ).append("\n"); 
		query.append("                                                         AND V.RLANE_CD        = Q.RLANE_CD(+)" ).append("\n"); 
		query.append("                                                         AND V.DIR_CD          = Q.DIR_CD(+)" ).append("\n"); 
		query.append("                                                         AND V.VSL_CD          = Q.VSL_CD(+)" ).append("\n"); 
		query.append("                                                         AND V.SKD_VOY_NO      = Q.SKD_VOY_NO(+)" ).append("\n"); 
		query.append("                                                         AND V.SKD_DIR_CD      = Q.SKD_DIR_CD(+)" ).append("\n"); 
		query.append("                                                         AND V.QTA_RLSE_VER_NO = SUBSTR(@[f_bse_yr],-2) ||@[f_bse_qtr_cd]||'02'" ).append("\n"); 
		query.append("                                                         AND V.BSE_TP_CD       = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                         AND V.BSE_YR          = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                         AND V.BSE_QTR_CD      = @[f_bse_qtr_cd]" ).append("\n"); 
		query.append("                        #if (${f_bse_wk} != '')" ).append("\n"); 
		query.append("                                                         AND V.BSE_WK          = @[f_bse_wk]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                                                         AND V.TRD_CD          = @[f_trd_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                                                         AND V.RLANE_CD        = @[f_rlane_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')" ).append("\n"); 
		query.append("                                                         AND V.DIR_CD          = @[f_dir_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("--                                                         AND 1 = CASE WHEN V.BSE_YR || v.BSE_QTR_CD > '20142Q'" ).append("\n"); 
		query.append("--                                                                           THEN (SELECT NVL((" ).append("\n"); 
		query.append("--                                                                                            SELECT DISTINCT 0" ).append("\n"); 
		query.append("--                                                                                              FROM SQM_SCTR_PAIR_MGMT S1" ).append("\n"); 
		query.append("--                                                                                             WHERE 1=1" ).append("\n"); 
		query.append("--                                                                                               AND S1.BSE_TP_CD  = V.BSE_TP_CD" ).append("\n"); 
		query.append("--                                                                                               AND S1.BSE_YR     = V.BSE_YR" ).append("\n"); 
		query.append("--                                                                                               AND S1.BSE_QTR_CD = V.BSE_QTR_CD" ).append("\n"); 
		query.append("--                                                                                               AND S1.TRD_CD     = V.TRD_CD" ).append("\n"); 
		query.append("--                                                                                               AND S1.RLANE_CD   = V.RLANE_CD" ).append("\n"); 
		query.append("--                                                                                               AND S1.DIR_CD     = V.DIR_CD" ).append("\n"); 
		query.append("--                                                                                            ),1)" ).append("\n"); 
		query.append("--                                                                                FROM DUAL)" ).append("\n"); 
		query.append("--                                                                      ELSE 1" ).append("\n"); 
		query.append("--                                                                 END" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                                    ) B1" ).append("\n"); 
		query.append("                                                    FULL OUTER JOIN" ).append("\n"); 
		query.append("                                                    (" ).append("\n"); 
		query.append("                                                      SELECT " ).append("\n"); 
		query.append("                                                             A3.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                            ,A1.TRD_CD" ).append("\n"); 
		query.append("                                                            ,A1.SUB_TRD_CD" ).append("\n"); 
		query.append("                                                            ,A1.RLANE_CD" ).append("\n"); 
		query.append("                                                            ,A1.DIR_CD" ).append("\n"); 
		query.append("                                                            ,A1.VSL_CD" ).append("\n"); 
		query.append("                                                            ,A1.SKD_VOY_NO" ).append("\n"); 
		query.append("                                                            ,A1.COST_YRMON" ).append("\n"); 
		query.append("                                                            ,DECODE(A3.BSE_YR, '2014', A1.SLS_YRMON, A1.COST_YRMON) YRMON" ).append("\n"); 
		query.append("                                                            ,A1.COST_WK" ).append("\n"); 
		query.append("                                                            ,A1.IOC_CD" ).append("\n"); 
		query.append("                                                            ,ROUND(NVL(A2.FNL_HJS_BSA_CAPA, 0)) AS FNL_HJS_BSA_CAPA" ).append("\n"); 
		query.append("                                                        FROM MAS_MON_VVD       A1" ).append("\n"); 
		query.append("                                                            ,BSA_VVD_MST       A2" ).append("\n"); 
		query.append("                                                            ,(" ).append("\n"); 
		query.append("                                                               SELECT DISTINCT" ).append("\n"); 
		query.append("                                                                      S1.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                                     ,S2.BSE_TP_CD" ).append("\n"); 
		query.append("                                                                     ,S2.BSE_YR" ).append("\n"); 
		query.append("                                                                     ,S2.BSE_QTR_CD" ).append("\n"); 
		query.append("                                                                     ,S2.TRD_CD" ).append("\n"); 
		query.append("                                                                     ,S2.RLANE_CD" ).append("\n"); 
		query.append("                                                                     ,S2.DIR_CD" ).append("\n"); 
		query.append("                                                                 FROM SQM_QTA_RLSE_VER S1" ).append("\n"); 
		query.append("                        #if (${f_cond_tp} == '1')" ).append("\n"); 
		query.append("                                                                      -- 해당 분기의 LANE-OFFICE RELATION SETTING 한 노선의 정보를 걸어준다" ).append("\n"); 
		query.append("                                                                      -- (2013년간 데이터를 제외한 모든 분기를 걸어주면됨 현재는 현재 분기와 미래 판매목표만 걸어주고 있음)" ).append("\n"); 
		query.append("                                                                     ,SQM_QTA_LANE_OFC S2" ).append("\n"); 
		query.append("                        #else" ).append("\n"); 
		query.append("                                                                      -- 2013년도 데이터는  LANE-OFFICE RELATION SETTING 정보가 없기 때문에 TARGET VVD 정보를 걸어서 노선정보를 가져온다." ).append("\n"); 
		query.append("                                                                     ,SQM_CFM_TGT_VVD S2" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                                                                WHERE 1=1" ).append("\n"); 
		query.append("                                                                  AND S1.BSE_TP_CD      = S2.BSE_TP_CD" ).append("\n"); 
		query.append("                                                                  AND S1.BSE_YR         = S2.BSE_YR" ).append("\n"); 
		query.append("                                                                  AND S1.BSE_QTR_CD     = S2.BSE_QTR_CD" ).append("\n"); 
		query.append("                                                                  AND S1.SQM_VER_STS_CD = 'R'" ).append("\n"); 
		query.append("                                                                  AND S2.BSE_TP_CD      = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                                  AND S2.BSE_YR         = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                                  AND S2.BSE_QTR_CD     = @[f_bse_qtr_cd]" ).append("\n"); 
		query.append("                        #if (${f_cond_tp} == '1')" ).append("\n"); 
		query.append("                                                                  AND S2.OFC_VW_CD      = 'L'" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                                                                  AND S2.TRD_CD         = @[f_trd_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                                                                  AND S2.RLANE_CD       = @[f_rlane_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')" ).append("\n"); 
		query.append("                                                                  AND S2.DIR_CD         = @[f_dir_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("--                                                                  AND 1 = CASE WHEN S2.BSE_YR || S2.BSE_QTR_CD > '20142Q'" ).append("\n"); 
		query.append("--                                                                                    THEN (SELECT NVL((" ).append("\n"); 
		query.append("--                                                                                                     SELECT 0" ).append("\n"); 
		query.append("--                                                                                                       FROM SQM_SCTR_PAIR_MGMT X1" ).append("\n"); 
		query.append("--                                                                                                      WHERE 1=1" ).append("\n"); 
		query.append("--                                                                                                        AND X1.BSE_TP_CD  = S2.BSE_TP_CD" ).append("\n"); 
		query.append("--                                                                                                        AND X1.BSE_YR     = S2.BSE_YR" ).append("\n"); 
		query.append("--                                                                                                        AND X1.BSE_QTR_CD = S2.BSE_QTR_CD" ).append("\n"); 
		query.append("--                                                                                                        AND X1.TRD_CD     = S2.TRD_CD" ).append("\n"); 
		query.append("--                                                                                                        AND X1.RLANE_CD   = S2.RLANE_CD" ).append("\n"); 
		query.append("--                                                                                                        AND X1.DIR_CD     = S2.DIR_CD" ).append("\n"); 
		query.append("--                                                                                                     ),1)" ).append("\n"); 
		query.append("--                                                                                         FROM DUAL)" ).append("\n"); 
		query.append("--                                                                               ELSE 1" ).append("\n"); 
		query.append("--                                                                          END" ).append("\n"); 
		query.append("                                                              ) A3" ).append("\n"); 
		query.append("                                                       WHERE A1.TRD_CD         = A2.TRD_CD     (+)" ).append("\n"); 
		query.append("                                                         AND A1.RLANE_CD       = A2.RLANE_CD   (+)" ).append("\n"); 
		query.append("                                                         AND A1.VSL_CD         = A2.VSL_CD     (+)" ).append("\n"); 
		query.append("                                                         AND A1.SKD_VOY_NO     = A2.SKD_VOY_NO (+)" ).append("\n"); 
		query.append("                                                         AND A1.DIR_CD         = A2.SKD_DIR_CD (+)" ).append("\n"); 
		query.append("                                                         AND A1.IOC_CD         = A2.IOC_CD     (+)" ).append("\n"); 
		query.append("                                                         AND A1.TRD_CD         = A3.TRD_CD" ).append("\n"); 
		query.append("                                                         AND A1.RLANE_CD       = A3.RLANE_CD" ).append("\n"); 
		query.append("                                                         AND A1.DIR_CD         = A3.DIR_CD" ).append("\n"); 
		query.append("                        #if (${f_bse_wk} != '')" ).append("\n"); 
		query.append("                                                         AND A1.COST_WK        = @[f_bse_wk]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                                                         AND A1.DELT_FLG       = 'N'" ).append("\n"); 
		query.append("                                                         AND A1.IOC_CD         = DECODE(A1.RLANE_CD, 'RBCCO', 'I', A1.IOC_CD) -- RBCCO 노선은 IOC_CD = 'I' 인것만" ).append("\n"); 
		query.append("                                                         -- 2013년 : SLS_YRMON / 2014년 : Week / 2015년~ : COST_YRMON (COA 이행 데이터 기준이 다름)" ).append("\n"); 
		query.append("                                                         AND CASE WHEN '2013' = A3.BSE_YR THEN A1.SLS_YRMON WHEN '2014' = A3.BSE_YR THEN SUBSTR(A1.SLS_YRMON, 1, 4)||A1.COST_WK ELSE A1.COST_YRMON END " ).append("\n"); 
		query.append("                                                             BETWEEN CASE WHEN '2014' = A3.BSE_YR THEN @[f_bse_yr]||@[f_fm_wk] ELSE @[f_bse_yr]||DECODE(@[f_bse_qtr_cd],'1Q','01','2Q','04','3Q','07','4Q','10') END " ).append("\n"); 
		query.append("                                                                 AND CASE WHEN '2014' = A3.BSE_YR THEN @[f_bse_yr]||@[f_to_wk] ELSE @[f_bse_yr]||DECODE(@[f_bse_qtr_cd],'1Q','03','2Q','06','3Q','09','4Q','12') END " ).append("\n"); 
		query.append("                                                         AND NOT EXISTS ( SELECT 1" ).append("\n"); 
		query.append("                                                                            FROM SQM_QTA_TGT_VVD S1" ).append("\n"); 
		query.append("                                                                           WHERE S1.BSE_TP_CD  = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                                             AND S1.BSE_YR     = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                                             AND S1.BSE_QTR_CD = @[f_bse_qtr_cd]" ).append("\n"); 
		query.append("                                                                             AND S1.DELT_FLG   = 'Y'" ).append("\n"); 
		query.append("                                                                             AND A1.TRD_CD     = S1.TRD_CD" ).append("\n"); 
		query.append("                                                                             AND A1.RLANE_CD   = S1.RLANE_CD" ).append("\n"); 
		query.append("                                                                             AND A1.VSL_CD     = S1.VSL_CD" ).append("\n"); 
		query.append("                                                                             AND A1.SKD_VOY_NO = S1.SKD_VOY_NO" ).append("\n"); 
		query.append("                                                                             AND A1.DIR_CD     = S1.DIR_CD" ).append("\n"); 
		query.append("                                                                        )" ).append("\n"); 
		query.append("                                                    ) B2" ).append("\n"); 
		query.append("                                                 ON B1.QTA_RLSE_VER_NO = B2.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                AND B1.TRD_CD          = B2.TRD_CD" ).append("\n"); 
		query.append("                                                AND B1.SUB_TRD_CD      = B2.SUB_TRD_CD" ).append("\n"); 
		query.append("                                                AND B1.DIR_CD          = B2.DIR_CD" ).append("\n"); 
		query.append("                                                AND B1.RLANE_CD        = B2.RLANE_CD" ).append("\n"); 
		query.append("                                                AND B1.IOC_CD          = B2.IOC_CD" ).append("\n"); 
		query.append("                                                AND B1.VSL_CD          = B2.VSL_CD" ).append("\n"); 
		query.append("                                                AND B1.SKD_VOY_NO      = B2.SKD_VOY_NO" ).append("\n"); 
		query.append("                                          )" ).append("\n"); 
		query.append("                                 GROUP BY O_QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                         ,O_TRD_CD" ).append("\n"); 
		query.append("                                         ,O_RLANE_CD" ).append("\n"); 
		query.append("                                         ,O_SUB_TRD_CD" ).append("\n"); 
		query.append("                                         ,O_DIR_CD" ).append("\n"); 
		query.append("                                         ,O_IOC_CD" ).append("\n"); 
		query.append("                                         ,O_VVD" ).append("\n"); 
		query.append("                                 )A2" ).append("\n"); 
		query.append("                        WHERE A1.TRD_CD         = A2.TRD_CD" ).append("\n"); 
		query.append("                        AND A1.SUB_TRD_CD       = A2.SUB_TRD_CD" ).append("\n"); 
		query.append("                        AND A1.RLANE_CD         = A2.RLANE_CD" ).append("\n"); 
		query.append("                        AND A1.DIR_CD           = A2.DIR_CD" ).append("\n"); 
		query.append("                        AND A1.IOC_CD           = A2.IOC_CD" ).append("\n"); 
		query.append("                        #if (${f_portion_link} != '' && ${f_portion_link} != 'All')" ).append("\n"); 
		query.append("                        AND DECODE(SQM_CNG_TP_CD, 'I', 'Y', 'N') = @[f_portion_link]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_trd_dir} == 'on' && ${f_hul_bnd_cd} != '' && ${f_hul_bnd_cd} != 'All')" ).append("\n"); 
		query.append("                        AND A1.HUL_BND_CD               		 = @[f_hul_bnd_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("                    WHERE TSRD NOT IN" ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                        SELECT DISTINCT A2.TRD_CD||A2.SUB_TRD_CD||A2.RLANE_CD||A2.DIR_CD" ).append("\n"); 
		query.append("                          FROM SQM_QTA_LANE_OFC A1" ).append("\n"); 
		query.append("                              ,SQM_CFM_QTA_POTN_MGMT A2" ).append("\n"); 
		query.append("                              ,SQM_DAT_RLT A3" ).append("\n"); 
		query.append("                              ,MAS_LANE_RGST A4" ).append("\n"); 
		query.append("                         WHERE 1=1" ).append("\n"); 
		query.append("                           AND A2.TRD_CD       = A4.TRD_CD" ).append("\n"); 
		query.append("                           AND A2.RLANE_CD     = A4.RLANE_CD" ).append("\n"); 
		query.append("                           AND A2.DIR_CD       = A4.DIR_CD" ).append("\n"); 
		query.append("                           AND A4.DELT_FLG     = 'N'" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                           AND A2.BSE_TP_CD    = A3.BSE_TP_CD" ).append("\n"); 
		query.append("                           AND A2.BSE_YR       = A3.BSE_YR" ).append("\n"); 
		query.append("                           AND A2.BSE_QTR_CD   = A3.BSE_QTR_CD" ).append("\n"); 
		query.append("                           AND A2.OFC_VW_CD    = A3.OFC_VW_CD" ).append("\n"); 
		query.append("                           AND A2.TRD_CD       = A3.TRD_CD" ).append("\n"); 
		query.append("                           AND A2.CONV_DIR_CD  = A3.CONV_DIR_CD" ).append("\n"); 
		query.append("                           AND A2.RHQ_CD       = A3.RHQ_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                           AND A1.BSE_TP_CD    = A2.BSE_TP_CD" ).append("\n"); 
		query.append("                           AND A1.BSE_YR       = A2.BSE_YR" ).append("\n"); 
		query.append("                           AND A1.BSE_QTR_CD   = A2.BSE_QTR_CD" ).append("\n"); 
		query.append("                           AND A1.OFC_VW_CD    = A2.OFC_VW_CD" ).append("\n"); 
		query.append("                           AND A1.RHQ_CD       = A2.RHQ_CD" ).append("\n"); 
		query.append("                           AND A1.RGN_OFC_CD   = A2.RGN_OFC_CD" ).append("\n"); 
		query.append("                           AND A1.TRD_CD       = A2.TRD_CD" ).append("\n"); 
		query.append("                           AND A1.RLANE_CD     = A2.RLANE_CD" ).append("\n"); 
		query.append("                           AND A1.DIR_CD       = A2.DIR_CD" ).append("\n"); 
		query.append("                           AND A1.SQM_ACT_FLG  = 'Y'" ).append("\n"); 
		query.append("                           AND A2.BSE_TP_CD    = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                           AND A2.BSE_YR       = @[f_bse_yr]" ).append("\n"); 
		query.append("                           AND A2.BSE_QTR_CD   = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])" ).append("\n"); 
		query.append("                           AND A2.OFC_VW_CD    = 'C'" ).append("\n"); 
		query.append("                           AND A2.QTA_STEP_CD  = '05' --OUTBOUND가 05이고 N.OUTBOUNT가 04임" ).append("\n"); 
		query.append("                        #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                           AND A2.TRD_CD       = @[f_trd_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                           AND A2.RLANE_CD     = @[f_rlane_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_click} != 'on' && ${f_conv_dir_cd} != '' && ${f_conv_dir_cd} != 'All')" ).append("\n"); 
		query.append("                           AND A2.CONV_DIR_CD  = @[f_conv_dir_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_click} == 'on' && ${f_trd_dir} != '' && ${f_trd_dir} != 'All')" ).append("\n"); 
		query.append("                           AND A4.HUL_BND_CD  = @[f_trd_dir]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("            " ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        , PORTION_ADJUST_RHQ_N_C AS" ).append("\n"); 
		query.append("        (" ).append("\n"); 
		query.append("            (" ).append("\n"); 
		query.append("                SELECT TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, MIN(RHQ_APLY_FM_YRWK_N_C) AS RHQ_APLY_FM_YRWK_N_C, MAX(RHQ_APLY_TO_YRWK_N_C) AS RHQ_APLY_TO_YRWK_N_C " ).append("\n"); 
		query.append("                FROM" ).append("\n"); 
		query.append("                (" ).append("\n"); 
		query.append("                    SELECT A2.TRD_CD, A2.SUB_TRD_CD, A2.RLANE_CD, A2.DIR_CD, A2.APLY_FM_YRWK AS RHQ_APLY_FM_YRWK_N_C, A2.APLY_TO_YRWK AS RHQ_APLY_TO_YRWK_N_C" ).append("\n"); 
		query.append("                      FROM SQM_QTA_LANE_OFC A1" ).append("\n"); 
		query.append("                          ,SQM_CFM_QTA_POTN_MGMT A2" ).append("\n"); 
		query.append("                          ,SQM_DAT_RLT A3" ).append("\n"); 
		query.append("                          ,MAS_LANE_RGST A4" ).append("\n"); 
		query.append("                     WHERE 1=1" ).append("\n"); 
		query.append("                       AND A2.TRD_CD       = A4.TRD_CD" ).append("\n"); 
		query.append("                       AND A2.RLANE_CD     = A4.RLANE_CD" ).append("\n"); 
		query.append("                       AND A2.DIR_CD       = A4.DIR_CD" ).append("\n"); 
		query.append("                       AND A4.DELT_FLG     = 'N'" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                       AND A2.BSE_TP_CD    = A3.BSE_TP_CD" ).append("\n"); 
		query.append("                       AND A2.BSE_YR       = A3.BSE_YR" ).append("\n"); 
		query.append("                       AND A2.BSE_QTR_CD   = A3.BSE_QTR_CD" ).append("\n"); 
		query.append("                       AND A2.OFC_VW_CD    = A3.OFC_VW_CD" ).append("\n"); 
		query.append("                       AND A2.TRD_CD       = A3.TRD_CD" ).append("\n"); 
		query.append("                       AND A2.CONV_DIR_CD  = A3.CONV_DIR_CD" ).append("\n"); 
		query.append("                       AND A2.RHQ_CD       = A3.RHQ_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                       AND A1.BSE_TP_CD    = A2.BSE_TP_CD" ).append("\n"); 
		query.append("                       AND A1.BSE_YR       = A2.BSE_YR" ).append("\n"); 
		query.append("                       AND A1.BSE_QTR_CD   = A2.BSE_QTR_CD" ).append("\n"); 
		query.append("                       AND A1.OFC_VW_CD    = A2.OFC_VW_CD" ).append("\n"); 
		query.append("                       AND A1.RHQ_CD       = A2.RHQ_CD" ).append("\n"); 
		query.append("                       AND A1.RGN_OFC_CD   = A2.RGN_OFC_CD" ).append("\n"); 
		query.append("                       AND A1.TRD_CD       = A2.TRD_CD" ).append("\n"); 
		query.append("                       AND A1.RLANE_CD     = A2.RLANE_CD" ).append("\n"); 
		query.append("                       AND A1.DIR_CD       = A2.DIR_CD" ).append("\n"); 
		query.append("                       AND A1.SQM_ACT_FLG  = 'Y'" ).append("\n"); 
		query.append("                       AND A2.BSE_TP_CD    = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                       AND A2.BSE_YR       = @[f_bse_yr]" ).append("\n"); 
		query.append("                       AND A2.BSE_QTR_CD   = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])" ).append("\n"); 
		query.append("                       AND A2.OFC_VW_CD    = 'C'" ).append("\n"); 
		query.append("                       AND A2.QTA_STEP_CD  = '04' --OUTBOUND가 05이고 N.OUTBOUNT가 04임" ).append("\n"); 
		query.append("                    #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                       AND A2.TRD_CD       = @[f_trd_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                       AND A2.RLANE_CD     = @[f_rlane_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_click} != 'on' && ${f_conv_dir_cd} != '' && ${f_conv_dir_cd} != 'All')" ).append("\n"); 
		query.append("                       AND A2.CONV_DIR_CD  = @[f_conv_dir_cd]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                    #if (${f_click} == 'on' && ${f_trd_dir} != '' && ${f_trd_dir} != 'All')" ).append("\n"); 
		query.append("                       AND A4.HUL_BND_CD  = @[f_trd_dir]" ).append("\n"); 
		query.append("                    #end" ).append("\n"); 
		query.append("                        GROUP BY A2.TRD_CD, A2.SUB_TRD_CD, A2.RLANE_CD, A2.DIR_CD, A2.APLY_FM_YRWK, A2.APLY_TO_YRWK" ).append("\n"); 
		query.append("                )" ).append("\n"); 
		query.append("                GROUP BY TRD_CD , SUB_TRD_CD, RLANE_CD, DIR_CD" ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("            UNION ALL" ).append("\n"); 
		query.append("            (           " ).append("\n"); 
		query.append("                SELECT TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, '999999' AS RHQ_APLY_FM_YRWK_N_C, '999999' AS RHQ_APLY_TO_YRWK_N_C" ).append("\n"); 
		query.append("                    FROM" ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                        SELECT DISTINCT A2.TRD_CD, A2.SUB_TRD_CD, A2.RLANE_CD, A2.DIR_CD, A2.TRD_CD||A2.SUB_TRD_CD||A2.RLANE_CD||A2.DIR_CD AS TSRD" ).append("\n"); 
		query.append("                            FROM MAS_LANE_RGST A1, " ).append("\n"); 
		query.append("                                 (" ).append("\n"); 
		query.append("                                   SELECT O_QTA_RLSE_VER_NO  AS QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                         ,O_TRD_CD           AS TRD_CD" ).append("\n"); 
		query.append("                                         ,O_RLANE_CD         AS RLANE_CD" ).append("\n"); 
		query.append("                                         ,O_SUB_TRD_CD       AS SUB_TRD_CD" ).append("\n"); 
		query.append("                                         ,O_DIR_CD           AS DIR_CD" ).append("\n"); 
		query.append("                                         ,O_IOC_CD           AS IOC_CD" ).append("\n"); 
		query.append("                                         ,O_VVD" ).append("\n"); 
		query.append("                                         ,MAX(SLS_YR)        AS SLS_YR" ).append("\n"); 
		query.append("                                         ,MAX(SLS_YRMON)     AS SLS_YRMON" ).append("\n"); 
		query.append("                                         ,MAX(BSE_YR)        AS BSE_YR" ).append("\n"); 
		query.append("                                         ,MAX(BSE_MON)       AS BSE_MON" ).append("\n"); 
		query.append("                                         ,MAX(BSE_WK)        AS BSE_WK" ).append("\n"); 
		query.append("                                         ,MAX(VVD)           AS VVD" ).append("\n"); 
		query.append("                                         ,MAX(SQM_CNG_TP_CD) AS SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                         ,MAX(FNL_BSA_CAPA)  AS FNL_BSA_CAPA" ).append("\n"); 
		query.append("                                         ,MAX(LOD_QTY)       AS LOD_QTY" ).append("\n"); 
		query.append("                                         ,MAX(GRS_REV)       AS GRS_REV" ).append("\n"); 
		query.append("                                         ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE MAS_COST_YR             END) AS MAS_COST_YR" ).append("\n"); 
		query.append("                                         ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE MAS_COST_YRMON          END) AS MAS_COST_YRMON" ).append("\n"); 
		query.append("                                         ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE MAS_MON                END) AS MAS_BSE_MON" ).append("\n"); 
		query.append("                                         ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE COST_WK                END) AS MAS_BSE_WK" ).append("\n"); 
		query.append("                                         ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE MAS_VVD                END) AS MAS_VVD" ).append("\n"); 
		query.append("                                         ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE FNL_HJS_BSA_CAPA || '' END) AS MAS_FNL_BSA_CAPA" ).append("\n"); 
		query.append("                                         ,CASE WHEN MAX(SQM_INFO) = MAX(MAS_INFO) THEN 'R'" ).append("\n"); 
		query.append("                                               WHEN NVL(MAX(SQM_INFO), '*') = '*' THEN 'I'" ).append("\n"); 
		query.append("                                               WHEN NVL(MAX(MAS_INFO), '*') = '*' THEN 'D'" ).append("\n"); 
		query.append("                                                                                  ELSE 'U'" ).append("\n"); 
		query.append("                                          END AS FLAG" ).append("\n"); 
		query.append("                                         ,MAX(SQM_INFO) AS SQM_INFO" ).append("\n"); 
		query.append("                                         ,MAX(MAS_INFO) AS MAS_INFO" ).append("\n"); 
		query.append("                                     FROM (" ).append("\n"); 
		query.append("                                             SELECT B1.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                   ,B1.TRD_CD" ).append("\n"); 
		query.append("                                                   ,B1.DIR_CD" ).append("\n"); 
		query.append("                                                   ,B1.SUB_TRD_CD" ).append("\n"); 
		query.append("                                                   ,B1.RLANE_CD" ).append("\n"); 
		query.append("                                                   ,B1.BSE_YR" ).append("\n"); 
		query.append("                                                   ,B1.BSE_MON" ).append("\n"); 
		query.append("                                                   ,B1.BSE_WK" ).append("\n"); 
		query.append("                                                   ,B1.SLS_YRMON" ).append("\n"); 
		query.append("                                                   ,SUBSTR(B1.SLS_YRMON,0,4) AS SLS_YR" ).append("\n"); 
		query.append("                                                   ,B1.VSL_CD || B1.SKD_VOY_NO || B1.DIR_CD AS VVD" ).append("\n"); 
		query.append("                                                   ,B1.SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                                   ,B1.FNL_BSA_CAPA" ).append("\n"); 
		query.append("                                                   ,B1.LOD_QTY" ).append("\n"); 
		query.append("                                                   ,B1.GRS_REV" ).append("\n"); 
		query.append("                                                   ,B2.COST_YRMON AS MAS_COST_YRMON" ).append("\n"); 
		query.append("                                                   ,SUBSTR(B2.COST_YRMON,0,4) AS MAS_COST_YR" ).append("\n"); 
		query.append("                                                   ,SUBSTR(B2.YRMON, -2) AS MAS_MON" ).append("\n"); 
		query.append("                                                   ,B2.COST_WK" ).append("\n"); 
		query.append("                                                   ,B2.VSL_CD || B2.SKD_VOY_NO || B2.DIR_CD AS MAS_VVD" ).append("\n"); 
		query.append("                                                   ,B2.FNL_HJS_BSA_CAPA" ).append("\n"); 
		query.append("                                                   ,B1.TRD_CD || B1.SUB_TRD_CD || B1.RLANE_CD || B1.DIR_CD || B1.VSL_CD || B1.SKD_VOY_NO || B1.DIR_CD || B1.BSE_WK || B1.FNL_BSA_CAPA || B1.SLS_YRMON AS SQM_INFO" ).append("\n"); 
		query.append("                                                   ,B2.TRD_CD || B2.SUB_TRD_CD || B2.RLANE_CD || B2.DIR_CD || B2.VSL_CD || B2.SKD_VOY_NO || B2.DIR_CD || B2.COST_WK || B2.FNL_HJS_BSA_CAPA || B2.COST_YRMON AS MAS_INFO" ).append("\n"); 
		query.append("                                                   ,NVL(B1.QTA_RLSE_VER_NO, B2.QTA_RLSE_VER_NO)       AS O_QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                   ,NVL(B1.TRD_CD         , B2.TRD_CD)                AS O_TRD_CD" ).append("\n"); 
		query.append("                                                   ,NVL(B1.RLANE_CD       , B2.RLANE_CD)              AS O_RLANE_CD" ).append("\n"); 
		query.append("                                                   ,NVL(B1.SUB_TRD_CD     , B2.SUB_TRD_CD)            AS O_SUB_TRD_CD" ).append("\n"); 
		query.append("                                                   ,NVL(B1.IOC_CD         , B2.IOC_CD)                AS O_IOC_CD" ).append("\n"); 
		query.append("                                                   ,NVL(B1.DIR_CD         , B2.DIR_CD)                AS O_DIR_CD" ).append("\n"); 
		query.append("                                                   ,NVL(B1.BSE_MON        , SUBSTR(B2.YRMON, -2))     AS O_BSE_MON" ).append("\n"); 
		query.append("                                                   ,NVL(B1.BSE_WK         , B2.COST_WK)               AS O_BSE_WK" ).append("\n"); 
		query.append("                                                   ,NVL(B1.VSL_CD || B1.SKD_VOY_NO || B1.DIR_CD, B2.VSL_CD || B2.SKD_VOY_NO || B2.DIR_CD) AS O_VVD" ).append("\n"); 
		query.append("                                               FROM (" ).append("\n"); 
		query.append("                                                      SELECT " ).append("\n"); 
		query.append("                                                             V.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                            ,V.TRD_CD" ).append("\n"); 
		query.append("                                                            ,V.DIR_CD" ).append("\n"); 
		query.append("                                                            ,V.SUB_TRD_CD" ).append("\n"); 
		query.append("                                                            ,V.RLANE_CD" ).append("\n"); 
		query.append("                                                            ,V.BSE_YR" ).append("\n"); 
		query.append("                                                            ,V.BSE_MON" ).append("\n"); 
		query.append("                                                            ,V.BSE_WK" ).append("\n"); 
		query.append("                                                            ,V.SLS_YRMON" ).append("\n"); 
		query.append("                                                            ,V.VSL_CD" ).append("\n"); 
		query.append("                                                            ,V.SKD_VOY_NO" ).append("\n"); 
		query.append("                                                            ,V.FNL_BSA_CAPA" ).append("\n"); 
		query.append("                                                            ,Q.LOD_QTY" ).append("\n"); 
		query.append("                                                            ,Q.GRS_REV" ).append("\n"); 
		query.append("                                                            ,V.IOC_CD" ).append("\n"); 
		query.append("                                                            ,Q.SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                                        FROM SQM_CFM_TGT_VVD V" ).append("\n"); 
		query.append("                                                            ,(" ).append("\n"); 
		query.append("                                                              SELECT QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                                    ,TRD_CD" ).append("\n"); 
		query.append("                                                                    ,RLANE_CD" ).append("\n"); 
		query.append("                                                                    ,DIR_CD" ).append("\n"); 
		query.append("                                                                    ,VSL_CD" ).append("\n"); 
		query.append("                                                                    ,SKD_VOY_NO" ).append("\n"); 
		query.append("                                                                    ,SKD_DIR_CD" ).append("\n"); 
		query.append("                                                                    ,SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                                                    ,SUM(LOD_QTY) AS LOD_QTY" ).append("\n"); 
		query.append("                                                                    ,ROUND(SUM(LOD_QTY*GRS_RPB_REV)) AS GRS_REV" ).append("\n"); 
		query.append("                                                                FROM SQM_CFM_QTA" ).append("\n"); 
		query.append("                                                               WHERE 1=1" ).append("\n"); 
		query.append("                                                                 AND QTA_RLSE_VER_NO = ( SELECT QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                                                           FROM SQM_QTA_RLSE_VER" ).append("\n"); 
		query.append("                                                                                          WHERE BSE_TP_CD      = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                                                            AND BSE_YR         = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                                                            AND BSE_QTR_CD     = @[f_bse_qtr_cd]" ).append("\n"); 
		query.append("                                                                                            AND SQM_VER_STS_CD = 'R' )" ).append("\n"); 
		query.append("                                                                 AND OFC_VW_CD       = 'L'" ).append("\n"); 
		query.append("                        #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                                                                 AND TRD_CD          = @[f_trd_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                                                                 AND RLANE_CD        = @[f_rlane_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')" ).append("\n"); 
		query.append("                                                                 AND DIR_CD          = @[f_dir_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                                                               GROUP BY QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                                       ,TRD_CD" ).append("\n"); 
		query.append("                                                                       ,RLANE_CD" ).append("\n"); 
		query.append("                                                                       ,DIR_CD" ).append("\n"); 
		query.append("                                                                       ,VSL_CD" ).append("\n"); 
		query.append("                                                                       ,SKD_VOY_NO" ).append("\n"); 
		query.append("                                                                       ,SKD_DIR_CD" ).append("\n"); 
		query.append("                                                                       ,SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                                             ) Q" ).append("\n"); 
		query.append("                                                       WHERE 1=1" ).append("\n"); 
		query.append("                                                         AND V.QTA_RLSE_VER_NO = Q.QTA_RLSE_VER_NO(+)" ).append("\n"); 
		query.append("                                                         AND V.TRD_CD          = Q.TRD_CD(+)" ).append("\n"); 
		query.append("                                                         AND V.RLANE_CD        = Q.RLANE_CD(+)" ).append("\n"); 
		query.append("                                                         AND V.DIR_CD          = Q.DIR_CD(+)" ).append("\n"); 
		query.append("                                                         AND V.VSL_CD          = Q.VSL_CD(+)" ).append("\n"); 
		query.append("                                                         AND V.SKD_VOY_NO      = Q.SKD_VOY_NO(+)" ).append("\n"); 
		query.append("                                                         AND V.SKD_DIR_CD      = Q.SKD_DIR_CD(+)" ).append("\n"); 
		query.append("                                                         AND V.QTA_RLSE_VER_NO = SUBSTR(@[f_bse_yr],-2) ||@[f_bse_qtr_cd]||'02'" ).append("\n"); 
		query.append("                                                         AND V.BSE_TP_CD       = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                         AND V.BSE_YR          = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                         AND V.BSE_QTR_CD      = @[f_bse_qtr_cd]" ).append("\n"); 
		query.append("                        #if (${f_bse_wk} != '')" ).append("\n"); 
		query.append("                                                         AND V.BSE_WK          = @[f_bse_wk]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                                                         AND V.TRD_CD          = @[f_trd_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                                                         AND V.RLANE_CD        = @[f_rlane_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')" ).append("\n"); 
		query.append("                                                         AND V.DIR_CD          = @[f_dir_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("--                                                         AND 1 = CASE WHEN V.BSE_YR || v.BSE_QTR_CD > '20142Q'" ).append("\n"); 
		query.append("--                                                                           THEN (SELECT NVL((" ).append("\n"); 
		query.append("--                                                                                            SELECT DISTINCT 0" ).append("\n"); 
		query.append("--                                                                                              FROM SQM_SCTR_PAIR_MGMT S1" ).append("\n"); 
		query.append("--                                                                                             WHERE 1=1" ).append("\n"); 
		query.append("--                                                                                               AND S1.BSE_TP_CD  = V.BSE_TP_CD" ).append("\n"); 
		query.append("--                                                                                               AND S1.BSE_YR     = V.BSE_YR" ).append("\n"); 
		query.append("--                                                                                               AND S1.BSE_QTR_CD = V.BSE_QTR_CD" ).append("\n"); 
		query.append("--                                                                                               AND S1.TRD_CD     = V.TRD_CD" ).append("\n"); 
		query.append("--                                                                                               AND S1.RLANE_CD   = V.RLANE_CD" ).append("\n"); 
		query.append("--                                                                                               AND S1.DIR_CD     = V.DIR_CD" ).append("\n"); 
		query.append("--                                                                                            ),1)" ).append("\n"); 
		query.append("--                                                                                FROM DUAL)" ).append("\n"); 
		query.append("--                                                                      ELSE 1" ).append("\n"); 
		query.append("--                                                                 END" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                                    ) B1" ).append("\n"); 
		query.append("                                                    FULL OUTER JOIN" ).append("\n"); 
		query.append("                                                    (" ).append("\n"); 
		query.append("                                                      SELECT " ).append("\n"); 
		query.append("                                                             A3.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                            ,A1.TRD_CD" ).append("\n"); 
		query.append("                                                            ,A1.SUB_TRD_CD" ).append("\n"); 
		query.append("                                                            ,A1.RLANE_CD" ).append("\n"); 
		query.append("                                                            ,A1.DIR_CD" ).append("\n"); 
		query.append("                                                            ,A1.VSL_CD" ).append("\n"); 
		query.append("                                                            ,A1.SKD_VOY_NO" ).append("\n"); 
		query.append("                                                            ,A1.COST_YRMON" ).append("\n"); 
		query.append("                                                            ,DECODE(A3.BSE_YR, '2014', A1.SLS_YRMON, A1.COST_YRMON) YRMON" ).append("\n"); 
		query.append("                                                            ,A1.COST_WK" ).append("\n"); 
		query.append("                                                            ,A1.IOC_CD" ).append("\n"); 
		query.append("                                                            ,ROUND(NVL(A2.FNL_HJS_BSA_CAPA, 0)) AS FNL_HJS_BSA_CAPA" ).append("\n"); 
		query.append("                                                        FROM MAS_MON_VVD       A1" ).append("\n"); 
		query.append("                                                            ,BSA_VVD_MST       A2" ).append("\n"); 
		query.append("                                                            ,(" ).append("\n"); 
		query.append("                                                               SELECT DISTINCT" ).append("\n"); 
		query.append("                                                                      S1.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                                     ,S2.BSE_TP_CD" ).append("\n"); 
		query.append("                                                                     ,S2.BSE_YR" ).append("\n"); 
		query.append("                                                                     ,S2.BSE_QTR_CD" ).append("\n"); 
		query.append("                                                                     ,S2.TRD_CD" ).append("\n"); 
		query.append("                                                                     ,S2.RLANE_CD" ).append("\n"); 
		query.append("                                                                     ,S2.DIR_CD" ).append("\n"); 
		query.append("                                                                 FROM SQM_QTA_RLSE_VER S1" ).append("\n"); 
		query.append("                        #if (${f_cond_tp} == '1')" ).append("\n"); 
		query.append("                                                                      -- 해당 분기의 LANE-OFFICE RELATION SETTING 한 노선의 정보를 걸어준다" ).append("\n"); 
		query.append("                                                                      -- (2013년간 데이터를 제외한 모든 분기를 걸어주면됨 현재는 현재 분기와 미래 판매목표만 걸어주고 있음)" ).append("\n"); 
		query.append("                                                                     ,SQM_QTA_LANE_OFC S2" ).append("\n"); 
		query.append("                        #else" ).append("\n"); 
		query.append("                                                                      -- 2013년도 데이터는  LANE-OFFICE RELATION SETTING 정보가 없기 때문에 TARGET VVD 정보를 걸어서 노선정보를 가져온다." ).append("\n"); 
		query.append("                                                                     ,SQM_CFM_TGT_VVD S2" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                                                                WHERE 1=1" ).append("\n"); 
		query.append("                                                                  AND S1.BSE_TP_CD      = S2.BSE_TP_CD" ).append("\n"); 
		query.append("                                                                  AND S1.BSE_YR         = S2.BSE_YR" ).append("\n"); 
		query.append("                                                                  AND S1.BSE_QTR_CD     = S2.BSE_QTR_CD" ).append("\n"); 
		query.append("                                                                  AND S1.SQM_VER_STS_CD = 'R'" ).append("\n"); 
		query.append("                                                                  AND S2.BSE_TP_CD      = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                                  AND S2.BSE_YR         = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                                  AND S2.BSE_QTR_CD     = @[f_bse_qtr_cd]" ).append("\n"); 
		query.append("                        #if (${f_cond_tp} == '1')" ).append("\n"); 
		query.append("                                                                  AND S2.OFC_VW_CD      = 'L'" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                                                                  AND S2.TRD_CD         = @[f_trd_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                                                                  AND S2.RLANE_CD       = @[f_rlane_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')" ).append("\n"); 
		query.append("                                                                  AND S2.DIR_CD         = @[f_dir_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("--                                                                  AND 1 = CASE WHEN S2.BSE_YR || S2.BSE_QTR_CD > '20142Q'" ).append("\n"); 
		query.append("--                                                                                    THEN (SELECT NVL((" ).append("\n"); 
		query.append("--                                                                                                     SELECT 0" ).append("\n"); 
		query.append("--                                                                                                       FROM SQM_SCTR_PAIR_MGMT X1" ).append("\n"); 
		query.append("--                                                                                                      WHERE 1=1" ).append("\n"); 
		query.append("--                                                                                                        AND X1.BSE_TP_CD  = S2.BSE_TP_CD" ).append("\n"); 
		query.append("--                                                                                                        AND X1.BSE_YR     = S2.BSE_YR" ).append("\n"); 
		query.append("--                                                                                                        AND X1.BSE_QTR_CD = S2.BSE_QTR_CD" ).append("\n"); 
		query.append("--                                                                                                        AND X1.TRD_CD     = S2.TRD_CD" ).append("\n"); 
		query.append("--                                                                                                        AND X1.RLANE_CD   = S2.RLANE_CD" ).append("\n"); 
		query.append("--                                                                                                        AND X1.DIR_CD     = S2.DIR_CD" ).append("\n"); 
		query.append("--                                                                                                     ),1)" ).append("\n"); 
		query.append("--                                                                                         FROM DUAL)" ).append("\n"); 
		query.append("--                                                                               ELSE 1" ).append("\n"); 
		query.append("--                                                                          END" ).append("\n"); 
		query.append("                                                              ) A3" ).append("\n"); 
		query.append("                                                       WHERE A1.TRD_CD         = A2.TRD_CD     (+)" ).append("\n"); 
		query.append("                                                         AND A1.RLANE_CD       = A2.RLANE_CD   (+)" ).append("\n"); 
		query.append("                                                         AND A1.VSL_CD         = A2.VSL_CD     (+)" ).append("\n"); 
		query.append("                                                         AND A1.SKD_VOY_NO     = A2.SKD_VOY_NO (+)" ).append("\n"); 
		query.append("                                                         AND A1.DIR_CD         = A2.SKD_DIR_CD (+)" ).append("\n"); 
		query.append("                                                         AND A1.IOC_CD         = A2.IOC_CD     (+)" ).append("\n"); 
		query.append("                                                         AND A1.TRD_CD         = A3.TRD_CD" ).append("\n"); 
		query.append("                                                         AND A1.RLANE_CD       = A3.RLANE_CD" ).append("\n"); 
		query.append("                                                         AND A1.DIR_CD         = A3.DIR_CD" ).append("\n"); 
		query.append("                        #if (${f_bse_wk} != '')" ).append("\n"); 
		query.append("                                                         AND A1.COST_WK        = @[f_bse_wk]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                                                         AND A1.DELT_FLG       = 'N'" ).append("\n"); 
		query.append("                                                         AND A1.IOC_CD         = DECODE(A1.RLANE_CD, 'RBCCO', 'I', A1.IOC_CD) -- RBCCO 노선은 IOC_CD = 'I' 인것만" ).append("\n"); 
		query.append("                                                         -- 2013년 : SLS_YRMON / 2014년 : Week / 2015년~ : COST_YRMON (COA 이행 데이터 기준이 다름)" ).append("\n"); 
		query.append("                                                         AND CASE WHEN '2013' = A3.BSE_YR THEN A1.SLS_YRMON WHEN '2014' = A3.BSE_YR THEN SUBSTR(A1.SLS_YRMON, 1, 4)||A1.COST_WK ELSE A1.COST_YRMON END " ).append("\n"); 
		query.append("                                                             BETWEEN CASE WHEN '2014' = A3.BSE_YR THEN @[f_bse_yr]||@[f_fm_wk] ELSE @[f_bse_yr]||DECODE(@[f_bse_qtr_cd],'1Q','01','2Q','04','3Q','07','4Q','10') END " ).append("\n"); 
		query.append("                                                                 AND CASE WHEN '2014' = A3.BSE_YR THEN @[f_bse_yr]||@[f_to_wk] ELSE @[f_bse_yr]||DECODE(@[f_bse_qtr_cd],'1Q','03','2Q','06','3Q','09','4Q','12') END " ).append("\n"); 
		query.append("                                                         AND NOT EXISTS ( SELECT 1" ).append("\n"); 
		query.append("                                                                            FROM SQM_QTA_TGT_VVD S1" ).append("\n"); 
		query.append("                                                                           WHERE S1.BSE_TP_CD  = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                                             AND S1.BSE_YR     = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                                             AND S1.BSE_QTR_CD = @[f_bse_qtr_cd]" ).append("\n"); 
		query.append("                                                                             AND S1.DELT_FLG   = 'Y'" ).append("\n"); 
		query.append("                                                                             AND A1.TRD_CD     = S1.TRD_CD" ).append("\n"); 
		query.append("                                                                             AND A1.RLANE_CD   = S1.RLANE_CD" ).append("\n"); 
		query.append("                                                                             AND A1.VSL_CD     = S1.VSL_CD" ).append("\n"); 
		query.append("                                                                             AND A1.SKD_VOY_NO = S1.SKD_VOY_NO" ).append("\n"); 
		query.append("                                                                             AND A1.DIR_CD     = S1.DIR_CD" ).append("\n"); 
		query.append("                                                                        )" ).append("\n"); 
		query.append("                                                    ) B2" ).append("\n"); 
		query.append("                                                 ON B1.QTA_RLSE_VER_NO = B2.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                AND B1.TRD_CD          = B2.TRD_CD" ).append("\n"); 
		query.append("                                                AND B1.SUB_TRD_CD      = B2.SUB_TRD_CD" ).append("\n"); 
		query.append("                                                AND B1.DIR_CD          = B2.DIR_CD" ).append("\n"); 
		query.append("                                                AND B1.RLANE_CD        = B2.RLANE_CD" ).append("\n"); 
		query.append("                                                AND B1.IOC_CD          = B2.IOC_CD" ).append("\n"); 
		query.append("                                                AND B1.VSL_CD          = B2.VSL_CD" ).append("\n"); 
		query.append("                                                AND B1.SKD_VOY_NO      = B2.SKD_VOY_NO" ).append("\n"); 
		query.append("                                          )" ).append("\n"); 
		query.append("                                 GROUP BY O_QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                         ,O_TRD_CD" ).append("\n"); 
		query.append("                                         ,O_RLANE_CD" ).append("\n"); 
		query.append("                                         ,O_SUB_TRD_CD" ).append("\n"); 
		query.append("                                         ,O_DIR_CD" ).append("\n"); 
		query.append("                                         ,O_IOC_CD" ).append("\n"); 
		query.append("                                         ,O_VVD" ).append("\n"); 
		query.append("                                 )A2" ).append("\n"); 
		query.append("                        WHERE A1.TRD_CD         = A2.TRD_CD" ).append("\n"); 
		query.append("                        AND A1.SUB_TRD_CD       = A2.SUB_TRD_CD" ).append("\n"); 
		query.append("                        AND A1.RLANE_CD         = A2.RLANE_CD" ).append("\n"); 
		query.append("                        AND A1.DIR_CD           = A2.DIR_CD" ).append("\n"); 
		query.append("                        AND A1.IOC_CD           = A2.IOC_CD" ).append("\n"); 
		query.append("                        #if (${f_portion_link} != '' && ${f_portion_link} != 'All')" ).append("\n"); 
		query.append("                        AND DECODE(SQM_CNG_TP_CD, 'I', 'Y', 'N') = @[f_portion_link]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_trd_dir} == 'on' && ${f_hul_bnd_cd} != '' && ${f_hul_bnd_cd} != 'All')" ).append("\n"); 
		query.append("                        AND A1.HUL_BND_CD               		 = @[f_hul_bnd_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("                    WHERE TSRD NOT IN" ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                        SELECT DISTINCT A2.TRD_CD||A2.SUB_TRD_CD||A2.RLANE_CD||A2.DIR_CD" ).append("\n"); 
		query.append("                          FROM SQM_QTA_LANE_OFC A1" ).append("\n"); 
		query.append("                              ,SQM_CFM_QTA_POTN_MGMT A2" ).append("\n"); 
		query.append("                              ,SQM_DAT_RLT A3" ).append("\n"); 
		query.append("                              ,MAS_LANE_RGST A4" ).append("\n"); 
		query.append("                         WHERE 1=1" ).append("\n"); 
		query.append("                           AND A2.TRD_CD       = A4.TRD_CD" ).append("\n"); 
		query.append("                           AND A2.RLANE_CD     = A4.RLANE_CD" ).append("\n"); 
		query.append("                           AND A2.DIR_CD       = A4.DIR_CD" ).append("\n"); 
		query.append("                           AND A4.DELT_FLG     = 'N'" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                           AND A2.BSE_TP_CD    = A3.BSE_TP_CD" ).append("\n"); 
		query.append("                           AND A2.BSE_YR       = A3.BSE_YR" ).append("\n"); 
		query.append("                           AND A2.BSE_QTR_CD   = A3.BSE_QTR_CD" ).append("\n"); 
		query.append("                           AND A2.OFC_VW_CD    = A3.OFC_VW_CD" ).append("\n"); 
		query.append("                           AND A2.TRD_CD       = A3.TRD_CD" ).append("\n"); 
		query.append("                           AND A2.CONV_DIR_CD  = A3.CONV_DIR_CD" ).append("\n"); 
		query.append("                           AND A2.RHQ_CD       = A3.RHQ_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                           AND A1.BSE_TP_CD    = A2.BSE_TP_CD" ).append("\n"); 
		query.append("                           AND A1.BSE_YR       = A2.BSE_YR" ).append("\n"); 
		query.append("                           AND A1.BSE_QTR_CD   = A2.BSE_QTR_CD" ).append("\n"); 
		query.append("                           AND A1.OFC_VW_CD    = A2.OFC_VW_CD" ).append("\n"); 
		query.append("                           AND A1.RHQ_CD       = A2.RHQ_CD" ).append("\n"); 
		query.append("                           AND A1.RGN_OFC_CD   = A2.RGN_OFC_CD" ).append("\n"); 
		query.append("                           AND A1.TRD_CD       = A2.TRD_CD" ).append("\n"); 
		query.append("                           AND A1.RLANE_CD     = A2.RLANE_CD" ).append("\n"); 
		query.append("                           AND A1.DIR_CD       = A2.DIR_CD" ).append("\n"); 
		query.append("                           AND A1.SQM_ACT_FLG  = 'Y'" ).append("\n"); 
		query.append("                           AND A2.BSE_TP_CD    = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                           AND A2.BSE_YR       = @[f_bse_yr]" ).append("\n"); 
		query.append("                           AND A2.BSE_QTR_CD   = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])" ).append("\n"); 
		query.append("                           AND A2.OFC_VW_CD    = 'C'" ).append("\n"); 
		query.append("                           AND A2.QTA_STEP_CD  = '04' --OUTBOUND가 05이고 N.OUTBOUNT가 04임" ).append("\n"); 
		query.append("                        #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                           AND A2.TRD_CD       = @[f_trd_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                           AND A2.RLANE_CD     = @[f_rlane_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_click} != 'on' && ${f_conv_dir_cd} != '' && ${f_conv_dir_cd} != 'All')" ).append("\n"); 
		query.append("                           AND A2.CONV_DIR_CD  = @[f_conv_dir_cd]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                        #if (${f_click} == 'on' && ${f_trd_dir} != '' && ${f_trd_dir} != 'All')" ).append("\n"); 
		query.append("                           AND A4.HUL_BND_CD  = @[f_trd_dir]" ).append("\n"); 
		query.append("                        #end" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("            " ).append("\n"); 
		query.append("            )" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        SELECT CASE" ).append("\n"); 
		query.append("                WHEN BSE_WK IN ('00', '53')" ).append("\n"); 
		query.append("                THEN" ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                    CASE                    " ).append("\n"); 
		query.append("                        WHEN NVL((SELECT SUBSTR(MMV.COST_YRMON, 1, 4) FROM MAS_MON_VVD MMV WHERE MMV.TRD_CD = A2.TRD_CD AND MMV.RLANE_CD = A2.RLANE_CD AND MMV.VSL_CD = SUBSTR(A2.VVD,1,4) AND MMV.SKD_VOY_NO = SUBSTR(A2.VVD,5,8) AND MMV.DIR_CD = SUBSTR(A2.VVD,9,9)),SLS_YR) = SUBSTR(RHQ_APLY_FM_YRWK_L,1,4)  -- RHQ FROM YEAR 비교" ).append("\n"); 
		query.append("                        THEN " ).append("\n"); 
		query.append("                            (" ).append("\n"); 
		query.append("                                CASE " ).append("\n"); 
		query.append("                                    WHEN NVL((SELECT SUBSTR(MMV.COST_YRMON, 1, 4) FROM MAS_MON_VVD MMV WHERE MMV.TRD_CD = A2.TRD_CD AND MMV.RLANE_CD = A2.RLANE_CD AND MMV.VSL_CD = SUBSTR(A2.VVD,1,4) AND MMV.SKD_VOY_NO = SUBSTR(A2.VVD,5,8) AND MMV.DIR_CD = SUBSTR(A2.VVD,9,9)),SLS_YR) = SUBSTR(RHQ_APLY_TO_YRWK_L,1,4) -- RHQ TO YEAR 비교" ).append("\n"); 
		query.append("                                    THEN " ).append("\n"); 
		query.append("                                        (" ).append("\n"); 
		query.append("                                            CASE " ).append("\n"); 
		query.append("                                              WHEN BSE_WK >= SUBSTR(RHQ_APLY_FM_YRWK_L,5) -- RHQ FROM WEEK 비교" ).append("\n"); 
		query.append("                                              THEN " ).append("\n"); 
		query.append("                                                (" ).append("\n"); 
		query.append("                                                    CASE" ).append("\n"); 
		query.append("                                                        WHEN BSE_WK <= SUBSTR(RHQ_APLY_TO_YRWK_L,5) -- RHQ TO WEEK 비교" ).append("\n"); 
		query.append("                                                        THEN 'SAME'" ).append("\n"); 
		query.append("                                                        ELSE 'DIFFERENT!'||RL.TRD_CD||'!'||RL.SUB_TRD_CD||'!'||RL.RLANE_CD||'!'||RL.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                                                    END" ).append("\n"); 
		query.append("                                                )" ).append("\n"); 
		query.append("                                              ELSE 'DIFFERENT!'||RL.TRD_CD||'!'||RL.SUB_TRD_CD||'!'||RL.RLANE_CD||'!'||RL.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                                            END" ).append("\n"); 
		query.append("                                        )" ).append("\n"); 
		query.append("                                    ELSE 'DIFFERENT!'||RL.TRD_CD||'!'||RL.SUB_TRD_CD||'!'||RL.RLANE_CD||'!'||RL.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                                END" ).append("\n"); 
		query.append("                            )" ).append("\n"); 
		query.append("                        WHEN NVL((SELECT SUBSTR(MMV.COST_YRMON, 1, 4) FROM MAS_MON_VVD MMV WHERE MMV.TRD_CD = A2.TRD_CD AND MMV.RLANE_CD = A2.RLANE_CD AND MMV.VSL_CD = SUBSTR(A2.VVD,1,4) AND MMV.SKD_VOY_NO = SUBSTR(A2.VVD,5,8) AND MMV.DIR_CD = SUBSTR(A2.VVD,9,9)),SLS_YR) > SUBSTR(RHQ_APLY_FM_YRWK_L,1,4)  " ).append("\n"); 
		query.append("                        THEN 'SAME'" ).append("\n"); 
		query.append("                        WHEN NVL((SELECT SUBSTR(MMV.COST_YRMON, 1, 4) FROM MAS_MON_VVD MMV WHERE MMV.TRD_CD = A2.TRD_CD AND MMV.RLANE_CD = A2.RLANE_CD AND MMV.VSL_CD = SUBSTR(A2.VVD,1,4) AND MMV.SKD_VOY_NO = SUBSTR(A2.VVD,5,8) AND MMV.DIR_CD = SUBSTR(A2.VVD,9,9)),SLS_YR) < SUBSTR(RHQ_APLY_FM_YRWK_L,1,4)  " ).append("\n"); 
		query.append("                        THEN 'DIFFERENT!'||RL.TRD_CD||'!'||RL.SUB_TRD_CD||'!'||RL.RLANE_CD||'!'||RL.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                        END                    " ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("                WHEN SLS_YR = SUBSTR(RHQ_APLY_FM_YRWK_L,1,4)  -- RHQ FROM YEAR 비교" ).append("\n"); 
		query.append("                THEN " ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                        CASE " ).append("\n"); 
		query.append("                            WHEN SLS_YR = SUBSTR(RHQ_APLY_TO_YRWK_L,1,4) -- RHQ TO YEAR 비교" ).append("\n"); 
		query.append("                            THEN " ).append("\n"); 
		query.append("                                (" ).append("\n"); 
		query.append("                                    CASE " ).append("\n"); 
		query.append("                                      WHEN BSE_WK >= SUBSTR(RHQ_APLY_FM_YRWK_L,5) -- RHQ FROM WEEK 비교" ).append("\n"); 
		query.append("                                      THEN " ).append("\n"); 
		query.append("                                        (" ).append("\n"); 
		query.append("                                            CASE" ).append("\n"); 
		query.append("                                                WHEN BSE_WK <= SUBSTR(RHQ_APLY_TO_YRWK_L,5) -- RHQ TO WEEK 비교" ).append("\n"); 
		query.append("                                                THEN 'SAME'" ).append("\n"); 
		query.append("                                                ELSE 'DIFFERENT!'||RL.TRD_CD||'!'||RL.SUB_TRD_CD||'!'||RL.RLANE_CD||'!'||RL.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                                            END" ).append("\n"); 
		query.append("                                        )" ).append("\n"); 
		query.append("                                      ELSE 'DIFFERENT!'||RL.TRD_CD||'!'||RL.SUB_TRD_CD||'!'||RL.RLANE_CD||'!'||RL.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                                    END" ).append("\n"); 
		query.append("                                )" ).append("\n"); 
		query.append("                            ELSE 'DIFFERENT!'||RL.TRD_CD||'!'||RL.SUB_TRD_CD||'!'||RL.RLANE_CD||'!'||RL.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                        END" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("                WHEN SLS_YR > SUBSTR(RHQ_APLY_FM_YRWK_L,1,4)  " ).append("\n"); 
		query.append("                THEN 'SAME'" ).append("\n"); 
		query.append("                WHEN SLS_YR < SUBSTR(RHQ_APLY_FM_YRWK_L,1,4)  " ).append("\n"); 
		query.append("                THEN 'DIFFERENT!'||RL.TRD_CD||'!'||RL.SUB_TRD_CD||'!'||RL.RLANE_CD||'!'||RL.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                END AS COMPARISON_WITH_RHQ_L   " ).append("\n"); 
		query.append("                " ).append("\n"); 
		query.append("              ,CASE" ).append("\n"); 
		query.append("                WHEN BSE_WK IN ('00', '53')" ).append("\n"); 
		query.append("                THEN" ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                    CASE" ).append("\n"); 
		query.append("                        WHEN NVL((SELECT SUBSTR(MMV.COST_YRMON, 1, 4) FROM MAS_MON_VVD MMV WHERE MMV.TRD_CD = A2.TRD_CD AND MMV.RLANE_CD = A2.RLANE_CD AND MMV.VSL_CD = SUBSTR(A2.VVD,1,4) AND MMV.SKD_VOY_NO = SUBSTR(A2.VVD,5,8) AND MMV.DIR_CD = SUBSTR(A2.VVD,9,9)),SLS_YR) = SUBSTR(RHQ_APLY_FM_YRWK_O_C,1,4)  -- RHQ FROM YEAR 비교" ).append("\n"); 
		query.append("                        THEN " ).append("\n"); 
		query.append("                        (" ).append("\n"); 
		query.append("                            CASE " ).append("\n"); 
		query.append("                                WHEN NVL((SELECT SUBSTR(MMV.COST_YRMON, 1, 4) FROM MAS_MON_VVD MMV WHERE MMV.TRD_CD = A2.TRD_CD AND MMV.RLANE_CD = A2.RLANE_CD AND MMV.VSL_CD = SUBSTR(A2.VVD,1,4) AND MMV.SKD_VOY_NO = SUBSTR(A2.VVD,5,8) AND MMV.DIR_CD = SUBSTR(A2.VVD,9,9)),SLS_YR) = SUBSTR(RHQ_APLY_TO_YRWK_O_C,1,4) -- RHQ TO YEAR 비교" ).append("\n"); 
		query.append("                                THEN " ).append("\n"); 
		query.append("                                    (" ).append("\n"); 
		query.append("                                        CASE " ).append("\n"); 
		query.append("                                          WHEN BSE_WK >= SUBSTR(RHQ_APLY_FM_YRWK_O_C,5) -- RHQ FROM WEEK 비교" ).append("\n"); 
		query.append("                                          THEN " ).append("\n"); 
		query.append("                                            (" ).append("\n"); 
		query.append("                                                CASE" ).append("\n"); 
		query.append("                                                    WHEN BSE_WK <= SUBSTR(RHQ_APLY_TO_YRWK_O_C,5) -- RHQ TO WEEK 비교" ).append("\n"); 
		query.append("                                                    THEN 'SAME'" ).append("\n"); 
		query.append("                                                    ELSE 'DIFFERENT!'||ROC.TRD_CD||'!'||ROC.SUB_TRD_CD||'!'||ROC.RLANE_CD||'!'||ROC.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                                                END" ).append("\n"); 
		query.append("                                            )" ).append("\n"); 
		query.append("                                          ELSE 'DIFFERENT!'||ROC.TRD_CD||'!'||ROC.SUB_TRD_CD||'!'||ROC.RLANE_CD||'!'||ROC.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                                        END" ).append("\n"); 
		query.append("                                    )" ).append("\n"); 
		query.append("                                ELSE 'DIFFERENT!'||ROC.TRD_CD||'!'||ROC.SUB_TRD_CD||'!'||ROC.RLANE_CD||'!'||ROC.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                            END" ).append("\n"); 
		query.append("                        )" ).append("\n"); 
		query.append("                        WHEN NVL((SELECT SUBSTR(MMV.COST_YRMON, 1, 4) FROM MAS_MON_VVD MMV WHERE MMV.TRD_CD = A2.TRD_CD AND MMV.RLANE_CD = A2.RLANE_CD AND MMV.VSL_CD = SUBSTR(A2.VVD,1,4) AND MMV.SKD_VOY_NO = SUBSTR(A2.VVD,5,8) AND MMV.DIR_CD = SUBSTR(A2.VVD,9,9)),SLS_YR) > SUBSTR(RHQ_APLY_FM_YRWK_O_C,1,4)  " ).append("\n"); 
		query.append("                        THEN 'SAME'" ).append("\n"); 
		query.append("                        WHEN NVL((SELECT SUBSTR(MMV.COST_YRMON, 1, 4) FROM MAS_MON_VVD MMV WHERE MMV.TRD_CD = A2.TRD_CD AND MMV.RLANE_CD = A2.RLANE_CD AND MMV.VSL_CD = SUBSTR(A2.VVD,1,4) AND MMV.SKD_VOY_NO = SUBSTR(A2.VVD,5,8) AND MMV.DIR_CD = SUBSTR(A2.VVD,9,9)),SLS_YR) < SUBSTR(RHQ_APLY_FM_YRWK_O_C,1,4)  " ).append("\n"); 
		query.append("                        THEN 'DIFFERENT!'||ROC.TRD_CD||'!'||ROC.SUB_TRD_CD||'!'||ROC.RLANE_CD||'!'||ROC.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                        END" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("                WHEN SLS_YR = SUBSTR(RHQ_APLY_FM_YRWK_O_C,1,4)  -- RHQ FROM YEAR 비교" ).append("\n"); 
		query.append("                THEN " ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                        CASE " ).append("\n"); 
		query.append("                            WHEN SLS_YR = SUBSTR(RHQ_APLY_TO_YRWK_O_C,1,4) -- RHQ TO YEAR 비교" ).append("\n"); 
		query.append("                            THEN " ).append("\n"); 
		query.append("                                (" ).append("\n"); 
		query.append("                                    CASE " ).append("\n"); 
		query.append("                                      WHEN BSE_WK >= SUBSTR(RHQ_APLY_FM_YRWK_O_C,5) -- RHQ FROM WEEK 비교" ).append("\n"); 
		query.append("                                      THEN " ).append("\n"); 
		query.append("                                        (" ).append("\n"); 
		query.append("                                            CASE" ).append("\n"); 
		query.append("                                                WHEN BSE_WK <= SUBSTR(RHQ_APLY_TO_YRWK_O_C,5) -- RHQ TO WEEK 비교" ).append("\n"); 
		query.append("                                                THEN 'SAME'" ).append("\n"); 
		query.append("                                                ELSE 'DIFFERENT!'||ROC.TRD_CD||'!'||ROC.SUB_TRD_CD||'!'||ROC.RLANE_CD||'!'||ROC.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                                            END" ).append("\n"); 
		query.append("                                        )" ).append("\n"); 
		query.append("                                      ELSE 'DIFFERENT!'||ROC.TRD_CD||'!'||ROC.SUB_TRD_CD||'!'||ROC.RLANE_CD||'!'||ROC.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                                    END" ).append("\n"); 
		query.append("                                )" ).append("\n"); 
		query.append("                            ELSE 'DIFFERENT!'||ROC.TRD_CD||'!'||ROC.SUB_TRD_CD||'!'||ROC.RLANE_CD||'!'||ROC.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                        END" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("                WHEN SLS_YR > SUBSTR(RHQ_APLY_FM_YRWK_O_C,1,4)  " ).append("\n"); 
		query.append("                THEN 'SAME'" ).append("\n"); 
		query.append("                WHEN SLS_YR < SUBSTR(RHQ_APLY_FM_YRWK_O_C,1,4)  " ).append("\n"); 
		query.append("                THEN 'DIFFERENT!'||ROC.TRD_CD||'!'||ROC.SUB_TRD_CD||'!'||ROC.RLANE_CD||'!'||ROC.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                END AS COMPARISON_WITH_RHQ_O_C   " ).append("\n"); 
		query.append("                " ).append("\n"); 
		query.append("                ,CASE" ).append("\n"); 
		query.append("                WHEN BSE_WK IN ('00', '53')" ).append("\n"); 
		query.append("                THEN" ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                    CASE" ).append("\n"); 
		query.append("                        WHEN NVL((SELECT SUBSTR(MMV.COST_YRMON, 1, 4) FROM MAS_MON_VVD MMV WHERE MMV.TRD_CD = A2.TRD_CD AND MMV.RLANE_CD = A2.RLANE_CD AND MMV.VSL_CD = SUBSTR(A2.VVD,1,4) AND MMV.SKD_VOY_NO = SUBSTR(A2.VVD,5,8) AND MMV.DIR_CD = SUBSTR(A2.VVD,9,9)),SLS_YR) = SUBSTR(RHQ_APLY_FM_YRWK_N_C,1,4)  -- RHQ FROM YEAR 비교" ).append("\n"); 
		query.append("                        THEN " ).append("\n"); 
		query.append("                        (" ).append("\n"); 
		query.append("                            CASE " ).append("\n"); 
		query.append("                                WHEN NVL((SELECT SUBSTR(MMV.COST_YRMON, 1, 4) FROM MAS_MON_VVD MMV WHERE MMV.TRD_CD = A2.TRD_CD AND MMV.RLANE_CD = A2.RLANE_CD AND MMV.VSL_CD = SUBSTR(A2.VVD,1,4) AND MMV.SKD_VOY_NO = SUBSTR(A2.VVD,5,8) AND MMV.DIR_CD = SUBSTR(A2.VVD,9,9)),SLS_YR) = SUBSTR(RHQ_APLY_TO_YRWK_N_C,1,4) -- RHQ TO YEAR 비교" ).append("\n"); 
		query.append("                                THEN " ).append("\n"); 
		query.append("                                    (" ).append("\n"); 
		query.append("                                        CASE " ).append("\n"); 
		query.append("                                          WHEN BSE_WK >= SUBSTR(RHQ_APLY_FM_YRWK_N_C,5) -- RHQ FROM WEEK 비교" ).append("\n"); 
		query.append("                                          THEN " ).append("\n"); 
		query.append("                                            (" ).append("\n"); 
		query.append("                                                CASE" ).append("\n"); 
		query.append("                                                    WHEN BSE_WK <= SUBSTR(RHQ_APLY_TO_YRWK_N_C,5) -- RHQ TO WEEK 비교" ).append("\n"); 
		query.append("                                                    THEN 'SAME'" ).append("\n"); 
		query.append("                                                    ELSE 'DIFFERENT!'||RNC.TRD_CD||'!'||RNC.SUB_TRD_CD||'!'||RNC.RLANE_CD||'!'||RNC.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                                                END" ).append("\n"); 
		query.append("                                            )" ).append("\n"); 
		query.append("                                          ELSE 'DIFFERENT!'||RNC.TRD_CD||'!'||RNC.SUB_TRD_CD||'!'||RNC.RLANE_CD||'!'||RNC.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                                        END" ).append("\n"); 
		query.append("                                    )" ).append("\n"); 
		query.append("                                ELSE 'DIFFERENT!'||RNC.TRD_CD||'!'||RNC.SUB_TRD_CD||'!'||RNC.RLANE_CD||'!'||RNC.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                            END" ).append("\n"); 
		query.append("                        )" ).append("\n"); 
		query.append("                        WHEN NVL((SELECT SUBSTR(MMV.COST_YRMON, 1, 4) FROM MAS_MON_VVD MMV WHERE MMV.TRD_CD = A2.TRD_CD AND MMV.RLANE_CD = A2.RLANE_CD AND MMV.VSL_CD = SUBSTR(A2.VVD,1,4) AND MMV.SKD_VOY_NO = SUBSTR(A2.VVD,5,8) AND MMV.DIR_CD = SUBSTR(A2.VVD,9,9)),SLS_YR) > SUBSTR(RHQ_APLY_FM_YRWK_N_C,1,4)  " ).append("\n"); 
		query.append("                        THEN 'SAME'" ).append("\n"); 
		query.append("                        WHEN NVL((SELECT SUBSTR(MMV.COST_YRMON, 1, 4) FROM MAS_MON_VVD MMV WHERE MMV.TRD_CD = A2.TRD_CD AND MMV.RLANE_CD = A2.RLANE_CD AND MMV.VSL_CD = SUBSTR(A2.VVD,1,4) AND MMV.SKD_VOY_NO = SUBSTR(A2.VVD,5,8) AND MMV.DIR_CD = SUBSTR(A2.VVD,9,9)),SLS_YR) < SUBSTR(RHQ_APLY_FM_YRWK_N_C,1,4)  " ).append("\n"); 
		query.append("                        THEN 'DIFFERENT!'||RNC.TRD_CD||'!'||RNC.SUB_TRD_CD||'!'||RNC.RLANE_CD||'!'||RNC.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                        END" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("                WHEN SLS_YR = SUBSTR(RHQ_APLY_FM_YRWK_N_C,1,4)  -- RHQ FROM YEAR 비교" ).append("\n"); 
		query.append("                THEN " ).append("\n"); 
		query.append("                    (" ).append("\n"); 
		query.append("                        CASE " ).append("\n"); 
		query.append("                            WHEN SLS_YR = SUBSTR(RHQ_APLY_TO_YRWK_N_C,1,4) -- RHQ TO YEAR 비교" ).append("\n"); 
		query.append("                            THEN " ).append("\n"); 
		query.append("                                (" ).append("\n"); 
		query.append("                                    CASE " ).append("\n"); 
		query.append("                                      WHEN BSE_WK >= SUBSTR(RHQ_APLY_FM_YRWK_N_C,5) -- RHQ FROM WEEK 비교" ).append("\n"); 
		query.append("                                      THEN " ).append("\n"); 
		query.append("                                        (" ).append("\n"); 
		query.append("                                            CASE" ).append("\n"); 
		query.append("                                                WHEN BSE_WK <= SUBSTR(RHQ_APLY_TO_YRWK_N_C,5) -- RHQ TO WEEK 비교" ).append("\n"); 
		query.append("                                                THEN 'SAME'" ).append("\n"); 
		query.append("                                                ELSE 'DIFFERENT!'||RNC.TRD_CD||'!'||RNC.SUB_TRD_CD||'!'||RNC.RLANE_CD||'!'||RNC.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                                            END" ).append("\n"); 
		query.append("                                        )" ).append("\n"); 
		query.append("                                      ELSE 'DIFFERENT!'||RNC.TRD_CD||'!'||RNC.SUB_TRD_CD||'!'||RNC.RLANE_CD||'!'||RNC.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                                    END" ).append("\n"); 
		query.append("                                )" ).append("\n"); 
		query.append("                            ELSE 'DIFFERENT!'||RNC.TRD_CD||'!'||RNC.SUB_TRD_CD||'!'||RNC.RLANE_CD||'!'||RNC.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                        END" ).append("\n"); 
		query.append("                    )" ).append("\n"); 
		query.append("                WHEN SLS_YR > SUBSTR(RHQ_APLY_FM_YRWK_N_C,1,4)  " ).append("\n"); 
		query.append("                THEN 'SAME'" ).append("\n"); 
		query.append("                WHEN SLS_YR < SUBSTR(RHQ_APLY_FM_YRWK_N_C,1,4)  " ).append("\n"); 
		query.append("                THEN 'DIFFERENT!'||RNC.TRD_CD||'!'||RNC.SUB_TRD_CD||'!'||RNC.RLANE_CD||'!'||RNC.DIR_CD||'!'||BSE_WK" ).append("\n"); 
		query.append("                END AS COMPARISON_WITH_RHQ_N_C" ).append("\n"); 
		query.append("            " ).append("\n"); 
		query.append("            FROM MAS_LANE_RGST A1, " ).append("\n"); 
		query.append("                 (" ).append("\n"); 
		query.append("                   SELECT O_QTA_RLSE_VER_NO  AS QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                         ,O_TRD_CD           AS TRD_CD" ).append("\n"); 
		query.append("                         ,O_RLANE_CD         AS RLANE_CD" ).append("\n"); 
		query.append("                         ,O_SUB_TRD_CD       AS SUB_TRD_CD" ).append("\n"); 
		query.append("                         ,O_DIR_CD           AS DIR_CD" ).append("\n"); 
		query.append("                         ,O_IOC_CD           AS IOC_CD" ).append("\n"); 
		query.append("                         ,O_VVD" ).append("\n"); 
		query.append("                         ,MAX(SLS_YR)        AS SLS_YR" ).append("\n"); 
		query.append("                         ,MAX(SLS_YRMON)     AS SLS_YRMON" ).append("\n"); 
		query.append("                         ,MAX(BSE_YR)        AS BSE_YR" ).append("\n"); 
		query.append("                         ,MAX(BSE_MON)       AS BSE_MON" ).append("\n"); 
		query.append("                         ,MAX(BSE_WK)        AS BSE_WK" ).append("\n"); 
		query.append("                         ,MAX(VVD)           AS VVD" ).append("\n"); 
		query.append("                         ,MAX(SQM_CNG_TP_CD) AS SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                         ,MAX(FNL_BSA_CAPA)  AS FNL_BSA_CAPA" ).append("\n"); 
		query.append("                         ,MAX(LOD_QTY)       AS LOD_QTY" ).append("\n"); 
		query.append("                         ,MAX(GRS_REV)       AS GRS_REV" ).append("\n"); 
		query.append("                         ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE MAS_COST_YR             END) AS MAS_COST_YR" ).append("\n"); 
		query.append("                         ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE MAS_COST_YRMON          END) AS MAS_COST_YRMON" ).append("\n"); 
		query.append("                         ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE MAS_MON                END) AS MAS_BSE_MON" ).append("\n"); 
		query.append("                         ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE COST_WK                END) AS MAS_BSE_WK" ).append("\n"); 
		query.append("                         ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE MAS_VVD                END) AS MAS_VVD" ).append("\n"); 
		query.append("                         ,MAX(CASE WHEN NVL(SQM_INFO, '*') = NVL(MAS_INFO, '*') THEN '' ELSE FNL_HJS_BSA_CAPA || '' END) AS MAS_FNL_BSA_CAPA" ).append("\n"); 
		query.append("                         ,CASE WHEN MAX(SQM_INFO) = MAX(MAS_INFO) THEN 'R'" ).append("\n"); 
		query.append("                               WHEN NVL(MAX(SQM_INFO), '*') = '*' THEN 'I'" ).append("\n"); 
		query.append("                               WHEN NVL(MAX(MAS_INFO), '*') = '*' THEN 'D'" ).append("\n"); 
		query.append("                                                                  ELSE 'U'" ).append("\n"); 
		query.append("                          END AS FLAG" ).append("\n"); 
		query.append("                         ,MAX(SQM_INFO) AS SQM_INFO" ).append("\n"); 
		query.append("                         ,MAX(MAS_INFO) AS MAS_INFO" ).append("\n"); 
		query.append("                     FROM (" ).append("\n"); 
		query.append("                             SELECT B1.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                   ,B1.TRD_CD" ).append("\n"); 
		query.append("                                   ,B1.DIR_CD" ).append("\n"); 
		query.append("                                   ,B1.SUB_TRD_CD" ).append("\n"); 
		query.append("                                   ,B1.RLANE_CD" ).append("\n"); 
		query.append("                                   ,B1.BSE_YR" ).append("\n"); 
		query.append("                                   ,B1.BSE_MON" ).append("\n"); 
		query.append("                                   ,B1.BSE_WK" ).append("\n"); 
		query.append("                                   ,B1.SLS_YRMON" ).append("\n"); 
		query.append("                                   ,SUBSTR(B1.SLS_YRMON,0,4) AS SLS_YR" ).append("\n"); 
		query.append("                                   ,B1.VSL_CD || B1.SKD_VOY_NO || B1.DIR_CD AS VVD" ).append("\n"); 
		query.append("                                   ,B1.SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                   ,B1.FNL_BSA_CAPA" ).append("\n"); 
		query.append("                                   ,B1.LOD_QTY" ).append("\n"); 
		query.append("                                   ,B1.GRS_REV" ).append("\n"); 
		query.append("                                   ,B2.COST_YRMON AS MAS_COST_YRMON" ).append("\n"); 
		query.append("                                   ,SUBSTR(B2.COST_YRMON,0,4) AS MAS_COST_YR" ).append("\n"); 
		query.append("                                   ,SUBSTR(B2.YRMON, -2) AS MAS_MON" ).append("\n"); 
		query.append("                                   ,B2.COST_WK" ).append("\n"); 
		query.append("                                   ,B2.VSL_CD || B2.SKD_VOY_NO || B2.DIR_CD AS MAS_VVD" ).append("\n"); 
		query.append("                                   ,B2.FNL_HJS_BSA_CAPA" ).append("\n"); 
		query.append("                                   ,B1.TRD_CD || B1.SUB_TRD_CD || B1.RLANE_CD || B1.DIR_CD || B1.VSL_CD || B1.SKD_VOY_NO || B1.DIR_CD || B1.BSE_WK || B1.FNL_BSA_CAPA || B1.SLS_YRMON AS SQM_INFO" ).append("\n"); 
		query.append("                                   ,B2.TRD_CD || B2.SUB_TRD_CD || B2.RLANE_CD || B2.DIR_CD || B2.VSL_CD || B2.SKD_VOY_NO || B2.DIR_CD || B2.COST_WK || B2.FNL_HJS_BSA_CAPA || B2.COST_YRMON AS MAS_INFO" ).append("\n"); 
		query.append("                                   ,NVL(B1.QTA_RLSE_VER_NO, B2.QTA_RLSE_VER_NO)       AS O_QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                   ,NVL(B1.TRD_CD         , B2.TRD_CD)                AS O_TRD_CD" ).append("\n"); 
		query.append("                                   ,NVL(B1.RLANE_CD       , B2.RLANE_CD)              AS O_RLANE_CD" ).append("\n"); 
		query.append("                                   ,NVL(B1.SUB_TRD_CD     , B2.SUB_TRD_CD)            AS O_SUB_TRD_CD" ).append("\n"); 
		query.append("                                   ,NVL(B1.IOC_CD         , B2.IOC_CD)                AS O_IOC_CD" ).append("\n"); 
		query.append("                                   ,NVL(B1.DIR_CD         , B2.DIR_CD)                AS O_DIR_CD" ).append("\n"); 
		query.append("                                   ,NVL(B1.BSE_MON        , SUBSTR(B2.YRMON, -2))     AS O_BSE_MON" ).append("\n"); 
		query.append("                                   ,NVL(B1.BSE_WK         , B2.COST_WK)               AS O_BSE_WK" ).append("\n"); 
		query.append("                                   ,NVL(B1.VSL_CD || B1.SKD_VOY_NO || B1.DIR_CD, B2.VSL_CD || B2.SKD_VOY_NO || B2.DIR_CD) AS O_VVD" ).append("\n"); 
		query.append("                               FROM (" ).append("\n"); 
		query.append("                                      SELECT " ).append("\n"); 
		query.append("                                             V.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                            ,V.TRD_CD" ).append("\n"); 
		query.append("                                            ,V.DIR_CD" ).append("\n"); 
		query.append("                                            ,V.SUB_TRD_CD" ).append("\n"); 
		query.append("                                            ,V.RLANE_CD" ).append("\n"); 
		query.append("                                            ,V.BSE_YR" ).append("\n"); 
		query.append("                                            ,V.BSE_MON" ).append("\n"); 
		query.append("                                            ,V.BSE_WK" ).append("\n"); 
		query.append("                                            ,V.SLS_YRMON" ).append("\n"); 
		query.append("                                            ,V.VSL_CD" ).append("\n"); 
		query.append("                                            ,V.SKD_VOY_NO" ).append("\n"); 
		query.append("                                            ,V.FNL_BSA_CAPA" ).append("\n"); 
		query.append("                                            ,Q.LOD_QTY" ).append("\n"); 
		query.append("                                            ,Q.GRS_REV" ).append("\n"); 
		query.append("                                            ,V.IOC_CD" ).append("\n"); 
		query.append("                                            ,Q.SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                        FROM SQM_CFM_TGT_VVD V" ).append("\n"); 
		query.append("                                            ,(" ).append("\n"); 
		query.append("                                              SELECT QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                    ,TRD_CD" ).append("\n"); 
		query.append("                                                    ,RLANE_CD" ).append("\n"); 
		query.append("                                                    ,DIR_CD" ).append("\n"); 
		query.append("                                                    ,VSL_CD" ).append("\n"); 
		query.append("                                                    ,SKD_VOY_NO" ).append("\n"); 
		query.append("                                                    ,SKD_DIR_CD" ).append("\n"); 
		query.append("                                                    ,SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                                    ,SUM(LOD_QTY) AS LOD_QTY" ).append("\n"); 
		query.append("                                                    ,ROUND(SUM(LOD_QTY*GRS_RPB_REV)) AS GRS_REV" ).append("\n"); 
		query.append("                                                FROM SQM_CFM_QTA" ).append("\n"); 
		query.append("                                               WHERE 1=1" ).append("\n"); 
		query.append("                                                 AND QTA_RLSE_VER_NO = ( SELECT QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                                           FROM SQM_QTA_RLSE_VER" ).append("\n"); 
		query.append("                                                                          WHERE BSE_TP_CD      = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                                            AND BSE_YR         = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                                            AND BSE_QTR_CD     = @[f_bse_qtr_cd]" ).append("\n"); 
		query.append("                                                                            AND SQM_VER_STS_CD = 'R' )" ).append("\n"); 
		query.append("                                                 AND OFC_VW_CD       = 'L'" ).append("\n"); 
		query.append("        #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                                                 AND TRD_CD          = @[f_trd_cd]" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("        #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                                                 AND RLANE_CD        = @[f_rlane_cd]" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("        #if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')" ).append("\n"); 
		query.append("                                                 AND DIR_CD          = @[f_dir_cd]" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                                               GROUP BY QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                       ,TRD_CD" ).append("\n"); 
		query.append("                                                       ,RLANE_CD" ).append("\n"); 
		query.append("                                                       ,DIR_CD" ).append("\n"); 
		query.append("                                                       ,VSL_CD" ).append("\n"); 
		query.append("                                                       ,SKD_VOY_NO" ).append("\n"); 
		query.append("                                                       ,SKD_DIR_CD" ).append("\n"); 
		query.append("                                                       ,SQM_CNG_TP_CD" ).append("\n"); 
		query.append("                                             ) Q" ).append("\n"); 
		query.append("                                       WHERE 1=1" ).append("\n"); 
		query.append("                                         AND V.QTA_RLSE_VER_NO = Q.QTA_RLSE_VER_NO(+)" ).append("\n"); 
		query.append("                                         AND V.TRD_CD          = Q.TRD_CD(+)" ).append("\n"); 
		query.append("                                         AND V.RLANE_CD        = Q.RLANE_CD(+)" ).append("\n"); 
		query.append("                                         AND V.DIR_CD          = Q.DIR_CD(+)" ).append("\n"); 
		query.append("                                         AND V.VSL_CD          = Q.VSL_CD(+)" ).append("\n"); 
		query.append("                                         AND V.SKD_VOY_NO      = Q.SKD_VOY_NO(+)" ).append("\n"); 
		query.append("                                         AND V.SKD_DIR_CD      = Q.SKD_DIR_CD(+)" ).append("\n"); 
		query.append("                                         AND V.QTA_RLSE_VER_NO = SUBSTR(@[f_bse_yr],-2) ||@[f_bse_qtr_cd]||'02'" ).append("\n"); 
		query.append("                                         AND V.BSE_TP_CD       = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                         AND V.BSE_YR          = @[f_bse_yr]" ).append("\n"); 
		query.append("                                         AND V.BSE_QTR_CD      = @[f_bse_qtr_cd]" ).append("\n"); 
		query.append("        #if (${f_bse_wk} != '')" ).append("\n"); 
		query.append("                                         AND V.BSE_WK          = @[f_bse_wk]" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("        #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                                         AND V.TRD_CD          = @[f_trd_cd]" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("        #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                                         AND V.RLANE_CD        = @[f_rlane_cd]" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("        #if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')" ).append("\n"); 
		query.append("                                         AND V.DIR_CD          = @[f_dir_cd]" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("--                                         AND 1 = CASE WHEN V.BSE_YR || v.BSE_QTR_CD > '20142Q'" ).append("\n"); 
		query.append("--                                                           THEN (SELECT NVL((" ).append("\n"); 
		query.append("--                                                                            SELECT DISTINCT 0" ).append("\n"); 
		query.append("--                                                                              FROM SQM_SCTR_PAIR_MGMT S1" ).append("\n"); 
		query.append("--                                                                             WHERE 1=1" ).append("\n"); 
		query.append("--                                                                               AND S1.BSE_TP_CD  = V.BSE_TP_CD" ).append("\n"); 
		query.append("--                                                                               AND S1.BSE_YR     = V.BSE_YR" ).append("\n"); 
		query.append("--                                                                               AND S1.BSE_QTR_CD = V.BSE_QTR_CD" ).append("\n"); 
		query.append("--                                                                               AND S1.TRD_CD     = V.TRD_CD" ).append("\n"); 
		query.append("--                                                                               AND S1.RLANE_CD   = V.RLANE_CD" ).append("\n"); 
		query.append("--                                                                               AND S1.DIR_CD     = V.DIR_CD" ).append("\n"); 
		query.append("--                                                                            ),1)" ).append("\n"); 
		query.append("--                                                                FROM DUAL)" ).append("\n"); 
		query.append("--                                                      ELSE 1" ).append("\n"); 
		query.append("--                                                 END" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                    ) B1" ).append("\n"); 
		query.append("                                    FULL OUTER JOIN" ).append("\n"); 
		query.append("                                    (" ).append("\n"); 
		query.append("                                      SELECT " ).append("\n"); 
		query.append("                                             A3.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                            ,A1.TRD_CD" ).append("\n"); 
		query.append("                                            ,A1.SUB_TRD_CD" ).append("\n"); 
		query.append("                                            ,A1.RLANE_CD" ).append("\n"); 
		query.append("                                            ,A1.DIR_CD" ).append("\n"); 
		query.append("                                            ,A1.VSL_CD" ).append("\n"); 
		query.append("                                            ,A1.SKD_VOY_NO" ).append("\n"); 
		query.append("                                            ,A1.COST_YRMON" ).append("\n"); 
		query.append("                                            ,DECODE(A3.BSE_YR, '2014', A1.SLS_YRMON, A1.COST_YRMON) YRMON" ).append("\n"); 
		query.append("                                            ,A1.COST_WK" ).append("\n"); 
		query.append("                                            ,A1.IOC_CD" ).append("\n"); 
		query.append("                                            ,ROUND(NVL(A2.FNL_HJS_BSA_CAPA, 0)) AS FNL_HJS_BSA_CAPA" ).append("\n"); 
		query.append("                                        FROM MAS_MON_VVD       A1" ).append("\n"); 
		query.append("                                            ,BSA_VVD_MST       A2" ).append("\n"); 
		query.append("                                            ,(" ).append("\n"); 
		query.append("                                               SELECT DISTINCT" ).append("\n"); 
		query.append("                                                      S1.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                                     ,S2.BSE_TP_CD" ).append("\n"); 
		query.append("                                                     ,S2.BSE_YR" ).append("\n"); 
		query.append("                                                     ,S2.BSE_QTR_CD" ).append("\n"); 
		query.append("                                                     ,S2.TRD_CD" ).append("\n"); 
		query.append("                                                     ,S2.RLANE_CD" ).append("\n"); 
		query.append("                                                     ,S2.DIR_CD" ).append("\n"); 
		query.append("                                                 FROM SQM_QTA_RLSE_VER S1" ).append("\n"); 
		query.append("        #if (${f_cond_tp} == '1')" ).append("\n"); 
		query.append("                                                      -- 해당 분기의 LANE-OFFICE RELATION SETTING 한 노선의 정보를 걸어준다" ).append("\n"); 
		query.append("                                                      -- (2013년간 데이터를 제외한 모든 분기를 걸어주면됨 현재는 현재 분기와 미래 판매목표만 걸어주고 있음)" ).append("\n"); 
		query.append("                                                     ,SQM_QTA_LANE_OFC S2" ).append("\n"); 
		query.append("        #else" ).append("\n"); 
		query.append("                                                      -- 2013년도 데이터는  LANE-OFFICE RELATION SETTING 정보가 없기 때문에 TARGET VVD 정보를 걸어서 노선정보를 가져온다." ).append("\n"); 
		query.append("                                                     ,SQM_CFM_TGT_VVD S2" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                                                WHERE 1=1" ).append("\n"); 
		query.append("                                                  AND S1.BSE_TP_CD      = S2.BSE_TP_CD" ).append("\n"); 
		query.append("                                                  AND S1.BSE_YR         = S2.BSE_YR" ).append("\n"); 
		query.append("                                                  AND S1.BSE_QTR_CD     = S2.BSE_QTR_CD" ).append("\n"); 
		query.append("                                                  AND S1.SQM_VER_STS_CD = 'R'" ).append("\n"); 
		query.append("                                                  AND S2.BSE_TP_CD      = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                  AND S2.BSE_YR         = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                  AND S2.BSE_QTR_CD     = @[f_bse_qtr_cd]" ).append("\n"); 
		query.append("        #if (${f_cond_tp} == '1')" ).append("\n"); 
		query.append("                                                  AND S2.OFC_VW_CD      = 'L'" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("        #if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')" ).append("\n"); 
		query.append("                                                  AND S2.TRD_CD         = @[f_trd_cd]" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("        #if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')" ).append("\n"); 
		query.append("                                                  AND S2.RLANE_CD       = @[f_rlane_cd]" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("        #if (${f_trd_dir} != 'on' && ${f_dir_cd} != '' && ${f_dir_cd} != 'All')" ).append("\n"); 
		query.append("                                                  AND S2.DIR_CD         = @[f_dir_cd]" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("--                                                  AND 1 = CASE WHEN S2.BSE_YR || S2.BSE_QTR_CD > '20142Q'" ).append("\n"); 
		query.append("--                                                                    THEN (SELECT NVL((" ).append("\n"); 
		query.append("--                                                                                     SELECT 0" ).append("\n"); 
		query.append("--                                                                                       FROM SQM_SCTR_PAIR_MGMT X1" ).append("\n"); 
		query.append("--                                                                                      WHERE 1=1" ).append("\n"); 
		query.append("--                                                                                        AND X1.BSE_TP_CD  = S2.BSE_TP_CD" ).append("\n"); 
		query.append("--                                                                                        AND X1.BSE_YR     = S2.BSE_YR" ).append("\n"); 
		query.append("--                                                                                        AND X1.BSE_QTR_CD = S2.BSE_QTR_CD" ).append("\n"); 
		query.append("--                                                                                        AND X1.TRD_CD     = S2.TRD_CD" ).append("\n"); 
		query.append("--                                                                                        AND X1.RLANE_CD   = S2.RLANE_CD" ).append("\n"); 
		query.append("--                                                                                        AND X1.DIR_CD     = S2.DIR_CD" ).append("\n"); 
		query.append("--                                                                                     ),1)" ).append("\n"); 
		query.append("--                                                                         FROM DUAL)" ).append("\n"); 
		query.append("--                                                               ELSE 1" ).append("\n"); 
		query.append("--                                                          END" ).append("\n"); 
		query.append("                                              ) A3" ).append("\n"); 
		query.append("                                       WHERE A1.TRD_CD         = A2.TRD_CD     (+)" ).append("\n"); 
		query.append("                                         AND A1.RLANE_CD       = A2.RLANE_CD   (+)" ).append("\n"); 
		query.append("                                         AND A1.VSL_CD         = A2.VSL_CD     (+)" ).append("\n"); 
		query.append("                                         AND A1.SKD_VOY_NO     = A2.SKD_VOY_NO (+)" ).append("\n"); 
		query.append("                                         AND A1.DIR_CD         = A2.SKD_DIR_CD (+)" ).append("\n"); 
		query.append("                                         AND A1.IOC_CD         = A2.IOC_CD     (+)" ).append("\n"); 
		query.append("                                         AND A1.TRD_CD         = A3.TRD_CD" ).append("\n"); 
		query.append("                                         AND A1.RLANE_CD       = A3.RLANE_CD" ).append("\n"); 
		query.append("                                         AND A1.DIR_CD         = A3.DIR_CD" ).append("\n"); 
		query.append("        #if (${f_bse_wk} != '')" ).append("\n"); 
		query.append("                                         AND A1.COST_WK        = @[f_bse_wk]" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("                                         AND A1.DELT_FLG       = 'N'" ).append("\n"); 
		query.append("                                         AND A1.IOC_CD         = DECODE(A1.RLANE_CD, 'RBCCO', 'I', A1.IOC_CD) -- RBCCO 노선은 IOC_CD = 'I' 인것만" ).append("\n"); 
		query.append("                                         -- 2013년 : SLS_YRMON / 2014년 : Week / 2015년~ : COST_YRMON (COA 이행 데이터 기준이 다름)" ).append("\n"); 
		query.append("                                         AND CASE WHEN '2013' = A3.BSE_YR THEN A1.SLS_YRMON WHEN '2014' = A3.BSE_YR THEN SUBSTR(A1.SLS_YRMON, 1, 4)||A1.COST_WK ELSE A1.COST_YRMON END " ).append("\n"); 
		query.append("                                             BETWEEN CASE WHEN '2014' = A3.BSE_YR THEN @[f_bse_yr]||@[f_fm_wk] ELSE @[f_bse_yr]||DECODE(@[f_bse_qtr_cd],'1Q','01','2Q','04','3Q','07','4Q','10') END " ).append("\n"); 
		query.append("                                                 AND CASE WHEN '2014' = A3.BSE_YR THEN @[f_bse_yr]||@[f_to_wk] ELSE @[f_bse_yr]||DECODE(@[f_bse_qtr_cd],'1Q','03','2Q','06','3Q','09','4Q','12') END " ).append("\n"); 
		query.append("                                         AND NOT EXISTS ( SELECT 1" ).append("\n"); 
		query.append("                                                            FROM SQM_QTA_TGT_VVD S1" ).append("\n"); 
		query.append("                                                           WHERE S1.BSE_TP_CD  = @[f_bse_tp_cd]" ).append("\n"); 
		query.append("                                                             AND S1.BSE_YR     = @[f_bse_yr]" ).append("\n"); 
		query.append("                                                             AND S1.BSE_QTR_CD = @[f_bse_qtr_cd]" ).append("\n"); 
		query.append("                                                             AND S1.DELT_FLG   = 'Y'" ).append("\n"); 
		query.append("                                                             AND A1.TRD_CD     = S1.TRD_CD" ).append("\n"); 
		query.append("                                                             AND A1.RLANE_CD   = S1.RLANE_CD" ).append("\n"); 
		query.append("                                                             AND A1.VSL_CD     = S1.VSL_CD" ).append("\n"); 
		query.append("                                                             AND A1.SKD_VOY_NO = S1.SKD_VOY_NO" ).append("\n"); 
		query.append("                                                             AND A1.DIR_CD     = S1.DIR_CD" ).append("\n"); 
		query.append("                                                        )" ).append("\n"); 
		query.append("                                    ) B2" ).append("\n"); 
		query.append("                                 ON B1.QTA_RLSE_VER_NO = B2.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                                AND B1.TRD_CD          = B2.TRD_CD" ).append("\n"); 
		query.append("                                AND B1.SUB_TRD_CD      = B2.SUB_TRD_CD" ).append("\n"); 
		query.append("                                AND B1.DIR_CD          = B2.DIR_CD" ).append("\n"); 
		query.append("                                AND B1.RLANE_CD        = B2.RLANE_CD" ).append("\n"); 
		query.append("                                AND B1.IOC_CD          = B2.IOC_CD" ).append("\n"); 
		query.append("                                AND B1.VSL_CD          = B2.VSL_CD" ).append("\n"); 
		query.append("                                AND B1.SKD_VOY_NO      = B2.SKD_VOY_NO" ).append("\n"); 
		query.append("                          )" ).append("\n"); 
		query.append("                 GROUP BY O_QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                         ,O_TRD_CD" ).append("\n"); 
		query.append("                         ,O_RLANE_CD" ).append("\n"); 
		query.append("                         ,O_SUB_TRD_CD" ).append("\n"); 
		query.append("                         ,O_DIR_CD" ).append("\n"); 
		query.append("                         ,O_IOC_CD" ).append("\n"); 
		query.append("                         ,O_VVD" ).append("\n"); 
		query.append("                 )A2" ).append("\n"); 
		query.append("                 ,PORTION_ADJUST_RHQ_L RL" ).append("\n"); 
		query.append("                 ,PORTION_ADJUST_RHQ_O_C ROC" ).append("\n"); 
		query.append("                 ,PORTION_ADJUST_RHQ_N_C RNC" ).append("\n"); 
		query.append("        WHERE A1.TRD_CD         = A2.TRD_CD" ).append("\n"); 
		query.append("        AND A1.SUB_TRD_CD       = A2.SUB_TRD_CD" ).append("\n"); 
		query.append("        AND A1.RLANE_CD         = A2.RLANE_CD" ).append("\n"); 
		query.append("        AND A1.DIR_CD           = A2.DIR_CD" ).append("\n"); 
		query.append("        AND A1.IOC_CD           = A2.IOC_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        AND A1.TRD_CD           = RL.TRD_CD" ).append("\n"); 
		query.append("        AND A1.SUB_TRD_CD       = RL.SUB_TRD_CD" ).append("\n"); 
		query.append("        AND A1.RLANE_CD         = RL.RLANE_CD" ).append("\n"); 
		query.append("        AND A1.DIR_CD           = RL.DIR_CD" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        AND A1.TRD_CD           = ROC.TRD_CD" ).append("\n"); 
		query.append("        AND A1.SUB_TRD_CD       = ROC.SUB_TRD_CD" ).append("\n"); 
		query.append("        AND A1.RLANE_CD         = ROC.RLANE_CD" ).append("\n"); 
		query.append("        AND A1.DIR_CD           = ROC.DIR_CD" ).append("\n"); 
		query.append("        " ).append("\n"); 
		query.append("        AND A1.TRD_CD           = RNC.TRD_CD" ).append("\n"); 
		query.append("        AND A1.SUB_TRD_CD       = RNC.SUB_TRD_CD" ).append("\n"); 
		query.append("        AND A1.RLANE_CD         = RNC.RLANE_CD" ).append("\n"); 
		query.append("        AND A1.DIR_CD           = RNC.DIR_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        #if (${f_portion_link} != '' && ${f_portion_link} != 'All')" ).append("\n"); 
		query.append("        AND DECODE(SQM_CNG_TP_CD, 'I', 'Y', 'N') = @[f_portion_link]" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("        #if (${f_trd_dir} == 'on' && ${f_hul_bnd_cd} != '' && ${f_hul_bnd_cd} != 'All')" ).append("\n"); 
		query.append("        AND A1.HUL_BND_CD               		 = @[f_hul_bnd_cd]" ).append("\n"); 
		query.append("        #end" ).append("\n"); 
		query.append("        ORDER BY A2.TRD_CD" ).append("\n"); 
		query.append("                ,A2.RLANE_CD" ).append("\n"); 
		query.append("                ,A2.DIR_CD" ).append("\n"); 
		query.append("                ,NVL(SLS_YR,NVL(MAS_COST_YR, BSE_YR))" ).append("\n"); 
		query.append("                ,NVL(MAS_BSE_MON, BSE_MON)" ).append("\n"); 
		query.append("                ,NVL(MAS_BSE_WK, BSE_WK)" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("WHERE COMPARISON_WITH_RHQ_L LIKE 'DIFFERENT%'" ).append("\n"); 
		query.append(" OR COMPARISON_WITH_RHQ_O_C LIKE 'DIFFERENT%'" ).append("\n"); 
		query.append(" OR COMPARISON_WITH_RHQ_N_C LIKE 'DIFFERENT%'" ).append("\n"); 

	}
}