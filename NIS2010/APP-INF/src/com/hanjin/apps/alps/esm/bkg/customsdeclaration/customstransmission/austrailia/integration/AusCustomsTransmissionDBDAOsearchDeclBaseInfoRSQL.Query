<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AusCustomsTransmissionDBDAOsearchDeclBaseInfoRSQL">
			<desc><![CDATA[호주 위험물 FLATFILE 전송 시 기본 정보를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT 
 '89N'  DOC_CD
,  'IFTDGN' || @[vvd_cd] || @[port_cd] || @[d_type]|| LTRIM(TO_CHAR(BKG_CSTM_EDI_SEQ.NEXTVAL,'0000009')) DOC_NO
,'' MSG_FUNC
,TO_CHAR(GLOBALDATE_PKG.TIME_CONV_OFC_FNC('SELSC', SYSDATE, @[ofc_cd]),'YYYYMMHH24MI') MSG_DATE 
,A.DG_DECL_TP_CD  HANDLING
,(	SELECT	MAX(MSG_SND_NO)
	FROM BKG_CSTMS_DG_SND
	WHERE CNT_CD = 'AU'
	AND	  DG_DECL_TP_CD = @[d_type]
	AND   VSL_CD      = SUBSTR(@[vvd_cd], 1, 4)
	AND   SKD_VOY_NO  = SUBSTR(@[vvd_cd], 5, 4)
	AND   SKD_DIR_CD  = SUBSTR(@[vvd_cd], 9, 1)
	AND   PORT_CD     = @[port_cd]
) REF_NO

,'20' TRANS_STAGE
,((A.SKD_VOY_NO) || (A.SKD_DIR_CD))AS VOYAGE_NO
,'1' TRANS_MODE
,C.LLOYD_NO IMO_NO
,C.VSL_ENG_NM VESSEL_NM
   
,'MS' PARTY_TYPE
,F.CRR_NM CARRIER_NM
,'' DEPT_EMPLOY
,'' COM_NO
,'EM' COM_CH
,NVL((
	SELECT DECODE (MSG_SND_NO, NULL, 'O', 'U') 
	FROM BKG_CSTMS_DG_SND 
	WHERE DG_DECL_TP_CD = @[d_type]
	AND   VSL_CD      = SUBSTR(@[vvd_cd], 1, 4)
	AND   SKD_VOY_NO  = SUBSTR(@[vvd_cd], 5, 4)
	AND   SKD_DIR_CD  = SUBSTR(@[vvd_cd], 9, 1)
	AND   PORT_CD     = @[port_cd]
	AND   CNT_CD        = 'AU' 
	AND	  ROWNUM = 1 ),'O') SEND_TYPE

FROM 
     BKG_CSTMS_DG A
    ,BKG_DG_CGO B
    ,BKG_CSTMS_DG_VSL_SKD C
    ,MDM_VSL_CNTR D
    ,MDM_CARRIER F
	

WHERE A.DG_DECL_TP_CD = @[d_type]
AND   A.VSL_CD      = SUBSTR(@[vvd_cd], 1, 4)
AND   A.SKD_VOY_NO  = SUBSTR(@[vvd_cd], 5, 4)
AND   A.SKD_DIR_CD  = SUBSTR(@[vvd_cd], 9, 1)
AND   A.PORT_CD     = @[port_cd]
AND	A.CNTR_NO        = B.CNTR_NO
AND A.VSL_CD        = C.VSL_CD
AND A.SKD_VOY_NO    = C.SKD_VOY_NO
AND A.SKD_DIR_CD    = C.SKD_DIR_CD
AND A.PORT_CD       = C.PORT_CD
AND A.DG_DECL_TP_CD = C.DG_DECL_TP_CD
AND A.CNT_CD        = C.CNT_CD
AND C.VSL_ENG_NM    = D.VSL_ENG_NM 
AND D.CRR_CD        = F.CRR_CD
AND A.CNT_CD        = 'AU'
AND   ROWNUM        = 1			]]></sql>
			<params>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="port_cd" type="12" value="" out="N"/>
				<param name="d_type" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
