<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="DailyForecastManageDBDAOSpcDlyFcastCustCSQL">
			<desc><![CDATA[SPC_DLY_FCAST_CUST의 지정된 ibflag 값에 따라 DB에 반영한다.(추가)
CHOI.Y.S - [프로젝트] Ticket ID : CHM-201004171 - 53FT 관련 필드 추가
2011.01.03 최윤성 [CHM-201008093-01] Office Level Table 생성
 - SPC_ORGANIZATION_V 대신 SPC_OFC_LVL 로 대체]]></desc>
			<sql><![CDATA[
INSERT INTO SPC_DLY_FCAST_CUST (
    RLANE_CD           ,
    DIR_CD             ,
    VSL_CD             ,
    SKD_VOY_NO         ,
    SKD_DIR_CD         ,
    IOC_TS_CD          ,
    SREP_USR_ID        ,
    CUST_CNT_CD        ,
    CUST_SEQ           ,
    POL_YD_CD          ,
    POD_YD_CD          ,
    FCAST_OFC_CD       ,
    FCAST_CUST_TP_CD   ,
    IOC_CD             ,
    REP_TRD_CD         ,
    REP_SUB_TRD_CD     ,
    TRD_CD             ,
    SUB_TRD_CD         ,
    SLS_RHQ_CD         ,
    SLS_AQ_CD          ,
    SLS_RGN_OFC_CD     ,
    SLS_OFC_CD         ,
    FCAST_TTL_QTY      ,
    FCAST_40FT_HC_QTY  ,
    FCAST_45FT_HC_QTY  ,
    FCAST_53FT_QTY     ,
    FCAST_RF_QTY       ,
    FCAST_TTL_WGT      ,
    CFM_TTL_QTY        ,
    CFM_40FT_HC_QTY    ,
    CFM_45FT_HC_QTY    ,
    CFM_53FT_QTY       ,
    CFM_RF_QTY         ,
    CFM_TTL_WGT        ,
    USD_BKG_TTL_QTY    ,
    USD_BKG_20FT_QTY   ,
    USD_BKG_40FT_QTY   ,
    USD_BKG_40FT_HC_QTY,
    USD_BKG_45FT_HC_QTY,
    USD_BKG_53FT_QTY   ,
    USD_BKG_RF_QTY     ,
    USD_BKG_TTL_WGT    ,
    CTRL_LVL_CD        ,
    MODI_GDT           ,
    CFM_USR_ID         ,
    CFM_DT             ,
    CRE_USR_ID         ,
    CRE_DT             ,
    UPD_USR_ID         ,
    UPD_DT
)
WITH PARAMS AS (
    SELECT @[trd_cd]      AS TRD_CD     ,
           @[sub_trd_cd]  AS SUB_TRD_CD ,
           @[rlane_cd]    AS RLANE_CD   ,
           @[dir_cd]      AS DIR_CD     ,
           @[vsl_cd]      AS VSL_CD     ,
           @[skd_voy_no]  AS SKD_VOY_NO ,
           @[skd_dir_cd]  AS SKD_DIR_CD ,
           @[ioc_ts_cd]   AS IOC_TS_CD  ,
           @[srep_usr_id] AS SREP_USR_ID,
           NVL(@[cust_cnt_cd], '00')    AS CUST_CNT_CD ,
           NVL(@[cust_seq], 0)          AS CUST_SEQ    ,
           NVL(@[pol_yd_cd], '0000000') AS POL_CD      ,
           NVL(@[pod_yd_cd], '0000000') AS POD_CD      ,
           @[fcast_ofc_cd]              AS FCAST_OFC_CD,
           NVL(@[fcast_cust_tp_cd], '0')     AS FCAST_CUST_TP_CD   ,
           TO_NUMBER(@[fcast_ttl_qty])       AS FCAST_TTL_QTY      ,
           TO_NUMBER(@[fcast_40ft_hc_qty])   AS FCAST_40FT_HC_QTY  ,
           TO_NUMBER(@[fcast_45ft_hc_qty])   AS FCAST_45FT_HC_QTY  ,
           TO_NUMBER(@[fcast_53ft_qty])      AS FCAST_53FT_QTY     ,
           TO_NUMBER(@[fcast_rf_qty])        AS FCAST_RF_QTY       ,
           TO_NUMBER(@[fcast_ttl_wgt])       AS FCAST_TTL_WGT      ,
           TO_NUMBER(@[cfm_ttl_qty])         AS CFM_TTL_QTY        ,
           TO_NUMBER(@[cfm_40ft_hc_qty])     AS CFM_40FT_HC_QTY    ,
           TO_NUMBER(@[cfm_45ft_hc_qty])     AS CFM_45FT_HC_QTY    ,
           TO_NUMBER(@[cfm_53ft_qty])        AS CFM_53FT_QTY       ,
           TO_NUMBER(@[cfm_rf_qty])          AS CFM_RF_QTY         ,
           TO_NUMBER(@[cfm_ttl_wgt])         AS CFM_TTL_WGT        ,
           TO_NUMBER(@[usd_bkg_ttl_qty])     AS USD_BKG_TTL_QTY    ,
           TO_NUMBER(@[usd_bkg_20ft_qty])    AS USD_BKG_20FT_QTY   ,
           TO_NUMBER(@[usd_bkg_40ft_qty])    AS USD_BKG_40FT_QTY   ,
           TO_NUMBER(@[usd_bkg_40ft_hc_qty]) AS USD_BKG_40FT_HC_QTY,
           TO_NUMBER(@[usd_bkg_45ft_hc_qty]) AS USD_BKG_45FT_HC_QTY,
           TO_NUMBER(@[usd_bkg_53ft_qty])    AS USD_BKG_53FT_QTY   ,
           TO_NUMBER(@[usd_bkg_rf_qty])      AS USD_BKG_RF_QTY     ,
           TO_NUMBER(@[usd_bkg_ttl_wgt])     AS USD_BKG_TTL_WGT    ,
           @[ctrl_lvl_cd] AS CTRL_LVL_CD,
           @[cfm_dt]      AS CMF_FLG    ,
           @[upd_usr_id]  AS USR_ID     ,
           @[modi_gdt]    AS MODI_DT
      FROM DUAL
)
  SELECT P.RLANE_CD        ,
         P.DIR_CD          ,
         P.VSL_CD          ,
         P.SKD_VOY_NO      ,
         P.SKD_DIR_CD      ,
         P.IOC_TS_CD       ,
         P.SREP_USR_ID     ,
         P.CUST_CNT_CD     ,
         P.CUST_SEQ        ,
         P.POL_CD          ,
         P.POD_CD          ,
         P.FCAST_OFC_CD    ,
         P.FCAST_CUST_TP_CD,
         DECODE(P.IOC_TS_CD, 'O', 'O', 'I') AS IOC_CD,
         RL.REP_TRD_CD,
         (
            SELECT RDRL.SUB_TRD_CD
              FROM MDM_DTL_REV_LANE RDRL
             WHERE RDRL.RLANE_CD        = RL.RLANE_CD
               AND RDRL.TRD_CD          = RL.REP_TRD_CD
               AND RDRL.VSL_SLAN_DIR_CD = P.DIR_CD
               AND ROWNUM = 1
         ) AS REP_SUB_TRD_CD,
         P.TRD_CD,
         P.SUB_TRD_CD,
         O.N2ND_PRNT_OFC_CD AS SLS_RHQ_CD    ,
         O.N3RD_PRNT_OFC_CD AS SLS_AQ_CD     ,
         O.N4TH_PRNT_OFC_CD AS SLS_RGN_OFC_CD,
         O.SPC_SLS_OFC_CD   AS SLS_OFC_CD    ,
         P.FCAST_TTL_QTY    ,
         P.FCAST_40FT_HC_QTY,
         P.FCAST_45FT_HC_QTY,
         P.FCAST_53FT_QTY   ,
         P.FCAST_RF_QTY     ,
         P.FCAST_TTL_WGT    ,
         DECODE(P.CMF_FLG, 'C', P.CFM_TTL_QTY    , DECODE(P.POD_CD, '0000000', P.CFM_TTL_QTY))     AS CFM_TTL_QTY   ,
         DECODE(P.CMF_FLG, 'C', P.CFM_40FT_HC_QTY, DECODE(P.POD_CD, '0000000', P.CFM_40FT_HC_QTY)) AS CFM_40FT_HC_QTY,
         DECODE(P.CMF_FLG, 'C', P.CFM_45FT_HC_QTY, DECODE(P.POD_CD, '0000000', P.CFM_45FT_HC_QTY)) AS CFM_45FT_HC_QTY,
         DECODE(P.CMF_FLG, 'C', P.CFM_53FT_QTY   , DECODE(P.POD_CD, '0000000', P.CFM_53FT_QTY))    AS CFM_53FT_QTY   ,
         DECODE(P.CMF_FLG, 'C', P.CFM_RF_QTY     , DECODE(P.POD_CD, '0000000', P.CFM_RF_QTY))      AS CFM_RF_QTY     ,
         DECODE(P.CMF_FLG, 'C', P.CFM_TTL_WGT    , DECODE(P.POD_CD, '0000000', P.CFM_TTL_WGT))     AS CFM_TTL_WGT    ,
         P.USD_BKG_TTL_QTY    ,
         P.USD_BKG_20FT_QTY   ,
         P.USD_BKG_40FT_QTY   ,
         P.USD_BKG_40FT_HC_QTY,
         P.USD_BKG_45FT_HC_QTY,
         P.USD_BKG_53FT_QTY   ,
         P.USD_BKG_RF_QTY     ,
         P.USD_BKG_TTL_WGT    ,
         P.CTRL_LVL_CD        ,
         CAST(SYS_EXTRACT_UTC(TO_TIMESTAMP(MODI_DT, 'YYYY/MM/DD HH24:MI:SS')) AS DATE) AS MODI_GDT,
         DECODE(P.CMF_FLG, 'C', P.USR_ID) AS CFM_USR_ID,
         DECODE(P.CMF_FLG, 'C', SYSDATE)  AS CFM_DT    ,
         P.USR_ID AS CRE_USR_ID,
         SYSDATE  AS CRE_DT    ,
         P.USR_ID AS UPD_USR_ID,
         SYSDATE  AS UPD_DT
    FROM SPC_OFC_LVL  O ,
         MDM_SLS_REP  SR,
         MDM_REV_LANE RL,
         PARAMS       P ,
         MAS_MON_VVD  C
   WHERE O.OFC_CD     = SR.OFC_CD
     AND SR.SREP_CD   = P.SREP_USR_ID
     AND RL.DELT_FLG  = 'N'
     AND RL.RLANE_CD  = P.RLANE_CD
     AND C.TRD_CD     = P.TRD_CD
     AND C.RLANE_CD   = P.RLANE_CD
     AND C.IOC_CD     = DECODE(P.IOC_TS_CD, 'O', 'O', 'I')
     AND C.VSL_CD     = P.VSL_CD
     AND C.SKD_VOY_NO = P.SKD_VOY_NO
     AND C.DIR_CD     = P.SKD_DIR_CD
     AND SUBSTR(C.SLS_YRMON, 1, 4) || C.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK			]]></sql>
			<params>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="sub_trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="ioc_ts_cd" type="12" value="" out="N"/>
				<param name="srep_usr_id" type="12" value="" out="N"/>
				<param name="cust_cnt_cd" type="12" value="" out="N"/>
				<param name="cust_seq" type="12" value="" out="N"/>
				<param name="pol_yd_cd" type="12" value="" out="N"/>
				<param name="pod_yd_cd" type="12" value="" out="N"/>
				<param name="fcast_ofc_cd" type="12" value="" out="N"/>
				<param name="fcast_cust_tp_cd" type="12" value="" out="N"/>
				<param name="fcast_ttl_qty" type="12" value="" out="N"/>
				<param name="fcast_40ft_hc_qty" type="12" value="" out="N"/>
				<param name="fcast_45ft_hc_qty" type="12" value="" out="N"/>
				<param name="fcast_53ft_qty" type="12" value="" out="N"/>
				<param name="fcast_rf_qty" type="12" value="" out="N"/>
				<param name="fcast_ttl_wgt" type="12" value="" out="N"/>
				<param name="cfm_ttl_qty" type="12" value="" out="N"/>
				<param name="cfm_40ft_hc_qty" type="12" value="" out="N"/>
				<param name="cfm_45ft_hc_qty" type="12" value="" out="N"/>
				<param name="cfm_53ft_qty" type="12" value="" out="N"/>
				<param name="cfm_rf_qty" type="12" value="" out="N"/>
				<param name="cfm_ttl_wgt" type="12" value="" out="N"/>
				<param name="usd_bkg_ttl_qty" type="12" value="" out="N"/>
				<param name="usd_bkg_20ft_qty" type="12" value="" out="N"/>
				<param name="usd_bkg_40ft_qty" type="12" value="" out="N"/>
				<param name="usd_bkg_40ft_hc_qty" type="12" value="" out="N"/>
				<param name="usd_bkg_45ft_hc_qty" type="12" value="" out="N"/>
				<param name="usd_bkg_53ft_qty" type="12" value="" out="N"/>
				<param name="usd_bkg_rf_qty" type="12" value="" out="N"/>
				<param name="usd_bkg_ttl_wgt" type="12" value="" out="N"/>
				<param name="ctrl_lvl_cd" type="12" value="" out="N"/>
				<param name="cfm_dt" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="modi_gdt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
