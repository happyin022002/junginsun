<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCRateProposalDBDAORsltRateTpRSQL">
			<desc><![CDATA[Rate - Customer Type 재조회]]></desc>
			<sql><![CDATA[
SELECT A.INTG_CD_VAL_CTNT AS CD
      ,A.INTG_CD_VAL_DP_DESC NM
      ,NVL(C.ACPT_CNT, 0) + NVL(C.NOT_ACPT_CNT, 0) AS RATE_CNT
      ,NVL(C.AMDT_CNT, 0) AS AMDT_CNT
      ,NVL(ACPT_CNT, 0) AS ACPT_CNT
      ,NVL(NOT_ACPT_CNT, 0) AS NOT_ACPT_CNT
      ,CASE
         WHEN C.AMDT_CNT > 0 THEN
          'Y'
         ELSE
          'N'
       END AS AMDT_FLG
      ,DECODE(NOT_ACPT_CNT, 0, 'Y', 'N') AS ACPT_FLG
  FROM NISADM.COM_INTG_CD_DTL A
      ,(SELECT GEN_SPCL_RT_TP_CD
              ,SUM(DECODE(N1ST_CMNC_AMDT_SEQ, @[n1st_cmnc_amdt_seq], 1, 0)) AS AMDT_CNT
              ,SUM(DECODE(PRC_PROG_STS_CD, 'A', 1, 0)) AS ACPT_CNT
              ,SUM(DECODE(PRC_PROG_STS_CD, 'A', 0, 1)) AS NOT_ACPT_CNT
          FROM (SELECT PROP_NO, AMDT_SEQ, SVC_SCP_CD, GEN_SPCL_RT_TP_CD, N1ST_CMNC_AMDT_SEQ, PRC_PROG_STS_CD
                  FROM PRI_SP_SCP_RT_CMDT
                      ,(SELECT LGCY_IF_FLG FROM PRI_SP_MN WHERE PROP_NO = @[prop_no] AND AMDT_SEQ = @[amdt_seq] AND ROWNUM = 1) M
                 WHERE PROP_NO = @[prop_no]
                   AND AMDT_SEQ = @[amdt_seq]
                   AND SVC_SCP_CD = @[svc_scp_cd]
                   AND SRC_INFO_CD <> DECODE(M.LGCY_IF_FLG, 'Y', 'AD', 'X')
                UNION ALL
                SELECT PROP_NO, AMDT_SEQ, SVC_SCP_CD, GEN_SPCL_RT_TP_CD, N1ST_CMNC_AMDT_SEQ, PRC_PROG_STS_CD
                  FROM PRI_SP_SCP_RT_ACT_CUST
                      ,(SELECT LGCY_IF_FLG FROM PRI_SP_MN WHERE PROP_NO = @[prop_no] AND AMDT_SEQ = @[amdt_seq] AND ROWNUM = 1) M
                 WHERE PROP_NO = @[prop_no]
                   AND AMDT_SEQ = @[amdt_seq]
                   AND SVC_SCP_CD = @[svc_scp_cd]
                   AND SRC_INFO_CD <> DECODE(M.LGCY_IF_FLG, 'Y', 'AD', 'X')
                UNION ALL
                SELECT PROP_NO, AMDT_SEQ, SVC_SCP_CD, GEN_SPCL_RT_TP_CD, N1ST_CMNC_AMDT_SEQ, PRC_PROG_STS_CD
                  FROM PRI_SP_SCP_RT_CNOTE
                      ,(SELECT LGCY_IF_FLG FROM PRI_SP_MN WHERE PROP_NO = @[prop_no] AND AMDT_SEQ = @[amdt_seq] AND ROWNUM = 1) M
                 WHERE PROP_NO = @[prop_no]
                   AND AMDT_SEQ = @[amdt_seq]
                   AND SVC_SCP_CD = @[svc_scp_cd]
                   AND SRC_INFO_CD <> DECODE(M.LGCY_IF_FLG, 'Y', 'AD', 'X')
                UNION ALL
                SELECT PROP_NO, AMDT_SEQ, SVC_SCP_CD, GEN_SPCL_RT_TP_CD, N1ST_CMNC_AMDT_SEQ, PRC_PROG_STS_CD
                  FROM PRI_SP_SCP_RT_ROUT_PNT
                      ,(SELECT LGCY_IF_FLG FROM PRI_SP_MN WHERE PROP_NO = @[prop_no] AND AMDT_SEQ = @[amdt_seq] AND ROWNUM = 1) M
                 WHERE PROP_NO = @[prop_no]
                   AND AMDT_SEQ = @[amdt_seq]
                   AND SVC_SCP_CD = @[svc_scp_cd]
                   AND SRC_INFO_CD <> DECODE(M.LGCY_IF_FLG, 'Y', 'AD', 'X')
                UNION ALL
                SELECT PROP_NO, AMDT_SEQ, SVC_SCP_CD, GEN_SPCL_RT_TP_CD, N1ST_CMNC_AMDT_SEQ, PRC_PROG_STS_CD
                  FROM PRI_SP_SCP_RT_ROUT_VIA
                      ,(SELECT LGCY_IF_FLG FROM PRI_SP_MN WHERE PROP_NO = @[prop_no] AND AMDT_SEQ = @[amdt_seq] AND ROWNUM = 1) M
                 WHERE PROP_NO = @[prop_no]
                   AND AMDT_SEQ = @[amdt_seq]
                   AND SVC_SCP_CD = @[svc_scp_cd]
                   AND SRC_INFO_CD <> DECODE(M.LGCY_IF_FLG, 'Y', 'AD', 'X')
                UNION ALL
                SELECT PROP_NO, AMDT_SEQ, SVC_SCP_CD, GEN_SPCL_RT_TP_CD, N1ST_CMNC_AMDT_SEQ, PRC_PROG_STS_CD
                  FROM PRI_SP_SCP_RT_ROUT_DIR
                      ,(SELECT LGCY_IF_FLG FROM PRI_SP_MN WHERE PROP_NO = @[prop_no] AND AMDT_SEQ = @[amdt_seq] AND ROWNUM = 1) M
                 WHERE PROP_NO = @[prop_no]
                   AND AMDT_SEQ = @[amdt_seq]
                   AND SVC_SCP_CD = @[svc_scp_cd]
                   AND SRC_INFO_CD <> DECODE(M.LGCY_IF_FLG, 'Y', 'AD', 'X')
                UNION ALL
                SELECT PROP_NO, AMDT_SEQ, SVC_SCP_CD, GEN_SPCL_RT_TP_CD, N1ST_CMNC_AMDT_SEQ, PRC_PROG_STS_CD
                  FROM PRI_SP_SCP_RT_CMDT_RNOTE
                      ,(SELECT LGCY_IF_FLG FROM PRI_SP_MN WHERE PROP_NO = @[prop_no] AND AMDT_SEQ = @[amdt_seq] AND ROWNUM = 1) M
                 WHERE PROP_NO = @[prop_no]
                   AND AMDT_SEQ = @[amdt_seq]
                   AND SVC_SCP_CD = @[svc_scp_cd]
                   AND SRC_INFO_CD <> DECODE(M.LGCY_IF_FLG, 'Y', 'AD', 'X')
                UNION ALL
                SELECT PROP_NO, AMDT_SEQ, SVC_SCP_CD, GEN_SPCL_RT_TP_CD, N1ST_CMNC_AMDT_SEQ, PRC_PROG_STS_CD
                  FROM PRI_SP_SCP_RT
                      ,(SELECT LGCY_IF_FLG FROM PRI_SP_MN WHERE PROP_NO = @[prop_no] AND AMDT_SEQ = @[amdt_seq] AND ROWNUM = 1) M
                 WHERE PROP_NO = @[prop_no]
                   AND AMDT_SEQ = @[amdt_seq]
                   AND SVC_SCP_CD = @[svc_scp_cd]
                   AND SRC_INFO_CD <> DECODE(M.LGCY_IF_FLG, 'Y', 'AD', 'X'))
         GROUP BY PROP_NO, AMDT_SEQ, SVC_SCP_CD, GEN_SPCL_RT_TP_CD) C
 WHERE A.INTG_CD_VAL_CTNT = C.GEN_SPCL_RT_TP_CD(+)
   AND A.INTG_CD_ID = 'CD01705' AND A.INTG_CD_VAL_CTNT IN ('G','S') 
 ORDER BY A.INTG_CD_VAL_DP_SEQ			]]></sql>
			<params>
				<param name="n1st_cmnc_amdt_seq" type="12" value="" out="N"/>
				<param name="prop_no" type="12" value="TES090001" out="N"/>
				<param name="amdt_seq" type="2" value="1" out="N"/>
				<param name="svc_scp_cd" type="12" value="ACE" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
