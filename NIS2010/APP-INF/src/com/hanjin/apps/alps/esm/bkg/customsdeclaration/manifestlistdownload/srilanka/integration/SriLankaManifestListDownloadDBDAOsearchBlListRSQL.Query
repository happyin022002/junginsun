<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SriLankaManifestListDownloadDBDAOsearchBlListRSQL">
			<desc><![CDATA[스리랑카세관 신고용 B/L List 를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT * FROM 
	  (SELECT '' AS SEQ,
       BL_NO,
       POL_CD,
       POD_CD, 
       DEL_CD,
       PCK_QTY,
       PCK_TP_CD,
       ACT_WGT,
       WGT_UT_CD,
       MEAS_QTY,
       MEAS_UT_CD,
       BKG_NO,
	   VVD_POL,
	   VVD_POD,
       COUNT(DISTINCT BL_NO) OVER() AS BL_TOTAL

  FROM
       (SELECT NVL(B.BL_NO, ' ')||NVL(B.BL_TP_CD, ' ') AS BL_NO,
               NVL(B.POL_CD, ' ') AS POL_CD,
               NVL(B.POD_CD, ' ') AS POD_CD,
               NVL(B.DEL_CD, ' ') AS DEL_CD,
               TO_CHAR(NVL(C.PCK_QTY, 0), 'FM00000000') AS PCK_QTY,
               NVL(C.PCK_TP_CD, ' ') AS PCK_TP_CD,
               TO_CHAR(NVL(C.ACT_WGT, 0), 'FM00000000.000') AS ACT_WGT,
               NVL(C.WGT_UT_CD, ' ') AS WGT_UT_CD,
               TO_CHAR(NVL(C.MEAS_QTY, 0), 'FM00000000.000') AS MEAS_QTY,
               NVL(C.MEAS_UT_CD, ' ') AS MEAS_UT_CD,
               NVL(B.BKG_NO, ' ') AS BKG_NO,
			   NVL(A.POL_CD, ' ') AS VVD_POL,
               NVL(A.POD_CD, ' ') AS VVD_POD

          FROM BKG_VVD A,
               BKG_BOOKING B,
               BKG_BL_DOC C

         WHERE A.VSL_CD = @[vsl_cd]
           AND A.SKD_VOY_NO = @[skd_voy_no]
           AND A.SKD_DIR_CD = @[skd_dir_cd]
           AND A.BKG_NO = B.BKG_NO

#if (${pol_cd} == '')
		
           AND A.POD_CD LIKE @[pod_cd]||'%'
           AND B.DEL_CD LIKE @[del_cd]||'%'
		#if (${ts_tp_cd} == 'T')
           AND A.POD_CD <> B.POD_CD
		#elseif (${ts_tp_cd} == 'L')
           AND A.POD_CD = B.POD_CD
		#end


#else
		   AND A.POL_CD LIKE @[pol_cd]||'%'
           AND B.DEL_CD LIKE @[del_cd]||'%'
		   	#if (${ts_tp_cd} == 'T')

           AND A.POL_CD <> B.POL_CD
		#elseif (${ts_tp_cd} == 'L')
           AND A.POL_CD = B.POL_CD
		#end

#end
           AND B.BL_NO > ' '
           AND B.BKG_STS_CD NOT IN ('X', 'S')
#if (${cgo_tp_cd} == 'M')
           AND B.BKG_CGO_TP_CD = 'P'
#else
           AND B.BKG_CGO_TP_CD <> 'P'
#end
           AND A.BKG_NO = C.BKG_NO

 GROUP BY NVL(B.BL_NO, ' ')||NVL(B.BL_TP_CD, ' '),
          NVL(B.POL_CD, ' '),
          NVL(B.POD_CD, ' '),
          NVL(B.DEL_CD, ' ') ,
          TO_CHAR(NVL(C.PCK_QTY, 0), 'FM00000000'),
          NVL(C.PCK_TP_CD, ' '),
          TO_CHAR(NVL(C.ACT_WGT, 0), 'FM00000000.000'), NVL(C.WGT_UT_CD, ' '),
          TO_CHAR(NVL(C.MEAS_QTY, 0), 'FM00000000.000'), NVL(C.MEAS_UT_CD, ' '),
          NVL(B.BKG_NO, ' '),
          NVL(A.POL_CD, ' ') ,
          NVL(A.POD_CD, ' ') 


 ORDER BY NVL(B.BL_NO, ' ')||NVL(B.BL_TP_CD, ' '),
          NVL(B.POL_CD, ' '),
          NVL(B.POD_CD, ' '),
          NVL(B.DEL_CD, ' '))	
) WHERE VVD_POL LIKE 'LK%' OR VVD_POD LIKE 'LK%'			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
