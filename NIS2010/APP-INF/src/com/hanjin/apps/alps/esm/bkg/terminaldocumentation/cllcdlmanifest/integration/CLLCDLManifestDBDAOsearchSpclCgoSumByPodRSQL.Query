<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CLLCDLManifestDBDAOsearchSpclCgoSumByPodRSQL">
			<desc><![CDATA[searchSpclCgoSumByPod]]></desc>
			<sql><![CDATA[
SELECT DG.POD_CD2
, BQ.BLCK_STWG_CD AS GUBUN_CD
, DECODE(SUM(D_LO_40),0,'',SUM(D_LO_40)) D_LO_40
, DECODE(SUM(D_LO_20),0,'',SUM(D_LO_20)) D_LO_20
, DECODE(SUM(D_LO_40H),0,'',SUM(D_LO_40H)) D_LO_40H
, DECODE(SUM(R_LO_40),0,'',SUM(R_LO_40)) R_LO_40
, DECODE(SUM(R_LO_20),0,'',SUM(R_LO_20)) R_LO_20
, DECODE(SUM(R_LO_40H),0,'',SUM(R_LO_40H)) R_LO_40H
, DECODE(SUM(F_LO_40),0,'',SUM(F_LO_40)) F_LO_40
, DECODE(SUM(F_LO_20),0,'',SUM(F_LO_20)) F_LO_20
, DECODE(SUM(F_LO_40H),0,'',SUM(F_LO_40H)) F_LO_40H
, DECODE(SUM(O_LO_40),0,'',SUM(O_LO_40)) O_LO_40
, DECODE(SUM(O_LO_20),0,'',SUM(O_LO_20)) O_LO_20
, DECODE(SUM(O_LO_40H),0,'',SUM(O_LO_40H)) O_LO_40H
, DECODE(SUM(O_LO_45),0,'',SUM(O_LO_45)) O_LO_45

, DECODE(SUM(D_TS_40),0,'',SUM(D_TS_40)) D_TS_40
, DECODE(SUM(D_TS_20),0,'',SUM(D_TS_20)) D_TS_20
, DECODE(SUM(D_TS_40H),0,'',SUM(D_TS_40H)) D_TS_40H
, DECODE(SUM(R_TS_40),0,'',SUM(R_TS_40)) R_TS_40
, DECODE(SUM(R_TS_20),0,'',SUM(R_TS_20)) R_TS_20
, DECODE(SUM(R_TS_40H),0,'',SUM(R_TS_40H)) R_TS_40H
, DECODE(SUM(F_TS_40),0,'',SUM(F_TS_40)) F_TS_40
, DECODE(SUM(F_TS_20),0,'',SUM(F_TS_20)) F_TS_20
, DECODE(SUM(F_TS_40H),0,'',SUM(F_TS_40H)) F_TS_40H
, DECODE(SUM(O_TS_40),0,'',SUM(O_TS_40)) O_TS_40
, DECODE(SUM(O_TS_20),0,'',SUM(O_TS_20)) O_TS_20
, DECODE(SUM(O_TS_40H),0,'',SUM(O_TS_40H)) O_TS_40H
, DECODE(SUM(O_TS_45),0,'',SUM(O_TS_45)) O_TS_45

, DECODE(SUM(NVL(D_LO_40,0)+NVL(D_TS_40,0)),0,'',SUM(NVL(D_LO_40,0)+NVL(D_TS_40,0))) D_LO_TS_40
, DECODE(SUM(NVL(D_LO_20,0)+NVL(D_TS_20,0)),0,'',SUM(NVL(D_LO_20,0)+NVL(D_TS_20,0))) D_LO_TS_20
, DECODE(SUM(NVL(D_LO_40H,0)+NVL(D_TS_40H,0)),0,'',SUM(NVL(D_LO_40H,0)+NVL(D_TS_40H,0))) D_LO_TS_40H
, DECODE(SUM(NVL(R_LO_40,0)+NVL(R_TS_40,0)),0,'',SUM(NVL(R_LO_40,0)+NVL(R_TS_40,0))) R_LO_TS_40
, DECODE(SUM(NVL(R_LO_20,0)+NVL(R_TS_20,0)),0,'',SUM(NVL(R_LO_20,0)+NVL(R_TS_20,0))) R_LO_TS_20
, DECODE(SUM(NVL(R_LO_40H,0)+NVL(R_TS_40H,0)),0,'',SUM(NVL(R_LO_40H,0)+NVL(R_TS_40H,0))) R_LO_TS_40H
, DECODE(SUM(NVL(F_LO_40,0)+NVL(F_TS_40,0)),0,'',SUM(NVL(F_LO_40,0)+NVL(F_TS_40,0))) F_LO_TS_40
, DECODE(SUM(NVL(F_LO_20,0)+NVL(F_TS_20,0)),0,'',SUM(NVL(F_LO_20,0)+NVL(F_TS_20,0))) F_LO_TS_20
, DECODE(SUM(NVL(F_LO_40H,0)+NVL(F_TS_40H,0)),0,'',SUM(NVL(F_LO_40H,0)+NVL(F_TS_40H,0))) F_LO_TS_40H
, DECODE(SUM(NVL(O_LO_40,0)+NVL(O_TS_40,0)),0,'',SUM(NVL(O_LO_40,0)+NVL(O_TS_40,0))) O_LO_TS_40
, DECODE(SUM(NVL(O_LO_20,0)+NVL(O_TS_20,0)),0,'',SUM(NVL(O_LO_20,0)+NVL(O_TS_20,0))) O_LO_TS_20
, DECODE(SUM(NVL(O_LO_40H,0)+NVL(O_TS_40H,0)),0,'',SUM(NVL(O_LO_40H,0)+NVL(O_TS_40H,0))) O_LO_TS_40H
, DECODE(SUM(NVL(O_LO_45,0)+NVL(O_TS_45,0)),0,'',SUM(NVL(O_LO_45,0)+NVL(O_TS_45,0))) O_LO_TS_45
FROM
	(SELECT NVL(LO.UN_LOC_CD,BV.POD_CD) POD_CD2
        , BK.BLCK_STWG_CD AS BLCK_STWG_CD
		, BK.BKG_NO BKG_NO
        
        , MAX(DECODE(BV.POL_CD,BK.POL_CD, DECODE(SUBSTR(BQ.CNTR_TPSZ_CD,2,1),'2',DECODE(BQ.DCGO_FLG,'Y',BQ.OP_CNTR_QTY,0),0),0))       D_LO_20
        , MAX(DECODE(BV.POL_CD,BK.POL_CD, DECODE(SUBSTR(BQ.CNTR_TPSZ_CD,2,1),'2',0,'5',0,DECODE(BQ.DCGO_FLG,'Y',BQ.OP_CNTR_QTY,0)),0)) D_LO_40
        , MAX(DECODE(BV.POL_CD,BK.POL_CD, DECODE(SUBSTR(BQ.CNTR_TPSZ_CD,2,1),'5',DECODE(BQ.DCGO_FLG,'Y',BQ.OP_CNTR_QTY,0),0),0))       D_LO_40H
        
        , MAX(DECODE(BV.POL_CD,BK.POL_CD, 0,DECODE(SUBSTR(BQ.CNTR_TPSZ_CD,2,1),'2',DECODE(BQ.DCGO_FLG,'Y',BQ.OP_CNTR_QTY,0),0)))       D_TS_20
        , MAX(DECODE(BV.POL_CD,BK.POL_CD, 0,DECODE(SUBSTR(BQ.CNTR_TPSZ_CD,2,1),'2',0,'5',0,DECODE(BQ.DCGO_FLG,'Y',BQ.OP_CNTR_QTY,0)))) D_TS_40
        , MAX(DECODE(BV.POL_CD,BK.POL_CD, 0,DECODE(SUBSTR(BQ.CNTR_TPSZ_CD,2,1),'5',DECODE(BQ.DCGO_FLG,'Y',BQ.OP_CNTR_QTY,0),0)))       D_TS_40H
        
		, MAX(VPS.CLPT_SEQ) CLPT_SEQ
	FROM BKG_BOOKING BK
		, BKG_VVD BV
		, VSK_VSL_PORT_SKD VPS
		, BKG_DG_CGO DG
		, MDM_LOCATION LO
		, BKG_QTY_DTL BQ
	WHERE BK.BKG_NO = BV.BKG_NO
	  AND BV.VSL_CD = VPS.VSL_CD
	  AND BV.SKD_VOY_NO = VPS.SKD_VOY_NO
	  AND BV.SKD_DIR_CD = VPS.SKD_DIR_CD
	  AND BV.POD_CD = VPS.VPS_PORT_CD
	  AND VPS.VPS_PORT_CD = LO.LOC_CD
	  AND BK.BKG_NO = DG.BKG_NO(+)
	  AND BV.VSL_CD = SUBSTR(@[in_vvd_cd],1,4)
	  AND BV.SKD_VOY_NO = SUBSTR(@[in_vvd_cd],5,4)
	  AND BV.SKD_DIR_CD = SUBSTR(@[in_vvd_cd],9,1)
	  AND BV.POL_CD=@[in_pol_cd]
#if (${in_pol_yd_cd} != '')
      AND BV.POL_YD_CD = @[in_pol_cd]||@[in_pol_yd_cd]
#end
	  AND BK.BKG_STS_CD IN ( 'F','W')
	  AND BK.BKG_OFC_CD LIKE @[in_bkg_ofc_cd]||'%'
	  AND VPS.CLPT_IND_SEQ='1'
	  AND NVL(BK.SPLIT_RSN_CD,' ') <> 'M'
	  AND BK.BKG_NO = BQ.BKG_NO
	GROUP BY NVL(LO.UN_LOC_CD,BV.POD_CD),BK.BLCK_STWG_CD, BK.BKG_NO) DG, 

	(SELECT NVL(LO.UN_LOC_CD,BV.POD_CD) POD_CD2
        , BK.BLCK_STWG_CD AS BLCK_STWG_CD
		, BK.BKG_NO BKG_NO

        , MAX(DECODE(BV.POL_CD,BK.POL_CD, DECODE(BQ.CNTR_TPSZ_CD,'R2',DECODE(BQ.RC_FLG,'Y',BQ.OP_CNTR_QTY,0),0),0))        R_LO_20
        , MAX(DECODE(BV.POL_CD,BK.POL_CD, DECODE(BQ.CNTR_TPSZ_CD,'R4',DECODE(BQ.RC_FLG,'Y',BQ.OP_CNTR_QTY,0),0),0))        R_LO_40
        , MAX(DECODE(BV.POL_CD,BK.POL_CD, DECODE(BQ.CNTR_TPSZ_CD,'R5',DECODE(BQ.RC_FLG,'Y',BQ.OP_CNTR_QTY,0),'R8',DECODE(BQ.RC_FLG,'Y',BQ.OP_CNTR_QTY,0),'R9',DECODE(BQ.RC_FLG,'Y',BQ.OP_CNTR_QTY,0),0),0))        R_LO_40H
        
        , MAX(DECODE(BV.POL_CD,BK.POL_CD, 0,DECODE(BQ.CNTR_TPSZ_CD,'R2',DECODE(BQ.RC_FLG,'Y',BQ.OP_CNTR_QTY,0),0)))        R_TS_20
        , MAX(DECODE(BV.POL_CD,BK.POL_CD, 0,DECODE(BQ.CNTR_TPSZ_CD,'R4',DECODE(BQ.RC_FLG,'Y',BQ.OP_CNTR_QTY,0),0)))        R_TS_40
        , MAX(DECODE(BV.POL_CD,BK.POL_CD, 0,DECODE(BQ.CNTR_TPSZ_CD,'R5',DECODE(BQ.RC_FLG,'Y',BQ.OP_CNTR_QTY,0),'R8',DECODE(BQ.RC_FLG,'Y',BQ.OP_CNTR_QTY,0),'R9',DECODE(BQ.RC_FLG,'Y',BQ.OP_CNTR_QTY,0),0)))        R_TS_40H
        
	FROM BKG_BOOKING BK
		, BKG_VVD BV
		, VSK_VSL_PORT_SKD VPS
		, BKG_RF_CGO RF
		, MDM_LOCATION LO
		, BKG_QTY_DTL BQ
	WHERE BK.BKG_NO = BV.BKG_NO
	  AND BV.VSL_CD = VPS.VSL_CD
	  AND BV.SKD_VOY_NO = VPS.SKD_VOY_NO
	  AND BV.SKD_DIR_CD = VPS.SKD_DIR_CD
	  AND BV.POD_CD = VPS.VPS_PORT_CD
	  AND VPS.VPS_PORT_CD = LO.LOC_CD
	  AND BK.BKG_NO = RF.BKG_NO(+)
	  AND BV.VSL_CD = SUBSTR(@[in_vvd_cd],1,4)
	  AND BV.SKD_VOY_NO = SUBSTR(@[in_vvd_cd],5,4)
	  AND BV.SKD_DIR_CD = SUBSTR(@[in_vvd_cd],9,1)
	  AND BV.POL_CD=@[in_pol_cd]
#if (${in_pol_yd_cd} != '')
      AND BV.POL_YD_CD = @[in_pol_cd]||@[in_pol_yd_cd]
#end
	  AND BK.BKG_STS_CD IN ( 'F','W')
	  AND BK.BKG_OFC_CD LIKE @[in_bkg_ofc_cd]||'%'
	  AND VPS.CLPT_IND_SEQ='1'
	  AND NVL(BK.SPLIT_RSN_CD,' ') <> 'M'
	  AND BK.BKG_NO = BQ.BKG_NO
	GROUP BY NVL(LO.UN_LOC_CD,BV.POD_CD),BK.BLCK_STWG_CD, BK.BKG_NO 
	) RF,

	(SELECT NVL(LO.UN_LOC_CD,BV.POD_CD) POD_CD2
        , BK.BLCK_STWG_CD AS BLCK_STWG_CD
		, BK.BKG_NO BKG_NO

		, SUM(DECODE(BV.POL_CD,BK.POL_CD, DECODE(BQ.CNTR_TPSZ_CD,'F2',BQ.OP_CNTR_QTY,'P2',BQ.OP_CNTR_QTY,'A2',BQ.OP_CNTR_QTY,0),0)) F_LO_20
		, SUM(DECODE(BV.POL_CD,BK.POL_CD, DECODE(BQ.CNTR_TPSZ_CD,'F4',BQ.OP_CNTR_QTY,'P4',BQ.OP_CNTR_QTY,'A4',BQ.OP_CNTR_QTY,0),0)) F_LO_40
		, SUM(DECODE(BV.POL_CD,BK.POL_CD, DECODE(BQ.CNTR_TPSZ_CD,'F5',BQ.OP_CNTR_QTY,0),0)) F_LO_40H

		, SUM(DECODE(BV.POL_CD,BK.POL_CD, DECODE(BQ.CNTR_TPSZ_CD,'O2',BQ.OP_CNTR_QTY,'S2',BQ.OP_CNTR_QTY,0),0)) O_LO_20
		, SUM(DECODE(BV.POL_CD,BK.POL_CD, DECODE(BQ.CNTR_TPSZ_CD,'O4',BQ.OP_CNTR_QTY,'S4',BQ.OP_CNTR_QTY,0),0)) O_LO_40
		, SUM(DECODE(BV.POL_CD,BK.POL_CD, DECODE(BQ.CNTR_TPSZ_CD,'O5',BQ.OP_CNTR_QTY,0),0)) O_LO_40H
		, SUM(DECODE(BV.POL_CD,BK.POL_CD, DECODE(BQ.CNTR_TPSZ_CD,'O7',BQ.OP_CNTR_QTY,0),0)) O_LO_45

		, SUM(DECODE(BV.POL_CD,BK.POL_CD, 0, DECODE(BQ.CNTR_TPSZ_CD,'F2',BQ.OP_CNTR_QTY,'P2',BQ.OP_CNTR_QTY,'A2',BQ.OP_CNTR_QTY,0))) F_TS_20
		, SUM(DECODE(BV.POL_CD,BK.POL_CD, 0, DECODE(BQ.CNTR_TPSZ_CD,'F4',BQ.OP_CNTR_QTY,'P4',BQ.OP_CNTR_QTY,'A4',BQ.OP_CNTR_QTY,0))) F_TS_40
		, SUM(DECODE(BV.POL_CD,BK.POL_CD, 0, DECODE(BQ.CNTR_TPSZ_CD,'F5',BQ.OP_CNTR_QTY,0))) F_TS_40H

		, SUM(DECODE(BV.POL_CD,BK.POL_CD, 0, DECODE(BQ.CNTR_TPSZ_CD,'O2',BQ.OP_CNTR_QTY,'S2',BQ.OP_CNTR_QTY,0))) O_TS_20
		, SUM(DECODE(BV.POL_CD,BK.POL_CD, 0, DECODE(BQ.CNTR_TPSZ_CD,'O4',BQ.OP_CNTR_QTY,'S4',BQ.OP_CNTR_QTY,0))) O_TS_40
		, SUM(DECODE(BV.POL_CD,BK.POL_CD, 0, DECODE(BQ.CNTR_TPSZ_CD,'O5',BQ.OP_CNTR_QTY,0))) O_TS_40H
		, SUM(DECODE(BV.POL_CD,BK.POL_CD, 0, DECODE(BQ.CNTR_TPSZ_CD,'O7',BQ.OP_CNTR_QTY,0))) O_TS_45
	FROM BKG_BOOKING BK
		, BKG_VVD BV
		, VSK_VSL_PORT_SKD VPS
		, BKG_QUANTITY BQ
		, MDM_LOCATION LO
	WHERE BK.BKG_NO = BV.BKG_NO
	  AND BV.VSL_CD = VPS.VSL_CD
	  AND BV.SKD_VOY_NO = VPS.SKD_VOY_NO
	  AND BV.SKD_DIR_CD = VPS.SKD_DIR_CD
	  AND BV.POD_CD = VPS.VPS_PORT_CD
	  AND BK.BKG_NO = BQ.BKG_NO
	  AND VPS.VPS_PORT_CD = LO.LOC_CD
	  AND BV.VSL_CD = SUBSTR(@[in_vvd_cd],1,4)
	  AND BV.SKD_VOY_NO = SUBSTR(@[in_vvd_cd],5,4)
	  AND BV.SKD_DIR_CD = SUBSTR(@[in_vvd_cd],9,1)
	  AND BV.POL_CD=@[in_pol_cd]
#if (${in_pol_yd_cd} != '')
      AND BV.POL_YD_CD = @[in_pol_cd]||@[in_pol_yd_cd]
#end
	  AND BK.BKG_STS_CD IN ( 'F','W')
	  AND BK.BKG_OFC_CD LIKE @[in_bkg_ofc_cd]||'%'
	  AND VPS.CLPT_IND_SEQ='1'
	  AND NVL(BK.SPLIT_RSN_CD,' ') <> 'M'
	GROUP BY NVL(LO.UN_LOC_CD,BV.POD_CD)  ,BK.BLCK_STWG_CD, BK.BKG_NO) BQ

WHERE DG. BKG_NO = RF.BKG_NO
AND DG. BKG_NO = BQ.BKG_NO
GROUP BY DG.POD_CD2,BQ.BLCK_STWG_CD, CLPT_SEQ
ORDER BY CLPT_SEQ			]]></sql>
			<params>
				<param name="in_vvd_cd" type="12" value="" out="N"/>
				<param name="in_pol_cd" type="12" value="" out="N"/>
				<param name="in_pol_yd_cd" type="12" value="" out="N"/>
				<param name="in_bkg_ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
