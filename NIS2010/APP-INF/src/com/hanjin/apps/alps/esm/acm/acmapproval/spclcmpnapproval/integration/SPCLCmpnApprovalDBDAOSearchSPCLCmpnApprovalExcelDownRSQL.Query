<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SPCLCmpnApprovalDBDAOSearchSPCLCmpnApprovalExcelDownRSQL">
			<desc><![CDATA[SearchSPCLCmpnApprovalExcelDown]]></desc>
			<sql><![CDATA[
SELECT 		
		   A.CUST_CNT_CD||TO_CHAR(A.CUST_SEQ,'FM000000') AS CUST_CNT_SEQ,
           TO_CHAR(A.VNDR_SEQ,'FM000000') AS VNDR_SEQ,		
           B.CUST_LGL_ENG_NM AS CUST_LGL_ENG_NM,		
           A.CSR_NO,		
           '' BKG_NO,		
           '' BL_NO,		
           COUNT(*) AS TOT_CNT,		
		   ROUND(SUM(A.IF_AMT), 2) AS NET_AMT,
		   ROUND(SUM(A.IF_AMT * NVL(A.INV_TAX_RT, 0) / 100), 2) AS VAT,
		   ROUND(SUM(A.IF_AMT + (A.IF_AMT * NVL(A.INV_TAX_RT, 0) / 100)), 2) AS TOT_AMT,
           A.AP_OFC_CD,		
           TO_CHAR(A.IF_DT,'YYYYMMDD') AS IF_DT,		
           DECODE(D.IF_FLG,'Y','Success',D.IF_ERR_RSN) AS IF_RSN,		
           DECODE(D.RCV_ERR_FLG,'Y','Success',D.RCV_ERR_RSN) AS RCV_RSN,		
           D.IF_FLG AS IF_FLG,		
           D.RCV_ERR_FLG AS RCV_FLG,		
           D.PAY_AMT,		
           D.PAY_DT,		
           D.FTU_USE_CTNT1,		
           D.PAY_MZD_LU_CD		
      FROM ACM_SPCL_CMPN A,		
           MDM_CUSTOMER B,		
           ACM_AGN_BKG_INFO C,		
           AP_INV_HDR D		
     WHERE A.CUST_CNT_CD = B.CUST_CNT_CD		
       AND A.CUST_SEQ = B.CUST_SEQ		
       AND A.BKG_NO = C.BKG_NO		
       AND A.CRE_USR_ID != 'COST'		
       AND A.AP_OFC_CD IS NOT NULL		
       AND C.BL_NO IS NOT NULL		
       AND A.CSR_NO = D.CSR_NO(+)		
       AND A.AR_OFC_CD = @[ar_ofc_cd]     		
#if(${date_div} == 'C')		
       AND A.CRE_DT		
    BETWEEN TO_DATE(REPLACE(@[date_fm],'-', ''),'YYYYMMDD')		
       AND TO_DATE(REPLACE(@[date_to],'-', ''),'YYYYMMDD')+0.99999		
#elseif(${date_div} == 'E')		
       AND A.VSL_DEP_DT		
    BETWEEN TO_DATE(REPLACE(@[date_fm],'-', ''),'YYYYMMDD')		
       AND TO_DATE(REPLACE(@[date_to],'-', ''),'YYYYMMDD')+0.99999		
#elseif(${date_div} == 'I')		
       AND A.IF_DT		
    BETWEEN TO_DATE(REPLACE(@[date_fm],'-', ''),'YYYYMMDD')		
       AND TO_DATE(REPLACE(@[date_to],'-', ''),'YYYYMMDD')+0.99999		
#end		
#if(${if_opt} == 'NI')		
       AND A.SPCL_CMPN_STS_CD <> 'IF'		
#elseif(${if_opt} == 'IF')		
       AND A.SPCL_CMPN_STS_CD = 'IF'		
#elseif(${if_opt} == 'PR')		
       AND A.SPCL_CMPN_STS_CD = 'PR'		
#end		
#if(${cust_cnt_seq} != '')		
       AND A.CUST_CNT_CD = substr(@[cust_cnt_seq], 0, 2)		
       AND A.CUST_SEQ    = substr(@[cust_cnt_seq], 3, 6)		
#end		
#if(${bl_no} != '')		
       AND C.BL_NO		
        IN		
         ( $bl_no		
         )		
#end		
  GROUP BY 		
		   A.CUST_CNT_CD||TO_CHAR(A.CUST_SEQ,'FM000000'),
           TO_CHAR(A.VNDR_SEQ,'FM000000'), 		
           B.CUST_LGL_ENG_NM, A.CSR_NO, A.AP_OFC_CD, 		
           TO_CHAR(A.IF_DT,'YYYYMMDD'),		
           DECODE(D.IF_FLG,'Y','Success',D.IF_ERR_RSN),		
           DECODE(D.RCV_ERR_FLG,'Y','Success',D.RCV_ERR_RSN),		
           D.IF_FLG, D.RCV_ERR_FLG,		
           D.PAY_AMT, D.PAY_DT, D.FTU_USE_CTNT1, D.PAY_MZD_LU_CD		
 UNION ALL		
    SELECT 		
		   A.CUST_CNT_CD||TO_CHAR(A.CUST_SEQ,'FM000000') AS CUST_CNT_SEQ,
           TO_CHAR(A.VNDR_SEQ,'FM000000') AS VNDR_SEQ,		
           B.CUST_LGL_ENG_NM AS CUST_LGL_ENG_NM,		
           A.CSR_NO AS CSR_NO,		
           A.BKG_NO,		
           C.BL_NO,		
           COUNT(*) AS TOT_CNT,		
		   ROUND(SUM(A.IF_AMT), 2) AS NET_AMT,
		   ROUND(SUM(A.IF_AMT * NVL(A.INV_TAX_RT, 0) / 100), 2) AS VAT,
		   ROUND(SUM(A.IF_AMT + (A.IF_AMT * NVL(A.INV_TAX_RT, 0) / 100)), 2) AS TOT_AMT,
           '' AS AP_OFC_CD,		
           NULL AS IF_DT,		
           '' AS IF_RSN,		
           '' AS RCV_RSN,		
           '' AS IF_FLG,		
           '' AS RCV_FLG,		
           NULL AS PAY_AMT,		
           NULL AS PAY_DT,		
           '' AS FTU_USE_CTNT1,		
           '' AS PAY_MZD_LU_CD		
      FROM ACM_SPCL_CMPN A, 		
           MDM_CUSTOMER B,		
           ACM_AGN_BKG_INFO C,		
           AP_INV_HDR D		
     WHERE A.CUST_CNT_CD = B.CUST_CNT_CD		
       AND A.CUST_SEQ = B.CUST_SEQ		
       AND A.BKG_NO = C.BKG_NO		
       AND A.CRE_USR_ID != 'COST'		
       AND A.AP_OFC_CD IS NOT NULL		
       AND C.BL_NO IS NOT NULL		
       AND A.CSR_NO = D.CSR_NO(+)		
       AND A.AR_OFC_CD = @[ar_ofc_cd]     		
#if(${date_div} == 'C')		
       AND A.CRE_DT		
    BETWEEN TO_DATE(REPLACE(@[date_fm],'-', ''),'YYYYMMDD')		
       AND TO_DATE(REPLACE(@[date_to],'-', ''),'YYYYMMDD')+0.99999		
#elseif(${date_div} == 'E')		
       AND A.VSL_DEP_DT		
    BETWEEN TO_DATE(REPLACE(@[date_fm],'-', ''),'YYYYMMDD')		
       AND TO_DATE(REPLACE(@[date_to],'-', ''),'YYYYMMDD')+0.99999		
#elseif(${date_div} == 'I')		
       AND A.IF_DT		
    BETWEEN TO_DATE(REPLACE(@[date_fm],'-', ''),'YYYYMMDD')		
       AND TO_DATE(REPLACE(@[date_to],'-', ''),'YYYYMMDD')+0.99999		
#end		
#if(${if_opt} == 'NI')		
       AND A.SPCL_CMPN_STS_CD <> 'IF'		
#elseif(${if_opt} == 'IF')		
       AND A.SPCL_CMPN_STS_CD = 'IF'		
#elseif(${if_opt} == 'PR')		
       AND A.SPCL_CMPN_STS_CD = 'PR'		
#end		
#if(${cust_cnt_seq} != '')		
       AND A.CUST_CNT_CD = substr(@[cust_cnt_seq], 0, 2)		
       AND A.CUST_SEQ    = substr(@[cust_cnt_seq], 3, 6)		
#end		
#if(${bl_no} != '')		
       AND C.BL_NO		
        IN		
         ( $bl_no		
         )		
#end		
  GROUP BY 		
		   A.CUST_CNT_CD||TO_CHAR(A.CUST_SEQ,'FM000000'),
           TO_CHAR(A.VNDR_SEQ,'FM000000'),		
           B.CUST_LGL_ENG_NM, A.CSR_NO, A.BKG_NO, C.BL_NO		
  ORDER BY CUST_CNT_SEQ, CSR_NO, BKG_NO DESC, TOT_CNT DESC			]]></sql>
			<params>
				<param name="ar_ofc_cd" type="12" value="" out="N"/>
				<param name="date_fm" type="12" value="" out="N"/>
				<param name="date_to" type="12" value="" out="N"/>
				<param name="cust_cnt_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
