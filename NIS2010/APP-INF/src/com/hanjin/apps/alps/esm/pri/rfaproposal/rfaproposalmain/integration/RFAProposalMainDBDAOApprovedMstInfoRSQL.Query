<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RFAProposalMainDBDAOApprovedMstInfoRSQL">
			<desc><![CDATA[Basic RFA Amend 시 승인된 Max Amdt Seq Master RFA 정보를 조회한다.]]></desc>
			<sql><![CDATA[
WITH INPUT_PARAMS AS (
    SELECT MN.PROP_NO
         , MAX(MN.AMDT_SEQ) AMDT_SEQ
    FROM PRI_RP_MN MN
       , PRI_RP_HDR HDR
    WHERE 1=1
    AND   MN.RFA_CTRT_TP_CD = 'M'
    AND   HDR.RFA_NO = @[mst_rfa_no]
    AND   HDR.PROP_NO = MN.PROP_NO
    AND PROP_STS_CD = 'A'
    GROUP BY MN.PROP_NO
)
SELECT MN.PROP_NO
      ,MN.AMDT_SEQ
      ,DUR.SVC_SCP_CD
      ,TO_CHAR(MN.EFF_DT, 'YYYYMMDD') EFF_DT
      ,TO_CHAR(DUR.CTRT_EXP_DT, 'YYYYMMDD') EXP_DT
FROM   PRI_RP_MN MN
      ,PRI_RP_SCP_DUR DUR
      ,INPUT_PARAMS INP
WHERE  MN.PROP_NO = INP.PROP_NO
AND    MN.AMDT_SEQ = INP.AMDT_SEQ
AND    DUR.PROP_NO = MN.PROP_NO 
AND    DUR.AMDT_SEQ = MN.AMDT_SEQ			]]></sql>
			<params>
				<param name="mst_rfa_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
