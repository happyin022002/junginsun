<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PerformanceReportDBDAOModifyQueueDetailList3USQL">
			<desc><![CDATA[2011.03 김기종 [CHM-201109394-01] DPCS고도화일환으로 START TIME 관리]]></desc>
			<sql><![CDATA[
UPDATE BKG_SR_CRNT_RQST R SET 
#if (${com_flg} == 'start' || ${com_flg} == 'end')
#if (${com_flg} == 'start')
	SR_WRK_STS_CD	= 'W' 
	,DPCS_DOC_FM_DT = GLOBALDATE_PKG.TIME_CONV_FNC('KRPUS',SYSDATE,GLOBALDATE_PKG.GET_LOCCD_FNC('PKGSA'))
	
#elseif (${com_flg} == 'end')
	--,DPCS_DOC_FM_DT = NULL
	#if (${pnd_flg} == 'P' || ${pnd_flg} == 'Y' )
	SR_WRK_STS_CD	= '' 
   ,PND_FLG = 'N'
   ,PND_USR_ID = @[usr_id]
   ,PND_END_DT = GLOBALDATE_PKG.TIME_CONV_FNC('KRPUS',SYSDATE,GLOBALDATE_PKG.GET_LOCCD_FNC('PKGSA'))
   ,PND_HRS = (SELECT SUM(SR_PROC_HRS) FROM BKG_SR_HIS H WHERE H.SR_KND_CD=R.SR_KND_CD AND H.SR_NO = R.SR_NO AND H.BKG_NO = R.BKG_NO AND H.SR_STS_CD = 'PN')
	#else
	SR_WRK_STS_CD	= DECODE(SR_WRK_STS_CD,'W','',SR_WRK_STS_CD) 
	#end
#end
	,SR_WRK_STS_USR_ID = @[usr_id]
#else
	SR_WRK_STS_USR_ID = @[usr_id]
	#if (${pnd_flg} == 'P' || ${pnd_flg} == 'Y' )
   ,PND_FLG = 'N'
   ,PND_USR_ID = @[usr_id]
   ,PND_END_DT = GLOBALDATE_PKG.TIME_CONV_FNC('KRPUS',SYSDATE,GLOBALDATE_PKG.GET_LOCCD_FNC('PKGSA'))
   ,PND_HRS = (SELECT SUM(SR_PROC_HRS) FROM BKG_SR_HIS H WHERE H.SR_KND_CD=R.SR_KND_CD AND H.SR_NO = R.SR_NO AND H.BKG_NO = R.BKG_NO AND H.SR_STS_CD = 'PN')
	#if (${com_flg} == 'pnx')
   ,SR_WRK_STS_CD = DECODE(BL_RT_FLG||BL_AUD_FLG||BL_DRFT_FAX_OUT_FLG||BL_DOC_INP_FLG,'YYYY','Y','W')
	#end
   #end
	,DPCS_DOC_FM_DT = GLOBALDATE_PKG.TIME_CONV_FNC('KRPUS',SYSDATE,GLOBALDATE_PKG.GET_LOCCD_FNC('PKGSA'))
	
#if (${com_flg} == 'inp')
	,BL_DOC_INP_FLG = 'Y'
   ,BL_DOC_INP_USR_ID = @[usr_id]
   ,BL_DOC_INP_ST_DT =	DPCS_DOC_FM_DT
   ,BL_DOC_INP_DT = GLOBALDATE_PKG.TIME_CONV_FNC('KRPUS',SYSDATE,GLOBALDATE_PKG.GET_LOCCD_FNC('PKGSA'))
   ,SR_WRK_STS_CD  = DECODE(BL_RT_FLG||BL_AUD_FLG||BL_DRFT_FAX_OUT_FLG,'YYY','Y','W')	
   ,BL_DOC_INP_HRS =  (SELECT SUM(SR_PROC_HRS) FROM BKG_SR_HIS H WHERE H.SR_KND_CD=R.SR_KND_CD AND H.SR_NO = R.SR_NO AND H.BKG_NO = R.BKG_NO AND H.SR_STS_CD = 'ID')
#elseif (${com_flg} == 'rt')
	,BL_RT_FLG = 'Y'
   ,BL_RT_USR_ID = @[usr_id]
   ,BL_RT_ST_DT =	DPCS_DOC_FM_DT
   ,BL_RT_DT = GLOBALDATE_PKG.TIME_CONV_FNC('KRPUS',SYSDATE,GLOBALDATE_PKG.GET_LOCCD_FNC('PKGSA'))
   ,SR_WRK_STS_CD  = DECODE(BL_DOC_INP_FLG||BL_AUD_FLG||BL_DRFT_FAX_OUT_FLG,'YYY','Y','W')		
   ,BL_RT_HRS =  (SELECT SUM(SR_PROC_HRS) FROM BKG_SR_HIS H WHERE H.SR_KND_CD=R.SR_KND_CD AND H.SR_NO = R.SR_NO AND H.BKG_NO = R.BKG_NO AND H.SR_STS_CD = 'RD')	
#elseif (${com_flg} == 'qa')
   ,BL_AUD_FLG = 'Y'
   ,BL_AUD_USR_ID = @[usr_id]
   ,BL_AUD_ST_DT = DPCS_DOC_FM_DT
   ,BL_AUD_DT = GLOBALDATE_PKG.TIME_CONV_FNC('KRPUS',SYSDATE,GLOBALDATE_PKG.GET_LOCCD_FNC('PKGSA'))
   ,SR_WRK_STS_CD  = DECODE(BL_DOC_INP_FLG||BL_RT_FLG||BL_DRFT_FAX_OUT_FLG,'YYY','Y','W')
   ,BL_AUD_HRS =  (SELECT SUM(SR_PROC_HRS) FROM BKG_SR_HIS H WHERE H.SR_KND_CD=R.SR_KND_CD AND H.SR_NO = R.SR_NO AND H.BKG_NO = R.BKG_NO AND H.SR_STS_CD = 'AD')				
#elseif (${com_flg} == 'fax')
 	,BL_DRFT_FAX_OUT_FLG = 'Y'
   ,BL_DRFT_FAX_OUT_USR_ID = @[usr_id]
   ,BL_DRFT_FAX_OUT_ST_DT =	DPCS_DOC_FM_DT
   ,BL_DRFT_FAX_OUT_DT = GLOBALDATE_PKG.TIME_CONV_FNC('KRPUS',SYSDATE,GLOBALDATE_PKG.GET_LOCCD_FNC('PKGSA'))
   ,SR_WRK_STS_CD  = DECODE(BL_DOC_INP_FLG||BL_RT_FLG||BL_AUD_FLG,'YYY','Y','W')	
   ,BL_DRFT_FAX_OUT_HRS =  (SELECT SUM(SR_PROC_HRS) FROM BKG_SR_HIS H WHERE H.SR_KND_CD=R.SR_KND_CD AND H.SR_NO = R.SR_NO AND H.BKG_NO = R.BKG_NO AND H.SR_STS_CD = 'DF')				
#end
   ,CRNT_DT = GLOBALDATE_PKG.TIME_CONV_FNC('KRPUS',SYSDATE,GLOBALDATE_PKG.GET_LOCCD_FNC('PKGSA'))
#end
,	UPD_USR_ID = @[usr_id]
,	UPD_DT = SYSDATE	
WHERE	SR_KND_CD = @[src_cd]
AND	SR_NO = @[sr_no]
AND	BKG_NO = @[bkg_no]
AND SR_AMD_SEQ = (SELECT NVL(MAX(SR_AMD_SEQ),0)
                             FROM  BKG_SR_CRNT_RQST
                            WHERE SR_KND_CD = R.SR_KND_CD
                              AND SR_AMD_TP_CD = R.SR_AMD_TP_CD
                              AND BKG_NO = R.BKG_NO
                              AND SR_NO = R.SR_NO
                              AND FNT_OFC_TRNS_DT IS NOT NULL
                           )			]]></sql>
			<params>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="src_cd" type="12" value="" out="N"/>
				<param name="sr_no" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
