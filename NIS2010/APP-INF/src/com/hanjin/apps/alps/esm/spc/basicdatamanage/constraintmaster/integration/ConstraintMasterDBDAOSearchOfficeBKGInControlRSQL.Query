<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ConstraintMasterDBDAOSearchOfficeBKGInControlRSQL">
			<desc><![CDATA[Control Office BKG get List
ConstraintMasterDBDAOSearchOfficeBKGInControlRSQL.Query- 패키지 이동으로 신규 생성
* 2015.09.24 이혜민 [CHM-201537552] BKG Control - SMP통제 조건 by lane 변경요청]]></desc>
			<sql><![CDATA[
--Alloc Office 항목 조회 (BKG_CTRL_TP_CD = 'O')
SELECT 	
		BKG_CTRL_TP_CD,
		BKG_CTRL_DTL_CD,
		BKG_CTRL_RTO,
		NVL(BKG_CTRL_ACCT_FLG, 'N') AS BKG_CTRL_ACCT_FLG,
        NVL(BKG_CTRL_LANE_FLG, 'N') AS BKG_CTRL_LANE_FLG,
        RLANE_CD,
        DIR_CD
FROM 	SPC_BKG_CTRL_OPT_DTL
WHERE   TRD_CD     = @[trd_cd]
	AND SUB_TRD_CD = @[sub_trd_cd]
	AND RLANE_CD   = @[rlane_cd]
	AND DIR_CD     = @[dir_cd]
	AND BKG_CTRL_TP_CD = 'O'
UNION ALL
--SMP Group 항목 조회 (BKG_CTRL_TP_CD = 'S')
SELECT B.BKG_CTRL_TP_CD,
       B.BKG_CTRL_DTL_CD,
	   B.BKG_CTRL_RTO,
	   NVL(B.BKG_CTRL_ACCT_FLG, 'N') AS BKG_CTRL_ACCT_FLG,
       NVL(B.BKG_CTRL_LANE_FLG, 'N') AS BKG_CTRL_LANE_FLG,
       B.RLANE_CD,
       B.DIR_CD
FROM (
        SELECT TRD_CD
             , SUB_TRD_CD
             , NVL((SELECT DISTINCT RLANE_CD 
                      FROM SPC_BKG_CTRL_OPT_DTL
                     WHERE TRD_CD     = @[trd_cd]
                       AND SUB_TRD_CD = @[sub_trd_cd]
                       AND RLANE_CD   = @[rlane_cd]
                       AND DIR_CD     = @[dir_cd]
                       AND BKG_CTRL_LANE_FLG = 'Y'), 'XXXXX') RLANE_CD
             , NVL((SELECT DISTINCT DIR_CD 
                      FROM SPC_BKG_CTRL_OPT_DTL
                     WHERE TRD_CD     = @[trd_cd]
                       AND SUB_TRD_CD = @[sub_trd_cd]
                       AND RLANE_CD   = @[rlane_cd]
                       AND DIR_CD     = @[dir_cd]
                       AND BKG_CTRL_LANE_FLG = 'Y'), 'X') DIR_CD
          FROM SPC_HD_HUL_MST
         WHERE TRD_CD    = @[trd_cd]
           AND RLANE_CD  = @[rlane_cd]
           AND DIR_CD    = @[dir_cd]
     ) A, SPC_BKG_CTRL_OPT_DTL B
WHERE 1=1
AND B.BKG_CTRL_TP_CD = 'S'
AND A.TRD_CD     = B.TRD_CD
AND A.SUB_TRD_CD = B.SUB_TRD_CD
AND A.RLANE_CD   = B.RLANE_CD
AND A.DIR_CD     = B.DIR_CD			]]></sql>
			<params>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="sub_trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
