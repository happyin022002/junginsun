/*=========================================================
*Copyright(c) 2016 CyberLogitec
*@FileName : SpacecontrolInquiryDBDAO021FcstPfmcAcctViewNSmpListRSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2016.06.23
*@LastModifier : 
*@LastVersion : 1.0
* 2016.06.23 
* 1.0 Creation
=========================================================*/
package com.hanjin.apps.alps.esm.spc.spacecontrolinquiry.spacecontrolinquiry.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.hanjin.framework.support.db.ISQLTemplate;

/**
 *
 * @author 
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class SpacecontrolInquiryDBDAO021FcstPfmcAcctViewNSmpListRSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * Daily Forecast Status 화면 내 FCST & PFMC Status by ACCT 탭에서  Non SMP 조건 체크한 경우 데이터를 조회한다.
	  * </pre>
	  */
	public SpacecontrolInquiryDBDAO021FcstPfmcAcctViewNSmpListRSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("area",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("duration",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("sales_office",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("week",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("trade",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("year",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("bound",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("rhq",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("subtrade1",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("pol_cd",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.hanjin.apps.alps.esm.spc.spacecontrolinquiry.spacecontrolinquiry.integration").append("\n"); 
		query.append("FileName : SpacecontrolInquiryDBDAO021FcstPfmcAcctViewNSmpListRSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("WITH MAS_MON_VVD_LV AS(" ).append("\n"); 
		query.append("    SELECT B.TRD_CD    ," ).append("\n"); 
		query.append("           B.SUB_TRD_CD," ).append("\n"); 
		query.append("           B.RLANE_CD  ," ).append("\n"); 
		query.append("           B.DIR_CD    ," ).append("\n"); 
		query.append("           B.IOC_CD    ," ).append("\n"); 
		query.append("           B.COST_YR   ," ).append("\n"); 
		query.append("           B.NUM       ," ).append("\n"); 
		query.append("           B.COST_WK   ," ).append("\n"); 
		query.append("           B.SLS_YRMON ," ).append("\n"); 
		query.append("           B.WK_DAY    ," ).append("\n"); 
		query.append("           B.VSL_CD    ," ).append("\n"); 
		query.append("           B.SKD_VOY_NO," ).append("\n"); 
		query.append("           B.SKD_DIR_CD," ).append("\n"); 
		query.append("           B.HH_FLG    ," ).append("\n"); 
		query.append("           B.RHQ_CD    ," ).append("\n"); 
		query.append("           B.AQ_CD     ," ).append("\n"); 
		query.append("           B.RGN_OFC_CD," ).append("\n"); 
		query.append("           B.VSL_CD || B.SKD_VOY_NO || B.SKD_DIR_CD VVD_CD," ).append("\n"); 
		query.append("           (SELECT /*+ INDEX_DESC(M XPKSPC_MDL_VER_MST) */" ).append("\n"); 
		query.append("            	   DECODE(B.HH_FLG, 'Y', COST_YRWK||'-'||VER_SEQ, '200001-1')" ).append("\n"); 
		query.append("              FROM SPC_MDL_VER_MST M" ).append("\n"); 
		query.append("             WHERE B.COST_YR||B.COST_WK BETWEEN M.VER_ST_YRWK AND M.VER_END_YRWK" ).append("\n"); 
		query.append("               AND M.TRD_CD  = B.TRD_CD" ).append("\n"); 
		query.append("               AND M.CFM_FLG = 'Y'" ).append("\n"); 
		query.append("               AND ROWNUM = 1) AS SEASON" ).append("\n"); 
		query.append("           ,B.BSE_QTR_CD" ).append("\n"); 
		query.append("           ,B.BSE_YR" ).append("\n"); 
		query.append("      FROM (" ).append("\n"); 
		query.append("              SELECT M.TRD_CD    ," ).append("\n"); 
		query.append("                     M.SUB_TRD_CD," ).append("\n"); 
		query.append("                     M.RLANE_CD  ," ).append("\n"); 
		query.append("                     M.DIR_CD    ," ).append("\n"); 
		query.append("                     M.IOC_CD    ," ).append("\n"); 
		query.append("                     M.SLS_YRMON ," ).append("\n"); 
		query.append("                     SUBSTR(M.SLS_YRMON, 1, 4) AS COST_YR," ).append("\n"); 
		query.append("                     P.RNUM NUM  ," ).append("\n"); 
		query.append("                     M.COST_WK   ," ).append("\n"); 
		query.append("                     P.WK_DAY    ," ).append("\n"); 
		query.append("                     M.VSL_CD    ," ).append("\n"); 
		query.append("                     M.SKD_VOY_NO," ).append("\n"); 
		query.append("                     M.DIR_CD        AS SKD_DIR_CD," ).append("\n"); 
		query.append("                     DECODE(Q.DIR_CD, NULL, 'N', 'Y') AS HH_FLG," ).append("\n"); 
		query.append("                     C.RHQ_CD        AS RHQ_CD    ," ).append("\n"); 
		query.append("                     @[area]         AS AQ_CD     ," ).append("\n"); 
		query.append("                     @[sales_office] AS RGN_OFC_CD," ).append("\n"); 
		query.append("                     @[pol_cd]       AS POL_CD  " ).append("\n"); 
		query.append("                     , CASE WHEN M.COST_YRMON >= '201501' " ).append("\n"); 
		query.append("                          THEN CEIL(TO_NUMBER(SUBSTR(M.COST_YRMON, -2))/3)||'Q' " ).append("\n"); 
		query.append("                          ELSE CEIL(TO_NUMBER(DECODE(M.COST_WK,'00','01','53','52',M.COST_WK))/13)||'Q'" ).append("\n"); 
		query.append("                      END BSE_QTR_CD " ).append("\n"); 
		query.append("                    , SUBSTR(M.COST_YRMON, 1,4) AS BSE_YR" ).append("\n"); 
		query.append("                FROM MAS_MON_VVD     M," ).append("\n"); 
		query.append("                     SPC_HD_HUL_MST  Q," ).append("\n"); 
		query.append("                     (" ).append("\n"); 
		query.append("                        SELECT /*+ INDEX (P XPKMAS_WK_PRD) */" ).append("\n"); 
		query.append("                               P.COST_YR||P.COST_WK AS COST_YRWK," ).append("\n"); 
		query.append("                               P.SLS_FM_DT ||'~'|| P.SLS_TO_DT AS WK_DAY," ).append("\n"); 
		query.append("                               ROWNUM               AS RNUM" ).append("\n"); 
		query.append("                          FROM MAS_WK_PRD P" ).append("\n"); 
		query.append("                         WHERE P.COST_YR||P.COST_WK >= @[year]||@[week]" ).append("\n"); 
		query.append("                           AND ROWNUM               <= @[duration]" ).append("\n"); 
		query.append("                     ) P," ).append("\n"); 
		query.append("                     (" ).append("\n"); 
		query.append("                        SELECT DISTINCT" ).append("\n"); 
		query.append("                               SUBSTR(AA" ).append("\n"); 
		query.append("                                ,INSTR(AA,',',1,LEVEL)+1" ).append("\n"); 
		query.append("                                 ,INSTR(AA,',',1,LEVEL+1) - INSTR(AA,',',1,LEVEL) -1" ).append("\n"); 
		query.append("                               ) RHQ_CD" ).append("\n"); 
		query.append("                          FROM (SELECT ','||@[rhq]||',' AA FROM DUAL)" ).append("\n"); 
		query.append("          					   CONNECT BY LEVEL <= LENGTH(AA) - LENGTH(REPLACE(AA,','))-1" ).append("\n"); 
		query.append("                     ) C" ).append("\n"); 
		query.append("               WHERE SUBSTR(M.SLS_YRMON, 1, 4)||M.COST_WK = P.COST_YRWK" ).append("\n"); 
		query.append("                 AND (M.DELT_FLG IS NULL OR M.DELT_FLG = 'N')" ).append("\n"); 
		query.append("                 AND Q.TRD_CD(+)     = M.TRD_CD" ).append("\n"); 
		query.append("                 AND Q.RLANE_CD(+)   = M.RLANE_CD" ).append("\n"); 
		query.append("                 AND Q.DIR_CD(+)     = M.DIR_CD" ).append("\n"); 
		query.append("#if (${trade} != '')" ).append("\n"); 
		query.append("                 AND M.TRD_CD = @[trade]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${subtrade1} != '')" ).append("\n"); 
		query.append("                 AND M.SUB_TRD_CD = @[subtrade1]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${bound} != '')" ).append("\n"); 
		query.append("                 AND M.DIR_CD = (CASE " ).append("\n"); 
		query.append("									WHEN M.RLANE_CD IN ('AUSIA', 'CKAIA', 'WAXIA', 'AAZIA', 'QISIA', 'RUSIA', 'FOXIA') THEN" ).append("\n"); 
		query.append("											DECODE(@[bound], 'E', 'W', 'W', 'E', @[bound])" ).append("\n"); 
		query.append("									ELSE" ).append("\n"); 
		query.append("										@[bound]" ).append("\n"); 
		query.append("								END)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${rlane1} != '')" ).append("\n"); 
		query.append("                 AND M.RLANE_CD IN ($rlane1)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("              ) B" ).append("\n"); 
		query.append("  ORDER BY B.VSL_CD    ," ).append("\n"); 
		query.append("           B.SKD_VOY_NO," ).append("\n"); 
		query.append("           B.DIR_CD" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", SREP_LIST AS (" ).append("\n"); 
		query.append("            SELECT DISTINCT  " ).append("\n"); 
		query.append("                   V.COST_YR, " ).append("\n"); 
		query.append("                   V.COST_WK, " ).append("\n"); 
		query.append("                   V.COST_YR||V.COST_WK COST_YRWK," ).append("\n"); 
		query.append("                   F.CUST_CNT_CD, " ).append("\n"); 
		query.append("                   F.CUST_SEQ, " ).append("\n"); 
		query.append("                   NVL( (SELECT DISTINCT CUST_CTRL_CD" ).append("\n"); 
		query.append("                          FROM SPC_MDL_CUST_CTRL M" ).append("\n"); 
		query.append("                         WHERE M.COST_YRWK   = SUBSTR(V.SEASON, 1, 6)" ).append("\n"); 
		query.append("                           AND M.VER_SEQ     = SUBSTR(V.SEASON, 8)" ).append("\n"); 
		query.append("                           AND M.TRD_CD      = F.TRD_CD" ).append("\n"); 
		query.append("                           AND M.CUST_CNT_CD = F.CUST_CNT_CD" ).append("\n"); 
		query.append("                           AND M.CUST_SEQ    = F.CUST_SEQ" ).append("\n"); 
		query.append("                           AND NVL(M.SC_NO, NVL(M.RFA_NO, 'X')) = NVL(F.SC_NO, NVL(F.RFA_NO, 'X'))" ).append("\n"); 
		query.append("                           AND M.DELT_FLG = 'N') , 'C') AS CUST_CTRL_CD," ).append("\n"); 
		query.append("                   F.SC_NO," ).append("\n"); 
		query.append("                   F.RFA_NO" ).append("\n"); 
		query.append("              FROM MAS_MON_VVD_LV    V," ).append("\n"); 
		query.append("                   SPC_DLY_FCAST_CUST F " ).append("\n"); 
		query.append("             WHERE F.TRD_CD      = V.TRD_CD" ).append("\n"); 
		query.append("               AND F.SUB_TRD_CD  = V.SUB_TRD_CD" ).append("\n"); 
		query.append("               AND F.RLANE_CD    = V.RLANE_CD" ).append("\n"); 
		query.append("               AND F.DIR_CD      = V.DIR_CD" ).append("\n"); 
		query.append("               AND F.IOC_TS_CD   = V.IOC_CD" ).append("\n"); 
		query.append("               AND F.VSL_CD      = V.VSL_CD" ).append("\n"); 
		query.append("               AND F.SKD_VOY_NO  = V.SKD_VOY_NO" ).append("\n"); 
		query.append("               AND F.SKD_DIR_CD  = V.SKD_DIR_CD" ).append("\n"); 
		query.append("               AND F.SLS_RHQ_CD  = V.RHQ_CD" ).append("\n"); 
		query.append("               AND F.SLS_RGN_OFC_CD  = NVL(V.RGN_OFC_CD, F.SLS_RGN_OFC_CD)" ).append("\n"); 
		query.append("               AND F.CUST_CNT_CD <> 'XX'" ).append("\n"); 
		query.append("               AND F.CUST_SEQ    <> '999999'" ).append("\n"); 
		query.append("#if(${acct} != '')" ).append("\n"); 
		query.append("               AND F.CUST_CNT_CD||TO_CHAR(F.CUST_SEQ, 'FM000000') IN (${acct})" ).append("\n"); 
		query.append("#end               " ).append("\n"); 
		query.append("             UNION ALL" ).append("\n"); 
		query.append("             SELECT DISTINCT V.COST_YR, V.COST_WK, V.COST_YR||V.COST_WK COST_YRWK, M.CUST_CNT_CD," ).append("\n"); 
		query.append("                   M.CUST_SEQ, " ).append("\n"); 
		query.append("                   'C' CUST_CTRL_CD," ).append("\n"); 
		query.append("                   NULL SC_NO," ).append("\n"); 
		query.append("                   NULL RFA_N" ).append("\n"); 
		query.append("             FROM MAS_MON_VVD_LV    V," ).append("\n"); 
		query.append("             (SELECT 'XX' CUST_CNT_CD, 999999 CUST_SEQ FROM DUAL) M" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", MDL_DATA AS (" ).append("\n"); 
		query.append("    SELECT DISTINCT " ).append("\n"); 
		query.append("           G.CUST_GRP_ID," ).append("\n"); 
		query.append("           M.CUST_CNT_CD AS MDL_CUST_CNT," ).append("\n"); 
		query.append("           M.CUST_SEQ    AS MDL_CUST_SEQ," ).append("\n"); 
		query.append("           M.CUST_CTRL_CD AS MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("           M.CUST_CNT_CD," ).append("\n"); 
		query.append("           M.CUST_SEQ," ).append("\n"); 
		query.append("           M.SC_NO," ).append("\n"); 
		query.append("           M.RFA_NO," ).append("\n"); 
		query.append("           M.CTRT_OFC_CD," ).append("\n"); 
		query.append("           M.SLS_RGN_OFC_CD AS LOAD_OFC_CD," ).append("\n"); 
		query.append("           M.TRD_CD," ).append("\n"); 
		query.append("           M.SUB_TRD_CD," ).append("\n"); 
		query.append("           M.RLANE_CD," ).append("\n"); 
		query.append("           V.IOC_CD," ).append("\n"); 
		query.append("           V.VSL_CD||V.SKD_VOY_NO||V.DIR_CD AS VVD_CD," ).append("\n"); 
		query.append("           V.NUM," ).append("\n"); 
		query.append("           V.COST_YR||V.COST_WK AS COST_YRWK," ).append("\n"); 
		query.append("           RLANE_ADJ_QTY AS MAX_QTY" ).append("\n"); 
		query.append("      FROM MAS_MON_VVD_LV V," ).append("\n"); 
		query.append("           SPC_MDL_CUST_REV_LANE M," ).append("\n"); 
		query.append("           SREP_LIST S," ).append("\n"); 
		query.append("           MDM_CUSTOMER G" ).append("\n"); 
		query.append("     WHERE M.COST_YRWK   = SUBSTR(V.SEASON, 1, 6)" ).append("\n"); 
		query.append("       AND M.VER_SEQ     = SUBSTR(V.SEASON, 8)" ).append("\n"); 
		query.append("       AND M.TRD_CD      = V.TRD_CD" ).append("\n"); 
		query.append("       AND M.SUB_TRD_CD  = V.SUB_TRD_CD" ).append("\n"); 
		query.append("       AND M.RLANE_CD    = V.RLANE_CD" ).append("\n"); 
		query.append("       AND M.CUST_CNT_CD = S.CUST_CNT_CD" ).append("\n"); 
		query.append("       AND M.CUST_SEQ    = S.CUST_SEQ" ).append("\n"); 
		query.append("       AND NVL(M.SC_NO, NVL(M.RFA_NO, 'X')) = NVL(S.SC_NO, NVL(S.RFA_NO, 'X'))" ).append("\n"); 
		query.append("       AND M.DELT_FLG    = 'N'" ).append("\n"); 
		query.append("       AND M.CUST_CNT_CD = G.CUST_CNT_CD" ).append("\n"); 
		query.append("       AND M.CUST_SEQ    = G.CUST_SEQ" ).append("\n"); 
		query.append("#if(${grp_acct} != '')" ).append("\n"); 
		query.append("       AND NVL(G.CUST_GRP_ID, 'X') IN (${grp_acct})     " ).append("\n"); 
		query.append("#end  " ).append("\n"); 
		query.append("       AND V.HH_FLG      = 'Y'" ).append("\n"); 
		query.append("#if (${rhq} != '' || ${area} != '' || ${sales_office} != '')" ).append("\n"); 
		query.append("       AND (    (V.RHQ_CD = 'SHARC' AND V.AQ_CD IS NULL AND V.RGN_OFC_CD IS NULL) " ).append("\n"); 
		query.append("             OR EXISTS ( SELECT O.OFC_CD" ).append("\n"); 
		query.append("                           FROM SPC_OFC_LVL O" ).append("\n"); 
		query.append("                          WHERE O.OFC_TP_CD IN ('BB', 'BA', 'BS')" ).append("\n"); 
		query.append("                            AND SPC_SCR_OFC_CONV_FNC(M.SLS_RGN_OFC_CD) = O.OFC_CD" ).append("\n"); 
		query.append("						    AND V.RHQ_CD = O.N2ND_PRNT_OFC_CD" ).append("\n"); 
		query.append("                            AND V.COST_YR || V.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK" ).append("\n"); 
		query.append("                     CONNECT BY NOCYCLE O.PRNT_OFC_CD = PRIOR O.OFC_CD" ).append("\n"); 
		query.append("                             START WITH (V.RGN_OFC_CD IS NULL AND O.PRNT_OFC_CD = NVL(V.AQ_CD, V.RHQ_CD)) OR (O.OFC_CD = V.RGN_OFC_CD)))" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", CTRT_FCAST AS (" ).append("\n"); 
		query.append("    SELECT CUST_GRP_ID ," ).append("\n"); 
		query.append("           MDL_CUST_CNT," ).append("\n"); 
		query.append("           MDL_CUST_SEQ," ).append("\n"); 
		query.append("           CUST_CNT_CD ," ).append("\n"); 
		query.append("           CUST_SEQ    ," ).append("\n"); 
		query.append("           MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("           SC_NO       ," ).append("\n"); 
		query.append("           RFA_NO      ," ).append("\n"); 
		query.append("           CTRT_OFC_CD ," ).append("\n"); 
		query.append("           LOAD_OFC_CD ," ).append("\n"); 
		query.append("           TRD_CD      ," ).append("\n"); 
		query.append("           SUB_TRD_CD  ," ).append("\n"); 
		query.append("           RLANE_CD    ," ).append("\n"); 
		query.append("           IOC_CD      ," ).append("\n"); 
		query.append("           VVD_CD      ," ).append("\n"); 
		query.append("           NUM         ," ).append("\n"); 
		query.append("           COST_YRWK   ," ).append("\n"); 
		query.append("           0              AS MAX_QTY    ," ).append("\n"); 
		query.append("           SUM(FCAST_QTY) AS CTRT_FCST  ,           " ).append("\n"); 
		query.append("           0              AS FCAST_QTY  ," ).append("\n"); 
		query.append("           0              AS BKG_QTY    ," ).append("\n"); 
		query.append("           0              AS BKG_AVG_QTY" ).append("\n"); 
		query.append("      FROM (" ).append("\n"); 
		query.append("            SELECT DISTINCT " ).append("\n"); 
		query.append("                 C.CUST_GRP_ID," ).append("\n"); 
		query.append("                 NVL(S.CUST_CNT_CD, 'XX') AS MDL_CUST_CNT," ).append("\n"); 
		query.append("                 NVL(S.CUST_SEQ, 999999 ) AS MDL_CUST_SEQ," ).append("\n"); 
		query.append("                 NVL(S.CUST_CTRL_CD, 'C') AS MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("                 F.CUST_CNT_CD   ," ).append("\n"); 
		query.append("                 F.CUST_SEQ      ," ).append("\n"); 
		query.append("                 F.SC_NO         , " ).append("\n"); 
		query.append("                 F.RFA_NO        ," ).append("\n"); 
		query.append("                 F.CTRT_OFC_CD   ," ).append("\n"); 
		query.append("                 F.SLS_RGN_OFC_CD AS LOAD_OFC_CD," ).append("\n"); 
		query.append("                 F.TRD_CD        ," ).append("\n"); 
		query.append("                 F.SUB_TRD_CD    ," ).append("\n"); 
		query.append("                 F.RLANE_CD      ," ).append("\n"); 
		query.append("                 A.IOC_CD        ," ).append("\n"); 
		query.append("                 F.VSL_CD||F.SKD_VOY_NO||F.SKD_DIR_CD AS VVD_CD," ).append("\n"); 
		query.append("                 A.NUM," ).append("\n"); 
		query.append("                 A.COST_YR||A.COST_WK AS COST_YRWK, " ).append("\n"); 
		query.append("                 NVL(F.FCAST_TTL_QTY,0) + (NVL(FCAST_40FT_HC_QTY, 0) + NVL(FCAST_45FT_HC_QTY, 0) + NVL(FCAST_53FT_QTY, 0) ) * 2 AS FCAST_QTY" ).append("\n"); 
		query.append("              FROM MAS_MON_VVD_LV      A," ).append("\n"); 
		query.append("                   SPC_CTRT_FCAST_CUST F," ).append("\n"); 
		query.append("                   SREP_LIST           S," ).append("\n"); 
		query.append("                   MDM_CUSTOMER        C" ).append("\n"); 
		query.append("             WHERE A.TRD_CD      = F.TRD_CD" ).append("\n"); 
		query.append("               AND A.RLANE_CD    = F.RLANE_CD" ).append("\n"); 
		query.append("               AND A.IOC_CD      = F.IOC_TS_CD" ).append("\n"); 
		query.append("               AND A.VSL_CD      = F.VSL_CD" ).append("\n"); 
		query.append("               AND A.SKD_VOY_NO  = F.SKD_VOY_NO" ).append("\n"); 
		query.append("               AND A.DIR_CD      = F.SKD_DIR_CD" ).append("\n"); 
		query.append("               AND A.DIR_CD      = F.SKD_DIR_CD" ).append("\n"); 
		query.append("               AND F.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("               AND F.CUST_SEQ    = C.CUST_SEQ" ).append("\n"); 
		query.append("#if(${grp_acct} != '')" ).append("\n"); 
		query.append("               AND NVL(C.CUST_GRP_ID, 'X') IN (${grp_acct}) " ).append("\n"); 
		query.append("#end  " ).append("\n"); 
		query.append("#if(${acct} != '')" ).append("\n"); 
		query.append("               AND F.CUST_CNT_CD||TO_CHAR(F.CUST_SEQ, 'FM000000') IN (${acct})" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("               AND (    (A.RHQ_CD = 'SHARC' AND A.AQ_CD IS NULL AND A.RGN_OFC_CD IS NULL) " ).append("\n"); 
		query.append("                     OR EXISTS ( SELECT O.OFC_CD" ).append("\n"); 
		query.append("                                   FROM SPC_OFC_LVL O" ).append("\n"); 
		query.append("                                  WHERE O.OFC_TP_CD IN ('BB', 'BA', 'BS')" ).append("\n"); 
		query.append("                                    AND F.SLS_RGN_OFC_CD = O.OFC_CD" ).append("\n"); 
		query.append("						            AND A.RHQ_CD = O.N2ND_PRNT_OFC_CD" ).append("\n"); 
		query.append("                                    AND A.COST_YR || A.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK" ).append("\n"); 
		query.append("                                CONNECT BY NOCYCLE O.PRNT_OFC_CD = PRIOR O.OFC_CD" ).append("\n"); 
		query.append("                                  START WITH (A.RGN_OFC_CD IS NULL AND O.PRNT_OFC_CD = NVL(A.AQ_CD, A.RHQ_CD)) OR (O.OFC_CD = A.RGN_OFC_CD)))" ).append("\n"); 
		query.append("            " ).append("\n"); 
		query.append("               AND F.CUST_CNT_CD     = S.CUST_CNT_CD" ).append("\n"); 
		query.append("               AND F.CUST_SEQ        = S.CUST_SEQ" ).append("\n"); 
		query.append("               AND NVL(F.SC_NO, NVL(F.RFA_NO, 'X')) = NVL(S.SC_NO, NVL(S.RFA_NO, 'X'))" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("        )        " ).append("\n"); 
		query.append("  GROUP BY CUST_GRP_ID     ," ).append("\n"); 
		query.append("           MDL_CUST_CNT    ," ).append("\n"); 
		query.append("           MDL_CUST_SEQ    ," ).append("\n"); 
		query.append("           MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("           CUST_CNT_CD     ," ).append("\n"); 
		query.append("           CUST_SEQ        ," ).append("\n"); 
		query.append("           SC_NO           ," ).append("\n"); 
		query.append("           RFA_NO          ," ).append("\n"); 
		query.append("           CTRT_OFC_CD     ," ).append("\n"); 
		query.append("           LOAD_OFC_CD     ," ).append("\n"); 
		query.append("           TRD_CD          ," ).append("\n"); 
		query.append("           SUB_TRD_CD      ," ).append("\n"); 
		query.append("           RLANE_CD        ," ).append("\n"); 
		query.append("           IOC_CD          ," ).append("\n"); 
		query.append("           VVD_CD          ," ).append("\n"); 
		query.append("           NUM             ," ).append("\n"); 
		query.append("           COST_YRWK " ).append("\n"); 
		query.append("    HAVING SUM(FCAST_QTY) <> 0" ).append("\n"); 
		query.append(")   " ).append("\n"); 
		query.append(",RFA_BKG_DATA AS (" ).append("\n"); 
		query.append("SELECT SHP_CUST_CD," ).append("\n"); 
		query.append("       POL_CD," ).append("\n"); 
		query.append("       POD_CD," ).append("\n"); 
		query.append("       RFA_NO," ).append("\n"); 
		query.append("       CUST_CTRL_CD" ).append("\n"); 
		query.append("  FROM (" ).append("\n"); 
		query.append("        SELECT " ).append("\n"); 
		query.append("               CUST_CD AS  SHP_CUST_CD," ).append("\n"); 
		query.append("               POL_CD," ).append("\n"); 
		query.append("               POD_CD," ).append("\n"); 
		query.append("               MAX(RFA_NO) OVER(PARTITION BY CUST_CD,POL_CD,POD_CD) AS RFA_NO,  " ).append("\n"); 
		query.append("               CUST_CTRL_CD,             " ).append("\n"); 
		query.append("               MIN(CUST_CTRL_CD) OVER(PARTITION BY CUST_CD,POL_CD,POD_CD) AS CUST_CTRL_CD_MIN               " ).append("\n"); 
		query.append("          FROM (" ).append("\n"); 
		query.append("                SELECT (SELECT CUST_CNT_CD||LPAD(CUST_SEQ,6,'0')" ).append("\n"); 
		query.append("                          FROM BKG_CUSTOMER B" ).append("\n"); 
		query.append("                         WHERE B.BKG_NO         = A.BKG_NO" ).append("\n"); 
		query.append("                           AND B.BKG_CUST_TP_CD = 'S'" ).append("\n"); 
		query.append("                           AND B.CUST_CNT_CD    = 'CN'" ).append("\n"); 
		query.append("                       ) CUST_CD," ).append("\n"); 
		query.append("                       A.POL_CD," ).append("\n"); 
		query.append("                       A.POD_CD,                       " ).append("\n"); 
		query.append("                       C.RFA_NO," ).append("\n"); 
		query.append("                       C.CUST_CTRL_CD" ).append("\n"); 
		query.append("                  FROM BKG_BOOKING A," ).append("\n"); 
		query.append("                       (" ).append("\n"); 
		query.append("                        SELECT RFA_NO," ).append("\n"); 
		query.append("                               CUST_CTRL_CD" ).append("\n"); 
		query.append("                          FROM SPC_MDL_CUST_CTRL M," ).append("\n"); 
		query.append("                               MAS_MON_VVD_LV S" ).append("\n"); 
		query.append("                         WHERE M.TRD_CD    IN ('AES', 'IAS') " ).append("\n"); 
		query.append("                           AND M.TRD_CD    = S.TRD_CD " ).append("\n"); 
		query.append("                           AND M.COST_YRWK = SUBSTR(S.SEASON, 1, 6)" ).append("\n"); 
		query.append("                           AND M.VER_SEQ   = SUBSTR(S.SEASON, 8)" ).append("\n"); 
		query.append("                           AND M.RFA_NO IS NOT NULL" ).append("\n"); 
		query.append("                       ) C" ).append("\n"); 
		query.append("                 WHERE A.RFA_NO = C.RFA_NO " ).append("\n"); 
		query.append("               )" ).append("\n"); 
		query.append("         WHERE CUST_CD IS NOT NULL" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("  WHERE CUST_CTRL_CD_MIN = CUST_CTRL_CD" ).append("\n"); 
		query.append(" GROUP BY SHP_CUST_CD," ).append("\n"); 
		query.append("       POL_CD," ).append("\n"); 
		query.append("       POD_CD," ).append("\n"); 
		query.append("       RFA_NO," ).append("\n"); 
		query.append("       CUST_CTRL_CD" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", BKG_DATA AS (" ).append("\n"); 
		query.append("    SELECT AB.BKG_NO, " ).append("\n"); 
		query.append("           AB.SUB_TRD_CD," ).append("\n"); 
		query.append("           AB.RLANE_CD  ," ).append("\n"); 
		query.append("           AB.VSL_CD    ," ).append("\n"); 
		query.append("           AB.SKD_VOY_NO," ).append("\n"); 
		query.append("           AB.DIR_CD    ," ).append("\n"); 
		query.append("           AB.IOC_CD    ," ).append("\n"); 
		query.append("           AB.TRD_CD    ," ).append("\n"); 
		query.append("           AB.LOAD_OFC_CD," ).append("\n"); 
		query.append("           AB.NUM," ).append("\n"); 
		query.append("           AB.COST_YRWK," ).append("\n"); 
		query.append("           S.SC_NO," ).append("\n"); 
		query.append("           S.RFA_NO,           " ).append("\n"); 
		query.append("           AB.CTRT_OFC_CD," ).append("\n"); 
		query.append("           AB.CUST_GRP_ID," ).append("\n"); 
		query.append("           AB.CUST_CNT_CD," ).append("\n"); 
		query.append("           AB.CUST_SEQ,           " ).append("\n"); 
		query.append("           NVL(S.CUST_CNT_CD, 'XX') AS MDL_CUST_CNT," ).append("\n"); 
		query.append("           NVL(S.CUST_SEQ, 999999 ) AS MDL_CUST_SEQ," ).append("\n"); 
		query.append("           NVL(S.CUST_CTRL_CD, 'C') AS MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("           AB.BKG_QTY," ).append("\n"); 
		query.append("           TO_NUMBER(SUBSTR(AB.MAS_QTYCM, 0, INSTR(AB.MAS_QTYCM, '-')-1)) MAS_QTY," ).append("\n"); 
		query.append("           TO_NUMBER(SUBSTR(AB.MAS_QTYCM, INSTR(AB.MAS_QTYCM, '-')+1)) MAS_CM" ).append("\n"); 
		query.append("    FROM ( SELECT /*+ ORDERED */" ).append("\n"); 
		query.append("               B.BKG_NO," ).append("\n"); 
		query.append("               A.SUB_TRD_CD," ).append("\n"); 
		query.append("               A.RLANE_CD  ," ).append("\n"); 
		query.append("               A.VSL_CD    ," ).append("\n"); 
		query.append("               A.SKD_VOY_NO," ).append("\n"); 
		query.append("               A.DIR_CD    ," ).append("\n"); 
		query.append("               A.IOC_CD    ," ).append("\n"); 
		query.append("               A.TRD_CD    ," ).append("\n"); 
		query.append("               O.N4TH_PRNT_OFC_CD   AS LOAD_OFC_CD," ).append("\n"); 
		query.append("               A.NUM," ).append("\n"); 
		query.append("               A.COST_YR||A.COST_WK AS COST_YRWK," ).append("\n"); 
		query.append("               B.CTRT_OFC_CD," ).append("\n"); 
		query.append("               G.CUST_GRP_ID," ).append("\n"); 
		query.append("               B.CTRT_CUST_CNT_CD AS CUST_CNT_CD," ).append("\n"); 
		query.append("               B.CTRT_CUST_SEQ    AS CUST_SEQ," ).append("\n"); 
		query.append("               (SELECT SUM(DECODE(SPC_GET_CNTR_SZ_FNC(Q.CNTR_TPSZ_CD), '2', 1, 2) * Q.OP_CNTR_QTY)" ).append("\n"); 
		query.append("                  FROM BKG_QUANTITY Q" ).append("\n"); 
		query.append("                 WHERE B.BKG_NO = Q.BKG_NO" ).append("\n"); 
		query.append("               ) AS BKG_QTY ," ).append("\n"); 
		query.append("               (SELECT SUM(DECODE(SPC_GET_CNTR_SZ_FNC(CM.CNTR_TPSZ_CD), '2', 1, 2) * CM.BKG_QTY) ||'-'|| " ).append("\n"); 
		query.append("					   SUM(NVL(CM.BKG_REV, 0) + NVL(CM.BKG_OFT_REV, 0) + NVL(CM.BKG_MISC_REV, 0) + NVL(CM.SCR_CHG_REV, 0) + NVL(CM.DMDT_COM_AMT, 0) - NVL(CM.PA_CM_COST_TTL_AMT, 0))" ).append("\n"); 
		query.append("                  FROM MAS_BKG_EXPN_DTL CM -- MAS_BKG_REV_DTL CM " ).append("\n"); 
		query.append("                 WHERE B.BKG_NO = CM.BKG_NO" ).append("\n"); 
		query.append("               ) AS MAS_QTYCM" ).append("\n"); 
		query.append("               , SPC_GET_SMP_AMEND_FNC(A.TRD_CD, SUBSTR(A.SEASON, 1, 6), SUBSTR(A.SEASON, 8), B.SC_NO) AMEND_SC_NO" ).append("\n"); 
		query.append("               , SPC_GET_SMP_AMEND_FNC(A.TRD_CD, SUBSTR(A.SEASON, 1, 6), SUBSTR(A.SEASON, 8), DECODE(SUBSTR(B.RFA_NO, 1, 3), 'DUM', '', B.RFA_NO)) AMEND_RFA_NO" ).append("\n"); 
		query.append("          FROM MAS_MON_VVD_LV     A  ," ).append("\n"); 
		query.append("               BKG_BOOKING        B  ," ).append("\n"); 
		query.append("               BKG_VVD            BV ," ).append("\n"); 
		query.append("               MDM_DTL_REV_LANE   DRL," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("               SPC_OFC_LVL        O  ," ).append("\n"); 
		query.append("               MDM_CUSTOMER       G  ," ).append("\n"); 
		query.append("               BKG_CUSTOMER       BC  " ).append("\n"); 
		query.append("         WHERE B.BKG_STS_CD       IN ('W','F')" ).append("\n"); 
		query.append("           AND B.BKG_CGO_TP_CD    IN ('F', 'B', 'R')" ).append("\n"); 
		query.append("           AND B.BKG_NO            = BV.BKG_NO" ).append("\n"); 
		query.append("           AND A.VSL_CD            = B.VSL_CD" ).append("\n"); 
		query.append("           AND A.SKD_VOY_NO        = B.SKD_VOY_NO" ).append("\n"); 
		query.append("           AND A.DIR_CD            = B.SKD_DIR_CD" ).append("\n"); 
		query.append("#if (${rhq} != '' || ${area} != '' || ${sales_office} != '')" ).append("\n"); 
		query.append("       AND (    (A.RHQ_CD = 'SHARC' AND A.AQ_CD IS NULL AND A.RGN_OFC_CD IS NULL) " ).append("\n"); 
		query.append("             OR EXISTS ( SELECT O.OFC_CD" ).append("\n"); 
		query.append("                           FROM SPC_OFC_LVL O" ).append("\n"); 
		query.append("                          WHERE O.OFC_TP_CD IN ('BB', 'BA', 'BS')" ).append("\n"); 
		query.append("                            AND SPC_SCR_OFC_CONV_FNC(B.BKG_OFC_CD) = O.OFC_CD" ).append("\n"); 
		query.append("						    AND A.RHQ_CD = O.N2ND_PRNT_OFC_CD" ).append("\n"); 
		query.append("                            AND A.COST_YR || A.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK" ).append("\n"); 
		query.append("                     CONNECT BY NOCYCLE O.PRNT_OFC_CD = PRIOR O.OFC_CD" ).append("\n"); 
		query.append("                             START WITH (A.RGN_OFC_CD IS NULL AND O.PRNT_OFC_CD = NVL(A.AQ_CD, A.RHQ_CD)) OR (O.OFC_CD = A.RGN_OFC_CD)))" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("           AND A.VSL_CD            = BV.VSL_CD" ).append("\n"); 
		query.append("           AND A.SKD_VOY_NO        = BV.SKD_VOY_NO" ).append("\n"); 
		query.append("           AND A.DIR_CD            = BV.SKD_DIR_CD" ).append("\n"); 
		query.append("           AND O.OFC_CD            = SPC_SCR_OFC_CONV_FNC(B.OB_SLS_OFC_CD)" ).append("\n"); 
		query.append("           AND DRL.RLANE_CD        = A.RLANE_CD" ).append("\n"); 
		query.append("           AND DRL.VSL_SLAN_DIR_CD = A.DIR_CD" ).append("\n"); 
		query.append("           AND DRL.IOC_CD          = A.IOC_CD" ).append("\n"); 
		query.append("           AND DRL.SUB_TRD_CD      = A.SUB_TRD_CD" ).append("\n"); 
		query.append("           AND DRL.DELT_FLG        = 'N'" ).append("\n"); 
		query.append("           AND DRL.FM_CONTI_CD     = (SELECT SPC_CONTI_CONV_FNC(L.CONTI_CD, A.RLANE_CD, A.DIR_CD)" ).append("\n"); 
		query.append("                                        FROM MDM_LOCATION L" ).append("\n"); 
		query.append("                                       WHERE L.LOC_CD = BV.POL_CD )" ).append("\n"); 
		query.append("           AND DRL.TO_CONTI_CD     = (SELECT SPC_CONTI_CONV_FNC(L.CONTI_CD, A.RLANE_CD, A.DIR_CD)" ).append("\n"); 
		query.append("                                        FROM MDM_LOCATION L" ).append("\n"); 
		query.append("                                       WHERE L.LOC_CD = BV.POD_CD )" ).append("\n"); 
		query.append("           AND A.COST_YR || A.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK" ).append("\n"); 
		query.append("#if (${area} != '')" ).append("\n"); 
		query.append("       AND A.AQ_CD             = O.N3RD_PRNT_OFC_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${sales_office} != '')" ).append("\n"); 
		query.append("       AND A.RGN_OFC_CD        = O.N4TH_PRNT_OFC_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("           AND (    ((A.RHQ_CD = 'SHARC' AND A.AQ_CD IS NULL AND A.RGN_OFC_CD IS NULL AND  A.RHQ_CD = O.N2ND_PRNT_OFC_CD) AND DRL.FM_CONTI_CD = 'A')" ).append("\n"); 
		query.append("                 OR A.RHQ_CD <> 'SHARC'" ).append("\n"); 
		query.append("                 OR A.AQ_CD      IS NOT NULL" ).append("\n"); 
		query.append("                 OR A.RGN_OFC_CD IS NOT NULL )             " ).append("\n"); 
		query.append("           AND B.CTRT_CUST_CNT_CD  = G.CUST_CNT_CD" ).append("\n"); 
		query.append("           AND B.CTRT_CUST_SEQ     = G.CUST_SEQ     " ).append("\n"); 
		query.append("#if(${grp_acct} != '')" ).append("\n"); 
		query.append("           AND NVL(G.CUST_GRP_ID, 'X') IN (${grp_acct}) " ).append("\n"); 
		query.append("#end    " ).append("\n"); 
		query.append("#if(${acct} != '')" ).append("\n"); 
		query.append("           AND B.CTRT_CUST_CNT_CD||TO_CHAR(B.CTRT_CUST_SEQ, 'FM000000') IN (${acct})" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("           AND B.BKG_NO            = BC.BKG_NO  " ).append("\n"); 
		query.append("           AND BC.BKG_CUST_TP_CD   = 'S'       " ).append("\n"); 
		query.append("    ) AB, SREP_LIST S" ).append("\n"); 
		query.append("    WHERE 1=1" ).append("\n"); 
		query.append("    AND AB.COST_YRWK = S.COST_YRWK(+)" ).append("\n"); 
		query.append("    AND AB.CUST_CNT_CD  = S.CUST_CNT_CD(+)" ).append("\n"); 
		query.append("    AND AB.CUST_SEQ     = S.CUST_SEQ (+)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    AND CASE WHEN AB.AMEND_SC_NO IS NOT NULL AND S.SC_NO(+) IS NOT NULL THEN AB.AMEND_SC_NO" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("             ELSE (CASE WHEN AB.AMEND_RFA_NO IS NOT NULL AND S.RFA_NO(+) IS NOT NULL THEN AB.AMEND_RFA_NO" ).append("\n"); 
		query.append("                        ELSE 'X' END)" ).append("\n"); 
		query.append("        END =" ).append("\n"); 
		query.append("        CASE WHEN AB.AMEND_SC_NO IS NOT NULL AND S.SC_NO(+) IS NOT NULL THEN S.SC_NO(+)" ).append("\n"); 
		query.append("             ELSE (CASE WHEN AB.AMEND_RFA_NO IS NOT NULL AND S.RFA_NO(+) IS NOT NULL THEN S.RFA_NO(+)" ).append("\n"); 
		query.append("                        ELSE 'X' END) " ).append("\n"); 
		query.append("        END" ).append("\n"); 
		query.append("     UNION ALL" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("     SELECT /*+ ORDERED */" ).append("\n"); 
		query.append("           B.BKG_NO," ).append("\n"); 
		query.append("           B.SUB_TRD_CD," ).append("\n"); 
		query.append("           B.RLANE_CD  ," ).append("\n"); 
		query.append("           B.VSL_CD    ," ).append("\n"); 
		query.append("           B.SKD_VOY_NO," ).append("\n"); 
		query.append("           B.DIR_CD    ," ).append("\n"); 
		query.append("           B.IOC_CD    ," ).append("\n"); 
		query.append("           B.TRD_CD    ," ).append("\n"); 
		query.append("           B.LOAD_OFC_CD," ).append("\n"); 
		query.append("           B.NUM," ).append("\n"); 
		query.append("           B.COST_YRWK," ).append("\n"); 
		query.append("           B.SC_NO," ).append("\n"); 
		query.append("           NVL(RD.RFA_NO,'') AS RFA_NO,           " ).append("\n"); 
		query.append("           B.CTRT_OFC_CD," ).append("\n"); 
		query.append("           B.CUST_GRP_ID," ).append("\n"); 
		query.append("           B.CUST_CNT_CD," ).append("\n"); 
		query.append("           B.CUST_SEQ," ).append("\n"); 
		query.append("           B.MDL_CUST_CNT," ).append("\n"); 
		query.append("           B.MDL_CUST_SEQ," ).append("\n"); 
		query.append("           NVL(RD.CUST_CTRL_CD,'C')  AS MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("           B.BKG_QTY, 0 MAS_QTY, 0 MAS_CM" ).append("\n"); 
		query.append("     FROM (SELECT /*+ ORDERED */" ).append("\n"); 
		query.append("                   B.BKG_NO," ).append("\n"); 
		query.append("                   A.SUB_TRD_CD," ).append("\n"); 
		query.append("                   A.RLANE_CD  ," ).append("\n"); 
		query.append("                   A.VSL_CD    ," ).append("\n"); 
		query.append("                   A.SKD_VOY_NO," ).append("\n"); 
		query.append("                   A.DIR_CD    ," ).append("\n"); 
		query.append("                   A.IOC_CD    ," ).append("\n"); 
		query.append("                   A.TRD_CD    ," ).append("\n"); 
		query.append("                   O.N4TH_PRNT_OFC_CD   AS LOAD_OFC_CD," ).append("\n"); 
		query.append("                   A.NUM," ).append("\n"); 
		query.append("                   A.COST_YR||A.COST_WK AS COST_YRWK," ).append("\n"); 
		query.append("                   '' AS SC_NO," ).append("\n"); 
		query.append("                   BC.CUST_CNT_CD||LPAD(BC.CUST_SEQ,6,'0') AS SHP_CUST_CD, " ).append("\n"); 
		query.append("                   B.POL_CD AS BKG_POL_CD," ).append("\n"); 
		query.append("                   B.POD_CD AS BKG_POD_CD," ).append("\n"); 
		query.append("                   B.CTRT_OFC_CD," ).append("\n"); 
		query.append("                   G.CUST_GRP_ID," ).append("\n"); 
		query.append("                   B.CTRT_CUST_CNT_CD AS CUST_CNT_CD," ).append("\n"); 
		query.append("                   B.CTRT_CUST_SEQ    AS CUST_SEQ," ).append("\n"); 
		query.append("                   'XX'    AS MDL_CUST_CNT," ).append("\n"); 
		query.append("                   999999  AS MDL_CUST_SEQ," ).append("\n"); 
		query.append("                   (SELECT SUM(DECODE(SPC_GET_CNTR_SZ_FNC(Q.CNTR_TPSZ_CD), '2', 1, 2) * Q.OP_CNTR_QTY)" ).append("\n"); 
		query.append("                      FROM BKG_QUANTITY Q" ).append("\n"); 
		query.append("                     WHERE B.BKG_NO = Q.BKG_NO" ).append("\n"); 
		query.append("                   ) AS BKG_QTY  " ).append("\n"); 
		query.append("              FROM MAS_MON_VVD_LV     A  ," ).append("\n"); 
		query.append("                   BKG_BOOKING        B  ," ).append("\n"); 
		query.append("                   BKG_VVD            BV ," ).append("\n"); 
		query.append("                   MDM_DTL_REV_LANE   DRL," ).append("\n"); 
		query.append("                   SPC_OFC_LVL        O  ," ).append("\n"); 
		query.append("                   MDM_CUSTOMER       G  ," ).append("\n"); 
		query.append("                   BKG_CUSTOMER       BC " ).append("\n"); 
		query.append("             WHERE B.BKG_STS_CD       IN ('W','F')" ).append("\n"); 
		query.append("               AND B.BKG_CGO_TP_CD    IN ('F', 'B', 'R')" ).append("\n"); 
		query.append("               AND B.BKG_NO            = BV.BKG_NO" ).append("\n"); 
		query.append("               AND A.VSL_CD            = B.VSL_CD" ).append("\n"); 
		query.append("               AND A.SKD_VOY_NO        = B.SKD_VOY_NO" ).append("\n"); 
		query.append("               AND A.DIR_CD            = B.SKD_DIR_CD" ).append("\n"); 
		query.append("#if (${rhq} != '' || ${area} != '' || ${sales_office} != '')" ).append("\n"); 
		query.append("       AND (    (A.RHQ_CD = 'SHARC' AND A.AQ_CD IS NULL AND A.RGN_OFC_CD IS NULL) " ).append("\n"); 
		query.append("             OR EXISTS ( SELECT O.OFC_CD" ).append("\n"); 
		query.append("                           FROM SPC_OFC_LVL O" ).append("\n"); 
		query.append("                          WHERE O.OFC_TP_CD IN ('BB', 'BA', 'BS')" ).append("\n"); 
		query.append("                            AND SPC_SCR_OFC_CONV_FNC(B.BKG_OFC_CD) = O.OFC_CD" ).append("\n"); 
		query.append("						    AND A.RHQ_CD = O.N2ND_PRNT_OFC_CD" ).append("\n"); 
		query.append("                            AND A.COST_YR || A.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK" ).append("\n"); 
		query.append("                     CONNECT BY NOCYCLE O.PRNT_OFC_CD = PRIOR O.OFC_CD" ).append("\n"); 
		query.append("                             START WITH (A.RGN_OFC_CD IS NULL AND O.PRNT_OFC_CD = NVL(A.AQ_CD, A.RHQ_CD)) OR (O.OFC_CD = A.RGN_OFC_CD)))" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("               AND A.VSL_CD            = BV.VSL_CD" ).append("\n"); 
		query.append("               AND A.SKD_VOY_NO        = BV.SKD_VOY_NO" ).append("\n"); 
		query.append("               AND A.DIR_CD            = BV.SKD_DIR_CD" ).append("\n"); 
		query.append("               AND O.OFC_CD            = SPC_SCR_OFC_CONV_FNC(B.OB_SLS_OFC_CD)" ).append("\n"); 
		query.append("               AND DRL.RLANE_CD        = A.RLANE_CD" ).append("\n"); 
		query.append("               AND DRL.VSL_SLAN_DIR_CD = A.DIR_CD" ).append("\n"); 
		query.append("               AND DRL.IOC_CD          = A.IOC_CD" ).append("\n"); 
		query.append("               AND DRL.SUB_TRD_CD      = A.SUB_TRD_CD" ).append("\n"); 
		query.append("               AND DRL.DELT_FLG        = 'N'" ).append("\n"); 
		query.append("               AND DRL.FM_CONTI_CD     = (SELECT SPC_CONTI_CONV_FNC(L.CONTI_CD, A.RLANE_CD, A.DIR_CD)" ).append("\n"); 
		query.append("                                            FROM MDM_LOCATION L" ).append("\n"); 
		query.append("                                           WHERE L.LOC_CD = BV.POL_CD )" ).append("\n"); 
		query.append("               AND DRL.TO_CONTI_CD     = (SELECT SPC_CONTI_CONV_FNC(L.CONTI_CD, A.RLANE_CD, A.DIR_CD)" ).append("\n"); 
		query.append("                                            FROM MDM_LOCATION L" ).append("\n"); 
		query.append("                                           WHERE L.LOC_CD = BV.POD_CD )" ).append("\n"); 
		query.append("               AND A.COST_YR || A.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK" ).append("\n"); 
		query.append("#if (${area} != '')" ).append("\n"); 
		query.append("       AND A.AQ_CD             = O.N3RD_PRNT_OFC_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${sales_office} != '')" ).append("\n"); 
		query.append("       AND A.RGN_OFC_CD        = O.N4TH_PRNT_OFC_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("               AND (    ((A.RHQ_CD = 'SHARC' AND A.AQ_CD IS NULL AND A.RGN_OFC_CD IS NULL AND  A.RHQ_CD = O.N2ND_PRNT_OFC_CD) AND DRL.FM_CONTI_CD = 'A')" ).append("\n"); 
		query.append("                     OR A.RHQ_CD <> 'SHARC'" ).append("\n"); 
		query.append("                     OR A.AQ_CD      IS NOT NULL" ).append("\n"); 
		query.append("                     OR A.RGN_OFC_CD IS NOT NULL ) " ).append("\n"); 
		query.append("               AND B.CTRT_CUST_CNT_CD  = G.CUST_CNT_CD" ).append("\n"); 
		query.append("               AND B.CTRT_CUST_SEQ     = G.CUST_SEQ" ).append("\n"); 
		query.append("#if(${grp_acct} != '')" ).append("\n"); 
		query.append("       AND NVL(G.CUST_GRP_ID, 'X') IN (${grp_acct}) " ).append("\n"); 
		query.append("#end    " ).append("\n"); 
		query.append("#if(${acct} != '')" ).append("\n"); 
		query.append("       AND B.CTRT_CUST_CNT_CD||TO_CHAR(B.CTRT_CUST_SEQ, 'FM000000') IN (${acct})" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("               AND B.BKG_NO            = BC.BKG_NO  " ).append("\n"); 
		query.append("               AND BC.BKG_CUST_TP_CD   = 'S'        " ).append("\n"); 
		query.append("               AND A.TRD_CD            IN ('AES', 'IAS') " ).append("\n"); 
		query.append("               AND DECODE(SUBSTR(B.RFA_NO, 1, 3), 'DUM', '', B.RFA_NO) IS NULL " ).append("\n"); 
		query.append("               AND BC.CUST_CNT_CD      = 'CN' " ).append("\n"); 
		query.append("               AND B.SC_NO            IS NULL  " ).append("\n"); 
		query.append("             ) B,RFA_BKG_DATA RD" ).append("\n"); 
		query.append("        WHERE B.SHP_CUST_CD = RD.SHP_CUST_CD(+) " ).append("\n"); 
		query.append("         AND B.BKG_POL_CD  = RD.POL_CD(+)" ).append("\n"); 
		query.append("         AND B.BKG_POD_CD  = RD.POD_CD(+)" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append(", BKG_DATA1 AS (         " ).append("\n"); 
		query.append("  SELECT TRD_CD      ," ).append("\n"); 
		query.append("         SUB_TRD_CD  ," ).append("\n"); 
		query.append("         RLANE_CD    ," ).append("\n"); 
		query.append("         COST_YRWK   ," ).append("\n"); 
		query.append("         NUM         ," ).append("\n"); 
		query.append("         VSL_CD||SKD_VOY_NO||DIR_CD AS VVD_CD," ).append("\n"); 
		query.append("         IOC_CD      ," ).append("\n"); 
		query.append("         LOAD_OFC_CD ," ).append("\n"); 
		query.append("         SC_NO       ," ).append("\n"); 
		query.append("         RFA_NO      ," ).append("\n"); 
		query.append("         CTRT_OFC_CD ," ).append("\n"); 
		query.append("         CUST_GRP_ID ," ).append("\n"); 
		query.append("         MDL_CUST_CNT," ).append("\n"); 
		query.append("         MDL_CUST_SEQ," ).append("\n"); 
		query.append("         MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("         CUST_CNT_CD ," ).append("\n"); 
		query.append("         CUST_SEQ    , " ).append("\n"); 
		query.append("         SUM(BKG_QTY) AS BKG_QTY," ).append("\n"); 
		query.append("         SUM(MAS_QTY) MAS_QTY," ).append("\n"); 
		query.append("         SUM(MAS_CM) MAS_CM" ).append("\n"); 
		query.append("    FROM BKG_DATA B" ).append("\n"); 
		query.append("   GROUP BY TRD_CD   ," ).append("\n"); 
		query.append("         SUB_TRD_CD  ," ).append("\n"); 
		query.append("         RLANE_CD    ," ).append("\n"); 
		query.append("         COST_YRWK   ," ).append("\n"); 
		query.append("         NUM         ," ).append("\n"); 
		query.append("         VSL_CD      ," ).append("\n"); 
		query.append("         SKD_VOY_NO  ," ).append("\n"); 
		query.append("         DIR_CD      ," ).append("\n"); 
		query.append("         IOC_CD      ," ).append("\n"); 
		query.append("         LOAD_OFC_CD ," ).append("\n"); 
		query.append("         SC_NO       ," ).append("\n"); 
		query.append("         RFA_NO      ," ).append("\n"); 
		query.append("         CTRT_OFC_CD ," ).append("\n"); 
		query.append("         CUST_GRP_ID ," ).append("\n"); 
		query.append("         MDL_CUST_CNT," ).append("\n"); 
		query.append("         MDL_CUST_SEQ," ).append("\n"); 
		query.append("         MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("         CUST_CNT_CD ," ).append("\n"); 
		query.append("         CUST_SEQ" ).append("\n"); 
		query.append(")        " ).append("\n"); 
		query.append(", FCT_DATA AS (" ).append("\n"); 
		query.append("    SELECT CUST_GRP_ID ," ).append("\n"); 
		query.append("           MDL_CUST_CNT," ).append("\n"); 
		query.append("           MDL_CUST_SEQ," ).append("\n"); 
		query.append("           MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("           CUST_CNT_CD ," ).append("\n"); 
		query.append("           CUST_SEQ    ," ).append("\n"); 
		query.append("           SC_NO       ," ).append("\n"); 
		query.append("           RFA_NO      ," ).append("\n"); 
		query.append("           LOAD_OFC_CD ," ).append("\n"); 
		query.append("           TRD_CD      ," ).append("\n"); 
		query.append("           SUB_TRD_CD  ," ).append("\n"); 
		query.append("           RLANE_CD    ," ).append("\n"); 
		query.append("           IOC_CD      ," ).append("\n"); 
		query.append("           VVD_CD      ," ).append("\n"); 
		query.append("           NUM         ," ).append("\n"); 
		query.append("           COST_YRWK   ," ).append("\n"); 
		query.append("           WK_DAY      ," ).append("\n"); 
		query.append("           0              AS MAX_QTY    ," ).append("\n"); 
		query.append("           SUM(FCAST_QTY) AS FCAST_QTY  ," ).append("\n"); 
		query.append("           0              AS BKG_QTY    ," ).append("\n"); 
		query.append("           0              AS BKG_AVG_QTY" ).append("\n"); 
		query.append("      FROM (" ).append("\n"); 
		query.append("              SELECT DISTINCT" ).append("\n"); 
		query.append("                     C.CUST_GRP_ID  ," ).append("\n"); 
		query.append("                     NVL(SRC.CUST_CNT_CD, 'XX') AS MDL_CUST_CNT," ).append("\n"); 
		query.append("                     NVL(SRC.CUST_SEQ, 999999 ) AS MDL_CUST_SEQ," ).append("\n"); 
		query.append("                     NVL(SRC.CUST_CTRL_CD, 'C') AS MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("                     F.CUST_CNT_CD   ," ).append("\n"); 
		query.append("                     F.CUST_SEQ      ," ).append("\n"); 
		query.append("                     F.SC_NO         ," ).append("\n"); 
		query.append("                     F.RFA_NO        ," ).append("\n"); 
		query.append("                     F.SLS_RGN_OFC_CD AS LOAD_OFC_CD," ).append("\n"); 
		query.append("                     F.TRD_CD        ," ).append("\n"); 
		query.append("                     F.SUB_TRD_CD    ," ).append("\n"); 
		query.append("                     F.RLANE_CD      ," ).append("\n"); 
		query.append("                     A.IOC_CD        ," ).append("\n"); 
		query.append("                     F.VSL_CD||F.SKD_VOY_NO||F.SKD_DIR_CD AS VVD_CD," ).append("\n"); 
		query.append("                     A.NUM," ).append("\n"); 
		query.append("                     A.COST_YR||A.COST_WK AS COST_YRWK, " ).append("\n"); 
		query.append("                     A.WK_DAY," ).append("\n"); 
		query.append("                     NVL(F.CFM_TTL_QTY,0) + (NVL(CFM_40FT_HC_QTY, 0) + NVL(CFM_45FT_HC_QTY, 0) + NVL(CFM_53FT_QTY, 0) ) * 2 AS FCAST_QTY" ).append("\n"); 
		query.append("                     ,F.DIR_CD, F.SREP_USR_ID, F.POL_YD_CD, F.POD_YD_CD, F.FCAST_OFC_CD, F.FCAST_CUST_TP_CD, F.FCAST_SEQ, F.USA_BKG_MOD_CD, F.DEST_LOC_CD " ).append("\n"); 
		query.append("              FROM MAS_MON_VVD_LV     A  ," ).append("\n"); 
		query.append("                   SPC_DLY_FCAST_CUST F  ," ).append("\n"); 
		query.append("                   SREP_LIST          SRC, " ).append("\n"); 
		query.append("                   MDM_CUSTOMER       C" ).append("\n"); 
		query.append("             WHERE A.TRD_CD      = F.TRD_CD" ).append("\n"); 
		query.append("               AND A.RLANE_CD    = F.RLANE_CD" ).append("\n"); 
		query.append("               AND A.IOC_CD      = F.IOC_TS_CD" ).append("\n"); 
		query.append("               AND A.VSL_CD      = F.VSL_CD" ).append("\n"); 
		query.append("               AND A.SKD_VOY_NO  = F.SKD_VOY_NO" ).append("\n"); 
		query.append("               AND A.DIR_CD      = F.SKD_DIR_CD" ).append("\n"); 
		query.append("               AND A.DIR_CD      = F.DIR_CD" ).append("\n"); 
		query.append("               AND A.RHQ_CD      = F.SLS_RHQ_CD" ).append("\n"); 
		query.append("               AND F.CUST_CNT_CD = C.CUST_CNT_CD" ).append("\n"); 
		query.append("               AND F.CUST_SEQ    = C.CUST_SEQ" ).append("\n"); 
		query.append("#if(${grp_acct} != '')" ).append("\n"); 
		query.append("               AND NVL(C.CUST_GRP_ID, 'X') IN (${grp_acct})" ).append("\n"); 
		query.append("#end    " ).append("\n"); 
		query.append("#if(${acct} != '')" ).append("\n"); 
		query.append("               AND F.CUST_CNT_CD||TO_CHAR(F.CUST_SEQ, 'FM000000') IN (${acct})" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${rhq} != '')" ).append("\n"); 
		query.append("               AND (    (     A.RHQ_CD = 'SHARC'" ).append("\n"); 
		query.append("                          AND EXISTS ( SELECT 1" ).append("\n"); 
		query.append("                                         FROM MDM_LOCATION L" ).append("\n"); 
		query.append("                                        WHERE SUBSTR(F.POL_YD_CD, 1, 5) = L.LOC_CD" ).append("\n"); 
		query.append("                                          AND SPC_CONTI_CONV_FNC(L.CONTI_CD,A.RLANE_CD,A.DIR_CD) = 'A')" ).append("\n"); 
		query.append("                          AND A.RHQ_CD = F.SLS_RHQ_CD)  " ).append("\n"); 
		query.append("                     OR A.RHQ_CD = F.SLS_RHQ_CD)   " ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${area} != '')" ).append("\n"); 
		query.append("               AND A.AQ_CD       = F.SLS_AQ_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${sales_office} != '')" ).append("\n"); 
		query.append("               AND A.RGN_OFC_CD  = F.SLS_RGN_OFC_CD" ).append("\n"); 
		query.append("#end                " ).append("\n"); 
		query.append("               AND F.CUST_CNT_CD     = SRC.CUST_CNT_CD(+)" ).append("\n"); 
		query.append("               AND F.CUST_SEQ        = SRC.CUST_SEQ(+)" ).append("\n"); 
		query.append("               AND CASE WHEN F.SC_NO IS NOT NULL AND SRC.SC_NO(+) IS NOT NULL THEN F.SC_NO " ).append("\n"); 
		query.append("                        ELSE ( CASE WHEN F.RFA_NO IS NOT NULL AND SRC.RFA_NO(+) IS NOT NULL THEN F.RFA_NO" ).append("\n"); 
		query.append("                                    ELSE 'X' END)" ).append("\n"); 
		query.append("                   END = CASE WHEN F.SC_NO IS NOT NULL AND SRC.SC_NO(+) IS NOT NULL THEN SRC.SC_NO(+) " ).append("\n"); 
		query.append("                        ELSE ( CASE WHEN F.RFA_NO IS NOT NULL AND SRC.RFA_NO(+) IS NOT NULL THEN SRC.RFA_NO(+)" ).append("\n"); 
		query.append("                                    ELSE 'X' END)" ).append("\n"); 
		query.append("                   END" ).append("\n"); 
		query.append("           )" ).append("\n"); 
		query.append("  GROUP BY CUST_GRP_ID   ," ).append("\n"); 
		query.append("           MDL_CUST_CNT  ," ).append("\n"); 
		query.append("           MDL_CUST_SEQ  ," ).append("\n"); 
		query.append("           MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("           CUST_CNT_CD   ," ).append("\n"); 
		query.append("           CUST_SEQ      ," ).append("\n"); 
		query.append("           SC_NO         ," ).append("\n"); 
		query.append("           RFA_NO        ," ).append("\n"); 
		query.append("           LOAD_OFC_CD   ," ).append("\n"); 
		query.append("           TRD_CD        ," ).append("\n"); 
		query.append("           SUB_TRD_CD    ," ).append("\n"); 
		query.append("           RLANE_CD      ," ).append("\n"); 
		query.append("           IOC_CD        ," ).append("\n"); 
		query.append("           VVD_CD        ," ).append("\n"); 
		query.append("           NUM           ," ).append("\n"); 
		query.append("           COST_YRWK     ," ).append("\n"); 
		query.append("           WK_DAY" ).append("\n"); 
		query.append("    HAVING SUM(FCAST_QTY) <> 0" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", BASE_DATA AS (    " ).append("\n"); 
		query.append("    SELECT COST_YRWK   ," ).append("\n"); 
		query.append("           CUST_GRP_ID ," ).append("\n"); 
		query.append("           MDL_CUST_CNT," ).append("\n"); 
		query.append("           MDL_CUST_SEQ," ).append("\n"); 
		query.append("           MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("           CUST_CNT_CD ," ).append("\n"); 
		query.append("           CUST_SEQ    ," ).append("\n"); 
		query.append("           SC_NO       ," ).append("\n"); 
		query.append("           RFA_NO      ," ).append("\n"); 
		query.append("           CTRT_OFC_CD ," ).append("\n"); 
		query.append("           LOAD_OFC_CD ," ).append("\n"); 
		query.append("           TRD_CD      ," ).append("\n"); 
		query.append("           SUB_TRD_CD  ," ).append("\n"); 
		query.append("           RLANE_CD    ," ).append("\n"); 
		query.append("           IOC_CD      ," ).append("\n"); 
		query.append("           MIN(VVD_CD) AS VVD_CD1," ).append("\n"); 
		query.append("           MAX(VVD_CD) AS VVD_CD2," ).append("\n"); 
		query.append("           NUM," ).append("\n"); 
		query.append("           SUM(MAX_QTY)     AS MAX_QTY    ," ).append("\n"); 
		query.append("           SUM(CTRT_FCST)   AS CTRT_FCST  ," ).append("\n"); 
		query.append("           SUM(FCAST_QTY)   AS FCAST_QTY  ," ).append("\n"); 
		query.append("           SUM(BKG_QTY)     AS BKG_QTY    ," ).append("\n"); 
		query.append("           NVL((SELECT /*+ INDEX_DESC(M XPKSPC_MDL_VER_MST) */" ).append("\n"); 
		query.append("                       M.COST_YRWK||'-'||M.VER_SEQ AS SEASON" ).append("\n"); 
		query.append("                  FROM SPC_MDL_VER_MST M" ).append("\n"); 
		query.append("                 WHERE A.COST_YRWK BETWEEN M.VER_ST_YRWK AND M.VER_END_YRWK" ).append("\n"); 
		query.append("                   AND M.TRD_CD  = A.TRD_CD" ).append("\n"); 
		query.append("                   AND M.CFM_FLG = 'Y'" ).append("\n"); 
		query.append("                   AND ROWNUM = 1), '200001-1') AS SEASON," ).append("\n"); 
		query.append("		   " ).append("\n"); 
		query.append("           SUM(MAS_QTY) MAS_QTY," ).append("\n"); 
		query.append("           SUM(MAS_CM) MAS_CM" ).append("\n"); 
		query.append("      FROM (" ).append("\n"); 
		query.append("              SELECT 'F' F, COST_YRWK     ," ).append("\n"); 
		query.append("                     CUST_GRP_ID   ," ).append("\n"); 
		query.append("                     MDL_CUST_CNT  ," ).append("\n"); 
		query.append("                     MDL_CUST_SEQ  ," ).append("\n"); 
		query.append("                     MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("                     CUST_CNT_CD   ," ).append("\n"); 
		query.append("                     CUST_SEQ      ," ).append("\n"); 
		query.append("                     SC_NO         ," ).append("\n"); 
		query.append("                     RFA_NO        ," ).append("\n"); 
		query.append("                     NVL((SELECT MAX(CTRT_OFC_CD)" ).append("\n"); 
		query.append("                            FROM MDL_DATA" ).append("\n"); 
		query.append("                           WHERE COST_YRWK = F.COST_YRWK" ).append("\n"); 
		query.append("                             AND NVL(CUST_GRP_ID,'X') =NVL( F.CUST_GRP_ID,'X')" ).append("\n"); 
		query.append("                             AND MDL_CUST_CNT = F.MDL_CUST_CNT" ).append("\n"); 
		query.append("                             AND MDL_CUST_SEQ = F.MDL_CUST_SEQ" ).append("\n"); 
		query.append("                             AND MDL_CUST_CTRL_CD=F.MDL_CUST_CTRL_CD" ).append("\n"); 
		query.append("                             AND CUST_CNT_CD=F.CUST_CNT_CD" ).append("\n"); 
		query.append("                             AND CUST_SEQ=F.CUST_SEQ" ).append("\n"); 
		query.append("                             AND NVL(SC_NO, NVL(RFA_NO,'X')) = NVL(F.SC_NO, NVL(F.RFA_NO,'X'))" ).append("\n"); 
		query.append("                         ),(SELECT MAX(CTRT_OFC_CD)" ).append("\n"); 
		query.append("                            FROM CTRT_FCAST" ).append("\n"); 
		query.append("                           WHERE COST_YRWK = F.COST_YRWK" ).append("\n"); 
		query.append("                             AND NVL(CUST_GRP_ID,'X') =NVL( F.CUST_GRP_ID,'X')" ).append("\n"); 
		query.append("                             AND MDL_CUST_CNT = F.MDL_CUST_CNT" ).append("\n"); 
		query.append("                             AND MDL_CUST_SEQ = F.MDL_CUST_SEQ" ).append("\n"); 
		query.append("                             AND MDL_CUST_CTRL_CD=F.MDL_CUST_CTRL_CD" ).append("\n"); 
		query.append("                             AND CUST_CNT_CD=F.CUST_CNT_CD" ).append("\n"); 
		query.append("                             AND CUST_SEQ=F.CUST_SEQ" ).append("\n"); 
		query.append("                             AND NVL(SC_NO, NVL(RFA_NO,'X')) = NVL(F.SC_NO, NVL(F.RFA_NO,'X'))" ).append("\n"); 
		query.append("                         )" ).append("\n"); 
		query.append("                     ) AS CTRT_OFC_CD," ).append("\n"); 
		query.append("                     LOAD_OFC_CD   ," ).append("\n"); 
		query.append("                     TRD_CD        ," ).append("\n"); 
		query.append("                     SUB_TRD_CD    ," ).append("\n"); 
		query.append("                     RLANE_CD      ," ).append("\n"); 
		query.append("                     IOC_CD        ," ).append("\n"); 
		query.append("                     VVD_CD        ," ).append("\n"); 
		query.append("                     NUM           ," ).append("\n"); 
		query.append("                     0 AS MAX_QTY  ," ).append("\n"); 
		query.append("                     0 AS CTRT_FCST," ).append("\n"); 
		query.append("                     FCAST_QTY     ," ).append("\n"); 
		query.append("                     0 AS BKG_QTY  ," ).append("\n"); 
		query.append("                     0 AS MAS_QTY  ," ).append("\n"); 
		query.append("                     0 AS MAS_CM" ).append("\n"); 
		query.append("                FROM FCT_DATA F" ).append("\n"); 
		query.append("              UNION ALL" ).append("\n"); 
		query.append("              SELECT 'C' F, COST_YRWK     ," ).append("\n"); 
		query.append("                     CUST_GRP_ID   ," ).append("\n"); 
		query.append("                     MDL_CUST_CNT  ," ).append("\n"); 
		query.append("                     MDL_CUST_SEQ  ," ).append("\n"); 
		query.append("                     MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("                     CUST_CNT_CD   ," ).append("\n"); 
		query.append("                     CUST_SEQ      ," ).append("\n"); 
		query.append("                     SC_NO         ," ).append("\n"); 
		query.append("                     RFA_NO        ," ).append("\n"); 
		query.append("                     CTRT_OFC_CD   ," ).append("\n"); 
		query.append("                     LOAD_OFC_CD   ," ).append("\n"); 
		query.append("                     TRD_CD        ," ).append("\n"); 
		query.append("                     SUB_TRD_CD    ," ).append("\n"); 
		query.append("                     RLANE_CD      ," ).append("\n"); 
		query.append("                     IOC_CD        ," ).append("\n"); 
		query.append("                     VVD_CD        ," ).append("\n"); 
		query.append("                     NUM           ," ).append("\n"); 
		query.append("                     0 AS MAX_QTY  ," ).append("\n"); 
		query.append("                     CTRT_FCST     ," ).append("\n"); 
		query.append("                     0 AS FCAST_QTY," ).append("\n"); 
		query.append("                     0 AS BKG_QTY  ," ).append("\n"); 
		query.append("                     0 AS MAS_QTY  ," ).append("\n"); 
		query.append("                     0 AS MAS_CM" ).append("\n"); 
		query.append("                FROM CTRT_FCAST" ).append("\n"); 
		query.append("              UNION ALL" ).append("\n"); 
		query.append("              SELECT 'B' F,COST_YRWK     ," ).append("\n"); 
		query.append("                     CUST_GRP_ID   ," ).append("\n"); 
		query.append("                     MDL_CUST_CNT  ," ).append("\n"); 
		query.append("                     MDL_CUST_SEQ  ," ).append("\n"); 
		query.append("                     MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("                     CUST_CNT_CD   ," ).append("\n"); 
		query.append("                     CUST_SEQ      ," ).append("\n"); 
		query.append("                     SC_NO         ," ).append("\n"); 
		query.append("                     RFA_NO        ," ).append("\n"); 
		query.append("                     CTRT_OFC_CD   ," ).append("\n"); 
		query.append("                     LOAD_OFC_CD   ," ).append("\n"); 
		query.append("                     TRD_CD        ," ).append("\n"); 
		query.append("                     SUB_TRD_CD    ," ).append("\n"); 
		query.append("                     RLANE_CD      ," ).append("\n"); 
		query.append("                     IOC_CD        ," ).append("\n"); 
		query.append("                     VVD_CD        ," ).append("\n"); 
		query.append("                     NUM           ," ).append("\n"); 
		query.append("                     0 AS MAX_QTY  ," ).append("\n"); 
		query.append("                     0 AS CTRT_FCST," ).append("\n"); 
		query.append("                     0 AS FCAST_QTY," ).append("\n"); 
		query.append("                     BKG_QTY       ," ).append("\n"); 
		query.append("                     MAS_QTY       ," ).append("\n"); 
		query.append("                     MAS_CM" ).append("\n"); 
		query.append("                FROM BKG_DATA1" ).append("\n"); 
		query.append("              UNION ALL" ).append("\n"); 
		query.append("              SELECT 'M' F,COST_YRWK     ," ).append("\n"); 
		query.append("                     CUST_GRP_ID   ," ).append("\n"); 
		query.append("                     MDL_CUST_CNT  ," ).append("\n"); 
		query.append("                     MDL_CUST_SEQ  ," ).append("\n"); 
		query.append("                     MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("                     CUST_CNT_CD   ," ).append("\n"); 
		query.append("                     CUST_SEQ      ," ).append("\n"); 
		query.append("                     SC_NO         ," ).append("\n"); 
		query.append("                     RFA_NO        ," ).append("\n"); 
		query.append("                     CTRT_OFC_CD   ," ).append("\n"); 
		query.append("                     LOAD_OFC_CD   ," ).append("\n"); 
		query.append("                     TRD_CD        ," ).append("\n"); 
		query.append("                     SUB_TRD_CD    ," ).append("\n"); 
		query.append("                     RLANE_CD      ," ).append("\n"); 
		query.append("                     IOC_CD        ," ).append("\n"); 
		query.append("                     VVD_CD        ," ).append("\n"); 
		query.append("                     NUM           ," ).append("\n"); 
		query.append("                     MAX_QTY       ," ).append("\n"); 
		query.append("                     0 AS CTRT_FCST," ).append("\n"); 
		query.append("                     0 AS FCAST_QTY," ).append("\n"); 
		query.append("                     0 AS BKG_QTY  ," ).append("\n"); 
		query.append("                     0 AS MAS_QTY  ," ).append("\n"); 
		query.append("                     0 AS MAS_CM" ).append("\n"); 
		query.append("                FROM MDL_DATA" ).append("\n"); 
		query.append("           ) A" ).append("\n"); 
		query.append("  GROUP BY COST_YRWK   ," ).append("\n"); 
		query.append("           CUST_GRP_ID ," ).append("\n"); 
		query.append("           MDL_CUST_CNT," ).append("\n"); 
		query.append("           MDL_CUST_SEQ," ).append("\n"); 
		query.append("           MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("           CUST_CNT_CD ," ).append("\n"); 
		query.append("           CUST_SEQ    ," ).append("\n"); 
		query.append("           SC_NO       ," ).append("\n"); 
		query.append("           RFA_NO      ," ).append("\n"); 
		query.append("           CTRT_OFC_CD ," ).append("\n"); 
		query.append("           LOAD_OFC_CD ," ).append("\n"); 
		query.append("           TRD_CD      ," ).append("\n"); 
		query.append("           SUB_TRD_CD  ," ).append("\n"); 
		query.append("           RLANE_CD    ," ).append("\n"); 
		query.append("           IOC_CD      ," ).append("\n"); 
		query.append("           NUM" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", BKG_AVG AS (" ).append("\n"); 
		query.append("    SELECT B.CUST_GRP_ID ," ).append("\n"); 
		query.append("           B.MDL_CUST_CNT," ).append("\n"); 
		query.append("           B.MDL_CUST_SEQ," ).append("\n"); 
		query.append("           B.MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("           B.MDL_CUST_CNT AS CUST_CNT_CD," ).append("\n"); 
		query.append("           B.MDL_CUST_SEQ AS CUST_SEQ," ).append("\n"); 
		query.append("           B.SC_NO       ," ).append("\n"); 
		query.append("           B.RFA_NO      ," ).append("\n"); 
		query.append("           B.CTRT_OFC_CD ," ).append("\n"); 
		query.append("           B.LOAD_OFC_CD ," ).append("\n"); 
		query.append("           B.TRD_CD      ," ).append("\n"); 
		query.append("           B.SUB_TRD_CD  ," ).append("\n"); 
		query.append("           B.RLANE_CD    ," ).append("\n"); 
		query.append("           B.IOC_CD      ," ).append("\n"); 
		query.append("           B.VVD_CD1     ," ).append("\n"); 
		query.append("           B.VVD_CD2     ," ).append("\n"); 
		query.append("           B.NUM         ," ).append("\n"); 
		query.append("           B.COST_YRWK   ," ).append("\n"); 
		query.append("           A.BKG_AVG_TEU_QTY AS BKG_AVG_QTY" ).append("\n"); 
		query.append("      FROM SPC_BKG_AVG_QTY A," ).append("\n"); 
		query.append("           BASE_DATA B" ).append("\n"); 
		query.append("     WHERE B.COST_YRWK >= A.COST_YRWK" ).append("\n"); 
		query.append("       AND B.TRD_CD    = A.TRD_CD" ).append("\n"); 
		query.append("       AND B.RLANE_CD  = A.RLANE_CD" ).append("\n"); 
		query.append("       AND B.IOC_CD    = DECODE(A.IOC_TS_CD, 'T', 'I', A.IOC_TS_CD)" ).append("\n"); 
		query.append("       AND B.LOAD_OFC_CD  = A.SLS_OFC_CD" ).append("\n"); 
		query.append("       AND B.MDL_CUST_CNT = A.CUST_CNT_CD" ).append("\n"); 
		query.append("       AND B.MDL_CUST_SEQ = A.CUST_SEQ" ).append("\n"); 
		query.append("       AND CASE WHEN B.SC_NO IS NOT NULL AND A.SC_NO IS NOT NULL THEN SPC_GET_SMP_AMEND_FNC(B.TRD_CD, SUBSTR(B.SEASON, 1, 6), SUBSTR(B.SEASON, 8), A.SC_NO)" ).append("\n"); 
		query.append("                ELSE ( CASE WHEN B.RFA_NO IS NOT NULL AND A.RFA_NO IS NOT NULL THEN SPC_GET_SMP_AMEND_FNC(B.TRD_CD, SUBSTR(B.SEASON, 1, 6), SUBSTR(B.SEASON, 8), A.RFA_NO)" ).append("\n"); 
		query.append("                            ELSE 'X' END)" ).append("\n"); 
		query.append("           END = CASE WHEN B.SC_NO IS NOT NULL AND A.SC_NO IS NOT NULL THEN B.SC_NO " ).append("\n"); 
		query.append("                ELSE ( CASE WHEN B.RFA_NO IS NOT NULL AND A.RFA_NO IS NOT NULL THEN B.RFA_NO" ).append("\n"); 
		query.append("                            ELSE 'X' END)" ).append("\n"); 
		query.append("           END       " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("       AND A.COST_YRWK    = (SELECT /*+ INDEX_DESC(A XPKSPC_BKG_AVG_QTY) */" ).append("\n"); 
		query.append("                                    COST_YRWK" ).append("\n"); 
		query.append("                               FROM SPC_BKG_AVG_QTY A" ).append("\n"); 
		query.append("                              WHERE A.COST_YRWK <= B.COST_YRWK" ).append("\n"); 
		query.append("                                AND A.TRD_CD = B.TRD_CD" ).append("\n"); 
		query.append("                                AND A.RLANE_CD = B.RLANE_CD" ).append("\n"); 
		query.append("                                AND DECODE(A.IOC_TS_CD, 'T', 'I', A.IOC_TS_CD) = B.IOC_CD" ).append("\n"); 
		query.append("                                AND ROWNUM    = 1 )" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append(", QTA_DATA_SUM AS (" ).append("\n"); 
		query.append("    SELECT TRD_CD, NVL(SUB_TRD_CD, 'TTL') SUB_TRD_CD, NUM, SUM(LOD_QTY) LOD_QTY FROM (" ).append("\n"); 
		query.append("        SELECT V.TRD_CD    ," ).append("\n"); 
		query.append("               V.SUB_TRD_CD," ).append("\n"); 
		query.append("               V.RLANE_CD  ," ).append("\n"); 
		query.append("               V.DIR_CD    ," ).append("\n"); 
		query.append("               MQ.RGN_OFC_CD        AS RGN_OFC_CD," ).append("\n"); 
		query.append("               V.VSL_CD," ).append("\n"); 
		query.append("               V.SKD_VOY_NO," ).append("\n"); 
		query.append("               V.SKD_DIR_CD," ).append("\n"); 
		query.append("               NVL(SUBSTR(V.SLS_YRMON, 1, 4), 'TTL') AS COST_YR," ).append("\n"); 
		query.append("               V.COST_WK , V.NUM, " ).append("\n"); 
		query.append("               SUM(MQ.LOD_QTY) AS LOD_QTY" ).append("\n"); 
		query.append("          FROM SQM_QTA_RLSE_VER MQR," ).append("\n"); 
		query.append("               SQM_CFM_QTA      MQ ," ).append("\n"); 
		query.append("               MAS_MON_VVD_LV   V," ).append("\n"); 
		query.append("               SPC_OFC_LVL      OL" ).append("\n"); 
		query.append("         WHERE 1=1 " ).append("\n"); 
		query.append("           AND MQR.BSE_YR          = V.BSE_YR" ).append("\n"); 
		query.append("           AND MQR.BSE_QTR_CD  = V.BSE_QTR_CD           " ).append("\n"); 
		query.append("           AND MQR.SQM_VER_STS_CD  = 'R' " ).append("\n"); 
		query.append("           AND MQR.BSE_TP_CD       = 'Q'" ).append("\n"); 
		query.append("           AND MQ.QTA_RLSE_VER_NO  = MQR.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("           AND MQ.BSE_TP_CD        = MQR.BSE_TP_CD " ).append("\n"); 
		query.append("           AND MQ.BSE_YR           = MQR.BSE_YR" ).append("\n"); 
		query.append("           AND MQ.BSE_QTR_CD       = MQR.BSE_QTR_CD" ).append("\n"); 
		query.append("           AND MQ.QTA_TGT_CD       = 'D' " ).append("\n"); 
		query.append("           AND MQ.OFC_VW_CD        = 'L'  " ).append("\n"); 
		query.append("           AND MQ.TRD_CD           = V.TRD_CD" ).append("\n"); 
		query.append("           AND MQ.RLANE_CD         = V.RLANE_CD" ).append("\n"); 
		query.append("           AND MQ.DIR_CD           = V.DIR_CD" ).append("\n"); 
		query.append("           AND MQ.VSL_CD           = V.VSL_CD" ).append("\n"); 
		query.append("           AND MQ.SKD_VOY_NO       = V.SKD_VOY_NO" ).append("\n"); 
		query.append("           AND MQ.SKD_DIR_CD       = V.SKD_DIR_CD" ).append("\n"); 
		query.append("           AND MQ.RLANE_CD         = MQ.RLANE_CD" ).append("\n"); 
		query.append("#if (${rhq} != '' || ${area} != '' || ${sales_office} != '')" ).append("\n"); 
		query.append("       AND (    (V.RHQ_CD = 'SHARC' AND V.AQ_CD IS NULL AND V.RGN_OFC_CD IS NULL) " ).append("\n"); 
		query.append("             OR EXISTS ( SELECT O.OFC_CD" ).append("\n"); 
		query.append("                           FROM SPC_OFC_LVL O" ).append("\n"); 
		query.append("                          WHERE O.OFC_TP_CD IN ('BB', 'BA', 'BS')" ).append("\n"); 
		query.append("                            AND SPC_SCR_OFC_CONV_FNC(MQ.RGN_OFC_CD) = O.OFC_CD" ).append("\n"); 
		query.append("						    AND V.RHQ_CD = O.N2ND_PRNT_OFC_CD" ).append("\n"); 
		query.append("                            AND V.COST_YR || V.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK" ).append("\n"); 
		query.append("                     CONNECT BY NOCYCLE O.PRNT_OFC_CD = PRIOR O.OFC_CD" ).append("\n"); 
		query.append("                             START WITH (V.RGN_OFC_CD IS NULL AND O.PRNT_OFC_CD = NVL(V.AQ_CD, V.RHQ_CD)) OR (O.OFC_CD = V.RGN_OFC_CD)))" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("           AND V.COST_YR || V.COST_WK BETWEEN OL.OFC_APLY_FM_YRWK AND OL.OFC_APLY_TO_YRWK" ).append("\n"); 
		query.append("           AND V.RHQ_CD = OL.N2ND_PRNT_OFC_CD" ).append("\n"); 
		query.append("           AND NVL((SELECT O2.CONV_RGN_OFC_CD" ).append("\n"); 
		query.append("                    FROM SPC_RGN_OFC_CONV O2" ).append("\n"); 
		query.append("                   WHERE O2.SLS_RGN_OFC_CD = MQ.RGN_OFC_CD), MQ.RGN_OFC_CD) = OL.OFC_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("      GROUP BY V.TRD_CD     ," ).append("\n"); 
		query.append("               V.SUB_TRD_CD ," ).append("\n"); 
		query.append("               V.RLANE_CD   ," ).append("\n"); 
		query.append("               V.DIR_CD     ," ).append("\n"); 
		query.append("               MQ.RGN_OFC_CD," ).append("\n"); 
		query.append("               SUBSTR(V.SLS_YRMON, 1, 4)," ).append("\n"); 
		query.append("               V.COST_WK    ," ).append("\n"); 
		query.append("               V.VSL_CD     ," ).append("\n"); 
		query.append("               V.SKD_VOY_NO ," ).append("\n"); 
		query.append("               V.SKD_DIR_CD ,V.NUM" ).append("\n"); 
		query.append("    ) GROUP BY GROUPING SETS ((TRD_CD), (TRD_CD, SUB_TRD_CD))" ).append("\n"); 
		query.append("         , NUM" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", MDL_DATA_SUM AS (" ).append("\n"); 
		query.append("    SELECT TRD_CD" ).append("\n"); 
		query.append("         , NVL(SUB_TRD_CD, 'TTL') SUB_TRD_CD" ).append("\n"); 
		query.append("         , NUM" ).append("\n"); 
		query.append("         , SUM(MAX_QTY) GUIDE_QTY" ).append("\n"); 
		query.append("      FROM MDL_DATA" ).append("\n"); 
		query.append("     GROUP BY GROUPING SETS ((TRD_CD), (TRD_CD, SUB_TRD_CD))" ).append("\n"); 
		query.append("         , NUM" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", BKG_QTY_SUM AS (" ).append("\n"); 
		query.append("    SELECT TRD_CD" ).append("\n"); 
		query.append("         , NVL(SUB_TRD_CD, 'TTL') SUB_TRD_CD" ).append("\n"); 
		query.append("         , NUM" ).append("\n"); 
		query.append("         , SUM(BKG_QTY) BKG_QTY" ).append("\n"); 
		query.append("      FROM BASE_DATA" ).append("\n"); 
		query.append("     GROUP BY GROUPING SETS ((TRD_CD), (TRD_CD, SUB_TRD_CD))" ).append("\n"); 
		query.append("         , NUM" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", C_GUIDE_TTL AS (" ).append("\n"); 
		query.append("SELECT Q.TRD_CD" ).append("\n"); 
		query.append("     , Q.SUB_TRD_CD" ).append("\n"); 
		query.append("     , Q.NUM" ).append("\n"); 
		query.append("     , B.BKG_QTY" ).append("\n"); 
		query.append("     , Q.LOD_QTY" ).append("\n"); 
		query.append("     , Q.LOD_QTY - G.GUIDE_QTY C_QTY" ).append("\n"); 
		query.append("  FROM QTA_DATA_SUM Q" ).append("\n"); 
		query.append("     , MDL_DATA_SUM G" ).append("\n"); 
		query.append("     , BKG_QTY_SUM B" ).append("\n"); 
		query.append(" WHERE Q.TRD_CD = G.TRD_CD" ).append("\n"); 
		query.append("   AND Q.SUB_TRD_CD = G.SUB_TRD_CD" ).append("\n"); 
		query.append("   AND Q.NUM = G.NUM" ).append("\n"); 
		query.append("   AND Q.TRD_CD = B.TRD_CD" ).append("\n"); 
		query.append("   AND Q.SUB_TRD_CD = B.SUB_TRD_CD" ).append("\n"); 
		query.append("   AND Q.NUM = B.NUM" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", BASE_DATA1 AS (" ).append("\n"); 
		query.append("    SELECT TRD_CD      ," ).append("\n"); 
		query.append("		   'X' CUST_CLSS," ).append("\n"); 
		query.append("           NVL(CUST_GRP_ID, MDL_CUST_CNT||TO_CHAR(MDL_CUST_SEQ, 'FM000000')) AS CUST_GRP_ID ," ).append("\n"); 
		query.append("           ACCT_TP     ," ).append("\n"); 
		query.append("           MDL_CUST_CNT," ).append("\n"); 
		query.append("           MDL_CUST_SEQ," ).append("\n"); 
		query.append("           MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("           CUST_CNT_CD ," ).append("\n"); 
		query.append("           CUST_SEQ    ," ).append("\n"); 
		query.append("           SC_NO       ," ).append("\n"); 
		query.append("           RFA_NO      ," ).append("\n"); 
		query.append("           CTRT_OFC_CD ," ).append("\n"); 
		query.append("           LOAD_OFC_CD ," ).append("\n"); 
		query.append("           SUB_TRD_CD  ," ).append("\n"); 
		query.append("           RLANE_CD    ," ).append("\n"); 
		query.append("#set($primate = 'new_dur')" ).append("\n"); 
		query.append("#if(${duration} == '1')" ).append("\n"); 
		query.append("	#set($new_dur = ['1'])" ).append("\n"); 
		query.append("#elseif(${duration} == '2')" ).append("\n"); 
		query.append("	#set($new_dur = ['1','2'])" ).append("\n"); 
		query.append("#elseif(${duration} == '3')" ).append("\n"); 
		query.append("	#set($new_dur = ['1','2','3'])" ).append("\n"); 
		query.append("#elseif(${duration} == '4')" ).append("\n"); 
		query.append("	#set($new_dur = ['1','2','3','4'])" ).append("\n"); 
		query.append("#elseif(${duration} == '5')" ).append("\n"); 
		query.append("	#set($new_dur = ['1','2','3','4','5'])" ).append("\n"); 
		query.append("#elseif(${duration} == '6')" ).append("\n"); 
		query.append("	#set($new_dur = ['1','2','3','4','5','6'])" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#foreach( $key in $new_dur )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("           MAX(DECODE(NUM, ${key}, DECODE(VVD_CD1, VVD_CD2, VVD_CD1, VVD_CD1||'/'||VVD_CD2))) AS VVD${key}," ).append("\n"); 
		query.append("           SUM(DECODE(NUM, ${key}, MAX_QTY    , 0)) AS MAX_QTY${key}1    ," ).append("\n"); 
		query.append("           SUM(DECODE(NUM, ${key}, CTRT_FCST  , 0)) AS CTRT_FCST${key}1  ," ).append("\n"); 
		query.append("           SUM(DECODE(NUM, ${key}, FCAST_QTY  , 0)) AS FCAST_QTY${key}1  ," ).append("\n"); 
		query.append("           SUM(DECODE(NUM, ${key}, BKG_QTY    , 0)) AS BKG_QTY${key}1    ," ).append("\n"); 
		query.append("           SUM(DECODE(NUM, ${key}, BKG_AVG_QTY, 0)) AS BKG_AVG_QTY${key}1," ).append("\n"); 
		query.append("		   " ).append("\n"); 
		query.append("		   SUM(DECODE(NUM, ${key}, MAS_QTY, 0)) AS MAS_QTY${key}1," ).append("\n"); 
		query.append("           SUM(DECODE(NUM, ${key}, MAS_CM, 0)) AS MAS_CM${key}1," ).append("\n"); 
		query.append("           (SELECT LOD_QTY FROM C_GUIDE_TTL C WHERE C.TRD_CD = T.TRD_CD AND C.SUB_TRD_CD  = T.SUB_TRD_CD AND C.NUM = ${key}) AS TTL_LOD_QTY${key}1," ).append("\n"); 
		query.append("           (SELECT C_QTY FROM C_GUIDE_TTL C WHERE C.TRD_CD = T.TRD_CD AND C.SUB_TRD_CD  = T.SUB_TRD_CD AND C.NUM = ${key}) AS C_LOD_QTY${key}1," ).append("\n"); 
		query.append("           (SELECT LOD_QTY FROM C_GUIDE_TTL C WHERE C.TRD_CD = T.TRD_CD AND C.SUB_TRD_CD  = 'TTL' AND C.NUM = ${key}) AS T_TTL_LOD_QTY${key}1," ).append("\n"); 
		query.append("           (SELECT C_QTY FROM C_GUIDE_TTL C WHERE C.TRD_CD = T.TRD_CD AND C.SUB_TRD_CD  = 'TTL'  AND C.NUM = ${key}) AS T_C_LOD_QTY${key}1," ).append("\n"); 
		query.append("           (SELECT BKG_QTY FROM C_GUIDE_TTL C WHERE C.TRD_CD = T.TRD_CD AND C.SUB_TRD_CD  = T.SUB_TRD_CD AND C.NUM = ${key}) AS TTL_BKG_QTY${key}1," ).append("\n"); 
		query.append("           (SELECT BKG_QTY FROM C_GUIDE_TTL C WHERE C.TRD_CD = T.TRD_CD AND C.SUB_TRD_CD  = 'TTL'  AND C.NUM = ${key}) AS T_TTL_BKG_QTY${key}1," ).append("\n"); 
		query.append("           " ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("           ''" ).append("\n"); 
		query.append("      FROM (" ).append("\n"); 
		query.append("              SELECT " ).append("\n"); 
		query.append("                     C1.RVIS_CNTR_CUST_TP_CD AS ACCT_TP," ).append("\n"); 
		query.append("                     C1.CUST_GRP_ID AS CUST_GRP_ID," ).append("\n"); 
		query.append("                     B.MDL_CUST_CNT," ).append("\n"); 
		query.append("                     B.MDL_CUST_SEQ," ).append("\n"); 
		query.append("                     B.MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("                     B.CUST_CNT_CD ," ).append("\n"); 
		query.append("                     B.CUST_SEQ    ," ).append("\n"); 
		query.append("                     B.SC_NO       ," ).append("\n"); 
		query.append("                     B.RFA_NO      ," ).append("\n"); 
		query.append("                     B.CTRT_OFC_CD ," ).append("\n"); 
		query.append("                     B.LOAD_OFC_CD ," ).append("\n"); 
		query.append("                     B.TRD_CD      ," ).append("\n"); 
		query.append("                     B.SUB_TRD_CD  ," ).append("\n"); 
		query.append("                     B.RLANE_CD    ," ).append("\n"); 
		query.append("                     B.VVD_CD1     ," ).append("\n"); 
		query.append("                     B.VVD_CD2     ," ).append("\n"); 
		query.append("                     B.NUM         ," ).append("\n"); 
		query.append("                     B.MAX_QTY     ," ).append("\n"); 
		query.append("                     B.CTRT_FCST   ," ).append("\n"); 
		query.append("                     B.FCAST_QTY   ," ).append("\n"); 
		query.append("                     B.BKG_QTY     ," ).append("\n"); 
		query.append("                     0 AS BKG_AVG_QTY," ).append("\n"); 
		query.append("					 B.MAS_CM     ," ).append("\n"); 
		query.append("					 B.MAS_QTY     " ).append("\n"); 
		query.append("                FROM BASE_DATA    B," ).append("\n"); 
		query.append("                     MDM_CUSTOMER C," ).append("\n"); 
		query.append("                     MDM_CUSTOMER C1" ).append("\n"); 
		query.append("               WHERE B.CUST_CNT_CD  = C.CUST_CNT_CD" ).append("\n"); 
		query.append("                 AND B.CUST_SEQ     = C.CUST_SEQ" ).append("\n"); 
		query.append("                 AND B.MDL_CUST_CNT = C1.CUST_CNT_CD" ).append("\n"); 
		query.append("                 AND B.MDL_CUST_SEQ = C1.CUST_SEQ" ).append("\n"); 
		query.append("              UNION ALL" ).append("\n"); 
		query.append("              SELECT " ).append("\n"); 
		query.append("                     C.RVIS_CNTR_CUST_TP_CD AS ACCT_TP," ).append("\n"); 
		query.append("                     C.CUST_GRP_ID AS CUST_GRP_ID," ).append("\n"); 
		query.append("                     B.MDL_CUST_CNT  ," ).append("\n"); 
		query.append("                     B.MDL_CUST_SEQ  ," ).append("\n"); 
		query.append("                     B.MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("                     B.CUST_CNT_CD   ," ).append("\n"); 
		query.append("                     B.CUST_SEQ      ," ).append("\n"); 
		query.append("                     B.SC_NO         ," ).append("\n"); 
		query.append("                     B.RFA_NO        ," ).append("\n"); 
		query.append("                     B.CTRT_OFC_CD   ," ).append("\n"); 
		query.append("                     B.LOAD_OFC_CD   ," ).append("\n"); 
		query.append("                     B.TRD_CD        ," ).append("\n"); 
		query.append("                     B.SUB_TRD_CD    ," ).append("\n"); 
		query.append("                     B.RLANE_CD      ," ).append("\n"); 
		query.append("                     B.VVD_CD1       ," ).append("\n"); 
		query.append("                     B.VVD_CD2       ," ).append("\n"); 
		query.append("                     B.NUM           ," ).append("\n"); 
		query.append("                     0 AS MAX_QTY    ," ).append("\n"); 
		query.append("                     0 AS CTRT_FCST  ," ).append("\n"); 
		query.append("                     0 AS FCAST_QTY  ," ).append("\n"); 
		query.append("                     0 AS BKG_QTY    ," ).append("\n"); 
		query.append("                     B.BKG_AVG_QTY," ).append("\n"); 
		query.append("					 0 AS MAS_CM     ," ).append("\n"); 
		query.append("					 0 AS MAS_QTY     					 " ).append("\n"); 
		query.append("                FROM BKG_AVG      B," ).append("\n"); 
		query.append("                     MDM_CUSTOMER C" ).append("\n"); 
		query.append("               WHERE B.MDL_CUST_CNT = C.CUST_CNT_CD" ).append("\n"); 
		query.append("                 AND B.MDL_CUST_SEQ = C.CUST_SEQ" ).append("\n"); 
		query.append("           ) T" ).append("\n"); 
		query.append("  WHERE 1=1" ).append("\n"); 
		query.append("  GROUP BY TRD_CD      ," ).append("\n"); 
		query.append("           ACCT_TP     ," ).append("\n"); 
		query.append("           CUST_GRP_ID ," ).append("\n"); 
		query.append("           MDL_CUST_CNT," ).append("\n"); 
		query.append("           MDL_CUST_SEQ," ).append("\n"); 
		query.append("           MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("           CUST_CNT_CD ," ).append("\n"); 
		query.append("           CUST_SEQ    ," ).append("\n"); 
		query.append("           SC_NO       ," ).append("\n"); 
		query.append("           RFA_NO      ," ).append("\n"); 
		query.append("           CTRT_OFC_CD ," ).append("\n"); 
		query.append("           LOAD_OFC_CD ," ).append("\n"); 
		query.append("           SUB_TRD_CD  ," ).append("\n"); 
		query.append("           RLANE_CD" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${view_type11} == 'ACCT')" ).append("\n"); 
		query.append("-- Acct 선택시" ).append("\n"); 
		query.append("SELECT * FROM" ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("  SELECT 1 ORD, TRD_CD      , CUST_CLSS," ).append("\n"); 
		query.append("         MAX(NVL(CUST_GRP_ID, MDL_CUST_CNT||TO_CHAR(MDL_CUST_SEQ, 'FM000000'))) AS CUST_GRP_ID ," ).append("\n"); 
		query.append("         CUST_GRP_NM ," ).append("\n"); 
		query.append("         ACCT_TP     ," ).append("\n"); 
		query.append("         MAX(MDL_CUST_CNT||TO_CHAR(MDL_CUST_SEQ, 'FM000000')) AS CUST_NO," ).append("\n"); 
		query.append("         MAX(MDL_CUST_CTRL_CD) AS CUST_CTRL_CD," ).append("\n"); 
		query.append("         CUST_NM     ," ).append("\n"); 
		query.append("         MAX(CUST_CNT_CD) AS CUST_CNT_CD," ).append("\n"); 
		query.append("         MAX(CUST_SEQ)    AS CUST_SEQ   ," ).append("\n"); 
		query.append("         OTH_CUST_NM ," ).append("\n"); 
		query.append("         SC_NO       ," ).append("\n"); 
		query.append("         DECODE(TRD_CD, 'AES',NVL(SC_NO,RFA_NO),'IAS',NVL(SC_NO,RFA_NO),RFA_NO) AS RFA_NO, --2015.03.09 [CHM-201534504]SMP IAS 보완에 따른 FCST 추가 개발 요청" ).append("\n"); 
		query.append("         CTRT_OFC_CD ," ).append("\n"); 
		query.append("         LOAD_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("         SUB_TRD_CD  ," ).append("\n"); 
		query.append("         RLANE_CD    ," ).append("\n"); 
		query.append("         " ).append("\n"); 
		query.append("#if(${chkview} == '1')" ).append("\n"); 
		query.append("#foreach( $key in $new_dur )" ).append("\n"); 
		query.append("         MAX(VVD${key})          AS VVD${key}         ," ).append("\n"); 
		query.append("         SUM(MAX_QTY${key}1)     AS MAX_QTY${key}1    ," ).append("\n"); 
		query.append("         SUM(FCT${key}1)         AS FCT${key}1        ," ).append("\n"); 
		query.append("         SUM(CFCT${key}1)        AS CFCT${key}1       ," ).append("\n"); 
		query.append("         SUM(BKG${key}1)         AS BKG${key}1        ," ).append("\n"); 
		query.append("         SUM(BKG_AVG_QTY${key}1) AS BKG_AVG_QTY${key}1," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("		 ROUND(SUM(MAS_CM${key}1), 2) AS CM${key}1,	" ).append("\n"); 
		query.append("		 ROUND(SUM(MAS_CM${key}1)/DECODE(SUM(MAS_QTY${key}1), 0, 1, SUM(MAS_QTY${key}1)), 2) AS CMB${key}1,	" ).append("\n"); 
		query.append("         ROUND(SUM(BKG${key}1)/DECODE(SUM(MAX_QTY${key}1), 0, 1, SUM(MAX_QTY${key}1))*100, 2) AS RATIO${key}1," ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("#foreach( $key in $new_dur )" ).append("\n"); 
		query.append("         MAX(VVD${key})          AS VVD${key}         ," ).append("\n"); 
		query.append("         ROUND(SUM(MAX_QTY${key}1) / 2, 1)     AS MAX_QTY${key}1    ," ).append("\n"); 
		query.append("         ROUND(SUM(FCT${key}1) / 2, 1)         AS FCT${key}1        ," ).append("\n"); 
		query.append("         ROUND(SUM(CFCT${key}1) / 2, 1)        AS CFCT${key}1       ," ).append("\n"); 
		query.append("         ROUND(SUM(BKG${key}1) / 2, 1)         AS BKG${key}1        ," ).append("\n"); 
		query.append("         ROUND(SUM(BKG_AVG_QTY${key}1) / 2, 1) AS BKG_AVG_QTY${key}1," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("		 ROUND(SUM(MAS_CM${key}1), 2) AS CM${key}1,	" ).append("\n"); 
		query.append("		 ROUND(SUM(MAS_CM${key}1)/DECODE(SUM(MAS_QTY${key}1), 0, 1, SUM(MAS_QTY${key}1)), 2) AS CMB${key}1,	" ).append("\n"); 
		query.append("         ROUND(SUM(BKG${key}1)/DECODE(SUM(MAX_QTY${key}1), 0, 1, SUM(MAX_QTY${key}1))*100, 2) AS RATIO${key}1," ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("         '' AS T" ).append("\n"); 
		query.append("    FROM (" ).append("\n"); 
		query.append("            SELECT TRD_CD     , CUST_CLSS, " ).append("\n"); 
		query.append("                   CUST_GRP_ID," ).append("\n"); 
		query.append("                   (SELECT CUST_GRP_NM" ).append("\n"); 
		query.append("                      FROM MDM_CUST_PERF_GRP N" ).append("\n"); 
		query.append("                     WHERE D.CUST_GRP_ID = N.CUST_GRP_ID" ).append("\n"); 
		query.append("                       AND N.DELT_FLG    = 'N') CUST_GRP_NM," ).append("\n"); 
		query.append("                   ACCT_TP     ," ).append("\n"); 
		query.append("                   MDL_CUST_CNT," ).append("\n"); 
		query.append("                   MDL_CUST_SEQ," ).append("\n"); 
		query.append("                   MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("                   (SELECT CUST_LGL_ENG_NM" ).append("\n"); 
		query.append("                      FROM MDM_CUSTOMER C" ).append("\n"); 
		query.append("                     WHERE C.CUST_CNT_CD = D.MDL_CUST_CNT" ).append("\n"); 
		query.append("                       AND C.CUST_SEQ    = D.MDL_CUST_SEQ" ).append("\n"); 
		query.append("                       AND C.DELT_FLG    = 'N') CUST_NM,                   " ).append("\n"); 
		query.append("                   CUST_CNT_CD," ).append("\n"); 
		query.append("                   CUST_SEQ   ," ).append("\n"); 
		query.append("                   (SELECT CUST_LGL_ENG_NM" ).append("\n"); 
		query.append("                      FROM MDM_CUSTOMER C" ).append("\n"); 
		query.append("                     WHERE C.CUST_CNT_CD = D.CUST_CNT_CD" ).append("\n"); 
		query.append("                       AND C.CUST_SEQ    = D.CUST_SEQ" ).append("\n"); 
		query.append("                       AND C.DELT_FLG    = 'N') OTH_CUST_NM," ).append("\n"); 
		query.append("                   SC_NO      ," ).append("\n"); 
		query.append("                   RFA_NO     ," ).append("\n"); 
		query.append("                   CTRT_OFC_CD," ).append("\n"); 
		query.append("                   LOAD_OFC_CD," ).append("\n"); 
		query.append("                   SUB_TRD_CD ," ).append("\n"); 
		query.append("                   RLANE_CD   ,      " ).append("\n"); 
		query.append("#foreach( $key in $new_dur )" ).append("\n"); 
		query.append("                   MAX(VVD${key})          AS VVD${key}         ," ).append("\n"); 
		query.append("                   SUM(MAX_QTY${key}1)     AS MAX_QTY${key}1    ," ).append("\n"); 
		query.append("                   SUM(CTRT_FCST${key}1)   AS CFCT${key}1       ," ).append("\n"); 
		query.append("                   SUM(FCAST_QTY${key}1)   AS FCT${key}1        ," ).append("\n"); 
		query.append("                   SUM(BKG_QTY${key}1)     AS BKG${key}1        ," ).append("\n"); 
		query.append("                   SUM(BKG_AVG_QTY${key}1) AS BKG_AVG_QTY${key}1," ).append("\n"); 
		query.append("                   SUM(MAS_CM${key}1) AS MAS_CM${key}1," ).append("\n"); 
		query.append("                   SUM(MAS_QTY${key}1) AS MAS_QTY${key}1,			   " ).append("\n"); 
		query.append("#end                   " ).append("\n"); 
		query.append("                   '' AS T" ).append("\n"); 
		query.append("              FROM BASE_DATA1 D" ).append("\n"); 
		query.append("              WHERE 1=1" ).append("\n"); 
		query.append("                  AND NVL(CUST_GRP_ID, MDL_CUST_CNT||TO_CHAR(MDL_CUST_SEQ, 'FM000000')) <> 'XX999999'" ).append("\n"); 
		query.append("                  --AND MDL_CUST_CTRL_CD <> 'C'" ).append("\n"); 
		query.append("                  AND LOAD_OFC_CD IS NOT NULL" ).append("\n"); 
		query.append("          GROUP BY GROUPING SETS (" ).append("\n"); 
		query.append("                                    (TRD_CD)," ).append("\n"); 
		query.append("                                    (TRD_CD, CUST_CLSS)," ).append("\n"); 
		query.append("                                    (TRD_CD, CUST_CLSS, CUST_GRP_ID)," ).append("\n"); 
		query.append("                                    (TRD_CD, CUST_CLSS, CUST_GRP_ID, ACCT_TP, MDL_CUST_CNT, MDL_CUST_SEQ, MDL_CUST_CTRL_CD, SC_NO, RFA_NO)," ).append("\n"); 
		query.append("                                    (TRD_CD, CUST_CLSS, CUST_GRP_ID, ACCT_TP, MDL_CUST_CNT, MDL_CUST_SEQ, MDL_CUST_CTRL_CD, SC_NO, RFA_NO, CTRT_OFC_CD, LOAD_OFC_CD, SUB_TRD_CD)," ).append("\n"); 
		query.append("                                    (TRD_CD, CUST_CLSS, CUST_GRP_ID, ACCT_TP, MDL_CUST_CNT, MDL_CUST_SEQ, MDL_CUST_CTRL_CD, CUST_CNT_CD, CUST_SEQ, SC_NO, RFA_NO, CTRT_OFC_CD, LOAD_OFC_CD, SUB_TRD_CD, RLANE_CD)," ).append("\n"); 
		query.append("                                    (TRD_CD, CUST_CLSS, CUST_GRP_ID, ACCT_TP, MDL_CUST_CNT, MDL_CUST_SEQ, MDL_CUST_CTRL_CD, SC_NO, RFA_NO, CTRT_OFC_CD, LOAD_OFC_CD, SUB_TRD_CD, RLANE_CD)" ).append("\n"); 
		query.append("                                 )" ).append("\n"); 
		query.append("            HAVING NOT (    ( NVL(MDL_CUST_CNT, 'XX') = NVL(CUST_CNT_CD, 'X') AND NVL(MDL_CUST_SEQ, 999999) = NVL(CUST_SEQ, 1) AND LOAD_OFC_CD IS NOT NULL )" ).append("\n"); 
		query.append("                         OR ( TRD_CD IS NOT NULL AND CUST_GRP_ID = 'XX999999' AND SUB_TRD_CD IS NOT NULL AND RLANE_CD IS NULL )" ).append("\n"); 
		query.append("                       )" ).append("\n"); 
		query.append("         ) T" ).append("\n"); 
		query.append("GROUP BY TRD_CD      , CUST_CLSS," ).append("\n"); 
		query.append("         CUST_GRP_ID ," ).append("\n"); 
		query.append("         CUST_GRP_NM ," ).append("\n"); 
		query.append("         ACCT_TP     ," ).append("\n"); 
		query.append("         CUST_NM     ," ).append("\n"); 
		query.append("         OTH_CUST_NM ," ).append("\n"); 
		query.append("         SC_NO       ," ).append("\n"); 
		query.append("         DECODE(TRD_CD, 'AES',NVL(SC_NO,RFA_NO), 'IAS',NVL(SC_NO,RFA_NO),RFA_NO)," ).append("\n"); 
		query.append("         CTRT_OFC_CD ," ).append("\n"); 
		query.append("         LOAD_OFC_CD ," ).append("\n"); 
		query.append("         SUB_TRD_CD  ," ).append("\n"); 
		query.append("         RLANE_CD     " ).append("\n"); 
		query.append("UNION ALL" ).append("\n"); 
		query.append("  SELECT 2 ORD, TRD_CD      , 'X' CUST_CLSS," ).append("\n"); 
		query.append("         'GTTL' CUST_GRP_ID ," ).append("\n"); 
		query.append("         'Guide TTL' CUST_GRP_NM ," ).append("\n"); 
		query.append("         NVL(MDL_CUST_CTRL_CD, 'S.TTL') ACCT_TP     ," ).append("\n"); 
		query.append("         'TT000001' CUST_NO," ).append("\n"); 
		query.append("         NVL(SUB_TRD_CD, 'TTL') CUST_CTRL_CD," ).append("\n"); 
		query.append("         NVL(SUB_TRD_CD, 'TTL') CUST_NM     ," ).append("\n"); 
		query.append("         'TT'  CUST_CNT_CD," ).append("\n"); 
		query.append("         1 CUST_SEQ   ," ).append("\n"); 
		query.append("         'Guide TTL' OTH_CUST_NM ," ).append("\n"); 
		query.append("         NVL(MDL_CUST_CTRL_CD, 'S.TTL') SC_NO       ," ).append("\n"); 
		query.append("         NVL(MDL_CUST_CTRL_CD, 'S.TTL') RFA_NO," ).append("\n"); 
		query.append("         NVL(MDL_CUST_CTRL_CD, 'S.TTL') CTRT_OFC_CD ," ).append("\n"); 
		query.append("         NVL(MDL_CUST_CTRL_CD, 'S.TTL') OFC_CD," ).append("\n"); 
		query.append("         NVL(MDL_CUST_CTRL_CD, 'S.TTL') SUB_TRD_CD  ," ).append("\n"); 
		query.append("         NVL(MDL_CUST_CTRL_CD, 'S.TTL') RLANE_CD    ," ).append("\n"); 
		query.append("#if(${chkview} == '1')" ).append("\n"); 
		query.append("#foreach( $key in $new_dur )" ).append("\n"); 
		query.append("         MAX(VVD${key})          AS VVD${key}         ,       " ).append("\n"); 
		query.append("         DECODE(NVL(MDL_CUST_CTRL_CD, 'X'), 'X', DECODE(NVL(SUB_TRD_CD, 'TTL'), 'TTL', MAX(T_TTL_LOD_QTY${key}1), MAX(TTL_LOD_QTY${key}1)), 'C', DECODE(NVL(SUB_TRD_CD, 'TTL'), 'TTL', MAX(T_C_LOD_QTY${key}1), MAX(C_LOD_QTY${key}1)) ,SUM(MAX_QTY${key}1)) MAX_QTY${key}1,            " ).append("\n"); 
		query.append("         SUM(FCAST_QTY${key}1)   AS FCT${key}1        ," ).append("\n"); 
		query.append("         SUM(CTRT_FCST${key}1)   AS CFCT${key}1       ," ).append("\n"); 
		query.append("         SUM(BKG_QTY${key}1)     AS BKG${key}1        ," ).append("\n"); 
		query.append("         SUM(BKG_AVG_QTY${key}1) AS BKG_AVG_QTY${key}1," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("		 ROUND(SUM(MAS_CM${key}1), 2) AS CM${key}1,	" ).append("\n"); 
		query.append("		 ROUND(SUM(MAS_CM${key}1)/DECODE(SUM(MAS_QTY${key}1), 0, 1, SUM(MAS_QTY${key}1)), 2) AS CMB${key}1,	             " ).append("\n"); 
		query.append("         CASE WHEN NVL(MDL_CUST_CTRL_CD, 'X') = 'X' THEN NULL" ).append("\n"); 
		query.append("         ELSE " ).append("\n"); 
		query.append("             ROUND(SUM(BKG_QTY${key}1)/DECODE(DECODE(NVL(SUB_TRD_CD, 'TTL'), 'TTL', MAX(T_TTL_BKG_QTY${key}1), MAX(TTL_BKG_QTY${key}1)), 0, 1, " ).append("\n"); 
		query.append("                 DECODE(NVL(SUB_TRD_CD, 'TTL'), 'TTL', MAX(T_TTL_BKG_QTY${key}1), MAX(TTL_BKG_QTY${key}1)))*100, 2) " ).append("\n"); 
		query.append("         END AS RATIO${key}1,                       " ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("#foreach( $key in $new_dur )" ).append("\n"); 
		query.append("         MAX(VVD${key})          AS VVD${key}  " ).append("\n"); 
		query.append("         DECODE(NVL(MDL_CUST_CTRL_CD, 'X'), 'X', DECODE(NVL(SUB_TRD_CD, 'TTL'), 'TTL', MAX(T_TTL_LOD_QTY${key}1), MAX(TTL_LOD_QTY${key}1)), 'C', DECODE(NVL(SUB_TRD_CD, 'TTL'), 'TTL', MAX(T_C_LOD_QTY${key}1), MAX(C_LOD_QTY${key}1)) ,SUM(MAX_QTY${key}1)) MAX_QTY${key}1,       " ).append("\n"); 
		query.append("         ROUND(SUM(FCAST_QTY${key}1) / 2, 1)   AS FCT${key}1        ," ).append("\n"); 
		query.append("         ROUND(SUM(CTRT_FCST${key}1) / 2, 1)   AS CFCT${key}1       ," ).append("\n"); 
		query.append("         ROUND(SUM(BKG_QTY${key}1) / 2, 1)     AS BKG${key}1        ," ).append("\n"); 
		query.append("         ROUND(SUM(BKG_AVG_QTY${key}1) / 2, 1) AS BKG_AVG_QTY${key}1," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("		 ROUND(SUM(MAS_CM${key}1), 2) AS CM${key}1,	" ).append("\n"); 
		query.append("		 ROUND(SUM(MAS_CM${key}1)/DECODE(SUM(MAS_QTY${key}1), 0, 1, SUM(MAS_QTY${key}1)), 2) AS CMB${key}1,	" ).append("\n"); 
		query.append("         CASE WHEN NVL(MDL_CUST_CTRL_CD, 'X') = 'X' THEN NULL" ).append("\n"); 
		query.append("         ELSE " ).append("\n"); 
		query.append("             ROUND(SUM(BKG_QTY${key}1)/DECODE(DECODE(NVL(SUB_TRD_CD, 'TTL'), 'TTL', MAX(T_TTL_BKG_QTY${key}1), MAX(TTL_BKG_QTY${key}1)), 0, 1, " ).append("\n"); 
		query.append("                 DECODE(NVL(SUB_TRD_CD, 'TTL'), 'TTL', MAX(T_TTL_BKG_QTY${key}1), MAX(TTL_BKG_QTY${key}1)))*100, 2) " ).append("\n"); 
		query.append("         END AS RATIO${key}1," ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#end	 " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("         '' AS T" ).append("\n"); 
		query.append("    FROM BASE_DATA1 D" ).append("\n"); 
		query.append("    GROUP BY GROUPING SETS ((TRD_CD),(TRD_CD, SUB_TRD_CD)," ).append("\n"); 
		query.append("                            (TRD_CD, MDL_CUST_CTRL_CD)," ).append("\n"); 
		query.append("                            (TRD_CD, SUB_TRD_CD, MDL_CUST_CTRL_CD))" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("ORDER BY ORD, TRD_CD     , CUST_CLSS, DECODE(ORD, 2, NVL(CUST_CTRL_CD, 'Z'), 1)," ).append("\n"); 
		query.append("         CUST_GRP_NM," ).append("\n"); 
		query.append("         CUST_GRP_ID," ).append("\n"); 
		query.append("         NVL(CUST_NM, 'ZZZZZZZ')," ).append("\n"); 
		query.append("         NVL(OTH_CUST_NM, 'ZZZZZZZZ')," ).append("\n"); 
		query.append("         NVL(CUST_CNT_CD, 'AA')," ).append("\n"); 
		query.append("         NVL(CUST_SEQ, 0), " ).append("\n"); 
		query.append("         DECODE(CUST_GRP_ID, 'XX999999', 'Z', NVL(SC_NO, NVL(RFA_NO, 'Z')))," ).append("\n"); 
		query.append("         NVL(CTRT_OFC_CD, '0'), " ).append("\n"); 
		query.append("         NVL(OFC_CD, '0')," ).append("\n"); 
		query.append("         SUB_TRD_CD," ).append("\n"); 
		query.append("         RLANE_CD" ).append("\n"); 
		query.append("         " ).append("\n"); 
		query.append("#elseif(${view_type11} == 'LOFC')" ).append("\n"); 
		query.append("-- L/Office 선택시" ).append("\n"); 
		query.append("SELECT * FROM" ).append("\n"); 
		query.append("(" ).append("\n"); 
		query.append("  SELECT 1 ORD, TRD_CD      ," ).append("\n"); 
		query.append("         LOAD_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("         SUB_TRD_CD  ," ).append("\n"); 
		query.append("         RLANE_CD    ," ).append("\n"); 
		query.append("         MDL_CUST_CTRL_CD AS CUST_CTRL_CD," ).append("\n"); 
		query.append("         MAX(NVL(CUST_GRP_ID, MDL_CUST_CNT||TO_CHAR(MDL_CUST_SEQ, 'FM000000'))) AS CUST_GRP_ID ," ).append("\n"); 
		query.append("         CUST_GRP_NM ," ).append("\n"); 
		query.append("         ACCT_TP     ," ).append("\n"); 
		query.append("         MAX(MDL_CUST_CNT||TO_CHAR(MDL_CUST_SEQ, 'FM000000')) AS CUST_NO," ).append("\n"); 
		query.append("         CUST_NM     ," ).append("\n"); 
		query.append("         MAX(CUST_CNT_CD) AS CUST_CNT_CD ," ).append("\n"); 
		query.append("         MAX(CUST_SEQ)    AS CUST_SEQ    ," ).append("\n"); 
		query.append("         OTH_CUST_NM ," ).append("\n"); 
		query.append("         SC_NO       ," ).append("\n"); 
		query.append("         DECODE(TRD_CD, 'AES',NVL(SC_NO,RFA_NO),'IAS',NVL(SC_NO,RFA_NO),RFA_NO) AS RFA_NO," ).append("\n"); 
		query.append("         CTRT_OFC_CD ," ).append("\n"); 
		query.append("         " ).append("\n"); 
		query.append("#if(${chkview} == '1')" ).append("\n"); 
		query.append("#foreach( $key in $new_dur )" ).append("\n"); 
		query.append("         MAX(VVD${key})          AS VVD${key}         ," ).append("\n"); 
		query.append("         SUM(MAX_QTY${key}1)     AS MAX_QTY${key}1    ," ).append("\n"); 
		query.append("         SUM(FCT${key}1)         AS FCT${key}1        ," ).append("\n"); 
		query.append("         SUM(CFCT${key}1)        AS CFCT${key}1      ," ).append("\n"); 
		query.append("         SUM(BKG${key}1)         AS BKG${key}1        ," ).append("\n"); 
		query.append("         SUM(BKG_AVG_QTY${key}1) AS BKG_AVG_QTY${key}1,	" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("		 SUM(MAS_CM${key}1) AS CM${key}1,	" ).append("\n"); 
		query.append("		 ROUND(SUM(MAS_CM${key}1)/DECODE(SUM(MAS_QTY${key}1), 0, 1, SUM(MAS_QTY${key}1)), 2) AS CMB${key}1,	" ).append("\n"); 
		query.append("		 ROUND(SUM(BKG${key}1)/DECODE(SUM(MAX_QTY${key}1), 0, 1, SUM(MAX_QTY${key}1))*100, 2) AS RATIO${key}1," ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("#foreach( $key in $new_dur )" ).append("\n"); 
		query.append("         MAX(VVD${key})                        AS VVD${key}         ," ).append("\n"); 
		query.append("         ROUND(SUM(MAX_QTY${key}1) / 2, 1)     AS MAX_QTY${key}1    ," ).append("\n"); 
		query.append("         ROUND(SUM(FCT${key}1) / 2, 1)         AS FCT${key}1        ," ).append("\n"); 
		query.append("         ROUND(SUM(CFCT${key}1) / 2, 1)        AS CFCT${key}1       ," ).append("\n"); 
		query.append("         ROUND(SUM(BKG${key}1) / 2, 1)         AS BKG${key}1        ," ).append("\n"); 
		query.append("         ROUND(SUM(BKG_AVG_QTY${key}1) / 2, 1) AS BKG_AVG_QTY${key}1," ).append("\n"); 
		query.append(" " ).append("\n"); 
		query.append("		 ROUND(SUM(MAS_CM${key}1), 1) AS MAS_CM${key}1,	" ).append("\n"); 
		query.append("		 ROUND(SUM(MAS_CM${key}1)/DECODE(SUM(MAS_QTY${key}1), 0, 1, SUM(MAS_QTY${key}1)), 2) AS CMB${key}1," ).append("\n"); 
		query.append("         ROUND(SUM(BKG${key}1)/DECODE(SUM(MAX_QTY${key}1), 0, 1, SUM(MAX_QTY${key}1))*100, 2) AS RATIO${key}1," ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("         '' AS T" ).append("\n"); 
		query.append("    FROM (" ).append("\n"); 
		query.append("            SELECT TRD_CD     ," ).append("\n"); 
		query.append("                   CUST_GRP_ID," ).append("\n"); 
		query.append("                   (SELECT CUST_GRP_NM" ).append("\n"); 
		query.append("                      FROM MDM_CUST_PERF_GRP N" ).append("\n"); 
		query.append("                     WHERE D.CUST_GRP_ID = N.CUST_GRP_ID" ).append("\n"); 
		query.append("                       AND N.DELT_FLG    = 'N') CUST_GRP_NM," ).append("\n"); 
		query.append("                   ACCT_TP     ," ).append("\n"); 
		query.append("                   MDL_CUST_CNT," ).append("\n"); 
		query.append("                   MDL_CUST_SEQ," ).append("\n"); 
		query.append("                   MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("                   (SELECT CUST_LGL_ENG_NM" ).append("\n"); 
		query.append("                      FROM MDM_CUSTOMER C" ).append("\n"); 
		query.append("                     WHERE C.CUST_CNT_CD = D.MDL_CUST_CNT" ).append("\n"); 
		query.append("                       AND C.CUST_SEQ    = D.MDL_CUST_SEQ" ).append("\n"); 
		query.append("                       AND C.DELT_FLG    = 'N') CUST_NM," ).append("\n"); 
		query.append("                   " ).append("\n"); 
		query.append("                   CUST_CNT_CD," ).append("\n"); 
		query.append("                   CUST_SEQ   ," ).append("\n"); 
		query.append("                   (SELECT CUST_LGL_ENG_NM" ).append("\n"); 
		query.append("                      FROM MDM_CUSTOMER C" ).append("\n"); 
		query.append("                     WHERE C.CUST_CNT_CD = D.CUST_CNT_CD" ).append("\n"); 
		query.append("                       AND C.CUST_SEQ    = D.CUST_SEQ" ).append("\n"); 
		query.append("                       AND C.DELT_FLG    = 'N') OTH_CUST_NM," ).append("\n"); 
		query.append("                   SC_NO      ," ).append("\n"); 
		query.append("                   RFA_NO     ," ).append("\n"); 
		query.append("                   CTRT_OFC_CD," ).append("\n"); 
		query.append("                   LOAD_OFC_CD," ).append("\n"); 
		query.append("                   SUB_TRD_CD ," ).append("\n"); 
		query.append("                   RLANE_CD   ," ).append("\n"); 
		query.append("#foreach( $key in $new_dur )" ).append("\n"); 
		query.append("                   MAX(VVD${key})          AS VVD${key}         ," ).append("\n"); 
		query.append("                   SUM(MAX_QTY${key}1)     AS MAX_QTY${key}1    ," ).append("\n"); 
		query.append("                   SUM(CTRT_FCST${key}1)   AS CFCT${key}1       ," ).append("\n"); 
		query.append("                   SUM(FCAST_QTY${key}1)   AS FCT${key}1        ," ).append("\n"); 
		query.append("                   SUM(BKG_QTY${key}1)     AS BKG${key}1        ," ).append("\n"); 
		query.append("                   SUM(BKG_AVG_QTY${key}1) AS BKG_AVG_QTY${key}1," ).append("\n"); 
		query.append("                   SUM(MAS_CM${key}1)      AS MAS_CM${key}1," ).append("\n"); 
		query.append("                   SUM(MAS_QTY${key}1)     AS MAS_QTY${key}1,		   " ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                   '' AS T" ).append("\n"); 
		query.append("              FROM BASE_DATA1 D" ).append("\n"); 
		query.append("              WHERE 1=1" ).append("\n"); 
		query.append("                  AND NVL(CUST_GRP_ID, MDL_CUST_CNT||TO_CHAR(MDL_CUST_SEQ, 'FM000000')) <> 'XX999999'" ).append("\n"); 
		query.append("                  --AND MDL_CUST_CTRL_CD <> 'C'" ).append("\n"); 
		query.append("                  AND LOAD_OFC_CD IS NOT NULL" ).append("\n"); 
		query.append("          GROUP BY GROUPING SETS (" ).append("\n"); 
		query.append("                                    (TRD_CD)," ).append("\n"); 
		query.append("                                    (TRD_CD, LOAD_OFC_CD)," ).append("\n"); 
		query.append("                                    (TRD_CD, LOAD_OFC_CD, SUB_TRD_CD)," ).append("\n"); 
		query.append("                                    (TRD_CD, LOAD_OFC_CD, SUB_TRD_CD, RLANE_CD, MDL_CUST_CTRL_CD)," ).append("\n"); 
		query.append("                                    (TRD_CD, LOAD_OFC_CD, SUB_TRD_CD, RLANE_CD, MDL_CUST_CTRL_CD, CUST_GRP_ID, ACCT_TP, MDL_CUST_CNT, MDL_CUST_SEQ, SC_NO, RFA_NO, CTRT_OFC_CD)," ).append("\n"); 
		query.append("                                    (TRD_CD, LOAD_OFC_CD, SUB_TRD_CD, RLANE_CD, MDL_CUST_CTRL_CD, CUST_GRP_ID, ACCT_TP, MDL_CUST_CNT, MDL_CUST_SEQ, CUST_CNT_CD, CUST_SEQ, SC_NO, RFA_NO, CTRT_OFC_CD)" ).append("\n"); 
		query.append("                                 )" ).append("\n"); 
		query.append("            HAVING NOT (    ( NVL(MDL_CUST_CNT, 'XX') = NVL(CUST_CNT_CD, 'X') AND NVL(MDL_CUST_SEQ, 999999) = NVL(CUST_SEQ, 1) AND LOAD_OFC_CD IS NOT NULL)" ).append("\n"); 
		query.append("                       )" ).append("\n"); 
		query.append("         ) T" ).append("\n"); 
		query.append("GROUP BY TRD_CD      ," ).append("\n"); 
		query.append("         LOAD_OFC_CD ," ).append("\n"); 
		query.append("         SUB_TRD_CD  ," ).append("\n"); 
		query.append("         RLANE_CD    ," ).append("\n"); 
		query.append("         MDL_CUST_CTRL_CD," ).append("\n"); 
		query.append("         CUST_GRP_ID ," ).append("\n"); 
		query.append("         CUST_GRP_NM ," ).append("\n"); 
		query.append("         ACCT_TP     ," ).append("\n"); 
		query.append("         CUST_NM     ," ).append("\n"); 
		query.append("         SC_NO       ," ).append("\n"); 
		query.append("         DECODE(TRD_CD, 'AES',NVL(SC_NO,RFA_NO),'IAS',NVL(SC_NO,RFA_NO),RFA_NO), " ).append("\n"); 
		query.append("         OTH_CUST_NM ," ).append("\n"); 
		query.append("         CTRT_OFC_CD" ).append("\n"); 
		query.append("UNION ALL" ).append("\n"); 
		query.append("  SELECT 2 ORD, TRD_CD      ," ).append("\n"); 
		query.append("         '*' OFC_CD," ).append("\n"); 
		query.append("         '*' SUB_TRD_CD  ," ).append("\n"); 
		query.append("         '*' RLANE_CD    ," ).append("\n"); 
		query.append("         NVL(SUB_TRD_CD, 'TTL') CUST_CTRL_CD," ).append("\n"); 
		query.append("         'GTTL' CUST_GRP_ID ," ).append("\n"); 
		query.append("         'Guide TTL' CUST_GRP_NM ," ).append("\n"); 
		query.append("         NVL(MDL_CUST_CTRL_CD, 'S.TTL') ACCT_TP     ," ).append("\n"); 
		query.append("         'TT000001' CUST_NO," ).append("\n"); 
		query.append("         NVL(SUB_TRD_CD, 'TTL') CUST_NM     ," ).append("\n"); 
		query.append("         'TT'  CUST_CNT_CD," ).append("\n"); 
		query.append("         1 CUST_SEQ   ," ).append("\n"); 
		query.append("         'Guide TTL' OTH_CUST_NM ," ).append("\n"); 
		query.append("         NVL(MDL_CUST_CTRL_CD, 'S.TTL') SC_NO       ," ).append("\n"); 
		query.append("         NVL(MDL_CUST_CTRL_CD, 'S.TTL') RFA_NO," ).append("\n"); 
		query.append("         '' CTRT_OFC_CD ," ).append("\n"); 
		query.append("#if(${chkview} == '1')" ).append("\n"); 
		query.append("#foreach( $key in $new_dur )" ).append("\n"); 
		query.append("         MAX(VVD${key})          AS VVD${key}         ," ).append("\n"); 
		query.append("         DECODE(NVL(MDL_CUST_CTRL_CD, 'X'), 'X', DECODE(NVL(SUB_TRD_CD, 'TTL'), 'TTL', MAX(T_TTL_LOD_QTY${key}1), MAX(TTL_LOD_QTY${key}1)), 'C', DECODE(NVL(SUB_TRD_CD, 'TTL'), 'TTL', MAX(T_C_LOD_QTY${key}1), MAX(C_LOD_QTY${key}1)) ,SUM(MAX_QTY${key}1)) MAX_QTY${key}1," ).append("\n"); 
		query.append("         SUM(FCAST_QTY${key}1)         AS FCT${key}1        ," ).append("\n"); 
		query.append("         SUM(CTRT_FCST${key}1)        AS CFCT${key}1       ," ).append("\n"); 
		query.append("         SUM(BKG_QTY${key}1)     AS BKG${key}1        ," ).append("\n"); 
		query.append("         SUM(BKG_AVG_QTY${key}1) AS BKG_AVG_QTY${key}1," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("		 ROUND(SUM(MAS_CM${key}1), 2) AS CM${key}1,	" ).append("\n"); 
		query.append("		 ROUND(SUM(MAS_CM${key}1)/DECODE(SUM(MAS_QTY${key}1), 0, 1, SUM(MAS_QTY${key}1)), 2) AS CMB${key}1,	" ).append("\n"); 
		query.append("         CASE WHEN NVL(MDL_CUST_CTRL_CD, 'X') = 'X' THEN NULL" ).append("\n"); 
		query.append("         ELSE " ).append("\n"); 
		query.append("             ROUND(SUM(BKG_QTY${key}1)/DECODE(DECODE(NVL(SUB_TRD_CD, 'TTL'), 'TTL', MAX(T_TTL_BKG_QTY${key}1), MAX(TTL_BKG_QTY${key}1)), 0, 1, " ).append("\n"); 
		query.append("                 DECODE(NVL(SUB_TRD_CD, 'TTL'), 'TTL', MAX(T_TTL_BKG_QTY${key}1), MAX(TTL_BKG_QTY${key}1)))*100, 2) " ).append("\n"); 
		query.append("         END AS RATIO${key}1," ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("#foreach( $key in $new_dur )" ).append("\n"); 
		query.append("         MAX(VVD${key})          AS VVD${key}         ," ).append("\n"); 
		query.append("         DECODE(NVL(MDL_CUST_CTRL_CD, 'X'), 'X', DECODE(NVL(SUB_TRD_CD, 'TTL'), 'TTL', MAX(T_TTL_LOD_QTY${key}1), MAX(TTL_LOD_QTY${key}1)), 'C', DECODE(NVL(SUB_TRD_CD, 'TTL'), 'TTL', MAX(T_C_LOD_QTY${key}1), MAX(C_LOD_QTY${key}1)) ,SUM(MAX_QTY${key}1)) MAX_QTY${key}1," ).append("\n"); 
		query.append("         ROUND(SUM(FCAST_QTY${key}1) / 2, 1)         AS FCT${key}1        ," ).append("\n"); 
		query.append("         ROUND(SUM(CTRT_FCST${key}1) / 2, 1)        AS CFCT${key}1       ," ).append("\n"); 
		query.append("         ROUND(SUM(BKG_QTY${key}1) / 2, 1)     AS BKG${key}1        ," ).append("\n"); 
		query.append("         ROUND(SUM(BKG_AVG_QTY${key}1) / 2, 1) AS BKG_AVG_QTY${key}1," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("		 ROUND(SUM(MAS_CM${key}1), 2) AS CM${key}1,	" ).append("\n"); 
		query.append("		 ROUND(SUM(MAS_CM${key}1)/DECODE(SUM(MAS_QTY${key}1), 0, 1, SUM(MAS_QTY${key}1)), 2) AS CMB${key}1,	" ).append("\n"); 
		query.append("         CASE WHEN NVL(MDL_CUST_CTRL_CD, 'X') = 'X' THEN NULL" ).append("\n"); 
		query.append("         ELSE " ).append("\n"); 
		query.append("             ROUND(SUM(BKG_QTY${key}1)/DECODE(DECODE(NVL(SUB_TRD_CD, 'TTL'), 'TTL', MAX(T_TTL_BKG_QTY${key}1), MAX(TTL_BKG_QTY${key}1)), 0, 1, " ).append("\n"); 
		query.append("                 DECODE(NVL(SUB_TRD_CD, 'TTL'), 'TTL', MAX(T_TTL_BKG_QTY${key}1), MAX(TTL_BKG_QTY${key}1)))*100, 2) " ).append("\n"); 
		query.append("         END AS RATIO${key}1," ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#end	 " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("         '' AS T" ).append("\n"); 
		query.append("    FROM BASE_DATA1 D" ).append("\n"); 
		query.append("    GROUP BY GROUPING SETS ((TRD_CD), (TRD_CD, SUB_TRD_CD)," ).append("\n"); 
		query.append("                            (TRD_CD, MDL_CUST_CTRL_CD)," ).append("\n"); 
		query.append("                            (TRD_CD, SUB_TRD_CD, MDL_CUST_CTRL_CD))" ).append("\n"); 
		query.append(")        " ).append("\n"); 
		query.append("ORDER BY TRD_CD     , DECODE(ORD, 2, NVL(CUST_CTRL_CD, 'Z'), 1), DECODE(ORD, 2, ACCT_TP, 1)," ).append("\n"); 
		query.append("         OFC_CD," ).append("\n"); 
		query.append("         SUB_TRD_CD ," ).append("\n"); 
		query.append("         RLANE_CD   ," ).append("\n"); 
		query.append("         CUST_CTRL_CD," ).append("\n"); 
		query.append("         CUST_GRP_NM," ).append("\n"); 
		query.append("         NVL(CUST_NM, 'ZZZZZZZZ'), " ).append("\n"); 
		query.append("         NVL(CUST_NO, 'ZZZZZZZ' )," ).append("\n"); 
		query.append("         DECODE(CUST_CNT_CD, NULL, '0', SUB_TRD_CD)," ).append("\n"); 
		query.append("         DECODE(CUST_CNT_CD, NULL, '0', RLANE_CD  )," ).append("\n"); 
		query.append("         NVL(CUST_CNT_CD, '0' )," ).append("\n"); 
		query.append("         NVL(OTH_CUST_NM, 'AA')," ).append("\n"); 
		query.append("         NVL(CUST_CNT_CD, 'AA')," ).append("\n"); 
		query.append("         NVL(CUST_SEQ, 0)" ).append("\n"); 
		query.append("#end" ).append("\n"); 

	}
}