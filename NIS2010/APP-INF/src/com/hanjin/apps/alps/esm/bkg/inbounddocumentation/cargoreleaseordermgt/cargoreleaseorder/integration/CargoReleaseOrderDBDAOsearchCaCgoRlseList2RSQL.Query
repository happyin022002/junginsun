<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CargoReleaseOrderDBDAOsearchCaCgoRlseList2RSQL">
			<desc><![CDATA[CargoReleaseOrderDBDAOsearchCaCgoRlseList2RSQL]]></desc>
			<sql><![CDATA[
SELECT /*+ LEADING(M) USE_NL(M N O P Q R) */  M.BL_NO,
       P.BKG_NO,
       N.PCK_QTY PCS_QTY,
       N.VSL_CD||N.SKD_VOY_NO||N.SKD_DIR_CD VVD_CD,
       N.CSTMS_PORT_CD AS POD_CD,
       N.DEL_CD,
       N.HUB_LOC_CD HUB_CD,
       M.LAST_UP_DT,
       M.FRT_CLT_FLG,
       M.F_LAST_DT,
       M.OBL_RDEM_FLG,
       M.O_LAST_DT,
       M.MRN_TML_EDI_SND_CD TML_SND,
       M.TML_LAST_DT,
       ' '  PRT_IND,
           SUBSTR(REPLACE(REPLACE(O.CUST_NM, CHR(34), CHR(34)||CHR(34)), CHR(13)||CHR(10), ' '), 1, 20) CUST_NM,
       Q.INTER_RMK,
       NVL(Q.DO_HLD_FLG,'N') AS DO_HLD_FLG,
       R.BL_CPY_KNT AS OBL_TTL_KNT
  FROM
      (
             SELECT  /*+ USE_NL(A C) */
               C.BL_NO,
               TO_CHAR(GREATEST(NVL(C.FRT_CLT_LST_DT,TO_DATE('00010101000001','YYYYMMDDHH24MISS')),
                                NVL(C.OBL_RDEM_LST_DT,TO_DATE('00010101000001','YYYYMMDDHH24MISS')),
                                NVL(C.CSTMS_CLR_LST_DT,TO_DATE('00010101000001','YYYYMMDDHH24MISS'))),'DDMonRR HH24:MI', 'NLS_DATE_LANGUAGE=ENGLISH') LAST_UP_DT,
               C.FRT_CLT_FLG,
               TO_CHAR(C.FRT_CLT_LST_DT, 'DDMonRR HH24:MI', 'NLS_DATE_LANGUAGE=ENGLISH') F_LAST_DT,
               C.OBL_RDEM_FLG,
               TO_CHAR(C.OBL_RDEM_LST_DT, 'DDMonRR HH24:MI', 'NLS_DATE_LANGUAGE=ENGLISH') O_LAST_DT,
               C.MRN_TML_EDI_SND_CD,
               TO_CHAR(C.MRN_TML_EDI_LST_SND_DT, 'DDMonRR HH24:MI', 'NLS_DATE_LANGUAGE=ENGLISH') TML_LAST_DT,
               ROWNUM
       FROM (SELECT  RID
             FROM   (SELECT  ROWID  RID
                     FROM    BKG_CGO_RLSE
                     WHERE   FRT_CLT_LST_DT BETWEEN TO_DATE(@[start_date] || @[start_time] , 'YYYY-MM-DDHH24:MI') AND TO_DATE(@[end_date] || @[end_time] , 'YYYY-MM-DDHH24:MI')
                     UNION ALL
                     SELECT  ROWID  RID
                     FROM    BKG_CGO_RLSE
                     WHERE   OBL_RDEM_LST_DT BETWEEN TO_DATE(@[start_date] || @[start_time] , 'YYYY-MM-DDHH24:MI') AND TO_DATE(@[end_date] || @[end_time] , 'YYYY-MM-DDHH24:MI')
                    )
             GROUP BY RID
            )  A,
             BKG_CGO_RLSE C
       WHERE A.RID = C.ROWID
      ) M,
       BKG_CSTMS_ADV_BL   N,
       BKG_CSTMS_ADV_CUST O,
       BKG_BOOKING        P,
       BKG_DO_REF         Q,
       BKG_BL_ISS         R
 WHERE N.CNT_CD(+)     = 'CA'
 
 
#if (${vvd} != '') 
   AND N.VSL_CD     = SUBSTR(@[vvd], 1,4)
   AND N.SKD_VOY_NO = SUBSTR(@[vvd], 5,4)
   AND N.SKD_DIR_CD = SUBSTR(@[vvd], 9,1)
 

#end

#if (${pod_cd} != '')   
   AND N.POD_CD     = @[pod_cd]
#end

#if (${del_cd} != '')
   AND N.DEL_CD     = @[del_cd]
#end
   
#if (${hub_loc_cd} != '')
   AND N.HUB_LOC_CD = @[hub_loc_cd]
#end
#if (${mrn_tml_edi_snd_cd} != '')
   AND DECODE(NVL(M.MRN_TML_EDI_SND_CD,'N'), 'Y', 'Y', 'N') = @[mrn_tml_edi_snd_cd] 
#end
#if (${frt_clt_flg} != '')
   AND DECODE(NVL(M.FRT_CLT_FLG       ,'N'), 'Y', 'Y', 'N') = @[frt_clt_flg]
#end
#if (${obl_rdem_flg} != '')
   AND DECODE(NVL(M.OBL_RDEM_FLG      ,'N'), 'Y', 'Y', 'N') = @[obl_rdem_flg]
#end
 
   AND M.BL_NO  = N.BL_NO(+)
   AND O.CNT_CD(+) = 'CA'
   AND M.BL_NO  = O.BL_NO(+)
   AND O.BKG_CUST_TP_CD = 'C'
   AND M.BL_NO  = P.BL_NO
   AND P.BKG_NO = Q.BKG_NO(+)
   AND R.BKG_NO(+) = P.BKG_NO
ORDER BY 1			]]></sql>
			<params>
				<param name="start_date" type="12" value="" out="N"/>
				<param name="start_time" type="12" value="" out="N"/>
				<param name="end_date" type="12" value="" out="N"/>
				<param name="end_time" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
				<param name="hub_loc_cd" type="12" value="" out="N"/>
				<param name="mrn_tml_edi_snd_cd" type="12" value="" out="N"/>
				<param name="frt_clt_flg" type="12" value="" out="N"/>
				<param name="obl_rdem_flg" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
