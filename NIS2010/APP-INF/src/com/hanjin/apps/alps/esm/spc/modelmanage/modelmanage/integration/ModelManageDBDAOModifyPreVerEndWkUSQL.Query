<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ModelManageDBDAOModifyPreVerEndWkUSQL">
			<desc><![CDATA[이전 version의 적용 end 주차를 수정합니다.(현재 version start 주차의 1주 이전으로)
[CHM-201322502-01] SPC 프로젝트 - 성수기 선복운영 개선을 위한 T/F추진]]></desc>
			<sql><![CDATA[
UPDATE SPC_MDL_VER_MST
SET CFM_FLG = 'Y'
  , VER_END_YRWK = (SELECT PRE_WK
                      FROM (
                            SELECT COST_YR, COST_WK, LAG(COST_YR||COST_WK) OVER(ORDER BY COST_YR, COST_WK) PRE_WK
                              FROM MAS_WK_PRD
                           )
                     WHERE COST_YR = SUBSTR(@[ver_st_yrwk],1,4)
                       AND COST_WK = SUBSTR(@[ver_st_yrwk],5)
                   )
  , UPD_USR_ID = @[usr_id]
  , UPD_DT = SYSDATE
WHERE TRD_CD = @[trd_cd]
  AND COST_YRWK = @[cost_yrwk]
  AND VER_SEQ = TO_NUMBER(@[ver_seq])-1			]]></sql>
			<params>
				<param name="ver_st_yrwk" type="12" value="" out="N"/>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="cost_yrwk" type="12" value="" out="N"/>
				<param name="ver_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
