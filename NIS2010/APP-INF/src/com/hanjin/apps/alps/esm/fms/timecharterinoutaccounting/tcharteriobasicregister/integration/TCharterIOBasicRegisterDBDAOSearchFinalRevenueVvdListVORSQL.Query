<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOBasicRegisterDBDAOSearchFinalRevenueVvdListVORSQL">
			<desc><![CDATA[Final Revenue Vvd List]]></desc>
			<sql><![CDATA[
SELECT 'I' ibflag
,	A.REV_YRMON
,	A.VSL_CD
,	A.SKD_VOY_NO
,	A.SKD_DIR_CD
,	A.REV_DIR_CD
,	A.VST_DT
,	A.VED_DT
,	A.RLANE_CD
,	M.VSL_SLAN_CD SLAN_CD
,	A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD||A.REV_DIR_CD VVD_CD
FROM MDM_REV_LANE M, GL_ESTM_REV_VVD A
WHERE	M.RLANE_CD = A.RLANE_CD
AND		A.EXE_YRMON = @[rev_yrmon]
AND		A.REV_YRMON = @[rev_yrmon]
AND     A.LINE_NO = '1'
AND		EXISTS (SELECT NULL FROM FMS_CONTRACT 
				WHERE  VSL_CD = A.VSL_CD AND FLET_CTRT_FACT_CD = 'ACT'
                AND    FLET_CTRT_TP_CD <> 'OW'
				UNION ALL
				SELECT NULL FROM FMS_CONTRACT FC, FMS_ID_VSL FI 
				WHERE FI.VSL_CD = A.VSL_CD AND FC.FLET_CTRT_NO = FI.FLET_CTRT_NO 
				AND   FC.FLET_CTRT_FACT_CD = 'ACT' AND FI.USE_FLG = 'Y')
UNION ALL
SELECT 'I' ibflag
,	A.REV_YRMON
,	A.VSL_CD
,	A.SKD_VOY_NO
,	A.SKD_DIR_CD
,	A.REV_DIR_CD
,	A.VST_DT
,	A.VED_DT
,	A.RLANE_CD
,	M.VSL_SLAN_CD SLAN_CD
,	A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD||A.REV_DIR_CD VVD_CD
FROM MDM_REV_LANE M, GL_ESTM_REV_VVD A
WHERE	M.RLANE_CD = A.RLANE_CD
AND		A.EXE_YRMON = @[rev_yrmon]
AND		A.REV_YRMON = @[rev_yrmon]
AND		A.SKD_DIR_CD = 'V'
AND		A.REV_DIR_CD = 'V'
AND     NVL(A.LINE_NO,'0') <> '1'
AND		EXISTS (SELECT NULL FROM FMS_CONTRACT 
				WHERE  VSL_CD = A.VSL_CD AND FLET_CTRT_FACT_CD = 'ACT'
                AND    FLET_CTRT_TP_CD <> 'OW'
				UNION ALL
				SELECT NULL FROM FMS_CONTRACT FC, FMS_ID_VSL FI 
				WHERE FI.VSL_CD = A.VSL_CD AND FC.FLET_CTRT_NO = FI.FLET_CTRT_NO 
				AND FC.FLET_CTRT_FACT_CD = 'ACT' AND FI.USE_FLG = 'Y')			]]></sql>
			<params>
				<param name="rev_yrmon" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
