<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="Kor24ManifestListDBDAOSearchElNoKorRSQL">
			<desc><![CDATA[O/B T/S의 경우 ELNo를 구한다.]]></desc>
			<sql><![CDATA[
SELECT DISTINCT TRIM(NVL(V.MRN_NO||V.MRN_CHK_NO||T.MST_BL_SEQ,' ')) D_MRN_NO
  FROM (
      SELECT VSL_CD
           , SKD_VOY_NO
           , SKD_DIR_CD
           , 'I' BND
           , TS_POD_CD POD
           , NVL(MST_BL_SEQ,' ') MSN_NO
           , DECODE(USA_BND_FLG,NULL,'N',' ','N',USA_BND_FLG) OB_TYPE
        FROM BKG_CSTMS_ADV_KR_BL
       WHERE BKG_NO = @[bkg_no]

         AND CSTMS_DECL_TP_CD IN ('T','I')
         AND DMST_PORT_CD = @[kt_port]
         AND TRNS_SEQ = (
            SELECT MAX(TRNS_SEQ)
              FROM BKG_CSTMS_ADV_KR_BL
             WHERE BKG_NO = @[bkg_no]

               AND DMST_PORT_CD = @[kt_port]
               AND CSTMS_DECL_TP_CD IN ('I','T')
               AND POD_CD <> TS_POD_CD
               )
       ) T
     , BKG_CSTMS_ADV_KR_VVD_SMRY V
 WHERE V.VSL_CD = T.VSL_CD
   AND V.SKD_VOY_NO = T.SKD_VOY_NO
   AND V.SKD_DIR_CD = T.SKD_DIR_CD
   AND ((T.OB_TYPE IN ('A','B','C','D') AND V.OB_DECL_TP_CD IN ('A','B','C','D')) OR
      (T.OB_TYPE = 'N' AND T.OB_TYPE = V.OB_DECL_TP_CD))
   AND V.PORT_CD = T.POD
   AND V.IO_BND_CD = T.BND			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="kt_port" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
