<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="FeederChargeGuideLineDBDAOCheckPreFDRRSQL">
			<desc><![CDATA[CheckPreFDR]]></desc>
			<sql><![CDATA[
WITH MAX_TRF AS (
        SELECT @[svc_scp_cd] AS SVC_SCP_CD
             , @[org_dest_tp_cd] AS ORG_DEST_TP_CD
             , TRF.FDR_TRF_NO
             , MAX(MN.AMDT_SEQ) AMDT_SEQ
          FROM PRI_TRF_FDR_MN MN
             , (    SELECT MAX(MN.FDR_TRF_NO) FDR_TRF_NO
                      FROM PRI_TRF_FDR_MN MN 
                         , PRI_TRF_FDR_HDR HDR
                     WHERE 1=1
                       AND MN.SVC_SCP_CD = HDR.SVC_SCP_CD
                       AND MN.ORG_DEST_TP_CD = HDR.ORG_DEST_TP_CD
                       AND MN.FDR_TRF_NO = HDR.FDR_TRF_NO
                       AND MN.SVC_SCP_CD    = @[svc_scp_cd]
                       AND MN.ORG_DEST_TP_CD = @[org_dest_tp_cd]                     
                       AND MN.FIC_PROP_STS_CD = 'C'
                       AND HDR.RHQ_CD = @[rhq_cd]
               ) TRF
         WHERE 1=1
           AND MN.FDR_TRF_NO = TRF.FDR_TRF_NO
      GROUP BY TRF.FDR_TRF_NO
    )
    
SELECT TO_CHAR(DUR.EFF_DT,'YYYYMMDD') EFF_DT
FROM PRI_TRF_FDR_DUR DUR
   , MAX_TRF SUB
WHERE 1=1
  AND DUR.SVC_SCP_CD = SUB.SVC_SCP_CD
  AND DUR.ORG_DEST_TP_CD = SUB.ORG_DEST_TP_CD
  AND DUR.FDR_TRF_NO = SUB.FDR_TRF_NO
  AND DUR.AMDT_SEQ   = SUB.AMDT_SEQ			]]></sql>
			<params>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="org_dest_tp_cd" type="12" value="" out="N"/>
				<param name="rhq_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
