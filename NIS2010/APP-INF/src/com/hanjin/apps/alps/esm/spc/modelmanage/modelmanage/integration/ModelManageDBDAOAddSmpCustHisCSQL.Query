<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ModelManageDBDAOAddSmpCustHisCSQL">
			<desc><![CDATA[SMP Customer History 정보를 저장합니다.
[CHM-201322502-01] SPC 프로젝트 - 성수기 선복운영 개선을 위한 T/F추진
2014.02.04 [CHM-201428383-01] RFA 로직 추가]]></desc>
			<sql><![CDATA[
INSERT INTO SPC_MDL_CUST_CTRL_HIS (
    TRD_CD
  , COST_YRWK
  , VER_SEQ
  , MODI_SEQ
  , CUST_GRP_ID
  , CUST_CNT_CD
  , CUST_SEQ
  , SC_NO
  , RFA_NO
  , CUST_CTRL_CD
  , WK_MQC_QTY
  , CNG_ITM_NM
  , OLD_CUST_GRP_ID
  , OLD_CUST_CNT_CD
  , OLD_CUST_SEQ
  , OLD_SC_NO
  , OLD_RFA_NO
  , OLD_CUST_CTRL_CD
  , OLD_WK_MQC_QTY
  , MODI_USR_ID
  , MODI_GDT
  , DELT_FLG
  , CRE_USR_ID
  , CRE_DT
  , UPD_USR_ID
  , UPD_DT
  , SUB_TRD_CD
) VALUES (
    @[trd_cd]
  , @[cost_yrwk]
  , @[ver_seq]
  , (SELECT NVL(MAX(MODI_SEQ)+1,1)
       FROM SPC_MDL_CUST_CTRL_HIS
      WHERE TRD_CD = @[trd_cd]
        AND COST_YRWK = @[cost_yrwk]
        AND VER_SEQ = @[ver_seq]
    )
  , (SELECT CUST_GRP_ID
       FROM MDM_CUSTOMER
      WHERE CUST_CNT_CD = SUBSTR(@[cust_cd],1,2)
        AND CUST_SEQ = SUBSTR(@[cust_cd],3)
     )
  , SUBSTR(@[cust_cd],1,2)
  , SUBSTR(@[cust_cd],3)
  , @[sc_no]
  , @[rfa_no]
  , @[cust_ctrl_cd]
  , @[wk_mqc_qty]
  , @[cng_itm_nm]
  , (SELECT CUST_GRP_ID
       FROM MDM_CUSTOMER
      WHERE CUST_CNT_CD = SUBSTR(@[old_cust_cd],1,2)
        AND CUST_SEQ = SUBSTR(@[old_cust_cd],3)
     )
  , SUBSTR(@[old_cust_cd],1,2)
  , SUBSTR(@[old_cust_cd],3)
  , @[old_sc_no]
  , @[old_rfa_no]
  , @[old_cust_ctrl_cd]
  , @[old_wk_mqc_qty]
  , @[usr_id]
  , CAST(SYS_EXTRACT_UTC(TO_TIMESTAMP(@[modi_gdt], 'YYYY/MM/DD HH24:MI:SS')) AS DATE)
  , 'N'
  , @[usr_id]
  , SYSDATE
  , @[usr_id]
  , SYSDATE
  , NVL(@[sub_trd_cd],'*') -- 20130424 NVL 추가
)			]]></sql>
			<params>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="cost_yrwk" type="12" value="" out="N"/>
				<param name="ver_seq" type="12" value="" out="N"/>
				<param name="cust_cd" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
				<param name="rfa_no" type="12" value="" out="N"/>
				<param name="cust_ctrl_cd" type="12" value="" out="N"/>
				<param name="wk_mqc_qty" type="12" value="" out="N"/>
				<param name="cng_itm_nm" type="12" value="" out="N"/>
				<param name="old_cust_cd" type="12" value="" out="N"/>
				<param name="old_sc_no" type="12" value="" out="N"/>
				<param name="old_rfa_no" type="12" value="" out="N"/>
				<param name="old_cust_ctrl_cd" type="12" value="" out="N"/>
				<param name="old_wk_mqc_qty" type="12" value="" out="N"/>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="modi_gdt" type="12" value="" out="N"/>
				<param name="sub_trd_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
