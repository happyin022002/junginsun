<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="WeeklyCMDBDAOSearchVVDChkWithARListVORSQL">
			<desc><![CDATA[mas_mon_vvd 테이블에서 Month VVD 정보를 조회   ]]></desc>
			<sql><![CDATA[
SELECT   DECODE(A.TRD_CD    ,NULL, 'A', DECODE(B.TRD_CD, NULL, 'C' ,'B'   ) ) RSLT_CD /* C:MAS ONLY, B:BOTH */	
        ,DECODE(A.TRD_CD    ,NULL, 'AR Only', DECODE(B.TRD_CD, NULL, 'MAS Only', 'BOTH') ) RSLT
        ,NVL(A.TRD_CD       , B.TRD_CD                  ) TRD_CD 	
        ,NVL(A.RLANE_CD     , B.RLANE_CD                ) RLANE_CD  
        ,NVL(A.IOC_CD       , B.IOC_CD                  ) IOC_CD    
        ,NVL(A.VSL_CD       , B.VSL_CD                  ) VSL_CD 	
        ,NVL(A.SKD_VOY_NO   , B.SKD_VOY_NO              ) SKD_VOY_NO
        ,NVL(A.DIR_CD       , B.DIR_CD                  ) DIR_CD 	
        ,NVL(A.VSL_CD       , B.VSL_CD                  )||		    
         NVL(A.SKD_VOY_NO   , B.SKD_VOY_NO              )|| 		
         NVL(A.DIR_CD       , B.DIR_CD                  ) VVD	 			
        ,NVL(A.SLAN_CD      , B.SLAN_CD                 ) SLAN_CD   
        ,NVL(A.MON_TGT_FLG  , NULL                      ) MON_TGT_FLG   
        ,NVL(A.DELT_FLG     , NULL                      ) DELT_FLG      			
        ,NVL(A.COST_YRMON   , NULL                      ) COST_YRMON    		
        ,NVL(A.COST_WK      , NULL                      ) COST_WK       		
        ,NVL(A.LST_LODG_PORT_CD, B.LST_LODG_PORT_CD  ) LST_LODG_PORT_CD 		
  FROM  (SELECT TRD_CD     		, RLANE_CD  	, IOC_CD 			
               ,VSL_CD     		, SKD_VOY_NO	, DIR_CD 			
               ,COST_YRMON 		, COST_WK   	, SLAN_CD 			
               ,LST_LODG_PORT_CD, MON_TGT_FLG	, DELT_FLG			
          FROM  MAS_MON_VVD  										
         WHERE  RLANE_CD   <>      'RBCCO' 							
        ) A 							
        RIGHT OUTER JOIN  /* AR ONLY 찾기 위해(MAS_MON_VVD_IF 에만 있는 항차)*/
       (SELECT TRD_CD     , RLANE_CD  , IOC_CD 					
              ,VSL_CD     , SKD_VOY_NO, DIR_CD 					
              ,COST_YRMON , COST_WK   , SLAN_CD 					
              ,LST_LODG_PORT_CD 									
          FROM MAS_MON_VVD_IF  									
         WHERE RLANE_CD   <>      'RBCCO' 							
           AND COST_YRMON = @[f_cost_yr]||@[f_cost_fm_mon]												
                                            ) B 					
    ON (    A.TRD_CD     = B.TRD_CD  									
        AND A.RLANE_CD   = B.RLANE_CD 									
        AND A.IOC_CD     = B.IOC_CD 									
        AND A.VSL_CD     = B.VSL_CD 									
        AND A.SKD_VOY_NO = B.SKD_VOY_NO 								
        AND A.DIR_CD     = B.DIR_CD     ) 								
  UNION	 /* MAS ONLY를 위해 */													
  SELECT  DECODE(A.TRD_CD    , NULL, 'A'       ,  					
          DECODE(B.TRD_CD    , NULL, 'C'       , 'B'   ) ) RSLT_CD 	
         ,DECODE(A.TRD_CD    , NULL, 'AR Only' ,  					
          DECODE(B.TRD_CD    , NULL, 'MAS Only', 'BOTH') ) RSLT 	    
         ,NVL(A.TRD_CD       , B.TRD_CD                  ) TRD_CD 	
         ,NVL(A.RLANE_CD     , B.RLANE_CD                ) RLANE_CD  
         ,NVL(A.IOC_CD       , B.IOC_CD                  ) IOC_CD    
         ,NVL(A.VSL_CD       , B.VSL_CD                  ) VSL_CD 	
         ,NVL(A.SKD_VOY_NO   , B.SKD_VOY_NO              ) SKD_VOY_NO
         ,NVL(A.DIR_CD       , B.DIR_CD                  ) DIR_CD 	
         ,NVL(A.VSL_CD       , B.VSL_CD                  )||		    
          NVL(A.SKD_VOY_NO   , B.SKD_VOY_NO              )|| 		
          NVL(A.DIR_CD       , B.DIR_CD                  ) VVD	 			
         ,NVL(A.SLAN_CD      , B.SLAN_CD                 ) SLAN_CD   
         ,NVL(A.MON_TGT_FLG  , NULL                      ) MON_TGT_FLG   
         ,NVL(A.DELT_FLG     , NULL                      ) DELT_FLG      	
         ,NVL(A.COST_YRMON   , NULL                      ) COST_YRMON    		
         ,NVL(A.COST_WK      , NULL                      ) COST_WK       			
         ,NVL(A.LST_LODG_PORT_CD, B.LST_LODG_PORT_CD  ) LST_LODG_PORT_CD 		
  FROM   (SELECT TRD_CD     		, RLANE_CD  	, IOC_CD 			
                ,VSL_CD     		, SKD_VOY_NO	, DIR_CD 			
                ,COST_YRMON 		, COST_WK   	, SLAN_CD 			
                ,LST_LODG_PORT_CD, MON_TGT_FLG	, DELT_FLG			
            FROM MAS_MON_VVD  										
           WHERE RLANE_CD   <>      'RBCCO' 							
             AND COST_YRMON = @[f_cost_yr]||@[f_cost_fm_mon]				   					    		
             AND DELT_FLG   =       'N'       	 							
          									) A 							
          LEFT OUTER JOIN  											
         (SELECT TRD_CD     , RLANE_CD  , IOC_CD 					
                ,VSL_CD     , SKD_VOY_NO, DIR_CD 					
                ,COST_YRMON , COST_WK   , SLAN_CD 					
                ,LST_LODG_PORT_CD 									
            FROM MAS_MON_VVD_IF  									
           WHERE RLANE_CD   <>      'RBCCO' 							
             AND COST_YRMON = @[f_cost_yr]||@[f_cost_fm_mon]												
                                            ) B 					
    ON (    A.TRD_CD     = B.TRD_CD  									
        AND A.RLANE_CD   = B.RLANE_CD 									
        AND A.IOC_CD     = B.IOC_CD 									
        AND A.VSL_CD     = B.VSL_CD 									
        AND A.SKD_VOY_NO = B.SKD_VOY_NO 								
        AND A.DIR_CD     = B.DIR_CD     ) 										
ORDER BY RSLT_CD			]]></sql>
			<params>
				<param name="f_cost_yr" type="12" value="" out="N"/>
				<param name="f_cost_fm_mon" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
