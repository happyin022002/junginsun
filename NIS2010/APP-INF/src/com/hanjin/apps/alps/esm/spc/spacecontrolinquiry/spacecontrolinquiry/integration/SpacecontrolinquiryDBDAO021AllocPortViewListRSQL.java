/*=========================================================
*Copyright(c) 2018 CyberLogitec
*@FileName : SpacecontrolinquiryDBDAO021AllocPortViewListRSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2018.03.13
*@LastModifier : 
*@LastVersion : 1.0
* 2018.03.13 
* 1.0 Creation
=========================================================*/
package com.hanjin.apps.alps.esm.spc.spacecontrolinquiry.spacecontrolinquiry.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.hanjin.framework.support.db.ISQLTemplate;

/**
 *
 * @author 
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class SpacecontrolinquiryDBDAO021AllocPortViewListRSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * Daily Forecast Status 화면 내 Allocation Status(HO) 탭 조회
	  * --2015.01월 이전 주석 쿼리안으로 이동
	  * 2015.01.12 Arie [CHM-201433532] Sector QTA제외한 실적 조회 로직 보완 요청 
	  * 2015.01.21 신자영 [CHM-201533786] Daily FCST상 ACCT 조회 조건 보완요청 
	  * 2015.01.30 Arie [CHM-201534031]Daily FCST Allocby HO & RHQ 데이터 오류 수정요청 - Alloc조회시 SKD을 POD 만 걸고있으나, POL-POD모두걸도록 수정함
	  * 2015.03.03 CHM-201534458 SQM QTA주가 변경 관련 적용 요청
	  * 2015.03.09 [CHM-201534504]SMP IAS 보완에 따른 FCST 추가 개발 요청
	  * 2015.06.02 Accout Control option 적용 오류 수정
	  * 2015.06.24 이혜민 [CHM-201535810] Fixed Rate 계약 정보의 SPC 적용 개발 요청
	  * 2015.06.25 Arie [CHM-201536511] Daily Forecast status 아주 노선 Area 분류 변경 요청 - CAT lane Bound를 W로 설정하고 검색할 때 E/B 항차가 검색되도록 변경 요청 (E/B가 Head haul)
	  * 2015.07.03 이혜민 [CHM-201536633] Control Option management 보완요청 (Fixed Rate관련)
	  * 2015.08.12 이혜민 [CHM-201537257] BKG_DATA CUST_CTRL_CD 기준 변경. 
	  * 						(1. RFA_NO IS NULL, SC IS NULL 조건 삭제(DUMMY RFA뿐만 아니라 모든 RFA 비교) 
	  * 						2. SPC_MDL_CUST_RFA에 CMDT_CD 조인 조건 추가.)
	  * 2015.08.19 이혜민 [CHM-201537615] Daily Forecast Allocation Status (HO, RHQ) 탭에서 QTA 가져올때 BSA가 0 이면 QTA가 0으로 보이는 로직 수정
	  * 2015.09.11 이혜민 [CHM-201537959] QISIA 노선의 Daily Forecast (HO, RHQ) Bound 강제조정 요청
	  * 2015.09.16 이혜민 선반영 SPC_CONTI_CONV_FNC 태울때 SLAN_CD를 인자로 가져가던것 RLANE_CD로 수정 (RLANE_CD로 가져가야 제대로 펑션을 탐)
	  * 2015.11.23 이혜민 선반영 RUS 노선 Bound 변경 요청
	  * 2016.02.23 이혜민 [CHM-201640132] Daily Forecast 상 DXBMES 산하 지역 Load office 표시 수정 (DXBSC -> DXBME) 
	  * 2016.03.04 이혜민 쿼리튜닝
	  * 2016.04.21 이혜민 선반영 Dest 추가
	  * 2016.05.27 이혜민 SELSC, TYOSC RHQ 독립분리
	  * 2018.01.03 송민석 [CSR #2927] 'KJXIA','KCXIA','KDSIA' 의 경우 Bound가 W 인경우 E로 간주함
	  * 2018.01.11 송민석 [CSR #2927] 'KJXIA','KCXIA','KDSIA' 와 같이 bound를 역으로 간주 할경우 그 total 값도 해당 bound에 sum 되도록 변경함
	  * 2018.02.20 박광석 [SR #3288] Daily Forecast Status 상, KVT, KMH Lane (S/N bound → W/E bound 전환)
	  * </pre>
	  */
	public SpacecontrolinquiryDBDAO021AllocPortViewListRSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("office",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("login_id",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("subtrade1",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("trade",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("sales_office",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("ui_name",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("pol_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("ofc_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("duration",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("area",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("rhq2",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("year",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("bound",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("week",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.hanjin.apps.alps.esm.spc.spacecontrolinquiry.spacecontrolinquiry.integration").append("\n"); 
		query.append("FileName : SpacecontrolinquiryDBDAO021AllocPortViewListRSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("WITH " ).append("\n"); 
		query.append("PARAMS AS" ).append("\n"); 
		query.append("(SELECT @[year]         AS YEAR" ).append("\n"); 
		query.append("      , @[week]         AS WEEK" ).append("\n"); 
		query.append("      , @[duration]     AS DURATION" ).append("\n"); 
		query.append("      , o.ofc_cd        AS OFC_CD" ).append("\n"); 
		query.append("      , @[trade]       AS TRD_CD" ).append("\n"); 
		query.append("      , @[subtrade1]    AS SUB_TRD_CD" ).append("\n"); 
		query.append("      , @[bound]        AS DIR_CD" ).append("\n"); 
		query.append("      , SUBSTR(null, 0, 4)    AS VSL_CD" ).append("\n"); 
		query.append("      , SUBSTR(null, 5, 4)    AS SKD_VOY_NO" ).append("\n"); 
		query.append("      , SUBSTR(null, 9)       AS SKD_DIR_CD" ).append("\n"); 
		query.append("      , l.conti_cd      AS OFC_CONTI" ).append("\n"); 
		query.append("      , '2'        AS STS" ).append("\n"); 
		query.append("      , null      AS all_pol" ).append("\n"); 
		query.append("   FROM MDM_LOCATION L" ).append("\n"); 
		query.append("      , MDM_ORGANIZATION O" ).append("\n"); 
		query.append("  WHERE L.LOC_CD = O.LOC_CD " ).append("\n"); 
		query.append(" " ).append("\n"); 
		query.append("#if (${ofc_cd} == 'SZPDC')" ).append("\n"); 
		query.append("    AND O.OFC_CD = @[ofc_cd] " ).append("\n"); 
		query.append("#else " ).append("\n"); 
		query.append("    #if (${office} == '')" ).append("\n"); 
		query.append("    AND O.OFC_CD = 'SHARC' " ).append("\n"); 
		query.append("    #else" ).append("\n"); 
		query.append("    AND O.OFC_CD = @[office] " ).append("\n"); 
		query.append("    #end " ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append(", REP_VVDS AS (" ).append("\n"); 
		query.append(" SELECT V.TRD_CD AS REP_TRD_CD" ).append("\n"); 
		query.append("      , V.SUB_TRD_CD AS REP_SUB_TRD_CD" ).append("\n"); 
		query.append("      , V.RLANE_CD" ).append("\n"); 
		query.append("      , V.DIR_CD" ).append("\n"); 
		query.append("      , SUBSTR(V.SLS_YRMON, 1, 4) AS COST_YR" ).append("\n"); 
		query.append("      , SUBSTR(V.SLS_YRMON, 5) AS COST_MON" ).append("\n"); 
		query.append("      , V.SLS_YRMON" ).append("\n"); 
		query.append("      , V.COST_WK" ).append("\n"); 
		query.append("      , V.VSL_CD" ).append("\n"); 
		query.append("      , V.SKD_VOY_NO" ).append("\n"); 
		query.append("      , V.DIR_CD SKD_DIR_CD" ).append("\n"); 
		query.append("      , V.LST_LODG_PORT_CD" ).append("\n"); 
		query.append("      , V.LST_LODG_PORT_ETD_DT" ).append("\n"); 
		query.append("      , P.OFC_CD" ).append("\n"); 
		query.append("      , P.OFC_CONTI" ).append("\n"); 
		query.append("      , P.STS" ).append("\n"); 
		query.append("      , DECODE(NVL(A.CTRL_LVL_CD, 'N'), 'T', NVL(DECODE(A.CTRL_ECC_FLG, 'Y', 'E', DECODE(A.CTRL_ECC_GRP_FLG, 'Y', 'G', 'N')), 'N'), 'N' )AS CTRL_DEST" ).append("\n"); 
		query.append("      , NVL(A.CTRL_DEST_LVL_CD, 'N') AS CTRL_DEST_LVL" ).append("\n"); 
		query.append("      , NVL(A.CTRL_USA_SVC_MOD_FLG, 'N') AS CTRL_USA" ).append("\n"); 
		query.append("      , NVL(A.CTRL_ACCT_FLG, 'N') AS CTRL_ACCOUNT" ).append("\n"); 
		query.append("      , NVL(A.CTRL_FX_RT_FLG, 'N') AS CTRL_FX_RT_FLG" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("      , SUBSTR(V.COST_YRMON, 1, 4) AS BSE_YR" ).append("\n"); 
		query.append("      , CASE WHEN V.COST_YRMON >= '201501' THEN CEIL(TO_NUMBER(SUBSTR(V.COST_YRMON, -2))/3)||'Q' " ).append("\n"); 
		query.append("             ELSE CEIL(TO_NUMBER(DECODE(V.COST_WK, '00', '01', '53', '52', V.COST_WK))/13)||'Q' END BSE_QTR_CD" ).append("\n"); 
		query.append("      , V.N1ST_LODG_PORT_ETD_DT AS FL_ETD_DT" ).append("\n"); 
		query.append("      , V.SLAN_CD" ).append("\n"); 
		query.append("   FROM MAS_MON_VVD V" ).append("\n"); 
		query.append("      , PARAMS P" ).append("\n"); 
		query.append("      , SPC_ALOC_CTRL_OPT A" ).append("\n"); 
		query.append("  WHERE V.TRD_CD        = SPC_GET_REP_TRD_FNC(V.RLANE_CD)" ).append("\n"); 
		query.append("    AND V.SUB_TRD_CD    = SPC_GET_REP_SUB_TRD_FNC(V.RLANE_CD) " ).append("\n"); 
		query.append("    AND SUBSTR(V.SLS_YRMON, 1, 4)||V.COST_WK IN" ).append("\n"); 
		query.append("        (SELECT /*+ INDEX(D XPKMAS_WK_PRD)*/ D.COST_YR||D.COST_WK" ).append("\n"); 
		query.append("           FROM MAS_WK_PRD D" ).append("\n"); 
		query.append("          WHERE D.COST_YR||D.COST_WK >= P.YEAR||P.WEEK" ).append("\n"); 
		query.append("            AND ROWNUM               <= TO_NUMBER(P.DURATION)" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("    AND V.TRD_CD        LIKE @[trade] || '%'" ).append("\n"); 
		query.append("    AND V.SUB_TRD_CD    LIKE @[subtrade1]|| '%'" ).append("\n"); 
		query.append("    AND (V.DIR_CD        LIKE @[bound] || '%' " ).append("\n"); 
		query.append("    OR  V.DIR_CD     LIKE" ).append("\n"); 
		query.append("    CASE " ).append("\n"); 
		query.append("        WHEN V.RLANE_CD IN ('AUSIA', 'CKAIA', 'WAXIA', 'AAZIA', 'QISIA', 'RUSIA', 'FOXIA','KJXIA','KCXIA','KDSIA') THEN" ).append("\n"); 
		query.append("             " ).append("\n"); 
		query.append("                DECODE(@[bound], 'E', 'W', 'W', 'E', @[bound])" ).append("\n"); 
		query.append("        WHEN V.RLANE_CD IN ('KVTIA','KMHIA') THEN" ).append("\n"); 
		query.append("             " ).append("\n"); 
		query.append("                DECODE(@[bound], 'E', 'N', 'W', 'S', @[bound])" ).append("\n"); 
		query.append("        ELSE" ).append("\n"); 
		query.append("            (CASE WHEN V.SLAN_CD = 'CAT' THEN DECODE(@[bound], 'E', 'W', 'W', 'E', @[bound]) ELSE  @[bound] END)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    END" ).append("\n"); 
		query.append("    || '%') " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("    AND V.DIR_CD        LIKE null || '%' " ).append("\n"); 
		query.append("    AND (V.DELT_FLG IS NULL OR V.DELT_FLG   = 'N'" ).append("\n"); 
		query.append("     OR EXISTS" ).append("\n"); 
		query.append("        (SELECT 1" ).append("\n"); 
		query.append("           FROM MAS_MON_VVD N" ).append("\n"); 
		query.append("          WHERE N.RLANE_CD   = V.RLANE_CD -- 2012.12.07 SLANE_CD를 RLANE_CD로 변경" ).append("\n"); 
		query.append("            AND N.VSL_CD     = V.VSL_CD" ).append("\n"); 
		query.append("            AND N.SKD_VOY_NO = V.SKD_VOY_NO" ).append("\n"); 
		query.append("            AND N.DIR_CD     = V.DIR_CD" ).append("\n"); 
		query.append("            AND N.DELT_FLG   = 'N'" ).append("\n"); 
		query.append("        ))" ).append("\n"); 
		query.append("    AND A.RLANE_CD (+)  = V.RLANE_CD" ).append("\n"); 
		query.append("    AND A.DIR_CD (+)    = V.DIR_CD" ).append("\n"); 
		query.append("    AND A.VSL_CD (+)    = V.VSL_CD" ).append("\n"); 
		query.append("    AND A.SKD_VOY_NO(+) = V.SKD_VOY_NO" ).append("\n"); 
		query.append("    AND A.SKD_DIR_CD(+) = V.DIR_CD" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append(", VSL_PORT_SKD AS (" ).append("\n"); 
		query.append(" SELECT V.REP_TRD_CD" ).append("\n"); 
		query.append("      , V.REP_SUB_TRD_CD" ).append("\n"); 
		query.append("      , V.RLANE_CD" ).append("\n"); 
		query.append("      , V.DIR_CD" ).append("\n"); 
		query.append("      , V.COST_YR" ).append("\n"); 
		query.append("      , V.COST_MON" ).append("\n"); 
		query.append("      , V.COST_WK" ).append("\n"); 
		query.append("      , V.VSL_CD" ).append("\n"); 
		query.append("      , V.SKD_VOY_NO" ).append("\n"); 
		query.append("      , V.SKD_DIR_CD" ).append("\n"); 
		query.append("      , VPS.VPS_PORT_CD" ).append("\n"); 
		query.append("      , VPS.YD_CD AS PORT_CD" ).append("\n"); 
		query.append("      , VPS.CALL_YD_IND_SEQ" ).append("\n"); 
		query.append("      , VPS.CLPT_SEQ AS PORT_SEQ" ).append("\n"); 
		query.append("      , VPS.TURN_PORT_IND_CD AS PORT_IND" ).append("\n"); 
		query.append("      , SPC_CONTI_CONV_FNC(L.CONTI_CD, V.RLANE_CD, V.DIR_CD) AS CONTI_CD" ).append("\n"); 
		query.append("      , DECODE(SIGN(VPS.VPS_ETD_DT - GLOBALDATE_PKG.TIME_CONV_FNC('GMT', SYS_EXTRACT_UTC(SYSTIMESTAMP), VPS.VPS_PORT_CD)), -1, 'Y', 'N') AS PORT_PAST" ).append("\n"); 
		query.append("      , VPS.VPS_ETA_DT AS ETA_DT" ).append("\n"); 
		query.append("      , VPS.VPS_ETD_DT AS ETD_DT" ).append("\n"); 
		query.append("      , V.LST_LODG_PORT_CD" ).append("\n"); 
		query.append("      , V.LST_LODG_PORT_ETD_DT" ).append("\n"); 
		query.append("      , V.OFC_CD" ).append("\n"); 
		query.append("      , V.OFC_CONTI" ).append("\n"); 
		query.append("      , V.STS" ).append("\n"); 
		query.append("      , V.BSE_YR" ).append("\n"); 
		query.append("      , V.BSE_QTR_CD" ).append("\n"); 
		query.append("      , DECODE(VPS.SKD_CNG_STS_CD, 'S', 1, 0) AS SKIPPED" ).append("\n"); 
		query.append("      , MAX(VPS.CLPT_SEQ) OVER (PARTITION BY V.REP_TRD_CD, V.REP_SUB_TRD_CD, V.RLANE_CD, VPS.VSL_CD, VPS.SKD_VOY_NO, VPS.SKD_DIR_CD, NVL(VPS.YD_CD, VPS.VPS_PORT_CD)) AS MAX_SEQ" ).append("\n"); 
		query.append("      , MIN(VPS.CLPT_SEQ) OVER (PARTITION BY V.REP_TRD_CD, V.REP_SUB_TRD_CD, V.RLANE_CD, VPS.VSL_CD, VPS.SKD_VOY_NO, VPS.SKD_DIR_CD, NVL(VPS.YD_CD, VPS.VPS_PORT_CD)) AS MIN_SEQ" ).append("\n"); 
		query.append("      , VPS.CLPT_IND_SEQ AS CLPT_IND_SEQ" ).append("\n"); 
		query.append("      , COUNT(*) OVER (PARTITION BY V.REP_TRD_CD, V.REP_SUB_TRD_CD, V.RLANE_CD, VPS.VSL_CD, VPS.SKD_VOY_NO, VPS.SKD_DIR_CD, NVL(VPS.YD_CD, VPS.VPS_PORT_CD)) AS PORT_CNT" ).append("\n"); 
		query.append("      , V.SLAN_CD" ).append("\n"); 
		query.append("      , VPS.SKD_CNG_STS_CD" ).append("\n"); 
		query.append("   FROM MDM_LOCATION L" ).append("\n"); 
		query.append("      , VSK_VSL_PORT_SKD VPS" ).append("\n"); 
		query.append("      , REP_VVDS V" ).append("\n"); 
		query.append("  WHERE L.LOC_CD       = VPS.VPS_PORT_CD" ).append("\n"); 
		query.append("    AND VPS.VSL_CD     = V.VSL_CD" ).append("\n"); 
		query.append("    AND VPS.SKD_VOY_NO = V.SKD_VOY_NO" ).append("\n"); 
		query.append("    AND VPS.SKD_DIR_CD = V.SKD_DIR_CD" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append(", VVD_POL_POD AS (" ).append("\n"); 
		query.append(" SELECT REP_TRD_CD" ).append("\n"); 
		query.append("      , REP_SUB_TRD_CD" ).append("\n"); 
		query.append("      , RLANE_CD" ).append("\n"); 
		query.append("      , DIR_CD" ).append("\n"); 
		query.append("      , TRD_CD" ).append("\n"); 
		query.append("      , SUB_TRD_CD" ).append("\n"); 
		query.append("      , COST_YR" ).append("\n"); 
		query.append("      , COST_MON" ).append("\n"); 
		query.append("      , COST_WK" ).append("\n"); 
		query.append("      , VSL_CD" ).append("\n"); 
		query.append("      , SKD_VOY_NO" ).append("\n"); 
		query.append("      , SKD_DIR_CD" ).append("\n"); 
		query.append("      , POL_CD" ).append("\n"); 
		query.append("      , POL_SEQ" ).append("\n"); 
		query.append("      , POL_CONTI" ).append("\n"); 
		query.append("      , POL_PAST" ).append("\n"); 
		query.append("      , POL_ETA_DT" ).append("\n"); 
		query.append("      , POL_ETD_DT" ).append("\n"); 
		query.append("      , POD_CD" ).append("\n"); 
		query.append("      , POD_SEQ" ).append("\n"); 
		query.append("      , POD_CONTI" ).append("\n"); 
		query.append("      , POD_PAST" ).append("\n"); 
		query.append("      , POD_ETA_DT" ).append("\n"); 
		query.append("      , POD_ETD_DT" ).append("\n"); 
		query.append("      , IOC_CD" ).append("\n"); 
		query.append("      , PAST" ).append("\n"); 
		query.append("      , LST_LODG_PORT_CD" ).append("\n"); 
		query.append("      , LST_LODG_PORT_ETD_DT" ).append("\n"); 
		query.append("      , OFC_CD" ).append("\n"); 
		query.append("      , OFC_CONTI" ).append("\n"); 
		query.append("      , STS" ).append("\n"); 
		query.append("      , POL_SKIP" ).append("\n"); 
		query.append("      , POD_SKIP" ).append("\n"); 
		query.append("      , LD_PORT" ).append("\n"); 
		query.append("      , PL_VPS_PORT_CD" ).append("\n"); 
		query.append("      , PD_VPS_PORT_CD" ).append("\n"); 
		query.append("      , PL_CLPT_IND_SEQ" ).append("\n"); 
		query.append("      , PD_CLPT_IND_SEQ" ).append("\n"); 
		query.append("      , PL_PORT_CNT" ).append("\n"); 
		query.append("      , PD_PORT_CNT" ).append("\n"); 
		query.append("      , PL_PD_PORT_CNT" ).append("\n"); 
		query.append("      , PL_SKD_CNG_STS_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("      , BSE_YR" ).append("\n"); 
		query.append("      , BSE_QTR_CD" ).append("\n"); 
		query.append("      , MAX(PL_PORT_CNT) OVER (PARTITION BY POL_CD) AS MAX_POL_PORT_SEQ" ).append("\n"); 
		query.append("      , MAX(PD_PORT_CNT) OVER (PARTITION BY POD_CD) AS MAX_POD_PORT_SEQ" ).append("\n"); 
		query.append("      , POL_YD_SEQ" ).append("\n"); 
		query.append("      , POD_YD_SEQ" ).append("\n"); 
		query.append("   FROM" ).append("\n"); 
		query.append("        (SELECT REP_TRD_CD" ).append("\n"); 
		query.append("              , REP_SUB_TRD_CD" ).append("\n"); 
		query.append("              , RLANE_CD" ).append("\n"); 
		query.append("              , DIR_CD" ).append("\n"); 
		query.append("              , TRD_CD" ).append("\n"); 
		query.append("              , SUB_TRD_CD" ).append("\n"); 
		query.append("              , COST_YR" ).append("\n"); 
		query.append("              , COST_MON" ).append("\n"); 
		query.append("              , COST_WK" ).append("\n"); 
		query.append("              , VSL_CD" ).append("\n"); 
		query.append("              , SKD_VOY_NO" ).append("\n"); 
		query.append("              , SKD_DIR_CD" ).append("\n"); 
		query.append("              , POL_CD" ).append("\n"); 
		query.append("              , POL_SEQ" ).append("\n"); 
		query.append("              , POL_CONTI" ).append("\n"); 
		query.append("              , POL_PAST" ).append("\n"); 
		query.append("              , POL_ETA_DT" ).append("\n"); 
		query.append("              , POL_ETD_DT" ).append("\n"); 
		query.append("              , POD_CD" ).append("\n"); 
		query.append("              , POD_SEQ" ).append("\n"); 
		query.append("              , POD_CONTI" ).append("\n"); 
		query.append("              , POD_PAST" ).append("\n"); 
		query.append("              , POD_ETA_DT" ).append("\n"); 
		query.append("              , POD_ETD_DT" ).append("\n"); 
		query.append("              , IOC_CD" ).append("\n"); 
		query.append("              , PAST" ).append("\n"); 
		query.append("              , LST_LODG_PORT_CD" ).append("\n"); 
		query.append("              , LST_LODG_PORT_ETD_DT" ).append("\n"); 
		query.append("              , OFC_CD" ).append("\n"); 
		query.append("              , OFC_CONTI" ).append("\n"); 
		query.append("              , STS" ).append("\n"); 
		query.append("              , POL_SKIP" ).append("\n"); 
		query.append("              , POD_SKIP" ).append("\n"); 
		query.append("              , LD_PORT" ).append("\n"); 
		query.append("              , PL_PORT_CNT" ).append("\n"); 
		query.append("              , DECODE(SLAN_CD, 'IMU', '1', PD_PORT_CNT) AS PD_PORT_CNT" ).append("\n"); 
		query.append("              , PL_PD_PORT_CNT" ).append("\n"); 
		query.append("              , PL_VPS_PORT_CD" ).append("\n"); 
		query.append("              , PD_VPS_PORT_CD" ).append("\n"); 
		query.append("              , PL_CLPT_IND_SEQ" ).append("\n"); 
		query.append("              , PD_CLPT_IND_SEQ" ).append("\n"); 
		query.append("              , PL_SKD_CNG_STS_CD" ).append("\n"); 
		query.append("              , MAX(PL_PD_PORT_CNT) OVER (PARTITION BY RLANE_CD, TRD_CD, VSL_CD, SKD_VOY_NO, SKD_DIR_CD, PL_VPS_PORT_CD, PL_CLPT_IND_SEQ, PD_VPS_PORT_CD, PD_CLPT_IND_SEQ, POL_SEQ " ).append("\n"); 
		query.append("                                              ORDER BY RLANE_CD, TRD_CD, VSL_CD, SKD_VOY_NO, SKD_DIR_CD, PL_VPS_PORT_CD, PL_CLPT_IND_SEQ, PD_VPS_PORT_CD, PD_CLPT_IND_SEQ ) AS PL_PD_PORT_MAX" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("              , BSE_YR" ).append("\n"); 
		query.append("              , BSE_QTR_CD" ).append("\n"); 
		query.append("              , POL_YD_SEQ" ).append("\n"); 
		query.append("              , POD_YD_SEQ" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("           FROM" ).append("\n"); 
		query.append("                (SELECT PL.REP_TRD_CD" ).append("\n"); 
		query.append("                      , PL.REP_SUB_TRD_CD" ).append("\n"); 
		query.append("                      , PL.RLANE_CD" ).append("\n"); 
		query.append("                      , PL.DIR_CD" ).append("\n"); 
		query.append("                      , DRL.TRD_CD" ).append("\n"); 
		query.append("                      , DRL.SUB_TRD_CD" ).append("\n"); 
		query.append("                      , PL.COST_YR" ).append("\n"); 
		query.append("                      , PL.COST_MON" ).append("\n"); 
		query.append("                      , PL.COST_WK" ).append("\n"); 
		query.append("                      , PL.VSL_CD" ).append("\n"); 
		query.append("                      , PL.SKD_VOY_NO" ).append("\n"); 
		query.append("                      , PL.SKD_DIR_CD" ).append("\n"); 
		query.append("                      , PL.PORT_CD AS POL_CD" ).append("\n"); 
		query.append("                      , MAX(PL.PORT_SEQ) AS POL_SEQ" ).append("\n"); 
		query.append("                      , PL.CONTI_CD AS POL_CONTI" ).append("\n"); 
		query.append("                      , MIN(PL.PORT_PAST) AS POL_PAST" ).append("\n"); 
		query.append("                      , PL.ETA_DT AS POL_ETA_DT" ).append("\n"); 
		query.append("                      , PL.ETD_DT AS POL_ETD_DT" ).append("\n"); 
		query.append("                      , PD.PORT_CD AS POD_CD" ).append("\n"); 
		query.append("                      , (CASE WHEN MAX(PL.PORT_SEQ) < MAX(PD.MIN_SEQ) THEN MAX(PD.MIN_SEQ) ELSE CASE WHEN MAX(PL.PORT_SEQ) > MAX(PD.MIN_SEQ) " ).append("\n"); 
		query.append("                              THEN MAX(PD.MAX_SEQ) END END ) AS POD_SEQ" ).append("\n"); 
		query.append("                      , PD.CONTI_CD AS POD_CONTI" ).append("\n"); 
		query.append("                      , MIN(PD.PORT_PAST) AS POD_PAST" ).append("\n"); 
		query.append("                      , PD.ETA_DT AS POD_ETA_DT" ).append("\n"); 
		query.append("                      , PD.ETD_DT AS POD_ETD_DT" ).append("\n"); 
		query.append("                      , DECODE(PL.CONTI_CD, PD.CONTI_CD, 'I', 'O') AS IOC_CD" ).append("\n"); 
		query.append("                      , DECODE(PL.STS, '1', PL.PORT_PAST, '2', 'N', '3', 'Y') AS PAST" ).append("\n"); 
		query.append("                      , PL.LST_LODG_PORT_CD" ).append("\n"); 
		query.append("                      , PL.LST_LODG_PORT_ETD_DT" ).append("\n"); 
		query.append("                      , PL.OFC_CD" ).append("\n"); 
		query.append("                      , PL.OFC_CONTI" ).append("\n"); 
		query.append("                      , PL.STS" ).append("\n"); 
		query.append("                      , PL.SKIPPED AS POL_SKIP" ).append("\n"); 
		query.append("                      , PD.SKIPPED AS POD_SKIP" ).append("\n"); 
		query.append("                      , SUBSTR(" ).append("\n"); 
		query.append("                        (SELECT MAX(LTRIM(TO_CHAR(S1.PORT_SEQ, 'FM000'))|| S1.PORT_CD)" ).append("\n"); 
		query.append("                           FROM VSL_PORT_SKD S1" ).append("\n"); 
		query.append("                          WHERE S1.SKIPPED <> 1" ).append("\n"); 
		query.append("                        ), 4) AS LD_PORT" ).append("\n"); 
		query.append("                      , PL.PORT_CNT AS PL_PORT_CNT" ).append("\n"); 
		query.append("                      , PD.PORT_CNT AS PD_PORT_CNT" ).append("\n"); 
		query.append("                      , PL.SLAN_CD" ).append("\n"); 
		query.append("                      , PL.VPS_PORT_CD AS PL_VPS_PORT_CD" ).append("\n"); 
		query.append("                      , PD.VPS_PORT_CD AS PD_VPS_PORT_CD" ).append("\n"); 
		query.append("                      , PL.CLPT_IND_SEQ AS PL_CLPT_IND_SEQ" ).append("\n"); 
		query.append("                      , PD.CLPT_IND_SEQ AS PD_CLPT_IND_SEQ" ).append("\n"); 
		query.append("                      , PL.SKD_CNG_STS_CD AS PL_SKD_CNG_STS_CD" ).append("\n"); 
		query.append("                      , ROW_NUMBER()OVER (PARTITION BY PL.REP_TRD_CD, PL.RLANE_CD, PL.VSL_CD, PL.SKD_VOY_NO, PL.SKD_DIR_CD, PL.VPS_PORT_CD, PL.CLPT_IND_SEQ" ).append("\n"); 
		query.append("                                                     , PD.RLANE_CD, PD.VSL_CD, PD.SKD_VOY_NO, PD.SKD_DIR_CD, PD.REP_TRD_CD, PD.VPS_PORT_CD, PD.CLPT_IND_SEQ " ).append("\n"); 
		query.append("                                              ORDER BY PL.REP_TRD_CD, PL.RLANE_CD, PL.VSL_CD, PL.SKD_VOY_NO, PL.SKD_DIR_CD, PL.VPS_PORT_CD, PL.CLPT_IND_SEQ" ).append("\n"); 
		query.append("                                                     , PD.RLANE_CD, PD.VSL_CD, PD.SKD_VOY_NO, PD.SKD_DIR_CD, PD.REP_TRD_CD, PD.VPS_PORT_CD, PD.CLPT_IND_SEQ) AS PL_PD_PORT_CNT" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                      , PL.BSE_YR" ).append("\n"); 
		query.append("                      , PL.BSE_QTR_CD" ).append("\n"); 
		query.append("                      , PL.CALL_YD_IND_SEQ AS POL_YD_SEQ" ).append("\n"); 
		query.append("                      , PD.CALL_YD_IND_SEQ AS POD_YD_SEQ" ).append("\n"); 
		query.append("                   FROM MDM_DTL_REV_LANE DRL" ).append("\n"); 
		query.append("                      , VSL_PORT_SKD PD" ).append("\n"); 
		query.append("                      , VSL_PORT_SKD PL" ).append("\n"); 
		query.append("                  WHERE DRL.RLANE_CD        = PL.RLANE_CD" ).append("\n"); 
		query.append("                    AND DRL.VSL_SLAN_DIR_CD = PL.DIR_CD" ).append("\n"); 
		query.append("                    AND DRL.FM_CONTI_CD     = PL.CONTI_CD" ).append("\n"); 
		query.append("                    AND DRL.TO_CONTI_CD     = PD.CONTI_CD" ).append("\n"); 
		query.append("                    AND PD.REP_TRD_CD       = PL.REP_TRD_CD" ).append("\n"); 
		query.append("                    AND PD.REP_SUB_TRD_CD   = PL.REP_SUB_TRD_CD" ).append("\n"); 
		query.append("                    AND PD.RLANE_CD         = PL.RLANE_CD" ).append("\n"); 
		query.append("                    AND PD.VSL_CD           = PL.VSL_CD" ).append("\n"); 
		query.append("                    AND PD.SKD_VOY_NO       = PL.SKD_VOY_NO" ).append("\n"); 
		query.append("                    AND PD.SKD_DIR_CD       = PL.SKD_DIR_CD" ).append("\n"); 
		query.append("                    AND PD.PORT_CD         <> PL.PORT_CD" ).append("\n"); 
		query.append("                    AND PD.PORT_SEQ         > PL.PORT_SEQ" ).append("\n"); 
		query.append("                    AND ( PL.PORT_SEQ       = DECODE(PD.CONTI_CD, PL.CONTI_CD, PL.MIN_SEQ, PL.MAX_SEQ)" ).append("\n"); 
		query.append("                     OR PD.PORT_SEQ         < PL.MAX_SEQ )" ).append("\n"); 
		query.append("               GROUP BY PL.REP_TRD_CD" ).append("\n"); 
		query.append("                      , PL.REP_SUB_TRD_CD" ).append("\n"); 
		query.append("                      , PL.RLANE_CD" ).append("\n"); 
		query.append("                      , PL.DIR_CD" ).append("\n"); 
		query.append("                      , DRL.TRD_CD" ).append("\n"); 
		query.append("                      , DRL.SUB_TRD_CD" ).append("\n"); 
		query.append("                      , PL.COST_YR" ).append("\n"); 
		query.append("                      , PL.COST_MON" ).append("\n"); 
		query.append("                      , PL.COST_WK" ).append("\n"); 
		query.append("                      , PL.VSL_CD" ).append("\n"); 
		query.append("                      , PL.SKD_VOY_NO" ).append("\n"); 
		query.append("                      , PL.SKD_DIR_CD" ).append("\n"); 
		query.append("                      , PL.PORT_CD" ).append("\n"); 
		query.append("                      , PL.CONTI_CD" ).append("\n"); 
		query.append("                      , PD.PORT_CD" ).append("\n"); 
		query.append("                      , PD.CONTI_CD" ).append("\n"); 
		query.append("                      , PL.SKIPPED" ).append("\n"); 
		query.append("                      , PD.SKIPPED" ).append("\n"); 
		query.append("                      , PL.ETA_DT" ).append("\n"); 
		query.append("                      , PL.ETD_DT" ).append("\n"); 
		query.append("                      , PD.ETA_DT" ).append("\n"); 
		query.append("                      , PD.ETD_DT" ).append("\n"); 
		query.append("                      , DECODE(PL.CONTI_CD, PD.CONTI_CD, 'I', 'O')" ).append("\n"); 
		query.append("                      , DECODE(PL.STS, '1', PL.PORT_PAST, '2', 'N', '3', 'Y')" ).append("\n"); 
		query.append("                      , PL.LST_LODG_PORT_CD" ).append("\n"); 
		query.append("                      , PL.LST_LODG_PORT_ETD_DT" ).append("\n"); 
		query.append("                      , PL.OFC_CD" ).append("\n"); 
		query.append("                      , PL.OFC_CONTI" ).append("\n"); 
		query.append("                      , PL.STS" ).append("\n"); 
		query.append("                      , PL.CLPT_IND_SEQ" ).append("\n"); 
		query.append("                      , PL.VPS_PORT_CD" ).append("\n"); 
		query.append("                      , PD.VPS_PORT_CD" ).append("\n"); 
		query.append("                      , PL.CLPT_IND_SEQ" ).append("\n"); 
		query.append("                      , PD.CLPT_IND_SEQ" ).append("\n"); 
		query.append("                      , PL.PORT_CNT" ).append("\n"); 
		query.append("                      , PD.PORT_CNT" ).append("\n"); 
		query.append("                      , PL.SLAN_CD" ).append("\n"); 
		query.append("                      , PD.REP_TRD_CD" ).append("\n"); 
		query.append("                      , PD.RLANE_CD" ).append("\n"); 
		query.append("                      , PD.VSL_CD" ).append("\n"); 
		query.append("                      , PD.SKD_VOY_NO" ).append("\n"); 
		query.append("                      , PD.SKD_DIR_CD" ).append("\n"); 
		query.append("                      , PL.SKD_CNG_STS_CD" ).append("\n"); 
		query.append("                      , PL.BSE_YR" ).append("\n"); 
		query.append("                      , PL.BSE_QTR_CD" ).append("\n"); 
		query.append("                      , PL.CALL_YD_IND_SEQ" ).append("\n"); 
		query.append("                      , PD.CALL_YD_IND_SEQ" ).append("\n"); 
		query.append("                )" ).append("\n"); 
		query.append("        ) A" ).append("\n"); 
		query.append("  WHERE A.PL_PD_PORT_CNT = PL_PD_PORT_MAX" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("MAS_MON_VVD_LV AS (   " ).append("\n"); 
		query.append("    SELECT B.TRD_CD    , " ).append("\n"); 
		query.append("           B.SUB_TRD_CD," ).append("\n"); 
		query.append("           B.RLANE_CD  ," ).append("\n"); 
		query.append("           B.DIR_CD    ," ).append("\n"); 
		query.append("           B.IOC_CD    ," ).append("\n"); 
		query.append("           B.COST_YR   ," ).append("\n"); 
		query.append("           B.COST_MON  ," ).append("\n"); 
		query.append("		   B.BSE_QTR_CD," ).append("\n"); 
		query.append("           B.BSE_YR    ," ).append("\n"); 
		query.append("           B.NUM       ," ).append("\n"); 
		query.append("           DENSE_RANK() OVER(PARTITION BY B.TRD_CD, B.RLANE_CD, B.DIR_CD, B.NUM ORDER BY B.DIR_CD, B.PORT_ETD) NUM_1," ).append("\n"); 
		query.append("           B.COST_WK   ," ).append("\n"); 
		query.append("           B.VSL_CD    ," ).append("\n"); 
		query.append("           B.SKD_VOY_NO," ).append("\n"); 
		query.append("           B.SKD_DIR_CD," ).append("\n"); 
		query.append("           B.RHQ_CD    ," ).append("\n"); 
		query.append("           B.AQ_CD     ," ).append("\n"); 
		query.append("           B.RGN_OFC_CD," ).append("\n"); 
		query.append("           (" ).append("\n"); 
		query.append("             SELECT DECODE(O.OFC_TP_CD, 'QT', O.PRNT_OFC_CD, DECODE(@[ofc_cd], 'ATLSA', 'NYCRA', 'SLSSC', 'NYCRA', 'PHXSA', 'NYCRA', O.OFC_CD))" ).append("\n"); 
		query.append("               FROM SPC_OFC_LVL O  ," ).append("\n"); 
		query.append("                    COM_USER    COM" ).append("\n"); 
		query.append("              WHERE COM.USR_ID = @[login_id]" ).append("\n"); 
		query.append("                AND B.COST_YR || B.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK" ).append("\n"); 
		query.append("                AND O.OFC_CD = SPC_SCR_OFC_CONV_FNC(DECODE(@[login_id], '09012001', 'ISTEM', '09014001','ISTEM',  COM.OFC_CD), @[ui_name])  " ).append("\n"); 
		query.append("           ) AS OFC_CD," ).append("\n"); 
		query.append("           B.POL_CD         ," ).append("\n"); 
		query.append("           SPC_GET_WK_VVD_BSA_FNC('VOL', B.TRD_CD, B.RLANE_CD, B.DIR_CD, B.COST_YR||B.COST_WK, B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD) AS BSA ," ).append("\n"); 
		query.append("           SPC_GET_WK_VVD_BSA_FNC('WGT', B.TRD_CD, B.RLANE_CD, B.DIR_CD, B.COST_YR||B.COST_WK, B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD) AS BSA_WGT ," ).append("\n"); 
		query.append("           B.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           B.PAST           ," ).append("\n"); 
		query.append("           (SELECT /*+ INDEX_DESC (M XPKSPC_MDL_VER_MST ) */" ).append("\n"); 
		query.append("                   DECODE(HH_FLG, 'N', '200001-1', M.COST_YRWK||'-'||M.VER_SEQ)" ).append("\n"); 
		query.append("              FROM SPC_MDL_VER_MST M" ).append("\n"); 
		query.append("             WHERE B.COST_YR ||B.COST_WK BETWEEN M.VER_ST_YRWK AND M.VER_END_YRWK" ).append("\n"); 
		query.append("               AND M.TRD_CD  = B.TRD_CD" ).append("\n"); 
		query.append("               AND M.CFM_FLG = 'Y'" ).append("\n"); 
		query.append("               AND ROWNUM    = 1" ).append("\n"); 
		query.append("           ) AS SEASON," ).append("\n"); 
		query.append("           NVL(O.ACCT_GRP_CTRL_FLG, 'N') AS ACCT_FLG" ).append("\n"); 
		query.append("          ,NVL(O.CTRL_ECC_FLG, 'N')         AS CTRL_ECC_FLG" ).append("\n"); 
		query.append("          ,NVL(O.CTRL_LOC_FLG, 'N')         AS CTRL_LOC_FLG" ).append("\n"); 
		query.append("          ,NVL(O.CTRL_USA_SVC_MOD_FLG, 'N') AS CTRL_USA_SVC_MOD_FLG" ).append("\n"); 
		query.append("          ,NVL(O.CTRL_ACCT_FLG, 'N')        AS CTRL_ACCT_FLG" ).append("\n"); 
		query.append("          ,NVL(O.CTRL_DEST_LVL_CD, 'N')     AS CTRL_DEST_LVL_CD" ).append("\n"); 
		query.append("          ,NVL(O.CTRL_FX_RT_FLG, 'N')       AS CTRL_FX_RT_FLG" ).append("\n"); 
		query.append("          ,O.CTRL_LVL_CD " ).append("\n"); 
		query.append("		  ,B.FL_ETD_DT	  " ).append("\n"); 
		query.append("		  ,change_code" ).append("\n"); 
		query.append("      FROM (" ).append("\n"); 
		query.append("              SELECT M.TRD_CD    ," ).append("\n"); 
		query.append("                     M.SUB_TRD_CD," ).append("\n"); 
		query.append("                     M.RLANE_CD  ," ).append("\n"); 
		query.append("                     M.DIR_CD    ," ).append("\n"); 
		query.append("                     M.IOC_CD    ," ).append("\n"); 
		query.append("                     SUBSTR(M.SLS_YRMON, 1, 4) AS COST_YR ," ).append("\n"); 
		query.append("                     SUBSTR(M.SLS_YRMON, 5)    AS COST_MON," ).append("\n"); 
		query.append("                     P.RNUM NUM       ," ).append("\n"); 
		query.append("                     M.COST_WK        ," ).append("\n"); 
		query.append("                     DECODE(@[trade], 'IAS', NVL(L.LOD_SPL_CNG_FLG,'N'), 'Y') AS LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                     M.VSL_CD         ," ).append("\n"); 
		query.append("                     M.SKD_VOY_NO     ," ).append("\n"); 
		query.append("                     M.DIR_CD               AS SKD_DIR_CD," ).append("\n"); 
		query.append("                     C.RHQ_CD               AS RHQ_CD    ," ).append("\n"); 
		query.append("                     @[area]                AS AQ_CD     ," ).append("\n"); 
		query.append("                     @[sales_office]        AS RGN_OFC_CD," ).append("\n"); 
		query.append("                     @[pol_cd]              AS POL_CD    ," ).append("\n"); 
		query.append("                     DECODE(SIGN(SUBSTR(M.SLS_YRMON, 1, 4)||M.COST_WK - ( SELECT PRD.COST_YR||TO_CHAR(CEIL((TO_CHAR(SYSDATE, 'DDD') + 7 - TO_CHAR(TO_DATE(PRD.SLS_TO_DT, 'YYYYMMDD'), 'DDD')) / 7), 'FM00')" ).append("\n"); 
		query.append("                                                                            FROM MAS_WK_PRD PRD" ).append("\n"); 
		query.append("                                                                           WHERE PRD.COST_YR = TO_CHAR(SYSDATE, 'YYYY')" ).append("\n"); 
		query.append("                                                                             AND PRD.COST_WK = '01')), -1, 'Y', 'N') AS PAST," ).append("\n"); 
		query.append("                     DECODE(H.DIR_CD, NULL, 'N', 'Y') AS HH_FLG" ).append("\n"); 
		query.append("                    ,TO_CHAR(M.LST_LODG_PORT_ETD_DT,'YYYYMMDD') AS PORT_ETD" ).append("\n"); 
		query.append("					, CASE WHEN M.COST_YRMON >= '201501' " ).append("\n"); 
		query.append("                           THEN CEIL(TO_NUMBER(SUBSTR(M.COST_YRMON, -2))/3)||'Q' " ).append("\n"); 
		query.append("                           ELSE CEIL(TO_NUMBER(DECODE(M.COST_WK,'00','01','53','52',M.COST_WK))/13)||'Q'" ).append("\n"); 
		query.append("                      END BSE_QTR_CD " ).append("\n"); 
		query.append("                    , SUBSTR(M.COST_YRMON, 1,4) AS BSE_YR" ).append("\n"); 
		query.append("                    , M.N1ST_LODG_PORT_ETD_DT AS FL_ETD_DT " ).append("\n"); 
		query.append("		    , (CASE " ).append("\n"); 
		query.append("									WHEN M.RLANE_CD IN ('AUSIA', 'CKAIA', 'WAXIA', 'AAZIA', 'QISIA', 'RUSIA', 'FOXIA','KJXIA','KCXIA','KDSIA') THEN" ).append("\n"); 
		query.append("										 " ).append("\n"); 
		query.append("											DECODE(M.DIR_CD, 'E', 'W', 'W', 'E', M.DIR_CD)" ).append("\n"); 
		query.append("                                    WHEN M.RLANE_CD IN ('KVTIA','KMHIA') THEN" ).append("\n"); 
		query.append("										 " ).append("\n"); 
		query.append("											DECODE(M.DIR_CD, 'N', 'E', 'S', 'W', M.DIR_CD)" ).append("\n"); 
		query.append("									ELSE" ).append("\n"); 
		query.append("                                        (CASE WHEN M.SLAN_CD = 'CAT' THEN DECODE(M.DIR_CD, 'E', 'W', 'W', 'E', M.DIR_CD) ELSE  M.DIR_CD END)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("								END) as change_code" ).append("\n"); 
		query.append("                FROM MAS_MON_VVD     M," ).append("\n"); 
		query.append("                     MAS_LANE_RGST   L," ).append("\n"); 
		query.append("                     (" ).append("\n"); 
		query.append("                        SELECT /*+ INDEX (P, XPKMAS_WK_PRD) */" ).append("\n"); 
		query.append("                               P.COST_YR||P.COST_WK AS COST_YRWK," ).append("\n"); 
		query.append("                               ROWNUM               AS RNUM" ).append("\n"); 
		query.append("                          FROM MAS_WK_PRD P" ).append("\n"); 
		query.append("                         WHERE P.COST_YR||P.COST_WK >= @[year]||@[week]" ).append("\n"); 
		query.append("                           AND ROWNUM               <= @[duration]" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                     ) P," ).append("\n"); 
		query.append("                     (" ).append("\n"); 
		query.append("       				 SELECT DISTINCT" ).append("\n"); 
		query.append("            			    SUBSTR(AA," ).append("\n"); 
		query.append("             					   INSTR(AA,',',1,LEVEL)+1," ).append("\n"); 
		query.append("               					   INSTR(AA,',',1,LEVEL+1) - INSTR(AA,',',1,LEVEL)" ).append("\n"); 
		query.append("              					  -1" ).append("\n"); 
		query.append("              					  ) RHQ_CD" ).append("\n"); 
		query.append("         			   FROM (SELECT ','||@[rhq2]||',' AA FROM DUAL)" ).append("\n"); 
		query.append("          					  CONNECT BY LEVEL <= LENGTH(AA) - LENGTH(REPLACE(AA,','))-1" ).append("\n"); 
		query.append("                     ) C," ).append("\n"); 
		query.append("                     SPC_HD_HUL_MST H" ).append("\n"); 
		query.append("               WHERE SUBSTR(M.SLS_YRMON, 1, 4)||M.COST_WK = P.COST_YRWK" ).append("\n"); 
		query.append("                 AND (M.DELT_FLG IS NULL OR M.DELT_FLG = 'N')" ).append("\n"); 
		query.append("       " ).append("\n"); 
		query.append("#if (${trade} != '')" ).append("\n"); 
		query.append("                 AND M.TRD_CD = @[trade]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${subtrade1} != '')" ).append("\n"); 
		query.append("                 AND M.SUB_TRD_CD = @[subtrade1]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${bound} != '')" ).append("\n"); 
		query.append("                 AND M.DIR_CD = (CASE " ).append("\n"); 
		query.append("									WHEN M.RLANE_CD IN ('AUSIA', 'CKAIA', 'WAXIA', 'AAZIA', 'QISIA', 'RUSIA', 'FOXIA','KJXIA','KCXIA','KDSIA') THEN" ).append("\n"); 
		query.append("											DECODE(@[bound], 'E', 'W', 'W', 'E', @[bound])" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                    WHEN M.RLANE_CD IN ('KVTIA','KMHIA') THEN" ).append("\n"); 
		query.append("										 " ).append("\n"); 
		query.append("											DECODE(@[bound], 'E', 'N', 'W', 'S', @[bound])" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("									ELSE" ).append("\n"); 
		query.append("                                        (CASE WHEN M.SLAN_CD = 'CAT' THEN DECODE(@[bound], 'W', 'E', 'E', 'W', @[bound]) ELSE @[bound] END)" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("								END)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                 AND M.TRD_CD          = L.TRD_CD" ).append("\n"); 
		query.append("                 AND M.RLANE_CD        = L.RLANE_CD" ).append("\n"); 
		query.append("                 AND M.DIR_CD          = L.DIR_CD" ).append("\n"); 
		query.append("                 AND M.IOC_CD          = L.IOC_CD" ).append("\n"); 
		query.append("                 AND L.DELT_FLG        = 'N'" ).append("\n"); 
		query.append("                 AND M.TRD_CD          = H.TRD_CD    (+)" ).append("\n"); 
		query.append("                 AND M.RLANE_CD        = H.RLANE_CD  (+)" ).append("\n"); 
		query.append("                 AND M.DIR_CD          = H.DIR_CD    (+)" ).append("\n"); 
		query.append("#if (${rlane1} != '')" ).append("\n"); 
		query.append("                 AND M.RLANE_CD         IN ($rlane1)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("           ) B," ).append("\n"); 
		query.append("           SPC_ALOC_CTRL_OPT O" ).append("\n"); 
		query.append("     WHERE B.TRD_CD     = O.REP_TRD_CD(+)" ).append("\n"); 
		query.append("       AND B.RLANE_CD   = O.RLANE_CD  (+)" ).append("\n"); 
		query.append("       AND B.DIR_CD     = O.DIR_CD    (+)" ).append("\n"); 
		query.append("       AND B.VSL_CD     = O.VSL_CD    (+)" ).append("\n"); 
		query.append("       AND B.SKD_VOY_NO = O.SKD_VOY_NO(+)" ).append("\n"); 
		query.append("       AND B.SKD_DIR_CD = O.SKD_DIR_CD(+)" ).append("\n"); 
		query.append("  ORDER BY B.VSL_CD    ," ).append("\n"); 
		query.append("           B.SKD_VOY_NO," ).append("\n"); 
		query.append("           B.DIR_CD" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", CTRT_OPT_DTL AS (" ).append("\n"); 
		query.append("-- SPC_ALOC_LANE_CTRL_OPT_DTL 테이블의 계약 정보를 가지고 온다." ).append("\n"); 
		query.append("SELECT DISTINCT  " ).append("\n"); 
		query.append("       A2.TRD_CD" ).append("\n"); 
		query.append("      ,A2.SUB_TRD_CD" ).append("\n"); 
		query.append("      ,A2.RLANE_CD" ).append("\n"); 
		query.append("      ,A2.DIR_CD" ).append("\n"); 
		query.append("      ,A2.ALOC_CTRL_TP_CD" ).append("\n"); 
		query.append("      ,A2.CTRL_LOC_ACCT_CD" ).append("\n"); 
		query.append("      ,A1.FL_ETD_DT" ).append("\n"); 
		query.append("      ,change_code" ).append("\n"); 
		query.append("  FROM MAS_MON_VVD_LV A1" ).append("\n"); 
		query.append("      ,SPC_ALOC_LANE_CTRL_OPT_DTL A2" ).append("\n"); 
		query.append(" WHERE 1=1" ).append("\n"); 
		query.append("   AND A1.TRD_CD           = A2.TRD_CD" ).append("\n"); 
		query.append("   AND A1.SUB_TRD_CD       = A2.SUB_TRD_CD" ).append("\n"); 
		query.append("   AND A1.RLANE_CD         = A2.RLANE_CD" ).append("\n"); 
		query.append("   AND A1.DIR_CD           = A2.DIR_CD" ).append("\n"); 
		query.append("   AND A1.CTRL_ACCT_FLG    = 'Y'" ).append("\n"); 
		query.append("   AND A1.CTRL_FX_RT_FLG   = 'Y'" ).append("\n"); 
		query.append("   AND A2.CTRL_FX_RT_FLG   = 'Y'" ).append("\n"); 
		query.append("   AND A2.ALOC_CTRL_TP_CD  = 'F'" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", CTRT_DTL_INFO AS (" ).append("\n"); 
		query.append("    SELECT  " ).append("\n"); 
		query.append("           A5.TRD_CD" ).append("\n"); 
		query.append("          ,A5.SUB_TRD_CD" ).append("\n"); 
		query.append("          ,A5.RLANE_CD" ).append("\n"); 
		query.append("          ,A5.DIR_CD" ).append("\n"); 
		query.append("          ,A5.ALOC_CTRL_TP_CD" ).append("\n"); 
		query.append("          ,A5.CTRL_LOC_ACCT_CD " ).append("\n"); 
		query.append("          ,A1.PROP_NO" ).append("\n"); 
		query.append("          ,A2.AMDT_SEQ" ).append("\n"); 
		query.append("          ,A3.SVC_SCP_CD" ).append("\n"); 
		query.append("          ,A4.GEN_SPCL_RT_TP_CD" ).append("\n"); 
		query.append("          ,A4.CMDT_HDR_SEQ" ).append("\n"); 
		query.append("          ,A2.REAL_CUST_CNT_CD || LPAD(A2.REAL_CUST_SEQ,'6','0') CUST_CD" ).append("\n"); 
		query.append("          ,A4.FX_RT_FLG" ).append("\n"); 
		query.append("          ,A2.EFF_DT" ).append("\n"); 
		query.append("          ,A2.EXP_DT" ).append("\n"); 
		query.append("          ,A2.PROP_STS_CD" ).append("\n"); 
		query.append("      FROM CTRT_OPT_DTL A5" ).append("\n"); 
		query.append("          ,PRI_SP_HDR A1" ).append("\n"); 
		query.append("          ,PRI_SP_MN  A2" ).append("\n"); 
		query.append("          ,PRI_SP_SCP_MN A3" ).append("\n"); 
		query.append("          ,PRI_SP_SCP_RT_CMDT_HDR A4 " ).append("\n"); 
		query.append("     WHERE 1=1" ).append("\n"); 
		query.append("       AND A1.SC_NO             = A5.CTRL_LOC_ACCT_CD" ).append("\n"); 
		query.append("       AND A1.PROP_NO           = A2.PROP_NO" ).append("\n"); 
		query.append("       AND A2.PROP_STS_CD       = 'F' -- A, F, Q" ).append("\n"); 
		query.append("       AND TRUNC(A5.FL_ETD_DT) BETWEEN A2.EFF_DT AND A2.EXP_DT" ).append("\n"); 
		query.append("       AND A2.PROP_NO           = A3.PROP_NO" ).append("\n"); 
		query.append("       AND A2.AMDT_SEQ          = A3.AMDT_SEQ" ).append("\n"); 
		query.append("       AND A3.PROP_NO           = A4.PROP_NO" ).append("\n"); 
		query.append("       AND A3.AMDT_SEQ          = A4.AMDT_SEQ" ).append("\n"); 
		query.append("       AND A3.SVC_SCP_CD        = A4.SVC_SCP_CD" ).append("\n"); 
		query.append("       AND NVL(A4.FX_RT_FLG,'N')= 'Y'" ).append("\n"); 
		query.append("     )" ).append("\n"); 
		query.append(", ALOC_LANE_CTRL_OPT_DTL AS (" ).append("\n"); 
		query.append("SELECT DISTINCT B1.TRD_CD" ).append("\n"); 
		query.append("      ,B1.SUB_TRD_CD" ).append("\n"); 
		query.append("      ,B1.RLANE_CD" ).append("\n"); 
		query.append("      ,B1.DIR_CD" ).append("\n"); 
		query.append("      ,NVL(B3.ALOC_CTRL_TP_CD, B1.ALOC_CTRL_TP_CD) AS ALOC_CTRL_TP_CD" ).append("\n"); 
		query.append("      ,B1.CTRL_LOC_ACCT_CD" ).append("\n"); 
		query.append("      ,B1.SC_NO" ).append("\n"); 
		query.append("      ,B1.RFA_NO" ).append("\n"); 
		query.append("      ,NVL(B3.ALOC_CTRL_DTL_CD, B1.ALOC_CTRL_DTL_CD) AS ALOC_CTRL_DTL_CD" ).append("\n"); 
		query.append("      ,change_code" ).append("\n"); 
		query.append("  FROM " ).append("\n"); 
		query.append("       SPC_ALOC_LANE_CTRL_OPT_DTL B1" ).append("\n"); 
		query.append("      ,MAS_MON_VVD_LV B2" ).append("\n"); 
		query.append("      ,(" ).append("\n"); 
		query.append("        -- Actual Account 정보 추출" ).append("\n"); 
		query.append("        SELECT distinct" ).append("\n"); 
		query.append("               A1.TRD_CD" ).append("\n"); 
		query.append("              ,A1.SUB_TRD_CD" ).append("\n"); 
		query.append("              ,A1.RLANE_CD" ).append("\n"); 
		query.append("              ,A1.DIR_CD" ).append("\n"); 
		query.append("              ,'B' AS ALOC_CTRL_TP_CD" ).append("\n"); 
		query.append("              ,A1.ALOC_CTRL_TP_CD AS ORG_ALOC_CTRL_TP_CD -- B : A/Acct, C : Commodity, F : Fixed" ).append("\n"); 
		query.append("              ,A1.CTRL_LOC_ACCT_CD" ).append("\n"); 
		query.append("              ,A1.PROP_NO" ).append("\n"); 
		query.append("              ,A1.AMDT_SEQ" ).append("\n"); 
		query.append("              ,A1.SVC_SCP_CD" ).append("\n"); 
		query.append("              ,A2.CUST_CNT_CD || LPAD(A2.CUST_SEQ,'6','0') AS ALOC_CTRL_DTL_CD" ).append("\n"); 
		query.append("          FROM CTRT_DTL_INFO A1" ).append("\n"); 
		query.append("              ,PRI_SP_SCP_RT_ACT_CUST A2" ).append("\n"); 
		query.append("         WHERE 1=1" ).append("\n"); 
		query.append("           AND A1.PROP_NO           = A2.PROP_NO" ).append("\n"); 
		query.append("           AND A1.AMDT_SEQ          = A2.AMDT_SEQ" ).append("\n"); 
		query.append("           AND A1.SVC_SCP_CD        = A2.SVC_SCP_CD" ).append("\n"); 
		query.append("           AND A1.GEN_SPCL_RT_TP_CD = A2.GEN_SPCL_RT_TP_CD" ).append("\n"); 
		query.append("           AND A1.CMDT_HDR_SEQ      = A2.CMDT_HDR_SEQ" ).append("\n"); 
		query.append("        UNION ALL" ).append("\n"); 
		query.append("        -- CMDT 정보 추출" ).append("\n"); 
		query.append("        SELECT distinct" ).append("\n"); 
		query.append("               A1.TRD_CD" ).append("\n"); 
		query.append("              ,A1.SUB_TRD_CD" ).append("\n"); 
		query.append("              ,A1.RLANE_CD" ).append("\n"); 
		query.append("              ,A1.DIR_CD" ).append("\n"); 
		query.append("              ,'C' AS ALOC_CTRL_TP_CD" ).append("\n"); 
		query.append("              ,A1.ALOC_CTRL_TP_CD AS ORG_ALOC_CTRL_TP_CD -- B : A/Acct, C : Commodity, F : Fixed" ).append("\n"); 
		query.append("              ,A1.CTRL_LOC_ACCT_CD" ).append("\n"); 
		query.append("              ,A1.PROP_NO" ).append("\n"); 
		query.append("              ,A1.AMDT_SEQ" ).append("\n"); 
		query.append("              ,A1.SVC_SCP_CD" ).append("\n"); 
		query.append("              ,DECODE(A2.PRC_CMDT_TP_CD,'C', A2.PRC_CMDT_DEF_CD, 'G', A4.PRC_CMDT_DEF_CD) AS ALOC_CTRL_DTL_CD" ).append("\n"); 
		query.append("          FROM CTRT_DTL_INFO A1" ).append("\n"); 
		query.append("              ,PRI_SP_SCP_RT_CMDT     A2" ).append("\n"); 
		query.append("              ,PRI_SP_SCP_GRP_CMDT    A3" ).append("\n"); 
		query.append("              ,PRI_SP_SCP_GRP_CMDT_DTL A4  " ).append("\n"); 
		query.append("         WHERE 1=1" ).append("\n"); 
		query.append("           AND A1.PROP_NO           = A2.PROP_NO" ).append("\n"); 
		query.append("           AND A1.AMDT_SEQ          = A2.AMDT_SEQ" ).append("\n"); 
		query.append("           AND A1.SVC_SCP_CD        = A2.SVC_SCP_CD" ).append("\n"); 
		query.append("           AND A1.GEN_SPCL_RT_TP_CD = A2.GEN_SPCL_RT_TP_CD" ).append("\n"); 
		query.append("           AND A1.CMDT_HDR_SEQ      = A2.CMDT_HDR_SEQ" ).append("\n"); 
		query.append("           AND A2.SRC_INFO_CD       <> 'AD'" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("           AND A2.PROP_NO           = A3.PROP_NO(+)" ).append("\n"); 
		query.append("           AND A2.AMDT_SEQ          = A3.AMDT_SEQ(+)" ).append("\n"); 
		query.append("           AND A2.SVC_SCP_CD        = A3.SVC_SCP_CD(+)" ).append("\n"); 
		query.append("           AND A2.PRC_CMDT_DEF_CD   = A3.PRC_GRP_CMDT_CD(+)" ).append("\n"); 
		query.append("           " ).append("\n"); 
		query.append("           AND A3.PROP_NO           = A4.PROP_NO(+)" ).append("\n"); 
		query.append("           AND A3.AMDT_SEQ          = A4.AMDT_SEQ(+)" ).append("\n"); 
		query.append("           AND A3.SVC_SCP_CD        = A4.SVC_SCP_CD(+)" ).append("\n"); 
		query.append("           AND A3.GRP_CMDT_SEQ      = A4.GRP_CMDT_SEQ(+)   " ).append("\n"); 
		query.append("           AND A4.SRC_INFO_CD(+)    <> 'AD'" ).append("\n"); 
		query.append("         GROUP BY A1.TRD_CD" ).append("\n"); 
		query.append("              ,A1.SUB_TRD_CD" ).append("\n"); 
		query.append("              ,A1.RLANE_CD" ).append("\n"); 
		query.append("              ,A1.DIR_CD" ).append("\n"); 
		query.append("              ,A1.ALOC_CTRL_TP_CD" ).append("\n"); 
		query.append("              ,A1.CTRL_LOC_ACCT_CD" ).append("\n"); 
		query.append("              ,A1.PROP_NO" ).append("\n"); 
		query.append("              ,A1.AMDT_SEQ" ).append("\n"); 
		query.append("              ,A1.SVC_SCP_CD" ).append("\n"); 
		query.append("              ,DECODE(A2.PRC_CMDT_TP_CD,'C', A2.PRC_CMDT_DEF_CD, 'G', A4.PRC_CMDT_DEF_CD)       " ).append("\n"); 
		query.append("       ) B3" ).append("\n"); 
		query.append(" WHERE 1=1" ).append("\n"); 
		query.append("   AND B2.TRD_CD           = B1.TRD_CD" ).append("\n"); 
		query.append("   AND B2.SUB_TRD_CD       = B1.SUB_TRD_CD" ).append("\n"); 
		query.append("   AND B2.RLANE_CD         = B1.RLANE_CD" ).append("\n"); 
		query.append("   AND B2.DIR_CD           = B1.DIR_CD" ).append("\n"); 
		query.append("   AND B1.TRD_CD           = B3.TRD_CD(+)" ).append("\n"); 
		query.append("   AND B1.SUB_TRD_CD       = B3.SUB_TRD_CD(+)" ).append("\n"); 
		query.append("   AND B1.RLANE_CD         = B3.RLANE_CD(+)" ).append("\n"); 
		query.append("   AND B1.DIR_CD           = B3.DIR_CD(+)" ).append("\n"); 
		query.append("   AND B1.ALOC_CTRL_TP_CD  = B3.ORG_ALOC_CTRL_TP_CD(+)" ).append("\n"); 
		query.append("   AND B1.CTRL_LOC_ACCT_CD = B3.CTRL_LOC_ACCT_CD(+)" ).append("\n"); 
		query.append("    )" ).append("\n"); 
		query.append(", QTA_DATA AS (" ).append("\n"); 
		query.append("    SELECT 1 AS FLG    ," ).append("\n"); 
		query.append("           R.TRD_CD    ," ).append("\n"); 
		query.append("           R.DIR_CD    ," ).append("\n"); 
		query.append("           R.SUB_TRD_CD," ).append("\n"); 
		query.append("           R.RLANE_CD  ," ).append("\n"); 
		query.append("           NVL(( SELECT T2.CONV_RGN_OFC_CD" ).append("\n"); 
		query.append("                   FROM SPC_RGN_OFC_CONV T2" ).append("\n"); 
		query.append("                  WHERE T2.SLS_RGN_OFC_CD = R.OFC_CD), R.OFC_CD) AS OFC_CD," ).append("\n"); 
		query.append("           R.WK             ," ).append("\n"); 
		query.append("           R.NUM            ," ).append("\n"); 
		query.append("           R.NUM_1," ).append("\n"); 
		query.append("           R.VVD            , R.VSL_CD, R.SKD_VOY_NO, R.SKD_DIR_CD," ).append("\n"); 
		query.append("           R.BSA            , R.BSA_WGT," ).append("\n"); 
		query.append("           R.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           R.ACCT_FLG       ," ).append("\n"); 
		query.append("           'C' AS CUST_CTRL_CD," ).append("\n"); 
		query.append("           SUM(R.QTA_GREV)       AS QTA_GREV," ).append("\n"); 
		query.append("           SUM(R.QTA_CM)         AS QTA_CM " ).append("\n"); 
		query.append("           , CTRL_ECC_FLG, CTRL_LOC_FLG, CTRL_USA_SVC_MOD_FLG, CTRL_ACCT_FLG, CTRL_DEST_LVL_CD " ).append("\n"); 
		query.append("#if (${check_sector2} == 'Y')" ).append("\n"); 
		query.append("           , R.POD_CD" ).append("\n"); 
		query.append("           , SUM(R.S_QTA_QTY) AS QTA_QTY" ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("           , SUM(R.QTA_QTY) AS QTA_QTY" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("           , 0 AS FCT_QTY" ).append("\n"); 
		query.append("           , 0 AS FCT_GREV" ).append("\n"); 
		query.append("           , 0 AS FCT_CM" ).append("\n"); 
		query.append("           , 0 AS ALC_QTY" ).append("\n"); 
		query.append("           , 0 AS ALC_GREV" ).append("\n"); 
		query.append("           , 0 AS ALC_CM" ).append("\n"); 
		query.append("           , 0 AS BKG_QTY" ).append("\n"); 
		query.append("           , 0 AS BKG_GREV" ).append("\n"); 
		query.append("           , 0 AS BKG_CM" ).append("\n"); 
		query.append("	   ,change_code" ).append("\n"); 
		query.append("      FROM (" ).append("\n"); 
		query.append("              SELECT " ).append("\n"); 
		query.append("#if (${check_sector2} == 'Y')" ).append("\n"); 
		query.append("				     DISTINCT " ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("				     MQ.TRD_CD     ," ).append("\n"); 
		query.append("                     A.SUB_TRD_CD  ," ).append("\n"); 
		query.append("                     MQ.RLANE_CD   ," ).append("\n"); 
		query.append("                     MQ.DIR_CD     ," ).append("\n"); 
		query.append("                     MQ.RGN_OFC_CD        AS OFC_CD," ).append("\n"); 
		query.append("                     A.COST_YR||A.COST_WK AS WK    ," ).append("\n"); 
		query.append("                     A.NUM," ).append("\n"); 
		query.append("                     A.NUM_1," ).append("\n"); 
		query.append("                     MQ.VSL_CD||MQ.SKD_VOY_NO||MQ.SKD_DIR_CD AS VVD, MQ.VSL_CD, MQ.SKD_VOY_NO, MQ.SKD_DIR_CD," ).append("\n"); 
		query.append("                    " ).append("\n"); 
		query.append("                     A.BSA            ,A.BSA_WGT," ).append("\n"); 
		query.append("                     A.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                     A.ACCT_FLG       ," ).append("\n"); 
		query.append("                     (MQ.LOD_QTY) AS QTA_QTY," ).append("\n"); 
		query.append("                     0 AS QTA_GREV," ).append("\n"); 
		query.append("                     0 AS QTA_CM" ).append("\n"); 
		query.append("                    , A.CTRL_ECC_FLG, A.CTRL_LOC_FLG, A.CTRL_USA_SVC_MOD_FLG, A.CTRL_ACCT_FLG, A.CTRL_DEST_LVL_CD " ).append("\n"); 
		query.append("#if (${check_sector2} == 'Y')" ).append("\n"); 
		query.append("                     -- Excluding Sector" ).append("\n"); 
		query.append("                    , SQP.POL_CD" ).append("\n"); 
		query.append("                    , SQP.POD_CD" ).append("\n"); 
		query.append("                    , SQ.LOD_QTY AS S_QTA_QTY" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                    ,change_code" ).append("\n"); 
		query.append("                FROM MAS_MON_VVD_LV   A  ," ).append("\n"); 
		query.append("                     SQM_CFM_QTA      MQ ," ).append("\n"); 
		query.append("                     SQM_QTA_RLSE_VER MQR," ).append("\n"); 
		query.append("#if (${check_sector2} == 'Y')" ).append("\n"); 
		query.append("                     SQM_SCTR_CFM_QTA   SQ, -- Excluding Sector" ).append("\n"); 
		query.append("                     SQM_SCTR_PAIR_MGMT SQP, -- Excluding Sector" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                     SPC_OFC_LVL      O" ).append("\n"); 
		query.append("               WHERE 1=1" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${rhq2} != '')" ).append("\n"); 
		query.append("                 AND A.RHQ_CD = O.N2ND_PRNT_OFC_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${area} != '')" ).append("\n"); 
		query.append("                 AND A.AQ_CD = MQ.AQ_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${sales_office} != '')" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                 AND A.RGN_OFC_CD = NVL(( SELECT O2.CONV_RGN_OFC_CD" ).append("\n"); 
		query.append("                                            FROM SPC_RGN_OFC_CONV O2" ).append("\n"); 
		query.append("                                           WHERE O2.SLS_RGN_OFC_CD = MQ.RGN_OFC_CD), MQ.RGN_OFC_CD)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${pol_cd} != '')" ).append("\n"); 
		query.append("                 AND A.POL_CD = '00000'" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                 AND MQR.BSE_YR          = A.BSE_YR" ).append("\n"); 
		query.append("				 AND MQR.BSE_QTR_CD      = A.BSE_QTR_CD" ).append("\n"); 
		query.append("                 AND MQR.SQM_VER_STS_CD  = 'R'" ).append("\n"); 
		query.append("                 AND MQR.BSE_TP_CD       = 'Q' " ).append("\n"); 
		query.append("                 AND MQ.QTA_RLSE_VER_NO  = MQR.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                 AND MQ.BSE_TP_CD        = MQR.BSE_TP_CD  " ).append("\n"); 
		query.append("                 AND MQ.BSE_YR           = MQR.BSE_YR" ).append("\n"); 
		query.append("                 AND MQ.BSE_QTR_CD       = MQR.BSE_QTR_CD                 " ).append("\n"); 
		query.append("                 AND MQ.QTA_TGT_CD       = 'D'" ).append("\n"); 
		query.append("                 AND MQ.OFC_VW_CD        = 'L'  " ).append("\n"); 
		query.append("                 AND MQ.TRD_CD           = A.TRD_CD" ).append("\n"); 
		query.append("                 AND MQ.RLANE_CD         = A.RLANE_CD" ).append("\n"); 
		query.append("                 AND MQ.DIR_CD           = A.SKD_DIR_CD" ).append("\n"); 
		query.append("                 AND MQ.VSL_CD           = A.VSL_CD" ).append("\n"); 
		query.append("                 AND MQ.SKD_VOY_NO       = A.SKD_VOY_NO" ).append("\n"); 
		query.append("                 AND MQ.SKD_DIR_CD       = A.SKD_DIR_CD" ).append("\n"); 
		query.append("#if (${check_sector2} == 'Y')		 " ).append("\n"); 
		query.append("                 AND MQ.QTA_RLSE_VER_NO  =     SQ.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                 AND MQ.BSE_TP_CD        =     SQ.BSE_TP_CD" ).append("\n"); 
		query.append("                 AND MQ.BSE_YR           =     SQ.BSE_YR" ).append("\n"); 
		query.append("                 AND MQ.BSE_QTR_CD       =     SQ.BSE_QTR_CD" ).append("\n"); 
		query.append("                 AND MQ.OFC_VW_CD        =     SQ.OFC_VW_CD" ).append("\n"); 
		query.append("                 AND MQ.RLANE_CD         =     SQ.RLANE_CD" ).append("\n"); 
		query.append("                 AND MQ.DIR_CD           =     SQ.DIR_CD" ).append("\n"); 
		query.append("                 AND MQ.VSL_CD           =     SQ.VSL_CD" ).append("\n"); 
		query.append("                 AND MQ.SKD_VOY_NO       =     SQ.SKD_VOY_NO" ).append("\n"); 
		query.append("                 AND MQ.SKD_DIR_CD       =     SQ.SKD_DIR_CD" ).append("\n"); 
		query.append("                 AND MQ.RGN_OFC_CD       =     SQ.RGN_OFC_CD" ).append("\n"); 
		query.append("                 AND SQP.BSE_TP_CD       =     SQ.BSE_TP_CD" ).append("\n"); 
		query.append("                 AND SQP.BSE_YR          =     SQ.BSE_YR" ).append("\n"); 
		query.append("                 AND SQP.BSE_QTR_CD      =     SQ.BSE_QTR_CD" ).append("\n"); 
		query.append("                 AND SQP.RLANE_CD        =     SQ.RLANE_CD" ).append("\n"); 
		query.append("                 AND SQP.DIR_CD          =     SQ.DIR_CD" ).append("\n"); 
		query.append("                 AND SQP.POL_CD          =     SQ.POL_CD" ).append("\n"); 
		query.append("                 AND SQP.POD_CD          =     SQ.POD_CD " ).append("\n"); 
		query.append("                 AND NVL(SQP.SQM_MN_SCTR_FLG, 'N')    =      'Y'" ).append("\n"); 
		query.append("                 AND SQ.POL_CD           =     NVL(A.POL_CD, SQ.POL_CD)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                 AND A.COST_YR || A.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK" ).append("\n"); 
		query.append("                 AND NVL((SELECT O2.CONV_RGN_OFC_CD" ).append("\n"); 
		query.append("                            FROM SPC_RGN_OFC_CONV O2" ).append("\n"); 
		query.append("                           WHERE O2.SLS_RGN_OFC_CD = MQ.RGN_OFC_CD), MQ.RGN_OFC_CD) = O.OFC_CD" ).append("\n"); 
		query.append("           ) R" ).append("\n"); 
		query.append("  GROUP BY R.TRD_CD         ," ).append("\n"); 
		query.append("           R.DIR_CD         ," ).append("\n"); 
		query.append("           R.SUB_TRD_CD     ," ).append("\n"); 
		query.append("           R.RLANE_CD       ," ).append("\n"); 
		query.append("           R.OFC_CD         ," ).append("\n"); 
		query.append("           R.WK             ," ).append("\n"); 
		query.append("           R.NUM            ," ).append("\n"); 
		query.append("           R.NUM_1," ).append("\n"); 
		query.append("           R.VVD            ,R.VSL_CD, R.SKD_VOY_NO, R.SKD_DIR_CD," ).append("\n"); 
		query.append("           R.BSA            ,R.BSA_WGT," ).append("\n"); 
		query.append("           R.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           R.ACCT_FLG" ).append("\n"); 
		query.append("           ,CTRL_ECC_FLG, CTRL_LOC_FLG, CTRL_USA_SVC_MOD_FLG, CTRL_ACCT_FLG, CTRL_DEST_LVL_CD" ).append("\n"); 
		query.append("	   ,change_code" ).append("\n"); 
		query.append("#if (${check_sector2} == 'Y')" ).append("\n"); 
		query.append("           , R.POD_CD" ).append("\n"); 
		query.append("    HAVING ROUND(SUM(S_QTA_QTY)) > 0        " ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("    HAVING ROUND(SUM(R.QTA_QTY)) > 0" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("#if (${check_sector2} == 'Y')" ).append("\n"); 
		query.append(", MAIN_POL_POD AS (" ).append("\n"); 
		query.append("    SELECT LV.RLANE_CD" ).append("\n"); 
		query.append("         , LV.SKD_DIR_CD" ).append("\n"); 
		query.append("         , LV.COST_YR" ).append("\n"); 
		query.append("         , LV.COST_WK" ).append("\n"); 
		query.append("         , LV.BSE_QTR_CD" ).append("\n"); 
		query.append("         , ST.POD_CD" ).append("\n"); 
		query.append("      FROM SQM_SCTR_PAIR_MGMT ST" ).append("\n"); 
		query.append("         , (SELECT RLANE_CD" ).append("\n"); 
		query.append("                 , SKD_DIR_CD" ).append("\n"); 
		query.append("                 , COST_YR" ).append("\n"); 
		query.append("                 , COST_WK" ).append("\n"); 
		query.append("                 , BSE_QTR_CD" ).append("\n"); 
		query.append("                 , POL_CD" ).append("\n"); 
		query.append("              FROM MAS_MON_VVD_LV" ).append("\n"); 
		query.append("             GROUP BY RLANE_CD" ).append("\n"); 
		query.append("                 , SKD_DIR_CD" ).append("\n"); 
		query.append("                 , COST_YR" ).append("\n"); 
		query.append("                 , COST_WK" ).append("\n"); 
		query.append("                 , BSE_QTR_CD" ).append("\n"); 
		query.append("                 , POL_CD) LV" ).append("\n"); 
		query.append("     WHERE ST.BSE_TP_CD = 'Q'" ).append("\n"); 
		query.append("       AND ST.BSE_YR = LV.COST_YR" ).append("\n"); 
		query.append("       AND ST.BSE_QTR_CD = LV.BSE_QTR_CD" ).append("\n"); 
		query.append("       AND ST.RLANE_CD = LV.RLANE_CD" ).append("\n"); 
		query.append("       AND ST.DIR_CD = LV.SKD_DIR_CD" ).append("\n"); 
		query.append("       AND NVL(ST.SQM_MN_SCTR_FLG, 'N') = 'Y'" ).append("\n"); 
		query.append("       AND ST.POL_CD = NVL(LV.POL_CD, ST.POL_CD)" ).append("\n"); 
		query.append("     GROUP BY LV.RLANE_CD" ).append("\n"); 
		query.append("         , LV.SKD_DIR_CD" ).append("\n"); 
		query.append("         , LV.COST_YR" ).append("\n"); 
		query.append("         , LV.COST_WK" ).append("\n"); 
		query.append("         , LV.BSE_QTR_CD" ).append("\n"); 
		query.append("         , ST.POD_CD" ).append("\n"); 
		query.append(" )" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append(", FCT_DATA AS (" ).append("\n"); 
		query.append("    SELECT 2 AS FLG         ," ).append("\n"); 
		query.append("           B.TRD_CD         ," ).append("\n"); 
		query.append("           B.DIR_CD         ," ).append("\n"); 
		query.append("           B.SUB_TRD_CD     ," ).append("\n"); 
		query.append("           B.RLANE_CD       ," ).append("\n"); 
		query.append("           B.OFC_CD         ," ).append("\n"); 
		query.append("           B.WK             ," ).append("\n"); 
		query.append("           B.NUM            ," ).append("\n"); 
		query.append("           B.NUM_1," ).append("\n"); 
		query.append("           B.VVD            ," ).append("\n"); 
		query.append("           B.BSA   ,B.BSA_WGT," ).append("\n"); 
		query.append("           B.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           B.ACCT_FLG       ," ).append("\n"); 
		query.append("           0 AS QTA_QTY ," ).append("\n"); 
		query.append("           0 AS QTA_GREV," ).append("\n"); 
		query.append("           0 AS QTA_CM  ," ).append("\n"); 
		query.append("           SUM(B.FCT_QTY) AS FCT_QTY," ).append("\n"); 
		query.append("           0 AS FCT_GREV," ).append("\n"); 
		query.append("           0 AS FCT_CM  ," ).append("\n"); 
		query.append("           0 AS ALC_QTY ," ).append("\n"); 
		query.append("           0 AS ALC_GREV," ).append("\n"); 
		query.append("           0 AS ALC_CM  ," ).append("\n"); 
		query.append("           0 AS BKG_QTY ," ).append("\n"); 
		query.append("           0 AS BKG_GREV," ).append("\n"); 
		query.append("           0 AS BKG_CM  ," ).append("\n"); 
		query.append("           MAX(B.PAST) AS PAST," ).append("\n"); 
		query.append("           B.CUST_CTRL_CD" ).append("\n"); 
		query.append("           , CTRL_ECC_FLG, CTRL_LOC_FLG, CTRL_USA_SVC_MOD_FLG, CTRL_ACCT_FLG, CTRL_DEST_LVL_CD " ).append("\n"); 
		query.append("           , USA_BKG_MOD_CD" ).append("\n"); 
		query.append("           , DEST_LOC_CD" ).append("\n"); 
		query.append("           , ACCOUNT_CD" ).append("\n"); 
		query.append("	   ,change_code" ).append("\n"); 
		query.append("      FROM (" ).append("\n"); 
		query.append("              SELECT B.TRD_CD    ," ).append("\n"); 
		query.append("                     B.DIR_CD    ," ).append("\n"); 
		query.append("                     B.SUB_TRD_CD," ).append("\n"); 
		query.append("                     B.RLANE_CD  ," ).append("\n"); 
		query.append("                     B.SLS_RGN_OFC_CD     AS OFC_CD," ).append("\n"); 
		query.append("                     A.COST_YR||A.COST_WK AS WK    ," ).append("\n"); 
		query.append("                     A.NUM," ).append("\n"); 
		query.append("                     A.NUM_1," ).append("\n"); 
		query.append("                     B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD AS VVD," ).append("\n"); 
		query.append("                     A.BSA            ,A.BSA_WGT," ).append("\n"); 
		query.append("                     A.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                     A.ACCT_FLG       ," ).append("\n"); 
		query.append("                     NVL(B.CFM_TTL_QTY, 0) + NVL(B.CFM_40FT_HC_QTY, 0) * 2 + NVL(B.CFM_45FT_HC_QTY, 0) * 2 + NVL(B.CFM_53FT_QTY, 0) * 2 AS FCT_QTY," ).append("\n"); 
		query.append("                     A.PAST," ).append("\n"); 
		query.append("                     NVL((SELECT CC.CUST_CTRL_CD" ).append("\n"); 
		query.append("  				            FROM SPC_MDL_CUST_CTRL CC" ).append("\n"); 
		query.append("  				           WHERE CC.TRD_CD      = A.TRD_CD" ).append("\n"); 
		query.append("  				             AND CC.COST_YRWK   = SUBSTR(A.SEASON, 1, 6)" ).append("\n"); 
		query.append("  				             AND CC.VER_SEQ     = SUBSTR(A.SEASON, 8)" ).append("\n"); 
		query.append("  				             AND CC.CUST_CNT_CD = B.CUST_CNT_CD" ).append("\n"); 
		query.append("  				             AND CC.CUST_SEQ    = B.CUST_SEQ" ).append("\n"); 
		query.append("  				             AND NVL(CC.SC_NO, NVL(CC.RFA_NO,'X')) = NVL(B.SC_NO,NVL(B.RFA_NO,'X'))" ).append("\n"); 
		query.append("  				             AND ROWNUM = 1 " ).append("\n"); 
		query.append("  		 		       ),'C') AS CUST_CTRL_CD" ).append("\n"); 
		query.append("                   , A.CTRL_ECC_FLG, A.CTRL_LOC_FLG, A.CTRL_USA_SVC_MOD_FLG, A.CTRL_ACCT_FLG, A.CTRL_DEST_LVL_CD " ).append("\n"); 
		query.append("                   , DECODE(A.CTRL_USA_SVC_MOD_FLG, 'Y', B.USA_BKG_MOD_CD, 'OTH') USA_BKG_MOD_CD" ).append("\n"); 
		query.append("                   , CASE WHEN A.CTRL_DEST_LVL_CD IN ('L', 'T') THEN B.DEST_LOC_CD ELSE 'XXXXX' END DEST_LOC_CD" ).append("\n"); 
		query.append("                     , CASE WHEN A.CTRL_ACCT_FLG = 'Y' THEN" ).append("\n"); 
		query.append("                        NVL((SELECT D.CTRL_LOC_ACCT_CD" ).append("\n"); 
		query.append("                               FROM SPC_ALOC_LANE_CTRL_OPT_DTL D," ).append("\n"); 
		query.append("		       	       	            SPC_ALOC_LANE_CTRL_OFC OFC" ).append("\n"); 
		query.append("                              WHERE D.RLANE_CD          = A.RLANE_CD" ).append("\n"); 
		query.append("                                AND D.TRD_CD            = SPC_GET_REP_TRD_FNC(A.RLANE_CD) " ).append("\n"); 
		query.append("                                AND D.SUB_TRD_CD        = SPC_GET_REP_SUB_TRD_FNC(A.RLANE_CD)" ).append("\n"); 
		query.append("                                AND D.DIR_CD            = A.SKD_DIR_CD" ).append("\n"); 
		query.append("                                AND D.ALOC_CTRL_TP_CD   = 'A'" ).append("\n"); 
		query.append("                                AND D.RLANE_CD          = OFC.RLANE_CD" ).append("\n"); 
		query.append("                                AND D.TRD_CD            = OFC.TRD_CD" ).append("\n"); 
		query.append("                                AND D.SUB_TRD_CD        = OFC.SUB_TRD_CD" ).append("\n"); 
		query.append("                                AND D.DIR_CD            = OFC.DIR_CD " ).append("\n"); 
		query.append("                                AND D.ALOC_CTRL_TP_CD   = OFC.ALOC_CTRL_TP_CD " ).append("\n"); 
		query.append("                                AND D.CTRL_LOC_ACCT_CD  = OFC.CTRL_LOC_ACCT_CD" ).append("\n"); 
		query.append("                                AND OFC.OFC_CD          = DECODE(IOC_TS_CD, 'T', B.SLS_RGN_OFC_CD, B.SLS_RGN_OFC_CD)" ).append("\n"); 
		query.append("                                AND D.ALOC_CTRL_DTL_CD  = B.CUST_CNT_CD ||LPAD(B.CUST_SEQ,6,'0')                                        " ).append("\n"); 
		query.append("                         ),'OTHERS')" ).append("\n"); 
		query.append("                     ELSE" ).append("\n"); 
		query.append("                        'OTHERS'" ).append("\n"); 
		query.append("                     END AS ACCOUNT_CD " ).append("\n"); 
		query.append("		     ,change_code" ).append("\n"); 
		query.append("                FROM MAS_MON_VVD_LV     A," ).append("\n"); 
		query.append("                     SPC_DLY_FCAST_CUST B," ).append("\n"); 
		query.append("		     VVD_POL_POD VPP" ).append("\n"); 
		query.append("#if (${check_sector2} == 'Y')" ).append("\n"); 
		query.append("                     ,MAIN_POL_POD SEC" ).append("\n"); 
		query.append("#end					 " ).append("\n"); 
		query.append("               WHERE A.TRD_CD      = B.TRD_CD" ).append("\n"); 
		query.append("                 AND A.RLANE_CD    = B.RLANE_CD" ).append("\n"); 
		query.append("                 AND A.IOC_CD      = B.IOC_TS_CD" ).append("\n"); 
		query.append("                 AND A.VSL_CD      = B.VSL_CD" ).append("\n"); 
		query.append("                 AND A.SKD_VOY_NO  = B.SKD_VOY_NO" ).append("\n"); 
		query.append("                 AND A.DIR_CD      = B.SKD_DIR_CD" ).append("\n"); 
		query.append("                 AND A.DIR_CD      = B.DIR_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("-- VVD가 삭제후 재 생성시 나는 오류 수정" ).append("\n"); 
		query.append("                             and b.RLANE_CD      = VPP.RLANE_CD" ).append("\n"); 
		query.append("                            AND b.DIR_CD        = VPP.DIR_CD" ).append("\n"); 
		query.append("                            AND b.VSL_CD        = VPP.VSL_CD" ).append("\n"); 
		query.append("                            AND b.SKD_VOY_NO    = VPP.SKD_VOY_NO" ).append("\n"); 
		query.append("                            AND b.SKD_DIR_CD    = VPP.SKD_DIR_CD" ).append("\n"); 
		query.append("			     " ).append("\n"); 
		query.append("                            AND b.POL_YD_CD      = VPP.POL_CD" ).append("\n"); 
		query.append("                            AND b.POD_YD_CD      = VPP.POD_CD" ).append("\n"); 
		query.append("                            AND b.POL_YD_IND_SEQ = VPP.POL_YD_SEQ" ).append("\n"); 
		query.append("                            AND b.POD_YD_IND_SEQ = VPP.POD_YD_SEQ" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                                                    AND ( VPP.POL_CONTI = VPP.OFC_CONTI" ).append("\n"); 
		query.append("                             OR b.SLS_RHQ_CD = VPP.OFC_CD" ).append("\n"); 
		query.append("                             OR b.SLS_RHQ_CD = 'SINRS'" ).append("\n"); 
		query.append("                             OR VPP.RLANE_CD = 'WAFIE' ) " ).append("\n"); 
		query.append("                                                    AND VPP.PAST = 'N'" ).append("\n"); 
		query.append("                            AND (NVL(b.CFM_TTL_QTY, 0) + NVL(b.CFM_40FT_HC_QTY, 0) + NVL(b.CFM_45FT_HC_QTY, 0) + NVL(b.CFM_53FT_QTY, 0) + NVL(b.CFM_TTL_WGT, 0) + NVL(b.CFM_RF_QTY, 0)) > 0" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("-- VVD가 삭제후 재 생성시 나는 오류 수정" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${rhq2} != '')" ).append("\n"); 
		query.append("                 AND ((     A.RHQ_CD = 'SHARC'" ).append("\n"); 
		query.append("							AND EXISTS ( SELECT 1" ).append("\n"); 
		query.append("										 FROM MDM_LOCATION L" ).append("\n"); 
		query.append("										WHERE SUBSTR(B.POL_YD_CD, 1, 5) = L.LOC_CD" ).append("\n"); 
		query.append("										  AND SPC_CONTI_CONV_FNC(L.CONTI_CD,A.RLANE_CD,A.DIR_CD) = 'A')" ).append("\n"); 
		query.append("							AND A.RHQ_CD = B.SLS_RHQ_CD)  " ).append("\n"); 
		query.append("						OR A.RHQ_CD = B.SLS_RHQ_CD)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${area} != '')" ).append("\n"); 
		query.append("                 AND B.SLS_RGN_OFC_CD IN ( SELECT O.OFC_CD" ).append("\n"); 
		query.append("										   FROM SPC_OFC_LVL O" ).append("\n"); 
		query.append("										  WHERE O.N3RD_PRNT_OFC_CD = A.AQ_CD" ).append("\n"); 
		query.append("											AND A.COST_YR || A.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK )" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${sales_office} != '')" ).append("\n"); 
		query.append("                 AND A.RGN_OFC_CD = NVL(( SELECT T2.CONV_RGN_OFC_CD" ).append("\n"); 
		query.append("											  FROM SPC_RGN_OFC_CONV T2" ).append("\n"); 
		query.append("											 WHERE T2.SLS_RGN_OFC_CD = B.SLS_RGN_OFC_CD), B.SLS_RGN_OFC_CD )" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${pol_cd} != '')" ).append("\n"); 
		query.append("                 AND A.POL_CD = B.POL_YD_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${check_sector2} == 'Y')" ).append("\n"); 
		query.append("                 AND A.RLANE_CD    = SEC.RLANE_CD" ).append("\n"); 
		query.append("                 AND A.DIR_CD        = SEC.SKD_DIR_CD " ).append("\n"); 
		query.append("                 AND A.COST_YR       = SEC.COST_YR" ).append("\n"); 
		query.append("                 AND A.COST_WK       = SEC.COST_WK" ).append("\n"); 
		query.append("                 AND B.POD_YD_CD   LIKE SEC.POD_CD||'%'	" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("           ) B" ).append("\n"); 
		query.append("  GROUP BY B.TRD_CD         ," ).append("\n"); 
		query.append("           B.DIR_CD         ," ).append("\n"); 
		query.append("           B.SUB_TRD_CD     ," ).append("\n"); 
		query.append("           B.RLANE_CD       ," ).append("\n"); 
		query.append("           B.OFC_CD         ," ).append("\n"); 
		query.append("           B.WK             ," ).append("\n"); 
		query.append("           B.NUM            ," ).append("\n"); 
		query.append("           B.NUM_1," ).append("\n"); 
		query.append("           B.VVD            ," ).append("\n"); 
		query.append("           B.BSA ,B.BSA_WGT ," ).append("\n"); 
		query.append("           B.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           B.ACCT_FLG       ," ).append("\n"); 
		query.append("           B.CUST_CTRL_CD" ).append("\n"); 
		query.append("           , CTRL_ECC_FLG, CTRL_LOC_FLG, CTRL_USA_SVC_MOD_FLG, CTRL_ACCT_FLG, CTRL_DEST_LVL_CD " ).append("\n"); 
		query.append("           , USA_BKG_MOD_CD" ).append("\n"); 
		query.append("           , DEST_LOC_CD" ).append("\n"); 
		query.append("	       , ACCOUNT_CD" ).append("\n"); 
		query.append("	       ,change_code" ).append("\n"); 
		query.append("   HAVING SUM(B.FCT_QTY) > 0" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", SKD_POL_POD AS(" ).append("\n"); 
		query.append("SELECT" ).append("\n"); 
		query.append("       DISTINCT VSL_CD" ).append("\n"); 
		query.append("     , SKD_VOY_NO" ).append("\n"); 
		query.append("     , SKD_DIR_CD" ).append("\n"); 
		query.append("     , RLANE_CD" ).append("\n"); 
		query.append("     , POL_CD" ).append("\n"); 
		query.append("     , POD_CD" ).append("\n"); 
		query.append("     , SPC_GET_OCN_IPC_FNC(RLANE_CD, VPS_PORT_CD, VPS_PORT_CD) AS IOC_CD" ).append("\n"); 
		query.append("FROM (" ).append("\n"); 
		query.append("SELECT V.VSL_CD" ).append("\n"); 
		query.append("     , V.SKD_VOY_NO" ).append("\n"); 
		query.append("     , V.SKD_DIR_CD" ).append("\n"); 
		query.append("     , V.RLANE_CD,S1.VPS_PORT_CD" ).append("\n"); 
		query.append("     , NVL(S1.YD_CD, S1.VPS_PORT_CD) AS POL_CD" ).append("\n"); 
		query.append("     , NVL(S2.YD_CD, S2.VPS_PORT_CD) AS POD_CD" ).append("\n"); 
		query.append("     , S1.CLPT_SEQ as PORT_SEQ1 " ).append("\n"); 
		query.append("     , S2.CLPT_SEQ as PORT_SEQ2 " ).append("\n"); 
		query.append("     , MAX(S1.CLPT_SEQ) OVER (PARTITION BY NVL(S1.YD_CD, S1.VPS_PORT_CD), S1.VSL_CD, S1.SKD_VOY_NO, S1.SKD_DIR_CD) AS MAX_SEQ1" ).append("\n"); 
		query.append("  FROM (SELECT DISTINCT RLANE_CD, VSL_CD, SKD_VOY_NO, SKD_DIR_CD FROM MAS_MON_VVD_LV) V" ).append("\n"); 
		query.append("     , VSK_VSL_PORT_SKD S1" ).append("\n"); 
		query.append("     , VSK_VSL_PORT_SKD S2" ).append("\n"); 
		query.append(" WHERE S1.VSL_CD = V.VSL_CD" ).append("\n"); 
		query.append("   AND S1.SKD_VOY_NO = V.SKD_VOY_NO" ).append("\n"); 
		query.append("   AND S1.SKD_DIR_CD = V.SKD_DIR_CD" ).append("\n"); 
		query.append("   AND S1.VSL_CD = S2.VSL_CD" ).append("\n"); 
		query.append("   AND S1.SKD_VOY_NO = S2.SKD_VOY_NO" ).append("\n"); 
		query.append("   AND S1.SKD_DIR_CD = S2.SKD_DIR_CD" ).append("\n"); 
		query.append("   AND S1.CLPT_SEQ < S2.CLPT_SEQ" ).append("\n"); 
		query.append("   ) WHERE 1=1 " ).append("\n"); 
		query.append("   AND (PORT_SEQ1 = MAX_SEQ1 OR PORT_SEQ2 < MAX_SEQ1)" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", ALC_DATA AS (" ).append("\n"); 
		query.append("    SELECT /*+ ORDERED */ 3 AS FLG    ," ).append("\n"); 
		query.append("           B.TRD_CD    ," ).append("\n"); 
		query.append("           B.DIR_CD    ," ).append("\n"); 
		query.append("           B.SUB_TRD_CD," ).append("\n"); 
		query.append("           B.RLANE_CD  ," ).append("\n"); 
		query.append("           B.SLS_RGN_OFC_CD     AS OFC_CD," ).append("\n"); 
		query.append("           A.COST_YR||A.COST_WK AS WK    ," ).append("\n"); 
		query.append("           A.NUM," ).append("\n"); 
		query.append("           A.NUM_1," ).append("\n"); 
		query.append("           B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD AS VVD," ).append("\n"); 
		query.append("           A.BSA ,A.BSA_WGT ," ).append("\n"); 
		query.append("           A.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           A.ACCT_FLG       ," ).append("\n"); 
		query.append("           'C' AS CUST_CTRL_CD," ).append("\n"); 
		query.append("           0 AS QTA_QTY ," ).append("\n"); 
		query.append("           0 AS QTA_GREV," ).append("\n"); 
		query.append("           0 AS QTA_CM  ," ).append("\n"); 
		query.append("           0 AS FCT_QTY ," ).append("\n"); 
		query.append("           0 AS FCT_GREV," ).append("\n"); 
		query.append("           0 AS FCT_CM  ," ).append("\n"); 
		query.append("           SUM(B.ASGN_TTL_QTY) AS ALC_QTY," ).append("\n"); 
		query.append("           0 AS ALC_GREV," ).append("\n"); 
		query.append("           0 AS ALC_CM  ," ).append("\n"); 
		query.append("           0 AS BKG_QTY ," ).append("\n"); 
		query.append("           0 AS BKG_GREV," ).append("\n"); 
		query.append("           0 AS BKG_CM" ).append("\n"); 
		query.append("           , A.CTRL_ECC_FLG, A.CTRL_LOC_FLG, A.CTRL_USA_SVC_MOD_FLG, A.CTRL_ACCT_FLG, A.CTRL_DEST_LVL_CD " ).append("\n"); 
		query.append("           , DECODE(A.CTRL_USA_SVC_MOD_FLG, 'Y', B.USA_BKG_MOD_CD, 'OTH') USA_BKG_MOD_CD" ).append("\n"); 
		query.append("           , CASE WHEN A.CTRL_DEST_LVL_CD IN ('L', 'T') THEN B.DEST_LOC_CD ELSE 'XXXXX' END DEST_LOC_CD" ).append("\n"); 
		query.append("	       , DECODE(A.CTRL_ACCT_FLG, 'Y', " ).append("\n"); 
		query.append("                 	DECODE(B.CTRT_NO||B.CUST_CNT_CD||LPAD(B.CUST_SEQ, 6, '0'), 'XXX999999', 'OTHERS'," ).append("\n"); 
		query.append("                        DECODE(B.CUST_CNT_CD||LPAD(B.CUST_SEQ, 6, '0'), 'XX999999', B.CTRT_NO, B.CUST_CNT_CD||LPAD(B.CUST_SEQ, 6, '0')))," ).append("\n"); 
		query.append("                 	'OTHERS') AS ACCOUNT_CD  " ).append("\n"); 
		query.append("	   ,change_code" ).append("\n"); 
		query.append("      FROM MAS_MON_VVD_LV   A," ).append("\n"); 
		query.append("           SPC_ALOC_POL_POD B," ).append("\n"); 
		query.append("           SKD_POL_POD V" ).append("\n"); 
		query.append("#if (${check_sector2} == 'Y')" ).append("\n"); 
		query.append("           --------------------------------" ).append("\n"); 
		query.append("           ,MAIN_POL_POD SEC	" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("     WHERE A.TRD_CD     = B.TRD_CD" ).append("\n"); 
		query.append("       AND A.RLANE_CD   = B.RLANE_CD" ).append("\n"); 
		query.append("       AND A.IOC_CD     = B.IOC_CD" ).append("\n"); 
		query.append("       AND A.VSL_CD     = B.VSL_CD" ).append("\n"); 
		query.append("       AND A.SKD_VOY_NO = B.SKD_VOY_NO" ).append("\n"); 
		query.append("       AND A.DIR_CD     = B.SKD_DIR_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${rhq2} != '')" ).append("\n"); 
		query.append("       AND ((     A.RHQ_CD = 'SHARC'" ).append("\n"); 
		query.append("              AND EXISTS ( SELECT 1" ).append("\n"); 
		query.append("                             FROM MDM_LOCATION L" ).append("\n"); 
		query.append("                            WHERE SUBSTR(B.POL_YD_CD, 1, 5) = L.LOC_CD" ).append("\n"); 
		query.append("                              AND SPC_CONTI_CONV_FNC(L.CONTI_CD,A.RLANE_CD,A.DIR_CD) = 'A')" ).append("\n"); 
		query.append("                              AND A.RHQ_CD = B.SLS_RHQ_CD) " ).append("\n"); 
		query.append("              OR A.RHQ_CD = B.SLS_RHQ_CD)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${area} != '')" ).append("\n"); 
		query.append("       AND A.AQ_CD = B.SLS_AQ_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${sales_office} != '')" ).append("\n"); 
		query.append("       AND A.RGN_OFC_CD = B.SLS_RGN_OFC_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${pol_cd} != '')" ).append("\n"); 
		query.append("       AND A.POL_CD = B.POL_YD_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("       AND (    (A.OFC_CD IN ('SELCTY', 'SELCDO', 'SINRS', 'CLTCO','SELCMI', 'SELCMA'))" ).append("\n"); 
		query.append("             OR (B.SLS_RHQ_CD = A.OFC_CD)" ).append("\n"); 
		query.append("             OR (B.SLS_AQ_CD IN ( A.OFC_CD, DECODE(A.OFC_CD, 'SHADPI', 'SHADSA'), DECODE(A.OFC_CD, 'SHADSA', 'SHADPI')))" ).append("\n"); 
		query.append("             OR (B.SLS_RGN_OFC_CD = A.OFC_CD))" ).append("\n"); 
		query.append("       AND B.TS_FLG = 'N'" ).append("\n"); 
		query.append("       AND B.RLANE_CD = V.RLANE_CD" ).append("\n"); 
		query.append("       AND B.VSL_CD     = V.VSL_CD" ).append("\n"); 
		query.append("       AND B.SKD_VOY_NO = V.SKD_VOY_NO" ).append("\n"); 
		query.append("       AND B.DIR_CD     = V.SKD_DIR_CD" ).append("\n"); 
		query.append("       AND DECODE(SUBSTR(B.POL_YD_CD, 6, 2), '00', SUBSTR(B.POL_YD_CD, 1, 5), SUBSTR(B.POL_YD_CD, 1, LENGTH(V.POL_CD))) = DECODE(SUBSTR(B.POL_YD_CD, 6, 2), '00', SUBSTR(V.POL_CD, 1, 5), V.POL_CD)" ).append("\n"); 
		query.append("       AND DECODE(SUBSTR(B.POD_YD_CD, 6, 2), '00', SUBSTR(B.POD_YD_CD, 1, 5), SUBSTR(B.POD_YD_CD, 1, LENGTH(V.POD_CD))) = DECODE(SUBSTR(B.POD_YD_CD, 6, 2), '00', SUBSTR(V.POD_CD, 1, 5), V.POD_CD)" ).append("\n"); 
		query.append("       AND A.ACCT_FLG = 'N'" ).append("\n"); 
		query.append("#if (${check_sector2} == 'Y')	" ).append("\n"); 
		query.append("       AND A.RLANE_CD    = SEC.RLANE_CD" ).append("\n"); 
		query.append("       AND A.DIR_CD      = SEC.SKD_DIR_CD " ).append("\n"); 
		query.append("       AND A.COST_YR     = SEC.COST_YR" ).append("\n"); 
		query.append("       AND A.COST_WK     = SEC.COST_WK" ).append("\n"); 
		query.append("       AND B.POD_YD_CD   LIKE SEC.POD_CD||'%'" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("  GROUP BY B.TRD_CD    ," ).append("\n"); 
		query.append("           B.DIR_CD    ," ).append("\n"); 
		query.append("           B.SUB_TRD_CD," ).append("\n"); 
		query.append("           B.RLANE_CD  ," ).append("\n"); 
		query.append("           B.SLS_RGN_OFC_CD," ).append("\n"); 
		query.append("           A.COST_YR||A.COST_WK," ).append("\n"); 
		query.append("           A.NUM," ).append("\n"); 
		query.append("           A.NUM_1," ).append("\n"); 
		query.append("           B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD," ).append("\n"); 
		query.append("           A.BSA,A.BSA_WGT," ).append("\n"); 
		query.append("           A.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           A.ACCT_FLG" ).append("\n"); 
		query.append("           , A.CTRL_ECC_FLG, A.CTRL_LOC_FLG, A.CTRL_USA_SVC_MOD_FLG, A.CTRL_ACCT_FLG, A.CTRL_DEST_LVL_CD " ).append("\n"); 
		query.append("           , DECODE(A.CTRL_USA_SVC_MOD_FLG, 'Y', B.USA_BKG_MOD_CD, 'OTH')" ).append("\n"); 
		query.append("           , CASE WHEN A.CTRL_DEST_LVL_CD IN ('L', 'T') THEN B.DEST_LOC_CD ELSE 'XXXXX' END" ).append("\n"); 
		query.append("           , DECODE(A.CTRL_ACCT_FLG, 'Y', " ).append("\n"); 
		query.append("                 DECODE(B.CTRT_NO||B.CUST_CNT_CD||LPAD(B.CUST_SEQ, 6, '0'), 'XXX999999', 'OTHERS'," ).append("\n"); 
		query.append("                        DECODE(B.CUST_CNT_CD||LPAD(B.CUST_SEQ, 6, '0'), 'XX999999', B.CTRT_NO, B.CUST_CNT_CD||LPAD(B.CUST_SEQ, 6, '0')))," ).append("\n"); 
		query.append("                 'OTHERS')" ).append("\n"); 
		query.append("           ,change_code" ).append("\n"); 
		query.append("    HAVING SUM(B.ASGN_TTL_QTY) > 0" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", ALOC_CUST_DATA AS (" ).append("\n"); 
		query.append("    SELECT 3 AS FLG    ," ).append("\n"); 
		query.append("           B.TRD_CD    ," ).append("\n"); 
		query.append("           B.DIR_CD    ," ).append("\n"); 
		query.append("           B.SUB_TRD_CD," ).append("\n"); 
		query.append("           B.RLANE_CD  ," ).append("\n"); 
		query.append("           B.SLS_RGN_OFC_CD     AS OFC_CD," ).append("\n"); 
		query.append("           A.COST_YR||A.COST_WK AS WK    ," ).append("\n"); 
		query.append("           A.NUM," ).append("\n"); 
		query.append("           A.NUM_1," ).append("\n"); 
		query.append("           B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD AS VVD," ).append("\n"); 
		query.append("           A.BSA,A.BSA_WGT," ).append("\n"); 
		query.append("           A.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           A.ACCT_FLG       ," ).append("\n"); 
		query.append("           B.CUST_CTRL_CD   ," ).append("\n"); 
		query.append("           0 AS QTA_QTY ," ).append("\n"); 
		query.append("           0 AS QTA_GREV," ).append("\n"); 
		query.append("           0 AS QTA_CM  ," ).append("\n"); 
		query.append("           0 AS FCT_QTY ," ).append("\n"); 
		query.append("           0 AS FCT_GREV," ).append("\n"); 
		query.append("           0 AS FCT_CM  ," ).append("\n"); 
		query.append("           SUM(B.ASGN_TTL_QTY) AS ALC_QTY," ).append("\n"); 
		query.append("           0 AS ALC_GREV," ).append("\n"); 
		query.append("           0 AS ALC_CM  ," ).append("\n"); 
		query.append("           0 AS BKG_QTY ," ).append("\n"); 
		query.append("           0 AS BKG_GREV," ).append("\n"); 
		query.append("           0 AS BKG_CM" ).append("\n"); 
		query.append("           , A.CTRL_ECC_FLG, A.CTRL_LOC_FLG, A.CTRL_USA_SVC_MOD_FLG, A.CTRL_ACCT_FLG, A.CTRL_DEST_LVL_CD " ).append("\n"); 
		query.append("           , DECODE(A.CTRL_USA_SVC_MOD_FLG, 'Y', B.USA_BKG_MOD_CD, 'OTH') USA_BKG_MOD_CD" ).append("\n"); 
		query.append("           , CASE WHEN A.CTRL_DEST_LVL_CD IN ('L', 'T') THEN B.DEST_LOC_CD ELSE 'XXXXX' END DEST_LOC_CD" ).append("\n"); 
		query.append("	   , DECODE(A.CTRL_ACCT_FLG, 'Y', " ).append("\n"); 
		query.append("                 DECODE(B.CTRT_NO||B.CUST_CNT_CD||LPAD(B.CUST_SEQ, 6, '0'), 'XXX999999', 'OTHERS'," ).append("\n"); 
		query.append("                        DECODE(B.CUST_CNT_CD||LPAD(B.CUST_SEQ, 6, '0'), 'XX999999', B.CTRT_NO, B.CUST_CNT_CD||LPAD(B.CUST_SEQ, 6, '0')))," ).append("\n"); 
		query.append("                 'OTHERS') ACCOUNT_CD" ).append("\n"); 
		query.append("           ,change_code" ).append("\n"); 
		query.append("      FROM MAS_MON_VVD_LV        A," ).append("\n"); 
		query.append("           SPC_ALOC_CUST_POL_POD B," ).append("\n"); 
		query.append("           SKD_POL_POD V" ).append("\n"); 
		query.append("#if (${check_sector2} == 'Y')	" ).append("\n"); 
		query.append("           ,MAIN_POL_POD SEC" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("     WHERE A.TRD_CD     = B.TRD_CD" ).append("\n"); 
		query.append("       AND A.RLANE_CD   = B.RLANE_CD" ).append("\n"); 
		query.append("       AND A.IOC_CD     = B.IOC_CD" ).append("\n"); 
		query.append("       AND A.VSL_CD     = B.VSL_CD" ).append("\n"); 
		query.append("       AND A.SKD_VOY_NO = B.SKD_VOY_NO" ).append("\n"); 
		query.append("       AND A.DIR_CD     = B.SKD_DIR_CD" ).append("\n"); 
		query.append("#if (${rhq2} != '')" ).append("\n"); 
		query.append("       AND ((     A.RHQ_CD = 'SHARC'" ).append("\n"); 
		query.append("              AND EXISTS ( SELECT 1" ).append("\n"); 
		query.append("                             FROM MDM_LOCATION L" ).append("\n"); 
		query.append("                            WHERE SUBSTR(B.POL_YD_CD, 1, 5) = L.LOC_CD" ).append("\n"); 
		query.append("                              AND SPC_CONTI_CONV_FNC(L.CONTI_CD,A.RLANE_CD,A.DIR_CD) = 'A')" ).append("\n"); 
		query.append("                              AND A.RHQ_CD = B.SLS_RHQ_CD) " ).append("\n"); 
		query.append("              OR A.RHQ_CD = B.SLS_RHQ_CD)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${area} != '')" ).append("\n"); 
		query.append("       AND A.AQ_CD = B.SLS_AQ_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${sales_office} != '')" ).append("\n"); 
		query.append("       AND A.RGN_OFC_CD = B.SLS_RGN_OFC_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${pol_cd} != '')" ).append("\n"); 
		query.append("       AND A.POL_CD = B.POL_YD_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("       AND (    (A.OFC_CD IN ('SELCTY', 'SELCDO', 'SINRS', 'CLTCO','SELCMI', 'SELCMA'))" ).append("\n"); 
		query.append("             OR (B.SLS_RHQ_CD = A.OFC_CD)" ).append("\n"); 
		query.append("             OR (B.SLS_AQ_CD IN ( A.OFC_CD, DECODE(A.OFC_CD, 'SHADPI', 'SHADSA'), DECODE(A.OFC_CD, 'SHADSA', 'SHADPI')))" ).append("\n"); 
		query.append("             OR (B.SLS_RGN_OFC_CD = A.OFC_CD))" ).append("\n"); 
		query.append("       AND B.TS_FLG = 'N'" ).append("\n"); 
		query.append("       AND B.RLANE_CD = V.RLANE_CD" ).append("\n"); 
		query.append("       AND B.VSL_CD     = V.VSL_CD" ).append("\n"); 
		query.append("       AND B.SKD_VOY_NO = V.SKD_VOY_NO" ).append("\n"); 
		query.append("       AND B.DIR_CD     = V.SKD_DIR_CD" ).append("\n"); 
		query.append("       AND DECODE(SUBSTR(B.POL_YD_CD, 6, 2), '00', SUBSTR(B.POL_YD_CD, 1, 5), SUBSTR(B.POL_YD_CD, 1, LENGTH(V.POL_CD))) = DECODE(SUBSTR(B.POL_YD_CD, 6, 2), '00', SUBSTR(V.POL_CD, 1, 5), V.POL_CD)" ).append("\n"); 
		query.append("       AND DECODE(SUBSTR(B.POD_YD_CD, 6, 2), '00', SUBSTR(B.POD_YD_CD, 1, 5), SUBSTR(B.POD_YD_CD, 1, LENGTH(V.POD_CD))) = DECODE(SUBSTR(B.POD_YD_CD, 6, 2), '00', SUBSTR(V.POD_CD, 1, 5), V.POD_CD)       " ).append("\n"); 
		query.append("       AND A.ACCT_FLG = 'Y'" ).append("\n"); 
		query.append("#if (${check_sector2} == 'Y')" ).append("\n"); 
		query.append("       AND A.RLANE_CD    = SEC.RLANE_CD" ).append("\n"); 
		query.append("       AND A.DIR_CD      = SEC.SKD_DIR_CD " ).append("\n"); 
		query.append("       AND A.COST_YR     = SEC.COST_YR" ).append("\n"); 
		query.append("       AND A.COST_WK     = SEC.COST_WK" ).append("\n"); 
		query.append("       AND B.POD_YD_CD   LIKE SEC.POD_CD||'%'" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("  GROUP BY B.TRD_CD    ," ).append("\n"); 
		query.append("           B.DIR_CD    ," ).append("\n"); 
		query.append("           B.SUB_TRD_CD," ).append("\n"); 
		query.append("           B.RLANE_CD  ," ).append("\n"); 
		query.append("           B.SLS_RGN_OFC_CD," ).append("\n"); 
		query.append("           A.COST_YR||A.COST_WK," ).append("\n"); 
		query.append("           A.NUM," ).append("\n"); 
		query.append("           A.NUM_1," ).append("\n"); 
		query.append("           B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD," ).append("\n"); 
		query.append("           A.BSA,A.BSA_WGT," ).append("\n"); 
		query.append("           A.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           A.ACCT_FLG       ," ).append("\n"); 
		query.append("           B.CUST_CTRL_CD" ).append("\n"); 
		query.append("           , A.CTRL_ECC_FLG, A.CTRL_LOC_FLG, A.CTRL_USA_SVC_MOD_FLG, A.CTRL_ACCT_FLG, A.CTRL_DEST_LVL_CD " ).append("\n"); 
		query.append("           , DECODE(A.CTRL_USA_SVC_MOD_FLG, 'Y', B.USA_BKG_MOD_CD, 'OTH')" ).append("\n"); 
		query.append("           , CASE WHEN A.CTRL_DEST_LVL_CD IN ('L', 'T') THEN B.DEST_LOC_CD ELSE 'XXXXX' END " ).append("\n"); 
		query.append("	   , DECODE(A.CTRL_ACCT_FLG, 'Y', " ).append("\n"); 
		query.append("                 DECODE(B.CTRT_NO||B.CUST_CNT_CD||LPAD(B.CUST_SEQ, 6, '0'), 'XXX999999', 'OTHERS'," ).append("\n"); 
		query.append("                        DECODE(B.CUST_CNT_CD||LPAD(B.CUST_SEQ, 6, '0'), 'XX999999', B.CTRT_NO, B.CUST_CNT_CD||LPAD(B.CUST_SEQ, 6, '0')))," ).append("\n"); 
		query.append("                 'OTHERS')  " ).append("\n"); 
		query.append("           ,change_code" ).append("\n"); 
		query.append("    HAVING SUM(B.ASGN_TTL_QTY) > 0" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(",RFA_BKG_DATA AS (" ).append("\n"); 
		query.append("SELECT DISTINCT CUST_CNT_CD||LPAD(CUST_SEQ,6,'0') AS SHP_CUST_CD," ).append("\n"); 
		query.append("       POL_CD," ).append("\n"); 
		query.append("       POD_CD," ).append("\n"); 
		query.append("       RFA_NO," ).append("\n"); 
		query.append("       CMDT_CD," ).append("\n"); 
		query.append("       CUST_CTRL_CD" ).append("\n"); 
		query.append("  FROM SPC_MDL_CUST_RFA" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${check_dest_ctrl} != '')" ).append("\n"); 
		query.append(", DEST_LOC_TMP AS (" ).append("\n"); 
		query.append("       SELECT DISTINCT " ).append("\n"); 
		query.append("              D.TRD_CD" ).append("\n"); 
		query.append("             ,D.SUB_TRD_CD" ).append("\n"); 
		query.append("             ,D.RLANE_CD " ).append("\n"); 
		query.append("             ,D.DIR_CD" ).append("\n"); 
		query.append("             ,D.ALOC_CTRL_TP_CD" ).append("\n"); 
		query.append("             ,D.CTRL_LOC_ACCT_CD" ).append("\n"); 
		query.append("        FROM SPC_ALOC_LANE_CTRL_OPT_DTL D, " ).append("\n"); 
		query.append("             MAS_MON_VVD_LV V " ).append("\n"); 
		query.append("       WHERE 1=1" ).append("\n"); 
		query.append("         AND D.TRD_CD          = V.TRD_CD" ).append("\n"); 
		query.append("         AND D.SUB_TRD_CD      = V.SUB_TRD_CD" ).append("\n"); 
		query.append("         AND D.RLANE_CD        = V.RLANE_CD" ).append("\n"); 
		query.append("         AND D.DIR_CD          = V.DIR_CD" ).append("\n"); 
		query.append("         AND D.ALOC_CTRL_TP_CD = 'E'" ).append("\n"); 
		query.append("       " ).append("\n"); 
		query.append("       UNION ALL" ).append("\n"); 
		query.append("       " ).append("\n"); 
		query.append("       SELECT DISTINCT" ).append("\n"); 
		query.append("              D.TRD_CD" ).append("\n"); 
		query.append("             ,D.SUB_TRD_CD" ).append("\n"); 
		query.append("             ,D.RLANE_CD " ).append("\n"); 
		query.append("             ,D.DIR_CD" ).append("\n"); 
		query.append("             ,D.ALOC_CTRL_TP_CD" ).append("\n"); 
		query.append("             ,D.CTRL_LOC_ACCT_CD" ).append("\n"); 
		query.append("        FROM SPC_ALOC_LANE_CTRL_OPT_DTL D" ).append("\n"); 
		query.append("             , MDM_LOCATION ML1" ).append("\n"); 
		query.append("             , MDM_EQ_ORZ_CHT ME1" ).append("\n"); 
		query.append("             , MAS_MON_VVD_LV V " ).append("\n"); 
		query.append("       WHERE 1=1" ).append("\n"); 
		query.append("         AND D.TRD_CD           = V.TRD_CD" ).append("\n"); 
		query.append("         AND D.SUB_TRD_CD       = V.SUB_TRD_CD" ).append("\n"); 
		query.append("         AND D.RLANE_CD         = V.RLANE_CD" ).append("\n"); 
		query.append("         AND D.DIR_CD           = V.DIR_CD" ).append("\n"); 
		query.append("         AND D.CTRL_LOC_ACCT_CD = ML1.LOC_CD" ).append("\n"); 
		query.append("         AND ME1.SCC_CD         = ML1.SCC_CD" ).append("\n"); 
		query.append("         AND D.ALOC_CTRL_TP_CD  = 'L'" ).append("\n"); 
		query.append("         AND NOT EXISTS (SELECT 1" ).append("\n"); 
		query.append("                           FROM SPC_ALOC_LANE_CTRL_OPT_DTL T" ).append("\n"); 
		query.append("                          WHERE 1=1" ).append("\n"); 
		query.append("                            AND T.TRD_CD = D.TRD_CD" ).append("\n"); 
		query.append("                            AND T.SUB_TRD_CD = D.SUB_TRD_CD" ).append("\n"); 
		query.append("                            AND T.RLANE_CD = D.RLANE_CD " ).append("\n"); 
		query.append("                            AND T.DIR_CD = D.DIR_CD" ).append("\n"); 
		query.append("                            AND T.ALOC_CTRL_TP_CD = 'E'" ).append("\n"); 
		query.append("                            AND T.CTRL_LOC_ACCT_CD = ME1.ECC_CD)                        " ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append(", BKG_DATA AS (" ).append("\n"); 
		query.append("    SELECT 4 AS FLG         ," ).append("\n"); 
		query.append("           B.TRD_CD         ," ).append("\n"); 
		query.append("           B.DIR_CD         ," ).append("\n"); 
		query.append("           B.SUB_TRD_CD     ," ).append("\n"); 
		query.append("           B.RLANE_CD       ," ).append("\n"); 
		query.append("           B.OFC_CD         ," ).append("\n"); 
		query.append("           B.WK             ," ).append("\n"); 
		query.append("           B.NUM            ," ).append("\n"); 
		query.append("           B.NUM_1," ).append("\n"); 
		query.append("           B.VVD            ," ).append("\n"); 
		query.append("           B.BSA ,B.BSA_WGT," ).append("\n"); 
		query.append("           B.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           B.ACCT_FLG       ," ).append("\n"); 
		query.append("           0 AS QTA_QTY ," ).append("\n"); 
		query.append("           0 AS QTA_GREV," ).append("\n"); 
		query.append("           0 AS QTA_CM  ," ).append("\n"); 
		query.append("           0 AS FCT_QTY ," ).append("\n"); 
		query.append("           0 AS FCT_GREV," ).append("\n"); 
		query.append("           0 AS FCT_CM  ," ).append("\n"); 
		query.append("           0 AS ALC_QTY ," ).append("\n"); 
		query.append("           0 AS ALC_GREV," ).append("\n"); 
		query.append("           0 AS ALC_CM  ," ).append("\n"); 
		query.append("           SUM(B.BKG_QTY) AS BKG_QTY," ).append("\n"); 
		query.append("		   SUM(B.BKG_WGT) AS BKG_WGT, " ).append("\n"); 
		query.append("           0 AS BKG_GREV," ).append("\n"); 
		query.append("           0 AS BKG_CM  ," ).append("\n"); 
		query.append("           MAX(B.PAST) AS PAST," ).append("\n"); 
		query.append("           B.CUST_CTRL_CD," ).append("\n"); 
		query.append("           B.CTRL_ECC_FLG, " ).append("\n"); 
		query.append("           B.CTRL_LOC_FLG, " ).append("\n"); 
		query.append("           B.CTRL_USA_SVC_MOD_FLG, " ).append("\n"); 
		query.append("           B.CTRL_ACCT_FLG, " ).append("\n"); 
		query.append("           B.CTRL_DEST_LVL_CD," ).append("\n"); 
		query.append("           B.USA_BKG_MOD_CD," ).append("\n"); 
		query.append("           B.DEST_LOC_CD, " ).append("\n"); 
		query.append("--           B.ACCT_CD, " ).append("\n"); 
		query.append("	       B.ACCOUNT_CD" ).append("\n"); 
		query.append("	       ,change_code" ).append("\n"); 
		query.append("      FROM (" ).append("\n"); 
		query.append("            SELECT B.TRD_CD    ," ).append("\n"); 
		query.append("                   B.DIR_CD    ," ).append("\n"); 
		query.append("                   B.SUB_TRD_CD," ).append("\n"); 
		query.append("                   B.RLANE_CD  ," ).append("\n"); 
		query.append("                   B.OFC_CD," ).append("\n"); 
		query.append("                   B.WK    ," ).append("\n"); 
		query.append("                   B.NUM," ).append("\n"); 
		query.append("                   B.NUM_1," ).append("\n"); 
		query.append("                   B.VVD," ).append("\n"); 
		query.append("                   B.BSA,B.BSA_WGT," ).append("\n"); 
		query.append("                   B.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                   B.ACCT_FLG       ," ).append("\n"); 
		query.append("                   B.BKG_QTY,BKG_WGT," ).append("\n"); 
		query.append("                   B.PAST," ).append("\n"); 
		query.append("                   NVL(B.CUST_CTRL_CD" ).append("\n"); 
		query.append("                       , CASE WHEN B.AES_FLG = 'Y' " ).append("\n"); 
		query.append("                              THEN NVL(RD.CUST_CTRL_CD,'C')                         " ).append("\n"); 
		query.append("                              ELSE 'C'" ).append("\n"); 
		query.append("                         END                    " ).append("\n"); 
		query.append("                       ) AS CUST_CTRL_CD," ).append("\n"); 
		query.append("                   B.CTRL_ECC_FLG, " ).append("\n"); 
		query.append("                   B.CTRL_LOC_FLG, " ).append("\n"); 
		query.append("                   B.CTRL_USA_SVC_MOD_FLG, " ).append("\n"); 
		query.append("                   B.CTRL_ACCT_FLG, " ).append("\n"); 
		query.append("                   B.CTRL_DEST_LVL_CD," ).append("\n"); 
		query.append("                   B.USA_BKG_MOD_CD," ).append("\n"); 
		query.append("                   B.DEST_LOC_CD," ).append("\n"); 
		query.append("--                   B.ACCT_CD," ).append("\n"); 
		query.append("		           B.ACCOUNT_CD" ).append("\n"); 
		query.append("			   ,change_code" ).append("\n"); 
		query.append("             FROM (" ).append("\n"); 
		query.append("                      SELECT  /*+ LEADING(A B O RL DRL)  */  A.TRD_CD    ," ).append("\n"); 
		query.append("                             A.DIR_CD    ," ).append("\n"); 
		query.append("                             A.SUB_TRD_CD," ).append("\n"); 
		query.append("                             A.RLANE_CD  ," ).append("\n"); 
		query.append("                             O.N4TH_PRNT_OFC_CD   AS OFC_CD," ).append("\n"); 
		query.append("                             A.COST_YR||A.COST_WK AS WK    ," ).append("\n"); 
		query.append("                             A.NUM," ).append("\n"); 
		query.append("                             A.NUM_1," ).append("\n"); 
		query.append("                             A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD AS VVD," ).append("\n"); 
		query.append("                             A.BSA ,A.BSA_WGT           ," ).append("\n"); 
		query.append("                             A.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                             A.ACCT_FLG       ," ).append("\n"); 
		query.append("                             ( SELECT SUM(DECODE(SPC_GET_CNTR_SZ_FNC(Q.CNTR_TPSZ_CD), '2', 1, 2) * Q.OP_CNTR_QTY)" ).append("\n"); 
		query.append("                                 FROM BKG_QUANTITY Q" ).append("\n"); 
		query.append("                                WHERE B.BKG_NO = Q.BKG_NO" ).append("\n"); 
		query.append("                               HAVING SUM(DECODE(SPC_GET_CNTR_SZ_FNC(Q.CNTR_TPSZ_CD), '2', 1, 2) * Q.OP_CNTR_QTY) > 0" ).append("\n"); 
		query.append("                             ) AS BKG_QTY," ).append("\n"); 
		query.append("							 (SELECT TO_CHAR((MAX(D.ACT_WGT) * DECODE(MAX(D.WGT_UT_CD), 'LBS', 0.00045, 0.001)) " ).append("\n"); 
		query.append("                                    + SUM(Q.OP_CNTR_QTY * (SELECT TS.CNTR_TPSZ_TARE_WGT FROM MDM_CNTR_TP_SZ TS WHERE TS.CNTR_TPSZ_CD = Q.CNTR_TPSZ_CD)) * 0.001, 'FM0000000000.000')" ).append("\n"); 
		query.append("                               FROM BKG_QUANTITY Q" ).append("\n"); 
		query.append("                              WHERE B.BKG_NO      = Q.BKG_NO" ).append("\n"); 
		query.append("                                AND Q.OP_CNTR_QTY > 0" ).append("\n"); 
		query.append("                            ) AS BKG_WGT, " ).append("\n"); 
		query.append("                             A.PAST," ).append("\n"); 
		query.append("                             CASE WHEN A.TRD_CD IN ('AES', 'IAS') " ).append("\n"); 
		query.append("                                       AND BC.CUST_CNT_CD = 'CN' " ).append("\n"); 
		query.append("                                  THEN 'Y'                             " ).append("\n"); 
		query.append("                                  ELSE 'N'" ).append("\n"); 
		query.append("                             END AS AES_FLG," ).append("\n"); 
		query.append("                             BC.CUST_CNT_CD||LPAD(BC.CUST_SEQ,6,'0') AS SHP_CUST_CD, " ).append("\n"); 
		query.append("                             B.POL_CD AS BKG_POL_CD," ).append("\n"); 
		query.append("                             B.POD_CD AS BKG_POD_CD," ).append("\n"); 
		query.append("                             B.CMDT_CD," ).append("\n"); 
		query.append("                             (SELECT CC.CUST_CTRL_CD" ).append("\n"); 
		query.append("                                    FROM SPC_MDL_CUST_CTRL CC" ).append("\n"); 
		query.append("                                   WHERE CC.TRD_CD      = A.TRD_CD" ).append("\n"); 
		query.append("                                     AND CC.COST_YRWK   = SUBSTR(A.SEASON, 1, 6)" ).append("\n"); 
		query.append("                                     AND CC.VER_SEQ     = SUBSTR(A.SEASON, 8)" ).append("\n"); 
		query.append("                                     AND CC.CUST_CNT_CD = B.CTRT_CUST_CNT_CD" ).append("\n"); 
		query.append("                                     AND CC.CUST_SEQ    = B.CTRT_CUST_SEQ" ).append("\n"); 
		query.append("                                     --SC, RFA중 하나라도 맞으면 실적 인지하도록" ).append("\n"); 
		query.append("                                     AND (" ).append("\n"); 
		query.append("                                        CASE WHEN CC.SC_NO IS NOT NULL AND B.SC_NO IS NOT NULL THEN CC.SC_NO" ).append("\n"); 
		query.append("                                             ELSE (CASE WHEN CC.RFA_NO IS NOT NULL AND B.RFA_NO IS NOT NULL THEN CC.RFA_NO" ).append("\n"); 
		query.append("                                                        ELSE 'X' END)" ).append("\n"); 
		query.append("                                             END =" ).append("\n"); 
		query.append("                                        CASE WHEN CC.SC_NO IS NOT NULL AND B.SC_NO IS NOT NULL THEN SPC_GET_SMP_AMEND_FNC(CC.TRD_CD, CC.COST_YRWK, CC.VER_SEQ, B.SC_NO)" ).append("\n"); 
		query.append("                                             ELSE (CASE WHEN CC.RFA_NO IS NOT NULL AND B.RFA_NO IS NOT NULL THEN SPC_GET_SMP_AMEND_FNC(CC.TRD_CD, CC.COST_YRWK, CC.VER_SEQ, DECODE(SUBSTR(B.RFA_NO, 1, 3), 'DUM', '', B.RFA_NO))" ).append("\n"); 
		query.append("                                                        ELSE 'X' END) " ).append("\n"); 
		query.append("                                             END)                                    " ).append("\n"); 
		query.append("                                     AND ROWNUM = 1) AS CUST_CTRL_CD" ).append("\n"); 
		query.append("                           , A.CTRL_ECC_FLG, A.CTRL_LOC_FLG, A.CTRL_USA_SVC_MOD_FLG, A.CTRL_ACCT_FLG, A.CTRL_DEST_LVL_CD" ).append("\n"); 
		query.append("                           " ).append("\n"); 
		query.append("#if (${check_ipi_local} != '')" ).append("\n"); 
		query.append("                           , CASE WHEN (SUBSTR(B.POR_CD, 1, 2) IN ('CA', 'US') OR SUBSTR(B.DEL_CD, 1, 2) IN ('CA', 'US')) THEN " ).append("\n"); 
		query.append("                                   SPC_USA_MODE_FNC(B.RCV_TERM_CD, B.DE_TERM_CD, B.POR_CD, B.POL_CD, B.POD_CD,B.DEL_CD)" ).append("\n"); 
		query.append("                             ELSE " ).append("\n"); 
		query.append("                                   'OTH' " ).append("\n"); 
		query.append("                             END USA_BKG_MOD_CD" ).append("\n"); 
		query.append("                             " ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("                           , CASE " ).append("\n"); 
		query.append("                                WHEN A.CTRL_USA_SVC_MOD_FLG = 'Y' AND (SUBSTR(B.POR_CD, 1, 2) IN ('CA', 'US') OR SUBSTR(B.DEL_CD, 1, 2) IN ('CA', 'US'))" ).append("\n"); 
		query.append("                                THEN SPC_USA_MODE_FNC(B.RCV_TERM_CD, B.DE_TERM_CD, B.POR_CD, B.POL_CD, B.POD_CD,B.DEL_CD)" ).append("\n"); 
		query.append("                             ELSE 'OTH' END USA_BKG_MOD_CD" ).append("\n"); 
		query.append("#end  " ).append("\n"); 
		query.append("                             " ).append("\n"); 
		query.append("                           " ).append("\n"); 
		query.append("#if (${check_dest_ctrl} != '')  " ).append("\n"); 
		query.append("                             " ).append("\n"); 
		query.append("                           , NVL((SELECT D.CTRL_LOC_ACCT_CD" ).append("\n"); 
		query.append("                                    FROM DEST_LOC_TMP               D," ).append("\n"); 
		query.append("                                         MDM_LOCATION               ML1," ).append("\n"); 
		query.append("                                         MDM_EQ_ORZ_CHT             ME1" ).append("\n"); 
		query.append("                                   WHERE A.RLANE_CD         = D.RLANE_CD" ).append("\n"); 
		query.append("                                     AND SPC_GET_REP_TRD_FNC(A.RLANE_CD)     = D.TRD_CD" ).append("\n"); 
		query.append("                                     AND SPC_GET_REP_SUB_TRD_FNC(A.RLANE_CD) = D.SUB_TRD_CD" ).append("\n"); 
		query.append("                                     AND A.SKD_DIR_CD       = D.DIR_CD " ).append("\n"); 
		query.append("                                     AND D.ALOC_CTRL_TP_CD  = 'E'" ).append("\n"); 
		query.append("                                     AND ML1.LOC_CD         = B.DEL_CD" ).append("\n"); 
		query.append("                                     AND ME1.SCC_CD         = ML1.SCC_CD" ).append("\n"); 
		query.append("                                     AND D.CTRL_LOC_ACCT_CD = ME1.ECC_CD" ).append("\n"); 
		query.append("                                     " ).append("\n"); 
		query.append("                                  UNION ALL" ).append("\n"); 
		query.append("                                         " ).append("\n"); 
		query.append("                                  SELECT D.CTRL_LOC_ACCT_CD" ).append("\n"); 
		query.append("                                    FROM DEST_LOC_TMP D" ).append("\n"); 
		query.append("                                   WHERE A.RLANE_CD                          = D.RLANE_CD" ).append("\n"); 
		query.append("                                     AND SPC_GET_REP_TRD_FNC(A.RLANE_CD)     = D.TRD_CD" ).append("\n"); 
		query.append("                                     AND SPC_GET_REP_SUB_TRD_FNC(A.RLANE_CD) = D.SUB_TRD_CD" ).append("\n"); 
		query.append("                                     AND A.SKD_DIR_CD       = D.DIR_CD " ).append("\n"); 
		query.append("                                     AND D.ALOC_CTRL_TP_CD  = 'L'" ).append("\n"); 
		query.append("                                     AND D.CTRL_LOC_ACCT_CD = B.DEL_CD   " ).append("\n"); 
		query.append("                                    " ).append("\n"); 
		query.append("                                 ),'XXXXX') AS  DEST_LOC_CD                              " ).append("\n"); 
		query.append("                             " ).append("\n"); 
		query.append("#else  " ).append("\n"); 
		query.append("                           " ).append("\n"); 
		query.append("                           , CASE --아래두개의 FLAG가 동시에 Y인경우는 없음" ).append("\n"); 
		query.append("                                WHEN A.CTRL_LVL_CD = 'T' AND A.CTRL_LOC_FLG = 'Y' THEN                                 " ).append("\n"); 
		query.append("                                     NVL((SELECT D.CTRL_LOC_ACCT_CD" ).append("\n"); 
		query.append("                                            FROM SPC_ALOC_LANE_CTRL_OPT_DTL D" ).append("\n"); 
		query.append("                                           WHERE A.RLANE_CD         = D.RLANE_CD" ).append("\n"); 
		query.append("                                             AND SPC_GET_REP_TRD_FNC(A.RLANE_CD)     = D.TRD_CD" ).append("\n"); 
		query.append("                                             AND SPC_GET_REP_SUB_TRD_FNC(A.RLANE_CD) = D.SUB_TRD_CD" ).append("\n"); 
		query.append("                                             AND A.SKD_DIR_CD       = D.DIR_CD " ).append("\n"); 
		query.append("                                             AND D.ALOC_CTRL_TP_CD  = 'L'" ).append("\n"); 
		query.append("                                             AND D.CTRL_LOC_ACCT_CD = DECODE(A.CTRL_DEST_LVL_CD, 'T', B.DEL_CD, 'D', B.POD_CD, 'ZZZZZ')" ).append("\n"); 
		query.append("                                       ),'XXXXX') " ).append("\n"); 
		query.append("                                       " ).append("\n"); 
		query.append("                                WHEN A.CTRL_LVL_CD = 'T' AND A.CTRL_ECC_FLG = 'Y' THEN " ).append("\n"); 
		query.append("                                     NVL((SELECT D.CTRL_LOC_ACCT_CD" ).append("\n"); 
		query.append("                                            FROM SPC_ALOC_LANE_CTRL_OPT_DTL D," ).append("\n"); 
		query.append("                                                 MDM_LOCATION               ML1," ).append("\n"); 
		query.append("                                                 MDM_EQ_ORZ_CHT             ME1" ).append("\n"); 
		query.append("                                           WHERE A.RLANE_CD         = D.RLANE_CD" ).append("\n"); 
		query.append("                                             AND SPC_GET_REP_TRD_FNC(A.RLANE_CD)     = D.TRD_CD" ).append("\n"); 
		query.append("                                             AND SPC_GET_REP_SUB_TRD_FNC(A.RLANE_CD) = D.SUB_TRD_CD" ).append("\n"); 
		query.append("                                             AND A.SKD_DIR_CD       = D.DIR_CD " ).append("\n"); 
		query.append("                                             AND D.ALOC_CTRL_TP_CD  = 'E'" ).append("\n"); 
		query.append("                                             AND ML1.LOC_CD         = DECODE(A.CTRL_DEST_LVL_CD, 'T', B.DEL_CD, 'D', B.POD_CD, 'ZZZZZ')" ).append("\n"); 
		query.append("                                             AND ME1.SCC_CD         = ML1.SCC_CD" ).append("\n"); 
		query.append("                                             AND D.CTRL_LOC_ACCT_CD = ME1.ECC_CD" ).append("\n"); 
		query.append("                                    ),'XXXXX')" ).append("\n"); 
		query.append("                                   " ).append("\n"); 
		query.append("                             ELSE 'XXXXX' END DEST_LOC_CD" ).append("\n"); 
		query.append("                             " ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                               , CASE WHEN A.CTRL_ACCT_FLG = 'Y' THEN" ).append("\n"); 
		query.append("                               NVL((" ).append("\n"); 
		query.append("                               -- A : Individul B: Actual C: Commodity" ).append("\n"); 
		query.append("									SELECT DISTINCT(D.CTRL_LOC_ACCT_CD)" ).append("\n"); 
		query.append("									  FROM ALOC_LANE_CTRL_OPT_DTL D" ).append("\n"); 
		query.append("									 WHERE A.RLANE_CD                           = D.RLANE_CD" ).append("\n"); 
		query.append("									   AND SPC_GET_REP_TRD_FNC(A.RLANE_CD)      = D.TRD_CD" ).append("\n"); 
		query.append("									   AND SPC_GET_REP_SUB_TRD_FNC(A.RLANE_CD)  = D.SUB_TRD_CD" ).append("\n"); 
		query.append("									   AND A.SKD_DIR_CD                         = D.DIR_CD " ).append("\n"); 
		query.append("									   AND D.ALOC_CTRL_TP_CD                    IN ('A','B','C') " ).append("\n"); 
		query.append("								       AND (( SPC_SCR_OFC_CONV_FNC(B.OB_SLS_OFC_CD) IN " ).append("\n"); 
		query.append("                                              (SELECT OFC.OFC_CD" ).append("\n"); 
		query.append("                                                 FROM SPC_ALOC_LANE_CTRL_OFC OFC" ).append("\n"); 
		query.append("                                                WHERE D.RLANE_CD           = OFC.RLANE_CD" ).append("\n"); 
		query.append("								                  AND D.TRD_CD             = OFC.TRD_CD" ).append("\n"); 
		query.append("								                  AND D.SUB_TRD_CD         = OFC.SUB_TRD_CD" ).append("\n"); 
		query.append("								                  AND D.DIR_CD             = OFC.DIR_CD " ).append("\n"); 
		query.append("								                  AND D.ALOC_CTRL_TP_CD    = OFC.ALOC_CTRL_TP_CD" ).append("\n"); 
		query.append("                                                  AND D.CTRL_LOC_ACCT_CD   = OFC.CTRL_LOC_ACCT_CD" ).append("\n"); 
		query.append("                                            ))" ).append("\n"); 
		query.append("                                            OR ( NOT EXISTS " ).append("\n"); 
		query.append("                                             ( SELECT 1" ).append("\n"); 
		query.append("                                                 FROM SPC_ALOC_LANE_CTRL_OFC OFC_ALL" ).append("\n"); 
		query.append("                                                WHERE D.RLANE_CD           = OFC_ALL.RLANE_CD" ).append("\n"); 
		query.append("                                                AND D.TRD_CD             = OFC_ALL.TRD_CD" ).append("\n"); 
		query.append("                                                AND D.SUB_TRD_CD         = OFC_ALL.SUB_TRD_CD" ).append("\n"); 
		query.append("								                AND D.DIR_CD             = OFC_ALL.DIR_CD " ).append("\n"); 
		query.append("								                AND D.ALOC_CTRL_TP_CD    = OFC_ALL.ALOC_CTRL_TP_CD" ).append("\n"); 
		query.append("                                                AND D.CTRL_LOC_ACCT_CD   = OFC_ALL.CTRL_LOC_ACCT_CD" ).append("\n"); 
		query.append("                                                )" ).append("\n"); 
		query.append("                                            ))" ).append("\n"); 
		query.append("									   AND (D.CTRL_LOC_ACCT_CD = B.SC_NO OR D.CTRL_LOC_ACCT_CD = B.RFA_NO)" ).append("\n"); 
		query.append("									   AND D.ALOC_CTRL_DTL_CD  = DECODE(D.ALOC_CTRL_TP_CD, 'A', B.CTRT_CUST_CNT_CD ||LPAD(B.CTRT_CUST_SEQ,6,'0')," ).append("\n"); 
		query.append("                                                                                       	   'B', B.AGMT_ACT_CNT_CD ||LPAD(B.AGMT_ACT_CUST_SEQ,6,'0')," ).append("\n"); 
		query.append("                                                                                           'C', B.CMDT_CD)                                     " ).append("\n"); 
		query.append("                               ),'OTHERS')" ).append("\n"); 
		query.append("                               ELSE" ).append("\n"); 
		query.append("                                    'OTHERS'" ).append("\n"); 
		query.append("                               END AS ACCOUNT_CD " ).append("\n"); 
		query.append("			       ,change_code" ).append("\n"); 
		query.append("                FROM MAS_MON_VVD_LV     A  ," ).append("\n"); 
		query.append("                     MDM_REV_LANE       RL ,         " ).append("\n"); 
		query.append("                     SPC_OFC_LVL        O  ,                    " ).append("\n"); 
		query.append("                     BKG_BOOKING        B  ,                 " ).append("\n"); 
		query.append("                     MDM_DTL_REV_LANE   DRL, " ).append("\n"); 
		query.append("                     BKG_VVD            BV ," ).append("\n"); 
		query.append("                     BKG_CUSTOMER       BC  " ).append("\n"); 
		query.append("					, BKG_BL_DOC D" ).append("\n"); 
		query.append("#if (${check_sector2} == 'Y')" ).append("\n"); 
		query.append("                     ,MAIN_POL_POD SEC" ).append("\n"); 
		query.append("#end					 " ).append("\n"); 
		query.append("               WHERE O.OFC_CD         = SPC_SCR_OFC_CONV_FNC(B.OB_SLS_OFC_CD)" ).append("\n"); 
		query.append("                 AND A.COST_YR || A.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK" ).append("\n"); 
		query.append("                 AND B.BKG_STS_CD    IN('W','F')" ).append("\n"); 
		query.append("                 AND B.BKG_CGO_TP_CD IN ('F', 'B', 'R')" ).append("\n"); 
		query.append("                 AND A.VSL_CD         = B.VSL_CD" ).append("\n"); 
		query.append("                 AND A.SKD_VOY_NO     = B.SKD_VOY_NO" ).append("\n"); 
		query.append("                 AND A.SKD_DIR_CD     = B.SKD_DIR_CD" ).append("\n"); 
		query.append("				 AND B.BKG_NO         = D.BKG_NO" ).append("\n"); 
		query.append("#if (${rhq2} != '' || ${area} != '' || ${sales_office} != '')" ).append("\n"); 
		query.append("       AND (    (A.RHQ_CD = 'SHARC' AND A.AQ_CD IS NULL AND A.RGN_OFC_CD IS NULL) " ).append("\n"); 
		query.append("             OR EXISTS ( SELECT O.OFC_CD" ).append("\n"); 
		query.append("                           FROM SPC_OFC_LVL O" ).append("\n"); 
		query.append("                          WHERE O.OFC_TP_CD IN ('BB', 'BA', 'BS')" ).append("\n"); 
		query.append("                            AND SPC_SCR_OFC_CONV_FNC(B.BKG_OFC_CD) = O.OFC_CD" ).append("\n"); 
		query.append("						    AND A.RHQ_CD = O.N2ND_PRNT_OFC_CD" ).append("\n"); 
		query.append("                            AND A.COST_YR || A.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK" ).append("\n"); 
		query.append("                     CONNECT BY NOCYCLE O.PRNT_OFC_CD = PRIOR O.OFC_CD" ).append("\n"); 
		query.append("                             START WITH (A.RGN_OFC_CD IS NULL AND (O.PRNT_OFC_CD = A.AQ_CD OR O.PRNT_OFC_CD = A.RHQ_CD)) OR (O.OFC_CD = A.RGN_OFC_CD)))" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${pol_cd} != '')" ).append("\n"); 
		query.append("                 AND A.POL_CD = NVL(B.PRE_RLY_PORT_CD, B.POL_CD)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                 AND DRL.TRD_CD          = A.TRD_CD" ).append("\n"); 
		query.append("                 AND DRL.RLANE_CD        = A.RLANE_CD" ).append("\n"); 
		query.append("                 AND DRL.VSL_SLAN_DIR_CD = A.DIR_CD" ).append("\n"); 
		query.append("                 AND DRL.IOC_CD          = A.IOC_CD" ).append("\n"); 
		query.append("                 AND DRL.SUB_TRD_CD      = A.SUB_TRD_CD" ).append("\n"); 
		query.append("                 AND DRL.DELT_FLG        = 'N'" ).append("\n"); 
		query.append("                 AND DRL.RLANE_CD        = RL.RLANE_CD" ).append("\n"); 
		query.append("                 AND DRL.FM_CONTI_CD     =( SELECT SPC_CONTI_CONV_FNC(L.CONTI_CD, A.RLANE_CD, A.DIR_CD)" ).append("\n"); 
		query.append("                                              FROM MDM_LOCATION L" ).append("\n"); 
		query.append("                                             WHERE L.LOC_CD = NVL(B.PRE_RLY_PORT_CD, B.POL_CD) )" ).append("\n"); 
		query.append("                 AND DRL.TO_CONTI_CD     =( SELECT SPC_CONTI_CONV_FNC(L.CONTI_CD, A.RLANE_CD, A.DIR_CD)" ).append("\n"); 
		query.append("                                              FROM MDM_LOCATION L" ).append("\n"); 
		query.append("                                             WHERE L.LOC_CD = NVL(B.PST_RLY_PORT_CD, B.POD_CD) )" ).append("\n"); 
		query.append("                 AND (    ((A.RHQ_CD = 'SHARC' AND A.AQ_CD IS NULL AND A.RGN_OFC_CD IS NULL AND  A.RHQ_CD = O.N2ND_PRNT_OFC_CD) AND DRL.FM_CONTI_CD = 'A')" ).append("\n"); 
		query.append("                       OR A.RHQ_CD <> 'SHARC'" ).append("\n"); 
		query.append("                       OR A.AQ_CD      IS NOT NULL" ).append("\n"); 
		query.append("                       OR A.RGN_OFC_CD IS NOT NULL )" ).append("\n"); 
		query.append("                 AND RL.RLANE_CD    = A.RLANE_CD" ).append("\n"); 
		query.append("                 AND RL.VSL_SLAN_CD = B.SLAN_CD" ).append("\n"); 
		query.append("                 AND RL.VSL_TP_CD   = 'C'" ).append("\n"); 
		query.append("                 AND RL.DELT_FLG    = 'N'" ).append("\n"); 
		query.append("                 " ).append("\n"); 
		query.append("                 AND B.BKG_NO            = BV.BKG_NO" ).append("\n"); 
		query.append("                 AND A.VSL_CD            = BV.VSL_CD" ).append("\n"); 
		query.append("                 AND A.SKD_VOY_NO        = BV.SKD_VOY_NO" ).append("\n"); 
		query.append("                 AND A.DIR_CD            = BV.SKD_DIR_CD" ).append("\n"); 
		query.append("                 AND B.BKG_NO            = BC.BKG_NO  " ).append("\n"); 
		query.append("                 AND BC.BKG_CUST_TP_CD   = 'S'       " ).append("\n"); 
		query.append("#if (${check_sector2} == 'Y')" ).append("\n"); 
		query.append("                 AND A.RLANE_CD    = SEC.RLANE_CD" ).append("\n"); 
		query.append("                 AND A.DIR_CD      = SEC.SKD_DIR_CD " ).append("\n"); 
		query.append("                 AND A.COST_YR     = SEC.COST_YR" ).append("\n"); 
		query.append("                 AND A.COST_WK     = SEC.COST_WK" ).append("\n"); 
		query.append("                 AND BV.POD_CD     = SEC.POD_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("             ) B, RFA_BKG_DATA RD" ).append("\n"); 
		query.append("       WHERE B.SHP_CUST_CD = RD.SHP_CUST_CD(+) " ).append("\n"); 
		query.append("         AND B.BKG_POL_CD  = RD.POL_CD(+)" ).append("\n"); 
		query.append("         AND B.BKG_POD_CD  = RD.POD_CD(+)" ).append("\n"); 
		query.append("         AND B.CMDT_CD     = RD.CMDT_CD(+)  " ).append("\n"); 
		query.append("             " ).append("\n"); 
		query.append("      ) B" ).append("\n"); 
		query.append("GROUP BY B.TRD_CD         ," ).append("\n"); 
		query.append("         B.DIR_CD         ," ).append("\n"); 
		query.append("         B.SUB_TRD_CD     ," ).append("\n"); 
		query.append("         B.RLANE_CD       ," ).append("\n"); 
		query.append("         B.OFC_CD         ," ).append("\n"); 
		query.append("         B.WK             ," ).append("\n"); 
		query.append("         B.NUM            ," ).append("\n"); 
		query.append("         B.NUM_1," ).append("\n"); 
		query.append("         B.VVD            ," ).append("\n"); 
		query.append("         B.BSA   ,B.BSA_WGT ," ).append("\n"); 
		query.append("         B.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("         B.ACCT_FLG       ," ).append("\n"); 
		query.append("         B.CUST_CTRL_CD" ).append("\n"); 
		query.append("       , B.CTRL_ECC_FLG, B.CTRL_LOC_FLG, B.CTRL_USA_SVC_MOD_FLG, B.CTRL_ACCT_FLG, B.CTRL_DEST_LVL_CD" ).append("\n"); 
		query.append("       , B.USA_BKG_MOD_CD" ).append("\n"); 
		query.append("       , B.DEST_LOC_CD " ).append("\n"); 
		query.append("       , B.ACCOUNT_CD" ).append("\n"); 
		query.append("       ,change_code" ).append("\n"); 
		query.append("  HAVING B.OFC_CD IS NOT NULL" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", MDL_DATA AS (" ).append("\n"); 
		query.append("    SELECT A.TRD_CD    ," ).append("\n"); 
		query.append("           A.DIR_CD    ," ).append("\n"); 
		query.append("           A.SUB_TRD_CD," ).append("\n"); 
		query.append("           A.RLANE_CD  ," ).append("\n"); 
		query.append("           M.SLS_RGN_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("           M.CUST_CTRL_CD," ).append("\n"); 
		query.append("           A.COST_YR||A.COST_WK AS WK," ).append("\n"); 
		query.append("           A.NUM," ).append("\n"); 
		query.append("           A.NUM_1," ).append("\n"); 
		query.append("           A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD AS VVD," ).append("\n"); 
		query.append("           A.BSA ,A.BSA_WGT," ).append("\n"); 
		query.append("           A.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           A.ACCT_FLG       ," ).append("\n"); 
		query.append("           SUM(RLANE_ADJ_QTY) AS MDL_QTY" ).append("\n"); 
		query.append("           , A.CTRL_ECC_FLG, A.CTRL_LOC_FLG, A.CTRL_USA_SVC_MOD_FLG, A.CTRL_ACCT_FLG, A.CTRL_DEST_LVL_CD " ).append("\n"); 
		query.append("	   ,change_code" ).append("\n"); 
		query.append("      FROM MAS_MON_VVD_LV        A," ).append("\n"); 
		query.append("           SPC_MDL_CUST_REV_LANE M" ).append("\n"); 
		query.append("     WHERE M.COST_YRWK      = SUBSTR(A.SEASON, 1, 6)" ).append("\n"); 
		query.append("       AND M.VER_SEQ        = SUBSTR(A.SEASON, 8)" ).append("\n"); 
		query.append("       AND M.TRD_CD         = A.TRD_CD" ).append("\n"); 
		query.append("       AND M.SUB_TRD_CD     = A.SUB_TRD_CD" ).append("\n"); 
		query.append("       AND M.RLANE_CD       = A.RLANE_CD" ).append("\n"); 
		query.append("       AND M.SLS_RHQ_CD     = A.RHQ_CD" ).append("\n"); 
		query.append("#if (${sales_office} != '')" ).append("\n"); 
		query.append("       AND M.SLS_RGN_OFC_CD = A.RGN_OFC_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("       AND A.ACCT_FLG       = 'Y'" ).append("\n"); 
		query.append("  GROUP BY A.TRD_CD        ," ).append("\n"); 
		query.append("           A.DIR_CD        ," ).append("\n"); 
		query.append("           A.SUB_TRD_CD    ," ).append("\n"); 
		query.append("           A.RLANE_CD      ," ).append("\n"); 
		query.append("           M.SLS_RGN_OFC_CD," ).append("\n"); 
		query.append("           M.CUST_CTRL_CD  ," ).append("\n"); 
		query.append("           A.COST_YR||A.COST_WK," ).append("\n"); 
		query.append("           A.NUM," ).append("\n"); 
		query.append("           A.NUM_1," ).append("\n"); 
		query.append("           A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD," ).append("\n"); 
		query.append("           A.BSA,A.BSA_WGT," ).append("\n"); 
		query.append("           A.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           A.ACCT_FLG" ).append("\n"); 
		query.append("           , A.CTRL_ECC_FLG, A.CTRL_LOC_FLG, A.CTRL_USA_SVC_MOD_FLG, A.CTRL_ACCT_FLG, A.CTRL_DEST_LVL_CD" ).append("\n"); 
		query.append("	   ,change_code" ).append("\n"); 
		query.append("    HAVING SUM(M.RLANE_ADJ_QTY)>0" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", BASE_DATA AS(" ).append("\n"); 
		query.append("    SELECT TRD_CD         " ).append("\n"); 
		query.append("          ,DIR_CD         " ).append("\n"); 
		query.append("          ,SUB_TRD_CD     " ).append("\n"); 
		query.append("          ,RLANE_CD    " ).append("\n"); 
		query.append("          ,DECODE(Z1.OFC_CD, 'BSA', 'BSA', ( " ).append("\n"); 
		query.append("#if(${check_area2} =='Y')" ).append("\n"); 
		query.append("                                              SELECT SPC_RGN_OFC_CONV_FNC(NVL(O.N3RD_PRNT_OFC_CD, O.N2ND_PRNT_OFC_CD),Z1.OFC_CD)" ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("                                              SELECT NVL(O.N3RD_PRNT_OFC_CD, O.N2ND_PRNT_OFC_CD)             " ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                                                FROM SPC_OFC_LVL O" ).append("\n"); 
		query.append("                                               WHERE O.OFC_CD = Z1.OFC_CD" ).append("\n"); 
		query.append("                                                 AND Z1.WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK )" ).append("\n"); 
		query.append("           ) AS AQ_CD" ).append("\n"); 
		query.append("          ,OFC_CD         " ).append("\n"); 
		query.append("          ,CUST_CTRL_CD   " ).append("\n"); 
		query.append("          ,WK             " ).append("\n"); 
		query.append("          ,NUM " ).append("\n"); 
		query.append("#if(${checkVvd1} == 'Y')" ).append("\n"); 
		query.append("          ,DENSE_RANK() OVER(PARTITION BY TRD_CD, RLANE_CD, DIR_CD, NUM ORDER BY NUM_1) NUM_1" ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("          ,'' AS NUM_1" ).append("\n"); 
		query.append("#end " ).append("\n"); 
		query.append("          ,VVD            " ).append("\n"); 
		query.append("          ,BSA            " ).append("\n"); 
		query.append("          ,LOD_SPL_CNG_FLG" ).append("\n"); 
		query.append("		  ,NVL(BSA_WGT,0) AS BSA_WGT" ).append("\n"); 
		query.append("          ,NVL(BKG_WGT,0) AS BKG_WGT" ).append("\n"); 
		query.append("          ,ACCT_FLG       " ).append("\n"); 
		query.append("          ,QTA_QTY " ).append("\n"); 
		query.append("          ,QTA_GREV" ).append("\n"); 
		query.append("          ,QTA_CM  " ).append("\n"); 
		query.append("          ,FCT_QTY " ).append("\n"); 
		query.append("          ,FCT_GREV" ).append("\n"); 
		query.append("          ,FCT_CM  " ).append("\n"); 
		query.append("          ,ALC_QTY " ).append("\n"); 
		query.append("          ,ALC_GREV" ).append("\n"); 
		query.append("          ,ALC_CM  " ).append("\n"); 
		query.append("          ,BKG_QTY " ).append("\n"); 
		query.append("          ,BKG_GREV" ).append("\n"); 
		query.append("          ,BKG_CM  " ).append("\n"); 
		query.append("          ,MDL_QTY" ).append("\n"); 
		query.append("          ,CTRL_ECC_FLG" ).append("\n"); 
		query.append("          ,CTRL_LOC_FLG" ).append("\n"); 
		query.append("          ,CTRL_USA_SVC_MOD_FLG" ).append("\n"); 
		query.append("          ,CTRL_ACCT_FLG" ).append("\n"); 
		query.append("          ,CTRL_DEST_LVL_CD" ).append("\n"); 
		query.append("          ,USA_BKG_MOD_CD" ).append("\n"); 
		query.append("          ,DEST_LOC_CD" ).append("\n"); 
		query.append("          , ACCOUNT_CD" ).append("\n"); 
		query.append("	  ,change_code" ).append("\n"); 
		query.append("      FROM (" ).append("\n"); 
		query.append("		    SELECT TRD_CD         ," ).append("\n"); 
		query.append("		           DIR_CD         ," ).append("\n"); 
		query.append("		           SUB_TRD_CD     ," ).append("\n"); 
		query.append("		           RLANE_CD       ," ).append("\n"); 
		query.append("		           OFC_CD         ," ).append("\n"); 
		query.append("		           CUST_CTRL_CD   ," ).append("\n"); 
		query.append("		           WK             ," ).append("\n"); 
		query.append("		           NUM            ," ).append("\n"); 
		query.append("                   NUM_1," ).append("\n"); 
		query.append("		           VVD            ," ).append("\n"); 
		query.append("		           DECODE(TRD_CD||LOD_SPL_CNG_FLG,'IASY',SUM(BKG_QTY),BSA) AS BSA,  " ).append("\n"); 
		query.append("		           DECODE(TRD_CD||LOD_SPL_CNG_FLG,'IASY',SUM(BKG_WGT),BSA_WGT) AS BSA_WGT,  " ).append("\n"); 
		query.append("		           LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                   SUM(BKG_WGT)  AS BKG_WGT ," ).append("\n"); 
		query.append("		           ACCT_FLG       ," ).append("\n"); 
		query.append("		           SUM(QTA_QTY)  AS QTA_QTY ," ).append("\n"); 
		query.append("		           SUM(QTA_GREV) AS QTA_GREV," ).append("\n"); 
		query.append("		           SUM(QTA_CM)   AS QTA_CM  ," ).append("\n"); 
		query.append("		           SUM(FCT_QTY)  AS FCT_QTY ," ).append("\n"); 
		query.append("		           SUM(FCT_GREV) AS FCT_GREV," ).append("\n"); 
		query.append("		           SUM(FCT_CM)   AS FCT_CM  ," ).append("\n"); 
		query.append("		           SUM(ALC_QTY)  AS ALC_QTY ," ).append("\n"); 
		query.append("		           SUM(ALC_GREV) AS ALC_GREV," ).append("\n"); 
		query.append("		           SUM(ALC_CM)   AS ALC_CM  ," ).append("\n"); 
		query.append("		           SUM(BKG_QTY)  AS BKG_QTY ," ).append("\n"); 
		query.append("		           SUM(BKG_GREV) AS BKG_GREV," ).append("\n"); 
		query.append("		           SUM(BKG_CM)   AS BKG_CM  ," ).append("\n"); 
		query.append("		           SUM(MDL_QTY)  AS MDL_QTY" ).append("\n"); 
		query.append("		           , CTRL_ECC_FLG, CTRL_LOC_FLG, CTRL_USA_SVC_MOD_FLG, CTRL_ACCT_FLG, CTRL_DEST_LVL_CD, USA_BKG_MOD_CD, DEST_LOC_CD" ).append("\n"); 
		query.append("		           , ACCOUNT_CD" ).append("\n"); 
		query.append("			   ,change_code" ).append("\n"); 
		query.append("		      FROM (" ).append("\n"); 
		query.append("		              SELECT TRD_CD         ," ).append("\n"); 
		query.append("		                     DIR_CD         ," ).append("\n"); 
		query.append("		                     SUB_TRD_CD     ," ).append("\n"); 
		query.append("		                     RLANE_CD       ," ).append("\n"); 
		query.append("		                     OFC_CD         ," ).append("\n"); 
		query.append("		                     CUST_CTRL_CD   ," ).append("\n"); 
		query.append("		                     WK             ," ).append("\n"); 
		query.append("		                     NUM            ," ).append("\n"); 
		query.append("                             NUM_1," ).append("\n"); 
		query.append("		                     VVD            ," ).append("\n"); 
		query.append("		                     BSA            ," ).append("\n"); 
		query.append("		                     LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("		                     ACCT_FLG       ," ).append("\n"); 
		query.append("							 BSA_WGT   ," ).append("\n"); 
		query.append("                             0 AS BKG_WGT   ," ).append("\n"); 
		query.append("		                     QTA_QTY        ," ).append("\n"); 
		query.append("		                     QTA_GREV       ," ).append("\n"); 
		query.append("		                     QTA_CM         ," ).append("\n"); 
		query.append("		                     FCT_QTY        ," ).append("\n"); 
		query.append("		                     FCT_GREV       ," ).append("\n"); 
		query.append("		                     FCT_CM         ," ).append("\n"); 
		query.append("		                     ALC_QTY        ," ).append("\n"); 
		query.append("		                     ALC_GREV       ," ).append("\n"); 
		query.append("		                     ALC_CM         ," ).append("\n"); 
		query.append("		                     BKG_QTY        ," ).append("\n"); 
		query.append("		                     BKG_GREV       ," ).append("\n"); 
		query.append("		                     BKG_CM         ," ).append("\n"); 
		query.append("		                     0 AS MDL_QTY" ).append("\n"); 
		query.append("		                     , CTRL_ECC_FLG, CTRL_LOC_FLG, CTRL_USA_SVC_MOD_FLG, CTRL_ACCT_FLG, CTRL_DEST_LVL_CD, 'OTH' USA_BKG_MOD_CD, 'XXXXX' DEST_LOC_CD" ).append("\n"); 
		query.append("		                     , 'OTHERS' AS ACCOUNT_CD" ).append("\n"); 
		query.append("				     ,change_code" ).append("\n"); 
		query.append("		                FROM QTA_DATA" ).append("\n"); 
		query.append("		              UNION ALL" ).append("\n"); 
		query.append("		              SELECT TRD_CD         ," ).append("\n"); 
		query.append("		                     DIR_CD         ," ).append("\n"); 
		query.append("		                     SUB_TRD_CD     ," ).append("\n"); 
		query.append("		                     RLANE_CD       ," ).append("\n"); 
		query.append("		                     OFC_CD         ," ).append("\n"); 
		query.append("		                     CUST_CTRL_CD   ," ).append("\n"); 
		query.append("		                     WK             ," ).append("\n"); 
		query.append("		                     NUM            ," ).append("\n"); 
		query.append("                             NUM_1," ).append("\n"); 
		query.append("		                     VVD            ," ).append("\n"); 
		query.append("		                     BSA            ," ).append("\n"); 
		query.append("		                     LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("		                     ACCT_FLG       ," ).append("\n"); 
		query.append("							 BSA_WGT   ," ).append("\n"); 
		query.append("                             0 AS BKG_WGT   ,  " ).append("\n"); 
		query.append("		                     QTA_QTY        ," ).append("\n"); 
		query.append("		                     QTA_GREV       ," ).append("\n"); 
		query.append("		                     QTA_CM         ," ).append("\n"); 
		query.append("		                     DECODE(PAST, 'N', FCT_QTY , 0) AS FCT_QTY ," ).append("\n"); 
		query.append("		                     DECODE(PAST, 'N', FCT_GREV, 0) AS FCT_GREV," ).append("\n"); 
		query.append("		                     DECODE(PAST, 'N', FCT_CM  , 0) AS FCT_CM  ," ).append("\n"); 
		query.append("		                     ALC_QTY ," ).append("\n"); 
		query.append("		                     ALC_GREV," ).append("\n"); 
		query.append("		                     ALC_CM  ," ).append("\n"); 
		query.append("		                     BKG_QTY ," ).append("\n"); 
		query.append("		                     BKG_GREV," ).append("\n"); 
		query.append("		                     BKG_CM  ," ).append("\n"); 
		query.append("		                     0 AS MDL_QTY" ).append("\n"); 
		query.append("		                     , CTRL_ECC_FLG, CTRL_LOC_FLG, CTRL_USA_SVC_MOD_FLG, CTRL_ACCT_FLG, CTRL_DEST_LVL_CD, USA_BKG_MOD_CD, DEST_LOC_CD" ).append("\n"); 
		query.append("		                     , ACCOUNT_CD" ).append("\n"); 
		query.append("				     ,change_code" ).append("\n"); 
		query.append("		                FROM FCT_DATA" ).append("\n"); 
		query.append("		              UNION ALL" ).append("\n"); 
		query.append("		              SELECT TRD_CD         ," ).append("\n"); 
		query.append("		                     DIR_CD         ," ).append("\n"); 
		query.append("		                     SUB_TRD_CD     ," ).append("\n"); 
		query.append("		                     RLANE_CD       ," ).append("\n"); 
		query.append("		                     OFC_CD         ," ).append("\n"); 
		query.append("		                     CUST_CTRL_CD   ," ).append("\n"); 
		query.append("		                     WK             ," ).append("\n"); 
		query.append("		                     NUM            ," ).append("\n"); 
		query.append("                             NUM_1," ).append("\n"); 
		query.append("		                     VVD            ," ).append("\n"); 
		query.append("		                     BSA            ," ).append("\n"); 
		query.append("		                     LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("		                     ACCT_FLG       ," ).append("\n"); 
		query.append("							 BSA_WGT   ," ).append("\n"); 
		query.append("                             0 AS BKG_WGT   ,   " ).append("\n"); 
		query.append("		                     QTA_QTY        ," ).append("\n"); 
		query.append("		                     QTA_GREV       ," ).append("\n"); 
		query.append("		                     QTA_CM         ," ).append("\n"); 
		query.append("		                     FCT_QTY        ," ).append("\n"); 
		query.append("		                     FCT_GREV       ," ).append("\n"); 
		query.append("		                     FCT_CM         ," ).append("\n"); 
		query.append("		                     ALC_QTY        ," ).append("\n"); 
		query.append("		                     ALC_GREV       ," ).append("\n"); 
		query.append("		                     ALC_CM         ," ).append("\n"); 
		query.append("		                     BKG_QTY        ," ).append("\n"); 
		query.append("		                     BKG_GREV       ," ).append("\n"); 
		query.append("		                     BKG_CM         ," ).append("\n"); 
		query.append("		                     0 AS MDL_QTY" ).append("\n"); 
		query.append("		                     , CTRL_ECC_FLG, CTRL_LOC_FLG, CTRL_USA_SVC_MOD_FLG, CTRL_ACCT_FLG, CTRL_DEST_LVL_CD, USA_BKG_MOD_CD, DEST_LOC_CD" ).append("\n"); 
		query.append("		                     , ACCOUNT_CD" ).append("\n"); 
		query.append("				     ,change_code" ).append("\n"); 
		query.append("		                FROM ALC_DATA" ).append("\n"); 
		query.append("		              UNION ALL" ).append("\n"); 
		query.append("		              SELECT TRD_CD         ," ).append("\n"); 
		query.append("		                     DIR_CD         ," ).append("\n"); 
		query.append("		                     SUB_TRD_CD     ," ).append("\n"); 
		query.append("		                     RLANE_CD       ," ).append("\n"); 
		query.append("		                     OFC_CD         ," ).append("\n"); 
		query.append("		                     CUST_CTRL_CD   ," ).append("\n"); 
		query.append("		                     WK             ," ).append("\n"); 
		query.append("		                     NUM            ," ).append("\n"); 
		query.append("                             NUM_1," ).append("\n"); 
		query.append("		                     VVD            ," ).append("\n"); 
		query.append("		                     BSA            ," ).append("\n"); 
		query.append("		                     LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("		                     ACCT_FLG       ," ).append("\n"); 
		query.append("							 BSA_WGT   ," ).append("\n"); 
		query.append("                             0 AS BKG_WGT   ," ).append("\n"); 
		query.append("		                     QTA_QTY        ," ).append("\n"); 
		query.append("		                     QTA_GREV       ," ).append("\n"); 
		query.append("		                     QTA_CM         ," ).append("\n"); 
		query.append("		                     FCT_QTY        ," ).append("\n"); 
		query.append("		                     FCT_GREV       ," ).append("\n"); 
		query.append("		                     FCT_CM         ," ).append("\n"); 
		query.append("		                     ALC_QTY        ," ).append("\n"); 
		query.append("		                     ALC_GREV       ," ).append("\n"); 
		query.append("		                     ALC_CM         ," ).append("\n"); 
		query.append("		                     BKG_QTY        ," ).append("\n"); 
		query.append("		                     BKG_GREV       ," ).append("\n"); 
		query.append("		                     BKG_CM         ," ).append("\n"); 
		query.append("		                     0 AS MDL_QTY" ).append("\n"); 
		query.append("		                     , CTRL_ECC_FLG, CTRL_LOC_FLG, CTRL_USA_SVC_MOD_FLG, CTRL_ACCT_FLG, CTRL_DEST_LVL_CD, USA_BKG_MOD_CD, DEST_LOC_CD" ).append("\n"); 
		query.append("		                     , ACCOUNT_CD" ).append("\n"); 
		query.append("				     ,change_code" ).append("\n"); 
		query.append("		                FROM ALOC_CUST_DATA" ).append("\n"); 
		query.append("		              UNION ALL" ).append("\n"); 
		query.append("		              SELECT TRD_CD         ," ).append("\n"); 
		query.append("		                     DIR_CD         ," ).append("\n"); 
		query.append("		                     SUB_TRD_CD     ," ).append("\n"); 
		query.append("		                     RLANE_CD       ," ).append("\n"); 
		query.append("		                     OFC_CD         ," ).append("\n"); 
		query.append("		                     CUST_CTRL_CD   ," ).append("\n"); 
		query.append("		                     WK             ," ).append("\n"); 
		query.append("		                     NUM            ," ).append("\n"); 
		query.append("                             NUM_1," ).append("\n"); 
		query.append("		                     VVD            ," ).append("\n"); 
		query.append("		                     BSA            ," ).append("\n"); 
		query.append("		                     LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("		                     ACCT_FLG       ," ).append("\n"); 
		query.append("							 BSA_WGT   ," ).append("\n"); 
		query.append("                             BKG_WGT   , " ).append("\n"); 
		query.append("		                     QTA_QTY        ," ).append("\n"); 
		query.append("		                     QTA_GREV       ," ).append("\n"); 
		query.append("		                     QTA_CM         ," ).append("\n"); 
		query.append("		                     DECODE(PAST, 'Y', BKG_QTY , 0) AS FCT_QTY ," ).append("\n"); 
		query.append("		                     DECODE(PAST, 'Y', BKG_GREV, 0) AS FCT_GREV," ).append("\n"); 
		query.append("		                     DECODE(PAST, 'Y', BKG_CM  , 0) AS FCT_CM  ," ).append("\n"); 
		query.append("		                     ALC_QTY ," ).append("\n"); 
		query.append("		                     ALC_GREV," ).append("\n"); 
		query.append("		                     ALC_CM  ," ).append("\n"); 
		query.append("		                     BKG_QTY ," ).append("\n"); 
		query.append("		                     BKG_GREV," ).append("\n"); 
		query.append("		                     BKG_CM    ," ).append("\n"); 
		query.append("		                     0 AS MDL_QTY" ).append("\n"); 
		query.append("		                     , CTRL_ECC_FLG, CTRL_LOC_FLG, CTRL_USA_SVC_MOD_FLG, CTRL_ACCT_FLG, CTRL_DEST_LVL_CD, USA_BKG_MOD_CD, DEST_LOC_CD" ).append("\n"); 
		query.append("		                     , ACCOUNT_CD" ).append("\n"); 
		query.append("				     ,change_code" ).append("\n"); 
		query.append("		                FROM BKG_DATA" ).append("\n"); 
		query.append("		              UNION ALL" ).append("\n"); 
		query.append("		              SELECT TRD_CD         ," ).append("\n"); 
		query.append("		                     DIR_CD         ," ).append("\n"); 
		query.append("		                     SUB_TRD_CD     ," ).append("\n"); 
		query.append("		                     RLANE_CD       ," ).append("\n"); 
		query.append("		                     OFC_CD         ," ).append("\n"); 
		query.append("		                     CUST_CTRL_CD   ," ).append("\n"); 
		query.append("		                     WK             ," ).append("\n"); 
		query.append("		                     NUM            ," ).append("\n"); 
		query.append("                             NUM_1," ).append("\n"); 
		query.append("		                     VVD            ," ).append("\n"); 
		query.append("		                     BSA            ," ).append("\n"); 
		query.append("		                     LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("							 ACCT_FLG       ," ).append("\n"); 
		query.append("							 BSA_WGT   ," ).append("\n"); 
		query.append("                             0 AS BKG_WGT   ," ).append("\n"); 
		query.append("		                     0 AS QTA_QTY   ," ).append("\n"); 
		query.append("		                     0 AS QTA_GREV  ," ).append("\n"); 
		query.append("		                     0 AS QTA_CM    ," ).append("\n"); 
		query.append("		                     0 AS FCT_QTY ," ).append("\n"); 
		query.append("		                     0 AS FCT_GREV," ).append("\n"); 
		query.append("		                     0 AS FCT_CM  ," ).append("\n"); 
		query.append("		                     0 AS ALC_QTY ," ).append("\n"); 
		query.append("		                     0 AS ALC_GREV," ).append("\n"); 
		query.append("		                     0 AS ALC_CM  ," ).append("\n"); 
		query.append("		                     0 AS BKG_QTY ," ).append("\n"); 
		query.append("		                     0 AS BKG_GREV," ).append("\n"); 
		query.append("		                     0 AS BKG_CM    ," ).append("\n"); 
		query.append("		                     MDL_QTY" ).append("\n"); 
		query.append("		                     , CTRL_ECC_FLG, CTRL_LOC_FLG, CTRL_USA_SVC_MOD_FLG, CTRL_ACCT_FLG, CTRL_DEST_LVL_CD, 'OTH' USA_BKG_MOD_CD, 'XXXXX' DEST_LOC_CD" ).append("\n"); 
		query.append("		                     , 'OTHERS' ACCOUNT_CD" ).append("\n"); 
		query.append("				     ,change_code" ).append("\n"); 
		query.append("		                FROM MDL_DATA" ).append("\n"); 
		query.append("		" ).append("\n"); 
		query.append("		                -- BSA TO LOAD가 아닌 경우, BSA 정보 무조건 가져오도록 추가" ).append("\n"); 
		query.append("		              UNION ALL" ).append("\n"); 
		query.append("		              SELECT DISTINCT " ).append("\n"); 
		query.append("		                     TRD_CD    ," ).append("\n"); 
		query.append("		                     DIR_CD    ," ).append("\n"); 
		query.append("		                     SUB_TRD_CD," ).append("\n"); 
		query.append("		                     RLANE_CD  ," ).append("\n"); 
		query.append("		                     'BSA' AS OFC_CD      ," ).append("\n"); 
		query.append("		                     'C'   AS CUST_CTRL_CD," ).append("\n"); 
		query.append("		                     COST_YR||COST_WK AS WK," ).append("\n"); 
		query.append("		                     NUM       ," ).append("\n"); 
		query.append("                             NUM_1," ).append("\n"); 
		query.append("		                     VSL_CD||SKD_VOY_NO||SKD_DIR_CD AS VVD," ).append("\n"); 
		query.append("		                     BSA            ," ).append("\n"); 
		query.append("		                     LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("		                     ACCT_FLG       ," ).append("\n"); 
		query.append("							 BSA_WGT   ," ).append("\n"); 
		query.append("                             0 AS BKG_WGT   ," ).append("\n"); 
		query.append("		                     0 AS QTA_QTY   ," ).append("\n"); 
		query.append("		                     0 AS QTA_GREV  ," ).append("\n"); 
		query.append("		                     0 AS QTA_CM    ," ).append("\n"); 
		query.append("		                     0 AS FCT_QTY   ," ).append("\n"); 
		query.append("		                     0 AS FCT_GREV  ," ).append("\n"); 
		query.append("		                     0 AS FCT_CM    ," ).append("\n"); 
		query.append("		                     0 AS ALC_QTY   ," ).append("\n"); 
		query.append("		                     0 AS ALC_GREV  ," ).append("\n"); 
		query.append("		                     0 AS ALC_CM    ," ).append("\n"); 
		query.append("		                     0 AS BKG_QTY   ," ).append("\n"); 
		query.append("		                     0 AS BKG_GREV  ," ).append("\n"); 
		query.append("		                     0 AS BKG_CM    ," ).append("\n"); 
		query.append("		                     0 AS MDL_QTY" ).append("\n"); 
		query.append("		                     , CTRL_ECC_FLG, CTRL_LOC_FLG, CTRL_USA_SVC_MOD_FLG, CTRL_ACCT_FLG, CTRL_DEST_LVL_CD, 'OTH' USA_BKG_MOD_CD, 'XXXXX' DEST_LOC_CD" ).append("\n"); 
		query.append("		                     , 'OTHERS' ACCOUNT_CD" ).append("\n"); 
		query.append("				     ,change_code" ).append("\n"); 
		query.append("		                FROM MAS_MON_VVD_LV" ).append("\n"); 
		query.append("		               WHERE LOD_SPL_CNG_FLG = 'N'" ).append("\n"); 
		query.append("		                 AND BSA > 0" ).append("\n"); 
		query.append("		           )" ).append("\n"); 
		query.append("		  GROUP BY TRD_CD         ," ).append("\n"); 
		query.append("		           DIR_CD         ," ).append("\n"); 
		query.append("		           SUB_TRD_CD     ," ).append("\n"); 
		query.append("		           RLANE_CD       ," ).append("\n"); 
		query.append("		           OFC_CD         ," ).append("\n"); 
		query.append("		           CUST_CTRL_CD   ," ).append("\n"); 
		query.append("		           WK             ," ).append("\n"); 
		query.append("		           NUM            ," ).append("\n"); 
		query.append("                   NUM_1," ).append("\n"); 
		query.append("		           VVD            ," ).append("\n"); 
		query.append("		           BSA ,BSA_WGT ," ).append("\n"); 
		query.append("		           LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("		           ACCT_FLG" ).append("\n"); 
		query.append("		           , CTRL_ECC_FLG, CTRL_LOC_FLG, CTRL_USA_SVC_MOD_FLG, CTRL_ACCT_FLG, CTRL_DEST_LVL_CD, USA_BKG_MOD_CD, DEST_LOC_CD" ).append("\n"); 
		query.append("		           , ACCOUNT_CD" ).append("\n"); 
		query.append("			   ,change_code" ).append("\n"); 
		query.append("			) Z1" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", BASE_DATA1 AS (" ).append("\n"); 
		query.append("#if(${is_sha} == 'Y' || ${is_sel} == 'Y' || ${is_tyo} == 'Y')" ).append("\n"); 
		query.append("    SELECT 1 AS BSA_AVG ," ).append("\n"); 
		query.append("           Z1.TRD_CD    ," ).append("\n"); 
		query.append("           Z1.SUB_TRD_CD," ).append("\n"); 
		query.append("#if(${trade} == 'IAS')" ).append("\n"); 
		query.append("           NVL(SPC_GET_DEST_FNC(Z1.TRD_CD, Z1.SUB_TRD_CD, Z1.RLANE_CD), '-') AS DEST," ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("           SPC_GET_DEST_FNC(Z1.TRD_CD, Z1.SUB_TRD_CD, Z1.RLANE_CD) AS DEST," ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("           Z1.RLANE_CD  ," ).append("\n"); 
		query.append("           --Z1.DIR_CD    ," ).append("\n"); 
		query.append("	   change_code as dir_cd," ).append("\n"); 
		query.append("		   DECODE(Z1.OFC_CD, 'SELSC', 'SELSC', 'TYOSC', 'TYOSC', Z1.AQ_CD) AQ_CD      ," ).append("\n"); 
		query.append("           Z1.OFC_CD    ," ).append("\n"); 
		query.append("           Z1.LOD_SPL_CNG_FLG, " ).append("\n"); 
		query.append("           Z1.CUST_CTRL_CD," ).append("\n"); 
		query.append("           Z1.ACCT_FLG    ," ).append("\n"); 
		query.append("           Z1.NUM_1," ).append("\n"); 
		query.append("           " ).append("\n"); 
		query.append("#set($primate = 'new_dur')" ).append("\n"); 
		query.append("#if(${duration} == '1')" ).append("\n"); 
		query.append("	#set($new_dur = ['1'])" ).append("\n"); 
		query.append("#elseif(${duration} == '2')" ).append("\n"); 
		query.append("	#set($new_dur = ['1','2'])" ).append("\n"); 
		query.append("#elseif(${duration} == '3')" ).append("\n"); 
		query.append("	#set($new_dur = ['1','2','3'])" ).append("\n"); 
		query.append("#elseif(${duration} == '4')" ).append("\n"); 
		query.append("	#set($new_dur = ['1','2','3','4'])" ).append("\n"); 
		query.append("#elseif(${duration} == '5')" ).append("\n"); 
		query.append("	#set($new_dur = ['1','2','3','4','5'])" ).append("\n"); 
		query.append("#elseif(${duration} == '6')" ).append("\n"); 
		query.append("	#set($new_dur = ['1','2','3','4','5','6'])" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#foreach( $key in $new_dur )" ).append("\n"); 
		query.append("           DECODE(Z1.TRD_CD||Z1.LOD_SPL_CNG_FLG,'IASY',SUM(DECODE(Z1.NUM, ${key}, Z1.BKG_QTY, 0)),SUM(DECODE(Z1.NUM, ${key}, NVL(Z1.BSA, 0), 0))) AS BSA${key}, -- 20130329 추가 BSA 수송량대체" ).append("\n"); 
		query.append("           DECODE(Z1.TRD_CD||Z1.LOD_SPL_CNG_FLG,'IASY',SUM(DECODE(Z1.NUM, ${key}, Z1.BKG_WGT, 0)),SUM(DECODE(Z1.NUM, ${key}, NVL(Z1.BSA_WGT, 0), 0))) AS BSA${key}1_WGT, -- 20130329 추가 BSA 수송량대체" ).append("\n"); 
		query.append("#if(${checkVvd1} == 'Y')" ).append("\n"); 
		query.append("           MAX(DECODE(Z1.NUM, ${key}, Z1.VVD))            AS VVD${key}1," ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("           MIN(DECODE(Z1.NUM, ${key}, Z1.VVD))            AS VVD${key}1," ).append("\n"); 
		query.append("#end    " ).append("\n"); 
		query.append("           SUM(DECODE(Z1.NUM, ${key}, Z1.BKG_WGT))        AS BKG${key}1_WGT," ).append("\n"); 
		query.append("           MAX(DECODE(Z1.NUM, ${key}, Z1.VVD))            AS VVD${key}2," ).append("\n"); 
		query.append("           SUM(DECODE(Z1.NUM, ${key}, Z1.QTA_QTY, 0))     AS QTA${key}1," ).append("\n"); 
		query.append("           SUM(DECODE(Z1.NUM, ${key}, Z1.FCT_QTY, 0))     AS FCT${key}1," ).append("\n"); 
		query.append("           SUM(DECODE(Z1.NUM, ${key}, Z1.ALC_QTY, 0))     AS ALC${key}1," ).append("\n"); 
		query.append("           SUM(DECODE(Z1.NUM, ${key}, Z1.BKG_QTY, 0))     AS BKG${key}1," ).append("\n"); 
		query.append("           SUM(DECODE(Z1.NUM, ${key}, Z1.MDL_QTY, 0))     AS MDL${key}1," ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("           ''" ).append("\n"); 
		query.append("           , CTRL_ECC_FLG, CTRL_LOC_FLG, CTRL_USA_SVC_MOD_FLG, CTRL_ACCT_FLG, CTRL_DEST_LVL_CD, DECODE(USA_BKG_MOD_CD, 'X', 'OTH',USA_BKG_MOD_CD) USA_BKG_MOD_CD" ).append("\n"); 
		query.append("           , NVL(DEST_LOC_CD, 'XXXXX') DEST_LOC_CD " ).append("\n"); 
		query.append("           , ACCOUNT_CD AS ACCT_CD" ).append("\n"); 
		query.append("      FROM BASE_DATA Z1" ).append("\n"); 
		query.append("      WHERE 1=1" ).append("\n"); 
		query.append("#if(${area} != '' && ${area} != 'null')" ).append("\n"); 
		query.append("	  AND Z1.AQ_CD = @[area]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if(${is_sha} == 'Y')" ).append("\n"); 
		query.append("#if(${is_sel} == 'Y' && ${is_tyo} == 'N')" ).append("\n"); 
		query.append("      AND Z1.OFC_CD <> 'TYOSC'" ).append("\n"); 
		query.append("#elseif(${is_sel} == 'N' && ${is_tyo} == 'Y')" ).append("\n"); 
		query.append("      AND Z1.OFC_CD <> 'SELSC'" ).append("\n"); 
		query.append("#elseif(${is_sel} == 'N' && ${is_tyo} == 'N')" ).append("\n"); 
		query.append("      AND Z1.OFC_CD <> 'SELSC' AND Z1.OFC_CD <> 'TYOSC'" ).append("\n"); 
		query.append("#end	" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#elseif(${is_sha} == 'N')" ).append("\n"); 
		query.append("#if(${is_sel} == 'Y' && ${is_tyo} == 'N')" ).append("\n"); 
		query.append("      AND Z1.OFC_CD = 'SELSC'" ).append("\n"); 
		query.append("#elseif(${is_sel} == 'N' && ${is_tyo} == 'Y')" ).append("\n"); 
		query.append("      AND Z1.OFC_CD = 'TYOSC'" ).append("\n"); 
		query.append("#elseif(${is_sel} == 'Y' && ${is_tyo} == 'Y')" ).append("\n"); 
		query.append("      AND Z1.OFC_CD = 'SELSC' OR Z1.OFC_CD = 'TYOSC'" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#end	  " ).append("\n"); 
		query.append("  GROUP BY Z1.TRD_CD    , " ).append("\n"); 
		query.append("           Z1.SUB_TRD_CD," ).append("\n"); 
		query.append("           SPC_GET_DEST_FNC(Z1.TRD_CD, Z1.SUB_TRD_CD, Z1.RLANE_CD)," ).append("\n"); 
		query.append("           Z1.RLANE_CD    ," ).append("\n"); 
		query.append("          -- Z1.DIR_CD      ," ).append("\n"); 
		query.append("	  change_code," ).append("\n"); 
		query.append("           Z1.AQ_CD       ," ).append("\n"); 
		query.append("           Z1.OFC_CD      ," ).append("\n"); 
		query.append("           Z1.LOD_SPL_CNG_FLG, " ).append("\n"); 
		query.append("           Z1.ACCT_FLG    ," ).append("\n"); 
		query.append("           Z1.CUST_CTRL_CD," ).append("\n"); 
		query.append("           Z1.NUM_1" ).append("\n"); 
		query.append("           , CTRL_ECC_FLG, CTRL_LOC_FLG, CTRL_USA_SVC_MOD_FLG, CTRL_ACCT_FLG, CTRL_DEST_LVL_CD, USA_BKG_MOD_CD, DEST_LOC_CD" ).append("\n"); 
		query.append("           --, ACCT_CD" ).append("\n"); 
		query.append("           , ACCOUNT_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if(( ${is_sha} == 'N' && ${is_sel} == 'Y' ) || ( ${is_sha} == 'N' && ${is_tyo} == 'Y' ))" ).append("\n"); 
		query.append(" UNION ALL" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if(${is_sha} == 'N')" ).append("\n"); 
		query.append("    SELECT 1 AS BSA_AVG ," ).append("\n"); 
		query.append("           Z1.TRD_CD    ," ).append("\n"); 
		query.append("           Z1.SUB_TRD_CD," ).append("\n"); 
		query.append("#if(${trade} == 'IAS')" ).append("\n"); 
		query.append("           NVL(SPC_GET_DEST_FNC(Z1.TRD_CD, Z1.SUB_TRD_CD, Z1.RLANE_CD), '-') AS DEST," ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("           SPC_GET_DEST_FNC(Z1.TRD_CD, Z1.SUB_TRD_CD, Z1.RLANE_CD) AS DEST," ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("           Z1.RLANE_CD  ," ).append("\n"); 
		query.append("           Z1.DIR_CD    ," ).append("\n"); 
		query.append("		   DECODE(Z1.OFC_CD, 'SELSC', 'SELSC', 'TYOSC', 'TYOSC', Z1.AQ_CD) AQ_CD      ," ).append("\n"); 
		query.append("           Z1.OFC_CD    ," ).append("\n"); 
		query.append("           Z1.LOD_SPL_CNG_FLG, " ).append("\n"); 
		query.append("           Z1.CUST_CTRL_CD," ).append("\n"); 
		query.append("           Z1.ACCT_FLG    ," ).append("\n"); 
		query.append("           Z1.NUM_1," ).append("\n"); 
		query.append("           " ).append("\n"); 
		query.append("#set($primate = 'new_dur')" ).append("\n"); 
		query.append("#if(${duration} == '1')" ).append("\n"); 
		query.append("	#set($new_dur = ['1'])" ).append("\n"); 
		query.append("#elseif(${duration} == '2')" ).append("\n"); 
		query.append("	#set($new_dur = ['1','2'])" ).append("\n"); 
		query.append("#elseif(${duration} == '3')" ).append("\n"); 
		query.append("	#set($new_dur = ['1','2','3'])" ).append("\n"); 
		query.append("#elseif(${duration} == '4')" ).append("\n"); 
		query.append("	#set($new_dur = ['1','2','3','4'])" ).append("\n"); 
		query.append("#elseif(${duration} == '5')" ).append("\n"); 
		query.append("	#set($new_dur = ['1','2','3','4','5'])" ).append("\n"); 
		query.append("#elseif(${duration} == '6')" ).append("\n"); 
		query.append("	#set($new_dur = ['1','2','3','4','5','6'])" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#foreach( $key in $new_dur )" ).append("\n"); 
		query.append("           DECODE(Z1.TRD_CD||Z1.LOD_SPL_CNG_FLG,'IASY',SUM(DECODE(Z1.NUM, ${key}, Z1.BKG_QTY, 0)),SUM(DECODE(Z1.NUM, ${key}, NVL(Z1.BSA, 0), 0))) AS BSA${key}, -- 20130329 추가 BSA 수송량대체" ).append("\n"); 
		query.append("           DECODE(Z1.TRD_CD||Z1.LOD_SPL_CNG_FLG,'IASY',SUM(DECODE(Z1.NUM, ${key}, Z1.BKG_WGT, 0)),SUM(DECODE(Z1.NUM, ${key}, NVL(Z1.BSA_WGT, 0), 0))) AS BSA${key}1_WGT, -- 20130329 추가 BSA 수송량대체" ).append("\n"); 
		query.append("#if(${checkVvd1} == 'Y')" ).append("\n"); 
		query.append("           MAX(DECODE(Z1.NUM, ${key}, Z1.VVD))            AS VVD${key}1," ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("           MIN(DECODE(Z1.NUM, ${key}, Z1.VVD))            AS VVD${key}1," ).append("\n"); 
		query.append("#end    " ).append("\n"); 
		query.append("           SUM(DECODE(Z1.NUM, ${key}, Z1.BKG_WGT))        AS BKG${key}1_WGT," ).append("\n"); 
		query.append("           MAX(DECODE(Z1.NUM, ${key}, Z1.VVD))            AS VVD${key}2," ).append("\n"); 
		query.append("           SUM(DECODE(Z1.NUM, ${key}, Z1.QTA_QTY, 0))     AS QTA${key}1," ).append("\n"); 
		query.append("           SUM(DECODE(Z1.NUM, ${key}, Z1.FCT_QTY, 0))     AS FCT${key}1," ).append("\n"); 
		query.append("           SUM(DECODE(Z1.NUM, ${key}, Z1.ALC_QTY, 0))     AS ALC${key}1," ).append("\n"); 
		query.append("           SUM(DECODE(Z1.NUM, ${key}, Z1.BKG_QTY, 0))     AS BKG${key}1," ).append("\n"); 
		query.append("           SUM(DECODE(Z1.NUM, ${key}, Z1.MDL_QTY, 0))     AS MDL${key}1," ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("           ''" ).append("\n"); 
		query.append("           , CTRL_ECC_FLG, CTRL_LOC_FLG, CTRL_USA_SVC_MOD_FLG, CTRL_ACCT_FLG, CTRL_DEST_LVL_CD, DECODE(USA_BKG_MOD_CD, 'X', 'OTH',USA_BKG_MOD_CD) USA_BKG_MOD_CD" ).append("\n"); 
		query.append("           , NVL(DEST_LOC_CD, 'XXXXX') DEST_LOC_CD " ).append("\n"); 
		query.append("           , ACCOUNT_CD AS ACCT_CD" ).append("\n"); 
		query.append("      FROM BASE_DATA Z1" ).append("\n"); 
		query.append("      WHERE 1=1" ).append("\n"); 
		query.append("      AND Z1.AQ_CD <> 'SHARC' AND Z1.AQ_CD <> 'SZPDC'" ).append("\n"); 
		query.append("#if(${area} != '' && ${area} != 'null')" ).append("\n"); 
		query.append("	  AND Z1.AQ_CD = @[area]" ).append("\n"); 
		query.append("#end	  " ).append("\n"); 
		query.append("  GROUP BY Z1.TRD_CD    ," ).append("\n"); 
		query.append("           Z1.SUB_TRD_CD," ).append("\n"); 
		query.append("           SPC_GET_DEST_FNC(Z1.TRD_CD, Z1.SUB_TRD_CD, Z1.RLANE_CD)," ).append("\n"); 
		query.append("           Z1.RLANE_CD    ," ).append("\n"); 
		query.append("           Z1.DIR_CD      ," ).append("\n"); 
		query.append("           Z1.AQ_CD       ," ).append("\n"); 
		query.append("           Z1.OFC_CD      ," ).append("\n"); 
		query.append("           Z1.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           Z1.ACCT_FLG    ," ).append("\n"); 
		query.append("           Z1.CUST_CTRL_CD," ).append("\n"); 
		query.append("           Z1.NUM_1" ).append("\n"); 
		query.append("           , CTRL_ECC_FLG, CTRL_LOC_FLG, CTRL_USA_SVC_MOD_FLG, CTRL_ACCT_FLG, CTRL_DEST_LVL_CD, USA_BKG_MOD_CD, DEST_LOC_CD" ).append("\n"); 
		query.append("           , ACCOUNT_CD" ).append("\n"); 
		query.append("#end " ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("  SELECT Z4.DEST        ," ).append("\n"); 
		query.append("         Z4.TRD_CD      ," ).append("\n"); 
		query.append("         Z4.SUB_TRD_CD  ," ).append("\n"); 
		query.append("         Z4.RLANE_CD    ," ).append("\n"); 
		query.append("         Z4.DIR_CD      ," ).append("\n"); 
		query.append("         Z4.AQ_CD       ," ).append("\n"); 
		query.append("         DECODE(Z4.OFC_CD, 'DXBSC', 'DXBME', Z4.OFC_CD) OFC_CD      ," ).append("\n"); 
		query.append("         '' AS SUB_OFC_CD," ).append("\n"); 
		query.append("         DECODE(T2, 'Y', 'Z', Z4.CUST_CTRL_CD) CUST_CTRL_CD," ).append("\n"); 
		query.append("         DECODE(USA_BKG_MOD_CD, 'OTH', 'OTHERS', USA_BKG_MOD_CD) USA_BKG_MOD_CD," ).append("\n"); 
		query.append("         NVL(Z4.ACCT_CD, '+') ACCT_CD1," ).append("\n"); 
		query.append("         NVL(Z4.ACCT_NM, '+') ACCT_CD," ).append("\n"); 
		query.append("         DECODE(DEST_LOC_CD, 'XXXXX', 'OTHERS', DEST_LOC_CD) DEST_LOC_CD," ).append("\n"); 
		query.append("         Z4.GID         ," ).append("\n"); 
		query.append("#foreach( $key in $new_dur )" ).append("\n"); 
		query.append("         Z4.VVD${key}    ," ).append("\n"); 
		query.append("         Z4.BSA${key}    ," ).append("\n"); 
		query.append("         DECODE(" ).append("\n"); 
		query.append("                 ROW_NUMBER() OVER (PARTITION BY " ).append("\n"); 
		query.append("#if(${trade} == 'IAS')" ).append("\n"); 
		query.append("                    Z4.DEST," ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                            Z4.TRD_CD, Z4.SUB_TRD_CD, Z4.RLANE_CD, Z4.DIR_CD, Z4.AQ_CD, Z4.VVD1, Z4.OFC_CD, DECODE(Z4.T2, 'Y', 'Z', NVL(Z4.CUST_CTRL_CD,0)) " ).append("\n"); 
		query.append("                                        ORDER BY DECODE(Z4.T2, 'Y', 'Z', NVL(Z4.CUST_CTRL_CD,0))" ).append("\n"); 
		query.append("                                                ,DECODE(Z4.T2, 'N', USA_BKG_MOD_CD, DECODE(USA_BKG_MOD_CD,'+','Z',USA_BKG_MOD_CD))" ).append("\n"); 
		query.append("                                                ,DECODE(Z4.T2, 'N', ACCT_CD,        DECODE(ACCT_CD,'+','Z',ACCT_CD))" ).append("\n"); 
		query.append("                                                ,DECODE(Z4.T2, 'N', DEST_LOC_CD,    DECODE(DEST_LOC_CD,'+','Z',DEST_LOC_CD)) )" ).append("\n"); 
		query.append("                ,1 , DECODE(CUST_CTRL_CD, NULL, Z4.QTA${key}1, 'C', (Z4.QTA${key}1-Z4.MDL_TTL${key}1), Z4.MDL${key}1)" ).append("\n"); 
		query.append("                ,0" ).append("\n"); 
		query.append("                ) AS QTA${key}1,         " ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("         Z4.FCT${key}1 ," ).append("\n"); 
		query.append("         Z4.ALC${key}1 ," ).append("\n"); 
		query.append("         Z4.BKG${key}1 ," ).append("\n"); 
		query.append("		 CASE WHEN (BKG${key}1_WGT > 0 AND BSA${key}1_WGT > 0) THEN TO_CHAR( (BKG${key}1_WGT/BSA${key}1_WGT)*100 ,'FM990.00')||'%' ELSE '0%' END  AS PRF${key}1," ).append("\n"); 
		query.append("         BKG${key}1_WGT as BKGW${key} , BSA${key}1_WGT as BSAW${key} , " ).append("\n"); 
		query.append("         DECODE(CUST_CTRL_CD, NULL, Z4.PREF${key}1, 'C', ROUND(DECODE(Z4.QTA${key}1-Z4.MDL_TTL${key}1, 0, 0, Z4.FCT${key}1 * 100 / (Z4.QTA${key}1-Z4.MDL_TTL${key}1)),0) || '%', GPREF${key}1 ) AS PREF${key}1," ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("         DECODE(CUST_CTRL_CD, NULL, DECODE(T2, 'Y', 'GUIDE', ''), DECODE(Z4.OFC_CD, '+', 'GUIDE', '')) AS T" ).append("\n"); 
		query.append("    FROM (" ).append("\n"); 
		query.append("            SELECT /*+ USE_MERGE(Z4 Z3) */" ).append("\n"); 
		query.append("                   Z3.DEST        ," ).append("\n"); 
		query.append("                   Z3.BSA_AVG     ," ).append("\n"); 
		query.append("                   Z3.TRD_CD      ," ).append("\n"); 
		query.append("                   Z3.SUB_TRD_CD  ," ).append("\n"); 
		query.append("                   Z3.RLANE_CD    ," ).append("\n"); 
		query.append("                   Z3.DIR_CD      ," ).append("\n"); 
		query.append("                   Z3.AQ_CD       ," ).append("\n"); 
		query.append("                   Z3.OFC_CD      ," ).append("\n"); 
		query.append("                   Z3.CUST_CTRL_CD," ).append("\n"); 
		query.append("                   Z3.GID         ," ).append("\n"); 
		query.append("                   Z3.NUM_1," ).append("\n"); 
		query.append("#foreach( $key in $new_dur )" ).append("\n"); 
		query.append("                   Z3.VVD${key}   ," ).append("\n"); 
		query.append("                   Z3.BSA${key}   ," ).append("\n"); 
		query.append("                   CASE WHEN Z3.SUB_TRD_CD = 'TOTAL' AND Z3.RLANE_CD = 'TOTAL' AND Z3.DIR_CD = 'TOTAL' THEN" ).append("\n"); 
		query.append("                        MAX(Z3.QTA${key}1) OVER(PARTITION BY Z3.DEST, Z3.TRD_CD, Z3.SUB_TRD_CD, Z3.RLANE_CD, Z3.DIR_CD, Z3.AQ_CD, Z3.OFC_CD, Z3.CUST_CTRL_CD, Z3.GID) " ).append("\n"); 
		query.append("                   ELSE" ).append("\n"); 
		query.append("                        MAX(Z3.QTA${key}1) OVER(PARTITION BY Z3.DEST, Z3.TRD_CD, Z3.SUB_TRD_CD, Z3.RLANE_CD, Z3.DIR_CD, Z3.AQ_CD, Z3.OFC_CD, Z3.CUST_CTRL_CD, Z3.GID, Z3.VVD${key})                   " ).append("\n"); 
		query.append("                   END AS QTA${key}1," ).append("\n"); 
		query.append("                   Z3.FCT${key}1," ).append("\n"); 
		query.append("                   Z3.ALC${key}1," ).append("\n"); 
		query.append("                   Z3.BKG${key}1,BSA${key}1_WGT,BKG${key}1_WGT, " ).append("\n"); 
		query.append("                   Z3.MDL${key}1, " ).append("\n"); 
		query.append("                   MAX(Z3.MDL${key}1) OVER (PARTITION BY Z3.DEST, Z3.TRD_CD, Z3.SUB_TRD_CD, Z3.RLANE_CD, Z3.DIR_CD, Z3.AQ_CD, Z3.OFC_CD) AS MDL_TTL${key}1," ).append("\n"); 
		query.append("                   ROUND(DECODE(MAX(Z3.QTA${key}1) OVER (PARTITION BY Z3.DEST, Z3.TRD_CD, Z3.SUB_TRD_CD, Z3.RLANE_CD, Z3.DIR_CD, Z3.AQ_CD, Z3.OFC_CD, Z3.CUST_CTRL_CD, Z3.GID, Z3.VVD${key}), 0, " ).append("\n"); 
		query.append("                                0, " ).append("\n"); 
		query.append("                                Z3.FCT${key}1 * 100 / MAX(Z3.QTA${key}1) OVER (PARTITION BY Z3.DEST, Z3.TRD_CD, Z3.SUB_TRD_CD, Z3.RLANE_CD, Z3.DIR_CD, Z3.AQ_CD, Z3.OFC_CD, Z3.CUST_CTRL_CD, Z3.GID, Z3.VVD${key})" ).append("\n"); 
		query.append("                                ), 1)||'%' AS PREF${key}1," ).append("\n"); 
		query.append("                               " ).append("\n"); 
		query.append("                   DECODE(CUST_CTRL_CD, NULL, 0, ROUND(DECODE(Z3.MDL${key}1, 0, 0, Z3.FCT${key}1 * 100 / Z3.MDL${key}1), 1)) || '%' AS GPREF${key}1," ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                   '' AS T, T2" ).append("\n"); 
		query.append("                   , USA_BKG_MOD_CD, ACCT_CD" ).append("\n"); 
		query.append("                   , CASE WHEN ACCT_CD = '+' THEN ''" ).append("\n"); 
		query.append("                     WHEN ACCT_CD = 'OTHERS' THEN 'OTHERS'           " ).append("\n"); 
		query.append("                    WHEN LENGTH(TRIM(TRANSLATE(ACCT_CD, '1234567890', '          '))) = 2 THEN " ).append("\n"); 
		query.append("                    (SELECT CUST_LGL_ENG_NM " ).append("\n"); 
		query.append("                        FROM MDM_CUSTOMER" ).append("\n"); 
		query.append("                        WHERE CUST_CNT_CD||LPAD(CUST_SEQ, 6, '0') = ACCT_CD ) " ).append("\n"); 
		query.append("                    ELSE " ).append("\n"); 
		query.append("                    NVL((" ).append("\n"); 
		query.append("                    -- SC CASE NAME " ).append("\n"); 
		query.append("                        SELECT CUST_LGL_ENG_NM" ).append("\n"); 
		query.append("                        FROM    PRI_SP_HDR    HD  ," ).append("\n"); 
		query.append("                                PRI_SP_MN     MN  ," ).append("\n"); 
		query.append("                                PRI_SP_CTRT_PTY AC, " ).append("\n"); 
		query.append("                                MDM_CUSTOMER A" ).append("\n"); 
		query.append("                        WHERE   HD.SC_NO        = ACCT_CD" ).append("\n"); 
		query.append("                        AND     MN.PROP_NO      = HD.PROP_NO" ).append("\n"); 
		query.append("                        AND     MN.PROP_STS_CD  = 'F'    -- Filed만 B/L적용 가능 " ).append("\n"); 
		query.append("                        AND     AC.PROP_NO      = MN.PROP_NO" ).append("\n"); 
		query.append("                        AND     AC.AMDT_SEQ     = MN.AMDT_SEQ" ).append("\n"); 
		query.append("                        AND     AC.PRC_CTRT_PTY_TP_CD = 'C'" ).append("\n"); 
		query.append("                        AND     AC.AMDT_SEQ   = (SELECT MAX(AMDT_SEQ)" ).append("\n"); 
		query.append("                                                   FROM PRI_SP_MN N_MN" ).append("\n"); 
		query.append("                                                  WHERE N_MN.PROP_NO = HD.PROP_NO" ).append("\n"); 
		query.append("					                                AND	N_MN.PROP_STS_CD  = 'F'" ).append("\n"); 
		query.append("                                                )" ).append("\n"); 
		query.append("                        AND A.CUST_CNT_CD = AC.CUST_CNT_CD " ).append("\n"); 
		query.append("                        AND A.CUST_SEQ = AC.CUST_SEQ" ).append("\n"); 
		query.append("                        UNION ALL" ).append("\n"); 
		query.append("                        SELECT  CUST_LGL_ENG_NM" ).append("\n"); 
		query.append("                        FROM    PRI_RP_HDR    HD  ," ).append("\n"); 
		query.append("                                PRI_RP_MN     MN  ," ).append("\n"); 
		query.append("                                MDM_CUSTOMER  A" ).append("\n"); 
		query.append("                        WHERE   HD.RFA_NO        = ACCT_CD" ).append("\n"); 
		query.append("                        AND     MN.PROP_NO       = HD.PROP_NO" ).append("\n"); 
		query.append("                        AND     MN.PROP_STS_CD   = 'A'        /*상수*/" ).append("\n"); 
		query.append("                        AND     MN.AMDT_SEQ      = (SELECT MAX(AMDT_SEQ)" ).append("\n"); 
		query.append("                                                      FROM PRI_RP_MN N_MN" ).append("\n"); 
		query.append("                                                     WHERE N_MN.PROP_NO = HD.PROP_NO" ).append("\n"); 
		query.append("                                                       AND N_MN.PROP_STS_CD   = 'A'  )" ).append("\n"); 
		query.append("                        AND     A.CUST_CNT_CD = MN.CTRT_CUST_CNT_CD " ).append("\n"); 
		query.append("                        AND A.CUST_SEQ = MN.CTRT_CUST_SEQ" ).append("\n"); 
		query.append("                        AND     ROWNUM <= 1" ).append("\n"); 
		query.append("                   ), ACCT_CD)" ).append("\n"); 
		query.append("                 END AS ACCT_NM, DEST_LOC_CD" ).append("\n"); 
		query.append("              FROM (" ).append("\n"); 
		query.append("                      SELECT " ).append("\n"); 
		query.append("#if(${trade} == 'IAS')" ).append("\n"); 
		query.append("                             DENSE_RANK() OVER (ORDER BY DEST, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD" ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("                             DENSE_RANK() OVER (ORDER BY TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if(${checkVvd1} == 'Y')" ).append("\n"); 
		query.append("                                                         ,NUM_1" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                                                ) AS GID," ).append("\n"); 
		query.append("                             NVL(( SELECT SUM(BSA) / COUNT(1) AS BSA" ).append("\n"); 
		query.append("                                     FROM MAS_MON_VVD_LV L" ).append("\n"); 
		query.append("                                    WHERE L.SUB_TRD_CD = Z2.SUB_TRD_CD" ).append("\n"); 
		query.append("                                      AND L.RLANE_CD   = Z2.RLANE_CD" ).append("\n"); 
		query.append("                                ), 0) AS BSA_AVG," ).append("\n"); 
		query.append("#if(${trade} == 'IAS')" ).append("\n"); 
		query.append("                             NVL(Z2.DEST, ' ') AS DEST," ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("                             MAX(NVL(Z2.DEST, ' ')) AS DEST," ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                             NVL(Z2.TRD_CD    , 'TOTAL') AS TRD_CD    ," ).append("\n"); 
		query.append("                             NVL(Z2.SUB_TRD_CD, 'TOTAL') AS SUB_TRD_CD," ).append("\n"); 
		query.append("                             NVL(Z2.RLANE_CD  , 'TOTAL') AS RLANE_CD  ," ).append("\n"); 
		query.append("                             NVL(Z2.DIR_CD    , 'TOTAL') AS DIR_CD    ," ).append("\n"); 
		query.append("                             NVL(Z2.AQ_CD     , '+')     AS AQ_CD     ," ).append("\n"); 
		query.append("                             NVL(Z2.OFC_CD    , '+')     AS OFC_CD    ," ).append("\n"); 
		query.append("                             Z2.CUST_CTRL_CD," ).append("\n"); 
		query.append("#if(${checkVvd1} == 'Y')" ).append("\n"); 
		query.append("                             Z2.NUM_1 ," ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("                             '' NUM_1," ).append("\n"); 
		query.append("#end                             " ).append("\n"); 
		query.append("#foreach( $key in $new_dur )" ).append("\n"); 
		query.append("                             DECODE(Z2.TRD_CD||MAX(Z2.LOD_SPL_CNG_FLG),'IASY',SUM(Z2.BKG${key}1),MAX(Z2.BSA${key})) AS BSA${key}," ).append("\n"); 
		query.append("							 DECODE(Z2.TRD_CD||MAX(Z2.LOD_SPL_CNG_FLG),'IASY',SUM(Z2.BKG${key}1_WGT),MAX(Z2.BSA${key}1_WGT)) AS BSA${key}1_WGT," ).append("\n"); 
		query.append("                             MAX(DECODE((NVL(Z2.VVD${key}1, ' ')), (NVL(Z2.VVD${key}2, ' ')), Z2.VVD${key}1, Z2.VVD${key}2||'/'||Z2.VVD${key}1)) AS VVD${key}," ).append("\n"); 
		query.append("                             SUM(Z2.QTA${key}1) AS QTA${key}1," ).append("\n"); 
		query.append("                             SUM(Z2.FCT${key}1) AS FCT${key}1," ).append("\n"); 
		query.append("                             SUM(Z2.ALC${key}1) AS ALC${key}1," ).append("\n"); 
		query.append("                             SUM(Z2.BKG${key}1) AS BKG${key}1," ).append("\n"); 
		query.append("							 SUM(Z2.BKG${key}1_WGT) AS BKG${key}1_WGT," ).append("\n"); 
		query.append("                             SUM(Z2.MDL${key}1) AS MDL${key}1," ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                             '' T" ).append("\n"); 
		query.append("                             , NVL(USA_BKG_MOD_CD, '+') USA_BKG_MOD_CD, NVL(ACCT_CD, '+') ACCT_CD, NVL(DEST_LOC_CD, '+') DEST_LOC_CD" ).append("\n"); 
		query.append("                            , CASE WHEN OFC_CD IS NULL AND CUST_CTRL_CD IS NULL AND " ).append("\n"); 
		query.append("                                ( " ).append("\n"); 
		query.append("                                    (USA_BKG_MOD_CD IS NOT NULL AND ACCT_CD IS NULL AND DEST_LOC_CD IS NULL) OR " ).append("\n"); 
		query.append("                                    (ACCT_CD IS NOT NULL AND USA_BKG_MOD_CD IS NULL AND DEST_LOC_CD IS NULL) OR " ).append("\n"); 
		query.append("                                    (DEST_LOC_CD IS NOT NULL AND ACCT_CD IS NULL AND USA_BKG_MOD_CD IS NULL)" ).append("\n"); 
		query.append("                                ) THEN 'Y'" ).append("\n"); 
		query.append("                            ELSE 'N' END AS T2" ).append("\n"); 
		query.append("                        FROM BASE_DATA1 Z2" ).append("\n"); 
		query.append("                    GROUP BY" ).append("\n"); 
		query.append("#if(${trade} == 'IAS')" ).append("\n"); 
		query.append("#if (${subtrade1} == '')" ).append("\n"); 
		query.append("                              Z2.TRD_CD  ," ).append("\n"); 
		query.append("                              CUBE(Z2.SUB_TRD_CD, Z2.DEST, Z2.RLANE_CD, Z2.DIR_CD, Z2.AQ_CD, Z2.OFC_CD, Z2.CUST_CTRL_CD, USA_BKG_MOD_CD, ACCT_CD, DEST_LOC_CD" ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("                              Z2.TRD_CD    ," ).append("\n"); 
		query.append("                              Z2.SUB_TRD_CD," ).append("\n"); 
		query.append("                              CUBE(Z2.RLANE_CD, Z2.DEST, Z2.DIR_CD, Z2.AQ_CD, Z2.OFC_CD, Z2.CUST_CTRL_CD, USA_BKG_MOD_CD, ACCT_CD, DEST_LOC_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if(${checkVvd1} == 'Y')" ).append("\n"); 
		query.append("                                   ,NUM_1" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                                  )" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                      HAVING     (NOT (AQ_CD IS NULL AND OFC_CD IS NOT NULL))" ).append("\n"); 
		query.append("                             AND (NOT (RLANE_CD IS NOT NULL AND DIR_CD IS NULL))" ).append("\n"); 
		query.append("                             AND (NOT (SUB_TRD_CD IS NOT NULL AND RLANE_CD IS NULL AND DIR_CD IS NOT NULL AND AQ_CD IS NOT NULL))" ).append("\n"); 
		query.append("                             AND (NOT (SUB_TRD_CD IS NULL AND RLANE_CD IS NOT NULL))" ).append("\n"); 
		query.append("                             AND (NOT (SUB_TRD_CD IS NULL AND RLANE_CD IS NULL AND DIR_CD IS NOT NULL AND AQ_CD IS NOT NULL))" ).append("\n"); 
		query.append("                             AND (NOT (DEST IS NOT NULL AND RLANE_CD IS NULL AND DIR_CD IS NOT NULL AND AQ_CD IS NOT NULL))" ).append("\n"); 
		query.append("                             AND (NOT (DEST IS NULL AND RLANE_CD IS NOT NULL))" ).append("\n"); 
		query.append("                             AND (NOT (SUB_TRD_CD IS NULL AND RLANE_CD IS NULL AND DIR_CD IS NOT NULL AND AQ_CD IS NOT NULL))" ).append("\n"); 
		query.append("                             AND (NOT (SUB_TRD_CD IS NULL AND DEST IS NOT NULL))" ).append("\n"); 
		query.append("                             AND (NOT (TRD_CD = 'IAS' AND SUB_TRD_CD = 'IP' AND DEST IS NOT NULL AND RLANE_CD IS NULL))" ).append("\n"); 
		query.append("                             AND (NOT (TRD_CD = 'IAS' AND SUB_TRD_CD = 'IA' AND NVL(DEST, ' ') = '-' AND RLANE_CD IS NULL))" ).append("\n"); 
		query.append("                             AND (NOT (MAX(ACCT_FLG) = 'N' AND CUST_CTRL_CD IS NOT NULL))" ).append("\n"); 
		query.append("                             AND (NOT (MAX(ACCT_FLG) = 'Y' AND AQ_CD IS NOT NULL AND OFC_CD IS NULL AND CUST_CTRL_CD IS NOT NULL))" ).append("\n"); 
		query.append("                             AND (NOT (USA_BKG_MOD_CD IS NULL AND (ACCT_CD IS NOT NULL OR DEST_LOC_CD IS NOT NULL)))" ).append("\n"); 
		query.append("                             AND (NOT (ACCT_CD IS NULL AND DEST_LOC_CD IS NOT NULL))" ).append("\n"); 
		query.append("                             AND (NOT (CUST_CTRL_CD IS NULL AND USA_BKG_MOD_CD IS NOT NULL))" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#else" ).append("\n"); 
		query.append("	#if (${subtrade1} == '')" ).append("\n"); 
		query.append("                              Z2.TRD_CD  ," ).append("\n"); 
		query.append("                              CUBE(Z2.SUB_TRD_CD, Z2.RLANE_CD, Z2.DIR_CD, Z2.AQ_CD, Z2.OFC_CD, Z2.CUST_CTRL_CD, USA_BKG_MOD_CD, DEST_LOC_CD, ACCT_CD" ).append("\n"); 
		query.append("	#else" ).append("\n"); 
		query.append("                              Z2.TRD_CD    ," ).append("\n"); 
		query.append("                              Z2.SUB_TRD_CD," ).append("\n"); 
		query.append("                              CUBE(Z2.RLANE_CD, Z2.DIR_CD, Z2.AQ_CD, Z2.OFC_CD, Z2.CUST_CTRL_CD, USA_BKG_MOD_CD, DEST_LOC_CD, ACCT_CD" ).append("\n"); 
		query.append("	#end" ).append("\n"); 
		query.append("#if(${checkVvd1} == 'Y')" ).append("\n"); 
		query.append("                                   ,NUM_1" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                                  )" ).append("\n"); 
		query.append("                      HAVING     (NOT (AQ_CD IS NULL AND OFC_CD IS NOT NULL))" ).append("\n"); 
		query.append("                             AND (NOT (RLANE_CD IS NOT NULL AND DIR_CD IS NULL))" ).append("\n"); 
		query.append("                             AND (NOT (SUB_TRD_CD IS NOT NULL AND RLANE_CD IS NULL AND DIR_CD IS NOT NULL AND AQ_CD IS NOT NULL))" ).append("\n"); 
		query.append("                             AND (NOT (SUB_TRD_CD IS NULL AND RLANE_CD IS NOT NULL))" ).append("\n"); 
		query.append("                             AND (NOT (SUB_TRD_CD IS NULL AND RLANE_CD IS NULL AND DIR_CD IS NOT NULL AND AQ_CD IS NOT NULL))" ).append("\n"); 
		query.append("                             AND (NOT (MAX(ACCT_FLG) = 'N' AND CUST_CTRL_CD IS NOT NULL))" ).append("\n"); 
		query.append("                             AND (NOT (MAX(ACCT_FLG) = 'Y' AND AQ_CD IS NOT NULL AND OFC_CD IS NULL AND CUST_CTRL_CD IS NOT NULL))" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                             AND (( 1=1" ).append("\n"); 
		query.append("                                 AND (NOT (CUST_CTRL_CD IS NULL AND USA_BKG_MOD_CD IS NOT NULL))" ).append("\n"); 
		query.append("                                 AND (NOT (USA_BKG_MOD_CD IS NULL AND ACCT_CD IS NOT NULL))" ).append("\n"); 
		query.append("                                 AND (NOT (ACCT_CD IS NULL AND DEST_LOC_CD IS NOT NULL))" ).append("\n"); 
		query.append("                                 AND (NOT (AQ_CD IS NULL AND OFC_CD IS NULL AND CUST_CTRL_CD IS NOT NULL AND USA_BKG_MOD_CD IS NOT NULL))" ).append("\n"); 
		query.append("                                 AND (NOT (AQ_CD IS NULL AND OFC_CD IS NULL AND CUST_CTRL_CD IS NULL AND USA_BKG_MOD_CD IS NULL AND ACCT_CD IS NOT NULL))" ).append("\n"); 
		query.append("                                 AND (NOT (AQ_CD IS NULL AND OFC_CD IS NULL AND CUST_CTRL_CD IS NULL AND USA_BKG_MOD_CD IS NULL AND ACCT_CD IS NULL AND DEST_LOC_CD IS NOT NULL))" ).append("\n"); 
		query.append("                             ) OR ( 1=1                          " ).append("\n"); 
		query.append("                                 AND (NOT (RLANE_CD IS NOT NULL AND AQ_CD IS NULL AND OFC_CD IS NULL AND CUST_CTRL_CD IS NULL AND USA_BKG_MOD_CD IS NOT NULL AND (ACCT_CD IS NOT NULL OR DEST_LOC_CD IS NOT NULL)))" ).append("\n"); 
		query.append("                                 AND (NOT (RLANE_CD IS NOT NULL AND AQ_CD IS NULL AND OFC_CD IS NULL AND CUST_CTRL_CD IS NULL AND ACCT_CD IS NOT NULL AND (USA_BKG_MOD_CD IS NOT NULL OR DEST_LOC_CD IS NOT NULL)))" ).append("\n"); 
		query.append("                                 AND (NOT (RLANE_CD IS NOT NULL AND AQ_CD IS NULL AND OFC_CD IS NULL AND CUST_CTRL_CD IS NULL AND DEST_LOC_CD IS NOT NULL AND (ACCT_CD IS NOT NULL OR USA_BKG_MOD_CD IS NOT NULL)))" ).append("\n"); 
		query.append("                                 AND OFC_CD IS NULL AND CUST_CTRL_CD IS NULL AND" ).append("\n"); 
		query.append("                                    ( " ).append("\n"); 
		query.append("                                        (USA_BKG_MOD_CD IS NOT NULL AND ACCT_CD IS NULL AND DEST_LOC_CD IS NULL) OR " ).append("\n"); 
		query.append("                                        (ACCT_CD IS NOT NULL AND USA_BKG_MOD_CD IS NULL AND DEST_LOC_CD IS NULL) OR " ).append("\n"); 
		query.append("                                        (DEST_LOC_CD IS NOT NULL AND ACCT_CD IS NULL AND USA_BKG_MOD_CD IS NULL)" ).append("\n"); 
		query.append("                                    )" ).append("\n"); 
		query.append("                             ))" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if(${checkVvd1} == 'Y')" ).append("\n"); 
		query.append("                            AND (NOT (TRD_CD IS NOT NULL AND SUB_TRD_CD IS NOT NULL AND RLANE_CD IS NOT NULL AND DIR_CD IS NOT NULL AND NUM_1 IS     NULL))" ).append("\n"); 
		query.append("                            AND (NOT (TRD_CD IS NOT NULL AND SUB_TRD_CD IS NOT NULL AND RLANE_CD IS     NULL AND DIR_CD IS NOT NULL AND NUM_1 IS NOT NULL))" ).append("\n"); 
		query.append("                            AND (NOT (TRD_CD IS NOT NULL AND SUB_TRD_CD IS NOT NULL AND RLANE_CD IS     NULL AND DIR_CD IS     NULL AND NUM_1 IS NOT NULL))" ).append("\n"); 
		query.append("                            AND (NOT (TRD_CD IS NOT NULL AND SUB_TRD_CD IS     NULL AND RLANE_CD IS     NULL AND DIR_CD IS NOT NULL AND NUM_1 IS NOT NULL))" ).append("\n"); 
		query.append("                            AND (NOT (TRD_CD IS NOT NULL AND SUB_TRD_CD IS     NULL AND RLANE_CD IS     NULL AND DIR_CD IS     NULL AND NUM_1 IS NOT NULL))" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                                  " ).append("\n"); 
		query.append("                   ) Z3" ).append("\n"); 
		query.append("         ) Z4 " ).append("\n"); 
		query.append("   WHERE Z4.AQ_CD <> 'BSA'" ).append("\n"); 
		query.append("   AND NOT ( Z4.AQ_CD <> '+' AND Z4.OFC_CD <> '+' AND USA_BKG_MOD_CD <> '+'  AND (NVL(Z4.ACCT_NM, '+') = '+' OR DEST_LOC_CD='+'))  " ).append("\n"); 
		query.append("ORDER BY DECODE(SUB_TRD_CD, 'TOTAL', '00', SUB_TRD_CD) DESC," ).append("\n"); 
		query.append("         DECODE(DEST, 'M.E', 1, 'AU', 2, 'IN', 3, 'TH & VN', 4, 'ID', 5, 'CN & JP', 6, 'MY & BD', 7, 'AF', 8, 'PH', 9, 'RU', 10, '-', 11)," ).append("\n"); 
		query.append("         BSA_AVG DESC," ).append("\n"); 
		query.append("         DECODE(RLANE_CD, 'TOTAL', 'ZZZZZ', RLANE_CD)," ).append("\n"); 
		query.append("         DECODE(DIR_CD  , 'TOTAL', DECODE(AQ_CD, '+', DECODE(CUST_CTRL_CD, NULL, '0', '2'), '1'), DIR_CD)," ).append("\n"); 
		query.append("         NUM_1," ).append("\n"); 
		query.append("         DECODE(AQ_CD   , 'TOTAL', DECODE(RLANE_CD, 'TOTAL', 'ZZZZZ', '00000'))," ).append("\n"); 
		query.append("         DECODE(AQ_CD   , '+', DECODE(OFC_CD, '+', DECODE(CUST_CTRL_CD, NULL, '0', '9'), '10'), '11')," ).append("\n"); 
		query.append("         DECODE(AQ_CD   , NULL, '0', 'SELSC', '1', 'TYOSC', '2', 'SHADNC', '3', 'SZPDC','4','SHARC', '5', 'DXBME', '6', 'SINRS', '7','TAIWAN', '8','SHADKJ', '9', 'SINDSA', '10', 'SINDPI', '11', 'RUSIA', '12', AQ_CD)," ).append("\n"); 
		query.append("         DECODE(OFC_CD  , 'TOTAL', '00000', OFC_CD)," ).append("\n"); 
		query.append("         DECODE(T2, 'Y', 'GUIDE', T) DESC," ).append("\n"); 
		query.append("         DECODE(T2, 'Y', 'Z', NVL(CUST_CTRL_CD, '0'))" ).append("\n"); 
		query.append("		 , DECODE(T2, 'Y', DECODE(USA_BKG_MOD_CD, '+', 'Z', USA_BKG_MOD_CD), USA_BKG_MOD_CD)" ).append("\n"); 
		query.append("		 , DECODE(ACCT_CD, '+', 'ZZZ', 'OTHERS', 'ZZ', ACCT_CD)" ).append("\n"); 
		query.append("         , DECODE(T2, 'Y', DECODE(DEST_LOC_CD, '+', 'Z', DEST_LOC_CD), DEST_LOC_CD)" ).append("\n"); 
		query.append("/*" ).append("\n"); 
		query.append("2012.08.21 전상화 [CHM-201219745]    09012001 사용자의 경우, HAMDEB와 동일한 권한을 가지도록 예외처리" ).append("\n"); 
		query.append("2013.01.15 최윤성 [CHM-201322502-01] SPC 프로젝트 - 성수기 선복운영 개선을 위한 T/F추진" ).append("\n"); 
		query.append("2013.02.22 김시몬[CHM-201323235-01] 제목 : WAX 노선 Dest. 반영 건, 작업 내용 : WAX 노선은 Dest. 를 AU 로 집계되도록 보완, WAXIA 의 경우 Direction 변경(E=> W, W=> E)" ).append("\n"); 
		query.append("2013.02.28 김시몬[CHM-201322502-01] 제목 : 성수기 선복운영 개선을 위한 T/F추진, 작업 내용 : BKG실적 가져올때 MDM_DTL_REV_LANE 테이블과 연계시 TRD_CD를 체크하도록 수정" ).append("\n"); 
		query.append("2013.04.02 김시몬[CHM-201322502-01] ISA TRADE인 경우 COA정보를 이용하여 BSA를 BKG 수송량으로 대체한는 로직추가" ).append("\n"); 
		query.append("2013.04.15 [CHM-201322502-01] SPC 프로젝트 - BSA 오류 수정" ).append("\n"); 
		query.append("2013.06.13 진마리아 SELCDO 팀코드 변경 (SELCTY)" ).append("\n"); 
		query.append("2013.09.05 진마리아 [CHM-201326612] AAZ Direction Conversion" ).append("\n"); 
		query.append("2013.11.26 진마리아 [CHM-201326854] SAQ project로 인한 SPC 변경건_FNC 우선제거" ).append("\n"); 
		query.append("2013.12.05 김시몬 [CHM-201326854] SAQ project로 인한 SPC 변경건_테이블 변경" ).append("\n"); 
		query.append("2013.12.26 최윤성 [선반영] Guide 의 Perf 로직 변경" ).append("\n"); 
		query.append("2014.01.13 김시몬 [선처리] SELBB/TYOBB RHQ변경에 따른 SQM SPC_OFC_LVL추가" ).append("\n"); 
		query.append("2014.01.23 김시몬 [선처리] 09014001,HAMDEB 로 ofc변경 처리" ).append("\n"); 
		query.append("2014.02.04 [CHM-201428383-01] RFA 로직 추가" ).append("\n"); 
		query.append("2014.03.14 김시몬 [선처리] BKG RFA NULL 관련 보완" ).append("\n"); 
		query.append("2014.03.17 [CHM-20142960] SMP/Allocation control보완 요청 - SPC_GET_SMP_AMEND_FNC 적용" ).append("\n"); 
		query.append("2014.03.25 김시몬 [선처리] SQM 분기구하는 로직 관련 보완" ).append("\n"); 
		query.append("2014.05.21 AES 보완" ).append("\n"); 
		query.append("2014.05.22 [선반영] AES-SC관련 로직 추가" ).append("\n"); 
		query.append("2014.08.31 [CHM-201431081] SPC Allocation Control Option 추가 보완 요청수정" ).append("\n"); 
		query.append("2014.09.11 [선반영] SPC Allocation Control Option 추가 보완 요청수정" ).append("\n"); 
		query.append("2014.10.20 Arie Im [CHM-201432344] Daily FCST - Dest Control시 SUM기능 보완" ).append("\n"); 
		query.append("2014.11.04 박은주 [CHM-201432710]  [SPC : 사후CSR 진행] [CHM-201431980]Daily FCST -Dest/Local-IPI 조회기능 보완요청" ).append("\n"); 
		query.append("                           QTA에 대해서 Yield Group 기준으로 중첩된 정보에 대해서는 0으로 나오도록 처리함(추가요청사항)" ).append("\n"); 
		query.append("2014.11.20 [CHM-201432864] Daily FCST보완" ).append("\n"); 
		query.append("- SUB Trade별 전체 실적 GUIDE추가(Acct) - SUB Trade, Trade 별 USMode/Account/Dest Sum 추가(HO/RHQ)" ).append("\n"); 
		query.append("- 체크박스 기능 재정의(HO/RHQ) - Excluding Sector(IAS) 추가 (HO/RHQ탭) - BKG실적 집계시 SC/RFA NO 둘중 하나만 있어도 Count" ).append("\n"); 
		query.append("2014.12.16 박은주 [CHM-201433153] Daily FCST status 리포트 보완 요청(겹선)" ).append("\n"); 
		query.append("2018.01.03 송민석 [CSR #2927] 'KJXIA','KCXIA','KDSIA' 의 경우 Bound가 W 인경우 E로 간주함" ).append("\n"); 
		query.append("2018.01.11 송민석 [CSR #2927] 'KJXIA','KCXIA','KDSIA' 와 같이 bound를 역으로 간주 할경우 그 total 값도 해당 bound에 sum 되도록 변경함" ).append("\n"); 
		query.append("2018.02.20 박광석 [SR #3288] Daily Forecast Status 상, 'KVTIA', 'KMHIA' Lane (S/N bound → W/E bound 전환)" ).append("\n"); 
		query.append("*/" ).append("\n"); 

	}
}