<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingHistoryMgtDBDAOSearchHistBkgEurTroRSQL">
			<desc><![CDATA[BookingHistoryMgtDBDAOSearchHistBkgEurTroRSQL]]></desc>
			<sql><![CDATA[
WITH OLD AS 
(SELECT @[bkg_no] BKG_NO
, @[io_bnd_cd] IO_BND_CD
, @[tro_seq] TRO_SEQ
, @[rqst_sub_seq] RQST_SUB_SEQ
, @[cntr_no] CNTR_NO
, @[cntr_tpsz_cd] CNTR_TPSZ_CD
, @[dcgo_seq] DCGO_SEQ
, @[rc_seq] RC_SEQ
, @[awk_cgo_seq] AWK_CGO_SEQ
, @[hlg_tp_cd] HLG_TP_CD
, @[cgo_wgt] CGO_WGT
, @[cntr_pkup_yd_cd] CNTR_PKUP_YD_CD
, @[cntr_pkup_dt] CNTR_PKUP_DT
, @[cntr_rtn_yd_cd] CNTR_RTN_YD_CD
, @[cntr_rtn_dt] CNTR_RTN_DT
, @[eur_trns_tp_cd] EUR_TRNS_TP_CD
, @[drp_off_pkup_yd_cd] DRP_OFF_PKUP_YD_CD
, @[cmdt_cd] CMDT_CD
, @[rep_cmdt_cd] REP_CMDT_CD
, @[rep_cmdt_desc] REP_CMDT_DESC
, @[bkg_trsp_mzd_cd] BKG_TRSP_MZD_CD
, @[spcl_instr_rmk] SPCL_INSTR_RMK
, @[tro_proc_cd] TRO_PROC_CD
, @[cxl_flg] CXL_FLG
, @[cstms_clr_no] CSTMS_CLR_NO
, @[all_in_rt_cd] ALL_IN_RT_CD
, @[curr_cd] CURR_CD
, @[vat_flg] VAT_FLG
, @[t1_doc_flg] T1_DOC_FLG
, @[trns_rev_amt] TRNS_REV_AMT
, @[so_cty_cd] SO_CTY_CD
, @[so_seq_no] SO_SEQ_NO
, @[act_cnt_cd] ACT_CNT_CD
, @[act_cust_seq] ACT_CUST_SEQ
, @[corr_no] CORR_NO
, @[corr_flg] CORR_FLG
, @[cfm_flg] CFM_FLG
, @[cfm_usr_id] CFM_USR_ID
, @[cfm_ofc_cd] CFM_OFC_CD
, @[cfm_dt] CFM_DT
, @[cfm_upd_dt] CFM_UPD_DT
, @[cfm_hlg_tp_cd] CFM_HLG_TP_CD
, @[cfm_all_in_rt_cd] CFM_ALL_IN_RT_CD
, @[cfm_curr_cd] CFM_CURR_CD
, @[cfm_rev_amt] CFM_REV_AMT
, @[cfm_vat_flg] CFM_VAT_FLG
, @[pctl_no] PCTL_NO
, @[cre_ofc_cd] CRE_OFC_CD
, @[add_rev_rmk] ADD_REV_RMK
from dual)
SELECT HIS_CATE_NM
    , PRE_CTNT
    , CRNT_CTNT
  FROM 
    (
        SELECT 'TRO YARD' HIS_CATE_NM
                , OLD.CNTR_NO||
                  '/'||OLD.HLG_TP_CD||
                  '/P/UP@['||OLD.CNTR_PKUP_YD_CD||
                  '/'||OLD.CNTR_PKUP_DT||
                  '/RTN@['||OLD.CNTR_RTN_YD_CD||'/'||OLD.CNTR_RTN_DT PRE_CTNT
                , NOW.CNTR_NO||
                  '/'||NOW.HLG_TP_CD||
                  '/P/UP@['||NOW.CNTR_PKUP_YD_CD||
                  '/'||TO_CHAR(NOW.CNTR_PKUP_DT, 'YYYY-MM-DD HH24:MI')||
                  '/RTN@['||NOW.CNTR_RTN_YD_CD||
                  '/'||TO_CHAR(NOW.CNTR_RTN_DT, 'YYYY-MM-DD HH24:MI') CRNT_CTNT
          FROM OLD
             , BKG_EUR_TRO NOW
         WHERE NOW.BKG_NO   (+) = OLD.BKG_NO
           AND NOW.IO_BND_CD(+) = OLD.IO_BND_CD
           AND NOW.TRO_SEQ  (+) = OLD.TRO_SEQ
        UNION ALL
        SELECT 'TRO ACTUAL SHIPPER' HIS_CATE_NM
                , OLD.CNTR_NO||
                  '/'||OLD.ACT_CNT_CD||OLD.ACT_CUST_SEQ PRE_CTNT
                , NOW.CNTR_NO||
                  '/'||NOW.ACT_CNT_CD||NOW.ACT_CUST_SEQ CRNT_CTNT
          FROM OLD
             , BKG_EUR_TRO NOW
         WHERE NOW.BKG_NO   (+) = OLD.BKG_NO
           AND NOW.IO_BND_CD(+) = OLD.IO_BND_CD
           AND NOW.TRO_SEQ  (+) = OLD.TRO_SEQ
        UNION ALL
        SELECT 'TRO RATE' HIS_CATE_NM
                , OLD.CNTR_NO||
                  '/'||OLD.CURR_CD||
                  '/''MANIFESTED RATE@['||OLD.ALL_IN_RT_CD||
                  '/VAT'||OLD.VAT_FLG||
                  '/T1 DOC'||OLD.T1_DOC_FLG||
                  '/'||OLD.TRNS_REV_AMT PRE_CTNT
                , NOW.CNTR_NO||
                  '/'||NOW.CURR_CD||
                  '/''MANIFESTED RATE@['||NOW.ALL_IN_RT_CD||
                  '/VAT'||NOW.VAT_FLG||
                  '/T1 DOC'||NOW.T1_DOC_FLG||
                  '/'||NOW.TRNS_REV_AMT CRNT_CTNT
          FROM OLD
             , BKG_EUR_TRO NOW
         WHERE NOW.BKG_NO   (+) = OLD.BKG_NO
           AND NOW.IO_BND_CD(+) = OLD.IO_BND_CD
           AND NOW.TRO_SEQ  (+) = OLD.TRO_SEQ   
		UNION ALL
		SELECT 'ADDITIONAL REMARK' HIS_CATE_NM
                , OLD.CNTR_NO|| '/'||OLD.ADD_REV_RMK PRE_CTNT
                , NOW.CNTR_NO|| '/'||NOW.ADD_REV_RMK CRNT_CTNT
		FROM OLD	
			, BKG_EUR_TRO NOW
		WHERE NOW.BKG_NO   (+) = OLD.BKG_NO
		  AND NOW.IO_BND_CD(+) = OLD.IO_BND_CD
		  AND NOW.TRO_SEQ  (+) = OLD.TRO_SEQ	
		UNION ALL
		SELECT 'TRO CFM' HIS_CATE_NM
			   ,'TRO SEQ: '||OLD.TRO_SEQ ||', Confirm ' ||OLD.CFM_FLG PRE_CTNT
		       ,'TRO SEQ: '||NOW.TRO_SEQ ||', Confirm ' ||NOW.CFM_FLG CRNT_CTNT
		FROM OLD
			, BKG_EUR_TRO NOW
		WHERE NOW.BKG_NO   (+) = OLD.BKG_NO
		  AND NOW.IO_BND_CD(+) = OLD.IO_BND_CD
		  AND NOW.TRO_SEQ  (+) = OLD.TRO_SEQ
		UNION ALL
		SELECT 'TRO CANCEL' HIS_CATE_NM
				, 'TRO SEQ: '||OLD.TRO_SEQ ||', Cancel ' ||OLD.CXL_FLG PRE_CTNT
				, 'TRO SEQ: '||NOW.TRO_SEQ ||', Cancel ' ||NOW.CXL_FLG CRNT_CTNT
		FROM OLD	
			, BKG_EUR_TRO NOW
		WHERE NOW.BKG_NO   (+) = OLD.BKG_NO
		  AND NOW.IO_BND_CD(+) = OLD.IO_BND_CD
		  AND NOW.TRO_SEQ  (+) = OLD.TRO_SEQ		
)
WHERE NVL(TRIM(PRE_CTNT), ' ') <> NVL(TRIM(CRNT_CTNT), ' ')			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="tro_seq" type="12" value="" out="N"/>
				<param name="rqst_sub_seq" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="dcgo_seq" type="12" value="" out="N"/>
				<param name="rc_seq" type="12" value="" out="N"/>
				<param name="awk_cgo_seq" type="12" value="" out="N"/>
				<param name="hlg_tp_cd" type="12" value="" out="N"/>
				<param name="cgo_wgt" type="12" value="" out="N"/>
				<param name="cntr_pkup_yd_cd" type="12" value="" out="N"/>
				<param name="cntr_pkup_dt" type="12" value="" out="N"/>
				<param name="cntr_rtn_yd_cd" type="12" value="" out="N"/>
				<param name="cntr_rtn_dt" type="12" value="" out="N"/>
				<param name="eur_trns_tp_cd" type="12" value="" out="N"/>
				<param name="drp_off_pkup_yd_cd" type="12" value="" out="N"/>
				<param name="cmdt_cd" type="12" value="" out="N"/>
				<param name="rep_cmdt_cd" type="12" value="" out="N"/>
				<param name="rep_cmdt_desc" type="12" value="" out="N"/>
				<param name="bkg_trsp_mzd_cd" type="12" value="" out="N"/>
				<param name="spcl_instr_rmk" type="12" value="" out="N"/>
				<param name="tro_proc_cd" type="12" value="" out="N"/>
				<param name="cxl_flg" type="12" value="" out="N"/>
				<param name="cstms_clr_no" type="12" value="" out="N"/>
				<param name="all_in_rt_cd" type="12" value="" out="N"/>
				<param name="curr_cd" type="12" value="" out="N"/>
				<param name="vat_flg" type="12" value="" out="N"/>
				<param name="t1_doc_flg" type="12" value="" out="N"/>
				<param name="trns_rev_amt" type="12" value="" out="N"/>
				<param name="so_cty_cd" type="12" value="" out="N"/>
				<param name="so_seq_no" type="12" value="" out="N"/>
				<param name="act_cnt_cd" type="12" value="" out="N"/>
				<param name="act_cust_seq" type="12" value="" out="N"/>
				<param name="corr_no" type="12" value="" out="N"/>
				<param name="corr_flg" type="12" value="" out="N"/>
				<param name="cfm_flg" type="12" value="" out="N"/>
				<param name="cfm_usr_id" type="12" value="" out="N"/>
				<param name="cfm_ofc_cd" type="12" value="" out="N"/>
				<param name="cfm_dt" type="12" value="" out="N"/>
				<param name="cfm_upd_dt" type="12" value="" out="N"/>
				<param name="cfm_hlg_tp_cd" type="12" value="" out="N"/>
				<param name="cfm_all_in_rt_cd" type="12" value="" out="N"/>
				<param name="cfm_curr_cd" type="12" value="" out="N"/>
				<param name="cfm_rev_amt" type="12" value="" out="N"/>
				<param name="cfm_vat_flg" type="12" value="" out="N"/>
				<param name="pctl_no" type="12" value="" out="N"/>
				<param name="cre_ofc_cd" type="12" value="" out="N"/>
				<param name="add_rev_rmk" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
