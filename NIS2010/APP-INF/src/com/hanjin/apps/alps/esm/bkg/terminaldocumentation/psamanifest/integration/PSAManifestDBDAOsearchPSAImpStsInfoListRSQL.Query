<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PSAManifestDBDAOsearchPSAImpStsInfoListRSQL">
			<desc><![CDATA[PSA Import Status List조회한다.]]></desc>
			<sql><![CDATA[
SELECT DECODE(DEL_CNTR.CNTR_NO,NULL,NULL,'-') SAV 
     , PI.VSL_CD VSL_CD
     , PI.SKD_VOY_NO SKD_VOY_NO
     , PI.SKD_DIR_CD SKD_DIR_CD
     , PI.CNTR_NO CNTR_NO
     , PI.POL_CD POL_CD
     , PI.POD_CD POD_CD
     , CASE WHEN CNTR.VGM_WGT > 0 THEN NVL(CNTR.VGM_WGT,0) ELSE NVL(PI.CNTR_WGT,0) END CNTR_WGT 
     /*, CASE WHEN CNTR.VGM_WGT > 0 OR PI.VGM_WGT > 0 THEN 'Y' ELSE 'N' END VGM_IND*/
     , CASE WHEN CNTR.VGM_WGT > 0 OR PI.CNTR_WGT > 0 OR PI.VGM_WGT > 0 THEN 'Y' ELSE 'N' END VGM_IND
     , PI.TS_TP_CD TS_TP_CD
     , PI.DCGO_FLG DCGO_FLG
     , PI.RC_FLG RC_FLG
     , PI.AWK_CGO_FLG AWK_CGO_FLG
     , PI.BB_CGO_FLG BB_CGO_FLG
     , PI.RD_CGO_FLG RD_CGO_FLG
     , PI.FULL_MTY_CD FM_CD
     , PI.LODG_VSL_CD NEXT_VSL_CD
     , PI.LODG_SKD_VOY_NO NEXT_SKD_VOY_NO
     , PI.LODG_VSL_DIR_CD NEXT_SKD_DIR_CD
     , PI.N1ST_POD_CD PORT_CD
     , PI.CNTR_OPR_CD   COP
     , PI.IB_SLT_OPR_CD IOP
     , PI.OB_SLT_OPR_CD OOP
     , PI.PSA_BAT_NO BATCH_NO
     , TO_CHAR(PI.SND_DT,'YYYY-MM-DD') SND_DT
     , PI.CNTR_SEAL_NO SEAL_NO
     , PI.BKG_NO BKG_NO
     , PI.CNTR_TPSZ_CD CNTR_TPSZ_CD
     , DECODE(PI.RC_FLG, 'Y', '1', '0') SPC
     , 'U' UDT_FLAG
     , UPPER(TRIM(PV.PSA_VOY_DIR_CD)) PSA_VOY_DIR_CD
     , UPPER(TRIM(PV.PSA_VSL_NM)) PSA_VSL_NM
	 , ' ' USER_ID
     , ' ' TYPE_CD
     , ' ' RECEIVER_ID
     , NVL(PI.VGM_WGT,CNTR.VGM_WGT) VGM_WGT 
     , NVL(PI.VGM_MZD_TP_CD,CNTR.VGM_MZD_TP_CD) VGM_MZD_TP_CD
     , NVL(PI.VGM_VRFY_SIG_CTNT,CNTR.VGM_VRFY_SIG_CTNT) VGM_VRFY_SIG_CTNT
     , PI.VGM_REF_NO
     , TO_CHAR(NVL(PI.VGM_VRFY_DT,CNTR.VGM_VRFY_DT),'YYYY-MM-DD') VGM_VRFY_DT
  FROM BKG_CSTMS_PSA_IMP_STS PI
     , BKG_CSTMS_PSA_IMP_STS_SPCL PS
     , BKG_CSTMS_PSA_VVD PV
     , (SELECT CNTR_NO
          FROM
             ( SELECT DISTINCT CNTR_NO
                 FROM BKG_CSTMS_PSA_IMP_STS
                WHERE VSL_CD        = @[vsl_cd]
                  AND SKD_VOY_NO    = @[skd_voy_no]
                  AND SKD_DIR_CD    = @[skd_dir_cd]
               MINUS
               SELECT DISTINCT C.CNTR_NO
                 FROM BKG_VVD V, BKG_BOOKING B, BKG_CONTAINER C, BKG_VVD NV
                WHERE V.VSL_CD           = @[vsl_cd]
                  AND V.SKD_VOY_NO       = @[skd_voy_no]
                  AND V.SKD_DIR_CD       = @[skd_dir_cd]
                  AND V.POD_CD           = 'SGSIN'
                  AND B.BKG_STS_CD NOT IN   ('X','S')
                  AND V.BKG_NO           = B.BKG_NO
                  AND V.BKG_NO           = C.BKG_NO
                  AND V.BKG_NO           = NV.BKG_NO
                  AND NV.VSL_PRE_PST_CD||NV.VSL_SEQ  = (SELECT NVL(MIN(VSL_PRE_PST_CD||VSL_SEQ), V.VSL_PRE_PST_CD||V.VSL_SEQ)
                                                          FROM BKG_VVD
                                                         WHERE BKG_NO  = V.BKG_NO
                                                           AND V.VSL_PRE_PST_CD||V.VSL_SEQ < VSL_PRE_PST_CD||VSL_SEQ
                                                       )
        )) DEL_CNTR
        , BKG_CONTAINER CNTR
  WHERE  PI.VSL_CD        = @[vsl_cd]
  AND    PI.SKD_VOY_NO    = @[skd_voy_no]
  AND    PI.SKD_DIR_CD    = @[skd_dir_cd]
  AND    PI.VSL_CD        = PS.VSL_CD(+)
  AND    PI.SKD_VOY_NO    = PS.SKD_VOY_NO(+)
  AND    PI.SKD_DIR_CD    = PS.SKD_DIR_CD(+)
  AND    PI.CNTR_NO       = PS.CNTR_NO(+)
  AND    PI.CNTR_NO       = DEL_CNTR.CNTR_NO(+)
#if(${type_cd}!='')
  AND    TS_TP_CD    LIKE SUBSTR(@[type_cd],1,1) ||'%'
  AND FULL_MTY_CD    LIKE SUBSTR(@[type_cd], 2, 1) ||'%'
#end
  AND PI.LODG_VSL_CD     = PV.VSL_CD(+)
  AND PI.LODG_SKD_VOY_NO = PV.SKD_VOY_NO(+)
  AND PI.LODG_VSL_DIR_CD = PV.SKD_DIR_CD(+)
  AND PI.BKG_NO          = CNTR.BKG_NO(+)
  AND PI.CNTR_NO         = CNTR.CNTR_NO(+)			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="type_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
