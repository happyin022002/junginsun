<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UnmatchBLDBDAORsltSearchChargeFilteringListRSQL">
			<desc><![CDATA[Charge Filtering]]></desc>
			<sql><![CDATA[
SELECT  
    DENSE_RANK() OVER ( ORDER BY BKG_NO, BKG_CTRT_TP_CD, BKG_RHQ_CD , BKG_OFC_CD , CTRT_NO , POR_CD	, POL_CD , POD_CD ,	DEL_CD , VPS_ETD_DT	 ) BKG_SEQ , -- <--
    COUNT(DISTINCT BKG_NO) OVER () AS BL_CNT,
    COUNT(BKG_NO) OVER() AS ROW_CNT,
    BKG_RHQ_CD,
    BKG_OFC_CD,
    BKG_NO,
    BL_NO,
    BKG_CRE_DT,
    RT_APLY_DT,
    TO_CHAR(VPS_ETD_DT ,'YYYY-MM-DD') VPS_ETD_DT,
    TO_CHAR(VPS_ETA_DT ,'YYYY-MM-DD') VPS_ETA_DT,
    VVD,
    BKG_CTRT_TP_CD,
    BKG_CTRT_TP_NM,
    CTRT_NO,
    REP_CMDT_CD,
    CMDT_CD,
    CMDT_NM,
    CSTMS_DESC,
    DCGO_FLG,
    RC_FLG,
	AWK_CGO_FLG,
    BB_CGO_FLG,
    RD_CGO_FLG,
    HNGR_FLG,
    EQ_SUBST_FLG,
    SVC_SCP_CD            ,
    POR_CD                ,
    POL_CD                ,
    POD_CD                ,
    DEL_CD                ,
    RCV_TERM_CD           ,
    DE_TERM_CD            ,  
	REPLACE(S_CUST_NM,CHR(13)||CHR(10),' ') S_CUST_NM		,
	REPLACE(C_CUST_NM,CHR(13)||CHR(10),' ') C_CUST_NM		,
	REPLACE(N_CUST_NM,CHR(13)||CHR(10),' ') N_CUST_NM		,
	CASE 
	   WHEN BKG_CTRT_TP_CD = 'S' THEN BKG_GET_TOKEN_FNC(SC_INFO,7,',')
	   WHEN BKG_CTRT_TP_CD = 'R' THEN (SELECT A.CUST_LGL_ENG_NM FROM MDM_CUSTOMER A WHERE A.CUST_CNT_CD = BKG_GET_TOKEN_FNC(RF_INFO,3,',') AND A.CUST_SEQ = BKG_GET_TOKEN_FNC(RF_INFO,4,','))
	   WHEN BKG_CTRT_TP_CD = 'T' THEN (SELECT A.CUST_LGL_ENG_NM FROM MDM_CUSTOMER A WHERE A.CUST_CNT_CD = BKG_GET_TOKEN_FNC(TA_INFO,3,',') AND A.CUST_SEQ = BKG_GET_TOKEN_FNC(TA_INFO,4,','))
    END CTRT_CUST_NM,
    DECODE(BKG_CTRT_TP_CD,'S' ,BKG_GET_TOKEN_FNC(SC_INFO,5,','), 'R', BKG_GET_TOKEN_FNC(RF_INFO,5,','), 'T', BKG_GET_TOKEN_FNC(TA_INFO,5,',')) CTRT_CUST_TP_CD,
    CASE 
        WHEN BKG_CTRT_TP_CD ='S' THEN  (SELECT  A.INTG_CD_VAL_DP_DESC FROM    COM_INTG_CD_DTL A WHERE A.INTG_CD_ID = 'CD00698' AND A.INTG_CD_VAL_CTNT = BKG_GET_TOKEN_FNC(SC_INFO,6,','))            
        WHEN BKG_CTRT_TP_CD ='R' THEN  (SELECT  A.INTG_CD_VAL_DP_DESC FROM    COM_INTG_CD_DTL A WHERE A.INTG_CD_ID = 'CD00698' AND A.INTG_CD_VAL_CTNT = BKG_GET_TOKEN_FNC(RF_INFO,6,','))
        WHEN BKG_CTRT_TP_CD ='T' THEN  (SELECT  A.INTG_CD_VAL_DP_DESC FROM    COM_INTG_CD_DTL A WHERE A.INTG_CD_ID = 'CD00698' AND A.INTG_CD_VAL_CTNT = BKG_GET_TOKEN_FNC(TA_INFO,6,','))
    ELSE ''
    END CTRT_CUST_VAL_SGM_NM,    
    BDR_FLG               ,
    BKG_STS_CD            ,
    BKG_STS_NM            ,
    SPLIT_FLG             ,
    SPLIT_NM              ,
    CHARGE_FLG            ,
    CHARGE_NM             ,
    AUTO_RAT_FLG,       
    ( SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD02131' AND INTG_CD_VAL_CTNT = AUTO_RAT_FLG ) AUTO_RAT_NM  ,
    RT_BL_TP_NM,
    INR_AUTH_NO,
    RATER_ID,
    NVL(RDN_NO, ' ')      RDN_NO      ,
    NVL(RDN_STS_NM , ' ') RDN_STS_NM  ,
	AUTO_RAT_CD,
    CHG_CD                ,
    CURR_CD               ,
    CHG_UT_AMT            ,
    RAT_AS_QTY            ,
    RAT_UT_CD             ,
    CHG_AMT               ,
    ERR_BL_CD             ,
    ''  SEARCH_DATE       ,
    ''  FROM_DT           ,
    ''  TO_DT             ,
    ''  CARGO_TYPE        ,
    ''  BILL_TYPE_N       ,
    ''  BILL_TYPE_M       ,
    ''  BILL_TYPE_C       ,
    ''  BILL_TYPE_B       ,
    ''  BKG_CUST_TP_CD    ,
    ''  CUST_CNT_CD       ,
    ''  CUST_SEQ          ,
    ''  CUST_NM           ,
    FRT_TERM_CD 
FROM(
SELECT
#if (${search_date} == 'BOOKING')

#elseif (${search_date} == 'APPL')
	/*+ LEADING(BR) */
#else

#end
		( SELECT A.OFC_CD FROM MDM_ORGANIZATION A WHERE A.OFC_TP_CD = 'HQ' START WITH A.OFC_CD = BK.BKG_OFC_CD CONNECT BY PRIOR A.PRNT_OFC_CD = A.OFC_CD ) BKG_RHQ_CD , -- param 같이
         BK.BKG_OFC_CD , -- param 같이
         BK.BKG_NO     ,
         BK.BL_NO      ,
		 TO_CHAR(BK.BKG_CRE_DT, 'YYYY-MM-DD')        AS BKG_CRE_DT ,
         TO_CHAR(BR.RT_APLY_DT, 'YYYY-MM-DD')        AS RT_APLY_DT ,
		 (
                SELECT /*+ INDEX_ASC(BV XPKBKG_VVD) */ TO_DATE (PS.VPS_ETD_DT)
                FROM    
                        VSK_VSL_PORT_SKD  PS, BKG_VVD BV
                WHERE   PS.VSL_CD       = BV.VSL_CD
                AND     PS.SKD_VOY_NO   = BV.SKD_VOY_NO
                AND     PS.SKD_DIR_CD   = BV.SKD_DIR_CD
                AND     PS.VPS_PORT_CD  = BV.POL_CD
                AND     PS.CLPT_IND_SEQ = BV.POL_CLPT_IND_SEQ
                AND     BV.BKG_NO       = BK.BKG_NO
                AND ROWNUM = 1


                ) VPS_ETD_DT      ,
		 (
                SELECT /*+ INDEX_DESC(BV XPKBKG_VVD) */ TO_DATE (PS.VPS_ETA_DT)
                FROM    
                        VSK_VSL_PORT_SKD  PS, BKG_VVD BV
                WHERE   PS.VSL_CD       = BV.VSL_CD
                AND     PS.SKD_VOY_NO   = BV.SKD_VOY_NO
                AND     PS.SKD_DIR_CD   = BV.SKD_DIR_CD
                AND     PS.VPS_PORT_CD  = BV.POD_CD
                AND     PS.CLPT_IND_SEQ = BV.POD_CLPT_IND_SEQ
                AND     BV.BKG_NO       = BK.BKG_NO
                AND ROWNUM = 1


                ) VPS_ETA_DT      ,
		( SELECT TRIM(REPLACE(INTG_CD_VAL_DP_DESC, 'B/L', '')) FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD01639' AND INTG_CD_VAL_CTNT = BR.RT_BL_TP_CD )  RT_BL_TP_NM ,                
		 BK.CMDT_CD        ,
		( SELECT A.CMDT_NM FROM MDM_COMMODITY A WHERE A.CMDT_CD = BK.CMDT_CD )  CMDT_NM ,
        C1.CUST_NM  S_CUST_NM ,
        C2.CUST_NM  C_CUST_NM ,
        C3.CUST_NM  N_CUST_NM ,
		 DECODE(BL.BDR_FLG, 'Y', 'Yes', 'No')  BDR_FLG ,
		 ( SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD00769' AND INTG_CD_VAL_CTNT = BK.BKG_STS_CD ) BKG_STS_NM  ,
         ( SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD02376' AND INTG_CD_VAL_CTNT = DECODE(BK.SPLIT_FLG, NULL, 'N', 'Y', 'S', BK.SPLIT_FLG) ) SPLIT_NM  ,
         ( SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD02375' AND INTG_CD_VAL_CTNT = DECODE(BC.BKG_NO, NULL, 'N', 'C') ) CHARGE_NM  ,
		 NVL(( SELECT COBIZ_AUTH_NO FROM BKG_BL_DOC WHERE BKG_NO = BK.BKG_NO ),' ') INR_AUTH_NO  ,
		 ( SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD01716' AND INTG_CD_VAL_CTNT = BR.BKG_CTRT_TP_CD ) BKG_CTRT_TP_NM,
         NVL((SELECT  MAX(RDN_NO) RDN_NO
		      FROM    BKG_REV_DR_NOTE
		      WHERE   BKG_NO = BK.BKG_NO), ' ') AS RDN_NO ,
         NVL((SELECT INTG_CD_VAL_DESC
              FROM COM_INTG_CD_DTL, BKG_REV_DR_NOTE A
	          WHERE 1=1
	            AND INTG_CD_ID = 'CD01568'
	            AND INTG_CD_VAL_CTNT = A.RDN_STS_CD
	            AND A.BKG_NO = BK.BKG_NO
	            AND (A.RDN_NO, RVIS_SEQ ) IN  (SELECT RDN_NO, RVIS_SEQ FROM BKG_REV_DR_NOTE K
                                                WHERE K.BKG_NO = BK.BKG_NO
                                                  AND K.CRE_DT = (SELECT MAX(CRE_DT) FROM BKG_REV_DR_NOTE P
                                                                  WHERE 1=1
                                                                    AND P.BKG_NO = K.BKG_NO
                                                                    AND ROWNUM = 1)
                                               )
                ),' ') RDN_STS_NM,  
         BC.AUTO_RAT_CD,
         BK.EQ_SUBST_FLG,
         BL.CSTMS_DESC,
         BK.REP_CMDT_CD,   
        (SELECT  MAX(DECODE(A.AUTO_RAT_CD, 'A', 'A', 'I', 'A', 'M'))
        FROM    BKG_CHG_RT  A
        WHERE   A.BKG_NO    = BK.BKG_NO
        ) AUTO_RAT_FLG    ,   
        (
         SELECT  UPD_USR_ID
         FROM    (
                 SELECT  BKG_NO      ,
                        UPD_USR_ID  ,
                        ROW_NUMBER() OVER( PARTITION BY BKG_NO ORDER BY UPD_DT DESC ) ROW_NUMBER
                 FROM    BKG_CHG_RT
                 ) A
         WHERE   A.BKG_NO      = BK.BKG_NO
         AND     A.ROW_NUMBER  = 1
        ) RATER_ID        ,
         CASE
         WHEN    BK.TAA_NO IS NOT NULL THEN  BK.TAA_NO
         WHEN    BK.RFA_NO IS NOT NULL THEN  BK.RFA_NO
         ELSE    BK.SC_NO
         END                                         AS CTRT_NO    ,
         CASE
            WHEN    BK.TAA_NO IS NOT NULL THEN  'T'
            WHEN    BK.RFA_NO IS NOT NULL THEN  'R'
            ELSE    'S'
         END                                         AS CTRT_TP_CD ,
         BK.VSL_CD     , -- param 같이
         BK.SKD_VOY_NO , -- param 같이
         BK.SKD_DIR_CD , -- param 같이
         BK.VSL_CD || BK.SKD_VOY_NO || BK.SKD_DIR_CD AS VVD        , -- param 같이
		 BK.DCGO_FLG    ,
		 BK.RC_FLG      ,
		 BK.AWK_CGO_FLG ,
		 BK.BB_CGO_FLG  ,
		 BK.RD_CGO_FLG  ,
		 BK.HNGR_FLG    ,
         BK.RCV_TERM_CD   , -- param 같이
         BK.DE_TERM_CD    , -- param 같이
         BK.POR_CD        , -- param 같이
         BK.POL_CD        , -- param 같이
         BK.POD_CD        , -- param 같이
         BK.DEL_CD        , -- param 같이
         BR.RT_BL_TP_CD ,
         (SELECT TRIM(REPLACE(INTG_CD_VAL_DP_DESC, 'B/L', '')) FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD01639' AND INTG_CD_VAL_CTNT = BR.RT_BL_TP_CD) AS BL_CVRD_TP_NM ,
		 BK.BKG_STS_CD    , -- param 같이
         BC.CHG_CD        , -- param 같이
		 DECODE(BC.CHG_CD , 'OFT' , 'AAA' , 'O/F' , 'AAB' , BC.CHG_CD)	DP_SEQ	,
         BC.RAT_UT_CD     ,
         BC.CURR_CD       ,
         BC.CHG_AMT       ,
	     BL.COBIZ_AUTH_NO ,
	     BC.CHG_UT_AMT    ,
	     BC.RAT_AS_QTY    ,
		 NULL AS REP_CHG_CD  , -- param
	     NULL AS SEARCH_DATE , -- param
	     NULL AS FROM_DT     , -- param
	     NULL AS TO_DT       , -- param
         NULL AS RFA_SC_NO   , -- param
		 BK.SVC_SCP_CD       , -- param
		 DECODE(BC.BKG_NO, NULL, 'N', 'C')                       AS CHARGE_FLG , -- param 같이
	     DECODE(BK.SPLIT_FLG, NULL, 'N', 'Y', 'S', BK.SPLIT_FLG) AS SPLIT_FLG , -- param 같이
	     NULL AS CARGO_TYPE  , -- param
	     NULL AS BILL_TYPE_N , -- param  
	     NULL AS BILL_TYPE_M , -- param  
	     NULL AS BILL_TYPE_C , -- param
	     NULL AS BILL_TYPE_B , -- param
		 CASE
         WHEN    BK.TAA_NO IS NOT NULL THEN  'T'
         WHEN    BK.RFA_NO IS NOT NULL THEN  'R'
         ELSE    'S'
         END	 BKG_CTRT_TP_CD,
         BC.FRT_TERM_CD,
		 (
            SELECT  SH.SC_NO ||','|| SM.AMDT_SEQ ||','|| CP.CUST_CNT_CD ||','|| CP.CUST_SEQ ||','|| CT.PRC_CTRT_CUST_TP_CD ||','|| CP.CTRT_CUST_VAL_SGM_CD ||','|| CP.CTRT_PTY_NM
            FROM    PRI_SP_HDR          SH  ,
                    PRI_SP_MN           SM  ,
                    PRI_SP_CTRT_PTY     CP  ,
                    PRI_SP_CTRT_CUST_TP CT
            WHERE   SM.PROP_NO            = SH.PROP_NO
            AND     SM.PROP_STS_CD        = 'F'
            AND     CP.PROP_NO            = SM.PROP_NO
            AND     CP.AMDT_SEQ           = SM.AMDT_SEQ
            AND     CP.PRC_CTRT_PTY_TP_CD = 'C'
            AND     CT.PROP_NO            = CP.PROP_NO
            AND     CT.AMDT_SEQ           = CP.AMDT_SEQ
            AND     CT.PRC_CTRT_PTY_TP_CD = CP.PRC_CTRT_PTY_TP_CD
            AND     SM.AMDT_SEQ = (SELECT MAX(AMDT_SEQ) FROM PRI_SP_MN WHERE PROP_NO = SM.PROP_NO)
            AND     SH.SC_NO = BK.SC_NO
         ) SC_INFO,
         (
            SELECT  RH.RFA_NO ||','|| RM.AMDT_SEQ ||','|| RM.CTRT_CUST_CNT_CD ||','|| RM.CTRT_CUST_SEQ ||','|| RM.PRC_CTRT_CUST_TP_CD ||','|| RM.CTRT_CUST_VAL_SGM_CD
            FROM    PRI_RP_HDR      RH  ,
                    PRI_RP_MN       RM
            WHERE   RM.PROP_NO            = RH.PROP_NO
            AND     RM.PROP_STS_CD        = 'A'
            AND     RM.AMDT_SEQ = (SELECT MAX(AMDT_SEQ) FROM PRI_RP_MN WHERE PROP_NO = RM.PROP_NO)
            AND     RH.RFA_NO = BK.RFA_NO
         ) RF_INFO  ,
         (
            SELECT  TH.TAA_NO ||','|| TM.AMDT_SEQ ||','|| TM.CTRT_CUST_CNT_CD ||','|| TM.CTRT_CUST_SEQ ||','|| TM.PRC_CTRT_CUST_TP_CD ||','|| TM.CTRT_CUST_VAL_SGM_CD
            FROM    PRI_TAA_HDR     TH  ,
                    PRI_TAA_MN      TM
            WHERE   TM.TAA_PROP_NO    = TH.TAA_PROP_NO
            AND     TM.CFM_FLG        = 'Y'
            AND     TM.AMDT_SEQ = (SELECT MAX(AMDT_SEQ) FROM PRI_TAA_MN WHERE TAA_PROP_NO = TM.TAA_PROP_NO) 
            AND     TH.TAA_NO = BK.TAA_NO
         ) TA_INFO,
         NVL((
            SELECT  DECODE(UB.REV_AUD_STS_CD,'U','Error','S','Settled','')
            FROM    BKG_REV_UMCH_BKG UB
            WHERE   UB.BKG_NO        = BK.BKG_NO
            AND     UB.UMCH_BKG_SEQ  = (SELECT MAX(UMCH_BKG_SEQ) FROM BKG_REV_UMCH_BKG U WHERE U.BKG_NO = UB.BKG_NO)
         ), 'Not Audited') ERR_BL_CD
FROM     BKG_BOOKING BK  
        ,BKG_RATE    BR  
	    ,BKG_BL_DOC  BL  
        ,BKG_CHG_RT  BC   
        ,BKG_CUSTOMER  C1  
        ,BKG_CUSTOMER  C2  
        ,BKG_CUSTOMER  C3   
		,(
      	 SELECT	OFC_CD 
      	 FROM	MDM_ORGANIZATION A
#if (${bkg_ofc_cd} != '') 
		 WHERE	OFC_CD = @[bkg_ofc_cd]
#end
#if (${bkg_gso_cd} != '') 
      	 START WITH	A.OFC_CD		= @[bkg_gso_cd]
#else
      	 START WITH	A.OFC_CD		= @[bkg_rhq_cd]
#end
      	 CONNECT BY	PRIOR A.OFC_CD	= A.PRNT_OFC_CD  
		 ) OG
#if (${search_date} == 'ETD' || ${search_date} == 'ETA')
		,VSK_VSL_PORT_SKD VSK
		,BKG_VVD VVD
#end
WHERE    1=1
#if (${search_date} == 'ETD')
AND      VSK.VSL_CD = VVD.VSL_CD
AND      VSK.SKD_VOY_NO = VVD.SKD_VOY_NO
AND      VSK.SKD_DIR_cD = VVD.SKD_DIR_CD
AND      VSK.VPS_PORT_CD = VVD.POL_CD
AND      VSK.CLPT_IND_SEQ = VVD.POL_CLPT_IND_SEQ
AND      VVD.VSL_PRE_PST_CD||VVD.VSL_SEQ = ( SELECT MIN(VSL_PRE_PST_CD||VSL_SEQ) FROM BKG_VVD VVD2 WHERE VVD2.BKG_NO = BK.BKG_NO)

   #if (${from_dt} != '') 
   AND      VSK.VPS_ETD_DT >= TO_DATE(@[from_dt], 'YYYY-MM-DD')
   #end
   
   #if (${to_dt} != '') 
   AND      VSK.VPS_ETD_DT <= TO_DATE(@[to_dt], 'YYYY-MM-DD') + 0.99999      /* 0.99999 는 23시 59분 59초를 의미 */
   #end

AND      VVD.BKG_NO = BK.BKG_NO
#end
#if (${search_date} == 'ETA')
AND      VSK.VSL_CD = VVD.VSL_CD
AND      VSK.SKD_VOY_NO = VVD.SKD_VOY_NO
AND      VSK.SKD_DIR_cD = VVD.SKD_DIR_CD
AND      VSK.VPS_PORT_CD = VVD.POD_CD
AND      VSK.CLPT_IND_SEQ = VVD.POD_CLPT_IND_SEQ
AND      VVD.VSL_PRE_PST_CD||VVD.VSL_SEQ = ( SELECT MAX(VSL_PRE_PST_CD||VSL_SEQ) FROM BKG_VVD VVD2 WHERE VVD2.BKG_NO = BK.BKG_NO)

   #if (${from_dt} != '') 
   AND      VSK.VPS_ETA_DT >= TO_DATE(@[from_dt], 'YYYY-MM-DD')
   #end
   
   #if (${to_dt} != '') 
   AND      VSK.VPS_ETA_DT <= TO_DATE(@[to_dt], 'YYYY-MM-DD') + 0.99999      /* 0.99999 는 23시 59분 59초를 의미 */
   #end

AND      VVD.BKG_NO = BK.BKG_NO
#end
AND		 BR.BKG_NO 		= BK.BKG_NO
AND		 BL.BKG_NO 		= BK.BKG_NO
AND      BC.BKG_NO	= BR.BKG_NO
AND		 BK.BKG_OFC_CD	= OG.OFC_CD
AND      C1.BKG_NO      = BK.BKG_NO
AND      C1.BKG_CUST_TP_CD  = 'S'
AND      C2.BKG_NO          = BK.BKG_NO
AND      C2.BKG_CUST_TP_CD  = 'C'
AND      C3.BKG_NO          = BK.BKG_NO
AND      C3.BKG_CUST_TP_CD  = 'N'

#if (${split_flg} == 'S') 
AND      BK.SPLIT_FLG = 'Y'
#elseif (${split_flg} == 'N')         
AND     (BK.SPLIT_FLG IS NULL OR BK.SPLIT_FLG = 'N')
#end

#if (${charge_flg} == 'C') 
AND      BC.BKG_NO IS NOT NULL
#elseif(${charge_flg} == 'N') 
AND      BC.BKG_NO IS NULL
#end

#if (${bill_type_n} != '' || ${bill_type_m} != '' || ${bill_type_c} != '' || ${bill_type_b} != '')
AND      BR.RT_BL_TP_CD IN (@[bill_type_n],@[bill_type_m],@[bill_type_c],@[bill_type_b])
#end

AND      BC.FRT_INCL_XCLD_DIV_CD(+) = 'N'	-- 고정
AND		 BC.CHG_AMT(+)				<> 0	-- 고정

#if (${search_date} == 'BKG') 
	
	#if (${from_dt} != '') 
	AND      BK.BKG_CRE_DT >= TO_DATE(@[from_dt], 'YYYY-MM-DD') 
	#end
	
	#if (${to_dt} != '')
	AND      BK.BKG_CRE_DT <= TO_DATE (@[to_dt], 'YYYY-MM-DD') + 0.99999      /* 0.99999 는 23시 59분 59초를 의미 */
	#end

#elseif (${search_date} == 'APPL')

	#if (${from_dt} != '') 
	AND      BR.RT_APLY_DT >= TO_DATE(@[from_dt], 'YYYY-MM-DD') 
	#end

	#if (${to_dt} != '')
	AND      BR.RT_APLY_DT <= TO_DATE (@[to_dt], 'YYYY-MM-DD') + 0.99999      /* 0.99999 는 23시 59분 59초를 의미 */
	#end

#end

	#if (${vvd} != '')
	AND     BK.VSL_CD       = SUBSTR(@[vvd], 1, 4)
	AND     BK.SKD_VOY_NO   = SUBSTR(@[vvd], 5, 4)
	AND     BK.SKD_DIR_CD   = SUBSTR(@[vvd], 9, 1)
	#end

#if (${rfa_sc_no} != '')
	AND  CASE
         WHEN    BK.TAA_NO IS NOT NULL THEN  BK.TAA_NO
         WHEN    BK.RFA_NO IS NOT NULL THEN  BK.RFA_NO
         ELSE    BK.SC_NO
         END     = @[rfa_sc_no]
#end

#if (${svc_scp_cd} != '') 
AND      BK.SVC_SCP_CD  = @[svc_scp_cd]
#end

#if (${por_cd} != '') 
AND      BK.POR_CD LIKE @[por_cd] || '%'
#end

#if (${pol_cd} != '') 
AND      BK.POL_CD LIKE @[pol_cd] || '%'
#end

#if (${pod_cd} != '') 
AND      BK.POD_CD LIKE @[pod_cd] || '%'
#end

#if (${del_cd} != '') 
AND      BK.DEL_CD LIKE @[del_cd] || '%'
#end

#if (${rep_chg_cd} != '') 
AND      ( SELECT A.REP_CHG_CD FROM MDM_CHARGE A WHERE A.CHG_CD = BC.CHG_CD ) = @[rep_chg_cd]
#end

#if (${chg_cd} != '')
			#if (${charge_type} == 'RATED')
						AND BC.CRE_USR_ID = NVL(@[cre_usr_id],BC.CRE_USR_ID)
				#if(${chg_cd1} != '')
					#if(${charge_condition} == 'AND')
						AND EXISTS ( SELECT 'Y' 
									 FROM BKG_CHG_RT A 
			            			 WHERE A.BKG_NO = BC.BKG_NO
		              				   AND A.CHG_CD = @[chg_cd]
	              					)
						AND EXISTS ( SELECT 'Y' 
									 FROM BKG_CHG_RT A 
	            					 WHERE A.BKG_NO = BC.BKG_NO
	              					   AND A.CHG_CD = @[chg_cd1]
	            					)
						AND BC.CHG_CD IN ( @[chg_cd] , @[chg_cd1] )
					#elseif(${charge_condition} == 'OR')
						AND EXISTS ( SELECT 'Y' 
									 FROM BKG_CHG_RT A 
	            					 WHERE A.BKG_NO = BC.BKG_NO
	              			  		   AND A.CHG_CD = @[chg_cd]
	              					 UNION ALL
		            				 SELECT 'Y' 
								 	 FROM BKG_CHG_RT A 
            					 	 WHERE A.BKG_NO = BC.BKG_NO
              					   	 AND A.CHG_CD = @[chg_cd1]  
              						)
					#end
				#elseif(${chg_cd1} == '')
					AND BC.CHG_CD = @[chg_cd]
				#end
			#elseif (${charge_type} == 'NOTRATED')
				#if(${chg_cd1} != '')
					#if(${charge_condition} == 'AND')
						AND NOT EXISTS ( SELECT 'Y' 
										 FROM BKG_CHG_RT A 
 								         WHERE A.BKG_NO = BC.BKG_NO
              							 AND A.CHG_CD = @[chg_cd]
              							 INTERSECT
            							 SELECT 'Y' 
										 FROM BKG_CHG_RT A 
            							 WHERE A.BKG_NO = BC.BKG_NO
              							 AND A.CHG_CD = @[chg_cd1] 
              							)
					#elseif(${charge_condition} == 'OR')
						AND NOT EXISTS ( SELECT 'Y' 
										 FROM BKG_CHG_RT A 
 								         WHERE A.BKG_NO = BC.BKG_NO
              							 AND A.CHG_CD = @[chg_cd]
              							 UNION ALL
            							 SELECT 'Y' 
										 FROM BKG_CHG_RT A 
            							 WHERE A.BKG_NO = BC.BKG_NO
              							 AND A.CHG_CD = @[chg_cd1] 
              							)
					#end
				#elseif(${chg_cd1} == '')
					AND NOT EXISTS ( SELECT 'Y' 
								 FROM BKG_CHG_RT A 
		            			 WHERE A.BKG_NO = BC.BKG_NO
		         				   AND A.CHG_CD = @[chg_cd]
	           					)
				#end			
			#end
        #end

#if (${bl_no} != '')
AND     BK.BL_NO = @[bl_no]
#end

#if (${bkg_ctrt_tp_cd} != '')
AND     BR.BKG_CTRT_TP_CD   = @[bkg_ctrt_tp_cd]
#end
#if (${bkg_ctrt_tp_cd} == 'S' && ${ctrt_no} != '')
AND     BK.SC_NO          = @[ctrt_no]
#elseif (${bkg_ctrt_tp_cd} == 'R' && ${ctrt_no} != '')
AND     BK.RFA_NO         = @[ctrt_no]
#elseif (${bkg_ctrt_tp_cd} == 'T' && ${ctrt_no} != '')
AND     BK.TAA_NO         = @[ctrt_no]
#end
#if (${bkg_ctrt_tp_cd} == '' && ${ctrt_no} != '')
AND 	(		BK.SC_NO          = @[ctrt_no]
				OR	BK.RFA_NO         = @[ctrt_no]
				OR	BK.TAA_NO         = @[ctrt_no]
		)
#end
#if (${bkg_cust_tp_cd} == 'S')

	#if (${cust_cnt_cd} != '')
	AND     C1.CUST_CNT_CD  = @[cust_cnt_cd]
	#end
	#if (${cust_seq} != '')
	AND     C1.CUST_SEQ     = @[cust_seq]
	#end

#elseif (${bkg_cust_tp_cd} == 'C')

	#if (${cust_cnt_cd} != '')
	AND     C2.CUST_CNT_CD  = @[cust_cnt_cd]
	#end
	#if (${cust_seq} != '')
	AND     C2.CUST_SEQ     = @[cust_seq]
	#end

#elseif (${bkg_cust_tp_cd} == 'N')

	#if (${cust_cnt_cd} != '')
	AND     C3.CUST_CNT_CD  = @[cust_cnt_cd]
	#end
	#if (${cust_seq} != '')
	AND     C3.CUST_SEQ     = @[cust_seq]
	#end

#end


#if (${cmdt_cd} != '')
AND     BK.CMDT_CD  = @[cmdt_cd]
#end

#if (${rcv_term_cd} != '') 
AND      BK.RCV_TERM_CD = @[rcv_term_cd]
#end

#if (${de_term_cd} != '') 
AND      BK.DE_TERM_CD  = @[de_term_cd]
#end

/* cargo type : DG, RF, AK, BB, RD, HG */
#if (${cargo_type} == 'DG') 
AND     BK.DCGO_FLG    = 'Y'
#elseif (${cargo_type} == 'RF') 
AND     BK.RC_FLG      = 'Y'
#elseif (${cargo_type} == 'AK') 
AND     BK.AWK_CGO_FLG = 'Y'
#elseif (${cargo_type} == 'BB') 
AND     BK.BB_CGO_FLG  = 'Y'
#elseif (${cargo_type} == 'RD') 
AND     BK.RD_CGO_FLG  = 'Y'
#elseif (${cargo_type} == 'HG') 
AND     BK.HNGR_FLG    = 'Y'
#elseif (${cargo_type} == 'ST') 
AND     BK.STOP_OFF_LOC_CD IS NOT NULL
#end

#if (${bdr_flg} != '')
AND     BL.BDR_FLG  = @[bdr_flg]
#end
#if (${bkg_sts_cd} != '') 
AND     BK.BKG_STS_CD = @[bkg_sts_cd]
#end

#if (${curr_cd} != '')
AND     BC.CURR_CD      = @[curr_cd]
#end

#if (${rat_ut_cd} != '')
AND     BC.RAT_UT_CD      IN ( #foreach(${key} in ${rat_ut_list}) #if($velocityCount != 1) , #end '$key' #end )  -- MULTI
#end

)
WHERE 1=1

#if (${auto_rat_flg} != '')
AND     AUTO_RAT_FLG    = @[auto_rat_flg]
#end

#if (${bkg_cust_tp_cd} == 'S')

#if (${cust_nm} != '')
AND     UPPER(S_CUST_NM)  LIKE '%' || UPPER(@[cust_nm]) || '%'
#end

#elseif (${bkg_cust_tp_cd} == 'C')

#if (${cust_nm} != '')
AND     UPPER(C_CUST_NM)  LIKE '%' || UPPER(@[cust_nm]) || '%'
#end

#elseif (${bkg_cust_tp_cd} == 'N')

#if (${cust_nm} != '')
AND     UPPER(N_CUST_NM)  LIKE '%' || UPPER(@[cust_nm]) || '%'
#end
#end


#if (${err_bl_cd} == 'S')
AND     ERR_BL_CD = 'Settled'
#elseif (${err_bl_cd} == 'U')
AND     ERR_BL_CD = 'Error'
#elseif (${err_bl_cd} == 'N')
AND     ERR_BL_CD = 'Not Audited'
#end

ORDER BY
BKG_NO		,
BKG_CTRT_TP_CD	,
BKG_RHQ_CD  ,
BKG_OFC_CD  ,
CTRT_NO		,
POR_CD		,
POL_CD		,
POD_CD		,
DEL_CD		,
VPS_ETD_DT	,
DP_SEQ			]]></sql>
			<params>
				<param name="bkg_ofc_cd" type="12" value="" out="N"/>
				<param name="bkg_gso_cd" type="12" value="" out="N"/>
				<param name="bkg_rhq_cd" type="12" value="" out="N"/>
				<param name="from_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="bill_type_n" type="12" value="" out="N"/>
				<param name="bill_type_m" type="12" value="" out="N"/>
				<param name="bill_type_c" type="12" value="" out="N"/>
				<param name="bill_type_b" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="rfa_sc_no" type="12" value="" out="N"/>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="por_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
				<param name="rep_chg_cd" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="chg_cd" type="12" value="" out="N"/>
				<param name="chg_cd1" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="bkg_ctrt_tp_cd" type="12" value="" out="N"/>
				<param name="ctrt_no" type="12" value="" out="N"/>
				<param name="cust_cnt_cd" type="12" value="" out="N"/>
				<param name="cust_seq" type="12" value="" out="N"/>
				<param name="cmdt_cd" type="12" value="" out="N"/>
				<param name="rcv_term_cd" type="12" value="" out="N"/>
				<param name="de_term_cd" type="12" value="" out="N"/>
				<param name="bdr_flg" type="12" value="" out="N"/>
				<param name="bkg_sts_cd" type="12" value="" out="N"/>
				<param name="curr_cd" type="12" value="" out="N"/>
				<param name="auto_rat_flg" type="12" value="" out="N"/>
				<param name="cust_nm" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
