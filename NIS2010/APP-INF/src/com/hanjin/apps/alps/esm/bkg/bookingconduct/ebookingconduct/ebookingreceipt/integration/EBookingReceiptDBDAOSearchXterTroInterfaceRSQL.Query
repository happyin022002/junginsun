<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EBookingReceiptDBDAOSearchXterTroInterfaceRSQL">
			<desc><![CDATA[external request 처리를 위해 external rqst의 Tro 정보를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT TRO_SEQ
        , SHPR_OWN_TRK_FLG  OWNR_TRK_FLG
        , ACT_SHPR_NM       ACT_SHPR_NM
        , CNTC_PSON_NM
        , CNTC_PHN_NO_CTNT  CNTC_PHN_NO
        , CNTC_MPHN_NO_CTNT CNTC_MPHN_NO
        --, DOR_ZIP_ID        ZN_CD
        , DOR_ZIP_ID        DOR_PST_NO 
        , ACT_SHPR_ADDR
        , TRO_RMK  || DECODE(TRO_RMK,NULL,'', ',') ||      
           BKG_JOIN_FNC(CURSOR(  SELECT 'UN No:'||IMDG_UN_NO
                                        ||', IMO Class:'||IMDG_CLSS_ID 
                                        ||' (Requested)' TRO_RMK
                                   FROM BKG_XTER_DG_CGO DG
                                   WHERE XTER_SNDR_ID = @[xter_sndr_id]
                                   AND XTER_RQST_NO = @[xter_rqst_no]
                                   AND XTER_RQST_SEQ = @[xter_rqst_seq]
                                   UNION ALL
                                   SELECT'Temp:'||ROUND(DECODE(MIN_TEMP_UT_CD, 'F', (5 * MIN_TEMP - 160)/9, MIN_TEMP), 1) --CDO_TEMP
                                        ||', Vantilation:'||VENT_RTO||DECODE(CNTR_VENT_TP_CD, 'P', '%', 'CMH')
                                        ||', Humidity:'||HUMID_RTO
                                        ||'%, Drain:  (Requested)' AS TRO_RMK 
                                   FROM BKG_XTER_RF_CGO
                                   WHERE XTER_SNDR_ID = @[xter_sndr_id]
                                   AND XTER_RQST_NO = @[xter_rqst_no]
                                   AND XTER_RQST_SEQ = @[xter_rqst_seq]))        
            DIFF_RMK
        , (select nvl((select 'Y'
              from mdm_location 
             where loc_cd = nvl(nvl(por_cd, pol_cd), 
                               (select loc_cd 
                                  from mdm_organization 
                                 where ofc_cd = bkg_ofc_cd)) 
               and conti_cd = 'E'), 'N')
               from bkg_xter_rqst_mst
               where xter_sndr_id = @[xter_sndr_id]
               and xter_rqst_no = @[xter_rqst_no]
               and xter_rqst_seq= @[xter_rqst_seq]
          ) IS_EUR
		, 'O' AS IO_BND_CD
		, 'N' AS CXL_FLG
        , 'N' AS RTN_TRO_FLG
        , 'Y' AS BKGFLG
		, 'I' AS IBFLAG
  FROM BKG_XTER_TRO
 WHERE XTER_SNDR_ID = @[xter_sndr_id]
   AND XTER_RQST_NO = @[xter_rqst_no]
   AND XTER_RQST_SEQ= @[xter_rqst_seq]			]]></sql>
			<params>
				<param name="xter_sndr_id" type="12" value="" out="N"/>
				<param name="xter_rqst_no" type="12" value="" out="N"/>
				<param name="xter_rqst_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
