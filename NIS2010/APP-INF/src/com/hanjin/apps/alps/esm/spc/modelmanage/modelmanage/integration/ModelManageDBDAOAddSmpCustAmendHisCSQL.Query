<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ModelManageDBDAOAddSmpCustAmendHisCSQL">
			<desc><![CDATA[SMP Customer Amend History 정보를 저장합니다.
2014.03.06 [CHM-20142960] SMP/Allocation control보완 요청 - Amend 로직 추가
2014.05.16 [CHM-201430353] SMP / AES 보완요청 - SC 입력 기능 추가]]></desc>
			<sql><![CDATA[
INSERT INTO SPC_MDL_CUST_CTRL_HIS (
       TRD_CD
     , COST_YRWK
     , VER_SEQ
     , MODI_SEQ
     , CUST_GRP_ID
     , CUST_CNT_CD
     , CUST_SEQ
     , SC_NO
     , RFA_NO
     , CNG_ITM_NM
     , OLD_SC_NO
     , OLD_RFA_NO
     , PRE_SC_NO
     , PRE_RFA_NO
     , DELT_FLG
     , MODI_USR_ID
     , MODI_GDT
     , CRE_USR_ID
     , CRE_DT
     , UPD_USR_ID
     , UPD_DT
)
SELECT TRD_CD
     , COST_YRWK
     , VER_SEQ
     , (SELECT NVL(MAX(MODI_SEQ) + 1, 1)
          FROM SPC_MDL_CUST_CTRL_HIS
         WHERE TRD_CD    = @[trd_cd]
           AND COST_YRWK = @[cost_yrwk]
           AND VER_SEQ   = @[ver_seq]
       ) AS MODI_SEQ
     , CUST_GRP_ID
     , CUST_CNT_CD
     , CUST_SEQ
     , @[sc_no]  AS SC_NO
     , @[rfa_no] AS RFA_NO
     , DECODE(@[sc_rfa_flg], 'RFA', 'RFA UPDATE', 'S/C UPDATE') AS CNG_ITM_NM
     , SC_NO         AS OLD_SC_NO
     , RFA_NO        AS OLD_RFA_NO
     , SC_NO         AS PRE_SC_NO
     , RFA_NO        AS PRE_RFA_NO
     , 'N'           AS DELT_FLG
     , @[cre_usr_id] AS MODI_USR_ID
     , CAST(SYS_EXTRACT_UTC(TO_TIMESTAMP(@[modi_gdt], 'YYYY/MM/DD HH24:MI:SS')) AS DATE) AS MODI_GDT
     , @[cre_usr_id] AS CRE_USR_ID
     , SYSDATE       AS CRE_DT
     , @[upd_usr_id] AS UPD_USR_ID
     , SYSDATE       AS UPD_DT
 FROM SPC_MDL_CUST_CTRL
WHERE TRD_CD      = @[trd_cd]
  AND COST_YRWK   = @[cost_yrwk]
  AND VER_SEQ     = @[ver_seq]
  AND CUST_CNT_CD = @[cust_cnt_cd]
  AND CUST_SEQ    = @[cust_seq]
#if (${pre_rfa_no} != '')
  AND RFA_NO      = @[pre_rfa_no]
#end
#if (${pre_sc_no} != '')
  AND SC_NO       = @[pre_sc_no]
#end			]]></sql>
			<params>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="cost_yrwk" type="12" value="" out="N"/>
				<param name="ver_seq" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
				<param name="rfa_no" type="12" value="" out="N"/>
				<param name="sc_rfa_flg" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="modi_gdt" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="cust_cnt_cd" type="12" value="" out="N"/>
				<param name="cust_seq" type="12" value="" out="N"/>
				<param name="pre_rfa_no" type="12" value="" out="N"/>
				<param name="pre_sc_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
