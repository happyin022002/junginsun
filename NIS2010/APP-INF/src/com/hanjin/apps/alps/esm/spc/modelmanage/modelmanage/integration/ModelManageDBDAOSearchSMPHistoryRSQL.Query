<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ModelManageDBDAOSearchSMPHistoryRSQL">
			<desc><![CDATA[SMP History 를 조회한다.
[CHM-201322502-01] SPC 프로젝트 - 성수기 선복운영 개선을 위한 T/F추진
2013.06.25 진마리아 [선처리] CRM Customer Flag 정보 개편에 따른 작업
2014.02.04 [CHM-201428383-01] RFA 로직 추가]]></desc>
			<sql><![CDATA[
SELECT TO_CHAR(MODI_GDT, 'YYYY-MM-DD HH24:MI:SS')     AS MODI_GDT   ,
       DECODE(MODI_USR_ID, 'SYSTEM', '', MODI_USR_ID) AS MODI_USR_ID,
       DECODE(MODI_USR_ID, 'SYSTEM', '', 'AUTO', 'AUTO', (SELECT USR_NM
                                                            FROM COM_USER
                                                           WHERE USR_ID = MODI_USR_ID)) AS MODI_USR_NM,
       VER_SEQ                                                      ,
       CNG_ITM_NM                                                   ,
       DECODE(MDL_ADD_FLG, 'Y', 'ADD', 'N', 'DEL')    AS MDL_ADD_FLG,
       DECODE(H.CUST_CNT_CD, NULL, '',
               (CASE WHEN NVL(NEW_KEY_ACCT_FLG,'N') = 'Y' THEN 'CC'
                     WHEN NVL(GLO_ACCT_FLG,'N')     = 'Y' THEN 'CC'
                     WHEN NVL(RGN_ACCT_FLG,'N')     = 'Y' THEN 'RC'
                     ELSE                             'LC'
                END)
             )                            	   		  AS ACCT_CLSS  ,
       (SELECT CUST_GRP_NM                  	      	
          FROM MDM_CUST_PERF_GRP            	      	
         WHERE CUST_GRP_ID = C.CUST_GRP_ID) 	      AS CUST_GRP_NM,
       CUST_LGL_ENG_NM                      	      AS CUST_NM    ,
       CUST_CTRL_CD                                                 ,
       SC_NO                                                        ,
       RFA_NO                                                       ,
       SUB_TRD_CD                                                   ,
       SLS_RHQ_CD                                                   ,
       CUST_ADJ_QTY                                                 ,
       SLS_RGN_OFC_CD                                               ,
       SUB_TRD_ADJ_QTY                                              ,
       RLANE_CD                                                     ,
       RLANE_ADJ_QTY                                                ,
       SPC_CTRL_MDL_RMK                                             ,
       SLS_RHQ_CD                                     AS OLD_SLS_RHQ,
       OLD_CUST_ADJ_QTY                                             ,
       OLD_SLS_RGN_OFC_CD                                           ,
       OLD_SUB_TRD_ADJ_QTY                                          ,
       OLD_RLANE_CD                                                 ,
       OLD_RLANE_ADJ_QTY                                            ,
       OLD_SPC_CTRL_MDL_RMK
  FROM SPC_MDL_CUST_REV_LANE_HIS H,
       MDM_CUSTOMER              C
 WHERE TRD_CD        = @[trade]
   AND COST_YRWK     = @[season] 
#if(${version} != '')
   AND VER_SEQ       = @[version]
#end
#if(${rhq} != '')
   AND SLS_RHQ_CD    = @[rhq]
#end
#if(${office} != '')
   AND SLS_RGN_OFC_CD = @[office]
#end
#if(${subtrade} != '')
   AND SUB_TRD_CD    = @[subtrade]
#end
#if(${lane} != '')
   AND RLANE_CD      IN (${lane})
#end
#if(${acct_cd} != '')
   AND H.CUST_CNT_CD||TO_CHAR(H.CUST_SEQ, 'FM000000') IN (${acct_cd})
#end
#if(${grp_acct} != '')
   AND (H.CUST_CNT_CD, H.CUST_SEQ) IN (SELECT CUST_CNT_CD, CUST_SEQ
                                         FROM MDM_CUSTOMER
                                        WHERE CUST_GRP_ID IN (${grp_acct})
                                          AND DELT_FLG    = 'N')
#end
   AND H.CUST_CNT_CD = C.CUST_CNT_CD(+)
   AND H.CUST_SEQ    = C.CUST_SEQ(+)
 ORDER BY MODI_GDT DESC,
          DECODE(ACCT_CLSS, 'CC', '0', 'RC', '1', '2'),
          CUST_GRP_NM  ,
          CUST_NM      ,
          CUST_CTRL_CD , 
          SC_NO        ,      
          RFA_NO       ,
          SUB_TRD_CD   ,
          SLS_RHQ_CD   ,
          DECODE(SLS_RGN_OFC_CD, NULL, '0', SLS_RGN_OFC_CD),
          DECODE(CUST_ADJ_QTY, NULL, 'ZZZZZ', CUST_ADJ_QTY),
          DECODE(RLANE_CD, NULL, '0', RLANE_CD),
          DECODE(SUB_TRD_ADJ_QTY, NULL, 'ZZZZZ', SUB_TRD_ADJ_QTY),
          DECODE(SPC_CTRL_MDL_RMK, NULL, '0', SPC_CTRL_MDL_RMK),
          DECODE(RLANE_ADJ_QTY, NULL, 'ZZZZZ', RLANE_ADJ_QTY)			]]></sql>
			<params>
				<param name="trade" type="12" value="" out="N"/>
				<param name="season" type="12" value="" out="N"/>
				<param name="version" type="12" value="" out="N"/>
				<param name="rhq" type="12" value="" out="N"/>
				<param name="office" type="12" value="" out="N"/>
				<param name="subtrade" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
