<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BlRatingDBDAOSearchRateQtyListRSQL">
			<desc><![CDATA[SearchRateQtyList]]></desc>
			<sql><![CDATA[
#if (${ca_flg} == 'Y') 
SELECT A1.CNTR_TPSZ_CD	
      ,CASE 	
        WHEN LV = 1 AND DTL.BB_CGO_FLG = 'Y' THEN 'BB'
		WHEN LV = 2 AND DTL.AWK_CGO_FLG ='Y' THEN 'AK'
		WHEN LV = 3 AND DTL.RC_FLG ='Y' THEN 'RF'
		WHEN LV = 4 AND DTL.DCGO_FLG ='Y' THEN 'DG'
		WHEN LV = 5 AND DTL.BB_CGO_FLG ='N' AND AWK_CGO_FLG ='N' AND RC_FLG = 'N' AND DCGO_FLG = 'N' THEN 'DR'	
       END AS CGO	
      ,SUM(CASE 	
		WHEN LV = 1 AND DTL.BB_CGO_FLG = 'Y' AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY
		WHEN LV = 2 AND DTL.AWK_CGO_FLG ='Y' AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY
		WHEN LV = 3 AND DTL.RC_FLG ='Y' AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY
		WHEN LV = 4 AND DTL.DCGO_FLG ='Y'  AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY 
		WHEN LV = 5 AND DTL.BB_CGO_FLG ='N' AND AWK_CGO_FLG ='N' AND RC_FLG = 'N' AND DCGO_FLG = 'N'  AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY
       END) AS QTY
		,A1.EQ_SUBST_CNTR_TPSZ_CD EQ_SUB
		,A1.EQ_SUBST_CGO_QTY EQ_SUB_QTY
	FROM BKG_QTY_HIS A1, BKG_QTY_DTL_HIS DTL
      ,( SELECT LEVEL AS LV
           FROM DUAL
        CONNECT BY ROWNUM <= 5
       ) A2
 WHERE A1.BKG_NO = @[bkg_no]
	AND A1.BKG_NO = DTL.BKG_NO
	AND A1.CNTR_TPSZ_CD = DTL.CNTR_TPSZ_CD
	AND A1.CORR_NO = 'TMP0000001'
	AND A1.CORR_NO = DTL.CORR_NO
 GROUP BY A1.CNTR_TPSZ_CD,A1.EQ_SUBST_CNTR_TPSZ_CD,A1.EQ_SUBST_CGO_QTY
      ,CASE 
		WHEN LV = 1 AND DTL.BB_CGO_FLG = 'Y' THEN 'BB'
		WHEN LV = 2 AND DTL.AWK_CGO_FLG ='Y' THEN 'AK'
		WHEN LV = 3 AND DTL.RC_FLG ='Y' THEN 'RF'
		WHEN LV = 4 AND DTL.DCGO_FLG ='Y' THEN 'DG'
		WHEN LV = 5 AND DTL.BB_CGO_FLG ='N' AND AWK_CGO_FLG ='N' AND RC_FLG = 'N' AND DCGO_FLG = 'N' THEN 'DR'
       END
HAVING SUM(CASE 
		WHEN LV = 1 AND DTL.BB_CGO_FLG = 'Y' AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY 
		WHEN LV = 2 AND DTL.AWK_CGO_FLG ='Y' AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY
		WHEN LV = 3 AND DTL.RC_FLG ='Y' AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY
		WHEN LV = 4 AND DTL.DCGO_FLG ='Y'  AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY 
		WHEN LV = 5 AND DTL.BB_CGO_FLG ='N' AND AWK_CGO_FLG ='N' AND RC_FLG = 'N' AND DCGO_FLG = 'N'  AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY
       END) > 0
 ORDER BY CNTR_TPSZ_CD
#else 
SELECT A1.CNTR_TPSZ_CD	
      ,CASE 	
        WHEN LV = 1 AND DTL.BB_CGO_FLG = 'Y' THEN 'BB'
		WHEN LV = 2 AND DTL.AWK_CGO_FLG ='Y' THEN 'AK'
		WHEN LV = 3 AND DTL.RC_FLG ='Y' THEN 'RF'
		WHEN LV = 4 AND DTL.DCGO_FLG ='Y' THEN 'DG'
		WHEN LV = 5 AND DTL.BB_CGO_FLG ='N' AND AWK_CGO_FLG ='N' AND RC_FLG = 'N' AND DCGO_FLG = 'N' THEN 'DR'	
       END AS CGO	
      ,SUM(CASE 	
		WHEN LV = 1 AND DTL.BB_CGO_FLG = 'Y' AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY
		WHEN LV = 2 AND DTL.AWK_CGO_FLG ='Y' AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY
		WHEN LV = 3 AND DTL.RC_FLG ='Y' AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY
		WHEN LV = 4 AND DTL.DCGO_FLG ='Y'  AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY 
		WHEN LV = 5 AND DTL.BB_CGO_FLG ='N' AND AWK_CGO_FLG ='N' AND RC_FLG = 'N' AND DCGO_FLG = 'N'  AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY
       END) AS QTY
		,A1.EQ_SUBST_CNTR_TPSZ_CD EQ_SUB
		,A1.EQ_SUBST_CGO_QTY EQ_SUB_QTY
	FROM BKG_QUANTITY A1, BKG_QTY_DTL DTL
      ,( SELECT LEVEL AS LV
           FROM DUAL
        CONNECT BY ROWNUM <= 5
       ) A2
 WHERE A1.BKG_NO = @[bkg_no]
	AND A1.BKG_NO = DTL.BKG_NO
	AND A1.CNTR_TPSZ_CD = DTL.CNTR_TPSZ_CD
 GROUP BY A1.CNTR_TPSZ_CD,A1.EQ_SUBST_CNTR_TPSZ_CD,A1.EQ_SUBST_CGO_QTY
      ,CASE 
		WHEN LV = 1 AND DTL.BB_CGO_FLG = 'Y' THEN 'BB'
		WHEN LV = 2 AND DTL.AWK_CGO_FLG ='Y' THEN 'AK'
		WHEN LV = 3 AND DTL.RC_FLG ='Y' THEN 'RF'
		WHEN LV = 4 AND DTL.DCGO_FLG ='Y' THEN 'DG'
		WHEN LV = 5 AND DTL.BB_CGO_FLG ='N' AND AWK_CGO_FLG ='N' AND RC_FLG = 'N' AND DCGO_FLG = 'N' THEN 'DR'
       END
HAVING SUM(CASE 
		WHEN LV = 1 AND DTL.BB_CGO_FLG = 'Y' AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY 
		WHEN LV = 2 AND DTL.AWK_CGO_FLG ='Y' AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY
		WHEN LV = 3 AND DTL.RC_FLG ='Y' AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY
		WHEN LV = 4 AND DTL.DCGO_FLG ='Y'  AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY 
		WHEN LV = 5 AND DTL.BB_CGO_FLG ='N' AND AWK_CGO_FLG ='N' AND RC_FLG = 'N' AND DCGO_FLG = 'N'  AND DTL.OP_CNTR_QTY > 0 THEN DTL.OP_CNTR_QTY
       END) > 0
 ORDER BY CNTR_TPSZ_CD
#end			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
