<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UsWharfageDecMgtDBDAOsearchUsWhfSendQtyUSOAKRSQL">
			<desc><![CDATA[searchUsWhfSendQtyUSOAK]]></desc>
			<sql><![CDATA[
WITH RT_DTL AS (
 SELECT USA_WHF_RAT_UT_CD
       ,FULL_MTY_CD
       ,USA_WHF_TRSP_TP_CD
       ,USA_WHF_EXPT_FLG
       ,WHF_UT_PRC
   FROM BKG_USA_WHF_RT_DTL DTL
       ,(SELECT MAX(EFF_DT) AS EFF_DT
           FROM BKG_USA_WHF_RT_DTL
          WHERE PORT_CD = @[port]
            AND IO_BND_CD = @[bound]
        ) MAX_RT
  WHERE PORT_CD = @[port]
    AND IO_BND_CD = @[bound]
    AND DTL.EFF_DT = MAX_RT.EFF_DT
)
SELECT TB.*
      ,MAX(DECODE(B.USA_WHF_RAT_UT_CD, '20F', B.WHF_UT_PRC)) AS UT_PRC_20FT
      ,MAX(DECODE(B.USA_WHF_RAT_UT_CD, '40F', B.WHF_UT_PRC)) AS UT_PRC_40FT
      ,MAX(DECODE(B.USA_WHF_RAT_UT_CD, '45F', B.WHF_UT_PRC)) AS UT_PRC_45FT
      ,MAX(DECODE(B.USA_WHF_RAT_UT_CD, 'CON', B.WHF_UT_PRC)) AS UT_PRC_CONT
      ,MAX(DECODE(B.USA_WHF_RAT_UT_CD, 'TEU', B.WHF_UT_PRC)) AS UT_PRC_TEUS 
  FROM (
		SELECT '1' AS SEQ
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, '20F', RAT_AS_QTY)) AS FT20
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, '40F', RAT_AS_QTY)) AS FT40
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, '45F', RAT_AS_QTY)) AS FT45
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, 'CON', RAT_AS_QTY)) AS CONT
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, 'TEU', RAT_AS_QTY)) AS TEUS
		      ,SUM(RAT_AS_QTY * WHF_UT_PRC) AS WHF_AMT
		      ,'F' FULL_MTY_CD
		      ,'L' USA_WHF_TRSP_TP_CD
		  FROM BKG_USA_WHF_SND_QTY
		 WHERE VSL_CD = SUBSTR(@[vvd], 1, 4)
		   AND SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
		   AND SKD_DIR_CD = SUBSTR(@[vvd], 9)
		   AND PORT_CD = @[port]
		   AND IO_BND_CD = @[bound]
		   AND FULL_MTY_CD = 'F'
		   AND USA_WHF_TRSP_TP_CD = 'L'
		   AND USA_WHF_EXPT_FLG = 'N'
		UNION ALL
		SELECT '2' AS SEQ
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, '20F', RAT_AS_QTY)) AS ft20
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, '40F', RAT_AS_QTY)) AS ft40
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, '45F', RAT_AS_QTY)) AS ft45
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, 'CON', RAT_AS_QTY)) AS cont
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, 'TEU', RAT_AS_QTY)) AS teus
		      ,SUM(RAT_AS_QTY * WHF_UT_PRC) AS WHF_AMT
		      ,'M' FULL_MTY_CD
		      ,'L' USA_WHF_TRSP_TP_CD
		  FROM BKG_USA_WHF_SND_QTY 
		 WHERE VSL_CD = SUBSTR(@[vvd], 1, 4)
		   AND SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
		   AND SKD_DIR_CD = SUBSTR(@[vvd], 9)
		   AND PORT_CD = @[port]
		   AND IO_BND_CD = @[bound]
		   AND FULL_MTY_CD = 'M'
		   AND USA_WHF_TRSP_TP_CD = 'L'
		   AND USA_WHF_EXPT_FLG = 'N'
		UNION ALL
		SELECT '3' AS SEQ
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, '20F', RAT_AS_QTY)) AS ft20
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, '40F', RAT_AS_QTY)) AS ft40
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, '45F', RAT_AS_QTY)) AS ft45
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, 'CON', RAT_AS_QTY)) AS cont
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, 'TEU', RAT_AS_QTY)) AS teus
		      ,SUM(RAT_AS_QTY * WHF_UT_PRC) AS WHF_AMT
		      ,'F' FULL_MTY_CD
		      ,'I' USA_WHF_TRSP_TP_CD
		  FROM BKG_USA_WHF_SND_QTY 
		 WHERE VSL_CD = SUBSTR(@[vvd], 1, 4)
		   AND SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
		   AND SKD_DIR_CD = SUBSTR(@[vvd], 9)
		   AND PORT_CD = @[port]
		   AND IO_BND_CD = @[bound]
		   AND FULL_MTY_CD = 'F'
		   AND USA_WHF_TRSP_TP_CD = 'I'
		   AND USA_WHF_EXPT_FLG = 'N'
		UNION ALL
		SELECT '4' AS SEQ
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, '20F', RAT_AS_QTY)) AS ft20
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, '40F', RAT_AS_QTY)) AS ft40
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, '45F', RAT_AS_QTY)) AS ft45
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, 'CON', RAT_AS_QTY)) AS cont
		      ,MAX(DECODE(USA_WHF_RAT_UT_CD, 'TEU', RAT_AS_QTY)) AS teus
		      ,SUM(RAT_AS_QTY * WHF_UT_PRC) AS WHF_AMT
		      ,'M' FULL_MTY_CD
		      ,'I' USA_WHF_TRSP_TP_CD
		  FROM BKG_USA_WHF_SND_QTY 
		 WHERE VSL_CD = SUBSTR(@[vvd], 1, 4)
		   AND SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
		   AND SKD_DIR_CD = SUBSTR(@[vvd], 9)
		   AND PORT_CD = @[port]
		   AND IO_BND_CD = @[bound]
		   AND FULL_MTY_CD = 'M'
		   AND USA_WHF_TRSP_TP_CD = 'I'
		   AND USA_WHF_EXPT_FLG = 'N'
       ) TB
      ,RT_DTL B
 WHERE B.FULL_MTY_CD = TB.FULL_MTY_CD(+)
   AND B.USA_WHF_EXPT_FLG = 'N'
   AND B.USA_WHF_TRSP_TP_CD = TB.USA_WHF_TRSP_TP_CD(+)
GROUP BY TB.SEQ
        ,TB.ft20
        ,TB.ft40
        ,TB.ft45
        ,TB.cont
        ,TB.teus
        ,TB.WHF_AMT
        ,TB.FULL_MTY_CD
        ,TB.USA_WHF_TRSP_TP_CD
ORDER BY TB.SEQ			]]></sql>
			<params>
				<param name="port" type="12" value="" out="N"/>
				<param name="bound" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
