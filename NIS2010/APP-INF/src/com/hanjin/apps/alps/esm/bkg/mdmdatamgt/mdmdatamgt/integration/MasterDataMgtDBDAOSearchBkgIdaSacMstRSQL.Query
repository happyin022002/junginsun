<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MasterDataMgtDBDAOSearchBkgIdaSacMstRSQL">
			<desc><![CDATA[ ]]></desc>
			<sql><![CDATA[
with base_data as (
    select 
         a.IDA_SAC_CD
        , a.IDA_SAC_NM
        , a.IDA_SAC_TP_CD
        , a.PRNT_IDA_SAC_CD
        , a.DELT_FLG
        , a.CRE_DT
        , a.CRE_USR_ID
        , a.UPD_DT
        , a.UPD_USR_ID 
		, a.IDA_GST_RTO
		, a.IDA_CGST_RTO
		, a.IDA_SGST_RTO 
		, a.IDA_IGST_RTO
		, a.IDA_UGST_RTO 
    from BKG_IDA_SAC_MST a 
    WHERE 1=1
        and a.ida_sac_tp_cd = 'SAC'
#if (${ida_sac_cd} != '' ) 
        and a.IDA_SAC_CD LIKE  @[ida_sac_cd] || '%' 
#end
#if (${ida_sac_nm} != '' ) 
        and a.IDA_SAC_NM LIKE  '%' || @[ida_sac_nm] || '%' 
#end
),
prnt_data as (
    select distinct
         a.IDA_SAC_CD
        , a.IDA_SAC_NM
        , a.IDA_SAC_TP_CD
        , a.PRNT_IDA_SAC_CD
        , a.DELT_FLG
        , a.CRE_DT
        , a.CRE_USR_ID
        , a.UPD_DT
        , a.UPD_USR_ID 
		, a.IDA_GST_RTO
		, a.IDA_CGST_RTO
		, a.IDA_SGST_RTO
		, a.IDA_IGST_RTO
		, a.IDA_UGST_RTO 
    from BKG_IDA_SAC_MST a ,base_data b
    WHERE 1=1 --SCT : SECTION, HDG:HEADING, GRP:GROUP, SAC : SAC 
        and a.IDA_SAC_TP_CD <> 'SAC'
        and ( a.IDA_SAC_TP_CD = 'STR' 
                OR ( a.IDA_SAC_TP_CD = 'SCT' and a.IDA_SAC_CD = substr(b.IDA_SAC_CD,0,3) ) 
                OR ( a.IDA_SAC_TP_CD = 'HDG' and a.IDA_SAC_CD = substr(b.IDA_SAC_CD,0,4) ) 
                OR ( a.IDA_SAC_TP_CD = 'GRP' and a.IDA_SAC_CD = substr(b.IDA_SAC_CD,0,5) ) 
            )
)
select 
	level  
	, a.IDA_SAC_CD
	, a.IDA_SAC_NM
	, a.IDA_SAC_TP_CD
	, a.PRNT_IDA_SAC_CD
	, a.DELT_FLG
	, a.CRE_DT
	, a.CRE_USR_ID
	, a.UPD_DT
	, a.UPD_USR_ID 
		, a.IDA_GST_RTO
		, a.IDA_CGST_RTO
		, a.IDA_SGST_RTO
		, a.IDA_IGST_RTO
		, a.IDA_UGST_RTO 
from (
    select 
         a.IDA_SAC_CD
        , a.IDA_SAC_NM
        , a.IDA_SAC_TP_CD
        , a.PRNT_IDA_SAC_CD
        , a.DELT_FLG
        , a.CRE_DT
        , a.CRE_USR_ID
        , a.UPD_DT
        , a.UPD_USR_ID    
		, a.IDA_GST_RTO
		, a.IDA_CGST_RTO
		, a.IDA_SGST_RTO
		, a.IDA_IGST_RTO
		, a.IDA_UGST_RTO  
    from base_data a
    union all
     select 
         a.IDA_SAC_CD
        , a.IDA_SAC_NM
        , a.IDA_SAC_TP_CD
        , a.PRNT_IDA_SAC_CD
        , a.DELT_FLG
        , a.CRE_DT
        , a.CRE_USR_ID
        , a.UPD_DT
        , a.UPD_USR_ID    
		, a.IDA_GST_RTO
		, a.IDA_CGST_RTO
		, a.IDA_SGST_RTO
		, a.IDA_IGST_RTO
		, a.IDA_UGST_RTO  
    from prnt_data a   

) a
CONNECT BY PRIOR IDA_SAC_CD = PRNT_IDA_SAC_CD                                    
START WITH PRNT_IDA_SAC_CD = '99'
ORDER SIBLINGS BY IDA_SAC_CD			]]></sql>
			<params>
				<param name="ida_sac_cd" type="12" value="" out="N"/>
				<param name="ida_sac_nm" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
