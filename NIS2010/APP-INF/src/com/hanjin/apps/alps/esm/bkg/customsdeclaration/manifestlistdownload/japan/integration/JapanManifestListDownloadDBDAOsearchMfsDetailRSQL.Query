<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="JapanManifestListDownloadDBDAOsearchMfsDetailRSQL">
			<desc><![CDATA[searchMfsDetail]]></desc>
			<sql><![CDATA[
SELECT 
    NVL(A.BL_NO,' ')||NVL(A.BL_SPLIT_NO,'  ') BL_NUMBER,
	NVL(A.BL_NO,' ')||NVL(A.BL_SPLIT_NO,'  ') BL_NUMBER2,
    NVL(A.POL_CD,' ') POL_CD,     
	NVL(A.BKG_DEL_CD,' ') BKG_DEL_CD,
    DECODE(A.PCK_QTY,NULL,'N',0,'N','Y') PCK_QTY,
    DECODE(A.PCK_TP_CD,NULL,'N','Y') PCK_TP_CD,
    DECODE(A.GRS_WGT,NULL,'N',0,'N','Y') GRS_WGT,
    DECODE(A.WGT_UT_CD,NULL,'N','Y') WGT_UT_CD,
    DECODE(A.MEAS_QTY,NULL,'N',0,'N','Y') MEAS_QTY,
    DECODE(A.MEAS_UT_CD,NULL,'N','Y') MEAS_UT_CD,
    DECODE(LENGTH(RTRIM(C1.CUST_NM)),NULL,'N','Y') CUST_NM, 
    DECODE(LENGTH(RTRIM(C1.CUST_ADDR)),NULL,'N','Y') CUST_ADDR,
    DECODE(LENGTH(RTRIM(C2.CUST_NM)),NULL,'N','Y') CUST_NM2, 
    DECODE(LENGTH(RTRIM(C2.CUST_ADDR)),NULL,'N','Y') CUST_ADDR2,
    DECODE(LENGTH(RTRIM(C3.CUST_NM)),NULL,'N','Y') CUST_NM3, 
    DECODE(LENGTH(RTRIM(C3.CUST_ADDR)),NULL,'N','Y') CUST_ADDR3,
    DECODE(LENGTH(RTRIM(D.DIFF_RMK)),NULL,'N','Y') DIFF_RMK, 
    DECODE(LENGTH(RTRIM(D.BL_DESC)),NULL,'N','Y') BL_DESC,
    NVL(B.CNTR_NO,' ') CNTR_NO,    
    DECODE(LENGTH(RTRIM(B.CNTR_SEAL_NO)),NULL,'N','Y') CNTR_SEAL_NO,
    NVL(A.LOCL_TS_IND_CD,' ') LOCL_TS_FLG,
    NVL(A.PST_VSL_CD||A.PST_SKD_VOY_NO||A.PST_SKD_DIR_CD,' ') PST_VSL_CD,  
	NVL(A.PST_RLY_POD_CD,' ') PST_RLY_POD_CD,
    NVL(A.FULL_MTY_CD,' ') FULL_MTY_CD,   
	NVL(A.CY_OPR_ID,' ') CY_OPR_CD,
	NVL(@[in_call_sgn_no], ' ') CALL_SGN_NO,
	NVL(TO_CHAR(TO_DATE(@[in_eta_dt],'YYYY-MM-dd'),'YYYY-MM-DD'), ' ') ETA_DT,
	'' SEQ,
    NVL(A.JP_TML_VSL_NO,DECODE((SELECT DECODE(NVL(A.ACT_CRR_CD, B.CRR_CD),'SML','Y','N') CRR_CD
								  FROM VSK_VSL_SKD A, MDM_VSL_CNTR B
								 WHERE 1=1
								   AND A.VSL_CD = SUBSTR(@[in_vvd_cd],1,4)
								   AND A.SKD_VOY_NO = SUBSTR(@[in_vvd_cd],5,4)
 								   AND A.SKD_DIR_CD = SUBSTR(@[in_vvd_cd],9,1)
								   AND A.VSL_CD = B.VSL_CD ),'Y',SUBSTR(@[in_vvd_cd],5,5),' ')) JP_TML_VSL_NO,
    DECODE(LENGTH(RTRIM(C1.PHN_NO)),NULL,'N','Y') PHN_NO,
    DECODE(LENGTH(RTRIM(C2.PHN_NO)),NULL,'N','Y') PHN_NO2,
    DECODE(LENGTH(RTRIM(C3.PHN_NO)),NULL,'N','Y') PHN_NO3,
    DECODE(C1.PHN_NO, (SELECT OFC_PHN_NO
					     FROM MDM_LOCATION ML, MDM_ORGANIZATION MO
					    WHERE ML.EQ_CTRL_OFC_CD = MO.OFC_CD
					      AND ML.LOC_CD         = @[in_pod_cd]), 'D', '', 'N', 'B') AS VIA,
    DECODE(C2.PHN_NO, (SELECT OFC_PHN_NO
					     FROM MDM_LOCATION ML, MDM_ORGANIZATION MO
					    WHERE ML.EQ_CTRL_OFC_CD = MO.OFC_CD
					      AND ML.LOC_CD         = @[in_pod_cd]), 'D', '', 'N', 'B') AS VIA2,
    DECODE(C3.PHN_NO, (SELECT OFC_PHN_NO
					     FROM MDM_LOCATION ML, MDM_ORGANIZATION MO
					    WHERE ML.EQ_CTRL_OFC_CD = MO.OFC_CD
					      AND ML.LOC_CD         = @[in_pod_cd]), 'D', '', 'N', 'B') AS VIA3

FROM 
	BKG_CSTMS_JP_BL A, 
	BKG_CSTMS_JP_BL_CNTR B, 
	BKG_CSTMS_JP_BL_MK D,
  	BKG_CSTMS_JP_BL_CUST C1, 
  	BKG_CSTMS_JP_BL_CUST C2, 
  	BKG_CSTMS_JP_BL_CUST C3
WHERE A.VSL_CD         = @[in_vsl_cd]
AND A.SKD_VOY_NO  = @[in_skd_voy_no]
AND A.SKD_DIR_CD     = @[in_skd_dir_cd]
#if (${in_pol_cd}!= '') 
AND A.POL_CD        = @[in_pol_cd]
#end
AND A.POD_CD        = @[in_pod_cd]
AND A.JP_BL_STS_CD      = 'A'
AND A.BL_NO          = B.BL_NO(+)
AND A.BL_SPLIT_NO    = B.BL_SPLIT_NO(+)
AND B.JP_CSTMS_CNTR_STS_CD(+)   = 'A'
AND A.BL_NO          = D.BL_NO(+)
AND A.BL_SPLIT_NO    = D.BL_SPLIT_NO(+)
AND D.BL_SEQ(+) = 1
AND A.BL_NO          = C1.BL_NO(+)
AND A.BL_SPLIT_NO    = C1.BL_SPLIT_NO(+)
AND C1.BKG_CUST_TP_CD(+)        = 'S'
AND A.BL_NO          = C2.BL_NO(+)
AND A.BL_SPLIT_NO    = C2.BL_SPLIT_NO(+)
AND C2.BKG_CUST_TP_CD(+)     = 'C'
AND A.BL_NO          = C3.BL_NO(+)
AND A.BL_SPLIT_NO    = C3.BL_SPLIT_NO(+)
AND C3.BKG_CUST_TP_CD(+)     = 'N'
#if (${in_err_gb} == 'E') 	
AND ( DECODE(A.PCK_QTY,NULL,'N',0,'N','Y') = 'N'
OR    DECODE(A.PCK_TP_CD,NULL,'N','Y') = 'N'
OR    DECODE(A.GRS_WGT,NULL,'N',0,'N','Y') = 'N'
OR    DECODE(A.WGT_UT_CD,NULL,'N','Y') = 'N'
OR    DECODE(A.MEAS_QTY,NULL,'N',0,'N','Y') = 'N'
OR    DECODE(A.MEAS_UT_CD,NULL,'N','Y') = 'N'
OR    DECODE(LENGTH(RTRIM(C1.CUST_NM)),NULL,'N','Y') = 'N'
OR    DECODE(LENGTH(RTRIM(C1.CUST_ADDR)),NULL,'N','Y') = 'N'
OR    DECODE(LENGTH(RTRIM(C2.CUST_NM)),NULL,'N','Y') = 'N'
OR    DECODE(LENGTH(RTRIM(C2.CUST_ADDR)),NULL,'N','Y') = 'N'
OR    DECODE(LENGTH(RTRIM(C3.CUST_NM)),NULL,'N','Y') = 'N'
OR    DECODE(LENGTH(RTRIM(C3.CUST_ADDR)),NULL,'N','Y') = 'N'
OR    DECODE(LENGTH(RTRIM(B.CNTR_NO)),NULL,'N','Y') = 'N'
OR    DECODE(LENGTH(RTRIM(B.CNTR_SEAL_NO)),NULL,'N','Y') = 'N'
OR    DECODE(LENGTH(RTRIM(D.DIFF_RMK)),NULL,'N','Y') = 'N'
OR    DECODE(LENGTH(RTRIM(D.BL_DESC)),NULL,'N','Y') = 'N' 
OR    DECODE(LENGTH(RTRIM(C1.PHN_NO)),NULL,'N','Y') = 'N' 
OR    DECODE(LENGTH(RTRIM(C2.PHN_NO)),NULL,'N','Y') = 'N' 
OR    DECODE(LENGTH(RTRIM(C3.PHN_NO)),NULL,'N','Y') = 'N'
OR    DECODE(LENGTH(RTRIM(C3.PHN_NO)),NULL,'N','Y') = 'N'
OR    DECODE(C1.PHN_NO, (SELECT OFC_PHN_NO
					       FROM MDM_LOCATION ML, MDM_ORGANIZATION MO
					      WHERE ML.EQ_CTRL_OFC_CD = MO.OFC_CD
					        AND ML.LOC_CD         = @[in_pod_cd]), 'D', '', 'N', 'B') = 'N'
OR    DECODE(C2.PHN_NO, (SELECT OFC_PHN_NO
					       FROM MDM_LOCATION ML, MDM_ORGANIZATION MO
					      WHERE ML.EQ_CTRL_OFC_CD = MO.OFC_CD
					        AND ML.LOC_CD         = @[in_pod_cd]), 'D', '', 'N', 'B') = 'N'
OR    DECODE(C3.PHN_NO, (SELECT OFC_PHN_NO
					       FROM MDM_LOCATION ML, MDM_ORGANIZATION MO
					      WHERE ML.EQ_CTRL_OFC_CD = MO.OFC_CD
					        AND ML.LOC_CD         = @[in_pod_cd]), 'D', '', 'N', 'B') = 'N'
)
#end
#if (${in_bl_type}== '1') 
AND A.LOCL_TS_IND_CD     <> 'T'
#end
#if (${in_bl_type}== '2') 
AND A.LOCL_TS_IND_CD     = 'T'
#end
ORDER BY A.BL_NO||A.BL_SPLIT_NO			]]></sql>
			<params>
				<param name="in_call_sgn_no" type="12" value="" out="N"/>
				<param name="in_eta_dt" type="12" value="" out="N"/>
				<param name="in_vvd_cd" type="12" value="" out="N"/>
				<param name="in_pod_cd" type="12" value="" out="N"/>
				<param name="in_vsl_cd" type="12" value="" out="N"/>
				<param name="in_skd_voy_no" type="12" value="" out="N"/>
				<param name="in_skd_dir_cd" type="12" value="" out="N"/>
				<param name="in_pol_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
