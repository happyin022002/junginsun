<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RFAReportDBDAORsltPriCopiedRFARSQL">
			<desc><![CDATA[RsltPriCopiedRFA]]></desc>
			<sql><![CDATA[
SELECT      
      HDR.RFA_NO AS RFA_NO      
	 ,MN.AMDT_SEQ AS AMDT_SEQ     
	 ,MN.PROP_NO AS PROP_NO     
	 ,LPAD(NVL(HDR.MST_RFA_NO,0),10,0) ||'_'||LPAD(MN.AMDT_SEQ,3,0) AS SOURCE
     ,SCP_MN.SVC_SCP_CD AS SVC_SCP_CD    
	 , MAS.OFC_N3RD_LVL_CD                  AS RHQ_CD
     , MN.PROP_OFC_CD    
	 , MN.PROP_SREP_CD     
	 , TO_CHAR(SCP_MN.EFF_DT,'YYYY-MM-DD') AS EFF_DT
	 , TO_CHAR(SCP_MN.EXP_DT,'YYYY-MM-DD') AS EXP_DT
     , MN.PRC_CTRT_CUST_TP_CD AS PRC_CTRT_CUST_TP_CD
     , (SELECT CUST_LGL_ENG_NM FROM MDM_CUSTOMER WHERE CUST_CNT_CD=MN.CTRT_CUST_CNT_CD AND CUST_SEQ = MN.CTRT_CUST_SEQ  ) AS CUST_LGL_ENG_NM
     , DMDT.DMDT_FT_TP_CD AS DMDT_FT_TP_CD
     , MN.PROP_STS_CD AS PROP_STS_CD     
     
FROM  PRI_RP_HDR                HDR
    , PRI_RP_MN                 MN
    , PRI_RP_SCP_MN             SCP_MN
    , PRI_RP_DMDT               DMDT
    , MAS_OFC_LVL               MAS
WHERE 1 = 1
 AND HDR.PROP_NO    = MN.PROP_NO
  AND MN.PROP_NO     = SCP_MN.PROP_NO
 AND MN.AMDT_SEQ    = SCP_MN.AMDT_SEQ
-----------------------------------------
  AND MN.PROP_NO           = DMDT.PROP_NO
 AND MN.AMDT_SEQ          = DMDT.AMDT_SEQ
 ---------------------------------------
 AND SCP_MN.PROP_SCP_OFC_CD = MAS.OFC_CD(+) 
 AND SCP_MN.EXP_DT <= TO_DATE(MAS.OFC_APLY_TO_YRMON(+),'YYYYMM')
 AND SCP_MN.EFF_DT >= TO_DATE(MAS.OFC_APLY_FM_YRMON(+),'YYYYMM')
 ---------------------------------------
 AND SCP_MN.EFF_DT <= TO_DATE(@[f_exp_dt],'YYYY-MM-DD')
 AND SCP_MN.EXP_DT >= TO_DATE(@[f_eff_dt],'YYYY-MM-DD')
 AND SCP_MN.SVC_SCP_CD = @[f_scp]
 AND MST_RFA_NO IS NOT NULL
 #if( ${f_rfa_no} != '' )
 AND HDR.RFA_NO = @[f_rfa_no]
 #end

 #if( ${f_m_rfa_no} != '')
 AND HDR.MST_RFA_NO = @[f_m_rfa_no]
 #end

 #if( ${f_sls_rep} != '')
 AND MN.PROP_SREP_CD = @[f_sls_rep]
 #end

 #if( ${f_req_ofc} != '')
 AND MN.PROP_OFC_CD = @[f_req_ofc]
 #elseif( ${f_req_rhq} != '')
 AND MAS.OFC_N3RD_LVL_CD = @[f_req_rhq]
 #end


 
 #if( ${f_rfa_tp_b} != '')
 AND (MN.RFA_CTRT_TP_CD = 'B'
		OR (MN.RFA_CTRT_TP_CD IN(''
								,@[f_rfa_tp_c]
								,@[f_rfa_tp_s]
								)
			AND MN.AMDT_SEQ = 0
			)
	
 )
 #else
		AND (MN.RFA_CTRT_TP_CD IN(''
								,@[f_rfa_tp_c]
								,@[f_rfa_tp_s]
								)
			AND MN.AMDT_SEQ = 0
			)
 #end			]]></sql>
			<params>
				<param name="f_exp_dt" type="12" value="" out="N"/>
				<param name="f_eff_dt" type="12" value="" out="N"/>
				<param name="f_scp" type="12" value="" out="N"/>
				<param name="f_rfa_no" type="12" value="" out="N"/>
				<param name="f_m_rfa_no" type="12" value="" out="N"/>
				<param name="f_sls_rep" type="12" value="" out="N"/>
				<param name="f_req_ofc" type="12" value="" out="N"/>
				<param name="f_req_rhq" type="12" value="" out="N"/>
				<param name="f_rfa_tp_c" type="12" value="" out="N"/>
				<param name="f_rfa_tp_s" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
