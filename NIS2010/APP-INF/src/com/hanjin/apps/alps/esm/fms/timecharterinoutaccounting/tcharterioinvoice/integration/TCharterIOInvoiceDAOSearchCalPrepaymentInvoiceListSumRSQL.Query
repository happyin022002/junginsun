<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOInvoiceDAOSearchCalPrepaymentInvoiceListSumRSQL">
			<desc><![CDATA[TCharterIOInvoiceDAOSearchCalPrepaymentInvoiceListSumRSQL]]></desc>
			<sql><![CDATA[
#if(${flet_ctrt_tp_gb} == 'TI')

SELECT CURR_CD,
	   INV_AMT,
	   CURR_CD2,
	   INV_AMT2
  FROM (
		SELECT 
			   CURR_CD,
               CASE WHEN CURR_CD = 'KRW' OR CURR_CD = 'JPY' OR CURR_CD = 'PAB' THEN
						 TO_CHAR(ROUND(SUM(INV_AMT),2),'999,999,999,999,999,999')
                    ELSE 
			   			 TO_CHAR(ROUND(SUM(INV_AMT),2),'999,999,999,999,999,999.00') 
                END INV_AMT, 
			   CURR_CD2,
			   CASE WHEN CURR_CD2 = 'KRW' OR CURR_CD2 = 'JPY' OR CURR_CD2 = 'PAB' THEN
                         TO_CHAR(ROUND(SUM(INV_AMT2),2),'999,999,999,999,999,999')
				    ELSE
			   			 TO_CHAR(ROUND(SUM(INV_AMT2),2),'999,999,999,999,999,999.00') 
                END INV_AMT2,
			   MIN(ACCT_CD) ACCT_CD
		  FROM (
				SELECT  ACCT_ITM_NM,
						ACCT_CD,
						CURR_CD,
						INV_AMT,
						CURR_CD2,
						INV_AMT2 
				  FROM  ( 
						SELECT  ACCT_ITM_NM, 
								ACCT_CD, 
								DECODE(FLET_CURR_CHK_CD,'F',HIR_CURR_N1ST_CD,NULL) CURR_CD,
								DECODE(FLET_CURR_CHK_CD,'F',HIR_RT_N1ST_AMT,NULL) INV_AMT,
								DECODE(FLET_CURR_CHK_CD,'S',HIR_CURR_N1ST_CD,NULL) CURR_CD2,
								DECODE(FLET_CURR_CHK_CD,'S',HIR_RT_N1ST_AMT,NULL) INV_AMT2,
								'1' SORTKEY 
						  FROM ( 
								SELECT MIN(ACCT_ITM_NM) ACCT_ITM_NM,
									   MIN(ACCT_CD) ACCT_CD,
									   HIR_CURR_N1ST_CD,
									   HIR_RT_N1ST_AMT HIR_RT_N1ST_AMT,
									   MIN(FLET_CURR_CHK_CD) FLET_CURR_CHK_CD
								  FROM (SELECT (SELECT ACCT_ITM_NM 
												  FROM FMS_ACCT_ITM
												 WHERE ACCT_CD = '510911'
												   AND ROWNUM = 1) ACCT_ITM_NM,
											   '510911' ACCT_CD, 
											   HIR_CURR_N1ST_CD, 
											   FMS_HIRCURAMT1_FNC(@[flet_ctrt_no], @[ori_eff_dt], @[ori_exp_dt]) HIR_RT_N1ST_AMT, 
											   'F' FLET_CURR_CHK_CD
										  FROM FMS_CONTRACT FC, FMS_HIRE FH 
										 WHERE FC.FLET_CTRT_NO = FH.FLET_CTRT_NO 
										   AND FC.FLET_CTRT_NO = @[flet_ctrt_no] 
										   AND  TO_DATE(@[ori_eff_dt],'YYYYMMDDHH24MI') >= (SELECT MIN(EFF_DT) 
																							  FROM FMS_HIRE 
																							 WHERE FLET_CTRT_NO = @[flet_ctrt_no])
										   AND  TO_DATE(@[ori_exp_dt],'YYYYMMDDHH24MI') <= (SELECT MAX(EXP_DT) 
																							  FROM FMS_HIRE 
																							 WHERE FLET_CTRT_NO = @[flet_ctrt_no])
										   AND  HIR_CURR_N1ST_CD IS NOT NULL
									   ) WHERE  HIR_RT_N1ST_AMT != 0
										 GROUP BY HIR_CURR_N1ST_CD
							    UNION ALL 
								SELECT MIN(ACCT_ITM_NM) ACCT_ITM_NM,
									   MIN(ACCT_CD) ACCT_CD,
									   HIR_CURR_N2ND_CD,
									   HIR_RT_N1ST_AMT HIR_RT_N1ST_AMT,
									   MIN(FLET_CURR_CHK_CD) FLET_CURR_CHK_CD
								  FROM (SELECT (SELECT ACCT_ITM_NM 
												  FROM FMS_ACCT_ITM
												 WHERE ACCT_CD = '510911'
												   AND ROWNUM = 1) ACCT_ITM_NM, 
											   '510911' ACCT_CD, 
											   HIR_CURR_N2ND_CD, 
											   FMS_HIRCURAMT2_FNC(@[flet_ctrt_no], @[ori_eff_dt], @[ori_exp_dt]) HIR_RT_N1ST_AMT,
											   'S' FLET_CURR_CHK_CD
										  FROM FMS_CONTRACT FC, FMS_HIRE FH 
										 WHERE FC.FLET_CTRT_NO = FH.FLET_CTRT_NO 
										   AND FC.FLET_CTRT_NO = @[flet_ctrt_no] 
										   AND  TO_DATE(@[ori_eff_dt],'YYYYMMDDHH24MI') >= (SELECT MIN(EFF_DT) 
																							  FROM FMS_HIRE 
																							 WHERE FLET_CTRT_NO = @[flet_ctrt_no])
										   AND  TO_DATE(@[ori_exp_dt],'YYYYMMDDHH24MI') <= (SELECT MAX(EXP_DT) 
																							  FROM FMS_HIRE 
																							 WHERE FLET_CTRT_NO = @[flet_ctrt_no])
										   AND  HIR_CURR_N2ND_CD IS NOT NULL
									   ) WHERE  HIR_RT_N1ST_AMT != 0
										 GROUP BY HIR_CURR_N2ND_CD
							   ) 
						UNION ALL 
						SELECT	ACCT_ITM_NM, 
								ACCT_CD, 
								DECODE(FLET_CURR_CHK_CD,'F',HIR_CURR_N1ST_CD,NULL) CURR_CD,
								DECODE(FLET_CURR_CHK_CD,'F',HIR_RT_N1ST_AMT,NULL) INV_AMT,
								DECODE(FLET_CURR_CHK_CD,'S',HIR_CURR_N1ST_CD,NULL) CURR_CD2,
								DECODE(FLET_CURR_CHK_CD,'S',HIR_RT_N1ST_AMT,NULL) INV_AMT2,
								'3' SORTKEY 
						  FROM (
								SELECT MIN(ACCT_ITM_NM) ACCT_ITM_NM,
									   MIN(ACCT_CD) ACCT_CD,
									   HIR_CURR_N1ST_CD,
									   ROUND(HIR_RT_N1ST_AMT,2) HIR_RT_N1ST_AMT,
									   MIN(FLET_CURR_CHK_CD) FLET_CURR_CHK_CD
								  FROM (SELECT  (SELECT ACCT_ITM_NM 
												  FROM FMS_ACCT_ITM
												 WHERE ACCT_CD = '510911'
												   AND ROWNUM = 1) ACCT_ITM_NM,
												'510911' ACCT_CD, 
												HIR_CURR_N1ST_CD, 
												- FMS_HIRCURAMT1_FNC(@[flet_ctrt_no], @[ori_eff_dt], @[ori_exp_dt]) * TO_NUMBER(@[acmm_rt_amt]/100) HIR_RT_N1ST_AMT,
												'F' FLET_CURR_CHK_CD
										   FROM FMS_CONTRACT FC, FMS_HIRE FH 
										  WHERE FC.FLET_CTRT_NO = FH.FLET_CTRT_NO 
											AND FC.FLET_CTRT_NO = @[flet_ctrt_no] 
											AND  TO_DATE(@[ori_eff_dt],'YYYYMMDDHH24MI') >= (SELECT MIN(EFF_DT) 
																							   FROM FMS_HIRE 
																							  WHERE FLET_CTRT_NO = @[flet_ctrt_no])
											AND  TO_DATE(@[ori_exp_dt],'YYYYMMDDHH24MI') <= (SELECT MAX(EXP_DT) 
																							   FROM FMS_HIRE 
																							  WHERE FLET_CTRT_NO = @[flet_ctrt_no])
											AND  HIR_CURR_N1ST_CD IS NOT NULL
									   ) WHERE  HIR_RT_N1ST_AMT != 0
										 GROUP BY HIR_CURR_N1ST_CD
								UNION ALL
								SELECT MIN(ACCT_ITM_NM) ACCT_ITM_NM,
									   MIN(ACCT_CD) ACCT_CD,
									   HIR_CURR_N2ND_CD,
									   ROUND(HIR_RT_N1ST_AMT,2) HIR_RT_N1ST_AMT,
									   MIN(FLET_CURR_CHK_CD) FLET_CURR_CHK_CD
								  FROM (SELECT	(SELECT ACCT_ITM_NM 
												  FROM FMS_ACCT_ITM
												 WHERE ACCT_CD = '510911'
												   AND ROWNUM = 1) ACCT_ITM_NM, 
												'510911' ACCT_CD, 
												HIR_CURR_N2ND_CD,
												- FMS_HIRCURAMT2_FNC(@[flet_ctrt_no], @[ori_eff_dt], @[ori_exp_dt]) * TO_NUMBER(@[acmm_rt_amt]/100) HIR_RT_N1ST_AMT,
												'S' FLET_CURR_CHK_CD
										   FROM FMS_CONTRACT FC, FMS_HIRE FH 
										  WHERE FC.FLET_CTRT_NO = FH.FLET_CTRT_NO 
											AND FC.FLET_CTRT_NO = @[flet_ctrt_no] 
											AND  TO_DATE(@[ori_eff_dt],'YYYYMMDDHH24MI') >= (SELECT MIN(EFF_DT) 
																							   FROM FMS_HIRE 
																							  WHERE FLET_CTRT_NO = @[flet_ctrt_no])
											AND  TO_DATE(@[ori_exp_dt],'YYYYMMDDHH24MI') <= (SELECT MAX(EXP_DT) 
																							   FROM FMS_HIRE 
																							  WHERE FLET_CTRT_NO = @[flet_ctrt_no]) 
											AND  HIR_CURR_N2ND_CD IS NOT NULL
									   ) WHERE  HIR_RT_N1ST_AMT != 0
										 GROUP BY HIR_CURR_N2ND_CD
							   ) WHERE @[acmm_flg] = 'Y' 
						UNION ALL 
						SELECT  ACCT_ITM_NM, 
								ACCT_CD, 
								DECODE(FLET_CURR_CHK_CD,'F',HIR_CURR_N1ST_CD,NULL) CURR_CD,
								DECODE(FLET_CURR_CHK_CD,'F',HIR_RT_N1ST_AMT,NULL) INV_AMT,
								DECODE(FLET_CURR_CHK_CD,'S',HIR_CURR_N1ST_CD,NULL) CURR_CD2,
								DECODE(FLET_CURR_CHK_CD,'S',HIR_RT_N1ST_AMT,NULL) INV_AMT2,
								'4' SORTKEY 
						  FROM ( 
								SELECT MIN(ACCT_ITM_NM) ACCT_ITM_NM,
									   MIN(ACCT_CD) ACCT_CD,
									   HIR_CURR_N1ST_CD,
									   HIR_RT_N1ST_AMT HIR_RT_N1ST_AMT,
									   MIN(FLET_CURR_CHK_CD) FLET_CURR_CHK_CD
								  FROM (SELECT	(SELECT ACCT_ITM_NM
												   FROM FMS_ACCT_ITM
												  WHERE ACCT_CD = '512641'
													AND ACCT_ITM_SEQ = 41
													AND ROWNUM = 1) ACCT_ITM_NM,
												'512641' ACCT_CD, 
												HIR_CURR_N1ST_CD, 
												FMS_HIRCURAMT1_FNC(@[flet_ctrt_no], @[ori_eff_dt], @[ori_exp_dt]) * TO_NUMBER(@[flet_brog_rt_amt]/100) HIR_RT_N1ST_AMT, 
												'F' FLET_CURR_CHK_CD
										  FROM  FMS_CONTRACT FC, FMS_HIRE FH 
										 WHERE  FC.FLET_CTRT_NO = FH.FLET_CTRT_NO 
										   AND  FC.FLET_CTRT_NO = @[flet_ctrt_no] 
										   AND  TO_DATE(@[ori_eff_dt],'YYYYMMDDHH24MI') >= (SELECT MIN(EFF_DT) 
																							  FROM FMS_HIRE 
																							 WHERE FLET_CTRT_NO = @[flet_ctrt_no])
										   AND  TO_DATE(@[ori_exp_dt],'YYYYMMDDHH24MI') <= (SELECT MAX(EXP_DT) 
																							  FROM FMS_HIRE 
																							 WHERE FLET_CTRT_NO = @[flet_ctrt_no]) 
										   AND  HIR_CURR_N1ST_CD IS NOT NULL
									   ) WHERE  HIR_RT_N1ST_AMT != 0
										 GROUP BY HIR_CURR_N1ST_CD
								UNION ALL 
								SELECT MIN(ACCT_ITM_NM) ACCT_ITM_NM,
									   MIN(ACCT_CD) ACCT_CD,
									   HIR_CURR_N2ND_CD,
									   HIR_RT_N1ST_AMT HIR_RT_N1ST_AMT,
									   MIN(FLET_CURR_CHK_CD) FLET_CURR_CHK_CD
								  FROM (SELECT	(SELECT ACCT_ITM_NM
												   FROM FMS_ACCT_ITM
												  WHERE ACCT_CD = '512641'
													AND ACCT_ITM_SEQ = 41
													AND ROWNUM = 1) ACCT_ITM_NM,
												'512641' ACCT_CD, 
												HIR_CURR_N2ND_CD, 
												FMS_HIRCURAMT2_FNC(@[flet_ctrt_no], @[ori_eff_dt], @[ori_exp_dt]) * TO_NUMBER(@[flet_brog_rt_amt]/100) HIR_RT_N1ST_AMT,
												'S' FLET_CURR_CHK_CD
										  FROM  FMS_CONTRACT FC, FMS_HIRE FH 
										 WHERE  FC.FLET_CTRT_NO = FH.FLET_CTRT_NO 
										   AND  FC.FLET_CTRT_NO = @[flet_ctrt_no] 
										   AND  TO_DATE(@[ori_eff_dt],'YYYYMMDDHH24MI') >= (SELECT MIN(EFF_DT) 
																							  FROM FMS_HIRE 
																							 WHERE FLET_CTRT_NO = @[flet_ctrt_no])
										   AND  TO_DATE(@[ori_exp_dt],'YYYYMMDDHH24MI') <= (SELECT MAX(EXP_DT) 
																							  FROM FMS_HIRE 
																							 WHERE FLET_CTRT_NO = @[flet_ctrt_no]) 
										   AND  HIR_CURR_N2ND_CD IS NOT NULL
									   ) WHERE  HIR_RT_N1ST_AMT != 0
										 GROUP BY HIR_CURR_N2ND_CD
							   ) WHERE @[brog_flg] = 'Y' 
						UNION ALL 
						SELECT ACCT_ITM_NM,
							   ACCT_CD,
							   HIR_CURR_N1ST_CD,
							   HIR_RT_N1ST_AMT,
							   HIR_CURR_N2ND_CD,
							   HIR_RT_N2ND_AMT,
							   SORTKEY
						  FROM ( 
								SELECT	ACCT_ITM_NM, 
										ACCT_CD, 
										MIN(HIR_CURR_N1ST_CD) HIR_CURR_N1ST_CD, 
										FMS_OTRAMT_FNC(@[flet_ctrt_no], ACCT_CD, ACCT_ITM_SEQ, @[ori_eff_dt], @[ori_exp_dt]) HIR_RT_N1ST_AMT, 
										MIN(HIR_CURR_N2ND_CD) HIR_CURR_N2ND_CD, 
										MIN(HIR_RT_N2ND_AMT) HIR_RT_N2ND_AMT,
										ACCT_ITM_SEQ,
										MIN(EFF_DT) EFF_DT,
										MAX(EXP_DT) EXP_DT,
										'2' SORTKEY 
								  FROM ( 
										SELECT	(SELECT ACCT_ITM_NM 
												   FROM FMS_ACCT_ITM 
												  WHERE ACCT_CD = FO.ACCT_CD 
													AND ACCT_ITM_SEQ = FO.ACCT_ITM_SEQ 
													AND ROWNUM =1) ACCT_ITM_NM, 
												FO.ACCT_CD, 
												FO.CURR_CD HIR_CURR_N1ST_CD, 
												FO.OTR_EXPN_AMT / TO_NUMBER(@[ori_inv_usd_dys]) * TO_NUMBER(@[inv_usd_dys]) HIR_RT_N1ST_AMT, 
												NULL HIR_CURR_N2ND_CD, 
												0 HIR_RT_N2ND_AMT,
												FO.ACCT_ITM_SEQ,
												FO.EFF_DT,
												FO.EXP_DT
										  FROM  FMS_CONTRACT FC, FMS_OTR_EXPN FO 
										 WHERE  FC.FLET_CTRT_NO = FO.FLET_CTRT_NO 
										   AND  FC.FLET_CTRT_NO = @[flet_ctrt_no] 
										   AND  TO_DATE(SUBSTR(@[ori_eff_dt],1,8),'YYYYMMDD') >= (SELECT MIN(EFF_DT) 
																					          FROM FMS_OTR_EXPN 
																					         WHERE FLET_CTRT_NO = @[flet_ctrt_no])
										   AND  TO_DATE(SUBSTR(@[ori_exp_dt],1,8),'YYYYMMDD') <= (SELECT CASE WHEN MAX(EXP_DT) >= TO_DATE(SUBSTR(@[ori_exp_dt],1,8),'YYYYMMDD') THEN
                 																							       MAX(EXP_DT)
            																						          ELSE
                 																							       MAX(EXP_DT) + 1
        																						          END EXP_DT 
																					          FROM FMS_OTR_EXPN 
																					         WHERE FLET_CTRT_NO = @[flet_ctrt_no])
									   ) 
								 GROUP BY ACCT_ITM_NM, ACCT_CD, ACCT_ITM_SEQ
							 ) 
						) ORDER BY SORTKEY ASC, ACCT_CD ASC, CURR_CD ASC
				) GROUP BY CURR_CD, CURR_CD2
		) ORDER BY ACCT_CD

#else

SELECT CURR_CD,
	   INV_AMT,
	   CURR_CD2,
	   INV_AMT2
  FROM (
		SELECT 
			   CURR_CD, 
			   CASE WHEN CURR_CD = 'KRW' OR CURR_CD = 'JPY' OR CURR_CD = 'PAB' THEN
						 TO_CHAR(ROUND(SUM(INV_AMT),2),'999,999,999,999,999,999')
					ELSE
			   		     TO_CHAR(ROUND(SUM(INV_AMT),2),'999,999,999,999,999,999.00') 
				END INV_AMT, 
			   CURR_CD2,
			   CASE WHEN CURR_CD2 = 'KRW' OR CURR_CD2 = 'JPY' OR CURR_CD2 = 'PAB' THEN
						 TO_CHAR(ROUND(SUM(INV_AMT2),2),'999,999,999,999,999,999')
					ELSE
			   			 TO_CHAR(ROUND(SUM(INV_AMT2),2),'999,999,999,999,999,999.00') 
				END INV_AMT2,
			   MIN(ACCT_CD) ACCT_CD
		  FROM (
				SELECT  ACCT_ITM_NM,
						ACCT_CD,
						CURR_CD,
						INV_AMT,
						CURR_CD2,
						INV_AMT2 
				  FROM  ( 
						SELECT  ACCT_ITM_NM, 
								ACCT_CD, 
								DECODE(FLET_CURR_CHK_CD,'F',HIR_CURR_N1ST_CD,NULL) CURR_CD,
								DECODE(FLET_CURR_CHK_CD,'F',HIR_RT_N1ST_AMT,NULL) INV_AMT,
								DECODE(FLET_CURR_CHK_CD,'S',HIR_CURR_N1ST_CD,NULL) CURR_CD2,
								DECODE(FLET_CURR_CHK_CD,'S',HIR_RT_N1ST_AMT,NULL) INV_AMT2,
								'1' SORTKEY 
						  FROM ( 
								SELECT MIN(ACCT_ITM_NM) ACCT_ITM_NM,
									   MIN(ACCT_CD) ACCT_CD,
									   HIR_CURR_N1ST_CD,
									   HIR_RT_N1ST_AMT HIR_RT_N1ST_AMT,
									   MIN(FLET_CURR_CHK_CD) FLET_CURR_CHK_CD
								  FROM (SELECT (SELECT ACCT_ITM_NM 
												  FROM FMS_ACCT_ITM
												 WHERE ACCT_CD = '510911'
												   AND ROWNUM = 1) ACCT_ITM_NM,
											   '510911' ACCT_CD, 
											   HIR_CURR_N1ST_CD, 
											   FMS_HIRCURAMT1_FNC(@[flet_ctrt_no], @[ori_eff_dt], @[ori_exp_dt]) HIR_RT_N1ST_AMT, 
											   'F' FLET_CURR_CHK_CD
										  FROM FMS_CONTRACT FC, FMS_HIRE FH 
										 WHERE FC.FLET_CTRT_NO = FH.FLET_CTRT_NO 
										   AND FC.FLET_CTRT_NO = @[flet_ctrt_no] 
										   AND  TO_DATE(@[ori_eff_dt],'YYYYMMDDHH24MI') >= (SELECT MIN(EFF_DT) 
																							  FROM FMS_HIRE 
																							 WHERE FLET_CTRT_NO = @[flet_ctrt_no])
										   AND  TO_DATE(@[ori_exp_dt],'YYYYMMDDHH24MI') <= (SELECT MAX(EXP_DT) 
																							  FROM FMS_HIRE 
																							 WHERE FLET_CTRT_NO = @[flet_ctrt_no])
										   AND  HIR_CURR_N1ST_CD IS NOT NULL
									   ) WHERE  HIR_RT_N1ST_AMT != 0
										 GROUP BY HIR_CURR_N1ST_CD
							    UNION ALL 
								SELECT MIN(ACCT_ITM_NM) ACCT_ITM_NM,
									   MIN(ACCT_CD) ACCT_CD,
									   HIR_CURR_N2ND_CD,
									   HIR_RT_N1ST_AMT HIR_RT_N1ST_AMT,
									   MIN(FLET_CURR_CHK_CD) FLET_CURR_CHK_CD
								  FROM (SELECT (SELECT ACCT_ITM_NM 
												  FROM FMS_ACCT_ITM
												 WHERE ACCT_CD = '510911'
												   AND ROWNUM = 1) ACCT_ITM_NM, 
											   '510911' ACCT_CD, 
											   HIR_CURR_N2ND_CD, 
											   FMS_HIRCURAMT2_FNC(@[flet_ctrt_no], @[ori_eff_dt], @[ori_exp_dt]) HIR_RT_N1ST_AMT,
											   'S' FLET_CURR_CHK_CD
										  FROM FMS_CONTRACT FC, FMS_HIRE FH 
										 WHERE FC.FLET_CTRT_NO = FH.FLET_CTRT_NO 
										   AND FC.FLET_CTRT_NO = @[flet_ctrt_no] 
										   AND  TO_DATE(@[ori_eff_dt],'YYYYMMDDHH24MI') >= (SELECT MIN(EFF_DT) 
																							  FROM FMS_HIRE 
																							 WHERE FLET_CTRT_NO = @[flet_ctrt_no])
										   AND  TO_DATE(@[ori_exp_dt],'YYYYMMDDHH24MI') <= (SELECT MAX(EXP_DT) 
																							  FROM FMS_HIRE 
																							 WHERE FLET_CTRT_NO = @[flet_ctrt_no])
										   AND  HIR_CURR_N2ND_CD IS NOT NULL
									   ) WHERE  HIR_RT_N1ST_AMT != 0
										 GROUP BY HIR_CURR_N2ND_CD
							   ) 
						UNION ALL 
						SELECT	ACCT_ITM_NM, 
								ACCT_CD, 
								DECODE(FLET_CURR_CHK_CD,'F',HIR_CURR_N1ST_CD,NULL) CURR_CD,
								DECODE(FLET_CURR_CHK_CD,'F',HIR_RT_N1ST_AMT,NULL) INV_AMT,
								DECODE(FLET_CURR_CHK_CD,'S',HIR_CURR_N1ST_CD,NULL) CURR_CD2,
								DECODE(FLET_CURR_CHK_CD,'S',HIR_RT_N1ST_AMT,NULL) INV_AMT2,
								'3' SORTKEY 
						  FROM (
								SELECT MIN(ACCT_ITM_NM) ACCT_ITM_NM,
									   MIN(ACCT_CD) ACCT_CD,
									   HIR_CURR_N1ST_CD,
									   ROUND(HIR_RT_N1ST_AMT,2) HIR_RT_N1ST_AMT,
									   MIN(FLET_CURR_CHK_CD) FLET_CURR_CHK_CD
								  FROM (SELECT  (SELECT ACCT_ITM_NM 
												  FROM FMS_ACCT_ITM
												 WHERE ACCT_CD = '510911'
												   AND ROWNUM = 1) ACCT_ITM_NM,
												'510911' ACCT_CD, 
												HIR_CURR_N1ST_CD, 
												- FMS_HIRCURAMT1_FNC(@[flet_ctrt_no], @[ori_eff_dt], @[ori_exp_dt]) * TO_NUMBER(@[acmm_rt_amt]/100) HIR_RT_N1ST_AMT,
												'F' FLET_CURR_CHK_CD
										   FROM FMS_CONTRACT FC, FMS_HIRE FH 
										  WHERE FC.FLET_CTRT_NO = FH.FLET_CTRT_NO 
											AND FC.FLET_CTRT_NO = @[flet_ctrt_no] 
											AND  TO_DATE(@[ori_eff_dt],'YYYYMMDDHH24MI') >= (SELECT MIN(EFF_DT) 
																							   FROM FMS_HIRE 
																							  WHERE FLET_CTRT_NO = @[flet_ctrt_no])
											AND  TO_DATE(@[ori_exp_dt],'YYYYMMDDHH24MI') <= (SELECT MAX(EXP_DT) 
																							   FROM FMS_HIRE 
																							  WHERE FLET_CTRT_NO = @[flet_ctrt_no])
											AND  HIR_CURR_N1ST_CD IS NOT NULL
									   ) WHERE  HIR_RT_N1ST_AMT != 0
										 GROUP BY HIR_CURR_N1ST_CD
								UNION ALL
								SELECT MIN(ACCT_ITM_NM) ACCT_ITM_NM,
									   MIN(ACCT_CD) ACCT_CD,
									   HIR_CURR_N2ND_CD,
									   ROUND(HIR_RT_N1ST_AMT,2) HIR_RT_N1ST_AMT,
									   MIN(FLET_CURR_CHK_CD) FLET_CURR_CHK_CD
								  FROM (SELECT	(SELECT ACCT_ITM_NM 
												  FROM FMS_ACCT_ITM
												 WHERE ACCT_CD = '510911'
												   AND ROWNUM = 1) ACCT_ITM_NM, 
												'510911' ACCT_CD, 
												HIR_CURR_N2ND_CD,
												- FMS_HIRCURAMT2_FNC(@[flet_ctrt_no], @[ori_eff_dt], @[ori_exp_dt]) * TO_NUMBER(@[acmm_rt_amt]/100) HIR_RT_N1ST_AMT,
												'S' FLET_CURR_CHK_CD
										   FROM FMS_CONTRACT FC, FMS_HIRE FH 
										  WHERE FC.FLET_CTRT_NO = FH.FLET_CTRT_NO 
											AND FC.FLET_CTRT_NO = @[flet_ctrt_no] 
											AND  TO_DATE(@[ori_eff_dt],'YYYYMMDDHH24MI') >= (SELECT MIN(EFF_DT) 
																							   FROM FMS_HIRE 
																							  WHERE FLET_CTRT_NO = @[flet_ctrt_no])
											AND  TO_DATE(@[ori_exp_dt],'YYYYMMDDHH24MI') <= (SELECT MAX(EXP_DT) 
																							   FROM FMS_HIRE 
																							  WHERE FLET_CTRT_NO = @[flet_ctrt_no]) 
											AND  HIR_CURR_N2ND_CD IS NOT NULL
									   ) WHERE  HIR_RT_N1ST_AMT != 0
										 GROUP BY HIR_CURR_N2ND_CD
							   ) WHERE @[acmm_flg] = 'Y' 
						UNION ALL 
						SELECT  ACCT_ITM_NM, 
								ACCT_CD, 
								DECODE(FLET_CURR_CHK_CD,'F',HIR_CURR_N1ST_CD,NULL) CURR_CD,
								DECODE(FLET_CURR_CHK_CD,'F',HIR_RT_N1ST_AMT,NULL) INV_AMT,
								DECODE(FLET_CURR_CHK_CD,'S',HIR_CURR_N1ST_CD,NULL) CURR_CD2,
								DECODE(FLET_CURR_CHK_CD,'S',HIR_RT_N1ST_AMT,NULL) INV_AMT2,
								'4' SORTKEY 
						  FROM ( 
								SELECT MIN(ACCT_ITM_NM) ACCT_ITM_NM,
									   MIN(ACCT_CD) ACCT_CD,
									   HIR_CURR_N1ST_CD,
									   HIR_RT_N1ST_AMT HIR_RT_N1ST_AMT,
									   MIN(FLET_CURR_CHK_CD) FLET_CURR_CHK_CD
								  FROM (SELECT	(SELECT ACCT_ITM_NM
												   FROM FMS_ACCT_ITM
												  WHERE ACCT_CD = '512641'
													AND ACCT_ITM_SEQ = 41
													AND ROWNUM = 1) ACCT_ITM_NM,
												'512641' ACCT_CD, 
												HIR_CURR_N1ST_CD, 
												FMS_HIRCURAMT1_FNC(@[flet_ctrt_no], @[ori_eff_dt], @[ori_exp_dt]) * TO_NUMBER(@[flet_brog_rt_amt]/100)* -1 HIR_RT_N1ST_AMT, 
												'F' FLET_CURR_CHK_CD
										  FROM  FMS_CONTRACT FC, FMS_HIRE FH 
										 WHERE  FC.FLET_CTRT_NO = FH.FLET_CTRT_NO 
										   AND  FC.FLET_CTRT_NO = @[flet_ctrt_no] 
										   AND  TO_DATE(@[ori_eff_dt],'YYYYMMDDHH24MI') >= (SELECT MIN(EFF_DT) 
																							  FROM FMS_HIRE 
																							 WHERE FLET_CTRT_NO = @[flet_ctrt_no])
										   AND  TO_DATE(@[ori_exp_dt],'YYYYMMDDHH24MI') <= (SELECT MAX(EXP_DT) 
																							  FROM FMS_HIRE 
																							 WHERE FLET_CTRT_NO = @[flet_ctrt_no]) 
										   AND  HIR_CURR_N1ST_CD IS NOT NULL
									   ) WHERE  HIR_RT_N1ST_AMT != 0
										 GROUP BY HIR_CURR_N1ST_CD
								UNION ALL 
								SELECT MIN(ACCT_ITM_NM) ACCT_ITM_NM,
									   MIN(ACCT_CD) ACCT_CD,
									   HIR_CURR_N2ND_CD,
									   HIR_RT_N1ST_AMT HIR_RT_N1ST_AMT,
									   MIN(FLET_CURR_CHK_CD) FLET_CURR_CHK_CD
								  FROM (SELECT	(SELECT ACCT_ITM_NM
												   FROM FMS_ACCT_ITM
												  WHERE ACCT_CD = '512641'
													AND ACCT_ITM_SEQ = 41
													AND ROWNUM = 1) ACCT_ITM_NM,
												'512641' ACCT_CD, 
												HIR_CURR_N2ND_CD, 
												FMS_HIRCURAMT2_FNC(@[flet_ctrt_no], @[ori_eff_dt], @[ori_exp_dt]) * TO_NUMBER(@[flet_brog_rt_amt]/100)* -1 HIR_RT_N1ST_AMT,
												'S' FLET_CURR_CHK_CD
										  FROM  FMS_CONTRACT FC, FMS_HIRE FH 
										 WHERE  FC.FLET_CTRT_NO = FH.FLET_CTRT_NO 
										   AND  FC.FLET_CTRT_NO = @[flet_ctrt_no] 
										   AND  TO_DATE(@[ori_eff_dt],'YYYYMMDDHH24MI') >= (SELECT MIN(EFF_DT) 
																							  FROM FMS_HIRE 
																							 WHERE FLET_CTRT_NO = @[flet_ctrt_no])
										   AND  TO_DATE(@[ori_exp_dt],'YYYYMMDDHH24MI') <= (SELECT MAX(EXP_DT) 
																							  FROM FMS_HIRE 
																							 WHERE FLET_CTRT_NO = @[flet_ctrt_no]) 
										   AND  HIR_CURR_N2ND_CD IS NOT NULL
									   ) WHERE  HIR_RT_N1ST_AMT != 0
										 GROUP BY HIR_CURR_N2ND_CD
							   ) WHERE @[brog_flg] = 'Y' 
						UNION ALL 
						SELECT ACCT_ITM_NM,
							   ACCT_CD,
							   HIR_CURR_N1ST_CD,
							   HIR_RT_N1ST_AMT,
							   HIR_CURR_N2ND_CD,
							   HIR_RT_N2ND_AMT,
							   SORTKEY
						  FROM ( 
								SELECT	ACCT_ITM_NM, 
										ACCT_CD, 
										MIN(HIR_CURR_N1ST_CD) HIR_CURR_N1ST_CD, 
										FMS_OTRAMT_FNC(@[flet_ctrt_no], ACCT_CD, ACCT_ITM_SEQ, @[ori_eff_dt], @[ori_exp_dt]) HIR_RT_N1ST_AMT, 
										MIN(HIR_CURR_N2ND_CD) HIR_CURR_N2ND_CD, 
										MIN(HIR_RT_N2ND_AMT) HIR_RT_N2ND_AMT,
										ACCT_ITM_SEQ,
										MIN(EFF_DT) EFF_DT,
										MAX(EXP_DT) EXP_DT,
										'2' SORTKEY 
								  FROM ( 
										SELECT	(SELECT ACCT_ITM_NM 
												   FROM FMS_ACCT_ITM 
												  WHERE ACCT_CD = FO.ACCT_CD 
													AND ACCT_ITM_SEQ = FO.ACCT_ITM_SEQ 
													AND ROWNUM =1) ACCT_ITM_NM, 
												FO.ACCT_CD, 
												FO.CURR_CD HIR_CURR_N1ST_CD, 
												FO.OTR_EXPN_AMT / TO_NUMBER(@[ori_inv_usd_dys]) * TO_NUMBER(@[inv_usd_dys]) HIR_RT_N1ST_AMT, 
												NULL HIR_CURR_N2ND_CD, 
												0 HIR_RT_N2ND_AMT,
												FO.ACCT_ITM_SEQ,
												FO.EFF_DT,
												FO.EXP_DT
										  FROM  FMS_CONTRACT FC, FMS_OTR_EXPN FO 
										 WHERE  FC.FLET_CTRT_NO = FO.FLET_CTRT_NO 
										   AND  FC.FLET_CTRT_NO = @[flet_ctrt_no] 
										   AND  TO_DATE(@[ori_eff_dt],'YYYYMMDDHH24MI') >= (SELECT MIN(EFF_DT) 
																					          FROM FMS_OTR_EXPN 
																					         WHERE FLET_CTRT_NO = @[flet_ctrt_no])
										   AND  TO_DATE(@[ori_exp_dt],'YYYYMMDDHH24MI') <= (SELECT CASE WHEN MAX(EXP_DT) >= TO_DATE(@[ori_exp_dt],'YYYYMMDDHH24MI') THEN
                 																							 MAX(EXP_DT)
            																						    ELSE
                 																							 MAX(EXP_DT) + 1
        																						    END EXP_DT 
																					          FROM FMS_OTR_EXPN 
																					         WHERE FLET_CTRT_NO = @[flet_ctrt_no])
									   ) 
								 GROUP BY ACCT_ITM_NM, ACCT_CD, ACCT_ITM_SEQ
							 ) 
						) ORDER BY SORTKEY ASC, ACCT_CD ASC, CURR_CD ASC
				) GROUP BY CURR_CD, CURR_CD2
		) ORDER BY ACCT_CD

#end			]]></sql>
			<params>
				<param name="flet_ctrt_no" type="12" value="" out="N"/>
				<param name="ori_eff_dt" type="12" value="" out="N"/>
				<param name="ori_exp_dt" type="12" value="" out="N"/>
				<param name="acmm_rt_amt" type="12" value="" out="N"/>
				<param name="acmm_flg" type="12" value="" out="N"/>
				<param name="flet_brog_rt_amt" type="12" value="" out="N"/>
				<param name="brog_flg" type="12" value="" out="N"/>
				<param name="ori_inv_usd_dys" type="12" value="" out="N"/>
				<param name="inv_usd_dys" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
