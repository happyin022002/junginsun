<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOInvoiceDBDAOSearchGlInquiryOwnerInvoiceListRSQL">
			<desc><![CDATA[GL Inquiry Owner Accout 정보를 조회한다]]></desc>
			<sql><![CDATA[
SELECT VVD_CD
     , N1ST_CURR_CD
     , N1ST_AMT
     , ORG_SLP_NO
     , SLP_NO
     , CXL_SLP_NO
     , AP_DESC
     , EFF_DT
     , ACCT_CD
     , CTR_CD
     , STL_DT
     , SUM(N1ST_AMT) OVER(PARTITION BY ORG_SLP_NO, STL_DT) ORG_SUM_AMT
     , MAX(EFF_DT) OVER(PARTITION BY ORG_SLP_NO, STL_DT) MAX_EFF_DT
FROM (
        SELECT VVD_CD
             , N1ST_CURR_CD
             , N1ST_AMT
             , DECODE(SUBSTR(OWNR_SLP_NO, 3, 1), 'C', (SELECT PAIR_SLP_TP_CD||PAIR_SLP_FUNC_CD||PAIR_SLP_OFC_CD||PAIR_SLP_ISS_DT||PAIR_SLP_SER_NO||PAIR_SLP_SEQ_NO
                                                       FROM FMS_OWNR_ACCT_SLP
                                                       WHERE SLP_TP_CD||SLP_FUNC_CD||SLP_OFC_CD||SLP_ISS_DT||SLP_SER_NO||SLP_SEQ_NO = OWNR_SLP_NO), OWNR_SLP_NO) ORG_SLP_NO
             , SLP_NO
             , DECODE(SUBSTR(OWNR_SLP_NO, 3, 1), 'C', OWNR_SLP_NO, '') CXL_SLP_NO
             , AP_DESC
             , EFF_DT
             , ACCT_CD
             , CTR_CD
             , STL_DT
             , CRE_DT
        FROM (     
                 SELECT D.VSL_CD||D.SKD_VOY_NO||D.SKD_DIR_CD||D.REV_DIR_CD VVD_CD
                      , D.CSR_CURR_CD N1ST_CURR_CD
                      , D.CSR_AMT N1ST_AMT
                      , NVL(D.ORG_SLP_TP_CD||D.ORG_SLP_FUNC_CD||D.ORG_SLP_OFC_CD||D.ORG_ISS_DT||D.ORG_SLP_SER_NO||D.ORG_SLP_SEQ_NO, 
                            D.AP_SLP_TP_CD||D.AP_SLP_FUNC_CD||D.AP_SLP_OFC_CD||D.AP_SLP_ISS_DT||D.AP_SLP_SER_NO||D.AP_SLP_SEQ_NO) OWNR_SLP_NO
                      , D.SLP_TP_CD||D.SLP_FUNC_CD||D.SLP_OFC_CD||D.SLP_ISS_DT||D.SLP_SER_NO||D.SLP_SEQ_NO SLP_NO
                      , D.CSR_DESC AP_DESC
                      , M.EFF_DT EFF_DT
                      , D.ACCT_CD ACCT_CD
                      , D.CTR_CD CTR_CD
                      , D.STL_DT  
                      , D.CRE_DT    
                 FROM FMS_CONSULTATION M,  
                      FMS_CSUL_SLP D
                 WHERE M.SLP_TP_CD = D.SLP_TP_CD
                 AND M.SLP_FUNC_CD = D.SLP_FUNC_CD
                 AND M.SLP_OFC_CD = D.SLP_OFC_CD
                 AND M.SLP_ISS_DT = D.SLP_ISS_DT
                 AND M.SLP_SER_NO = D.SLP_SER_NO
                 AND M.APRO_FLG = 'Y'
                 AND M.CXL_FLG = 'N'
                 AND D.ACCT_CD = '111071'    
                 #if (${dt_opt} == 'L') 
                    AND M.EFF_DT <= @[ldgr_dt]
                    AND (D.STL_DT IS NULL OR D.STL_DT > @[ldgr_dt])
                 #else
                    AND M.EFF_DT >= @[eff_dt1] 
                    AND M.EFF_DT <= @[eff_dt2]
                 #end
                 #if (${stl_flg} == 'Y')
                    AND D.STL_DT IS NOT NULL
                 #elseif (${stl_flg} == 'N')
                    AND D.STL_DT IS NULL
                 #end 
                 #if (${vsl_cd} != '')                                                                               
                    AND D.VSL_CD = @[vsl_cd]                                                                          
                 #end
             )
	 )
ORDER BY ORG_SLP_NO, CRE_DT			]]></sql>
			<params>
				<param name="ldgr_dt" type="12" value="" out="N"/>
				<param name="eff_dt1" type="12" value="" out="N"/>
				<param name="eff_dt2" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
