<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="IHCGuideLineDBDAOModifyIHCGuidelineDetailDiffUSQL">
			<desc><![CDATA[update OPTM_TRSP_MOD_FLG = 'Y' 's guideline diff cal
* History
2013.03.16 전지예 [CHM-201534279] Pricing Feeder/IHC tariff 45" 칼럼 추가 안]]></desc>
			<sql><![CDATA[
UPDATE /*+ bypass_ujvc */
(           
       SELECT DECODE(IHC.OPTM_TRSP_MOD_FLG,'N',DECODE(SUBSTR(CALC_20FT_FRT_RT_AMT,1,1),'Y',TO_NUMBER(REPLACE(CALC_20FT_FRT_RT_AMT,'Y','')),0)+IHC.ORG_COST_20FT_FRT_RT_AMT,IHC.GLINE_20FT_FRT_RT_AMT) CALC_20FT_FRT_RT_AMT
             ,DECODE(IHC.OPTM_TRSP_MOD_FLG,'N',DECODE(SUBSTR(CALC_40FT_FRT_RT_AMT,1,1),'Y',TO_NUMBER(REPLACE(CALC_40FT_FRT_RT_AMT,'Y','')),0)+IHC.ORG_COST_40FT_FRT_RT_AMT,IHC.GLINE_40FT_FRT_RT_AMT) CALC_40FT_FRT_RT_AMT
             ,DECODE(IHC.OPTM_TRSP_MOD_FLG,'N',DECODE(SUBSTR(CALC_45FT_FRT_RT_AMT,1,1),'Y',TO_NUMBER(REPLACE(CALC_45FT_FRT_RT_AMT,'Y','')),0)+IHC.ORG_COST_45FT_FRT_RT_AMT,IHC.GLINE_45FT_FRT_RT_AMT) CALC_45FT_FRT_RT_AMT -- 45' Cost 추가
             , UPD_IHC.*
       FROM (  
         SELECT MAX( OPTM_TRSP_MOD_FLG||(GLINE_20FT_FRT_RT_AMT-ORG_COST_20FT_FRT_RT_AMT) ) OVER(PARTITION BY PNT_LOC_CD, BSE_PORT_LOC_CD  )  AS CALC_20FT_FRT_RT_AMT
                 ,MAX( OPTM_TRSP_MOD_FLG||(GLINE_40FT_FRT_RT_AMT-ORG_COST_40FT_FRT_RT_AMT) ) OVER(PARTITION BY PNT_LOC_CD, BSE_PORT_LOC_CD  )  AS CALC_40FT_FRT_RT_AMT
                 ,MAX( OPTM_TRSP_MOD_FLG||(GLINE_45FT_FRT_RT_AMT-ORG_COST_45FT_FRT_RT_AMT) ) OVER(PARTITION BY PNT_LOC_CD, BSE_PORT_LOC_CD  )  AS CALC_45FT_FRT_RT_AMT -- 45' Cost 추가
           ,IHC.*
         FROM PRI_TRF_IHC_RT IHC
         WHERE SVC_SCP_CD = @[svc_scp_cd] AND IHC_TRF_NO = @[ihc_trf_no]  AND AMDT_SEQ = @[amdt_seq] AND ORG_DEST_TP_CD = @[org_dest_tp_cd] 
         ORDER BY PNT_LOC_CD,BSE_PORT_LOC_CD,OPTM_TRSP_MOD_FLG DESC
       )  IHC
       , PRI_TRF_IHC_RT UPD_IHC
       WHERE UPD_IHC.SVC_SCP_CD = @[svc_scp_cd] AND UPD_IHC.IHC_TRF_NO = @[ihc_trf_no]  
         AND UPD_IHC.AMDT_SEQ = @[amdt_seq]     AND UPD_IHC.ORG_DEST_TP_CD = @[org_dest_tp_cd]
         AND IHC.SVC_SCP_CD = UPD_IHC.SVC_SCP_CD
         AND IHC.IHC_TRF_NO = UPD_IHC.IHC_TRF_NO
         AND IHC.AMDT_SEQ = UPD_IHC.AMDT_SEQ
         AND IHC.RT_SEQ = UPD_IHC.RT_SEQ
         AND IHC.ORG_DEST_TP_CD = UPD_IHC.ORG_DEST_TP_CD
         AND IHC.IHC_CGO_TP_CD = UPD_IHC.IHC_CGO_TP_CD
)
SET 
GLINE_20FT_FRT_RT_AMT = DECODE(OPTM_TRSP_MOD_FLG,'Y',GLINE_20FT_FRT_RT_AMT, CALC_20FT_FRT_RT_AMT)
, GLINE_40FT_FRT_RT_AMT = DECODE(OPTM_TRSP_MOD_FLG,'Y',GLINE_40FT_FRT_RT_AMT, CALC_40FT_FRT_RT_AMT)
, GLINE_45FT_FRT_RT_AMT = DECODE(OPTM_TRSP_MOD_FLG,'Y',GLINE_45FT_FRT_RT_AMT, CALC_45FT_FRT_RT_AMT) -- 45' Cost 추가			]]></sql>
			<params>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="ihc_trf_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="12" value="" out="N"/>
				<param name="org_dest_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
