<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CargoReleaseOrderDBDAOsearchDoCheckReportSummaryRSQL">
			<desc><![CDATA[D/O Release 실적에 대해 조회한다]]></desc>
			<sql><![CDATA[
SELECT    TRIM(TO_CHAR(SUM(TEU)  ,'999999990.99')) TOT_TEU
        , TRIM(TO_CHAR(SUM(FEU)  ,'999999990.99')) TOT_FEU  
        , TRIM(TO_CHAR(ROUND(SUM(BKG_ACTWGT_QTY)  /1000) ,'999,999,999')) TOT_WGT
		, TRIM(TO_CHAR(SUM(BKG_MEA_QTY)  ,'999,999,990.999')) TOT_MEA
		, COUNT(1)  TOT_CNT

    FROM ( 
        SELECT BKG_NO  
            , X.BL_NO
        	, ( SELECT TRIM(TO_CHAR(SUM(DECODE(GREATEST('2', SUBSTR(CNTR_TPSZ_CD, 2, 1)), '2', NVL(OP_CNTR_QTY, 0), 0)) , '999999990.99')) FROM BKG_QUANTITY WHERE BKG_NO = X.BKG_NO ) TEU
            , ( SELECT TRIM(TO_CHAR(SUM(DECODE(GREATEST('2', SUBSTR(CNTR_TPSZ_CD, 2, 1)), '2', 0, NVL(OP_CNTR_QTY, 0))) , '999999990.99')) FROM BKG_QUANTITY WHERE BKG_NO = X.BKG_NO ) FEU
            , X.BKG_ACTWGT_QTY
            , X.BKG_MEA_QTY     
        FROM (
            SELECT   BKGM.BKG_NO              AS BKG_NO
                   , BKGM.POD_CD              AS POD_CD
                   , BKGM.POL_CD              AS POL_CD
                   , BKGM.BL_NO||BKGM.BL_TP_CD  AS BL_NO            
                   , TRIM(TO_CHAR(DECODE(NVL(BDOC.ACT_WGT,0),  0, DECODE(NVL(BDOC.WGT_UT_CD,0),'LBS',ROUND(NVL(BDOC.ACT_WGT,0)*0.4536,3),NVL(BDOC.ACT_WGT,0)),
                                         DECODE(NVL(BDOC.WGT_UT_CD,0),'LBS',ROUND(NVL(BDOC.ACT_WGT,0)*0.4536,3),NVL(BDOC.ACT_WGT,0)) ),'999999999.999')) AS BKG_ACTWGT_QTY
                   , TRIM(TO_CHAR(DECODE(NVL(BDOC.MEAS_UT_CD, 0),'CBF',ROUND (NVL(BDOC.MEAS_QTY,0)*0.02), NVL(BDOC.MEAS_QTY,0)),'999999990.999')) AS BKG_MEA_QTY
            FROM  BKG_DO_DTL  DOTL
            	 ,BKG_DO      BKDO   
            	 ,BKG_BOOKING BKGM
                 ,BKG_BL_DOC  BDOC
                 ,BKG_VVD     BVVD
            WHERE 1=1
    #if (${rd_flag} == 'F')
	        AND DOTL.EVNT_DT BETWEEN TO_DATE (@[evnt_dt_fm], 'YYYYMMDD') AND TO_DATE (@[evnt_dt_to], 'YYYYMMDD') + 0.99999   ---  OPTIONAL 2 MANDATORY GROUP1
	#end
	#if (${rd_flag} == 'F' && ${evnt_ofc_cd} != '')
	        AND DOTL.EVNT_OFC_CD = @[evnt_ofc_cd]
	#end
	#if (${rd_flag} == 'F' && ${evnt_usr_id} != '')
	        AND DOTL.EVNT_USR_ID = @[evnt_usr_id]
	#end
	#if (${rd_flag} == 'S')
	        AND BKGM.BL_NO  = @[bl_no] -- OPTIONAL 5 MANDATORY GROUP3   
	#end
	#if (${rd_flag} == 'T')
	        AND BVVD.VSL_CD     = @[vsl_cd]         -- OPTIONAL 3 MANDATORY GROUP2
	        AND BVVD.SKD_VOY_NO = @[skd_voy_no] -- OPTIONAL 3 MANDATORY GROUP2
	        AND BVVD.SKD_DIR_CD = @[skd_dir_cd] -- OPTIONAL 3 MANDATORY GROUP2
	        AND BKGM.POD_CD   = @[pod_cd] -- OPTIONAL 4 MANDATORY GROUP2
	#end
	#if (${rd_flag} == 'T' && ${del_cd} != '')
	        AND BKGM.DEL_CD = @[del_cd] -- OPTIONAL 10
	#end
            AND   BKGM.BKG_NO     = BVVD.BKG_NO 
            AND   BKGM.POD_CD     = BVVD.POD_CD   
            AND   BDOC.BKG_NO     = BKGM.BKG_NO           
            AND   DOTL.BKG_NO     = BKGM.BKG_NO
            AND   DOTL.RLSE_STS_CD IN ('I', 'R') -- 20091126 심영우 과장 Release되지 않은 것은 리스트에서 제외시켜야 함
            
            AND   BKDO.BKG_NO = DOTL.BKG_NO
            AND   BKDO.RLSE_SEQ = DOTL.RLSE_SEQ  
         
 
           ) X
     ) Y			]]></sql>
			<params>
				<param name="evnt_dt_fm" type="12" value="" out="N"/>
				<param name="evnt_dt_to" type="12" value="" out="N"/>
				<param name="evnt_ofc_cd" type="12" value="" out="N"/>
				<param name="evnt_usr_id" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
