<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BRKGAuditDBDAOSearchBRKGCommCmpnForAuditRSQL">
			<desc><![CDATA[SearchBRKGCommCmpnForAudit]]></desc>
			<sql><![CDATA[
SELECT
           A.CMPN_SEQ,
      CASE WHEN A.COMM_PROC_STS_CD   = 'AS'
           THEN '1'
           ELSE '0'
      END PAY_CHK,
      CASE A.FRT_FWRD_CNT_CD
      WHEN ''
      THEN ''
      ELSE CONCAT(A.FRT_FWRD_CNT_CD, TO_CHAR (A.FRT_FWRD_SEQ, 'FM000000'))
       END                                                           AS FRT_FWRD_CNT_SEQ,
           TO_CHAR (A.VNDR_SEQ, 'FM000000')                          AS VNDR_CNT_SEQ,
         (     SELECT
                      MAX (NVL (LTRIM (C.CUST_LGL_ENG_NM), ' '))
                 FROM MDM_CUSTOMER          C
                WHERE C.CUST_CNT_CD(+)      = A.FRT_FWRD_CNT_CD
                  AND C.CUST_SEQ(+)         = A.FRT_FWRD_SEQ
                  AND C.CNTR_DIV_FLG(+)     = 'Y'
         )                                                           AS CUST_LGL_ENG_NM,
         (     SELECT
                      MAX (NVL (B.BL_NO, ' '))
                 FROM AGT_COMM_BKG_INFO     B
                WHERE B.BKG_NO              = A.BKG_NO
         )                                                           AS BL_NO,
		(     SELECT
					MAX (NVL (B.BKG_STS_CD, ' '))
				FROM BKG_BOOKING     B
				WHERE B.BKG_NO              = A.BKG_NO
		)                                                           AS BKG_STS_CD,
           TO_CHAR (A.VSL_DEP_DT, 'YYYYMMDD')                        AS VSL_DEP_DT,
           TO_CHAR (A.CRE_DT, 'YYYYMMDD')                            AS CRE_DT,
         (     SELECT
                      MAX (NVL (B.FMC_NO, ' '))
                 FROM AGT_COMM_BKG_INFO     B
                WHERE B.BKG_NO              = A.BKG_NO
         )                                                           AS FMC_NO,
           NVL (A.CMPN_REF_NO, ' ')                                  AS CMPN_REF_NO,
      CASE 
      WHEN SUBSTR (A.CMPN_DIV_CD, 1, 1) = 'B'
       AND NVL (A.CMPN_BKG_RT, 0) != 0
      THEN (A.ACT_COMM_AMT / A.CMPN_BKG_RT) * 100
      ELSE 0
       END                                                           AS ACT_COMM_ABLE,
           NVL (CMPN_BKG_RT, 0)                                      AS CMPN_BKG_RT,
      CASE SUBSTR (A.CMPN_DIV_CD, 1, 1)
      WHEN 'B'
      THEN A.ACT_COMM_AMT
      ELSE 0
       END                                                           AS ACT_COMM_AMT,
           NVL (A.BKG_BX_QTY,  0)                                    AS BKG_BX_QTY,
           NVL (A.CMPN_BX_RT,  0)                                    AS CMPN_BX_RT,
           NVL (A.BKG_TEU_QTY, 0)                                    AS BKG_TEU_QTY,
           NVL (A.CMPN_TEU_RT, 0)                                    AS CMPN_TEU_RT,
           NVL (A.BKG_FEU_QTY, 0)                                    AS BKG_FEU_QTY,
           NVL (A.CMPN_FEU_RT, 0)                                    AS CMPN_FEU_RT,
           NVL (A.BKG_RF_QTY,  0)                                    AS BKG_RF_QTY,
           NVL (A.CMPN_RF_RT,  0)                                    AS CMPN_RF_RT,
		   NVL (A.BKG_RF_TEU_QTY, 0)                                 AS BKG_RF_TEU_QTY,
		   NVL (A.CMPN_RF_TEU_RT, 0)                                 AS CMPN_RF_TEU_RT,
		   NVL (A.BKG_RF_FEU_QTY, 0)                                 AS BKG_RF_FEU_QTY,
		   NVL (A.CMPN_RF_FEU_RT, 0)                                 AS CMPN_RF_FEU_RT,
      CASE SUBSTR (A.CMPN_DIV_CD, 1, 1)
      WHEN 'C'
      THEN A.ACT_COMM_AMT
      ELSE 0
       END                                                           AS CNTR_COMM_AMT,
           NVL (A.ACT_PRE_COMM_AMT, 0)                               AS ACT_PRE_COMM_AMT,
           NVL (A.ACT_IF_COMM_AMT, 0)                                AS ACT_IF_COMM_AMT,
           NVL (A.COMM_PROC_STS_CD, ' ')                             AS COMM_PROC_STS_CD,
           A.COMM_PROC_RSLT_RSN,
           NVL (TO_CHAR (CMPN_IF_DT, 'YYYYMMDD'), ' ')               AS CMPN_IF_DT,
           A.BKG_NO,
           AGMT_CNT_CD,
           AGMT_CUST_SEQ,
           AGMT_RT_SEQ
      FROM AGT_CMPN_COMM         A,
         (     SELECT
                      A.BKG_NO,
                      MIN (A.CMPN_SEQ)     AS CMPN_SEQ
                 FROM AGT_CMPN_COMM         A
                WHERE A.CRE_USR_ID         != 'COST'
#if(${sts_cd} == 'I')
                  AND A.COMM_PROC_STS_CD    = 'IF'
#elseif(${sts_cd} == 'N')
                  AND A.COMM_PROC_STS_CD   <> 'IF'
#elseif(${sts_cd} == 'P')
                  AND A.COMM_PROC_STS_CD   = 'AS' -- Paid 
#elseif(${sts_cd} == 'T')
                  AND A.COMM_PROC_STS_CD   = 'CS' -- Not Paid 
#elseif(${sts_cd} == 'C')
                  AND A.COMM_PROC_STS_CD   = 'CA' -- Payment Canceled  
#end


#if(${date_option} == 'I')
                  AND A.CMPN_IF_DT
              BETWEEN TO_DATE (NVL(REPLACE(@[search_dt_fr],'-',''), '19000101'), 'YYYYMMDD')
                  AND TO_DATE (NVL(REPLACE(@[search_dt_to],'-',''), '29990101'), 'YYYYMMDD')+0.999999
#end
#if(${date_option} == 'E')
                  AND A.VSL_DEP_DT
              BETWEEN TO_DATE (NVL(REPLACE(@[search_dt_fr],'-',''), '19000101'), 'YYYYMMDD')
                  AND TO_DATE (NVL(REPLACE(@[search_dt_to],'-',''), '29990101'), 'YYYYMMDD')+0.999999
#end
#if(${ff_cnt_cd} != '')
                  AND A.FRT_FWRD_CNT_CD     = SUBSTR(@[ff_cnt_cd], 1, 2)
                  AND A.FRT_FWRD_SEQ        = SUBSTR(@[ff_cnt_cd], 3)

#end
#if(${multi_vvd} != '')
                  AND  A.COMM_VSL_CD||A.COMM_SKD_VOY_NO||A.COMM_SKD_DIR_CD IN ( $multi_vvd	)
#end
#if( ${bl_nos} != '' || ${date_option} == 'C')
                  AND A.BKG_NO
                   IN
                    (     SELECT
                                 BKG_NO
                            FROM AGT_COMM_BKG_INFO
                           WHERE 1=1
#if( ${bl_nos} != '')
                             AND BL_NO
                              IN
                               ( $bl_nos
                               )
#end
#if(${date_option} == 'C')
                             AND BKG_CRE_DT
                         BETWEEN TO_DATE (NVL(REPLACE(@[search_dt_fr],'-',''), '19000101'), 'YYYYMMDD')
                             AND TO_DATE (NVL(REPLACE(@[search_dt_to],'-',''), '29990101'), 'YYYYMMDD')+0.999999
#end
                   )
#end
             GROUP BY A.BKG_NO
         )                       B
     WHERE A.BKG_NO              = B.BKG_NO
       AND A.CMPN_SEQ            = B.CMPN_SEQ
	   AND A.AR_OFC_CD = @[ofc_cd]
  ORDER BY CONCAT (A.FRT_FWRD_CNT_CD, A.FRT_FWRD_SEQ),
           CONCAT (A.VNDR_CNT_CD, A.VNDR_SEQ),
           CUST_LGL_ENG_NM			]]></sql>
			<params>
				<param name="search_dt_fr" type="12" value="" out="Y"/>
				<param name="search_dt_to" type="12" value="" out="Y"/>
				<param name="ff_cnt_cd" type="12" value="" out="Y"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
