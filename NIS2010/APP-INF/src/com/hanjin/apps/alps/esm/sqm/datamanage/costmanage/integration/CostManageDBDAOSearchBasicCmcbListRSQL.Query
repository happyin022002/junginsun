<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CostManageDBDAOSearchBasicCmcbListRSQL">
			<desc><![CDATA[Basic CMCB Data 를 조회
2015.10.19 김용습 [CHM-201538305] [CSR 전환건] Basic CMCB (CM Cost Per Box) / Basic CMCB for IAS Sector 화면 내 신규 칼럼 추가
2015.11.06 김용습 [선반영] RPB 계산시 0인 값은 제외하고 평균값 구하도록 함]]></desc>
			<sql><![CDATA[
SELECT A2.BSE_YR
        ,A2.BSE_QTR_CD
        ,A2.OFC_VW_CD
        ,A2.TRD_CD
        ,A2.RLANE_CD
        ,A2.DIR_CD
        ,A2.RHQ_CD
        ,A2.RGN_OFC_CD
        ,A2.GID_PA_CM_XCLD_EQ_UC_AMT
        ,A2.GID_PA_CM_UC_AMT
        ,A2.GID_RA_CM_UC_AMT
        ,(SELECT AVG(CFM.GRS_RPB_REV) 
            FROM SQM_CFM_QTA CFM 
            WHERE CFM.QTA_RLSE_VER_NO = SUBSTR(A1.BSE_YR,-2)||DECODE(A1.BSE_TP_CD, 'Y', '00', A1.BSE_QTR_CD)||'01'
            AND CFM.BSE_TP_CD = A1.BSE_TP_CD
            AND CFM.BSE_YR = A1.BSE_YR
            AND CFM.BSE_QTR_CD = A1.BSE_QTR_CD
            AND CFM.OFC_VW_CD = A1.OFC_VW_CD
            AND CFM.QTA_TGT_CD = 'D'
            AND CFM.TRD_CD = A1.TRD_CD
            AND CFM.RLANE_CD = A1.RLANE_CD 
            AND CFM.DIR_CD = A1.DIR_CD
            AND CFM.RHQ_CD = A1.RHQ_CD
            AND CFM.RGN_OFC_CD = A1.RGN_OFC_CD
            AND CFM.GRS_RPB_REV != 0) AS INITIAL_RPB
        ,(SELECT AVG(CFM.GRS_RPB_REV - CFM.RA_CM_UC_AMT) 
            FROM SQM_CFM_QTA CFM 
            WHERE CFM.QTA_RLSE_VER_NO = SUBSTR(A1.BSE_YR,-2)||DECODE(A1.BSE_TP_CD, 'Y', '00', A1.BSE_QTR_CD)||'01'
            AND CFM.BSE_TP_CD = A1.BSE_TP_CD
            AND CFM.BSE_YR = A1.BSE_YR
            AND CFM.BSE_QTR_CD = A1.BSE_QTR_CD
            AND CFM.OFC_VW_CD = A1.OFC_VW_CD
            AND CFM.QTA_TGT_CD = 'D'
            AND CFM.TRD_CD = A1.TRD_CD
            AND CFM.RLANE_CD = A1.RLANE_CD 
            AND CFM.DIR_CD = A1.DIR_CD
            AND CFM.RHQ_CD = A1.RHQ_CD
            AND CFM.RGN_OFC_CD = A1.RGN_OFC_CD
            AND CFM.GRS_RPB_REV != 0) AS INITIAL_CMPB_RA
        ,A2.PA_CM_UC_AMT
        ,A2.RA_CM_UC_AMT
        ,(SELECT AVG(CFM.GRS_RPB_REV) 
            FROM SQM_CFM_QTA CFM 
            WHERE CFM.QTA_RLSE_VER_NO = SUBSTR(A1.BSE_YR,-2)||DECODE(A1.BSE_TP_CD, 'Y', '00', A1.BSE_QTR_CD)||'02'
            AND CFM.BSE_TP_CD = A1.BSE_TP_CD
            AND CFM.BSE_YR = A1.BSE_YR
            AND CFM.BSE_QTR_CD = A1.BSE_QTR_CD
            AND CFM.OFC_VW_CD = A1.OFC_VW_CD
            AND CFM.QTA_TGT_CD = 'D'
            AND CFM.TRD_CD = A1.TRD_CD
            AND CFM.RLANE_CD = A1.RLANE_CD 
            AND CFM.DIR_CD = A1.DIR_CD
            AND CFM.RHQ_CD = A1.RHQ_CD
            AND CFM.RGN_OFC_CD = A1.RGN_OFC_CD
            AND CFM.GRS_RPB_REV != 0) AS CURRENT_RPB
        ,(SELECT AVG(CFM.GRS_RPB_REV - CFM.RA_CM_UC_AMT) 
            FROM SQM_CFM_QTA CFM 
            WHERE CFM.QTA_RLSE_VER_NO = SUBSTR(A1.BSE_YR,-2)||DECODE(A1.BSE_TP_CD, 'Y', '00', A1.BSE_QTR_CD)||'02'
            AND CFM.BSE_TP_CD = A1.BSE_TP_CD
            AND CFM.BSE_YR = A1.BSE_YR
            AND CFM.BSE_QTR_CD = A1.BSE_QTR_CD
            AND CFM.OFC_VW_CD = A1.OFC_VW_CD
            AND CFM.QTA_TGT_CD = 'D'
            AND CFM.TRD_CD = A1.TRD_CD
            AND CFM.RLANE_CD = A1.RLANE_CD 
            AND CFM.DIR_CD = A1.DIR_CD
            AND CFM.RHQ_CD = A1.RHQ_CD
            AND CFM.RGN_OFC_CD = A1.RGN_OFC_CD
            AND CFM.GRS_RPB_REV != 0) AS CURRENT_CMPB_RA
    FROM SQM_QTA_LANE_OFC      A1
        ,SQM_QTA_LANE_OFC_COST A2
   WHERE A1.BSE_TP_CD   = @[f_bse_tp_cd]
     AND A1.BSE_YR      = @[f_bse_yr]
     AND A1.BSE_QTR_CD  = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])
     AND A1.OFC_VW_CD   = @[f_ofc_vw_cd]
#if (${f_trd_cd} != '' && ${f_trd_cd} != 'All')
     AND A1.TRD_CD      = @[f_trd_cd]
#end
#if (${f_rlane_cd} != '' && ${f_rlane_cd} != 'All')
     AND A1.RLANE_CD    = @[f_rlane_cd]
#end
#if (${f_dir_cd} != '' && ${f_dir_cd} != 'All')
     AND A1.DIR_CD      = @[f_dir_cd]
#end
#if (${f_rgn_ofc_cd} != '' && ${f_rgn_ofc_cd} != 'All')
     AND A1.RGN_OFC_CD  = @[f_rgn_ofc_cd]
#end
#if (${f_rhq_cd} != '' && ${f_rhq_cd} != 'All')
     AND A1.RHQ_CD      = @[f_rhq_cd]
#end
     AND A1.SQM_ACT_FLG = 'Y'
     AND A1.BSE_TP_CD   = A2.BSE_TP_CD
     AND A1.BSE_YR      = A2.BSE_YR
     AND A1.BSE_QTR_CD  = A2.BSE_QTR_CD
     AND A1.OFC_VW_CD   = A2.OFC_VW_CD
     AND A1.TRD_CD      = A2.TRD_CD
     AND A1.RLANE_CD    = A2.RLANE_CD
     AND A1.DIR_CD      = A2.DIR_CD
     AND A1.RHQ_CD      = A2.RHQ_CD
     AND A1.RGN_OFC_CD  = A2.RGN_OFC_CD
ORDER BY A2.BSE_YR
        ,A2.BSE_QTR_CD
        ,A2.OFC_VW_CD
        ,A2.TRD_CD
        ,A2.RLANE_CD
        ,A2.DIR_CD
        ,A2.RHQ_CD
        ,A2.RGN_OFC_CD			]]></sql>
			<params>
				<param name="f_bse_tp_cd" type="12" value="" out="N"/>
				<param name="f_bse_yr" type="12" value="" out="N"/>
				<param name="f_bse_qtr_cd" type="12" value="" out="N"/>
				<param name="f_ofc_vw_cd" type="12" value="" out="N"/>
				<param name="f_trd_cd" type="12" value="" out="N"/>
				<param name="f_rlane_cd" type="12" value="" out="N"/>
				<param name="f_dir_cd" type="12" value="" out="N"/>
				<param name="f_rgn_ofc_cd" type="12" value="" out="N"/>
				<param name="f_rhq_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
