<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCProposalMainDBDAORsltHisAmdLgcyVORSQL">
			<desc><![CDATA[Amendment History 레거시 데이터인 경우]]></desc>
			<sql><![CDATA[
SELECT   PROP_SCP_TERM_TP_CD
#if (${term_type_cd} != '')
#if (${term_type_cd} == '03')
        ,DECODE('04',PROP_SCP_TERM_TP_CD, MAX (AMDT_FLG) ,'0') AMDT_FLG
#elseif (${term_type_cd} == '04')
        ,DECODE('07',PROP_SCP_TERM_TP_CD, MAX (AMDT_FLG) ,'0') AMDT_FLG
#elseif (${term_type_cd} == '11')
        ,DECODE('41',PROP_SCP_TERM_TP_CD, MAX (AMDT_FLG) ,'0') AMDT_FLG
#elseif (${term_type_cd} == '12')
        ,DECODE('13',PROP_SCP_TERM_TP_CD, MAX (AMDT_FLG) ,'0') AMDT_FLG
#elseif (${term_type_cd} == '13')
        ,DECODE('14',PROP_SCP_TERM_TP_CD, MAX (AMDT_FLG) ,'0') AMDT_FLG
#elseif (${term_type_cd} == '14')
        ,DECODE('51',PROP_SCP_TERM_TP_CD, MAX (AMDT_FLG) ,'0') AMDT_FLG
#elseif (${term_type_cd} == '15')
        ,DECODE('71',PROP_SCP_TERM_TP_CD, MAX (AMDT_FLG) ,'0') AMDT_FLG
#elseif (${term_type_cd} == '16')
        ,DECODE('32',PROP_SCP_TERM_TP_CD, MAX (AMDT_FLG) ,'0') AMDT_FLG
#elseif (${term_type_cd} == '17')
        ,DECODE('15',PROP_SCP_TERM_TP_CD, MAX (AMDT_FLG) ,'0') AMDT_FLG
#elseif (${term_type_cd} == '18')
        ,DECODE('61',PROP_SCP_TERM_TP_CD, MAX (AMDT_FLG) ,'0') AMDT_FLG
#elseif (${term_type_cd} == '19')
        ,DECODE('16',PROP_SCP_TERM_TP_CD, MAX (AMDT_FLG) ,'0') AMDT_FLG
#else
        ,DECODE(@[term_type_cd],PROP_SCP_TERM_TP_CD, MAX (AMDT_FLG) ,'0') AMDT_FLG
#end
#else
        ,MAX (AMDT_FLG)  AMDT_FLG
#end
        ,DAT_FLG
FROM     (
		
	SELECT PROP_SCP_TERM_TP_CD
#if (${svc_scp_cd} == '')
		, AMDT_FLG
#else
	    ,0 AMDT_FLG
#end
		,DAT_FLG
	FROM(
         SELECT '01' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               , 0 DAT_FLG
         FROM   PRI_SP_DUR
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]
         AND    ROWNUM = 1
         UNION ALL
         SELECT '02' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               , 0 DAT_FLG
         FROM   PRI_SP_MQC
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]
         AND    ROWNUM = 1
         UNION ALL
         SELECT '02' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               , 0 DAT_FLG
         FROM   PRI_SP_SUB_MQC
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]  
         AND    ROWNUM = 1
         UNION ALL
         SELECT '04' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               , 0 DAT_FLG
         FROM   PRI_SP_CTRT_PTY
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]    
         AND    ROWNUM = 1                                                    
         UNION ALL
         SELECT '05' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               , 0 DAT_FLG
         FROM   PRI_SP_AFIL
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]
         AND    ROWNUM = 1
         UNION ALL
         SELECT '06' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               , 0 DAT_FLG
         FROM   PRI_SP_BLPL
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]      
         AND    ROWNUM = 1                       
         UNION ALL
         SELECT '07' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               , 0 DAT_FLG
         FROM   PRI_SP_CTRT_CUST_TP
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]
         AND    ROWNUM = 1
		)
    UNION ALL
	SELECT PROP_SCP_TERM_TP_CD
#if (${svc_scp_cd} == '')
		, 0 AMDT_FLG
#else
	    , AMDT_FLG
#end
		, DAT_FLG
	FROM(
         SELECT '01' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               ,0 DAT_FLG
         FROM   PRI_SP_SCP_DUR
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]
         AND    SVC_SCP_CD = @[svc_scp_cd]
         AND    ROWNUM = 1 
         UNION ALL
         SELECT '02' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               ,0 DAT_FLG
         FROM   PRI_SP_SCP_MQC
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]
         AND    SVC_SCP_CD = @[svc_scp_cd]
         AND    ROWNUM = 1 
         UNION ALL
         SELECT '13' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               ,0 DAT_FLG
         FROM   PRI_SP_SCP_GRP_LOC_DTL
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]
         AND    SVC_SCP_CD = @[svc_scp_cd]
         AND    ROWNUM = 1    
         UNION ALL
         SELECT '14' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               ,0 DAT_FLG
         FROM   PRI_SP_SCP_GRP_CMDT_DTL
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]
         AND    SVC_SCP_CD = @[svc_scp_cd]
          AND    ROWNUM = 1    
         UNION ALL
         SELECT '15' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               ,0 DAT_FLG
         FROM   PRI_SP_SCP_LODG_AGN
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]
         AND    SVC_SCP_CD = @[svc_scp_cd]
          AND    ROWNUM = 1    
        UNION ALL
        SELECT  '16' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
                ,0 DAT_FLG
        FROM    PRI_SP_SCP_GOH_CHG
        WHERE   PROP_NO = @[prop_no]
        AND     AMDT_SEQ= @[amdt_seq]
        AND     SVC_SCP_CD = @[svc_scp_cd]
         AND    ROWNUM = 1    
         UNION ALL                                                       
         SELECT '32' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               ,COUNT(*) DAT_FLG
         FROM   PRI_SP_SCP_NOTE
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]
         AND    SVC_SCP_CD = @[svc_scp_cd]
         AND    NOTE_TP_CD = 'P'
          AND    ROWNUM = 1    
        UNION ALL
        SELECT  '41' PROP_SCP_TERM_TP_CD
                ,COUNT(*) AMDT_FLG
                ,0 DAT_FLG
        FROM    PRI_SP_SCP_ROUT_PNT
        WHERE   PROP_NO = @[prop_no]
        AND     AMDT_SEQ= @[amdt_seq]
        AND     SVC_SCP_CD = @[svc_scp_cd]
        AND     ORG_DEST_TP_CD = 'O'
         AND    ROWNUM = 1    
        UNION ALL
        SELECT  '41' PROP_SCP_TERM_TP_CD
                ,COUNT(*) AMDT_FLG
                ,0 DAT_FLG
        FROM    PRI_SP_SCP_ROUT_PNT
        WHERE   PROP_NO = @[prop_no]
        AND     AMDT_SEQ= @[amdt_seq]
        AND     SVC_SCP_CD = @[svc_scp_cd]
        AND     ORG_DEST_TP_CD = 'D'
         AND    ROWNUM = 1    
        UNION ALL
         SELECT '51' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               ,0 DAT_FLG
         FROM   PRI_SP_SCP_TRSP_ADD_CHG
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]
         AND    SVC_SCP_CD = @[svc_scp_cd]
         AND    ADD_CHG_TP_CD = 'A'
         AND    ORG_DEST_TP_CD = 'O'
          AND    ROWNUM = 1    
         UNION ALL
         SELECT '51' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               ,0 DAT_FLG
         FROM   PRI_SP_SCP_TRSP_ADD_CHG
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]
         AND    SVC_SCP_CD = @[svc_scp_cd]
         AND    ADD_CHG_TP_CD = 'A'
         AND    ORG_DEST_TP_CD = 'D'
          AND    ROWNUM = 1    
         UNION ALL
         SELECT '61' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               ,0 DAT_FLG
         FROM   PRI_SP_SCP_TRSP_ADD_CHG
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]
         AND    SVC_SCP_CD = @[svc_scp_cd]
         AND    ADD_CHG_TP_CD = 'I'
         AND    ORG_DEST_TP_CD = 'O'
          AND    ROWNUM = 1    
         UNION ALL
         SELECT '61' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               ,0 DAT_FLG
         FROM   PRI_SP_SCP_TRSP_ADD_CHG
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]
         AND    SVC_SCP_CD = @[svc_scp_cd]
         AND    ADD_CHG_TP_CD = 'I'
         AND    ORG_DEST_TP_CD = 'D'
         AND    ROWNUM = 1    
         UNION ALL                             
         SELECT '71' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               ,0 DAT_FLG
         FROM   PRI_SP_SCP_RT_CMDT_HDR
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]
         AND    SVC_SCP_CD = @[svc_scp_cd]  
         AND    GEN_SPCL_RT_TP_CD = 'G'    
         AND    ROWNUM = 1                           
         UNION ALL                             
         SELECT '71' PROP_SCP_TERM_TP_CD
               ,COUNT(*) AMDT_FLG
               ,0 DAT_FLG
         FROM   PRI_SP_SCP_RT_CMDT_HDR
         WHERE  PROP_NO = @[prop_no]
         AND    AMDT_SEQ = @[amdt_seq]
         AND    SVC_SCP_CD = @[svc_scp_cd]
         AND    GEN_SPCL_RT_TP_CD = 'S'                                    
         AND    ROWNUM = 1   
		) 
)
GROUP BY PROP_SCP_TERM_TP_CD,DAT_FLG			]]></sql>
			<params>
				<param name="term_type_cd" type="12" value="" out="N"/>
				<param name="prop_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="12" value="" out="N"/>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
