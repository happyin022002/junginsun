<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="QtaAdjustmentDBDAOCopyCfmTgtVvdCSQL">
			<desc><![CDATA[[QTA Adjustment by VVD] 에서 확정데이터를 [복사] 합니다

* 2015.02.27 이혜민 SLS_YRMON 추가
* 2015.06.15 김용습 [CHM-201536164] 주간 MAS Open에 따른 타모듈 프로그램 적용 요청
* 2015.09.09 김용습 [CHM-201537818] QTA Adjustment by VVD, QTA Adjustment by VVD for IAS Sector 두 화면내 칼럼 수정
2016.04.22 CHM-201641278 [SQM] IAS Trade 판매목표 수립 Portion 연결 시스템 수정 요청 CSR]]></desc>
			<sql><![CDATA[
INSERT INTO SQM_CFM_TGT_VVD (
       QTA_RLSE_VER_NO
      ,BSE_TP_CD
      ,BSE_YR
      ,BSE_QTR_CD
      ,QTA_TGT_CD
      ,TRD_CD
      ,RLANE_CD
      ,DIR_CD
      ,VSL_CD
      ,SKD_VOY_NO
      ,SKD_DIR_CD
      ,BSE_MON
      ,BSE_WK
      ,SLS_YRMON
      ,CONV_DIR_CD
      ,SUB_TRD_CD
      ,IOC_CD
      ,FNL_BSA_CAPA
      ,LOD_QTY
      ,GRS_REV
      ,CRE_USR_ID
      ,CRE_DT
      ,UPD_USR_ID
      ,UPD_DT
)
SELECT A1.QTA_RLSE_VER_NO
      ,A1.BSE_TP_CD
      ,A1.BSE_YR
      ,A1.BSE_QTR_CD
      ,A1.QTA_TGT_CD
      ,A1.TRD_CD
      ,A1.RLANE_CD
      ,A1.DIR_CD
      ,SUBSTR(@[mas_vvd], 1, 4) AS VSL_CD
      ,SUBSTR(@[mas_vvd], 5, 4) AS SKD_VOY_NO
      ,SUBSTR(@[mas_vvd], 9, 1) AS SKD_DIR_CD
      ,@[mas_bse_mon] AS BSE_MON
      ,@[mas_bse_wk]  AS BSE_WK
      ,@[mas_cost_yrmon] AS SLS_YRMON
      ,A1.CONV_DIR_CD
      ,A1.SUB_TRD_CD
      ,A1.IOC_CD
      ,@[mas_fnl_bsa_capa] AS FNL_BSA_CAPA
      ,DECODE(@[spl_potn], '1', 0, LOD_QTY) AS LOD_QTY
      ,DECODE(@[spl_potn], '1', 0, GRS_REV) AS GRS_REV
      ,@[usr_id] AS CRE_USR_ID
      ,SYSDATE   AS CRE_DT
      ,@[usr_id] AS UPD_USR_ID
      ,SYSDATE   AS UPD_DT
  FROM SQM_CFM_TGT_VVD A1
 WHERE A1.QTA_RLSE_VER_NO = @[qta_rlse_ver_no]
   AND A1.BSE_TP_CD       = @[bse_tp_cd]
   AND A1.BSE_YR          = @[bse_yr]
   AND A1.BSE_QTR_CD      = @[bse_qtr_cd]
   AND A1.QTA_TGT_CD      = @[qta_tgt_cd]
   AND A1.TRD_CD          = @[trd_cd]
   AND A1.RLANE_CD        = @[rlane_cd]
   AND A1.DIR_CD          = @[dir_cd]
   AND A1.VSL_CD          = SUBSTR(@[copy_vvd], 1, 4)
   AND A1.SKD_VOY_NO      = SUBSTR(@[copy_vvd], 5, 4)
   AND A1.SKD_DIR_CD      = SUBSTR(@[copy_vvd], 9, 1)
   
   AND NOT EXISTS (
    SELECT * FROM SQM_CFM_TGT_VVD A1
     WHERE A1.QTA_RLSE_VER_NO = @[qta_rlse_ver_no]
       AND A1.BSE_TP_CD       = @[bse_tp_cd]
       AND A1.BSE_YR          = @[bse_yr]
       AND A1.BSE_QTR_CD      = @[bse_qtr_cd]
       AND A1.QTA_TGT_CD      = @[qta_tgt_cd]
       AND A1.TRD_CD          = @[trd_cd]
       AND A1.RLANE_CD        = @[rlane_cd]
       AND A1.DIR_CD          = @[dir_cd]
       AND A1.VSL_CD          = SUBSTR(@[mas_vvd], 1, 4)
       AND A1.SKD_VOY_NO      = SUBSTR(@[mas_vvd], 5, 4)
       AND A1.SKD_DIR_CD      = SUBSTR(@[mas_vvd], 9, 1)
   ) -- QTA ADJUSTMENT BY VVD FOR IAS SECTOR에서 추가할 때 중복 에러 나지 않게 하기 위해 NOT EXISTS 조건 추가			]]></sql>
			<params>
				<param name="mas_vvd" type="12" value="" out="N"/>
				<param name="mas_bse_mon" type="12" value="" out="N"/>
				<param name="mas_bse_wk" type="12" value="" out="N"/>
				<param name="mas_cost_yrmon" type="12" value="" out="N"/>
				<param name="mas_fnl_bsa_capa" type="12" value="" out="N"/>
				<param name="spl_potn" type="12" value="" out="N"/>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="qta_rlse_ver_no" type="12" value="" out="N"/>
				<param name="bse_tp_cd" type="12" value="" out="N"/>
				<param name="bse_yr" type="12" value="" out="N"/>
				<param name="bse_qtr_cd" type="12" value="" out="N"/>
				<param name="qta_tgt_cd" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
				<param name="copy_vvd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
