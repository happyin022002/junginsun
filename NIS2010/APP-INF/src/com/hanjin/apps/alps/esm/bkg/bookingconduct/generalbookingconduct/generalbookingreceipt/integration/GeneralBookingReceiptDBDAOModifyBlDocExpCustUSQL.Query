<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingReceiptDBDAOModifyBlDocExpCustUSQL">
			<desc><![CDATA[Booking Customer Tab 에서 오른쪽 상단에 A/Customer 변경 시 Export Ref. 항목에,
입력된 기존 입력 data + 줄 바꿈 처리 Customer 의 Name 이 저장 되도록 변경(Before, After 의 A/Customer 다르면 Before 삭제 및 After로 변경)]]></desc>
			<sql><![CDATA[
#if (${ca_flg}== 'Y')
UPDATE BKG_CUST_HIS
SET    CUST_NM = ( CASE WHEN 
                       DECODE(@[old_act_cust_cd],'','',(SELECT 'X' 
                                                        FROM BKG_CUST_HIS 
                                                        WHERE BKG_NO= @[bkg_no]
                                                        AND   CORR_NO = 'TMP0000001'
			                                            AND   BKG_CUST_TP_CD ='E'
                                                        AND   CUST_NM LIKE '%'||@[old_act_cust_nm]||'%' )) IS NULL 
                       THEN ( SELECT DECODE(NVL(CUST_NM,''),'','',CUST_NM||CHR(13))||DECODE(@[new_act_cust_cd],NULL,'' ,@[new_act_cust_nm])
                              FROM   BKG_CUST_HIS 
                              WHERE  BKG_NO= @[bkg_no] AND CORR_NO = 'TMP0000001'  AND BKG_CUST_TP_CD ='E')  
                       ELSE ( SELECT DECODE(@[new_act_cust_cd],NULL,REPLACE(CUST_NM,@[old_act_cust_nm]  ,'') ,REPLACE(CUST_NM,@[old_act_cust_nm],@[new_act_cust_nm])) 
                              FROM   BKG_CUST_HIS
                              WHERE  BKG_NO= @[bkg_no] AND CORR_NO = 'TMP0000001'
							  AND    BKG_CUST_TP_CD ='E')
                      END)
, UPD_USR_ID = @[upd_usr_id]
, UPD_DT     = SYSDATE
WHERE  BKG_NO  =  @[bkg_no]
AND CORR_NO = 'TMP0000001'
AND BKG_CUST_TP_CD ='E'
#else
UPDATE BKG_CUSTOMER
SET    CUST_NM =  ( CASE WHEN 
                         DECODE(@[old_act_cust_cd],'','',(SELECT 'X' 
                                                           FROM BKG_CUSTOMER 
                                                           WHERE BKG_NO= @[bkg_no]
                                                           AND BKG_CUST_TP_CD ='E' 
                                                           AND   CUST_NM LIKE '%'||@[old_act_cust_nm]||'%' )) IS NULL 
                         THEN ( SELECT DECODE(NVL(CUST_NM,''),'','',CUST_NM||CHR(13))||DECODE(@[new_act_cust_cd],NULL,'', @[new_act_cust_nm])
                                FROM BKG_CUSTOMER 
                                WHERE BKG_NO= @[bkg_no] AND BKG_CUST_TP_CD ='E')  
                         ELSE ( SELECT DECODE(@[new_act_cust_cd],NULL,REPLACE(CUST_NM ,@[old_act_cust_nm] ,'') ,REPLACE(CUST_NM ,@[old_act_cust_nm],@[new_act_cust_nm])) 
                                FROM BKG_CUSTOMER
                                WHERE BKG_NO= @[bkg_no] AND BKG_CUST_TP_CD ='E')
                         END)
, UPD_USR_ID = @[upd_usr_id]
, UPD_DT     = SYSDATE
WHERE  BKG_NO =  @[bkg_no]
AND BKG_CUST_TP_CD ='E'
#end			]]></sql>
			<params>
				<param name="old_act_cust_cd" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="old_act_cust_nm" type="12" value="" out="N"/>
				<param name="new_act_cust_cd" type="12" value="" out="N"/>
				<param name="new_act_cust_nm" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
