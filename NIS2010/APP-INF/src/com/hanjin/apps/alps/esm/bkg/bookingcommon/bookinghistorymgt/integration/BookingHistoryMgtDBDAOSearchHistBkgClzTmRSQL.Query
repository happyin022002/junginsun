<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingHistoryMgtDBDAOSearchHistBkgClzTmRSQL">
			<desc><![CDATA[BookingHistoryMgtDBDAOSearchHistBkgClzTmRSQL]]></desc>
			<sql><![CDATA[
WITH OLD AS
(SELECT @[bkg_no] BKG_NO
        , @[clz_tp_cd] CLZ_TP_CD
        , @[clz_yd_cd] CLZ_YD_CD
		, @[sys_set_dt] SYS_SET_DT
        , @[mnl_set_dt] MNL_SET_DT
        , @[mnl_set_usr_id] MNL_SET_USR_ID
        , @[ntc_flg] NTC_FLG
FROM DUAL)
SELECT HIS_CATE_NM
     , PRE_CTNT
     , CRNT_CTNT
  FROM 
    (
        SELECT (SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD02112' AND OLD.CLZ_TP_CD = INTG_CD_VAL_CTNT) HIS_CATE_NM
                , OLD.CLZ_YD_CD||
                  decode(nvl(OLD.MNL_SET_DT, 'N'), 'N',
                  '/'||OLD.SYS_SET_DT, 
				  '/Manual Set:'||OLD.MNL_SET_DT) PRE_CTNT
                , NOW.CLZ_YD_CD||
                  decode(nvl(to_char(NOW.MNL_SET_DT, 'yyyymmdd'), 'N'), 'N',
                  '/'||TO_CHAR(NOW.SYS_SET_DT, 'YYYY-MM-DD HH24:MI:SS'),
                  '/Manual Set:'||TO_CHAR(NOW.MNL_SET_DT, 'YYYY-MM-DD HH24:MI:SS')) CRNT_CTNT
          FROM OLD
             , BKG_CLZ_TM NOW
         WHERE NOW.BKG_NO   (+) = OLD.BKG_NO
           AND NOW.CLZ_TP_CD(+) = OLD.CLZ_TP_CD
    )    
 WHERE NVL(TRIM(PRE_CTNT), ' ') <> NVL(TRIM(CRNT_CTNT), ' ')			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="clz_tp_cd" type="12" value="" out="N"/>
				<param name="clz_yd_cd" type="12" value="" out="N"/>
				<param name="sys_set_dt" type="12" value="" out="N"/>
				<param name="mnl_set_dt" type="12" value="" out="N"/>
				<param name="mnl_set_usr_id" type="12" value="" out="N"/>
				<param name="ntc_flg" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
