<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RFAProposalMainDBDAORsltPropMnSpotInqVORSQL">
			<desc><![CDATA[Proposal & Amendement Inquiry   ]]></desc>
			<sql><![CDATA[
SELECT HDR.RFA_NO
      ,MN.PROP_NO
      ,MN.AMDT_SEQ
      ,MN.AMDT_SEQ - 1 PRE_AMDT_SEQ
      ,DECODE (DUR.CTRT_EFF_DT ,DUR.CTRT_EXP_DT, '',TO_CHAR (DUR.CTRT_EFF_DT, 'YYYYMMDD') ) CTRT_EFF_DT
      ,DECODE (DUR.CTRT_EFF_DT ,DUR.CTRT_EXP_DT, '',TO_CHAR (DUR.CTRT_EXP_DT, 'YYYYMMDD') ) CTRT_EXP_DT
      ,DECODE (MN.EFF_DT, MN.EXP_DT, '', TO_CHAR (MN.EFF_DT, 'YYYYMMDD')) EFF_DT
      ,DECODE (MN.EFF_DT, MN.EXP_DT, '', TO_CHAR (MN.EXP_DT, 'YYYYMMDD')) EXP_DT
	  ,TO_CHAR (MN.FILE_DT, 'YYYYMMDD') FILE_DT
      ,MN.PROP_STS_CD
      ,STS_CD.INTG_CD_VAL_DP_DESC PROP_STS
      ,MN.PROP_OFC_CD
      ,MN.PROP_SREP_CD
      ,SLS_REP1.SREP_NM PROP_SREP_NM
      ,MN.PROP_APRO_OFC_CD
      ,PROG_USR.USR_NM PROP_APRO_STAFF
      ,TO_CHAR(MN.PROP_APRO_DT, 'YYYYMMDD') PROP_APRO_DT
      ,TO_CHAR (MN.CRE_DT, 'YYYYMMDD') CRE_DT
      ,MN.CTRT_CUST_CNT_CD
      ,MN.CTRT_CUST_SEQ
	  ,CUST.CUST_LGL_ENG_NM CTRT_PTY_NM 
      ,MN.PRC_CTRT_CUST_TP_CD
      ,CUST_TY.INTG_CD_VAL_DESC PRC_CTRT_CUST_TP_NM
      ,MN.CTRT_CUST_VAL_SGM_CD
      ,SGM1.INTG_CD_VAL_DP_DESC CTRT_CUST_VAL_SGM
	  ,MN.RESPB_SLS_OFC_CD
	  ,MN.RESPB_SREP_CD
	  ,SLS_REP2.SREP_NM CTRT_CUST_SREP_NM
      ,MN.TGT_MVC_QTY
	  ,MN.CNTR_LOD_UT_CD
	  ,UT.INTG_CD_VAL_DP_DESC UNIT
      ,MN.SLS_LD_NO
	  ,FREE_TIME.INTG_CD_VAL_DP_DESC DMDT_FT_TP_CD
	  ,PRS_CRNT_CM_AMT
	  ,PRS_ESTM_CM_AMT
      ,MN.RFA_CTRT_TP_CD AS RFA_CTRT_TP_CD
FROM   PRI_RP_MN MN
      ,PRI_RP_HDR HDR
      ,PRI_RP_DUR DUR
      ,COM_INTG_CD_DTL STS_CD
      ,COM_INTG_CD_DTL SGM1
	  ,COM_INTG_CD_DTL UT
	  ,PRI_RP_DMDT DMDT
	  ,COM_INTG_CD_DTL FREE_TIME
      ,MDM_SLS_REP SLS_REP1
      ,MDM_SLS_REP SLS_REP2
      ,COM_INTG_CD_DTL CUST_TY
      ,MDM_CUSTOMER CUST
	  ,(
		SELECT A.PROP_NO
    		  ,A.AMDT_SEQ
      	  	  ,A.PROP_STS_CD
      		  ,B.USR_NM
		FROM   PRI_RP_PROG A
		      ,COM_USER B
		WHERE  A.PROG_USR_ID = B.USR_ID
		AND    PROP_STS_CD = 'A'
	    AND    USE_FLG = 'Y'
		AND    PROP_PROG_SEQ =
          				(SELECT /*+ INDEX_DESC(B XPKPRI_RP_PROG) */ PROP_PROG_SEQ
           				   FROM  PRI_RP_PROG B
           				  WHERE  PROP_NO = A.PROP_NO
           					AND  AMDT_SEQ = A.AMDT_SEQ
           					AND  PROP_STS_CD = 'A'
							AND  ROWNUM = 1)
		) PROG_USR
,(
  SELECT ROUND(
		 SUM(
         CASE
         WHEN SS.AMDT_SEQ = 0 THEN NULL
         ELSE SS.PRS_CRNT_CM_AMT
         END
         )) PRS_CRNT_CM_AMT   ,
         ROUND(
		 SUM(
         CASE
    	 WHEN SS.AMDT_SEQ = 0 THEN SS.PRS_ESTM_CM_AMT
    	 ELSE SS.PRS_RMN_CM_AMT
    	 END
    	 )) PRS_ESTM_CM_AMT
FROM  PRI_RP_SCP_MN SS
WHERE SS.PROP_NO   = @[prop_no]
AND   SS.AMDT_SEQ  = @[amdt_seq]
)PRS_CM
WHERE  MN.PROP_NO = @[prop_no]
AND    MN.AMDT_SEQ = @[amdt_seq]
AND    HDR.PROP_NO = MN.PROP_NO
AND    DUR.PROP_NO = MN.PROP_NO
AND    DUR.AMDT_SEQ = MN.AMDT_SEQ
AND    DMDT.PROP_NO(+) = MN.PROP_NO
AND    DMDT.AMDT_SEQ(+) = MN.AMDT_SEQ
AND    SLS_REP1.SREP_CD(+) = MN.PROP_SREP_CD
AND    SLS_REP2.SREP_CD(+) = MN.RESPB_SREP_CD
AND    STS_CD.INTG_CD_ID = 'CD01722'
AND    STS_CD.INTG_CD_VAL_CTNT = MN.PROP_STS_CD
AND    FREE_TIME.INTG_CD_VAL_CTNT(+) = DMDT.DMDT_FT_TP_CD
AND    FREE_TIME.INTG_CD_ID(+) = 'CD01704'
AND    SGM1.INTG_CD_VAL_CTNT(+) = MN.CTRT_CUST_VAL_SGM_CD
AND    SGM1.INTG_CD_ID(+) = 'CD00698'
AND    CUST_TY.INTG_CD_ID(+)      = 'CD00697'
AND    CUST.RVIS_CNTR_CUST_TP_CD = CUST_TY.INTG_CD_VAL_CTNT(+)
AND    CUST.CUST_CNT_CD(+)         = MN.CTRT_CUST_CNT_CD
AND    CUST.CUST_SEQ(+)            = MN.CTRT_CUST_SEQ
AND    CUST.DELT_FLG(+)            = 'N'
AND    CUST.CNTR_DIV_FLG(+) 	   = 'Y'
AND    MN.PROP_NO 				= PROG_USR.PROP_NO(+)
AND    MN.AMDT_SEQ 				= PROG_USR.AMDT_SEQ(+)
AND    UT.INTG_CD_ID(+)         = 'CD00897'
AND UT.INTG_CD_VAL_CTNT(+)         = MN.CNTR_LOD_UT_CD			]]></sql>
			<params>
				<param name="prop_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
