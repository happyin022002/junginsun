<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EBookingReceiptDBDAOsearchXterCmRSQL">
			<desc><![CDATA[searchXterCm]]></desc>
			<sql><![CDATA[
SELECT UPPER(CNTR_NO) CNTR_NO
        , MK_DESC_SEQ CNTR_MF_SEQ
        , PCK_QTY 
        , UPPER(PCK_TP_CD) PCK_TP_cD
        , CNTR_MF_WGT
        , UPPER(WGT_UT_CD) WGT_UT_CD
        , MEAS_QTY 
        , UPPER(MEAS_UT_CD) MEAS_UT_CD 
        , UPPER(REPLACE(NVL(HAMO_TRF_CTNT, ' '),'.','')) HAMO_TRF_CD
        , UPPER(NVL(NCM_NO, DECODE(NCM_MULTI_NO, NULL, ' ', 
                      SUBSTR(NCM_MULTI_NO, 0, DECODE( INSTR(NCM_MULTI_NO,',') , 0,  LENGTH(NCM_MULTI_NO), 
                                                                                    INSTR(NCM_MULTI_NO,',')-1))))) NCM_NO
        , '  ' PO_NO
        , UPPER(NVL(REPLACE(MARKS, '@@', CHR(13)||CHR(10)), ' ')) CNTR_MF_MK_DESC 
        , UPPER(NVL(REPLACE(DESCRIPTION, '@@', CHR(13)||CHR(10)), ' ')) CNTR_MF_GDS_DESC
        , UPPER(NVL(REPLACE(DTL_DESC, '@@', CHR(13)||CHR(10)), '  ')) CNTR_MF_DTL_DESC 
		, NVL(DCGO_SEQ,'') DCGO_SEQ
		, UPPER(NVL(CMDT_HS_CD,'   ')) CMDT_HS_CD
		, '   ' CNTR_MF_NO
        , UPPER(SI_NO) SI_NO
        , XTER_RQST_SEQ
        , UPPER(NCM_MULTI_NO) NCM_MULTI_NO
        , UPPER(WPM_TRT_CD) WPM_TRT_CD
FROM ( /* FOR MASTER BKG */
    SELECT CM.XTER_RQST_NO 
        , CM.XTER_RQST_SEQ 
        , CM.CNTR_NO 
        , CM.MK_DESC_SEQ 
        , CM.PCK_QTY
        , CM.PCK_TP_CD 
        , CM.CNTR_MF_WGT 
        , CM.WGT_UT_CD 
        , CM.MEAS_QTY
        , CM.MEAS_UT_CD
        , CM.CNTR_MF_MK_DESC MARKS
        , CM.CNTR_MF_DESC DESCRIPTION
        , CM.CNTR_MF_DTL_DESC DTL_DESC
        , CM.HAMO_TRF_CTNT
        , CM.NCM_NO
		, CM.CMDT_HS_CD
		, CM.DCGO_SEQ
        , '' AS SI_NO
        , NVL(BKG_JOIN_FNC(CURSOR(
                                  SELECT DTL.NCM_NO
                                    FROM BKG_XTER_CNTR_MK_DESC_NCM DTL
                                   WHERE DTL.XTER_SNDR_ID = CM.XTER_SNDR_ID
                                     AND DTL.XTER_RQST_NO = CM.XTER_RQST_NO
                                     AND DTL.XTER_RQST_SEQ =  CM.XTER_RQST_SEQ
                                     AND DTL.MK_DESC_SEQ = CM.MK_DESC_SEQ
                                     AND DTL.CNTR_NO  = CM.CNTR_NO
                                     AND DTL.CNTR_SEQ = CM.CNTR_SEQ 
                               )
                        ),CM.NCM_NO
        ) NCM_MULTI_NO
        , WPM_TRT_CD
    FROM BKG_XTER_CNTR_MK_DESC CM
    WHERE CM.XTER_SNDR_ID = @[sender_id]
      AND CM.XTER_RQST_NO = @[rqst_no]
      AND CM.XTER_RQST_SEQ= @[rqst_seq]
    UNION ALL /* FOR H/BL */
    SELECT CM.XTER_RQST_NO 
        , CM.XTER_RQST_SEQ 
        , CM.CNTR_NO
        , CM.MK_DESC_SEQ 
        , CM.PCK_QTY 
        , CM.PCK_TP_CD 
        , CM.CNTR_MF_WGT
        , CM.WGT_UT_CD 
        , CM.MEAS_QTY 
        , CM.MEAS_UT_CD 
        , CM.CNTR_MF_MK_DESC MARKS 
        , CM.CNTR_MF_DESC DESCRIPTION 
        , CM.CNTR_MF_DTL_DESC DTL_DESC 
        , CM.HAMO_TRF_CTNT
        , CM.NCM_NO
		, CM.CMDT_HS_CD
		, CM.DCGO_SEQ
        , MST.XTER_RQST_NO SI_NO
        , NVL(BKG_JOIN_FNC(CURSOR(
                                  SELECT DTL.NCM_NO
                                    FROM BKG_XTER_CNTR_MK_DESC_NCM DTL
                                   WHERE DTL.XTER_SNDR_ID = CM.XTER_SNDR_ID
                                     AND DTL.XTER_RQST_NO = CM.XTER_RQST_NO
                                     AND DTL.XTER_RQST_SEQ =  CM.XTER_RQST_SEQ
                                     AND DTL.MK_DESC_SEQ = CM.MK_DESC_SEQ
                                     AND DTL.CNTR_NO  = CM.CNTR_NO
                                     AND DTL.CNTR_SEQ = CM.CNTR_SEQ 
                               )
                        ),CM.NCM_NO
        ) NCM_MULTI_NO
        , WPM_TRT_CD
    FROM BKG_XTER_RQST_MST MST
        , BKG_XTER_CNTR_MK_DESC CM
    WHERE CM.XTER_RQST_NO  = MST.XTER_RQST_NO
      AND CM.XTER_RQST_SEQ = MST.XTER_RQST_SEQ
      AND CM.XTER_SNDR_ID  = MST.XTER_SNDR_ID
      AND MST.BKG_NO       = @[bkg_no]
      AND MST.XTER_SNDR_ID = @[sender_id]
      AND MST.XTER_RQST_SEQ= @[rqst_seq]
      AND MST.XTER_BL_TP_CD= 'H' 
	  AND 0 = ( SELECT COUNT(*)    
    			  FROM BKG_XTER_CNTR_MK_DESC
    			 WHERE XTER_SNDR_ID = @[sender_id]
     			   AND XTER_RQST_NO = @[rqst_no]
      			   AND XTER_RQST_SEQ= @[rqst_seq] )
)
ORDER BY CNTR_NO, MK_DESC_SEQ, XTER_RQST_NO, XTER_RQST_SEQ, PCK_QTY, CNTR_MF_WGT, MEAS_QTY, MARKS, DESCRIPTION			]]></sql>
			<params>
				<param name="sender_id" type="12" value="" out="N"/>
				<param name="rqst_no" type="12" value="" out="N"/>
				<param name="rqst_seq" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
