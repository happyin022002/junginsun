<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BRKGAuditDBDAOSearchAPActualInterfaceCmpnDetailRSQL">
			<desc><![CDATA[SearchAPActualInterfaceDetail]]></desc>
			<sql><![CDATA[
SELECT
           A.FRT_FWRD_CNT_CD||TO_CHAR(A.FRT_FWRD_SEQ,'FM000000') AS FWDR,
           TO_CHAR(A.VNDR_SEQ,'FM000000')                        AS VNDR,
           C.BL_NO,
           A.CMPN_REF_NO,
           ROUND(A.ACT_IF_COMM_AMT,0) AS ACT_IF_COMM_AMT,
           DECODE(SUBSTR(A.CMPN_DIV_CD,1,1),'B','RATE','CNTR')   AS CMPN_TYPE,
           A.CMPN_BKG_RT,
           A.BKG_NO,
           A.CMPN_SEQ,
           A.COMM_PROC_RSLT_RSN,
		   D.BKG_STS_CD
      FROM AGT_CMPN_COMM     A,
           MDM_CUSTOMER      B,
           AGT_COMM_BKG_INFO C,
		   BKG_BOOKING D
     WHERE A.FRT_FWRD_CNT_CD   = SUBSTR(@[fwdr], 0, 2)
       AND A.FRT_FWRD_SEQ      = SUBSTR(@[fwdr], 3, 6)
       AND A.AP_OFC_CD        IS NOT NULL
       AND A.FRT_FWRD_CNT_CD   = B.CUST_CNT_CD
       AND A.FRT_FWRD_SEQ      = B.CUST_SEQ
       AND A.BKG_NO            = C.BKG_NO
	   AND A.BKG_NO            = D.BKG_NO(+)
       AND A.AP_OFC_CD        IS NOT NULL
       AND A.CRE_USR_ID       != 'COST'
       AND C.BL_NO            IS NOT NULL
#if(${vndr_seq} != '')
       AND A.VNDR_SEQ          = @[vndr_seq]
#end
#if(${ap_ofc_cd} != '')
       AND A.AP_OFC_CD         = @[ap_ofc_cd]
#end

#if (${if_option} == 'BF') 
		AND A.COMM_PROC_STS_CD IN('AS')
	#if (${sts_option} == '1') 
		AND A.VSL_DEP_DT BETWEEN TO_DATE(REPLACE(@[search_dt_fr],'-', ''),'YYYYMMDD') AND TO_DATE(REPLACE(@[search_dt_to],'-', ''),'YYYYMMDD')+0.999999
	#else 
		AND A.CRE_DT BETWEEN TO_DATE(REPLACE(@[search_dt_fr],'-', ''),'YYYYMMDD') AND TO_DATE(REPLACE(@[search_dt_to],'-', ''),'YYYYMMDD')+0.999999
	#end
#elseif (${if_option} == 'NC') 
		AND A.COMM_PROC_STS_CD IN('CE','IC','CA','CM','CS')
	#if (${sts_option} == '1') 
		AND A.VSL_DEP_DT BETWEEN TO_DATE(REPLACE(@[search_dt_fr],'-', ''),'YYYYMMDD') AND TO_DATE(REPLACE(@[search_dt_to],'-', ''),'YYYYMMDD')+0.999999
	#else 
		AND A.CRE_DT BETWEEN TO_DATE(REPLACE(@[search_dt_fr],'-', ''),'YYYYMMDD') AND TO_DATE(REPLACE(@[search_dt_to],'-', ''),'YYYYMMDD')+0.999999
	#end
#elseif (${if_option} == 'IF') 
		AND A.COMM_PROC_STS_CD IN('IF')
		AND A.CMPN_IF_DT BETWEEN TO_DATE(REPLACE(@[search_dt_fr],'-', ''),'YYYYMMDD') AND TO_DATE(REPLACE(@[search_dt_to],'-', ''),'YYYYMMDD')+0.999999
		AND A.CSR_NO = @[csr_no]
#end
UNION ALL
SELECT
           'VAT'	AS FWDR,
           ''		AS VNDR,
           ''		AS BL_NO,
           ''		AS CMPN_REF_NO,
           ROUND(SUM(A.ACT_IF_COMM_AMT * NVL(A.INV_TAX_RT, 0) / 100), 2)	AS ACT_IF_COMM_AMT,
           ''		AS CMPN_TYPE,
           NULL CMPN_BKG_RT,
           '' BKG_NO,
           NULL CMPN_SEQ,
           '' COMM_PROC_RSLT_RSN,
		   '' BKG_STS_CD
      FROM AGT_CMPN_COMM     A,
           MDM_CUSTOMER      B,
           AGT_COMM_BKG_INFO C,
		   BKG_BOOKING D
     WHERE A.FRT_FWRD_CNT_CD   = SUBSTR(@[fwdr], 0, 2)
       AND A.FRT_FWRD_SEQ      = SUBSTR(@[fwdr], 3, 6)
       AND A.AP_OFC_CD        IS NOT NULL
       AND A.FRT_FWRD_CNT_CD   = B.CUST_CNT_CD
       AND A.FRT_FWRD_SEQ      = B.CUST_SEQ
       AND A.BKG_NO            = C.BKG_NO
	   AND A.BKG_NO            = D.BKG_NO(+)
       AND A.AP_OFC_CD        IS NOT NULL
       AND A.CRE_USR_ID       != 'COST'
       AND C.BL_NO            IS NOT NULL
#if(${vndr_seq} != '')
       AND A.VNDR_SEQ          = @[vndr_seq]
#end
#if(${ap_ofc_cd} != '')
       AND A.AP_OFC_CD         = @[ap_ofc_cd]
#end

#if (${if_option} == 'BF') 
		AND A.COMM_PROC_STS_CD IN('AS')
	#if (${sts_option} == '1') 
		AND A.VSL_DEP_DT BETWEEN TO_DATE(REPLACE(@[search_dt_fr],'-', ''),'YYYYMMDD') AND TO_DATE(REPLACE(@[search_dt_to],'-', ''),'YYYYMMDD')+0.999999
	#else 
		AND A.CRE_DT BETWEEN TO_DATE(REPLACE(@[search_dt_fr],'-', ''),'YYYYMMDD') AND TO_DATE(REPLACE(@[search_dt_to],'-', ''),'YYYYMMDD')+0.999999
	#end
#elseif (${if_option} == 'NC') 
		AND A.COMM_PROC_STS_CD IN('CE','IC','CS','CM','CA')
	#if (${sts_option} == '1') 
		AND A.VSL_DEP_DT BETWEEN TO_DATE(REPLACE(@[search_dt_fr],'-', ''),'YYYYMMDD') AND TO_DATE(REPLACE(@[search_dt_to],'-', ''),'YYYYMMDD')+0.999999
	#else 
		AND A.CRE_DT BETWEEN TO_DATE(REPLACE(@[search_dt_fr],'-', ''),'YYYYMMDD') AND TO_DATE(REPLACE(@[search_dt_to],'-', ''),'YYYYMMDD')+0.999999
	#end
#elseif (${if_option} == 'IF') 
		AND A.COMM_PROC_STS_CD IN('IF')
		AND A.CMPN_IF_DT BETWEEN TO_DATE(REPLACE(@[search_dt_fr],'-', ''),'YYYYMMDD') AND TO_DATE(REPLACE(@[search_dt_to],'-', ''),'YYYYMMDD')+0.999999
		AND A.CSR_NO = @[csr_no]

#end
ORDER BY 1			]]></sql>
			<params>
				<param name="fwdr" type="12" value="" out="Y"/>
				<param name="vndr_seq" type="12" value="" out="Y"/>
				<param name="ap_ofc_cd" type="12" value="" out="Y"/>
				<param name="search_dt_fr" type="12" value="" out="Y"/>
				<param name="search_dt_to" type="12" value="" out="Y"/>
				<param name="csr_no" type="12" value="" out="Y"/>
			</params>
		</query>
	</querys>
</sqls>
