<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TransferOrderIssueDBDAOcopyTroBySeqCSQL">
			<desc><![CDATA[general tro를 copy한다]]></desc>
			<sql><![CDATA[
insert into bkg_tro(BKG_NO 
,IO_BND_CD 
,RTN_TRO_FLG 
,TRO_SEQ 
,RCV_TERM_CD 
,RQST_DT 
,RQST_USR_ID 
,OWNR_TRK_FLG 
,ACT_SHPR_CNT_CD 
,ACT_SHPR_SEQ 
,ACT_SHPR_NM 
,ACT_SHPR_PHN_NO 
,ACT_SHPR_ADDR 
,ZN_CD 
,DOR_LOC_CD 
,DOR_PST_NO 
,BIZ_RGST_NO 
,CFM_FLG 
,CFM_DT 
,DIFF_RMK 
,CNTC_PSON_NM 
,CNTC_FAX_NO 
,CNTC_PHN_NO 
,CNTC_MPHN_NO 
,CXL_FLG 
,SO_FLG 
,SO_ACT_CUST_NO 
,SO_ACT_CUST_SEQ 
,PCTL_NO 
,VSL_CD 
,SKD_VOY_NO 
,SKD_DIR_CD 
,POL_CD 
,POD_CD 
,TRO_BKG_NO 
,CRE_USR_ID 
,CRE_DT 
,UPD_USR_ID 
,UPD_DT
)
select @[targetBkg] BKG_NO 
,IO_BND_CD 
,RTN_TRO_FLG 

#if(${tro_seq}!='')
--tro split
	,nvl((select max(tro_seq)
			from bkg_tro 
		   where bkg_no 		= @[targetBkg]
        	 and io_bnd_cd 		= 'O'
			 and rtn_tro_flg 	= 'N'
			 and cxl_flg 		= 'N'), 0) + 1
#else
--tro copy
	,rownum
#end

,RCV_TERM_CD 
,null RQST_DT 
,null RQST_USR_ID 
,OWNR_TRK_FLG 
,ACT_SHPR_CNT_CD 
,ACT_SHPR_SEQ 
,ACT_SHPR_NM 
,ACT_SHPR_PHN_NO 
,ACT_SHPR_ADDR 
,ZN_CD 
,DOR_LOC_CD 
,DOR_PST_NO 
,BIZ_RGST_NO 
,'N'  CFM_FLG 
,null CFM_DT 
,DIFF_RMK 
,CNTC_PSON_NM 
,CNTC_FAX_NO 
,CNTC_PHN_NO 
,CNTC_MPHN_NO 
,'N' CXL_FLG 
,'N' SO_FLG 
,null SO_ACT_CUST_NO 
,null SO_ACT_CUST_SEQ 
,tro_seq      PCTL_NO  --cancel을 제외하고 seq를 1부터 딴 다음 bkg_tro_dtl에 seq를 유지하기 위해 임시로 넣음
,VSL_CD 
,SKD_VOY_NO 
,SKD_DIR_CD 
,POL_CD 
,POD_CD 
,null TRO_BKG_NO 
,@[usr_id] CRE_USR_ID 
,sysdate CRE_DT 
,@[usr_id] UPD_USR_ID 
,sysdate UPD_DT
  from bkg_tro
 where bkg_no 		= @[bkg_no] 
   and io_bnd_cd 	= 'O'
   and rtn_tro_flg 	= 'N'
   and cxl_flg 		= 'N'
#if(${tro_seq}!='')
--tro split
   and tro_seq 		= @[tro_seq]
#else
 order by bkg_no, tro_seq
#end			]]></sql>
			<params>
				<param name="targetBkg" type="12" value="" out="N"/>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="tro_seq" type="2" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
