<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CLLCDLManifestDBDAOsearchPreAdivceVvdInfoRSQL">
			<desc><![CDATA[화면 ESM_BKG_1153 의 그리드 1 조회 하는 쿼리 searchPreAdivceVvdInfo]]></desc>
			<sql><![CDATA[
SELECT 
    B.VSL_CD || B.SKD_VOY_NO || B.SKD_DIR_CD AS VVD, 
    B.POL_CD AS POL_CD,   
    COUNT(B.BKG_NO) SUBTOTAL
  FROM BKG_VVD A, BKG_BOOKING B
 WHERE 1=1 
   AND A.BKG_NO = B.BKG_NO 
   AND B.BKG_STS_CD != 'X' 
   AND A.VSL_CD = SUBSTR(@[s_vvd],1,4)
   AND A.SKD_VOY_NO = SUBSTR(@[s_vvd],5,4)
   AND A.SKD_DIR_CD = SUBSTR(@[s_vvd],9,1)

#if(${s_full_rtn_yd_cd} != '')
   AND B.FULL_RTN_YD_CD like NVL(@[s_full_rtn_yd_cd]||@[s_full_rtn_yd_nod_cd]||'%','%')
#end

#if(${s_pol_cd} != '')
   AND A.POL_CD like NVL(@[s_pol_cd]||'%','%')
#end

#if(${s_por_cd} != '')
   AND B.POR_CD like NVL(@[s_por_cd]||'%','%')
#end

   AND 'Y' = (  SELECT MAX(DECODE(CNMV_STS_CD,'OP','Y','N')) 
				FROM BKG_CONTAINER 
				WHERE BKG_NO = A.BKG_NO 
			#if(${op_fm_dt} != '' && ${op_to_dt} != '')
				AND CNMV_EVNT_DT BETWEEN TO_DATE(@[op_fm_dt],'YYYY-MM-DD') AND TO_DATE(@[op_to_dt],'YYYY-MM-DD') + 0.99999
			#end
			 )
GROUP BY B.VSL_CD, B.SKD_VOY_NO, B.SKD_DIR_CD, A.VSL_CD, A.SKD_VOY_NO, A.SKD_DIR_CD, B.POL_CD			]]></sql>
			<params>
				<param name="s_vvd" type="12" value="kkkkk" out="Y"/>
				<param name="s_full_rtn_yd_cd" type="12" value="" out="Y"/>
				<param name="s_full_rtn_yd_nod_cd" type="12" value="" out="Y"/>
				<param name="s_pol_cd" type="12" value="" out="Y"/>
				<param name="s_por_cd" type="12" value="" out="Y"/>
				<param name="op_fm_dt" type="12" value="" out="Y"/>
				<param name="op_to_dt" type="12" value="" out="Y"/>
			</params>
		</query>
	</querys>
</sqls>
