<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ChinaManifestListDownloadDBDAOsearchBlListRSQL">
			<desc><![CDATA[BkgCstmsChnBlVO]]></desc>
			<sql><![CDATA[
SELECT  B.BKG_NO
       ,MAX( B.BKG_NO||CHR(9)||
             B.BL_NO||CHR(9)||
             B.BL_NO_TP||CHR(9)||
             VVD.VSL_CD||CHR(9)||
             VVD.SKD_VOY_NO||CHR(9)||
             VVD.SKD_DIR_CD||CHR(9)||
             VVD.POL_CD||CHR(9)||
             VVD.POD_CD||CHR(9)||
             B.POR_CD||CHR(9)||
             B.POL_CD||CHR(9)||
             B.POD_CD||CHR(9)||
             B.DEL_CD||CHR(9)||
             NVL(TO_CHAR(BM.OBL_ISS_DT, 'yyyymmdd hh24miss'), ' ')||CHR(9)||
             NVL(TO_CHAR(BCD.BL_OBRD_DT, 'yyyymmdd hh24miss'), ( SELECT TO_CHAR(VSL.VPS_ETB_DT, 'yyyymmdd hh24miss') 
                                                                   FROM BKG_VVD VVD, VSK_VSL_PORT_SKD VSL
                                                                   WHERE VVD.VSL_CD = VSL.VSL_CD
                                                                   AND VVD.SKD_VOY_NO = VSL.SKD_VOY_NO
                                                                   AND VVD.SKD_DIR_CD = VSL.SKD_DIR_CD
                                                                   AND VVD.POL_CD = VSL.VPS_PORT_CD
                                                                   AND VVD.BKG_NO = B.BKG_NO
                                                                   AND VVD.VSL_PRE_PST_CD||VSL_SEQ = (SELECT MAX(VSL_PRE_PST_CD||VSL_SEQ) FROM BKG_VVD
                                                                                                        WHERE BKG_NO = B.BKG_NO
                                                                   AND VSL.CLPT_IND_SEQ = 1)        
                
             ))||CHR(9)||
             DECODE(@[trans_mode],'P','21',DECODE(B.DEL_CD,'CNHKG','21',DECODE(SUBSTR(B.DEL_CD,1,2),'CN',
				(SELECT CHN_CSTMS_TRSP_MOD_CD FROM BKG_CSTMS_CHN_DE_MOD
  				WHERE POD_CD = VVD.POD_CD
  				AND DEL_CD = B.DEL_CD ),'21')))||CHR(9)||
             B.RCV_TERM_CD||CHR(9)||
             B.DE_TERM_CD||CHR(9)||
             NVL(BR.FRT_TERM_CD, ' ')||CHR(9)||
             RPAD(REPLACE(REPLACE(NVL(BCD.CSTMS_DESC,' '),CHR(13)||CHR(10),' '),CHR(9),' '),256)||CHR(9)||
             NVL(BCD.PCK_QTY,0)||CHR(9)||
             NVL(BCD.PCK_TP_CD,' ')||CHR(9)||
             DECODE(NVL(BCD.WGT_UT_CD,' '),'LBS',ROUND(NVL(BCD.ACT_WGT,0)*0.4536,3), NVL(BCD.ACT_WGT,0))||CHR(9)|| /* 20060707 yong: LBS=>KGS로 환산 */
             DECODE(NVL(BCD.WGT_UT_CD,' '),'LBS','KGS',NVL(BCD.WGT_UT_CD,' '))||CHR(9)||
             NVL(BCD.MEAS_QTY,0)||CHR(9)||
             NVL(BCD.MEAS_UT_CD,' ')||CHR(9)||
             B.BKG_CGO_TP_CD||CHR(9)|| /* 20051124 yong : cgo type, special dg cargo, special rf cargo D/L되도록 추가 */
             B.DCGO_FLG||CHR(9)||
             B.RC_FLG||CHR(9)||
             NVL(OFC.LOC_CD,' ')||CHR(9)||
             @[trans_mode]||CHR(9)||
             TO_CHAR(SKD.VPS_ETA_DT, 'YYYYMMDD HH24MISS')||CHR(9)||
			 DECODE(B.DEL_NOD_CD,'CNJXGM1',B.DEL_NOD_CD,VVD.POD_YD_CD)) BL_NO
FROM   BKG_BL_ISS BM,
       BKG_RATE BR,
       BKG_BOOKING B,
       BKG_VVD VVD,
       BKG_BL_DOC BCD,
       MDM_ORGANIZATION OFC,
       VSK_VSL_PORT_SKD SKD
WHERE  1=1
AND (#foreach($field_id in ${field_list}) 
      	#if($velocityCount > 1)
        OR #end      B.BKG_NO IN ( $field_id )
     #end
)
#if (${bkg_cgo_tp_cd} != '') 
AND    DECODE(B.BKG_CGO_TP_CD,'P','P','F') = @[bkg_cgo_tp_cd]
#end
AND    B.BKG_NO                    =    VVD.BKG_NO
AND    B.BKG_NO                    =    BM.BKG_NO(+)
AND    B.BKG_NO                    =    BR.BKG_NO(+)
AND    BM.OBL_ISS_OFC_CD           =    OFC.OFC_CD(+)
AND    VVD.VSL_CD                  =    SUBSTR(@[vvd],1,4)
AND    VVD.SKD_VOY_NO              =    SUBSTR(@[vvd],5,4)
AND    VVD.SKD_DIR_CD              =    SUBSTR(@[vvd],9,1)
AND    DECODE(@[trans_mode],'D',VVD.POD_CD,VVD.POL_CD) = @[loc_cd]
AND    B.BKG_NO                    =    BCD.BKG_NO(+)
AND    VVD.VSL_CD                  =    SKD.VSL_CD
AND    VVD.SKD_VOY_NO              =    SKD.SKD_VOY_NO
AND    VVD.SKD_DIR_CD              =    SKD.SKD_DIR_CD
AND    VVD.POD_CD                  =    SKD.VPS_PORT_CD
GROUP BY B.BKG_NO			]]></sql>
			<params>
				<param name="trans_mode" type="12" value="" out="N"/>
				<param name="bkg_cgo_tp_cd" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="loc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
