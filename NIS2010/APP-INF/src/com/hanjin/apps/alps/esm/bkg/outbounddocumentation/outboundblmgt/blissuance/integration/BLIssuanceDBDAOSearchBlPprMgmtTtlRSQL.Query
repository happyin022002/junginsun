<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLIssuanceDBDAOSearchBlPprMgmtTtlRSQL">
			<desc><![CDATA[OBL PAPER MANAGEMENT화면의 SUMMARY값을 구한다.]]></desc>
			<sql><![CDATA[
SELECT TTL.DTRB_YR
      ,TTL.RHQ_CD
      ,TTL.OFC_CD
      ,TTL.CUST_CNT_CD
      ,TTL.CUST_SEQ
      ,TTL.CUST_NM
      ,NVL((SELECT /*+ INDEX(AUTH XAK01BKG_INET_BL_PRN_AUTH) */ count(*) * 3
             FROM BKG_INET_BL_PRN_AUTH AUTH
            WHERE AUTH.AUTH_DT IS NOT NULL
              AND AUTH.N1ST_PRN_DT IS NOT NULL
              AND AUTH.DELT_FLG = 'N'
              AND AUTH.PRN_CUST_CNT_CD = TTL.CUST_CNT_CD
              AND AUTH.PRN_CUST_SEQ = TTL.CUST_SEQ
#if (${dtrb_yr} != 'ALL') 
              AND AUTH.N1ST_PRN_DT >= DECODE(@[dtrb_yr],'2015',TO_DATE('20150401','YYYYMMDD'),TO_DATE(@[dtrb_yr]||'0101','YYYYMMDD'))
              AND AUTH.N1ST_PRN_DT < TO_DATE(@[dtrb_yr] + 1||'0101','YYYYMMDD')
#else
              AND AUTH.N1ST_PRN_DT >= TO_DATE('20150401','YYYYMMDD')
#end
        ),0) AS CUST_WDR_KNT
       ,TTL.CUST_DTRB_KNT
       ,TO_CHAR(TTL.UPD_DT,'YYYY.MM.DD') AS UPD_DT
  FROM (
    SELECT PPR.DTRB_YR
          ,PPR.RHQ_CD
          ,PPR.OFC_CD
          ,PPR.CUST_CNT_CD
          ,PPR.CUST_SEQ
          ,MDM.CUST_LGL_ENG_NM AS CUST_NM
          ,SUM(PPR.CUST_DTRB_KNT) AS CUST_DTRB_KNT
          ,MAX(PPR.UPD_DT) AS UPD_DT
      FROM BKG_CUST_BL_PPR_MGMT PPR
          ,MDM_CUSTOMER MDM
     WHERE 1=1
    #if (${dtrb_yr} != 'ALL') 
       AND PPR.DTRB_YR = @[dtrb_yr]
    #end 
    #if (${rhq_cd} != '') 
       AND PPR.RHQ_CD = @[rhq_cd]
    #end   
    #if (${ofc_cd} != '') 
       AND PPR.OFC_CD = @[ofc_cd]
    #end   
    #if (${cust_cnt_cd} != '') 
       AND PPR.CUST_CNT_CD = @[cust_cnt_cd]
    #end 
    #if (${cust_seq} != '') 
       AND PPR.CUST_SEQ = @[cust_seq]
    #end 
       AND PPR.CUST_CNT_CD = MDM.CUST_CNT_CD
       AND PPR.CUST_SEQ = MDM.CUST_SEQ
    #if (${cust_nm} != '') 
       AND MDM.CUST_LGL_ENG_NM LIKE '%'||@[cust_nm]||'%'
    #end
    GROUP BY PPR.DTRB_YR
            ,PPR.RHQ_CD
            ,PPR.OFC_CD
            ,PPR.CUST_CNT_CD
            ,PPR.CUST_SEQ
            ,MDM.CUST_LGL_ENG_NM
        ) TTL
ORDER BY TTL.DTRB_YR
        ,TTL.RHQ_CD
        ,TTL.OFC_CD
        ,TTL.CUST_CNT_CD
        ,TTL.CUST_SEQ
			]]></sql>
			<params>
				<param name="dtrb_yr" type="12" value="" out="N"/>
				<param name="rhq_cd" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="cust_cnt_cd" type="12" value="" out="N"/>
				<param name="cust_seq" type="12" value="" out="N"/>
				<param name="cust_nm" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
