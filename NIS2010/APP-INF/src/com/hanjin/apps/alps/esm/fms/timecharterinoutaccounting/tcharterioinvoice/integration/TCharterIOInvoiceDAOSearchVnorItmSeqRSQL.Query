<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOInvoiceDAOSearchVnorItmSeqRSQL">
			<desc><![CDATA[Vnor Itm Seq 조회]]></desc>
			<sql><![CDATA[
SELECT 
    CASE WHEN ( 
                SELECT  
                    COUNT(F.VNOR_SEQ) 
                FROM FMS_VNOR F, FMS_VNOR_ITM I 
                WHERE 1=1 
                AND F.VSL_CD = @[vsl_cd] 
                AND F.VNOR_OFFH_FM_DT = TO_DATE(@[vnor_offh_fm_dt],'YYYYMMDDHH24MI') 
                AND F.VNOR_OFFH_TO_DT = TO_DATE(@[vnor_offh_to_dt],'YYYYMMDDHH24MI') 
                AND F.VSL_CD = I.VSL_CD 
                AND F.VNOR_SEQ = I.VNOR_SEQ 
                AND I.VNOR_ITM_FLET_ADD_CD = 'O'     
    			AND F.CR_CHK_FLG = @[cr_chk_flg] 
                ) > 0 THEN (  
                            SELECT MAX(VNOR_ITM_SEQ)+1 FROM FMS_VNOR_ITM I 
                            WHERE 1=1 
                            AND I.VSL_CD = @[vsl_cd] 
                            AND I.VNOR_SEQ = ( 
                                                SELECT  
                                                    MAX(F.VNOR_SEQ)  
                                                FROM FMS_VNOR F, FMS_VNOR_ITM I 
                                                WHERE 1=1 
                                                AND F.VSL_CD = @[vsl_cd] 
                                                AND F.VNOR_OFFH_FM_DT = TO_DATE(@[vnor_offh_fm_dt],'YYYYMMDDHH24MI') 
                                                AND F.VNOR_OFFH_TO_DT = TO_DATE(@[vnor_offh_to_dt],'YYYYMMDDHH24MI') 
                                                AND F.VSL_CD = I.VSL_CD 
                                                AND F.VNOR_SEQ = I.VNOR_SEQ 
                                                AND I.VNOR_ITM_FLET_ADD_CD = 'O'       
            									AND F.CR_CHK_FLG = @[cr_chk_flg]                                             
                                              )                 
                            )  
          ELSE 1 
          END VNOR_SEQ 
FROM DUAL			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="vnor_offh_fm_dt" type="12" value="" out="N"/>
				<param name="vnor_offh_to_dt" type="12" value="" out="N"/>
				<param name="cr_chk_flg" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
