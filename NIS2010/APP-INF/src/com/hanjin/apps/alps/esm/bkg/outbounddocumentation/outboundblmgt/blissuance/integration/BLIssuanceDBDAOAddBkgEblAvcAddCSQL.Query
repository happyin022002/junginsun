<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLIssuanceDBDAOAddBkgEblAvcAddCSQL">
			<desc><![CDATA[]]></desc>
			<sql><![CDATA[
INSERT	INTO BKG_EBL_AVC_ADD
	(BKG_NO
	,BL_NO	
	,BKG_EBL_SEQ
	,CNTR_SEQ
	,DOC_PARA_NO1
	,DOC_PARA_NO2
	,JB_TIT_CTNT
	,CUST_REF_RMK1
	,CUST_REF_RMK2
	,IF_FLG
	,CRE_USR_ID
	,CRE_DT
	,UPD_USR_ID
	,UPD_DT)
SELECT	BK.BKG_NO BKG_NO
	,BK.BL_NO BL_NO
	,@[bkg_ebl_seq] BKG_EBL_SEQ
	,ROWNUM CNTR_SEQ
	,BK.BKG_NO||LTRIM(TO_CHAR(@[bkg_ebl_seq], '0000')) DOC_PARA_NO1
	,BK.BKG_NO||LTRIM(TO_CHAR(@[bkg_ebl_seq], '0000'))||LTRIM(TO_CHAR(ROWNUM, '0000')) DOC_PARA_NO2
	,ADD_INFO.TITLE JB_TIT_CTNT
	,'' CUST_REF_RMK1
	,CASE WHEN ADD_INFO.TITLE ='EQ' THEN '(EQ SUB : '||ADD_INFO.DES||')'
	 ELSE ADD_INFO.DES
	 END CUST_REF_RMK2
	,'N' IF_FLG
	,@[usr_id] CRE_USR_ID
	,SYSDATE CRE_DT
	,@[usr_id] UPD_USR_ID
	,SYSDATE UPD_DT	
  FROM	BKG_BOOKING BK, 
		(SELECT BKG_NO,'EQ' AS TITLE,BKG_JOIN_FNC(CURSOR(  
                            SELECT CNTR_TPSZ_CD||'X'||EQ_SUBST_CGO_QTY AS A  
                              FROM BKG_QUANTITY  
                             WHERE BKG_NO = BK.BKG_NO
                               AND EQ_SUBST_CNTR_TPSZ_CD IS NOT NULL  
                               AND EQ_SUBST_CGO_QTY <> 0 ),',') DES
		  FROM BKG_BOOKING BK
          WHERE BKG_NO = @[bkg_no]
         UNION ALL 
         SELECT BKG_NO, 'FMC',DECODE(RTRIM(RF.CUST_REF_NO_CTNT),'',NULL,'FMC'||SUBSTR(RF.CUST_REF_NO_CTNT,1,6)) FMC_NO
         FROM BKG_REFERENCE RF WHERE BKG_NO =  @[bkg_no] AND BKG_REF_TP_CD  = 'FMCN' AND ROWNUM =1
         UNION ALL 
         SELECT BKG_NO, 'CA',DECODE(BL.BDR_CNG_FLG, 'N', NULL ,'C/A') AS CA_no  FROM BKG_BL_DOC BL
         WHERE BKG_NO = @[bkg_no]
         ) ADD_INFO
							
 WHERE 	BK.BKG_NO = @[bkg_no]
   AND BK.BKG_NO = ADD_INFO.BKG_NO(+) 
   AND ADD_INFO.DES IS NOT NULL			]]></sql>
			<params>
				<param name="bkg_ebl_seq" type="12" value="" out="N"/>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
