<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="NetworkCostDBDAOCreateAverageUCRawCSQL">
			<desc><![CDATA[Raw Data]]></desc>
			<sql><![CDATA[
INSERT INTO MAS_OP_AVG_VSL_TP_COST
(
	    COST_YRMON
      , TRD_CD
      , RLANE_CD
      , DIR_CD
      , VSL_OSHP_CD
      , STND_COST_CD
      , FNL_HJS_BSA_CAPA
      , FREQ_NO
      , NTWK_HIR_COST_AMT
      , CRE_USR_ID
      , CRE_DT
      , UPD_USR_ID
      , UPD_DT
)

 SELECT COST_YRMON
      , TRD_CD
      , RLANE_CD
      , DIR_CD
      , VSL_OSHP_CD     
      , DECODE(B.NO, 1, '43102011', 2, '53101000', 3, '53102000', 4, '53200000', 5, '54100000'
                   , 6, '54250000', 7, '54300000', 8, '54200000', 9, '54150000', 10 , '54450000'
		   , 11, '54180000', 12, '54550000', 13, '54350000', 14, '54400000') STND_COST_CD
      , HJS_BSA_CAPA AS FNL_HJS_BSA_CAPA
      , FREQ_NO      
      , DECODE(B.NO, 1, SPC_INCOME, 2, AMT_01, 3, AMT_02, 4, AMT_03, 5, AMT_04
                   , 6, AMT_05, 7, AMT_06, 8, AMT_07, 9, AMT_08, 10 , AMT_09
		   , 11, AMT_10, 12, AMT_11, 13, AMT_12, 14, AMT_13) NTWK_HIR_COST_AMT
      , @[cre_usr_id] CRE_USR_ID
      , SYSDATE CRE_DT
      , @[cre_usr_id] UPD_USR_ID
      , SYSDATE UPD_DT
   FROM
        (
              SELECT COST_YRMON
                      , TRD_CD
                      , RLANE_CD
                      , DIR_CD
                      , VSL_OSHP_CD
                      , SUM(FNL_HJS_BSA_CAPA) AS HJS_BSA_CAPA
                      , COUNT(*) FREQ_NO                                              
                      , SUM(SPC_INCOME) SPC_INCOME
                      , SUM(AMT_01 ) AS AMT_01
                      , SUM(AMT_02)  AS AMT_02
                      , SUM(AMT_03)  AS AMT_03
                      , SUM(AMT_04)  AS AMT_04
                      , SUM(AMT_05)  AS AMT_05
                      , SUM(AMT_06)  AS AMT_06
                      , SUM(AMT_07)  AS AMT_07
                      , SUM(AMT_08)  AS AMT_08
                      , SUM(AMT_09)  AS AMT_09
                      , SUM(AMT_10)  AS AMT_10
                      , SUM(AMT_11)  AS AMT_11
                      , SUM(AMT_12)  AS AMT_12
                      , SUM(AMT_13)  AS AMT_13
                   FROM
                        (
                         SELECT REPLACE(@[f_cost_yrmon],'-','') AS COST_YRMON
                              , A.COST_WK
                              , A.TRD_CD
                              , A.RLANE_CD
                              , A.VSL_CD
                              , A.SKD_VOY_NO
                              , A.DIR_CD
                              , NVL(V.VSL_OSHP_CD, 'OTH') VSL_OSHP_CD
                              , B.FNL_HJS_BSA_CAPA
                              , NVL(B.INCM_BZC_CHTR_AMT, 0)+NVL(B.INCM_SUB_CHTR_AMT, 0)+NVL(B.INCM_CRS_CHTR_AMT, 0) AS SPC_INCOME
                              , C.AMT_01
                              , C.AMT_02
                              , C.AMT_03
                              , C.AMT_04
                              , C.AMT_05
                              , C.AMT_06
                              , C.AMT_07
                              , C.AMT_08
                              , C.AMT_09
                              , C.AMT_10
                              , C.AMT_11
                              , C.AMT_12
                              , C.AMT_13
                           FROM MAS_MON_VVD A
                              , BSA_VVD_MST B
                              , (SELECT A1.TRD_CD                                                         AS TRD_CD
                                      , A1.RLANE_CD                                                       AS RLANE_CD
                                      , A1.IOC_CD                                                         AS IOC_CD
                                      , A1.VSL_CD                                                         AS VSL_CD
                                      , A1.SKD_VOY_NO                                                     AS SKD_VOY_NO
                                      , A1.DIR_CD                                                         AS DIR_CD
                                      , SUM(TS_UC_AMT)                                                    AS TS_UC_AMT
                                      , SUM(DECODE(A1.STND_COST_CD, '53101000', A1.NTWK_HIR_COST_AMT, 0)) AS AMT_01
                                      , SUM(DECODE(A1.STND_COST_CD, '53102000', A1.NTWK_HIR_COST_AMT, 0)) AS AMT_02
                                      , SUM(DECODE(A1.STND_COST_CD, '53200000', A1.NTWK_HIR_COST_AMT, 0)) AS AMT_03
                                      , SUM(DECODE(A1.STND_COST_CD, '54100000', A1.NTWK_HIR_COST_AMT, 0)) AS AMT_04
                                      , SUM(DECODE(A1.STND_COST_CD, '54250000', A1.NTWK_HIR_COST_AMT, 0)) AS AMT_05
                                      , SUM(DECODE(A1.STND_COST_CD, '54300000', A1.NTWK_HIR_COST_AMT, 0)) AS AMT_06
                                      , SUM(DECODE(A1.STND_COST_CD, '54200000', A1.NTWK_HIR_COST_AMT, 0)) AS AMT_07
                                      , SUM(DECODE(A1.STND_COST_CD, '54150000', A1.NTWK_HIR_COST_AMT, 0)) AS AMT_08
                                      , SUM(DECODE(A1.STND_COST_CD, '54450000', A1.NTWK_HIR_COST_AMT, 0)) AS AMT_09
                                      , SUM(DECODE(A1.STND_COST_CD, '54180000', A1.NTWK_HIR_COST_AMT, 0)) AS AMT_10
                                      , SUM(DECODE(A1.STND_COST_CD, '54550000', A1.NTWK_HIR_COST_AMT, 0)) AS AMT_11
                                      , SUM(DECODE(A1.STND_COST_CD, '54350000', A1.NTWK_HIR_COST_AMT, 0)) AS AMT_12
                                      , SUM(DECODE(A1.STND_COST_CD, '54400000', A1.NTWK_HIR_COST_AMT, 0)) AS AMT_13
                                   FROM MAS_VVD_HIR A1
                               GROUP BY A1.TRD_CD
                                      , A1.RLANE_CD
                                      , A1.IOC_CD
                                      , A1.VSL_CD
                                      , A1.SKD_VOY_NO
                                      , A1.DIR_CD
                                ) C
                              , MAS_LANE_RGST R
                              , MAS_VSL_RGST V
                          WHERE A.TRD_CD     = B.TRD_CD
                            AND A.RLANE_CD   = B.RLANE_CD
                            AND A.IOC_CD     = B.IOC_CD
                            AND A.VSL_CD     = B.VSL_CD
                            AND A.SKD_VOY_NO = B.SKD_VOY_NO
                            AND A.DIR_CD     = B.SKD_DIR_CD
                            AND A.TRD_CD     = C.TRD_CD
                            AND A.RLANE_CD   = C.RLANE_CD
                            AND A.IOC_CD     = C.IOC_CD
                            AND A.VSL_CD     = C.VSL_CD
                            AND A.SKD_VOY_NO = C.SKD_VOY_NO
                            AND A.DIR_CD     = C.DIR_CD
                            AND A.TRD_CD     = R.TRD_CD
                            AND A.RLANE_CD   = R.RLANE_CD
                            AND A.IOC_CD     = R.IOC_CD
                            AND A.DIR_CD     = R.DIR_CD
                            AND R.DELT_FLG   = 'N'
                            AND A.VSL_CD   = V.VSL_CD(+)
                            AND V.LST_FLG(+)  = 'Y'
                            AND V.DELT_FLG(+) = 'N'
                            AND A.DELT_FLG = 'N'
                            AND SUBSTR(A.SLS_YRMON,1,4)||A.COST_WK BETWEEN REPLACE(@[f_fm_yrwk],'-','') AND REPLACE(@[f_to_yrwk],'-','')
                            AND B.FNL_HJS_BSA_CAPA > 0
                            AND A.SUB_TRD_CD <> 'IP'
                        )
               GROUP BY COST_YRMON
                      , TRD_CD
                      , RLANE_CD
                      , DIR_CD
                      , VSL_OSHP_CD
      
        ) A
      , (SELECT LEVEL NO
           FROM DUAL
                CONNECT BY LEVEL <= 14
        ) B			]]></sql>
			<params>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="f_cost_yrmon" type="12" value="" out="N"/>
				<param name="f_fm_yrwk" type="12" value="" out="N"/>
				<param name="f_to_yrwk" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
