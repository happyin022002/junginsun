<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MultiDimensionRPTDBDAOSearchPlAdjustmentTotalListRSQL">
			<desc><![CDATA[MultiDimensionRPTDBDAOSearchPlAdjustmentTotalListRSQL]]></desc>
			<sql><![CDATA[
SELECT DECODE(GROUPING(RPT_ITM_DESC), 1, '1', '2') AS LV
      ,MIN(SEQ) AS SEQ
      ,DECODE(RPT_ITM_DESC, NULL, SGRP_COST_CD_DESC, RPT_ITM_DESC) AS ITM_DESC
      ,STND_COST_CD
      ,SGRP_COST_CD_DESC
      ,RPT_ITM_DESC
      ,RPT_ITM_COLR_FLG
      ,SUM(HH_WKLY_AMT) AS HH_WKLY_AMT
      ,SUM(BH_WKLY_AMT) AS BH_WKLY_AMT
      ,SUM(MB_WKLY_AMT) AS MB_WKLY_AMT
      ,SUM(TTL_WKLY_AMT) AS TTL_WKLY_AMT
      ,SUM(HH_ADJ_AMT) AS HH_ADJ_AMT
      ,SUM(BH_ADJ_AMT) AS BH_ADJ_AMT
      ,SUM(MB_ADJ_AMT) AS MB_ADJ_AMT
      ,SUM(TTL_ADJ_AMT) AS TTL_ADJ_AMT
      ,SUM(HH_MON_AMT) AS HH_MON_AMT
      ,SUM(BH_MON_AMT) AS BH_MON_AMT
      ,SUM(MB_MON_AMT) AS MB_MON_AMT
      ,SUM(TTL_MON_AMT) AS TTL_MON_AMT
      ,COUNT(1) AS CNT
FROM (
        SELECT SEQ
              ,STND_COST_CD
              ,SGRP_COST_CD
              ,RPT_ITM_DESC
              ,SGRP_COST_CD_DESC
              ,RPT_ITM_COLR_FLG
              ,DECODE(STND_COST_CD,'RPB00000',DECODE(MAX(HH_LOAD),0,0,MAX(HH_WKLY_REV_AMT)/MAX(HH_LOAD)),'LOADFACT',DECODE(MAX(HH_BSA_CAPA),0,0,MAX(HH_LOAD)/MAX(HH_BSA_CAPA) * 100),SUM(NVL(HH_WKLY_AMT, 0))) AS HH_WKLY_AMT
              ,DECODE(STND_COST_CD,'RPB00000',DECODE(MAX(BH_LOAD),0,0,MAX(BH_WKLY_REV_AMT)/MAX(BH_LOAD)),'LOADFACT',DECODE(MAX(BH_BSA_CAPA),0,0,MAX(BH_LOAD)/MAX(BH_BSA_CAPA) * 100),SUM(NVL(BH_WKLY_AMT, 0))) AS BH_WKLY_AMT
              ,DECODE(STND_COST_CD,'RPB00000',DECODE(MAX(MB_LOAD),0,0,MAX(MB_WKLY_REV_AMT)/MAX(MB_LOAD)),'LOADFACT',DECODE(MAX(MB_BSA_CAPA),0,0,MAX(MB_LOAD)/MAX(MB_BSA_CAPA) * 100),SUM(NVL(MB_WKLY_AMT, 0))) AS MB_WKLY_AMT
              ,DECODE(STND_COST_CD,'RPB00000',DECODE(MAX(HH_LOAD)+MAX(BH_LOAD)+MAX(MB_LOAD),0,0,(MAX(HH_WKLY_REV_AMT)+MAX(BH_WKLY_REV_AMT)+MAX(MB_WKLY_REV_AMT)) / (MAX(HH_LOAD)+MAX(BH_LOAD)+MAX(MB_LOAD))),
                                   'LOADFACT',DECODE(MAX(HH_BSA_CAPA)+MAX(BH_BSA_CAPA)+MAX(MB_BSA_CAPA),0,0,(MAX(HH_LOAD)+MAX(BH_LOAD)+MAX(MB_LOAD))/(MAX(HH_BSA_CAPA)+MAX(BH_BSA_CAPA)+MAX(MB_BSA_CAPA)) * 100),
                                   SUM(NVL(HH_WKLY_AMT, 0)) + SUM(NVL(BH_WKLY_AMT, 0)) + SUM(NVL(MB_WKLY_AMT, 0))) AS TTL_WKLY_AMT
              
              ,DECODE(STND_COST_CD,'RPB00000',DECODE(MAX(HH_LOAD),0,0,MAX(HH_MON_REV_AMT)/MAX(HH_LOAD)),'LOADFACT',DECODE(MAX(HH_BSA_CAPA),0,0,MAX(HH_LOAD)/MAX(HH_BSA_CAPA) * 100),SUM(NVL(HH_MON_AMT, 0))) -
               DECODE(STND_COST_CD,'RPB00000',DECODE(MAX(HH_LOAD),0,0,MAX(HH_WKLY_REV_AMT)/MAX(HH_LOAD)),'LOADFACT',DECODE(MAX(HH_BSA_CAPA),0,0,MAX(HH_LOAD)/MAX(HH_BSA_CAPA) * 100),SUM(NVL(HH_WKLY_AMT, 0))) AS HH_ADJ_AMT
               
              ,DECODE(STND_COST_CD,'RPB00000',DECODE(MAX(BH_LOAD),0,0,MAX(BH_MON_REV_AMT)/MAX(BH_LOAD)),'LOADFACT',DECODE(MAX(BH_BSA_CAPA),0,0,MAX(BH_LOAD)/MAX(BH_BSA_CAPA) * 100),SUM(NVL(BH_MON_AMT, 0))) -
               DECODE(STND_COST_CD,'RPB00000',DECODE(MAX(BH_LOAD),0,0,MAX(BH_WKLY_REV_AMT)/MAX(BH_LOAD)),'LOADFACT',DECODE(MAX(BH_BSA_CAPA),0,0,MAX(BH_LOAD)/MAX(BH_BSA_CAPA) * 100),SUM(NVL(BH_WKLY_AMT, 0))) AS BH_ADJ_AMT
               
              ,DECODE(STND_COST_CD,'RPB00000',DECODE(MAX(MB_LOAD),0,0,MAX(MB_MON_REV_AMT)/MAX(MB_LOAD)),'LOADFACT',DECODE(MAX(MB_BSA_CAPA),0,0,MAX(MB_LOAD)/MAX(MB_BSA_CAPA) * 100),SUM(NVL(MB_MON_AMT, 0))) -
               DECODE(STND_COST_CD,'RPB00000',DECODE(MAX(MB_LOAD),0,0,MAX(MB_WKLY_REV_AMT)/MAX(MB_LOAD)),'LOADFACT',DECODE(MAX(MB_BSA_CAPA),0,0,MAX(MB_LOAD)/MAX(MB_BSA_CAPA) * 100),SUM(NVL(MB_WKLY_AMT, 0))) AS MB_ADJ_AMT
               
              ,DECODE(STND_COST_CD,'RPB00000',DECODE(MAX(HH_LOAD)+MAX(BH_LOAD)+MAX(MB_LOAD),0,0,(MAX(HH_MON_REV_AMT)+MAX(BH_MON_REV_AMT)+MAX(MB_MON_REV_AMT)) / (MAX(HH_LOAD)+MAX(BH_LOAD)+MAX(MB_LOAD))),
                                   'LOADFACT',DECODE(MAX(HH_BSA_CAPA)+MAX(BH_BSA_CAPA)+MAX(MB_BSA_CAPA),0,0,(MAX(HH_LOAD)+MAX(BH_LOAD)+MAX(MB_LOAD))/(MAX(HH_BSA_CAPA)+MAX(BH_BSA_CAPA)+MAX(MB_BSA_CAPA)) * 100),
                                   SUM(NVL(HH_MON_AMT, 0)) + SUM(NVL(BH_MON_AMT, 0)) + SUM(NVL(MB_MON_AMT, 0))) -
               DECODE(STND_COST_CD,'RPB00000',DECODE(MAX(HH_LOAD)+MAX(BH_LOAD)+MAX(MB_LOAD),0,0,(MAX(HH_WKLY_REV_AMT)+MAX(BH_WKLY_REV_AMT)+MAX(MB_WKLY_REV_AMT)) / (MAX(HH_LOAD)+MAX(BH_LOAD)+MAX(MB_LOAD))),
                                   'LOADFACT',DECODE(MAX(HH_BSA_CAPA)+MAX(BH_BSA_CAPA)+MAX(MB_BSA_CAPA),0,0,(MAX(HH_LOAD)+MAX(BH_LOAD)+MAX(MB_LOAD))/(MAX(HH_BSA_CAPA)+MAX(BH_BSA_CAPA)+MAX(MB_BSA_CAPA)) * 100),
                                   SUM(NVL(HH_WKLY_AMT, 0)) + SUM(NVL(BH_WKLY_AMT, 0)) + SUM(NVL(MB_WKLY_AMT, 0))) AS TTL_ADJ_AMT                                   
              
              ,DECODE(STND_COST_CD,'RPB00000',DECODE(MAX(HH_LOAD),0,0,MAX(HH_MON_REV_AMT)/MAX(HH_LOAD)),'LOADFACT',DECODE(MAX(HH_BSA_CAPA),0,0,MAX(HH_LOAD)/MAX(HH_BSA_CAPA) * 100),SUM(NVL(HH_MON_AMT, 0))) AS HH_MON_AMT
              ,DECODE(STND_COST_CD,'RPB00000',DECODE(MAX(BH_LOAD),0,0,MAX(BH_MON_REV_AMT)/MAX(BH_LOAD)),'LOADFACT',DECODE(MAX(BH_BSA_CAPA),0,0,MAX(BH_LOAD)/MAX(BH_BSA_CAPA) * 100),SUM(NVL(BH_MON_AMT, 0))) AS BH_MON_AMT
              ,DECODE(STND_COST_CD,'RPB00000',DECODE(MAX(MB_LOAD),0,0,MAX(MB_MON_REV_AMT)/MAX(MB_LOAD)),'LOADFACT',DECODE(MAX(MB_BSA_CAPA),0,0,MAX(MB_LOAD)/MAX(MB_BSA_CAPA) * 100),SUM(NVL(MB_MON_AMT, 0))) AS MB_MON_AMT

              ,DECODE(STND_COST_CD,'RPB00000',DECODE(MAX(HH_LOAD)+MAX(BH_LOAD)+MAX(MB_LOAD),0,0,(MAX(HH_MON_REV_AMT)+MAX(BH_MON_REV_AMT)+MAX(MB_MON_REV_AMT)) / (MAX(HH_LOAD)+MAX(BH_LOAD)+MAX(MB_LOAD))),
                                   'LOADFACT',DECODE(MAX(HH_BSA_CAPA)+MAX(BH_BSA_CAPA)+MAX(MB_BSA_CAPA),0,0,(MAX(HH_LOAD)+MAX(BH_LOAD)+MAX(MB_LOAD))/(MAX(HH_BSA_CAPA)+MAX(BH_BSA_CAPA)+MAX(MB_BSA_CAPA)) * 100),
                                   SUM(NVL(HH_MON_AMT, 0)) + SUM(NVL(BH_MON_AMT, 0)) + SUM(NVL(MB_MON_AMT, 0))) AS TTL_MON_AMT
        FROM (
                SELECT B.RPT_DP_SEQ AS SEQ
                      ,A.HUL_BND_CD
                      ,B.STND_COST_CD
                      ,B.SGRP_COST_CD
                      ,B.RPT_ITM_DESC
                      ,B.SGRP_COST_CD_DESC
                      ,B.RPT_ITM_COLR_FLG
                      ,DECODE(A.HUL_BND_CD, 'HH', A.ESTM_PL_AMT, 0) AS HH_WKLY_AMT
                      ,DECODE(A.HUL_BND_CD, 'BH', A.ESTM_PL_AMT, 0) AS BH_WKLY_AMT
                      ,DECODE(A.HUL_BND_CD, 'M', A.ESTM_PL_AMT, 0) AS MB_WKLY_AMT
                      ,CASE WHEN A.HUL_BND_CD = 'HH' AND A.PL_DESC = 'Week' THEN A.ESTM_PL_AMT
                       WHEN A.HUL_BND_CD = 'HH' AND A.PL_DESC = 'Month' THEN A.ACCT_AMT END AS HH_MON_AMT
                      ,CASE WHEN A.HUL_BND_CD = 'BH' AND A.PL_DESC = 'Week' THEN A.ESTM_PL_AMT
                       WHEN A.HUL_BND_CD = 'BH' AND A.PL_DESC = 'Month' THEN A.ACCT_AMT END AS BH_MON_AMT
                      ,CASE WHEN A.HUL_BND_CD = 'M' AND A.PL_DESC = 'Week' THEN A.ESTM_PL_AMT
                       WHEN A.HUL_BND_CD = 'M' AND A.PL_DESC = 'Month' THEN A.ACCT_AMT END AS MB_MON_AMT
                      ,SUM(DECODE(B.STND_COST_CD,'LOAD0000',DECODE(A.HUL_BND_CD, 'HH', A.ESTM_PL_AMT, 0),0)) OVER(PARTITION BY A.HUL_BND_CD) AS HH_LOAD
                      ,SUM(DECODE(B.STND_COST_CD,'LOAD0000',DECODE(A.HUL_BND_CD, 'BH', A.ESTM_PL_AMT, 0),0)) OVER(PARTITION BY A.HUL_BND_CD) AS BH_LOAD
                      ,SUM(DECODE(B.STND_COST_CD,'LOAD0000',DECODE(A.HUL_BND_CD, 'M',  A.ESTM_PL_AMT, 0),0)) OVER(PARTITION BY A.HUL_BND_CD) AS MB_LOAD
                      ,SUM(DECODE(B.STND_COST_CD,'BSA00000',DECODE(A.HUL_BND_CD, 'HH', A.ESTM_PL_AMT, 0),0)) OVER(PARTITION BY A.HUL_BND_CD) AS HH_BSA_CAPA
                      ,SUM(DECODE(B.STND_COST_CD,'BSA00000',DECODE(A.HUL_BND_CD, 'BH', A.ESTM_PL_AMT, 0),0)) OVER(PARTITION BY A.HUL_BND_CD) AS BH_BSA_CAPA
                      ,SUM(DECODE(B.STND_COST_CD,'BSA00000',DECODE(A.HUL_BND_CD, 'M',  A.ESTM_PL_AMT, 0),0)) OVER(PARTITION BY A.HUL_BND_CD) AS MB_BSA_CAPA
                      ,SUM(DECODE(B.STND_COST_CD,'REVENUE0',DECODE(A.HUL_BND_CD, 'HH', A.ESTM_PL_AMT, 0),0)) OVER(PARTITION BY A.HUL_BND_CD) AS HH_WKLY_REV_AMT
                      ,SUM(DECODE(B.STND_COST_CD,'REVENUE0',DECODE(A.HUL_BND_CD, 'BH', A.ESTM_PL_AMT, 0),0)) OVER(PARTITION BY A.HUL_BND_CD) AS BH_WKLY_REV_AMT
                      ,SUM(DECODE(B.STND_COST_CD,'REVENUE0',DECODE(A.HUL_BND_CD, 'M',  A.ESTM_PL_AMT, 0),0)) OVER(PARTITION BY A.HUL_BND_CD) AS MB_WKLY_REV_AMT
                      ,SUM(DECODE(B.STND_COST_CD,'REVENUE0',DECODE(A.HUL_BND_CD, 'HH',DECODE(A.PL_DESC, 'Week', A.ESTM_PL_AMT,A.ACCT_AMT), 0), 0)) OVER(PARTITION BY A.HUL_BND_CD) AS HH_MON_REV_AMT
                      ,SUM(DECODE(B.STND_COST_CD,'REVENUE0',DECODE(A.HUL_BND_CD, 'BH',DECODE(A.PL_DESC, 'Week', A.ESTM_PL_AMT,A.ACCT_AMT), 0), 0)) OVER(PARTITION BY A.HUL_BND_CD) AS BH_MON_REV_AMT
                      ,SUM(DECODE(B.STND_COST_CD,'REVENUE0',DECODE(A.HUL_BND_CD, 'M', DECODE(A.PL_DESC, 'Week', A.ESTM_PL_AMT,A.ACCT_AMT), 0), 0)) OVER(PARTITION BY A.HUL_BND_CD) AS MB_MON_REV_AMT

                FROM MAS_PFIT_ADJ A, MAS_PFIT_LSS_RPT_ITM B
                WHERE 1=1
                AND A.STND_COST_CD = B.STND_COST_CD
                AND B.RPT_VW_CD = 'P'
            #if(${f_chkprd} =='M')
				AND A.REV_YRMON    BETWEEN @[f_year]||@[f_fm_mon] AND @[f_year]||@[f_to_mon]
			#elseif (${f_chkprd} =='W')
				AND A.SLS_YRMON     LIKE @[f_year]||@[f_sls_mon]||'%'
				AND A.COST_WK       BETWEEN @[f_fm_wk] AND @[f_to_wk]
			#end
            #if(${f_trd_cd} !='')
				AND A.TRD_CD    = @[f_trd_cd]
			#end
			#if(${f_rlane_cd} !='')
				AND A.RLANE_CD  = @[f_rlane_cd]
			#end
			#if(${f_dir_cd} !='')
				AND A.SKD_DIR_CD = @[f_dir_cd] 
			#end
			#if(${f_vsl_cd} !='')
				AND A.VSL_CD    = @[f_vsl_cd]
			#end
			#if(${f_skd_voy_no} !='')
				AND A.SKD_VOY_NO = @[f_skd_voy_no]
			#end
			#if(${f_skd_dir_cd} !='')
				AND A.SKD_DIR_CD = @[f_skd_dir_cd]
		    #end
			#if(${f_sub_trd_cd} !='')
				AND A.SUB_TRD_CD = @[f_sub_trd_cd]
		    #end
			#if(${f_trd_dir_cd} !='')
				AND A.HUL_BND_CD = @[f_trd_dir_cd]
			#end
                AND (B.STND_COST_TP_CD IN ('S','C','O') OR B.STND_COST_CD IN ('OPCTOTAL','OPB00000','BOPTOTAL','BOPB0000'))
                ORDER BY SEQ
        )
        GROUP BY SEQ
              ,STND_COST_CD
              ,SGRP_COST_CD
              ,RPT_ITM_DESC
              ,SGRP_COST_CD_DESC
              ,RPT_ITM_COLR_FLG
      )
WHERE 1=1
GROUP BY GROUPING SETS ((SGRP_COST_CD_DESC), (STND_COST_CD, SGRP_COST_CD_DESC, RPT_ITM_DESC, RPT_ITM_COLR_FLG)) 
ORDER BY SEQ, LV			]]></sql>
			<params>
				<param name="f_year" type="12" value="" out="N"/>
				<param name="f_fm_mon" type="12" value="" out="N"/>
				<param name="f_to_mon" type="12" value="" out="N"/>
				<param name="f_sls_mon" type="12" value="" out="N"/>
				<param name="f_fm_wk" type="12" value="" out="N"/>
				<param name="f_to_wk" type="12" value="" out="N"/>
				<param name="f_trd_cd" type="12" value="" out="N"/>
				<param name="f_rlane_cd" type="12" value="" out="N"/>
				<param name="f_dir_cd" type="12" value="" out="N"/>
				<param name="f_vsl_cd" type="12" value="" out="N"/>
				<param name="f_skd_voy_no" type="12" value="" out="N"/>
				<param name="f_skd_dir_cd" type="12" value="" out="N"/>
				<param name="f_sub_trd_cd" type="12" value="" out="N"/>
				<param name="f_trd_dir_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
