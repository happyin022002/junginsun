<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOConsultationDBDAOSearchSlipApprovalTaxRSQL">
			<desc><![CDATA[ERP AP 전송하기 위한 세금 계산서 정보 조회한다]]></desc>
			<sql><![CDATA[
SELECT  A.ISS_DT, A.SPL_RGST_NO, A.OFC_CD, 
        A.TAX_VAT_TP_CD,
        A.TAX_INV_YRMON||A.OFC_CD||A.TAX_SER_NO TAX_NO, A.SPL_AMT, 
        A.TAX_AMT, A.CURR_CD, DECODE(A.TAX_PL_CD, '1', '매입0%일반', B.AP_TAX_NM) TAX_CODE, 
	    A.CO_NM,
        TO_CHAR(TO_DATE(A.ISS_DT, 'YYYYMMDD'), 'YYYY/MM/DD HH24:MI:SS') ISS_DT_TIME
FROM    FMS_TAX A, AP_TAX B 
WHERE	A.FA_FLG = B.FA_FLG(+)
AND     A.TAX_NAID_FLG = B.TAX_NAID_FLG(+)
AND     A.TAX_NSL_FLG = B.TAX_NSL_FLG(+)
AND     A.SLP_TP_CD || A.SLP_FUNC_CD || A.SLP_OFC_CD || A.SLP_ISS_DT || A.SLP_SER_NO IN (
                                                                                            SELECT MIN(CSR_NO) AS CSR_NO
                                                                                            FROM
                                                                                            (
                                                                                                SELECT F.VAT_SLP_TP_CD || F.VAT_SLP_FUNC_CD || F.VAT_SLP_OFC_CD || F.VAT_SLP_ISS_DT || F.VAT_SLP_SER_NO  AS CSR_NO
                                                                                                FROM FMS_CONSULTATION F
                                                                                                WHERE F.SLP_TP_CD||F.SLP_FUNC_CD||F.SLP_OFC_CD||F.SLP_ISS_DT||F.SLP_SER_NO = @[csr_no]
                                                                                                UNION  
                                                                                                SELECT @[csr_no] AS CSR_NO
                                                                                                FROM DUAL
                                                                                            )    
)
AND     DECODE(A.TAX_VAT_TP_CD, '1', 0, 10) = B.TAX_RT(+)
AND    (B.AP_TAX_NM LIKE '매입%0%' OR B.AP_TAX_NM LIKE 'FA%')			]]></sql>
			<params>
				<param name="csr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
