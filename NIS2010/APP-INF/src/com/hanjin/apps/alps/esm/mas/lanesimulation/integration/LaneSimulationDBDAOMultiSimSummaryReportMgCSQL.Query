<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="LaneSimulationDBDAOMultiSimSummaryReportMgCSQL">
			<desc><![CDATA[summary 레포트 머지 1]]></desc>
			<sql><![CDATA[
MERGE INTO MAS_SIM_SMRY_RPT C1
		    USING (SELECT   A1.SIM_DT
		                   ,A1.SIM_NO
		                   ,A1.SECT_NO
		                   ,@[sim_rpt_no] SIM_RPT_NO
		                   ,A1.VSL_CD
		                   ,'OVBK' SGRP_COST_CD
		                   ,SUM(((A3.FOIL_SAIL_CSM * A2.SEA_DYS) +(A3.FOIL_PORT_CSM * A2.PORT_DYS)) * @[grs_rpb_rev]
		                        +(A3.DOIL_CSM * A2.TTL_TZ_DYS * A3.DOIL_UC_AMT)
		                       ) SIM_PERF_AMT
		                   ,@[cre_usr_id] CRE_USR_ID
		                   ,SYSDATE CRE_DT
		               FROM MAS_SIM_VSL_SET_INFO A1
		                  ,(
		                   SELECT DISTINCT SIM_DT, SIM_NO, SECT_NO, TML_CD, PORT_DYS, SEA_DYS, TTL_TZ_DYS, APLY_VOY_RTO
		                     FROM MAS_SIM_TML_OP_DYS
		                    WHERE SIM_DT = @[sim_dt]
		                      AND SIM_NO = @[sim_no] 
		                      AND SECT_NO = @[sect_no] 
		                   )A2
		                  , MAS_SIM_BNK_COST A3
		              WHERE A1.SIM_DT = A2.SIM_DT
		                AND A1.SIM_NO = A2.SIM_NO
		                AND A1.SECT_NO = A2.SECT_NO
		                AND A1.SIM_DT = A3.SIM_DT
		                AND A1.SIM_NO = A3.SIM_NO
		                AND A1.SECT_NO = A3.SECT_NO
		                AND A1.VSL_CLSS_CAPA = A3.VSL_CLSS_CAPA
		                AND A1.SIM_DIV_CD = '1'
		                AND A1.SIM_DT = @[sim_dt]
		                AND A1.SIM_NO = @[sim_no]
		                AND A1.SECT_NO = @[sect_no]
		           GROUP BY A1.SIM_DT, A1.SIM_NO, A1.SECT_NO, A1.VSL_CD) C2
		    ON (    C1.SIM_DT = C2.SIM_DT
		        AND C1.SIM_NO = C2.SIM_NO
		        AND C1.SECT_NO = C2.SECT_NO
		        AND C1.SIM_RPT_NO = C2.SIM_RPT_NO
		        AND C1.SGRP_COST_CD = C2.SGRP_COST_CD
		        AND C1.VSL_CD = C2.VSL_CD)
		    WHEN MATCHED THEN
		       UPDATE
		          SET C1.SIM_PERF_AMT = C2.SIM_PERF_AMT
		    WHEN NOT MATCHED THEN
		       INSERT(C1.SIM_DT, C1.SIM_NO, C1.SECT_NO, C1.SIM_RPT_NO, C1.SGRP_COST_CD, C1.VSL_CD, C1.SIM_PERF_AMT
		             ,C1.CRE_USR_ID, C1.CRE_DT)
		       VALUES(C2.SIM_DT, C2.SIM_NO, C2.SECT_NO, C2.SIM_RPT_NO, C2.SGRP_COST_CD, C2.VSL_CD, C2.SIM_PERF_AMT
		             ,C2.CRE_USR_ID, C2.CRE_DT)			]]></sql>
			<params>
				<param name="sim_rpt_no" type="12" value="" out="N"/>
				<param name="grs_rpb_rev" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="sim_dt" type="12" value="" out="N"/>
				<param name="sim_no" type="12" value="" out="N"/>
				<param name="sect_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
