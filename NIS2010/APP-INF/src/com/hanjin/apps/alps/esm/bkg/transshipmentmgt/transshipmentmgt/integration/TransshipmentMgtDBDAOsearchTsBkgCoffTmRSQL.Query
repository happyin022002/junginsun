<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TransshipmentMgtDBDAOsearchTsBkgCoffTmRSQL">
			<desc><![CDATA[TS 화물에 대한 Cut off time 을 조회한다]]></desc>
			<sql><![CDATA[
SELECT BKG.VSL_CD||BKG.SKD_VOY_NO||BKG.SKD_DIR_CD VVD
        , BKG.POL_CD
        , BKG.YD_CD
		, decode(COFF.BKG_CLZ_STS_CD,null, 'Open','C','Closed','R','Re-open') BKG_CLZ_STS_NM
        , nvl(COFF.BKG_CLZ_STS_CD, 'O') BKG_CLZ_STS_CD
        , USR.OFC_CD
        , COFF.UPD_USR_ID
        , USR.USR_NM
        , TO_CHAR(COFF.UPD_DT, 'YYYY-MM-DD HH24:MM:SS') UPD_DT
		, BKG.VSL_CD
        , BKG.SKD_VOY_NO
        , BKG.SKD_DIR_CD
        , BKG.POL_CLPT_IND_SEQ AS CLPT_IND_SEQ
  FROM        
    (SELECT DISTINCT VVD.VSL_CD
            , VVD.SKD_VOY_NO
            , VVD.SKD_DIR_CD
            , VVD.POL_CD
            , SUBSTR(VVD.POL_YD_CD, 6, 2) YD_CD
            , VVD.POL_CLPT_IND_SEQ
      FROM BKG_BOOKING BK, BKG_VVD VVD
     WHERE BK.BKG_NO        = VVD.BKG_NO
#if (${vsl_cd}!='')
       AND VVD.VSL_CD       = SUBSTR(@[vsl_cd], 1, 4) 
       AND VVD.SKD_VOY_NO   = SUBSTR(@[vsl_cd], 5, 4) 
       AND VVD.SKD_DIR_CD   = SUBSTR(@[vsl_cd], 9, 1) 
#end 
#if (${pol_cd} != '' && ${yd_cd} != '')
       AND VVD.POL_YD_CD    = @[pol_cd]||@[yd_cd]
#elseif (${pol_cd} != '')
       AND VVD.POL_CD       = @[pol_cd]
#end     
       and BK.BKG_CGO_TP_CD <> 'M'
       ) BKG --KRPUS
        , BKG_TS_COFF_TM COFF, COM_USER USR
WHERE BKG.VSL_CD = COFF.VSL_CD(+)
  AND BKG.SKD_VOY_NO = COFF.SKD_VOY_NO(+)
  AND BKG.SKD_DIR_CD = COFF.SKD_DIR_CD(+)
  AND BKG.POL_CD = COFF.POL_CD(+)        
  AND BKG.POL_CLPT_IND_SEQ = COFF.CLPT_IND_SEQ(+)--CLPT_IND_SEQ
#if (${bkg_clz_sts_cd} != '' && ${bkg_clz_sts_cd} !='All' && ${bkg_clz_sts_cd} !='M') 
  AND nvl(COFF.BKG_CLZ_STS_CD, 'O') = @[bkg_clz_sts_cd]
#elseif (${bkg_clz_sts_cd} != '' && ${bkg_clz_sts_cd} =='M') 
  AND nvl(COFF.BKG_CLZ_STS_CD, 'O') in ('O','R')
#end
  AND COFF.UPD_USR_ID = USR.USR_ID(+)			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="yd_cd" type="12" value="" out="N"/>
				<param name="bkg_clz_sts_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
