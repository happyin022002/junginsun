<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="MalaysiaCustomsTransmissionDBDAOsearchPreNextVslInfoRSQL">
			<desc><![CDATA[2ND VVD 정보 조회를 위해 T/S일 경우 PRE/NEXT 정보를 구한다. POD(INBOUND) T/S 경우 NEXT, POL(OUTBOUND) T/S 경우 PRE정보]]></desc>
			<sql><![CDATA[
SELECT BKG_GET_TOKEN_FNC(PREV_VVD,1) AS PRE_VVD
     , BKG_GET_TOKEN_FNC(PREV_VVD,2) AS PRE_POL_CD
     , BKG_GET_TOKEN_FNC(PREV_VVD,3) AS PRE_POD_CD
     , BKG_GET_TOKEN_FNC(NEXT_VVD,1) AS NEXT_VVD
     , BKG_GET_TOKEN_FNC(NEXT_VVD,2) AS NEXT_POL_CD
     , BKG_GET_TOKEN_FNC(NEXT_VVD,3) AS NEXT_POD_CD
  FROM ( SELECT LAG(VSL_CD||SKD_VOY_NO||SKD_DIR_CD||','||POL_CD||','||POD_CD, 1)  OVER (ORDER BY VSL_PRE_PST_CD,VSL_SEQ) PREV_VVD
              , LEAD(VSL_CD||SKD_VOY_NO||SKD_DIR_CD||','||POL_CD||','||POD_CD, 1) OVER (ORDER BY VSL_PRE_PST_CD,VSL_SEQ) NEXT_VVD
              , VVD.*
           FROM BKG_VVD VVD
          WHERE BKG_NO =@[bkg_no]
       ) X 
WHERE 1=1
  AND VSL_CD     = SUBSTR(@[vvd],1,4)
  AND SKD_VOY_NO = SUBSTR(@[vvd],5,4)
  AND SKD_DIR_CD = SUBSTR(@[vvd],9,1)
  #if (${e_i_ind} == 'E')
	  AND POL_CD = @[input_pol_cd]        --Mode=Outbound 조건
  #else
	  AND POd_CD = @[input_pod_cd]        --Mode=Inbound 조건
  #end 
  AND ROWNUM = 1 			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="input_pol_cd" type="12" value="" out="N"/>
				<param name="input_pod_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
