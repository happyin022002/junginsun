<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLDocumentationBLDBDAOCheckSelfFilingCMRSQL">
			<desc><![CDATA[US filer가 01이면서 C/M 탭에 Self가 찍혀있다면 BKG Creation의 화면에 저장된 BKG,SI Contact 이메일로 notification을 보낸다]]></desc>
			<sql><![CDATA[
SELECT CNTC_PSON_EML
#if (${ca_flg} == 'Y') 
FROM BKG_CNTC_PSON_HIS CNTC, BKG_BKG_HIS BKG
#else
FROM BKG_CNTC_PSON CNTC, BKG_BOOKING BKG
#end
WHERE CNTC.BKG_NO = @[bkg_no]
AND CNTC.BKG_NO = BKG.BKG_NO
AND BKG_CNTC_PSON_TP_CD IN ('BK','SI')
AND BKG.BKG_STS_CD <> 'X'
AND BKG.USA_CSTMS_FILE_CD = 1
AND BKG.POD_CD LIKE 'US%'
#if (${ca_flg} == 'Y') 
AND CNTC.CORR_NO = (SELECT MAX(CORR_NO) FROM BKG_CNTC_PSON_HIS WHERE BKG_NO = @[bkg_no])
AND BKG.CORR_NO = (SELECT MAX(CORR_NO) FROM BKG_BKG_HIS WHERE BKG_NO = @[bkg_no])
AND EXISTS (SELECT 1 FROM bkg_cntr_mf_desc_his WHERE BKG_NO = BKG.BKG_NO AND CNTR_MF_NO = 'SELF' AND CORR_NO = (SELECT MAX(CORR_NO) FROM bkg_cntr_mf_desc_his WHERE BKG_NO = @[bkg_no]) AND ROWNUM = 1)
#else
AND EXISTS (SELECT 1 FROM bkg_cntr_mf_desc WHERE BKG_NO = BKG.BKG_NO AND CNTR_MF_NO = 'SELF' AND ROWNUM = 1)
#end
AND ROWNUM < 3			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
