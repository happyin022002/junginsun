<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BLDocumentationBLDBDAOsearchXterVgmRqstListRSQL">
			<desc><![CDATA[XterVgm 조회]]></desc>
			<sql><![CDATA[
SELECT RQST.XTER_SNDR_ID
     , RQST.XTER_VGM_RQST_NO
     , RQST.XTER_VGM_SEQ
     , RQST.BKG_NO
     , RQST.CNTR_NO
     , TO_CHAR(RQST.RQST_DT,'YYYY-MM-DD HH24:MI') RQST_DT
     , RQST.XTER_RQST_VIA_CD
     , RQST.CUST_ID
     , RQST.VGM_UPLD_STS_CD
     , RQST.UPLD_USR_ID
     , TO_CHAR(RQST.UPLD_DT,'YYYY-MM-DD HH24:MI')  UPLD_DT
     , TO_CHAR(RQST.UPLD_GDT,'YYYY-MM-DD HH24:MI') UPLD_GDT
     , RQST.VGM_WGT
     , RQST.VGM_WGT_UT_CD
     , TO_CHAR(RQST.VGM_VRFY_DT,'YYYY-MM-DD HH24:MI') VGM_VRFY_DT
     , TO_CHAR(RQST.VGM_DTMN_DT,'YYYY-MM-DD HH24:MI') VGM_DTMN_DT
     , RQST.VGM_MZD_TP_CD
     , RQST.SMT_NM
     , RQST.SMT_EML
     , RQST.SMT_PHN_NO
     , (NVL((SELECT AUTH_PSON_NM 
               FROM BKG_XTER_VRFD_WGT_PTY PTY 
              WHERE PTY.XTER_SNDR_ID     = RQST.XTER_SNDR_ID
                AND PTY.XTER_VGM_RQST_NO = RQST.XTER_VGM_RQST_NO 
                AND PTY.XTER_VGM_SEQ     = RQST.XTER_VGM_SEQ
                AND PTY.CNTR_NO          = RQST.CNTR_NO
                AND PTY.VGM_PTY_TP_CD    = 'SPC'
             ),NVL((SELECT AUTH_PSON_NM 
                      FROM BKG_XTER_VRFD_WGT_PTY PTY 
                     WHERE PTY.XTER_SNDR_ID     = RQST.XTER_SNDR_ID
                       AND PTY.XTER_VGM_RQST_NO = RQST.XTER_VGM_RQST_NO 
                       AND PTY.XTER_VGM_SEQ     = RQST.XTER_VGM_SEQ
                       AND PTY.CNTR_NO          = RQST.CNTR_NO
                       AND PTY.VGM_PTY_TP_CD    = 'WPA'
             ),NVL((SELECT AUTH_PSON_NM 
                      FROM BKG_XTER_VRFD_WGT_PTY PTY 
                     WHERE PTY.XTER_SNDR_ID     = RQST.XTER_SNDR_ID
                       AND PTY.XTER_VGM_RQST_NO = RQST.XTER_VGM_RQST_NO 
                       AND PTY.XTER_VGM_SEQ     = RQST.XTER_VGM_SEQ
                       AND PTY.CNTR_NO          = RQST.CNTR_NO
                       AND PTY.VGM_PTY_TP_CD    = 'AM'
             ),NVL((SELECT AUTH_PSON_NM 
                      FROM BKG_XTER_VRFD_WGT_PTY PTY 
                     WHERE PTY.XTER_SNDR_ID     = RQST.XTER_SNDR_ID
                       AND PTY.XTER_VGM_RQST_NO = RQST.XTER_VGM_RQST_NO 
                       AND PTY.XTER_VGM_SEQ     = RQST.XTER_VGM_SEQ
                       AND PTY.CNTR_NO          = RQST.CNTR_NO
                       AND PTY.VGM_PTY_TP_CD    = 'WC'
             ),(SELECT AUTH_PSON_NM 
                  FROM BKG_XTER_VRFD_WGT_PTY PTY 
                 WHERE PTY.XTER_SNDR_ID     = RQST.XTER_SNDR_ID
                   AND PTY.XTER_VGM_RQST_NO = RQST.XTER_VGM_RQST_NO 
                   AND PTY.XTER_VGM_SEQ     = RQST.XTER_VGM_SEQ
                   AND PTY.CNTR_NO          = RQST.CNTR_NO
                   AND PTY.VGM_PTY_TP_CD    = 'OB'
               )
             ))))
       )VGM_VRFY_SIG_CTNT -- SPC,WPA,AM,WC,OB 순으로 하나만 SIGNATURE로 함
     , RQST.XTER_BKG_RQST_REF_NO
     , RQST.XTER_SI_REF_NO
     , RQST.RJCT_RSN_RMK
     , RQST.UPD_USR_ID
     , TO_CHAR(RQST.UPD_DT,'YYYY-MM-DD HH24:MI') UPD_DT
  FROM BKG_XTER_VRFD_WGT_RQST RQST
     , BKG_BOOKING            BK
#if (${bkg_no} == '' && ${f_vvd} != '')
     , BKG_VVD                VVD
#end
 WHERE RQST.BKG_NO = BK.BKG_NO(+)
#if (${bkg_no} != '')
   --booking no 입력시 (다른 조건 전부 비활성화)
   AND RQST.BKG_NO IN ( ${bkg_no} )
#else
    #if (${f_vvd} != '')
   AND VVD.BKG_NO     = BK.BKG_NO
   AND VVD.VSL_CD     = SUBSTR(@[f_vvd], 1, 4)
   AND VVD.SKD_VOY_NO = SUBSTR(@[f_vvd], 5, 4)
   AND VVD.SKD_DIR_CD = SUBSTR(@[f_vvd], 9, 1)
    #end
	#if (${cntr_no} != '')
   AND RQST.CNTR_NO IN ( ${cntr_no} )
	#end
	#if (${rqst_from_dt} != '')
   AND RQST.RQST_DT >= TO_DATE(@[rqst_from_dt],'YYYY-MM-DD')
	#end
	#if (${rqst_to_dt} != '')
   AND RQST.RQST_DT <= TO_DATE(@[rqst_to_dt],'YYYY-MM-DD')+1
	#end
	#if (${vgm_upld_sts_cd} != '')
   AND RQST.VGM_UPLD_STS_CD = @[vgm_upld_sts_cd]
	#end
	#if (${pol_cd} != '')
   AND BK.POL_CD = @[pol_cd]
	#end
	#if (${bkg_ofc_cd} != '')
   AND BK.BKG_OFC_CD = @[bkg_ofc_cd]
	#end
#end
 ORDER BY RQST.RQST_DT, RQST.BKG_NO, RQST.XTER_VGM_SEQ,  RQST.CNTR_NO			]]></sql>
			<params>
				<param name="f_vvd" type="12" value="" out="N"/>
				<param name="rqst_from_dt" type="12" value="" out="N"/>
				<param name="rqst_to_dt" type="12" value="" out="N"/>
				<param name="vgm_upld_sts_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="bkg_ofc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
