<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingReceiptDBDAOSearchVvdSkdForTsRouteRSQL">
			<desc><![CDATA[TS Route에서 VVD 조회]]></desc>
			<sql><![CDATA[
SELECT 
	VVD.BKG_NO
,	VVD.VSL_PRE_PST_CD
,	VVD.VSL_SEQ
,	VVD.SLAN_CD
,	VVD.VSL_CD
,	VVD.SKD_VOY_NO
,	VVD.SKD_DIR_CD
,   VVD.VSL_CD||VVD.SKD_VOY_NO||VVD.SKD_DIR_CD BKG_VVD_CD
,   VVD.POL_CLPT_IND_SEQ
,   VVD.POD_CLPT_IND_SEQ 
,	VVD.OP_CD
,	VVD.POL_CD
,	SUBSTR(VVD.POL_YD_CD,6,2) POL_YD_CD
,	VVD.POD_CD
,	SUBSTR(VVD.POD_YD_CD,6,2) POD_YD_CD
,	VVD.BKG_TRSP_MZD_CD
,	VVD.CNTR_LODG_FLG
,	VVD.REV_VVD_FLG
,	VVD.CRE_USR_ID
,	VVD.CRE_DT
,	VVD.UPD_USR_ID
,	VVD.UPD_DT    
,   (SELECT TO_CHAR(POL.VPS_ETD_DT,'YYYY-MM-DD') ETD_DAY
       FROM VSK_VSL_PORT_SKD POL
          , VSK_VSL_PORT_SKD POD
      WHERE POL.VPS_PORT_CD  = VVD.POL_CD
        AND POL.YD_CD        = VVD.POL_YD_CD
        AND POL.CLPT_IND_SEQ = VVD.POL_CLPT_IND_SEQ           
        AND POL.VSL_CD       = VVD.VSL_CD
        AND POL.SKD_VOY_NO   = VVD.SKD_VOY_NO
        AND POL.SKD_DIR_CD   = VVD.SKD_DIR_CD
        AND POD.VPS_PORT_CD  = VVD.POD_CD
        AND POD.YD_CD        = VVD.POD_YD_CD
        AND POD.CLPT_IND_SEQ = VVD.POD_CLPT_IND_SEQ
        AND POD.VSL_CD       = VVD.VSL_CD
        AND POD.SKD_VOY_NO   = VVD.SKD_VOY_NO
        AND POD.SKD_DIR_CD   = VVD.SKD_DIR_CD
        AND POL.CLPT_SEQ     < POD.CLPT_SEQ
        AND NVL(POL.SKD_CNG_STS_CD, ' ') <> 'S'
        AND NVL(POD.SKD_CNG_STS_CD, ' ') <> 'S'
        AND ROWNUM = 1
     ) ETD_DAY
,   (SELECT TO_CHAR(POD.VPS_ETA_DT,'YYYY-MM-DD') ETA_DAY 
       FROM VSK_VSL_PORT_SKD POL
          , VSK_VSL_PORT_SKD POD
      WHERE POL.VPS_PORT_CD  = VVD.POL_CD
        AND POL.YD_CD        = VVD.POL_YD_CD
        AND POL.CLPT_IND_SEQ = VVD.POL_CLPT_IND_SEQ           
        AND POL.VSL_CD       = VVD.VSL_CD
        AND POL.SKD_VOY_NO   = VVD.SKD_VOY_NO
        AND POL.SKD_DIR_CD   = VVD.SKD_DIR_CD
        AND POD.VPS_PORT_CD  = VVD.POD_CD
        AND POD.YD_CD        = VVD.POD_YD_CD
        AND POD.CLPT_IND_SEQ = VVD.POD_CLPT_IND_SEQ
        AND POD.VSL_CD       = VVD.VSL_CD
        AND POD.SKD_VOY_NO   = VVD.SKD_VOY_NO
        AND POD.SKD_DIR_CD   = VVD.SKD_DIR_CD
        AND POL.CLPT_SEQ     < POD.CLPT_SEQ
        AND NVL(POL.SKD_CNG_STS_CD, ' ') <> 'S'
        AND NVL(POD.SKD_CNG_STS_CD, ' ') <> 'S'
        AND ROWNUM = 1
     ) ETA_DAY

#if (${ca_flg}== 'Y')
FROM BKG_VVD_HIS VVD
#else
FROM BKG_VVD VVD
#end

WHERE	BKG_NO = @[bkg_no]
#if (${ca_flg}== 'Y')
AND   CORR_NO = 'TMP0000001'
#end
ORDER BY BKG_NO, VSL_PRE_PST_CD, VSL_SEQ			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
