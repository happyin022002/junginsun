<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UsWharfageDecMgtDBDAOsearchBkgUsaWhfSndQtyInitUSOAKRSQL">
			<desc><![CDATA[searchBkgUsaWhfSndQtyInitUSOAK]]></desc>
			<sql><![CDATA[
WITH RT_DTL AS (
SELECT USA_WHF_RAT_UT_CD
      ,FULL_MTY_CD
      ,USA_WHF_TRSP_TP_CD
      ,USA_WHF_EXPT_FLG
      ,WHF_UT_PRC
  FROM BKG_USA_WHF_RT_DTL DTL
      ,(SELECT MAX(EFF_DT) AS EFF_DT
          FROM BKG_USA_WHF_RT_DTL
         WHERE PORT_CD = @[port_cd]
           AND IO_BND_CD = @[io_bnd_cd]
       ) MAX_RT
 WHERE PORT_CD = @[port_cd]
   AND IO_BND_CD = @[io_bnd_cd]
   AND DTL.EFF_DT = MAX_RT.EFF_DT
)
SELECT @[vsl_cd]     AS VSL_CD
      ,@[skd_voy_no] AS SKD_VOY_NO
      ,@[skd_dir_cd] AS SKD_DIR_CD
      ,@[port_cd]    AS PORT_CD
      ,@[io_bnd_cd]  AS IO_BND_CD
      ,TB.USA_WHF_RAT_UT_CD
      ,TB.FULL_MTY_CD
      ,TB.USA_WHF_TRSP_TP_CD
      ,'N' AS USA_WHF_EXPT_FLG
      ,TB.RAT_AS_QTY
      ,NVL(RT_DTL.WHF_UT_PRC, 0) AS WHF_UT_PRC
      ,TB.RAT_AS_QTY * NVL(RT_DTL.WHF_UT_PRC, 0) AS WHF_AMT
      ,@[cre_usr_id] AS CRE_USR_ID
  FROM (
        SELECT TB1.*
         FROM (
                SELECT TB.USA_WHF_TRSP_TP_CD
                      ,TB.FULL_MTY_CD
                      ,TB.USA_WHF_RAT_UT_CD
                      ,0 AS RAT_AS_QTY
                  FROM (
                        SELECT INT.*
                          FROM (
                                SELECT 'L' AS USA_WHF_TRSP_TP_CD, 'F' AS FULL_MTY_CD, '20F' AS USA_WHF_RAT_UT_CD FROM DUAL
                                UNION
                                SELECT 'L', 'F', '40F' FROM DUAL
                                UNION
                                SELECT 'L', 'F', '45F' FROM DUAL
                                UNION
                                SELECT 'L', 'M', '20F' FROM DUAL
                                UNION
                                SELECT 'L', 'M', '40F' FROM DUAL
                                UNION
                                SELECT 'L', 'M', '45F' FROM DUAL
                                UNION
                                SELECT 'I', 'F', '20F' FROM DUAL
                                UNION
                                SELECT 'I', 'F', '40F' FROM DUAL
                                UNION
                                SELECT 'I', 'F', '45F' FROM DUAL
                                UNION
                                SELECT 'I', 'M', '20F' FROM DUAL
                                UNION
                                SELECT 'I', 'M', '40F' FROM DUAL
                                UNION
                                SELECT 'I', 'M', '45F' FROM DUAL
                               )INT
                                MINUS
                                SELECT A.USA_WHF_TRSP_TP_CD
                                      ,A.FULL_MTY_CD
                                      ,A.USA_WHF_RAT_UT_CD
                                  FROM BKG_USA_WHF_CNTR A
                                 WHERE A.VSL_CD = @[vsl_cd]
                                   AND A.SKD_VOY_NO =@[skd_voy_no]
                                   AND A.SKD_DIR_CD = @[skd_dir_cd]
                                   AND A.PORT_CD = @[port_cd]
                                   AND A.IO_BND_CD = @[io_bnd_cd]
                                GROUP BY A.USA_WHF_TRSP_TP_CD, A.FULL_MTY_CD,A.USA_WHF_RAT_UT_CD
                        ) TB
                UNION ALL
                SELECT A.USA_WHF_TRSP_TP_CD
                      ,A.FULL_MTY_CD
                      ,A.USA_WHF_RAT_UT_CD
                      ,SUM(RAT_AS_QTY) AS RAT_AS_QTY
                  FROM BKG_USA_WHF_CNTR A
                 WHERE A.VSL_CD = @[vsl_cd]
                   AND A.SKD_VOY_NO =@[skd_voy_no]
                   AND A.SKD_DIR_CD = @[skd_dir_cd]
                   AND A.PORT_CD = @[port_cd]
                   AND A.IO_BND_CD = @[io_bnd_cd]
                GROUP BY A.USA_WHF_TRSP_TP_CD, A.FULL_MTY_CD,A.USA_WHF_RAT_UT_CD
               )TB1
        UNION ALL
        SELECT TB1.*
          FROM (
                SELECT 'L' AS USA_WHF_TRSP_TP_CD
                      ,'F' AS FULL_MTY_CD
                      ,'CON' AS USA_WHF_RAT_UT_CD
                      ,NVL(SUM(RAT_AS_QTY),0) AS RAT_AS_QTY
                  FROM BKG_USA_WHF_CNTR A
                 WHERE A.VSL_CD = @[vsl_cd]
                   AND A.SKD_VOY_NO =@[skd_voy_no]
                   AND A.SKD_DIR_CD = @[skd_dir_cd]
                   AND A.PORT_CD = @[port_cd]
                   AND A.IO_BND_CD = @[io_bnd_cd]
                   AND A.FULL_MTY_CD = 'F'
                   AND A.USA_WHF_TRSP_TP_CD = 'L'
               )TB1
        UNION ALL
        SELECT TB1.*
          FROM (
                SELECT 'L' AS USA_WHF_TRSP_TP_CD
                      ,'F' AS FULL_MTY_CD
                      ,'TEU' AS USA_WHF_RAT_UT_CD
                      ,NVL(SUM(DECODE(A.USA_WHF_RAT_UT_CD, '40F', A.RAT_AS_QTY * 2, '45F', A.RAT_AS_QTY * 2.25, A.RAT_AS_QTY)),0) AS RAT_AS_QTY
                  FROM BKG_USA_WHF_CNTR A
                 WHERE A.VSL_CD = @[vsl_cd]
                   AND A.SKD_VOY_NO =@[skd_voy_no]
                   AND A.SKD_DIR_CD = @[skd_dir_cd]
                   AND A.PORT_CD = @[port_cd]
                   AND A.IO_BND_CD = @[io_bnd_cd]
                   AND A.FULL_MTY_CD = 'F'
                   AND A.USA_WHF_TRSP_TP_CD = 'L'
               )TB1
        UNION ALL
        SELECT TB1.*
          FROM (
                SELECT 'I' AS USA_WHF_TRSP_TP_CD
                      ,'F' AS FULL_MTY_CD
                      ,'CON' AS USA_WHF_RAT_UT_CD
                      ,NVL(SUM(RAT_AS_QTY),0) AS RAT_AS_QTY
                  FROM BKG_USA_WHF_CNTR A
                 WHERE A.VSL_CD = @[vsl_cd]
                   AND A.SKD_VOY_NO =@[skd_voy_no]
                   AND A.SKD_DIR_CD = @[skd_dir_cd]
                   AND A.PORT_CD = @[port_cd]
                   AND A.IO_BND_CD = @[io_bnd_cd]
                   AND A.FULL_MTY_CD = 'F'
                   AND A.USA_WHF_TRSP_TP_CD = 'I'
               )TB1
        UNION ALL
        SELECT TB1.*
          FROM (
                SELECT 'I' AS USA_WHF_TRSP_TP_CD
                      ,'F' AS FULL_MTY_CD
                      ,'TEU' AS USA_WHF_RAT_UT_CD
                      ,NVL(SUM(DECODE(A.USA_WHF_RAT_UT_CD, '40F', A.RAT_AS_QTY * 2, '45F', A.RAT_AS_QTY * 2.25, A.RAT_AS_QTY)),0) AS RAT_AS_QTY
                  FROM BKG_USA_WHF_CNTR A
                 WHERE A.VSL_CD = @[vsl_cd]
                   AND A.SKD_VOY_NO =@[skd_voy_no]
                   AND A.SKD_DIR_CD = @[skd_dir_cd]
                   AND A.PORT_CD = @[port_cd]
                   AND A.IO_BND_CD = @[io_bnd_cd]
                   AND A.FULL_MTY_CD = 'F'
                   AND A.USA_WHF_TRSP_TP_CD = 'I'
               )TB1
        )TB, RT_DTL
 WHERE TB.USA_WHF_TRSP_TP_CD = RT_DTL.USA_WHF_TRSP_TP_CD(+)
   AND TB.FULL_MTY_CD = RT_DTL.FULL_MTY_CD(+)
   AND TB.USA_WHF_RAT_UT_CD = RT_DTL.USA_WHF_RAT_UT_CD(+)			]]></sql>
			<params>
				<param name="port_cd" type="12" value="" out="N"/>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
