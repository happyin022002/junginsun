<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="IHCGuideLineDBDAOSearchIhcTariffInquiryListRSQL">
			<desc><![CDATA[IHC TARIFF INQUIRY - IHCTariffInquiryListVO 생성 쿼리
2013.02.07 서미진 [CHM-201322859] over weight svc flag에 따라 weight 정보 조회하여 보여줌
2013.07.30 전윤주 [CHM-201326002] Overweight Service flag가 'Y' 인 경우에만 버튼 색을 파란색으로 표시
2015.03.05 [CHM-201534279] 최성환  Pricing FeederIHC tariff 45 칼럼 추가
- HAMRU 45' 사용 그외는 40'로 적용함.]]></desc>
			<sql><![CDATA[
SELECT DISTINCT Y.SVC_SCP_CD
     , Y.PNT_LOC_CD
     , Y.IHC_COST_LOC_GRP_NO
     , LOC.LOC_NM PNT_LOC_CD_NM
     , NVL(LOC.ZIP_CD, LOC.LOC_GRD_NO) AS ZIP_CD
     , Y.HUB_LOC_CD
     , Y.BSE_PORT_LOC_CD
     , Y.PRC_TRSP_MOD_CD
     , TRSP_MOD.INTG_CD_VAL_DESC PRC_TRSP_MOD_CD_NM
     , Y.RCV_DE_TERM_CD
     , TERM.INTG_CD_VAL_DESC RCV_DE_TERM_CD_NM
     , Y.GLINE_20FT_FRT_RT_AMT
     , Y.GLINE_40FT_FRT_RT_AMT
     --, Y.GLINE_45FT_FRT_RT_AMT
     , CASE WHEN H.RHQ_CD = 'HAMRU' THEN Y.GLINE_45FT_FRT_RT_AMT ELSE Y.GLINE_40FT_FRT_RT_AMT END GLINE_45FT_FRT_RT_AMT --45'
     , Y.GLINE_LOCL_CURR_20FT_AMT
     , Y.GLINE_LOCL_CURR_40FT_AMT
     --, Y.GLINE_LOCL_CURR_45FT_AMT
     , CASE WHEN H.RHQ_CD = 'HAMRU' THEN Y.GLINE_LOCL_CURR_45FT_AMT ELSE Y.GLINE_LOCL_CURR_40FT_AMT END GLINE_LOCL_CURR_45FT_AMT --45'
     , TO_CHAR(Y.GLINE_20FT_FRT_RT_AMT,'FM999,999,999,999,990.00') AS GLINE_RF_20FT_FRT_RT_AMT
     , TO_CHAR(Y.GLINE_40FT_FRT_RT_AMT,'FM999,999,999,999,990.00') AS GLINE_RF_40FT_FRT_RT_AMT
     , TO_CHAR(Y.GLINE_LOCL_CURR_20FT_AMT,'FM999,999,999,999,990.00') AS GLINE_LOCL_CURR_RF_20FT_AMT
     , TO_CHAR(Y.GLINE_LOCL_CURR_40FT_AMT,'FM999,999,999,999,990.00') AS GLINE_LOCL_CURR_RF_40FT_AMT
     , DECODE( Y.DCGO_SVC_FLG , 'N' , 'N/A' , TO_CHAR(Y.GLINE_DG_20FT_FRT_RT_AMT,'FM999,999,999,999,990.00')) AS GLINE_DG_20FT_FRT_RT_AMT
     , DECODE( Y.DCGO_SVC_FLG , 'N' , 'N/A' , TO_CHAR(Y.GLINE_DG_40FT_FRT_RT_AMT,'FM999,999,999,999,990.00')) AS GLINE_DG_40FT_FRT_RT_AMT
     --, DECODE( Y.DCGO_SVC_FLG , 'N' , 'N/A' , TO_CHAR(Y.GLINE_DG_45FT_FRT_RT_AMT,'FM999,999,999,999,990.00')) AS GLINE_DG_45FT_FRT_RT_AMT
     , CASE WHEN H.RHQ_CD = 'HAMRU' 
            THEN DECODE( Y.DCGO_SVC_FLG , 'N' , 'N/A' , TO_CHAR(Y.GLINE_DG_45FT_FRT_RT_AMT,'FM999,999,999,999,990.00'))
            ELSE DECODE( Y.DCGO_SVC_FLG , 'N' , 'N/A' , TO_CHAR(Y.GLINE_DG_40FT_FRT_RT_AMT,'FM999,999,999,999,990.00')) 
       END GLINE_DG_45FT_FRT_RT_AMT --45'
     , DECODE( Y.DCGO_SVC_FLG , 'N' , 'N/A' , TO_CHAR(Y.GLINE_LOCL_CURR_DG_20FT_AMT,'FM999,999,999,999,990.00')) AS GLINE_LOCL_CURR_DG_20FT_AMT
     , DECODE( Y.DCGO_SVC_FLG , 'N' , 'N/A' , TO_CHAR(Y.GLINE_LOCL_CURR_DG_40FT_AMT,'FM999,999,999,999,990.00')) AS GLINE_LOCL_CURR_DG_40FT_AMT
     --, DECODE( Y.DCGO_SVC_FLG , 'N' , 'N/A' , TO_CHAR(Y.GLINE_LOCL_CURR_DG_45FT_AMT,'FM999,999,999,999,990.00')) AS GLINE_LOCL_CURR_DG_45FT_AMT
     , CASE WHEN H.RHQ_CD = 'HAMRU' 
            THEN DECODE( Y.DCGO_SVC_FLG , 'N' , 'N/A' , TO_CHAR(Y.GLINE_LOCL_CURR_DG_45FT_AMT,'FM999,999,999,999,990.00'))
            ELSE DECODE( Y.DCGO_SVC_FLG , 'N' , 'N/A' , TO_CHAR(Y.GLINE_LOCL_CURR_DG_40FT_AMT,'FM999,999,999,999,990.00'))
       END GLINE_LOCL_CURR_DG_45FT_AMT --45'
     , Y.LOCL_CURR_CD
     , Y.IHC_TRF_NO
     , Y.ORG_DEST_TP_CD
     , Y.IHC_CGO_TP_CD
     , MAX (DECODE(SPCL.OVR_WGT_CGO_SVC_FLG, 'Y', DECODE(SPCL.PRC_INLND_TRF_CNTR_TPSZ_CD, '20', SPCL.MIN_CGO_WGT, '') , DECODE(SPCL.PRC_INLND_TRF_CNTR_TPSZ_CD, '20', SPCL.MAX_CGO_WGT, '')) ) OVER(PARTITION BY SPCL.SVC_SCP_CD, SPCL.ORG_DEST_TP_CD, SPCL.IHC_TRF_NO, SPCL.PRC_TRSP_MOD_CD) AS TRSP_20FT_AGMT_WGT
     , MAX (DECODE(SPCL.OVR_WGT_CGO_SVC_FLG, 'Y', DECODE(SPCL.PRC_INLND_TRF_CNTR_TPSZ_CD, '40', SPCL.MIN_CGO_WGT, '') , DECODE(SPCL.PRC_INLND_TRF_CNTR_TPSZ_CD, '40', SPCL.MAX_CGO_WGT, '') ) ) OVER(PARTITION BY SPCL.SVC_SCP_CD, SPCL.ORG_DEST_TP_CD, SPCL.IHC_TRF_NO, SPCL.PRC_TRSP_MOD_CD) AS TRSP_40FT_AGMT_WGT
     --, MAX (DECODE(SPCL.OVR_WGT_CGO_SVC_FLG, 'Y', DECODE(SPCL.PRC_INLND_TRF_CNTR_TPSZ_CD, '45', SPCL.MIN_CGO_WGT, '') , DECODE(SPCL.PRC_INLND_TRF_CNTR_TPSZ_CD, '45', SPCL.MAX_CGO_WGT, '') ) ) OVER(PARTITION BY SPCL.SVC_SCP_CD, SPCL.ORG_DEST_TP_CD, SPCL.IHC_TRF_NO, SPCL.PRC_TRSP_MOD_CD) AS TRSP_45FT_AGMT_WGT --45'
     , CASE WHEN H.RHQ_CD = 'HAMRU' 
            THEN MAX (DECODE(SPCL.OVR_WGT_CGO_SVC_FLG, 'Y', DECODE(SPCL.PRC_INLND_TRF_CNTR_TPSZ_CD, '45', SPCL.MIN_CGO_WGT, '') , DECODE(SPCL.PRC_INLND_TRF_CNTR_TPSZ_CD, '45', SPCL.MAX_CGO_WGT, '') ) ) OVER(PARTITION BY SPCL.SVC_SCP_CD, SPCL.ORG_DEST_TP_CD, SPCL.IHC_TRF_NO, SPCL.PRC_TRSP_MOD_CD)
            ELSE MAX (DECODE(SPCL.OVR_WGT_CGO_SVC_FLG, 'Y', DECODE(SPCL.PRC_INLND_TRF_CNTR_TPSZ_CD, '40', SPCL.MIN_CGO_WGT, '') , DECODE(SPCL.PRC_INLND_TRF_CNTR_TPSZ_CD, '40', SPCL.MAX_CGO_WGT, '') ) ) OVER(PARTITION BY SPCL.SVC_SCP_CD, SPCL.ORG_DEST_TP_CD, SPCL.IHC_TRF_NO, SPCL.PRC_TRSP_MOD_CD)
       END TRSP_45FT_AGMT_WGT --45'
     ,MAX(OVR_WGT_CGO_SVC_FLG) OVER(PARTITION BY SPCL.SVC_SCP_CD, SPCL.ORG_DEST_TP_CD, SPCL.IHC_TRF_NO, SPCL.PRC_TRSP_MOD_CD) AS OVR_WGT_CGO_SVC_FLG
  FROM (SELECT MN.SVC_SCP_CD,
               MN.IHC_TRF_NO,
               MN.AMDT_SEQ,
               T.COST_CNT_CD,
               MN.ORG_DEST_TP_CD
          FROM PRI_TRF_IHC_HDR T,
               PRI_TRF_IHC_MN  MN
         WHERE 1=1  
           AND T.SVC_SCP_CD = MN.SVC_SCP_CD
           AND T.IHC_TRF_NO = MN.IHC_TRF_NO
           AND T.ORG_DEST_TP_CD = MN.ORG_DEST_TP_CD
           AND MN.SVC_SCP_CD = @[svc_scp_cd]
           AND MN.ORG_DEST_TP_CD = @[org_dest_tp_cd]
           AND TO_DATE(@[acc_dt],'YYYY-MM-DD') BETWEEN MN.EFF_DT AND MN.EXP_DT
           AND MN.FIC_PROP_STS_CD = 'C' 
           AND MN.USA_SCP_BND_FLG = 'N'
       ) X,
       PRI_TRF_IHC_RT Y,
       PRI_TRF_IHC_HDR H,
       COM_INTG_CD_DTL TRSP_MOD,
       COM_INTG_CD_DTL TERM,
       MDM_LOCATION LOC,
       PRI_TRF_IHC_SPCL_CGO_RT SPCL
 WHERE 1=1
   AND X.SVC_SCP_CD = Y.SVC_SCP_CD
   AND X.IHC_TRF_NO = Y.IHC_TRF_NO
   AND X.AMDT_SEQ = Y.AMDT_SEQ
   AND X.ORG_DEST_TP_CD = Y.ORG_DEST_TP_CD
   AND Y.OPTM_TRSP_MOD_FLG = 'Y'
   AND Y.SRC_INFO_CD != 'AD'
   AND Y.PRC_TRSP_MOD_CD = TRSP_MOD.INTG_CD_VAL_CTNT(+)
   AND TRSP_MOD.INTG_CD_ID(+) = 'CD01720'
   AND Y.RCV_DE_TERM_CD = TERM.INTG_CD_VAL_CTNT(+)
   AND TERM.INTG_CD_ID(+) = 'CD01725'
   AND Y.PNT_LOC_CD = LOC.LOC_CD(+)
   AND LOC.DELT_FLG(+) = 'N'
   AND X.SVC_SCP_CD = H.SVC_SCP_CD
   AND X.IHC_TRF_NO = H.IHC_TRF_NO
   AND X.ORG_DEST_TP_CD = H.ORG_DEST_TP_CD

   AND Y.SVC_SCP_CD      = SPCL.SVC_SCP_CD
   AND Y.ORG_DEST_TP_CD  = SPCL.ORG_DEST_TP_CD
   AND Y.IHC_TRF_NO      = SPCL.IHC_TRF_NO
   AND Y.PRC_TRSP_MOD_CD = SPCL.PRC_TRSP_MOD_CD  
#if(${svc_scp_cd} != '')
   AND Y.SVC_SCP_CD = @[svc_scp_cd]
#end
#if(${pnt_loc_cd} != '')
   AND Y.PNT_LOC_CD = @[pnt_loc_cd]
#end
#if(${bse_port_loc_cd} != '')
   AND Y.BSE_PORT_LOC_CD = @[bse_port_loc_cd]
#end
#if(${cnt_cd} != '')
   AND H.COST_CNT_CD = @[cnt_cd]
#end
#if(${zip_cd} != '')
   AND LOC.ZIP_CD LIKE @[zip_cd]||'%'
#end
#if(${ihc_cgo_tp_cd} != '')
   AND Y.IHC_CGO_TP_CD = @[ihc_cgo_tp_cd]
#end
  ORDER BY PNT_LOC_CD			]]></sql>
			<params>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="org_dest_tp_cd" type="12" value="" out="N"/>
				<param name="acc_dt" type="12" value="" out="N"/>
				<param name="pnt_loc_cd" type="12" value="" out="N"/>
				<param name="bse_port_loc_cd" type="12" value="" out="N"/>
				<param name="cnt_cd" type="12" value="" out="N"/>
				<param name="zip_cd" type="12" value="" out="N"/>
				<param name="ihc_cgo_tp_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
