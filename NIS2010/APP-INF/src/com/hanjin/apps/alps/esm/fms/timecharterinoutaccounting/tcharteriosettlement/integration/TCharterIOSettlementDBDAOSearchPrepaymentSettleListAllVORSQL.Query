<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOSettlementDBDAOSearchPrepaymentSettleListAllVORSQL">
			<desc><![CDATA[Multi Prepayment Settlement Retrieve. 조건에 해당하는 모든 미 정리된 선급금 전표를 조회한다]]></desc>
			<sql><![CDATA[
SELECT 	
		C.PAY_DT,
		SUBSTR(A.FLET_CTRT_NO, 0, 4) VSL_CD,
		A.FLET_CTRT_NO,
		A.EFF_DT EFF_DATE,
		A.PPAY_HIR_NO,
		B.VNDR_SEQ,
		B.CSR_DESC SLP_DESC,
		B.SLP_TP_CD||B.SLP_FUNC_CD||B.SLP_OFC_CD||B.SLP_ISS_DT||B.SLP_SER_NO||B.SLP_SEQ_NO ORG_SLIP_NO,
		B.SLP_TP_CD ORG_SLP_TP_CD,
		B.SLP_FUNC_CD ORG_SLP_FUNC_CD,
		B.SLP_OFC_CD ORG_SLP_OFC_CD,
		B.SLP_ISS_DT ORG_SLP_ISS_DT,
		B.SLP_SER_NO ORG_SLP_SER_NO,
		B.SLP_SEQ_NO ORG_SLP_SEQ_NO,
		B.ACCT_CD,
		B.CSR_CURR_CD,
		B.CSR_AMT SLP_AMT,
		(SELECT AP_CTR_CD 
          FROM MDM_ORGANIZATION 
         WHERE OFC_CD = @[ofc_cd]
           AND ROWNUM = 1) CTR_CD,
       (SELECT LOC_CD 
          FROM MDM_ORGANIZATION 
         WHERE OFC_CD = @[ofc_cd]
           AND ROWNUM = 1) SLP_LOC_CD,
		TO_CHAR(B.VVD_EFF_DT, 'YYYYMMDD') VVD_EFF_DT,
		TO_CHAR(B.VVD_EXP_DT, 'YYYYMMDD') VVD_EXP_DT,
		B.INV_SEQ
FROM 	FMS_CONSULTATION A, FMS_CSUL_SLP B, AP_INV_HDR C
WHERE 	A.SLP_TP_CD 	= B.SLP_TP_CD
AND   	A.SLP_FUNC_CD 	= B.SLP_FUNC_CD
AND   	A.SLP_OFC_CD 	= B.SLP_OFC_CD
AND   	A.SLP_ISS_DT 	= B.SLP_ISS_DT
AND   	A.SLP_SER_NO 	= B.SLP_SER_NO
AND		A.SLP_FUNC_CD   = 'P'
AND   	A.APRO_FLG 		= 'Y'
AND	  	B.ACCT_CD	 	= '111431'
AND   	B.STL_FLG 		= 'N'
AND 	C.CSR_NO = A.SLP_TP_CD||A.SLP_FUNC_CD||A.SLP_OFC_CD||A.SLP_ISS_DT||A.SLP_SER_NO

#if ( ${pay_date} != '' )
AND C.PAY_DT <= @[pay_date]
#end

ORDER BY B.INV_SEQ			]]></sql>
			<params>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="pay_date" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
