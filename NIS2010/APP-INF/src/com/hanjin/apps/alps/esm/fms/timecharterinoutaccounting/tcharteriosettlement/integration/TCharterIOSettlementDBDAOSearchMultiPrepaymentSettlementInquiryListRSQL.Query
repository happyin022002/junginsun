<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOSettlementDBDAOSearchMultiPrepaymentSettlementInquiryListRSQL">
			<desc><![CDATA[Slip Inquiry]]></desc>
			<sql><![CDATA[
SELECT 	
        @[usr_id] USR_ID,
        'AP' CSR_TYPE,
        'MultiPrepaymentSettlement' SCREEN_GUBUN,
        @[eff_date_from] FROM_EFF_DT,
        @[eff_date_to] TO_EFF_DT,
		B.ORG_SLP_TP_CD||B.ORG_SLP_FUNC_CD||B.ORG_SLP_OFC_CD||B.ORG_ISS_DT||B.ORG_SLP_SER_NO ORG_SLIP_NO,
        B.SLP_TP_CD||B.SLP_FUNC_CD||B.SLP_OFC_CD||B.SLP_ISS_DT||B.SLP_SER_NO NEW_CSR_NO,
        B.SLP_OFC_CD REQUEST_TEAM,
        TO_CHAR(A.CRE_DT,'YYYYMMDD') CSR_DT,
        (
            SELECT USR_NM
              FROM COM_USER
             WHERE USR_ID = @[usr_id]
               AND ROWNUM = 1
        ) PRODUCED_BY,
        B.CSR_DESC,
        CASE 
            WHEN B.CUST_CNT_CD IS NOT NULL AND B.CUST_SEQ IS NOT NULL 
            THEN B.CUST_CNT_CD || ' ' || B.CUST_SEQ
            ELSE TO_CHAR(B.VNDR_SEQ)
        END OWNR_CD,
        CASE 
            WHEN C.OWNR_SEQ IS NULL 
            THEN (  
                    CASE 
                        WHEN B.CUST_CNT_CD IS NOT NULL AND B.CUST_SEQ IS NOT NULL 
                        THEN (
                                SELECT FO.OWNR_NM
                                  FROM MDM_CUSTOMER MV, FMS_OWNER FO
                                 WHERE MV.CUST_CNT_CD = B.CUST_CNT_CD
                                   AND MV.CUST_SEQ = B.CUST_SEQ
                                   AND MV.FLET_MGMT_OWNR_CUST_SEQ = FO.OWNR_SEQ
                                   AND ROWNUM =1
                             )
                        ELSE (
                                SELECT FO.OWNR_NM
                                  FROM MDM_VENDOR MV, FMS_OWNER FO
                                 WHERE MV.VNDR_SEQ = B.VNDR_SEQ
                                   AND MV.FLET_MGMT_OWNR_VNDR_SEQ = FO.OWNR_SEQ
                                   AND ROWNUM =1
                             )
                        END 
                 )
            ELSE (
                    SELECT FO.OWNR_NM
                      FROM FMS_OWNER FO
                     WHERE C.OWNR_SEQ = FO.OWNR_SEQ
                       AND ROWNUM =1
                 )
        END OWNR_NM,
        B.CSR_CURR_CD,
        B.CSR_AMT,
        DECODE(A.EVID_TP_CD,'1','TAX','4','CI','ETC') EVID_TP,
        CASE 
            WHEN A.DIFF_AMT > 0 
            THEN 'Y'
            ELSE 'N'
        END DEDUCTION,
        A.RQST_AMT,
        A.DIFF_DESC,
        A.CXL_FLG,
        A.CXL_DESC,
        NVL(
            B.VSL_CD,
            (
                SELECT VSL_CD
                  FROM FMS_CONTRACT
                 WHERE FLET_CTRT_NO = A.FLET_CTRT_NO
                   AND ROWNUM = 1
            )
        ) VSL_CD,
        (
            SELECT VSL_ENG_NM
              FROM MDM_VSL_CNTR
             WHERE DELT_FLG = 'N'
              AND VSL_CD = NVL(B.VSL_CD,
                                        (
                                            SELECT VSL_CD
                                              FROM FMS_CONTRACT
                                             WHERE FLET_CTRT_NO = A.FLET_CTRT_NO
                                               AND ROWNUM = 1
                                        )
                              )
        ) VSL_ENG_NAME
FROM 	FMS_CONSULTATION A, FMS_CSUL_SLP B, FMS_CONTRACT C
WHERE 	A.SLP_TP_CD 	= B.SLP_TP_CD
AND   	A.SLP_FUNC_CD 	= B.SLP_FUNC_CD
AND   	A.SLP_OFC_CD 	= B.SLP_OFC_CD
AND   	A.SLP_ISS_DT 	= B.SLP_ISS_DT
AND   	A.SLP_SER_NO 	= B.SLP_SER_NO
AND		A.SLP_FUNC_CD   = 'S'
AND	  	B.ACCT_CD	 	= '111431'
AND A.FLET_CTRT_NO = C.FLET_CTRT_NO 
#if ( ${eff_date_from} != '' )
AND A.EFF_DT BETWEEN @[eff_date_from] AND @[eff_date_to]
#end
#if ( ${vsl_cd} != '' )
AND C.VSL_CD = @[vsl_cd]
#end
ORDER BY B.INV_SEQ			]]></sql>
			<params>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="eff_date_from" type="12" value="" out="N"/>
				<param name="eff_date_to" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
