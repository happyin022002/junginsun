<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="StatusReportDBDAOSearchCustVipReport1RSQL">
			<desc><![CDATA[StatusReportDBDAOSearchCustVipReport1RSQL
2010.09.10 김영철 [ ] VIP REPORT 부분 오류 수정 ( 반영일 : 2010.09.24 )
2010.09.29 김영철 [ ] VIP REPORT 부분 SQL문 오류인하여 수정함.
2011.06.16 변종건 [CHM-201111601-01] VIP Report -조회조건추가 (RFA#컬럼 )
2011.06.23 변종건 [CHM-201111602-01] VIP Report - Group Customer 기준 변경 (Contract Customer)
2013.02.06 김진주 [CHM-201322646] VIP Report Item 추가 요청 - Discharging at TS Port
2013.03.13 임재관 [CHM-201323518] VIP Report 보완 - Final destination name 로직 추가, Partial 선적의 Pick up yard 누락 보완]]></desc>
			<sql><![CDATA[
SELECT YY.*
FROM (
SELECT XX.*, COUNT(ROWNUM) OVER() TOTAL_CNT, 
ROWNUM RNUM
FROM ( 
SELECT DISTINCT ${select_list}
--     , COUNT(BKG_NO) OVER() TOTAL_CNT 
FROM ( 
   SELECT 
           (SELECT ACT_NM FROM MDM_ACTIVITY WHERE ACT_CD = Y2.STS_CD) STS_NM
          ,(SELECT YD_NM FROM MDM_YARD WHERE YD_CD = Y2.EVNT_PLC_CD) EVNT_PLC
		  ,BKG_GET_TOKEN_FNC( Y2.PRE_VVD_N_NM,1) AS PRE_VVD
		  ,BKG_GET_TOKEN_FNC( Y2.PRE_VVD_N_NM,2) AS PRE_VVD_NM
		  ,BKG_GET_TOKEN_FNC( Y2.POST_VVD_N_NM,1) AS POST_VVD
		  ,BKG_GET_TOKEN_FNC( Y2.POST_VVD_N_NM,2) AS POST_VVD_NM

          ,BKG_GET_TOKEN_FNC( Y2.NIST_POL_ETA_ETD_DT2,1) AS POL1_ETA_DT
          ,BKG_GET_TOKEN_FNC( Y2.NIST_POL_ETA_ETD_DT2,2) AS POL1_ETD_DT
          ,BKG_GET_TOKEN_FNC( Y2.NIST_POD_ETA_ETD_DT2,1) AS POD1_ETA_DT
          ,BKG_GET_TOKEN_FNC( Y2.NIST_POD_ETA_ETD_DT2,2) AS POD1_ETD_DT
          ,(SELECT CUST_REF_NO_CTNT
              FROM BKG_REFERENCE
             WHERE BKG_NO = Y2.BKG_NO
               AND BKG_REF_TP_CD ='HPDP'
               AND ROWNUM =1
           ) AS DEPT_NO
          ,(SELECT CUST_ADDR
              FROM BKG_CUSTOMER
             WHERE BKG_NO = Y2.BKG_NO
               AND BKG_CUST_TP_CD ='N'
            ) AS NTFY_ADDR
          ,(SELECT  DEST_TRNS_SVC_MOD_CD 
              FROM    BKG_BOOKING BK
             WHERE   BK.BKG_NO = Y2.BKG_NO
            ) AS  DEST_SVC_MOD_CD 
          ,(SELECT CUST_REF_NO_CTNT
		      FROM BKG_REFERENCE
             WHERE BKG_NO = Y2.BKG_NO
               AND BKG_REF_TP_CD = 'FINV'
               AND ROWNUM =1 
           ) AS CUST_INV_NO
          ,(SELECT CUST_REF_NO_CTNT     
		      FROM BKG_REFERENCE
             WHERE BKG_NO = Y2.BKG_NO
               AND BKG_REF_TP_CD = 'EBRF'
               AND ROWNUM =1
           ) AS CUST_BKG_REF_NO
          ,(SELECT CUST_REF_NO_CTNT
		      FROM BKG_REFERENCE
             WHERE BKG_NO = Y2.BKG_NO
               AND BKG_REF_TP_CD = 'ESRF'
               AND ROWNUM =1
           ) AS CUST_SI_REF_NO           
          ,(SELECT TO_CHAR(SUBSTR(CMDT_DESC, 1, 200)) FROM BKG_BL_MK_DESC MD WHERE MD.BKG_NO=Y2.BKG_NO AND MK_SEQ=1) AS MK_DESC
          ,'' AS DEL_FT_DT
          ,Y2.*
     FROM (
     SELECT 
             /* 2014.12.08 1.Event Date-Time 2.Status 3.Event Place 4.Days since last movement 추가 요청 김미선 부장 */
             BKG_GET_TOKEN_FNC(COP_COLS,2) AS EVNT_DT_TM
            ,BKG_GET_TOKEN_FNC(COP_COLS,3) AS STS_CD
            ,BKG_GET_TOKEN_FNC(COP_COLS,4) AS EVNT_PLC_CD
            ,TRUNC(SYSDATE) - TRUNC(TO_DATE(BKG_GET_TOKEN_FNC(COP_COLS,2),'YYYY-MM-DD HH24:MI')) AS DYS_LST_MVMT 
            ,(SELECT TO_CHAR(VPS_ETA_DT,'YYYY-MM-DD')||','||TO_CHAR(VPS_ETD_DT,'YYYY-MM-DD')
               FROM VSK_VSL_PORT_SKD POL
              WHERE 1=1
                AND POL.VSL_CD       = BKG_GET_TOKEN_FNC(Y1.NIST_POL_ETA_ETD_DT1,1)
                AND POL.SKD_VOY_NO   = BKG_GET_TOKEN_FNC(Y1.NIST_POL_ETA_ETD_DT1,2)
                AND POL.SKD_DIR_CD   = BKG_GET_TOKEN_FNC(Y1.NIST_POL_ETA_ETD_DT1,3)
                AND POL.VPS_PORT_CD  = BKG_GET_TOKEN_FNC(Y1.NIST_POL_ETA_ETD_DT1,4)
                AND POL.CLPT_IND_SEQ = BKG_GET_TOKEN_FNC(Y1.NIST_POL_ETA_ETD_DT1,5)  
             ) AS NIST_POL_ETA_ETD_DT2
            ,(SELECT TO_CHAR(VPS_ETA_DT,'YYYY-MM-DD')||','||TO_CHAR(VPS_ETD_DT,'YYYY-MM-DD')
                FROM VSK_VSL_PORT_SKD POD
               WHERE 1=1
                 AND POD.VSL_CD       = BKG_GET_TOKEN_FNC(Y1.NIST_POD_ETA_ETD_DT1,1)
                 AND POD.SKD_VOY_NO   = BKG_GET_TOKEN_FNC(Y1.NIST_POD_ETA_ETD_DT1,2)
                 AND POD.SKD_DIR_CD   = BKG_GET_TOKEN_FNC(Y1.NIST_POD_ETA_ETD_DT1,3)
                 AND POD.VPS_PORT_CD  = BKG_GET_TOKEN_FNC(Y1.NIST_POD_ETA_ETD_DT1,4)
                 AND POD.CLPT_IND_SEQ = BKG_GET_TOKEN_FNC(Y1.NIST_POD_ETA_ETD_DT1,5)  
             ) AS NIST_POD_ETA_ETD_DT2

            ,DECODE(IN_OUT_CD, 'OUT'  ,TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD'),'YYYYMMDD')
                                        - (  TO_DATE(SUBSTR(Y1.F_POL_ETAETD,9,8),'YYYYMMDD') 
                                           + DECODE(NVL(Y1.OB_CUST_CRTERM, 0),0, Y1.OB_OFC_CRTERM, Y1.OB_CUST_CRTERM ))
                                      ,TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD'),'YYYYMMDD')
                                         - (  TO_DATE(SUBSTR(Y1.L_POD_ETAETD,1,8),'YYYYMMDD')  
                                            + DECODE(NVL(Y1.IB_CUST_CRTERM, 0),0, Y1.IB_OFC_CRTERM, Y1.IB_CUST_CRTERM ))
                     ) AS OVERDUE
                                                 
            ,DECODE(IN_OUT_CD, 'OUT', TO_CHAR(TO_DATE(SUBSTR(Y1.F_POL_ETAETD,9,8),'YYYYMMDD')  
                                               + DECODE(NVL(Y1.OB_CUST_CRTERM, 0),0, Y1.OB_OFC_CRTERM, Y1.OB_CUST_CRTERM ),'YYYYMMDD')
                                        , TO_CHAR((TO_DATE(SUBSTR(Y1.L_POD_ETAETD,1,8),'YYYYMMDD')  
                                                 + DECODE(NVL(Y1.IB_CUST_CRTERM, 0),0, Y1.IB_OFC_CRTERM ,Y1.IB_CUST_CRTERM)),'YYYYMMDD')
                   ) AS DUE_DATE 
            ,Y1.*
      FROM (
            SELECT 
            --  ROWNUM RNUM
            --, COUNT(BKG_NO) OVER() TOTAL_CNT 
            --, 
			 (SELECT VSL_ENG_NM FROM MDM_VSL_CNTR WHERE VSL_CD = Y.VSL_CD) AS TRUNK_VESSEL

   		     /* 1st POL ETA,1st POL ETD */
            ,(SELECT /*+ INDEX_ASC(V1 XPKBKG_VVD )*/
                    V1.VSL_CD||','||V1.SKD_VOY_NO||','||V1.SKD_DIR_CD||','|| V1.POL_CD||','||V1.POl_CLPT_IND_SEQ
               FROM BKG_VVD V1
              WHERE V1.BKG_NO = Y.BKG_NO
                AND ROWNUM =1 /* 첫 배를 가져옴*/
             ) AS NIST_POL_ETA_ETD_DT1
             ,(SELECT /*+ INDEX_ASC(V1 XPKBKG_VVD )*/
                      V1.VSL_CD||','||V1.SKD_VOY_NO||','||V1.SKD_DIR_CD||','|| V1.POD_CD||','||V1.POD_CLPT_IND_SEQ
                 FROM BKG_VVD V1
                WHERE V1.BKG_NO = Y.BKG_NO
                  AND ROWNUM =1 /* 첫 배를 가져옴*/
               ) AS NIST_POD_ETA_ETD_DT1
            , Y.*
            ,(  SELECT 
                      MAX( LPAD(B.COP_DTL_SEQ,5,'0')||','||
                           TO_CHAR(NVL(B.ACT_DT, B.ESTM_DT),'YYYY-MM-DD HH24:MI') ||','||
                           B.ACT_CD ||','||
                           B.NOD_CD
                         ) AS COP_COLS
                      FROM SCE_COP_HDR A
                         , SCE_COP_DTL B
                     WHERE 1 =1
                       AND A.COP_STS_CD <> 'X'
                       AND A.COP_NO = B.COP_NO
                       AND B.ACT_DT IS NOT NULL           
                       AND A.BKG_NO =  Y.BKG_NO
                       AND A.CNTR_NO = Y.CNTR_NO
            ) COP_COLS
        ,(SELECT NVL(MAX(CR2.IB_CR_TERM_DYS),0) 
            FROM MDM_CR_CUST CR2
           WHERE CR2.CUST_CNT_CD = SUBSTR(Y.SHIPPER,1,2)
             AND CR2.CUST_SEQ    =  SUBSTR(Y.SHIPPER,3,6) ) AS OB_CUST_CRTERM
        ,(SELECT M2.IB_CR_TERM_DYS 
            FROM MDM_ORGANIZATION M1, MDM_ORGANIZATION M2
           WHERE M1.OFC_CD = Y.PPD_OFC
             AND M2.OFC_CD = M1.AR_OFC_CD                 )  AS OB_OFC_CRTERM
             
        ,(SELECT NVL(MAX(CR.IB_CR_TERM_DYS),0) 
            FROM MDM_CR_CUST CR
           WHERE CR.CUST_CNT_CD = SUBSTR(Y.CONSIGNEE,1,2)
             AND CR.CUST_SEQ    = SUBSTR(Y.CONSIGNEE,3,6) )  AS IB_CUST_CRTERM  
        ,(SELECT M2.IB_CR_TERM_DYS 
            FROM  MDM_ORGANIZATION M1, MDM_ORGANIZATION M2
           WHERE  M1.OFC_CD  = Y.CCT_OFC
             AND  M2.OFC_CD  = M1.AR_OFC_CD               )  AS IB_OFC_CRTERM             
             
                       
        ,(SELECT TO_CHAR(V1.VPS_ETA_DT,'YYYYMMDD')||TO_CHAR(V1.VPS_ETD_DT,'YYYYMMDD') AS ETAETD
              FROM   VSK_VSL_PORT_SKD V1
              WHERE  V1.VSL_CD       = SUBSTR(Y.FST_VVD,1,4)
              AND    V1.SKD_VOY_NO   = SUBSTR(Y.FST_VVD,5,4)
              AND    V1.SKD_DIR_CD   = SUBSTR(Y.FST_VVD,9,1)
              AND    V1.VPS_PORT_CD  = Y.POL_CD
              AND    V1.CLPT_IND_SEQ = (SELECT MAX(V2.CLPT_IND_SEQ)
                                        FROM   VSK_VSL_PORT_SKD V2
                                        WHERE  V2.VSL_CD      = SUBSTR(Y.FST_VVD,1,4)
                                        AND    V2.SKD_VOY_NO  = SUBSTR(Y.FST_VVD,5,4)
                                        AND    V2.SKD_DIR_CD  = SUBSTR(Y.FST_VVD,9,1)
                                        AND    V2.VPS_PORT_CD = Y.POL_CD)
            ) AS F_POL_ETAETD 
                
            ,(SELECT TO_CHAR(V3.VPS_ETA_DT,'YYYYMMDD')||TO_CHAR(V3.VPS_ETD_DT,'YYYYMMDD') AS ETAETD 
              FROM VSK_VSL_PORT_SKD V3
              WHERE   V3.VSL_CD = SUBSTR(Y.LST_VVD,1,4)
              AND     V3.SKD_VOY_NO = SUBSTR(Y.LST_VVD,5,4)
              AND     V3.SKD_DIR_CD = SUBSTR(Y.LST_VVD,9,1)
              AND     V3.VPS_PORT_CD = Y.POD_CD
              AND     V3.CLPT_IND_SEQ = (SELECT MAX(V4.CLPT_IND_SEQ)
                                         FROM   VSK_VSL_PORT_SKD V4
                                         WHERE  V4.VSL_CD     = SUBSTR(Y.LST_VVD,1,4)
                                         AND    V4.SKD_VOY_NO = SUBSTR(Y.LST_VVD,5,4)
                                         AND    V4.SKD_DIR_CD = SUBSTR(Y.LST_VVD,9,1)
                                         AND    V4.VPS_PORT_CD =  Y.POD_CD)
            ) AS L_POD_ETAETD
            FROM (
                    SELECT 
				 	X.BKG_NO,
				    X.CNTR_NO,
				    X.BKG_OFC_CD,
				    decode(@[scac_flg] ,'Y','SMLM','')||X.BL_NO  BL_NO,
				    X.TRUNK_VVD,
				    X.VSL_CD,
				    X.SKD_VOY_NO,
				    X.SKD_DIR_CD,
				    X.POR_CD,
				    X.POL_CD,
				    X.POD_CD,
				    X.DEL_CD,
				    X.PRE_RLY_PORT_CD,
				    X.PST_RLY_PORT_CD,
				    X.CMDT_CD,
				    X.PCT_QTY,
				    X.PCK_TP_CD,
				    X.REP_CMDT,
				    X.CUST_REF_NO,
				    X.ACT_WGT,
				    X.WGT_UT_CD,
				    X.RCV_TERM_CD,
				    X.DE_TERM_CD,
				    X.LANE_CD,
				    X.SCAC_CD,
				    X.OBL_ISS_DT,
				    X.BL_OBRD_DT,
					X.SVC_SCP_CD,
				    X.VSL_ENG_NM,
				    X.POR_NM,
				    X.POL_NM,
				    X.POD_NM,
				    X.DEL_NM,
				    X.SHPR_CODE,
				    X.SHPR_NAME,
				    X.CNEE_CODE,
				    X.CNEE_NAME,
				    X.NTFY_CODE,
				    X.NTFY_NAME,
				    X.SC_NO,   
				    X.RFA_NO,         
				    X.PPD_OFC,          
				    X.CCT_OFC,          
				    X.CSTMS_DESC,       
				    X.USA_CSTMS_FILE_CD,
				    X.CND_CSTMS_FILE_CD,
				    X.CNTR_WGT,         
				    X.CNTR_WGT_UT_CD,
				    X.SPC_CGO,
				    X.MEAS_QTY,      
				    X.CNTR_MEAS_UT_CD,    
				    X.CNTR_TPSZ_CD,  
                    X.CNTR_VOL_QTY, 
				    X.PCK_QTY,       
				    X.CNTR_PCK_TP_CD,
				    X.CNTR_PRT_FLG,  
				    X.BDR_FLG,       
				    X.POR_CNTY,      
				    X.DEL_CNTY,
				    X.RMK,
				    X.CGO_RCV_DT,
				    X.SCAC,
				    X.CNTR_SIZE,
				    X.CHG_AMT,
				    X.G_CUST_SHPR,
				    X.G_CUST_CNEE,
				    BKG_GET_TOKEN_FNC(X.CA_ITNO,1) AS CA_ITNO,
				    BKG_GET_TOKEN_FNC(X.CA_ITNO,2) AS CNRR_REF_NO,
				    X.ATD,
				    X.ATA,
				    X.ATA_T,
				    X.ATD_T,
				    X.F_POL_ETA,
				    X.F_POL_ETD,
				    X.F_POD_ETA,
				    X.F_POD_ETD,
				    X.T_POL_ETA,
				    X.T_POL_ETD,
				    X.T_POD_ETA,
				    X.T_POD_ETD,
				    X.PPD_Charge,
				    X.CCT_Charge,
				    X.AN_SEND_DT,
				    X.DEL_STATE,
				    X.CNTR_SEAL_NO,
				    X.BL_PO_NO,
                    X.ITEM_PO_NO,
				    X.CNTR_PO_NO,    
				    X.POL_ETD,
				    X.POD_ETA,
                    X.POD_ETB,
                    X.ACT_CUST_CODE,
                    X.ACT_CUST_NAME,
				    X.EQ_CTRL_OFC,
				    BKG_GET_TOKEN_FNC(X.FREE_DT,1) AS FREE_DT,
				    BKG_GET_TOKEN_FNC(X.FREE_DT,2) AS PKUP_NO,
				    BKG_GET_TOKEN_FNC(X.FREE_DT,3) AS PKUP_NOD_CD,
				    BKG_GET_TOKEN_FNC(X.FREE_DT,4) AS AVAL_DT,
				    BKG_GET_TOKEN_FNC(X.IBD_TRSP_ISS_DT,1) AS IBD_TRSP_ISS_DT,
				    X.HUB_LOC_CD,
				    BKG_GET_TOKEN_FNC(X.IBD_TRSP_ISS_DT,2) AS IT_NO,
				    BKG_GET_TOKEN_FNC(X.FRT_CLT_FLG,1) AS FRT_CLT_FLG,
				    BKG_GET_TOKEN_FNC(X.FRT_CLT_FLG,2) AS OBL_RDEM_FLG,
				    BKG_GET_TOKEN_FNC(X.FRT_CLT_FLG,3) AS CUSTOMS_RLS_DT,
				    BKG_GET_TOKEN_FNC(X.FRT_CLT_FLG,4) AS CSTMS_CLR_CD,
				    X.CNTR_OC_DATE,
				    X.DCHG_TS_PORT_DT,
				    X.DSPO_CD,
				    X.CGO_STS_CD,
				    X.POD_ATATIC_DT,
				    X.DEL_ATA,
				    X.DEL_DT,
				    X.POR_GATE_IN_DT,
				    X.MT_RETURN_DT,
				    X.DEL_ETA_DT,
				    X.EXPORT_REF_NO,
				    X.FIRMS_CODE,
				    X.CBKG_NO,
				    X.TOT_MEAS,
				    X.MEAS_UT_CD,
                    X.SHIP_ID,
                    X.PRT_NO,
                    X.BKG_RCT_SND_DT_FAX,
                    X.DBL_SND_DT_FAX,
                    X.WBL_SND_DT_FAX,
                    X.DBL_SND_DT_EDI,
                    X.BKG_RCT_SND_DT_EDI,
                    X.UVD_MAX_ACT_DT,
                    X.UVD_MAX_ACT_DT2,
                    X.RLN_MAX_ACT_DT,
                    X.URN_MAX_ACT_DT,
                    X.OAN_MAX_ACT_DT,
                    X.OAN_MAX_ACT_DT2,
                    X.D_MAX_ACT_DT,
                    X.WEB_PRT,
					'' CCT_EX_RT,
					'' PPD_EX_RT,

					X.FNL_DEST_NM FINAL_DEST_NM,

                   (SELECT BKG.VSL_CD||BKG.SKD_VOY_NO||BKG.SKD_DIR_CD 
                           ||','||(SELECT CVSL.VSL_ENG_NM FROM MDM_VSL_CNTR     CVSL WHERE CVSL.VSL_CD = PRE.VSL_CD) 
                      FROM BKG_BOOKING BKG
                         , BKG_VVD PRE
                     WHERE BKG.BKG_NO          = PRE.BKG_NO
                       AND BKG.PRE_RLY_PORT_CD = PRE.POD_CD
                       AND 'S'                 = PRE.VSL_PRE_PST_CD
                       AND  BKG.BKG_NO         = X.BKG_NO
					) AS  PRE_VVD_N_NM,

                   (SELECT BKG.VSL_CD||BKG.SKD_VOY_NO||BKG.SKD_DIR_CD 
                           ||','||(SELECT CVSL.VSL_ENG_NM FROM MDM_VSL_CNTR     CVSL WHERE CVSL.VSL_CD = PST.VSL_CD)
                      FROM BKG_BOOKING BKG
                         , BKG_VVD PST
                     WHERE BKG.BKG_NO          = PST.BKG_NO
                       AND BKG.PST_RLY_PORT_CD = PST.POL_CD
                       AND 'U'                 = PST.VSL_PRE_PST_CD
                       AND BKG.BKG_NO          = X.BKG_NO
                    ) AS POST_VVD_N_NM,

					'' G_CNEE_CODE,
					'' G_SHPR_CODE,
					'' FRD_CUST_CODE,
					X.FRD_CUST_NM,
					X.FRD_CUST_CD,
					'' BL_ISS_OFC,

                    /* CUSTOMER  */   
                    (SELECT C7.CUST_CNT_CD||LPAD(TO_CHAR(C7.CUST_SEQ),6,'0')
                        FROM BKG_CUSTOMER C7
                        WHERE C7.BKG_NO=X.BKG_NO AND C7.BKG_CUST_TP_CD ='S' ) AS SHIPPER,
                    ( SELECT C1.CUST_CNT_CD||LPAD(TO_CHAR(C1.CUST_SEQ),6,'0')
                        FROM   BKG_CUSTOMER C1
                       WHERE  C1.BKG_NO = X.BKG_NO AND C1.BKG_CUST_TP_CD ='C' ) AS CONSIGNEE,

                        
                    (SELECT /*+ INDEX( K5 XPKBKG_VVD ) */
                            K5.VSL_CD||K5.SKD_VOY_NO||K5.SKD_DIR_CD 
                        FROM  BKG_VVD K5
                        WHERE K5.BKG_NO = X.BKG_NO  AND  ROWNUM = 1) AS FST_VVD,
                    (SELECT /*+ INDEX_DESC( K6 XPKBKG_VVD ) */ 
                                     K6.VSL_CD||K6.SKD_VOY_NO||K6.SKD_DIR_CD 
                              FROM  BKG_VVD K6
                              WHERE K6.BKG_NO = X.BKG_NO
                              AND  ROWNUM = 1)     AS LST_VVD, 
                      @[in_out_cd] AS IN_OUT_CD
                      ,X.INIT_POL_ETA_DT,INIT_POL_ETD_DT,INIT_POD_ETA_DT
                      ,X.LOAD_ID
					  ,X.VGM_WGT AS VGM_WGT
                      ,X.VGM_WGT_UT_CD AS VGM_WGT_UT_CD
                      ,X.VGM_VRFY_SIG_CTNT AS VGM_VRFY_SIG_CTNT
                      ,X.VGM_MZD_TP_CD AS VGM_MZD_TP_CD
                    FROM (
                                SELECT 
                                    B.BKG_NO      AS BKG_NO,
                                    CNTR.CNTR_NO  AS CNTR_NO,
                                    B.BKG_OFC_CD  AS BKG_OFC_CD,
                                    B.BL_NO       AS BL_NO,
                                    B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD AS TRUNK_VVD,
                                    B.VSL_CD      AS VSL_CD, 
                                    B.SKD_VOY_NO  AS SKD_VOY_NO, 
                                    B.SKD_DIR_CD  AS SKD_DIR_CD, 
                                    B.POR_CD      AS POR_CD,
                                    B.POL_CD      AS POL_CD,
                                    B.POD_CD      AS POD_CD,
                                    B.DEL_CD      AS DEL_CD,
                                    B.PRE_RLY_PORT_CD AS PRE_RLY_PORT_CD,
                                    B.PST_RLY_PORT_CD AS PST_RLY_PORT_CD,
                                    B.CMDT_CD     AS CMDT_CD,
                                    D.PCK_QTY     AS PCT_QTY,
                                    D.PCK_TP_CD   AS PCK_TP_CD,   
                                    D.MEAS_QTY    AS TOT_MEAS,
                                    D.MEAS_UT_CD  AS MEAS_UT_CD,   
                                    L.REP_CMDT_NM AS REP_CMDT, 
                                    (SELECT CUST_REF_NO_CTNT 
                                     FROM BKG_REFERENCE R 
                                     WHERE R.BKG_NO = B.BKG_NO  
                                       AND BKG_REF_TP_CD = 'EBRF' ) AS CUST_REF_NO, 
                                    D.ACT_WGT     AS ACT_WGT, 
                                    D.WGT_UT_CD   AS WGT_UT_CD, 
                                    B.RCV_TERM_CD AS RCV_TERM_CD,
                                    B.DE_TERM_CD  AS DE_TERM_CD,
                                    B.SLAN_CD     AS LANE_CD,
                                    B.SCAC_CD     AS SCAC_CD,
									B.SVC_SCP_CD  AS SVC_SCP_CD,
                                    TO_CHAR(H.OBL_ISS_DT, 'YYYY-MM-DD')  AS OBL_ISS_DT,
                                    TO_CHAR(D.BL_OBRD_DT, 'YYYY-MM-DD')  AS BL_OBRD_DT,
                                    D.VSL_NM         AS VSL_ENG_NM,
                                    D.POR_NM         AS POR_NM,
                                    D.POL_NM         AS POL_NM,
                                    D.POD_NM         AS POD_NM,
                                    D.DEL_NM         AS DEL_NM,
                                    MAX(DECODE(C.BKG_CUST_TP_CD, 'S', C.CUST_CNT_CD, ''))||MAX(DECODE(C.BKG_CUST_TP_CD, 'S', LPAD(C.CUST_SEQ,6,'0'), '')) AS SHPR_CODE,
                                    REPLACE(MAX(DECODE(C.BKG_CUST_TP_CD,'S',C.CUST_NM,'')),chr(13)||chr(10),' ') AS SHPR_NAME,
                                    MAX(DECODE(C.BKG_CUST_TP_CD, 'C', C.CUST_CNT_CD, ''))||MAX(DECODE(C.BKG_CUST_TP_CD, 'C', LPAD(C.CUST_SEQ,6,'0'), '')) AS CNEE_CODE,
                                    REPLACE(MAX(DECODE(C.BKG_CUST_TP_CD,'C',C.CUST_NM,'')),chr(13)||chr(10),' ') AS CNEE_NAME,
                                    MAX(DECODE(C.BKG_CUST_TP_CD, 'N', C.CUST_CNT_CD, ''))||MAX(DECODE(C.BKG_CUST_TP_CD, 'N', LPAD(C.CUST_SEQ,6,'0'), '')) AS NTFY_CODE,
                                    REPLACE(MAX(DECODE(C.BKG_CUST_TP_CD,'N',C.CUST_NM,'')),chr(13)||chr(10),' ') AS NTFY_NAME,
									MAX(DECODE(C.BKG_CUST_TP_CD, 'F', C.CUST_CNT_CD, ''))||MAX(DECODE(C.BKG_CUST_TP_CD, 'F', LPAD(C.CUST_SEQ,6,'0'), '')) AS FRD_CUST_CD,
                                    REPLACE(MAX(DECODE(C.BKG_CUST_TP_CD,'F',C.CUST_NM,'')),chr(13)||chr(10),' ') AS FRD_CUST_NM,
                                    B.SC_NO             AS SC_NO,
                                    B.RFA_NO            AS RFA_NO,
                                    R.PPD_RCV_OFC_CD    AS PPD_OFC,
                                    R.CLT_OFC_CD        AS CCT_OFC,
                                    D.CSTMS_DESC        AS CSTMS_DESC,
                                    B.USA_CSTMS_FILE_CD AS USA_CSTMS_FILE_CD,
                                    B.CND_CSTMS_FILE_CD AS CND_CSTMS_FILE_CD,  
                                    CNTR.CNTR_WGT       AS CNTR_WGT,
                                    CNTR.WGT_UT_CD      AS CNTR_WGT_UT_CD,
                                    DECODE(CNTR.DCGO_FLG, 'Y', 'DG', DECODE(CNTR.RC_FLG, 'Y', 'RF', 
                                                                           DECODE(CNTR.BB_CGO_FLG, 'Y', 'BB', 
                                                                            DECODE(CNTR.AWK_CGO_FLG, 'Y', 'AK', 
                                                                             DECODE(CNTR.RD_CGO_FLG, 'RD', 
                                                                              DECODE(CNTR.SOC_FLG, 'Y', 'SOC', '')))))) AS SPC_CGO,   
                                    CNTR.MEAS_QTY       AS MEAS_QTY,
                                    CNTR.MEAS_UT_CD     AS CNTR_MEAS_UT_CD,
                                    CNTR.CNTR_TPSZ_CD   AS CNTR_TPSZ_CD,
                                    CNTR.CNTR_VOL_QTY   AS CNTR_VOL_QTY, 
                                    CNTR.PCK_QTY        AS PCK_QTY,
                                    CNTR.PCK_TP_CD      AS CNTR_PCK_TP_CD,
                                    CNTR.CNTR_PRT_FLG   AS CNTR_PRT_FLG,
                                    ( SELECT CUST_REF_NO_CTNT 
                                       FROM BKG_REFERENCE A
                                       WHERE A.BKG_NO = CNTR.BKG_NO
                                       AND  A.CNTR_NO = CNTR.CNTR_NO
									   AND A.BKG_REF_TP_CD = 'CTPO'
									   AND ROWNUM = 1
                                    ) AS CNTR_PO_NO,
								    BKG_JOIN_FNC( CURSOR(
								                    SELECT PO_NO
								                      FROM BKG_REF_DTL DTL
								                     WHERE DTL.BKG_NO = CNTR.BKG_NO
								                      AND DTL.CNTR_NO = CNTR.CNTR_NO
								                      AND DE_NO IS NULL
								                      AND PRT_NO IS NULL
								                      AND PO_NO IS NOT NULL
								                      AND ROWNUM <=10 /* 10개 까지만 제공 */
								    )) AS ITEM_PO_NO,
                                    J.DE_NO SHIP_ID,
                                    J.PRT_NO,
                                    D.BDR_FLG           AS BDR_FLG,
                                    SUBSTR(B.POR_CD,1,2) AS POR_CNTY,
                                    SUBSTR(B.DEL_CD,1,2) AS DEL_CNTY,
                                    REPLACE(B.XTER_RMK,chr(13)||chr(10),' ')           AS RMK,

                                    TO_CHAR(R.CGO_RCV_DT,'YYYY-MM-DD') AS CGO_RCV_DT, 
                                    'SMLM'               AS SCAC,
                                    (SELECT U.RAT_UT_CD 
                                     FROM PRI_RAT_UT U, PRI_RAT_UT C
                                     WHERE U.RAT_UT_CD IN ('20','40','45')
                                     AND U.CNTR_SZ_CD = C.CNTR_SZ_CD
                                     AND C.RAT_UT_CD = CNTR.CNTR_TPSZ_CD) CNTR_SIZE,                      
                                                                                               
                                    (SELECT CHG_AMT 
                                      FROM BKG_CHG_RT A
                                     WHERE A.BKG_NO = B.BKG_NO
                                       AND A.RT_SEQ = (SELECT MAX(RT_SEQ)
                                                       FROM BKG_CHG_RT C
                                                       WHERE C.BKG_NO = B.BKG_NO)
                                    ) AS CHG_AMT, 

                                    ( SELECT CUST_GRP_ID 
                                       FROM MDM_CUSTOMER A, BKG_CUSTOMER SCUST
                                      WHERE  A.CUST_CNT_CD = SCUST.CUST_CNT_CD
                                        AND  A.CUST_SEQ = SCUST.CUST_SEQ 
                                        AND  SCUST.BKG_CUST_TP_CD ='S'
                                        AND  SCUST.BKG_NO = B.BKG_NO
                                    ) AS G_CUST_SHPR,

                                    ( SELECT CUST_GRP_ID 
                                       FROM MDM_CUSTOMER A, BKG_CUSTOMER SCUST
                                      WHERE  A.CUST_CNT_CD = SCUST.CUST_CNT_CD
                                        AND  A.CUST_SEQ = SCUST.CUST_SEQ 
                                        AND  SCUST.BKG_CUST_TP_CD ='C'
                                        AND  SCUST.BKG_NO = B.BKG_NO
                                    ) AS G_CUST_CNEE    ,

                                    ( SELECT USA_IB_TRSP_NO||','||RAIL_CRR_REF_NO
										FROM BKG_CSTMS_ADV_CNTR A
										WHERE A.CNT_CD = 'CA'
										AND B.BL_NO = A.BL_NO
										AND CNTR.CNTR_NO = A.CNTR_NO
									) AS CA_ITNO,

                                    ( SELECT TO_CHAR(S2.ACT_DT,'YYYY-MM-DD hh24:mi')   
                                       FROM BKG_VVD S1, SCE_COP_DTL S2
                                       WHERE S1.BKG_NO = B.BKG_NO  
                                        AND S1.VSL_CD = S2.VSL_CD
                                        AND S1.SKD_VOY_NO = S2.SKD_VOY_NO
                                        AND S1.SKD_DIR_CD = S2.SKD_DIR_CD
                                        AND S1.POL_CD = S2.VPS_PORT_CD
                                        AND S1.VSL_PRE_PST_CD||S1.VSL_SEQ = (SELECT MIN(VSL_PRE_PST_CD||VSL_SEQ)
                                                                             FROM bkg_vvd
                                                                             WHERE BKG_NO = B.BKG_NO)
                                                                             AND S2.COP_NO IN ( SELECT MAX(COP_NO)
                                                                                                  FROM SCE_COP_HDR
                                                                                                 WHERE BKG_NO = B.BKG_NO
                                                                                                   AND COP_STS_CD != 'X' )
                                        AND S2.ACT_CD LIKE 'F__MDO'
                                    ) AS ATD,

                                        
                                    ( SELECT TO_CHAR(S2.ACT_DT,'YYYY-MM-DD hh24:mi')   
                                       FROM BKG_VVD S1, SCE_COP_DTL S2
                                       WHERE S1.BKG_NO = B.BKG_NO  
                                        AND S1.VSL_CD = S2.VSL_CD
                                        AND S1.SKD_VOY_NO = S2.SKD_VOY_NO
                                        AND S1.SKD_DIR_CD = S2.SKD_DIR_CD
                                        AND S1.POL_CD = S2.VPS_PORT_CD
                                        AND S1.VSL_PRE_PST_CD = 'T'
                                        AND S1.VSL_SEQ = '0'
                                        AND S2.COP_NO IN (SELECT MAX(COP_NO)
                                                            FROM SCE_COP_HDR
                                                           WHERE BKG_NO = B.BKG_NO
                                                             AND COP_STS_CD != 'X' )
                                        AND S2.ACT_CD LIKE 'F__MDO'
                                    ) AS ATD_T, 

                                       
                                    ( SELECT TO_CHAR(S2.ACT_DT,'YYYY-MM-DD hh24:mi')   
                                       FROM BKG_VVD S1, SCE_COP_DTL S2
                                       WHERE S1.BKG_NO = B.BKG_NO  
                                        AND S1.VSL_CD = S2.VSL_CD
                                        AND S1.SKD_VOY_NO = S2.SKD_VOY_NO
                                        AND S1.SKD_DIR_CD = S2.SKD_DIR_CD
                                        AND S1.POD_CD = S2.VPS_PORT_CD
                                        AND S1.VSL_PRE_PST_CD||S1.VSL_SEQ = (SELECT MAX(VSL_PRE_PST_CD||VSL_SEQ)
                                                                               FROM bkg_vvd
                                                                              WHERE BKG_NO = B.BKG_NO)
                                                                                AND S2.COP_NO IN ( SELECT MAX(COP_NO)
                                                                                                     FROM SCE_COP_HDR
                                                                                                    WHERE BKG_NO = B.BKG_NO
                                                                                                      AND COP_STS_CD != 'X' )
                                        AND S2.ACT_CD LIKE 'F__MAD'
                                    )AS ATA,

                                     
                                    ( SELECT TO_CHAR(S2.ACT_DT,'YYYY-MM-DD hh24:mi')   
                                       FROM BKG_VVD S1, SCE_COP_DTL S2
                                       WHERE S1.BKG_NO = B.BKG_NO  
                                        AND S1.VSL_CD = S2.VSL_CD
                                        AND S1.SKD_VOY_NO = S2.SKD_VOY_NO
                                        AND S1.SKD_DIR_CD = S2.SKD_DIR_CD
                                        AND S1.POD_CD = S2.VPS_PORT_CD
                                        AND S1.VSL_PRE_PST_CD = 'T'
                                        AND S1.VSL_SEQ = '0'
                                        AND S2.COP_NO IN ( SELECT MAX(COP_NO)
                                                             FROM SCE_COP_HDR
                                                            WHERE BKG_NO = B.BKG_NO
                                                              AND COP_STS_CD != 'X' )
                                        AND S2.ACT_CD LIKE 'F__MAD'
                                    )AS ATA_T,
 
                                       
									( 
									SELECT TO_CHAR(S2.VPS_ETA_DT, 'YYYY-MM-DD HH24:MI')
                                      FROM BKG_VVD S1, VSK_VSL_PORT_SKD S2
                                     WHERE S1.BKG_NO        = B.BKG_NO
                                       AND S1.VSL_CD       = S2.VSL_CD
                                       AND S1.SKD_VOY_NO = S2.SKD_VOY_NO
                                       AND S1.SKD_DIR_CD    = S2.SKD_DIR_CD
                                       AND S1.POL_CD       = S2.VPS_PORT_CD
                                       AND S1.POL_CLPT_IND_SEQ = S2.CLPT_IND_SEQ
									   AND ( S1.BKG_NO, S1.VSL_PRE_PST_CD, S1.VSL_SEQ ) IN (
                                         SELECT BKG_NO, SUBSTR(MAX(VSL_PRE_PST_CD||VSL_SEQ),1,1), SUBSTR(MAX(VSL_PRE_PST_CD||VSL_SEQ),2,1) 
                                           FROM BKG_VVD
                                          WHERE BKG_NO = S1.BKG_NO
                                          GROUP BY BKG_NO ) 
                                    ) AS F_POL_ETA,
                                        
                                    (
									SELECT TO_CHAR(S2.VPS_ETD_DT, 'YYYY-MM-DD HH24:MI')
                                      FROM BKG_VVD S1, VSK_VSL_PORT_SKD S2
                                     WHERE S1.BKG_NO        = B.BKG_NO
                                       AND S1.VSL_CD        = S2.VSL_CD
                                       AND S1.SKD_VOY_NO = S2.SKD_VOY_NO
                                       AND S1.SKD_DIR_CD    = S2.SKD_DIR_CD
                                       AND S1.POL_CD       = S2.VPS_PORT_CD
                                       AND S1.POL_CLPT_IND_SEQ = S2.CLPT_IND_SEQ
									   AND ( S1.BKG_NO, S1.VSL_PRE_PST_CD, S1.VSL_SEQ ) IN (
                                         SELECT BKG_NO, SUBSTR(MAX(VSL_PRE_PST_CD||VSL_SEQ),1,1), SUBSTR(MAX(VSL_PRE_PST_CD||VSL_SEQ),2,1) 
                                           FROM BKG_VVD
                                          WHERE BKG_NO = S1.BKG_NO
                                          GROUP BY BKG_NO ) 
                                    ) AS F_POL_ETD,

                                    (
									SELECT TO_CHAR(S2.VPS_ETA_DT, 'YYYY-MM-DD HH24:MI')
                                      FROM BKG_VVD S1, VSK_VSL_PORT_SKD S2
                                     WHERE S1.BKG_NO        =  B.BKG_NO
                                       AND S1.VSL_CD        = S2.VSL_CD
                                       AND S1.SKD_VOY_NO = S2.SKD_VOY_NO
                                       AND S1.SKD_DIR_CD    = S2.SKD_DIR_CD
                                       AND S1.POD_CD       = S2.VPS_PORT_CD
                                       AND S1.POD_CLPT_IND_SEQ = S2.CLPT_IND_SEQ
									   AND ( S1.BKG_NO, S1.VSL_PRE_PST_CD, S1.VSL_SEQ ) IN (
                                         SELECT BKG_NO, SUBSTR(MAX(VSL_PRE_PST_CD||VSL_SEQ),1,1), SUBSTR(MAX(VSL_PRE_PST_CD||VSL_SEQ),2,1) 
                                           FROM BKG_VVD
                                          WHERE BKG_NO = S1.BKG_NO
                                          GROUP BY BKG_NO ) 
                                    ) AS F_POD_ETA,

                                    (
									SELECT TO_CHAR(S2.VPS_ETD_DT, 'YYYY-MM-DD HH24:MI')
                                      FROM BKG_VVD S1, VSK_VSL_PORT_SKD S2
                                     WHERE S1.BKG_NO        =  B.BKG_NO
                                       AND S1.VSL_CD        = S2.VSL_CD
                                       AND S1.SKD_VOY_NO = S2.SKD_VOY_NO
                                       AND S1.SKD_DIR_CD    = S2.SKD_DIR_CD
                                       AND S1.POD_CD       = S2.VPS_PORT_CD
                                       AND S1.POD_CLPT_IND_SEQ = S2.CLPT_IND_SEQ
									   AND ( S1.BKG_NO, S1.VSL_PRE_PST_CD, S1.VSL_SEQ ) IN (
                                         SELECT BKG_NO, SUBSTR(MAX(VSL_PRE_PST_CD||VSL_SEQ),1,1), SUBSTR(MAX(VSL_PRE_PST_CD||VSL_SEQ),2,1) 
                                           FROM BKG_VVD
                                          WHERE BKG_NO = S1.BKG_NO
                                          GROUP BY BKG_NO )       
                                    ) AS F_POD_ETD,

                                    ( SELECT TO_CHAR(MIN(MAX(S2.VPS_ETA_DT)), 'YYYY-MM-DD HH24:MI')
                                      FROM BKG_VVD S1, VSK_VSL_PORT_SKD S2
                                     WHERE S1.BKG_NO        = B.BKG_NO
                                       AND S1.VSL_PRE_PST_CD        = 'T'
                                       AND S1.VSL_CD        = S2.VSL_CD
                                       AND S1.SKD_VOY_NO = S2.SKD_VOY_NO
                                       AND S1.SKD_DIR_CD    = S2.SKD_DIR_CD
                                       AND S1.POL_CD       = S2.VPS_PORT_CD
                                       AND S1.POL_CLPT_IND_SEQ = S2.CLPT_IND_SEQ
                                     GROUP BY S2.VSL_CD, S2.SKD_VOY_NO, S2.SKD_DIR_CD, S2.VPS_PORT_CD
                                    ) AS T_POL_ETA,

                                     (SELECT TO_CHAR(MIN(MIN(S2.VPS_ETD_DT)), 'YYYY-MM-DD HH24:MI')
                                      FROM BKG_VVD S1, VSK_VSL_PORT_SKD S2
                                     WHERE S1.BKG_NO        =  B.BKG_NO
                                       AND S1.VSL_PRE_PST_CD        = 'T'
                                       AND S1.VSL_CD        = S2.VSL_CD
                                       AND S1.SKD_VOY_NO = S2.SKD_VOY_NO
                                       AND S1.SKD_DIR_CD    = S2.SKD_DIR_CD
                                       AND S1.POL_CD      = S2.VPS_PORT_CD  
                                       AND S1.POL_CLPT_IND_SEQ = S2.CLPT_IND_SEQ
                                       GROUP BY S2.VSL_CD, S2.SKD_VOY_NO, S2.SKD_DIR_CD, S2.VPS_PORT_CD
                                    ) AS T_POL_ETD,

                                    (SELECT TO_CHAR(MAX(MAX(S2.VPS_ETA_DT)), 'YYYY-MM-DD HH24:MI')
                                     FROM BKG_VVD S1, VSK_VSL_PORT_SKD S2
                                     WHERE S1.BKG_NO        =  B.BKG_NO
                                       AND S1.VSL_PRE_PST_CD        = 'T'
                                       AND S1.VSL_CD        = S2.VSL_CD
                                       AND S1.SKD_VOY_NO = S2.SKD_VOY_NO
                                       AND S1.SKD_DIR_CD    = S2.SKD_DIR_CD
                                       AND S1.POD_CD       = S2.VPS_PORT_CD
                                       AND S1.POD_CLPT_IND_SEQ = S2.CLPT_IND_SEQ
                                     GROUP BY S2.VSL_CD, S2.SKD_VOY_NO, S2.SKD_DIR_CD, S2.VPS_PORT_CD
                                    ) AS T_POD_ETA, 

                                    ( SELECT TO_CHAR(MAX(MIN(S2.VPS_ETD_DT)), 'YYYY-MM-DD HH24:MI')
                                      FROM BKG_VVD S1, VSK_VSL_PORT_SKD S2
                                     WHERE S1.BKG_NO        = B.BKG_NO
                                       AND S1.VSL_PRE_PST_CD        = 'T'
                                       AND S1.VSL_CD        = S2.VSL_CD
                                       AND S1.SKD_VOY_NO = S2.SKD_VOY_NO
                                       AND S1.SKD_DIR_CD    = S2.SKD_DIR_CD
                                       AND S1.POD_CD       = S2.VPS_PORT_CD
                                       AND S1.POD_CLPT_IND_SEQ = S2.CLPT_IND_SEQ
                                     GROUP BY S2.VSL_CD, S2.SKD_VOY_NO, S2.SKD_DIR_CD, S2.VPS_PORT_CD
                                    ) AS T_POD_ETD,
                                     
                                    ( SELECT TRIM(TO_CHAR(SUM(CHG_AMT/USD_LOCL_XCH_RT) ,'99,999,999.99'))
                                        FROM BKG_CHG_RT R,
                                          GL_MON_XCH_RT A
                                        WHERE TO_CHAR(R.CRE_DT, 'YYYYMM') = A.ACCT_XCH_RT_YRMON
                                          AND A.ACCT_XCH_RT_LVL = '1'
                                          AND FRT_TERM_CD = 'P'
                                          AND R.BKG_NO = B.BKG_NO
										  AND R.CURR_CD = A.CURR_CD
										  AND R.FRT_INCL_XCLD_DIV_CD ='N'
                                    ) AS PPD_CHARGE,
                                          
                                    ( SELECT TRIM(TO_CHAR(SUM(CHG_AMT/USD_LOCL_XCH_RT) ,'99,999,999.99'))
                                        FROM BKG_CHG_RT R,
                                          GL_MON_XCH_RT A
                                        WHERE TO_CHAR(R.CRE_DT, 'YYYYMM') = A.ACCT_XCH_RT_YRMON
                                          AND A.ACCT_XCH_RT_LVL = '1'
                                          AND FRT_TERM_CD = 'C'
                                          AND R.BKG_NO = B.BKG_NO
										  AND R.CURR_CD = A.CURR_CD
										  AND R.FRT_INCL_XCLD_DIV_CD ='N'
                                    ) AS CCT_CHARGE,
                                          
                                    ( SELECT TO_CHAR(MAX(T.SND_DT), 'YYYY-MM-DD HH24:MI')
                                        FROM BKG_NTC_HIS T
                                        WHERE T.NTC_VIA_CD IN ('F','M')
                                          AND T.NTC_KND_CD ='AN'
                                          AND T.BKG_NO = B.BKG_NO
                                    ) AS AN_SEND_DT, 
                                        
                                    ( SELECT V.STE_NM 
                                      FROM MDM_location U, MDM_state V
                                      WHERE U.STE_CD    = V.STE_CD(+)
                                        AND U.cnt_cd       = V.cnt_cd
                                        AND U.loc_cd       = B.DEL_CD
                                    ) AS DEL_STATE,
                                     
                                    BKG_JOIN_FNC(CURSOR(SELECT C.CNTR_SEAL_NO
                                      FROM BKG_CNTR_SEAL_NO C
                                      WHERE 1=1
                                        AND C.CNTR_NO = CNTR.CNTR_NO
                                        AND C.BKG_NO = B.BKG_NO                   
                                    )) AS CNTR_SEAL_NO,
                                      
                                    ( SELECT CUST_REF_NO_CTNT
                                       FROM BKG_REFERENCE A
                                       WHERE A.BKG_NO = B.BKG_NO
									   AND A.BKG_REF_TP_CD = 'BKPO'
									   AND ROWNUM = 1
                                    ) AS BL_PO_NO,
                                       
                                    ( SELECT TO_CHAR(MIN(MIN(S2.VPS_ETD_DT)), 'YYYY-MM-DD HH24:MI')
                                        FROM BKG_VVD S1, VSK_VSL_PORT_SKD S2
                                        WHERE S1.BKG_NO        = B.BKG_NO
                                          AND S1.VSL_CD        = S2.VSL_CD
                                          AND S1.SKD_VOY_NO = S2.SKD_VOY_NO
                                          AND S1.SKD_DIR_CD    = S2.SKD_DIR_CD
                                          AND S1.POL_CD       = S2.VPS_PORT_CD
                                          AND S1.POL_CLPT_IND_SEQ = S2.CLPT_IND_SEQ
                                          GROUP BY S2.VSL_CD, S2.SKD_VOY_NO, S2.SKD_DIR_CD, S2.VPS_PORT_CD
                                    ) AS POL_ETD,
                                        
                                     (SELECT TO_CHAR(MAX(MAX(S2.VPS_ETA_DT)), 'YYYY-MM-DD HH24:MI')
                                       FROM BKG_VVD S1, VSK_VSL_PORT_SKD S2
                                      WHERE S1.BKG_NO        = B.BKG_NO
                                        AND S1.VSL_CD        = S2.VSL_CD
                                        AND S1.SKD_VOY_NO = S2.SKD_VOY_NO
                                        AND S1.SKD_DIR_CD    = S2.SKD_DIR_CD
                                        AND S1.POD_CD       = S2.VPS_PORT_CD
                                        AND S1.POD_CLPT_IND_SEQ = S2.CLPT_IND_SEQ
                                        GROUP BY S2.VSL_CD, S2.SKD_VOY_NO, S2.SKD_DIR_CD, S2.VPS_PORT_CD
                                    ) AS POD_ETA,
                                    
                                    (SELECT TO_CHAR(MAX(MAX(S2.VPS_ETB_DT)), 'YYYY-MM-DD HH24:MI')
                                       FROM BKG_VVD S1, VSK_VSL_PORT_SKD S2
                                      WHERE S1.BKG_NO        = B.BKG_NO
                                        AND S1.VSL_CD        = S2.VSL_CD
                                        AND S1.SKD_VOY_NO = S2.SKD_VOY_NO
                                        AND S1.SKD_DIR_CD    = S2.SKD_DIR_CD
                                        AND S1.POD_CD       = S2.VPS_PORT_CD
                                        AND S1.POD_CLPT_IND_SEQ = S2.CLPT_IND_SEQ
                                        GROUP BY S2.VSL_CD, S2.SKD_VOY_NO, S2.SKD_DIR_CD, S2.VPS_PORT_CD
                                    ) AS POD_ETB,
                                    
                                    (SELECT B.AGMT_ACT_CNT_CD||LPAD(B.AGMT_ACT_CUST_SEQ,6,'0')
                                   FROM MDM_CUSTOMER ACT_CUST
                                   WHERE ACT_CUST.CUST_CNT_CD = B.AGMT_ACT_CNT_CD
                                   AND ACT_CUST.CUST_SEQ = B.AGMT_ACT_CUST_SEQ) ACT_CUST_CODE,
                                   
                                   (SELECT ACT_CUST.CUST_LGL_ENG_NM
                                   FROM MDM_CUSTOMER ACT_CUST
                                   WHERE ACT_CUST.CUST_CNT_CD = B.AGMT_ACT_CNT_CD
                                   AND ACT_CUST.CUST_SEQ = B.AGMT_ACT_CUST_SEQ) ACT_CUST_NAME,
                                        
                                    (SELECT EQ_CTRL_OFC_CD
                                       FROM MDM_LOCATION U
									 WHERE U.LOC_CD       = B.DEL_CD
									) AS EQ_CTRL_OFC,

                                    (SELECT SO.LST_FREE_DT||','||SO.PKUP_NO||','||SO.PKUP_YD_CD||','||SO.PKUP_AVAL_DT
										FROM BKG_PKUP_NTC_PKUP_NO SO, BKG_BOOKING C, MDM_LOCATION M, SCE_COP_HDR SCA, SCE_COP_HDR SCB
										WHERE 1=1
                    					AND SCA.BKG_NO = CNTR.BKG_NO
                   						AND SCA.CNTR_NO = CNTR.CNTR_NO
                    					AND SCB.COP_STS_CD <> 'X'
                    					AND SCA.COP_STS_CD <> 'X'
                    					AND SCA.MST_COP_NO = SCB.COP_NO
                    					AND SCB.BKG_NO =  SO.BKG_NO
                    					AND SCB.CNTR_NO = SO.CNTR_NO
                    					AND C.BKG_NO = SO.BKG_NO
                    					AND C.DEL_CD = M.LOC_CD
                    					AND SO.OFC_CD = DECODE(SUBSTR(C.DEL_CD,1,2),'US','PHXSA',M.EQ_CTRL_OFC_CD) 
									) AS FREE_DT,

                                    (SELECT IBD_TRSP_ISS_DT||','||IBD_TRSP_NO
										FROM BKG_CSTMS_ADV_IBD A
										WHERE A.BL_NO = B.BL_NO
									) AS IBD_TRSP_ISS_DT,

                                    (SELECT HUB_LOC_CD
                                       FROM BKG_CSTMS_ADV_BL A
                                      WHERE A.BL_NO = B.BL_NO
										AND A.CNT_CD ='US'
                                    ) AS HUB_LOC_CD,

                                    (SELECT FRT_CLT_FLG||','||OBL_RDEM_FLG||','||TO_CHAR(CSTMS_CLR_LST_DT,'YYYY-MM-DD')||','||CSTMS_CLR_CD
										FROM BKG_CGO_RLSE A
										WHERE A.BL_NO = B.BL_NO
									) AS FRT_CLT_FLG,

                                    ( SELECT TO_CHAR(MAX(ACT_DT),'YYYY-MM-DD HH24:MI')
                                        FROM SCE_COP_DTL
                                       WHERE COP_NO = ( SELECT MAX(COP_NO) FROM SCE_COP_HDR
                                                                             WHERE BKG_NO = B.BKG_NO
                                                                 AND CNTR_NO = CNTR.CNTR_NO
                                                                 AND COP_STS_CD != 'X' )
                                                                 AND ACT_STS_MAPG_CD = 'OC'
                                                                                               ) AS CNTR_OC_DATE,

                                    ( SELECT TO_CHAR(MIN(ACT_DT),'YYYY-MM-DD HH24:MI')
                                        FROM SCE_COP_DTL
                                       WHERE COP_NO = ( SELECT MAX(COP_NO) 
                                                        FROM SCE_COP_HDR
                                                        WHERE BKG_NO = B.BKG_NO
                                                        AND CNTR_NO = CNTR.CNTR_NO
                                                        AND COP_STS_CD != 'X' )
                                        AND ACT_CD IN ('FTVMUD','FTWMUD')) AS DCHG_TS_PORT_DT,
                                                                                               
                                    (SELECT DSPO_CD 
                                       FROM BKG_CSTMS_ADV_RSLT A
                                      WHERE A.CNT_CD ='US'
                                        AND A.BL_NO = B.BL_NO
                                        AND A.CSTMS_SEQ = (SELECT MAX(CSTMS_SEQ)
                                                             FROM BKG_CSTMS_ADV_RSLT C
                                                            WHERE C.CNT_CD ='US'
                                                              AND C.BL_NO = B.BL_NO) 
                                    ) AS DSPO_CD,

                                    (SELECT CNMV_STS_CD 
                                       FROM MST_CONTAINER A
                                      WHERE A.CNTR_NO = CNTR.CNTR_NO
                                    )AS CGO_STS_CD,

                                    (SELECT TO_CHAR(MIN(MV_IC.CNMV_EVNT_DT),'YYYY-MM-DD HH24:MI')
                                      FROM CTM_MOVEMENT MV_IC
                                     WHERE MV_IC.CNTR_NO        = CNTR.CNTR_NO
                                       AND MV_IC.CNMV_CYC_NO    = CNTR.CNMV_CYC_NO
                                       AND MV_IC.MVMT_STS_CD    = 'IC'
                                       AND MV_IC.ORG_YD_CD      LIKE B.POD_CD||'%'
                                    ) AS POD_ATATIC_DT,

                                   (SELECT TO_CHAR(MIN(MV_IC.CNMV_EVNT_DT),'YYYY-MM-DD HH24:MI')
                                      FROM CTM_MOVEMENT MV_IC
                                     WHERE MV_IC.CNTR_NO        = CNTR.CNTR_NO
                                       AND MV_IC.CNMV_CYC_NO = CNTR.CNMV_CYC_NO
                                       AND MV_IC.MVMT_STS_CD        = 'IC'
                                       AND MV_IC.ORG_YD_CD      LIKE B.DEL_CD||'%'
                                    ) AS DEL_ATA,
									
									(SELECT MIN(TO_CHAR(CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI'))
									 FROM 	CTM_MOVEMENT
									 WHERE	BKG_NO IS NOT NULL
										AND CNTR_NO	= CNTR.CNTR_NO
										AND CNMV_CYC_NO = ( SELECT MAX(CNMV_CYC_NO) 
                                							FROM BKG_CONTAINER
                                  							WHERE BKG_NO = CNTR.BKG_NO
                                  							AND CNTR_NO =  CNTR.CNTR_NO )
										AND MVMT_STS_CD = 'ID' ) DEL_DT,

                                    ( SELECT TO_CHAR(MAX(ACT_DT),'YYYY-MM-DD HH24:MI')
                                        FROM SCE_COP_DTL
                                       WHERE COP_NO = ( SELECT MAX(COP_NO) FROM SCE_COP_HDR
                                                                             WHERE BKG_NO = B.BKG_NO
                                                                 AND CNTR_NO = CNTR.CNTR_NO
                                                                 AND COP_STS_CD != 'X' )
                                                                 AND ACT_STS_MAPG_CD = 'OC'
                                                                                               ) AS POR_GATE_IN_DT,

									( SELECT MIN(TO_CHAR(CNMV_EVNT_DT,'YYYY-MM-DD HH24:MI'))
										FROM CTM_MOVEMENT
									   WHERE BKG_NO IS NOT NULL
										AND CNTR_NO	= CNTR.CNTR_NO
										AND CNMV_CYC_NO = ( SELECT MAX(CNMV_CYC_NO) 
                                							FROM BKG_CONTAINER
                                  							WHERE BKG_NO = CNTR.BKG_NO
                                  							AND CNTR_NO =  CNTR.CNTR_NO )
										AND MVMT_STS_CD = 'MT'
									) MT_RETURN_DT,

                                    (SELECT NVL(DEL_ARR_DT,POD_ARR_DT)
                                       FROM BKG_ARR_NTC A
                                       WHERE A.BKG_NO = B.BKG_NO
                                    ) AS DEL_ETA_DT,
                                       
                                    ( SELECT REF_NO
                                       FROM BKG_CUSTOMER A
                                       WHERE A.BKG_NO = B.BKG_NO
                                       AND A.BKG_CUST_TP_CD ='E'
                                    ) AS EXPORT_REF_NO,

                                    (SELECT S2.YD_CSTMS_NO
                                       FROM BKG_BOOKING S1, MDM_YARD S2
                                      WHERE S1.BKG_NO        = B.BKG_NO   
                                        AND S1.POD_NOD_CD  = S2.YD_CD(+)
                                    ) AS FIRMS_CODE,  
                                     CNTR.BKG_NO   AS CBKG_NO,
                                    (
                                        SELECT TO_CHAR(MAX(
                                                           DECODE(NTC_VIA_CD,'F',NVL((SELECT XPT_DT FROM COM_FAX_SND_INFO WHERE FAX_SND_NO = SND_ID),NVL((SELECT UPD_DT FROM COM_FAX_SND_INFO WHERE FAX_SND_NO = SND_ID),SND_RQST_DT))
                                                                                ,NVL((SELECT EML_DT FROM COM_EML_SND_INFO WHERE EML_SND_NO = SND_ID),SND_RQST_DT)
                                                                 )
                                                          ),'YYYY-MM-DD HH24:MI')
                                        FROM   BKG_NTC_HIS
                                        WHERE  NTC_VIA_CD IN ('F','M')
                                        AND    NTC_KND_CD = 'BK'
                                        AND    BKG_NO = B.BKG_NO
                                    ) AS BKG_RCT_SND_DT_FAX,
								    (
                                        SELECT TO_CHAR(MAX(
                                                           DECODE(NTC_VIA_CD,'F',NVL((SELECT XPT_DT FROM COM_FAX_SND_INFO WHERE FAX_SND_NO = SND_ID),NVL((SELECT UPD_DT FROM COM_FAX_SND_INFO WHERE FAX_SND_NO = SND_ID),SND_RQST_DT))
                                                                                ,NVL((SELECT EML_DT FROM COM_EML_SND_INFO WHERE EML_SND_NO = SND_ID),SND_RQST_DT)
                                                                 )
                                                          ),'YYYY-MM-DD HH24:MI')
                                        FROM   BKG_NTC_HIS
                                        WHERE  NTC_VIA_CD IN ('F','M')
                                        AND    NTC_KND_CD = 'BL'
                                        AND    BKG_NO = B.BKG_NO
                                    ) AS DBL_SND_DT_FAX,
                                    (
                                        SELECT TO_CHAR(MAX(
                                                           DECODE(NTC_VIA_CD,'F',NVL((SELECT XPT_DT FROM COM_FAX_SND_INFO WHERE FAX_SND_NO = SND_ID),NVL((SELECT UPD_DT FROM COM_FAX_SND_INFO WHERE FAX_SND_NO = SND_ID),SND_RQST_DT))
                                                                                ,NVL((SELECT EML_DT FROM COM_EML_SND_INFO WHERE EML_SND_NO = SND_ID),SND_RQST_DT)
                                                                 )
                                                          ),'YYYY-MM-DD HH24:MI')
                                        FROM   BKG_NTC_HIS
                                        WHERE  NTC_VIA_CD IN ('F','M')
                                        AND    NTC_KND_CD = 'WB'
                                        AND    BKG_NO = B.BKG_NO
                                    ) AS WBL_SND_DT_FAX,
                                    (
                                        SELECT TO_CHAR(MAX(SND_RQST_DT), 'YYYY-MM-DD HH24:MI')
                                        FROM   BKG_NTC_HIS
                                        WHERE  NTC_VIA_CD = 'E'
                                        AND    NTC_KND_CD = 'BL'
                                        AND    BKG_NO = B.BKG_NO
                                    ) AS DBL_SND_DT_EDI,
                                    (
                                        SELECT TO_CHAR(MAX(SND_RQST_DT), 'YYYY-MM-DD HH24:MI')
                                        FROM   BKG_NTC_HIS
                                        WHERE  NTC_VIA_CD = 'E'
                                        AND    NTC_KND_CD = 'BK'
                                        AND    BKG_NO = B.BKG_NO
                                    ) AS BKG_RCT_SND_DT_EDI,
									(
										SELECT TO_CHAR(MAX(ACT_DT),'YYYY-MM-DD hh24:mi')
										FROM SCE_EDI_SND_RSLT A
										WHERE EDI_STS_CD = 'UVD'
  										AND A.BKG_NO = B.BKG_NO
  										AND A.CNTR_NO = CNTR.CNTR_NO
									) AS UVD_MAX_ACT_DT,
									(
										SELECT TO_CHAR(MAX(ACT_DT),'YYYY-MM-DD hh24:mi')
										FROM SCE_EDI_SND_RSLT A
										WHERE EDI_STS_CD = 'RLN'
  										AND A.BKG_NO = B.BKG_NO
  										AND A.CNTR_NO = CNTR.CNTR_NO
									) AS RLN_MAX_ACT_DT,
									(
										SELECT TO_CHAR(MAX(ACT_DT),'YYYY-MM-DD hh24:mi')
										FROM SCE_EDI_SND_RSLT A
										WHERE EDI_STS_CD = 'URN'
  										AND A.BKG_NO = B.BKG_NO
  										AND A.CNTR_NO = CNTR.CNTR_NO
									) AS URN_MAX_ACT_DT,
									(
										SELECT TO_CHAR(MAX(ACT_DT),'YYYY-MM-DD hh24:mi')
										FROM SCE_EDI_SND_RSLT A 
										WHERE EDI_STS_CD = 'OAN'
  										AND A.BKG_NO = B.BKG_NO
  										AND A.CNTR_NO = CNTR.CNTR_NO
									) AS OAN_MAX_ACT_DT,
									(
										SELECT TO_CHAR(MAX(ACT_DT),'YYYY-MM-DD hh24:mi')
										FROM SCE_EDI_SND_RSLT A 
										WHERE EDI_STS_CD = 'D'
  										AND A.BKG_NO = B.BKG_NO
  										AND A.CNTR_NO = CNTR.CNTR_NO
									) AS D_MAX_ACT_DT,
									NVL((
										SELECT 'Y' 
          								FROM BKG_INET_BL_PRN_AUTH A
          								WHERE BKG_NO = B.BKG_NO
          								AND DELT_FLG ='N' 
          								AND N1ST_PRN_DT IS NOT NULL
          								AND AUTH_DT = (SELECT MAX(AUTH_DT) FROM  BKG_INET_BL_PRN_AUTH WHERE BKG_NO = A.BKG_NO AND DELT_FLG ='N' AND N1ST_PRN_DT IS NOT NULL )  
        							),'N') AS WEB_PRT
									, D.FNL_DEST_NM

									/* 2014.11.20 VIP Customer Report에 Unloaded at POD / I/B Outgate item option 추가 요청 */
									,( SELECT TO_CHAR(MAX(DTL.ACT_DT),'YYYY-MM-DD HH24:MI')
                                         FROM SCE_COP_HDR HDR
                                            , SCE_COP_DTL DTL
                                        WHERE HDR.BKG_NO  = B.BKG_NO
                                          AND HDR.CNTR_NO = CNTR.CNTR_NO
                                          AND HDR.COP_NO  = DTL.COP_NO
                                          AND DTL.STND_EDI_STS_CD = 'UVD'
                                          AND HDR.COP_STS_CD <> 'X'
                                    ) AS UVD_MAX_ACT_DT2 /* Unloaded at POD(CTM) */   
								  ,( SELECT TO_CHAR(MAX(DTL.ACT_DT),'YYYY-MM-DD HH24:MI')
                                         FROM SCE_COP_HDR HDR
                                            , SCE_COP_DTL DTL
                                        WHERE HDR.BKG_NO  = B.BKG_NO
                                          AND HDR.CNTR_NO = CNTR.CNTR_NO
                                          AND HDR.COP_NO  = DTL.COP_NO
                                          AND DTL.STND_EDI_STS_CD = 'OAN'  
                                          AND HDR.COP_STS_CD <> 'X'
                                    ) AS OAN_MAX_ACT_DT2 /* IB OUTGATE(CTM) */
                                       ,TO_CHAR (OVR.PRE_ETA_DT,'YYYY-MM-DD HH24:MI')  INIT_POL_ETA_DT                                
                                       ,TO_CHAR (OVR.PRE_ETD_DT,'YYYY-MM-DD HH24:MI') INIT_POL_ETD_DT 
                                       ,TO_CHAR (OVR.PRE_BKG_POD_ETA_DT, 'YYYY-MM-DD HH24:MI') INIT_POD_ETA_DT
                                       , BR.CUST_REF_NO_CTNT LOAD_ID
									   ,CNTR.VGM_WGT AS VGM_WGT
                                       ,CNTR.VGM_WGT_UT_CD AS VGM_WGT_UT_CD
                                       ,CNTR.VGM_VRFY_SIG_CTNT AS VGM_VRFY_SIG_CTNT
                                       ,CNTR.VGM_MZD_TP_CD AS VGM_MZD_TP_CD
                                     FROM BKG_BOOKING B, BKG_CONTAINER CNTR, MDM_COMMODITY K, BKG_BL_DOC D, BKG_RATE R,
                                          BKG_VVD E, VSK_VSL_PORT_SKD F, VSK_VSL_PORT_SKD G, BKG_BL_ISS H, MDM_REP_CMDT L, BKG_REF_DTL J,
                                          BKG_CUSTOMER C , BKG_ROLL_OVR OVR
                                          ,BKG_REFERENCE BR
#if( ${gcust} != '')
                                           /* GCUST*/
                                         ,(  SELECT BKG_NO
                                             FROM   BKG_BOOKING
                                             WHERE  RFA_NO IN (  SELECT RFA_NO
                                                                 FROM   PRI_RP_HDR
                                                                 WHERE  PROP_NO IN (
                                                                                      SELECT DISTINCT PROP_NO
                                                                                      FROM   PRI_RP_MN
                                                                                      WHERE  (CTRT_CUST_CNT_CD,CTRT_CUST_SEQ ) IN (  SELECT DISTINCT CUST_CNT_CD,CUST_SEQ 
                                                                                                                                     FROM   MDM_CUSTOMER
                                                                                                                                     WHERE  CUST_GRP_ID = @[gcust]
                                                                                                                                  )

                                                                                      AND    PROP_STS_CD = 'A'
                                                                                   )
                                                              )
                                             UNION
                                             SELECT BKG_NO
                                             FROM   BKG_BOOKING
                                             WHERE  TAA_NO IN (  SELECT TAA_NO
                                                                 FROM   PRI_TAA_HDR
                                                                 WHERE  TAA_PROP_NO IN (
                                                                                          SELECT DISTINCT TAA_PROP_NO
                                                                                          FROM   PRI_TAA_MN
                                                                                          WHERE  (CTRT_CUST_CNT_CD,CTRT_CUST_SEQ ) IN (  SELECT DISTINCT CUST_CNT_CD,CUST_SEQ 
                                                                                                                                         FROM   MDM_CUSTOMER
                                                                                                                                         WHERE  CUST_GRP_ID = @[gcust]
                                                                                                                                      )
                                                                                          AND    CFM_FLG = 'Y'
                                                                                       )
                                                              )
                                             UNION
                                             SELECT BKG_NO
                                             FROM   BKG_BOOKING
                                             WHERE  SC_NO IN (  SELECT SC_NO
                                                                FROM   PRI_SP_HDR
                                                                WHERE  PROP_NO IN (
                                                                                     SELECT DISTINCT PROP_NO
                                                                                     FROM   PRI_SP_MN
                                                                                     WHERE  PROP_NO IN (
                                                                                                          SELECT DISTINCT PROP_NO
                                                                                                          FROM   PRI_SP_CTRT_PTY
                                                                                                          WHERE  (CUST_CNT_CD,CUST_SEQ ) IN (  SELECT DISTINCT CUST_CNT_CD,CUST_SEQ 
                                                                                                                                                 FROM   MDM_CUSTOMER
                                                                                                                                                WHERE  CUST_GRP_ID = @[gcust]
                                                                                                                                                      )
                                                                                                          AND    PRC_CTRT_PTY_TP_CD = 'C'
                                                                                                       )
                                                                                     AND PROP_STS_CD = 'F'
                                                                                  )
                                                             )
                                           ) GRP_CUST
#end

                                     WHERE B.BKG_STS_CD <>'X'
                                       AND B.BKG_CGO_TP_CD <>'P'
                                       AND B.BKG_NO = CNTR.BKG_NO
#if( ${gcust} != '')
                                       AND B.BKG_NO = GRP_CUST.BKG_NO
#end

                                       AND B.BKG_NO = D.BKG_NO
                                       AND B.BKG_NO = R.BKG_NO
                                       AND B.BKG_NO = E.BKG_NO
                                       AND B.BKG_NO = C.BKG_NO
                                       AND B.BKG_NO = H.BKG_NO(+)
                                       AND B.BKG_NO = J.BKG_NO(+)

                                       AND CNTR.BKG_NO = BR.BKG_NO(+) 
                                       AND BR. BKG_REF_TP_CD(+)='MSLD'
                                       AND CNTR.CNTR_NO = BR.CNTR_NO(+)

                                       AND B.CMDT_CD = K.CMDT_CD
                                       AND B.REP_CMDT_CD = L.REP_CMDT_CD
                                       AND C.BKG_CUST_TP_CD IN ('S','C','E','N','F')
                                       AND F.VSL_CD(+) = E.VSL_CD
                                       AND F.SKD_VOY_NO(+) = E.SKD_VOY_NO
                                       AND F.SKD_DIR_CD(+) = E.SKD_DIR_CD
                                       AND G.VSL_CD(+) = E.VSL_CD
                                       AND G.SKD_VOY_NO(+) = E.SKD_VOY_NO
                                       AND G.SKD_DIR_CD(+) = E.SKD_DIR_CD
                                           
                                       /* I/B O/B VPS_ETD_DT*/
			                	       #if( ${in_out_cd} == 'IN')
			                	         /* I/B VPS_ETD_DT*/
				                         #if( ${vps_eta_dt} != '')
										 AND B.POD_CD = E.POD_CD
										 AND G.VPS_PORT_CD(+) = E.POD_CD  
			                	         AND G.CLPT_IND_SEQ(+) = E.POD_CLPT_IND_SEQ 
   				                         AND G.VPS_ETA_DT >= TO_DATE(@[vps_eta_dt],'YYYY-MM-DD')
				                		 #end
					                	 #if( ${vps_etd_dt} != '')
				                         AND G.VPS_ETA_DT <= TO_DATE(@[vps_etd_dt],'YYYY-MM-DD') +0.99999
					                	 #end
                                       #else
                                         /* O/B VPS_ETD_DT*/
				                         #if( ${vps_eta_dt} != '')
										 AND B.POL_CD = E.POL_CD
										 AND F.VPS_PORT_CD(+) = E.POL_CD  
			                	         AND F.CLPT_IND_SEQ(+) = E.POL_CLPT_IND_SEQ 
   				                         AND F.VPS_ETD_DT >= TO_DATE(@[vps_eta_dt],'YYYY-MM-DD')
					                     #end
						                 #if( ${vps_etd_dt} != '')
				                         AND F.VPS_ETD_DT <= TO_DATE(@[vps_etd_dt],'YYYY-MM-DD') +0.99999
						                 #end
                                       #end



                                                                  
                                       /* VVD_CD CRWI0142E AEF58888*/
				                       #if( ${vvd_cd} != '')
                                       AND B.VSL_CD     = SUBSTR(@[vvd_cd], 1, 4)
                                       AND B.SKD_VOY_NO = SUBSTR(@[vvd_cd], 5, 4)
                                       AND B.SKD_DIR_CD = SUBSTR(@[vvd_cd], 9, 1)       
				                       #end
                                                         
                                         
                                       /* POL_CD*/
                				       #if( ${pol_cd} != '')
                                       AND B.POL_CD LIKE @[pol_cd]||'%'
				                       #end
                                       
                                       /* POL_YARD_CD */
                				       #if( ${pol_yard_cd} != '')
                                       AND SUBSTR(B.POL_NOD_CD, -2) = @[pol_yard_cd]
                				       #end
                                        
                                       /* POD_CD*/
				                       #if( ${pod_cd} != '')
                                       AND B.POD_CD LIKE @[pod_cd]||'%'
                				       #end
                                                       
                                       /* POD_YARD_CD */
                				       #if( ${pod_yard_cd} != '')
                                       AND SUBSTR(B.POD_NOD_CD, -2) = @[pod_yard_cd]
                				       #end
                                        
                                       /* POR_CD*/
                				       #if( ${por_cd} != '')
                                       AND B.POR_CD LIKE @[por_cd]||'%'
                                       #end

                                       /* DEL_CD*/
				                       #if( ${del_cd} != '')
                                       AND B.DEL_CD LIKE @[del_cd]||'%'
                				       #end
                                       
                                       #if( ${sc_no} != '' || ${rfa_no} != '' || ${taa_no} != '' )
                                       AND (     1 = 0
                                             /* SC_NO*/
                                             #if( ${sc_no} != '')
                                             OR  B.SC_NO = @[sc_no]
                                             #end
                                               
                                             /* RFA_NO*/
                                             #if( ${rfa_no} != '')
                                             OR  B.RFA_NO = @[rfa_no]
                                             #end
                                               
                                             /* TAA_NO*/
                                             #if( ${taa_no} != '')
                                             OR  B.TAA_NO = @[taa_no]
                                             #end
                                       
                                           )
                                       #end

       
                                       /* CUST_TP_CD*/
                				       #if( ${cust_tp_cd} != '')
                				       AND C.BKG_CUST_TP_CD IN (${cust_tp_cd})
				                       #end

				                       /* CUST_CNT_CD */
				                       #if( ${cust_cnt_cd} != '')
                                       AND C.CUST_CNT_CD = @[cust_cnt_cd]
				                       #end

                                       /* CUST_SEQ */
				                       #if( ${cust_seq} != '')
                                       AND C.CUST_SEQ = @[cust_seq]
				                       #end

                                       /* CUST_NM */
				                       #if( ${cust_nm} != '')
                                       AND C.CUST_NM LIKE '%'||@[cust_nm]||'%'
				                       #end

				                       /* EDI ID */
				                       #if( ${edi_id} != '')
										AND EXISTS ( SELECT 'Y'
                                                 FROM EDI_GROUP AA, EDI_GRP_CUST BB
                                                WHERE AA.EDI_GRP_CD = BB.EDI_GRP_CD
                                                  AND AA.DELT_FLG ='N'
                                                  AND AA.EDI_GRP_CD = @[edi_id]
                                                  AND AA.CO_DIV_CD = BB.CO_DIV_CD
                                                  AND AA.CO_DIV_CD ='SML'
                                                  AND ( DECODE(BB.BKG_CTRT_DIV_CD,'1',SC_NO)  IN (B.SC_NO,B.RFA_NO)
                                                        OR DECODE(BB.BKG_CTRT_DIV_CD,'1',NULL,BB.CUST_CNT_CD||BB.CUST_SEQ )  = C.CUST_CNT_CD||C.CUST_SEQ 
                                                      )
                                                  )
				                       #end
                                       
                                       /* A/Customer */
				                       #if( ${agmt_act_cnt_cd} != '' )
                                        AND B.AGMT_ACT_CNT_CD = @[agmt_act_cnt_cd]
                                       #end
                                       #if( ${agmt_act_cust_seq} != '' )
                                        AND B.AGMT_ACT_CUST_SEQ = TO_NUMBER(@[agmt_act_cust_seq])
                                       #end

										/* CHM-201639822 WMS Multi PO 옵션 2016-01-15  */
				                       #if( ${wms_multi_po} != '' )
										AND EXISTS ( SELECT 'Y'
										               FROM BKG_BL_MK_DESC MK
										              WHERE MK.BKG_NO = B.BKG_NO
										                AND (   INSTR(MK.CMDT_DESC,'PO NO',1,2)                 > 0
										                     OR INSTR(MK.CMDT_DESC,'PO#',1,2)                   > 0 
										                     OR INSTR(MK.CMDT_DESC,'PURCHASE ORDER NO',1,2)     > 0 
										                     OR INSTR(MK.CMDT_DESC,'PURCHASE ORDER NUMBER',1,2) > 0 
										                     OR INSTR(MK.CMDT_DESC,'REPACK',1,1)                > 0
										                     )                        
										             )
									
									   #end
                                       AND B.BKG_NO = OVR.BKG_NO
                                       AND OVR.ROLL_OVR_SEQ = (SELECT MAX(ROLL_OVR_SEQ) FROM BKG_ROLL_OVR RR WHERE B.BKG_NO = RR.BKG_NO )
                                       
                                       /* CHM-201640759 Split01-VIP Report에 조회 옵션 추가 _initial POL ETAPOL ETDPOD ETA_ BKG 생성 시점 및 VVD 변경 시점 기준*/
									   #if( ${init_dt_fm} != '' && ${init_dt_to} != '')
                                         #if( ${init_pol_pod_cd} =='A') --PRE_ETD_DT NEW_ETD_DT NEW_ETA_DT NEW_BKG_POD_ETA_DT

                                            AND PRE_ETA_DT >= TO_DATE(@[init_dt_fm], 'YYYY-MM-DD')
                                            AND PRE_ETA_DT <= TO_DATE(@[init_dt_to], 'YYYY-MM-DD') +0.99999 
                                         #end
                                         #if( ${init_pol_pod_cd} =='B') --PRE_ETD_DT NEW_ETD_DT NEW_ETA_DT NEW_BKG_POD_ETA_DT

                                            AND PRE_ETD_DT >= TO_DATE(@[init_dt_fm], 'YYYY-MM-DD')
                                            AND PRE_ETD_DT <= TO_DATE(@[init_dt_to], 'YYYY-MM-DD') +0.99999 
                                         #end
                                         #if( ${init_pol_pod_cd} =='C') --PRE_ETD_DT NEW_ETD_DT NEW_ETA_DT NEW_BKG_POD_ETA_DT

                                            AND PRE_BKG_POD_ETA_DT >= TO_DATE(@[init_dt_fm], 'YYYY-MM-DD')
                                            AND PRE_BKG_POD_ETA_DT <= TO_DATE(@[init_dt_to], 'YYYY-MM-DD') +0.99999 
                                         #end
                                       #end	
                                   GROUP BY   B.BKG_NO,
                                    CNTR.CNTR_NO,
                                    CNMV_CYC_NO,
                                    B.BKG_OFC_CD,
                                    B.BL_NO,
                                    B.VSL_CD ,
                                    B.SKD_VOY_NO ,
                                    B.SKD_DIR_CD ,
                                    B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD,
                                    B.POR_CD,
                                    B.POL_CD,
                                    B.POD_CD,
                                    B.DEL_CD,
                                    B.XTER_RMK,
                                    B.PRE_RLY_PORT_CD,
                                    B.PST_RLY_PORT_CD,
                                    B.CMDT_CD,
                                    D.PCK_QTY,
                                    D.PCK_TP_CD,    
                                    B.REP_CMDT_CD,
                                    L.REP_CMDT_NM, 
                                    D.ACT_WGT,   
                                    D.MEAS_QTY,  
                                    B.RCV_TERM_CD,
                                    B.DE_TERM_CD,
                                    B.SLAN_CD,
                                    B.SCAC_CD,
                                    H.OBL_ISS_OFC_CD, 
                                    H.OBL_ISS_DT,
                                    D.BL_OBRD_DT,
									B.SVC_SCP_CD,
                                    D.VSL_NM,
                                    D.POR_NM,
                                    D.POL_NM,
                                    D.POD_NM,
                                    D.DEL_NM,
                                    B.SC_NO,
                                    R.PPD_RCV_OFC_CD,  
                                    R.CLT_OFC_CD,
                                    D.CSTMS_DESC,
                                    B.USA_CSTMS_FILE_CD,
                                    B.CND_CSTMS_FILE_CD,  
                                    CNTR.CNTR_WGT,
                                    CNTR.WGT_UT_CD,
                                    CNTR.MEAS_QTY,
                                    CNTR.MEAS_UT_CD,
                                    CNTR.CNTR_TPSZ_CD,
                                    CNTR.CNTR_VOL_QTY,
                                    CNTR.DCGO_FLG,
                                    CNTR.BB_CGO_FLG,
                                    CNTR.AWK_CGO_FLG,
                                    CNTR.RC_FLG,
                                    CNTR.RD_CGO_FLG,
                                    CNTR.SOC_FLG,
                                    CNTR.PCK_QTY,
                                    CNTR.PCK_TP_CD,
                                    CNTR.CNTR_PRT_FLG,
                                    CNTR.PO_NO,
                                    J.DE_NO,
                                    J.PRT_NO,
                                    D.BDR_FLG,
                                    B.POR_CD,
                                    B.DEL_CD,
                                    R.CGO_RCV_DT,
                                    B.AGMT_ACT_CNT_CD,
                                    B.AGMT_ACT_CUST_SEQ,
									CNTR.BKG_NO, D.MEAS_QTY, D.MEAS_UT_CD, D.WGT_UT_CD, B.RFA_NO
									,D.FNL_DEST_NM
	                                ,OVR.PRE_ETA_DT                                  
                                    ,OVR.PRE_ETD_DT --WORK PRE_VSL_CD PRE_ETD_DT  PRE_ETA_DT PRE_BKG_POD_ETA_DT
                                    ,OVR.PRE_BKG_POD_ETA_DT
                                    ,CUST_REF_NO_CTNT
									,CNTR.VGM_WGT
                                    ,CNTR.VGM_WGT_UT_CD
                                    ,CNTR.VGM_VRFY_SIG_CTNT
                                    ,CNTR.VGM_MZD_TP_CD
                            ) X
                    WHERE 1=1
                    /* EQ Office*/ 
                    #if( ${eq_ofc_cd} != '')
                    AND X.EQ_CTRL_OFC = @[eq_ofc_cd]
                    #end
                    
                    #if (${sp_cargo_rf} != '' || ${sp_cargo_dg} != '' || ${sp_cargo_ak} != '' || ${sp_cargo_bb} != '' )
					AND X.SPC_CGO IN (@[sp_cargo_rf], @[sp_cargo_dg], @[sp_cargo_ak], @[sp_cargo_bb])					
				    #end
 
                    ORDER BY BKG_NO
                  ) Y
                ) Y1
            ) Y2
       ) Z
) XX
) YY
WHERE RNUM BETWEEN NVL(@[rows_per_page],50) * (NVL(@[curr_page],1) - 1) + 1
           AND     NVL(@[rows_per_page],50) *  NVL(@[curr_page],1)			]]></sql>
			<params>
				<param name="scac_flg" type="12" value="" out="N"/>
				<param name="in_out_cd" type="12" value="" out="N"/>
				<param name="gcust" type="12" value="" out="N"/>
				<param name="vps_eta_dt" type="12" value="20100201" out="N"/>
				<param name="vps_etd_dt" type="12" value="20100205" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pol_yard_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="pod_yard_cd" type="12" value="" out="N"/>
				<param name="por_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="AWE22791" out="N"/>
				<param name="rfa_no" type="12" value="" out="N"/>
				<param name="taa_no" type="12" value="" out="N"/>
				<param name="cust_cnt_cd" type="12" value="" out="N"/>
				<param name="cust_seq" type="12" value="" out="N"/>
				<param name="cust_nm" type="12" value="" out="N"/>
				<param name="edi_id" type="12" value="" out="N"/>
				<param name="agmt_act_cnt_cd" type="12" value="" out="N"/>
				<param name="agmt_act_cust_seq" type="12" value="" out="N"/>
				<param name="init_dt_fm" type="12" value="" out="N"/>
				<param name="init_dt_to" type="12" value="" out="N"/>
				<param name="eq_ofc_cd" type="12" value="" out="N"/>
				<param name="sp_cargo_rf" type="12" value="" out="N"/>
				<param name="sp_cargo_dg" type="12" value="" out="N"/>
				<param name="sp_cargo_ak" type="12" value="" out="N"/>
				<param name="sp_cargo_bb" type="12" value="" out="N"/>
				<param name="rows_per_page" type="12" value="" out="N"/>
				<param name="curr_page" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
