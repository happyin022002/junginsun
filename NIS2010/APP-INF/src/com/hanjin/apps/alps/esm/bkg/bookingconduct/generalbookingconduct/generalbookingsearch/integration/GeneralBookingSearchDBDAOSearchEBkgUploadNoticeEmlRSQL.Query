<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingSearchDBDAOSearchEBkgUploadNoticeEmlRSQL">
			<desc><![CDATA[e-Booking Upload Notice 메일 수신인을 조회한다.
WEB을 통해 자동생성된 BKG 중 Auto Notification에 체크되어있고  
Standby:F, NoRate:R인 Booking에 대해 Upload(Receipt) Notice를 전송해준다.]]></desc>
			<sql><![CDATA[
SELECT CNTC_PSON_EML
FROM BKG_BOOKING B, BKG_CNTC_PSON C
WHERE B.BKG_NO = @[bkg_no]
AND B.CRE_USR_ID = 'HOMEPAGE'        -- WEB Auto Creation 된 BKG
AND B.XTER_RQST_AUTO_NTC_FLG = 'Y'   -- Auto Notification 에 체크
AND NVL(B.ALOC_STS_CD,'X') <> 'S'    -- Stanby 'F' 
AND NVL(B.NON_RT_STS_CD,'X') <> 'R'  -- No Rate 'F'
AND B.BKG_NO = C.BKG_NO
AND C.BKG_CNTC_PSON_TP_CD = 'BK'
AND C.CNTC_PSON_EML IS NOT NULL
AND INSTR(C.CNTC_PSON_EML,'@') > 0
AND 0 = (SELECT COUNT(*)
         FROM BKG_NTC_HIS
         WHERE BKG_NO = B.BKG_NO
         AND NTC_KND_CD = 'BK'
         AND NTC_VIA_CD = 'M')			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
