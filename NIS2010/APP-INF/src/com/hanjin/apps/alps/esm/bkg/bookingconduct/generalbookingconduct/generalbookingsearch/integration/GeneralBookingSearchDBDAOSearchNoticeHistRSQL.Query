<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingSearchDBDAOSearchNoticeHistRSQL">
			<desc><![CDATA[GeneralBookingSearchDBDAOSearchNoticeHistRSQL]]></desc>
			<sql><![CDATA[
SELECT (SELECT INTG_CD_VAL_DP_DESC 
          FROM COM_INTG_CD_DTL 
         WHERE INTG_CD_ID = 'CD01552' 
           AND INTG_CD_VAL_CTNT = ORD.KIND) ITEM
        , FROM1 FRM_A
        , FROM2 FRM_B
        , TO1 TO_A
        , TO2 TO_B
        , VIA
        , TO_CHAR(SEND.SEND_DT, 'YYYY-MM-DD HH24:MI') CRE_DT
        , USR_NM CRE_USR_ID
        , OFFICE 
  FROM  ( SELECT 'BR' KIND
		         , MST.XTER_SNDR_ID FROM1
	    	     , '' FROM2
		         , NULL TO1
	    	     , NULL TO2
	        	 , BK.XTER_BKG_RQST_CD VIA
		         , MST.RQST_DT          SEND_DT
	    	     , NULL USR_NM
	        	 , NULL OFFICE
 		    FROM BKG_BOOKING BK, BKG_XTER_RQST_MST MST
 		   WHERE BK.BKG_NO     = MST.BKG_NO
    		 AND BK.BKG_NO     = @[bkg_no]
			 AND MST.BKG_UPLD_STS_CD = 'F'
	    	 AND MST.DOC_TP_CD = 'B'
         UNION 
         SELECT 'SI' KIND
                 , MST.XTER_SNDR_ID FROM1
    	     	 , '' FROM2
                 , NULL TO1
                 , NULL TO2
                 , BK.XTER_SI_CD VIA
                 , MST.RQST_DT    SEND_DT
                 , NULL USR_NM
                 , NULL OFFICE
           FROM BKG_BOOKING BK
              , BKG_XTER_RQST_MST MST
          WHERE BK.BKG_NO       = MST.BKG_NO
            AND BK.BKG_NO       = @[bkg_no]
			 AND MST.BKG_UPLD_STS_CD = 'F'
            AND MST.DOC_TP_CD   = 'S'
         UNION  
         SELECT NTC_KND_CD KIND
                 , NULL FROM1
                 , NULL FROM2
                 , DECODE(NTC_VIA_CD, 'F', NTC_FAX_NO, 'M', NTC_EML, EDI_ID) TO1
                 , DECODE(NTC_VIA_CD, 'E', ntc.esvc_grp_cd, NULL) TO2 
                 , DECODE(NTC_VIA_CD, 'F', 'FAX', 'M', 'EMAIL', 'E', 'EDI')   VIA
                 , CASE WHEN NTC_KND_CD IN ('UR','DR') AND SND_USR_ID = 'SYSTEM' THEN GLOBALDATE_PKG.TIME_CONV_FNC('KRSEL',SND_RQST_DT,BKG.POL_CD)
                        ELSE NVL(SND_RQST_DT, SND_DT) 
                        END AS SEND_DT
                 , NVL((SELECT USR_NM FROM COM_USER WHERE USR_ID = NTC.SND_USR_ID), NTC.SND_USR_ID) USR_NM
                 , SND_OFC_CD OFFICE
           FROM BKG_NTC_HIS NTC
               ,BKG_BOOKING BKG
          WHERE NTC.BKG_NO = @[bkg_no]
            AND NTC.BKG_NO = BKG.BKG_NO) SEND
     , (SELECT 1 NO, 'BR' KIND FROM DUAL
        UNION ALL
        SELECT 2 NO, 'CN' KIND FROM DUAL
        UNION ALL
        SELECT 3 NO, 'BK' KIND FROM DUAL
        UNION ALL
        SELECT 4 NO, 'BT' KIND FROM DUAL
        UNION ALL
        SELECT 5 NO, 'SI' KIND FROM DUAL
        UNION ALL
        SELECT 6 NO, 'BL' KIND FROM DUAL
        UNION ALL
        SELECT 7 NO, 'WB' KIND FROM DUAL
        UNION ALL
        SELECT 8 NO, 'IB' KIND FROM DUAL
        UNION ALL
        SELECT 9 NO, 'SR' KIND FROM DUAL 
		UNION ALL
		SELECT 10 NO, 'SS' KIND FROM DUAL
		UNION ALL
		SELECT 11 NO, 'RR' KIND FROM DUAL
		UNION ALL
		SELECT 12 NO, 'SB' KIND FROM DUAL
		UNION ALL
		SELECT 13 NO, 'DR' KIND FROM DUAL
        UNION ALL
		SELECT 14 NO, 'UR' KIND FROM DUAL
		UNION ALL
		SELECT 15 NO, 'NR' KIND FROM DUAL
		UNION ALL
		SELECT 16 NO, 'RP' KIND FROM DUAL
		UNION ALL
		SELECT 17 NO, 'RC' KIND FROM DUAL
		UNION ALL
		SELECT 18 NO, 'OM' KIND FROM DUAL
		UNION ALL
		SELECT 19 NO, 'RO' KIND FROM DUAL
		UNION ALL
		SELECT 20 NO, 'VM' KIND FROM DUAL
		UNION ALL
		SELECT 21 NO, 'VC' KIND FROM DUAL
		UNION ALL
		SELECT 22 NO, 'VR' KIND FROM DUAL
		UNION ALL
		SELECT 23 NO, 'VI' KIND FROM DUAL
        ) ORD
 WHERE ORD.KIND = SEND.KIND(+)
 ORDER BY ORD.NO, SEND.SEND_DT			]]></sql>
			<params>
				<param name="bkg_no" type="12" value=" " out="N"/>
			</params>
		</query>
	</querys>
</sqls>
