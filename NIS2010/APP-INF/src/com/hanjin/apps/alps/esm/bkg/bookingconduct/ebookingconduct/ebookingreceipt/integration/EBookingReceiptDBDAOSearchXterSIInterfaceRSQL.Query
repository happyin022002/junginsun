<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EBookingReceiptDBDAOSearchXterSIInterfaceRSQL">
			<desc><![CDATA[external request 처리를 위해 external rqst의 Booking 정보를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT DECODE(NVL(M.ESTM_WGT,0),0, BL.ACT_WGT, M.ESTM_WGT) ACT_WGT,
       B.ADV_SHTG_CD,
       B.ALOC_STS_CD,
       B.AWK_CGO_FLG AWK_CGO_FLG,
       B.AWK_CGO_FLG AWK_CGO_FLG_OLD,
       B.BB_CGO_FLG BB_CGO_FLG,
       B.BB_CGO_FLG BB_CGO_FLG_OLD,
       NVL(BL.BDR_FLG, 'N') BDR_FLG,
       B.BKG_ALOC_TP_CD,  
       NVL(B.BKG_CGO_TP_CD,'F') BKG_CGO_TP_CD,
       BC.CNTC_PSON_EML BKG_CNTC_PSON_EML,
       BC.CNTC_PSON_FAX_NO BKG_CNTC_PSON_FAX_NO,
       BC.CNTC_PSON_MPHN_NO BKG_CNTC_PSON_MPHN_NO,
       BC.CNTC_PSON_NM BKG_CNTC_PSON_NM,
       BC.CNTC_PSON_PHN_NO BKG_CNTC_PSON_PHN_NO,
       NVL(M.SI_CNTC_EML, SC.CNTC_PSON_EML) SI_CNTC_PSON_EML,
       NVL(M.SI_CNTC_FAX_AREA_NO||M.SI_CNTC_FAX_NO, SC.CNTC_PSON_FAX_NO) SI_CNTC_PSON_FAX_NO,
       NVL(M.SI_CNTC_MPHN_NO, SC.CNTC_PSON_MPHN_NO) SI_CNTC_PSON_MPHN_NO,
       NVL(M.SI_CNTC_NM, SC.CNTC_PSON_NM) SI_CNTC_PSON_NM,
       NVL(M.SI_CNTC_PHN_AREA_NO||M.SI_CNTC_PHN_NO||M.SI_CNTC_XTN_PHN_NO, SC.CNTC_PSON_PHN_NO) SI_CNTC_PSON_PHN_NO,
       B.DEL_CD BKG_DEL_CD,
       SUBSTR(B.DEL_NOD_CD, 6, 2) BKG_DEL_YD_CD,
       M.BKG_NO,
       B.BKG_OFC_CD BKG_OFC_CD,
       B.POD_CD BKG_POD_CD,
       SUBSTR(B.POD_NOD_CD, 6, 2) BKG_POD_YD_CD,
       B.POL_CD BKG_POL_CD,       
       SUBSTR(B.POL_NOD_CD, 6, 2) BKG_POL_YD_CD,
       B.POR_CD BKG_POR_CD,
       SUBSTR(B.POR_NOD_CD, 6, 2) BKG_POR_YD_CD,
       B.BKG_STS_CD,
       B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD BKG_TRUNK_VVD,
       B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD BKG_TRUNK_VVD_OLD,
       B.BLCK_STWG_CD,
       B.BL_NO||NVL(B.BL_TP_CD, DECODE(I.OBL_SRND_FLG, 'Y', 'S', null)) BL_NO,
       BL.CORR_USR_ID CA_USER,
       B.CMDT_CD CMDT_CD,
       B.CMDT_CD CMDT_CD_OLD,
       (SELECT CMDT.CMDT_NM FROM MDM_COMMODITY CMDT WHERE CMDT.CMDT_CD =B.CMDT_CD) CMDT_DESC,
       B.CND_CSTMS_FILE_CD CND_CSTMS_FILE_CD,
       NVL((SELECT 'Y' FROM BKG_XTER_CNTR CNTR WHERE CNTR.XTER_SNDR_ID = M.XTER_SNDR_ID AND CNTR.XTER_RQST_NO = M.XTER_RQST_NO AND ROWNUM = 1),
            NVL((SELECT 'Y' FROM BKG_CONTAINER CNTR WHERE CNTR.BKG_NO = M.BKG_NO AND ROWNUM = 1), 'N')) CNTR_FLG,
       B.CRR_SOC_FLG,
       B.CTRT_OFC_CD CTRT_OFC_CD,
       B.CTRT_SREP_CD CTRT_SREP_CD,
       B.DCGO_FLG DCGO_FLG,
       B.DCGO_FLG DCGO_FLG_OLD,
       TO_CHAR(B.DE_DUE_DT, 'YYYY-MM-DD') DE_DUE_DT,
       TO_CHAR(B.DE_DUE_DT, 'YYYY-MM-DD') DE_DUE_DT_OLD,
       B.DEL_CD DEL_CD_OLD,
       NVL(M.DEL_NM, BL.DEL_NM) DEL_NM,
       SUBSTR(B.DEL_NOD_CD, 6, 2) DEL_YD_CD_OLD,
       B.DEST_SCONTI_CD,
       B.DEST_TRNS_MOD_CD,
       B.DEST_TRNS_SVC_MOD_CD,
       B.DE_TERM_CD DE_TERM_CD,
       B.DE_TERM_CD DE_TERM_CD_OLD,
       DECODE(B.AWK_CGO_FLG, 'Y', 'Y', NULL) AWK_FLG,
       DECODE(B.BB_CGO_FLG, 'Y', 'Y', NULL) BB_FLG,
       DECODE(B.DCGO_FLG, 'Y', 'Y', NULL) DG_FLG,
       B.DOC_USR_ID,
       NVL(B.EDI_HLD_FLG, 'N') EDI_HLD_FLG,
       CASE WHEN (SELECT SUM(EQ_SUBST_CGO_QTY)
                  FROM BKG_QUANTITY Q
                  WHERE Q.BKG_NO = M.BKG_NO) > 0 THEN 'Y'
            ELSE 'N'
       END EQ_SUBST_FLG,
       B.FD_GRD_FLG,
       B.FLEX_HGT_FLG AS FLEX_HGT_FLG,
       (SELECT CUST_REF_NO_CTNT
        FROM BKG_REFERENCE R
        WHERE R.BKG_REF_TP_CD 	= 'FMCN'
        AND R.BKG_NO 			= B.BKG_NO
        AND ROWNUM = 1) FMC_NO,
       NVL(M.FNL_DEST_NM, BL.FNL_DEST_NM) FNL_DEST_NM,
       B.FULL_PKUP_YD_CD,
       B.FULL_RTN_YD_CD,
       B.FULL_RTN_YD_CD	FULL_RTN_YD_CD_OLD,
       B.FUMG_CNTC_PHN_NO,
       B.FUMG_CNTC_PSON_NM,
       B.FUMG_DIFF_RMK,
       DECODE(NVL(B.FUMG_LOC_CD, 'NULL'), 'NULL', 'N', 'Y') FUMG_FLG,
       B.FUMG_LOC_CD,
       B.HNGR_FLG,
       NVL(B.INDIV_PSON_FLG, 'N') INDIV_PSON_FLG,
       B.INTER_RMK,
       CASE WHEN 0 < (SELECT COUNT(CHG_CD) FROM BKG_CHG_RT WHERE BKG_NO = M.BKG_NO) THEN 'Y'
            ELSE 'N'
       END IS_RATED_FLG,
       NVL(M.KR_CSTMS_CUST_TP_CD,B.KR_CSTMS_CUST_TP_CD) KR_CSTMS_CUST_TP_CD,
       TO_CHAR(LODG_DUE_DT, 'YYYY-MM-DD') LODG_DUE_DT,
       TO_CHAR(LODG_DUE_DT, 'YYYY-MM-DD') LODG_DUE_DT_OLD,
       NVL(B.MNL_BKG_NO_FLG, 'N') MNL_BKG_NO_FLG,
       TO_CHAR( B.MTY_DOR_ARR_DT, 'YYYY-MM-DD') MTY_DOR_ARR_DT,
       TO_CHAR(B.MTY_DOR_ARR_DT, 'YYYY-MM-DD') MTY_DOR_ARR_DT_OLD,
       TO_CHAR(B.MTY_PKUP_DT, 'YYYY-MM-DD') MTY_PKUP_DT,
       B.MTY_PKUP_DT MTY_PKUP_DT_OLD,
       B.MTY_PKUP_YD_CD MTY_PKUP_YD_CD,
       B.MTY_PKUP_YD_CD MTY_PKUP_YD_CD_OLD,
       B.OB_SREP_CD ,
       B.OB_SLS_OFC_CD,
       B.BKG_NO OLD_BKG_NO,
       B.ORG_SCONTI_CD,
       B.ORG_TRNS_MOD_CD,
       B.ORG_TRNS_SVC_MOD_CD,
       NVL((SELECT 'Y'
            FROM BKG_BOOKING BK1, BKG_CONTAINER CNTR1,
                 BKG_BOOKING BK2, BKG_CONTAINER CNTR2
            WHERE BK1.BKG_NO        = CNTR1.BKG_NO 
            AND BK2.BKG_NO        = CNTR2.BKG_NO
            AND BK1.BKG_NO        <> BK2.BKG_NO   --다른 BKG
            AND CNTR1.CNTR_NO     = CNTR2.CNTR_NO --같은 CNTR
            AND BK1.BKG_CGO_TP_CD = BK2.BKG_CGO_TP_CD
            AND BK1.POL_CD        = BK2.POL_CD
            AND BK1.POD_CD        = BK2.POD_CD
            AND BK1.VSL_CD        = BK2.VSL_CD
            AND BK1.SKD_VOY_NO    = BK2.SKD_VOY_NO
            AND BK1.SKD_DIR_CD    = BK2.SKD_DIR_CD
            AND CNTR1.CNTR_PRT_FLG= 'Y'
            AND CNTR2.CNTR_PRT_FLG= 'Y'
            AND BK1.BKG_STS_CD    <> 'X'
            AND BK2.BKG_STS_CD    <> 'X'
            AND BK1.BKG_NO        = M.BKG_NO
            AND ROWNUM = 1), 'N') PARTIAL_VVD_ASSIGN_FLG,
       B.PCTL_NO,
       B.PCTL_NO PCTL_NO_OLD,
       B.POD_CD POD_CD_OLD,
       NVL(M.POD_NM, BL.POD_NM) POD_NM,
       SUBSTR(B.POD_NOD_CD, 6, 2) POD_YD_CD_OLD,
       B.POL_CD	POL_CD_OLD,
       NVL(M.POL_NM, BL.POL_NM) POL_NM,
       SUBSTR(B.POL_NOD_CD, 6, 2) POL_YD_CD_OLD,
       B.POR_CD POR_CD_OLD,
       NVL(M.POR_NM, BL.POR_NM) POR_NM,
       B.PORT_SKP_FLG,
       SUBSTR(B.POR_NOD_CD, 6, 2) POR_YD_CD_OLD,
       B.PRCT_FLG,
       B.PRE_RLY_PORT_CD,
       SUBSTR(PRE.POD_YD_CD, 6, 2) PRE_RLY_PORT_YD_CD,
       PRE.VSL_CD||PRE.SKD_VOY_NO||PRE.SKD_DIR_CD PRE_VVD_CD,
       B.PST_RLY_PORT_CD,
       SUBSTR(PST.POL_YD_CD, 6, 2) PST_RLY_PORT_YD_CD,
       PST.VSL_CD||PST.SKD_VOY_NO||PST.SKD_DIR_CD PST_VVD_CD,
       B.RAIL_BLK_CD,
       B.RC_FLG RC_FLG,
       B.RC_FLG RC_FLG_OLD,
       B.RCV_TERM_CD RCV_TERM_CD,
       B.RCV_TERM_CD RCV_TERM_CD_OLD,
       NVL(B.RD_CGO_FLG, 'N') RD_CGO_FLG,
       B.REP_CMDT_CD REP_CMDT_CD,
       B.RFA_NO RFA_NO,
       B.RFA_NO RFA_NO_OLD,
       DECODE(B.RC_FLG, 'Y', 'Y', NULL) RF_FLG,
       (SELECT COUNT(1) FROM BKG_ROLL_OVR ROL WHERE ROL.BKG_NO = M.BKG_NO) ROLL_OVR_CNT,
       B.SCAC_CD SCAC_CD,
       B.SC_NO SC_NO,
       B.SC_NO SC_NO_OLD,
       NVL(S.CNT_CD, SH.CUST_CNT_CD) S_CUST_CNT_CD,
       NVL(S.CUST_SEQ, SH.CUST_SEQ) S_CUST_SEQ,
       DECODE(M.DOC_TP_CD, 'S', 'Y', 'U','Y','N') SI_FLG,
       B.SLAN_CD,
       B.SOC_FLG SOC_FLG,
       B.SPCL_HIDE_FLG,
       B.SPCL_HIDE_LNR_FLG,
       B.STOP_OFF_CNTC_PHN_NO,
       B.STOP_OFF_CNTC_PSON_NM,
       B.STOP_OFF_DIFF_RMK,
       B.STOP_OFF_LOC_CD,
       DECODE(NVL(B.STOP_OFF_LOC_CD, 'NULL'), 'NULL', 'N', 'Y') STOP_OFF_FLG,
       B.STWG_CD,
       DECODE(NVL(B.STWG_CD, 'NULL'), 'NULL', 'N', 'Y') STWG_FLG,
       B.STWG_RMK,
       B.SVC_SCP_CD,
       B.TAA_NO TAA_NO,
       B.TAA_NO TAA_NO_OLD,
       B.TWN_SO_NO TWN_SO_NO,
       B.USA_CSTMS_FILE_CD USA_CSTMS_FILE_CD,
       USR.USR_EML, 
       USR.USR_NM,
       (SELECT DECODE(COUNT(*),0,'N','Y')
        FROM BKG_HRD_CDG_CTNT
        WHERE HRD_CDG_ID = 'VEH_CMDT_FLG'
        AND ATTR_CTNT1 = B.CMDT_CD) VEH_CMDT_FLG,
       DECODE(M.DOC_TP_CD, 'B', M.XTER_RQST_VIA_CD, B.XTER_BKG_RQST_CD) XTER_BKG_RQST_CD,
       DECODE(M.DOC_TP_CD, 'B', M.XTER_RQST_NO, B.XTER_BKG_RQST_REF_NO) XTER_BKG_RQST_REF_NO,
       NVL(B.XTER_RMK||CHR(13)||CHR(10)||(CASE WHEN INSTR(M.XTER_BKG_RMK1||M.XTER_BKG_RMK2, CHR(13)||CHR(10)) = 0 
                      AND INSTR(M.XTER_BKG_RMK1||M.XTER_BKG_RMK2, CHR(10)) > 0
                      THEN REPLACE(M.XTER_BKG_RMK1||M.XTER_BKG_RMK2, CHR(10), CHR(13)||CHR(10))
                 ELSE M.XTER_BKG_RMK1||M.XTER_BKG_RMK2
            END),
            B.XTER_RMK) XTER_RMK,
       NVL(M.AUTO_EML_FLG, B.XTER_RQST_AUTO_NTC_FLG) XTER_RQST_AUTO_NTC_FLG,
       DECODE(M.DOC_TP_CD, 'S', M.XTER_RQST_VIA_CD, B.XTER_SI_CD) XTER_SI_CD,
       DECODE(M.DOC_TP_CD, 'S', M.XTER_RQST_NO, B.XTER_SI_REF_NO) XTER_SI_REF_NO,
       USR.XTN_PHN_NO
	   /************************************/
	   , DECODE(SUBSTR(M.ESTM_WGT_UT_CD,1,1),'K','KGS',M.ESTM_WGT_UT_CD) WGT_UT_CD
	   , 'Y' WEB_SVC_FLG
	   , B.NON_RT_STS_CD 
		, IDA_HLG_TP_CD
FROM BKG_XTER_RQST_MST M, BKG_XTER_CUST S, BKG_XTER_CUST E, BKG_BOOKING B, BKG_BL_DOC BL,
     BKG_CNTC_PSON BC, BKG_CNTC_PSON SC, BKG_BL_ISS I,
     BKG_VVD PRE, BKG_VVD PST, BKG_CUSTOMER SH, COM_USER USR     
WHERE M.XTER_SNDR_ID = @[xter_sndr_id]
AND M.XTER_RQST_NO = @[xter_rqst_no]
AND M.XTER_RQST_SEQ = @[xter_rqst_seq]
AND M.XTER_SNDR_ID = S.XTER_SNDR_ID(+)
AND M.XTER_RQST_NO = S.XTER_RQST_NO(+)
AND M.XTER_RQST_SEQ = S.XTER_RQST_SEQ(+)
AND 'S' = S.XTER_CUST_TP_CD(+)
AND M.XTER_SNDR_ID = E.XTER_SNDR_ID(+)
AND M.XTER_RQST_NO = E.XTER_RQST_NO(+)
AND M.XTER_RQST_SEQ = E.XTER_RQST_SEQ(+)
AND 'E' = E.XTER_CUST_TP_CD(+)
AND M.BKG_NO = B.BKG_NO(+)
AND B.BKG_NO = BL.BKG_NO(+)
AND B.BKG_NO =BC.BKG_NO(+)
AND BC.BKG_CNTC_PSON_TP_CD(+) = 'BK'
AND B.BKG_NO =SC.BKG_NO(+)
AND SC.BKG_CNTC_PSON_TP_CD(+) = 'SI'
AND B.BKG_NO = I.BKG_NO(+)
AND B.BKG_NO = PRE.BKG_NO(+)
AND 'S' = PRE.VSL_PRE_PST_CD(+)
AND B.PRE_RLY_PORT_CD= PRE.POD_CD(+)
AND B.BKG_NO = PST.BKG_NO(+)
AND B.PST_RLY_PORT_CD= PST.POL_CD(+)
AND 'U' = PST.VSL_PRE_PST_CD(+)
AND B.BKG_NO = SH.BKG_NO(+)
AND 'S' = SH.BKG_CUST_TP_CD(+)
AND UPPER(B.DOC_USR_ID) = UPPER(USR.USR_ID(+))			]]></sql>
			<params>
				<param name="xter_sndr_id" type="12" value="WEB" out="N"/>
				<param name="xter_rqst_no" type="12" value="FRA5090700003" out="N"/>
				<param name="xter_rqst_seq" type="12" value="1" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
