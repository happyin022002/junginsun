<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingSearchDBDAOSearchBkgForSpclRqstRSQL">
			<desc><![CDATA[vvd변경시 spcl cargo rqst를 위해 bkg data를 조회한다.]]></desc>
			<sql><![CDATA[
select bk.bkg_no
    , bk.por_cd
    , bk.del_cd
    , bk.rcv_term_cd bkg_rcv_term_cd
    , bk.de_term_cd bkg_de_term_cd
    , 'DG' spcl_cgo_cate_cd
    , count(1) dcgo_qty
    , 0 rc_qty
    , 0 awk_cgo_qty
    , 0 bb_cgo_qty
  from bkg_booking bk
    , bkg_dg_cgo dg
 where bk.bkg_no = @[bkg_no]
   and bk.bkg_no = dg.bkg_no
#if(${rqst_type} == 'SPLIT')
   and NVL(dg.SPCL_CGO_APRO_CD,'#') in ('R', 'P') --split일 때는 request, pending에 대해서만 재REQUEST
#else
   and NVL(dg.SPCL_CGO_APRO_CD,'#') in ('Y', 'R', 'P') --요청/승인됐던 건에 대해서 재REQUEST
#end
 group by bk.bkg_no
    , bk.por_cd
    , bk.del_cd
    , bk.rcv_term_cd 
    , bk.de_term_cd 
union all  
select bk.bkg_no
    , bk.por_cd
    , bk.del_cd
    , bk.rcv_term_cd bkg_rcv_term_cd
    , bk.de_term_cd bkg_de_term_cd
    , 'RF' spcl_cgo_cate_cd
    , 0 dcgo_qty
    , count(1) rc_qty
    , 0 awk_cgo_qty
    , 0 bb_cgo_qty
  from bkg_booking bk
    , bkg_rf_cgo rf
 where bk.bkg_no = @[bkg_no]
   and bk.bkg_no = rf.bkg_no
#if(${rqst_type} == 'SPLIT')
   and NVL(rf.SPCL_CGO_APRO_CD,'#') in ('R', 'P') --split일 때는 request, pending에 대해서만 재REQUEST
#else
   and NVL(rf.SPCL_CGO_APRO_CD,'#') in ('Y', 'R', 'P') --요청/승인됐던 건에 대해서 재REQUEST
#end
 group by bk.bkg_no
    , bk.por_cd
    , bk.del_cd
    , bk.rcv_term_cd 
    , bk.de_term_cd 
union all  
select bk.bkg_no
    , bk.por_cd
    , bk.del_cd
    , bk.rcv_term_cd bkg_rcv_term_cd
    , bk.de_term_cd bkg_de_term_cd
    , 'AK' spcl_cgo_cate_cd
    , 0 dcgo_qty
    , 0 rc_qty
    , count(1) awk_cgo_qty
    , 0 bb_cgo_qty
  from bkg_booking bk
    , bkg_awk_cgo ak
 where bk.bkg_no = @[bkg_no]
   and bk.bkg_no = ak.bkg_no
#if(${rqst_type} == 'SPLIT')
   and NVL(ak.SPCL_CGO_APRO_CD,'#') in ('R', 'P') --split일 때는 request, pending에 대해서만 재REQUEST
#else
   and NVL(ak.SPCL_CGO_APRO_CD,'#') in ('Y', 'R', 'P') --요청/승인됐던 건에 대해서 재REQUEST
#end
 group by bk.bkg_no
    , bk.por_cd
    , bk.del_cd
    , bk.rcv_term_cd 
    , bk.de_term_cd 
union all  
select bk.bkg_no
    , bk.por_cd
    , bk.del_cd
    , bk.rcv_term_cd bkg_rcv_term_cd
    , bk.de_term_cd bkg_de_term_cd
    , 'BB' spcl_cgo_cate_cd
    , 0 dcgo_qty
    , 0 rc_qty
    , 0 awk_cgo_qty
    , count(1)  bb_cgo_qty
  from bkg_booking bk
    , bkg_bb_cgo bb
 where bk.bkg_no = @[bkg_no]
   and bk.bkg_no = bb.bkg_no
#if(${rqst_type} == 'SPLIT')
   and NVL(bb.SPCL_CGO_APRO_CD,'#') in ('R', 'P') --split일 때는 request, pending에 대해서만 재REQUEST
#else
   and NVL(bb.SPCL_CGO_APRO_CD,'#') in ('Y', 'R', 'P') --요청/승인됐던 건에 대해서 재REQUEST
#end
 group by bk.bkg_no
    , bk.por_cd
    , bk.del_cd
    , bk.rcv_term_cd 
    , bk.de_term_cd			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="MANY3120009" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
