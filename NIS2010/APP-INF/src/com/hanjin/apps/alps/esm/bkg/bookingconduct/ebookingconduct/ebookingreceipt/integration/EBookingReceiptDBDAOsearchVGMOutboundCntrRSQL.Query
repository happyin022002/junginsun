<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EBookingReceiptDBDAOsearchVGMOutboundCntrRSQL">
			<desc><![CDATA[searchVGMOutbound]]></desc>
			<sql><![CDATA[
select CNTR FLAT_FILE from (
       select ''
        ||CHR(10)||'{CNTR'
        ||CHR(10)||'VSL_CD:'        || bk.vsl_cd
        ||CHR(10)||'VSL_VOY:'       || bk.skd_voy_no
        ||CHR(10)||'VSL_DIR:'       || bk.skd_dir_cd
        ||CHR(10)||'VSL_NAME:'      || vsl.vsl_eng_nm
        ||CHR(10)||'VSL_LLOYD:'     || vsl.lloyd_no
        ||CHR(10)||'CNTR_NO:'       || bc.cntr_no
        ||CHR(10)||'CNTR_TP:'       || bc.cntr_tpsz_cd
        ||CHR(10)||'BKG_NO:'        || bc.bkg_no
        ||CHR(10)||'VGM_WGTQTY:'    || bc.VGM_WGT
        ||CHR(10)||'VGM_WGTCD:'     || bc.VGM_WGT_UT_CD
        ||CHR(10)||'VGM_METHOD:'    || bc.VGM_MZD_TP_CD
        ||CHR(10)||'VGM_DMT_DT:'    || to_char(VGM_DTMN_DT,'RRRRMMDDHH24MI')
        ||CHR(10)||'VGM_VERI_DT:'   || to_char(VGM_VRFY_DT,'RRRRMMDDHH24MI')
        || (RTRIM (XMLAGG (XMLELEMENT (e, CNTR_SEAL || '')).EXTRACT ('//text()'),','))
        || (RTRIM (XMLAGG (XMLELEMENT (e, CNTR_PARTY || '')).EXTRACT ('//text()'),','))
        ||CHR(10)||'}CNTR' CNTR
    from bkg_booking   bk,
         bkg_container bc, 
         mdm_vsl_cntr  vsl,
                (select ''
                ||CHR(10)||'{CNTR_SEAL'
                ||CHR(10)||'SEAL_NO:' || CNTR_SEAL_NO
                ||CHR(10)||'}CNTR_SEAL' CNTR_SEAL, CNTR_NO, BKG_NO
                from bkg_cntr_seal_no
				where bkg_no = @[bkg_no]
                ) cs,
                (select * from (select ''
                ||CHR(10)||'{CNTR_PARTY'
                ||CHR(10)||'PARTY_FUNC_CD:SPC' --I'm SPC
                --||CHR(10)||'PARTY_NM:'      || VGM_PTY_ID
                --||CHR(10)||'PARTY_ADDR:'    || VGM_PTY_ADDR
                ||CHR(10)||'PARTY_PERSON:'  || REPLACE(REPLACE(REPLACE(VGM_VRFY_SIG_CTNT,CHR(13)||CHR(10),' '),CHR(13),' '),CHR(10),' ') 
                --||CHR(10)||'PARTY_TEL:'     || VGM_PTY_CNTC_PHN_NO
                --||CHR(10)||'PARTY_EMAIL:'   || VGM_PTY_EML
                --||CHR(10)||'PARTY_FAX:'     || VGM_PTY_FAX_NO
                ||CHR(10)||'}CNTR_PARTY' CNTR_PARTY, a.CNTR_NO, a.BKG_NO, RANK() OVER (ORDER BY 1 DESC ) as rk
                from bkg_container a
                where 1=1
                and a.bkg_no = @[bkg_no]
                ) pty where pty.rk = 1 ) pty
    where bk.bkg_no = bc.bkg_no
    and bk.bkg_no = @[bkg_no]
    and bc.bkg_no = cs.bkg_no(+)
    and bc.cntr_no = cs.CNTR_NO(+) 
    and bc.bkg_no = pty.bkg_no(+)
    and bc.cntr_no = pty.CNTR_NO(+)
    and bc.vgm_wgt is not null
    and bk.vsl_cd = vsl.vsl_cd(+)
    group by bc.cntr_no,
             bc.cntr_tpsz_cd,
             bc.bkg_no,
             bc.VGM_WGT,
             bc.VGM_WGT_UT_CD,
             bc.VGM_MZD_TP_CD,
             to_char(VGM_DTMN_DT,'RRRRMMDDHH24MI'),
             to_char(VGM_VRFY_DT,'RRRRMMDDHH24MI'),
             bk.vsl_cd,
             bk.skd_voy_no,
             bk.skd_dir_cd,
             vsl.vsl_eng_nm,
             vsl.lloyd_no)			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="SEL5E0756101" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
