<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PSASpecialManifestDBDAOpsaSearchDeclBaseInfoRSQL">
			<desc><![CDATA[Decl 기본정보를 조회한다. ]]></desc>
			<sql><![CDATA[
SELECT 
     '89N' DOC_NAME
    ,@[d_type] HANDLING
    ,(
        SELECT DECODE(COUNT(*), 0, 'O', 'U') SEND_STATUS
        FROM BKG_CSTMS_PSA_DG_SND
        WHERE PSA_EDI_MSG_TP_ID = 'IFD'
        AND   PSA_DG_DECL_TP_CD = @[d_type]
		AND   VSL_CD      = SUBSTR(@[vvd_cd], 1, 4)
		AND   SKD_VOY_NO  = SUBSTR(@[vvd_cd], 5, 4)
		AND   SKD_DIR_CD  = SUBSTR(@[vvd_cd], 9, 1)
		AND   PORT_CD     = @[port_cd]
    ) STATUS -- Cancel전송 클릭 시 'C', 최초전송이면 'O', BKG_CSTMS_EUR_DG_SND_LOG에 존재하면 'U'
    ,NVL(@[reason_resending], '') REASON
    ,'' USER_REF -- 전송로그 MSN_SND_NO를 사용함
    ,'' OLD_USER_REF
    ,''  FIRST_USER_REF
    ,(SELECT /*+ INDEX_DESC(BKG_CSTMS_EUR_DG_RCV XPKBKG_CSTMS_EUR_DG_RCV)*/ SCR_FILE_NO
      FROM BKG_CSTMS_PSA_DG_RCV
      WHERE PSA_EDI_MSG_TP_ID = 'IFD'
      AND MSG_RCV_NO = @[first_msg_snd_no]
	  AND ROWNUM = 1
	) SEC_FILE_NBR
    ,'' FF_REF -- 확인 요망

FROM DUAL			]]></sql>
			<params>
				<param name="d_type" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="port_cd" type="12" value="" out="N"/>
				<param name="reason_resending" type="12" value="" out="N"/>
				<param name="first_msg_snd_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
