<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ConstraintMasterDBDAOSpcAlocCtrlOptVORSQL">
			<desc><![CDATA[SPC_BKG_ALOC_MGMT SELECT

-기존 BKG 시스템 검색조건 삭제 및 Trade, Sub Trade, Lane 검색조건 적용 변경
( Trunk 뿐 아니라 TS정보에도 적용)
-TRUNK, T/S의 경우, Free Type은 Trunk pol-pod, TS pol-pod 동시입력 가능하므로 LOC_DIV_CD 변경함]]></desc>
			<sql><![CDATA[
#if(${tab_rhq_cd} != 'SHARC/SINRS')
SELECT BKG_ALOC_SEQ
 , BKG_ALOC_TP_CD
 , TRNK_SLAN_CD
 , TRNK_DIR_CD
 , VSL_CD||SKD_VOY_NO||SKD_DIR_CD VVD
 , SLS_RHQ_CD
 , OB_SLS_OFC_CD
 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'POR' AND LENGTH(BAMD.SB_LOC_CD) = 2) BKG_POR_CNT_CD
 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'POR' AND LENGTH(BAMD.SB_LOC_CD) = 5) POR_CD
 , POR_NOD_CD
 , BKG_POR_SCC_CD
 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'POL' AND LENGTH(BAMD.SB_LOC_CD) = 2) BKG_POL_CNT_CD
 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'POL' AND LENGTH(BAMD.SB_LOC_CD) = 5) POL_CD
 , POL_NOD_CD
 , N1ST_TS_SLAN_CD
 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'SPL' AND LENGTH(BAMD.SB_LOC_CD) = 5) N1ST_TS_POL_CD
 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'SPD' AND LENGTH(BAMD.SB_LOC_CD) = 5) N1ST_TS_POD_CD
 , N1ST_TS_DIR_CD
 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'SPL' AND LENGTH(BAMD.SB_LOC_CD) = 2) N1ST_TS_POL_CNT_CD
 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'SPD' AND LENGTH(BAMD.SB_LOC_CD) = 2) N1ST_TS_POD_CNT_CD

 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'SAY') TS_NOD_CD
 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'SLY') TS_POL_NOD_CD
 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'SDY') TS_POD_NOD_CD
 , N2ND_TS_SLAN_CD
 , N2ND_TS_POL_CD
 , N2ND_TS_POD_CD
 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'POD' AND LENGTH(BAMD.SB_LOC_CD) = 2) BKG_POD_CNT_CD
 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'POD' AND LENGTH(BAMD.SB_LOC_CD) = 5) POD_CD
 , POD_NOD_CD
 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'DEL' AND LENGTH(BAMD.SB_LOC_CD) = 2) BKG_DEL_CNT_CD
 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'DEL' AND LENGTH(BAMD.SB_LOC_CD) = 5) DEL_CD
 , DEL_NOD_CD
 , BKG_DEL_SCC_CD
 , SC_NO
 , RFA_NO
 , CTRT_CUST_CNT_CD||TRIM(TO_CHAR(CTRT_CUST_SEQ,'000000')) CTRT_CUST_CNT_CD
 , CUST_CNT_CD||TRIM(TO_CHAR(CUST_SEQ,'000000')) CUST_CNT_CD
 , (SELECT WM_CONCAT(Z.CNTR_TPSZ_CD) FROM SPC_BKG_ALOC_MGMT_TP_SZ_DTL Z WHERE Z.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ) CNTR_TPSZ_CD
 --, CMDT_CD
 --, (SELECT CMDT_NM FROM MDM_COMMODITY MDM WHERE BAM.CMDT_CD = MDM.CMDT_CD) CMDT_NM
 , (SELECT WM_CONCAT(CMDT.CMDT_CD) FROM SPC_BKG_ALOC_MGMT_CMDT_DTL CMDT WHERE CMDT.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ) CMDT_CD
 , (SELECT WM_CONCAT(MDM.CMDT_NM) FROM SPC_BKG_ALOC_MGMT_CMDT_DTL CMDT, MDM_COMMODITY MDM WHERE CMDT.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND TRIM(TO_CHAR(CMDT.CMDT_CD,'000000'))= MDM.CMDT_CD) CMDT_NM
 , TO_CHAR(SCG_GRP_CMDT_SEQ,'00') SCG_GRP_CMDT_SEQ
 , (SELECT PSGC.SCG_GRP_CMDT_DESC FROM PRI_SCG_GRP_CMDT PSGC WHERE PSGC.SVC_SCP_CD = 'TPW' AND PSGC.CHG_CD = 'GRI' AND PSGC.SCG_GRP_CMDT_SEQ = BAM.SCG_GRP_CMDT_SEQ AND ROWNUM = 1) SCG_GRP_CMDT_DESC
 , ALOC_LOD_QTY , ALOC_LOD_QTY AS OLD_ALOC_LOD_QTY -- 조건 완화 체크를 위해
 , ALOC_LOD_QTY_RTO, ALOC_LOD_QTY_RTO AS OLD_ALOC_LOD_QTY_RTO -- 조건 완화 체크를 위해
 , ASGN_TTL_WGT , ASGN_TTL_WGT AS OLD_ASGN_TTL_WGT -- 조건 완화 체크를 위해
 , ASGN_WGT_RTO, ASGN_WGT_RTO AS OLD_AASGN_WGT_RTO -- 조건 완화 체크를 위해
 , ALOC_SVC_CD
 , BKG_ALOC_RMK
 , ALOC_USE_FLG
 , CRE_USR_ID
 , CRE_DT
 , UPD_USR_ID
 , TO_CHAR(UPD_DT,'YYYY-MM-DD HH24:MI:SS') UPD_DT
 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'TPL' AND LENGTH(BAMD.SB_LOC_CD) = 5) TRUNK_POL_CD
 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'TPD' AND LENGTH(BAMD.SB_LOC_CD) = 5) TRUNK_POD_CD
 , CMPB_AMT, CMPB_AMT OLD_CMPB_AMT -- 조건 완화 체크를 위해
 , BKG_CTRL_TP_CD
 , DCGO_FLG
 , RD_CGO_FLG
 , (SELECT WM_CONCAT(CUST.CUST_CNT_CD||LPAD(CUST.CUST_SEQ, 6, '0')) FROM SPC_BKG_ALOC_MGMT_CUST_DTL CUST WHERE CUST.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND CUST.BKG_CUST_TP_CD = 'B' ) AGMT_ACT_CNT_CD
 , ALOC_APLY_FM_DT
 , ALOC_APLY_TO_DT
 , SUB_TRD_CD
 --, CMPB_RULE_CD 
 , DECODE(DCGO_FLG, 'Y', 'dg', DECODE (RD_CGO_FLG, 'Y', 'rd', '') ) AS DG_RD
 , OFT_CHG_AMT, OFT_CHG_AMT OLD_OFT_CHG_AMT -- 조건 완화 체크를 위해
 , USA_BKG_MOD_CD
 , HUL_BND_CD
 , APLY_FM_YRWK
 , APLY_TO_YRWK
 , CMPB_ONY_FLG --
 , RVIS_CNTR_CUST_TP_CD AS ACCT_TP
 , (SELECT CUST_LGL_ENG_NM FROM MDM_CUSTOMER M WHERE M.CUST_CNT_CD = BAM.CTRT_CUST_CNT_CD  AND  M.CUST_SEQ = BAM.CTRT_CUST_SEQ ) AS CTRT_CUST_CNT_NM
 , (SELECT CUST_LGL_ENG_NM FROM MDM_CUSTOMER M WHERE M.CUST_CNT_CD = BAM.CUST_CNT_CD  AND  M.CUST_SEQ = BAM.CUST_SEQ ) AS CUST_CNT_NM
 , (SELECT DISTINCT(SELECT CUST_LGL_ENG_NM FROM MDM_CUSTOMER WHERE CUST_CNT_CD = PTY.CUST_CNT_CD AND CUST_SEQ = PTY.CUST_SEQ) AS SC_NM
    FROM  PRI_SP_HDR HDR, PRI_SP_MN MN, PRI_SP_CTRT_PTY PTY
    WHERE 1=1
        AND PROP_STS_CD = 'F'
        AND HDR.PROP_NO = MN.PROP_NO
        AND MN.PROP_NO = PTY.PROP_NO
        AND MN.AMDT_SEQ = PTY.AMDT_SEQ
        AND PTY.PRC_CTRT_PTY_TP_CD  = 'C'
        AND HDR.SC_NO =  BAM.SC_NO AND ROWNUM=1 ) AS SC_NM
 , (SELECT  DISTINCT(SELECT CUST_LGL_ENG_NM FROM MDM_CUSTOMER WHERE CUST_CNT_CD = CTRT_CUST_CNT_CD AND CUST_SEQ = CTRT_CUST_SEQ) AS RFA_NM
    FROM PRI_RP_HDR HDR ,PRI_RP_MN MN
    WHERE 1=1
    AND PROP_STS_CD = 'A'
    AND HDR.PROP_NO = MN.PROP_NO
    AND HDR.RFA_NO = BAM.RFA_NO AND ROWNUM=1) AS RFA_NM
 , OP_CNTR_QTY, OP_CNTR_QTY AS OLD_OP_CNTR_QTY 
 , OP_CNTR_QTY_RTO, OP_CNTR_QTY_RTO AS OLD_OP_CNTR_QTY_RTO
 , CUST_GRP_ID
 ,(SELECT CUST_GRP_NM from MDM_CUST_PERF_GRP z WHERE z.CUST_GRP_ID = BAM.CUST_GRP_ID ) AS CUST_GRP_NM
 ,RFA_CTRT_TP_CD	
 ,CMPB_PER_TON_AMT	AS CMPB_PER_WGT
 ,TON_PER_TEU_WGT	AS WGT_PER_TEU
	-- 20170629 로켓배송-stowage 추가(송민석)
 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'STW' ) STWG_CD

FROM SPC_BKG_ALOC_MGMT BAM
WHERE 1=1
#if(${tab_rhq_cd} != '')
AND SLS_RHQ_CD = @[tab_rhq_cd]
#end
#if(${bkg_aloc_tp_cd} != 'ALL')
AND BKG_ALOC_TP_CD = @[bkg_aloc_tp_cd]
#end
AND ((SUB_TRD_CD IS NULL AND TRNK_SLAN_CD IS NULL AND N1ST_TS_SLAN_CD IS NULL) OR
( 1=1
-- LANE/Bound
AND SUBSTR(NVL(@[lane], 'XXX'), 1, 3)||NVL(@[bound], 'X') IN ('XXXX', NVL(TRNK_SLAN_CD, 'XXX')||NVL2(@[bound],TRNK_DIR_CD, 'X'), NVL(N1ST_TS_SLAN_CD, 'XXX')||NVL2(@[bound],N1ST_TS_DIR_CD, 'X'))
#if(${subtrade} != '')
--SubTrade가 있으면
AND (SUB_TRD_CD = @[subtrade]
 OR N1ST_TS_SLAN_CD IN (SELECT DISTINCT SUBSTR(B.RLANE_CD, 1, 3) SLAN_CD
                              FROM MDM_REV_LANE A
                                 , MDM_DTL_REV_LANE B
                                 , MDM_VSL_SVC_LANE C
                             WHERE A.RLANE_CD = B.RLANE_CD
                               AND A.VSL_TP_CD = 'C'
                               AND A.REP_TRD_CD = B.TRD_CD
                               AND B.DELT_FLG = 'N'
                               AND B.TRD_CD <> 'COM'
                               AND A.VSL_SLAN_CD = C.VSL_SLAN_CD
                               AND DECODE(C.VSL_SVC_TP_CD, 'I', C.CO_CD, '1') = DECODE(C.VSL_SVC_TP_CD, 'I', 'H', '1')
                               AND C.VSL_SVC_TP_CD <> 'O'
                               AND B.SUB_TRD_CD = @[subtrade])
 OR TRNK_SLAN_CD IN (SELECT DISTINCT SUBSTR(B.RLANE_CD, 1, 3) SLAN_CD
                              FROM MDM_REV_LANE A
                                 , MDM_DTL_REV_LANE B
                                 , MDM_VSL_SVC_LANE C
                             WHERE A.RLANE_CD = B.RLANE_CD
                               AND A.VSL_TP_CD = 'C'
                               AND A.REP_TRD_CD = B.TRD_CD
                               AND B.DELT_FLG = 'N'
                               AND B.TRD_CD <> 'COM'
                               AND A.VSL_SLAN_CD = C.VSL_SLAN_CD
                               AND DECODE(C.VSL_SVC_TP_CD, 'I', C.CO_CD, '1') = DECODE(C.VSL_SVC_TP_CD, 'I', 'H', '1')
                               AND C.VSL_SVC_TP_CD <> 'O'
                               AND B.SUB_TRD_CD = @[subtrade])
)
#else
#if(${trade} != '')
--SubTrade가 없고, Trade가 있으면
AND (SUB_TRD_CD IN (SELECT DISTINCT B.SUB_TRD_CD
                      FROM MDM_REV_LANE A
                         , MDM_DTL_REV_LANE B
                         , MDM_VSL_SVC_LANE C
                     WHERE A.RLANE_CD = B.RLANE_CD
                       AND A.VSL_TP_CD = 'C'
                       AND A.REP_TRD_CD = B.TRD_CD
                       AND B.DELT_FLG = 'N'
                       AND B.TRD_CD <> 'COM'
                       AND A.VSL_SLAN_CD = C.VSL_SLAN_CD
                       AND DECODE(C.VSL_SVC_TP_CD, 'I', C.CO_CD, '1') = DECODE(C.VSL_SVC_TP_CD, 'I', 'H', '1')
                       AND C.VSL_SVC_TP_CD <> 'O'
                       AND B.TRD_CD = @[trade])
 OR N1ST_TS_SLAN_CD IN (SELECT DISTINCT SUBSTR(B.RLANE_CD, 1, 3) SLAN_CD
                              FROM MDM_REV_LANE A
                                 , MDM_DTL_REV_LANE B
                                 , MDM_VSL_SVC_LANE C
                             WHERE A.RLANE_CD = B.RLANE_CD
                               AND A.VSL_TP_CD = 'C'
                               AND A.REP_TRD_CD = B.TRD_CD
                               AND B.DELT_FLG = 'N'
                               AND B.TRD_CD <> 'COM'
                               AND A.VSL_SLAN_CD = C.VSL_SLAN_CD
                               AND DECODE(C.VSL_SVC_TP_CD, 'I', C.CO_CD, '1') = DECODE(C.VSL_SVC_TP_CD, 'I', 'H', '1')
                               AND C.VSL_SVC_TP_CD <> 'O'
                               AND B.TRD_CD = @[trade])
 OR TRNK_SLAN_CD IN (SELECT DISTINCT SUBSTR(B.RLANE_CD, 1, 3) SLAN_CD
                              FROM MDM_REV_LANE A
                                 , MDM_DTL_REV_LANE B
                                 , MDM_VSL_SVC_LANE C
                             WHERE A.RLANE_CD = B.RLANE_CD
                               AND A.VSL_TP_CD = 'C'
                               AND A.REP_TRD_CD = B.TRD_CD
                               AND B.DELT_FLG = 'N'
                               AND B.TRD_CD <> 'COM'
                               AND A.VSL_SLAN_CD = C.VSL_SLAN_CD
                               AND DECODE(C.VSL_SVC_TP_CD, 'I', C.CO_CD, '1') = DECODE(C.VSL_SVC_TP_CD, 'I', 'H', '1')
                               AND C.VSL_SVC_TP_CD <> 'O'
                               AND B.TRD_CD = @[trade])
)
#end
#end
))
ORDER BY BKG_ALOC_SEQ
#else
WITH BASIC_DATA AS (
SELECT BKG_ALOC_SEQ
    , BKG_ALOC_TP_CD
    , TRNK_SLAN_CD
    , TRNK_DIR_CD
    , VSL_CD||SKD_VOY_NO||SKD_DIR_CD VVD
    , SLS_RHQ_CD
    , OB_SLS_OFC_CD
    , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'POR' AND LENGTH(BAMD.SB_LOC_CD) = 2) BKG_POR_CNT_CD
    , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'POR' AND LENGTH(BAMD.SB_LOC_CD) = 5) POR_CD
    , POR_NOD_CD
    , BKG_POR_SCC_CD
    , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'POL' AND LENGTH(BAMD.SB_LOC_CD) = 2) BKG_POL_CNT_CD
    , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'POL' AND LENGTH(BAMD.SB_LOC_CD) = 5) POL_CD
    , POL_NOD_CD
    , N1ST_TS_SLAN_CD
    , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'SPL' AND LENGTH(BAMD.SB_LOC_CD) = 5) N1ST_TS_POL_CD
    , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'SPD' AND LENGTH(BAMD.SB_LOC_CD) = 5) N1ST_TS_POD_CD
    , N1ST_TS_DIR_CD
    , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'SPL' AND LENGTH(BAMD.SB_LOC_CD) = 2) N1ST_TS_POL_CNT_CD
    , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'SPD' AND LENGTH(BAMD.SB_LOC_CD) = 2) N1ST_TS_POD_CNT_CD

    , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'SAY') TS_NOD_CD
    , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'SLY') TS_POL_NOD_CD
    , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'SDY') TS_POD_NOD_CD
    , N2ND_TS_SLAN_CD
    , N2ND_TS_POL_CD
    , N2ND_TS_POD_CD
    , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'POD' AND LENGTH(BAMD.SB_LOC_CD) = 2) BKG_POD_CNT_CD
    , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'POD' AND LENGTH(BAMD.SB_LOC_CD) = 5) POD_CD
    , POD_NOD_CD
    , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'DEL' AND LENGTH(BAMD.SB_LOC_CD) = 2) BKG_DEL_CNT_CD
    , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'DEL' AND LENGTH(BAMD.SB_LOC_CD) = 5) DEL_CD
    , DEL_NOD_CD
    , BKG_DEL_SCC_CD
    , SC_NO
    , RFA_NO
    , CTRT_CUST_CNT_CD||TRIM(TO_CHAR(CTRT_CUST_SEQ,'000000')) CTRT_CUST_CNT_CD
    , CUST_CNT_CD||TRIM(TO_CHAR(CUST_SEQ,'000000')) CUST_CNT_CD
    , (SELECT WM_CONCAT(Z.CNTR_TPSZ_CD) FROM SPC_BKG_ALOC_MGMT_TP_SZ_DTL Z WHERE Z.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ) CNTR_TPSZ_CD
    --, CMDT_CD
    --, (SELECT CMDT_NM FROM MDM_COMMODITY MDM WHERE BAM.CMDT_CD = MDM.CMDT_CD) CMDT_NM
    , (SELECT WM_CONCAT(CMDT.CMDT_CD) FROM SPC_BKG_ALOC_MGMT_CMDT_DTL CMDT WHERE CMDT.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ) CMDT_CD
    , (SELECT WM_CONCAT(MDM.CMDT_NM) FROM SPC_BKG_ALOC_MGMT_CMDT_DTL CMDT, MDM_COMMODITY MDM WHERE CMDT.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND TRIM(TO_CHAR(CMDT.CMDT_CD,'000000')) = MDM.CMDT_CD) CMDT_NM
    , TO_CHAR(SCG_GRP_CMDT_SEQ,'00') SCG_GRP_CMDT_SEQ
    , (SELECT PSGC.SCG_GRP_CMDT_DESC FROM PRI_SCG_GRP_CMDT PSGC WHERE PSGC.SVC_SCP_CD = 'TPW' AND PSGC.CHG_CD = 'GRI' AND PSGC.SCG_GRP_CMDT_SEQ = BAM.SCG_GRP_CMDT_SEQ AND ROWNUM = 1) SCG_GRP_CMDT_DESC
    , ALOC_LOD_QTY
    , ALOC_LOD_QTY_RTO
    , ASGN_TTL_WGT
    , ASGN_WGT_RTO
    , ALOC_SVC_CD
    , BKG_ALOC_RMK
    , ALOC_USE_FLG
    , CRE_USR_ID
    , CRE_DT
    , UPD_USR_ID
    , TO_CHAR(UPD_DT,'YYYY-MM-DD HH24:MI:SS') UPD_DT
    , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'TPL' AND LENGTH(BAMD.SB_LOC_CD) = 5) TRUNK_POL_CD
    , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'TPD' AND LENGTH(BAMD.SB_LOC_CD) = 5) TRUNK_POD_CD
    , CMPB_AMT
    , BKG_CTRL_TP_CD
    , DCGO_FLG
    , RD_CGO_FLG
    
    , (SELECT WM_CONCAT(CUST.CUST_CNT_CD||LPAD(CUST.CUST_SEQ, 6, '0')) FROM SPC_BKG_ALOC_MGMT_CUST_DTL CUST WHERE CUST.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND CUST.BKG_CUST_TP_CD = 'B' ) AGMT_ACT_CNT_CD
    , ALOC_APLY_FM_DT
    , ALOC_APLY_TO_DT
    , SUB_TRD_CD
    --, CMPB_RULE_CD
    , DECODE(DCGO_FLG, 'Y', 'dg', DECODE (RD_CGO_FLG, 'Y', 'rd', '') ) AS DG_RD
    , OFT_CHG_AMT
    , USA_BKG_MOD_CD
    , HUL_BND_CD
    , APLY_FM_YRWK
    , APLY_TO_YRWK
    , CMPB_ONY_FLG
    , RVIS_CNTR_CUST_TP_CD AS ACCT_TP
    , CTRT_CUST_CNT_CD AS CTRT_CUST_CNT_CD1
    , CUST_CNT_CD AS CUST_CNT_CD1
    , CTRT_CUST_SEQ
    , CUST_SEQ
	, OP_CNTR_QTY
    , OP_CNTR_QTY_RTO
    , CUST_GRP_ID
	, RFA_CTRT_TP_CD	
    , CMPB_PER_TON_AMT
    , TON_PER_TEU_WGT
	-- 20170629 로켓배송-stowage 추가(송민석)
 , (SELECT WM_CONCAT(BAMD.SB_LOC_CD) FROM SPC_BKG_ALOC_MGMT_NOD_DTL BAMD WHERE BAMD.BKG_ALOC_SEQ = BAM.BKG_ALOC_SEQ AND BAMD.SB_LOC_DIV_CD = 'STW' ) STWG_CD
FROM SPC_BKG_ALOC_MGMT BAM
WHERE 1=1
AND SLS_RHQ_CD IN ('SHARC', 'SINRS')
#if(${bkg_aloc_tp_cd} != 'ALL')
AND BKG_ALOC_TP_CD = @[bkg_aloc_tp_cd]
#end
AND ((SUB_TRD_CD IS NULL AND TRNK_SLAN_CD IS NULL AND N1ST_TS_SLAN_CD IS NULL) OR
( 1=1
-- LANE/Bound
AND SUBSTR(NVL(@[lane], 'XXX'), 1, 3)||NVL(@[bound], 'X') IN ('XXXX', NVL(TRNK_SLAN_CD, 'XXX')||NVL2(@[bound],TRNK_DIR_CD, 'X'), NVL(N1ST_TS_SLAN_CD, 'XXX')||NVL2(@[bound],N1ST_TS_DIR_CD, 'X'))
#if(${subtrade} != '')
--SubTrade가 있으면
AND (SUB_TRD_CD = @[subtrade]
 OR N1ST_TS_SLAN_CD IN (SELECT DISTINCT SUBSTR(B.RLANE_CD, 1, 3) SLAN_CD
                              FROM MDM_REV_LANE A
                                 , MDM_DTL_REV_LANE B
                                 , MDM_VSL_SVC_LANE C
                             WHERE A.RLANE_CD = B.RLANE_CD
                               AND A.VSL_TP_CD = 'C'
                               AND A.REP_TRD_CD = B.TRD_CD
                               AND B.DELT_FLG = 'N'
                               AND B.TRD_CD <> 'COM'
                               AND A.VSL_SLAN_CD = C.VSL_SLAN_CD
                               AND DECODE(C.VSL_SVC_TP_CD, 'I', C.CO_CD, '1') = DECODE(C.VSL_SVC_TP_CD, 'I', 'H', '1')
                               AND C.VSL_SVC_TP_CD <> 'O'
                               AND B.SUB_TRD_CD = @[subtrade])
 OR TRNK_SLAN_CD IN (SELECT DISTINCT SUBSTR(B.RLANE_CD, 1, 3) SLAN_CD
                              FROM MDM_REV_LANE A
                                 , MDM_DTL_REV_LANE B
                                 , MDM_VSL_SVC_LANE C
                             WHERE A.RLANE_CD = B.RLANE_CD
                               AND A.VSL_TP_CD = 'C'
                               AND A.REP_TRD_CD = B.TRD_CD
                               AND B.DELT_FLG = 'N'
                               AND B.TRD_CD <> 'COM'
                               AND A.VSL_SLAN_CD = C.VSL_SLAN_CD
                               AND DECODE(C.VSL_SVC_TP_CD, 'I', C.CO_CD, '1') = DECODE(C.VSL_SVC_TP_CD, 'I', 'H', '1')
                               AND C.VSL_SVC_TP_CD <> 'O'
                               AND B.SUB_TRD_CD = @[subtrade])
)
#else
  #if(${trade} != '')
  --SubTrade가 없고, Trade가 있으면
  AND (SUB_TRD_CD IN (SELECT DISTINCT B.SUB_TRD_CD
                        FROM MDM_REV_LANE A
                           , MDM_DTL_REV_LANE B
                           , MDM_VSL_SVC_LANE C
                       WHERE A.RLANE_CD = B.RLANE_CD
                         AND A.VSL_TP_CD = 'C'
                         AND A.REP_TRD_CD = B.TRD_CD
                         AND B.DELT_FLG = 'N'
                         AND B.TRD_CD <> 'COM'
                         AND A.VSL_SLAN_CD = C.VSL_SLAN_CD
                         AND DECODE(C.VSL_SVC_TP_CD, 'I', C.CO_CD, '1') = DECODE(C.VSL_SVC_TP_CD, 'I', 'H', '1')
                         AND C.VSL_SVC_TP_CD <> 'O'
                         AND B.TRD_CD = @[trade])
   OR N1ST_TS_SLAN_CD IN (SELECT DISTINCT SUBSTR(B.RLANE_CD, 1, 3) SLAN_CD
                                FROM MDM_REV_LANE A
                                   , MDM_DTL_REV_LANE B
                                   , MDM_VSL_SVC_LANE C
                               WHERE A.RLANE_CD = B.RLANE_CD
                                 AND A.VSL_TP_CD = 'C'
                                 AND A.REP_TRD_CD = B.TRD_CD
                                 AND B.DELT_FLG = 'N'
                                 AND B.TRD_CD <> 'COM'
                                 AND A.VSL_SLAN_CD = C.VSL_SLAN_CD
                                 AND DECODE(C.VSL_SVC_TP_CD, 'I', C.CO_CD, '1') = DECODE(C.VSL_SVC_TP_CD, 'I', 'H', '1')
                                 AND C.VSL_SVC_TP_CD <> 'O'
                                 AND B.TRD_CD = @[trade])
   OR TRNK_SLAN_CD IN (SELECT DISTINCT SUBSTR(B.RLANE_CD, 1, 3) SLAN_CD
                                FROM MDM_REV_LANE A
                                   , MDM_DTL_REV_LANE B
                                   , MDM_VSL_SVC_LANE C
                               WHERE A.RLANE_CD = B.RLANE_CD
                                 AND A.VSL_TP_CD = 'C'
                                 AND A.REP_TRD_CD = B.TRD_CD
                                 AND B.DELT_FLG = 'N'
                                 AND B.TRD_CD <> 'COM'
                                 AND A.VSL_SLAN_CD = C.VSL_SLAN_CD
                                 AND DECODE(C.VSL_SVC_TP_CD, 'I', C.CO_CD, '1') = DECODE(C.VSL_SVC_TP_CD, 'I', 'H', '1')
                                 AND C.VSL_SVC_TP_CD <> 'O'
                                 AND B.TRD_CD = @[trade])
  )
  #end
#end
))
)
SELECT SH.BKG_ALOC_SEQ SHAAS_SEQ
    , SW.BKG_ALOC_SEQ SINWA_SEQ
    , DECODE(COPY.RN, 1, SH.BKG_ALOC_SEQ, 2, SW.BKG_ALOC_SEQ) BKG_ALOC_SEQ
    , SH.BKG_ALOC_TP_CD
    , DECODE(COPY.RN, 1, SH.SLS_RHQ_CD, 2, SW.SLS_RHQ_CD) SLS_RHQ_CD
    , SH.TRUNK_POL_CD
    , SH.TRUNK_POD_CD
    , SH.TRNK_SLAN_CD
    , SH.TRNK_DIR_CD
    , SH.VVD
    , SH.OB_SLS_OFC_CD
    , SH.BKG_POR_CNT_CD
    , SH.POR_CD
    , SH.POR_NOD_CD
    , SH.BKG_POR_SCC_CD
    , SH.BKG_POL_CNT_CD
    , SH.POL_CD
    , SH.POL_NOD_CD
    , SH.N1ST_TS_SLAN_CD 
    , SH.TS_NOD_CD
    , SH.TS_POL_NOD_CD
    , SH.TS_POD_NOD_CD    
    , SH.N1ST_TS_POL_CD
    , SH.N1ST_TS_POD_CD
    , SH.N1ST_TS_DIR_CD
    , SH.N1ST_TS_POL_CNT_CD
    , SH.N1ST_TS_POD_CNT_CD
    , SH.N2ND_TS_SLAN_CD
    , SH.N2ND_TS_POL_CD
    , SH.N2ND_TS_POD_CD
    , SH.BKG_POD_CNT_CD
    , SH.POD_CD
    , SH.POD_NOD_CD
    , SH.BKG_DEL_CNT_CD
    , SH.DEL_CD
    , SH.DEL_NOD_CD
    , SH.BKG_DEL_SCC_CD
    , SH.SC_NO
    , SH.RFA_NO
    , SH.CTRT_CUST_CNT_CD
    , SH.CUST_CNT_CD
    , SH.CNTR_TPSZ_CD
    , SH.CMDT_CD
    , SH.CMDT_NM
    , SH.SCG_GRP_CMDT_SEQ
    , SH.SCG_GRP_CMDT_DESC
    , SH.ALOC_LOD_QTY, SH.ALOC_LOD_QTY OLD_ALOC_LOD_QTY
    , SH.ALOC_LOD_QTY_RTO, SH.ALOC_LOD_QTY_RTO OLD_ALOC_LOD_QTY_RTO
    , SH.ASGN_TTL_WGT , SH.ASGN_TTL_WGT OLD_ASGN_TTL_WGT
    , SH.ASGN_WGT_RTO, SH.ASGN_WGT_RTO OLD_AASGN_WGT_RTO
    , SH.ALOC_SVC_CD
    , SH.BKG_ALOC_RMK
    , SH.ALOC_USE_FLG
    , DECODE(COPY.RN, 1, SH.CRE_USR_ID, 2, SW.CRE_USR_ID) CRE_USR_ID
    , DECODE(COPY.RN, 1, SH.CRE_DT, 2, SW.CRE_DT) CRE_DT
    , DECODE(COPY.RN, 1, SH.UPD_USR_ID, 2, SW.UPD_USR_ID) UPD_USR_ID
    , DECODE(COPY.RN, 1, SH.UPD_DT, 2, SW.UPD_DT) UPD_DT
    , SH.CMPB_AMT, SH.CMPB_AMT
    , SH.BKG_CTRL_TP_CD
    , SH.DCGO_FLG
    , SH.RD_CGO_FLG
    , SH.AGMT_ACT_CNT_CD
    , SH.ALOC_APLY_FM_DT
    , SH.ALOC_APLY_TO_DT
    , SH.SUB_TRD_CD
    --, SH.CMPB_RULE_CD
    , SH.DG_RD
    , SH.OFT_CHG_AMT, SH.OFT_CHG_AMT OLD_OFT_CHG_AMT
    , SH.USA_BKG_MOD_CD
    , SH.HUL_BND_CD
    , SH.APLY_FM_YRWK
    , SH.APLY_TO_YRWK
    , SH.CMPB_ONY_FLG
    , (SELECT CUST_LGL_ENG_NM FROM MDM_CUSTOMER M WHERE M.CUST_CNT_CD = SH.CTRT_CUST_CNT_CD1  AND  M.CUST_SEQ = SH.CTRT_CUST_SEQ ) AS CTRT_CUST_CNT_NM
    , (SELECT CUST_LGL_ENG_NM FROM MDM_CUSTOMER M WHERE M.CUST_CNT_CD = SH.CUST_CNT_CD1  AND  M.CUST_SEQ = SH.CUST_SEQ ) AS CUST_CNT_NM
    , (SELECT DISTINCT(SELECT CUST_LGL_ENG_NM FROM MDM_CUSTOMER WHERE CUST_CNT_CD = PTY.CUST_CNT_CD AND CUST_SEQ = PTY.CUST_SEQ) AS SC_NM
    FROM  PRI_SP_HDR HDR, PRI_SP_MN MN, PRI_SP_CTRT_PTY PTY
    WHERE 1=1
    AND PROP_STS_CD = 'F'
    AND HDR.PROP_NO = MN.PROP_NO
    AND MN.PROP_NO = PTY.PROP_NO
    AND MN.AMDT_SEQ = PTY.AMDT_SEQ
    AND PTY.PRC_CTRT_PTY_TP_CD  = 'C'
    AND HDR.SC_NO =  SH.SC_NO  ) AS SC_NM
    , (SELECT  DISTINCT(SELECT CUST_LGL_ENG_NM FROM MDM_CUSTOMER WHERE CUST_CNT_CD = CTRT_CUST_CNT_CD AND CUST_SEQ = CTRT_CUST_SEQ) AS RFA_NM
    FROM PRI_RP_HDR HDR ,PRI_RP_MN MN
    WHERE 1=1
    AND PROP_STS_CD = 'A'
    AND HDR.PROP_NO = MN.PROP_NO
    AND HDR.RFA_NO = SH.RFA_NO ) AS RFA_NM
    , SH.ACCT_TP
    , SH.OP_CNTR_QTY
    , SH.OP_CNTR_QTY_RTO
    , SH.CUST_GRP_ID
	,(SELECT CUST_GRP_NM from MDM_CUST_PERF_GRP z WHERE z.CUST_GRP_ID = SH.CUST_GRP_ID ) AS CUST_GRP_NM
	,SH.RFA_CTRT_TP_CD	
	,SH.CMPB_PER_TON_AMT AS CMPB_PER_WGT
	,SH.TON_PER_TEU_WGT	AS WGT_PER_TEU
	,SH.STWG_CD
FROM 
    BASIC_DATA SH
  , BASIC_DATA SW
  , (SELECT ROWNUM AS RN FROM DUAL CONNECT BY ROWNUM <= 2) COPY
WHERE 
    SH.SLS_RHQ_CD = 'SHARC'
    AND SW.SLS_RHQ_CD = 'SINRS'
    AND SH.BKG_ALOC_TP_CD = SW.BKG_ALOC_TP_CD
    AND NVL(SH.TRNK_SLAN_CD, 'X')		= NVL(SW.TRNK_SLAN_CD, 'X')
    AND NVL(SH.TRNK_DIR_CD, 'X')		    = NVL(SW.TRNK_DIR_CD, 'X')
    AND NVL(SH.VVD, 'X')				    = NVL(SW.VVD, 'X')
    AND NVL(SH.OB_SLS_OFC_CD, 'X')		= NVL(SW.OB_SLS_OFC_CD, 'X')
    AND NVL(SH.BKG_POR_CNT_CD, 'X')		= NVL(SW.BKG_POR_CNT_CD    , 'X')
    AND NVL(SH.POR_CD		, 'X')		= NVL(SW.POR_CD           , 'X')
    AND NVL(SH.POR_NOD_CD	, 'X')		= NVL(SW.POR_NOD_CD        , 'X')
    AND NVL(SH.BKG_POR_SCC_CD, 'X')		= NVL(SW.BKG_POR_SCC_CD    , 'X')
    AND NVL(SH.BKG_POL_CNT_CD, 'X')		= NVL(SW.BKG_POL_CNT_CD    , 'X')
    AND NVL(SH.POL_CD		, 'X')		= NVL(SW.POL_CD           , 'X')
    AND NVL(SH.POL_NOD_CD	, 'X')		= NVL(SW.POL_NOD_CD        , 'X')
    AND NVL(SH.N1ST_TS_SLAN_CD, 'X')	    = NVL(SW.N1ST_TS_SLAN_CD   , 'X')
    AND NVL(SH.N1ST_TS_POL_CD, 'X')		= NVL(SW.N1ST_TS_POL_CD    , 'X')
    AND NVL(SH.N1ST_TS_POD_CD, 'X')		= NVL(SW.N1ST_TS_POD_CD    , 'X')
    AND NVL(SH.N1ST_TS_DIR_CD, 'X')		= NVL(SW.N1ST_TS_DIR_CD    , 'X')
    AND NVL(SH.N1ST_TS_POL_CNT_CD, 'X')	= NVL(SW.N1ST_TS_POL_CNT_CD, 'X')
    AND NVL(SH.N1ST_TS_POD_CNT_CD, 'X')	= NVL(SW.N1ST_TS_POD_CNT_CD, 'X')
    AND NVL(SH.N2ND_TS_SLAN_CD, 'X')	    = NVL(SW.N2ND_TS_SLAN_CD   , 'X')
    AND NVL(SH.N2ND_TS_POL_CD, 'X')		= NVL(SW.N2ND_TS_POL_CD    , 'X')
    AND NVL(SH.N2ND_TS_POD_CD, 'X')		= NVL(SW.N2ND_TS_POD_CD    , 'X')
    AND NVL(SH.BKG_POD_CNT_CD, 'X')		= NVL(SW.BKG_POD_CNT_CD    , 'X')
    AND NVL(SH.POD_CD		, 'X')		= NVL(SW.POD_CD           , 'X')
    AND NVL(SH.POD_NOD_CD	, 'X')		= NVL(SW.POD_NOD_CD        , 'X')
    AND NVL(SH.BKG_DEL_CNT_CD, 'X')		= NVL(SW.BKG_DEL_CNT_CD    , 'X')
    AND NVL(SH.DEL_CD		, 'X')		= NVL(SW.DEL_CD           , 'X')
    AND NVL(SH.DEL_NOD_CD	, 'X')		= NVL(SW.DEL_NOD_CD        , 'X')
    AND NVL(SH.BKG_DEL_SCC_CD, 'X')		= NVL(SW.BKG_DEL_SCC_CD    , 'X')
    AND NVL(SH.SC_NO		, 'X')		    = NVL(SW.SC_NO            , 'X')
    AND NVL(SH.RFA_NO		, 'X')		= NVL(SW.RFA_NO           , 'X')
    AND NVL(SH.CTRT_CUST_CNT_CD, 'X')	= NVL(SW.CTRT_CUST_CNT_CD  , 'X')
    AND NVL(SH.CUST_CNT_CD	, 'X')		= NVL(SW.CUST_CNT_CD       , 'X')
    AND NVL(SH.CNTR_TPSZ_CD	, 'X')		= NVL(SW.CNTR_TPSZ_CD      , 'X')
    AND NVL(SH.CMDT_CD		, 'X')		= NVL(SW.CMDT_CD           , 'X')
    AND NVL(SH.CMDT_NM		, 'X')		= NVL(SW.CMDT_NM           , 'X')
    AND NVL(SH.SCG_GRP_CMDT_SEQ, 'X')	= NVL(SW.SCG_GRP_CMDT_SEQ  , 'X')
    AND NVL(SH.SCG_GRP_CMDT_DESC, 'X')	= NVL(SW.SCG_GRP_CMDT_DESC , 'X')
    AND NVL(SH.ALOC_LOD_QTY	, 0)		= NVL(SW.ALOC_LOD_QTY      , 0)
    AND NVL(SH.ALOC_LOD_QTY_RTO, 0)	    = NVL(SW.ALOC_LOD_QTY_RTO  , 0)
    AND NVL(SH.ASGN_TTL_WGT	, 0)		= NVL(SW.ASGN_TTL_WGT      , 0)
    AND NVL(SH.ASGN_WGT_RTO  , 0)	    = NVL(SW.ASGN_WGT_RTO      , 0)
    AND NVL(SH.ALOC_SVC_CD	, 'X')		= NVL(SW.ALOC_SVC_CD       , 'X')
    --AND NVL(SH.BKG_ALOC_RMK	, 'X')		= NVL(SW.BKG_ALOC_RMK      , 'X')
    AND NVL(SH.ALOC_USE_FLG	, 'X')		= NVL(SW.ALOC_USE_FLG      , 'X')
    AND NVL(SH.CMPB_AMT		, 0)		= NVL(SW.CMPB_AMT          , 0)
    AND NVL(SH.BKG_CTRL_TP_CD, 'X')		= NVL(SW.BKG_CTRL_TP_CD    , 'X')
    AND NVL(SH.DCGO_FLG		, 'X')		= NVL(SW.DCGO_FLG          , 'X')
    AND NVL(SH.RD_CGO_FLG	, 'X')		= NVL(SW.RD_CGO_FLG        , 'X')
    AND NVL(SH.AGMT_ACT_CNT_CD, 'X')	    = NVL(SW.AGMT_ACT_CNT_CD   , 'X')
    AND NVL(SH.ALOC_APLY_FM_DT, 'X')	    = NVL(SW.ALOC_APLY_FM_DT   , 'X')
    AND NVL(SH.ALOC_APLY_TO_DT, 'X')	    = NVL(SW.ALOC_APLY_TO_DT   , 'X')
    AND NVL(SH.SUB_TRD_CD	, 'X')		= NVL(SW.SUB_TRD_CD        , 'X')
    --AND NVL(SH.CMPB_RULE_CD	, 'X')		= NVL(SW.CMPB_RULE_CD      , 'X')
    AND NVL(SH.DG_RD		, 'X')		    = NVL(SW.DG_RD            , 'X')
    AND NVL(SH.OFT_CHG_AMT	, 0)		= NVL(SW.OFT_CHG_AMT       , 0)
    AND NVL(SH.USA_BKG_MOD_CD, 'X')		= NVL(SW.USA_BKG_MOD_CD    , 'X')
    AND NVL(SH.APLY_FM_YRWK, 'X')		= NVL(SW.APLY_FM_YRWK    , 'X')
    AND NVL(SH.APLY_TO_YRWK, 'X')		= NVL(SW.APLY_TO_YRWK    , 'X')
    AND NVL(SH.HUL_BND_CD, 'X')		    = NVL(SW.HUL_BND_CD    , 'X')
    AND NVL(SH.ACCT_TP, 'X')		    = NVL(SW.ACCT_TP    , 'X')
	AND NVL(SH.OP_CNTR_QTY, 0)		= NVL(SW.OP_CNTR_QTY    , 0)
    AND NVL(SH.OP_CNTR_QTY_RTO, 0)		= NVL(SW.OP_CNTR_QTY_RTO    , 0)
	AND NVL(SH.CUST_GRP_ID, 0)		= NVL(SW.CUST_GRP_ID    , 0)
    AND NVL(SH.TS_NOD_CD, 'X')		= NVL(SW.TS_NOD_CD    , 'X')
    AND NVL(SH.TS_POL_NOD_CD, 'X')		= NVL(SW.TS_POL_NOD_CD    , 'X')
    AND NVL(SH.TS_POD_NOD_CD, 'X')		= NVL(SW.TS_POD_NOD_CD    , 'X')
    AND NVL(SH.RFA_CTRT_TP_CD, 'X')		= NVL(SW.RFA_CTRT_TP_CD    , 'X')
    AND NVL(SH.CMPB_PER_TON_AMT, 0)	= NVL(SW.CMPB_PER_TON_AMT    , 0)
    AND NVL(SH.TON_PER_TEU_WGT, 0)	= NVL(SW.TON_PER_TEU_WGT    , 0)
ORDER BY SH.BKG_ALOC_SEQ, COPY.RN
#end			]]></sql>
			<params>
				<param name="tab_rhq_cd" type="12" value="" out="N"/>
				<param name="bkg_aloc_tp_cd" type="12" value="" out="N"/>
				<param name="lane" type="12" value="" out="N"/>
				<param name="bound" type="12" value="" out="N"/>
				<param name="subtrade" type="12" value="" out="N"/>
				<param name="trade" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
