<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCRateProposalDBDAORsltPriAmdCmViewAllVORSQL">
			<desc><![CDATA[   PRS- S/C Amendment CM/OP View All]]></desc>
			<sql><![CDATA[
/*VO에 pfmc_unit, rate_type 을 추가해야 한다.*/
WITH VW_PRI_SP_SCP_RT_CMDT  AS (
	SELECT 	 CMDT.PROP_NO,CMDT.AMDT_SEQ
		,CMDT.SVC_SCP_CD, CMDT.GEN_SPCL_RT_TP_CD 
		,CMDT.CMDT_HDR_SEQ 
		,SUBSTR(MAX(SYS_CONNECT_BY_PATH(PRC_CMDT_DEF_CD , '; ')),3) AS PRC_CMDT_DEF_CD 
	FROM (
		SELECT PROP_NO,AMDT_SEQ,SVC_SCP_CD
			,GEN_SPCL_RT_TP_CD ,CMDT_HDR_SEQ
			,CMDT_SEQ,PRC_CMDT_DEF_CD
			,ROW_NUMBER() OVER(PARTITION BY PROP_NO
							,AMDT_SEQ
							,SVC_SCP_CD
							,GEN_SPCL_RT_TP_CD 
							,CMDT_HDR_SEQ
						ORDER BY PROP_NO
							,AMDT_SEQ
							,SVC_SCP_CD
							,GEN_SPCL_RT_TP_CD 
							,CMDT_HDR_SEQ
							,CMDT_SEQ) AS RN
		FROM PRI_SP_SCP_RT_CMDT 
		WHERE PROP_NO = @[prop_no]
			AND AMDT_SEQ = @[amdt_seq]
			AND SVC_SCP_CD = @[svc_scp_cd]
#if (${rate_type} != 'B') 
			AND GEN_SPCL_RT_TP_CD = @[rate_type]
#end			
	) CMDT
	START WITH RN = 1 
	CONNECT BY PRIOR CMDT.CMDT_HDR_SEQ = CMDT.CMDT_HDR_SEQ 
		AND PRIOR CMDT.GEN_SPCL_RT_TP_CD = CMDT.GEN_SPCL_RT_TP_CD  
		AND PRIOR  CMDT.RN = CMDT.RN - 1
	GROUP BY CMDT.PROP_NO
		,CMDT.AMDT_SEQ
		,CMDT.SVC_SCP_CD
		,CMDT.GEN_SPCL_RT_TP_CD 
		,CMDT.CMDT_HDR_SEQ
),
VW_PRI_SP_SCP_RT_ROUT_PNT_ORI AS (
 	SELECT  ROUT_PNT.PROP_NO,ROUT_PNT.AMDT_SEQ
		,ROUT_PNT.SVC_SCP_CD, ROUT_PNT.GEN_SPCL_RT_TP_CD 
		,ROUT_PNT.CMDT_HDR_SEQ, ROUT_PNT.ROUT_SEQ
		,ROUT_PNT.ORG_DEST_TP_CD
		, SUBSTR(MAX(SYS_CONNECT_BY_PATH(ROUT_PNT_LOC_DEF_CD || DECODE(TERM_NM,'','','(' || TERM_NM || ')'), '; ')),3) AS ROUT_PNT_LOC_DEF_CD 
	FROM (
		SELECT PROP_NO,AMDT_SEQ	,SVC_SCP_CD
			,GEN_SPCL_RT_TP_CD ,CMDT_HDR_SEQ
			,ROUT_SEQ ,ROUT_PNT_LOC_DEF_CD
			,ORG_DEST_TP_CD
			,ROW_NUMBER() OVER(PARTITION BY PROP_NO
							,AMDT_SEQ
							,SVC_SCP_CD
							,GEN_SPCL_RT_TP_CD 
							,CMDT_HDR_SEQ
							,ROUT_SEQ
							,ORG_DEST_TP_CD
						ORDER BY PROP_NO
							,AMDT_SEQ
							,SVC_SCP_CD
							,GEN_SPCL_RT_TP_CD 
							,CMDT_HDR_SEQ
							,ROUT_PNT_SEQ) AS RN
			,(SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL CODE WHERE CODE.INTG_CD_ID = 'CD02070' AND INTG_CD_VAL_CTNT = RCV_DE_TERM_CD) as TERM_NM   
		FROM PRI_SP_SCP_RT_ROUT_PNT 
		WHERE PROP_NO = @[prop_no]
			AND AMDT_SEQ = @[amdt_seq]
			AND SVC_SCP_CD = @[svc_scp_cd]
			AND ORG_DEST_TP_CD = 'O'
#if (${rate_type} != 'B') 
			AND GEN_SPCL_RT_TP_CD = @[rate_type]
#end		
			
	) ROUT_PNT
	START WITH RN = 1 
	CONNECT BY PRIOR ROUT_PNT.ROUT_SEQ = ROUT_PNT.ROUT_SEQ 
		AND PRIOR ROUT_PNT.ORG_DEST_TP_CD = ROUT_PNT.ORG_DEST_TP_CD 
		AND PRIOR ROUT_PNT.GEN_SPCL_RT_TP_CD = ROUT_PNT.GEN_SPCL_RT_TP_CD  
		AND PRIOR ROUT_PNT.CMDT_HDR_SEQ = ROUT_PNT.CMDT_HDR_SEQ
		AND PRIOR  ROUT_PNT.RN = ROUT_PNT.RN - 1
	GROUP BY ROUT_PNT.PROP_NO
		,ROUT_PNT.AMDT_SEQ
		,ROUT_PNT.SVC_SCP_CD
		,ROUT_PNT.GEN_SPCL_RT_TP_CD 
		,ROUT_PNT.CMDT_HDR_SEQ
		,ROUT_PNT.ROUT_SEQ
		,ROUT_PNT.ORG_DEST_TP_CD
 ),
 VW_PRI_SP_SCP_RT_ROUT_PNT_DEST AS (
 	SELECT  ROUT_PNT.PROP_NO,ROUT_PNT.AMDT_SEQ
		,ROUT_PNT.SVC_SCP_CD, ROUT_PNT.GEN_SPCL_RT_TP_CD 
		,ROUT_PNT.CMDT_HDR_SEQ, ROUT_PNT.ROUT_SEQ
		,ROUT_PNT.ORG_DEST_TP_CD
		, SUBSTR(MAX(SYS_CONNECT_BY_PATH(ROUT_PNT_LOC_DEF_CD || DECODE(TERM_NM,'','','(' || TERM_NM || ')'), '; ')),3) AS ROUT_PNT_LOC_DEF_CD 
	FROM (
		SELECT PROP_NO,AMDT_SEQ	,SVC_SCP_CD
			,GEN_SPCL_RT_TP_CD ,CMDT_HDR_SEQ
			,ROUT_SEQ ,ROUT_PNT_LOC_DEF_CD
			,ORG_DEST_TP_CD
			,ROW_NUMBER() OVER(PARTITION BY PROP_NO
							,AMDT_SEQ
							,SVC_SCP_CD
							,GEN_SPCL_RT_TP_CD 
							,CMDT_HDR_SEQ
							,ROUT_SEQ
							,ORG_DEST_TP_CD
						ORDER BY PROP_NO
							,AMDT_SEQ
							,SVC_SCP_CD
							,GEN_SPCL_RT_TP_CD 
							,CMDT_HDR_SEQ
							,ROUT_PNT_SEQ) AS RN
			,(SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL CODE WHERE CODE.INTG_CD_ID = 'CD02070' AND INTG_CD_VAL_CTNT = RCV_DE_TERM_CD) as TERM_NM 
		FROM PRI_SP_SCP_RT_ROUT_PNT 
		WHERE PROP_NO = @[prop_no]
			AND AMDT_SEQ = @[amdt_seq]
			AND SVC_SCP_CD = @[svc_scp_cd]
			AND ORG_DEST_TP_CD = 'D'
#if (${rate_type} != 'B') 
			AND GEN_SPCL_RT_TP_CD = @[rate_type]
#end	
	) ROUT_PNT
	START WITH RN = 1 
	CONNECT BY PRIOR ROUT_PNT.ROUT_SEQ = ROUT_PNT.ROUT_SEQ 
		AND PRIOR ROUT_PNT.ORG_DEST_TP_CD = ROUT_PNT.ORG_DEST_TP_CD 
		AND PRIOR ROUT_PNT.GEN_SPCL_RT_TP_CD = ROUT_PNT.GEN_SPCL_RT_TP_CD  
		AND PRIOR ROUT_PNT.CMDT_HDR_SEQ = ROUT_PNT.CMDT_HDR_SEQ
		AND PRIOR  ROUT_PNT.RN = ROUT_PNT.RN - 1
	GROUP BY ROUT_PNT.PROP_NO
		,ROUT_PNT.AMDT_SEQ
		,ROUT_PNT.SVC_SCP_CD
		,ROUT_PNT.GEN_SPCL_RT_TP_CD 
		,ROUT_PNT.CMDT_HDR_SEQ
		,ROUT_PNT.ROUT_SEQ
		,ROUT_PNT.ORG_DEST_TP_CD
),
VW_PRI_SP_SCP_RT_ROUT_VIA_ORI AS (
	SELECT 	 ROUT_VIA.PROP_NO,ROUT_VIA.AMDT_SEQ
		,ROUT_VIA.SVC_SCP_CD, ROUT_VIA.GEN_SPCL_RT_TP_CD 
		,ROUT_VIA.CMDT_HDR_SEQ, ROUT_VIA.ROUT_SEQ
		,ROUT_VIA.ORG_DEST_TP_CD
		,SUBSTR(MAX(SYS_CONNECT_BY_PATH(ROUT_VIA_PORT_DEF_CD , '; ')),3) AS ROUT_VIA_PORT_DEF_CD 
	FROM (
		SELECT PROP_NO,AMDT_SEQ,SVC_SCP_CD
			,GEN_SPCL_RT_TP_CD ,CMDT_HDR_SEQ
			,ROUT_SEQ,ROUT_VIA_PORT_DEF_CD
			,ORG_DEST_TP_CD
			,ROW_NUMBER() OVER(PARTITION BY PROP_NO
							,AMDT_SEQ
							,SVC_SCP_CD
							,GEN_SPCL_RT_TP_CD 
							,CMDT_HDR_SEQ
							,ROUT_SEQ
							,ORG_DEST_TP_CD
						ORDER BY PROP_NO
							,AMDT_SEQ
							,SVC_SCP_CD
							,GEN_SPCL_RT_TP_CD 
							,CMDT_HDR_SEQ
							,ROUT_VIA_SEQ) AS RN
		FROM PRI_SP_SCP_RT_ROUT_VIA 
		WHERE PROP_NO = @[prop_no]
			AND AMDT_SEQ = @[amdt_seq]
			AND SVC_SCP_CD = @[svc_scp_cd]
			AND ORG_DEST_TP_CD = 'O'
#if (${rate_type} != 'B') 
			AND GEN_SPCL_RT_TP_CD = @[rate_type]
#end	
	) ROUT_VIA
	START WITH RN = 1 
	CONNECT BY PRIOR ROUT_VIA.ROUT_SEQ = ROUT_VIA.ROUT_SEQ 
		AND PRIOR ROUT_VIA.ORG_DEST_TP_CD = ROUT_VIA.ORG_DEST_TP_CD 
		AND PRIOR ROUT_VIA.GEN_SPCL_RT_TP_CD = ROUT_VIA.GEN_SPCL_RT_TP_CD  
		AND PRIOR ROUT_VIA.CMDT_HDR_SEQ = ROUT_VIA.CMDT_HDR_SEQ
		AND PRIOR  ROUT_VIA.RN = ROUT_VIA.RN - 1
	GROUP BY ROUT_VIA.PROP_NO
		,ROUT_VIA.AMDT_SEQ
		,ROUT_VIA.SVC_SCP_CD
		,ROUT_VIA.GEN_SPCL_RT_TP_CD 
		,ROUT_VIA.CMDT_HDR_SEQ
		,ROUT_VIA.ROUT_SEQ
		,ROUT_VIA.ORG_DEST_TP_CD

),
VW_PRI_SP_SCP_RT_ROUT_VIA_DEST AS (
	SELECT 	 ROUT_VIA.PROP_NO,ROUT_VIA.AMDT_SEQ
		,ROUT_VIA.SVC_SCP_CD, ROUT_VIA.GEN_SPCL_RT_TP_CD 
		,ROUT_VIA.CMDT_HDR_SEQ, ROUT_VIA.ROUT_SEQ
		,ROUT_VIA.ORG_DEST_TP_CD
		,SUBSTR(MAX(SYS_CONNECT_BY_PATH(ROUT_VIA_PORT_DEF_CD , '; ')),3) AS ROUT_VIA_PORT_DEF_CD 
	FROM (
		SELECT PROP_NO,AMDT_SEQ,SVC_SCP_CD
			,GEN_SPCL_RT_TP_CD ,CMDT_HDR_SEQ
			,ROUT_SEQ,ROUT_VIA_PORT_DEF_CD
			,ORG_DEST_TP_CD
			,ROW_NUMBER() OVER(PARTITION BY PROP_NO
							,AMDT_SEQ
							,SVC_SCP_CD
							,GEN_SPCL_RT_TP_CD 
							,CMDT_HDR_SEQ
							,ROUT_SEQ
							,ORG_DEST_TP_CD
						ORDER BY PROP_NO
							,AMDT_SEQ
							,SVC_SCP_CD
							,GEN_SPCL_RT_TP_CD 
							,CMDT_HDR_SEQ
							,ROUT_VIA_SEQ) AS RN
		FROM PRI_SP_SCP_RT_ROUT_VIA 
		WHERE PROP_NO = @[prop_no]
			AND AMDT_SEQ = @[amdt_seq]
			AND SVC_SCP_CD = @[svc_scp_cd]
			AND ORG_DEST_TP_CD = 'D'
#if (${rate_type} != 'B') 
			AND GEN_SPCL_RT_TP_CD = @[rate_type]
#end	
	) ROUT_VIA
	START WITH RN = 1 
	CONNECT BY PRIOR ROUT_VIA.ROUT_SEQ = ROUT_VIA.ROUT_SEQ 
		AND PRIOR ROUT_VIA.ORG_DEST_TP_CD = ROUT_VIA.ORG_DEST_TP_CD 
		AND PRIOR ROUT_VIA.GEN_SPCL_RT_TP_CD = ROUT_VIA.GEN_SPCL_RT_TP_CD  
		AND PRIOR ROUT_VIA.CMDT_HDR_SEQ = ROUT_VIA.CMDT_HDR_SEQ
		AND PRIOR  ROUT_VIA.RN = ROUT_VIA.RN - 1
	GROUP BY ROUT_VIA.PROP_NO
		,ROUT_VIA.AMDT_SEQ
		,ROUT_VIA.SVC_SCP_CD
		,ROUT_VIA.GEN_SPCL_RT_TP_CD 
		,ROUT_VIA.CMDT_HDR_SEQ
		,ROUT_VIA.ROUT_SEQ
		,ROUT_VIA.ORG_DEST_TP_CD

) 
,
VW_PRI_ROUT AS (
	SELECT PROP_NO,AMDT_SEQ,SVC_SCP_CD,GEN_SPCL_RT_TP_CD,CMDT_HDR_SEQ,ROUT_SEQ
		,	MAX(DECODE(TP_CD,1,DEF_CD,NULL))  AS ORI_ROUT_PNT_LOC_DEF_CD
		,	MAX(DECODE(TP_CD,2,DEF_CD,NULL))  AS DST_ROUT_PNT_LOC_DEF_CD
		,	MAX(DECODE(TP_CD,3,DEF_CD,NULL))  AS ORI_ROUT_VIA_PORT_DEF_CD
		,	MAX(DECODE(TP_CD,4,DEF_CD,NULL))  AS DST_ROUT_VIA_PORT_DEF_CD
	FROM (
		SELECT 
			PROP_NO
			,AMDT_SEQ
			,SVC_SCP_CD
			,GEN_SPCL_RT_TP_CD
			,CMDT_HDR_SEQ
			,ROUT_SEQ
			,ORG_DEST_TP_CD
			,ROUT_PNT_LOC_DEF_CD AS DEF_CD
			, 1 AS TP_CD
		FROM 	VW_PRI_SP_SCP_RT_ROUT_PNT_ORI
		UNION ALL
		SELECT 
			PROP_NO
			,AMDT_SEQ
			,SVC_SCP_CD
			,GEN_SPCL_RT_TP_CD
			,CMDT_HDR_SEQ
			,ROUT_SEQ
			,ORG_DEST_TP_CD
			,ROUT_PNT_LOC_DEF_CD
			, 2 AS TP_CD
		FROM 	VW_PRI_SP_SCP_RT_ROUT_PNT_DEST
		UNION ALL
		SELECT 
			PROP_NO
			,AMDT_SEQ
			,SVC_SCP_CD
			,GEN_SPCL_RT_TP_CD
			,CMDT_HDR_SEQ
			,ROUT_SEQ
			,ORG_DEST_TP_CD
			,ROUT_VIA_PORT_DEF_CD
			, 3 AS TP_CD
		FROM 	VW_PRI_SP_SCP_RT_ROUT_VIA_ORI
		UNION ALL
		SELECT 
			PROP_NO
			,AMDT_SEQ
			,SVC_SCP_CD
			,GEN_SPCL_RT_TP_CD
			,CMDT_HDR_SEQ
			,ROUT_SEQ
			,ORG_DEST_TP_CD
			,ROUT_VIA_PORT_DEF_CD
			, 4 AS TP_CD
		FROM 	VW_PRI_SP_SCP_RT_ROUT_VIA_DEST
	)
	GROUP BY PROP_NO,AMDT_SEQ,SVC_SCP_CD,GEN_SPCL_RT_TP_CD,CMDT_HDR_SEQ,ROUT_SEQ
)
SELECT PROP_NO,AMDT_SEQ,SVC_SCP_CD,GEN_SPCL_RT_TP_CD,CMDT_HDR_SEQ,ROUT_SEQ
	,PRC_CMDT_DEF_CD
	,ORI_ROUT_PNT_LOC_DEF_CD
	,DST_ROUT_PNT_LOC_DEF_CD
	,ORI_ROUT_VIA_PORT_DEF_CD
	,DST_ROUT_VIA_PORT_DEF_CD
	,PRS_CRNT_LOD_QTY --ACTUAL - PFMC
	,TO_CHAR(DECODE(TOT_CRNT_LOD_QTY,0,0, ROUND(PRS_CRNT_LOD_QTY / TOT_CRNT_LOD_QTY * 100,2)),'990.99')  || '%' AS CRNT_SHARE  --ACTUAL - Share(%) - 해당 Route Performance의 전체 Performance대비 Share
	,PRS_CRNT_RESPB_CMPB_AMT -- ACTUAL - CMPB
	,PRS_CRNT_LOD_QTY * PRS_CRNT_RESPB_CMPB_AMT AS CRNT_CM-- ACTUAL - CM -  
	,PRS_RMN_LOD_QTY -- Estimate - PFMC
	,TO_CHAR(DECODE(TOT_RMN_LOD_QTY,0,0, ROUND(PRS_RMN_LOD_QTY / TOT_RMN_LOD_QTY * 100,2)),'990.99')  || '%' AS RMN_SHARE -- Estimate - Share(%)  -- 해당 Route Performance의 전체 Performance대비 Share
	,PRS_RMN_RESPB_CMPB_AMT -- Estimate - CMPB
	,PRS_RMN_LOD_QTY * PRS_RMN_RESPB_CMPB_AMT  AS RMN_CM -- Estimate - CM  --  
	,PRS_CRNT_RESPB_OPB_AMT -- -ACTUAL - OPB
	,PRS_CRNT_LOD_QTY *  PRS_CRNT_RESPB_OPB_AMT AS CRNT_OP-- -ACTUAL - OP  --  
	,PRS_RMN_LOD_QTY   -- Estimate - PFMC
	,PRS_RMN_RESPB_CMPB_AMT  -- Estimate - CMPB
	,PRS_RMN_RESPB_OPB_AMT -- Estimate - OPB
	,PRS_RMN_LOD_QTY *  PRS_RMN_RESPB_OPB_AMT AS RMN_OP -- Estimate - OP --  
	,DECODE(GEN_SPCL_RT_TP_CD,'G',1,0) G_RATE_TYPE
	,DECODE(GEN_SPCL_RT_TP_CD,'S',1,0) S_RATE_TYPE
	,PRS_CRNT_LOD_QTY + PRS_RMN_LOD_QTY AS PRS_SUM_LOD_QTY  -- sum pfmc
	,TO_CHAR(DECODE((NVL(TOT_CRNT_LOD_QTY,0)+NVL(TOT_RMN_LOD_QTY,0)),0,0,  ROUND((NVL(PRS_CRNT_LOD_QTY,0) + NVL(PRS_RMN_LOD_QTY,0)) / (NVL(TOT_CRNT_LOD_QTY,0)+NVL(TOT_RMN_LOD_QTY,0)) * 100,2)),'990.99')  || '%' AS SUM_SHARE  -- sum share
	,DECODE((PRS_CRNT_LOD_QTY + PRS_RMN_LOD_QTY),0,0, ((PRS_CRNT_LOD_QTY * PRS_CRNT_RESPB_CMPB_AMT) + (PRS_RMN_LOD_QTY * PRS_RMN_RESPB_CMPB_AMT)) /  (PRS_CRNT_LOD_QTY + PRS_RMN_LOD_QTY)) AS PRS_SUM_CMPB_AMT   -- sum cmpb
	,((PRS_CRNT_LOD_QTY * PRS_CRNT_RESPB_CMPB_AMT) + (PRS_RMN_LOD_QTY * PRS_RMN_RESPB_CMPB_AMT)) AS SUM_CM  -- sum cm
	,DECODE((PRS_CRNT_LOD_QTY + PRS_RMN_LOD_QTY),0,0, ((PRS_CRNT_LOD_QTY *  PRS_CRNT_RESPB_OPB_AMT) + (PRS_RMN_LOD_QTY *  PRS_RMN_RESPB_OPB_AMT)) /  (PRS_CRNT_LOD_QTY + PRS_RMN_LOD_QTY)) AS PRS_SUM_OPB_AMT -- sum opb
	,((PRS_CRNT_LOD_QTY *  PRS_CRNT_RESPB_OPB_AMT) + (PRS_RMN_LOD_QTY *  PRS_RMN_RESPB_OPB_AMT)) AS SUM_OP  -- sum op
	,PRS_RAT_UT_CD
	,CNTR_SZ_CD
	,PRS_RMN_LOD_QTY AS ORI_PRS_RMN_LOD_QTY 
FROM (
        
                        SELECT CR.PROP_NO,CR.AMDT_SEQ,CR.SVC_SCP_CD,CR.GEN_SPCL_RT_TP_CD,CR.CMDT_HDR_SEQ,CR.ROUT_SEQ
                                ,C.PRC_CMDT_DEF_CD
                                ,ROUT.ORI_ROUT_PNT_LOC_DEF_CD
                                ,ROUT.DST_ROUT_PNT_LOC_DEF_CD
                                ,ROUT.ORI_ROUT_VIA_PORT_DEF_CD
                                ,ROUT.DST_ROUT_VIA_PORT_DEF_CD
                                ,CR.PRS_CRNT_LOD_QTY / DECODE(@[pfmc_unit],'FEU',2,'TEU',1) AS  PRS_CRNT_LOD_QTY--ACTUAL - PFMC
                                ,CR.PRS_CRNT_RESPB_CMPB_AMT * DECODE(@[pfmc_unit],'FEU',2,'TEU',1) AS PRS_CRNT_RESPB_CMPB_AMT-- ACTUAL - CMPB
                                ,CR.PRS_RMN_LOD_QTY / DECODE(@[pfmc_unit],'FEU',2,'TEU',1) AS PRS_RMN_LOD_QTY-- Estimate - PFMC
                                ,CR.PRS_RMN_RESPB_CMPB_AMT * DECODE(@[pfmc_unit],'FEU',2,'TEU',1) AS PRS_RMN_RESPB_CMPB_AMT -- Estimate - CMPB
                                ,CR.PRS_CRNT_RESPB_OPB_AMT * DECODE(@[pfmc_unit],'FEU',2,'TEU',1) AS PRS_CRNT_RESPB_OPB_AMT -- ACTUAL - OPB
                                ,CR.PRS_RMN_RESPB_OPB_AMT * DECODE(@[pfmc_unit],'FEU',2,'TEU',1) AS PRS_RMN_RESPB_OPB_AMT-- Estimate - OPB
                                ,SUM(CR.PRS_CRNT_LOD_QTY/DECODE(@[pfmc_unit],'FEU',2,'TEU',1))  OVER( PARTITION BY CR.PROP_NO,CR.AMDT_SEQ,CR.SVC_SCP_CD) AS TOT_CRNT_LOD_QTY
                                ,SUM(CR.PRS_RMN_LOD_QTY/DECODE(@[pfmc_unit],'FEU',2,'TEU',1)) OVER( PARTITION BY CR.PROP_NO,CR.AMDT_SEQ,CR.SVC_SCP_CD) AS TOT_RMN_LOD_QTY
                                ,CR.PRS_RAT_UT_CD
                                ,U.CNTR_SZ_CD
                        FROM PRI_SP_SCP_RT_CMDT_HDR H
                                , VW_PRI_SP_SCP_RT_CMDT C
                                , VW_PRI_ROUT ROUT
                                , PRI_SP_SCP_RT_CMDT_ROUT CR
                                , PRI_RAT_UT U
                        WHERE H.PROP_NO = C.PROP_NO
                                AND H.AMDT_SEQ = C.AMDT_SEQ
                                AND H.SVC_SCP_CD = C.SVC_SCP_CD
                                AND H.GEN_SPCL_RT_TP_CD = C.GEN_SPCL_RT_TP_CD
                                AND H.CMDT_HDR_SEQ = C.CMDT_HDR_SEQ
                                AND H.PROP_NO = ROUT.PROP_NO
                                AND H.AMDT_SEQ = ROUT.AMDT_SEQ
                                AND H.SVC_SCP_CD = ROUT.SVC_SCP_CD
                                AND H.GEN_SPCL_RT_TP_CD = ROUT.GEN_SPCL_RT_TP_CD
                                AND H.CMDT_HDR_SEQ = ROUT.CMDT_HDR_SEQ

                                AND ROUT.PROP_NO = CR.PROP_NO(+)
                                AND ROUT.AMDT_SEQ = CR.AMDT_SEQ(+)
                                AND ROUT.SVC_SCP_CD = CR.SVC_SCP_CD(+)
                                AND ROUT.GEN_SPCL_RT_TP_CD = CR.GEN_SPCL_RT_TP_CD(+)
                                AND ROUT.CMDT_HDR_SEQ = CR.CMDT_HDR_SEQ(+)
                                AND ROUT.ROUT_SEQ = CR.ROUT_SEQ(+)
                                AND CR.PRS_RAT_UT_CD = U.RAT_UT_CD(+)
                                AND H.PROP_NO = @[prop_no]
                                AND H.AMDT_SEQ = @[amdt_seq]
                                AND H.SVC_SCP_CD = @[svc_scp_cd]
 
)
ORDER BY GEN_SPCL_RT_TP_CD			]]></sql>
			<params>
				<param name="prop_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="12" value="" out="N"/>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="rate_type" type="12" value="" out="N"/>
				<param name="pfmc_unit" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
