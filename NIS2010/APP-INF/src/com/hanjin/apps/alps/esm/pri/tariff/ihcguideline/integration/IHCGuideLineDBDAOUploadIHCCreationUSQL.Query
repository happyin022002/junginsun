<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="IHCGuideLineDBDAOUploadIHCCreationUSQL">
			<desc><![CDATA[PRI_TRF_IHC_RT테이블에 업데이트한다.
* History
2013.03.16 [CHM-201534279] 전지예 Pricing Feeder/IHC tariff 45" 칼럼 추가 안]]></desc>
			<sql><![CDATA[
MERGE INTO PRI_TRF_IHC_RT A1
      USING (
             SELECT   @[svc_scp_cd] SVC_SCP_CD
                     ,@[org_dest_tp_cd] ORG_DEST_TP_CD
                     ,@[ihc_trf_no] IHC_TRF_NO                
                     ,@[amdt_seq] AMDT_SEQ
                     ,@[ihc_cgo_tp_cd] IHC_CGO_TP_CD  
                     ,@[pnt_loc_cd] PNT_LOC_CD 
                     ,@[bse_port_loc_cd] BSE_PORT_LOC_CD
                     ,@[hub_loc_cd] HUB_LOC_CD
                     ,@[rcv_de_term_cd] RCV_DE_TERM_CD
                     ,@[prc_trsp_mod_cd] PRC_TRSP_MOD_CD 
                     ,@[gline_20ft_frt_rt_amt] GLINE_20FT_FRT_RT_AMT
                     ,@[gline_40ft_frt_rt_amt] GLINE_40FT_FRT_RT_AMT
                     ,@[gline_45ft_frt_rt_amt] GLINE_45FT_FRT_RT_AMT -- 45' Cost 추가
                     ,@[gline_locl_curr_20ft_amt] GLINE_LOCL_CURR_20FT_AMT
                     ,@[gline_locl_curr_40ft_amt] GLINE_LOCL_CURR_40FT_AMT
                     ,@[gline_locl_curr_45ft_amt] GLINE_LOCL_CURR_45FT_AMT -- 45' Cost 추가
                     ,NVL((SELECT MAX(RT_SEQ) 
                            FROM PRI_TRF_IHC_RT    
                           WHERE SVC_SCP_CD = @[svc_scp_cd] 
                             AND ORG_DEST_TP_CD = @[org_dest_tp_cd] 
                             AND IHC_TRF_NO = @[ihc_trf_no]
                             AND AMDT_SEQ   = @[amdt_seq]
                             AND IHC_CGO_TP_CD = @[ihc_cgo_tp_cd] 
                        GROUP BY SVC_SCP_CD
                                ,ORG_DEST_TP_CD
                                ,IHC_TRF_NO                
                                ,AMDT_SEQ
                                ,IHC_CGO_TP_CD )  
                          ,0)    RT_SEQ
                     ,( SELECT RHQ_CD
                          FROM PRI_TRF_IHC_HDR
                         WHERE SVC_SCP_CD = @[svc_scp_cd] 
                           AND ORG_DEST_TP_CD = @[org_dest_tp_cd] 
                           AND IHC_TRF_NO = @[ihc_trf_no]
                       ) RHQ_CD
               FROM DUAL       
            ) A2
      ON (    A1.SVC_SCP_CD      = A2.SVC_SCP_CD
          AND A1.ORG_DEST_TP_CD  = A2.ORG_DEST_TP_CD
          AND A1.IHC_TRF_NO      = A2.IHC_TRF_NO
          AND A1.AMDT_SEQ        = A2.AMDT_SEQ
          AND A1.IHC_CGO_TP_CD   = A2.IHC_CGO_TP_CD
          AND A1.PNT_LOC_CD      = A2.PNT_LOC_CD
          AND A1.BSE_PORT_LOC_CD = A2.BSE_PORT_LOC_CD
          AND NVL(A1.HUB_LOC_CD, 'N') = NVL(A2.HUB_LOC_CD, 'N')
          AND A1.RCV_DE_TERM_CD  = A2.RCV_DE_TERM_CD
          AND A1.PRC_TRSP_MOD_CD = A2.PRC_TRSP_MOD_CD
          AND A1.OPTM_TRSP_MOD_FLG = 'Y' ) --Optimum flag가 'Y'인 것만 화면에서 조회되므로 'Y'인 것 기준으로 비교함
      WHEN NOT MATCHED THEN
        INSERT 
                   (SVC_SCP_CD
                   ,ORG_DEST_TP_CD
                   ,IHC_TRF_NO
                   ,AMDT_SEQ
                   ,IHC_CGO_TP_CD
                   ,RT_SEQ
                   ,N1ST_CMNC_AMDT_SEQ
                   ,PNT_LOC_CD
                   ,BSE_PORT_LOC_CD
                   ,HUB_LOC_CD
                   ,PNT_NOD_CD
                   ,HUB_NOD_CD
                   ,BSE_PORT_NOD_CD
                   ,IHC_COST_LOC_GRP_NO
                   ,RCV_DE_TERM_CD
                   ,PRC_TRSP_MOD_CD
                   ,GLINE_20FT_FRT_RT_AMT
                   ,GLINE_40FT_FRT_RT_AMT
                   ,GLINE_45FT_FRT_RT_AMT -- 45' Cost 추가
                   ,COST_20FT_FRT_RT_AMT
                   ,COST_40FT_FRT_RT_AMT
                   ,COST_45FT_FRT_RT_AMT -- 45' Cost 추가
                   ,LOCL_CURR_COST_20FT_FRT_RT_AMT
                   ,LOCL_CURR_COST_40FT_FRT_RT_AMT
                   ,LOCL_CURR_COST_45FT_FRT_RT_AMT -- 45' Cost 추가
                   ,TRSP_20FT_COST_AMT
                   ,TRSP_40FT_COST_AMT
                   ,TRSP_45FT_COST_AMT -- 45' Cost 추가
                   ,MTY_TRSP_20FT_COST_AMT
                   ,MTY_TRSP_40FT_COST_AMT
                   ,MTY_TRSP_45FT_COST_AMT -- 45' Cost 추가
                   ,TML_20FT_COST_AMT
                   ,TML_40FT_COST_AMT
                   ,TML_45FT_COST_AMT -- 45' Cost 추가
                   ,MB_20FT_RTO
                   ,MB_40FT_RTO
                   ,MB_45FT_RTO -- 45' Cost 추가
                   ,GLINE_DG_20FT_FRT_RT_AMT
                   ,GLINE_DG_40FT_FRT_RT_AMT
                   ,GLINE_DG_45FT_FRT_RT_AMT -- 45' Cost 추가
                   ,GLINE_OVR_WGT_20FT_FRT_RT_AMT
                   ,GLINE_OVR_WGT_40FT_FRT_RT_AMT
                   ,GLINE_OVR_WGT_45FT_FRT_RT_AMT -- 45' Cost 추가
                   ,ORG_COST_20FT_FRT_RT_AMT
                   ,ORG_COST_40FT_FRT_RT_AMT
                   ,ORG_COST_45FT_FRT_RT_AMT -- 45' Cost 추가
                   ,GLINE_LOCL_CURR_20FT_AMT
                   ,GLINE_LOCL_CURR_40FT_AMT
                   ,GLINE_LOCL_CURR_45FT_AMT -- 45' Cost 추가
                   ,GLINE_LOCL_CURR_DG_20FT_AMT
                   ,GLINE_LOCL_CURR_DG_40FT_AMT
                   ,GLINE_LOCL_CURR_DG_45FT_AMT -- 45' Cost 추가
                   ,GLINE_LOCL_CURR_OVR_20FT_AMT
                   ,GLINE_LOCL_CURR_OVR_40FT_AMT
                   ,GLINE_LOCL_CURR_OVR_45FT_AMT -- 45' Cost 추가
                   ,OPTM_TRSP_MOD_FLG
                   ,SRC_INFO_CD
                   ,IHC_RT_RMK
                   ,DCGO_SVC_FLG
                   ,PRC_TRF_CRE_TP_CD
                   ,CRE_USR_ID
                   ,CRE_DT
                   ,UPD_USR_ID
                   ,UPD_DT
                   ,LOCL_CURR_CD
                   )      
         VALUES
           (@[svc_scp_cd]
           ,@[org_dest_tp_cd]
           ,@[ihc_trf_no]
           ,@[amdt_seq]
           ,@[ihc_cgo_tp_cd]
           ,A2.RT_SEQ +1
           ,0
           ,@[pnt_loc_cd]
           ,@[bse_port_loc_cd]
           ,@[hub_loc_cd]
           ,@[pnt_nod_cd]
           ,@[hub_nod_cd]
           ,@[bse_port_nod_cd]
           ,@[ihc_cost_loc_grp_no]
           ,@[rcv_de_term_cd]
           ,@[prc_trsp_mod_cd]
           ,@[gline_20ft_frt_rt_amt]
           ,@[gline_40ft_frt_rt_amt]
           ,DECODE(RHQ_CD, 'HAMRU', @[gline_45ft_frt_rt_amt], '') -- 45' Cost 추가
           ,@[cost_20ft_frt_rt_amt]
           ,@[cost_40ft_frt_rt_amt]
           ,DECODE(RHQ_CD, 'HAMRU', @[cost_45ft_frt_rt_amt], '') -- 45' Cost 추가
           ,@[locl_curr_cost_20ft_frt_rt_amt]
           ,@[locl_curr_cost_40ft_frt_rt_amt]
           ,DECODE(RHQ_CD, 'HAMRU', @[locl_curr_cost_45ft_frt_rt_amt], '') -- 45' Cost 추가
           ,@[trsp_20ft_cost_amt]
           ,@[trsp_40ft_cost_amt]
           ,DECODE(RHQ_CD, 'HAMRU', @[trsp_45ft_cost_amt], '') -- 45' Cost 추가
           ,@[mty_trsp_20ft_cost_amt]
           ,@[mty_trsp_40ft_cost_amt]
           ,DECODE(RHQ_CD, 'HAMRU', @[mty_trsp_45ft_cost_amt], '') -- 45' Cost 추가
           ,@[tml_20ft_cost_amt]
           ,@[tml_40ft_cost_amt]
           ,DECODE(RHQ_CD, 'HAMRU', @[tml_45ft_cost_amt], '') -- 45' Cost 추가
           ,@[mb_20ft_rto]
           ,@[mb_40ft_rto]
           ,DECODE(RHQ_CD, 'HAMRU', @[mb_45ft_rto], '') -- 45' Cost 추가
           ,@[gline_dg_20ft_frt_rt_amt]
           ,@[gline_dg_40ft_frt_rt_amt]
           ,DECODE(RHQ_CD, 'HAMRU', @[gline_dg_45ft_frt_rt_amt], '') -- 45' Cost 추가
           ,@[gline_ovr_wgt_20ft_frt_rt_amt]
           ,@[gline_ovr_wgt_40ft_frt_rt_amt]
           ,DECODE(RHQ_CD, 'HAMRU', @[gline_ovr_wgt_45ft_frt_rt_amt], '') -- 45' Cost 추가
           ,@[org_cost_20ft_frt_rt_amt]
           ,@[org_cost_40ft_frt_rt_amt]
           ,DECODE(RHQ_CD, 'HAMRU', @[org_cost_45ft_frt_rt_amt], '') -- 45' Cost 추가
           ,@[gline_locl_curr_20ft_amt]
           ,@[gline_locl_curr_40ft_amt]
           ,DECODE(RHQ_CD, 'HAMRU', @[gline_locl_curr_45ft_amt], '') -- 45' Cost 추가
           ,@[gline_locl_curr_dg_20ft_amt]
           ,@[gline_locl_curr_dg_40ft_amt]
           ,DECODE(RHQ_CD, 'HAMRU', @[gline_locl_curr_dg_45ft_amt], '') -- 45' Cost 추가
           ,@[gline_locl_curr_ovr_20ft_amt]
           ,@[gline_locl_curr_ovr_40ft_amt]
           ,DECODE(RHQ_CD, 'HAMRU', @[gline_locl_curr_ovr_45ft_amt], '') -- 45' Cost 추가
           ,'Y' -- 업로드 한 route는 optimum flag를 모두 'Y'로 해줌
           ,'NW'
           ,'Excel upload'
           ,@[dcgo_svc_flg]
           ,'G' -- 기존에 있던 route가 아닌 생성 route, term 일 경우는 'G'로 해줌
           ,@[cre_usr_id]
           ,SYSDATE
           ,@[upd_usr_id]
           ,SYSDATE
           ,@[locl_curr_cd])
       WHEN MATCHED THEN
         UPDATE
            SET A1.GLINE_20FT_FRT_RT_AMT = A2.GLINE_20FT_FRT_RT_AMT
              , A1.GLINE_40FT_FRT_RT_AMT = A2.GLINE_40FT_FRT_RT_AMT
              , A1.GLINE_45FT_FRT_RT_AMT = DECODE(RHQ_CD, 'HAMRU', A2.GLINE_45FT_FRT_RT_AMT, '') -- 45' Cost 추가
              -- LOC CURR에 대해 추가
              , A1.GLINE_LOCL_CURR_20FT_AMT = A2.GLINE_LOCL_CURR_20FT_AMT
              , A1.GLINE_LOCL_CURR_40FT_AMT = A2.GLINE_LOCL_CURR_40FT_AMT
              , A1.GLINE_LOCL_CURR_45FT_AMT = A2.GLINE_LOCL_CURR_45FT_AMT -- 45' Cost 추가
              , A1.SRC_INFO_CD = 'NW', A1.PRC_TRF_CRE_TP_CD = DECODE(A1.PRC_TRF_CRE_TP_CD, 'G', 'G', 'X') -- 생성 route의 경우 엑셀 업로드 후 code를 X로 업데이트 하지 않는다.
              , A1.IHC_RT_RMK = 'Excel upload',A1.UPD_USR_ID = @[upd_usr_id], A1.UPD_DT = SYSDATE			]]></sql>
			<params>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="org_dest_tp_cd" type="12" value="" out="N"/>
				<param name="ihc_trf_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="12" value="" out="N"/>
				<param name="ihc_cgo_tp_cd" type="12" value="" out="N"/>
				<param name="pnt_loc_cd" type="12" value="" out="N"/>
				<param name="bse_port_loc_cd" type="12" value="" out="N"/>
				<param name="hub_loc_cd" type="12" value="" out="N"/>
				<param name="rcv_de_term_cd" type="12" value="" out="N"/>
				<param name="prc_trsp_mod_cd" type="12" value="" out="N"/>
				<param name="gline_20ft_frt_rt_amt" type="12" value="" out="N"/>
				<param name="gline_40ft_frt_rt_amt" type="12" value="" out="N"/>
				<param name="gline_45ft_frt_rt_amt" type="12" value="" out="N"/>
				<param name="gline_locl_curr_20ft_amt" type="12" value="" out="N"/>
				<param name="gline_locl_curr_40ft_amt" type="12" value="" out="N"/>
				<param name="gline_locl_curr_45ft_amt" type="12" value="" out="N"/>
				<param name="pnt_nod_cd" type="12" value="" out="N"/>
				<param name="hub_nod_cd" type="12" value="" out="N"/>
				<param name="bse_port_nod_cd" type="12" value="" out="N"/>
				<param name="ihc_cost_loc_grp_no" type="12" value="" out="N"/>
				<param name="cost_20ft_frt_rt_amt" type="12" value="" out="N"/>
				<param name="cost_40ft_frt_rt_amt" type="12" value="" out="N"/>
				<param name="cost_45ft_frt_rt_amt" type="12" value="" out="N"/>
				<param name="locl_curr_cost_20ft_frt_rt_amt" type="12" value="" out="N"/>
				<param name="locl_curr_cost_40ft_frt_rt_amt" type="12" value="" out="N"/>
				<param name="locl_curr_cost_45ft_frt_rt_amt" type="12" value="" out="N"/>
				<param name="trsp_20ft_cost_amt" type="12" value="" out="N"/>
				<param name="trsp_40ft_cost_amt" type="12" value="" out="N"/>
				<param name="trsp_45ft_cost_amt" type="12" value="" out="N"/>
				<param name="mty_trsp_20ft_cost_amt" type="12" value="" out="N"/>
				<param name="mty_trsp_40ft_cost_amt" type="12" value="" out="N"/>
				<param name="mty_trsp_45ft_cost_amt" type="12" value="" out="N"/>
				<param name="tml_20ft_cost_amt" type="12" value="" out="N"/>
				<param name="tml_40ft_cost_amt" type="12" value="" out="N"/>
				<param name="tml_45ft_cost_amt" type="12" value="" out="N"/>
				<param name="mb_20ft_rto" type="12" value="" out="N"/>
				<param name="mb_40ft_rto" type="12" value="" out="N"/>
				<param name="mb_45ft_rto" type="12" value="" out="N"/>
				<param name="gline_dg_20ft_frt_rt_amt" type="12" value="" out="N"/>
				<param name="gline_dg_40ft_frt_rt_amt" type="12" value="" out="N"/>
				<param name="gline_dg_45ft_frt_rt_amt" type="12" value="" out="N"/>
				<param name="gline_ovr_wgt_20ft_frt_rt_amt" type="12" value="" out="N"/>
				<param name="gline_ovr_wgt_40ft_frt_rt_amt" type="12" value="" out="N"/>
				<param name="gline_ovr_wgt_45ft_frt_rt_amt" type="12" value="" out="N"/>
				<param name="org_cost_20ft_frt_rt_amt" type="12" value="" out="N"/>
				<param name="org_cost_40ft_frt_rt_amt" type="12" value="" out="N"/>
				<param name="org_cost_45ft_frt_rt_amt" type="12" value="" out="N"/>
				<param name="gline_locl_curr_dg_20ft_amt" type="12" value="" out="N"/>
				<param name="gline_locl_curr_dg_40ft_amt" type="12" value="" out="N"/>
				<param name="gline_locl_curr_dg_45ft_amt" type="12" value="" out="N"/>
				<param name="gline_locl_curr_ovr_20ft_amt" type="12" value="" out="N"/>
				<param name="gline_locl_curr_ovr_40ft_amt" type="12" value="" out="N"/>
				<param name="gline_locl_curr_ovr_45ft_amt" type="12" value="" out="N"/>
				<param name="dcgo_svc_flg" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="locl_curr_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
