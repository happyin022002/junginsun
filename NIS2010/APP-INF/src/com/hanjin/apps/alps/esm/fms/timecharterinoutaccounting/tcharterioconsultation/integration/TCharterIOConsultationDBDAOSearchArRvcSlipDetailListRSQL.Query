<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOConsultationDBDAOSearchArRvcSlipDetailListRSQL">
			<desc><![CDATA[AR Reverse 건 조회시]]></desc>
			<sql><![CDATA[
SELECT  A.TO_INV_NO BL_NO,
        'LFC'||LPAD(E.TO_IF_NO+ROWNUM,7,'0') TO_IF_NO,
        SUBSTR(A.TO_INV_NO, 1, 8) INV_NO,
        A.CUST_CNT_CD,
        A.CUST_SEQ,
        A.SLP_TP_CD,
        A.SLP_FUNC_CD,
        A.SLP_OFC_CD,
        A.SLP_ISS_DT,
        A.SLP_SER_NO,
        (SELECT SLP_LOC_CD
         FROM   FMS_CSUL_SLP FS
         WHERE  FS.SLP_TP_CD     = D.SLP_TP_CD
         AND    FS.SLP_FUNC_CD   = D.SLP_FUNC_CD
         AND    FS.SLP_OFC_CD    = D.SLP_OFC_CD
         AND    FS.SLP_ISS_DT    = D.SLP_ISS_DT
         AND    FS.SLP_SER_NO    = D.SLP_SER_NO
         AND    ROWNUM = 1) SLP_LOC_CD,
		D.EFF_DT,
        F.VSL_CD,
        F.SKD_VOY_NO,
        F.SKD_DIR_CD,
        F.REV_DIR_CD,
        TO_CHAR(TO_DATE(D.EFF_DT, 'YYYYMMDD') + 30, 'YYYYMMDD') DUE_DT,
        A.CSR_AMT INV_AMT,
        A.CSR_DESC INV_DESC,
        HJSEAI_PKG.h_encode(A.CSR_DESC   ,'ERP','KR') INV_DESC_ENC,
        A.CSR_CURR_CD CURR_CD,
        A.UPD_USR_ID
FROM    FMS_CSUL_SLP A, FMS_CONSULTATION D,
        (SELECT TO_NUMBER(NVL(MAX(SUBSTR(AR_IF_NO,4,7)),'0')) TO_IF_NO
         FROM   JOO_AR_MN
         WHERE  AR_IF_NO LIKE 'LFC%') E,
        (SELECT VSL_CD, SKD_VOY_NO, SKD_DIR_CD, REV_DIR_CD
         FROM   FMS_CSUL_SLP
         WHERE  SLP_TP_CD 	 = SUBSTR(@[csr_no],1,2)
		 AND	SLP_FUNC_CD  = SUBSTR(@[csr_no],3,1)
		 AND	SLP_OFC_CD 	 = SUBSTR(@[csr_no],4,6)
		 AND	SLP_ISS_DT 	 = SUBSTR(@[csr_no],10,6)
		 AND	SLP_SER_NO 	 = SUBSTR(@[csr_no],16,5)
         AND    ROWNUM       = 1) F
WHERE   A.SLP_TP_CD      = D.SLP_TP_CD
AND		A.SLP_FUNC_CD    = D.SLP_FUNC_CD
AND		A.SLP_OFC_CD     = D.SLP_OFC_CD
AND		A.SLP_ISS_DT     = D.SLP_ISS_DT
AND		A.SLP_SER_NO     = D.SLP_SER_NO
AND		A.ACCT_CD        NOT IN ('512641', '954112', '954111')
AND		A.SLP_TP_CD 	 = SUBSTR(@[csr_no],1,2)
AND		A.SLP_FUNC_CD 	 = SUBSTR(@[csr_no],3,1)
AND		A.SLP_OFC_CD 	 = SUBSTR(@[csr_no],4,6)
AND		A.SLP_ISS_DT 	 = SUBSTR(@[csr_no],10,6)
AND		A.SLP_SER_NO 	 = SUBSTR(@[csr_no],16,5)
AND     D.APRO_FLG       = 'N'
AND     D.CXL_FLG        = 'N'			]]></sql>
			<params>
				<param name="csr_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
