<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingReceiptDBDAOSearchScTypeRSQL">
			<desc><![CDATA[Sc Type 조회
2015.04.01 [CHM-201534662] US Filer type validation 추가 요청 - SC Type이 A이면 Affiliate 의 1개 member의 type 기준
                I(BCO)   : 01(O), 02(O), 03(X)   (기존 validation)
                N(NVO) : 01(X), 02(X), 03(O)   (기존 validation)
                A(Association) - Affiliate BCO : 01(O), 02(O), 03(X)      (추가)
                A(Association) - Affiliate N-BCO : 01(X), 02(X), 03(O)   (추가)
                (Association 의 Affiliate 의 RVIS_CNTR_CUST_TP_CD 는 동일함 전제)]]></desc>
			<sql><![CDATA[
select distinct PRC_CTRT_CUST_TP_CD real_cust_tp_cd
  from pri_sp_hdr hdr
        , pri_sp_mn main
        , pri_sp_ctrt_cust_tp cust
             , (select appl_dt   
                  from 
                (select 1 rank, RT_APLY_DT appl_dt --rate applicable
       #if (${ca_flg}== 'Y')
                from BKG_RT_HIS rt
                  where bkg_no = @[bkg_no]
                       and corr_no = 'TMP0000001'
       #else
                   from bkg_rate r
                  where bkg_no = @[bkg_no]
       #end
                    and rt_aply_dt is not null
                 union all
                 select 3 rank, sysdate appl_dt
                   from dual) 
                 where rownum = 1                  
                 order by rank) appl_dt
 where hdr.prop_no = main.prop_no
   and main.prop_no = cust.prop_no
   and main.amdt_seq = cust.amdt_seq
   and MAIN.eff_dt - 0.0001 < APPL_DT.APPL_DT
   AND MAIN.exp_dt + 0.9999 > APPL_DT.APPL_DT
   and prop_sts_cd = 'F'
   and hdr.sc_no = @[sc_no]
   and rownum = 1
			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
