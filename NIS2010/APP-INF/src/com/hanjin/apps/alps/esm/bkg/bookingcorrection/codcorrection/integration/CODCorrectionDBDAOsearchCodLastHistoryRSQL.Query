<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CODCorrectionDBDAOsearchCodLastHistoryRSQL">
			<desc><![CDATA[마지막으로 변경된 이력을 조회한다.]]></desc>
			<sql><![CDATA[
select cod.cod_sts_cd
        , to_char(his.evnt_dt, 'yyyy-mm-dd') update_date
        , his.upd_usr_id update_by
        , (select ofc_cd from com_user usr where usr.usr_id = his.upd_usr_id) update_ofc
        , decode(his.cod_sts_Cd,null,'',his.cod_sts_Cd    ||':'||(select INTG_CD_VAL_DP_DESC from com_intg_cd_dtl cd where cd.INTG_CD_ID = 'CD02124' and cd.INTG_CD_VAL_CTNT = his.COD_STS_CD)) now_read
        , decode(pre_his.cod_sts_Cd,null,'',pre_his.cod_sts_Cd||':'||(select INTG_CD_VAL_DP_DESC from com_intg_cd_dtl cd where cd.INTG_CD_ID = 'CD02124' and cd.INTG_CD_VAL_CTNT = pre_his.COD_STS_CD)) previous
  from bkg_cod cod, bkg_cod_his his, bkg_cod_his pre_his
 where cod.bkg_no = his.bkg_no
   and cod.cod_rqst_seq = his.cod_rqst_seq
   and his.bkg_no = pre_his.bkg_no(+)
   and his.cod_rqst_seq = pre_his.cod_rqst_seq(+)
   and his.cod_his_Seq - 1 = pre_his.cod_his_seq(+)
   and his.COD_HIS_SEQ = (select max(COD_HIS_SEQ) 
                            from bkg_cod_his his2
                           where his.bkg_no = his2.bkg_no
                             and his.cod_rqst_seq = his2.cod_rqst_seq)
#if (${bkgNo} !='')
   and cod.bkg_no = @[bkgNo]
#end
#if (${codRqstSeq} !='')
   and cod.cod_rqst_Seq =  @[codRqstSeq] 
#end			]]></sql>
			<params>
				<param name="bkgNo" type="12" value="" out="N"/>
				<param name="codRqstSeq" type="2" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
