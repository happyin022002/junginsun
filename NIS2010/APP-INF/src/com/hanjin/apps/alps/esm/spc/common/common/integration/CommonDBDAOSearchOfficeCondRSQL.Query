<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CommonDBDAOSearchOfficeCondRSQL">
			<desc><![CDATA[Office 코드 정보 조회.
2010.12.30 최윤성 [CHM-201008093-01] Office Level Table 생성
 - SPC_ORGANIZATION_V 대신 SPC_OFC_LVL 로 대체
2014.01.23 김시몬 [선반영] RHQ를 MDM_ORGANIZATION에서 SPC_OFC_LVL 로 대체
2015.09.03 이혜민 SHARSC 예외 처리 추가]]></desc>
			<sql><![CDATA[
WITH PARAM AS (
    -- 화면별 CONVERSION된 OFFICE정보를 가져온다(화면별 권한 처리)
    SELECT SPC_SCR_OFC_CONV_FNC(@[ofc_cd], @[ui_name]) AS OFC_CD,
           @[ofc_cd] ORG_OFC_CD
      FROM DUAL
)
  SELECT O.ADM   ,
         SO.N2ND_PRNT_OFC_CD AS RHQ_CD,
         --O.RHQ_CD,
         O.AQ_CD ,
         SO.N4TH_PRNT_OFC_CD AS RGN_OFC_CD,
         O.OFC_CD,
         SO.OFC_TP_CD
    FROM (
            SELECT DECODE(SUM(DECODE(O.OFC_TP_CD, 'HT', 1, 'HG', 1, 0)) * SUM(DECODE(O.OFC_CD, 'SELDC',1,'SELHO', 1, 0)), 0, 'N', 'Y') AS ADM,
                   -- 본사조직이고 컨선SBU의 USER는 ADMIN
                   MAX(DECODE(O.OFC_TP_CD, 'HQ', O.OFC_CD)) AS RHQ_CD    ,
                   MAX(DECODE(O.OFC_TP_CD, 'AQ', O.OFC_CD)) AS AQ_CD     ,
                   MAX(P.OFC_CD)                            AS OFC_CD    ,
                   MAX(P.ORG_OFC_CD)                        AS ORG_OFC_CD
              FROM MDM_ORGANIZATION O,
                   PARAM            P
        CONNECT BY NOCYCLE PRIOR O.PRNT_OFC_CD = O.OFC_CD
                   START WITH O.OFC_CD = P.OFC_CD
         ) O,
         SPC_OFC_LVL SO,
         MAS_WK_PRD  WK
   WHERE SO.OFC_CD = --지역그룹팀의 경우 본인의 타입을 넣어준다(HQ로 인식되는것을 막기 위해)
                     CASE
                          WHEN ORG_OFC_CD IN ( 'HAMRUO',
                                               'HAMRUS',
                                               'HAMRUC',
                                               'SHARCS',
                                               'SHARCO',
                                               'SHARCC'
                                             ) THEN O.ORG_OFC_CD
                                               ELSE O.OFC_CD
                      END
     AND WK.COST_YR || WK.COST_WK BETWEEN SO.OFC_APLY_FM_YRWK AND SO.OFC_APLY_TO_YRWK
     AND TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN WK.SLS_FM_DT AND WK.SLS_TO_DT			]]></sql>
			<params>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="ui_name" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
