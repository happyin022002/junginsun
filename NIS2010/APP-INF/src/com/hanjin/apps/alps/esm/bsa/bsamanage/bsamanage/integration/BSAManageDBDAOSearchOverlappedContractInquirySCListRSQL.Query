<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BSAManageDBDAOSearchOverlappedContractInquirySCListRSQL">
			<desc><![CDATA[중복 계약 조회 (SPACE CHARTERING)]]></desc>
			<sql><![CDATA[
WITH TARGET_AGREE AS
    (
     SELECT 
            DENSE_RANK() OVER(ORDER BY TRD_CD,RLANE_CD,DIR_CD) AS BSA_GROUP,
            BSA_SEQ,
            TRD_CD,
            RLANE_CD,
            DIR_CD,
            VSL_SEQ,
            VVD_CD,
            BSA_FM_DT,
            BSA_TO_DT,
            VSL_CD,
            HJS_FNL_BSA_CAPA,
            HJS_BSA_BFR_SUB_CAPA,
            VSL_BSA_CHK_FLG,
            SCHT_DESC,
            VSL_MLT_INP_FLG
       FROM BSA_SLT_CHTR_BZC
      WHERE BSA_TO_DT >= NVL( REPLACE(@[txtsdate],'-','') ,'19000101')
        AND VSL_BSA_CHK_FLG = 'N'
--    	AND TRD_CD     = 'IAS'
--        AND RLANE_CD   = 'CHSIA'
    )


SELECT DISTINCT 
       A2.BSA_GROUP ,
       A2.BSA_SEQ   ,
       A2.VVD_CD    ,
       A2.BSA_FM_DT ,
       A2.BSA_TO_DT ,
       A2.TRD_CD    ,
       A2.RLANE_CD  ,
       A2.DIR_CD    ,
       
       NULL AS VOP_CD     ,
       NULL AS VSL_CAPA   ,
       --A2.VSL_SEQ   ,
       --A2.HJS_FNL_BSA_CAPA    ,
       --A2.HJS_BSA_BFR_SUB_CAPA,
       --A2.VSL_BSA_CHK_FLG     ,
       --A2.SCHT_DESC      ,
       --A2.VSL_MLT_INP_FLG,
       DECODE(A2.BSA_FM_DT,A2.BSA_TO_DT,'N',DECODE(LEAST(A2.BSA_FM_DT,A2.BSA_TO_DT),A2.BSA_TO_DT,'Y','N')) AS REVERSE_FLG
       
  FROM TARGET_AGREE A1,
       TARGET_AGREE A2
 WHERE A1.BSA_GROUP = A2.BSA_GROUP
   AND A1.TRD_CD    = A2.TRD_CD
   AND A1.RLANE_CD  = A2.RLANE_CD
   AND A1.DIR_CD    = A2.DIR_CD
   AND A1.VSL_SEQ   = A2.VSL_SEQ
   AND (A2.BSA_TO_DT BETWEEN A1.BSA_FM_DT AND A1.BSA_TO_DT  
        OR A2.BSA_FM_DT BETWEEN A1.BSA_FM_DT AND A1.BSA_TO_DT)
   AND A1.BSA_SEQ   < A2.BSA_SEQ    
   AND A1.TRD_CD            = NVL( NULLIF(@[cobtrade], 'All') , A1.TRD_CD)
   AND A1.RLANE_CD 		    = NVL( NULLIF(@[coblane], 'All') , A1.RLANE_CD)
   AND A1.DIR_CD            = NVL( NULLIF(@[cobdir], 'All') ,A1.DIR_CD)
 ORDER BY A2.BSA_GROUP,     
       A2.TRD_CD  ,
       A2.RLANE_CD,
       A2.DIR_CD  ,
       --A2.VSL_SEQ ,
       A2.BSA_SEQ			]]></sql>
			<params>
				<param name="txtsdate" type="12" value="" out="N"/>
				<param name="cobtrade" type="12" value="" out="N"/>
				<param name="coblane" type="12" value="" out="N"/>
				<param name="cobdir" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
