<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EBookingReceiptDBDAOSearchWebServiceSIProcessTypeRSQL">
			<desc><![CDATA[external request 처리를 위해 external rqst의 Job Type, BKG Block Flag, Manual Flag 정보를 조회한다.]]></desc>
			<sql><![CDATA[
WITH TMLIM AS(
SELECT (SELECT CASE WHEN 'KR' = SUBSTR(BK.POL_CD,1,2) AND (SELECT BKG_GET_DCT_COFF_FNC(BK.BKG_NO) FROM DUAL) IS NOT NULL 			
               THEN (SELECT BKG_GET_DCT_COFF_FNC(BK.BKG_NO) FROM DUAL)			
               ELSE NVL(MNL_SET_DT, SYS_SET_DT) END
          FROM BKG_CLZ_TM TM
         WHERE TM.BKG_NO = BK.BKG_NO	
           AND CLZ_TP_CD = 'D') AS DCT_DT		
      ,(SELECT NVL(MNL_SET_DT, SYS_SET_DT) 			
          FROM BKG_CLZ_TM TM			
         WHERE TM.BKG_NO = BK.BKG_NO			
           AND CLZ_TP_CD = 'T') AS CCT_DT
      ,(SELECT ACT_DEP_DT FROM VSK_ACT_PORT_SKD VAP
					WHERE 1=1
					AND VPS.VSL_CD = VAP.VSL_CD
					AND VPS.SKD_VOY_NO = VAP.SKD_VOY_NO
					AND VPS.SKD_DIR_CD = VAP.SKD_DIR_CD
					AND VPS.VPS_PORT_CD = VAP.VPS_PORT_CD
					AND VPS.CLPT_IND_SEQ = VAP.CLPT_IND_SEQ
					AND ROWNUM = 1
				) AS ATD
      ,(SELECT BKG_GET_PORT_CLZ_DT_FNC(BK.BKG_NO) FROM DUAL) PCT_DT
      ,VPS.VPS_ETD_DT AS ETD_DT
      ,VPS.VPS_ETB_DT AS ETB_DT
      ,BLI.OBL_ISS_FLG
      ,BLD.BDR_FLG
      ,POL_ETD_DT    
      ,( SELECT MAX(DTL.DEP_FSH_DT) 
		   FROM PRD_PROD_CTL_ROUT_DTL DTL
		  WHERE BK.PCTL_NO     = DTL.PCTL_NO
 		    AND PCTL_IO_BND_CD  = 'T'
		    AND DTL.TRSP_MOD_CD IN ('VD', 'WD')) AS POD_ETA_DT
      ,DECODE(BK.BKG_STS_CD,'W','Y','X','Y','N') BKG_STS_FLG
      ,( SELECT /*+ INDEX_ASC(VVD XPKBKG_VVD) */ TO_CHAR(SKD.ACT_ARR_DT, 'YYYY-MM-DD HH24:MI:SS')
          FROM BKG_VVD VVD, VSK_ACT_PORT_SKD SKD
         WHERE 1=1
           AND BK.BKG_NO = VVD.BKG_NO
           AND BK.POD_CD = VVD.POD_CD
           AND VVD.VSL_CD = SKD.VSL_CD 
           AND VVD.SKD_VOY_NO = SKD.SKD_VOY_NO
           AND VVD.SKD_DIR_CD = SKD.SKD_DIR_CD
           AND VVD.POD_CD = SKD.VPS_PORT_CD
           AND VVD.POD_CLPT_IND_SEQ = SKD.CLPT_IND_SEQ
           AND VSL_PRE_PST_CD IN ('T','U')
           AND SKD.PORT_SKD_STS_CD = 'A'
           AND ROWNUM=1 ) AS POD_ATA_DT
      ,(SELECT COUNT(*) FROM BKG_CSTMS_ADV_EUR_SND WHERE BL_NO = BK.BL_NO AND EUR_EDI_MSG_TP_ID='ENS' AND SND_DT IS NOT NULL) ADV_EUR_CSTMS
      ,(SELECT COUNT(*) FROM BKG_CSTMS_ADV_JP_SND_LOG WHERE BL_NO = BK.BL_NO AND SND_DT IS NOT NULL) ADV_JP_CSTMS
      ,(SELECT COUNT(*) FROM BKG_CSTMS_ADV_BL WHERE BKG_NO = BK.BKG_NO AND MF_SND_DT IS NOT NULL) ADV_US_CSTMS
      ,(SELECT COUNT(*) FROM BKG_CSTMS_CHN_SND_LOG_BL BL, BKG_CSTMS_CHN_SND_LOG SND WHERE BK.BL_NO = BL.BL_NO AND BL.EDI_REF_ID = SND.EDI_REF_ID AND SND.MF_SND_DT IS NOT NULL) ADV_CN_CSTMS
	  ,(SELECT COUNT(*) FROM BKG_NTC_HIS WHERE BKG_NO = BK.BKG_NO AND NTC_KND_CD = 'IM' AND EDI_ID = 'MEXCUS') ADV_MX_CSTMS
      ,(SELECT COUNT(*) FROM BKG_CSTMS_SRI_VVD WHERE VSL_CD=BK.VSL_CD AND SKD_VOY_NO=BK.SKD_VOY_NO AND SKD_DIR_CD=BK.SKD_DIR_CD AND IO_BND_CD='O' AND SND_DT IS NOT NULL) SRI_CSTMS
      ,(SELECT COUNT(*) FROM BKG_CSTMS_BD_CNTR WHERE BD_CSTMS_BND_CD='O' AND BL_NO=BK.BL_NO) BD_CSTMS
      ,(SELECT COUNT(*) FROM BKG_CSTMS_MM_SND_LOG WHERE CSTMS_BND_CD='O' AND BKG_NO =BK.BKG_NO AND MF_SND_DT IS NOT NULL) MM_CSTMS
      ,(SELECT COUNT(*) FROM BKG_CSTMS_MY_SND_LOG WHERE MY_CSTMS_BND_CD ='E' AND VSL_CD=BK.VSL_CD AND SKD_VOY_NO=BK.SKD_VOY_NO AND SKD_DIR_CD=BK.SKD_DIR_CD AND SND_DT IS NOT NULL) MY_CSTMS
      ,(SELECT COUNT(*) FROM BKG_CSTMS_VN_SND_LOG WHERE VN_CSTMS_BND_CD ='E' AND BKG_NO = BK.BKG_NO AND MF_SND_DT IS NOT NULL) VN_CSTMS
      ,(SELECT COUNT(*) FROM BKG_CSTMS_KR_SND_LOG WHERE BL_NO = BK.BL_NO AND SND_DT IS NOT NULL) KR_CSTMS
      ,(SELECT COUNT(*) FROM BKG_CSTMS_EUR_IO_SND WHERE BND_TP_CD ='O' AND BL_NO =BK.BL_NO AND EUR_EDI_MSG_TP_ID='EXS' AND SND_DT IS NOT NULL) EUR_CSTMS
	  ,BL_NO
 FROM BKG_BOOKING BK
     ,BKG_VVD     VVD
     ,VSK_VSL_PORT_SKD VPS
     ,BKG_BL_ISS BLI
     ,BKG_BL_DOC BLD
WHERE BK.BKG_NO = @[bkg_no]
  AND BK.BKG_NO           =   VVD.BKG_NO
  AND BK.BKG_NO           =   BLI.BKG_NO(+)
  AND BK.BKG_NO           =   BLD.BKG_NO(+)
  AND VPS.VSL_CD          =   VVD.VSL_CD
  AND VPS.SKD_VOY_NO      =   VVD.SKD_VOY_NO
  AND VPS.SKD_DIR_CD      =   VVD.SKD_DIR_CD
  AND VPS.CLPT_IND_SEQ    =   VVD.POL_CLPT_IND_SEQ
  AND VPS.VPS_PORT_CD     =   VVD.POL_CD) 
,XTERMST AS (
SELECT CASE WHEN X.POR_CD !=BK.POR_CD OR X.POR_CD != BL.POR_CD THEN 'Y' 
            WHEN X.POR_NM !=BL.POR_NM THEN 'Y' ELSE 'N' END             AS POR_MOD
      ,CASE WHEN X.PRE_VSL_NM !=BL.PRE_VSL_NM THEN 'Y' ELSE 'N' END     AS PRE_VSL_MOD
      ,CASE WHEN X.VSL_NM !=BL.VSL_NM THEN 'Y' ELSE 'N' END             AS VSL_MOD
      ,CASE WHEN X.POL_CD !=BK.POL_CD OR X.POL_CD != BL.POL_CD THEN 'Y' 
            WHEN X.POL_NM !=BL.POL_NM THEN 'Y' ELSE 'N' END             AS POL_MOD
      ,CASE WHEN X.POD_CD !=BK.POD_CD OR X.POD_CD != BL.POD_CD THEN 'Y' 
            WHEN X.POD_NM !=BL.POD_NM THEN 'Y' ELSE 'N' END             AS POD_MOD
      ,CASE WHEN X.DEL_CD !=BK.DEL_CD OR X.DEL_CD != BL.DEL_CD THEN 'Y' 
            WHEN X.DEL_NM !=BL.DEL_NM THEN 'Y' ELSE 'N' END             AS DEL_MOD
      ,CASE WHEN X.RCV_TERM_CD !=BK.RCV_TERM_CD THEN 'Y' ELSE 'N' END   AS RCV_TERM_MOD
      ,CASE WHEN X.DE_TERM_CD != BK.DE_TERM_CD THEN 'Y' ELSE 'N' END   AS DE_TERM_MOD
      ,CASE WHEN DBMS_LOB.COMPARE(REPLACE(REPLACE(REPLACE(X.MK_DESC, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)), REPLACE(REPLACE(REPLACE(MK.MK_DESC, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10))) != 0 THEN 'Y' ELSE 'N' END AS MK_MOD
      ,CASE WHEN DBMS_LOB.COMPARE(REPLACE(REPLACE(REPLACE(SUBSTR(X.GDS_DESC,REGEXP_INSTR(GDS_DESC,'[[:alpha:]|[:digit:]|[:punct:]]'),BKG_GET_ENTER_FNC(GDS_DESC)), CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)), REPLACE(REPLACE(REPLACE(SUBSTR(MK.CMDT_DESC,REGEXP_INSTR(MK.CMDT_DESC,'[[:alpha:]|[:digit:]|[:punct:]]'),BKG_GET_ENTER_FNC(MK.CMDT_DESC)), CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10))) != 0 THEN 'Y' ELSE 'N' END AS DES_MOD
      ,CASE WHEN X.KR_CSTMS_CUST_TP_CD !=BK.KR_CSTMS_CUST_TP_CD THEN 'Y' ELSE 'N' END AS KR_CSTMS_CUST_TP_MOD
      ,CASE WHEN X.XTER_BL_TP_CD !=BI.RQST_BL_TP_CD THEN 'Y' ELSE 'N' END AS BL_TP_MOD
      ,CASE WHEN X.FRT_TERM_CD !=BR.FRT_TERM_CD THEN 'Y' ELSE 'N' END AS FRT_TERM_MOD
      ,CASE WHEN X.CSTMS_DESC !=BL.CSTMS_DESC THEN 'Y' ELSE 'N' END AS CSTMS_DESC_MOD
      ,CASE WHEN REPLACE(REPLACE(REPLACE(X.XTER_BKG_RMK1, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)) != REPLACE(REPLACE(REPLACE(BK.XTER_RMK, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)) THEN 'Y' ELSE 'N' END AS RMK_MOD
      ,CASE WHEN (SELECT COUNT(*) FROM BKG_CLUZ_LCK WHERE BKG_NO = @[bkg_no] AND DBMS_LOB.INSTR(REPLACE(REPLACE(REPLACE(X.GDS_DESC, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)), CLUZ_LCK_DESC , 1, 1) = 0) > 0 THEN 'Y' ELSE 'N' END AS CLUZ_LCK_FLG
      ,CASE WHEN ESTM_WGT = 0 THEN 'Y' ELSE 'N' END AS WGT_FLG
      ,XTER_SNDR_ID
      ,XTER_RQST_NO
      ,XTER_RQST_SEQ
      ,X.BKG_NO
	  ,X.CMPB_RT_FLG
  FROM BKG_XTER_RQST_MST X
      ,BKG_BOOKING BK
      ,BKG_BL_DOC  BL
      ,BKG_BL_ISS  BI
      ,BKG_RATE    BR
      ,BKG_BL_MK_DESC MK
 WHERE X.XTER_SNDR_ID=@[sender_id]
   AND X.XTER_RQST_NO =@[rqst_no]
   AND X.XTER_RQST_SEQ = @[rqst_seq]
   AND X.BKG_NO = BK.BKG_NO
   AND BK.BKG_NO = BL.BKG_NO
   AND BK.BKG_NO = BI.BKG_NO(+)
   AND BK.BKG_NO = BR.BKG_NO(+)
   AND BK.BKG_NO = MK.BKG_NO(+)
)
,XTERCUST AS (
SELECT CASE WHEN REPLACE(REPLACE(REPLACE(XC1.CUST_NM, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)) != REPLACE(REPLACE(REPLACE(BC1.CUST_NM, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)) THEN 'Y' ELSE 'N' END AS SH_NM_MOD
      ,CASE WHEN REPLACE(REPLACE(REPLACE(XC1.CUST_ADDR, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)) != REPLACE(REPLACE(REPLACE(BC1.CUST_ADDR, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)) THEN 'Y' ELSE 'N' END AS SH_ADDR_MOD
      ,CASE WHEN XC1.LOC_CTNT != BC1.CSTMS_DECL_CNT_CD THEN 'Y' ELSE 'N' END AS SH_CTRY_MOD
      ,CASE WHEN XC1.PST_CTNT != BC1.CUST_ZIP_ID THEN 'Y' ELSE 'N' END AS SH_ZIP_MOD
      ,CASE WHEN XC1.EORI_NO != BC1.CUST_CTY_NM THEN 'Y' ELSE 'N' END AS SH_EORI_MOD
      ,CASE WHEN XC1.LOC_NM != BC1.CUST_CTY_NM THEN 'Y' ELSE 'N' END AS SH_CITY_MOD
      ,CASE WHEN XC1.STE_CD != BC1.CUST_STE_CD THEN 'Y' ELSE 'N' END AS SH_STE_MOD
      ,CASE WHEN XC1.EUR_CSTMS_ST_NM != BC1.EUR_CSTMS_ST_NM THEN 'Y' ELSE 'N' END AS SH_ST_MOD
      ,CASE WHEN XC1.MX_TAX_ID != MX.MX_SHPR_TAX_ID THEN 'Y' ELSE 'N' END AS MX_SHPR_TAX_ID_MOD 
      ,CASE WHEN XC1.TR_TAX_ID != MX.TR_SHPR_TAX_ID THEN 'Y' ELSE 'N' END AS TR_SHPR_TAX_ID_MOD 
      ,CASE WHEN XC1.IL_TAX_ID != MX.IL_SHPR_TAX_ID THEN 'Y' ELSE 'N' END AS IL_SHPR_TAX_ID_MOD 
      ,CASE WHEN XC1.LB_TAX_ID != MX.LB_SHPR_TAX_ID THEN 'Y' ELSE 'N' END AS LB_SHPR_TAX_ID_MOD 
      ,CASE WHEN XC1.BRZ_TAX_ID != MX.SHPR_TAX_NO THEN 'Y' ELSE 'N' END AS BRZ_SHPR_TAX_ID_MOD
      ,CASE WHEN REPLACE(REPLACE(REPLACE(XC2.CUST_NM, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)) != REPLACE(REPLACE(REPLACE(BC2.CUST_NM, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)) THEN 'Y' ELSE 'N' END AS CN_NM_MOD
      ,CASE WHEN REPLACE(REPLACE(REPLACE(XC2.CUST_ADDR, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)) != REPLACE(REPLACE(REPLACE(BC2.CUST_ADDR, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)) THEN 'Y' ELSE 'N' END AS CN_ADDR_MOD
      ,CASE WHEN XC2.LOC_CTNT != BC2.CSTMS_DECL_CNT_CD THEN 'Y' ELSE 'N' END AS CN_CTRY_MOD
      ,CASE WHEN XC2.PST_CTNT != BC2.CUST_ZIP_ID THEN 'Y' ELSE 'N' END AS CN_ZIP_MOD
      ,CASE WHEN XC2.EORI_NO != BC2.CUST_CTY_NM THEN 'Y' ELSE 'N' END AS CN_EORI_MOD
      ,CASE WHEN XC2.LOC_NM != BC2.CUST_CTY_NM THEN 'Y' ELSE 'N' END AS CN_CITY_MOD
      ,CASE WHEN XC2.STE_CD != BC2.CUST_STE_CD THEN 'Y' ELSE 'N' END AS CN_STE_MOD
      ,CASE WHEN XC2.EUR_CSTMS_ST_NM != BC2.EUR_CSTMS_ST_NM THEN 'Y' ELSE 'N' END AS CN_ST_MOD
      ,CASE WHEN XC2.MX_TAX_ID != MX.MX_CNEE_TAX_ID THEN 'Y' ELSE 'N' END AS MX_CNEE_TAX_ID_MOD 
      ,CASE WHEN XC2.TR_TAX_ID != MX.TR_CNEE_TAX_ID THEN 'Y' ELSE 'N' END AS TR_CNEE_TAX_ID_MOD 
      ,CASE WHEN XC2.IL_TAX_ID != MX.IL_CNEE_TAX_ID THEN 'Y' ELSE 'N' END AS IL_CNEE_TAX_ID_MOD 
      ,CASE WHEN XC2.LB_TAX_ID != MX.LB_CNEE_TAX_ID THEN 'Y' ELSE 'N' END AS LB_CNEE_TAX_ID_MOD 
      ,CASE WHEN XC2.BRZ_TAX_ID != MX.CNEE_TAX_NO THEN 'Y' ELSE 'N' END AS BRZ_CNEE_TAX_ID_MOD       
      ,CASE WHEN REPLACE(REPLACE(REPLACE(XC3.CUST_NM, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)) != REPLACE(REPLACE(REPLACE(BC3.CUST_NM, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)) THEN 'Y' ELSE 'N' END AS NF_NM_MOD
      ,CASE WHEN REPLACE(REPLACE(REPLACE(XC3.CUST_ADDR, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)) != REPLACE(REPLACE(REPLACE(BC3.CUST_ADDR, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)) THEN 'Y' ELSE 'N' END AS NF_ADDR_MOD
      ,CASE WHEN XC3.LOC_CTNT != BC3.CSTMS_DECL_CNT_CD THEN 'Y' ELSE 'N' END AS NF_CTRY_MOD
      ,CASE WHEN XC3.PST_CTNT != BC3.CUST_ZIP_ID THEN 'Y' ELSE 'N' END AS NF_ZIP_MOD
      ,CASE WHEN XC3.EORI_NO != BC3.CUST_CTY_NM THEN 'Y' ELSE 'N' END AS NF_EORI_MOD
      ,CASE WHEN XC3.LOC_NM != BC3.CUST_CTY_NM THEN 'Y' ELSE 'N' END AS NF_CITY_MOD
      ,CASE WHEN XC3.STE_CD != BC3.CUST_STE_CD THEN 'Y' ELSE 'N' END AS NF_STE_MOD
      ,CASE WHEN XC3.EUR_CSTMS_ST_NM != BC3.EUR_CSTMS_ST_NM THEN 'Y' ELSE 'N' END AS NF_ST_MOD
      ,CASE WHEN XC3.MX_TAX_ID != MX.MX_NTFY_TAX_ID THEN 'Y' ELSE 'N' END AS MX_NTFY_TAX_ID_MOD 
      ,CASE WHEN XC3.TR_TAX_ID != MX.TR_NTFY_TAX_ID THEN 'Y' ELSE 'N' END AS TR_NTFY_TAX_ID_MOD 
      ,CASE WHEN XC3.IL_TAX_ID != MX.IL_NTFY_TAX_ID THEN 'Y' ELSE 'N' END AS IL_NTFY_TAX_ID_MOD 
      ,CASE WHEN XC3.LB_TAX_ID != MX.LB_NTFY_TAX_ID THEN 'Y' ELSE 'N' END AS LB_NTFY_TAX_ID_MOD 
      ,CASE WHEN XC3.BRZ_TAX_ID != MX.NTFY_TAX_NO THEN 'Y' ELSE 'N' END AS BRZ_NTFY_TAX_ID_MOD       
      ,CASE WHEN REPLACE(REPLACE(REPLACE(XC4.CUST_NM, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)) != REPLACE(REPLACE(REPLACE(BC4.CUST_NM, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)) THEN 'Y' ELSE 'N' END AS FF_NM_MOD
      ,CASE WHEN REPLACE(REPLACE(REPLACE(XC5.CUST_NM, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)) != REPLACE(REPLACE(REPLACE(BC5.CUST_NM, CHR(13)||CHR(10), CHR(13)), CHR(10), CHR(13)), CHR(13), CHR(13)||CHR(10)) THEN 'Y' ELSE 'N' END AS AN_NM_MOD
	  ,CASE WHEN (XM.POR_CD LIKE 'IR%' OR XM.POL_CD LIKE 'IR%' OR XM.POD_CD LIKE 'IR%' OR XM.DEL_CD LIKE 'IR%') AND INSTR(UPPER(XC2.CUST_NM), 'ORDER') > 0 THEN 'Y' ELSE 'N' END AS IR_TO_ORD_FLG
  FROM BKG_XTER_RQST_MST XM
      ,BKG_XTER_CUST XC1
      ,BKG_CUSTOMER BC1
      ,BKG_XTER_CUST XC2
      ,BKG_CUSTOMER BC2
      ,BKG_XTER_CUST XC3
      ,BKG_CUSTOMER BC3
      ,BKG_XTER_CUST XC4
      ,BKG_CUSTOMER BC4
      ,BKG_XTER_CUST XC5
      ,BKG_CUSTOMER BC5
      ,BKG_XPT_IMP_LIC MX
      ,BKG_XPT_IMP_LIC TR
      ,BKG_XPT_IMP_LIC IL
      ,BKG_XPT_IMP_LIC LB
      ,BKG_XPT_IMP_LIC BR
 WHERE XM.XTER_SNDR_ID=@[sender_id]
   AND XM.XTER_RQST_NO =@[rqst_no]   
   AND XM.XTER_RQST_SEQ = @[rqst_seq]
   AND XM.XTER_SNDR_ID= XC1.XTER_SNDR_ID(+)
   AND XM.XTER_RQST_NO = XC1.XTER_RQST_NO(+)
   AND XM.XTER_RQST_SEQ = XC1.XTER_RQST_SEQ(+)   
   AND XC1.XTER_CUST_TP_CD(+) ='S'
   AND XM.BKG_NO = BC1.BKG_NO(+)
   AND BC1.BKG_CUST_TP_CD(+) ='S'
   AND XM.XTER_SNDR_ID= XC2.XTER_SNDR_ID(+)
   AND XM.XTER_RQST_NO = XC2.XTER_RQST_NO(+)
   AND XM.XTER_RQST_SEQ = XC2.XTER_RQST_SEQ(+)   
   AND XC2.XTER_CUST_TP_CD(+) ='C'
   AND XM.BKG_NO = BC2.BKG_NO(+)
   AND BC2.BKG_CUST_TP_CD(+) ='C'
   AND XM.XTER_SNDR_ID= XC3.XTER_SNDR_ID(+)
   AND XM.XTER_RQST_NO = XC3.XTER_RQST_NO(+)
   AND XM.XTER_RQST_SEQ = XC3.XTER_RQST_SEQ(+)   
   AND XC3.XTER_CUST_TP_CD(+) ='N'
   AND XM.BKG_NO = BC3.BKG_NO(+)
   AND BC3.BKG_CUST_TP_CD(+) ='N'
   AND XM.XTER_SNDR_ID= XC4.XTER_SNDR_ID(+)
   AND XM.XTER_RQST_NO = XC4.XTER_RQST_NO(+)
   AND XM.XTER_RQST_SEQ = XC4.XTER_RQST_SEQ(+)   
   AND XC4.XTER_CUST_TP_CD(+) ='F'
   AND XM.BKG_NO = BC4.BKG_NO(+)
   AND BC4.BKG_CUST_TP_CD(+) ='F'
   AND XM.XTER_SNDR_ID= XC5.XTER_SNDR_ID(+)
   AND XM.XTER_RQST_NO = XC5.XTER_RQST_NO(+)
   AND XM.XTER_RQST_SEQ = XC5.XTER_RQST_SEQ(+)   
   AND XC5.XTER_CUST_TP_CD(+) ='A'
   AND XM.BKG_NO = BC5.BKG_NO(+)
   AND BC5.BKG_CUST_TP_CD(+) ='A'
   AND XM.BKG_NO = MX.BKG_NO(+)
   AND MX.CNT_CD(+) = 'MX'
   AND XM.BKG_NO = TR.BKG_NO(+)
   AND TR.CNT_CD(+) = 'TR'
   AND XM.BKG_NO = IL.BKG_NO(+)
   AND IL.CNT_CD(+) = 'IL'
   AND XM.BKG_NO = LB.BKG_NO(+)
   AND LB.CNT_CD(+) = 'LB'
   AND XM.BKG_NO = BR.BKG_NO(+)
   AND BR.CNT_CD(+) = 'BR' 
)
,XTERAES AS (
SELECT CASE WHEN XA.AES_INLND_TRNS_NO != BX.AES_INLND_TRNS_NO THEN 'Y' 
             WHEN XA.AES_PTA_NO1 != BX.AES_PTA_NO1 THEN 'Y' 
             WHEN XA.AES_PTA_NO2 != BX.AES_PTA_NO2 THEN 'Y' 
             WHEN XA.AES_PTA_DT != BX.AES_PTA_DT THEN 'Y' 
             WHEN XA.AES_PTU_NO != BX.AES_PTU_NO THEN 'Y'
             WHEN XA.AES_PTU_DT != BX.AES_PTU_DT THEN 'Y'
             WHEN XA.AES_DWN_NO != BX.AES_DWN_DT THEN 'Y'
             WHEN XA.AES_EXPT_CTNT != BX.AES_EXPT_CTNT THEN 'Y'
             WHEN XA.VIN_CTNT != BX.VIN_CTNT THEN 'Y'
             ELSE 'N' END AS AES_MOD
   FROM BKG_XTER_RQST_MST XM
       ,BKG_XTER_AES XA
       ,(SELECT BKG_NO
               ,AES_INLND_TRNS_NO
               ,AES_PTA_NO1,AES_PTA_NO2,AES_PTA_DT
               ,AES_PTU_NO,AES_PTU_DT
               ,AES_DWN_NO,AES_DWN_DT
               ,AES_EXPT_CTNT
               ,VIN_CTNT 
          FROM BKG_XPT_IMP_LIC A
         WHERE BKG_NO = (SELECT BKG_NO FROM BKG_XTER_RQST_MST WHERE XTER_SNDR_ID=@[sender_id] AND XTER_RQST_NO =@[rqst_no] AND XTER_RQST_SEQ = @[rqst_seq]) 
           AND CNT_CD = 'US'
           AND IO_BND_CD = 'O'
           AND XPT_IMP_SEQ = (SELECT MAX(XPT_IMP_SEQ) FROM BKG_XPT_IMP_LIC WHERE BKG_NO = A.BKG_NO AND CNT_CD='US' AND IO_BND_CD='O')) BX
  WHERE XM.XTER_SNDR_ID=@[sender_id]
    AND XM.XTER_RQST_NO =@[rqst_no]   
    AND XM.XTER_RQST_SEQ = @[rqst_seq]
    AND XM.XTER_SNDR_ID= XA.XTER_SNDR_ID(+)
    AND XM.XTER_RQST_NO = XA.XTER_RQST_NO(+)
    AND XM.XTER_RQST_SEQ = XA.XTER_RQST_SEQ(+)
    AND XM.BKG_NO = BX.BKG_NO(+)   
)
,XTERCAED AS (
SELECT CASE WHEN XC.CAED_CTNT1 != BX.CAED_NO1 THEN 'Y' 
             WHEN XC.CAED_CTNT2 != BX.CAED_NO2 THEN 'Y' 
             WHEN XC.CAED_CTNT3 != BX.CAED_NO3 THEN 'Y' 
             WHEN XC.G7_EDI_CTNT1 != BX.G7_EDI_NO1 THEN 'Y' 
             WHEN XC.G7_EDI_CTNT2 != BX.G7_EDI_NO2 THEN 'Y'
             WHEN XC.SMRY_RPT_CTNT1 != BX.MF_SMRY_RPT_PFX_CTNT THEN 'Y'
             WHEN XC.SMRY_RPT_CTNT2 != BX.MF_SMRY_RPT_NO THEN 'Y'
             WHEN XC.B13A_DT != BX.B13A_XPT_DT THEN 'Y'
             WHEN XC.B13A_CTNT1 != BX.B13A_XPT_NO1 THEN 'Y'
             WHEN XC.B13A_CTNT2 != BX.B13A_XPT_NO2 THEN 'Y'
             WHEN XC.INLND_TZ_CGO_CTNT != BX.CGO_CTRL_NO THEN 'Y'
             WHEN XC.NON_DECL_CTNT != BX.NDR_REF_ID||BX.NDR_REF_CTNT THEN 'Y'
             ELSE 'N' END AS CAED_MOD
   FROM BKG_XTER_RQST_MST XM
       ,BKG_XTER_CAED XC
       ,(SELECT BKG_NO,CAED_NO1,CAED_NO2,CAED_NO3
               ,G7_EDI_NO1,G7_EDI_NO2
               ,MF_SMRY_RPT_PFX_CTNT,MF_SMRY_RPT_NO
               ,B13A_XPT_DT,B13A_XPT_NO1,B13A_XPT_NO2
               ,CGO_CTRL_NO
               ,NDR_REF_ID,NDR_REF_CTNT
          FROM BKG_XPT_IMP_LIC A
         WHERE BKG_NO = (SELECT BKG_NO FROM BKG_XTER_RQST_MST WHERE XTER_SNDR_ID=@[sender_id] AND XTER_RQST_NO =@[rqst_no] AND XTER_RQST_SEQ = @[rqst_seq]) 
           AND CNT_CD = 'CA'
           AND IO_BND_CD = 'O'
           AND XPT_IMP_SEQ = (SELECT MAX(XPT_IMP_SEQ) FROM BKG_XPT_IMP_LIC WHERE BKG_NO = A.BKG_NO AND CNT_CD='CA' AND IO_BND_CD='O')) BX
  WHERE XM.XTER_SNDR_ID=@[sender_id]
    AND XM.XTER_RQST_NO =@[rqst_no]   
    AND XM.XTER_RQST_SEQ = @[rqst_seq]
    AND XM.XTER_SNDR_ID= XC.XTER_SNDR_ID(+)
    AND XM.XTER_RQST_NO = XC.XTER_RQST_NO(+)
    AND XM.XTER_RQST_SEQ = XC.XTER_RQST_SEQ(+)
    AND XM.BKG_NO = BX.BKG_NO(+)
)
,XTERCNTR AS (
SELECT 
		case when (
 select count(*) from bkg_xter_rqst_mst  
                         WHERE XTER_SNDR_ID=@[sender_id]
                           AND XTER_RQST_NO =@[rqst_no] 
                           AND XTER_RQST_SEQ = @[rqst_seq]
                           and por_cd like 'KR%' ) < 1
                           THEN 'N' ELSE case when 
                           (SELECT count(*)
                          FROM BKG_XTER_CNTR 
                         WHERE XTER_SNDR_ID=@[sender_id]
                           AND XTER_RQST_NO =@[rqst_no] 
                           AND XTER_RQST_SEQ = @[rqst_seq]
                           and CNTR_NO is not null and PCK_QTY is not null and PCK_TP_CD is not null and CNTR_WGT is not null and WGT_UT_CD is not null and MEAS_QTY is not null and MEAS_UT_CD is not null
                           ) > 0 THEN 'N' ELSE 'Y' END END as CNTR_KR_MNL,
		CASE WHEN (SELECT COUNT(*) FROM BKG_CONTAINER WHERE BKG_NO = @[bkg_no]) > 0 AND 
                (SELECT COUNT(*) 
                  FROM (
                        SELECT CNTR_NO,SOC_FLG
                          FROM BKG_XTER_CNTR 
                         WHERE XTER_SNDR_ID=@[sender_id]
                           AND XTER_RQST_NO =@[rqst_no]   
                           AND XTER_RQST_SEQ = @[rqst_seq]
                        MINUS  
                        SELECT CNTR_NO,SOC_FLG
                          FROM BKG_CONTAINER 
                         WHERE BKG_NO =@[bkg_no]
                        UNION 
                        SELECT CNTR_NO,SOC_FLG
                          FROM BKG_CONTAINER 
                         WHERE BKG_NO =@[bkg_no]
                        MINUS
                        SELECT CNTR_NO,SOC_FLG
                          FROM BKG_XTER_CNTR 
                         WHERE XTER_SNDR_ID=@[sender_id]
                           AND XTER_RQST_NO =@[rqst_no]   
                           AND XTER_RQST_SEQ = @[rqst_seq])) > 0 THEN 'Y' ELSE 'N' END AS CNTR_NO_MOD
       ,CASE WHEN (SELECT COUNT(*) FROM BKG_CONTAINER WHERE BKG_NO = @[bkg_no]) > 0 AND 
                (SELECT COUNT(*) 
                  FROM (
                        SELECT CNTR_NO,PCK_QTY,PCK_TP_CD,CNTR_WGT,WGT_UT_CD,MEAS_QTY,MEAS_UT_CD
                          FROM BKG_XTER_CNTR 
                         WHERE XTER_SNDR_ID=@[sender_id]
                           AND XTER_RQST_NO =@[rqst_no]   
                           AND XTER_RQST_SEQ = @[rqst_seq]
                        MINUS  
                        SELECT CNTR_NO,PCK_QTY,PCK_TP_CD,CNTR_WGT,WGT_UT_CD,MEAS_QTY,MEAS_UT_CD 
                          FROM BKG_CONTAINER 
                         WHERE BKG_NO =@[bkg_no]
                        UNION 
                        SELECT CNTR_NO,PCK_QTY,PCK_TP_CD,CNTR_WGT,WGT_UT_CD,MEAS_QTY,MEAS_UT_CD 
                          FROM BKG_CONTAINER 
                         WHERE BKG_NO =@[bkg_no]
                        MINUS
                        SELECT CNTR_NO,PCK_QTY,PCK_TP_CD,CNTR_WGT,WGT_UT_CD,MEAS_QTY,MEAS_UT_CD
                          FROM BKG_XTER_CNTR 
                         WHERE XTER_SNDR_ID=@[sender_id]
                           AND XTER_RQST_NO =@[rqst_no]   
                           AND XTER_RQST_SEQ = @[rqst_seq])) > 0 THEN 'Y' ELSE 'N' END AS CNTR_QTY_MOD
      ,CASE WHEN (SELECT COUNT(*) FROM BKG_CONTAINER WHERE BKG_NO = @[bkg_no]) > 0 AND 
                (SELECT COUNT(*) 
                  FROM (SELECT CNTR_NO, XTER_CNTR_SEAL_NO 
                          FROM BKG_XTER_CNTR_SEAL_NO
                         WHERE XTER_SNDR_ID=@[sender_id]
                           AND XTER_RQST_NO =@[rqst_no]   
                           AND XTER_RQST_SEQ = @[rqst_seq]
                         MINUS 
                         SELECT CNTR_NO,CNTR_SEAL_NO
                          FROM BKG_CNTR_SEAL_NO 
                         WHERE BKG_NO =@[bkg_no]
                         UNION 
                         SELECT CNTR_NO,CNTR_SEAL_NO
                          FROM BKG_CNTR_SEAL_NO 
                         WHERE BKG_NO =@[bkg_no]
                         MINUS
                         SELECT CNTR_NO, XTER_CNTR_SEAL_NO 
                          FROM BKG_XTER_CNTR_SEAL_NO
                         WHERE XTER_SNDR_ID=@[sender_id]
                           AND XTER_RQST_NO =@[rqst_no]   
                           AND XTER_RQST_SEQ = @[rqst_seq])) > 0 THEN 'Y' ELSE 'N' END AS CNTR_SEAL_MOD
     ,CASE WHEN (SELECT COUNT(*) FROM BKG_CONTAINER WHERE BKG_NO = @[bkg_no]) > 0 AND 
                (SELECT COUNT(*) 
                  FROM (SELECT PCK_QTY,PCK_TP_CD, CNTR_MF_WGT,WGT_UT_CD, HAMO_TRF_CTNT, CMDT_HS_CD
                          FROM BKG_XTER_CNTR_MK_DESC
                         WHERE XTER_SNDR_ID=@[sender_id]
                           AND XTER_RQST_NO =@[rqst_no]   
                           AND XTER_RQST_SEQ = @[rqst_seq]
                         MINUS 
                         SELECT PCK_QTY,PCK_TP_CD, CNTR_MF_WGT,WGT_UT_CD, HAMO_TRF_CD, CMDT_HS_CD
                          FROM BKG_CNTR_MF_DESC 
                         WHERE BKG_NO =@[bkg_no]
                         UNION
                         SELECT PCK_QTY,PCK_TP_CD, CNTR_MF_WGT,WGT_UT_CD, HAMO_TRF_CD, CMDT_HS_CD
                          FROM BKG_CNTR_MF_DESC 
                         WHERE BKG_NO =@[bkg_no]
                         MINUS
                         SELECT PCK_QTY,PCK_TP_CD, CNTR_MF_WGT,WGT_UT_CD, HAMO_TRF_CTNT, CMDT_HS_CD
                           FROM BKG_XTER_CNTR_MK_DESC
                          WHERE XTER_SNDR_ID=@[sender_id]
                            AND XTER_RQST_NO =@[rqst_no]   
                            AND XTER_RQST_SEQ = @[rqst_seq])) > 0 THEN 'Y' ELSE 'N' END AS CNTR_MF_MOD  
     ,CASE WHEN (SELECT COUNT(*) FROM BKG_CONTAINER WHERE BKG_NO = @[bkg_no]) > 0 AND 
                (SELECT COUNT(*) 
                  FROM (SELECT NCM_NO
                          FROM BKG_XTER_CNTR_MK_DESC_NCM
                         WHERE XTER_SNDR_ID=@[sender_id]
                           AND XTER_RQST_NO =@[rqst_no]   
                           AND XTER_RQST_SEQ = @[rqst_seq]
                         MINUS
                        SELECT NCM_NO
                          FROM BKG_CNTR_MF_DESC_DTL
                         WHERE BKG_NO =@[bkg_no]
                        UNION
                        SELECT NCM_NO
                          FROM BKG_CNTR_MF_DESC_DTL
                         WHERE BKG_NO =@[bkg_no]
                         MINUS
                        SELECT NCM_NO
                          FROM BKG_XTER_CNTR_MK_DESC_NCM
                         WHERE XTER_SNDR_ID=@[sender_id]
                           AND XTER_RQST_NO =@[rqst_no]   
                           AND XTER_RQST_SEQ = @[rqst_seq])) > 0 THEN 'Y' ELSE 'N' END AS CNTR_NCM_MOD  
	, CASE WHEN (SELECT COUNT(*) 
                   FROM BKG_XTER_CNTR 
                  WHERE XTER_SNDR_ID=@[sender_id]
                    AND XTER_RQST_NO =@[rqst_no]   
                    AND XTER_RQST_SEQ = @[rqst_seq]) <> (SELECT SUM(OP_CNTR_QTY) FROM BKG_QUANTITY WHERE BKG_NO =@[bkg_no]) 
            AND (SELECT COUNT(*) 
                   FROM BKG_XTER_CNTR 
                  WHERE XTER_SNDR_ID=@[sender_id]
                    AND XTER_RQST_NO =@[rqst_no]   
                    AND XTER_RQST_SEQ = @[rqst_seq]) > 0 THEN 'Y' ELSE 'N' END AS BKG_QTY_MOD     
 FROM DUAL 
)
,XTERLIC AS (
SELECT CASE WHEN (SELECT COUNT(*) 
                  FROM (
                        SELECT XPT_LIC_NO, PCK_QTY, PCK_TP_CD, CNTR_WGT, WGT_UT_CD, CGO_DIVD_FLG, SAM_PCK_QTY, SAM_PCK_TP_CD 
                          FROM BKG_XTER_XPT_LIC_NO   
                         WHERE XTER_SNDR_ID=@[sender_id]
                           AND XTER_RQST_NO =@[rqst_no]   
                           AND XTER_RQST_SEQ = @[rqst_seq]
                         MINUS  
                        SELECT XPT_LIC_NO, PCK_QTY, PCK_TP_CD, MF_WGT, WGT_UT_CD, DIVD_FLG, SAM_PCK_QTY ,SAM_PCK_TP_CD
                          FROM BKG_XPT_IMP_LIC 
                         WHERE BKG_NO =@[bkg_no]
                           AND CNT_CD= 'KR'
                         UNION
                        SELECT XPT_LIC_NO, PCK_QTY, PCK_TP_CD, MF_WGT, WGT_UT_CD, DIVD_FLG, SAM_PCK_QTY ,SAM_PCK_TP_CD
                          FROM BKG_XPT_IMP_LIC 
                         WHERE BKG_NO =@[bkg_no]
                           AND CNT_CD= 'KR'
                         MINUS
                        SELECT XPT_LIC_NO, PCK_QTY, PCK_TP_CD, CNTR_WGT, WGT_UT_CD, CGO_DIVD_FLG, SAM_PCK_QTY, SAM_PCK_TP_CD 
                          FROM BKG_XTER_XPT_LIC_NO   
                         WHERE XTER_SNDR_ID=@[sender_id]
                           AND XTER_RQST_NO =@[rqst_no]   
                           AND XTER_RQST_SEQ = @[rqst_seq])) > 0 THEN 'Y' ELSE 'N' END AS LIC_KR_MOD
       ,CASE WHEN (SELECT COUNT(*) 
                  FROM (
                        SELECT XPT_LIC_NO, ID_XPT_NO_ISS_DT
                          FROM BKG_XTER_XPT_LIC_NO   
                         WHERE XTER_SNDR_ID=@[sender_id]
                           AND XTER_RQST_NO =@[rqst_no]   
                           AND XTER_RQST_SEQ = @[rqst_seq]
                         MINUS  
                        SELECT ID_XPT_NO, ID_XPT_NO_ISS_DT
                          FROM BKG_XPT_IMP_LIC 
                         WHERE BKG_NO =@[bkg_no]
                           AND CNT_CD= 'ID'
                         UNION
                        SELECT ID_XPT_NO, ID_XPT_NO_ISS_DT
                          FROM BKG_XPT_IMP_LIC 
                         WHERE BKG_NO =@[bkg_no]
                           AND CNT_CD= 'ID'
                         MINUS
                        SELECT XPT_LIC_NO, ID_XPT_NO_ISS_DT
                          FROM BKG_XTER_XPT_LIC_NO   
                         WHERE XTER_SNDR_ID=@[sender_id]
                           AND XTER_RQST_NO =@[rqst_no]   
                           AND XTER_RQST_SEQ = @[rqst_seq] )) > 0 THEN 'Y' ELSE 'N' END AS LIC_ID_MOD
        
 FROM DUAL 
)
,XTERCHG AS (
SELECT CASE WHEN (SELECT COUNT(*) FROM BKG_CHG_RT WHERE BKG_NO = @[bkg_no]) > 0 AND 
                (SELECT COUNT(*) 
                  FROM (
                        SELECT CHG_CD,TRF_ITM_NO,CURR_CD,RAT_UT_CD,RAT_AS_QTY,CHG_UT_AMT,CHG_AMT,FRT_TERM_CD
                          FROM BKG_XTER_CHG_RT   
                         WHERE XTER_SNDR_ID=@[sender_id]
                           AND XTER_RQST_NO =@[rqst_no]   
                           AND XTER_RQST_SEQ = @[rqst_seq]
                         MINUS  
                        SELECT CHG_CD,TRF_ITM_NO,CURR_CD,RAT_UT_CD,RAT_AS_QTY,CHG_UT_AMT,CHG_AMT,FRT_TERM_CD
                          FROM BKG_CHG_RT 
                         WHERE BKG_NO =@[bkg_no])) > 0 THEN 'Y' ELSE 'N' END AS CHG_MOD          
                         FROM DUAL 
                        )
,XTERHBL AS (
SELECT CASE WHEN (SELECT COUNT(*) FROM (
SELECT 
 HBL.HBL_NO
, SH.CUST_NM SHPR_NM
, SH.CUST_ADDR SHPR_ADDR
, CN.CUST_NM CNEE_NM
, CN.CUST_ADDR CNEE_ADDR
, NF.CUST_NM NOTI_NM
, NF.CUST_ADDR NOTI_ADDR
, HBL.HBL_WGT
, HBL.WGT_UT_CD
, HBL.PCK_QTY
, HBL.PCK_TP_CD
, HBL.CMDT_MEAS_QTY
, HBL.CMDT_MEAS_UT_CD
, HBL.BL_MK_DESC
, HBL.BL_GDS_DESC
FROM BKG_HBL HBL, BKG_HBL_CUST SH, BKG_HBL_CUST CN, BKG_HBL_CUST NF
WHERE 1=1
and HBL.BKG_NO       = SH.BKG_NO(+)
and hbl.hbl_seq      = sh.hbl_seq(+)
AND 'S'              = SH.BKG_CUST_TP_CD(+)
AND HBL.BKG_NO       = CN.BKG_NO(+)
and hbl.hbl_seq      = cn.hbl_seq(+)
AND 'C'              = CN.BKG_CUST_TP_CD(+)
AND HBL.BKG_NO       = NF.BKG_NO(+)
and hbl.hbl_seq      = nf.hbl_seq(+)
AND 'N'              = NF.BKG_CUST_TP_CD(+)
AND HBL.BKG_NO       = @[bkg_no]
MINUS
SELECT 
 HBL.BL_NO_CTNT HBL_NO
, SH.CUST_NM SHPR_NM
, SH.CUST_ADDR SHPR_ADDR
, CN.CUST_NM CNEE_NM
, CN.CUST_ADDR CNEE_ADDR
, NF.CUST_NM NOTI_NM
, NF.CUST_ADDR NOTI_ADDR
, HBL.ESTM_WGT AS HBL_WGT
, HBL.ESTM_WGT_UT_CD AS WGT_UT_CD
, HBL.PCK_QTY AS PCK_QTY
, HBL.PCK_TP_CD AS PCK_TP_CD
, HBL.MEAS_QTY AS CMDT_MEAS_QTY
, HBL.MEAS_UT_CD AS CMDT_MEAS_UT_CD
, DBMS_LOB.SUBSTR(HBL.MK_DESC, 4000, 1) BL_MK_DESC
, DBMS_LOB.SUBSTR(HBL.GDS_DESC, 4000, 1) BL_GDS_DESC
FROM BKG_XTER_RQST_MST HBL, BKG_XTER_CUST SH, BKG_XTER_CUST CN, BKG_XTER_CUST NF,
(
SELECT MND.XTER_SNDR_ID,MND.XTER_RQST_NO,MND.XTER_RQST_SEQ
,SUM(MND.CNTR_MF_WGT) ESTM_WGT,MAX(DECODE(MND.CNTR_SEQ,1,MND.WGT_UT_CD,0)) ESTM_WGT_UT_CD,SUM(MND.PCK_QTY) PCK_QTY
,MAX(DECODE(MND.CNTR_SEQ,1,MND.PCK_TP_CD,0)) PCK_TP_CD,SUM(MND.MEAS_QTY) MEAS_QTY,MAX(DECODE(MND.CNTR_SEQ,1,MND.MEAS_UT_CD,0)) MEAS_UT_CD
FROM BKG_XTER_CNTR_MK_DESC MND, BKG_XTER_RQST_MST MST
WHERE MND.XTER_SNDR_ID = MST.XTER_SNDR_ID
AND MND.XTER_RQST_NO = MST.XTER_RQST_NO
AND MND.XTER_RQST_SEQ = MST.XTER_RQST_SEQ
AND MST.XTER_SNDR_ID = @[sender_id]
AND MST.XTER_RQST_SEQ = @[rqst_seq]
AND MST.BKG_NO= @[bkg_no]
AND MST.XTER_BL_TP_CD = 'H'
GROUP BY MND.XTER_SNDR_ID,MND.XTER_RQST_NO,MND.XTER_RQST_SEQ
) HBL_CM
WHERE HBL.XTER_SNDR_ID = SH.XTER_SNDR_ID(+)
AND HBL.XTER_RQST_NO = SH.XTER_RQST_NO(+)
AND HBL.XTER_RQST_SEQ= SH.XTER_RQST_SEQ(+)
AND 'S'              = SH.XTER_CUST_TP_CD(+)
AND HBL.XTER_SNDR_ID = CN.XTER_SNDR_ID(+)
AND HBL.XTER_RQST_NO = CN.XTER_RQST_NO(+)
AND HBL.XTER_RQST_SEQ= CN. XTER_RQST_SEQ(+)
AND 'C'              = CN.XTER_CUST_TP_CD(+)
AND HBL.XTER_SNDR_ID = NF.XTER_SNDR_ID(+)
AND HBL.XTER_RQST_NO = NF.XTER_RQST_NO(+)
AND HBL.XTER_RQST_SEQ= NF.XTER_RQST_SEQ(+)
AND 'N'              = NF.XTER_CUST_TP_CD(+)
AND HBL.XTER_SNDR_ID = HBL_CM.XTER_SNDR_ID(+)
AND HBL.XTER_RQST_NO = HBL_CM.XTER_RQST_NO(+)
AND HBL.XTER_RQST_SEQ= HBL_CM.XTER_RQST_SEQ(+)
AND HBL.BKG_NO       = @[bkg_no]
AND HBL.XTER_SNDR_ID = @[sender_id]
AND HBL.XTER_RQST_SEQ= @[rqst_seq]
AND HBL.XTER_BL_TP_CD= 'H'
AND HBL.XTER_RQST_VIA_CD = (SELECT XTER_RQST_VIA_CD
FROM BKG_XTER_RQST_MST
WHERE XTER_SNDR_ID = @[sender_id]
AND XTER_RQST_NO = @[rqst_no]
AND XTER_RQST_SEQ= @[rqst_seq])
UNION
SELECT 
 HBL.BL_NO_CTNT HBL_NO
, SH.CUST_NM SHPR_NM
, SH.CUST_ADDR SHPR_ADDR
, CN.CUST_NM CNEE_NM
, CN.CUST_ADDR CNEE_ADDR
, NF.CUST_NM NOTI_NM
, NF.CUST_ADDR NOTI_ADDR
, DECODE(HBL.XTER_RQST_VIA_CD,'SIM',HBL_CM.ESTM_WGT,HBL.ESTM_WGT) AS HBL_WGT
, DECODE(HBL.XTER_RQST_VIA_CD,'SIM',HBL_CM.ESTM_WGT_UT_CD,HBL.ESTM_WGT_UT_CD) AS WGT_UT_CD
, DECODE(HBL.XTER_RQST_VIA_CD,'SIM',HBL_CM.PCK_QTY,HBL.PCK_QTY) AS PCK_QTY
, DECODE(HBL.XTER_RQST_VIA_CD,'SIM',HBL_CM.PCK_TP_CD,HBL.PCK_TP_CD) AS PCK_TP_CD
, DECODE(HBL.XTER_RQST_VIA_CD,'SIM',HBL_CM.MEAS_QTY,HBL.MEAS_QTY) AS CMDT_MEAS_QTY
, DECODE(HBL.XTER_RQST_VIA_CD,'SIM',HBL_CM.MEAS_UT_CD,HBL.MEAS_UT_CD) AS CMDT_MEAS_UT_CD
, DBMS_LOB.SUBSTR(HBL.MK_DESC, 4000, 1) BL_MK_DESC
, DBMS_LOB.SUBSTR(HBL.GDS_DESC, 4000, 1) BL_GDS_DESC
FROM BKG_XTER_RQST_MST HBL, BKG_XTER_CUST SH, BKG_XTER_CUST CN, BKG_XTER_CUST NF,
(
SELECT MND.XTER_SNDR_ID,MND.XTER_RQST_NO,MND.XTER_RQST_SEQ
,SUM(MND.CNTR_MF_WGT) ESTM_WGT,MAX(DECODE(MND.CNTR_SEQ,1,MND.WGT_UT_CD,0)) ESTM_WGT_UT_CD,SUM(MND.PCK_QTY) PCK_QTY
,MAX(DECODE(MND.CNTR_SEQ,1,MND.PCK_TP_CD,0)) PCK_TP_CD,SUM(MND.MEAS_QTY) MEAS_QTY,MAX(DECODE(MND.CNTR_SEQ,1,MND.MEAS_UT_CD,0)) MEAS_UT_CD
FROM BKG_XTER_CNTR_MK_DESC MND, BKG_XTER_RQST_MST MST
WHERE MND.XTER_SNDR_ID = MST.XTER_SNDR_ID
AND MND.XTER_RQST_NO = MST.XTER_RQST_NO
AND MND.XTER_RQST_SEQ = MST.XTER_RQST_SEQ
AND MST.XTER_SNDR_ID = @[sender_id]
AND MST.XTER_RQST_SEQ = @[rqst_seq]
AND MST.BKG_NO= @[bkg_no]
AND MST.XTER_BL_TP_CD = 'H'
GROUP BY MND.XTER_SNDR_ID,MND.XTER_RQST_NO,MND.XTER_RQST_SEQ
) HBL_CM
WHERE HBL.XTER_SNDR_ID = SH.XTER_SNDR_ID(+)
AND HBL.XTER_RQST_NO = SH.XTER_RQST_NO(+)
AND HBL.XTER_RQST_SEQ= SH.XTER_RQST_SEQ(+)
AND 'S'              = SH.XTER_CUST_TP_CD(+)
AND HBL.XTER_SNDR_ID = CN.XTER_SNDR_ID(+)
AND HBL.XTER_RQST_NO = CN.XTER_RQST_NO(+)
AND HBL.XTER_RQST_SEQ= CN. XTER_RQST_SEQ(+)
AND 'C'              = CN.XTER_CUST_TP_CD(+)
AND HBL.XTER_SNDR_ID = NF.XTER_SNDR_ID(+)
AND HBL.XTER_RQST_NO = NF.XTER_RQST_NO(+)
AND HBL.XTER_RQST_SEQ= NF.XTER_RQST_SEQ(+)
AND 'N'              = NF.XTER_CUST_TP_CD(+)
AND HBL.XTER_SNDR_ID = HBL_CM.XTER_SNDR_ID(+)
AND HBL.XTER_RQST_NO = HBL_CM.XTER_RQST_NO(+)
AND HBL.XTER_RQST_SEQ= HBL_CM.XTER_RQST_SEQ(+)
AND HBL.BKG_NO       = @[bkg_no]
AND HBL.XTER_SNDR_ID = @[sender_id]
AND HBL.XTER_RQST_SEQ= @[rqst_seq]
AND HBL.XTER_BL_TP_CD= 'H'
AND HBL.XTER_RQST_VIA_CD = (SELECT XTER_RQST_VIA_CD
FROM BKG_XTER_RQST_MST
WHERE XTER_SNDR_ID = @[sender_id]
AND XTER_RQST_NO = @[rqst_no]
AND XTER_RQST_SEQ= @[rqst_seq])
MINUS
SELECT 
 HBL.HBL_NO
, SH.CUST_NM SHPR_NM
, SH.CUST_ADDR SHPR_ADDR
, CN.CUST_NM CNEE_NM
, CN.CUST_ADDR CNEE_ADDR
, NF.CUST_NM NOTI_NM
, NF.CUST_ADDR NOTI_ADDR
, HBL.HBL_WGT
, HBL.WGT_UT_CD
, HBL.PCK_QTY
, HBL.PCK_TP_CD
, HBL.CMDT_MEAS_QTY
, HBL.CMDT_MEAS_UT_CD
, HBL.BL_MK_DESC
, HBL.BL_GDS_DESC
FROM BKG_HBL HBL, BKG_HBL_CUST SH, BKG_HBL_CUST CN, BKG_HBL_CUST NF
WHERE 1=1
and HBL.BKG_NO       = SH.BKG_NO(+)
and hbl.hbl_seq      = sh.hbl_seq(+)
AND 'S'              = SH.BKG_CUST_TP_CD(+)
AND HBL.BKG_NO       = CN.BKG_NO(+)
and hbl.hbl_seq      = cn.hbl_seq(+)
AND 'C'              = CN.BKG_CUST_TP_CD(+)
AND HBL.BKG_NO       = NF.BKG_NO(+)
and hbl.hbl_seq      = nf.hbl_seq(+)
AND 'N'              = NF.BKG_CUST_TP_CD(+)
AND HBL.BKG_NO       = @[bkg_no])) > 0 THEN 'Y' ELSE 'N' END AS HBL1_MOD,
CASE WHEN (SELECT COUNT(*) FROM (
SELECT USA_CSTMS_FILE_NO
,SCAC_CD
,PCK_QTY
FROM BKG_USA_CSTMS_FILE_NO
WHERE BKG_NO  = @[bkg_no]
MINUS
SELECT USA_CSTMS_FILE_NO
, SCAC_CD
, PCK_QTY
FROM BKG_XTER_RQST_MST
WHERE BKG_NO       = @[bkg_no]
AND XTER_RQST_SEQ= @[rqst_seq]
AND NVL(XTER_BL_TP_CD, ' ') = 'H'
AND USA_CSTMS_FILE_NO IS NOT NULL
UNION
SELECT USA_CSTMS_FILE_NO
, SCAC_CD
, PCK_QTY
FROM BKG_XTER_RQST_MST
WHERE BKG_NO       = @[bkg_no]
AND XTER_RQST_SEQ= @[rqst_seq]
AND NVL(XTER_BL_TP_CD, ' ') = 'H'
AND USA_CSTMS_FILE_NO IS NOT NULL
MINUS
SELECT USA_CSTMS_FILE_NO
,SCAC_CD
,PCK_QTY
FROM BKG_USA_CSTMS_FILE_NO
WHERE BKG_NO  = @[bkg_no])) > 0 THEN 'Y' ELSE 'N' END AS HBL2_MOD
FROM DUAL
)
, DGCHK AS (SELECT CASE WHEN (SELECT 'Y' 
                                FROM BKG_XTER_DG_CGO 
                               WHERE XTER_SNDR_ID = @[sender_id]
                                 AND XTER_RQST_NO = @[rqst_no]
                                 AND XTER_RQST_SEQ= @[rqst_seq]
                                 AND ROWNUM = 1) = 'Y' THEN 'N' 
                        WHEN (SELECT 'Y' 
                                FROM BKG_DG_CGO 
                               WHERE BKG_NO = @[bkg_no]
                                 AND ROWNUM = 1) = 'Y' THEN 'N' 
                        ELSE ( SELECT DECODE(COUNT(*),0,'N','Y') 
                                FROM (
                                    SELECT HRD.*
                                    FROM BKG_BLCK_KW_LIST HRD
                                        ,BKG_XTER_RQST_MST MST
                                    WHERE HRD.BLCK_KW_TP_CD = 'MIS'
                                      AND MST.XTER_SNDR_ID = @[sender_id]
                                      AND MST.XTER_RQST_NO = @[rqst_no]
                                      AND MST.XTER_RQST_SEQ= @[rqst_seq]
                                      AND (UPPER(MST.CSTMS_DESC) LIKE '%'||HRD.BLCK_KW_NM||'%'
                                      OR UPPER(MST.GDS_DESC) LIKE '%'||HRD.BLCK_KW_NM||'%'
                                      OR UPPER(MST.XTER_BKG_RMK1) LIKE '%'||HRD.BLCK_KW_NM||'%')
                                    UNION ALL
                                    SELECT HRD.*
                                    FROM BKG_BLCK_KW_LIST HRD
                                         ,BKG_XTER_CNTR_MK_DESC CM
                                    WHERE HRD.BLCK_KW_TP_CD = 'MIS'
                                      AND CM.XTER_SNDR_ID = @[sender_id]
                                      AND CM.XTER_RQST_NO = @[rqst_no]
                                      AND CM.XTER_RQST_SEQ= @[rqst_seq]
                                      AND UPPER(CM.CNTR_MF_MK_DESC) LIKE '%'||HRD.BLCK_KW_NM||'%'
                                    ))
    END AS DG_FLG
FROM DUAL)

SELECT CASE WHEN ALL_MANUAL ='Y' THEN 'Y'
            WHEN DCT_LMT < SYSDATE AND DCT_MANUAL = 'Y' THEN 'Y'
            WHEN CCT_DT < SYSDATE AND (DCT_MANUAL = 'Y' OR CCT_MANUAL = 'Y') THEN 'Y'
            WHEN ATD_LMT < SYSDATE AND (DCT_MANUAL = 'Y' OR CCT_MANUAL = 'Y' OR ATD_MANUAL ='Y') THEN 'Y'
            WHEN ( BDR_FLG ='Y' OR BDR_LMT < SYSDATE ) AND (DCT_MANUAL = 'Y' OR CCT_MANUAL = 'Y' OR ATD_MANUAL ='Y' OR BDR_MANUAL = 'Y') THEN 'Y'
            WHEN PCT_DT < SYSDATE AND (DCT_MANUAL = 'Y' OR CCT_MANUAL = 'Y' OR ATD_MANUAL ='Y' OR BDR_MANUAL = 'Y' OR PCT_MANUAL ='Y') THEN 'Y'
            WHEN OBL_ISS_FLG = 'Y' AND BLISS_MANUAL ='Y' THEN 'Y'
            WHEN BKG_STS_FLG ='Y' THEN 'Y'
            WHEN CLUZ_LCK_FLG ='Y' THEN 'Y'
            WHEN ATA_LMT < SYSDATE THEN 'Y'
            WHEN ADM_FLG = 'Y' AND ADM_MANUAL ='Y' THEN 'Y'
            WHEN OBM_FLG = 'Y' AND OBM_MANUAL ='Y' THEN 'Y'
			WHEN IR_TO_ORD_FLG ='Y' THEN 'Y'
			WHEN DG_FLG = 'Y'  THEN 'Y'
            ELSE 'N'
        END AS MNL_FLG,
      CASE WHEN ALL_MANUAL ='Y' THEN 'Entirely manual upload'
            WHEN DCT_LMT < SYSDATE AND DCT_MANUAL = 'Y' THEN 'DCT Time Limit'
            WHEN CCT_DT < SYSDATE AND (DCT_MANUAL = 'Y' OR CCT_MANUAL = 'Y') THEN 'CCT Time Limit'
            WHEN ATD_LMT < SYSDATE AND (DCT_MANUAL = 'Y' OR CCT_MANUAL = 'Y' OR ATD_MANUAL ='Y') THEN 'ATD Time Limit'
            WHEN ( BDR_FLG ='Y' OR BDR_LMT < SYSDATE ) AND (DCT_MANUAL = 'Y' OR CCT_MANUAL = 'Y' OR ATD_MANUAL ='Y' OR BDR_MANUAL = 'Y') THEN 'BDR Time Limit'
            WHEN PCT_DT < SYSDATE AND (DCT_MANUAL = 'Y' OR ATD_MANUAL ='Y' OR CCT_MANUAL = 'Y' OR BDR_MANUAL = 'Y' OR PCT_MANUAL ='Y') THEN 'PCT Time Limit'
            WHEN OBL_ISS_FLG = 'Y' AND BLISS_MANUAL ='Y' THEN 'B/L Issue Time Limit'
            WHEN BKG_STS_FLG ='Y' THEN 'Booking Status'
            WHEN CLUZ_LCK_FLG ='Y' THEN 'Clause Lock'
            WHEN ATA_LMT < SYSDATE THEN 'ATA Time Limit'
            WHEN ADM_FLG = 'Y' AND ADM_MANUAL ='Y' THEN 'Advance Manifest'
            WHEN OBM_FLG = 'Y' AND OBM_MANUAL ='Y' THEN 'O/B Manifest'
			WHEN IR_TO_ORD_FLG ='Y' THEN 'Iran To Order'
			WHEN DG_FLG = 'Y'  THEN 'Non Checked DG Cargo'
            ELSE ''
        END AS MNL_UPLD_RSN
        ,XTER_SNDR_ID
        ,XTER_RQST_NO
        ,XTER_RQST_SEQ
        ,BKG_NO
		,BL_NO
		,CHG_MOD
		,'N' BKG_UPLD_STS_CD
		,'N' SYS_UPLD_FLG
		,CMPB_RT_FLG 
		,'' SI_AUD_FLG
FROM (
  SELECT CASE WHEN SH_NM_MOD = 'Y'OR PRE_VSL_MOD = 'Y' OR VSL_MOD = 'Y' 
                      OR POR_MOD ='Y' OR POL_MOD ='Y'  OR POD_MOD ='Y' OR DEL_MOD = 'Y' 
                      OR RCV_TERM_MOD ='Y' OR DE_TERM_MOD ='Y'
                      OR CNTR_NO_MOD ='Y' OR CNTR_SEAL_MOD ='Y'
                      OR CHG_MOD ='Y'  OR BKG_QTY_MOD ='Y' 
					  OR CNTR_KR_MNL = 'Y' THEN 'Y'					 
                    ELSE 'N'
                END AS ALL_MANUAL 
              ,CASE WHEN KR_CSTMS_CUST_TP_MOD = 'Y' OR AES_MOD ='Y' OR CAED_MOD ='Y' THEN 'Y'
                    ELSE 'N'
                END AS DCT_MANUAL
			  ,CASE WHEN HBL1_MOD = 'Y' OR HBL2_MOD ='Y' THEN 'Y'
                    ELSE 'N'
                END AS CCT_MANUAL
              ,CASE WHEN SH_ADDR_MOD = 'Y' OR SH_CTRY_MOD = 'Y' OR SH_EORI_MOD ='Y' OR SH_CITY_MOD = 'Y' OR SH_STE_MOD = 'Y' OR
                         CN_NM_MOD = 'Y' OR CN_ADDR_MOD = 'Y' OR CN_CTRY_MOD = 'Y' OR CN_ZIP_MOD = 'Y' OR CN_EORI_MOD = 'Y' OR CN_CITY_MOD = 'Y' OR CN_STE_MOD = 'Y' OR CN_ST_MOD = 'Y' OR 
                         NF_NM_MOD = 'Y' OR CNTR_QTY_MOD = 'Y' OR CNTR_MF_MOD = 'Y' OR CNTR_NCM_MOD = 'Y' OR 
                         MK_MOD = 'Y' OR DES_MOD = 'Y' OR CSTMS_DESC_MOD = 'Y'  THEN 'Y'
                    ELSE 'N'
                END AS ATD_MANUAL
              ,CASE WHEN NF_ADDR_MOD = 'Y' OR NF_CTRY_MOD = 'Y' OR NF_ZIP_MOD = 'Y' OR NF_EORI_MOD = 'Y' OR NF_CITY_MOD = 'Y' OR NF_STE_MOD = 'Y' OR NF_ST_MOD = 'Y' OR 
                         AN_NM_MOD = 'Y' OR BL_TP_MOD = 'Y' OR 
                         MX_SHPR_TAX_ID_MOD = 'Y' OR TR_SHPR_TAX_ID_MOD = 'Y' OR IL_SHPR_TAX_ID_MOD = 'Y' OR LB_SHPR_TAX_ID_MOD = 'Y' OR BRZ_SHPR_TAX_ID_MOD = 'Y' OR 
                         MX_CNEE_TAX_ID_MOD = 'Y' OR TR_CNEE_TAX_ID_MOD = 'Y' OR IL_CNEE_TAX_ID_MOD = 'Y' OR LB_CNEE_TAX_ID_MOD = 'Y' OR BRZ_CNEE_TAX_ID_MOD = 'Y' OR 
                         MX_NTFY_TAX_ID_MOD = 'Y' OR TR_NTFY_TAX_ID_MOD = 'Y' OR IL_NTFY_TAX_ID_MOD = 'Y' OR LB_NTFY_TAX_ID_MOD = 'Y' OR BRZ_NTFY_TAX_ID_MOD = 'Y' THEN 'Y'
                    ELSE 'N'
                END AS BDR_MANUAL
              ,CASE WHEN FRT_TERM_MOD = 'Y' OR FF_NM_MOD = 'Y' THEN 'Y'  
                    ELSE 'N'
                END AS PCT_MANUAL 
              ,CASE WHEN SH_ADDR_MOD = 'Y' OR SH_CTRY_MOD = 'Y' OR SH_ZIP_MOD = 'Y' OR SH_EORI_MOD = 'Y' OR SH_CITY_MOD = 'Y' OR SH_STE_MOD = 'Y' OR SH_ST_MOD = 'Y' OR 
                         CN_NM_MOD = 'Y' OR CN_ADDR_MOD = 'Y' OR CN_CTRY_MOD = 'Y' OR CN_ZIP_MOD = 'Y' OR CN_EORI_MOD = 'Y' OR CN_CITY_MOD = 'Y' OR CN_STE_MOD = 'Y' OR CN_ST_MOD = 'Y' OR 
                         NF_NM_MOD = 'Y' OR NF_ADDR_MOD = 'Y' OR NF_CTRY_MOD = 'Y' OR NF_ZIP_MOD = 'Y' OR NF_EORI_MOD = 'Y' OR NF_CITY_MOD = 'Y' OR NF_STE_MOD = 'Y' OR NF_ST_MOD = 'Y' OR 
                         CNTR_QTY_MOD = 'Y' OR CNTR_MF_MOD = 'Y' OR 
                         MK_MOD = 'Y' OR DES_MOD = 'Y' OR KR_CSTMS_CUST_TP_MOD = 'Y' OR RMK_MOD = 'Y' OR CSTMS_DESC_MOD = 'Y' OR
						 HBL1_MOD = 'Y' OR HBL2_MOD ='Y'
						 THEN 'Y'
                    ELSE 'N'
                END AS ADM_MANUAL
              ,CASE WHEN SH_ADDR_MOD = 'Y' OR SH_CTRY_MOD = 'Y' OR CN_NM_MOD = 'Y' OR CN_ADDR_MOD = 'Y' OR CN_CTRY_MOD = 'Y' OR 
                         MK_MOD = 'Y' OR DES_MOD = 'Y' OR FRT_TERM_MOD = 'Y' THEN 'Y'
                    ELSE 'N'
                END AS BLISS_MANUAL
              ,CASE WHEN SH_ADDR_MOD = 'Y' OR SH_CTRY_MOD = 'Y' OR SH_ZIP_MOD = 'Y' OR 
                         CN_NM_MOD = 'Y' OR CN_ADDR_MOD = 'Y' OR CN_CTRY_MOD = 'Y' OR 
                         CNTR_QTY_MOD = 'Y' OR CNTR_MF_MOD = 'Y' OR 
                         MK_MOD = 'Y' OR DES_MOD = 'Y' OR KR_CSTMS_CUST_TP_MOD = 'Y' OR 
                         CSTMS_DESC_MOD = 'Y' OR RMK_MOD = 'Y' THEN 'Y'
                    ELSE 'N'
                END AS OBM_MANUAL
			  ,CASE WHEN ADV_EUR_CSTMS > 0 OR ADV_JP_CSTMS > 0  OR ADV_US_CSTMS > 0  OR ADV_CN_CSTMS > 0 OR ADV_MX_CSTMS > 0
                     THEN 'Y' ELSE 'N' 
                END AS ADM_FLG
              ,CASE WHEN SRI_CSTMS > 0  OR MM_CSTMS > 0  OR MY_CSTMS > 0  OR VN_CSTMS > 0 OR
                         KR_CSTMS > 0  OR EUR_CSTMS > 0  OR BD_CSTMS > 0
                     THEN 'Y' ELSE 'N' 
                END AS OBM_FLG
              ,NVL(DCT_DT, CCT_DT-48/24) AS DCT_LMT
              ,NVL(ATD, ETD_DT) AS ATD_LMT
              ,BDR_FLG
              ,POL_ETD_DT+(POD_ETA_DT-POL_ETD_DT)/2 AS BDR_LMT
              ,OBL_ISS_FLG
              ,BKG_STS_FLG
              ,PCT_DT
              ,CLUZ_LCK_FLG
              ,ATD
              ,DCT_DT
              ,ETD_DT
              ,CCT_DT
              ,POL_ETD_DT
              ,POD_ETA_DT
              ,ETB_DT
              ,NVL(POD_ATA_DT,POD_ETA_DT) AS ATA_LMT
              ,XTER_SNDR_ID
              ,XTER_RQST_NO
              ,XTER_RQST_SEQ
              ,BKG_NO
			  ,BL_NO
			  ,CHG_MOD
			  ,CMPB_RT_FLG
			  ,IR_TO_ORD_FLG
			  ,DG_FLG
          FROM TMLIM 
              ,XTERMST
              ,XTERCUST
              ,XTERAES
              ,XTERCAED
              ,XTERCNTR
              ,XTERLIC
              ,XTERCHG 
			  ,XTERHBL
			  ,DGCHK
              )			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="FRA504172700" out="N"/>
				<param name="sender_id" type="12" value="WEB" out="N"/>
				<param name="rqst_no" type="12" value="FRA5090700003" out="N"/>
				<param name="rqst_seq" type="12" value="1" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
