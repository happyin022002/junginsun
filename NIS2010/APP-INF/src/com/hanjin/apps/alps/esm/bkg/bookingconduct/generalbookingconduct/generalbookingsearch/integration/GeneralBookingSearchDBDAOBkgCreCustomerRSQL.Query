<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingSearchDBDAOBkgCreCustomerRSQL">
			<desc><![CDATA[BkgCreCustomerVO]]></desc>
			<sql><![CDATA[
select  cust.cust_cnt_cd,
        cust.cust_seq,		
		cust.cust_cnt_cd||LPAD(cust.cust_seq,6,'0') customer_code,
		CASE WHEN CUST.SLS_DELT_EFF_RSN_CD = '07' THEN 'Exceeding Credit Limit'
             WHEN CUST.SLS_DELT_EFF_DT IS NOT NULL THEN 'No Use'
             WHEN NVL(CR.CUST_RLSE_CTRL_FLG, 'N') = 'Y' THEN 'Financial Risk'	
			 WHEN CUST.DELT_FLG = 'Y' THEN 'Delete'		
            -- WHEN CUST.VBS_CLSS_CD = '01' THEN 'PREMIUM' Request by Woori hong
              ELSE 'Use' END pb,
		UPPER(cust.cust_lgl_eng_nm) CUST_LGL_ENG_NM,
        decode(CUST.RVIS_CNTR_CUST_TP_CD, 'B', 'BCO', 'Non BCO') cust_div_flag,
        cust.ofc_cd,
        (
            select  UPPER(bzet_addr)                    
            from    mdm_cust_addr
            where   cust_cnt_cd = cust.cust_cnt_cd
            and     cust_seq = cust.cust_seq
            and     prmry_chk_flg = 'Y'
			and     rownum = 1
        ) bzet_addr,
		cust.frt_fwrd_fmc_no,
        cust.delt_flg,
        NVL(CR.CR_CLT_OFC_CD, CUST.OFC_CD) AR_OFC,
        REP.SREP_NM,
        CR.CUST_RLSE_CTRL_RMK,
        CD.INTG_CD_VAL_DP_DESC AS NO_USE_RSN,
        ADDR.CTY_NM,  
        ADDR.STE_CD,  
        ADDR.ZIP_CD,
        PNT.PHN_NO,
        DECODE(NVL(CR.CUST_RLSE_CTRL_FLG, 'N'),'Y','Yes','No')   R_BKLST,
		LOC.LOC_CD || '-' || LOC.LOC_NM as LOCATION_CODE 
 from mdm_customer cust
     ,MDM_CR_CUST CR
     ,MDM_SLS_REP REP
     ,COM_INTG_CD_DTL CD
     ,MDM_CUST_ADDR ADDR
     ,MDM_CUST_CNTC_PNT PNT
	 ,MDM_LOCATION LOC
where cust.cust_cnt_cd = @[cust_cnt_cd]
  and nvl(cust.nmd_cust_flg, 'N') = 'N'
  AND CUST.CNTR_DIV_FLG = 'Y'   
  AND CUST.DELT_FLG ='N'   
#if (${cust_seq} != '') 
  and CUST.CUST_SEQ = @[cust_seq]
#end
#if (${cust_nm} != '') 
  #if(${include} != '')
	--include
     AND (REGEXP_REPLACE(UPPER(CUST.CUST_LGL_ENG_NM),'[^a-zA-Z0-9]','')  LIKE '%'||REGEXP_REPLACE(UPPER(@[cust_nm]),'[^a-zA-Z0-9]','')||'%')
	#else
		AND UPPER(CUST.CUST_LGL_ENG_NM) LIKE UPPER(@[cust_nm]) || '%'
	#end
#end
#if (${ofc_cd} != '') 
  and cust.ofc_cd = @[ofc_cd]
#end
#if (${cty_nm} != '') 
  and UPPER(ADDR.CTY_NM) = UPPER(@[cty_nm])
#end
#if (${ste_cd} != '') 
  and UPPER(ADDR.STE_CD) = UPPER(@[ste_cd])
#end
#if (${zip_cd} != '') 
  and UPPER(ADDR.ZIP_CD) = UPPER(@[zip_cd])
#end
#if (${area_cd} != '') 
  AND SUBSTR(LTRIM(PHN_NO,'1-'),0,3)  = @[area_cd]  
#end
#if (${no_use} != '') 
  AND (CUST.SLS_DELT_EFF_DT IS NULL OR CUST.SLS_DELT_EFF_DT IS NOT NULL)
#else
  AND ((CUST.SLS_DELT_EFF_DT IS NULL OR CUST.SLS_DELT_EFF_RSN_CD = '07') AND CUST.DELT_FLG ='N')
#end

#if (${bklst} != 'on') 
 AND NVL(CR.CUST_RLSE_CTRL_FLG, 'N') = 'N'
#else
 AND NVL(CR.CUST_RLSE_CTRL_FLG, 'N') IN ('N','Y')
#end

  AND CUST.CUST_CNT_CD = CR.CUST_CNT_CD (+)
  AND CUST.CUST_SEQ = CR.CUST_SEQ (+)
  AND CUST.CUST_CNT_CD = ADDR.CUST_CNT_CD 
  AND CUST.CUST_SEQ = ADDR.CUST_SEQ 
  AND CUST.CUST_CNT_CD = PNT.CUST_CNT_CD 
  AND CUST.CUST_SEQ = PNT.CUST_SEQ 
  AND ADDR.PRMRY_CHK_FLG ='Y' 
  AND CUST.SREP_CD = REP.SREP_CD (+)
  AND CUST.SLS_DELT_EFF_RSN_CD = CD.INTG_CD_VAL_CTNT (+)
  AND CD.INTG_CD_ID(+) = 'CD03011'
  AND CUST.LOC_CD = LOC.LOC_CD(+)
order by cust.delt_flg , CUST.SLS_DELT_EFF_DT nulls first			]]></sql>
			<params>
				<param name="cust_cnt_cd" type="12" value="" out="N"/>
				<param name="cust_seq" type="12" value="" out="N"/>
				<param name="cust_nm" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="cty_nm" type="12" value="" out="N"/>
				<param name="ste_cd" type="12" value="" out="N"/>
				<param name="zip_cd" type="12" value="" out="N"/>
				<param name="area_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
