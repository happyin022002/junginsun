/*=========================================================
*Copyright(c) 2017 CyberLogitec
*@FileName : SpacecontrolinquiryDBDAOSearchAllocPortViewDetailListRSQL.java
*@FileTitle : 
*Open Issues :
*Change history :
*@LastModifyDate : 2017.01.23
*@LastModifier : Arie
*@LastVersion : 1.0
* 2017.01.23 Arie
* 1.0 Creation
=========================================================*/
package com.hanjin.apps.alps.esm.spc.spacecontrolinquiry.spacecontrolinquiry.integration;

import java.util.HashMap;
import org.apache.log4j.Logger;
import com.hanjin.framework.support.db.ISQLTemplate;

/**
 *
 * @author Arie
 * @see DAO 참조
 * @since J2EE 1.6
 */

public class SpacecontrolinquiryDBDAOSearchAllocPortViewDetailListRSQL implements ISQLTemplate{

	private StringBuffer query = new StringBuffer();
	
	Logger log =Logger.getLogger(this.getClass());
	
	/** Parameters definition in params/param elements */
	private HashMap<String,String[]> params = null;
	
	/**
	  * <pre>
	  * SpacecontrolinquiryDBDAOSearchAllocPortViewDetailListRSQL
	  * 2015.03.04 CHM-201534435 SQM QTA주가 변경 관련 적용 요청
	  * 2015.09.16 이혜민 선반영 SPC_CONTI_CONV_FNC 태울때 SLAN_CD를 인자로 가져가던것 RLANE_CD로 수정 (RLANE_CD로 가져가야 제대로 펑션을 탐)
	  * 2017.1.23 SM상선 전환에 따른 소스변경
	  * </pre>
	  */
	public SpacecontrolinquiryDBDAOSearchAllocPortViewDetailListRSQL(){
		setQuery();
		params = new HashMap<String,String[]>();
		String tmp = null;
		String[] arrTmp = null;
		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("login_id",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("subtrade1",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("trade",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("sales_office",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("ui_name",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("pol_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("vvd2",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("ofc_cd",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("vvd1",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("area",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("year",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("bound",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("rhq",new String[]{arrTmp[0],arrTmp[1]});

		tmp = java.sql.Types.VARCHAR + ",N";
		arrTmp = tmp.split(",");
		if(arrTmp.length !=2){
			throw new IllegalArgumentException();
		}
		params.put("week",new String[]{arrTmp[0],arrTmp[1]});

		query.append("/*").append("\n"); 
		query.append("Path : com.hanjin.apps.alps.esm.spc.spacecontrolinquiry.spacecontrolinquiry.integration").append("\n"); 
		query.append("FileName : SpacecontrolinquiryDBDAOSearchAllocPortViewDetailListRSQL").append("\n"); 
		query.append("*/").append("\n"); 
	}
	
	public String getSQL(){
		return query.toString();
	}
	
	public HashMap<String,String[]> getParams() {
		return params;
	}

	/**
	 * Query 생성
	 */
	public void setQuery(){
		query.append("WITH MAS_MON_VVD_LV AS (" ).append("\n"); 
		query.append("    SELECT B.TRD_CD    ," ).append("\n"); 
		query.append("           B.SUB_TRD_CD," ).append("\n"); 
		query.append("           B.RLANE_CD  ," ).append("\n"); 
		query.append("           B.DIR_CD    ," ).append("\n"); 
		query.append("           B.IOC_CD    ," ).append("\n"); 
		query.append("           B.COST_YR   ," ).append("\n"); 
		query.append("           B.COST_MON  ," ).append("\n"); 
		query.append("           B.NUM       ," ).append("\n"); 
		query.append("           B.COST_WK   ," ).append("\n"); 
		query.append("           B.VSL_CD    ," ).append("\n"); 
		query.append("           B.SKD_VOY_NO," ).append("\n"); 
		query.append("           B.SKD_DIR_CD," ).append("\n"); 
		query.append("           B.RHQ_CD    ," ).append("\n"); 
		query.append("           B.AQ_CD     ," ).append("\n"); 
		query.append("           B.RGN_OFC_CD," ).append("\n"); 
		query.append("           (" ).append("\n"); 
		query.append("             SELECT DECODE(O.OFC_TP_CD, 'QT', O.PRNT_OFC_CD, DECODE(@[ofc_cd], 'ATLSA', 'NYCRA', 'SLSSC', 'NYCRA', 'PHXSA', 'NYCRA', O.OFC_CD))" ).append("\n"); 
		query.append("               FROM SPC_OFC_LVL O  ," ).append("\n"); 
		query.append("                    COM_USER    COM" ).append("\n"); 
		query.append("              WHERE COM.USR_ID = @[login_id]" ).append("\n"); 
		query.append("                AND B.COST_YR || B.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK" ).append("\n"); 
		query.append("                AND O.OFC_CD = SPC_SCR_OFC_CONV_FNC(DECODE(@[login_id], '09012001', 'ISTEM', '09014001','ISTEM',  COM.OFC_CD), @[ui_name])  " ).append("\n"); 
		query.append(" 	          -- Login Office가 ISTSC인 경우에는 Origin Office가 아닌 Login Office가 Loading Office와 일치할 경우 Alloc 이 조회될 수 있도록 수정 요청" ).append("\n"); 
		query.append("           ) AS OFC_CD," ).append("\n"); 
		query.append("           B.POL_CD         ," ).append("\n"); 
		query.append("           B.BSA            ," ).append("\n"); 
		query.append("           B.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           B.PAST           ," ).append("\n"); 
		query.append("           (SELECT /*+ INDEX_DESC (M XPKSPC_MDL_VER_MST ) */" ).append("\n"); 
		query.append("                   DECODE(HH_FLG, 'N', '200001-1', M.COST_YRWK||'-'||M.VER_SEQ)" ).append("\n"); 
		query.append("              FROM SPC_MDL_VER_MST M" ).append("\n"); 
		query.append("             WHERE B.COST_YR ||B.COST_WK BETWEEN M.VER_ST_YRWK AND M.VER_END_YRWK" ).append("\n"); 
		query.append("               AND M.TRD_CD  = B.TRD_CD" ).append("\n"); 
		query.append("               AND M.CFM_FLG = 'Y'" ).append("\n"); 
		query.append("               AND ROWNUM    = 1" ).append("\n"); 
		query.append("           ) AS SEASON," ).append("\n"); 
		query.append("           NVL(O.ACCT_GRP_CTRL_FLG, 'N') AS ACCT_FLG" ).append("\n"); 
		query.append("           , B.BSE_QTR_CD" ).append("\n"); 
		query.append("           , B.BSE_YR" ).append("\n"); 
		query.append("      FROM (" ).append("\n"); 
		query.append("              SELECT M.TRD_CD    ," ).append("\n"); 
		query.append("                     M.SUB_TRD_CD," ).append("\n"); 
		query.append("                     M.RLANE_CD  ," ).append("\n"); 
		query.append("                     M.DIR_CD    ," ).append("\n"); 
		query.append("                     M.IOC_CD    ," ).append("\n"); 
		query.append("                     SUBSTR(M.SLS_YRMON, 1, 4) AS COST_YR ," ).append("\n"); 
		query.append("                     SUBSTR(M.SLS_YRMON, 5)    AS COST_MON," ).append("\n"); 
		query.append("                     P.RNUM NUM       ," ).append("\n"); 
		query.append("                     M.COST_WK        ," ).append("\n"); 
		query.append("                     DECODE(@[trade], 'IAS', NVL(L.LOD_SPL_CNG_FLG,'N'), 'Y') AS LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                     M.VSL_CD         ," ).append("\n"); 
		query.append("                     M.SKD_VOY_NO     ," ).append("\n"); 
		query.append("                     M.DIR_CD               AS SKD_DIR_CD," ).append("\n"); 
		query.append("                     C.RHQ_CD               AS RHQ_CD    ," ).append("\n"); 
		query.append("                     @[area]                AS AQ_CD     ," ).append("\n"); 
		query.append("                     @[sales_office]        AS RGN_OFC_CD," ).append("\n"); 
		query.append("                     @[pol_cd]              AS POL_CD    ," ).append("\n"); 
		query.append("                     NVL(B.CRR_BSA_CAPA, 0) AS BSA       ," ).append("\n"); 
		query.append("                     DECODE(SIGN(SUBSTR(M.SLS_YRMON, 1, 4)||M.COST_WK - ( SELECT PRD.COST_YR||TO_CHAR(CEIL((TO_CHAR(SYSDATE, 'DDD') + 7 - TO_CHAR(TO_DATE(PRD.SLS_TO_DT, 'YYYYMMDD'), 'DDD')) / 7), 'FM00')" ).append("\n"); 
		query.append("                                                                            FROM MAS_WK_PRD PRD" ).append("\n"); 
		query.append("                                                                           WHERE PRD.COST_YR = TO_CHAR(SYSDATE, 'YYYY')" ).append("\n"); 
		query.append("                                                                             AND PRD.COST_WK = '01')), -1, 'Y', 'N') AS PAST," ).append("\n"); 
		query.append("                     DECODE(H.DIR_CD, NULL, 'N', 'Y') AS HH_FLG" ).append("\n"); 
		query.append("                    , CASE WHEN M.COST_YRMON >= '201501' " ).append("\n"); 
		query.append("                          THEN CEIL(TO_NUMBER(SUBSTR(M.COST_YRMON, -2))/3)||'Q' " ).append("\n"); 
		query.append("                          ELSE CEIL(TO_NUMBER(DECODE(M.COST_WK,'00','01','53','52',M.COST_WK))/13)||'Q'" ).append("\n"); 
		query.append("                      END BSE_QTR_CD --2015.03.04 CHM-201534435 SQM QTA주가 변경 관련 적용 요청" ).append("\n"); 
		query.append("                   , SUBSTR(M.COST_YRMON, 1,4) AS BSE_YR" ).append("\n"); 
		query.append("                FROM MAS_MON_VVD     M," ).append("\n"); 
		query.append("                     MAS_LANE_RGST   L," ).append("\n"); 
		query.append("                     BSA_VVD_OTR_CRR B," ).append("\n"); 
		query.append("                     (" ).append("\n"); 
		query.append("                        SELECT /*+ INDEX (P, XPKMAS_WK_PRD) */" ).append("\n"); 
		query.append("                               P.COST_YR||P.COST_WK AS COST_YRWK," ).append("\n"); 
		query.append("                               ROWNUM               AS RNUM" ).append("\n"); 
		query.append("                          FROM MAS_WK_PRD P" ).append("\n"); 
		query.append("                         WHERE P.COST_YR||P.COST_WK = @[year]||@[week] --sycha 20140610 '=' 비교로 변경하고,  ROWNUM  <= duration 조건 삭제" ).append("\n"); 
		query.append("                     ) P," ).append("\n"); 
		query.append("                     (" ).append("\n"); 
		query.append("       				 SELECT DISTINCT" ).append("\n"); 
		query.append("            			    SUBSTR(AA," ).append("\n"); 
		query.append("             					   INSTR(AA,',',1,LEVEL)+1," ).append("\n"); 
		query.append("               					   INSTR(AA,',',1,LEVEL+1) - INSTR(AA,',',1,LEVEL)" ).append("\n"); 
		query.append("              					  -1" ).append("\n"); 
		query.append("              					  ) RHQ_CD" ).append("\n"); 
		query.append("         			   FROM (SELECT ','||@[rhq]||',' AA FROM DUAL)" ).append("\n"); 
		query.append("          					  CONNECT BY LEVEL <= LENGTH(AA) - LENGTH(REPLACE(AA,','))-1" ).append("\n"); 
		query.append("                     ) C," ).append("\n"); 
		query.append("                     SPC_HD_HUL_MST H" ).append("\n"); 
		query.append("               WHERE SUBSTR(M.SLS_YRMON, 1, 4)||M.COST_WK = P.COST_YRWK" ).append("\n"); 
		query.append("                 AND (M.DELT_FLG IS NULL OR M.DELT_FLG = 'N')" ).append("\n"); 
		query.append("       " ).append("\n"); 
		query.append("#if (${trade} != '')" ).append("\n"); 
		query.append("                 AND M.TRD_CD = @[trade]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${subtrade1} != '')" ).append("\n"); 
		query.append("                 AND M.SUB_TRD_CD = @[subtrade1]" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${bound} != '')" ).append("\n"); 
		query.append("                 AND M.DIR_CD = (CASE " ).append("\n"); 
		query.append("									WHEN M.RLANE_CD IN ('AUSIA', 'CKAIA', 'WAXIA', 'AAZIA', 'QISIA', 'RUSIA', 'FOXIA') THEN" ).append("\n"); 
		query.append("											DECODE(@[bound], 'E', 'W', 'W', 'E', @[bound])" ).append("\n"); 
		query.append("									ELSE" ).append("\n"); 
		query.append("										@[bound]" ).append("\n"); 
		query.append("								END)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                 AND B.BSA_OP_JB_CD(+) = '007'" ).append("\n"); 
		query.append("                 AND B.CRR_CD      (+) = 'SML'" ).append("\n"); 
		query.append("                 AND M.TRD_CD          = L.TRD_CD" ).append("\n"); 
		query.append("                 AND M.RLANE_CD        = L.RLANE_CD" ).append("\n"); 
		query.append("                 AND M.DIR_CD          = L.DIR_CD" ).append("\n"); 
		query.append("                 AND M.IOC_CD          = L.IOC_CD" ).append("\n"); 
		query.append("                 AND L.DELT_FLG        = 'N'" ).append("\n"); 
		query.append("                 AND M.TRD_CD          = B.TRD_CD    (+)" ).append("\n"); 
		query.append("                 AND M.RLANE_CD        = B.RLANE_CD  (+)" ).append("\n"); 
		query.append("                 AND M.VSL_CD          = B.VSL_CD    (+)" ).append("\n"); 
		query.append("                 AND M.SKD_VOY_NO      = B.SKD_VOY_NO(+)" ).append("\n"); 
		query.append("                 AND M.DIR_CD          = B.SKD_DIR_CD(+)" ).append("\n"); 
		query.append("                 AND M.TRD_CD          = H.TRD_CD    (+)" ).append("\n"); 
		query.append("                 AND M.RLANE_CD        = H.RLANE_CD  (+)" ).append("\n"); 
		query.append("                 AND M.DIR_CD          = H.DIR_CD    (+)" ).append("\n"); 
		query.append("#if (${rlane1} != '')" ).append("\n"); 
		query.append("                 AND M.RLANE_CD         IN ($rlane1)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("           ) B," ).append("\n"); 
		query.append("           SPC_ALOC_CTRL_OPT O" ).append("\n"); 
		query.append("     WHERE B.TRD_CD     = O.REP_TRD_CD(+)" ).append("\n"); 
		query.append("       AND B.RLANE_CD   = O.RLANE_CD  (+)" ).append("\n"); 
		query.append("       AND B.DIR_CD     = O.DIR_CD    (+)" ).append("\n"); 
		query.append("       AND B.VSL_CD     = O.VSL_CD    (+)" ).append("\n"); 
		query.append("       AND B.SKD_VOY_NO = O.SKD_VOY_NO(+)" ).append("\n"); 
		query.append("       AND B.SKD_DIR_CD = O.SKD_DIR_CD(+)" ).append("\n"); 
		query.append("  ORDER BY B.VSL_CD    ," ).append("\n"); 
		query.append("           B.SKD_VOY_NO," ).append("\n"); 
		query.append("           B.DIR_CD" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", QTA_DATA AS (" ).append("\n"); 
		query.append("    SELECT 1 AS FLG    ," ).append("\n"); 
		query.append("           R.TRD_CD    ," ).append("\n"); 
		query.append("           R.DIR_CD    ," ).append("\n"); 
		query.append("           R.SUB_TRD_CD," ).append("\n"); 
		query.append("           R.RLANE_CD  ," ).append("\n"); 
		query.append("           NVL(( SELECT T2.CONV_RGN_OFC_CD" ).append("\n"); 
		query.append("                   FROM SPC_RGN_OFC_CONV T2" ).append("\n"); 
		query.append("                  WHERE T2.SLS_RGN_OFC_CD = R.OFC_CD), R.OFC_CD) AS OFC_CD," ).append("\n"); 
		query.append("           R.WK             ," ).append("\n"); 
		query.append("           R.NUM            ," ).append("\n"); 
		query.append("           R.VVD            ," ).append("\n"); 
		query.append("           R.BSA            ," ).append("\n"); 
		query.append("           R.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           R.ACCT_FLG       ," ).append("\n"); 
		query.append("           'C' AS CUST_CTRL_CD," ).append("\n"); 
		query.append("           ROUND(SUM(R.QTA_QTY)) AS QTA_QTY ," ).append("\n"); 
		query.append("           SUM(R.QTA_GREV)       AS QTA_GREV," ).append("\n"); 
		query.append("           SUM(R.QTA_CM)         AS QTA_CM  ," ).append("\n"); 
		query.append("           0 AS FCT_QTY ," ).append("\n"); 
		query.append("           0 AS FCT_GREV," ).append("\n"); 
		query.append("           0 AS FCT_CM  ," ).append("\n"); 
		query.append("           0 AS ALC_QTY ," ).append("\n"); 
		query.append("           0 AS ALC_GREV," ).append("\n"); 
		query.append("           0 AS ALC_CM  ," ).append("\n"); 
		query.append("           0 AS BKG_QTY ," ).append("\n"); 
		query.append("           0 AS BKG_GREV," ).append("\n"); 
		query.append("           0 AS BKG_CM" ).append("\n"); 
		query.append("      FROM (" ).append("\n"); 
		query.append("              SELECT MQ.TRD_CD     ," ).append("\n"); 
		query.append("                     A.SUB_TRD_CD  ," ).append("\n"); 
		query.append("                     MQ.RLANE_CD   ," ).append("\n"); 
		query.append("                     MQ.DIR_CD     ," ).append("\n"); 
		query.append("                     MQ.RGN_OFC_CD        AS OFC_CD," ).append("\n"); 
		query.append("                     A.COST_YR||A.COST_WK AS WK    ," ).append("\n"); 
		query.append("                     A.NUM," ).append("\n"); 
		query.append("                     MQ.VSL_CD||MQ.SKD_VOY_NO||MQ.SKD_DIR_CD AS VVD," ).append("\n"); 
		query.append("                     A.BSA            ," ).append("\n"); 
		query.append("                     A.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                     A.ACCT_FLG       ," ).append("\n"); 
		query.append("                     (MQ.LOD_QTY) AS QTA_QTY," ).append("\n"); 
		query.append("                     0 AS QTA_GREV," ).append("\n"); 
		query.append("                     0 AS QTA_CM" ).append("\n"); 
		query.append("                FROM MAS_MON_VVD_LV   A  ," ).append("\n"); 
		query.append("                     SQM_CFM_QTA      MQ ," ).append("\n"); 
		query.append("                     SQM_QTA_RLSE_VER MQR," ).append("\n"); 
		query.append("                     SPC_OFC_LVL      O" ).append("\n"); 
		query.append("               WHERE 1=1" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${rhq} != '')" ).append("\n"); 
		query.append("                 AND A.RHQ_CD = O.N2ND_PRNT_OFC_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${area} != '')" ).append("\n"); 
		query.append("                 AND A.AQ_CD = MQ.AQ_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${sales_office} != '')" ).append("\n"); 
		query.append("                 AND A.RGN_OFC_CD = NVL(( SELECT O2.CONV_RGN_OFC_CD" ).append("\n"); 
		query.append("                                            FROM SPC_RGN_OFC_CONV O2" ).append("\n"); 
		query.append("                                           WHERE O2.SLS_RGN_OFC_CD = MQ.RGN_OFC_CD), MQ.RGN_OFC_CD)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${pol_cd} != '')" ).append("\n"); 
		query.append("                 AND A.POL_CD = '00000'" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                 AND MQR.BSE_YR          = A.BSE_YR" ).append("\n"); 
		query.append("                 --AND MQR.BSE_QTR_CD      = CEIL(TO_NUMBER(DECODE(A.COST_WK,'00','01','53','52',A.COST_WK))/13)||'Q' --CEIL(TO_NUMBER(A.COST_MON)/3)||'Q'" ).append("\n"); 
		query.append("                 AND MQR.BSE_QTR_CD          = A.BSE_QTR_CD" ).append("\n"); 
		query.append("                 AND MQR.SQM_VER_STS_CD  = 'R'" ).append("\n"); 
		query.append("                 AND MQR.BSE_TP_CD       = 'Q' -- 분기 20131205추가" ).append("\n"); 
		query.append("                 AND MQ.QTA_RLSE_VER_NO  = MQR.QTA_RLSE_VER_NO" ).append("\n"); 
		query.append("                 AND MQ.BSE_TP_CD        = MQR.BSE_TP_CD -- 분기 20131205추가  " ).append("\n"); 
		query.append("                 AND MQ.BSE_YR           = MQR.BSE_YR" ).append("\n"); 
		query.append("                 AND MQ.BSE_QTR_CD       = MQR.BSE_QTR_CD                 " ).append("\n"); 
		query.append("                 AND MQ.QTA_TGT_CD       = 'D'" ).append("\n"); 
		query.append("                 AND MQ.OFC_VW_CD        = 'L'  -- 20131205추가" ).append("\n"); 
		query.append("                 AND MQ.TRD_CD           = A.TRD_CD" ).append("\n"); 
		query.append("                 AND MQ.RLANE_CD         = A.RLANE_CD" ).append("\n"); 
		query.append("                 AND MQ.DIR_CD           = A.SKD_DIR_CD" ).append("\n"); 
		query.append("                 AND MQ.VSL_CD           = A.VSL_CD" ).append("\n"); 
		query.append("                 AND MQ.SKD_VOY_NO       = A.SKD_VOY_NO" ).append("\n"); 
		query.append("                 AND MQ.SKD_DIR_CD       = A.SKD_DIR_CD" ).append("\n"); 
		query.append("                 AND A.COST_YR || A.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK" ).append("\n"); 
		query.append("                 --AND MQ.RGN_OFC_CD        = O.OFC_CD" ).append("\n"); 
		query.append("                 AND NVL((SELECT O2.CONV_RGN_OFC_CD" ).append("\n"); 
		query.append("                            FROM SPC_RGN_OFC_CONV O2" ).append("\n"); 
		query.append("                           WHERE O2.SLS_RGN_OFC_CD = MQ.RGN_OFC_CD), MQ.RGN_OFC_CD) = O.OFC_CD" ).append("\n"); 
		query.append("           ) R" ).append("\n"); 
		query.append("  GROUP BY R.TRD_CD         ," ).append("\n"); 
		query.append("           R.DIR_CD         ," ).append("\n"); 
		query.append("           R.SUB_TRD_CD     ," ).append("\n"); 
		query.append("           R.RLANE_CD       ," ).append("\n"); 
		query.append("           R.OFC_CD         ," ).append("\n"); 
		query.append("           R.WK             ," ).append("\n"); 
		query.append("           R.NUM            ," ).append("\n"); 
		query.append("           R.VVD            ," ).append("\n"); 
		query.append("           R.BSA            ," ).append("\n"); 
		query.append("           R.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           R.ACCT_FLG" ).append("\n"); 
		query.append("    HAVING ROUND(SUM(R.QTA_QTY)) > 0" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", FCT_DATA AS (" ).append("\n"); 
		query.append("    SELECT 2 AS FLG         ," ).append("\n"); 
		query.append("           B.TRD_CD         ," ).append("\n"); 
		query.append("           B.DIR_CD         ," ).append("\n"); 
		query.append("           B.SUB_TRD_CD     ," ).append("\n"); 
		query.append("           B.RLANE_CD       ," ).append("\n"); 
		query.append("           B.OFC_CD         ," ).append("\n"); 
		query.append("           B.WK             ," ).append("\n"); 
		query.append("           B.NUM            ," ).append("\n"); 
		query.append("           B.VVD            ," ).append("\n"); 
		query.append("           B.BSA            ," ).append("\n"); 
		query.append("           B.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           B.ACCT_FLG       ," ).append("\n"); 
		query.append("           0 AS QTA_QTY ," ).append("\n"); 
		query.append("           0 AS QTA_GREV," ).append("\n"); 
		query.append("           0 AS QTA_CM  ," ).append("\n"); 
		query.append("           SUM(B.FCT_QTY) AS FCT_QTY," ).append("\n"); 
		query.append("           0 AS FCT_GREV," ).append("\n"); 
		query.append("           0 AS FCT_CM  ," ).append("\n"); 
		query.append("           0 AS ALC_QTY ," ).append("\n"); 
		query.append("           0 AS ALC_GREV," ).append("\n"); 
		query.append("           0 AS ALC_CM  ," ).append("\n"); 
		query.append("           0 AS BKG_QTY ," ).append("\n"); 
		query.append("           0 AS BKG_GREV," ).append("\n"); 
		query.append("           0 AS BKG_CM  ," ).append("\n"); 
		query.append("           MAX(B.PAST) AS PAST," ).append("\n"); 
		query.append("           B.CUST_CTRL_CD" ).append("\n"); 
		query.append("      FROM (" ).append("\n"); 
		query.append("              SELECT B.TRD_CD    ," ).append("\n"); 
		query.append("                     B.DIR_CD    ," ).append("\n"); 
		query.append("                     B.SUB_TRD_CD," ).append("\n"); 
		query.append("                     B.RLANE_CD  ," ).append("\n"); 
		query.append("                     B.SLS_RGN_OFC_CD     AS OFC_CD," ).append("\n"); 
		query.append("                     A.COST_YR||A.COST_WK AS WK    ," ).append("\n"); 
		query.append("                     A.NUM," ).append("\n"); 
		query.append("                     B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD AS VVD," ).append("\n"); 
		query.append("                     A.BSA            ," ).append("\n"); 
		query.append("                     A.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                     A.ACCT_FLG       ," ).append("\n"); 
		query.append("                     NVL(B.CFM_TTL_QTY, 0) + NVL(B.CFM_40FT_HC_QTY, 0) * 2 + NVL(B.CFM_45FT_HC_QTY, 0) * 2 + NVL(B.CFM_53FT_QTY, 0) * 2 AS FCT_QTY," ).append("\n"); 
		query.append("                     A.PAST," ).append("\n"); 
		query.append("                     NVL((SELECT CC.CUST_CTRL_CD" ).append("\n"); 
		query.append("  				            FROM SPC_MDL_CUST_CTRL CC" ).append("\n"); 
		query.append("  				           WHERE CC.TRD_CD      = A.TRD_CD" ).append("\n"); 
		query.append("  				             AND CC.COST_YRWK   = SUBSTR(A.SEASON, 1, 6)" ).append("\n"); 
		query.append("  				             AND CC.VER_SEQ     = SUBSTR(A.SEASON, 8)" ).append("\n"); 
		query.append("  				             AND CC.CUST_CNT_CD = B.CUST_CNT_CD" ).append("\n"); 
		query.append("  				             AND CC.CUST_SEQ    = B.CUST_SEQ" ).append("\n"); 
		query.append("  				             AND NVL(CC.SC_NO, NVL(CC.RFA_NO,'X')) = NVL(B.SC_NO,NVL(B.RFA_NO,'X'))" ).append("\n"); 
		query.append("  				             --AND DECODE(CC.TRD_CD, 'AES', NVL(CC.RFA_NO,'X'), NVL(CC.SC_NO,NVL(B.SC_NO,'X'))) = DECODE(CC.TRD_CD, 'AES', NVL(B.RFA_NO,'X'),NVL(B.SC_NO,'X'))" ).append("\n"); 
		query.append("  				             AND ROWNUM = 1  -- TPS만 SC 있음" ).append("\n"); 
		query.append("  		 		       ),'C') AS CUST_CTRL_CD" ).append("\n"); 
		query.append("                FROM MAS_MON_VVD_LV     A," ).append("\n"); 
		query.append("                     SPC_DLY_FCAST_CUST B" ).append("\n"); 
		query.append("               WHERE A.TRD_CD      = B.TRD_CD" ).append("\n"); 
		query.append("                 AND A.RLANE_CD    = B.RLANE_CD" ).append("\n"); 
		query.append("                 AND A.IOC_CD      = B.IOC_TS_CD" ).append("\n"); 
		query.append("                 AND A.VSL_CD      = B.VSL_CD" ).append("\n"); 
		query.append("                 AND A.SKD_VOY_NO  = B.SKD_VOY_NO" ).append("\n"); 
		query.append("                 AND A.DIR_CD      = B.SKD_DIR_CD" ).append("\n"); 
		query.append("                 AND A.DIR_CD      = B.DIR_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${rhq} != '')" ).append("\n"); 
		query.append("       AND ((     A.RHQ_CD = 'SHARC'" ).append("\n"); 
		query.append("              AND EXISTS ( SELECT 1" ).append("\n"); 
		query.append("                             FROM MDM_LOCATION L" ).append("\n"); 
		query.append("                            WHERE SUBSTR(B.POL_YD_CD, 1, 5) = L.LOC_CD" ).append("\n"); 
		query.append("                              AND SPC_CONTI_CONV_FNC(L.CONTI_CD,A.RLANE_CD,A.DIR_CD) = 'A')" ).append("\n"); 
		query.append("                              AND A.RHQ_CD = B.SLS_RHQ_CD)  " ).append("\n"); 
		query.append("             OR A.RHQ_CD = B.SLS_RHQ_CD)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${area} != '')" ).append("\n"); 
		query.append("       AND B.SLS_RGN_OFC_CD IN ( SELECT O.OFC_CD" ).append("\n"); 
		query.append("                                   FROM SPC_OFC_LVL O" ).append("\n"); 
		query.append("                                  WHERE O.N3RD_PRNT_OFC_CD = A.AQ_CD" ).append("\n"); 
		query.append("                                    AND A.COST_YR || A.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK )" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${sales_office} != '')" ).append("\n"); 
		query.append("       AND A.RGN_OFC_CD = NVL(( SELECT T2.CONV_RGN_OFC_CD" ).append("\n"); 
		query.append("                                  FROM SPC_RGN_OFC_CONV T2" ).append("\n"); 
		query.append("                                 WHERE T2.SLS_RGN_OFC_CD = B.SLS_RGN_OFC_CD), B.SLS_RGN_OFC_CD )" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${pol_cd} != '')" ).append("\n"); 
		query.append("       AND A.POL_CD = B.POL_YD_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("	" ).append("\n"); 
		query.append("           ) B" ).append("\n"); 
		query.append("  GROUP BY B.TRD_CD         ," ).append("\n"); 
		query.append("           B.DIR_CD         ," ).append("\n"); 
		query.append("           B.SUB_TRD_CD     ," ).append("\n"); 
		query.append("           B.RLANE_CD       ," ).append("\n"); 
		query.append("           B.OFC_CD         ," ).append("\n"); 
		query.append("           B.WK             ," ).append("\n"); 
		query.append("           B.NUM            ," ).append("\n"); 
		query.append("           B.VVD            ," ).append("\n"); 
		query.append("           B.BSA            ," ).append("\n"); 
		query.append("           B.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           B.ACCT_FLG       ," ).append("\n"); 
		query.append("           B.CUST_CTRL_CD" ).append("\n"); 
		query.append("   HAVING SUM(B.FCT_QTY) > 0" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", ALC_DATA AS (" ).append("\n"); 
		query.append("    SELECT 3 AS FLG    ," ).append("\n"); 
		query.append("           B.TRD_CD    ," ).append("\n"); 
		query.append("           B.DIR_CD    ," ).append("\n"); 
		query.append("           B.SUB_TRD_CD," ).append("\n"); 
		query.append("           B.RLANE_CD  ," ).append("\n"); 
		query.append("           B.SLS_RGN_OFC_CD     AS OFC_CD," ).append("\n"); 
		query.append("           A.COST_YR||A.COST_WK AS WK    ," ).append("\n"); 
		query.append("           A.NUM," ).append("\n"); 
		query.append("           B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD AS VVD," ).append("\n"); 
		query.append("           A.BSA            ," ).append("\n"); 
		query.append("           A.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           A.ACCT_FLG       ," ).append("\n"); 
		query.append("           'C' AS CUST_CTRL_CD," ).append("\n"); 
		query.append("           0 AS QTA_QTY ," ).append("\n"); 
		query.append("           0 AS QTA_GREV," ).append("\n"); 
		query.append("           0 AS QTA_CM  ," ).append("\n"); 
		query.append("           0 AS FCT_QTY ," ).append("\n"); 
		query.append("           0 AS FCT_GREV," ).append("\n"); 
		query.append("           0 AS FCT_CM  ," ).append("\n"); 
		query.append("           SUM(B.ASGN_TTL_QTY) AS ALC_QTY," ).append("\n"); 
		query.append("           0 AS ALC_GREV," ).append("\n"); 
		query.append("           0 AS ALC_CM  ," ).append("\n"); 
		query.append("           0 AS BKG_QTY ," ).append("\n"); 
		query.append("           0 AS BKG_GREV," ).append("\n"); 
		query.append("           0 AS BKG_CM" ).append("\n"); 
		query.append("      FROM MAS_MON_VVD_LV   A," ).append("\n"); 
		query.append("           SPC_ALOC_POL_POD B," ).append("\n"); 
		query.append("           VSK_VSL_PORT_SKD V" ).append("\n"); 
		query.append("     WHERE A.TRD_CD     = B.TRD_CD" ).append("\n"); 
		query.append("       AND A.RLANE_CD   = B.RLANE_CD" ).append("\n"); 
		query.append("       AND A.IOC_CD     = B.IOC_CD" ).append("\n"); 
		query.append("       AND A.VSL_CD     = B.VSL_CD" ).append("\n"); 
		query.append("       AND A.SKD_VOY_NO = B.SKD_VOY_NO" ).append("\n"); 
		query.append("       AND A.DIR_CD     = B.SKD_DIR_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${rhq} != '')" ).append("\n"); 
		query.append("       AND ((     A.RHQ_CD = 'SHARC'" ).append("\n"); 
		query.append("              AND EXISTS ( SELECT 1" ).append("\n"); 
		query.append("                             FROM MDM_LOCATION L" ).append("\n"); 
		query.append("                            WHERE SUBSTR(B.POL_YD_CD, 1, 5) = L.LOC_CD" ).append("\n"); 
		query.append("                              AND SPC_CONTI_CONV_FNC(L.CONTI_CD,A.RLANE_CD,A.DIR_CD) = 'A')" ).append("\n"); 
		query.append("                              AND A.RHQ_CD = B.SLS_RHQ_CD) " ).append("\n"); 
		query.append("              OR A.RHQ_CD = B.SLS_RHQ_CD)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${area} != '')" ).append("\n"); 
		query.append("       AND A.AQ_CD = B.SLS_AQ_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${sales_office} != '')" ).append("\n"); 
		query.append("       AND A.RGN_OFC_CD = B.SLS_RGN_OFC_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${pol_cd} != '')" ).append("\n"); 
		query.append("       AND A.POL_CD = B.POL_YD_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("       AND (    (A.OFC_CD IN ('SELCTY', 'SELCDO', 'SINRS', 'CLTCO'))" ).append("\n"); 
		query.append("             OR (B.SLS_RHQ_CD = A.OFC_CD)" ).append("\n"); 
		query.append("             OR (B.SLS_AQ_CD IN ( A.OFC_CD, DECODE(A.OFC_CD, 'SHADPI', 'SHADSA'), DECODE(A.OFC_CD, 'SHADSA', 'SHADPI')))" ).append("\n"); 
		query.append("             OR (B.SLS_RGN_OFC_CD = A.OFC_CD))" ).append("\n"); 
		query.append("       AND B.TS_FLG = 'N'" ).append("\n"); 
		query.append("       AND SUBSTR(B.RLANE_CD, 1, 3) = V.SLAN_CD" ).append("\n"); 
		query.append("       AND B.VSL_CD     = V.VSL_CD" ).append("\n"); 
		query.append("       AND B.SKD_VOY_NO = V.SKD_VOY_NO" ).append("\n"); 
		query.append("       AND B.DIR_CD     = V.SKD_DIR_CD" ).append("\n"); 
		query.append("       AND B.POD_YD_CD  = V.YD_CD" ).append("\n"); 
		query.append("       AND A.ACCT_FLG = 'N'" ).append("\n"); 
		query.append("  GROUP BY B.TRD_CD    ," ).append("\n"); 
		query.append("           B.DIR_CD    ," ).append("\n"); 
		query.append("           B.SUB_TRD_CD," ).append("\n"); 
		query.append("           B.RLANE_CD  ," ).append("\n"); 
		query.append("           B.SLS_RGN_OFC_CD," ).append("\n"); 
		query.append("           A.COST_YR||A.COST_WK," ).append("\n"); 
		query.append("           A.NUM," ).append("\n"); 
		query.append("           B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD," ).append("\n"); 
		query.append("           A.BSA," ).append("\n"); 
		query.append("           A.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           A.ACCT_FLG" ).append("\n"); 
		query.append("    HAVING SUM(B.ASGN_TTL_QTY) > 0" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", ALOC_CUST_DATA AS (" ).append("\n"); 
		query.append("    SELECT 3 AS FLG    ," ).append("\n"); 
		query.append("           B.TRD_CD    ," ).append("\n"); 
		query.append("           B.DIR_CD    ," ).append("\n"); 
		query.append("           B.SUB_TRD_CD," ).append("\n"); 
		query.append("           B.RLANE_CD  ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("           B.SLS_RGN_OFC_CD     AS OFC_CD," ).append("\n"); 
		query.append("           A.COST_YR||A.COST_WK AS WK    ," ).append("\n"); 
		query.append("           A.NUM," ).append("\n"); 
		query.append("           B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD AS VVD," ).append("\n"); 
		query.append("           A.BSA            ," ).append("\n"); 
		query.append("           A.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           A.ACCT_FLG       ," ).append("\n"); 
		query.append("           B.CUST_CTRL_CD   ," ).append("\n"); 
		query.append("           0 AS QTA_QTY ," ).append("\n"); 
		query.append("           0 AS QTA_GREV," ).append("\n"); 
		query.append("           0 AS QTA_CM  ," ).append("\n"); 
		query.append("           0 AS FCT_QTY ," ).append("\n"); 
		query.append("           0 AS FCT_GREV," ).append("\n"); 
		query.append("           0 AS FCT_CM  ," ).append("\n"); 
		query.append("           SUM(B.ASGN_TTL_QTY) AS ALC_QTY," ).append("\n"); 
		query.append("           0 AS ALC_GREV," ).append("\n"); 
		query.append("           0 AS ALC_CM  ," ).append("\n"); 
		query.append("           0 AS BKG_QTY ," ).append("\n"); 
		query.append("           0 AS BKG_GREV," ).append("\n"); 
		query.append("           0 AS BKG_CM" ).append("\n"); 
		query.append("      FROM MAS_MON_VVD_LV        A," ).append("\n"); 
		query.append("           SPC_ALOC_CUST_POL_POD B," ).append("\n"); 
		query.append("           VSK_VSL_PORT_SKD      V" ).append("\n"); 
		query.append("     WHERE A.TRD_CD     = B.TRD_CD" ).append("\n"); 
		query.append("       AND A.RLANE_CD   = B.RLANE_CD" ).append("\n"); 
		query.append("       AND A.IOC_CD     = B.IOC_CD" ).append("\n"); 
		query.append("       AND A.VSL_CD     = B.VSL_CD" ).append("\n"); 
		query.append("       AND A.SKD_VOY_NO = B.SKD_VOY_NO" ).append("\n"); 
		query.append("       AND A.DIR_CD     = B.SKD_DIR_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${rhq} != '')" ).append("\n"); 
		query.append("       AND ((     A.RHQ_CD = 'SHARC'" ).append("\n"); 
		query.append("              AND EXISTS ( SELECT 1" ).append("\n"); 
		query.append("                             FROM MDM_LOCATION L" ).append("\n"); 
		query.append("                            WHERE SUBSTR(B.POL_YD_CD, 1, 5) = L.LOC_CD" ).append("\n"); 
		query.append("                              AND SPC_CONTI_CONV_FNC(L.CONTI_CD,A.RLANE_CD,A.DIR_CD) = 'A')" ).append("\n"); 
		query.append("                              AND A.RHQ_CD = B.SLS_RHQ_CD) " ).append("\n"); 
		query.append("              OR A.RHQ_CD = B.SLS_RHQ_CD)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${area} != '')" ).append("\n"); 
		query.append("       AND A.AQ_CD = B.SLS_AQ_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("#if (${sales_office} != '')" ).append("\n"); 
		query.append("       AND A.RGN_OFC_CD = B.SLS_RGN_OFC_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${pol_cd} != '')" ).append("\n"); 
		query.append("       AND A.POL_CD = B.POL_YD_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("       AND (    (A.OFC_CD IN ('SELCTY', 'SELCDO', 'SINRS', 'CLTCO'))" ).append("\n"); 
		query.append("             OR (B.SLS_RHQ_CD = A.OFC_CD)" ).append("\n"); 
		query.append("             OR (B.SLS_AQ_CD IN ( A.OFC_CD, DECODE(A.OFC_CD, 'SHADPI', 'SHADSA'), DECODE(A.OFC_CD, 'SHADSA', 'SHADPI')))" ).append("\n"); 
		query.append("             OR (B.SLS_RGN_OFC_CD = A.OFC_CD))" ).append("\n"); 
		query.append("       AND B.TS_FLG = 'N'" ).append("\n"); 
		query.append("       AND SUBSTR(B.RLANE_CD, 1, 3) = V.SLAN_CD" ).append("\n"); 
		query.append("       AND B.VSL_CD     = V.VSL_CD" ).append("\n"); 
		query.append("       AND B.SKD_VOY_NO = V.SKD_VOY_NO" ).append("\n"); 
		query.append("       AND B.DIR_CD     = V.SKD_DIR_CD" ).append("\n"); 
		query.append("       AND B.POD_YD_CD  = V.YD_CD" ).append("\n"); 
		query.append("       " ).append("\n"); 
		query.append("       AND A.ACCT_FLG = 'Y'" ).append("\n"); 
		query.append("  GROUP BY B.TRD_CD    ," ).append("\n"); 
		query.append("           B.DIR_CD    ," ).append("\n"); 
		query.append("           B.SUB_TRD_CD," ).append("\n"); 
		query.append("           B.RLANE_CD  ," ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("           B.SLS_RGN_OFC_CD," ).append("\n"); 
		query.append("           A.COST_YR||A.COST_WK," ).append("\n"); 
		query.append("           A.NUM," ).append("\n"); 
		query.append("           B.VSL_CD||B.SKD_VOY_NO||B.SKD_DIR_CD," ).append("\n"); 
		query.append("           A.BSA," ).append("\n"); 
		query.append("           A.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           A.ACCT_FLG       ," ).append("\n"); 
		query.append("           B.CUST_CTRL_CD" ).append("\n"); 
		query.append("    HAVING SUM(B.ASGN_TTL_QTY) > 0" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(",RFA_BKG_DATA AS (" ).append("\n"); 
		query.append("SELECT SHP_CUST_CD," ).append("\n"); 
		query.append("       POL_CD," ).append("\n"); 
		query.append("       POD_CD," ).append("\n"); 
		query.append("       RFA_NO," ).append("\n"); 
		query.append("       CUST_CTRL_CD" ).append("\n"); 
		query.append("  FROM (" ).append("\n"); 
		query.append("        SELECT " ).append("\n"); 
		query.append("               CUST_CD AS  SHP_CUST_CD," ).append("\n"); 
		query.append("               POL_CD," ).append("\n"); 
		query.append("               POD_CD," ).append("\n"); 
		query.append("               MAX(RFA_NO) OVER(PARTITION BY CUST_CD,POL_CD,POD_CD) AS RFA_NO, " ).append("\n"); 
		query.append("               CUST_CTRL_CD,             " ).append("\n"); 
		query.append("               MIN(CUST_CTRL_CD) OVER(PARTITION BY CUST_CD,POL_CD,POD_CD) AS CUST_CTRL_CD_MIN               " ).append("\n"); 
		query.append("          FROM (" ).append("\n"); 
		query.append("                SELECT (SELECT CUST_CNT_CD||LPAD(CUST_SEQ,6,'0')" ).append("\n"); 
		query.append("                          FROM BKG_CUSTOMER B" ).append("\n"); 
		query.append("                         WHERE B.BKG_NO         = A.BKG_NO" ).append("\n"); 
		query.append("                           AND B.BKG_CUST_TP_CD = 'S'" ).append("\n"); 
		query.append("                           AND B.CUST_CNT_CD    = 'CN'" ).append("\n"); 
		query.append("                       ) CUST_CD," ).append("\n"); 
		query.append("                       A.POL_CD," ).append("\n"); 
		query.append("                       A.POD_CD,                       " ).append("\n"); 
		query.append("                       C.RFA_NO," ).append("\n"); 
		query.append("                       C.CUST_CTRL_CD" ).append("\n"); 
		query.append("                  FROM BKG_BOOKING A," ).append("\n"); 
		query.append("                       (" ).append("\n"); 
		query.append("                        SELECT RFA_NO," ).append("\n"); 
		query.append("                               CUST_CTRL_CD" ).append("\n"); 
		query.append("                          FROM SPC_MDL_CUST_CTRL M," ).append("\n"); 
		query.append("                               MAS_MON_VVD_LV S" ).append("\n"); 
		query.append("                         WHERE M.TRD_CD    = 'AES'" ).append("\n"); 
		query.append("                           AND M.TRD_CD    = S.TRD_CD " ).append("\n"); 
		query.append("                           AND M.COST_YRWK = SUBSTR(S.SEASON, 1, 6)" ).append("\n"); 
		query.append("                           AND M.VER_SEQ   = SUBSTR(S.SEASON, 8)" ).append("\n"); 
		query.append("                           AND M.RFA_NO IS NOT NULL" ).append("\n"); 
		query.append("                       ) C" ).append("\n"); 
		query.append("                 WHERE A.RFA_NO = C.RFA_NO " ).append("\n"); 
		query.append("               )" ).append("\n"); 
		query.append("         WHERE CUST_CD IS NOT NULL" ).append("\n"); 
		query.append("        )" ).append("\n"); 
		query.append("  WHERE CUST_CTRL_CD_MIN = CUST_CTRL_CD" ).append("\n"); 
		query.append(" GROUP BY SHP_CUST_CD," ).append("\n"); 
		query.append("       POL_CD," ).append("\n"); 
		query.append("       POD_CD," ).append("\n"); 
		query.append("       RFA_NO," ).append("\n"); 
		query.append("       CUST_CTRL_CD" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", BKG_DATA AS (" ).append("\n"); 
		query.append("    SELECT 4 AS FLG         ," ).append("\n"); 
		query.append("           B.TRD_CD         ," ).append("\n"); 
		query.append("           B.DIR_CD         ," ).append("\n"); 
		query.append("           B.SUB_TRD_CD     ," ).append("\n"); 
		query.append("           B.RLANE_CD       ," ).append("\n"); 
		query.append("           B.OFC_CD         ," ).append("\n"); 
		query.append("           B.WK             ," ).append("\n"); 
		query.append("           B.NUM            ," ).append("\n"); 
		query.append("           B.VVD            ," ).append("\n"); 
		query.append("           B.BSA            ," ).append("\n"); 
		query.append("           B.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           B.ACCT_FLG       ," ).append("\n"); 
		query.append("           0 AS QTA_QTY ," ).append("\n"); 
		query.append("           0 AS QTA_GREV," ).append("\n"); 
		query.append("           0 AS QTA_CM  ," ).append("\n"); 
		query.append("           0 AS FCT_QTY ," ).append("\n"); 
		query.append("           0 AS FCT_GREV," ).append("\n"); 
		query.append("           0 AS FCT_CM  ," ).append("\n"); 
		query.append("           0 AS ALC_QTY ," ).append("\n"); 
		query.append("           0 AS ALC_GREV," ).append("\n"); 
		query.append("           0 AS ALC_CM  ," ).append("\n"); 
		query.append("           SUM(B.BKG_QTY) AS BKG_QTY," ).append("\n"); 
		query.append("           0 AS BKG_GREV," ).append("\n"); 
		query.append("           0 AS BKG_CM  ," ).append("\n"); 
		query.append("           MAX(B.PAST) AS PAST," ).append("\n"); 
		query.append("           B.CUST_CTRL_CD" ).append("\n"); 
		query.append("      FROM (" ).append("\n"); 
		query.append("            SELECT B.TRD_CD    ," ).append("\n"); 
		query.append("                   B.DIR_CD    ," ).append("\n"); 
		query.append("                   B.SUB_TRD_CD," ).append("\n"); 
		query.append("                   B.RLANE_CD  ," ).append("\n"); 
		query.append("                   B.OFC_CD," ).append("\n"); 
		query.append("                   B.WK    ," ).append("\n"); 
		query.append("                   B.NUM," ).append("\n"); 
		query.append("                   B.VVD," ).append("\n"); 
		query.append("                   B.BSA            ," ).append("\n"); 
		query.append("                   B.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                   B.ACCT_FLG       ," ).append("\n"); 
		query.append("                   B.BKG_QTY," ).append("\n"); 
		query.append("                   B.PAST," ).append("\n"); 
		query.append("                   CASE WHEN B.AES_FLG = 'Y' THEN                        " ).append("\n"); 
		query.append("                        NVL(RD.CUST_CTRL_CD,'C')                         " ).append("\n"); 
		query.append("                   ELSE" ).append("\n"); 
		query.append("                        B.CUST_CTRL_CD" ).append("\n"); 
		query.append("                   END AS CUST_CTRL_CD" ).append("\n"); 
		query.append("             FROM (" ).append("\n"); 
		query.append("                      SELECT A.TRD_CD    ," ).append("\n"); 
		query.append("                             A.DIR_CD    ," ).append("\n"); 
		query.append("                             A.SUB_TRD_CD," ).append("\n"); 
		query.append("                             A.RLANE_CD  ," ).append("\n"); 
		query.append("                             O.N4TH_PRNT_OFC_CD   AS OFC_CD," ).append("\n"); 
		query.append("                             A.COST_YR||A.COST_WK AS WK    ," ).append("\n"); 
		query.append("                             A.NUM," ).append("\n"); 
		query.append("                             A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD AS VVD," ).append("\n"); 
		query.append("                             A.BSA            ," ).append("\n"); 
		query.append("                             A.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                             A.ACCT_FLG       ," ).append("\n"); 
		query.append("                             ( SELECT SUM(DECODE(SPC_GET_CNTR_SZ_FNC(Q.CNTR_TPSZ_CD), '2', 1, 2) * Q.OP_CNTR_QTY)" ).append("\n"); 
		query.append("                                 FROM BKG_QUANTITY Q" ).append("\n"); 
		query.append("                                WHERE B.BKG_NO = Q.BKG_NO" ).append("\n"); 
		query.append("                               HAVING SUM(DECODE(SPC_GET_CNTR_SZ_FNC(Q.CNTR_TPSZ_CD), '2', 1, 2) * Q.OP_CNTR_QTY) > 0" ).append("\n"); 
		query.append("                             ) AS BKG_QTY," ).append("\n"); 
		query.append("                             A.PAST," ).append("\n"); 
		query.append("                             " ).append("\n"); 
		query.append("                             CASE WHEN A.TRD_CD = 'AES' AND DECODE(SUBSTR(B.RFA_NO, 1, 3), 'DUM', '', B.RFA_NO) IS NULL AND BC.CUST_CNT_CD = 'CN' AND B.SC_NO IS NULL THEN" ).append("\n"); 
		query.append("                                  'Y'                             " ).append("\n"); 
		query.append("                             ELSE  " ).append("\n"); 
		query.append("                                  'N'" ).append("\n"); 
		query.append("                             END AS AES_FLG," ).append("\n"); 
		query.append("                             " ).append("\n"); 
		query.append("                             BC.CUST_CNT_CD||LPAD(BC.CUST_SEQ,6,'0') AS SHP_CUST_CD, " ).append("\n"); 
		query.append("                             B.POL_CD AS BKG_POL_CD," ).append("\n"); 
		query.append("                             B.POD_CD AS BKG_POD_CD," ).append("\n"); 
		query.append("                     " ).append("\n"); 
		query.append("                             NVL((SELECT CC.CUST_CTRL_CD" ).append("\n"); 
		query.append("                                    FROM SPC_MDL_CUST_CTRL CC" ).append("\n"); 
		query.append("                                   WHERE CC.TRD_CD      = A.TRD_CD" ).append("\n"); 
		query.append("                                     AND CC.COST_YRWK   = SUBSTR(A.SEASON, 1, 6)" ).append("\n"); 
		query.append("                                     AND CC.VER_SEQ     = SUBSTR(A.SEASON, 8)" ).append("\n"); 
		query.append("                                     AND CC.CUST_CNT_CD = B.CTRT_CUST_CNT_CD" ).append("\n"); 
		query.append("                                     AND CC.CUST_SEQ    = B.CTRT_CUST_SEQ" ).append("\n"); 
		query.append("                                     AND NVL(CC.SC_NO, NVL(CC.RFA_NO,'X')) = NVL(SPC_GET_SMP_AMEND_FNC(CC.TRD_CD, CC.COST_YRWK, CC.VER_SEQ, B.SC_NO), NVL(SPC_GET_SMP_AMEND_FNC(CC.TRD_CD, CC.COST_YRWK, CC.VER_SEQ, DECODE(SUBSTR(B.RFA_NO, 1, 3), 'DUM', '', B.RFA_NO)),'X'))" ).append("\n"); 
		query.append("                                     --AND DECODE(CC.TRD_CD, 'AES', NVL(CC.RFA_NO,'X'), NVL(CC.SC_NO,NVL(SPC_GET_SMP_AMEND_FNC(CC.TRD_CD, CC.COST_YRWK, CC.VER_SEQ, B.SC_NO),'X'))) = DECODE(CC.TRD_CD, 'AES', NVL(SPC_GET_SMP_AMEND_FNC(CC.TRD_CD, CC.COST_YRWK, CC.VER_SEQ, DECODE(SUBSTR(B.RFA_NO, 1, 3), 'DUM', '', B.RFA_NO)),'X'), NVL(SPC_GET_SMP_AMEND_FNC(CC.TRD_CD, CC.COST_YRWK, CC.VER_SEQ, B.SC_NO),'X'))" ).append("\n"); 
		query.append("                                     AND ROWNUM = 1), 'C') AS CUST_CTRL_CD" ).append("\n"); 
		query.append(" " ).append("\n"); 
		query.append("                FROM SPC_OFC_LVL        O  ," ).append("\n"); 
		query.append("                     BKG_BOOKING        B  ," ).append("\n"); 
		query.append("                     MDM_DTL_REV_LANE   DRL," ).append("\n"); 
		query.append("                     MDM_REV_LANE       RL ," ).append("\n"); 
		query.append("                     MAS_MON_VVD_LV     A  ," ).append("\n"); 
		query.append("                     BKG_VVD            BV ," ).append("\n"); 
		query.append("                     BKG_CUSTOMER       BC  --20140304 추가" ).append("\n"); 
		query.append("               WHERE O.OFC_CD         = SPC_SCR_OFC_CONV_FNC(B.OB_SLS_OFC_CD)" ).append("\n"); 
		query.append("                 AND B.BKG_STS_CD    IN('W','F')" ).append("\n"); 
		query.append("                 AND B.BKG_CGO_TP_CD IN ('F', 'B', 'R')" ).append("\n"); 
		query.append("                 AND A.VSL_CD         = B.VSL_CD" ).append("\n"); 
		query.append("                 AND A.SKD_VOY_NO     = B.SKD_VOY_NO" ).append("\n"); 
		query.append("                 AND A.SKD_DIR_CD     = B.SKD_DIR_CD" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${rhq} != '' || ${area} != '' || ${sales_office} != '')" ).append("\n"); 
		query.append("       AND (    (A.RHQ_CD = 'SHARC' AND A.AQ_CD IS NULL AND A.RGN_OFC_CD IS NULL) " ).append("\n"); 
		query.append("             OR EXISTS ( SELECT O.OFC_CD" ).append("\n"); 
		query.append("                           FROM SPC_OFC_LVL O" ).append("\n"); 
		query.append("                          WHERE O.OFC_TP_CD IN ('BB', 'BA', 'BS')" ).append("\n"); 
		query.append("                            AND SPC_SCR_OFC_CONV_FNC(B.BKG_OFC_CD) = O.OFC_CD" ).append("\n"); 
		query.append("						    AND A.RHQ_CD = O.N2ND_PRNT_OFC_CD" ).append("\n"); 
		query.append("                            AND A.COST_YR || A.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK" ).append("\n"); 
		query.append("                     CONNECT BY NOCYCLE O.PRNT_OFC_CD = PRIOR O.OFC_CD" ).append("\n"); 
		query.append("                             START WITH (A.RGN_OFC_CD IS NULL AND O.PRNT_OFC_CD = NVL(A.AQ_CD, A.RHQ_CD)) OR (O.OFC_CD = A.RGN_OFC_CD)))" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("#if (${pol_cd} != '')" ).append("\n"); 
		query.append("       AND A.POL_CD = NVL(B.PRE_RLY_PORT_CD, B.POL_CD)" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("                 AND DRL.TRD_CD          = A.TRD_CD" ).append("\n"); 
		query.append("                 AND DRL.RLANE_CD        = A.RLANE_CD" ).append("\n"); 
		query.append("                 AND DRL.VSL_SLAN_DIR_CD = A.DIR_CD" ).append("\n"); 
		query.append("                 AND DRL.IOC_CD          = A.IOC_CD" ).append("\n"); 
		query.append("                 AND DRL.SUB_TRD_CD      = A.SUB_TRD_CD" ).append("\n"); 
		query.append("                 AND DRL.DELT_FLG        = 'N'" ).append("\n"); 
		query.append("                 AND DRL.RLANE_CD        = RL.RLANE_CD" ).append("\n"); 
		query.append("                 AND DRL.FM_CONTI_CD     =( SELECT SPC_CONTI_CONV_FNC(L.CONTI_CD, A.RLANE_CD, A.DIR_CD)" ).append("\n"); 
		query.append("                                              FROM MDM_LOCATION L" ).append("\n"); 
		query.append("                                             WHERE L.LOC_CD = NVL(B.PRE_RLY_PORT_CD, B.POL_CD) )" ).append("\n"); 
		query.append("                 AND DRL.TO_CONTI_CD     =( SELECT SPC_CONTI_CONV_FNC(L.CONTI_CD, A.RLANE_CD, A.DIR_CD)" ).append("\n"); 
		query.append("                                              FROM MDM_LOCATION L" ).append("\n"); 
		query.append("                                             WHERE L.LOC_CD = NVL(B.PST_RLY_PORT_CD, B.POD_CD) )" ).append("\n"); 
		query.append("                 AND (    ((A.RHQ_CD = 'SHARC' AND A.AQ_CD IS NULL AND A.RGN_OFC_CD IS NULL AND  A.RHQ_CD = O.N2ND_PRNT_OFC_CD) AND DRL.FM_CONTI_CD = 'A')" ).append("\n"); 
		query.append("                       OR A.RHQ_CD <> 'SHARC'" ).append("\n"); 
		query.append("                       OR A.AQ_CD      IS NOT NULL" ).append("\n"); 
		query.append("                       OR A.RGN_OFC_CD IS NOT NULL )" ).append("\n"); 
		query.append("                 AND RL.RLANE_CD    = A.RLANE_CD" ).append("\n"); 
		query.append("                 AND RL.VSL_SLAN_CD = B.SLAN_CD" ).append("\n"); 
		query.append("                 AND RL.VSL_TP_CD   = 'C'" ).append("\n"); 
		query.append("                 AND RL.DELT_FLG    = 'N'" ).append("\n"); 
		query.append("                 AND A.COST_YR || A.COST_WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK" ).append("\n"); 
		query.append("                 " ).append("\n"); 
		query.append("                 AND B.BKG_NO            = BV.BKG_NO" ).append("\n"); 
		query.append("                 AND A.VSL_CD            = BV.VSL_CD" ).append("\n"); 
		query.append("                 AND A.SKD_VOY_NO        = BV.SKD_VOY_NO" ).append("\n"); 
		query.append("                 AND A.DIR_CD            = BV.SKD_DIR_CD" ).append("\n"); 
		query.append("                 AND B.BKG_NO            = BC.BKG_NO  --20140304 추가" ).append("\n"); 
		query.append("                 AND BC.BKG_CUST_TP_CD   = 'S'        --20140304 추가" ).append("\n"); 
		query.append("             ) B, RFA_BKG_DATA RD" ).append("\n"); 
		query.append("       WHERE B.SHP_CUST_CD = RD.SHP_CUST_CD(+) " ).append("\n"); 
		query.append("         AND B.BKG_POL_CD  = RD.POL_CD(+)" ).append("\n"); 
		query.append("         AND B.BKG_POD_CD  = RD.POD_CD(+)" ).append("\n"); 
		query.append("             " ).append("\n"); 
		query.append("      ) B" ).append("\n"); 
		query.append("GROUP BY B.TRD_CD         ," ).append("\n"); 
		query.append("         B.DIR_CD         ," ).append("\n"); 
		query.append("         B.SUB_TRD_CD     ," ).append("\n"); 
		query.append("         B.RLANE_CD       ," ).append("\n"); 
		query.append("         B.OFC_CD         ," ).append("\n"); 
		query.append("         B.WK             ," ).append("\n"); 
		query.append("         B.NUM            ," ).append("\n"); 
		query.append("         B.VVD            ," ).append("\n"); 
		query.append("         B.BSA            ," ).append("\n"); 
		query.append("         B.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("         B.ACCT_FLG       ," ).append("\n"); 
		query.append("         B.CUST_CTRL_CD" ).append("\n"); 
		query.append("  HAVING B.OFC_CD IS NOT NULL" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", MDL_DATA AS (" ).append("\n"); 
		query.append("    SELECT A.TRD_CD    ," ).append("\n"); 
		query.append("           A.DIR_CD    ," ).append("\n"); 
		query.append("           A.SUB_TRD_CD," ).append("\n"); 
		query.append("           A.RLANE_CD  ," ).append("\n"); 
		query.append("           M.SLS_RGN_OFC_CD AS OFC_CD," ).append("\n"); 
		query.append("           M.CUST_CTRL_CD," ).append("\n"); 
		query.append("           A.COST_YR||A.COST_WK AS WK," ).append("\n"); 
		query.append("           A.NUM," ).append("\n"); 
		query.append("           A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD AS VVD," ).append("\n"); 
		query.append("           A.BSA," ).append("\n"); 
		query.append("           A.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           A.ACCT_FLG       ," ).append("\n"); 
		query.append("           SUM(RLANE_ADJ_QTY) AS MDL_QTY" ).append("\n"); 
		query.append("      FROM MAS_MON_VVD_LV        A," ).append("\n"); 
		query.append("           SPC_MDL_CUST_REV_LANE M" ).append("\n"); 
		query.append("     WHERE M.COST_YRWK      = SUBSTR(A.SEASON, 1, 6)" ).append("\n"); 
		query.append("       AND M.VER_SEQ        = SUBSTR(A.SEASON, 8)" ).append("\n"); 
		query.append("       AND M.TRD_CD         = A.TRD_CD" ).append("\n"); 
		query.append("       AND M.SUB_TRD_CD     = A.SUB_TRD_CD" ).append("\n"); 
		query.append("       AND M.RLANE_CD       = A.RLANE_CD" ).append("\n"); 
		query.append("       AND M.SLS_RHQ_CD     = A.RHQ_CD" ).append("\n"); 
		query.append("#if (${sales_office} != '')" ).append("\n"); 
		query.append("       AND M.SLS_RGN_OFC_CD = A.RGN_OFC_CD" ).append("\n"); 
		query.append("#end" ).append("\n"); 
		query.append("       AND A.ACCT_FLG       = 'Y'" ).append("\n"); 
		query.append("  GROUP BY A.TRD_CD        ," ).append("\n"); 
		query.append("           A.DIR_CD        ," ).append("\n"); 
		query.append("           A.SUB_TRD_CD    ," ).append("\n"); 
		query.append("           A.RLANE_CD      ," ).append("\n"); 
		query.append("           M.SLS_RGN_OFC_CD," ).append("\n"); 
		query.append("           M.CUST_CTRL_CD  ," ).append("\n"); 
		query.append("           A.COST_YR||A.COST_WK," ).append("\n"); 
		query.append("           A.NUM," ).append("\n"); 
		query.append("           A.VSL_CD||A.SKD_VOY_NO||A.SKD_DIR_CD," ).append("\n"); 
		query.append("           A.BSA," ).append("\n"); 
		query.append("           A.LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           A.ACCT_FLG" ).append("\n"); 
		query.append("    HAVING SUM(M.RLANE_ADJ_QTY)>0" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append(", BASE_DATA AS(" ).append("\n"); 
		query.append("    SELECT TRD_CD         ," ).append("\n"); 
		query.append("           DIR_CD         ," ).append("\n"); 
		query.append("           SUB_TRD_CD     ," ).append("\n"); 
		query.append("           RLANE_CD       ," ).append("\n"); 
		query.append("           OFC_CD         ," ).append("\n"); 
		query.append("           CUST_CTRL_CD   ," ).append("\n"); 
		query.append("           WK             ," ).append("\n"); 
		query.append("           NUM            ," ).append("\n"); 
		query.append("           VVD            ," ).append("\n"); 
		query.append("           DECODE(TRD_CD||LOD_SPL_CNG_FLG,'IASY',SUM(BKG_QTY),BSA) AS BSA,  -- 2013.03.28 수송량으로 BSA 대체" ).append("\n"); 
		query.append("           LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           ACCT_FLG       ," ).append("\n"); 
		query.append("           SUM(QTA_QTY)  AS QTA_QTY ," ).append("\n"); 
		query.append("           SUM(QTA_GREV) AS QTA_GREV," ).append("\n"); 
		query.append("           SUM(QTA_CM)   AS QTA_CM  ," ).append("\n"); 
		query.append("           SUM(FCT_QTY)  AS FCT_QTY ," ).append("\n"); 
		query.append("           SUM(FCT_GREV) AS FCT_GREV," ).append("\n"); 
		query.append("           SUM(FCT_CM)   AS FCT_CM  ," ).append("\n"); 
		query.append("           SUM(ALC_QTY)  AS ALC_QTY ," ).append("\n"); 
		query.append("           SUM(ALC_GREV) AS ALC_GREV," ).append("\n"); 
		query.append("           SUM(ALC_CM)   AS ALC_CM  ," ).append("\n"); 
		query.append("           SUM(BKG_QTY)  AS BKG_QTY ," ).append("\n"); 
		query.append("           SUM(BKG_GREV) AS BKG_GREV," ).append("\n"); 
		query.append("           SUM(BKG_CM)   AS BKG_CM  ," ).append("\n"); 
		query.append("           SUM(MDL_QTY)  AS MDL_QTY" ).append("\n"); 
		query.append("      FROM (" ).append("\n"); 
		query.append("              SELECT TRD_CD         ," ).append("\n"); 
		query.append("                     DIR_CD         ," ).append("\n"); 
		query.append("                     SUB_TRD_CD     ," ).append("\n"); 
		query.append("                     RLANE_CD       ," ).append("\n"); 
		query.append("                     OFC_CD         ," ).append("\n"); 
		query.append("                     CUST_CTRL_CD   ," ).append("\n"); 
		query.append("                     WK             ," ).append("\n"); 
		query.append("                     NUM            ," ).append("\n"); 
		query.append("                     VVD            ," ).append("\n"); 
		query.append("                     BSA            ," ).append("\n"); 
		query.append("                     LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                     ACCT_FLG       ," ).append("\n"); 
		query.append("                     QTA_QTY        ," ).append("\n"); 
		query.append("                     QTA_GREV       ," ).append("\n"); 
		query.append("                     QTA_CM         ," ).append("\n"); 
		query.append("                     FCT_QTY        ," ).append("\n"); 
		query.append("                     FCT_GREV       ," ).append("\n"); 
		query.append("                     FCT_CM         ," ).append("\n"); 
		query.append("                     ALC_QTY        ," ).append("\n"); 
		query.append("                     ALC_GREV       ," ).append("\n"); 
		query.append("                     ALC_CM         ," ).append("\n"); 
		query.append("                     BKG_QTY        ," ).append("\n"); 
		query.append("                     BKG_GREV       ," ).append("\n"); 
		query.append("                     BKG_CM         ," ).append("\n"); 
		query.append("                     0 AS MDL_QTY" ).append("\n"); 
		query.append("                FROM QTA_DATA" ).append("\n"); 
		query.append("              UNION ALL" ).append("\n"); 
		query.append("              SELECT TRD_CD         ," ).append("\n"); 
		query.append("                     DIR_CD         ," ).append("\n"); 
		query.append("                     SUB_TRD_CD     ," ).append("\n"); 
		query.append("                     RLANE_CD       ," ).append("\n"); 
		query.append("                     OFC_CD         ," ).append("\n"); 
		query.append("                     CUST_CTRL_CD   ," ).append("\n"); 
		query.append("                     WK             ," ).append("\n"); 
		query.append("                     NUM            ," ).append("\n"); 
		query.append("                     VVD            ," ).append("\n"); 
		query.append("                     BSA            ," ).append("\n"); 
		query.append("                     LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                     ACCT_FLG       ," ).append("\n"); 
		query.append("                     QTA_QTY        ," ).append("\n"); 
		query.append("                     QTA_GREV       ," ).append("\n"); 
		query.append("                     QTA_CM         ," ).append("\n"); 
		query.append("                     DECODE(PAST, 'N', FCT_QTY , 0) AS FCT_QTY ," ).append("\n"); 
		query.append("                     DECODE(PAST, 'N', FCT_GREV, 0) AS FCT_GREV," ).append("\n"); 
		query.append("                     DECODE(PAST, 'N', FCT_CM  , 0) AS FCT_CM  ," ).append("\n"); 
		query.append("                     ALC_QTY ," ).append("\n"); 
		query.append("                     ALC_GREV," ).append("\n"); 
		query.append("                     ALC_CM  ," ).append("\n"); 
		query.append("                     BKG_QTY ," ).append("\n"); 
		query.append("                     BKG_GREV," ).append("\n"); 
		query.append("                     BKG_CM  ," ).append("\n"); 
		query.append("                     0 AS MDL_QTY" ).append("\n"); 
		query.append("                FROM FCT_DATA" ).append("\n"); 
		query.append("              UNION ALL" ).append("\n"); 
		query.append("              SELECT TRD_CD         ," ).append("\n"); 
		query.append("                     DIR_CD         ," ).append("\n"); 
		query.append("                     SUB_TRD_CD     ," ).append("\n"); 
		query.append("                     RLANE_CD       ," ).append("\n"); 
		query.append("                     OFC_CD         ," ).append("\n"); 
		query.append("                     CUST_CTRL_CD   ," ).append("\n"); 
		query.append("                     WK             ," ).append("\n"); 
		query.append("                     NUM            ," ).append("\n"); 
		query.append("                     VVD            ," ).append("\n"); 
		query.append("                     BSA            ," ).append("\n"); 
		query.append("                     LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                     ACCT_FLG       ," ).append("\n"); 
		query.append("                     QTA_QTY        ," ).append("\n"); 
		query.append("                     QTA_GREV       ," ).append("\n"); 
		query.append("                     QTA_CM         ," ).append("\n"); 
		query.append("                     FCT_QTY        ," ).append("\n"); 
		query.append("                     FCT_GREV       ," ).append("\n"); 
		query.append("                     FCT_CM         ," ).append("\n"); 
		query.append("                     ALC_QTY        ," ).append("\n"); 
		query.append("                     ALC_GREV       ," ).append("\n"); 
		query.append("                     ALC_CM         ," ).append("\n"); 
		query.append("                     BKG_QTY        ," ).append("\n"); 
		query.append("                     BKG_GREV       ," ).append("\n"); 
		query.append("                     BKG_CM         ," ).append("\n"); 
		query.append("                     0 AS MDL_QTY" ).append("\n"); 
		query.append("                FROM ALC_DATA" ).append("\n"); 
		query.append("              UNION ALL" ).append("\n"); 
		query.append("              SELECT TRD_CD         ," ).append("\n"); 
		query.append("                     DIR_CD         ," ).append("\n"); 
		query.append("                     SUB_TRD_CD     ," ).append("\n"); 
		query.append("                     RLANE_CD       ," ).append("\n"); 
		query.append("                     OFC_CD         ," ).append("\n"); 
		query.append("                     CUST_CTRL_CD   ," ).append("\n"); 
		query.append("                     WK             ," ).append("\n"); 
		query.append("                     NUM            ," ).append("\n"); 
		query.append("                     VVD            ," ).append("\n"); 
		query.append("                     BSA            ," ).append("\n"); 
		query.append("                     LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                     ACCT_FLG       ," ).append("\n"); 
		query.append("                     QTA_QTY        ," ).append("\n"); 
		query.append("                     QTA_GREV       ," ).append("\n"); 
		query.append("                     QTA_CM         ," ).append("\n"); 
		query.append("                     FCT_QTY        ," ).append("\n"); 
		query.append("                     FCT_GREV       ," ).append("\n"); 
		query.append("                     FCT_CM         ," ).append("\n"); 
		query.append("                     ALC_QTY        ," ).append("\n"); 
		query.append("                     ALC_GREV       ," ).append("\n"); 
		query.append("                     ALC_CM         ," ).append("\n"); 
		query.append("                     BKG_QTY        ," ).append("\n"); 
		query.append("                     BKG_GREV       ," ).append("\n"); 
		query.append("                     BKG_CM         ," ).append("\n"); 
		query.append("                     0 AS MDL_QTY" ).append("\n"); 
		query.append("                FROM ALOC_CUST_DATA" ).append("\n"); 
		query.append("              UNION ALL" ).append("\n"); 
		query.append("              SELECT TRD_CD         ," ).append("\n"); 
		query.append("                     DIR_CD         ," ).append("\n"); 
		query.append("                     SUB_TRD_CD     ," ).append("\n"); 
		query.append("                     RLANE_CD       ," ).append("\n"); 
		query.append("                     OFC_CD         ," ).append("\n"); 
		query.append("                     CUST_CTRL_CD   ," ).append("\n"); 
		query.append("                     WK             ," ).append("\n"); 
		query.append("                     NUM            ," ).append("\n"); 
		query.append("                     VVD            ," ).append("\n"); 
		query.append("                     BSA            ," ).append("\n"); 
		query.append("                     LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                     ACCT_FLG       ," ).append("\n"); 
		query.append("                     QTA_QTY        ," ).append("\n"); 
		query.append("                     QTA_GREV       ," ).append("\n"); 
		query.append("                     QTA_CM         ," ).append("\n"); 
		query.append("                     DECODE(PAST, 'Y', BKG_QTY , 0) AS FCT_QTY ," ).append("\n"); 
		query.append("                     DECODE(PAST, 'Y', BKG_GREV, 0) AS FCT_GREV," ).append("\n"); 
		query.append("                     DECODE(PAST, 'Y', BKG_CM  , 0) AS FCT_CM  ," ).append("\n"); 
		query.append("                     ALC_QTY ," ).append("\n"); 
		query.append("                     ALC_GREV," ).append("\n"); 
		query.append("                     ALC_CM  ," ).append("\n"); 
		query.append("                     BKG_QTY ," ).append("\n"); 
		query.append("                     BKG_GREV," ).append("\n"); 
		query.append("                     BKG_CM    ," ).append("\n"); 
		query.append("                     0 AS MDL_QTY" ).append("\n"); 
		query.append("                FROM BKG_DATA" ).append("\n"); 
		query.append("              UNION ALL" ).append("\n"); 
		query.append("              SELECT TRD_CD         ," ).append("\n"); 
		query.append("                     DIR_CD         ," ).append("\n"); 
		query.append("                     SUB_TRD_CD     ," ).append("\n"); 
		query.append("                     RLANE_CD       ," ).append("\n"); 
		query.append("                     OFC_CD         ," ).append("\n"); 
		query.append("                     CUST_CTRL_CD   ," ).append("\n"); 
		query.append("                     WK             ," ).append("\n"); 
		query.append("                     NUM            ," ).append("\n"); 
		query.append("                     VVD            ," ).append("\n"); 
		query.append("                     BSA            ," ).append("\n"); 
		query.append("                     LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                     ACCT_FLG       ," ).append("\n"); 
		query.append("                     0 AS QTA_QTY   ," ).append("\n"); 
		query.append("                     0 AS QTA_GREV  ," ).append("\n"); 
		query.append("                     0 AS QTA_CM    ," ).append("\n"); 
		query.append("                     0 AS FCT_QTY ," ).append("\n"); 
		query.append("                     0 AS FCT_GREV," ).append("\n"); 
		query.append("                     0 AS FCT_CM  ," ).append("\n"); 
		query.append("                     0 AS ALC_QTY ," ).append("\n"); 
		query.append("                     0 AS ALC_GREV," ).append("\n"); 
		query.append("                     0 AS ALC_CM  ," ).append("\n"); 
		query.append("                     0 AS BKG_QTY ," ).append("\n"); 
		query.append("                     0 AS BKG_GREV," ).append("\n"); 
		query.append("                     0 AS BKG_CM    ," ).append("\n"); 
		query.append("                     MDL_QTY" ).append("\n"); 
		query.append("                FROM MDL_DATA" ).append("\n"); 
		query.append("" ).append("\n"); 
		query.append("                -- BSA TO LOAD가 아닌 경우, BSA 정보 무조건 가져오도록 추가" ).append("\n"); 
		query.append("              UNION ALL" ).append("\n"); 
		query.append("              SELECT DISTINCT " ).append("\n"); 
		query.append("                     TRD_CD    ," ).append("\n"); 
		query.append("                     DIR_CD    ," ).append("\n"); 
		query.append("                     SUB_TRD_CD," ).append("\n"); 
		query.append("                     RLANE_CD  ," ).append("\n"); 
		query.append("                     'BSA' AS OFC_CD      ," ).append("\n"); 
		query.append("                     'C'   AS CUST_CTRL_CD," ).append("\n"); 
		query.append("                     COST_YR||COST_WK AS WK," ).append("\n"); 
		query.append("                     NUM       ," ).append("\n"); 
		query.append("                     VSL_CD||SKD_VOY_NO||SKD_DIR_CD AS VVD," ).append("\n"); 
		query.append("                     BSA            ," ).append("\n"); 
		query.append("                     LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                     ACCT_FLG       ," ).append("\n"); 
		query.append("                     0 AS QTA_QTY   ," ).append("\n"); 
		query.append("                     0 AS QTA_GREV  ," ).append("\n"); 
		query.append("                     0 AS QTA_CM    ," ).append("\n"); 
		query.append("                     0 AS FCT_QTY   ," ).append("\n"); 
		query.append("                     0 AS FCT_GREV  ," ).append("\n"); 
		query.append("                     0 AS FCT_CM    ," ).append("\n"); 
		query.append("                     0 AS ALC_QTY   ," ).append("\n"); 
		query.append("                     0 AS ALC_GREV  ," ).append("\n"); 
		query.append("                     0 AS ALC_CM    ," ).append("\n"); 
		query.append("                     0 AS BKG_QTY   ," ).append("\n"); 
		query.append("                     0 AS BKG_GREV  ," ).append("\n"); 
		query.append("                     0 AS BKG_CM    ," ).append("\n"); 
		query.append("                     0 AS MDL_QTY" ).append("\n"); 
		query.append("                FROM MAS_MON_VVD_LV" ).append("\n"); 
		query.append("               WHERE LOD_SPL_CNG_FLG = 'N'" ).append("\n"); 
		query.append("                 AND BSA > 0" ).append("\n"); 
		query.append("           )" ).append("\n"); 
		query.append("  GROUP BY TRD_CD         ," ).append("\n"); 
		query.append("           DIR_CD         ," ).append("\n"); 
		query.append("           SUB_TRD_CD     ," ).append("\n"); 
		query.append("           RLANE_CD       ," ).append("\n"); 
		query.append("           OFC_CD         ," ).append("\n"); 
		query.append("           CUST_CTRL_CD   ," ).append("\n"); 
		query.append("           WK             ," ).append("\n"); 
		query.append("           NUM            ," ).append("\n"); 
		query.append("           VVD            ," ).append("\n"); 
		query.append("           BSA            ," ).append("\n"); 
		query.append("           LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("           ACCT_FLG" ).append("\n"); 
		query.append(")" ).append("\n"); 
		query.append("--- sycha 20140610 summary 가 아닌 상세 조회용으로 변환" ).append("\n"); 
		query.append("SELECT" ).append("\n"); 
		query.append("    GRP_ID, -- 0:원데이터, 3:OFC_CD 합계,7:AQ_CD 합계, 15:DEST 합계,31:전체 합계 " ).append("\n"); 
		query.append("    TRD_CD," ).append("\n"); 
		query.append("    DIR_CD," ).append("\n"); 
		query.append("    SUB_TRD_CD," ).append("\n"); 
		query.append("    OFC_CD," ).append("\n"); 
		query.append("    CUST_CTRL_CD,    " ).append("\n"); 
		query.append("    VVD," ).append("\n"); 
		query.append("    RLANE_CD  ," ).append("\n"); 
		query.append("    DEST," ).append("\n"); 
		query.append("    AQ_CD," ).append("\n"); 
		query.append("    DECODE(CUST_CTRL_CD, NULL, QTA_QTY, 'C', (QTA_QTY-MDL_TTL_QTY), MDL_QTY) AS QTA_QTY," ).append("\n"); 
		query.append("    QTA_GREV," ).append("\n"); 
		query.append("    QTA_CM  ,        " ).append("\n"); 
		query.append("    FCT_QTY," ).append("\n"); 
		query.append("    FCT_GREV," ).append("\n"); 
		query.append("    FCT_CM ," ).append("\n"); 
		query.append("    ALC_QTY ," ).append("\n"); 
		query.append("    ALC_GREV," ).append("\n"); 
		query.append("    ALC_CM  ," ).append("\n"); 
		query.append("    BKG_QTY ," ).append("\n"); 
		query.append("    BKG_GREV," ).append("\n"); 
		query.append("    BKG_CM ," ).append("\n"); 
		query.append("    MDL_QTY,   " ).append("\n"); 
		query.append("    MDL_TTL_QTY," ).append("\n"); 
		query.append("    DECODE(CUST_CTRL_CD, NULL, PREF_QTY, 'C', ROUND(DECODE(QTA_QTY-MDL_TTL_QTY, 0, 0, FCT_QTY * 100 / (QTA_QTY-MDL_TTL_QTY)), 1), GPREF_QTY ) AS PREF_QTY," ).append("\n"); 
		query.append("    GPREF_QTY " ).append("\n"); 
		query.append("FROM (" ).append("\n"); 
		query.append("    SELECT" ).append("\n"); 
		query.append("        GRP_ID," ).append("\n"); 
		query.append("        TRD_CD," ).append("\n"); 
		query.append("        DIR_CD," ).append("\n"); 
		query.append("        SUB_TRD_CD," ).append("\n"); 
		query.append("        OFC_CD," ).append("\n"); 
		query.append("        CUST_CTRL_CD,    " ).append("\n"); 
		query.append("        VVD," ).append("\n"); 
		query.append("        RLANE_CD  ," ).append("\n"); 
		query.append("        DEST," ).append("\n"); 
		query.append("        AQ_CD," ).append("\n"); 
		query.append("        QTA_QTY," ).append("\n"); 
		query.append("        QTA_GREV," ).append("\n"); 
		query.append("        QTA_CM  ,        " ).append("\n"); 
		query.append("        FCT_QTY," ).append("\n"); 
		query.append("        FCT_GREV," ).append("\n"); 
		query.append("        FCT_CM ," ).append("\n"); 
		query.append("        ALC_QTY ," ).append("\n"); 
		query.append("        ALC_GREV," ).append("\n"); 
		query.append("        ALC_CM  ," ).append("\n"); 
		query.append("        BKG_QTY ," ).append("\n"); 
		query.append("        BKG_GREV," ).append("\n"); 
		query.append("        BKG_CM ," ).append("\n"); 
		query.append("        MDL_QTY,         " ).append("\n"); 
		query.append("        MAX(MDL_QTY) OVER (PARTITION BY DEST, TRD_CD, SUB_TRD_CD, RLANE_CD, DIR_CD, AQ_CD, OFC_CD) AS MDL_TTL_QTY," ).append("\n"); 
		query.append("        ROUND(DECODE(QTA_QTY, 0, 0, FCT_QTY * 100 / QTA_QTY), 1) AS PREF_QTY," ).append("\n"); 
		query.append("        DECODE(CUST_CTRL_CD, NULL, 0, ROUND(DECODE(MDL_QTY, 0, 0, FCT_QTY * 100 / MDL_QTY), 1)) AS GPREF_QTY      " ).append("\n"); 
		query.append("    FROM (" ).append("\n"); 
		query.append("        SELECT" ).append("\n"); 
		query.append("            GROUPING_ID(DEST, AQ_CD, OFC_CD, VVD, CUST_CTRL_CD) AS GRP_ID," ).append("\n"); 
		query.append("            TRD_CD," ).append("\n"); 
		query.append("            DIR_CD," ).append("\n"); 
		query.append("            SUB_TRD_CD," ).append("\n"); 
		query.append("            OFC_CD," ).append("\n"); 
		query.append("            CUST_CTRL_CD," ).append("\n"); 
		query.append("            VVD," ).append("\n"); 
		query.append("            RLANE_CD  ," ).append("\n"); 
		query.append("            DEST," ).append("\n"); 
		query.append("            AQ_CD," ).append("\n"); 
		query.append("            SUM(QTA_QTY) AS QTA_QTY," ).append("\n"); 
		query.append("            SUM(QTA_GREV) AS QTA_GREV," ).append("\n"); 
		query.append("            SUM(QTA_CM) AS QTA_CM  ," ).append("\n"); 
		query.append("            SUM(FCT_QTY) AS FCT_QTY," ).append("\n"); 
		query.append("            SUM(FCT_GREV) AS FCT_GREV," ).append("\n"); 
		query.append("            SUM(FCT_CM) AS FCT_CM ," ).append("\n"); 
		query.append("            SUM(ALC_QTY) AS ALC_QTY ," ).append("\n"); 
		query.append("            SUM(ALC_GREV) AS ALC_GREV," ).append("\n"); 
		query.append("            SUM(ALC_CM) AS ALC_CM  ," ).append("\n"); 
		query.append("            SUM(BKG_QTY) AS BKG_QTY ," ).append("\n"); 
		query.append("            SUM(BKG_GREV) AS BKG_GREV," ).append("\n"); 
		query.append("            SUM(BKG_CM) AS BKG_CM ," ).append("\n"); 
		query.append("            SUM(MDL_QTY) AS MDL_QTY           " ).append("\n"); 
		query.append("        FROM (" ).append("\n"); 
		query.append("            SELECT" ).append("\n"); 
		query.append("                TRD_CD," ).append("\n"); 
		query.append("                DIR_CD," ).append("\n"); 
		query.append("                SUB_TRD_CD," ).append("\n"); 
		query.append("                OFC_CD," ).append("\n"); 
		query.append("                CUST_CTRL_CD," ).append("\n"); 
		query.append("                WK," ).append("\n"); 
		query.append("                VVD," ).append("\n"); 
		query.append("                RLANE_CD  ," ).append("\n"); 
		query.append("                LOD_SPL_CNG_FLG," ).append("\n"); 
		query.append("                ACCT_FLG," ).append("\n"); 
		query.append("		        NVL(SPC_GET_DEST_FNC(Z1.TRD_CD, Z1.SUB_TRD_CD, Z1.RLANE_CD), '-') AS DEST," ).append("\n"); 
		query.append("		                   DECODE(Z1.OFC_CD, 'BSA', 'BSA', ( " ).append("\n"); 
		query.append("		            #if(${check_area2} =='Y')" ).append("\n"); 
		query.append("		                         SELECT SPC_RGN_OFC_CONV_FNC(NVL(O.N3RD_PRNT_OFC_CD, O.N2ND_PRNT_OFC_CD),Z1.OFC_CD)" ).append("\n"); 
		query.append("		            #else" ).append("\n"); 
		query.append("		                         SELECT NVL(O.N3RD_PRNT_OFC_CD, O.N2ND_PRNT_OFC_CD)             " ).append("\n"); 
		query.append("		            #end" ).append("\n"); 
		query.append("		                         FROM SPC_OFC_LVL O" ).append("\n"); 
		query.append("		                         WHERE O.OFC_CD = Z1.OFC_CD" ).append("\n"); 
		query.append("		                         AND Z1.WK BETWEEN O.OFC_APLY_FM_YRWK AND O.OFC_APLY_TO_YRWK )" ).append("\n"); 
		query.append("		            ) AS AQ_CD,                " ).append("\n"); 
		query.append("                QTA_QTY ," ).append("\n"); 
		query.append("                QTA_GREV," ).append("\n"); 
		query.append("                QTA_CM  ," ).append("\n"); 
		query.append("                FCT_QTY ," ).append("\n"); 
		query.append("                FCT_GREV," ).append("\n"); 
		query.append("                FCT_CM  ," ).append("\n"); 
		query.append("                ALC_QTY ," ).append("\n"); 
		query.append("                ALC_GREV," ).append("\n"); 
		query.append("                ALC_CM  ," ).append("\n"); 
		query.append("                BKG_QTY ," ).append("\n"); 
		query.append("                BKG_GREV," ).append("\n"); 
		query.append("                BKG_CM  ," ).append("\n"); 
		query.append("                MDL_QTY       " ).append("\n"); 
		query.append("            FROM BASE_DATA Z1" ).append("\n"); 
		query.append("            WHERE VVD IN (@[vvd1], @[vvd2])  -- sycha 20140610 항차 파라미터 추가" ).append("\n"); 
		query.append("        ) Z2" ).append("\n"); 
		query.append("        GROUP BY TRD_CD, DIR_CD, SUB_TRD_CD, RLANE_CD, ROLLUP(DEST, AQ_CD, OFC_CD, VVD, CUST_CTRL_CD )" ).append("\n"); 
		query.append("    ) Z3" ).append("\n"); 
		query.append("    WHERE GRP_ID != 1 AND GRP_ID != 31 -- VVD, CUST_CTRL_CD 그룹 합계 및 총계는 조회 불필요" ).append("\n"); 
		query.append(") Z4" ).append("\n"); 

	}
}