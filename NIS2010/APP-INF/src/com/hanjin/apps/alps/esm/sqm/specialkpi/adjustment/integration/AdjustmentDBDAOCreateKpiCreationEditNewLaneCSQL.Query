<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AdjustmentDBDAOCreateKpiCreationEditNewLaneCSQL">
			<desc><![CDATA[CreateKpiCreationEditNewLane

* 2014.09.17 이혜민 [CHM-201431755-01] New Lane Add시 Bound 삽입]]></desc>
			<sql><![CDATA[
INSERT INTO SQM_SPCL_CFM_QTA(
         BSE_TP_CD
        ,BSE_YR
        ,BSE_QTR_CD
        ,SPCL_TGT_CD
        ,TRD_CD
        ,RLANE_CD
        ,DIR_CD
        ,VSL_CD
        ,SKD_VOY_NO
        ,SKD_DIR_CD
        ,RGN_OFC_CD
        ,RHQ_CD
        ,AQ_CD
        ,CONV_DIR_CD
        ,LOD_QTY
        ,GRS_RPB_REV
        ,PA_CM_UC_AMT
        ,RA_CM_UC_AMT
        ,SQM_CNG_TP_CD
        ,CRE_USR_ID
        ,CRE_DT
        ,UPD_USR_ID
        ,UPD_DT
         )
SELECT A1.BSE_TP_CD
      ,A1.BSE_YR
      ,A1.BSE_QTR_CD
      ,A2.SPCL_TGT_CD
      ,A1.TRD_CD
      ,A1.RLANE_CD
      ,A1.DIR_CD
      ,A1.VSL_CD
      ,A1.SKD_VOY_NO
      ,A1.SKD_DIR_CD
      ,A2.RGN_OFC_CD
--MDM에서 RHQ를 찾아온 후 없으면 SQM_QTA_OFC에서 찾음
      ,NVL((SELECT N2ND_PRNT_OFC_CD
             FROM SQM_ORGANIZATION_V V
            WHERE V.OFC_CD = A2.RGN_OFC_CD
         ),(SELECT RHQ_CD
             FROM SQM_QTA_OFC 
            WHERE RGN_OFC_CD = A2.RGN_OFC_CD)) AS RHQ_CD
      ,NVL((SELECT N3RD_PRNT_OFC_CD
          FROM SQM_ORGANIZATION_V V
         WHERE 1=1
         AND V.OFC_CD = A2.RGN_OFC_CD),'') AS AQ_CD
      ,A2.CONV_DIR_CD
      ,NVL(A2.LOD_QTY, 0) AS LOD_QTY
      ,NVL(A2.GRS_RPB_REV, 0) AS GRS_RPB_REV
      ,A2.PA_CM_UC_AMT
      ,A2.RA_CM_UC_AMT
      ,'I' AS SQM_CNG_TP_CD
      ,@[usr_id] AS CRE_USR_ID
      ,SYSDATE AS CRE_DT
      ,@[usr_id] AS UPD_USR_ID
      ,SYSDATE AS UPD_DT
  FROM SQM_SPCL_TGT_VVD A1
      ,SQM_SPCL_NEW_LANE A2
 WHERE 1=1
   AND A1.BSE_YR          = @[f_bse_yr]
   AND A1.BSE_TP_CD       = @[f_bse_tp_cd]    -- Q, Y 필수
#if(${f_bse_tp_cd} == 'Q')
   AND A1.BSE_QTR_CD      = @[f_bse_qtr_cd]   -- Quartely일때 필수
#end
   AND A2.SPCL_TGT_CD     = @[f_spcl_tgt_cd]  -- S, R 필수
   AND A1.TRD_CD          = @[f_trd_cd]       -- TRADE
   AND A1.RLANE_CD        = @[f_rlane_cd]     -- NEW LANE
#if(${f_dir_cd} != '')
   AND A1.DIR_CD          = @[f_dir_cd]
#end
   AND A1.BSE_TP_CD       = A2.BSE_TP_CD
   AND A1.BSE_YR          = A2.BSE_YR
   AND A1.BSE_QTR_CD      = A2.BSE_QTR_CD
   AND A1.TRD_CD          = A2.TRD_CD
   AND A1.RLANE_CD        = A2.RLANE_CD
   AND A1.DIR_CD          = A2.DIR_CD			]]></sql>
			<params>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="f_bse_yr" type="12" value="" out="N"/>
				<param name="f_bse_tp_cd" type="12" value="" out="N"/>
				<param name="f_bse_qtr_cd" type="12" value="" out="N"/>
				<param name="f_spcl_tgt_cd" type="12" value="" out="N"/>
				<param name="f_trd_cd" type="12" value="" out="N"/>
				<param name="f_rlane_cd" type="12" value="" out="N"/>
				<param name="f_dir_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
