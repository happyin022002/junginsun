<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BlRatingDBDAOCreateRevenueAmountCSQL">
			<desc><![CDATA[Revenue와 BKG TEU Qty를 Insert한다]]></desc>
			<sql><![CDATA[
INSERT INTO BKG_REV_COST
(   BKG_NO,
    REV_COST_SEQ,
    REV_AMT,
    ESTM_COST_AMT,
    BKG_TEU_QTY,
    CMPB_AMT,
    EQ_MGMT_UC_AMT,
    OFT_AMT,
    DMDT_REV_AMT,
    SGL_REV_FLG,
    CRE_USR_ID,
    CRE_DT,
    UPD_USR_ID,
    UPD_DT
)
VALUES
(   @[bkg_no],
    (SELECT NVL(MAX(REV_COST_SEQ),0) + 1 REV_COST_SEQ
     FROM BKG_REV_COST
     WHERE BKG_NO = @[bkg_no]),
    @[rev_amt],
    (SELECT NVL(TTL_EXPN_AMT,0) ESTM_COST_AMT
       FROM PRD_PROD_CTL_MST P
          , BKG_BOOKING B
      WHERE B.BKG_NO = @[bkg_no]
        AND B.PCTL_NO = P.PCTL_NO),

    (SELECT SUM(DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),2,OP_CNTR_QTY,OP_CNTR_QTY*2)) BKG_TEU_QTY
     FROM BKG_QUANTITY
     WHERE BKG_NO = @[bkg_no]) ,
     
    ((TO_NUMBER(@[rev_amt]) 
      + (SELECT NVL(SUM(A2.ESTM_USD_TTL_AMT),0) DMDT_REV_AMT
           FROM MAS_COM_PARA A1
              , MAS_COM_COST_PARA A2
              , BKG_BOOKING B1
          WHERE 1=1
            AND B1.BKG_NO = @[bkg_no]
            AND B1.BKG_NO = A1.BKG_NO            
            AND A1.PCTL_NO = A2.PCTL_NO    
            AND A2.STND_COST_CD IN('43201011')
            AND ROWNUM = 1)
      - (SELECT NVL(TTL_EXPN_AMT,0) ESTM_COST_AMT
           FROM PRD_PROD_CTL_MST P
              , BKG_BOOKING B
          WHERE B.BKG_NO  = @[bkg_no]
            AND B.PCTL_NO = P.PCTL_NO)
    )
     /     
    (SELECT NVL(SUM(DECODE(SUBSTR(CNTR_TPSZ_CD,2,1),2,OP_CNTR_QTY,OP_CNTR_QTY*2)),0)
       FROM BKG_QUANTITY
      WHERE BKG_NO = @[bkg_no])), 

    (SELECT NVL(SUM(A2.RESPB_USD_TTL_AMT),0) EQ_MGMT_UC_AMT
                   FROM MAS_COM_PARA A1
                      , MAS_COM_COST_PARA A2
                      , BKG_BOOKING B1
                  WHERE 1=1
                    AND B1.BKG_NO = @[bkg_no]
                    AND B1.BKG_NO = A1.BKG_NO            
                    AND A1.PCTL_NO = A2.PCTL_NO    
                    AND A2.STND_COST_CD IN ('92202012','92202011')
     ),
    @[oft_amt],
    (SELECT NVL(SUM(A2.ESTM_USD_TTL_AMT),0) DMDT_REV_AMT
                   FROM MAS_COM_PARA A1
                      , MAS_COM_COST_PARA A2
                      , BKG_BOOKING B1
                  WHERE 1=1
                    AND B1.BKG_NO = @[bkg_no]
                    AND B1.BKG_NO = A1.BKG_NO            
                    AND A1.PCTL_NO = A2.PCTL_NO    
                    AND A2.STND_COST_CD IN('43201011')
                    AND ROWNUM = 1),
    @[sgl_rev_flg],
    @[cre_usr_id],
    SYSDATE,
    @[upd_usr_id],
    SYSDATE
)			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="rev_amt" type="12" value="" out="N"/>
				<param name="oft_amt" type="12" value="" out="N"/>
				<param name="sgl_rev_flg" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
