<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingUtilDBDAOSearchAmdtSeqRSQL">
			<desc><![CDATA[AmdtSeq를 조회한다.]]></desc>
			<sql><![CDATA[
--BookingUtilDBDAOSearchAmdtSeqRSQL.Query
SELECT  MAIN.AMDT_SEQ
  FROM  
#if( ${ctrt_type} == 'sc')
		PRI_SP_HDR HDR
       ,PRI_SP_MN MAIN
#elseif( ${ctrt_type} == 'rfa')
		PRI_RP_HDR HDR
       ,PRI_RP_MN MAIN
#elseif( ${ctrt_type} == 'taa')
		PRI_TAA_HDR HDR
	   ,PRI_TAA_MN MAIN
#end
       ,(SELECT APPL_DT
           FROM (
           #if (${bkg_no} != '') 
                SELECT 1 RANK, RT_APLY_DT APPL_DT 
                  FROM BKG_RT_HIS R
                 WHERE BKG_NO     = @[bkg_no]
                   AND CORR_NO    = 'TMP0000001'
                   AND RT_APLY_DT IS NOT NULL
                UNION ALL
                SELECT 2 RANK, RT_APLY_DT APPL_DT --RATE APPLICABLE
                  FROM BKG_RATE R
                 WHERE BKG_NO     = @[bkg_no]
                   AND RT_APLY_DT IS NOT NULL
                UNION ALL
                SELECT 3 RANK, SKD.VPS_ETD_DT APPL_DT --ONBOARD DATE
                  FROM BKG_VVD_HIS VVD, VSK_VSL_PORT_SKD SKD, BKG_BKG_HIS BK
                 WHERE BK.BKG_NO          = @[bkg_no]
                   AND BK.CORR_NO 		  = 'TMP0000001'
                   AND VVD.CORR_NO 		  = 'TMP0000001'
                   AND BK.BKG_NO          = VVD.BKG_NO
                   AND VVD.VSL_PRE_PST_CD IN ('S', 'T')
                   AND VVD.POL_CD         = BK.POL_CD
                   AND VVD.VSL_CD         = SKD.VSL_CD
                   AND VVD.SKD_VOY_NO     = SKD.SKD_VOY_NO
                   AND VVD.SKD_DIR_CD     = SKD.SKD_DIR_CD
                   AND VVD.POL_CD         = SKD.VPS_PORT_CD
                   AND VVD.POL_CLPT_IND_SEQ = SKD.CLPT_IND_SEQ
                UNION ALL
                SELECT 4 RANK, SKD.VPS_ETD_DT APPL_DT --ONBOARD DATE
                  FROM BKG_VVD VVD, VSK_VSL_PORT_SKD SKD, BKG_BOOKING BK
                 WHERE BK.BKG_NO          = @[bkg_no]
                   AND BK.BKG_NO          = VVD.BKG_NO
                   AND VVD.VSL_PRE_PST_CD IN ('S', 'T')
                   AND VVD.POL_CD         = BK.POL_CD
                   AND VVD.VSL_CD         = SKD.VSL_CD
                   AND VVD.SKD_VOY_NO     = SKD.SKD_VOY_NO
                   AND VVD.SKD_DIR_CD     = SKD.SKD_DIR_CD
                   AND VVD.POL_CD         = SKD.VPS_PORT_CD
                   AND VVD.POL_CLPT_IND_SEQ = SKD.CLPT_IND_SEQ
                UNION ALL 
        #end
                SELECT 5 RANK, SYSDATE APPL_DT
                  FROM DUAL)   
            WHERE ROWNUM = 1) APPL
 WHERE 1=1
#if( ${ctrt_type} == 'taa')
   AND HDR.TAA_PROP_NO = MAIN.TAA_PROP_NO
#else
   AND HDR.PROP_NO = MAIN.PROP_NO
#end
   AND MAIN.EFF_DT - 0.0001 < APPL.APPL_DT
   AND MAIN.EXP_DT + 0.9999 > APPL.APPL_DT
#if( ${ctrt_type} == 'sc')
   AND MAIN.PROP_STS_CD ='F'
   AND HDR.SC_NO = @[ctrt_no]
#elseif( ${ctrt_type} == 'rfa')
   AND MAIN.PROP_STS_CD ='A'
   AND HDR.RFA_NO = @[ctrt_no]
#elseif( ${ctrt_type} == 'taa')
   AND CFM_FLG = 'Y'
   AND HDR.TAA_NO = @[ctrt_no]
#end			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="ctrt_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
