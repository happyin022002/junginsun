<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PerformanceReportDBDAOSearchEBkgSiUploadStsListByPendingRSQL">
			<desc><![CDATA[e-BKG & S/I Upload Status Report - ESM_BKG_0226
Report Typeì´ Pending Report]]></desc>
			<sql><![CDATA[
SELECT REGION_CD
,	   GSO
,	   BKG_OFC
,      MON
,      B_TTL
,      B_X
,      B_F
,      B_R
,      B_D
,      B_P
,	 TO_CHAR(100 - TRUNC(B_P/DECODE(B_TTL,0,1,B_TTL),4)*100) B_PF
,      S_TTL
,      S_X
,      S_F
,      S_R
,      S_D
,      S_P
,      TO_CHAR(100 - TRUNC(S_P/DECODE(S_TTL,0,1,S_TTL),4)*100) S_PF
,	''	SORT
,	''  DOC_TP_CD
,	''	DOC_TP_B
,	''	DOC_TP_S
,	''	BKG_UPLD_STS_CD
,	''	XTER_RQST_NO
,	''	POR_CD
,	''	POL_CD
,	''	POD_CD
,	''	DEL_CD
,	''	DELAY
,	''	BKG_NO
,	''	LS_FROM_DT
,	''	LS_TO_DT
,	''	SERVER_ID
,	''	SAL_OFC
,	''  DURATION
,	''  FR_DT
,	''  TO_DT
,	''  REPORT_TYPE
, 	'' DURATION_YEAR
, 	'' DURATION_MONTH
, 	'' DURATION_FROM_WEEK
, 	'' DURATION_TO_WEEK
, 	'' DURATION_FROM_DT
, 	'' DURATION_TO_DT
,	'' TOTAL_CNT
,	'' ROW_NUM	
,	'' I_PAGE_NO
FROM (
	 -----------------------------------------------------------------------------
      SELECT  A_IB.REGION_CD
	  ,		  A_IB.GSO GSO
      ,       A_IB.BKG_OFC
      ,       TO_CHAR(A_IB.UPLD_DT,'YYYY-MM') MON
      ,       SUM(DECODE(AIBKG.DOC_TP_CD,'B',1,0)) B_TTL
      ,       SUM(DECODE(AIBKG.DOC_TP_CD,'B',DECODE(A_IB.BKG_STS_CD,'X',1,0),0)) B_X
      ,       SUM(DECODE(AIBKG.DOC_TP_CD,'B',DECODE(A_IB.BKG_UPLD_STS_CD,'F',1,0),0)) B_F
      ,       SUM(DECODE(AIBKG.DOC_TP_CD,'B',DECODE(A_IB.BKG_UPLD_STS_CD,'R',1,0),0)) B_R
      ,       SUM(DECODE(AIBKG.DOC_TP_CD,'B',DECODE(A_IB.BKG_UPLD_STS_CD,'D',1,0),0)) B_D
      ,       SUM(DECODE(AIBKG.DOC_TP_CD,'B',DECODE(A_IB.BKG_UPLD_STS_CD,'N',1,0),0)) B_P
      ,       SUM(DECODE(AIBKG.DOC_TP_CD,'S',1,0)) S_TTL
      ,       SUM(DECODE(AIBKG.DOC_TP_CD,'S',DECODE(A_IB.BKG_STS_CD,'X',1,0),0)) S_X
      ,       SUM(DECODE(AIBKG.DOC_TP_CD,'S',DECODE(A_IB.BKG_UPLD_STS_CD,'F',1,0),0)) S_F
      ,       SUM(DECODE(AIBKG.DOC_TP_CD,'S',DECODE(A_IB.BKG_UPLD_STS_CD,'R',1,0),0)) S_R
      ,       SUM(DECODE(AIBKG.DOC_TP_CD,'S',DECODE(A_IB.BKG_UPLD_STS_CD,'D',1,0),0)) S_D
      ,       SUM(DECODE(AIBKG.DOC_TP_CD,'S',DECODE(A_IB.BKG_UPLD_STS_CD,'N',1,0),0)) S_P
      FROM    BKG_XTER_RQST_MST AIBKG 
	 ,       (
			-----------------------------------------------------------------------------
				SELECT IBKG.XTER_RQST_NO
			 ,	      IB_NO.REGION_CD
             ,        IBKG.BKG_NO
             ,        MAX(IBKG.UPLD_DT)  UPLD_DT
             ,        IB_NO.BKG_OFC 
             ,        IB_NO.GSO
             ,        IB_NO.DOC_TP_CD
             ,        IB_NO.BKG_STS_CD
             ,        DECODE(MAX(DECODE(NVL(IBKG.BKG_UPLD_STS_CD,'A'),'F','D','R','C','D','B','A')),'A','N','B','D','C','R','D','F') BKG_UPLD_STS_CD 
             ,        IB_NO.POR_CD
             ,        IB_NO.POL_CD
             ,        IB_NO.POD_CD
             ,        IB_NO.DEL_CD
               FROM    BKG_XTER_RQST_MST IBKG, 
                       ( 
                       -----------------------------------------------------------------------------
                       SELECT	/*+ALL_ROWS */ OFC.REGION REGION_CD
					   ,	  A.XTER_RQST_NO
                       ,      A.BKG_OFC_CD BKG_OFC 
					   ,	  OFC.GSO GSO	
                       ,      A.BKG_NO
                       ,      A.DOC_TP_CD
                       ,      A.BKG_STS_CD
                       ,      A.POR_CD
                       ,      A.POL_CD
                       ,      A.POD_CD
                       ,      A.DEL_CD
                       FROM	(
								-----------------------------------------------------------------------------
                              		SELECT	A.XTER_RQST_NO
                                  ,       A.DOC_TP_CD
                                  ,       BKG.BKG_STS_CD
                                  ,       A.XTER_RQST_SEQ
                                  ,       A.BKG_NO
                                  ,       NVL(CUSTS.CUST_CNT_CD,  NVL(A.PRNT_CNT_CD,  B.CNT_CD )) CNT_CDH 
                                  ,       NVL(CUSTS.CUST_SEQ, NVL(A.PRNT_CUST_SEQ, B.CUST_SEQ)) CUST_CDH 
                                  ,       BKG.BKG_OFC_CD              
                                  ,       A.POR_CD   IB_POR_CD       
                                  ,       A.POL_CD   IB_POL_CD        
                                  ,       A.POD_CD   IB_POD_CD        
                                  ,       A.DEL_CD   IB_DEL_CD        
                                  ,       A.UPLD_DT                  
                                  ,       DECODE(NVL(BKG.POR_CD,' '),' ',A.POR_CD,BKG.POR_CD) POR_CD 
                                  ,       DECODE(NVL(BKG.POL_CD,' '),' ',A.POL_CD,BKG.POL_CD) POL_CD 
                                  ,       DECODE(NVL(BKG.POD_CD,' '),' ',A.POD_CD,BKG.POD_CD) POD_CD 
                                  ,       DECODE(NVL(BKG.DEL_CD,' '),' ',A.DEL_CD,BKG.DEL_CD) DEL_CD 
                                  FROM		BKG_XTER_RQST_MST A 
                                  ,       BKG_XTER_CUST B  
                                  ,       BKG_BOOKING BKG  
                                  ,       BKG_CUSTOMER CUSTS 
                                  WHERE		B.XTER_RQST_NO(+) = A.XTER_RQST_NO 
                                  AND		  B.XTER_RQST_SEQ = A.XTER_RQST_SEQ 
								  AND    		B.XTER_SNDR_ID(+) = A.XTER_SNDR_ID 
								  AND		  A.BKG_NO = BKG.BKG_NO(+) 
								   AND		  A.BKG_NO = CUSTS.BKG_NO(+)        
                                  AND		  A.XTER_BKG_RQST_STS_CD != 'T' 
                                  AND		  B.XTER_CUST_TP_CD      = 'S' 
                                  AND		  CUSTS.BKG_CUST_TP_CD  = 'S'  
                                  AND		  NVL(A.XTER_BL_TP_CD,' ') != 'H'  

                                  AND     A.DOC_TP_CD IN ('B','S')  
								/**e-SVC Type**/
								#if (${doc_tp_b} != '' && ${doc_tp_s} == '') 
								  AND     A.DOC_TP_CD = @[doc_tp_b]
								#end
								#if (${doc_tp_s} != '' && ${doc_tp_b} == '') 
								  AND     A.DOC_TP_CD = @[doc_tp_s]
								#end
                                  
                                  AND     A.DOC_TP_CD  NOT IN ('F')         
                                  AND     A.XTER_BKG_RQST_STS_CD IN ('C','U','X')  

#if (${duration} == 'M') 
	#if (${duration_month} != '') 
									AND    A.RQST_DT >= BKG_GET_CONV_DT_FNC('FR_MON',@[duration_year],@[duration_month])
									AND    A.RQST_DT <= BKG_GET_CONV_DT_FNC('TO_MON',@[duration_year],@[duration_month]) + 0.99999
	#end
#end
#if (${duration} == 'W') 
	#if (${duration_from_week} != '') 
								AND    A.RQST_DT>= BKG_GET_CONV_DT_FNC('FR_WEEK',@[duration_year],@[duration_from_week])
	#end
	#if (${duration_to_week} != '')         
       							 AND    A.RQST_DT <= BKG_GET_CONV_DT_FNC('TO_WEEK',@[duration_year],@[duration_to_week]) + 0.99999
	#end
#end

#if (${duration} == 'D') 
	#if (${duration_from_dt} != '') 
								  AND    A.RQST_DT   >= TO_DATE(@[duration_from_dt], 'YYYY-MM-DD') 
	#end

	#if (${duration_to_dt} != '') 
								  AND    A.RQST_DT <= TO_DATE(@[duration_to_dt], 'YYYY-MM-DD') + 0.99999 
	#end  
#end
                                  
								#if (${bkg_ofc} != '') 
								  AND     BKG.BKG_OFC_CD = @[bkg_ofc]
								#end
								#if (${sal_ofc} != '') 
                                  AND     BKG.OB_SLS_OFC_CD = @[sal_ofc]-- SALES OFFICE         
							    #end
								#if (${por_cd} != '') 
								  AND     A.POR_CD = @[por_cd]
								#end
								#if (${pol_cd} != '') 
                              	  AND     A.POL_CD = @[pol_cd]
								#end
								#if (${pod_cd} != '') 
                              	  AND     A.POD_CD = @[pod_cd]
								#end
								#if (${del_cd} != '') 
                              	  AND     A.DEL_CD = @[del_cd]
								#end
								-----------------------------------------------------------------------------
								  ) A
                       ,          (SELECT MC.* 
                                  FROM    MDM_CUSTOMER MC   
                                  WHERE   MC.NMD_CUST_FLG != 'Y' 
                                  ) CUSTH
                      ,           BKG_OFC_LVL_V OFC
                      WHERE	      A.CNT_CDH	=	CUSTH.CUST_CNT_CD(+)
                      AND	        A.CUST_CDH	=	CUSTH.CUST_SEQ(+)
					  AND         A.BKG_OFC_CD = OFC.OFC_CD --MDM_LOCATION

				#if (${region_cd} != '') 
					  AND         OFC.REGION = @[region_cd]  --REGION  
				#end
				
				#if (${gso} != '') 
					  AND		OFC.GSO	=	@[gso]
				#end	  
                      GROUP BY    A.XTER_RQST_NO,OFC.REGION,A.BKG_OFC_CD
                                  ,A.BKG_NO
								  ,OFC.GSO
                                  ,A.DOC_TP_CD, A.BKG_STS_CD,A.POR_CD, A.POL_CD, A.POD_CD, A.DEL_CD 
						) IB_NO
                       -----------------------------------------------------------------------------
            WHERE     IBKG.XTER_RQST_NO = IB_NO.XTER_RQST_NO
            AND       IBKG.BKG_NO       = IB_NO.BKG_NO
            AND       IBKG.DOC_TP_CD    = IB_NO.DOC_TP_CD  
            AND       XTER_BKG_RQST_STS_CD IN ('C','U','X')
			AND       IBKG.UPLD_DT IS NOT NULL
            AND       IBKG.BKG_UPLD_STS_CD <> 'D'
            GROUP BY  IBKG.XTER_RQST_NO, IB_NO.REGION_CD,IBKG.BKG_NO,  IB_NO.BKG_OFC, IB_NO.GSO
                     ,IB_NO.DOC_TP_CD, IB_NO.BKG_STS_CD,
                      IB_NO.POR_CD, IB_NO.POL_CD, IB_NO.POD_CD, IB_NO.DEL_CD
            ) A_IB
  		 	-----------------------------------------------------------------------------
WHERE     AIBKG.XTER_RQST_NO = A_IB.XTER_RQST_NO
AND       AIBKG.BKG_NO = A_IB.BKG_NO
AND       AIBKG.DOC_TP_CD = A_IB.DOC_TP_CD
GROUP BY  A_IB.REGION_CD
,		  A_IB.GSO
,         A_IB.BKG_OFC
,         TO_CHAR(A_IB.UPLD_DT,'YYYY-MM')
)
ORDER BY REGION_CD,GSO, BKG_OFC, MON			]]></sql>
			<params>
				<param name="doc_tp_b" type="12" value="" out="N"/>
				<param name="doc_tp_s" type="12" value="" out="N"/>
				<param name="duration_year" type="12" value="" out="N"/>
				<param name="duration_month" type="12" value="" out="N"/>
				<param name="duration_from_week" type="12" value="" out="N"/>
				<param name="duration_to_week" type="12" value="" out="N"/>
				<param name="duration_from_dt" type="12" value="" out="N"/>
				<param name="duration_to_dt" type="12" value="" out="N"/>
				<param name="bkg_ofc" type="12" value="" out="N"/>
				<param name="sal_ofc" type="12" value="" out="N"/>
				<param name="por_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
				<param name="region_cd" type="12" value="" out="N"/>
				<param name="gso" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
