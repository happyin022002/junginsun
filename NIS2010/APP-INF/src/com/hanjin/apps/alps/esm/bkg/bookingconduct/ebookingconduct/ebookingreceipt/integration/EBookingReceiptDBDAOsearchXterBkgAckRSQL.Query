<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="EBookingReceiptDBDAOsearchXterBkgAckRSQL">
			<desc><![CDATA[searchXterBkgAck]]></desc>
			<sql><![CDATA[
SELECT	'$$$MSGSTART:'||RPAD(LTRIM(edi.SND_ID),20)||
            RPAD(LTRIM(DECODE(mst.xter_sndr_id, 'CRSEDI_UNOA', 'CRSEDI', 'CRSEDI_UNOB', 'CRSEDI', mst.xter_sndr_id)),20)||RPAD('APERAK',10)||
        	RPAD(NVL(TRIM('BKG'),' '),3)||TO_CHAR(SYSDATE,'rrmmdd')||LTRIM(TO_CHAR(BKG_EDI_SEQ.nextval,'000009'),' ')||CHR(10)||
			'IB_CUST_RFF_NO:'   ||xter_instr.DOC_usr_ID             ||CHR(10)||
			'IB_SI_NO:'         ||mst.xter_rqst_no                  ||CHR(10)||
			'IB_EDI_ID:'        ||mst.xter_sndr_id                  ||CHR(10)||
		 	'IB_HJS_ID:'        ||edi.SND_ID                        ||CHR(10)||
			'IB_MSG_FLAG:'      ||@[doc_tp_cd]                      ||CHR(10)||
			'IB_PRC:'           ||'AP'                              ||CHR(10)||
			'IB_ERC:'           ||'OK'                              ||CHR(10)||
			'IB_FTX:'           ||'PROCESSING SUCCESSED'            ||CHR(10)||
			'IB_CUST_RFF_NO2:'  ||NVL(mst.CUST_ReF_NO, ' ')         ||CHR(10)||
            'IB_MBL_NO:'        ||BK.BL_NO||BK.BL_TP_CD             ||CHR(10)||
            'IB_BKG_NO:'        ||bk.bkg_no                         ||CHR(10)||
            'IB_VSL_NAME:'      ||VSL.VSL_ENG_NM                    ||CHR(10)||
            'IB_VOYAGE_NO:'     ||BK.SKD_VOY_NO                     ||CHR(10)||
            'IB_VSL_ETL: '      ||to_char(vps.VPS_ETB_DT,'YYYYMMDD')||CHR(10) FLAT_FILE
   FROM bkg_xter_rqst_mst mst
        , bkg_xter_instr xter_instr
        , bkg_BOOKING BK
        , mdm_VSL_cntr vsl
        , vsk_VSL_PORT_SKD vps
        , BKG_VVD vvd
        , (select grp.cust_trd_prnr_id rcv_id
				, grp.prov_trd_prnr_id SND_ID
			 from edi_group grp
			where grp.delt_flg          = 'N'
		 group by grp.cust_trd_prnr_id, grp.prov_trd_prnr_id ) edi
 where 1 = 1
   and mst.xter_sndr_id     = @[sender_id]
   and mst.xter_rqst_no     = @[rqst_no]
   and mst.xter_rqst_seq    = @[rqst_seq]
   AND mst.xter_rqst_no     = xter_instr.xter_rqst_no(+)
   AND mst.xter_rqst_seq    = xter_instr.xter_rqst_seq(+)
   AND mst.xter_sndr_id	    = xter_instr.xter_sndr_id(+)
   AND mst.xter_sndr_id     = edi.rcv_id
   AND mst.bkg_no           = BK.BKG_NO
   AND BK.VSL_CD            = VSL.VSL_CD
   AND bk.VSL_CD 			= vvd.VSL_CD
   AND bk.SKD_VOY_NO 	    = vvd.SKD_VOY_NO
   AND bk.SKD_DIR_CD 		= vvd.SKD_DIR_CD
   AND vvd.VSL_CD 			= vps.VSL_CD       (+)   
   AND vvd.SKD_VOy_NO 	    = vps.SKD_VOY_NO   (+)
   AND vvd.SKD_DIR_CD 		= vps.SKD_DIR_CD   (+)
   and vvd.pol_clpt_ind_seq = vps.clpt_ind_seq (+)
   AND vvd.POL_cd 		    = vps.VPS_port_CD  (+)
   AND ROWNUM 		        = 1			]]></sql>
			<params>
				<param name="doc_tp_cd" type="12" value="" out="N"/>
				<param name="sender_id" type="12" value="" out="N"/>
				<param name="rqst_no" type="12" value="" out="N"/>
				<param name="rqst_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
