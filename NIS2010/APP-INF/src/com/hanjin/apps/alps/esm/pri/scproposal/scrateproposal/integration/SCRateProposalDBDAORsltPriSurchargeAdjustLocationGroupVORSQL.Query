<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCRateProposalDBDAORsltPriSurchargeAdjustLocationGroupVORSQL">
			<desc><![CDATA[   Surcharge Adjust Location Group 조회]]></desc>
			<sql><![CDATA[
WITH dstct_rout_pnt AS (
	SELECT DISTINCT rout_pnt.rout_pnt_loc_def_cd 
	, rout_pnt.prop_no,rout_pnt.amdt_seq,rout_pnt.svc_scp_cd, rout_pnt.rout_pnt_loc_tp_cd ,rout_pnt.org_dest_tp_cd
	FROM pri_sp_scp_rt_rout_pnt rout_pnt
	WHERE rout_pnt.prop_no = @[prop_no]
		AND rout_pnt.amdt_seq = @[amdt_seq]
		AND rout_pnt.svc_scp_cd = @[svc_scp_cd]
		AND rout_pnt.org_dest_tp_cd = @[org_dest_tp_cd]
		AND @[select_type] = 'ORI'
),
dstct_rout_via AS (
	SELECT DISTINCT rout_via.rout_via_port_def_cd 
	, rout_via.prop_no,rout_via.amdt_seq,rout_via.svc_scp_cd, rout_via.rout_via_port_tp_cd ,rout_via.org_dest_tp_cd
	FROM pri_sp_scp_rt_rout_via rout_via
	WHERE rout_via.prop_no = @[prop_no]
		AND rout_via.amdt_seq = @[amdt_seq]
		AND rout_via.svc_scp_cd = @[svc_scp_cd]
		AND rout_via.org_dest_tp_cd = @[org_dest_tp_cd]
		AND @[select_type] = 'VIA'
)
SELECT loc_def_cd , prc_grp_loc_desc
	, prop_no,amdt_seq,svc_scp_cd, grp_loc_seq,  rout_loc_tp_cd ,org_dest_tp_cd
FROM (
	-- Origin/Destination Begin
	SELECT rout_pnt.rout_pnt_loc_def_cd as  loc_def_cd , grp_loc.prc_grp_loc_desc as prc_grp_loc_desc
	, grp_loc.prop_no,grp_loc.amdt_seq,grp_loc.svc_scp_cd, grp_loc.grp_loc_seq, rout_pnt.rout_pnt_loc_tp_cd as rout_loc_tp_cd ,rout_pnt.org_dest_tp_cd
	FROM dstct_rout_pnt rout_pnt
		, pri_sp_scp_grp_loc grp_loc
	WHERE  rout_pnt.rout_pnt_loc_tp_cd = 'G'
		AND rout_pnt.prop_no = grp_loc.prop_no
		AND rout_pnt.amdt_seq = grp_loc.amdt_seq
		AND rout_pnt.svc_scp_cd = grp_loc.svc_scp_cd
		AND rout_pnt.rout_pnt_loc_def_cd = grp_loc.prc_grp_loc_cd
		AND @[select_type] = 'ORI'
	UNION ALL
	SELECT mdm_loc.loc_cd  , mdm_loc.loc_nm
	, rout_pnt.prop_no,rout_pnt.amdt_seq,rout_pnt.svc_scp_cd, 0 grp_loc_seq, rout_pnt.rout_pnt_loc_tp_cd,rout_pnt.org_dest_tp_cd
	FROM dstct_rout_pnt rout_pnt
	, mdm_location mdm_loc
	WHERE  rout_pnt.rout_pnt_loc_tp_cd = 'L'
		AND mdm_loc.delt_flg = 'N'
		AND rout_pnt.rout_pnt_loc_def_cd = mdm_loc.loc_cd
		AND @[select_type] = 'ORI'
	-- Origin/Destination End
	UNION ALL
	-- Origin Via/Destination Via Begin
	SELECT rout_via.rout_via_port_def_cd , grp_loc.prc_grp_loc_desc 
	, grp_loc.prop_no,grp_loc.amdt_seq,grp_loc.svc_scp_cd,grp_loc.grp_loc_seq, rout_via.rout_via_port_tp_cd as rout_loc_tp_cd ,rout_via.org_dest_tp_cd
	FROM dstct_rout_via rout_via
		, pri_sp_scp_grp_loc grp_loc
	WHERE  rout_via.rout_via_port_tp_cd = 'G'
		AND rout_via.prop_no = grp_loc.prop_no
		AND rout_via.amdt_seq = grp_loc.amdt_seq
		AND rout_via.svc_scp_cd = grp_loc.svc_scp_cd
		AND rout_via.rout_via_port_def_cd = grp_loc.prc_grp_loc_cd
		AND @[select_type] = 'VIA'
	UNION ALL
	SELECT mdm_loc.loc_cd  , mdm_loc.loc_nm
	, rout_via.prop_no,rout_via.amdt_seq,rout_via.svc_scp_cd, 0 grp_loc_seq, rout_via.rout_via_port_tp_cd,rout_via.org_dest_tp_cd
	FROM dstct_rout_via rout_via
	, mdm_location mdm_loc
	WHERE   rout_via.rout_via_port_tp_cd = 'L'
		AND mdm_loc.delt_flg = 'N'
		AND rout_via.rout_via_port_def_cd = mdm_loc.loc_cd
		AND @[select_type] = 'VIA'
	-- Origin Via/Destination Via End
)
ORDER BY loc_def_cd			]]></sql>
			<params>
				<param name="prop_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="12" value="" out="N"/>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="org_dest_tp_cd" type="12" value="" out="N"/>
				<param name="select_type" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
