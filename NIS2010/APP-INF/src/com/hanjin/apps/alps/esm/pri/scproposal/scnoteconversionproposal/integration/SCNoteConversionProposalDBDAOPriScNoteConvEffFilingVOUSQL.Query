<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCNoteConversionProposalDBDAOPriScNoteConvEffFilingVOUSQL">
			<desc><![CDATA[filing시 변경 note가 amend 된 데이터만 변경한다.]]></desc>
			<sql><![CDATA[
UPDATE PRI_SC_NOTE_CONV CONV SET
       EFF_DT = TO_DATE(@[file_dt],'yyyy-MM-dd')
WHERE NOTE_CONV_MAPG_ID IN (
			                SELECT   NOTE_CONV_MAPG_ID
			                FROM     PRI_SP_SCP_NOTE_CTNT
			                WHERE    PROP_NO = @[prop_no]
			                     AND AMDT_SEQ = @[amdt_seq]
			                     AND N1ST_CMNC_AMDT_SEQ = @[amdt_seq]
			                UNION ALL
			                SELECT   NOTE_CONV_MAPG_ID
			                FROM     PRI_SP_SCP_RT_CNOTE
			                WHERE    PROP_NO = @[prop_no]
			                     AND AMDT_SEQ = @[amdt_seq]
			                     AND N1ST_CMNC_AMDT_SEQ = @[amdt_seq]
			                UNION ALL
			                SELECT   NOTE_CONV_MAPG_ID
			                FROM     PRI_SP_SCP_RT_CMDT_RNOTE
			                WHERE    PROP_NO = @[prop_no]
			                     AND AMDT_SEQ = @[amdt_seq]
			                     AND N1ST_CMNC_AMDT_SEQ = @[amdt_seq]
														)
AND (TO_CHAR(EFF_DT, 'yyyyMMdd') < @[file_dt]
     OR (TO_CHAR(EFF_DT, 'yyyyMMdd') > @[file_dt] 
         AND TO_CHAR(EFF_DT, 'yyyyMMdd') =
              (SELECT TO_CHAR(EFF_DT, 'yyyyMMdd')
               FROM   PRI_SP_SCP_MN
               WHERE  CONV.PROP_NO = PROP_NO
               AND    CONV.AMDT_SEQ = AMDT_SEQ
               AND    CONV.SVC_SCP_CD = SVC_SCP_CD
               AND    CONV.EFF_DT = EFF_DT)
         )
     )
AND NOTE_CONV_TP_CD <> 'T'			]]></sql>
			<params>
				<param name="file_dt" type="12" value="" out="N"/>
				<param name="prop_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
