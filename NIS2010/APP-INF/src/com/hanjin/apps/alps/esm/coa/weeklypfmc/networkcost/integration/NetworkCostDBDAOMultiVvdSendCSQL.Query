<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="NetworkCostDBDAOMultiVvdSendCSQL">
			<desc><![CDATA[Bunker Tariff 정보를 생성한다.
[CHM-201215754-01] [COA] Bunker Fee 화면 개발 건 쿼리 변경 -FCM의 Cons 정보를 COA_BNK_TRF 테이블 Cons에 MERGE 하는 쿼리.]]></desc>
			<sql><![CDATA[
-- YYYY-WW에서만 사용
 INSERT
   INTO FCM_ESTM_WK_CSM_IF
        (
                BSE_YRMON
              , BSE_WK
              , VSL_CD
              , SKD_VOY_NO
              , SKD_DIR_CD
              , TRD_CD
              , SUB_TRD_CD
              , FCM_ESTM_WRK_DT
              , FCM_ESTM_WRK_SEQ
              , FOIL_ESTM_CSM_WGT
              , DOIL_ESTM_CSM_WGT
              , CRE_USR_ID
              , CRE_DT
              , UPD_USR_ID
              , UPD_DT
        )
SELECT DISTINCT A1.SLS_YRMON         AS BSE_YRMON
      , A1.COST_WK                   AS BSE_WK
      , A1.VSL_CD                    AS VSL_CD
      , A1.SKD_VOY_NO                AS SKD_VOY_NO
      , A1.DIR_CD                    AS SKD_DIR_CD
      , A1.TRD_CD                    AS TRD_CD
      , A1.SUB_TRD_CD                AS SUB_TRD_CD
      , TO_CHAR(SYSDATE, 'YYYYMMDD') AS FCM_ESTM_WRK_DT
      , (
                 SELECT NVL(MAX(FCM_ESTM_WRK_SEQ), 0) + 1
                   FROM FCM_ESTM_WK_CSM_IF
                  WHERE BSE_YRMON       = A1.SLS_YRMON
                    AND BSE_WK          = A1.COST_WK
                    AND VSL_CD          = A1.VSL_CD
                    AND SKD_VOY_NO      = A1.SKD_VOY_NO
                    AND SKD_DIR_CD      = A1.DIR_CD
                    AND TRD_CD          = A1.TRD_CD
                    AND SUB_TRD_CD      = A1.SUB_TRD_CD
                    AND FCM_ESTM_WRK_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
        )           AS FCM_ESTM_WRK_SEQ
      , NULL        AS FOIL_ESTM_CSM_WGT
      , NULL        AS DOIL_ESTM_CSM_WGT
      , @[cre_usr_id] AS CRE_USR_ID   
      , SYSDATE     AS CRE_DT
      , @[cre_usr_id] AS UPD_USR_ID
      , SYSDATE     AS UPD_DT
   FROM COA_MON_VVD A1
      , COA_VSL_RGST A2
      , COA_LANE_RGST A3
  WHERE A1.TRD_CD          = A3.TRD_CD
    AND A1.RLANE_CD        = A3.RLANE_CD
    AND A1.IOC_CD          = A3.IOC_CD
    AND A1.DIR_CD          = A3.DIR_CD
    AND A3.TRD_CD         <> 'COM'
    AND A3.VSL_LANE_TP_CD IN ('JO', 'SC')
    AND A1.VSL_CD          = A2.VSL_CD
    AND A1.N1ST_LODG_PORT_ETD_DT BETWEEN A2.VSL_APLY_FM_DT AND A2.VSL_APLY_TO_DT
    AND A2.VOP_CD = 'HJS'
    AND A1.SLS_YRMON LIKE @[cost_yrmon]||'%'
    AND A1.COST_WK    = @[cost_wk]
    AND A1.RLANE_CD   = @[rlane_cd]
    AND A1.SLAN_CD    = @[slan_cd]
    AND A1.VSL_CD     = @[vsl_cd] 
    AND A1.SKD_VOY_NO = @[skd_voy_no]
    AND A1.DIR_CD     = @[dir_cd]
    AND A1.DELT_FLG   = 'N'
    AND A2.DELT_FLG   = 'N'
    AND A3.DELT_FLG   = 'N'			]]></sql>
			<params>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="cost_yrmon" type="12" value="" out="N"/>
				<param name="cost_wk" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="slan_cd" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
