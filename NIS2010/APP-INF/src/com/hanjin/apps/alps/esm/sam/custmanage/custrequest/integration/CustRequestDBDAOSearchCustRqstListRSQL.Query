<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CustRequestDBDAOSearchCustRqstListRSQL">
			<desc><![CDATA[Search customer request list]]></desc>
			<sql><![CDATA[
SELECT *
FROM ( 
SELECT  
    ROWNUM NO, 
    A.MDM_CUSTOMER_RQST_SEQ RQST_NO
   ,A.CUST_LGL_ENG_NM
   ,OFC_CD
   ,SREP_CD
   ,LOC_CD
   ,CUST_EML
   ,A.GRP_INDIV_DIV
   ,TO_CHAR(A.RQST_DT,'YYYY-MM-DD HH24:MI') RQST_DT
   ,TO_CHAR(A.UPD_DT,'YYYY-MM-DD HH24:MI') UPD_DT
   , TO_CHAR(
         CASE WHEN A.GRP_INDIV_DIV = 'G' THEN (SELECT MCPG.CRE_DT FROM MDM_CUST_PERF_GRP MCPG WHERE MCPG.CUST_GRP_ID = A.CRM_ROW_ID AND ROWNUM = 1)
         ELSE NVL((SELECT MC.CRE_DT FROM MDM_CUSTOMER MC WHERE MC.CRM_ROW_ID = A.CRM_ROW_ID AND ROWNUM = 1)
				  ,(SELECT MC.CRE_DT FROM MDM_CUSTOMER MC WHERE MC.CUST_CNT_CD = A.CUST_CNT_CD AND MC.CUST_SEQ = A.CUST_SEQ AND ROWNUM = 1))
         END,'YYYY-MM-DD HH24:MI')  APP_DT
   , CASE WHEN A.GRP_INDIV_DIV = 'G' THEN (SELECT CUST_GRP_ID FROM MDM_CUST_PERF_GRP MCPG WHERE MCPG.CUST_GRP_ID = A.CRM_ROW_ID AND ROWNUM = 1)
     ELSE NVL((SELECT MC.CUST_CNT_CD||TRIM(TO_CHAR(MC.CUST_SEQ,'000000')) FROM MDM_CUSTOMER MC WHERE MC.CRM_ROW_ID = A.CRM_ROW_ID AND ROWNUM = 1),A.CUST_CNT_CD||TRIM(TO_CHAR(A.CUST_SEQ,'000000')))
     END  CUST_CD
   , CASE WHEN DELT_FLG = 'N' THEN 'Saved'
          WHEN DELT_FLG = 'R' THEN 'Rejected'
          WHEN A.GRP_INDIV_DIV = 'G' THEN NVL((SELECT 'Approved' FROM MDM_CUST_PERF_GRP MCPG WHERE MCPG.CUST_GRP_ID = A.CRM_ROW_ID AND ROWNUM = 1),'Requested' )
          WHEN CUST_CNT_CD IS NOT NULL THEN 'Approved'
          WHEN DELT_FLG = 'P' THEN NVL((SELECT 'Approved' FROM MDM_CUSTOMER MC WHERE MC.CRM_ROW_ID = A.CRM_ROW_ID AND ROWNUM = 1), 'Requested' )
     ELSE 'Saved'
     END  DELT_FLG
FROM MDM_CUSTOMER_RQST A
WHERE 1=1
#if (${rqst_no} != '')
AND A.MDM_CUSTOMER_RQST_SEQ = @[rqst_no]
#end    
#if (${cust_nm} != '')
AND A.CUST_LGL_ENG_NM like '%' || UPPER(@[cust_nm]) || '%'
#end
#if (${ofc_cd} != '')
AND A.OFC_CD like '%' || UPPER(@[ofc_cd]) || '%'
#end
#if (${delt_flg} != '' && ${delt_flg} != 'ALL')
and CASE WHEN DELT_FLG = 'N' THEN 'N'
          WHEN DELT_FLG = 'R' THEN 'R'
          WHEN A.GRP_INDIV_DIV = 'G' THEN NVL((SELECT 'A' FROM MDM_CUST_PERF_GRP MCPG WHERE MCPG.CUST_GRP_ID = A.CRM_ROW_ID AND ROWNUM = 1),'P' )
          WHEN CUST_CNT_CD IS NOT NULL THEN 'A'
          WHEN DELT_FLG = 'P' THEN NVL((SELECT 'A' FROM MDM_CUSTOMER MC WHERE MC.CRM_ROW_ID = A.CRM_ROW_ID AND ROWNUM = 1), 'P' )
     ELSE 'N'
     END = @[delt_flg]
#end
#if (${rqst_fm_dt} != '')
AND RQST_DT >= TO_DATE(@[rqst_fm_dt],'YYYY-MM-DD')
#end
#if (${rqst_to_dt} != '')
AND RQST_DT <= TO_DATE(@[rqst_to_dt],'YYYY-MM-DD') + 0.99999
#end
#if (${cre_fm_dt} != '')
AND CRE_DT >= TO_DATE(@[cre_fm_dt],'YYYY-MM-DD')
#end
#if (${cre_to_dt} != '')
AND CRE_DT <= TO_DATE(@[cre_to_dt],'YYYY-MM-DD') + 0.99999
#end
ORDER BY MDM_CUSTOMER_RQST_SEQ desc
)
WHERE NO BETWEEN @[startpart] AND @[endpart]			]]></sql>
			<params>
				<param name="rqst_no" type="12" value="" out="N"/>
				<param name="cust_nm" type="12" value="" out="N"/>
				<param name="ofc_cd" type="12" value="" out="N"/>
				<param name="delt_flg" type="12" value="" out="N"/>
				<param name="rqst_fm_dt" type="12" value="" out="N"/>
				<param name="rqst_to_dt" type="12" value="" out="N"/>
				<param name="cre_fm_dt" type="12" value="" out="N"/>
				<param name="cre_to_dt" type="12" value="" out="N"/>
				<param name="startpart" type="12" value="" out="N"/>
				<param name="endpart" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
