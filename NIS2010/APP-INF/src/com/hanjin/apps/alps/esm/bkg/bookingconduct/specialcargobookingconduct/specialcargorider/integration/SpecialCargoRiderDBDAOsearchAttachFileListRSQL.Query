<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SpecialCargoRiderDBDAOsearchAttachFileListRSQL">
			<desc><![CDATA[B/L Rider & DG Rider 파일 업로드 현황 조회]]></desc>
			<sql><![CDATA[
SELECT 
idx ,
CASE WHEN ridr_tp_cd ='D' THEN 'D/G Rider'
     WHEN ridr_tp_cd ='A' THEN 'Awkward Rider'
     WHEN ridr_tp_cd ='B' THEN 'Break Bulk Rider'
     WHEN ridr_tp_cd ='G' THEN 'B/L Rider'
     WHEN ridr_tp_cd ='C' THEN 'Certificate' END  AS ridr_tp_cd
, BKG.bkg_no
, bl_no
, slan_cd
, vsl_cd
, pol_cd
, pod_cd
, file_nm
, cntr_no
, cntr_cgo_seq
, bkg_ofc_cd
, ob_sls_ofc_cd
, rgst_usr_id
, rgst_ofc_cd
, TO_CHAR(rgst_dt, 'YYYY-MM-DD HH24:MI') rgst_dt
, usr_nm
, file_sav_id
 FROM (
    SELECT 
	idx
    , ridr_tp_cd
    , BKG.bkg_no
    , bl_no
    , slan_cd
    , vsl_cd
    , pol_cd
    , pod_cd
    , file_nm
#if (${ridr_tp_cd} == 'D') 
--D/G Rider   
    , cntr_no
    , cntr_cgo_seq
#elseif (${ridr_tp_cd} == 'A') 
--Awkward Rider  
    , cntr_no
    , '' cntr_cgo_seq
#else
--Break Bulk Rider     B/L Rider    Certificate
    , '' cntr_no
    , '' cntr_cgo_seq
#end
    , bkg_ofc_cd
    , ob_sls_ofc_cd
    , rgst_usr_id
    , rgst_ofc_cd
    , rgst_dt
    , file_sav_id
     FROM (
            SELECT
			 dense_Rank() Over ( Order By STO.bkg_no) idx,
             STO.bkg_no
             , ridr_tp_cd
            , bl_no
            , slan_cd
            , vsl_cd||skd_voy_no||skd_dir_cd as vsl_cd
            , pol_cd
            , pod_cd
            , file_nm
	#if (${ridr_tp_cd} == 'D') 
	--D/G Rider   
	, DCGO_SEQ
	#elseif (${ridr_tp_cd} == 'A') 
	--Awkward Rider  
	, AWK_CGO_SEQ
	#else
	--Break Bulk Rider     B/L Rider    Certificate
    , ''
	#end
            , bkg_ofc_cd
            , ob_sls_ofc_cd
            , rgst_usr_id
            , rgst_ofc_cd
            , rgst_dt
            , file_sav_id
            FROM BKG_IMG_STO STO , BKG_BOOKING  BKG

		#if (${pre_post_vsl_cd} != '' )
			,(  
				SELECT BKG_NO, VSL_CD||SKD_VOY_NO||SKD_DIR_CD PRE_1_VVD
				FROM BKG_VVD
				WHERE VSL_PRE_PST_CD ='S'
				AND VSL_SEQ ='1'
				AND VSL_CD     = SUBSTR(@[pre_post_vsl_cd], 1, 4)
				AND SKD_VOY_NO = SUBSTR(@[pre_post_vsl_cd], 5, 4)
				AND SKD_DIR_CD = SUBSTR(@[pre_post_vsl_cd], 9, 1)
				UNION
				SELECT BKG_NO, VSL_CD||SKD_VOY_NO||SKD_DIR_CD PRE_1_VVD
				FROM BKG_VVD
				WHERE VSL_PRE_PST_CD ='S'
				AND VSL_SEQ ='2'
				AND VSL_CD     = SUBSTR(@[pre_post_vsl_cd], 1, 4)
				AND SKD_VOY_NO = SUBSTR(@[pre_post_vsl_cd], 5, 4)
				AND SKD_DIR_CD = SUBSTR(@[pre_post_vsl_cd], 9, 1)
				UNION
				SELECT BKG_NO, VSL_CD||SKD_VOY_NO||SKD_DIR_CD PRE_1_VVD
				FROM BKG_VVD
				WHERE VSL_PRE_PST_CD ='S'
				AND VSL_SEQ ='3'
				AND VSL_CD     = SUBSTR(@[pre_post_vsl_cd], 1, 4)
				AND SKD_VOY_NO = SUBSTR(@[pre_post_vsl_cd], 5, 4)
				AND SKD_DIR_CD = SUBSTR(@[pre_post_vsl_cd], 9, 1)
				UNION
				SELECT BKG_NO, VSL_CD||SKD_VOY_NO||SKD_DIR_CD PRE_1_VVD
				FROM BKG_VVD
				WHERE VSL_PRE_PST_CD ='S'
				AND VSL_SEQ ='4'
				AND VSL_CD     = SUBSTR(@[pre_post_vsl_cd], 1, 4)
				AND SKD_VOY_NO = SUBSTR(@[pre_post_vsl_cd], 5, 4)
				AND SKD_DIR_CD = SUBSTR(@[pre_post_vsl_cd], 9, 1)
				UNION 
				SELECT BKG_NO, VSL_CD||SKD_VOY_NO||SKD_DIR_CD PRE_1_VVD
				FROM BKG_VVD
				WHERE VSL_PRE_PST_CD ='U'
				AND VSL_SEQ ='1'
				AND VSL_CD     = SUBSTR(@[pre_post_vsl_cd], 1, 4)
				AND SKD_VOY_NO = SUBSTR(@[pre_post_vsl_cd], 5, 4)
				AND SKD_DIR_CD = SUBSTR(@[pre_post_vsl_cd], 9, 1)
				UNION
				SELECT BKG_NO, VSL_CD||SKD_VOY_NO||SKD_DIR_CD PRE_1_VVD
				FROM BKG_VVD
				WHERE VSL_PRE_PST_CD ='U'
				AND VSL_SEQ ='2'
				AND VSL_CD     = SUBSTR(@[pre_post_vsl_cd], 1, 4)
				AND SKD_VOY_NO = SUBSTR(@[pre_post_vsl_cd], 5, 4)
				AND SKD_DIR_CD = SUBSTR(@[pre_post_vsl_cd], 9, 1)
				UNION
				SELECT BKG_NO, VSL_CD||SKD_VOY_NO||SKD_DIR_CD PRE_1_VVD
				FROM BKG_VVD
				WHERE VSL_PRE_PST_CD ='U'
				AND VSL_SEQ ='3'
				AND VSL_CD     = SUBSTR(@[pre_post_vsl_cd], 1, 4)
				AND SKD_VOY_NO = SUBSTR(@[pre_post_vsl_cd], 5, 4)
				AND SKD_DIR_CD = SUBSTR(@[pre_post_vsl_cd], 9, 1)
				UNION
				SELECT BKG_NO, VSL_CD||SKD_VOY_NO||SKD_DIR_CD PRE_1_VVD
				FROM BKG_VVD
				WHERE VSL_PRE_PST_CD ='U'
				AND VSL_SEQ ='4'
				AND VSL_CD     = SUBSTR(@[pre_post_vsl_cd], 1, 4)
				AND SKD_VOY_NO = SUBSTR(@[pre_post_vsl_cd], 5, 4)
				AND SKD_DIR_CD = SUBSTR(@[pre_post_vsl_cd], 9, 1)
			 ) PR_PO_VB
		#end
            WHERE STO.BKG_NO = BKG.BKG_NO
            
		#if (${pre_post_vsl_cd} != '' )
            AND BKG.BKG_NO= PR_PO_VB.BKG_NO
		#end            
		#if (${bkg_no} != '') 
            AND BKG.BKG_NO= @[bkg_no] 
		#end
		#if (${bl_no} != '') 
            AND BKG.bl_no = @[bl_no] 
		#end
		#if (${vsl_cd} != '') 
           AND BKG.VSL_CD     = SUBSTR(@[vsl_cd], 1, 4)
           AND BKG.SKD_VOY_NO = SUBSTR(@[vsl_cd], 5, 4)
           AND BKG.SKD_DIR_CD = SUBSTR(@[vsl_cd], 9, 1)
		#end
		#if (${ridr_tp_cd} != '') 
           AND STO.ridr_tp_cd =  @[ridr_tp_cd]
		#end            
		#if (${s_rgst_dt} != '000000') 
            AND STO.rgst_dt >= TO_DATE(@[s_rgst_dt], 'YYYYMMDDHH24MISS') 
		#end  
		#if (${e_rgst_dt} != '235959') 
			AND STO.rgst_dt <= TO_DATE(@[e_rgst_dt], 'YYYYMMDDHH24MISS')
		#end  
		#if (${pol_cd} != '')
			AND BKG.pol_cd = @[pol_cd] 
		#end
		#if (${pod_cd} != '')		
			AND BKG.pod_cd = @[pod_cd] 
		#end
		#if (${bkg_ofc_cd} != '') 
			AND BKG.bkg_ofc_cd = @[bkg_ofc_cd] 
		#end
		#if (${ob_sls_ofc_cd} != '') 
            AND BKG.ob_sls_ofc_cd = @[ob_sls_ofc_cd] 
		#end
		#if (${slan_cd} != '') 
            AND BKG.slan_cd = @[slan_cd] 
		#end
		#if (${rgst_ofc_cd} != '') 
            AND STO.rgst_ofc_cd = @[rgst_ofc_cd] 
		#end
		#if (${rgst_usr_id} != '') 
			AND UPPER(STO.rgst_usr_id) = UPPER(@[rgst_usr_id]) 
		#end
            ) BKG 
	#if (${ridr_tp_cd} == 'D') 
	--D/G Rider   
	    , BKG_DG_CGO SUB
	      WHERE 
		BKG.BKG_NO = SUB.BKG_NO(+) 
		AND BKG.DCGO_SEQ = SUB.DCGO_SEQ(+)
	#elseif (${ridr_tp_cd} == 'A') 
	--Awkward Rider  
	    , BKG_AWK_CGO  SUB
	      WHERE 
		BKG.BKG_NO = SUB.BKG_NO(+) 
		AND BKG.AWK_CGO_SEQ = SUB.AWK_CGO_SEQ(+)
	#else
	--Break Bulk Rider     B/L Rider    Certificate

	#end
) BKG, COM_USER USR
WHERE BKG.rgst_usr_id = USR.USR_ID(+)			]]></sql>
			<params>
				<param name="pre_post_vsl_cd" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="ridr_tp_cd" type="12" value="" out="N"/>
				<param name="s_rgst_dt" type="12" value="" out="N"/>
				<param name="e_rgst_dt" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="bkg_ofc_cd" type="12" value="" out="N"/>
				<param name="ob_sls_ofc_cd" type="12" value="" out="N"/>
				<param name="slan_cd" type="12" value="" out="N"/>
				<param name="rgst_ofc_cd" type="12" value="" out="N"/>
				<param name="rgst_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
