<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingUtilDBDAOSearchPoNoLengthByDtlRSQL">
			<desc><![CDATA[미주향 BOOKING이면서 특정 화주의 경우 PO가 반드시 입력되어야함]]></desc>
			<sql><![CDATA[
select 'Y' error
  from
        (select decode(nvl(case.flag, 'N'), 'N', 'N/A' --p/o no validation이 필요없는 case
                                    , 'Y' --p/o no validation이 필요한는 case
                    , decode(case.required_len, nvl(input_po.input_len, 0), 'Pass', 'Error')) result
                , required_len
                , input_len
          from (select distinct 'Y' flag --입력값이 po_length_validation에 해당하는 case인지 여부
                        , po_len.attr_ctnt5 required_len --입력되어야할 P/No의 길이
                  from bkg_hrd_cdg_ctnt po_len
                 where ((po_len.attr_ctnt2 = @[cust_cnt_cd]/*'CA'*/ and po_len.attr_ctnt3= @[cust_seq]/*'385'*/)
                        or po_len.attr_ctnt4 =@[sc_no]/*'GLO92004'*/)
                   and po_Len.HRD_CDG_ID = 'PO_LENGTH'
                   and rownum = 1 --입력되어야할 길기가 중복이 되어서는 안됨
               ) case
               , (select length(ref_no.CUST_REF_NO_CTNT) input_len --입력된 P/O No의 길이들
                  from bkg_reference ref_no
                 where ref_no.bkg_no = @[bkg_no]/*'AARZ1030006'*/
                   and ref_no.BKG_REF_TP_CD in ('BKPO', 'CTPO', 'CMPO') 
               ) input_po
        )       
 where result = 'Error' --error가 하나만 있으면
   and rownum = 1			]]></sql>
			<params>
				<param name="cust_cnt_cd" type="12" value="" out="N"/>
				<param name="cust_seq" type="12" value="" out="N"/>
				<param name="sc_no" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
