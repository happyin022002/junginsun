<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCQuotationMainDBDAORsltPriSqMnChkNeedCalcVORSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
-- GENERAL이나 SPECIAL RATE에 데이터가 존재 하는데 CALCULATE 를 실행 하지 않은 데이터가 있는지 검사한다.
-- 이런 데이터가 존재시 COPY TO PROPOSAL을 하지 못한다.

SELECT   QTTN_NO, QTTN_VER_NO ,SVC_SCP_CD, GEN_SPCL_RT_TP_CD 
FROM (
          SELECT   MN.QTTN_NO,MN.QTTN_VER_NO ,MN.SVC_SCP_CD, 'G' AS GEN_SPCL_RT_TP_CD 
          FROM     PRI_SQ_MN MN
          WHERE    MN.QTTN_NO = @[qttn_no]
      		  AND  MN.QTTN_VER_NO = @[qttn_ver_no]
			  AND  MN.PRS_GEN_RT_CMPB_CALC_FLG = 'N'
			  AND  EXISTS (SELECT   1
                           FROM     PRI_SQ_RT_CMDT_ROUT RT
                           WHERE    RT.QTTN_NO        = MN.QTTN_NO
                                AND RT.QTTN_VER_NO       = MN.QTTN_VER_NO 
                                AND GEN_SPCL_RT_TP_CD = 'G'
                                AND ROWNUM = 1
              )
          UNION ALL
          SELECT   MN.QTTN_NO,MN.QTTN_VER_NO ,MN.SVC_SCP_CD, 'S' AS GEN_SPCL_RT_TP_CD 
          FROM     PRI_SQ_MN MN
          WHERE    MN.QTTN_NO = @[qttn_no]
      		  AND  MN.QTTN_VER_NO = @[qttn_ver_no]
			  AND  MN.PRS_SPCL_RT_CMPB_CALC_FLG = 'N'
			  AND  EXISTS (SELECT   1
                           FROM     PRI_SQ_RT_CMDT_ROUT RT
                           WHERE    RT.QTTN_NO        = MN.QTTN_NO
                                AND RT.QTTN_VER_NO       = MN.QTTN_VER_NO 
                                AND MN.SVC_SCP_CD     = SVC_SCP_CD
                                AND GEN_SPCL_RT_TP_CD = 'S'
                                AND ROWNUM = 1
              )
)
ORDER BY SVC_SCP_CD, GEN_SPCL_RT_TP_CD
			]]></sql>
			<params>
				<param name="qttn_no" type="12" value="" out="N"/>
				<param name="qttn_ver_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
