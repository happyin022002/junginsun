<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ScqBreakbulkDBDAOsearchPriScqBbRoutCostRSQL">
			<desc><![CDATA[searchPriScqBbRoutCost]]></desc>
			<sql><![CDATA[
SELECT TES.BB_CGO_TP_SEQ
     , TES.BB_CGO_DESC
     , NVL( LOCL_CURR_CD, 'USD' ) AS LOCL_CURR_CD
     , LOCL_CURR_AMT
     , COST_AMT
     , SCQ_RQST_NO
     , SCQ_VER_NO
     , ROUT_SEQ
     , ROUT_SEQ_VER_NO
     , ROUT_TP_CD
     , ROUT_RMK
     , CFM_FLG
     , ROUT_COST_SEQ
     , UPD_USR_ID
     , DECODE ( NVL ( LOCL_CURR_CD, 'USD' ), 'USD', 1, 
		( SELECT USD_LOCL_XCH_RT 
  		 FROM 	GL_MON_XCH_RT R
 		 WHERE  R.ACCT_XCH_RT_YRMON = ( SELECT MAX(ACCT_XCH_RT_YRMON)
                                     FROM GL_MON_XCH_RT T
                                     WHERE T.ACCT_XCH_RT_LVL = '1'
                                       AND T.CURR_CD = R.CURR_CD )
         AND R.ACCT_XCH_RT_LVL = '1'
         AND R.CURR_CD = LOCL_CURR_CD ) ) AS EX_RATE 
  FROM (SELECT ROUT.SCQ_RQST_NO
             , ROUT.SCQ_VER_NO
             , ROUT.ROUT_SEQ
             , ROUT.ROUT_SEQ_VER_NO
             , ROUT.ROUT_TP_CD
             , ROUT.ROUT_RMK
             , ROUT.CFM_FLG
             , RC.ROUT_COST_SEQ
             , RC.BB_CGO_TP_SEQ
             , NVL ( NVL( ROUT.LOCL_CURR_CD,
					( 	SELECT 	C.LOCL_CURR_CD 
						FROM 	PRI_SCQ_BB_ROUT_COST  C
						WHERE 	C.SCQ_RQST_NO = ROUT.SCQ_RQST_NO 
						AND 	C.SCQ_VER_NO  = ROUT.SCQ_VER_NO
        	            AND     C.ROUT_SEQ    = ROUT.ROUT_SEQ
            	        AND     C.ROUT_SEQ_VER_NO = ROUT.ROUT_SEQ_VER_NO
                	    AND     C.LOCL_CURR_CD IS NOT NULL 
                    	AND     ROWNUM = 1 ) ), 'USD' ) AS LOCL_CURR_CD
             , RC.LOCL_CURR_AMT
             , RC.COST_AMT
             , ROUT.UPD_USR_ID
          FROM PRI_SCQ_BB_ROUT ROUT
             , PRI_SCQ_BB_ROUT_COST RC 
         WHERE ROUT.SCQ_RQST_NO = RC.SCQ_RQST_NO
           AND ROUT.SCQ_VER_NO = RC.SCQ_VER_NO  
           AND ROUT.ROUT_SEQ = RC.ROUT_SEQ
           AND ROUT.ROUT_SEQ_VER_NO = RC.ROUT_SEQ_VER_NO 
           AND ROUT.ROUT_SEQ_VER_NO = (SELECT MAX(ROUT_SEQ_VER_NO)
                                         FROM PRI_SCQ_BB_ROUT ROUT
                                        WHERE ROUT.SCQ_RQST_NO = @[scq_rqst_no] --SEL201303190001
                                          AND ROUT.SCQ_VER_NO  = @[scq_ver_no]  --000 
                                          AND ROUT.ROUT_SEQ    = @[rout_seq] )  --1 
           AND ROUT.SCQ_RQST_NO = @[scq_rqst_no]
           AND ROUT.SCQ_VER_NO  = @[scq_ver_no]
           AND ROUT.ROUT_SEQ    = @[rout_seq]
       ) PRI
     , (SELECT BB_CGO_TP_SEQ
             , BB_CGO_DESC 
          FROM TES_BB_SO_COST 
         WHERE DELT_FLG <> 'Y'
       ) TES
 WHERE TES.BB_CGO_TP_SEQ = PRI.BB_CGO_TP_SEQ(+)
 ORDER BY TES.BB_CGO_TP_SEQ			]]></sql>
			<params>
				<param name="scq_rqst_no" type="12" value="" out="N"/>
				<param name="scq_ver_no" type="12" value="" out="N"/>
				<param name="rout_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
