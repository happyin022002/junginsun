<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="ManilaManifestListDownloadDBDAOsearchBlInfoRSQL">
			<desc><![CDATA[Manila 세관에 신고할 대상 B/L 정보를 조회한다.]]></desc>
			<sql><![CDATA[
SELECT  REG_NUMBER2,
        POD,
        YEAR,
		BL_NO,
        CARGO_TYPE,
        ETL_CARGO_TYPE,
        SHIPPER_NAME,
        SHIPPER_ADDRESS1,
        SHIPPER_ADDRESS2,
        SHIPPER_ADDRESS3,
        SHIPPER_ADDRESS4,
        CONSIGNEE_NAME,
        CONSIGNEE_ADDRESS1,
        CONSIGNEE_ADDRESS2,
        CONSIGNEE_ADDRESS3,
        CONSIGNEE_ADDRESS4,
        NOTIFY_NAME,
        NOTIFY_ADDRESS1,
        NOTIFY_ADDRESS2,
        NOTIFY_ADDRESS3,
        NOTIFY_ADDRESS4,
        WEIGHT,
        VOLUME,
        COUNTRY_ORIGIN,
        TOTAL_CNTR,
        ROWNUM AS SEQ
FROM (
		SELECT @[reg_no]  reg_number2,
			   '' pod,
		       TO_NUMBER(TO_CHAR(SYSDATE,'RR')) year,
		       'SMLM'||NVL(BKG.BL_NO,' ') bl_no,
		       NVL(TO_NUMBER(DECODE(NVL(BKG.BKG_CGO_TP_CD,'F'),'F','1','B','3',DECODE(NVL(BKG.RCV_TERM_CD,'Y'),'S','2','0'))),0) cargo_type,
		       NVL(TO_NUMBER(DECODE(NVL(BKG.BKG_CGO_TP_CD,'F'),'F','1','B','3',DECODE(NVL(BKG.RCV_TERM_CD,'Y'),'S','2','0'))),0) etl_cargo_type,
				BKG_SPCLCHAR_CONV_FNC(NVL(SUBSTR(REPLACE(SHP.CUST_NM,CHR(13)||CHR(10),'  '),1,40),' '),'J') shipper_name,
				BKG_SPCLCHAR_CONV_FNC(NVL(SUBSTR(REPLACE(SHP.CUST_ADDR,CHR(13)||CHR(10),'  '),1,40),' '),'J') shipper_address1,
				BKG_SPCLCHAR_CONV_FNC(NVL(SUBSTR(REPLACE(SHP.CUST_ADDR,CHR(13)||CHR(10),'  '),41,40),' '),'J') shipper_address2,
				BKG_SPCLCHAR_CONV_FNC(NVL(SUBSTR(REPLACE(SHP.CUST_ADDR,CHR(13)||CHR(10),'  '),81,40),' '),'J') shipper_address3,
				BKG_SPCLCHAR_CONV_FNC(NVL(SUBSTR(REPLACE(SHP.CUST_ADDR,CHR(13)||CHR(10),'  '),121,40),' '),'J') shipper_address4,
				BKG_SPCLCHAR_CONV_FNC(NVL(SUBSTR(REPLACE(CSN.CUST_NM,CHR(13)||CHR(10),'  '),1,40),' '),'J') consignee_name,
				BKG_SPCLCHAR_CONV_FNC(NVL(SUBSTR(REPLACE(CSN.CUST_ADDR,CHR(13)||CHR(10),'  '),1,40),' '),'J') consignee_address1,
				BKG_SPCLCHAR_CONV_FNC(NVL(SUBSTR(REPLACE(CSN.CUST_ADDR,CHR(13)||CHR(10),'  '),41,40),' '),'J') consignee_address2,
				BKG_SPCLCHAR_CONV_FNC(NVL(SUBSTR(REPLACE(CSN.CUST_ADDR,CHR(13)||CHR(10),'  '),81,40),' '),'J') consignee_address3,
				BKG_SPCLCHAR_CONV_FNC(NVL(SUBSTR(REPLACE(CSN.CUST_ADDR,CHR(13)||CHR(10),'  '),121,40),' '),'J') consignee_address4,
				BKG_SPCLCHAR_CONV_FNC(NVL(SUBSTR(REPLACE(NTF.CUST_NM,CHR(13)||CHR(10),'  '),1,40),' '),'J') notify_name,
				BKG_SPCLCHAR_CONV_FNC(NVL(SUBSTR(REPLACE(NTF.CUST_ADDR,CHR(13)||CHR(10),'  '),1,40),' '),'J') notify_address1,
				BKG_SPCLCHAR_CONV_FNC(NVL(SUBSTR(REPLACE(NTF.CUST_ADDR,CHR(13)||CHR(10),'  '),41,40),' '),'J') notify_address2,
				BKG_SPCLCHAR_CONV_FNC(NVL(SUBSTR(REPLACE(NTF.CUST_ADDR,CHR(13)||CHR(10),'  '),81,40),' '),'J') notify_address3,
				BKG_SPCLCHAR_CONV_FNC(NVL(SUBSTR(REPLACE(NTF.CUST_ADDR,CHR(13)||CHR(10),'  '),121,40),' '),'J') notify_address4,
		       NVL(DECODE(NVL(DOC.WGT_UT_CD,'KGS'),'KGS',NVL(DOC.ACT_WGT,0),'LBS',NVL(DOC.ACT_WGT,0)*0.45359),0) weight,
		       NVL(TO_CHAR(DECODE(NVL(DOC.MEAS_UT_CD,'CBM'),'CBM',NVL(DOC.MEAS_QTY,0),'CBF',NVL(DOC.MEAS_QTY,0)*0.02831)),' ') volume,
		       SUBSTR(NVL(BKG.POR_CD,' '),1,2) country_origin,
		       (SELECT COUNT(CNTR_NO)
	              FROM BKG_CONTAINER
	             WHERE BKG_CONTAINER.BKG_NO = NVL(BKG.BKG_NO,' ')
	           ) total_cntr
		 FROM BKG_CUSTOMER SHP,
		      BKG_CUSTOMER CSN,
		      BKG_CUSTOMER NTF,
		      BKG_BOOKING BKG,
		      BKG_VVD BV,
		      BKG_BL_DOC DOC
		 WHERE SHP.BKG_NO(+)       = BKG.BKG_NO AND
		       SHP.BKG_CUST_TP_CD          = 'S' AND
		       CSN.BKG_NO(+)       = BKG.BKG_NO AND
		       CSN.BKG_CUST_TP_CD          = 'C' AND
		       NTF.BKG_NO(+)       = BKG.BKG_NO AND
		       NTF.BKG_CUST_TP_CD          = 'N' AND
		       BKG.BKG_NO          = BV.BKG_NO AND
		       BKG.BKG_NO          = DOC.BKG_NO AND
		       BV.VSL_CD           = @[vsl_cd] AND
		       BV.SKD_VOY_NO    = @[skd_voy_no] AND
		       BV.SKD_DIR_CD       = @[skd_dir_cd] AND
			   #if (${pol_cd}!= '') 
		       BV.POL_CD          LIKE @[pol_cd] AND
			   #end
			   #if (${pod_cd}!= '') 
		       BV.POD_CD          LIKE @[pod_cd] AND
			   #end
		       BKG.BKG_STS_CD     IN ('F','W') AND
		       BKG.BL_NO > ' '
)			]]></sql>
			<params>
				<param name="reg_no" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
