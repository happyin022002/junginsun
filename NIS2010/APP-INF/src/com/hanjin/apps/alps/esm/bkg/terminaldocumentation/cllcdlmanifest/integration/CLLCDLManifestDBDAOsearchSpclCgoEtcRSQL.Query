<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CLLCDLManifestDBDAOsearchSpclCgoEtcRSQL">
			<desc><![CDATA[searchSpclCgoEtc]]></desc>
			<sql><![CDATA[
SELECT *
FROM (

#if (${in_pgm_no} == 'ESM_BKG_0951') 
/**************************** ESM_BKG_0951에서 조회된 경우  *****************************/
SELECT E_CGO_TYPE,
  E_POD,
  E_MLB,
  E_CNTR_NO,
  E_TP,
  E_DETAIL
FROM (
    SELECT E_CGO_TYPE,
      E_POD,
      E_MLB,
      E_CNTR_NO,
      E_TP,
      E_DETAIL
    FROM (
        SELECT '<STOW>' E_CGO_TYPE,
          BV.POD_CD E_POD,
          DECODE(NVL(BV.POD_CD,' '), 'USSEA', DECODE(BV.SLAN_CD,'PSX',DECODE(DECODE(SUBSTR(NVL(BKG.BLCK_STWG_CD,'LOC'), 3, 1),'1','ONE','2','TWO','3','THR','4','FOR','5','FIV','T','TRS', 'LOC'),'ONE','SE1','SEA'),DECODE(SUBSTR(NVL(BKG.BLCK_STWG_CD,'LOC'), 3, 1),'1','ONE','2','TWO','3','THR','4','FOR','5','FIV','T','TRS', 'LOC')), 
        							'USOAK', DECODE(BKG.BLCK_STWG_CD, 'OA1', 'OA1' , '', '', 'OAK'), 
        							'USLGB', DECODE(SUBSTR(NVL(BKG.BLCK_STWG_CD,'LOC'), 3, 1),'1','ONE','2','TWO','3','THR','4','FOR','5','FIV','7','SEV','T','TRS', 'LOC'), 
        							'CAVAN', DECODE(SUBSTR(NVL(BKG.BLCK_STWG_CD,'LOC'), 3, 1),'1','ONE','2','TWO','3','THR','4','FOR','5','FIV','T','TRS', 'LOC'),'') E_MLB,
          BC.CNTR_NO E_CNTR_NO,
          BC.CNTR_TPSZ_CD E_TP,
          BKG.STWG_CD E_DETAIL
        FROM BKG_BOOKING BKG
           , BKG_VVD BV
           , BKG_CONTAINER BC
        WHERE BKG.BKG_NO = BV.BKG_NO
          AND BKG.BKG_NO = BC.BKG_NO

		  AND BV.VSL_CD     = SUBSTR(@[in_vvd_cd], 1, 4)
		  AND BV.SKD_VOY_NO = SUBSTR(@[in_vvd_cd], 5, 4)
		  AND BV.SKD_DIR_CD = SUBSTR(@[in_vvd_cd], 9, 1)
		  AND BV.POL_CD     = @[in_pol_cd]
		  AND SUBSTR(BV.POL_YD_CD, 6, 2) like @[in_pol_yd_cd]||'%'
#if (${in_by_type} != 'ALL' )
		  AND DECODE(BV.POL_CD,BKG.POL_CD,'LOCAL','TS') = @[in_by_type]
#end
          AND BC.CNTR_TPSZ_CD <> 'D7'
          AND BC.CNTR_TPSZ_CD NOT LIKE 'A%'
          AND BKG.STWG_CD IS NOT NULL
          AND BKG.STWG_CD <> 'INGU'   )
    UNION ALL (
        SELECT '<PC>' E_CGO_TYPE,
          BV.POD_CD E_POD,
          BKG.BLCK_STWG_CD E_MLB,
          BC.CNTR_NO E_CNTR_NO,
          BC.CNTR_TPSZ_CD E_TP,
          '' E_DETAIL
        FROM BKG_BOOKING BKG
           , BKG_VVD BV
           , BKG_CONTAINER BC
           , MDM_COMMODITY CM
        WHERE BKG.BKG_NO = BV.BKG_NO
          AND BKG.BKG_NO = BC.BKG_NO
          AND BKG.CMDT_CD = CM.CMDT_CD

		  AND BV.VSL_CD     = SUBSTR(@[in_vvd_cd], 1, 4)
		  AND BV.SKD_VOY_NO = SUBSTR(@[in_vvd_cd], 5, 4)
		  AND BV.SKD_DIR_CD = SUBSTR(@[in_vvd_cd], 9, 1)
		  AND BV.POL_CD     = @[in_pol_cd]
		  AND SUBSTR(BV.POL_YD_CD, 6, 2) like @[in_pol_yd_cd]||'%'
#if (${in_by_type} != 'ALL' )
		  AND DECODE(BV.POL_CD,BKG.POL_CD,'LOCAL','TS') = @[in_by_type]
#end
		  AND (	BKG.PRCT_FLG ='Y'
        		or 
        		bkg.STWG_CD is null and CM.REP_IMDG_LVL_CD = 'P')
			)        	
         -- AND CM.REP_IMDG_LVL_CD = 'P'   )
    UNION ALL (
        SELECT '<TANK>' E_CGO_TYPE,
          BV.POD_CD E_POD,
          BKG.BLCK_STWG_CD E_MLB,
          BC.CNTR_NO E_CNTR_NO,
          BC.CNTR_TPSZ_CD E_TP,
          '' E_DETAIL
        FROM BKG_BOOKING BKG
           , BKG_VVD BV
           , BKG_CONTAINER BC
        WHERE BKG.BKG_NO = BV.BKG_NO
          AND BKG.BKG_NO = BC.BKG_NO

		  AND BV.VSL_CD     = SUBSTR(@[in_vvd_cd], 1, 4)
		  AND BV.SKD_VOY_NO = SUBSTR(@[in_vvd_cd], 5, 4)
		  AND BV.SKD_DIR_CD = SUBSTR(@[in_vvd_cd], 9, 1)
		  AND BV.POL_CD     = @[in_pol_cd]
		  AND SUBSTR(BV.POL_YD_CD, 6, 2) like @[in_pol_yd_cd]||'%'
#if (${in_by_type} != 'ALL' )
		  AND DECODE(BV.POL_CD,BKG.POL_CD,'LOCAL','TS') = @[in_by_type]
#end
          AND BC.CNTR_TPSZ_CD in('T2', 'T4')            
          AND BC.CNTR_NO NOT IN(
            SELECT CNTR_NO
            FROM BKG_DG_CGO DG
            WHERE BC.BKG_NO = DG.BKG_NO
              AND BC.CNTR_NO = DG.CNTR_NO) ) ) 
ORDER BY E_CGO_TYPE, E_POD, DECODE(E_MLB, 'LOC', '11', 'ONE', '12', 'TWO', '13', 'THR', '14', 'FOR', '15', 'FIV', '15.5', 'SEV', '15.7', 'HOT', '16', 'TRS', '17', '18')

#else 
/***************************** 기본 조회 *****************************/

SELECT E_CGO_TYPE,
  E_POD,
  E_BKG_BS,
  E_MLB,
  E_CNTR_NO,
  E_TP,
  E_DETAIL
FROM (
    SELECT E_CGO_TYPE,
      E_POD,
      E_BKG_BS,
      E_MLB,
      E_CNTR_NO,
      E_TP,
      E_DETAIL
    FROM (
        SELECT '<STOW>' E_CGO_TYPE,
          CLL.POD_CD E_POD,
          BKG.BLCK_STWG_CD AS E_BKG_BS,
          CLL.BLCK_STWG_CD E_MLB,
          CLL.CNTR_NO E_CNTR_NO,
          CLL.CNTR_TPSZ_CD E_TP,
          CLL.STWG_CD E_DETAIL
        FROM BKG_CSTMS_TML_KR_CLL CLL, BKG_BOOKING BKG
        WHERE BKG.BKG_NO = CLL.BKG_NO
          AND CLL.POL_CD = @[in_pol_cd]
          AND CLL.POL_YD_CD like @[in_pol_yd_cd]||'%'
          AND CLL.VSL_CD = SUBSTR(@[in_vvd_cd], 1, 4)
          AND CLL.SKD_VOY_NO = SUBSTR(@[in_vvd_cd], 5, 4)
          AND CLL.SKD_DIR_CD = SUBSTR(@[in_vvd_cd], 9, 1)
          AND CLL.POD_CD IS NOT NULL
          AND CLL.CNTR_TPSZ_CD <> 'D7'
          AND CLL.CNTR_TPSZ_CD NOT LIKE 'A%'
          AND CLL.STWG_CD IS NOT NULL
          AND CLL.STWG_CD <> 'INGU' #if (${in_by_type} == 'TS' )
          AND CLL.KR_CLL_TS_CD IN ('TS', 'TT') #end #if (${in_by_type} == 'LOCAL' )
          AND CLL.KR_CLL_TS_CD IS NULL #end )
    UNION ALL (
        SELECT '<R/D>' E_CGO_TYPE,
          CLL.POD_CD E_POD,
          (SELECT BKG.BLCK_STWG_CD
			 FROM BKG_BOOKING BKG
		    WHERE BKG.BKG_NO = CLL.BKG_NO
			  AND ROWNUM=1) AS E_BKG_BS,
		  CLL.BLCK_STWG_CD E_MLB,
          CLL.CNTR_NO E_CNTR_NO,
          CLL.CNTR_TPSZ_CD E_TP,
          '' E_DETAIL
        FROM BKG_CSTMS_TML_KR_CLL CLL
        WHERE CLL.POL_CD = @[in_pol_cd]
          AND CLL.POL_YD_CD like @[in_pol_yd_cd]||'%'
          AND CLL.VSL_CD = SUBSTR(@[in_vvd_cd], 1, 4)
          AND CLL.SKD_VOY_NO = SUBSTR(@[in_vvd_cd], 5, 4)
          AND CLL.SKD_DIR_CD = SUBSTR(@[in_vvd_cd], 9, 1)
          AND CLL.CLL_RMK1 LIKE '%RD%'
          AND CLL.POD_CD IS NOT NULL
          AND CLL.CNTR_TPSZ_CD <> 'D7' #if (${in_by_type} == 'TS' )
          AND CLL.KR_CLL_TS_CD IN ('TS', 'TT') #end #if (${in_by_type} == 'LOCAL' )
          AND CLL.KR_CLL_TS_CD IS NULL #end )
    UNION ALL (
        SELECT '<PC>' E_CGO_TYPE,
          CLL.POD_CD E_POD,
		 (SELECT BKG.BLCK_STWG_CD
			FROM BKG_BOOKING BKG
		   WHERE BKG.BKG_NO = CLL.BKG_NO
		     AND ROWNUM=1) AS E_BKG_BS,
          CLL.BLCK_STWG_CD E_MLB,
          CLL.CNTR_NO E_CNTR_NO,
          CLL.CNTR_TPSZ_CD E_TP,
          '' E_DETAIL
        FROM BKG_CSTMS_TML_KR_CLL CLL
        WHERE CLL.POL_CD = @[in_pol_cd]
          AND CLL.POL_YD_CD like @[in_pol_yd_cd]||'%'
          AND CLL.VSL_CD = SUBSTR(@[in_vvd_cd], 1, 4)
          AND CLL.SKD_VOY_NO = SUBSTR(@[in_vvd_cd], 5, 4)
          AND CLL.SKD_DIR_CD = SUBSTR(@[in_vvd_cd], 9, 1)
          --AND CLL.STWG_CD = 'PC'
		  AND (	CLL.STWG_CD = 'PC'
        		or 
        		CLL.STWG_CD is null and CLL.KR_TML_PRCT_ID = 'P' )		  
          AND CLL.POD_CD IS NOT NULL #if (${in_by_type} == 'TS' )
          AND CLL.KR_CLL_TS_CD IN ('TS',
              'TT') #end #if (${in_by_type} == 'LOCAL' )
          AND CLL.KR_CLL_TS_CD IS NULL #end )
    UNION ALL (
        SELECT '<TANK>' E_CGO_TYPE,
          CLL.POD_CD E_POD,
		 (SELECT BKG.BLCK_STWG_CD
            FROM BKG_BOOKING BKG
           WHERE BKG.BKG_NO = CLL.BKG_NO
             AND ROWNUM=1) AS E_BKG_BS,
          CLL.BLCK_STWG_CD E_MLB,
          CLL.CNTR_NO E_CNTR_NO,
          CLL.CNTR_TPSZ_CD E_TP,
          '' E_DETAIL
        FROM BKG_CSTMS_TML_KR_CLL CLL
        WHERE CLL.POL_CD = @[in_pol_cd]
          AND CLL.POL_YD_CD like @[in_pol_yd_cd]||'%'
          AND CLL.VSL_CD = SUBSTR(@[in_vvd_cd], 1, 4)
          AND CLL.SKD_VOY_NO = SUBSTR(@[in_vvd_cd], 5, 4)
          AND CLL.SKD_DIR_CD = SUBSTR(@[in_vvd_cd], 9, 1)
          AND CLL.POD_CD IS NOT NULL
          AND CLL.CNTR_TPSZ_CD in('T2', 'T4') #if (${in_by_type} == 'TS' )
          AND CLL.KR_CLL_TS_CD IN ('TS', 'TT') #end #if (${in_by_type} == 'LOCAL' )
          AND CLL.KR_CLL_TS_CD IS NULL #end
          AND CLL.CNTR_NO NOT IN(
            SELECT CNTR_NO
            FROM BKG_DG_CGO DG
            WHERE CLL.BKG_NO = DG.BKG_NO
              AND CLL.CNTR_NO = DG.CNTR_NO) ) ) #if (${in_sort_type} == '4' )
ORDER BY E_CGO_TYPE, DECODE(E_MLB, 'LOC', '11', 'ONE', '12', 'TWO', '13', 'THR', '14', 'FOR', '15', 'FIV', '15.5', 'SEV', '15.7', 'HOT', '16', 'TRS', '17', '18') #else
ORDER BY E_CGO_TYPE, E_POD, E_BKG_BS, DECODE(E_MLB, 'LOC', '11', 'ONE', '12', 'TWO', '13', 'THR', '14', 'FOR', '15', 'FIV', '15.5', 'SEV', '15.7','HOT', '16', 'TRS', '17', '18') #end

#end
)			]]></sql>
			<params>
				<param name="in_vvd_cd" type="12" value="" out="N"/>
				<param name="in_pol_cd" type="12" value="" out="N"/>
				<param name="in_pol_yd_cd" type="12" value="" out="N"/>
				<param name="in_by_type" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
