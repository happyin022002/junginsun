<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AncsManifestListDownloadDBDAOsearchAncsCstmsMfListRSQL">
			<desc><![CDATA[S]]></desc>
			<sql><![CDATA[
SELECT 
A.POL_CD AS POL,
C.VPS_ETD_DT AS POL_ATD, 
A.POD_CD AS POD,
DECODE(D.TRNK_AUTO_BDR_DT, NULL, DECODE(D.TRNK_MNL_BDR_DT, NULL, 'N', 'Y'), 'Y') AS BDR,
DECODE(D.TRNK_AUTO_BDR_DT, NULL, DECODE(D.TRNK_MNL_BDR_DT, NULL, NULL, TO_CHAR(D.TRNK_MNL_BDR_DT,'YYYY-MM-DD HH24:MI')), TO_CHAR(D.TRNK_AUTO_BDR_DT,'YYYY-MM-DD HH24:MI')) AS BDR_DATE,
COUNT(DISTINCT B.BKG_NO) AS BL,
COUNT(DISTINCT E.BKG_NO) AS DNLD,
COUNT(DISTINCT DECODE(E.ANR_MSG_STS_CD, 'A', E.BKG_NO, NULL)) AS ACPT,
COUNT(DISTINCT B.BKG_NO) - COUNT(DISTINCT E.BKG_NO) AS DIFF,
COUNT(DISTINCT H.CNTR_NO) AS CNTR,
COUNT(DISTINCT I.CNTR_NO) AS CNTR_DNLD,
COUNT(DISTINCT DECODE(I.ANR_MSG_STS_CD, 'A', I.CNTR_NO, NULL)) AS CNTR_ACPT,
(COUNT(DISTINCT H.CNTR_NO) - COUNT(DISTINCT I.CNTR_NO)) AS CNTR_DIFF
FROM BKG_VVD A, BKG_BOOKING B, VSK_VSL_PORT_SKD C, 
     BKG_VVD_BDR_LOG D, BKG_CSTMS_ANR_BL E, BKG_CSTMS_ANR_VVD F,
     BKG_CSTMS_ANR_CNTR G, BKG_CONTAINER H, BKG_CSTMS_ANR_CNTR I
 WHERE A.VSL_CD       =  SUBSTR( @[vvd],1,4 )
   AND A.SKD_VOY_NO   =  SUBSTR( @[vvd],5,4 )
   AND A.SKD_DIR_CD   =  SUBSTR( @[vvd],9,1 )
   AND A.POD_CD = @[pod]
AND B.BKG_NO       = A.BKG_NO
AND B.BKG_STS_CD   <> 'X'
AND B.BKG_CGO_TP_CD IN ('F', 'B')
AND C.VSL_CD       = A.VSL_CD
AND C.SKD_VOY_NO   = A.SKD_VOY_NO
AND C.SKD_DIR_CD   = A.SKD_DIR_CD
AND C.VPS_PORT_CD  = A.POL_CD

AND C.CLPT_IND_SEQ = A.POL_CLPT_IND_SEQ

AND D.VSL_CD(+)       = A.VSL_CD
AND D.SKD_VOY_NO(+)   = A.SKD_VOY_NO
AND D.SKD_DIR_CD(+)   = A.SKD_DIR_CD
AND D.POL_CLPT_IND_SEQ(+) = A.POL_CLPT_IND_SEQ
AND D.POD_CLPT_IND_SEQ(+) = A.POD_CLPT_IND_SEQ
AND D.POL_CD(+)  = A.POL_CD
AND D.POD_CD(+)  = A.POD_CD
AND E.VSL_CD(+)       = A.VSL_CD
AND E.SKD_VOY_NO(+)   = A.SKD_VOY_NO
AND E.SKD_DIR_CD(+)   = A.SKD_DIR_CD
AND E.BKG_NO(+)       = A.BKG_NO
AND F.VSL_CD   = A.VSL_CD
AND F.SKD_VOY_NO = A.SKD_VOY_NO
AND F.SKD_DIR_CD = A.SKD_DIR_CD
AND G.VSL_CD(+)     = E.VSL_CD
AND G.SKD_VOY_NO(+) = E.SKD_VOY_NO
AND G.SKD_DIR_CD(+) = E.SKD_DIR_CD
AND G.BKG_NO(+)     = E.BKG_NO
AND H.BKG_NO(+)          = B.BKG_NO
AND I.VSL_CD(+)       = E.VSL_CD
AND I.SKD_VOY_NO(+)   = E.SKD_VOY_NO
AND I.SKD_DIR_CD(+)   = E.SKD_DIR_CD
AND I.BKG_NO(+)       = E.BKG_NO
GROUP BY A.POL_CD, C.VPS_ETD_DT, A.POD_CD,
DECODE(D.TRNK_AUTO_BDR_DT, NULL, DECODE(D.TRNK_MNL_BDR_DT, NULL, 'N', 'Y'), 'Y'),
DECODE(D.TRNK_AUTO_BDR_DT, NULL, DECODE(D.TRNK_MNL_BDR_DT, NULL, NULL, TO_CHAR(D.TRNK_MNL_BDR_DT,'YYYY-MM-DD HH24:MI')), TO_CHAR(D.TRNK_AUTO_BDR_DT,'YYYY-MM-DD HH24:MI'))			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="pod" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
