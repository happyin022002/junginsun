<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="FACCommCalculationDBDAOSearchCalcFACCommBAInfoRSQL">
			<desc><![CDATA[FACCommCalculationDBDAOSearchCalcFACCommBAInfoRSQL]]></desc>
			<sql><![CDATA[
SELECT ROUND (NVL (SUM (DECODE (NVL (DECODE (A.CURR_CD, 'USD', 1, B.USD_LOCL_XCH_RT), 0), 
                    0, 0, 
                      A.CHG_AMT 
                    / (DECODE (A.CURR_CD, 
                               'USD', 1, 
                               NVL (B.USD_LOCL_XCH_RT, 0) 
                              ) 
                      ) 
                   )), 0), 2) FAC_CALC_AMT, 
 ROUND (NVL (SUM (DECODE (NVL (DECODE (A.CURR_CD, 'USD', 1, B.USD_LOCL_XCH_RT), 0), 
                    0, 0, 
                      A.CHG_AMT 
                    / (DECODE (A.CURR_CD, 
                               'USD', 1, 
                               NVL (B.USD_LOCL_XCH_RT, 0) 
                              ) 
                      ) 
                   )), 0) *(@[fac_bkg_rt] / 100), 2) ACT_COMM_AMT 
  FROM BKG_CHG_RT A, GL_MON_XCH_RT B 
 WHERE A.BKG_NO = @[bkg_no]  
   AND A.FRT_INCL_XCLD_DIV_CD = 'N' 
#if (${grs_net_div_cd} == 'Y') 
   AND chg_cd = 'OFT'
#end
   AND A.CURR_CD = B.CURR_CD 
   AND B.ACCT_XCH_RT_YRMON = 
          (CASE 
              WHEN SUBSTR(@[vps_etd_dt],1,6) > TO_CHAR (SYSDATE, 'YYYYMM') 
                 THEN TO_CHAR (ADD_MONTHS (SYSDATE, -1), 'YYYYMM') 
              ELSE SUBSTR(@[vps_etd_dt],1,6) 
           END 
          )   -- 출항월이 현재월보다 크면 현재월로 아니면 출항일로				
   AND B.ACCT_XCH_RT_LVL = '1'			]]></sql>
			<params>
				<param name="fac_bkg_rt" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="vps_etd_dt" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
