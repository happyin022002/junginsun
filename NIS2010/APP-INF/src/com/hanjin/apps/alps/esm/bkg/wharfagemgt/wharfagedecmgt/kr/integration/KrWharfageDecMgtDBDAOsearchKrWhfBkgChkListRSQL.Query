<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="KrWharfageDecMgtDBDAOsearchKrWhfBkgChkListRSQL">
			<desc><![CDATA[a]]></desc>
			<sql><![CDATA[
SELECT  BL_NO , DIFF, CSTMS_DECL_TP_CD
FROM
(
  SELECT  DISTINCT DECODE(A.BL_NO, NULL, B.BL_NO, A.BL_NO) BL_NO,  
         DECODE(A.BL_NO,NULL,'B',DECODE(B.BL_NO,NULL,'W','M')) DIFF,
		 NVL(A.BND_CD,B.BND_CD) AS CSTMS_DECL_TP_CD
  FROM 
  (
    SELECT  BL_NO, 'W' diff, BKW.WHF_BND_CD AS BND_CD
    FROM BKG_KR_WHF_BL BKW
	WHERE BKW.VSL_CD = SUBSTR(@[vvd],1,4)
	AND BKW.SKD_VOY_NO = SUBSTR(@[vvd],5,4)
	AND BKW.SKD_DIR_CD = SUBSTR(@[vvd],9,1)
	AND BKW.WHF_POL_CD = 'KRPUS'
	AND BKW.WHF_BND_CD IN (DECODE(@[whf_bnd_cd], 'IN', 'II','ON', 'OO', @[whf_bnd_cd]), DECODE(@[whf_bnd_cd], 'IN', 'IT','ON', 'OT', @[whf_bnd_cd]), DECODE(@[whf_bnd_cd], 'IN', 'IM','ON', 'OM', @[whf_bnd_cd]))
	AND BKW.WHF_BL_STS_CD <> 'D') A 

  FULL OUTER JOIN 
  ( 
	SELECT VB.BL_NO, 'B' diff, DECODE(VB.BKG_CGO_TP_CD,'P',SUBSTR(@[whf_bnd_cd], 1, 1)||'M',DECODE(VB.KEY_POL_CD,VB.POL_CD,SUBSTR(@[whf_bnd_cd], 1, 1)||'O',SUBSTR(@[whf_bnd_cd], 1, 1)||'T')) BND_CD
    FROM   BKG_CNTR_MANIFEST_V VB,
           BKG_BOOKING BKG
    WHERE  NVL(VB.BKG_STS_CD, 'Z') <> 'X'
    AND BKG.BKG_NO = VB.BKG_NO
    AND VB.KEY_VSL_CD = SUBSTR(@[vvd], 1, 4)
    AND VB.KEY_SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
    AND VB.KEY_SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
                  	              
#if (${whf_bnd_cd} == 'OO') 
        AND VB.KEY_POL_CD LIKE '%'||@[port_cd]||'%'
        AND VB.KEY_POL_CD = VB.POL_CD 
        AND VB.BKG_CGO_TP_CD <> 'P'
#elseif (${whf_bnd_cd} == 'OT') 
        AND VB.KEY_POL_CD LIKE '%'||@[port_cd]||'%' 
        AND VB.KEY_POL_CD  != VB.POL_CD
        AND VB.BKG_CGO_TP_CD <> 'P' 
#elseif (${whf_bnd_cd} == 'OM')
        AND VB.BKG_CGO_TP_CD = 'P' 
        AND VB.KEY_POL_CD LIKE '%'||@[port_cd]||'%' 
#elseif (${whf_bnd_cd} == 'ON')
		AND VB.KEY_POL_CD LIKE '%'||@[port_cd]||'%' 
#elseif (${whf_bnd_cd} == 'II')
		AND VB.KEY_POD_CD = VB.POD_CD 
        AND VB.BKG_CGO_TP_CD <> 'P' 
        AND VB.KEY_POD_CD LIKE '%'||@[port_cd]||'%' 
#elseif (${whf_bnd_cd} == 'IT')
		AND VB.KEY_POD_CD != VB.POD_CD 
        AND VB.BKG_CGO_TP_CD <> 'P' 
        AND VB.KEY_POD_CD LIKE '%'||@[port_cd]||'%' 
#elseif (${whf_bnd_cd} == 'IM')
        AND VB.BKG_CGO_TP_CD = 'P' 
        AND VB.KEY_POD_CD LIKE '%'||@[port_cd]||'%' 
#elseif (${whf_bnd_cd} == 'IN')
		AND VB.KEY_POD_CD LIKE '%'||@[port_cd]||'%' 
#end                 
        AND EXISTS (
                    SELECT 'Y'
                    FROM BKG_CUSTOMER Z
                    WHERE 1=1
                    AND Z.BKG_NO = VB.BKG_NO )) B

  ON ( A.Bl_NO = B.Bl_NO AND A.BND_CD = B.BND_CD)
 )
WHERE 1=1

#if (${diff} != 'A') 
AND DIFF = @[diff]
#else
AND DIFF in ('W', 'B')
#end
ORDER BY DIFF, CSTMS_DECL_TP_CD, BL_NO

			]]></sql>
			<params>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="whf_bnd_cd" type="12" value="" out="N"/>
				<param name="port_cd" type="12" value="" out="N"/>
				<param name="diff" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
