<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CLLCDLManifestDBDAOsearchCllDgByCntrUnRSQL">
			<desc><![CDATA[searchCllDgByCntrUn]]></desc>
			<sql><![CDATA[
SELECT	
	NVL(DG.IMDG_UN_NO,' ') IMDG_UN_NO,
	NVL(DG.IMDG_CLSS_CD,' ') IMDG_CLSS_CD,
	NVL(DG.PRP_SHP_NM,' ') PRP_SHP_NM,
	NVL(SUBSTRB(DG.EMER_CNTC_PHN_NO_CTNT,1,50),' ') EMER_CNTC_PHN_NO_CTNT,
	' ' IMDG_PG_NO,
	--'' IMDG_PG_NO,
	REPLACE(NVL(DG.DIFF_RMK,' '),chr(13)||chr(10),' ') DIFF_RMK,
	NVL(DG.EMS_NO,' ') EMS_NO,
	NVL(DG.IMDG_PCK_GRP_CD,' ') IMDG_PCK_GRP_CD,
	NVL(DG.MRN_POLUT_FLG,' ') MRN_POLUT_FLG,
	NVL(DG.IMDG_SUBS_RSK_LBL_CD1,' ')||NVL(DG.IMDG_SUBS_RSK_LBL_CD2,' ')||NVL(DG.IMDG_SUBS_RSK_LBL_CD3,' ') IMDG_SUBS_RSK_LBL_CD,
	NVL(DG.OUT_IMDG_PCK_QTY1,NULL) PCK_QTY,
	--'' PCK_QTY,
	NVL(DG.OUT_IMDG_PCK_CD1,' ') TML_PCK_UT_ID,
	--'' TML_PCK_UT_ID,
	NVL(DG.NET_WGT,NULL) NET_WGT,
	'KGS' NET_WGT_CD,
	DECODE(NVL(DG.WGT_UT_CD,' '),
			'LBS', ROUND(NVL(DG.GRS_WGT,0)*0.4536,3),
			NVL(DG.GRS_WGT,0)
	) GRS_WGT,
	'KGS' GRS_WGT_CD,
	DECODE(NVL(DG.MEAS_UT_CD,' '),
			'CBF', ROUND(NVL(DG.MEAS_QTY,0)*0.0283,3),
			NVL(DG.MEAS_QTY,0)
	) MEAS_QTY,
	'CBM' MEAS_QTY_CD,
	NVL(DG.HZD_DESC,' ') HZD_DESC,
	NVL(SUBSTRB(DG.SPCL_STWG_RQST_DESC,1,100),' ') SPCL_STWG_RQST_DESC,
	DG.DG_CNTR_SEQ
FROM	BKG_DG_CGO DG
WHERE	DG.BKG_NO	= @[bkg_no]
AND     NVL(DG.CNTR_NO,TO_CHAR(DG.DG_CNTR_SEQ))	= DECODE(NVL(DG.CNTR_NO,'Y'),'Y', (
                                                                        SELECT TO_CHAR(MIN(DG_CNTR_SEQ))
                                                                        FROM BKG_CSTMS_TML_CLL CLL, BKG_DG_CGO DG
                                                                        WHERE CLL.VSL_CD = SUBSTR(@[in_vvd_cd],1,4)
                                                                          AND CLL.SKD_VOY_NO = SUBSTR(@[in_vvd_cd],5,4)
                                                                          AND CLL.SKD_DIR_CD = SUBSTR(@[in_vvd_cd],9,1)
                                                                          AND CLL.PORT_CD = @[in_pol_cd]    -- Add. 2015.02.09. CHM-201533845
																		#if (${pol_split_no} != '')        
																		  AND NVL(CLL.CLPT_IND_SEQ,'1') = @[pol_split_no]   -- Add. 2015.02.09. CHM-201533845
																		#end
																		  AND CLL.BKG_NO = @[bkg_no]
																		  AND CLL.CNTR_NO = DECODE(SUBSTR(@[cntr_no],1,6),'T.B.N.',@[tbx_seq],@[cntr_no])
																		  AND CLL.CNTR_LODG_NO = NVL(@[tbn_seq],CLL.CNTR_LODG_NO)
                                                                          AND CLL.BKG_NO = DG.BKG_NO
                                                                          AND CLL.CNTR_TPSZ_CD = DG.CNTR_TPSZ_CD
                                                                          AND DG.CNTR_NO IS NULL
                                                                          AND DG.DG_CNTR_SEQ NOT IN ( SELECT NVL(DG_CNTR_SEQ,0) FROM BKG_CSTMS_TML_CLL_DG_CGO WHERE VSL_CD = SUBSTR(@[in_vvd_cd],1,4)
                                                                                                                                                  AND SKD_VOY_NO = SUBSTR(@[in_vvd_cd],5,4)
                                                                                                                                                  AND SKD_DIR_CD = SUBSTR(@[in_vvd_cd],9,1)
																																				  AND PORT_CD = @[in_pol_cd]    -- Add. 2015.02.09. CHM-201533845
																																				#if (${pol_split_no} != '')     
																																				  AND NVL(CLPT_IND_SEQ,'1') = @[pol_split_no]  -- Add. 2015.02.09. CHM-201533845
																																				#end
                                                                                                                                                  AND BKG_NO = @[bkg_no] 
																																				  AND CRE_USR_ID = @[in_usr_id] )
                                                                        ), @[cntr_no])			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="in_vvd_cd" type="12" value="" out="N"/>
				<param name="in_pol_cd" type="12" value="" out="N"/>
				<param name="pol_split_no" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="tbx_seq" type="12" value="" out="N"/>
				<param name="tbn_seq" type="12" value="" out="N"/>
				<param name="in_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
