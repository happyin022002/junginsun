<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="KrWharfageDecMgtDBDAOmergeBkgKrWhfBlCSQL">
			<desc><![CDATA[m]]></desc>
			<sql><![CDATA[
MERGE INTO BKG_KR_WHF_BL
USING DUAL
ON (    VSL_CD     = @[vsl_cd]
    AND SKD_VOY_NO = @[skd_voy_no]
    AND SKD_DIR_CD = @[skd_dir_cd]
    AND BL_NO      = @[bl_no]
    AND WHF_BND_CD = @[whf_bnd_cd] )
WHEN MATCHED THEN
UPDATE SET
BKG_NO               = @[bkg_no]
,POL_CD              = @[pol_cd]
,POD_CD              = @[pod_cd]
,POR_CD              = @[por_cd]
,DEL_CD              = @[del_cd]
,WHF_BL_STS_CD       = DECODE(@[bkg_sts_cd],'X', 'D', 'I')
,RCV_TERM_CD         = @[rcv_term_cd]
,DE_TERM_CD          = @[de_term_cd]
,WHF_POL_CD          = DECODE( SUBSTR(@[whf_bnd_cd], 1, 1), 'O', @[port_cd], ''  )
,WHF_POD_CD          = DECODE( SUBSTR(@[whf_bnd_cd], 1, 1), 'I', @[port_cd], ''  )
,PCK_QTY             = @[pck_qty]
,PCK_TP_CD           = @[pck_tp_cd]
,WGT_QTY             = @[act_wgt]
,WGT_UT_CD           = @[wgt_ut_cd]
,MEAS_QTY            = @[meas_qty]
,MEAS_UT_CD          = @[meas_ut_cd]
,RTON_WGT            = @[revenue]
,WHF_AMT             = DECODE(@[option_w],@[skd_dir_cd],(SELECT NVL(WHF_AMT,0)
													FROM BKG_KR_WHF_BL
													WHERE BL_NO       = @[bl_no]
													AND VSL_CD        = @[vsl_cd]
													AND SKD_VOY_NO    = @[skd_voy_no]
													AND SKD_DIR_cd    = @[skd_dir_cd]
													AND WHF_BND_CD     = @[whf_bnd_cd])
												  ,0)
,WHF_BL_ADD_RSN_CD   = DECODE( (@[vsl_cd]  || @[skd_voy_no] || @[skd_dir_cd]), (@[bkg_vsl_cd]  || @[bkg_skd_voy_no] || @[bkg_skd_dir_cd]), 'A', 'C' )
,WHF_BL_THRU_TS_FLG  = @[whf_bl_thru_ts_flg]
,WHF_BL_CGO_TP_CD    = @[bkg_cgo_tp_cd]
,SLS_OFC_CD          = @[ob_sls_ofc_cd]
,RLANE_CD            = @[slan_cd]
,UPD_USR_ID          = @[upd_usr_id]
,UPD_DT              = SYSDATE
WHEN NOT MATCHED THEN
INSERT
(
 VSL_CD
,SKD_VOY_NO
,SKD_DIR_CD
,WHF_BND_CD
,BL_NO
,BKG_NO
,POL_CD
,POD_CD
,POR_CD
,DEL_CD
,WHF_BL_STS_CD
,RCV_TERM_CD
,DE_TERM_CD
,WHF_POL_CD
,WHF_POD_CD
,PCK_QTY
,PCK_TP_CD
,WGT_QTY
,WGT_UT_CD
,MEAS_QTY
,MEAS_UT_CD
,RTON_WGT
,WHF_AMT
,WHF_BL_ADD_RSN_CD
,WHF_BL_THRU_TS_FLG
,WHF_BL_CGO_TP_CD
,WFG_EXPT_CD
,SLS_OFC_CD
,RLANE_CD
,CSTMS_DECL_TP_CD
,CRE_USR_ID
,CRE_DT
,UPD_USR_ID
,UPD_DT
)
VALUES (
 @[vsl_cd]
,@[skd_voy_no]
,@[skd_dir_cd]
,@[whf_bnd_cd]
,@[bl_no]
,@[bkg_no]
,@[pol_cd]
,@[pod_cd]
,@[por_cd]
,@[del_cd]
,DECODE(@[bkg_sts_cd],'X', 'D', 'I')
,@[rcv_term_cd]
,@[de_term_cd]
,DECODE( SUBSTR(@[whf_bnd_cd], 1, 1), 'O', @[port_cd], '' )
,DECODE( SUBSTR(@[whf_bnd_cd], 1, 1), 'I', @[port_cd], '' )
,@[pck_qty]
,@[pck_tp_cd]
,@[act_wgt]
,@[wgt_ut_cd]
,@[meas_qty]
,@[meas_ut_cd]
,@[revenue]
,DECODE(@[option_w], @[skd_dir_cd], @[amount],0)
,DECODE( (@[vsl_cd]  || @[skd_voy_no] || @[skd_dir_cd]), (@[bkg_vsl_cd]  || @[bkg_skd_voy_no] || @[bkg_skd_dir_cd]), 'A', 'C' )
,@[whf_bl_thru_ts_flg]
,@[bkg_cgo_tp_cd]
,NULL
,@[ob_sls_ofc_cd]
,@[slan_cd]
,CASE WHEN @[whf_bnd_cd] = 'OO' THEN 'E'
      WHEN @[whf_bnd_cd] = 'OT' THEN 'R'
      WHEN @[whf_bnd_cd] = 'II' THEN 'I'
      WHEN @[whf_bnd_cd] = 'IT' THEN 'T'
      ELSE NULL
 END
,@[cre_usr_id]
,SYSDATE
,@[upd_usr_id]
,SYSDATE
)			]]></sql>
			<params>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="whf_bnd_cd" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="por_cd" type="12" value="" out="N"/>
				<param name="del_cd" type="12" value="" out="N"/>
				<param name="bkg_sts_cd" type="12" value="" out="N"/>
				<param name="rcv_term_cd" type="12" value="" out="N"/>
				<param name="de_term_cd" type="12" value="" out="N"/>
				<param name="port_cd" type="12" value="" out="N"/>
				<param name="pck_qty" type="12" value="" out="N"/>
				<param name="pck_tp_cd" type="12" value="" out="N"/>
				<param name="act_wgt" type="12" value="" out="N"/>
				<param name="wgt_ut_cd" type="12" value="" out="N"/>
				<param name="meas_qty" type="12" value="" out="N"/>
				<param name="meas_ut_cd" type="12" value="" out="N"/>
				<param name="revenue" type="12" value="" out="N"/>
				<param name="option_w" type="12" value="" out="N"/>
				<param name="bkg_vsl_cd" type="12" value="" out="N"/>
				<param name="bkg_skd_voy_no" type="12" value="" out="N"/>
				<param name="bkg_skd_dir_cd" type="12" value="" out="N"/>
				<param name="whf_bl_thru_ts_flg" type="12" value="" out="N"/>
				<param name="bkg_cgo_tp_cd" type="12" value="" out="N"/>
				<param name="ob_sls_ofc_cd" type="12" value="" out="N"/>
				<param name="slan_cd" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="amount" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
