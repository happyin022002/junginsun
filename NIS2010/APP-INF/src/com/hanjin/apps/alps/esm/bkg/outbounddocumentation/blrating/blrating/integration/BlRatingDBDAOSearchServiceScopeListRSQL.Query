<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BlRatingDBDAOSearchServiceScopeListRSQL">
			<desc><![CDATA[BKG 에 해당되는 Service Scope 목록을 조회]]></desc>
			<sql><![CDATA[
SELECT T.SVC_SCP_CD
FROM (
SELECT DISTINCT SVC_SCP_CD FROM ( 
  SELECT A.SVC_SCP_CD  ,'A' A
  FROM MDM_SVC_SCP  A, BKG_BKG_HIS B 
    WHERE DELT_FLG='N'
    AND A.SVC_SCP_CD = B.SVC_SCP_CD
    AND B.BKG_NO =@[bkg_no]
    AND 'N' = @[ca_flg]
    AND CORR_NO = 'TMP0000001'
  UNION
  SELECT a.svc_scp_cd ,'B' B
  FROM mdm_svc_scp_lmt a
      ,mdm_svc_scp_lmt b
      ,mdm_svc_scp c
 WHERE a.svc_scp_cd = b.svc_scp_cd
   AND a.svc_scp_cd = c.svc_scp_cd
   AND c.delt_flg = 'N'
   AND a.org_dest_cd = 'O'
   AND a.delt_flg = 'N'
   AND a.svc_scp_ind_flg ='Y'
   AND a.rgn_cd IN (SELECT rgn_cd
                     FROM mdm_location
                     WHERE loc_cd = (select POR_CD from BKG_BKG_HIS where BKG_NO = @[bkg_no] and 'Y' = @[ca_flg] and CORR_NO = 'TMP0000001')) -- BKG POR_CD
   AND b.org_dest_cd = 'D'
   AND b.delt_flg = 'N'
   AND b.svc_scp_ind_flg ='Y'
   AND b.rgn_cd IN (SELECT rgn_cd
                    FROM mdm_location
                    WHERE loc_cd = (select DEL_CD from BKG_BKG_HIS where BKG_NO =@[bkg_no] and 'Y' = @[ca_flg] and CORR_NO = 'TMP0000001') ) -- BKG DEL_CD
    ORDER BY A)
) T

 UNION ALL
 
SELECT T.SVC_SCP_CD
FROM (
SELECT DISTINCT SVC_SCP_CD FROM ( 
  SELECT A.SVC_SCP_CD  ,'A' A
  FROM MDM_SVC_SCP  A, BKG_BOOKING B 
    WHERE DELT_FLG='N'
    AND A.SVC_SCP_CD = B.SVC_SCP_CD
    AND B.BKG_NO =@[bkg_no]
    AND 'N' = @[ca_flg]
  UNION
  SELECT a.svc_scp_cd ,'B' B
  FROM mdm_svc_scp_lmt a
      ,mdm_svc_scp_lmt b
      ,mdm_svc_scp c
 WHERE a.svc_scp_cd = b.svc_scp_cd
   AND a.svc_scp_cd = c.svc_scp_cd
   AND c.delt_flg = 'N'
   AND a.org_dest_cd = 'O'
   AND a.delt_flg = 'N'
   AND a.svc_scp_ind_flg ='Y'
   AND a.rgn_cd IN (SELECT rgn_cd
                     FROM mdm_location
                     WHERE loc_cd = (select POR_CD from BKG_BOOKING where BKG_NO = @[bkg_no] and 'N' = @[ca_flg])) -- BKG POR_CD
   AND b.org_dest_cd = 'D'
   AND b.delt_flg = 'N'
   AND b.svc_scp_ind_flg ='Y'
   AND b.rgn_cd IN (SELECT rgn_cd
                    FROM mdm_location
                    WHERE loc_cd = (select DEL_CD from BKG_BOOKING where BKG_NO =@[bkg_no] and 'N' = @[ca_flg]) ) -- BKG DEL_CD
    ORDER BY A)
) T			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="ca_flg" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
