<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingSearchDBDAOSearchCustomsHistRSQL">
			<desc><![CDATA[GeneralBookingSearchDBDAOSearchCustomsHistRSQL]]></desc>
			<sql><![CDATA[
SELECT  DECODE(SUBSTR(T.PORT,0,2),'US','USAMS','CA','Canada AIC',T.PORT) AS PORT
,       T.PORT_NM
,       XDT.BY_SEQ
,       DECODE(XDT.BY_SEQ,1,T.DOWNLOAD_FLAG,T.CUST_STATUS) AS CUST_STATUS
,       DECODE(XDT.BY_SEQ,1,T.DOWNLOAD_FLAG,NVL(T.CUST_STATUS_NM,'Manifest Transmit')) AS CUST_STATUS_NM
,       DECODE(XDT.BY_SEQ,1,T.DOWNLOAD_DT,DECODE(T.CUST_STATUS,'AI',T.AMDT_SND_DT,T.MF_SND_DT)) AS MF_SND_DT
,       DECODE(XDT.BY_SEQ,1,T.GMT_DOWNLOAD_DT,DECODE(T.CUST_STATUS,'AI',T.GMT_AMDT_SND_DT,T.GMT_MF_SND_DT)) AS GMT_DT
,       T.CRE_USR_ID
,       T.OFC_NM
FROM  ( 
SELECT CS.CSTMS_PORT_CD AS PORT
      ,(SELECT M.LOC_NM
        FROM   MDM_LOCATION M
        WHERE  M.LOC_CD = CS.CSTMS_PORT_CD) PORT_NM
      ,DECODE(IF_DT,NULL,'','DownLoad') DOWNLOAD_FLAG
      ,TO_CHAR(IF_DT, 'YYYY-MM-DD HH24:MI') DOWNLOAD_DT
	  ,TO_CHAR(GLOBALDATE_PKG.TIME_CONV_FNC('USNYC',IF_DT, 'GMT'), 'YYYY-MM-DD HH24:MI') GMT_DOWNLOAD_DT
      ,CS.CSTMS_MF_TP_CD CUST_STATUS
      ,(SELECT B.INTG_CD_VAL_DESC
        FROM   COM_INTG_CD_DTL B
        WHERE  INTG_CD_ID = 'CD02235' AND
               B.INTG_CD_VAL_CTNT = CS.CSTMS_MF_TP_CD) CUST_STATUS_NM
      ,TO_CHAR(CS.MF_SND_DT, 'YYYY-MM-DD HH24:MI') MF_SND_DT
      ,TO_CHAR(GLOBALDATE_PKG.TIME_CONV_FNC('USNYC',CS.MF_SND_DT, 'GMT'), 'YYYY-MM-DD HH24:MI') GMT_MF_SND_DT
      ,TO_CHAR(CS.AMDT_SND_DT, 'YYYY-MM-DD HH24:MI') AMDT_SND_DT
      ,TO_CHAR(GLOBALDATE_PKG.TIME_CONV_FNC('USNYC',CS.AMDT_SND_DT, 'GMT'), 'YYYY-MM-DD HH24:MI') GMT_AMDT_SND_DT
      ,CS.CRE_USR_ID
      ,(SELECT U.OFC_CD FROM COM_USER U WHERE U.USR_ID = CS.CRE_USR_ID) OFC_NM
FROM   BKG_CSTMS_ADV_BL CS
WHERE  CS.BL_NO = SUBSTR(@[bl_no],1,12)

) T
,(SELECT ROWNUM BY_SEQ
        FROM   DUAL
        CONNECT BY LEVEL <= 2) XDT
ORDER BY   T.PORT,XDT.BY_SEQ			]]></sql>
			<params>
				<param name="bl_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
