<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOInvoiceDAOSearchOffhireInvoiceListSumRSQL">
			<desc><![CDATA[TCharterIOInvoiceDAOSearchOffhireInvoiceListSumRSQL]]></desc>
			<sql><![CDATA[
SELECT CURR_CD,
	   INV_AMT,
	   CURR_CD2,
	   INV_AMT2
  FROM (
		SELECT  CURR_CD,
			    CASE WHEN CURR_CD = 'KRW' OR CURR_CD = 'JPY' OR CURR_CD = 'PAB' THEN
						  TO_CHAR(SUM(INV_AMT),'999,999,999,999,999,999')
                     ELSE
						  TO_CHAR(SUM(INV_AMT),'999,999,999,999,999,999.00') 
				 END INV_AMT, 
				CURR_CD2,
                CASE WHEN CURR_CD2 = 'KRW' OR CURR_CD2 = 'JPY' OR CURR_CD2 = 'PAB' THEN
						  TO_CHAR(SUM(INV_AMT2),'999,999,999,999,999,999') 
				     ELSE
						  TO_CHAR(SUM(INV_AMT2),'999,999,999,999,999,999.00') 
				 END INV_AMT2,
			    MIN(ACCT_CD) ACCT_CD
		FROM
			(
			SELECT 
				   DECODE(FD.FLET_CURR_CHK_CD,'F',FD.CURR_CD,NULL) CURR_CD, 
				   DECODE(FD.FLET_CURR_CHK_CD,'F',FD.INV_AMT,NULL) INV_AMT,
				   DECODE(FD.FLET_CURR_CHK_CD,'S',FD.CURR_CD,NULL) CURR_CD2, 
				   DECODE(FD.FLET_CURR_CHK_CD,'S',FD.INV_AMT,NULL) INV_AMT2,
				   FD.ACCT_CD
			  FROM FMS_INVOICE FI, FMS_INV_DTL FD, FMS_ACCT_ITM FA
			 WHERE FI.FLET_CTRT_NO = FD.FLET_CTRT_NO
			   AND FI.FLET_CTRT_NO = @[flet_ctrt_no]
			   AND FI.INV_SEQ = DECODE(@[inv_seq],NULL,(SELECT MAX(INV_SEQ) FROM FMS_INVOICE WHERE FLET_CTRT_NO = @[flet_ctrt_no] AND FLET_ISS_TP_CD = 'OFF'),@[inv_seq])
			   AND FI.FLET_ISS_TP_CD = 'OFF'
			   AND FI.INV_SEQ = FD.INV_SEQ
			   AND FI.FLET_ISS_TP_CD = FD.FLET_ISS_TP_CD
			   AND FD.ACCT_CD = FA.ACCT_CD
			   AND FD.ACCT_ITM_SEQ = FA.ACCT_ITM_SEQ
			   AND FD.ACCT_CD != '512641'
			) GROUP BY CURR_CD, CURR_CD2
	   ) ORDER BY ACCT_CD			]]></sql>
			<params>
				<param name="flet_ctrt_no" type="12" value="" out="N"/>
				<param name="inv_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
