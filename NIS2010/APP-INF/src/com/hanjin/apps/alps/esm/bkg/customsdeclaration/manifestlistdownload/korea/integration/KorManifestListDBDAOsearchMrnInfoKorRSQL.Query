<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="KorManifestListDBDAOsearchMrnInfoKorRSQL">
			<desc><![CDATA[MRN 정보 조회]]></desc>
			<sql><![CDATA[
SELECT SUBSTR(MAX(TO_CHAR(KV.VVD_SEQ, '00')||KV.MRN_NO), 4)     MRN_NO
     , SUBSTR(MAX(TO_CHAR(KV.VVD_SEQ, '00')||KV.MRN_CHK_NO), 4) MRN_CHK_NO
     , SUBSTR(MAX(TO_CHAR(KV.VVD_SEQ, '00')||KV.IO_BND_CD), 4)  IO_BND_CD
     , MAX(KV.VVD_SEQ) VVD_SEQ
     , MAX(KV.UPD_DT) UPD_DT
  FROM BKG_CSTMS_KR_VVD_SMRY KV
 WHERE KV.IO_BND_CD  = DECODE(@[pol_cd], NULL, 'I', 'O')
   AND KV.PORT_CD    = DECODE(@[pol_cd], NULL, @[pod_cd], @[pol_cd])
   AND DECODE(LENGTH(@[pod_tml]),7,PORT_TML_CD,' ') = DECODE(LENGTH(@[pod_tml]),7,@[pod_tml],' ')
   AND KV.vsl_cd     =   SUBSTR(@[vvd], 1, 4)
   AND KV.skd_voy_no =   SUBSTR(@[vvd], 5, 4)
   AND KV.skd_dir_cd =   SUBSTR(@[vvd], 9, 1)

#if(${in_type} == 'D' || ${in_type} == 'B' || ${in_type} == 'C'||${in_type} == 'D'||${in_type} == 'M')				
   AND KV.OB_DECL_TP_CD IN ('A','B','C','D','M')
#else
  AND KV.OB_DECL_TP_CD IN ('A','N','M','T','R')
#end

   AND KV.MRN_CHK_NO    = (SELECT MRN_CHK_NO
                           FROM BKG_CSTMS_KR_MF_REF_NO R
                           WHERE R.MRN_NO = KV.MRN_NO
                           AND VSL_CD     = SUBSTR(@[vvd], 1, 4)
                           AND SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
                           AND SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
                           AND PORT_CD    = DECODE(@[pol_cd], NULL, @[pod_cd], @[pol_cd])
                           AND IO_BND_CD  = DECODE(@[pol_cd], NULL, 'I', 'O')
                           AND ROWNUM = 1)
 GROUP BY KV.MRN_NO, KV.MRN_CHK_NO, KV.vsl_cd, KV.skd_voy_no, KV.skd_dir_cd
 ORDER BY VVD_SEQ DESC, UPD_DT DESC			]]></sql>
			<params>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="pod_tml" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
