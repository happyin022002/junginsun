<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BasicDataDBDAOInsertTargerVvdFixCSQL">
			<desc><![CDATA[0005화면에서 save시 입력쿼리

2016.04.20 CHM-201640366 Target VVD Fix 월기준 항차 생성 등 개선 CSR]]></desc>
			<sql><![CDATA[
MERGE INTO SQM_QTA_TGT_VVD A
USING (
     SELECT D.BSE_TP_CD, D.BSE_YR, D.BSE_QTR_CD, D.TRD_CD, D.RLANE_CD, D.DIR_CD, D.VSL_CD, D.SKD_VOY_NO, D.SKD_DIR_CD
	, D.BSE_MON, D.BSE_WK, D.SUB_TRD_CD, nvl(M.IOC_CD,'00') IOC_CD, D.FNL_BSA_CAPA, M.DELT_FLG, D.PF_SVC_TP_CD
    FROM
        (SELECT
		@[bse_mon] BSE_MON
		, @[bse_wk]  BSE_WK
		, @[fnl_bsa_capa] FNL_BSA_CAPA
		, @[bse_tp_cd] BSE_TP_CD
		, @[bse_yr] BSE_YR
		, decode(@[bse_tp_cd],'Y','00',@[bse_qtr_cd]) BSE_QTR_CD
		, @[trd_cd] TRD_CD
		, @[dir_cd] DIR_CD
		, @[sub_trd_cd] SUB_TRD_CD
		, @[rlane_cd] RLANE_CD
		, @[vsl_cd] VSL_CD
		, @[skd_voy_no] SKD_VOY_NO
		, @[skd_dir_cd] SKD_DIR_CD
		, NVL( (SELECT PF_SKD_TP_CD 
                FROM VSK_VSL_SKD V, MAS_MON_VVD M
                WHERE V.VSL_CD = @[vsl_cd] 
                    AND V.SKD_VOY_NO = @[skd_voy_no] 
                    AND V.SKD_DIR_CD = @[dir_cd] 
                    AND V.VSL_CD = M.VSL_CD
                    AND V.SKD_VOY_NO = M.SKD_VOY_NO
                    AND V.SKD_DIR_CD = M.DIR_CD
                    AND M.DELT_FLG = 'N'
                    AND M.TRD_CD = @[trd_cd]
                    AND M.RLANE_CD = @[rlane_cd]),'11111') PF_SVC_TP_CD
	FROM DUAL ) D , MAS_MON_VVD M
    WHERE 1=1
--      AND M.VSL_CD = 'AAAA'
--      AND M.SKD_VOY_NO = '0000'
--      AND M.DIR_CD = 'E'
--      AND M.TRD_CD = 'AES'
--      AND M.RLANE_CD = 'ADNAE'
      AND M.DELT_FLG(+) = 'N'
      AND M.VSL_CD(+) = D.VSL_CD
      AND M.SKD_VOY_NO(+) = D.SKD_VOY_NO
      AND M.DIR_CD(+) = D.DIR_CD
      AND M.TRD_CD(+) = D.TRD_CD
      AND M.RLANE_CD(+) = D.RLANE_CD
) B
ON(
	B.BSE_TP_CD    = A.BSE_TP_CD
  AND B.BSE_YR       = A.BSE_YR
  AND B.BSE_QTR_CD   = A.BSE_QTR_CD
  AND B.TRD_CD       = A.TRD_CD
  AND B.DIR_CD       = A.DIR_CD
  AND B.SUB_TRD_CD   = A.SUB_TRD_CD
  AND B.RLANE_CD     = A.RLANE_CD
  AND B.VSL_CD       = A.VSL_CD
  AND B.SKD_VOY_NO   = A.SKD_VOY_NO
  AND B.SKD_DIR_CD   = A.SKD_DIR_CD
)
WHEN NOT MATCHED THEN  
INSERT(BSE_TP_CD, BSE_YR, BSE_QTR_CD, TRD_CD, RLANE_CD, DIR_CD, VSL_CD, SKD_VOY_NO, SKD_DIR_CD
	, BSE_MON, BSE_WK, SUB_TRD_CD, IOC_CD, FNL_BSA_CAPA, DELT_FLG, CRE_USR_ID, CRE_DT, UPD_USR_ID, UPD_DT, PF_SVC_TP_CD
)  
 VALUES(B.BSE_TP_CD, B.BSE_YR, B.BSE_QTR_CD, B.TRD_CD, B.RLANE_CD, B.DIR_CD, B.VSL_CD, B.SKD_VOY_NO, B.SKD_DIR_CD
	, B.BSE_MON, B.BSE_WK, B.SUB_TRD_CD, B.IOC_CD, B.FNL_BSA_CAPA, 'N', @[cre_usr_id], sysdate, @[cre_usr_id], sysdate, B.PF_SVC_TP_CD
)			]]></sql>
			<params>
				<param name="bse_mon" type="12" value="" out="N"/>
				<param name="bse_wk" type="12" value="" out="N"/>
				<param name="fnl_bsa_capa" type="12" value="" out="N"/>
				<param name="bse_tp_cd" type="12" value="" out="N"/>
				<param name="bse_yr" type="12" value="" out="N"/>
				<param name="bse_qtr_cd" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
				<param name="sub_trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
