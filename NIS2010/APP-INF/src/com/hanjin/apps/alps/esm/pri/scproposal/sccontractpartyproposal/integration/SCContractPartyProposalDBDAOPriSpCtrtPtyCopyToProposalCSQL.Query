<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCContractPartyProposalDBDAOPriSpCtrtPtyCopyToProposalCSQL">
			<desc><![CDATA[PriSpCtrtPtyCopyToProposal]]></desc>
			<sql><![CDATA[
INSERT INTO PRI_SP_CTRT_PTY (
     PROP_NO
,    AMDT_SEQ
,    PRC_CTRT_PTY_TP_CD
,    CUST_CNT_CD
,    CUST_SEQ
,    CTRT_PTY_NM
,    CTRT_PTY_ADDR
,    CTRT_CUST_VAL_SGM_CD
,    CTRT_CUST_SREP_CD
,    CTRT_CUST_SLS_OFC_CD
,    CTRT_PTY_SGN_NM
,    CTRT_PTY_SGN_TIT_NM
,    PRC_PROG_STS_CD
,    SRC_INFO_CD
,    N1ST_CMNC_AMDT_SEQ
,    CRE_USR_ID
,    CRE_DT
,    UPD_USR_ID
,    UPD_DT
)
SELECT
     @[new_prop_no]
,    0 
,    'H'
,	 NULL
,	 NULL
,    DECODE(SUBSTR(@[qttn_srep_cd],1,2),'SG','SM Line Corporation(SG) PTE, LTD as Agent for SM Line Corporation.',
                                        'ID','SM Line Corporation(India) Private Limited as Agent for SM Line Corporation.',
                                        'SM Line Corporation')

,    (select NVL(MO.OFC_ADDR,'Please Input') from MDM_ORGANIZATION MO where   MO.OFC_CD =  DECODE(@[cnt_cd],'CN',DECODE( @[qttn_ofc_cd],'HKGSC',@[qttn_ofc_cd],'SELHO'),DECODE( @[qttn_ofc_cd],'LGBSC','PHXSA','NYCSC','PHXSA',@[qttn_ofc_cd]) )  ) as OFC_ADDR

,    NULL
,    NULL
,    NULL
,    NVL(PTY.CTRT_PTY_SGN_NM, 'PLEASE INPUT') AS CTRT_PTY_SGN_NM
,    NVL(PTY.CTRT_PTY_SGN_TIT_NM, 'PLEASE INPUT') AS CTRT_PTY_SGN_TIT_NM
,    'I'
,    'PC'
,    0 AS N1ST_CMNC_AMDT_SEQ
,    @[cre_usr_id]
,    sysdate
,    @[upd_usr_id]
,    sysdate
FROM MDM_ORGANIZATION ORG
   ,(
    SELECT PTY.CTRT_PTY_SGN_NM
          ,PTY.CTRT_PTY_SGN_TIT_NM
          ,PROP_OFC_CD
    FROM   PRI_SP_MN MN
          ,PRI_SP_CTRT_PTY PTY
    WHERE  PROP_OFC_CD = @[qttn_ofc_cd]
    AND    MN.PROP_NO = PTY.PROP_NO
    AND    MN.AMDT_SEQ = PTY.AMDT_SEQ
    AND    PTY.PRC_CTRT_PTY_TP_CD = 'H'
    AND    PTY.UPD_DT = (SELECT MAX (PTY.UPD_DT)
                        FROM   PRI_SP_MN MN
                              ,PRI_SP_CTRT_PTY PTY
                        WHERE  PROP_OFC_CD = @[qttn_ofc_cd]
                        AND    MN.PROP_NO = PTY.PROP_NO
                        AND    MN.AMDT_SEQ = PTY.AMDT_SEQ
                        AND    PTY.PRC_CTRT_PTY_TP_CD = 'H')
    )PTY
WHERE ORG.OFC_CD = @[qttn_ofc_cd]
AND   PTY.PROP_OFC_CD (+) = ORG.OFC_CD
AND   ROWNUM = 1
UNION ALL
SELECT  @[new_prop_no]
,    0
,    'C'
,    CUST.CUST_CNT_CD                                					
    ,CUST.CUST_SEQ                                   					
    ,CUST.CUST_LGL_ENG_NM CTRT_PTY_NM                					
    ,ADDR.BZET_ADDR CTRT_PTY_ADDR                    					
    ,CUST.VBS_CLSS_CD CTRT_CUST_VAL_SGM_CD           					    					
    ,CUST.SREP_CD CTRT_CUST_SREP_CD                  														
    ,CUST.OFC_CD CTRT_CUST_SLS_OFC_CD    
,    NVL(PTY.CTRT_PTY_SGN_NM, 'PLEASE INPUT') AS CTRT_PTY_SGN_NM
,    NVL(PTY.CTRT_PTY_SGN_TIT_NM, 'PLEASE INPUT') AS CTRT_PTY_SGN_TIT_NM
,    'I'
,    'PC'
,    0 AS N1ST_CMNC_AMDT_SEQ
,    @[cre_usr_id]
,    sysdate
,    @[upd_usr_id]
,    sysdate
FROM PRI_SQ_MN MN	,
     MDM_CUSTOMER CUST   ,
     MDM_CUST_ADDR ADDR  ,
	 MDM_SLS_REP SREP    ,
	(
		SELECT PTY.CTRT_PTY_SGN_NM
      			,PTY.CTRT_PTY_SGN_TIT_NM
      			,PTY.CUST_CNT_CD, PTY.CUST_SEQ 
		FROM    PRI_SP_MN MN
      			,PRI_SP_CTRT_PTY PTY
      			,PRI_SQ_MN  MN2
		WHERE  MN.PROP_NO = PTY.PROP_NO
		AND    MN.AMDT_SEQ = PTY.AMDT_SEQ
		AND    MN.PROP_STS_CD IN ( 'A', 'F')
		AND    MN.PROP_OFC_CD = @[qttn_ofc_cd]
		AND    PTY.CUST_CNT_CD = MN2.CUST_CNT_CD
		AND    PTY.CUST_SEQ = MN2.CUST_SEQ
		AND	   MN2.QTTN_NO = @[qttn_no]
		AND	   MN2.QTTN_VER_NO = @[qttn_ver_no]
		AND    PTY.PRC_CTRT_PTY_TP_CD = 'C'
		AND    PTY.UPD_DT =
          		(SELECT MAX (PTY.UPD_DT)
           		 FROM   PRI_SP_MN MN
            		   ,PRI_SP_CTRT_PTY PTY
           		       ,PRI_SQ_MN  MN2
          		 WHERE  MN.PROP_NO = PTY.PROP_NO
           		 AND    MN.AMDT_SEQ = PTY.AMDT_SEQ
		  		 AND    MN.PROP_STS_CD IN ( 'A', 'F')
		  		 AND    MN.PROP_OFC_CD = @[qttn_ofc_cd]
		  		 AND    PTY.CUST_CNT_CD = MN2.CUST_CNT_CD
           		 AND    PTY.CUST_SEQ = MN2.CUST_SEQ
          		 AND	MN2.QTTN_NO = @[qttn_no]
           		 AND	MN2.QTTN_VER_NO = @[qttn_ver_no]
           		 AND    PTY.PRC_CTRT_PTY_TP_CD = 'C'
				) 
		AND   ROWNUM = 1
	) PTY
WHERE MN.QTTN_NO = @[qttn_no]
AND	MN.QTTN_VER_NO = @[qttn_ver_no]
AND MN.CUST_CNT_CD          = CUST.CUST_CNT_CD
AND MN.CUST_SEQ             = CUST.CUST_SEQ
AND CUST.DELT_FLG			= 'N'
AND CUST.CNTR_DIV_FLG 		= 'Y'
AND CUST.CUST_CNT_CD        = ADDR.CUST_CNT_CD
AND CUST.CUST_SEQ           = ADDR.CUST_SEQ
AND ADDR.PRMRY_CHK_FLG      = 'Y'
AND CUST.SREP_CD 			= SREP.SREP_CD
AND MN.CUST_CNT_CD          = PTY.CUST_CNT_CD(+)
AND MN.CUST_SEQ             = PTY.CUST_SEQ(+)			]]></sql>
			<params>
				<param name="new_prop_no" type="12" value="" out="N"/>
				<param name="qttn_srep_cd" type="12" value="" out="N"/>
				<param name="cnt_cd" type="12" value="" out="N"/>
				<param name="qttn_ofc_cd" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="qttn_no" type="12" value="" out="N"/>
				<param name="qttn_ver_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
