<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="NetworkDistributionDBDAOAllocResultCommitListRSQL">
			<desc><![CDATA[Allocation Results(Commitment base) 조회]]></desc>
			<sql><![CDATA[
SELECT cost_yrmon
      , cost_wk
      , trd_cd
      , sub_trd_cd
      , rlane_cd
      , ioc_cd
      , vsl_cd
      , skd_voy_no
      , dir_cd
      , vvd_cd
	  , hul_bnd_cd
      , co_amt
      , hjs_sls_amt
      , n1st_asgn_amt
      , ipt_asgn_amt
      , (hjs_sls_amt + n1st_asgn_amt + ipt_asgn_amt) AS hjs_sales_final
      , (co_amt + hjs_sls_amt + n1st_asgn_amt + ipt_asgn_amt)  total_network_cost
   FROM (
	SELECT a.cost_yrmon
	      , a.cost_wk
	      , b.trd_cd
	      , DECODE(c.no, 1, a.sub_trd_cd, 'OT') AS sub_trd_cd
	      , b.rlane_cd
	      , b.ioc_cd
	      , b.vsl_cd
	      , b.skd_voy_no
	      , b.dir_cd
	      , b.vsl_cd||b.skd_voy_no||b.dir_cd AS vvd_cd
		  , (SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD03217' AND INTG_CD_VAL_CTNT = D.HUL_BND_CD) HUL_BND_CD
	#if (${f_op_view} == 'OP5')
	      , DECODE(c.no, 1, NVL(SUM(b.co_amt), 0),0)   AS co_amt
	      , DECODE(c.no, 1, NVL(SUM(b.hjs_sls_amt), 0),0)   AS hjs_sls_amt
	      , CASE WHEN b.trd_cd IN ('IAS','IES','IMS') THEN DECODE(c.no, 1, (NVL(SUM(b.n5th_asgn_amt), 0) - NVL(SUM(b.hjs_sls_amt), 0)), NVL(SUM(B.adj_trd_otr_fnl_amt), 0) ) 
				 ELSE DECODE(c.no, 1, NVL(SUM(b.n5th_asgn_amt), 0), NVL(SUM(B.adj_trd_otr_fnl_amt), 0)) END AS n1st_asgn_amt
	      , 0  AS n2st_asgn_amt
	      , DECODE(c.no, 1, NVL(SUM(b.ipt_asgn_amt), 0),0)  AS ipt_asgn_amt
	      
	#elseif (${f_op_view} == 'OP6')
	      , DECODE(c.no, 1, NVL(SUM(b.n4th_co_amt), 0),0)   AS co_amt
	      , DECODE(c.no, 1, NVL(SUM(b.n4th_hjs_sls_amt), 0),0)   AS hjs_sls_amt
	      , CASE WHEN b.trd_cd IN ('IAS','IES','IMS') THEN DECODE(c.no, 1, NVL(SUM(b.n6th_asgn_amt), 0) - NVL(SUM(b.n4th_hjs_sls_amt), 0), NVL(SUM(B.n6th_adj_otr_fnl_amt), 0) ) 
				 ELSE DECODE(c.no, 1, NVL(SUM(b.n6th_asgn_amt), 0), NVL(SUM(B.n6th_adj_otr_fnl_amt), 0)) END AS n1st_asgn_amt
	      , 0  AS n2st_asgn_amt
	      , DECODE(c.no, 1, NVL(SUM(b.ipt_asgn_amt), 0),0)  AS ipt_asgn_amt
	      
	#end

	   FROM mas_mon_vvd a
	      , mas_vvd_hir b
	      , (SELECT LEVEL AS NO FROM dual  CONNECT BY LEVEL < 3 ) c 
		  , (SELECT TRD_CD, RLANE_CD, IOC_CD, DIR_CD, HUL_BND_CD FROM MAS_LANE_RGST) D
	  WHERE a.trd_cd             = b.trd_cd
	    AND a.rlane_cd           = b.rlane_cd
	    AND a.ioc_cd             = b.ioc_cd
	    AND a.vsl_cd             = b.vsl_cd
	    AND a.skd_voy_no         = b.skd_voy_no
	    AND a.dir_cd             = b.dir_cd
		AND A.TRD_CD          = D.TRD_CD
        AND A.RLANE_CD        = D.RLANE_CD
        AND A.IOC_CD          = D.IOC_CD
        AND A.DIR_CD          = D.DIR_CD    
	    AND b.stnd_cost_cd NOT  IN('43102011', '54600000')
	    AND NVL(a.delt_flg, 'N') = 'N'

	#if (${f_seltrade} != '')
	    AND a.trd_cd = @[f_seltrade]
	#end
	#if (${f_selrlane} != '')
	    AND a.rlane_cd = @[f_selrlane]
	#end
	#if (${f_selioc} != '')
	    AND a.ioc_cd = @[f_selioc]
	#end
	#if (${f_vsl_cd} != '')
	    AND a.vsl_cd = @[f_vsl_cd]
	#end
	#if (${f_skd_voy_no} != '')
	    AND a.skd_voy_no = @[f_skd_voy_no]
	#end
	#if (${f_dir_cd} != '')
	    AND a.dir_cd = @[f_dir_cd]
	#end
	#if (${f_selcost} != '')
	    AND b.stnd_cost_cd = @[f_selcost]
	#end

	#if (${f_chkprd} == 'M')
	    #if (${f_fm_mon} != '')
	    AND a.cost_yrmon BETWEEN @[f_year]||@[f_fm_mon] AND @[f_year]||@[f_to_mon]
	    #else
	    AND a.cost_yrmon like @[f_year] || '%'
	    #end
	#elseif (${f_chkprd} == 'W')
	    AND a.sls_yrmon LIKE @[f_year] || '%'
	    #if (${f_fm_wk} != '')
	    AND a.cost_wk BETWEEN @[f_fm_wk] AND @[f_to_wk] 
	    #end
	#end

	GROUP BY a.cost_yrmon
	      , a.cost_wk
	      , b.trd_cd
	      , a.sub_trd_cd
	      , b.rlane_cd
	      , b.ioc_cd
	      , b.vsl_cd
	      , b.skd_voy_no
	      , b.dir_cd
		  , d.HUL_BND_CD
	      , c.no
	ORDER BY  a.cost_yrmon
	      , a.cost_wk
	      , b.trd_cd
	      , b.rlane_cd
	      , b.ioc_cd
	      , b.vsl_cd
	      , b.skd_voy_no
	      , b.dir_cd
	      , DECODE(DECODE(c.no, 1, a.sub_trd_cd, 'OT'), 'OT', '2', '1') 
   )
   WHERE TRD_CD||SUB_TRD_CD NOT IN ('IMSOT', 'IESOT')			]]></sql>
			<params>
				<param name="f_seltrade" type="12" value="" out="N"/>
				<param name="f_selrlane" type="12" value="" out="N"/>
				<param name="f_selioc" type="12" value="" out="N"/>
				<param name="f_vsl_cd" type="12" value="" out="N"/>
				<param name="f_skd_voy_no" type="12" value="" out="N"/>
				<param name="f_dir_cd" type="12" value="" out="N"/>
				<param name="f_selcost" type="12" value="" out="N"/>
				<param name="f_year" type="12" value="" out="N"/>
				<param name="f_fm_mon" type="12" value="" out="N"/>
				<param name="f_to_mon" type="12" value="" out="N"/>
				<param name="f_fm_wk" type="12" value="" out="N"/>
				<param name="f_to_wk" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
