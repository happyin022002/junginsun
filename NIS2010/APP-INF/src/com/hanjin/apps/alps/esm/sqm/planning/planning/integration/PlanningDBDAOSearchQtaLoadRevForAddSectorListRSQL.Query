<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PlanningDBDAOSearchQtaLoadRevForAddSectorListRSQL">
			<desc><![CDATA[[QTA Set up for IAS Sector by Head Office] 데이터를 조회한다.
[CHM-201639787] SQM Planning 도중 & Planning 완료 후 노선, P/F Group, Sector 추가 로직 Process 변경]]></desc>
			<sql><![CDATA[
SELECT DISTINCT A1.BSE_TP_CD
      , A1.BSE_YR
      , A1.BSE_QTR_CD
      , A1.RLANE_CD
      , A1.TRD_CD
      , A1.DIR_CD
      , A1.SUB_TRD_CD
      , A1.PF_GRP_CD
      , A1.RHQ_CD
      , A1.RGN_OFC_CD
      , (SELECT INTG_CD_VAL_DP_DESC FROM COM_INTG_CD_DTL WHERE INTG_CD_ID = 'CD03218' AND INTG_CD_VAL_CTNT = A2.IAS_RGN_CD) IAS_RGN_CD
      , A1.POL_CD
      , A1.POD_CD
   FROM SQM_SCTR_LANE_OFC A1
      , MAS_LANE_RGST A2
      , ( SELECT DISTINCT B1.DIR_CD
              , B1.RLANE_CD
              , B1.BSA_CAPA
              , B1.PF_GRP_CD
           FROM (SELECT A1.DIR_CD
                      , A1.RLANE_CD
                      , A1.FNL_BSA_CAPA
                      , A1.PF_GRP_CD
                      , MAX(A2.RANGE_BSA)+9 AS BSA_CAPA
                   FROM ( SELECT DISTINCT S1.RLANE_CD
                              , S1.DIR_CD
                              , S1.FNL_BSA_CAPA
                              , S2.PF_GRP_CD
                           FROM SQM_QTA_TGT_VVD S1
                              , SQM_SCTR_PF_GRP S2
                          WHERE 1               = 1
                            AND S1.BSE_TP_CD    = S2.BSE_TP_CD
                            AND S1.BSE_YR       = S2.BSE_YR
                            AND S1.BSE_QTR_CD   = S2.BSE_QTR_CD
                            AND S1.TRD_CD       = S2.TRD_CD
                            AND S1.RLANE_CD     = S2.RLANE_CD
                            AND S1.PF_SVC_TP_CD = S2.PF_SVC_TP_CD
                            AND S1.BSE_TP_CD    = @[f_bse_tp_cd]
                            AND S1.BSE_YR       = @[f_bse_yr]
                            AND S1.BSE_QTR_CD   = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])
                            AND S1.TRD_CD       = 'IAS'
                            AND S1.RLANE_CD     = @[f_rlane_cd]
                            AND S1.DIR_CD       = @[f_dir_cd]
                        ) A1
                      , ( SELECT DISTINCT RLANE_CD
                              , DIR_CD
                              , FNL_BSA_CAPA
                              , FNL_BSA_CAPA - 9 AS RANGE_BSA
                           FROM SQM_QTA_TGT_VVD
                          WHERE BSE_TP_CD  = @[f_bse_tp_cd]
                            AND BSE_YR     = @[f_bse_yr]
                            AND BSE_QTR_CD = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])
                            AND TRD_CD     = 'IAS'
                            AND RLANE_CD   = @[f_rlane_cd]
                            AND DIR_CD     = @[f_dir_cd]
                        ) A2
                  WHERE 1                = 1
                    AND A1.DIR_CD        = A2.DIR_CD
                    AND A1.RLANE_CD      = A2.RLANE_CD
                    AND A1.FNL_BSA_CAPA >= A2.RANGE_BSA
               GROUP BY A1.DIR_CD
                      , A1.RLANE_CD
                      , A1.FNL_BSA_CAPA
                      , A1.PF_GRP_CD
                ) B1
        ) C3
  WHERE 1              =1
    AND A1.SQM_ACT_FLG = 'Y'
    AND A1.TRD_CD      = A2.TRD_CD
    AND A1.SUB_TRD_CD  = A2.SUB_TRD_CD
    AND A1.RLANE_CD    = A2.RLANE_CD
    AND A1.BSE_TP_CD   = @[f_bse_tp_cd]
    AND A1.BSE_YR      = @[f_bse_yr]
    AND A1.BSE_QTR_CD  = DECODE(@[f_bse_tp_cd], 'Y', '00', @[f_bse_qtr_cd])
    AND A1.SUB_TRD_CD  = @[f_sub_trd_cd]
    AND A1.RLANE_CD    = @[f_rlane_cd]
    AND A1.DIR_CD      = @[f_dir_cd]
    AND A1.OFC_VW_CD   = SUBSTR(@[f_ofc_vw_cd], 0, 1)
    #if (${f_ias_rgn_cd} != '' && ${f_ias_rgn_cd} != 'All')
    AND A2.IAS_RGN_CD  = @[f_ias_rgn_cd]
    #end

    #if (${f_rhq_cd} != '' && ${f_rhq_cd} != 'All')
    AND A1.RHQ_CD      = @[f_rhq_cd]
    #end

    #if (${f_rgn_ofc_cd} != '' && ${f_rgn_ofc_cd} != 'All')
    AND A1.RGN_OFC_CD  = @[f_rgn_ofc_cd]
    #end

    #if (${f_pol_cd} != '' && ${f_pol_cd} != 'All')
    AND A1.POL_CD      = @[f_pol_cd]
    #end
    #if (${f_pod_cd} != '' && ${f_pod_cd} != 'All')
    AND A1.POD_CD      = @[f_pod_cd]
    #end
    AND NOT EXISTS
        (SELECT 1
           FROM SQM_SCTR_LOD_REV SR
          WHERE SR.BSE_TP_CD  = A1.BSE_TP_CD
            AND SR.BSE_YR     = A1.BSE_YR
            AND SR.BSE_QTR_CD = A1.BSE_QTR_CD
            AND SR.OFC_VW_CD  = A1.OFC_VW_CD
            AND SR.RLANE_CD   = A1.RLANE_CD
            AND SR.DIR_CD     = A1.DIR_CD
            AND SR.POL_CD     = A1.POL_CD
            AND SR.POD_CD     = A1.POD_CD
            AND SR.RHQ_CD     = A1.RHQ_CD
            AND SR.RGN_OFC_CD = A1.RGN_OFC_CD
            AND SR.PF_GRP_CD  = A1.PF_GRP_CD
        )

    AND A1.RLANE_CD    = C3.RLANE_CD
    AND A1.DIR_CD      = C3.DIR_CD
    AND A1.PF_GRP_CD   = C3.PF_GRP_CD
ORDER BY RHQ_CD
      , RGN_OFC_CD
      , POL_CD
      , POD_CD			]]></sql>
			<params>
				<param name="f_bse_tp_cd" type="12" value="" out="N"/>
				<param name="f_bse_yr" type="12" value="" out="N"/>
				<param name="f_bse_qtr_cd" type="12" value="" out="N"/>
				<param name="f_rlane_cd" type="12" value="" out="N"/>
				<param name="f_dir_cd" type="12" value="" out="N"/>
				<param name="f_sub_trd_cd" type="12" value="" out="N"/>
				<param name="f_ofc_vw_cd" type="12" value="" out="N"/>
				<param name="f_ias_rgn_cd" type="12" value="" out="N"/>
				<param name="f_rhq_cd" type="12" value="" out="N"/>
				<param name="f_rgn_ofc_cd" type="12" value="" out="N"/>
				<param name="f_pol_cd" type="12" value="" out="N"/>
				<param name="f_pod_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
