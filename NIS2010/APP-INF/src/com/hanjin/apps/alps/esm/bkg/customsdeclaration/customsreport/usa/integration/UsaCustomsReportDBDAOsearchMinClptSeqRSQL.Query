<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UsaCustomsReportDBDAOsearchMinClptSeqRSQL">
			<desc><![CDATA[searchMinClptSeq]]></desc>
			<sql><![CDATA[
SELECT MIN(CLPT_SEQ) AS CLPT_SEQ
      ,VSL.VSL_CD
      ,VSL.SKD_VOY_NO
      ,VSL.SKD_DIR_CD
  FROM (
       SELECT BKG.BKG_NO
             ,BKG.BL_NO
         FROM BKG_BOOKING BKG
        WHERE 1=1
#if (${mbl_no} != '')
          AND BKG.BL_NO = @[mbl_no]
#else
    #if (${ams_file_no} != '')
          AND BKG.BL_NO = @[ams_file_no]
    #end
#end
       UNION ALL
       SELECT BKG.BKG_NO
             ,HBL.CNTR_MF_NO
         FROM BKG_BOOKING BKG
             ,BKG_HBL HBL
        WHERE BKG.BKG_NO = HBL.BKG_NO
#if (${mbl_no} != '')
          AND BKG.BL_NO = @[mbl_no]
#else
    #if (${ams_file_no} != '')
          AND HBL.BKG_NO > ' '
          AND HBL.CNTR_MF_NO = @[ams_file_no]
    #end
#end
        ) BKG
      ,BKG_VVD VVD
      ,VSK_VSL_PORT_SKD VSL
WHERE BKG.BKG_NO = VVD.BKG_NO
  AND VVD.VSL_CD = VSL.VSL_CD
  AND VVD.SKD_VOY_NO = VSL.SKD_VOY_NO
  AND VVD.SKD_DIR_CD = VSL.SKD_DIR_CD
  AND VSL.CLPT_IND_SEQ = 1
  AND VSL.VPS_PORT_CD LIKE 'US%'
#if (${vvd} != '')
    AND VVD.VSL_CD = SUBSTR(@[vvd],1,4)
    AND VVD.SKD_VOY_NO = SUBSTR(@[vvd], 5, 4)
    AND VVD.SKD_DIR_CD = SUBSTR(@[vvd], 9, 1)
#end
#if (${pol} != '')
    AND VVD.POL_CD = @[pol]
#end
#if (${pod} != '')
    AND VVD.POD_CD = @[pod]
#end
GROUP BY VSL.VSL_CD, VSL.SKD_VOY_NO, VSL.SKD_DIR_CD			]]></sql>
			<params>
				<param name="mbl_no" type="12" value="" out="N"/>
				<param name="ams_file_no" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
				<param name="pol" type="12" value="" out="N"/>
				<param name="pod" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
