<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CMSummaryDBDAORsltPrsAmendmentCmSummarySimulation2NdTypeVORSQL">
			<desc><![CDATA[   ]]></desc>
			<sql><![CDATA[
SELECT  PRC_CTRT_NO AS SC_NO
			, LOAD
			, G_REV
			, COST_CM_OFFICE AS  COST_OFFICE
			, COST_CM_TRADE AS  COST_TRADE
			, COST_OP_OFFICE
			, CM_OFFICE
			, CM_TRADE
			, OP AS OP_OFFICE
			, CM_OFFICE / DECODE(LOAD,0,1,LOAD) AS CMPB_OFFICE
			, CM_TRADE /  DECODE(LOAD,0,1,LOAD) AS CMPB_TRADE
			, OP /  DECODE(LOAD,0,1,LOAD) AS OPB_OFFICE
			, DECODE(UPD_FLG,'Y','Y',DECODE(SCG_UPD_FLG,'Y','Y','N')) AS UPD_FLG
		FROM (
			SELECT  PRC_CTRT_NO 
				, SUM(LOAD  / DECODE('TEU','FEU',2,'TEU',1) )      AS LOAD            -- Load(Previous)
				, SUM(LOAD   * COST_CM_OFFICE)   AS COST_CM_OFFICE  -- Office Profit/ CM -- Cost(Previous)
				, SUM(LOAD   * COST_CM_TRADE)    AS COST_CM_TRADE   --Trade Profit/ CM   -- Cost(Previous)
				, SUM(LOAD   * COST_OP_OFFICE) AS COST_OP_OFFICE -- Office Profit/ OP -- Cost(Previous)
				, SUM(LOAD   * ( RATE/LOAD + SURCHAGE/LOAD) )         AS G_REV            -- Gross Revenue(Previous)
				, SUM(LOAD   *  ( RATE/LOAD + SURCHAGE/LOAD  - COST_CM_OFFICE ) ) AS CM_OFFICE
				, SUM(LOAD   *  ( RATE/LOAD + SURCHAGE/LOAD  - COST_CM_TRADE ) ) AS CM_TRADE
				, SUM(LOAD   *  ( RATE/LOAD + SURCHAGE/LOAD  - COST_OP_OFFICE - COST_CM_OFFICE ) ) AS OP
				, MAX(UPD_FLG) AS UPD_FLG
				, MAX(SCG_UPD_FLG) AS SCG_UPD_FLG
			FROM (
				SELECT SR_CST_DTL.PRS_YRMON       
				       ,SR_CST_DTL.PRS_WK          
				       ,SR_CST_DTL.PRC_CTRT_TP_CD  
				       ,SR_CST_DTL.PRC_CTRT_NO     
				       ,SR_CST_DTL.SVC_SCP_CD      
				       ,SR_CST_DTL.VSL_SLAN_DIR_CD 
				       ,SR_CST_DTL.TRD_CD          
				       ,SR_CST_DTL.SUB_TRD_CD      
				       ,SR_CST_DTL.RLANE_CD        
				       ,SR_CST_DTL.PRC_CGO_TP_CD   
				       ,SR_CST_DTL.ORG_LOC_TP_CD   
				       ,SR_CST_DTL.ORG_LOC_DEF_CD  
				       ,SR_CST_DTL.DEST_LOC_TP_CD  
				       ,SR_CST_DTL.DEST_LOC_DEF_CD 
					, MAX(SR_CST_DTL.PRS_CRNT_LOD_QTY  )      AS LOAD            -- Load(Previous)
					, MAX(SR_CST_DTL.PRS_RESPB_CM_UC_AMT)   AS COST_CM_OFFICE  -- Office Profit/ CM -- Cost(Previous)
					, MAX(SR_CST_DTL.PRS_PFIT_CM_UC_AMT)    AS COST_CM_TRADE   --Trade Profit/ CM   -- Cost(Previous)
					, MAX(SR_CST_DTL.PRS_RESPB_OPFIT_UC_AMT) AS COST_OP_OFFICE -- Office Profit/ OP -- Cost(Previous)
					, SUM( DECODE(SR_SCG.CHG_CD,'OFT',SR_SCG.SCG_AMT*SR_CST_DTL.PRS_CRNT_LOD_QTY,0) ) AS RATE
					, SUM( DECODE(SR_SCG.CHG_CD,'OFT',0,SR_SCG.SCG_AMT*SR_CST_DTL.PRS_CRNT_LOD_QTY) ) AS SURCHAGE
					, MAX(SR_CST_DTL.UPD_USR_ID) AS UPD_FLG
					, MAX(SR_SCG.UPD_USR_ID) AS SCG_UPD_FLG
				FROM  PRI_PRS_CTRT_SMRY_COST_TMP SR_CST_DTL
					, PRI_PRS_CTRT_SMRY_SCG_TMP SR_SCG
				WHERE 
					    SR_CST_DTL.PRS_YRMON        = SR_SCG.PRS_YRMON      
					AND SR_CST_DTL.PRS_WK           = SR_SCG.PRS_WK         
					AND SR_CST_DTL.PRC_CTRT_TP_CD   = SR_SCG.PRC_CTRT_TP_CD 
					AND SR_CST_DTL.PRC_CTRT_NO      = SR_SCG.PRC_CTRT_NO    
					AND SR_CST_DTL.SVC_SCP_CD       = SR_SCG.SVC_SCP_CD     
					AND SR_CST_DTL.VSL_SLAN_DIR_CD  = SR_SCG.VSL_SLAN_DIR_CD
					AND SR_CST_DTL.TRD_CD           = SR_SCG.TRD_CD         
					AND SR_CST_DTL.SUB_TRD_CD       = SR_SCG.SUB_TRD_CD     
					AND SR_CST_DTL.RLANE_CD         = SR_SCG.RLANE_CD       
					AND SR_CST_DTL.PRC_CGO_TP_CD    = SR_SCG.PRC_CGO_TP_CD  
					AND SR_CST_DTL.ORG_LOC_TP_CD    = SR_SCG.ORG_LOC_TP_CD  
					AND SR_CST_DTL.ORG_LOC_DEF_CD   = SR_SCG.ORG_LOC_DEF_CD 
					AND SR_CST_DTL.DEST_LOC_TP_CD   = SR_SCG.DEST_LOC_TP_CD 
					AND SR_CST_DTL.DEST_LOC_DEF_CD  = SR_SCG.DEST_LOC_DEF_CD
				GROUP BY SR_CST_DTL.PRS_YRMON       
					 ,SR_CST_DTL.PRS_WK          
					 ,SR_CST_DTL.PRC_CTRT_TP_CD  
					 ,SR_CST_DTL.PRC_CTRT_NO     
					 ,SR_CST_DTL.SVC_SCP_CD      
					 ,SR_CST_DTL.VSL_SLAN_DIR_CD 
					 ,SR_CST_DTL.TRD_CD          
					 ,SR_CST_DTL.SUB_TRD_CD      
					 ,SR_CST_DTL.RLANE_CD        
					 ,SR_CST_DTL.PRC_CGO_TP_CD   
					 ,SR_CST_DTL.ORG_LOC_TP_CD   
					 ,SR_CST_DTL.ORG_LOC_DEF_CD  
					 ,SR_CST_DTL.DEST_LOC_TP_CD  
					 ,SR_CST_DTL.DEST_LOC_DEF_CD 

			)
 
			GROUP BY PRC_CTRT_NO 
		) MN
		WHERE DECODE(UPD_FLG,'Y','Y',DECODE(SCG_UPD_FLG,'Y','Y','N')) = 'Y'			]]></sql>
			<params>
			</params>
		</query>
	</querys>
</sqls>
