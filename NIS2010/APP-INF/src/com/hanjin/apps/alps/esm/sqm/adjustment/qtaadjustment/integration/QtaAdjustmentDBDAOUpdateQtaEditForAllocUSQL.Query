<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="QtaAdjustmentDBDAOUpdateQtaEditForAllocUSQL">
			<desc><![CDATA[[확정 쿼타]의 Load와 상태를 변경한다.]]></desc>
			<sql><![CDATA[
   MERGE INTO SQM_CFM_QTA A1 USING
   (
       SELECT S2.QTA_RLSE_VER_NO
            , S1.BSE_TP_CD
            , S1.BSE_YR
            , S2.BSE_QTR_CD
            , S1.OFC_VW_CD
            , S1.QTA_TGT_CD
            , S1.TRD_CD
            , S1.RLANE_CD
            , S1.DIR_CD
            , S1.VSL_CD
            , S1.SKD_VOY_NO
            , S1.SKD_DIR_CD
            , S1.RHQ_CD
            , S1.RGN_OFC_CD
            , S1.LOD_QTY
            , S1.SQM_CNG_TP_CD
            , S1.UPD_USR_ID
            , S1.UPD_DT
            , S2.CONV_DIR_CD
         FROM (
               SELECT @[bse_yr]         AS BSE_YR
                    , 'Q'               AS BSE_TP_CD
                    , 'L'               AS OFC_VW_CD
                    , 'D'               AS QTA_TGT_CD
                    , 'A'               AS SQM_CNG_TP_CD
                    , @[trd_cd]         AS TRD_CD
                    , @[rlane_cd]       AS RLANE_CD
                    , @[dir_cd]         AS DIR_CD
                    , @[vsl_cd]         AS VSL_CD
                    , @[skd_voy_no]     AS SKD_VOY_NO
                    , @[skd_dir_cd]     AS SKD_DIR_CD
                    , @[rhq_cd]         AS RHQ_CD
                    , @[rgn_ofc_cd]     AS RGN_OFC_CD
                    , @[lod_qty]        AS LOD_QTY
                    , @[upd_usr_id]     AS UPD_USR_ID
                    , SYSDATE           AS UPD_DT
                 FROM DUAL
              ) S1
            , SQM_CFM_TGT_VVD S2
        WHERE S1.BSE_TP_CD      = S2.BSE_TP_CD
          AND S1.BSE_YR         = S2.BSE_YR
          AND S1.QTA_TGT_CD     = S2.QTA_TGT_CD
          AND S1.TRD_CD         = S2.TRD_CD
          AND S1.RLANE_CD       = S2.RLANE_CD
          AND S1.DIR_CD         = S2.DIR_CD
          AND S1.VSL_CD         = S2.VSL_CD
          AND S1.SKD_VOY_NO     = S2.SKD_VOY_NO
          AND S1.SKD_DIR_CD     = S2.SKD_DIR_CD
          AND SUBSTR(S2.QTA_RLSE_VER_NO,-2) = '02'
   ) A2
   ON (
        A1.QTA_RLSE_VER_NO = A2.QTA_RLSE_VER_NO
    AND A1.BSE_TP_CD    = A2.BSE_TP_CD
    AND A1.BSE_YR       = A2.BSE_YR
    AND A1.BSE_QTR_CD   = A2.BSE_QTR_CD
    AND A1.OFC_VW_CD    = A2.OFC_VW_CD
    AND A1.QTA_TGT_CD   = A2.QTA_TGT_CD
    AND A1.TRD_CD       = A2.TRD_CD
    AND A1.RLANE_CD     = A2.RLANE_CD
    AND A1.DIR_CD       = A2.DIR_CD
    AND A1.VSL_CD       = A2.VSL_CD
    AND A1.SKD_VOY_NO   = A2.SKD_VOY_NO
    AND A1.SKD_DIR_CD   = A2.SKD_DIR_CD
    AND A1.RGN_OFC_CD   = A2.RGN_OFC_CD
   )
   WHEN MATCHED THEN
       UPDATE
          SET A1.LOD_QTY        = A2.LOD_QTY
            , A1.SQM_CNG_TP_CD  = A2.SQM_CNG_TP_CD
            , A1.UPD_USR_ID     = A2.UPD_USR_ID
            , A1.UPD_DT         = A2.UPD_DT
   WHEN NOT MATCHED THEN
       INSERT (
             A1.QTA_RLSE_VER_NO
           , A1.BSE_TP_CD
           , A1.BSE_YR
           , A1.BSE_QTR_CD
           , A1.OFC_VW_CD
           , A1.QTA_TGT_CD
           , A1.TRD_CD
           , A1.RLANE_CD
           , A1.DIR_CD
           , A1.VSL_CD
           , A1.SKD_VOY_NO
           , A1.SKD_DIR_CD
           , A1.RGN_OFC_CD
           , A1.RHQ_CD
           , A1.AQ_CD
           , A1.CONV_DIR_CD
           , A1.LOD_QTY
           , A1.GRS_RPB_REV
           , A1.PA_CM_UC_AMT
           , A1.RA_CM_UC_AMT
           , A1.SQM_CNG_TP_CD
           , A1.CRE_USR_ID
           , A1.CRE_DT
           , A1.UPD_USR_ID
           , A1.UPD_DT
           , A1.MA_SLS_YRMON
       ) VALUES (
             A2.QTA_RLSE_VER_NO
           , A2.BSE_TP_CD
           , A2.BSE_YR
           , A2.BSE_QTR_CD
           , A2.OFC_VW_CD
           , A2.QTA_TGT_CD
           , A2.TRD_CD
           , A2.RLANE_CD
           , A2.DIR_CD
           , A2.VSL_CD
           , A2.SKD_VOY_NO
           , A2.SKD_DIR_CD
           , A2.RGN_OFC_CD
           , A2.RHQ_CD
           , ''
           , A2.CONV_DIR_CD
           , A2.LOD_QTY
           , 0
           , 0
           , 0
           , A2.SQM_CNG_TP_CD
           , A2.UPD_USR_ID
           , A2.UPD_DT
           , A2.UPD_USR_ID
           , A2.UPD_DT
           , NULL
       )

			]]></sql>
			<params>
				<param name="bse_yr" type="12" value="" out="N"/>
				<param name="trd_cd" type="12" value="" out="N"/>
				<param name="rlane_cd" type="12" value="" out="N"/>
				<param name="dir_cd" type="12" value="" out="N"/>
				<param name="vsl_cd" type="12" value="" out="N"/>
				<param name="skd_voy_no" type="12" value="" out="N"/>
				<param name="skd_dir_cd" type="12" value="" out="N"/>
				<param name="rhq_cd" type="12" value="" out="N"/>
				<param name="rgn_ofc_cd" type="12" value="" out="N"/>
				<param name="lod_qty" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
