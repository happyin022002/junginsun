<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="SCRateQuotationDBDAORsltPriSurchargeAdjustLocationGroupVORSQL">
			<desc><![CDATA[   Surcharge Adjust Location Group 조회]]></desc>
			<sql><![CDATA[
WITH dstct_rout_pnt AS (
	SELECT DISTINCT rout_pnt.rout_pnt_loc_def_cd 
	, rout_pnt.qttn_no,rout_pnt.qttn_ver_no, rout_pnt.rout_pnt_loc_tp_cd ,rout_pnt.org_dest_tp_cd
	FROM pri_sq_rt_rout_pnt rout_pnt
	WHERE rout_pnt.qttn_no = @[qttn_no]
		AND rout_pnt.qttn_ver_no = @[qttn_ver_no]
		AND rout_pnt.org_dest_tp_cd = @[org_dest_tp_cd]
		AND @[select_type] = 'ORI'
),
dstct_rout_via AS (
	SELECT DISTINCT rout_via.rout_via_port_def_cd 
	, rout_via.qttn_no,rout_via.qttn_ver_no, rout_via.rout_via_port_tp_cd ,rout_via.org_dest_tp_cd
	FROM pri_sq_rt_rout_via rout_via
	WHERE rout_via.qttn_no = @[qttn_no]
		AND rout_via.qttn_ver_no = @[qttn_ver_no]
		AND rout_via.org_dest_tp_cd = @[org_dest_tp_cd]
		AND @[select_type] = 'VIA'
)
SELECT loc_def_cd , prc_grp_loc_desc
	, qttn_no,qttn_ver_no, grp_loc_seq,  rout_loc_tp_cd ,org_dest_tp_cd
FROM (
	-- Origin/Destination Begin
	SELECT rout_pnt.rout_pnt_loc_def_cd as  loc_def_cd , grp_loc.prc_grp_loc_desc as prc_grp_loc_desc
	, grp_loc.qttn_no,grp_loc.qttn_ver_no,grp_loc.grp_loc_seq, rout_pnt.rout_pnt_loc_tp_cd as rout_loc_tp_cd ,rout_pnt.org_dest_tp_cd
	FROM dstct_rout_pnt rout_pnt
		, pri_sq_grp_loc grp_loc
	WHERE  rout_pnt.rout_pnt_loc_tp_cd = 'G'
		AND rout_pnt.qttn_no = grp_loc.qttn_no
		AND rout_pnt.qttn_ver_no = grp_loc.qttn_ver_no
		AND rout_pnt.rout_pnt_loc_def_cd = grp_loc.prc_grp_loc_cd
		AND @[select_type] = 'ORI'
	UNION ALL
	SELECT mdm_loc.loc_cd  , mdm_loc.loc_nm
	, rout_pnt.qttn_no,rout_pnt.qttn_ver_no, 0 grp_loc_seq, rout_pnt.rout_pnt_loc_tp_cd,rout_pnt.org_dest_tp_cd
	FROM dstct_rout_pnt rout_pnt
	, mdm_location mdm_loc
	WHERE  rout_pnt.rout_pnt_loc_tp_cd = 'L'
		AND mdm_loc.delt_flg = 'N'
		AND rout_pnt.rout_pnt_loc_def_cd = mdm_loc.loc_cd
		AND @[select_type] = 'ORI'
	-- Origin/Destination End
	UNION ALL
	-- Origin Via/Destination Via Begin
	SELECT rout_via.rout_via_port_def_cd , grp_loc.prc_grp_loc_desc 
	, grp_loc.qttn_no,grp_loc.qttn_ver_no,grp_loc.grp_loc_seq, rout_via.rout_via_port_tp_cd as rout_loc_tp_cd ,rout_via.org_dest_tp_cd
	FROM dstct_rout_via rout_via
		, pri_sq_grp_loc grp_loc
	WHERE  rout_via.rout_via_port_tp_cd = 'G'
		AND rout_via.qttn_no = grp_loc.qttn_no
		AND rout_via.qttn_ver_no = grp_loc.qttn_ver_no
		AND rout_via.rout_via_port_def_cd = grp_loc.prc_grp_loc_cd
		AND @[select_type] = 'VIA'
	UNION ALL
	SELECT mdm_loc.loc_cd  , mdm_loc.loc_nm
	, rout_via.qttn_no,rout_via.qttn_ver_no, 0 grp_loc_seq, rout_via.rout_via_port_tp_cd,rout_via.org_dest_tp_cd
	FROM dstct_rout_via rout_via
	, mdm_location mdm_loc
	WHERE   rout_via.rout_via_port_tp_cd = 'L'
		AND mdm_loc.delt_flg = 'N'
		AND rout_via.rout_via_port_def_cd = mdm_loc.loc_cd
		AND @[select_type] = 'VIA'
	-- Origin Via/Destination Via End
)
ORDER BY loc_def_cd			]]></sql>
			<params>
				<param name="qttn_no" type="12" value="" out="N"/>
				<param name="qttn_ver_no" type="12" value="" out="N"/>
				<param name="org_dest_tp_cd" type="12" value="" out="N"/>
				<param name="select_type" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
