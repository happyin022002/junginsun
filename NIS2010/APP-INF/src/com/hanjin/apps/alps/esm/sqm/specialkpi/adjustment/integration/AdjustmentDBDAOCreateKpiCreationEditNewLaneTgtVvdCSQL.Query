<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="AdjustmentDBDAOCreateKpiCreationEditNewLaneTgtVvdCSQL">
			<desc><![CDATA[CreateKpiCreationEditNewLaneTgtVvd

* 2015.06.15 김용습 [CHM-201536164] 주간 MAS Open에 따른 타모듈 프로그램 적용 요청]]></desc>
			<sql><![CDATA[
INSERT INTO SQM_SPCL_TGT_VVD(
        BSE_TP_CD
        ,BSE_YR
        ,BSE_QTR_CD
        ,TRD_CD
        ,RLANE_CD
        ,DIR_CD
        ,VSL_CD
        ,SKD_VOY_NO
        ,SKD_DIR_CD
        ,BSE_MON
        ,BSE_WK
        ,CONV_DIR_CD
        ,SUB_TRD_CD
        ,IOC_CD
        ,FNL_BSA_CAPA
        ,CRE_USR_ID
        ,CRE_DT
        ,UPD_USR_ID
        ,UPD_DT
       )
SELECT
       @[f_bse_tp_cd] AS BSE_TP_CD
      ,@[f_bse_yr] AS BSE_YR
#if(${f_bse_tp_cd} == 'Q') --분기일때는 그대로
      ,@[f_bse_qtr_cd] AS BSE_QTR_CD
#elseif(${f_bse_tp_cd} == 'Y') -- 연간일때는 주차로 구분
      ,CASE WHEN COST_WK BETWEEN '0'  AND '13' THEN '1Q'
            WHEN COST_WK BETWEEN '14' AND '26' THEN '2Q'
            WHEN COST_WK BETWEEN '27' AND '39' THEN '3Q'
            WHEN COST_WK BETWEEN '40' AND '53' THEN '4Q'
       END BSE_QTR_CD
#else
#end
      ,A1.TRD_CD
      ,A1.RLANE_CD
      ,A1.DIR_CD
      ,A1.VSL_CD
      ,A1.SKD_VOY_NO
      ,A1.DIR_CD AS SKD_DIR_CD
      ,SUBSTR(A1.SLS_YRMON, 5,2) AS BSE_MON
      ,A1.COST_WK AS BSE_WK
      ,NVL((SELECT CONV_DIR_CD
              FROM SQM_DIR_CONV
             WHERE 1=1
               AND BSE_TP_CD  = @[f_bse_tp_cd]
               AND BSE_YR     = @[f_bse_yr]
               AND BSE_QTR_CD = @[f_bse_qtr_cd]
               AND TRD_CD     = A1.TRD_CD
               AND RLANE_CD   = A1.RLANE_CD
               AND DIR_CD     = A1.DIR_CD
            ), DIR_CD) AS CONV_DIR_CD
      ,A1.SUB_TRD_CD
      ,A1.IOC_CD
      ,NVL(A1.VVD_BSA_CAPA,0) AS FNL_BSA_CAPA
      ,@[usr_id] AS CRE_USR_ID
      ,SYSDATE   AS CRE_DT
      ,@[usr_id] AS UPD_USR_ID
      ,SYSDATE   AS  UPD_DT
  FROM MAS_MON_VVD A1
 WHERE 1=1
   AND DELT_FLG   = 'N'
   AND TRD_CD     = @[f_trd_cd]         -- NEW TRADE
   AND RLANE_CD   = @[f_rlane_cd]       -- NEW LANE
   AND SLS_YRMON  LIKE @[f_bse_yr]||'%' -- 연간일때
#if (${f_bse_tp_cd} == 'Q')
   #if (${f_bse_qtr_cd} == '1Q')
   AND COST_WK    BETWEEN '00' AND '13'
   #elseif (${f_bse_qtr_cd} == '2Q')
   AND COST_WK    BETWEEN '14' AND '26'
   #elseif (${f_bse_qtr_cd} == '3Q')
   AND COST_WK    BETWEEN '27' AND '39'
   #elseif (${f_bse_qtr_cd} == '4Q')
   AND COST_WK    BETWEEN '40' AND '53'
   #else
   #end
#end			]]></sql>
			<params>
				<param name="f_bse_tp_cd" type="12" value="" out="N"/>
				<param name="f_bse_yr" type="12" value="" out="N"/>
				<param name="f_bse_qtr_cd" type="12" value="" out="N"/>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="f_trd_cd" type="12" value="" out="N"/>
				<param name="f_rlane_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
