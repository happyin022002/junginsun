<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RFAProposalMainDBDAOPriRpRetroVOCSQL">
			<desc><![CDATA[RFA의 Creation Date가 Rate Column의 Effective Date보다 늦을 경우, 승인권자가 Approval Click 이후 Save 이전 단계에서, 
Retroactive RFA임을 알고 해당 사유를 선택하여 저장하는 기능]]></desc>
			<sql><![CDATA[
MERGE		
  INTO PRI_RP_RTRO_NOTE T 		
 USING (SELECT *		
          FROM PRI_RP_MN		
         WHERE PROP_NO = @[prop_no]		
           AND AMDT_SEQ = @[amdt_seq]		
        ) S 		
        ON ( T.PROP_NO = S.PROP_NO		
         AND T.AMDT_SEQ = S.AMDT_SEQ		
         AND T.RTRO_NOTE_SEQ = 1
            )		
WHEN MATCHED THEN		
UPDATE		
   	 SET T.RTRO_NOTE_CD = @[rtro_note_cd]		
     	,T.RTRO_NOTE_CTNT = nvl(@[rtro_note_ctnt], '')
        ,T.RTRO_NOTE_CRE_DT = SYSDATE		
     	,T.UPD_USR_ID = @[upd_usr_id]	
     	,T.UPD_DT = SYSDATE		
WHEN NOT MATCHED THEN		
	  INSERT (T.PROP_NO		
             , T.AMDT_SEQ		
             , T.RTRO_NOTE_SEQ		
             , T.RTRO_NOTE_CD		
             , T.RTRO_NOTE_CTNT		
             , T.RTRO_NOTE_CRE_DT		
             , T.CRE_USR_ID		
             , T.CRE_DT		
             , T.UPD_USR_ID		
             , T.UPD_DT)		
	   VALUES (@[prop_no]
             , @[amdt_seq]
             , 1		
             , @[rtro_note_cd]	
             , nvl(@[rtro_note_ctnt], '')
             , SYSDATE		
             , @[cre_usr_id]
             , SYSDATE		
             , @[upd_usr_id]
             , SYSDATE)			]]></sql>
			<params>
				<param name="prop_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="12" value="" out="N"/>
				<param name="rtro_note_cd" type="12" value="" out="N"/>
				<param name="rtro_note_ctnt" type="12" value="" out="N"/>
				<param name="upd_usr_id" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
