<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UsaManifestListDownloadDBDAOmodifyContainerSealNoUSQL">
			<desc><![CDATA[modifyContainerSealNo]]></desc>
			<sql><![CDATA[
MERGE INTO BKG_CSTMS_SEAL_NO T1
USING ( 
    SELECT  @[cnt_cd] AS CNT_CD
		   ,NVL(@[cstms_div_id],'CTM') AS CSTMS_DIV_ID
           ,@[bl_no] AS BL_NO
           ,@[cntr_no] AS CNTR_NO 
           ,@[seal_no_seq] AS SEAL_NO_SEQ
    FROM DUAL 
) T2
ON ( T1.CNT_CD  = T2.CNT_CD AND
	 T1.CSTMS_DIV_ID = T2.CSTMS_DIV_ID AND
	 T1.BL_NO   = T2.BL_NO AND
	 T1.CNTR_NO = T2.CNTR_NO AND
	 T1.SEAL_NO_SEQ = T2.SEAL_NO_SEQ
)
WHEN MATCHED THEN
        UPDATE     
        SET      SEAL_NO = @[seal_no]
        ,        UPD_USR_ID = @[usr_id]
        ,        UPD_DT = SYSDATE
WHEN NOT MATCHED THEN
        INSERT ( CNT_CD
                ,CSTMS_DIV_ID
                ,BL_NO
                ,CNTR_NO
                ,SEAL_NO_SEQ
                ,SEAL_NO
                ,CRE_USR_ID
                ,CRE_DT
                ,UPD_USR_ID
                ,UPD_DT )
        VALUES ( @[cnt_cd]
                ,NVL(@[cstms_div_id],'CTM')
                ,@[bl_no]
                ,@[cntr_no]
                ,NVL((SELECT /*+ index_desc(A XPKBKG_CSTMS_SEAL_NO SL) */   
                             SEAL_NO_SEQ 
                      FROM   BKG_CSTMS_SEAL_NO A
                      WHERE  1=1
                      AND	 CNT_CD = @[cnt_cd]
                      AND    CSTMS_DIV_ID = NVL(@[cstms_div_id],'CTM')  
                      AND    BL_NO = @[bl_no]  
                      AND    CNTR_NO = @[cntr_no] 
                      AND    ROWNUM = 1   
                    ),0)+1
                ,@[seal_no]
                ,@[usr_id]
                ,SYSDATE
                ,@[usr_id]
                ,SYSDATE )			]]></sql>
			<params>
				<param name="cnt_cd" type="12" value="" out="N"/>
				<param name="cstms_div_id" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="cntr_no" type="12" value="" out="N"/>
				<param name="seal_no_seq" type="12" value="" out="N"/>
				<param name="seal_no" type="12" value="" out="N"/>
				<param name="usr_id" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
