<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TransferOrderIssueDBDAOSearchArbitraryRevChkRSQL">
			<desc><![CDATA[TransferOrderIssueDBDAOSearchArbitraryRevChk]]></desc>
			<sql><![CDATA[
SELECT ARB.CURR_CD GLINE_CURR_CD, 
       ARB.FNL_FRT_RT_AMT GLINE_REV_AMT
FROM PRI_RP_SCP_TRSP_ADD_CHG ARB,
     (SELECT RS.PROP_NO, RS.AMDT_SEQ, BK.SVC_SCP_CD, 
             DECODE(@[io_bnd_cd], 'O',BK.RCV_TERM_CD, 'I',BK.DE_TERM_CD) TERM_CD,
             BK.AGMT_ACT_CNT_CD, BK.AGMT_ACT_CUST_SEQ
        FROM BKG_BOOKING BK, BKG_RATE BR, PRI_RP_HDR RH, PRI_RP_MN RM, PRI_RP_SCP_MN RS
        WHERE BK.BKG_NO = @[bkg_no]
        AND BK.BKG_NO = BR.BKG_NO
        AND RH.RFA_NO = BK.RFA_NO
        AND RM.PROP_NO = RH.PROP_NO
        AND RM.PROP_STS_CD = 'A'
        AND RS.PROP_NO = RM.PROP_NO
        AND RS.AMDT_SEQ = RM.AMDT_SEQ
        AND RS.SVC_SCP_CD = BK.SVC_SCP_CD
        AND BR.RT_APLY_DT BETWEEN RS.EFF_DT AND RS.EXP_DT) CON
WHERE ARB.PROP_NO = CON.PROP_NO
AND ARB.AMDT_SEQ = CON.AMDT_SEQ
AND ARB.SVC_SCP_CD = CON.SVC_SCP_CD
AND ARB.ADD_CHG_TP_CD = 'A'  
AND ARB.ORG_DEST_TP_CD = DECODE(@[io_bnd_cd], 'O','O','I','D')  
AND ARB.SRC_INFO_CD <> 'AD'  
AND (ARB.CUST_CNT_CD IS NULL  
     OR (ARB.CUST_CNT_CD = CON.AGMT_ACT_CNT_CD  AND ARB.CUST_SEQ = CON.AGMT_ACT_CUST_SEQ))
AND (ARB.RAT_UT_CD IN ( 'BX', @[cntr_tpsz_cd])
    OR  (
            ARB.RAT_UT_CD  IN ( '20', '40', 'HC', '45', '53' )  
        AND ( SELECT A.CNTR_SZ_CD FROM PRI_RAT_UT A WHERE A.RAT_UT_CD = ARB.RAT_UT_CD ) = @[cntr_tpsz_cd]
        )  
    )
AND NVL(ARB.PRC_CGO_TP_CD, '*') IN ('*', DECODE(@[dg_flag],'Y','DG'), DECODE(@[rf_flag],'Y','RF'), 
                                    DECODE(@[awk_flag],'Y','AK'),DECODE(@[dg_flag]||@[rf_flag]||@[awk_flag],'NNN','DR'))
AND (ARB.PRC_TRSP_MOD_CD IS NULL  
    OR @[trsp_mode_cd]   IS NULL
    OR ARB.PRC_TRSP_MOD_CD = @[trsp_mode_cd]
    OR (ARB.PRC_TRSP_MOD_CD IN ('R','A') AND @[trsp_mode_cd] IN ('R','A'))  
    OR (ARB.PRC_TRSP_MOD_CD IN ('E','T') AND @[trsp_mode_cd] IN ('E','T'))  
    OR (ARB.PRC_TRSP_MOD_CD IN ('U','T') AND @[trsp_mode_cd] IN ('U','T')))  

AND (ARB.ROUT_PNT_LOC_TP_CD, ARB.ROUT_PNT_LOC_DEF_CD) 
    IN (SELECT  'L', @[pnt_loc_cd]
         FROM    DUAL  
         UNION ALL  
         SELECT  'G', G.PRC_GRP_LOC_CD  
         FROM  PRI_RP_SCP_GRP_LOC G ,PRI_RP_SCP_GRP_LOC_DTL  D
         WHERE D.PROP_NO = G.PROP_NO
         AND D.AMDT_SEQ = G.AMDT_SEQ
         AND D.SVC_SCP_CD = G.SVC_SCP_CD
         AND D.GRP_LOC_SEQ = G.GRP_LOC_SEQ
         AND D.SRC_INFO_CD <> 'AD'
         AND G.PROP_NO = CON.PROP_NO
         AND G.AMDT_SEQ = CON.AMDT_SEQ
         AND G.SVC_SCP_CD = CON.SVC_SCP_CD 
         AND D.LOC_CD = @[pnt_loc_cd])
AND (ARB.BSE_PORT_TP_CD, ARB.BSE_PORT_DEF_CD)  
IN (SELECT  'L', @[bse_port_loc_cd]
         FROM    DUAL  
         UNION ALL  
         SELECT  'G', G.PRC_GRP_LOC_CD  
         FROM  PRI_RP_SCP_GRP_LOC G ,PRI_RP_SCP_GRP_LOC_DTL  D
         WHERE D.PROP_NO = G.PROP_NO
         AND D.AMDT_SEQ = G.AMDT_SEQ
         AND D.SVC_SCP_CD = G.SVC_SCP_CD
         AND D.GRP_LOC_SEQ = G.GRP_LOC_SEQ
         AND D.SRC_INFO_CD <> 'AD'
         AND G.PROP_NO = CON.PROP_NO
         AND G.AMDT_SEQ = CON.AMDT_SEQ
         AND G.SVC_SCP_CD = CON.SVC_SCP_CD 
         AND D.LOC_CD = @[bse_port_loc_cd])
AND ROWNUM =1 			]]></sql>
			<params>
				<param name="io_bnd_cd" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="cntr_tpsz_cd" type="12" value="" out="N"/>
				<param name="dg_flag" type="12" value="" out="N"/>
				<param name="rf_flag" type="12" value="" out="N"/>
				<param name="awk_flag" type="12" value="" out="N"/>
				<param name="trsp_mode_cd" type="12" value="" out="N"/>
				<param name="pnt_loc_cd" type="12" value="" out="N"/>
				<param name="bse_port_loc_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
