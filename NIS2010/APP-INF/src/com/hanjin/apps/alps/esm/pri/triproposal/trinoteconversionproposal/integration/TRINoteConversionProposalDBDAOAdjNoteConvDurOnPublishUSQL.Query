<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TRINoteConversionProposalDBDAOAdjNoteConvDurOnPublishUSQL">
			<desc><![CDATA[Publish할때 날짜에 맞춰 Conversion Duration을  맞춰주는 작업]]></desc>
			<sql><![CDATA[
MERGE INTO PRI_TRI_NOTE_CONV A
USING (SELECT N.NOTE_CONV_MAPG_ID
             ,EFF_DT AS OLD_EFF_DT
             ,TO_DATE(@[pub_dt], 'YYYY-MM-DD') AS EFF_DT
             ,EXP_DT
         FROM PRI_TRI_RT N
        WHERE N.TRI_PROP_NO = @[tri_prop_no]
          AND N.AMDT_SEQ = @[amdt_seq]
      ) B
ON (A.NOTE_CONV_MAPG_ID = B.NOTE_CONV_MAPG_ID)
WHEN MATCHED THEN
  UPDATE
     SET A.EFF_DT = DECODE(A.EFF_DT, B.OLD_EFF_DT, B.EFF_DT, GREATEST(A.EFF_DT, B.EFF_DT))
--   WHERE (A.EFF_DT BETWEEN B.EFF_DT AND B.EXP_DT OR A.EXP_DT BETWEEN B.EFF_DT AND B.EXP_DT OR
--         (A.EFF_DT <= B.EFF_DT AND A.EXP_DT > B.EXP_DT))
  DELETE
   WHERE (A.EFF_DT > B.EXP_DT OR A.EXP_DT < B.EFF_DT)
     AND (A.NOTE_CONV_RULE_CD IS NULL OR A.NOTE_CONV_RULE_CD <> 'APP')			]]></sql>
			<params>
				<param name="pub_dt" type="12" value="" out="N"/>
				<param name="tri_prop_no" type="12" value="" out="N"/>
				<param name="amdt_seq" type="2" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
