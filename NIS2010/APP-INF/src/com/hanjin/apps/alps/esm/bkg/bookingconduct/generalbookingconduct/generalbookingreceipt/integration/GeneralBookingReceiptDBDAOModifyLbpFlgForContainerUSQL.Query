<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GeneralBookingReceiptDBDAOModifyLbpFlgForContainerUSQL">
			<desc><![CDATA[1) OLBP 일 경우 
       1-1) POD = US 이면서 Rail 이 아닐 경우 => LBP Flag : Y
       1-2) POD = CA 이면서 Rail 일 경우       => LBP Flag : Y
       1-3) 그 외의 경우                               => LBP Flag : N
2) 그 외의 경우 					      => LBP Flag : N

]]></desc>
			<sql><![CDATA[
#if (${ca_flg} == 'Y')
UPDATE BKG_CNTR_HIS
#else
UPDATE BKG_CONTAINER
#end
#if (${ca_flg} == 'Y')
SET LBP_FLG = 
(
    SELECT 
        CASE A.STWG_CD
            WHEN 'OLBP' THEN 
                  CASE A.POD_CD
                        WHEN 'US' THEN 
                                    CASE DEST_TRNS_MOD_CD 
                                         WHEN 'R' THEN 'N'
                                         ELSE 'Y'
                                         END
                        WHEN 'CA' THEN
                                    CASE DEST_TRNS_MOD_CD 
                                         WHEN 'R' THEN 'Y'
                                         ELSE 'N'
                                         END
						ELSE 'N'
                  END 
                        
            ELSE 'N'
        END LBP_FLG
    FROM (
                    SELECT DEST_TRNS_MOD_CD, SUBSTR(POD_CD,0,2) POD_CD, STWG_CD
                    FROM BKG_BKG_HIS
                    WHERE BKG_NO = @[bkg_no]
                     AND CORR_NO = 'TMP0000001'
         ) A
)
#else
SET LBP_FLG = 
(
    SELECT 
        CASE A.STWG_CD
            WHEN 'OLBP' THEN 
                  CASE A.POD_CD
                        WHEN 'US' THEN 
                                    CASE DEST_TRNS_MOD_CD 
                                         WHEN 'R' THEN 'N'
                                         ELSE 'Y'
                                         END
                        WHEN 'CA' THEN
                                    CASE DEST_TRNS_MOD_CD 
                                         WHEN 'R' THEN 'Y'
                                         ELSE 'N'
                                         END
						ELSE 'N'
                  END 
                        
            ELSE 'N'
        END LBP_FLG
    FROM (
                    SELECT DEST_TRNS_MOD_CD, SUBSTR(POD_CD,0,2) POD_CD, STWG_CD
                    FROM BKG_BOOKING
                    WHERE BKG_NO = @[bkg_no]
         ) A
)
#end
WHERE BKG_NO = @[bkg_no]
#if (${ca_flg} == 'Y')
AND   CORR_NO = 'TMP0000001'
#end			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
