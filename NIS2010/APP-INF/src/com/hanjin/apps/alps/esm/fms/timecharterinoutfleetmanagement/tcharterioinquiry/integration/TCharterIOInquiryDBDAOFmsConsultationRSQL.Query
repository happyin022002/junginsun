<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="TCharterIOInquiryDBDAOFmsConsultationRSQL">
			<desc><![CDATA[Statement of Account Select]]></desc>
			<sql><![CDATA[
SELECT NUM, 
	   ITM_NM, 
	   HIRE_NO,
	   ACCT_DT,
       ACCT_DESC,
       CURR_CD1,
       DR_AMT,
       CURR_CD2,
       CR_AMT
FROM
(
SELECT '11' NUM,
	   '1. Prepayment - Hire' ITM_NM,
	   '1. Prepayment - Hire' HIRE_NO,
	   '1. Prepayment - Hire' ACCT_DT,
	   '1. Prepayment - Hire' ACCT_DESC,
	   '' CURR_CD1,
	   '' DR_AMT,
	   '' CURR_CD2,
	   '' CR_AMT
  FROM DUAL
UNION ALL
SELECT '12' NUM,
	   B.ACCT_ITM_NM ITM_NM,
       TO_CHAR(D.PPAY_HIR_NO) HIRE_NO,
	   TO_CHAR(A.EFF_DT,'yyyy-mm-dd HH24:MI') || ' ~ ' || TO_CHAR(A.EXP_DT,'yyyy-mm-dd HH24:MI') ACCT_DT,
	   A.INV_DESC ACCT_DESC,
	   A.CURR_CD CURR_CD1,
	   TO_CHAR(A.INV_AMT) DR_AMT,
	   '' CURR_CD2,
	   '' CR_AMT
  FROM FMS_INVOICE D,
	   FMS_INV_DTL A,
  	   FMS_ACCT_ITM B
 WHERE D.FLET_CTRT_NO = A.FLET_CTRT_NO
   AND D.FLET_ISS_TP_CD = A.FLET_ISS_TP_CD
   AND D.INV_SEQ = A.INV_SEQ
   AND D.FLET_CTRT_NO = @[flet_ctrt_no]
   AND A.FLET_CTRT_NO = @[flet_ctrt_no]
   AND A.FLET_ISS_TP_CD = 'PRE'
   AND A.ACCT_CD = '510911'
   AND (A.SLP_TP_CD LIKE '19%' OR A.SLP_TP_CD LIKE '07%' OR A.SLP_TP_CD LIKE '20%')
   AND A.ACCT_CD = B.ACCT_CD
   AND A.ACCT_ITM_SEQ = B.ACCT_ITM_SEQ
   AND B.ACCT_CD = '510911'
#if (${hir_no} != '') 
   AND D.PPAY_HIR_NO = @[hir_no]
#end
UNION ALL
SELECT '21' NUM,
	   '2. Prepayment - Other’s Expenses / Lumpsum' ITM_NM,
	   '2. Prepayment - Other’s Expenses / Lumpsum' HIRE_NO,
	   '2. Prepayment - Other’s Expenses / Lumpsum' ACCT_DT,
	   '2. Prepayment - Other’s Expenses / Lumpsum' ACCT_DESC,
	   '' CURR_CD1,
	   '' DR_AMT,
	   '' CURR_CD2,
	   '' CR_AMT
  FROM DUAL
UNION ALL
SELECT '22' NUM,
	   B.ACCT_ITM_NM ITM_NM,
	   TO_CHAR(C.PPAY_HIR_NO) HIRE_NO,
	   TO_CHAR(A.EFF_DT,'yyyy-mm-dd HH24:MI') || ' ~ ' || TO_CHAR(A.EXP_DT,'yyyy-mm-dd HH24:MI') ACCT_DT,
	   A.INV_DESC ACCT_DESC,
	   A.CURR_CD CURR_CD1,
	   TO_CHAR(A.INV_AMT) DR_AMT,
	   '' CURR_CD2,
	   '' CR_AMT
  FROM FMS_INV_DTL A,
  	   FMS_ACCT_ITM B,
       FMS_INVOICE C
 WHERE A.FLET_CTRT_NO = @[flet_ctrt_no]
   AND A.FLET_ISS_TP_CD = 'PRE'
   AND (A.SLP_TP_CD LIKE '19%' OR A.SLP_TP_CD LIKE '07%' OR A.SLP_TP_CD LIKE '20%')
   AND A.FLET_CTRT_NO = C.FLET_CTRT_NO
   AND A.FLET_ISS_TP_CD = C.FLET_ISS_TP_CD
   AND A.INV_SEQ = C.INV_SEQ
   AND A.ACCT_CD = B.ACCT_CD
   AND A.ACCT_ITM_SEQ = B.ACCT_ITM_SEQ
#if (${hir_no} != '') 
   AND C.PPAY_HIR_NO = @[hir_no]
#end
   AND A.ACCT_CD <> '510911'
UNION ALL
SELECT '31' NUM,
	   '3. Off-Hire' ITM_NM,
	   '3. Off-Hire' HIRE_NO,
	   '3. Off-Hire' ACCT_DT,
	   '3. Off-Hire' ACCT_DESC,
	   '' CURR_CD1,
	   '' DR_AMT,
	   '' CURR_CD2,
	   '' CR_AMT
  FROM DUAL
UNION ALL
SELECT '32' NUM,
	   B.ACCT_ITM_NM ITM_NM,
	   TO_CHAR(C.PPAY_HIR_NO) HIRE_NO,
	   TO_CHAR(A.EFF_DT,'yyyy-mm-dd HH24:MI') || ' ~ ' || TO_CHAR(A.EXP_DT,'yyyy-mm-dd HH24:MI') ACCT_DT,
	   A.INV_DESC ACCT_DESC,
	   '' CURR_CD1,
	   '' DR_AMT,
	   A.CURR_CD CURR_CD2,
       TO_CHAR(A.INV_AMT) CR_AMT
  FROM FMS_INV_DTL A,
  	   FMS_ACCT_ITM B,
	   FMS_CONSULTATION C
 WHERE A.FLET_CTRT_NO = @[flet_ctrt_no]
   AND A.FLET_ISS_TP_CD = 'OFF'
   AND (A.SLP_TP_CD LIKE '19%' OR A.SLP_TP_CD LIKE '07%' OR A.SLP_TP_CD LIKE '20%')
   AND A.ACCT_CD = B.ACCT_CD
   AND A.ACCT_ITM_SEQ = B.ACCT_ITM_SEQ
   AND A.SLP_TP_CD = C.SLP_TP_CD(+)
   AND A.SLP_FUNC_CD = C.SLP_FUNC_CD(+)
   AND A.SLP_OFC_CD = C.SLP_OFC_CD(+)
   AND A.SLP_ISS_DT = C.SLP_ISS_DT(+)
   AND A.SLP_SER_NO = C.SLP_SER_NO(+)
#if (${hir_no} != '') 
   AND C.PPAY_HIR_NO = @[hir_no]
#end
UNION ALL
SELECT '41' NUM,
	   '4. Account Management' ITM_NM,
	   '4. Account Management' HIRE_NO,
	   '4. Account Management' ACCT_DT,
	   '4. Account Management' ACCT_DESC,
	   '' CURR_CD1,
	   '' DR_AMT,
	   '' CURR_CD2,
	   '' CR_AMT
  FROM DUAL
UNION ALL
SELECT '42' NUM,
	   B.ACCT_ITM_NM ITM_NM,
	   TO_CHAR(C.PPAY_HIR_NO) HIRE_NO,
	   (SUBSTR(A.CHTR_INV_DT,1,4) || '-' || SUBSTR(A.CHTR_INV_DT,5,2) || '-' || SUBSTR(A.CHTR_INV_DT,7,2)) ACCT_DT,
	   A.INV_DESC ACCT_DESC,
	   A.CURR_CD CURR_CD1,
       DECODE(A.CHTR_PAY_RCV_CD,'P',TO_CHAR(A.INV_AMT),TO_CHAR(A.INV_AMT * -1)) DR_AMT,
	   '' CURR_CD2,
	   '' CR_AMT
  FROM FMS_INV_DTL A,
  	   FMS_ACCT_ITM B,
	   FMS_CONSULTATION C
 WHERE A.FLET_CTRT_NO = @[flet_ctrt_no]
   AND A.FLET_ISS_TP_CD = 'CHT'
   AND (A.SLP_TP_CD LIKE '19%' OR A.SLP_TP_CD LIKE '07%' OR A.SLP_TP_CD LIKE '20%')
   AND A.ACCT_CD = B.ACCT_CD
   AND A.ACCT_ITM_SEQ = B.ACCT_ITM_SEQ
   AND A.SLP_TP_CD = C.SLP_TP_CD(+)
   AND A.SLP_FUNC_CD = C.SLP_FUNC_CD(+)
   AND A.SLP_OFC_CD = C.SLP_OFC_CD(+)
   AND A.SLP_ISS_DT = C.SLP_ISS_DT(+)
   AND A.SLP_SER_NO = C.SLP_SER_NO(+)
#if (${hir_no} != '') 
   AND C.PPAY_HIR_NO = @[hir_no]
#end
UNION ALL
SELECT '51' NUM,
	   '5. Owner''s Account' ITM_NM,
	   '5. Owner''s Account' HIRE_NO,
	   '5. Owner''s Account' ACCT_DT,
	   '5. Owner''s Account' ACCT_DESC,
	   '' CURR_CD1,
	   '' DR_AMT,
	   '' CURR_CD2,
	   '' CR_AMT
  FROM DUAL
UNION ALL
SELECT DISTINCT 
       '52' NUM,
       'Owner''s Account' ITM_NM,
       TO_CHAR(PPAY_HIR_NO) HIRE_NO,
       '' ACCT_DT,
       ACCT_DESC,
 	   '' CURR_CD1,
	   '' DR_AMT,     
       'USD' CURR_CD2,
       TO_CHAR(CR_AMT) CR_AMT
  FROM (SELECT D.AP_DESC ACCT_DESC,
     	       D.N1ST_AMT CR_AMT,
               C.PPAY_HIR_NO PPAY_HIR_NO
          FROM FMS_CSUL_SLP B, 
               FMS_CONSULTATION C, 
               FMS_OWNR_ACCT_SLP D
         WHERE C.SLP_TP_CD = B.SLP_TP_CD
           AND C.SLP_FUNC_CD = B.SLP_FUNC_CD
           AND C.SLP_OFC_CD = B.SLP_OFC_CD
           AND C.SLP_ISS_DT = B.SLP_ISS_DT
           AND C.SLP_SER_NO = B.SLP_SER_NO  
           AND D.SLP_TP_CD = B.AP_SLP_TP_CD
           AND D.SLP_FUNC_CD = B.AP_SLP_FUNC_CD
           AND D.SLP_OFC_CD = B.AP_SLP_OFC_CD
           AND D.SLP_ISS_DT = B.AP_SLP_ISS_DT
           AND D.SLP_SER_NO = B.AP_SLP_SER_NO 
           AND D.SLP_SEQ_NO = B.AP_SLP_SEQ_NO
           AND D.CSR_SLP_FLG = 'Y'
           AND D.FLET_PPAY_RLT_CD = 'O'
           AND D.ACCT_CD = '111071'
           AND C.FLET_CTRT_NO = @[flet_ctrt_no]
#if (${hir_no} != '') 
           AND C.PPAY_HIR_NO = @[hir_no]
#end
        UNION ALL
        SELECT A.AP_DESC ACCT_DESC,
      	       A.N1ST_AMT CR_AMT,
               B.PPAY_HIR_NO PPAY_HIR_NO
          FROM FMS_OWNR_ACCT_SLP A, FMS_CONSULTATION B  
         WHERE A.CSUL_SLP_TP_CD = B.SLP_TP_CD
           AND A.CSUL_SLP_FUNC_CD = B.SLP_FUNC_CD
           AND A.CSUL_SLP_OFC_CD = B.SLP_OFC_CD
           AND A.CSUL_SLP_ISS_DT = B.SLP_ISS_DT 
           AND A.CSUL_SLP_SER_NO = B.SLP_SER_NO  
           AND A.CSR_SLP_FLG = 'Y'
           AND A.FLET_PPAY_RLT_CD = 'O'
           AND A.ACCT_CD = '111071'
           AND B.FLET_CTRT_NO = @[flet_ctrt_no]
#if (${hir_no} != '') 
           AND B.PPAY_HIR_NO = @[hir_no]
#end
       )
UNION ALL
SELECT '61' NUM,
	   '6. Bunker On Delivery' ITM_NM,
	   '6. Bunker On Delivery' HIRE_NO,
	   '6. Bunker On Delivery' ACCT_DT,
	   '6. Bunker On Delivery' ACCT_DESC,
	   '' CURR_CD1,
	   '' DR_AMT,
	   '' CURR_CD2,
	   '' CR_AMT
  FROM DUAL
UNION ALL
SELECT '62' NUM,
	   C.ACCT_ITM_NM ITM_NM,
	   TO_CHAR(B.PPAY_HIR_NO) HIRE_NO,
	   TO_CHAR(BNK_DT,'yyyy-mm-dd') ACCT_DT,
	   B.CSR_DESC ACCT_DESC,
	   B.CSR_CURR_CD CURR_CD1,
	   TO_CHAR(A.BNK_QTY*A.BNK_PRC_AMT) DR_AMT,
	   '' CURR_CD2,
	   '' CR_AMT
  FROM FMS_BUNKER A,
  	   FMS_CONSULTATION B,
	   FMS_ACCT_ITM C,
	   FMS_ACCT_CATE D
 WHERE A.SLP_TP_CD = B.SLP_TP_CD
   AND A.SLP_FUNC_CD = B.SLP_FUNC_CD
   AND A.SLP_OFC_CD = B.SLP_OFC_CD
   AND A.SLP_ISS_DT = B.SLP_ISS_DT
   AND A.SLP_SER_NO = B.SLP_SER_NO
   AND A.BNK_TP_CD = 'BOD'
   AND B.APRO_FLG = 'Y'
   AND B.FLET_CTRT_NO = @[flet_ctrt_no]
#if (${hir_no} != '') 
   AND B.PPAY_HIR_NO = @[hir_no]
#end
   AND A.ACCT_CD = C.ACCT_CD
   AND A.ACCT_ITM_SEQ = C.ACCT_ITM_SEQ
   AND A.ACCT_CD = D.ACCT_CD
   AND A.ACCT_ITM_SEQ = D.ACCT_ITM_SEQ
   AND D.FLET_ACCT_CATE_CD = 'BU'
UNION ALL
SELECT '71' NUM,
	   '7. Bunker On Redelivery' ITM_NM,
	   '7. Bunker On Redelivery' HIRE_NO,
	   '7. Bunker On Redelivery' ACCT_DT,
	   '7. Bunker On Redelivery' ACCT_DESC,
	   '' CURR_CD1,
	   '' DR_AMT,
	   '' CURR_CD2,
	   '' CR_AMT
  FROM DUAL
UNION ALL
SELECT '72' NUM,
	   C.ACCT_ITM_NM ITM_NM,
	   TO_CHAR(B.PPAY_HIR_NO) HIRE_NO,
	   TO_CHAR(BNK_DT,'yyyy-mm-dd') ACCT_DT,
	   B.CSR_DESC ACCT_DESC,
	   '' CURR_CD1,
	   '' DR_AMT,
	   B.CSR_CURR_CD CURR_CD2,
	   TO_CHAR(A.BNK_QTY*A.BNK_PRC_AMT) CR_AMT
  FROM FMS_BUNKER A,
  	   FMS_CONSULTATION B,
	   FMS_ACCT_ITM C,
	   FMS_ACCT_CATE D
 WHERE A.SLP_TP_CD = B.SLP_TP_CD
   AND A.SLP_FUNC_CD = B.SLP_FUNC_CD
   AND A.SLP_OFC_CD = B.SLP_OFC_CD
   AND A.SLP_ISS_DT = B.SLP_ISS_DT
   AND A.SLP_SER_NO = B.SLP_SER_NO
   AND A.BNK_TP_CD = 'BOR'
   AND B.APRO_FLG = 'Y'
   AND B.FLET_CTRT_NO = @[flet_ctrt_no]
#if (${hir_no} != '') 
   AND B.PPAY_HIR_NO = @[hir_no]
#end
   AND A.ACCT_CD = C.ACCT_CD
   AND A.ACCT_ITM_SEQ = C.ACCT_ITM_SEQ
   AND A.ACCT_CD = D.ACCT_CD
   AND A.ACCT_ITM_SEQ = D.ACCT_ITM_SEQ
   AND D.FLET_ACCT_CATE_CD = 'BU'
UNION ALL
SELECT '81' NUM,
	   '8. Others' ITM_NM,
	   '8. Others' HIRE_NO,
	   '8. Others' ACCT_DT,
	   '8. Others' ACCT_DESC,
	   '' CURR_CD1,
	   '' DR_AMT,
	   '' CURR_CD2,
	   '' CR_AMT
  FROM DUAL
UNION ALL
SELECT '82' NUM,
	   AA.ITM_NM,
	   AA.HIRE_NO,
	   AA.ACCT_DT,
	   AA.ACCT_DESC,
	   AA.CURR_CD1,
	   AA.DR_AMT DR_AMT,
	   AA.CURR_CD2,
	   AA.CR_AMT CR_AMT
  FROM (SELECT C.ACCT_ENG_NM ITM_NM,
	   		   '' HIRE_NO,
	   		   (SUBSTR(A.EFF_DT,1,4) || '-' || SUBSTR(A.EFF_DT,5,2) || '-' || SUBSTR(A.EFF_DT,7,2)) ACCT_DT,
	   		   B.CSR_DESC ACCT_DESC,
	   		   B.CSR_CURR_CD CURR_CD1,
	   		   TO_CHAR(SUM(B.CSR_AMT)) DR_AMT,
	   		   '' CURR_CD2,
	   		   '' CR_AMT
  		  FROM FMS_CONSULTATION A,
		  	   FMS_CSUL_SLP B,
			   MDM_ACCOUNT C
 		 WHERE A.SLP_TP_CD = B.SLP_TP_CD
		   AND A.SLP_FUNC_CD = B.SLP_FUNC_CD
		   AND A.SLP_OFC_CD = B.SLP_OFC_CD
		   AND A.SLP_ISS_DT = B.SLP_ISS_DT
		   AND A.SLP_SER_NO = B.SLP_SER_NO
		   AND B.CSR_AMT >= 0
           AND B.FLET_SRC_TP_CD IN ('10', '11', '20', '98', '99')
		   --AND B.ACCT_CD NOT IN ('954112', '241121')
		   --AND A.PPAY_HIR_NO IS NULL
   		   AND A.APRO_FLG = 'Y'
		   AND A.FLET_CTRT_NO = @[flet_ctrt_no]
#if (${hir_no} != '') 
   		   AND A.PPAY_HIR_NO = @[hir_no]
#end
		   AND A.VAT_SLP_TP_CD IS NULL
	  	   AND B.ACCT_CD = C.ACCT_CD
 		 GROUP BY C.ACCT_ENG_NM, EFF_DT, B.CSR_DESC, B.CSR_CURR_CD
		 UNION ALL
		 SELECT C.ACCT_ENG_NM ITM_NM,
	   		   '' HIRE_NO,
	   		   (SUBSTR(A.EFF_DT,1,4) || '-' || SUBSTR(A.EFF_DT,5,2) || '-' || SUBSTR(A.EFF_DT,7,2)) ACCT_DT,
	   		   B.CSR_DESC ACCT_DESC,
	   		   '' CURR_CD1,
	   		   '' DR_AMT,
	   		   B.CSR_CURR_CD CURR_CD2,
	   		   TO_CHAR(SUM(B.CSR_AMT)*-1) CR_AMT
  		  FROM FMS_CONSULTATION A,
		  	   FMS_CSUL_SLP B,
			   MDM_ACCOUNT C
 		 WHERE A.SLP_TP_CD = B.SLP_TP_CD
		   AND A.SLP_FUNC_CD = B.SLP_FUNC_CD
		   AND A.SLP_OFC_CD = B.SLP_OFC_CD
		   AND A.SLP_ISS_DT = B.SLP_ISS_DT
		   AND A.SLP_SER_NO = B.SLP_SER_NO
		   AND B.CSR_AMT < 0
           AND B.FLET_SRC_TP_CD IN ('10', '11', '20', '98', '99')
		   --AND B.ACCT_CD NOT IN ('954112', '241121')
		   --AND A.PPAY_HIR_NO IS NULL
   		   AND A.APRO_FLG = 'Y'
		   AND A.FLET_CTRT_NO = @[flet_ctrt_no]
#if (${hir_no} != '') 
   		   AND A.PPAY_HIR_NO = @[hir_no]
#end
		   AND A.VAT_SLP_TP_CD IS NULL
	  	   AND B.ACCT_CD = C.ACCT_CD
 		 GROUP BY C.ACCT_ENG_NM, EFF_DT, B.CSR_DESC, B.CSR_CURR_CD) AA
)
ORDER BY NUM,ITM_NM,DECODE(TRANSLATE(HIRE_NO,'ABCDEFGHIJKLMNOPQRSTUVWXYZ-.0123456789','ABCDEFGHIJKLMNOPQRSTUVWXYZ'),NULL,TO_NUMBER(HIRE_NO),0),ACCT_DT			]]></sql>
			<params>
				<param name="flet_ctrt_no" type="12" value="" out="N"/>
				<param name="hir_no" type="2" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
