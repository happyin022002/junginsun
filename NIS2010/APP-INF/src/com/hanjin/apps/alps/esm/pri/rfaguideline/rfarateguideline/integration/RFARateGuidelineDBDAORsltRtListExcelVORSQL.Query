<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="RFARateGuidelineDBDAORsltRtListExcelVORSQL">
			<desc><![CDATA[Rate 엑셀 조회]]></desc>
			<sql><![CDATA[
SELECT A.SVC_SCP_CD,
       A.GLINE_SEQ,
       A.CMDT_HDR_SEQ,
       TO_CHAR(A.EFF_DT, 'YYYY-MM-DD') AS EFF_DT,
       TO_CHAR(A.EXP_DT, 'YYYY-MM-DD') AS EXP_DT,
       B.CMDT_SEQ,
       B.PRC_CMDT_DEF_CD,
       C.ROUT_SEQ,
--       C.DIR_CALL_FLG,
       E.ROUT_PNT_LOC_DEF_CD AS ORG_ROUT_PNT_LOC_DEF_CD,
       F.ROUT_VIA_PORT_DEF_CD AS ORG_ROUT_VIA_PORT_DEF_CD,
       G.ROUT_VIA_PORT_DEF_CD AS DEST_ROUT_VIA_PORT_DEF_CD,
       H.ROUT_PNT_LOC_DEF_CD AS DEST_ORG_ROUT_PNT_LOC_DEF_CD,
       D.RT_SEQ,
--       D.MQC_RNG_FM_QTY,
--       D.MQC_RNG_TO_QTY,
       D.RAT_UT_CD,
       D.PRC_CGO_TP_CD,
       D.CURR_CD,
       D.FRT_RT_AMT
  FROM PRI_RG_RT_CMDT_HDR A,
       PRI_RG_RT_CMDT B,
       PRI_RG_RT_CMDT_ROUT C,
       PRI_RG_RT D,
       (SELECT SVC_SCP_CD,
               GLINE_SEQ,
               CMDT_HDR_SEQ,
               ROUT_SEQ,
               SUBSTR(MAX(SYS_CONNECT_BY_PATH(ROUT_PNT_LOC_DEF_CD, ';')), 2) AS ROUT_PNT_LOC_DEF_CD
          FROM (SELECT SVC_SCP_CD,
                       GLINE_SEQ,
                       CMDT_HDR_SEQ,
                       ROUT_SEQ,
                       ORG_DEST_TP_CD,
                       ROUT_PNT_LOC_DEF_CD,
                       ROW_NUMBER() OVER(PARTITION BY SVC_SCP_CD, GLINE_SEQ, CMDT_HDR_SEQ, ROUT_SEQ ORDER BY SVC_SCP_CD, GLINE_SEQ, CMDT_HDR_SEQ, ROUT_SEQ, ROUT_PNT_SEQ) AS RN
                  FROM PRI_RG_RT_ROUT_PNT
                 WHERE ORG_DEST_TP_CD = 'O')
         START WITH RN = 1
        CONNECT BY PRIOR ROUT_SEQ = ROUT_SEQ
               AND PRIOR RN = RN - 1
         GROUP BY SVC_SCP_CD,
                  GLINE_SEQ,
                  CMDT_HDR_SEQ,
                  ROUT_SEQ) E,
       (SELECT SVC_SCP_CD,
               GLINE_SEQ,
               CMDT_HDR_SEQ,
               ROUT_SEQ,
               SUBSTR(MAX(SYS_CONNECT_BY_PATH(ROUT_VIA_PORT_DEF_CD, ';')), 2) AS ROUT_VIA_PORT_DEF_CD
          FROM (SELECT SVC_SCP_CD,
                       GLINE_SEQ,
                       CMDT_HDR_SEQ,
                       ROUT_SEQ,
                       ORG_DEST_TP_CD,
                       ROUT_VIA_PORT_DEF_CD,
                       ROW_NUMBER() OVER(PARTITION BY SVC_SCP_CD, GLINE_SEQ, CMDT_HDR_SEQ, ROUT_SEQ ORDER BY SVC_SCP_CD, GLINE_SEQ, CMDT_HDR_SEQ, ROUT_SEQ, ROUT_VIA_SEQ) AS RN
                  FROM PRI_RG_RT_ROUT_VIA
                 WHERE ORG_DEST_TP_CD = 'O')
         START WITH RN = 1
        CONNECT BY PRIOR ROUT_SEQ = ROUT_SEQ
               AND PRIOR RN = RN - 1
         GROUP BY SVC_SCP_CD,
                  GLINE_SEQ,
                  CMDT_HDR_SEQ,
                  ROUT_SEQ) F,
       (SELECT SVC_SCP_CD,
               GLINE_SEQ,
               CMDT_HDR_SEQ,
               ROUT_SEQ,
               SUBSTR(MAX(SYS_CONNECT_BY_PATH(ROUT_VIA_PORT_DEF_CD, ';')), 2) AS ROUT_VIA_PORT_DEF_CD
          FROM (SELECT SVC_SCP_CD,
                       GLINE_SEQ,
                       CMDT_HDR_SEQ,
                       ROUT_SEQ,
                       ORG_DEST_TP_CD,
                       ROUT_VIA_PORT_DEF_CD,
                       ROW_NUMBER() OVER(PARTITION BY SVC_SCP_CD, GLINE_SEQ, CMDT_HDR_SEQ, ROUT_SEQ ORDER BY SVC_SCP_CD, GLINE_SEQ, CMDT_HDR_SEQ, ROUT_SEQ, ROUT_VIA_SEQ) AS RN
                  FROM PRI_RG_RT_ROUT_VIA
                 WHERE ORG_DEST_TP_CD = 'D')
         START WITH RN = 1
        CONNECT BY PRIOR ROUT_SEQ = ROUT_SEQ
               AND PRIOR RN = RN - 1
         GROUP BY SVC_SCP_CD,
                  GLINE_SEQ,
                  CMDT_HDR_SEQ,
                  ROUT_SEQ) G,
       (SELECT SVC_SCP_CD,
               GLINE_SEQ,
               CMDT_HDR_SEQ,
               ROUT_SEQ,
               SUBSTR(MAX(SYS_CONNECT_BY_PATH(ROUT_PNT_LOC_DEF_CD, ';')), 2) AS ROUT_PNT_LOC_DEF_CD
          FROM (SELECT SVC_SCP_CD,
                       GLINE_SEQ,
                       CMDT_HDR_SEQ,
                       ROUT_SEQ,
                       ORG_DEST_TP_CD,
                       ROUT_PNT_LOC_DEF_CD,
                       ROW_NUMBER() OVER(PARTITION BY SVC_SCP_CD, GLINE_SEQ, CMDT_HDR_SEQ, ROUT_SEQ ORDER BY SVC_SCP_CD, GLINE_SEQ, CMDT_HDR_SEQ, ROUT_SEQ, ROUT_PNT_SEQ) AS RN
                  FROM PRI_RG_RT_ROUT_PNT
                 WHERE ORG_DEST_TP_CD = 'D')
         START WITH RN = 1
        CONNECT BY PRIOR ROUT_SEQ = ROUT_SEQ
               AND PRIOR RN = RN - 1
         GROUP BY SVC_SCP_CD,
                  GLINE_SEQ,
                  CMDT_HDR_SEQ,
                  ROUT_SEQ) H
 WHERE A.SVC_SCP_CD = B.SVC_SCP_CD
   AND A.GLINE_SEQ = B.GLINE_SEQ
   AND A.CMDT_HDR_SEQ = B.CMDT_HDR_SEQ
   AND A.SVC_SCP_CD = C.SVC_SCP_CD
   AND A.GLINE_SEQ = C.GLINE_SEQ
   AND A.CMDT_HDR_SEQ = C.CMDT_HDR_SEQ
   AND C.SVC_SCP_CD = D.SVC_SCP_CD
   AND C.GLINE_SEQ = D.GLINE_SEQ
   AND C.CMDT_HDR_SEQ = D.CMDT_HDR_SEQ
   AND C.ROUT_SEQ = D.ROUT_SEQ
   AND C.SVC_SCP_CD = E.SVC_SCP_CD
   AND C.GLINE_SEQ = E.GLINE_SEQ
   AND C.CMDT_HDR_SEQ = E.CMDT_HDR_SEQ
   AND C.ROUT_SEQ = E.ROUT_SEQ
   AND C.SVC_SCP_CD = F.SVC_SCP_CD
   AND C.GLINE_SEQ = F.GLINE_SEQ
   AND C.CMDT_HDR_SEQ = F.CMDT_HDR_SEQ
   AND C.ROUT_SEQ = F.ROUT_SEQ
   AND C.SVC_SCP_CD = G.SVC_SCP_CD
   AND C.GLINE_SEQ = G.GLINE_SEQ
   AND C.CMDT_HDR_SEQ = G.CMDT_HDR_SEQ
   AND C.ROUT_SEQ = G.ROUT_SEQ
   AND C.SVC_SCP_CD = H.SVC_SCP_CD
   AND C.GLINE_SEQ = H.GLINE_SEQ
   AND C.CMDT_HDR_SEQ = H.CMDT_HDR_SEQ
   AND C.ROUT_SEQ = E.ROUT_SEQ
   AND A.SVC_SCP_CD = @[svc_scp_cd]
   AND A.GLINE_SEQ = @[gline_seq]			]]></sql>
			<params>
				<param name="svc_scp_cd" type="12" value="" out="N"/>
				<param name="gline_seq" type="2" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
