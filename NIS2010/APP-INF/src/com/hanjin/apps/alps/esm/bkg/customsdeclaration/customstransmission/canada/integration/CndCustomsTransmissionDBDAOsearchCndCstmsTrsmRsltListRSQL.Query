<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="CndCustomsTransmissionDBDAOsearchCndCstmsTrsmRsltListRSQL">
			<desc><![CDATA[searchCndCstmsTrsmRsltList]]></desc>
			<sql><![CDATA[
#if (${rpt_flag} == 'V')
    SELECT  A.VSL_CD || A.SKD_VOY_NO || A.SKD_DIR_CD AS VVD_CD
           ,'' POL_CD
           ,'' POD_CD
           ,'' BL_NO
           ,'' CSTMS_FILE_TP_CD
           ,'' CSTMS_TRSM_STS_CD
           ,'' MF_STS_CD
           ,A.CND_ACK_RSPN_CD AS CSTMS_ACK_RCV_RSLT_CD
           ,A.CND_ACK_SUB_CD  AS CSTMS_ACK_PROC_RSLT_CD
           ,'' FULL_MTY_CD
           ,TO_CHAR(A.VSL_ARR_RPT_SND_DT, 'YYYY-MM-DD HH24:MI') AS AMDT_SND_DT
           ,TO_CHAR(A.ACK_DT, 'YYYY-MM-DD HH24:MI') AS CSTMS_ACK_RCV_DT
           ,A.CSTMS_RJCT_ID   AS CSTMS_ACK_RJCT_CD
           ,A.RCV_ERR_CTNT    AS CSTMS_ACK_RJCT_MSG
           ,C1.ATTR_CTNT2 AS ACK_DESC
           ,C2.ATTR_CTNT2 AS RESULT_DESC
           ,D.ATTR_CTNT2 ERR_CD_DESC
           ,D.ATTR_CTNT3 ERR_TP_CTNT
           ,1 GUBUN  
      FROM  BKG_CSTMS_CND_VSL A
           ,BKG_HRD_CDG_CTNT C1
           ,BKG_HRD_CDG_CTNT C2
           ,BKG_CSTMS_CD_CONV_CTNT D
     WHERE  C1.HRD_CDG_ID(+) = 'CND_ACK_CODE'
       AND  A.CND_ACK_RSPN_CD = C1.ATTR_CTNT1(+)
       AND  C2.HRD_CDG_ID(+) = 'CND_RESULT_CODE'
       AND  A.CND_ACK_SUB_CD  = C2.ATTR_CTNT1(+)
       AND  D.CNT_CD(+) = 'CA'
       AND  D.CSTMS_DIV_ID(+) = 'CBSA_ERR_CD'
       AND  A.CSTMS_RJCT_ID = D.ATTR_CTNT1(+)
               
        #if (${vvd_cd} != '')
           AND  A.VSL_CD = SUBSTR(@[vvd_cd],1,4)
           AND  A.SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4)
           AND  A.SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)
        #end
        #if (${s_snd_dt} != '')
           AND  A.VSL_ARR_RPT_SND_DT BETWEEN TO_DATE(@[s_snd_dt] || ' 000000','YYYY-MM-DD HH24MISS') AND TO_DATE(@[e_snd_dt] || ' 235959','YYYY-MM-DD HH24MISS')
        #end
        #if (${s_rcv_dt} != '')
           AND  A.ACK_DT BETWEEN TO_DATE(@[s_rcv_dt] || ' 000000','YYYY-MM-DD HH24MISS') AND TO_DATE(@[e_rcv_dt] || ' 235959','YYYY-MM-DD HH24MISS')
        #end
        #if (${cstms_ack_proc_rslt_cd} != '')
           AND  A.CND_ACK_SUB_CD IN (${cstms_ack_proc_rslt_cd})
        #end
  ORDER BY A.ACK_DT
#elseif (${subcmd} != '')
    SELECT  TB.*
           ,C1.ATTR_CTNT2 AS ACK_DESC
           ,C2.ATTR_CTNT2 AS RESULT_DESC
           ,C3.ATTR_CTNT2 AS CSTMS_TRSM_STS_DESC
           ,D.ATTR_CTNT2 ERR_CD_DESC
           ,D.ATTR_CTNT3 ERR_TP_CTNT
           ,'' MANIFEST_TTL
           ,'' SENT_BY_A6A
           ,'' SENT_BY_AL
           ,'' TARGET_TTL
           ,'' UNMANIFEST
           ,'' TOTAL
           ,'' PROCESSED
           ,'' ERROR
           ,2 GUBUN
      FROM (
            SELECT  BL.VSL_CD || BL.SKD_VOY_NO || BL.SKD_DIR_CD AS VVD_CD
                   ,BL.CSTMS_POL_CD AS POL_CD
                   ,BL.CSTMS_POD_CD AS POD_CD
                   ,BL.BL_NO
                   ,DECODE(BL.MF_NO, NULL, BL.CSTMS_FILE_TP_CD, '0') AS CSTMS_FILE_TP_CD
                   ,BL.CSTMS_TRSM_STS_CD
                   ,BL.MF_STS_CD
                   ,LOG.CND_ACK_RCV_ID AS CSTMS_ACK_RCV_RSLT_CD
                   ,LOG.CND_ACK_SUB_CD CSTMS_ACK_PROC_RSLT_CD
                   ,BL.FULL_MTY_CD
                   ,TO_CHAR(BL.AMDT_SND_DT, 'YYYY-MM-DD HH24:MI') AS AMDT_SND_DT
                   ,TO_CHAR(LOG.RCV_DT, 'YYYY-MM-DD HH24:MI') AS CSTMS_ACK_RCV_DT
                   ,LOG.CSTMS_RJCT_MSG AS CSTMS_ACK_RJCT_CD
                   ,LOG.CND_ACK_ERR_NOTE_DESC AS CSTMS_ACK_RJCT_MSG
              FROM  BKG_CSTMS_ADV_BL BL
                   ,BKG_CSTMS_ADV_RCV_LOG LOG
             WHERE  BL.CNT_CD = 'CA'
               AND  BL.CNT_CD = LOG.CNT_CD
               AND  BL.BL_NO = LOG.BL_NO
               AND  LOG.IO_BND_CD = 'I'
               AND  LOG.CND_ACK_SUB_CD IN ('37', '21', '01')
    #if (${bl_no} != '')
               AND  BL.BL_NO = @[bl_no]
    #else
               AND  BL.FULL_MTY_CD = @[rpt_flag]
        #if (${vvd_cd} != '')
               AND  BL.VSL_CD = SUBSTR(@[vvd_cd],1,4)
               AND  BL.SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4)
               AND  BL.SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)
        #end
        #if (${pol_cd} != '')
               AND  BL.CSTMS_POL_CD = @[pol_cd]
        #end
        #if (${pod_cd} != '')
               AND  BL.CSTMS_POD_CD = @[pod_cd]
        #end
        #if (${s_rcv_dt} != '')
               AND  LOG.RCV_DT BETWEEN
                   TO_DATE(REPLACE(@[s_rcv_dt],'-','')||'000000', 'YYYYMMDDHH24MISS') AND
                   TO_DATE(REPLACE(@[e_rcv_dt],'-','')||'235959', 'YYYYMMDDHH24MISS')
        #end
    #end
               AND  EXISTS
                           (
                            SELECT LG.CNT_CD
                              FROM BKG_CSTMS_ADV_RCV_LOG LG
                             WHERE LG.CNT_CD = BL.CNT_CD
                               AND LG.BL_NO = BL.BL_NO
                               AND LG.IO_BND_CD = 'I'
                               AND LG.CND_ACK_SUB_CD = @[subcmd]
                           )
           ) TB
           ,BKG_HRD_CDG_CTNT C1
           ,BKG_HRD_CDG_CTNT C2
           ,BKG_HRD_CDG_CTNT C3
           ,BKG_CSTMS_CD_CONV_CTNT D
      WHERE C1.HRD_CDG_ID(+) = 'CND_ACK_CODE'
        AND TB.CSTMS_ACK_RCV_RSLT_CD = C1.ATTR_CTNT1(+)
        AND C2.HRD_CDG_ID(+) = 'CND_RESULT_CODE'
        AND TB.CSTMS_ACK_PROC_RSLT_CD  = C2.ATTR_CTNT1(+)
        AND C3.HRD_CDG_ID(+) = 'CND_TRSM_STS_CD'
        AND TB.CSTMS_TRSM_STS_CD = C3.ATTR_CTNT1(+)
        AND  D.CNT_CD(+) = 'CA'
        AND  D.CSTMS_DIV_ID(+) = 'CBSA_ERR_CD'
        AND  TB.CSTMS_ACK_RJCT_CD = D.ATTR_CTNT1(+)
   ORDER BY  TB.BL_NO    
#elseif (${s_snd_dt} != '' || ${s_rcv_dt} != '')
--SND_DT RCV_DT로 조회한 경우
    SELECT  BL.VSL_CD || BL.SKD_VOY_NO || BL.SKD_DIR_CD AS VVD_CD
           ,BL.CSTMS_POL_CD AS POL_CD
           ,BL.CSTMS_POD_CD AS POD_CD
           ,BL.BL_NO
           ,DECODE(BL.MF_NO, NULL, BL.CSTMS_FILE_TP_CD, '0') AS CSTMS_FILE_TP_CD
           ,BL.CSTMS_TRSM_STS_CD
           ,BL.CSTMS_TRSM_STS_CD
           ,BL.CSTMS_ACK_RCV_RSLT_CD
           ,BL.CSTMS_ACK_PROC_RSLT_CD
           ,BL.MF_STS_CD
           ,TO_CHAR(BL.AMDT_SND_DT, 'YYYY-MM-DD HH24:MI') AS AMDT_SND_DT
           ,TO_CHAR(BL.CSTMS_ACK_RCV_DT, 'YYYY-MM-DD HH24:MI') AS CSTMS_ACK_RCV_DT
           ,BL.CSTMS_ACK_RJCT_CD
           ,BL.CSTMS_ACK_RJCT_MSG
           ,C1.ATTR_CTNT2 AS ACK_DESC
           ,C2.ATTR_CTNT2 AS RESULT_DESC
           ,C3.ATTR_CTNT2 AS CSTMS_TRSM_STS_DESC
           ,D.ATTR_CTNT2 ERR_CD_DESC
           ,D.ATTR_CTNT3 ERR_TP_CTNT
           ,'' MANIFEST_TTL
           ,'' SENT_BY_A6A
           ,'' SENT_BY_AL
           ,'' TARGET_TTL
           ,'' UNMANIFEST
           ,'' TOTAL
           ,'' PROCESSED
           ,'' ERROR
           ,3 GUBUN
      FROM  BKG_CSTMS_ADV_BL BL
           ,BKG_HRD_CDG_CTNT C1
           ,BKG_HRD_CDG_CTNT C2
           ,BKG_HRD_CDG_CTNT C3
           ,BKG_CSTMS_CD_CONV_CTNT D
     WHERE  BL.CNT_CD = 'CA'
       AND  C1.HRD_CDG_ID(+) = 'CND_ACK_CODE'
       AND  BL.CSTMS_ACK_RCV_RSLT_CD = C1.ATTR_CTNT1(+)
       AND  C2.HRD_CDG_ID(+) = 'CND_RESULT_CODE'
       AND  BL.CSTMS_ACK_PROC_RSLT_CD  = C2.ATTR_CTNT1(+)
       AND  C3.HRD_CDG_ID(+) = 'CND_TRSM_STS_CD'
       AND  BL.CSTMS_TRSM_STS_CD = C3.ATTR_CTNT1(+)
       AND  D.CNT_CD(+) = 'CA'
       AND  D.CSTMS_DIV_ID(+) = 'CBSA_ERR_CD'
       AND  BL.CSTMS_ACK_RJCT_CD = D.ATTR_CTNT1(+)
       AND  BL.FULL_MTY_CD = @[rpt_flag]
    #if (${bl_no} != '')
       AND  BL.BL_NO = @[bl_no]
    #else
        #if (${vvd_cd} != '')
           AND  BL.VSL_CD = SUBSTR(@[vvd_cd],1,4)
           AND  BL.SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4)
           AND  BL.SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)
        #end
        #if (${pol_cd} != '')
           AND  BL.CSTMS_POL_CD = @[pol_cd]
        #end
        #if (${pod_cd} != '')
           AND  BL.CSTMS_POD_CD = @[pod_cd]
        #end
	    #if (${cstms_trsm_sts_cd} == 'SentByA6A')
	       AND  BL.CSTMS_TRSM_STS_CD = '00'
	    #elseif (${cstms_trsm_sts_cd} == 'AddedByAi')
	       AND  BL.CSTMS_TRSM_STS_CD IN ('04')
	    #elseif (${cstms_trsm_sts_cd} == 'UnManifested')
	       AND  (BL.CSTMS_TRSM_STS_CD IS NULL OR BL.CSTMS_TRSM_STS_CD IN ('03'))
	    #elseif (${cstms_trsm_sts_cd} == 'Manifested')
	       AND  BL.CSTMS_TRSM_STS_CD IN ('00','04')
	    #end
	    #if (${s_snd_dt} != '')
	       AND  BL.AMDT_SND_DT BETWEEN TO_DATE(@[s_snd_dt] || ' 000000','YYYY-MM-DD HH24MISS') AND TO_DATE(@[e_snd_dt] || ' 235959','YYYY-MM-DD HH24MISS')
	    #end
	    #if (${s_rcv_dt} != '')
	       AND  BL.CSTMS_ACK_RCV_DT BETWEEN TO_DATE(@[s_rcv_dt] || ' 000000','YYYY-MM-DD HH24MISS') AND TO_DATE(@[e_rcv_dt] || ' 235959','YYYY-MM-DD HH24MISS')
	    #end
	    #if (${cstms_ack_proc_rslt_cd} != '')
	       AND  BL.CSTMS_ACK_PROC_RSLT_CD IN (${cstms_ack_proc_rslt_cd})
	    #end
    #end
#else
    SELECT   TB.*
            ,BL.CSTMS_TRSM_STS_CD
            ,BL.CSTMS_ACK_RCV_RSLT_CD
            ,BL.CSTMS_ACK_PROC_RSLT_CD
            ,TO_CHAR(BL.AMDT_SND_DT, 'YYYY-MM-DD HH24:MI') AS AMDT_SND_DT
            ,TO_CHAR(BL.CSTMS_ACK_RCV_DT, 'YYYY-MM-DD HH24:MI') AS CSTMS_ACK_RCV_DT
            ,BL.CSTMS_ACK_RJCT_CD
            ,BL.CSTMS_ACK_RJCT_MSG
            ,BL.MF_STS_CD
            ,C1.ATTR_CTNT2 AS ACK_DESC
            ,C2.ATTR_CTNT2 AS RESULT_DESC
            ,C3.ATTR_CTNT2 AS CSTMS_TRSM_STS_DESC
            ,D.ATTR_CTNT2 ERR_CD_DESC
            ,D.ATTR_CTNT3 ERR_TP_CTNT
            ,'' MANIFEST_TTL
            ,'' SENT_BY_A6A
            ,'' SENT_BY_AL
            ,'' TARGET_TTL
            ,'' UNMANIFEST
            ,'' TOTAL
            ,'' PROCESSED
            ,'' ERROR
           ,4 GUBUN
      FROM  (
            SELECT  VVD.VSL_CD || VVD.SKD_VOY_NO || VVD.SKD_DIR_CD AS VVD_CD
                   ,VVD.VSL_CD
                   ,VVD.SKD_VOY_NO
                   ,VVD.SKD_DIR_CD
                   ,VVD.POL_CD
                   ,VVD.POD_CD
                   ,BKG.BL_NO
                   ,BKG.CND_CSTMS_FILE_CD AS CSTMS_FILE_TP_CD
                   ,DECODE(BKG.BKG_CGO_TP_CD, 'F', 'F', 'M') AS FULL_MTY_CD
              FROM  BKG_VVD VVD
                   ,BKG_BOOKING BKG
             WHERE  VVD.BKG_NO = BKG.BKG_NO
               AND  BKG.BKG_STS_CD IN ('F','W')
               AND  BKG.BL_NO > ' '
            #if (${bl_no} != '')
               AND  BKG.BL_NO = @[bl_no]
               AND  (VVD.POD_CD LIKE 'CA%' OR VVD.POD_CD LIKE 'US%')
            #else
               AND  DECODE(BKG.BKG_CGO_TP_CD, 'F', 'F', 'M') = @[rpt_flag]
                #if (${vvd_cd} != '')
                   AND  VVD.VSL_CD = SUBSTR(@[vvd_cd],1,4)
                   AND  VVD.SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4)
                   AND  VVD.SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)
                #end
                #if (${pol_cd} != '')
                   AND  VVD.POL_CD = @[pol_cd]
                #end
                #if (${pod_cd} != '')
                   AND  VVD.POD_CD = @[pod_cd]
                #end
            #end
            UNION ALL
            SELECT  VVD.VSL_CD || VVD.SKD_VOY_NO || VVD.SKD_DIR_CD
                   ,VVD.VSL_CD
                   ,VVD.SKD_VOY_NO
                   ,VVD.SKD_DIR_CD
                   ,VVD.POL_CD
                   ,VVD.POD_CD
                   ,HBL.CNTR_MF_NO AS BL_NO
                   ,'0' AS CSTMS_FILE_TP_CD
                   ,DECODE(BKG.BKG_CGO_TP_CD, 'F', 'F', 'M') AS FULL_MTY_CD
              FROM  BKG_VVD VVD
                   ,BKG_BOOKING BKG
                   ,BKG_HBL HBL
             WHERE  VVD.BKG_NO = BKG.BKG_NO
               AND  BKG.BKG_NO = HBL.BKG_NO
               AND  BKG.BKG_STS_CD IN ('F','W')
               AND  HBL.CNTR_MF_NO > ' '
               AND  BKG.CND_CSTMS_FILE_CD = '1'
            #if (${bl_no} != '')
               AND  HBL.CNTR_MF_NO = @[bl_no]
               AND  HBL.BKG_NO > ' '
               AND  (VVD.POD_CD LIKE 'CA%' OR VVD.POD_CD LIKE 'US%')
            #else
               AND  DECODE(BKG.BKG_CGO_TP_CD, 'F', 'F', 'M') = @[rpt_flag]
                #if (${vvd_cd} != '')
                   AND  VVD.VSL_CD = SUBSTR(@[vvd_cd],1,4)
                   AND  VVD.SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4)
                   AND  VVD.SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)
                #end
                #if (${pol_cd} != '')
                   AND  VVD.POL_CD = @[pol_cd]
                #end
                #if (${pod_cd} != '')
                   AND  VVD.POD_CD = @[pod_cd]
                #end
            #end
            ) TB
            ,BKG_CSTMS_ADV_BL BL
            ,BKG_HRD_CDG_CTNT C1
            ,BKG_HRD_CDG_CTNT C2
            ,BKG_HRD_CDG_CTNT C3
            ,BKG_CSTMS_CD_CONV_CTNT D
            ,VSK_VSL_PORT_SKD VSL
      WHERE  BL.CNT_CD(+) = 'CA'
        AND  TB.BL_NO = BL.BL_NO(+)
        AND  C1.HRD_CDG_ID(+) = 'CND_ACK_CODE'
        AND  BL.CSTMS_ACK_RCV_RSLT_CD = C1.ATTR_CTNT1(+)
        AND  C2.HRD_CDG_ID(+) = 'CND_RESULT_CODE'
        AND  BL.CSTMS_ACK_PROC_RSLT_CD  = C2.ATTR_CTNT1(+)
        AND  C3.HRD_CDG_ID(+) = 'CND_TRSM_STS_CD'
        AND  BL.CSTMS_TRSM_STS_CD = C3.ATTR_CTNT1(+)
        AND  D.CNT_CD(+) = 'CA'
        AND  D.CSTMS_DIV_ID(+) = 'CBSA_ERR_CD'
        AND  BL.CSTMS_ACK_RJCT_CD = D.ATTR_CTNT1(+)
        AND  VSL.VSL_CD = TB.VSL_CD
        AND  VSL.SKD_VOY_NO = TB.SKD_VOY_NO
        AND  VSL.SKD_DIR_CD = TB.SKD_DIR_CD
        AND  VSL.VPS_PORT_CD = TB.POD_CD
        AND  VSL.CLPT_IND_SEQ = 1
        AND  VSL.CLPT_SEQ >= @[min_seq]
#if (${bl_no} == '')
    #if (${cstms_trsm_sts_cd} == 'SentByA6A')
        AND  BL.CSTMS_TRSM_STS_CD = '00'
    #elseif (${cstms_trsm_sts_cd} == 'AddedByAi')
        AND  BL.CSTMS_TRSM_STS_CD IN ('04')
    #elseif (${cstms_trsm_sts_cd} == 'UnManifested')
        AND  (BL.CSTMS_TRSM_STS_CD IS NULL OR BL.CSTMS_TRSM_STS_CD IN ('03'))
    #elseif (${cstms_trsm_sts_cd} == 'Manifested')
        AND  BL.CSTMS_TRSM_STS_CD IN ('00','04')
    #end
    #if (${cstms_ack_proc_rslt_cd} != '')
        AND  BL.CSTMS_ACK_PROC_RSLT_CD IN (${cstms_ack_proc_rslt_cd})
    #end
#end
    ORDER BY TB.BL_NO
#end			]]></sql>
			<params>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="s_snd_dt" type="12" value="" out="N"/>
				<param name="e_snd_dt" type="12" value="" out="N"/>
				<param name="s_rcv_dt" type="12" value="" out="N"/>
				<param name="e_rcv_dt" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="rpt_flag" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="pod_cd" type="12" value="" out="N"/>
				<param name="subcmd" type="12" value="" out="N"/>
				<param name="min_seq" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
