<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PerformanceReportDBDAOSearchCneeAccuracyOfcListRSQL">
			<desc><![CDATA[Doc Performance Report-ESM_BKG_0214
Documentation 실적 산출 기능
Cnee Accuracy Office 조회]]></desc>
			<sql><![CDATA[
SELECT BK.RGN_OFC_CD REGION
     , BK.GSO_OFC_CD GSO
     , BK.BKG_OFC_CD BKG_OFC_CD
     , TOTAL_BL CNT
     , BK.SUB_GRP_CTNT BDO_OFC1
     , NVL(WRONG_BL,0) || '/' || NVL(VALIDATE_BL,0) OFC_CNT
     , DECODE(VALIDATE_BL, 0, '0.00%', 
            TRIM(TO_CHAR(ROUND(WRONG_BL / VALIDATE_BL * 100, 2), '99990.99')) || '%') RATIO
     , '' FR_DT
     , '' TO_DT
     , '' POL_CD
     , '' SLAN_CD
     , '' VVD_CD
     , '' BKG_NO
     , '' BL_NO
     , '' OB_SLS_OFC_CD
	 , '' CLASS_TYPE
	 , '' BKG_NO
     , '' BL_NO
FROM 
        (SELECT 
#if (${rep_year} == '2010' || ${rep_year} == '2011' || ${rep_year} == '2012' || ${rep_year} == '2013')
               DECODE(BD.RGN_OFC_CD,'TYOIB','SHARC',BD.RGN_OFC_CD) RGN_OFC_CD
#else
               BD.RGN_OFC_CD
#end
             , BD.GSO_OFC_CD
             , BK.BKG_OFC_CD
             , BD.SUB_GRP_CTNT
             , COUNT(1) TOTAL_BL 
             , SUM(CASE WHEN BC.VAL_DT IS NULL THEN 0 ELSE 1 END) VALIDATE_BL
             , SUM(CASE WHEN BC.VAL_DT IS NULL THEN 0 ELSE DECODE(NVL(BC.VAL_CD, 'X'), 'W', 1, 0) END) WRONG_BL
          FROM BKG_BOOKING BK
             , BKG_VVD VVD
             , VSK_VSL_PORT_SKD SKD
             , BKG_CUSTOMER BC
             , BKG_DOC_PERF_OFC BD
         WHERE BK.BKG_NO = VVD.BKG_NO
           AND BK.POD_CD = VVD.POD_CD
           AND VVD.VSL_PRE_PST_CD IN ('T','U')
           AND (VVD.VSL_PRE_PST_CD, VVD.VSL_SEQ) = (SELECT /*+ index_desc (v2 xpkbkg_vvd) */ 
                                                            V2.VSL_PRE_PST_CD, V2.VSL_SEQ
                                                      FROM BKG_VVD V2
                                                     WHERE V2.BKG_NO = BK.BKG_NO
                                                       AND V2.VSL_PRE_PST_CD IN ('T','U')
                                                       AND ROWNUM = 1)
           AND VVD.VSL_CD     = SKD.VSL_CD
           AND VVD.SKD_VOY_NO = SKD.SKD_VOY_NO
           AND VVD.SKD_DIR_CD = SKD.SKD_DIR_CD
           AND VVD.POD_CD     = SKD.VPS_PORT_CD
           AND VVD.POD_CLPT_IND_SEQ = SKD.CLPT_IND_SEQ
           AND BK.BKG_NO      = BC.BKG_NO
           AND BC.VAL_DT IS NOT NULL
           AND BK.BKG_STS_CD  <> 'X'
           AND BK.BKG_CGO_TP_CD = 'F'
           AND BC.BKG_CUST_TP_CD = DECODE(BK.CUST_TO_ORD_FLG,'Y','N','C')
                                             
#if (${fr_dt} != '')                     
           AND SKD.VPS_ETA_DT >= TO_DATE(@[fr_dt],'YYYY-MM-DD')
#end
#if (${to_dt} != '')
           AND SKD.VPS_ETA_DT <= TO_DATE(@[to_dt],'YYYY-MM-DD') +0.99999
#end

#if (${bkg_no} != '') 
		AND	   BK.BKG_NO = @[bkg_no]
#end
#if (${bl_no} != '') 
		AND	   BK.BL_NO = @[bl_no]
#end
#if (${bkg_ofc_cd} != '') 
		AND    BK.BKG_OFC_CD = @[bkg_ofc_cd]
#end
#if (${ob_sls_ofc_cd} != '') 
		AND    BK.OB_SLS_OFC_CD = @[ob_sls_ofc_cd]
#end
#if (${pol_cd} != '') 
		AND    BK.POL_CD = @[pol_cd]
#end       
#if (${slan_cd} != '') 
		AND    BK.SLAN_CD = @[slan_cd]
#end                
#if (${vvd_cd} != '')
		AND   BK.VSL_CD     = SUBSTR(@[vvd_cd],1,4)
		AND   BK.SKD_VOY_NO = SUBSTR(@[vvd_cd],5,4)
		AND   BK.SKD_DIR_CD = SUBSTR(@[vvd_cd],9,1)
#end

        AND    DECODE(SUBSTR(BD.POR_CD,1,2),'JP',BK.BKG_OFC_CD,BD.BKG_OFC_CD) = BK.BKG_OFC_CD
        AND    BD.GSO_OFC_CD <> 'SHADKJ' 
        AND    BD.BKG_OFC_CD <> 'SHADKJ'
	    AND    DECODE(SUBSTR(BD.POR_CD,1,2),'JP',BD.POR_CD,BK.POR_CD) = BK.POR_CD  
        
#if (${gso} != '') 
   AND BD.GSO_OFC_CD = @[gso]
#end
#if (${region} != '') 
   #if (${rep_year} == '2010' || ${rep_year} == '2011' || ${rep_year} == '2012' || ${rep_year} == '2013')
		#if(${region} == 'SHARC')
		AND    RGN_OFC_CD IN ( @[region],'TYOIB')
		#end
		#if(${region} == 'TYOIB')
		AND    RGN_OFC_CD =''
		#end
		#if(${region} != 'TYOIB' && ${region} != 'SHARC')
		AND    RGN_OFC_CD= @[region]
		#end
   #else
        AND    RGN_OFC_CD= @[region]
   #end
#end         
      GROUP BY
#if (${rep_year} == '2010' || ${rep_year} == '2011' || ${rep_year} == '2012' || ${rep_year} == '2013')
               DECODE(BD.RGN_OFC_CD,'TYOIB','SHARC',BD.RGN_OFC_CD) 
#else
               BD.RGN_OFC_CD 
#end
             , BD.GSO_OFC_CD
             , BK.BKG_OFC_CD
             , BD.SUB_GRP_CTNT) BK			]]></sql>
			<params>
				<param name="fr_dt" type="12" value="" out="N"/>
				<param name="to_dt" type="12" value="" out="N"/>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="bl_no" type="12" value="" out="N"/>
				<param name="bkg_ofc_cd" type="12" value="" out="N"/>
				<param name="ob_sls_ofc_cd" type="12" value="" out="N"/>
				<param name="pol_cd" type="12" value="" out="N"/>
				<param name="slan_cd" type="12" value="" out="N"/>
				<param name="vvd_cd" type="12" value="" out="N"/>
				<param name="gso" type="12" value="" out="N"/>
				<param name="region" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
