<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="BookingHistoryMgtDBDAOSearchHistBkgCntcPsonRSQL">
			<desc><![CDATA[BookingHistoryMgtDBDAOSearchHistBkgCntcPsonRSQL]]></desc>
			<sql><![CDATA[
WITH OLD_CNTC AS
(SELECT @[bkg_no] BKG_NO
        , @[bkg_cntc_pson_tp_cd] BKG_CNTC_PSON_TP_CD
        , @[cntc_pson_nm] CNTC_PSON_NM
        , @[cntc_pson_phn_no] CNTC_PSON_PHN_NO
        , @[cntc_pson_mphn_no] CNTC_PSON_MPHN_NO
        , @[cntc_pson_fax_no] CNTC_PSON_FAX_NO
        , @[cntc_pson_eml] CNTC_PSON_EML
        , @[diff_rmk] DIFF_RMK
FROM DUAL)
SELECT HIS_CATE_NM
     , PRE_CTNT
     , CRNT_CTNT
  FROM 
    (
        SELECT DECODE(NOW_CNTC.BKG_CNTC_PSON_TP_CD, 'BK', 'BOOKING ', 'S/I ')||'CONTACT' HIS_CATE_NM
               , OLD_CNTC.CNTC_PSON_NM||
                 '/'||OLD_CNTC.CNTC_PSON_PHN_NO||
                 '/'||OLD_CNTC.CNTC_PSON_MPHN_NO||
                 '/'||OLD_CNTC.CNTC_PSON_FAX_NO||
                 '/'||OLD_CNTC.CNTC_PSON_EML PRE_CTNT
               , NOW_CNTC.CNTC_PSON_NM||
                 '/'||NOW_CNTC.CNTC_PSON_PHN_NO||
                 '/'||NOW_CNTC.CNTC_PSON_MPHN_NO||
                 '/'||NOW_CNTC.CNTC_PSON_FAX_NO||
                 '/'||NOW_CNTC.CNTC_PSON_EML CRNT_CTNT
          FROM OLD_CNTC
#if (${ca_flg} == 'Y')
             , BKG_CNTC_PSON_HIS NOW_CNTC
         WHERE NOW_CNTC.BKG_NO              = OLD_CNTC.BKG_NO
	       AND NOW_CNTC.CORR_NO             = 'TMP0000001' 
#else
             , BKG_CNTC_PSON NOW_CNTC
         WHERE NOW_CNTC.BKG_NO              = OLD_CNTC.BKG_NO
#end

           AND NOW_CNTC.BKG_CNTC_PSON_TP_CD = OLD_CNTC.BKG_CNTC_PSON_TP_CD
    )    
 WHERE NVL(TRIM(PRE_CTNT), ' ') <> NVL(TRIM(CRNT_CTNT), ' ')			]]></sql>
			<params>
				<param name="bkg_no" type="12" value="" out="N"/>
				<param name="bkg_cntc_pson_tp_cd" type="12" value="" out="N"/>
				<param name="cntc_pson_nm" type="12" value="" out="N"/>
				<param name="cntc_pson_phn_no" type="12" value="" out="N"/>
				<param name="cntc_pson_mphn_no" type="12" value="" out="N"/>
				<param name="cntc_pson_fax_no" type="12" value="" out="N"/>
				<param name="cntc_pson_eml" type="12" value="" out="N"/>
				<param name="diff_rmk" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
