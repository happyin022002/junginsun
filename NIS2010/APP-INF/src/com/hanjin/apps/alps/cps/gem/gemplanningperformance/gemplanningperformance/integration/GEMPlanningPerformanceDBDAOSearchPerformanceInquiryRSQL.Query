<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GEMPlanningPerformanceDBDAOSearchPerformanceInquiryRSQL">
			<desc><![CDATA[비용계획을 요청중인 조직의 현재까지의 실적 정보를 조회한다]]></desc>
			<sql><![CDATA[
SELECT 
'FM' FM_TO,
A.OFC_CD, A.GEN_EXPN_CD, 
B.LOCL_CURR_CD,
B.RQST_UT_VAL,
YEAR_ASS_EXP/B.RQST_UT_VAL YEAR_ASS_EXP,
YTD_ASS_EXP/B.RQST_UT_VAL YTD_ASS_EXP,
YTD_PERF/B.RQST_UT_VAL YTD_PERF,
(SELECT 
NVL( MAX (CASE
WHEN A.GEN_EXPN_TRNS_DIV_CD = 'F'
AND     A.GEN_EXPN_APRO_STEP_CD = B.CRNT_GEN_EXPN_APRO_STEP_CD
THEN   A.JAN_AMT
+ A.FEB_AMT
+ A.MAR_AMT
+ A.APR_AMT
+ A.MAY_AMT
+ A.JUN_AMT
+ A.JUL_AMT
+ A.AUG_AMT
+ A.SEP_AMT
+ A.OCT_AMT
+ A.NOV_AMT
+ A.DEC_AMT
END
),0) AD_AMT
FROM GEM_APRO_STEP A, GEM_ITEM B, GEM_REQUEST C
WHERE    B.GEN_EXPN_RQST_NO = C.GEN_EXPN_RQST_NO
AND      B.GEN_EXPN_RQST_NO = A.GEN_EXPN_RQST_NO
AND      B.OFC_CD = A.OFC_CD
AND      B.GEN_EXPN_CD = A.GEN_EXPN_CD
AND      B.GEN_EXPN_ITM_NO = A.GEN_EXPN_ITM_NO
AND      B.GEN_EXPN_TRNS_DIV_CD = A.GEN_EXPN_TRNS_DIV_CD
AND      B.GEN_EXPN_RQST_SEQ = A.GEN_EXPN_RQST_SEQ
AND      B.GEN_EXPN_APRO_AUTH_OFC_CD = A.GEN_EXPN_APRO_AUTH_OFC_CD
AND      C.GEN_EXPN_RQST_TP_CD = @[gen_expn_rqst_tp_cd]
AND      C.PLN_YRMON LIKE SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'%'
AND A.OFC_CD = @[fm_ofc_cd]
AND A.GEN_EXPN_CD = @[fm_gen_expn_cd]) AD_AMT
FROM
(SELECT   OFC_CD
,GEN_EXPN_CD
,SUM (YEAR_ASS_EXP) YEAR_ASS_EXP
,SUM (YTD_ASS_EXP) YTD_ASS_EXP
,SUM (YTD_PERF) YTD_PERF
FROM     (SELECT OFC_CD
,GEN_EXPN_CD
,   A.GEN_EXPN_INIT_AMT
+ A.GEN_EXPN_ADD_AMT
+ A.GEN_EXPN_TRNS_AMT YEAR_ASS_EXP
,CASE
WHEN RSLT_YRMON BETWEEN SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'01' AND TO_CHAR(SYSDATE, 'YYYYMM')
THEN (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)
ELSE 0
END YTD_ASS_EXP
,CASE
WHEN RSLT_YRMON BETWEEN SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'01' AND TO_CHAR(SYSDATE, 'YYYYMM')
THEN SLP_PERF_AMT
ELSE 0
END YTD_PERF
FROM   GEM_RSLT_SMRY A
WHERE  A.RSLT_YRMON LIKE SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'%'
AND A.OFC_CD = @[fm_ofc_cd]
AND A.GEN_EXPN_CD = @[fm_gen_expn_cd])
GROUP BY OFC_CD, GEN_EXPN_CD) A,
GEM_OFFICE B
WHERE A.OFC_CD = B.OFC_CD(+)

UNION ALL

SELECT 
'FM' FM_TO,
OFC_CD, GEN_EXPN_CD, 
'USD' LOCL_CURR_CD,
1 RQST_UT_VAL,
(SELECT AAA.YEAR_ASS_EXP/USD_LOCL_XCH_RT FROM GEM_XCH_RT WHERE ACCT_XCH_RT_YRMON = SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'00' AND GEN_EXPN_XCH_RT_DIV_CD = 'I' AND CURR_CD = AAA.LOCL_CURR_CD) YEAR_ASS_EXP,
(SELECT AAA.YTD_ASS_EXP/USD_LOCL_XCH_RT FROM GEM_XCH_RT WHERE ACCT_XCH_RT_YRMON = SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'00' AND GEN_EXPN_XCH_RT_DIV_CD = 'I' AND CURR_CD = AAA.LOCL_CURR_CD) YTD_ASS_EXP, 
AAA.YTD_PERF YTD_PERF, 
(SELECT AAA.AD_AMT/USD_LOCL_XCH_RT FROM GEM_XCH_RT WHERE ACCT_XCH_RT_YRMON = SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'00' AND GEN_EXPN_XCH_RT_DIV_CD = 'I' AND CURR_CD = AAA.LOCL_CURR_CD)*AAA.RQST_UT_VAL AD_AMT
FROM
(SELECT A.OFC_CD, A.GEN_EXPN_CD,
B.LOCL_CURR_CD,
B.RQST_UT_VAL,
YEAR_ASS_EXP,
YTD_ASS_EXP,
YTD_PERF,
(SELECT
NVL( MAX (CASE
WHEN A.GEN_EXPN_TRNS_DIV_CD = 'F'
AND     A.GEN_EXPN_APRO_STEP_CD = B.CRNT_GEN_EXPN_APRO_STEP_CD
THEN   A.JAN_AMT
+ A.FEB_AMT
+ A.MAR_AMT
+ A.APR_AMT
+ A.MAY_AMT
+ A.JUN_AMT
+ A.JUL_AMT
+ A.AUG_AMT
+ A.SEP_AMT
+ A.OCT_AMT
+ A.NOV_AMT
+ A.DEC_AMT
END
),0) AD_AMT
FROM GEM_APRO_STEP A, GEM_ITEM B, GEM_REQUEST C
WHERE    B.GEN_EXPN_RQST_NO = C.GEN_EXPN_RQST_NO
AND      B.GEN_EXPN_RQST_NO = A.GEN_EXPN_RQST_NO
AND      B.OFC_CD = A.OFC_CD
AND      B.GEN_EXPN_CD = A.GEN_EXPN_CD
AND      B.GEN_EXPN_ITM_NO = A.GEN_EXPN_ITM_NO
AND      B.GEN_EXPN_TRNS_DIV_CD = A.GEN_EXPN_TRNS_DIV_CD
AND      B.GEN_EXPN_RQST_SEQ = A.GEN_EXPN_RQST_SEQ
AND      B.GEN_EXPN_APRO_AUTH_OFC_CD = A.GEN_EXPN_APRO_AUTH_OFC_CD
AND      C.GEN_EXPN_RQST_TP_CD = @[gen_expn_rqst_tp_cd]
AND      C.PLN_YRMON LIKE SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'%'
AND A.OFC_CD = @[fm_ofc_cd]
AND A.GEN_EXPN_CD = @[fm_gen_expn_cd]) AD_AMT
FROM
(SELECT   OFC_CD
,GEN_EXPN_CD
,SUM (YEAR_ASS_EXP) YEAR_ASS_EXP
,SUM (YTD_ASS_EXP) YTD_ASS_EXP
,SUM (YTD_PERF) YTD_PERF
FROM     (SELECT A.OFC_CD
,GEN_EXPN_CD
,   A.GEN_EXPN_INIT_AMT
+ A.GEN_EXPN_ADD_AMT
+ A.GEN_EXPN_TRNS_AMT YEAR_ASS_EXP
,CASE
WHEN RSLT_YRMON BETWEEN SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'01' AND TO_CHAR(SYSDATE, 'YYYYMM')
THEN (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)
ELSE 0
END YTD_ASS_EXP
,CASE
WHEN RSLT_YRMON BETWEEN SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'01' AND TO_CHAR(SYSDATE, 'YYYYMM')
THEN (SELECT A.SLP_PERF_AMT/USD_LOCL_XCH_RT FROM GEM_XCH_RT WHERE ACCT_XCH_RT_YRMON = A.RSLT_YRMON AND GEN_EXPN_XCH_RT_DIV_CD = 'M' AND CURR_CD = B.LOCL_CURR_CD)
ELSE 0
END YTD_PERF
FROM   GEM_RSLT_SMRY A, GEM_OFFICE B
WHERE  A.RSLT_YRMON LIKE SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'%'
AND A.OFC_CD = @[fm_ofc_cd]
AND A.GEN_EXPN_CD = @[fm_gen_expn_cd]
AND A.OFC_CD = B.OFC_CD(+))
GROUP BY OFC_CD, GEN_EXPN_CD) A,
GEM_OFFICE B
WHERE A.OFC_CD = B.OFC_CD(+)) AAA

#if (${to_ofc_cd} != '' && ${to_gen_expn_cd} != '')

UNION ALL

SELECT 
'TO' FM_TO,
A.OFC_CD, A.GEN_EXPN_CD, 
B.LOCL_CURR_CD,
B.RQST_UT_VAL,
YEAR_ASS_EXP/B.RQST_UT_VAL YEAR_ASS_EXP,
YTD_ASS_EXP/B.RQST_UT_VAL YTD_ASS_EXP,
YTD_PERF/B.RQST_UT_VAL YTD_PERF,
(SELECT 
NVL( MAX (CASE
WHEN A.GEN_EXPN_TRNS_DIV_CD = 'T'
AND     A.GEN_EXPN_APRO_STEP_CD = B.CRNT_GEN_EXPN_APRO_STEP_CD
THEN   A.JAN_AMT
+ A.FEB_AMT
+ A.MAR_AMT
+ A.APR_AMT
+ A.MAY_AMT
+ A.JUN_AMT
+ A.JUL_AMT
+ A.AUG_AMT
+ A.SEP_AMT
+ A.OCT_AMT
+ A.NOV_AMT
+ A.DEC_AMT
END
),0) AD_AMT
FROM GEM_APRO_STEP A, GEM_ITEM B, GEM_REQUEST C
WHERE    B.GEN_EXPN_RQST_NO = C.GEN_EXPN_RQST_NO
AND      B.GEN_EXPN_RQST_NO = A.GEN_EXPN_RQST_NO
AND      B.OFC_CD = A.OFC_CD
AND      B.GEN_EXPN_CD = A.GEN_EXPN_CD
AND      B.GEN_EXPN_ITM_NO = A.GEN_EXPN_ITM_NO
AND      B.GEN_EXPN_TRNS_DIV_CD = A.GEN_EXPN_TRNS_DIV_CD
AND      B.GEN_EXPN_RQST_SEQ = A.GEN_EXPN_RQST_SEQ
AND      B.GEN_EXPN_APRO_AUTH_OFC_CD = A.GEN_EXPN_APRO_AUTH_OFC_CD
AND      C.GEN_EXPN_RQST_TP_CD = @[gen_expn_rqst_tp_cd]
AND      C.PLN_YRMON LIKE SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'%'
AND A.OFC_CD = @[to_ofc_cd]
AND A.GEN_EXPN_CD = @[to_gen_expn_cd]) AD_AMT
FROM
(SELECT   OFC_CD
,GEN_EXPN_CD
,SUM (YEAR_ASS_EXP) YEAR_ASS_EXP
,SUM (YTD_ASS_EXP) YTD_ASS_EXP
,SUM (YTD_PERF) YTD_PERF
FROM     (SELECT OFC_CD
,GEN_EXPN_CD
,   A.GEN_EXPN_INIT_AMT
+ A.GEN_EXPN_ADD_AMT
+ A.GEN_EXPN_TRNS_AMT YEAR_ASS_EXP
,CASE
WHEN RSLT_YRMON BETWEEN SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'01' AND TO_CHAR(SYSDATE, 'YYYYMM')
THEN (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)
ELSE 0
END YTD_ASS_EXP
,CASE
WHEN RSLT_YRMON BETWEEN SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'01' AND TO_CHAR(SYSDATE, 'YYYYMM')
THEN SLP_PERF_AMT
ELSE 0
END YTD_PERF
FROM   GEM_RSLT_SMRY A
WHERE  A.RSLT_YRMON LIKE SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'%'
AND A.OFC_CD = @[to_ofc_cd]
AND A.GEN_EXPN_CD = @[to_gen_expn_cd])
GROUP BY OFC_CD, GEN_EXPN_CD) A,
GEM_OFFICE B
WHERE A.OFC_CD = B.OFC_CD(+)

UNION ALL

SELECT 
'TO' FM_TO,
OFC_CD, GEN_EXPN_CD, 
'USD' LOCL_CURR_CD,
1 RQST_UT_VAL,
(SELECT AAA.YEAR_ASS_EXP/USD_LOCL_XCH_RT FROM GEM_XCH_RT WHERE ACCT_XCH_RT_YRMON = SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'00' AND GEN_EXPN_XCH_RT_DIV_CD = 'I' AND CURR_CD = AAA.LOCL_CURR_CD) YEAR_ASS_EXP,
(SELECT AAA.YTD_ASS_EXP/USD_LOCL_XCH_RT FROM GEM_XCH_RT WHERE ACCT_XCH_RT_YRMON = SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'00' AND GEN_EXPN_XCH_RT_DIV_CD = 'I' AND CURR_CD = AAA.LOCL_CURR_CD) YTD_ASS_EXP, 
AAA.YTD_PERF YTD_PERF, 
(SELECT AAA.AD_AMT/USD_LOCL_XCH_RT FROM GEM_XCH_RT WHERE ACCT_XCH_RT_YRMON = SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'00' AND GEN_EXPN_XCH_RT_DIV_CD = 'I' AND CURR_CD = AAA.LOCL_CURR_CD)*AAA.RQST_UT_VAL AD_AMT
FROM
(SELECT A.OFC_CD, A.GEN_EXPN_CD,
B.LOCL_CURR_CD,
B.RQST_UT_VAL,
YEAR_ASS_EXP,
YTD_ASS_EXP,
YTD_PERF,
(SELECT
NVL( MAX (CASE
WHEN A.GEN_EXPN_TRNS_DIV_CD = 'T'
AND     A.GEN_EXPN_APRO_STEP_CD = B.CRNT_GEN_EXPN_APRO_STEP_CD
THEN   A.JAN_AMT
+ A.FEB_AMT
+ A.MAR_AMT
+ A.APR_AMT
+ A.MAY_AMT
+ A.JUN_AMT
+ A.JUL_AMT
+ A.AUG_AMT
+ A.SEP_AMT
+ A.OCT_AMT
+ A.NOV_AMT
+ A.DEC_AMT
END
),0) AD_AMT
FROM GEM_APRO_STEP A, GEM_ITEM B, GEM_REQUEST C
WHERE    B.GEN_EXPN_RQST_NO = C.GEN_EXPN_RQST_NO
AND      B.GEN_EXPN_RQST_NO = A.GEN_EXPN_RQST_NO
AND      B.OFC_CD = A.OFC_CD
AND      B.GEN_EXPN_CD = A.GEN_EXPN_CD
AND      B.GEN_EXPN_ITM_NO = A.GEN_EXPN_ITM_NO
AND      B.GEN_EXPN_TRNS_DIV_CD = A.GEN_EXPN_TRNS_DIV_CD
AND      B.GEN_EXPN_RQST_SEQ = A.GEN_EXPN_RQST_SEQ
AND      B.GEN_EXPN_APRO_AUTH_OFC_CD = A.GEN_EXPN_APRO_AUTH_OFC_CD
AND      C.GEN_EXPN_RQST_TP_CD = @[gen_expn_rqst_tp_cd]
AND      C.PLN_YRMON LIKE SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'%'
AND A.OFC_CD = @[to_ofc_cd]
AND A.GEN_EXPN_CD = @[to_gen_expn_cd]) AD_AMT
FROM
(SELECT   OFC_CD
,GEN_EXPN_CD
,SUM (YEAR_ASS_EXP) YEAR_ASS_EXP
,SUM (YTD_ASS_EXP) YTD_ASS_EXP
,SUM (YTD_PERF) YTD_PERF
FROM     (SELECT A.OFC_CD
,GEN_EXPN_CD
,   A.GEN_EXPN_INIT_AMT
+ A.GEN_EXPN_ADD_AMT
+ A.GEN_EXPN_TRNS_AMT YEAR_ASS_EXP
,CASE
WHEN RSLT_YRMON BETWEEN SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'01' AND TO_CHAR(SYSDATE, 'YYYYMM')
THEN (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)
ELSE 0
END YTD_ASS_EXP
,CASE
WHEN RSLT_YRMON BETWEEN SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'01' AND TO_CHAR(SYSDATE, 'YYYYMM')
THEN (SELECT A.SLP_PERF_AMT/USD_LOCL_XCH_RT FROM GEM_XCH_RT WHERE ACCT_XCH_RT_YRMON = A.RSLT_YRMON AND GEN_EXPN_XCH_RT_DIV_CD = 'M' AND CURR_CD = B.LOCL_CURR_CD)
ELSE 0
END YTD_PERF
FROM   GEM_RSLT_SMRY A, GEM_OFFICE B
WHERE  A.RSLT_YRMON LIKE SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'),1,4)||'%'
AND A.OFC_CD = @[to_ofc_cd]
AND A.GEN_EXPN_CD = @[to_gen_expn_cd]
AND A.OFC_CD = B.OFC_CD(+))
GROUP BY OFC_CD, GEN_EXPN_CD) A,
GEM_OFFICE B
WHERE A.OFC_CD = B.OFC_CD(+)) AAA

#end			]]></sql>
			<params>
				<param name="gen_expn_rqst_tp_cd" type="12" value="" out="N"/>
				<param name="fm_ofc_cd" type="12" value="" out="N"/>
				<param name="fm_gen_expn_cd" type="12" value="" out="N"/>
				<param name="to_ofc_cd" type="12" value="" out="N"/>
				<param name="to_gen_expn_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
