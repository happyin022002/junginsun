<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="GEMPlanningPerformanceDBDAOSearchReportAfterClosingAllRSQL">
			<desc><![CDATA[조직별 예산과 실적을 조회한다
2011.01.31 이준범[CHM-201108626-01]
요청사항 : SELPLL- >SELLIC  관련 문제 연관 해소
보완내역 : 조직 변경으로 인한 조직 코드 변경시 과거 데이터를 조회 할 수 있도록
               History Table(GEM_OFC_HIS) 검색하도록 SQL 수정  

2012.12.12 Ticket ID : CHM-201221037
설계자 : 강환, 개발자 : 원종규
Title : 일부 법인 비용주관팀 로직 변경에 따른 조회(inquiry/Report) 기능 보완 요청
Description : SELPLI에서 승인하는 비용항목 조회시 SELPLI의 산하 조직이 조회되도록 수정

2014.10.23 이준범 [CHM-201432508-01]
요청사항: [GEM] 결산작업을 위한 데이터 업데이트 지원
보완: SELPLI 하드코딩 부분 삭제 ]]></desc>
			<sql><![CDATA[
SELECT A.OFC_CD||A.GEN_EXPN_CD AS OFFICE_EXPENSE
      ,DECODE(@[ofc_cur], 'LCL', B.LOCL_CURR_CD
                   , 'USD', 'USD'
                   , 'KRW', 'KRW' ) AS LOCL_CURR_CD
      ,DECODE(@[ofc_cur], 'LCL', B.RQST_UT_VAL
                   , 'USD', 1
                   , 'KRW', 1000 ) AS RQST_UT_VAL
      ,SUBSTR(@[from_rslt_yrmon], 1, 4) RT_YR 
#if(${monthly_view} == 'Y') 
	  ,SUBSTR(A.RSLT_YRMON, 5, 2) RT_FM_MON 
#else 
	  ,SUBSTR(@[from_rslt_yrmon],5,2) RT_FM_MON 
#end 
	  ,SUBSTR(@[to_rslt_yrmon],5,2) RT_TO_MON
      ,A.OFC_CD
#if(${sub_office_view} == 'Y')
      ,A.SUB_OFC_CD
#end
      ,DECODE(A.OFC_CO_DIV_CD, 'O', 'HJS', 'S', 'OS', 'E', 'ETC') OFC_CO_DIV_CD   
      ,( SELECT L_2 FROM GEM_OFC_LEVEL_V WHERE L_4 = A.OFC_CD ) AS LEVEL_2
      ,CASE WHEN GEN_EXPN_OFC_LVL = '4' AND A.OFC_CD <> B.PRNT_OFC_CD THEN B.PRNT_OFC_CD END LEVEL_3
      ,DECODE(B.RGN_OFC_FLG, 'Y',DECODE(@[sch_lang],'K','해외','FOREIGN'),DECODE(@[sch_lang],'K','국내','DOMESTIC')) AS RGN_OFC_FLG 
      ,C.SALY_FLG AS SLS_OFC_FLG
      ,A.GEN_EXPN_CD
      ,DECODE(@[sch_lang],'K',C.KRN_ABBR_NM, C.ENG_ABBR_NM) AS ABBR_NM
      ,C.TIC_CD
      ,DECODE(@[sch_lang],'K',C.KRN_ABBR_NM_1, C.ENG_ABBR_NM_1) AS ABBR_NM01      
      ,DECODE(@[sch_lang],'K',C.KRN_ABBR_NM_2, C.ENG_ABBR_NM_2) AS ABBR_NM02
      ,DECODE(@[sch_lang],'K',C.KRN_ABBR_NM_3, C.ENG_ABBR_NM_3) AS ABBR_NM03
      ,A.GEN_EXPN_INIT_AMT01 AS GEN_EXPN_INIT_AMT
      ,A.PLAN_ASSN_AMT01 AS LCL_ASSIGNED
      ,A.SLP_PERF_AMT01 AS SLP_PERF_AMT
      ,A.USD_PLAN_INIT_AMT01 AS USD_EXPN_INIT_AMT
      ,A.USD_PLAN_ASSN_AMT01 AS USD_ASSIGNED
      ,A.USD_PLAN_PERF_AMT01 AS USD_PERF_AMT
      ,A.USD_ACCT_INIT_AMT01 AS USD_ACC_EXPN_INIT_AMT
      ,A.USD_ACCT_ASSN_AMT01 AS USD_ACC_ASSIGNED
      ,A.USD_ACCT_PERF_AMT01 AS USD_ACC_PERF_AMT
      ,A.LCL_RATIO01 AS RATIO_BA
      ,A.USD_RATIO01 AS RATIO_FC
      ,A.PLAN_USD_LOCL_XCH_RT AS USD_LOCL_XCH_RT
      ,A.ACCT_USD_LOCL_XCH_RT AS USD_ACC_LOCL_XCH_RT
      ,A.SLP_PERF_AMT02 AS SLP_PERF_AMT01
      ,A.USD_PLAN_PERF_AMT02 AS USD_PERF_AMT01
      ,A.USD_ACCT_PERF_AMT02 AS USD_ACC_PERF_AMT01
      ,A.LCL_RATIO02 AS LCL_RATIO01
      ,A.USD_RATIO02 AS USD_RATIO01
      ,A.SLP_PERF_AMT03 AS SLP_PERF_AMT02
      ,A.USD_PLAN_PERF_AMT03 AS USD_PERF_AMT02
      ,A.USD_ACCT_PERF_AMT03 AS USD_ACC_PERF_AMT02
      ,A.LCL_RATIO03 AS LCL_RATIO02
      ,A.USD_RATIO03 AS USD_RATIO02
      ,A.SLP_PERF_AMT04 AS SLP_PERF_AMT03
      ,A.USD_PLAN_PERF_AMT04 AS USD_PERF_AMT03
      ,A.USD_ACCT_PERF_AMT04 AS USD_ACC_PERF_AMT03
      ,A.LCL_RATIO04 AS LCL_RATIO03
      ,A.USD_RATIO04 AS USD_RATIO03   
  FROM (
        SELECT A.OFC_CD
#if(${monthly_view} == 'Y')
	      ,A.RSLT_YRMON
#end
#if(${sub_office_view} == 'Y')
              ,A.SUB_OFC_CD  -- SUB OFFICE VIEW 선택시 추가
#end
              ,A.GEN_EXPN_CD
              ,A.OFC_CO_DIV_CD
              ,SUM(A.GEN_EXPN_INIT_AMT01) AS GEN_EXPN_INIT_AMT01
              ,SUM(A.PLAN_ASSN_AMT01) AS PLAN_ASSN_AMT01
              ,SUM(A.SLP_PERF_AMT01) AS SLP_PERF_AMT01
              ,SUM(A.USD_PLAN_INIT_AMT01) AS USD_PLAN_INIT_AMT01
              ,SUM(A.USD_PLAN_ASSN_AMT01) AS USD_PLAN_ASSN_AMT01
              ,SUM(A.USD_PLAN_PERF_AMT01) AS USD_PLAN_PERF_AMT01
              ,SUM(A.USD_ACCT_INIT_AMT01) AS USD_ACCT_INIT_AMT01
              ,SUM(A.USD_ACCT_ASSN_AMT01) AS USD_ACCT_ASSN_AMT01
              ,SUM(A.USD_ACCT_PERF_AMT01) AS USD_ACCT_PERF_AMT01
              ,DECODE(SUM(A.PLAN_ASSN_AMT01), 0, 0, (SUM(A.SLP_PERF_AMT01)/SUM(A.PLAN_ASSN_AMT01))*100 ) AS LCL_RATIO01
              ,DECODE(SUM(A.USD_PLAN_ASSN_AMT01), 0, 0, (SUM(A.USD_PLAN_PERF_AMT01)/SUM(A.USD_PLAN_ASSN_AMT01))*100 ) AS USD_RATIO01
              ,MAX(A.PLAN_USD_LOCL_XCH_RT) AS PLAN_USD_LOCL_XCH_RT
              ,MAX(A.ACCT_USD_LOCL_XCH_RT) AS ACCT_USD_LOCL_XCH_RT
              ,SUM(A.SLP_PERF_AMT02) SLP_PERF_AMT02      
              ,SUM(A.USD_PLAN_PERF_AMT02) AS USD_PLAN_PERF_AMT02
              ,SUM(A.USD_ACCT_PERF_AMT02) AS USD_ACCT_PERF_AMT02
              ,DECODE(SUM(A.PLAN_ASSN_AMT02), 0, 0, (SUM(A.SLP_PERF_AMT02)/SUM(A.PLAN_ASSN_AMT02))*100 ) AS LCL_RATIO02
              ,DECODE(SUM(A.USD_PLAN_ASSN_AMT02), 0, 0, (SUM(A.USD_ACCT_PERF_AMT02)/SUM(A.USD_PLAN_ASSN_AMT02))*100 ) AS USD_RATIO02   
              ,SUM(A.SLP_PERF_AMT03) SLP_PERF_AMT03        
              ,SUM(A.USD_PLAN_PERF_AMT03) AS USD_PLAN_PERF_AMT03
              ,SUM(A.USD_ACCT_PERF_AMT03) AS USD_ACCT_PERF_AMT03
              ,DECODE(SUM(A.PLAN_ASSN_AMT03), 0, 0, (SUM(A.SLP_PERF_AMT03)/SUM(A.PLAN_ASSN_AMT03))*100 ) AS LCL_RATIO03
              ,DECODE(SUM(A.USD_PLAN_ASSN_AMT03), 0, 0, (SUM(A.USD_ACCT_PERF_AMT03)/SUM(A.USD_PLAN_ASSN_AMT03))*100 ) AS USD_RATIO03
              ,SUM(A.SLP_PERF_AMT04) SLP_PERF_AMT04
              ,SUM(A.USD_PLAN_PERF_AMT04) AS USD_PLAN_PERF_AMT04
              ,SUM(A.USD_ACCT_PERF_AMT04) AS USD_ACCT_PERF_AMT04
              ,DECODE(SUM(A.PLAN_ASSN_AMT04), 0, 0, (SUM(A.SLP_PERF_AMT04)/SUM(A.PLAN_ASSN_AMT04))*100 ) AS LCL_RATIO04
              ,DECODE(SUM(A.USD_PLAN_ASSN_AMT04), 0, 0, (SUM(A.USD_ACCT_PERF_AMT04)/SUM(A.USD_PLAN_ASSN_AMT04))*100 ) AS USD_RATIO04
          FROM (
                SELECT A.RSLT_YRMON 
                      ,A.OFC_CD
                      ,A.SUB_OFC_CD
                      ,A.GEN_EXPN_CD
                      ,A.OFC_CO_DIV_CD
                      ,NVL(A.GEN_EXPN_INIT_AMT01, 0) AS GEN_EXPN_INIT_AMT01
                      ,NVL(A.PLAN_ASSN_AMT01, 0) AS PLAN_ASSN_AMT01
                      ,NVL(A.SLP_PERF_AMT01, 0) AS SLP_PERF_AMT01
                      ,NVL(A.USD_PLAN_INIT_AMT01, 0) AS USD_PLAN_INIT_AMT01
                      ,NVL(A.USD_PLAN_ASSN_AMT01, 0) AS USD_PLAN_ASSN_AMT01
                      ,NVL(A.USD_PLAN_PERF_AMT01, 0) AS USD_PLAN_PERF_AMT01
                      ,NVL(A.USD_ACCT_INIT_AMT01, 0) AS USD_ACCT_INIT_AMT01
                      ,NVL(A.USD_ACCT_ASSN_AMT01, 0) AS USD_ACCT_ASSN_AMT01
                      ,NVL(A.USD_ACCT_PERF_AMT01, 0) AS USD_ACCT_PERF_AMT01
                      ,NVL(A.PLAN_USD_LOCL_XCH_RT, 0) AS PLAN_USD_LOCL_XCH_RT
                      ,NVL(A.ACCT_USD_LOCL_XCH_RT, 0) AS ACCT_USD_LOCL_XCH_RT
                      ,NVL(B.PLAN_ASSN_AMT02, 0) AS PLAN_ASSN_AMT02
                      ,NVL(B.SLP_PERF_AMT02, 0) AS SLP_PERF_AMT02
                      ,NVL(B.USD_PLAN_ASSN_AMT02, 0) AS USD_PLAN_ASSN_AMT02
                      ,NVL(B.USD_PLAN_PERF_AMT02, 0) AS USD_PLAN_PERF_AMT02
                      ,NVL(B.USD_ACCT_PERF_AMT02, 0) AS USD_ACCT_PERF_AMT02
                      ,NVL(C.PLAN_ASSN_AMT03, 0) AS PLAN_ASSN_AMT03
                      ,NVL(C.SLP_PERF_AMT03, 0) AS SLP_PERF_AMT03
                      ,NVL(C.USD_PLAN_ASSN_AMT03, 0) AS USD_PLAN_ASSN_AMT03
                      ,NVL(C.USD_PLAN_PERF_AMT03, 0) AS USD_PLAN_PERF_AMT03
                      ,NVL(C.USD_ACCT_PERF_AMT03, 0) AS USD_ACCT_PERF_AMT03
                      ,NVL(D.PLAN_ASSN_AMT04, 0) AS PLAN_ASSN_AMT04
                      ,NVL(D.SLP_PERF_AMT04, 0) AS SLP_PERF_AMT04
                      ,NVL(D.USD_PLAN_ASSN_AMT04, 0) AS USD_PLAN_ASSN_AMT04
                      ,NVL(D.USD_PLAN_PERF_AMT04, 0) AS USD_PLAN_PERF_AMT04
                      ,NVL(D.USD_ACCT_PERF_AMT04, 0) AS USD_ACCT_PERF_AMT04
                      ,NVL(A.GEN_EXPN_INIT_AMT01, 0) + NVL(A.PLAN_ASSN_AMT01, 0) + NVL(A.SLP_PERF_AMT01, 0)
                            + NVL(A.USD_PLAN_INIT_AMT01, 0) + NVL(A.USD_PLAN_ASSN_AMT01, 0) + NVL(A.USD_PLAN_PERF_AMT01, 0)
                            + NVL(A.USD_ACCT_INIT_AMT01, 0) + NVL(A.USD_ACCT_ASSN_AMT01, 0) + NVL(A.USD_ACCT_PERF_AMT01, 0)
                            + NVL(B.SLP_PERF_AMT02, 0) + NVL(B.USD_PLAN_PERF_AMT02, 0) + NVL(B.USD_ACCT_PERF_AMT02, 0)
                            + NVL(C.SLP_PERF_AMT03, 0) + NVL(C.USD_PLAN_PERF_AMT03, 0) + NVL(C.USD_ACCT_PERF_AMT03, 0)
                            + NVL(D.SLP_PERF_AMT04, 0) + NVL(D.USD_PLAN_PERF_AMT04, 0) + NVL(D.USD_ACCT_PERF_AMT04, 0) AS AMT_TOT                      
                  FROM (
                        SELECT A.RSLT_YRMON 
                              ,A.OFC_CD
                              ,A.SUB_OFC_CD
                              ,A.GEN_EXPN_CD
                              ,A.OFC_CO_DIV_CD 
                              ,DECODE(@[ofc_cur], 'LCL', A.GEN_EXPN_INIT_AMT/B.RQST_UT_VAL
                                           , 'USD', A.GEN_EXPN_INIT_AMT/C.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.GEN_EXPN_INIT_AMT/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS GEN_EXPN_INIT_AMT01
                              ,DECODE(@[ofc_cur], 'LCL', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/B.RQST_UT_VAL
                                           , 'USD', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'KRW', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS PLAN_ASSN_AMT01
                              ,DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/B.RQST_UT_VAL
                                           , 'USD', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT ) AS SLP_PERF_AMT01
                              ,DECODE(@[ofc_cur], 'LCL', (A.GEN_EXPN_INIT_AMT/C.USD_LOCL_XCH_RT)
                                           , 'USD', (A.GEN_EXPN_INIT_AMT/C.USD_LOCL_XCH_RT)
                                           , 'KRW', ((A.GEN_EXPN_INIT_AMT/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS USD_PLAN_INIT_AMT01
                              ,DECODE(@[ofc_cur], 'LCL', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'USD', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'KRW', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS USD_PLAN_ASSN_AMT01
                              ,DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/C.USD_LOCL_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/C.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS USD_PLAN_PERF_AMT01     
                              ,DECODE(@[ofc_cur], 'LCL', A.GEN_EXPN_INIT_AMT/D.USD_LOCL_XCH_RT
                                           , 'USD', A.GEN_EXPN_INIT_AMT/D.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.GEN_EXPN_INIT_AMT/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT ) AS USD_ACCT_INIT_AMT01     
                              ,DECODE(@[ofc_cur], 'LCL', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/D.USD_LOCL_XCH_RT
                                           , 'USD', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/D.USD_LOCL_XCH_RT
                                           , 'KRW', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT ) AS USD_ACCT_ASSN_AMT01   
                              ,DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT ) AS USD_ACCT_PERF_AMT01     
                              ,C.USD_LOCL_XCH_RT AS PLAN_USD_LOCL_XCH_RT
                              ,D.USD_LOCL_XCH_RT AS ACCT_USD_LOCL_XCH_RT             
                          FROM (
                                SELECT A.RSLT_YRMON 
                                      ,A.OFC_CD
                                      ,A.SUB_OFC_CD
                                      ,A.GEN_EXPN_CD
                                      ,A.OFC_CO_DIV_CD
                                      ,SUM(NVL(B.GEN_EXPN_INIT_AMT, 0)) GEN_EXPN_INIT_AMT 
                                      ,SUM(NVL(B.GEN_EXPN_ADD_AMT, 0)) GEN_EXPN_ADD_AMT
                                      ,SUM(NVL(B.GEN_EXPN_TRNS_AMT, 0)) GEN_EXPN_TRNS_AMT
                                      ,SUM(NVL(B.SLP_PERF_AMT, 0)) SLP_PERF_AMT
                                  FROM ( 
                                        SELECT SUBSTR(@[from_rslt_yrmon],1,4)||B.MM RSLT_YRMON
                                              ,A.OFC_CD
                                              ,A.SUB_OFC_CD
                                              ,A.GEN_EXPN_CD
                                              ,A.OFC_CO_DIV_CD
                                          FROM ( 
                                                SELECT DISTINCT OFC_CD, SUB_OFC_CD, GEN_EXPN_CD, OFC_CO_DIV_CD 
                                                  FROM GEM_RSLT_SMRY
                                                 WHERE RSLT_YRMON BETWEEN TO_CHAR(@[from_rslt_yrmon]-'300'||'01') AND SUBSTR(@[to_rslt_yrmon], 1, 4)||'12'
                                               ) A
                                              ,( 
                                                SELECT TRIM(TO_CHAR(ROWNUM, '00')) MM 
                                                  FROM DUAL CONNECT BY LEVEL <= 12 
                                               ) B    
                                       ) A
                                      ,GEM_RSLT_SMRY B
                                 WHERE A.RSLT_YRMON  = B.RSLT_YRMON(+)
                                   AND A.OFC_CD      = B.OFC_CD(+)
                                   AND A.SUB_OFC_CD  = B.SUB_OFC_CD(+)
                                   AND A.GEN_EXPN_CD = B.GEN_EXPN_CD(+)
                                   AND A.OFC_CO_DIV_CD = B.OFC_CO_DIV_CD(+)  
                              GROUP BY A.RSLT_YRMON 
                                      ,A.OFC_CD
                                      ,A.SUB_OFC_CD
                                      ,A.GEN_EXPN_CD
                                      ,A.OFC_CO_DIV_CD                          
                               ) A
                              ,GEM_OFFICE B
                              ,GEM_XCH_RT C
                              ,(
                                SELECT A.ACCT_XCH_RT_YRMON
                                      ,A.CURR_CD
                                      ,B.USD_LOCL_XCH_RT
                                      ,B.LOCL_KRW_XCH_RT
                                      ,B.USD_KRW_XCH_RT
                                  FROM (
                                        SELECT B.ACCT_XCH_RT_YRMON
                                              ,A.CURR_CD
                                          FROM (
                                                SELECT DISTINCT CURR_CD
                                                  FROM GEM_XCH_RT
                                                 WHERE ACCT_XCH_RT_YRMON LIKE SUBSTR(@[from_rslt_yrmon], 1, 4)||'%'
                                               ) A
                                              ,(
                                                SELECT SUBSTR(@[from_rslt_yrmon], 1, 4)||TRIM(TO_CHAR(ROWNUM, '00')) ACCT_XCH_RT_YRMON
                                                  FROM DUAL CONNECT BY LEVEL <= 12
                                               ) B
                                       ) A
                                      ,GEM_XCH_RT B
                                 WHERE A.ACCT_XCH_RT_YRMON = B.ACCT_XCH_RT_YRMON(+)
                                   AND A.CURR_CD = B.CURR_CD(+)
                                   AND B.GEN_EXPN_XCH_RT_DIV_CD(+) = 'M'
                               ) D
                         WHERE A.RSLT_YRMON BETWEEN @[from_rslt_yrmon] AND @[to_rslt_yrmon]
                           AND A.OFC_CD = B.OFC_CD
                           AND B.LOCL_CURR_CD  = C.CURR_CD
                           AND C.ACCT_XCH_RT_YRMON = SUBSTR(@[from_rslt_yrmon], 1, 4)||'00' 
                           AND C.GEN_EXPN_XCH_RT_DIV_CD = 'I' 
                           AND B.LOCL_CURR_CD  = D.CURR_CD
                           AND A.RSLT_YRMON    = D.ACCT_XCH_RT_YRMON
#if(${expn_dep} == 'FAC')                           
                           AND 1 = DECODE(A.GEN_EXPN_CD, '240601', DECODE(A.OFC_CO_DIV_CD, 'O', 0 , 1 ) , 1 )  -- Depreciation (240601) : Divide 선택시 제외     
#end                                          
                       ) A    
                      ,( 
                        SELECT SUBSTR(@[from_rslt_yrmon], 1, 4)||SUBSTR(A.RSLT_YRMON , 5,2) RSLT_YRMON
                              ,A.OFC_CD
                              ,A.SUB_OFC_CD
                              ,A.GEN_EXPN_CD 
                              ,A.OFC_CO_DIV_CD
                              ,SUM(DECODE(@[ofc_cur], 'LCL', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/B.RQST_UT_VAL
                                           , 'USD', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'KRW', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT )) AS PLAN_ASSN_AMT02
                              ,SUM(DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/B.RQST_UT_VAL
                                           , 'USD', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT )) AS SLP_PERF_AMT02
                              ,SUM(DECODE(@[ofc_cur], 'LCL', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'USD', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'KRW', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT )) AS USD_PLAN_ASSN_AMT02
                              ,SUM(DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/C.USD_LOCL_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/C.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT )) AS USD_PLAN_PERF_AMT02
                              ,SUM(DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT )) AS USD_ACCT_PERF_AMT02
                          FROM GEM_RSLT_SMRY A
                              ,GEM_OFFICE B
                              ,GEM_XCH_RT C
                              ,GEM_XCH_RT D   
                         WHERE A.RSLT_YRMON BETWEEN TO_CHAR(@[from_rslt_yrmon]-'100') AND TO_CHAR(@[to_rslt_yrmon]-'100')
                           AND A.OFC_CD = B.OFC_CD 
                           AND B.LOCL_CURR_CD = C.CURR_CD
                           AND C.ACCT_XCH_RT_YRMON = SUBSTR(@[from_rslt_yrmon], 1, 4)-'1'||'00'  
                           AND C.GEN_EXPN_XCH_RT_DIV_CD = 'I'
                           AND B.LOCL_CURR_CD = D.CURR_CD
                           AND A.RSLT_YRMON = D.ACCT_XCH_RT_YRMON
                           AND D.GEN_EXPN_XCH_RT_DIV_CD = 'M'
#if(${expn_dep} == 'FAC')                           
                           AND 1 = DECODE(A.GEN_EXPN_CD, '240601', DECODE(A.OFC_CO_DIV_CD, 'O', 0 , 1 ) , 1 )  -- Depreciation (240601) : Divide 선택시 제외   
#end                
                      GROUP BY SUBSTR(@[from_rslt_yrmon], 1, 4)||SUBSTR(A.RSLT_YRMON , 5,2) 
                              ,A.OFC_CD
                              ,A.SUB_OFC_CD
                              ,A.GEN_EXPN_CD 
                              ,A.OFC_CO_DIV_CD           
                       ) B
                      ,( 
                        SELECT SUBSTR(@[from_rslt_yrmon], 1, 4)||SUBSTR(A.RSLT_YRMON , 5,2) RSLT_YRMON
                              ,A.OFC_CD
                              ,A.SUB_OFC_CD
                              ,A.GEN_EXPN_CD
                              ,A.OFC_CO_DIV_CD
                              ,SUM(DECODE(@[ofc_cur], 'LCL', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/B.RQST_UT_VAL
                                           , 'USD', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'KRW', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT )) AS PLAN_ASSN_AMT03
                              ,SUM(DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/B.RQST_UT_VAL
                                           , 'USD', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT )) AS SLP_PERF_AMT03
                              ,SUM(DECODE(@[ofc_cur], 'LCL', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'USD', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'KRW', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT )) AS USD_PLAN_ASSN_AMT03
                              ,SUM(DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/C.USD_LOCL_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/C.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT )) AS USD_PLAN_PERF_AMT03
                              ,SUM(DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT )) AS USD_ACCT_PERF_AMT03
                          FROM GEM_RSLT_SMRY A
                              ,GEM_OFFICE B
                              ,GEM_XCH_RT C
                              ,GEM_XCH_RT D   
                         WHERE A.RSLT_YRMON BETWEEN TO_CHAR(@[from_rslt_yrmon]-'200') AND TO_CHAR(@[to_rslt_yrmon]-'200')
                           AND A.OFC_CD = B.OFC_CD 
                           AND B.LOCL_CURR_CD = C.CURR_CD
                           AND C.ACCT_XCH_RT_YRMON = SUBSTR(@[from_rslt_yrmon], 1, 4)-'2'||'00'  
                           AND C.GEN_EXPN_XCH_RT_DIV_CD = 'I'
                           AND B.LOCL_CURR_CD = D.CURR_CD
                           AND A.RSLT_YRMON = D.ACCT_XCH_RT_YRMON
                           AND D.GEN_EXPN_XCH_RT_DIV_CD = 'M'
#if(${expn_dep} == 'FAC')                           
                           AND 1 = DECODE(A.GEN_EXPN_CD, '240601', DECODE(A.OFC_CO_DIV_CD, 'O', 0 , 1 ) , 1 )  -- Depreciation (240601) : Divide 선택시 제외   
#end   
                      GROUP BY SUBSTR(@[from_rslt_yrmon], 1, 4)||SUBSTR(A.RSLT_YRMON , 5,2) 
                              ,A.OFC_CD
                              ,A.SUB_OFC_CD
                              ,A.GEN_EXPN_CD 
                              ,A.OFC_CO_DIV_CD                          
                       ) C
                      ,( 
                        SELECT SUBSTR(@[from_rslt_yrmon], 1, 4)||SUBSTR(A.RSLT_YRMON , 5,2) RSLT_YRMON
                              ,A.OFC_CD
                              ,A.SUB_OFC_CD
                              ,A.GEN_EXPN_CD
                              ,A.OFC_CO_DIV_CD
                              ,SUM(DECODE(@[ofc_cur], 'LCL', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/B.RQST_UT_VAL
                                           , 'USD', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'KRW', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT )) AS PLAN_ASSN_AMT04
                              ,SUM(DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/B.RQST_UT_VAL
                                           , 'USD', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT )) AS SLP_PERF_AMT04
                              ,SUM(DECODE(@[ofc_cur], 'LCL', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'USD', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'KRW', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT )) AS USD_PLAN_ASSN_AMT04
                              ,SUM(DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/C.USD_LOCL_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/C.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT )) AS USD_PLAN_PERF_AMT04
                              ,SUM(DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT )) AS USD_ACCT_PERF_AMT04
                          FROM GEM_RSLT_SMRY A
                              ,GEM_OFFICE B
                              ,GEM_XCH_RT C
                              ,GEM_XCH_RT D   
                         WHERE A.RSLT_YRMON BETWEEN TO_CHAR(@[from_rslt_yrmon]-'300') AND TO_CHAR(@[to_rslt_yrmon]-'300')
                           AND A.OFC_CD = B.OFC_CD 
                           AND B.LOCL_CURR_CD = C.CURR_CD
                           AND C.ACCT_XCH_RT_YRMON = SUBSTR(@[from_rslt_yrmon], 1, 4)-'3'||'00'  
                           AND C.GEN_EXPN_XCH_RT_DIV_CD = 'I'
                           AND B.LOCL_CURR_CD = D.CURR_CD
                           AND A.RSLT_YRMON = D.ACCT_XCH_RT_YRMON
                           AND D.GEN_EXPN_XCH_RT_DIV_CD = 'M'
#if(${expn_dep} == 'FAC')
                           AND 1 = DECODE(A.GEN_EXPN_CD, '240601', DECODE(A.OFC_CO_DIV_CD, 'O', 0 , 1 ) , 1 )  -- Depreciation (240601) : Divide 선택시 제외   
#end                    
                      GROUP BY SUBSTR(@[from_rslt_yrmon], 1, 4)||SUBSTR(A.RSLT_YRMON , 5,2) 
                              ,A.OFC_CD
                              ,A.SUB_OFC_CD
                              ,A.GEN_EXPN_CD 
                              ,A.OFC_CO_DIV_CD        
                      ) D
                 WHERE 1=1
                   AND A.RSLT_YRMON  = B.RSLT_YRMON(+)
                   AND A.OFC_CD      = B.OFC_CD(+)
                   AND A.SUB_OFC_CD  = B.SUB_OFC_CD(+)
                   AND A.GEN_EXPN_CD = B.GEN_EXPN_CD(+)
                   AND A.OFC_CO_DIV_CD = B.OFC_CO_DIV_CD(+)
                   AND A.RSLT_YRMON  = C.RSLT_YRMON(+)
                   AND A.OFC_CD      = C.OFC_CD(+)
                   AND A.SUB_OFC_CD  = C.SUB_OFC_CD(+)
                   AND A.GEN_EXPN_CD = C.GEN_EXPN_CD(+)
                   AND A.OFC_CO_DIV_CD = C.OFC_CO_DIV_CD(+)
                   AND A.RSLT_YRMON  = D.RSLT_YRMON(+)
                   AND A.OFC_CD      = D.OFC_CD(+)
                   AND A.SUB_OFC_CD  = D.SUB_OFC_CD(+)
                   AND A.GEN_EXPN_CD = D.GEN_EXPN_CD(+)
                   AND A.OFC_CO_DIV_CD = D.OFC_CO_DIV_CD(+)
               ) A
              ,GEM_EXPENSE B 
         WHERE A.GEN_EXPN_CD = B.GEN_EXPN_CD     
           AND A.AMT_TOT <> 0 
#if(${auth_flg} == 'YNYN')           
           AND ( A.OFC_CD IN (SELECT OFC_CD      
                                FROM GEM_OFC_HIS
                          START WITH OFC_CD IN (@[login_office])
                    CONNECT BY PRIOR OFC_CD = BFR_OFC_CD ) 
                OR B.TIC_CD = @[login_office] )
#elseif(${auth_flg} == 'YYYN')
           AND ( A.OFC_CD IN ( SELECT OFC_CD      
                                 FROM GEM_OFC_HIS
                           START WITH OFC_CD IN ( SELECT L_4 
                                                    FROM GEM_OFC_LEVEL_V 
                                                   WHERE L_3 = @[login_office] )
                     CONNECT BY PRIOR OFC_CD = BFR_OFC_CD ) OR B.TIC_CD = @[login_office] )    
#end                                      
      GROUP BY A.OFC_CD
#if(${monthly_view} == 'Y')      
              ,A.RSLT_YRMON
#end              
#if(${sub_office_view} == 'Y')              
              ,A.SUB_OFC_CD  -- SUB OFFICE VIEW 선택시 추가
#end              
              ,A.GEN_EXPN_CD
              ,A.OFC_CO_DIV_CD  
#if(${expn_dep} == 'FAC')                  
        UNION ALL
        SELECT B.TIC_CD AS OFC_CD
#if(${monthly_view} == 'Y')
	      ,A.RSLT_YRMON
#end
#if(${sub_office_view} == 'Y')              
              ,B.TIC_CD AS SUB_OFC_CD  
#end              
              ,A.GEN_EXPN_CD
              ,A.OFC_CO_DIV_CD      
              ,SUM(A.GEN_EXPN_INIT_AMT01) AS GEN_EXPN_INIT_AMT01
              ,SUM(A.PLAN_ASSN_AMT01) AS PLAN_ASSN_AMT01
              ,SUM(A.SLP_PERF_AMT01) AS SLP_PERF_AMT01
              ,SUM(A.USD_PLAN_INIT_AMT01) AS USD_PLAN_INIT_AMT01
              ,SUM(A.USD_PLAN_ASSN_AMT01) AS USD_PLAN_ASSN_AMT01
              ,SUM(A.USD_PLAN_PERF_AMT01) AS USD_PLAN_PERF_AMT01
              ,SUM(A.USD_ACCT_INIT_AMT01) AS USD_ACCT_INIT_AMT01
              ,SUM(A.USD_ACCT_ASSN_AMT01) AS USD_ACCT_ASSN_AMT01
              ,SUM(A.USD_ACCT_PERF_AMT01) AS USD_ACCT_PERF_AMT01
              ,DECODE(SUM(A.PLAN_ASSN_AMT01), 0, 0, (SUM(A.SLP_PERF_AMT01)/SUM(A.PLAN_ASSN_AMT01))*100 ) AS LCL_RATIO01
              ,DECODE(SUM(A.USD_PLAN_ASSN_AMT01), 0, 0, (SUM(A.USD_PLAN_PERF_AMT01)/SUM(A.USD_PLAN_ASSN_AMT01))*100 ) AS USD_RATIO01
              ,MAX(A.PLAN_USD_LOCL_XCH_RT) AS PLAN_USD_LOCL_XCH_RT
              ,MAX(A.ACCT_USD_LOCL_XCH_RT) AS ACCT_USD_LOCL_XCH_RT
              ,SUM(A.SLP_PERF_AMT02) SLP_PERF_AMT02      
              ,SUM(A.USD_PLAN_PERF_AMT02) AS USD_PLAN_PERF_AMT02
              ,SUM(A.USD_ACCT_PERF_AMT02) AS USD_ACCT_PERF_AMT02
              ,DECODE(SUM(A.PLAN_ASSN_AMT02), 0, 0, (SUM(A.SLP_PERF_AMT02)/SUM(A.PLAN_ASSN_AMT02))*100 ) AS LCL_RATIO02
              ,DECODE(SUM(A.USD_PLAN_ASSN_AMT02), 0, 0, (SUM(A.USD_ACCT_PERF_AMT02)/SUM(A.USD_PLAN_ASSN_AMT02))*100 ) AS USD_RATIO02   
              ,SUM(A.SLP_PERF_AMT03) SLP_PERF_AMT03        
              ,SUM(A.USD_PLAN_PERF_AMT03) AS USD_PLAN_PERF_AMT03
              ,SUM(A.USD_ACCT_PERF_AMT03) AS USD_ACCT_PERF_AMT03
              ,DECODE(SUM(A.PLAN_ASSN_AMT03), 0, 0, (SUM(A.SLP_PERF_AMT03)/SUM(A.PLAN_ASSN_AMT03))*100 ) AS LCL_RATIO03
              ,DECODE(SUM(A.USD_PLAN_ASSN_AMT03), 0, 0, (SUM(A.USD_ACCT_PERF_AMT03)/SUM(A.USD_PLAN_ASSN_AMT03))*100 ) AS USD_RATIO03
              ,SUM(A.SLP_PERF_AMT04) SLP_PERF_AMT04
              ,SUM(A.USD_PLAN_PERF_AMT04) AS USD_PLAN_PERF_AMT04
              ,SUM(A.USD_ACCT_PERF_AMT04) AS USD_ACCT_PERF_AMT04
              ,DECODE(SUM(A.PLAN_ASSN_AMT04), 0, 0, (SUM(A.SLP_PERF_AMT04)/SUM(A.PLAN_ASSN_AMT04))*100 ) AS LCL_RATIO04
              ,DECODE(SUM(A.USD_PLAN_ASSN_AMT04), 0, 0, (SUM(A.USD_ACCT_PERF_AMT04)/SUM(A.USD_PLAN_ASSN_AMT04))*100 ) AS USD_RATIO04
          FROM (
                SELECT A.RSLT_YRMON
                      ,A.OFC_CD
                      ,A.SUB_OFC_CD
                      ,A.GEN_EXPN_CD
                      ,NVL(A.OFC_CO_DIV_CD, 'O') AS OFC_CO_DIV_CD
                      ,NVL(A.GEN_EXPN_INIT_AMT01, 0) AS GEN_EXPN_INIT_AMT01
                      ,NVL(A.PLAN_ASSN_AMT01, 0) AS PLAN_ASSN_AMT01
                      ,NVL(A.SLP_PERF_AMT01, 0) AS SLP_PERF_AMT01
                      ,NVL(A.USD_PLAN_INIT_AMT01, 0) AS USD_PLAN_INIT_AMT01
                      ,NVL(A.USD_PLAN_ASSN_AMT01, 0) AS USD_PLAN_ASSN_AMT01
                      ,NVL(A.USD_PLAN_PERF_AMT01, 0) AS USD_PLAN_PERF_AMT01
                      ,NVL(A.USD_ACCT_INIT_AMT01, 0) AS USD_ACCT_INIT_AMT01
                      ,NVL(A.USD_ACCT_ASSN_AMT01, 0) AS USD_ACCT_ASSN_AMT01
                      ,NVL(A.USD_ACCT_PERF_AMT01, 0) AS USD_ACCT_PERF_AMT01
                      ,NVL(A.PLAN_USD_LOCL_XCH_RT, 0) AS PLAN_USD_LOCL_XCH_RT
                      ,NVL(A.ACCT_USD_LOCL_XCH_RT, 0) AS ACCT_USD_LOCL_XCH_RT
                      ,NVL(B.PLAN_ASSN_AMT02, 0) AS PLAN_ASSN_AMT02
                      ,NVL(B.SLP_PERF_AMT02, 0) AS SLP_PERF_AMT02
                      ,NVL(B.USD_PLAN_ASSN_AMT02, 0) AS USD_PLAN_ASSN_AMT02
                      ,NVL(B.USD_PLAN_PERF_AMT02, 0) AS USD_PLAN_PERF_AMT02
                      ,NVL(B.USD_ACCT_PERF_AMT02, 0) AS USD_ACCT_PERF_AMT02
                      ,NVL(C.PLAN_ASSN_AMT03, 0) AS PLAN_ASSN_AMT03
                      ,NVL(C.SLP_PERF_AMT03, 0) AS SLP_PERF_AMT03
                      ,NVL(C.USD_PLAN_ASSN_AMT03, 0) AS USD_PLAN_ASSN_AMT03
                      ,NVL(C.USD_PLAN_PERF_AMT03, 0) AS USD_PLAN_PERF_AMT03
                      ,NVL(C.USD_ACCT_PERF_AMT03, 0) AS USD_ACCT_PERF_AMT03
                      ,NVL(D.PLAN_ASSN_AMT04, 0) AS PLAN_ASSN_AMT04
                      ,NVL(D.SLP_PERF_AMT04, 0) AS SLP_PERF_AMT04
                      ,NVL(D.USD_PLAN_ASSN_AMT04, 0) AS USD_PLAN_ASSN_AMT04
                      ,NVL(D.USD_PLAN_PERF_AMT04, 0) AS USD_PLAN_PERF_AMT04
                      ,NVL(D.USD_ACCT_PERF_AMT04, 0) AS USD_ACCT_PERF_AMT04
                      ,NVL(A.GEN_EXPN_INIT_AMT01, 0) + NVL(A.PLAN_ASSN_AMT01, 0) + NVL(A.SLP_PERF_AMT01, 0)
                            + NVL(A.USD_PLAN_INIT_AMT01, 0) + NVL(A.USD_PLAN_ASSN_AMT01, 0) + NVL(A.USD_PLAN_PERF_AMT01, 0)
                            + NVL(A.USD_ACCT_INIT_AMT01, 0) + NVL(A.USD_ACCT_ASSN_AMT01, 0) + NVL(A.USD_ACCT_PERF_AMT01, 0)
                            + NVL(B.SLP_PERF_AMT02, 0) + NVL(B.USD_PLAN_PERF_AMT02, 0) + NVL(B.USD_ACCT_PERF_AMT02, 0)
                            + NVL(C.SLP_PERF_AMT03, 0) + NVL(C.USD_PLAN_PERF_AMT03, 0) + NVL(C.USD_ACCT_PERF_AMT03, 0)
                            + NVL(D.SLP_PERF_AMT04, 0) + NVL(D.USD_PLAN_PERF_AMT04, 0) + NVL(D.USD_ACCT_PERF_AMT04, 0) AS AMT_TOT
                  FROM (
                        SELECT A.RSLT_YRMON 
                              ,A.OFC_CD
                              ,A.SUB_OFC_CD
                              ,A.GEN_EXPN_CD
                              ,A.OFC_CO_DIV_CD
                              ,DECODE(@[ofc_cur], 'LCL', ((A.GEN_EXPN_INIT_AMT/B.RQST_UT_VAL)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT
                                           , 'USD', A.GEN_EXPN_INIT_AMT/C.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.GEN_EXPN_INIT_AMT/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS GEN_EXPN_INIT_AMT01
                              ,DECODE(@[ofc_cur], 'LCL', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/B.RQST_UT_VAL)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT
                                           , 'USD', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'KRW', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS PLAN_ASSN_AMT01
                              ,DECODE(@[ofc_cur], 'LCL', ((A.SLP_PERF_AMT/B.RQST_UT_VAL)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT ) AS SLP_PERF_AMT01
                              ,DECODE(@[ofc_cur], 'LCL', (A.GEN_EXPN_INIT_AMT/C.USD_LOCL_XCH_RT)
                                           , 'USD', (A.GEN_EXPN_INIT_AMT/C.USD_LOCL_XCH_RT)
                                           , 'KRW', ((A.GEN_EXPN_INIT_AMT/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS USD_PLAN_INIT_AMT01                                   
                              ,DECODE(@[ofc_cur], 'LCL', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'USD', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'KRW', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS USD_PLAN_ASSN_AMT01
                              ,DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/C.USD_LOCL_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/C.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS USD_PLAN_PERF_AMT01     
                              ,DECODE(@[ofc_cur], 'LCL', A.GEN_EXPN_INIT_AMT/D.USD_LOCL_XCH_RT
                                           , 'USD', A.GEN_EXPN_INIT_AMT/D.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.GEN_EXPN_INIT_AMT/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT ) AS USD_ACCT_INIT_AMT01     
                              ,DECODE(@[ofc_cur], 'LCL', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/D.USD_LOCL_XCH_RT
                                           , 'USD', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/D.USD_LOCL_XCH_RT
                                           , 'KRW', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT ) AS USD_ACCT_ASSN_AMT01   
                              ,DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT ) AS USD_ACCT_PERF_AMT01
                              ,C.USD_LOCL_XCH_RT AS PLAN_USD_LOCL_XCH_RT
                              ,D.USD_LOCL_XCH_RT AS ACCT_USD_LOCL_XCH_RT             
                          FROM (
                                SELECT A.RSLT_YRMON 
                                      ,A.OFC_CD
                                      ,A.SUB_OFC_CD
                                      ,A.GEN_EXPN_CD
                                      ,A.OFC_CO_DIV_CD
                                      ,NVL(B.GEN_EXPN_INIT_AMT, 0) GEN_EXPN_INIT_AMT 
                                      ,NVL(B.GEN_EXPN_ADD_AMT, 0) GEN_EXPN_ADD_AMT
                                      ,NVL(B.GEN_EXPN_TRNS_AMT, 0) GEN_EXPN_TRNS_AMT
                                      ,NVL(B.SLP_PERF_AMT, 0) SLP_PERF_AMT
                                  FROM ( 
                                        SELECT SUBSTR(@[from_rslt_yrmon],1,4)||B.MM RSLT_YRMON
                                              ,A.OFC_CD
                                              ,A.SUB_OFC_CD
                                              ,A.GEN_EXPN_CD
                                              ,A.OFC_CO_DIV_CD
                                          FROM ( 
                                                SELECT DISTINCT OFC_CD, SUB_OFC_CD, GEN_EXPN_CD, OFC_CO_DIV_CD 
                                                  FROM GEM_RSLT_SMRY
                                                 WHERE RSLT_YRMON BETWEEN TO_CHAR(@[from_rslt_yrmon]-'300')||'01' AND SUBSTR(@[to_rslt_yrmon], 1, 4)||'12'
                                                   AND GEN_EXPN_CD = '240601'
                                                   AND OFC_CO_DIV_CD = 'O'
                                               ) A
                                              ,( 
                                                SELECT TRIM(TO_CHAR(ROWNUM, '00')) MM 
                                                  FROM DUAL CONNECT BY LEVEL <= 12 
                                               ) B    
                                       ) A
                                      ,GEM_RSLT_SMRY B
                                 WHERE A.RSLT_YRMON  = B.RSLT_YRMON(+)
                                   AND A.OFC_CD = B.OFC_CD(+)
                                   AND A.SUB_OFC_CD = B.SUB_OFC_CD(+)
                                   AND A.GEN_EXPN_CD = B.GEN_EXPN_CD(+)
                                   AND A.OFC_CO_DIV_CD  = B.OFC_CO_DIV_CD(+)
                               ) A
                              ,GEM_OFFICE B
                              ,GEM_XCH_RT C
                              ,(
                                SELECT A.ACCT_XCH_RT_YRMON
                                      ,A.CURR_CD
                                      ,B.USD_LOCL_XCH_RT
                                      ,B.LOCL_KRW_XCH_RT
                                      ,B.USD_KRW_XCH_RT
                                  FROM (
                                        SELECT B.ACCT_XCH_RT_YRMON
                                              ,A.CURR_CD
                                          FROM (
                                                SELECT DISTINCT CURR_CD
                                                  FROM GEM_XCH_RT
                                                 WHERE ACCT_XCH_RT_YRMON LIKE SUBSTR(@[from_rslt_yrmon], 1, 4)||'%'
                                               ) A
                                              ,(
                                                SELECT SUBSTR(@[from_rslt_yrmon], 1, 4)||TRIM(TO_CHAR(ROWNUM, '00')) ACCT_XCH_RT_YRMON
                                                  FROM DUAL CONNECT BY LEVEL <= 12
                                               ) B
                                       ) A
                                      ,GEM_XCH_RT B
                                 WHERE A.ACCT_XCH_RT_YRMON = B.ACCT_XCH_RT_YRMON(+)
                                   AND A.CURR_CD = B.CURR_CD(+)
                                   AND B.GEN_EXPN_XCH_RT_DIV_CD(+) = 'M'
                               ) D
                         WHERE A.RSLT_YRMON BETWEEN @[from_rslt_yrmon] AND @[to_rslt_yrmon]
                           AND A.OFC_CD = B.OFC_CD
                           AND B.LOCL_CURR_CD  = C.CURR_CD
                           AND C.ACCT_XCH_RT_YRMON = SUBSTR(@[from_rslt_yrmon], 1, 4)||'00' 
                           AND C.GEN_EXPN_XCH_RT_DIV_CD = 'I' 
                           AND B.LOCL_CURR_CD  = D.CURR_CD
                           AND A.RSLT_YRMON    = D.ACCT_XCH_RT_YRMON
                       ) A    
                      ,( 
                        SELECT SUBSTR(@[from_rslt_yrmon], 1, 4)||SUBSTR(A.RSLT_YRMON , 5,2) RSLT_YRMON
                              ,A.OFC_CD
                              ,A.SUB_OFC_CD
                              ,A.GEN_EXPN_CD 
                              ,A.OFC_CO_DIV_CD
                              ,DECODE(@[ofc_cur], 'LCL', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/B.RQST_UT_VAL)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT 
                                           , 'USD', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'KRW', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS PLAN_ASSN_AMT02
                              ,DECODE(@[ofc_cur], 'LCL', ((A.SLP_PERF_AMT/B.RQST_UT_VAL)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT ) AS SLP_PERF_AMT02
                              ,DECODE(@[ofc_cur], 'LCL', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'USD', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'KRW', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS USD_PLAN_ASSN_AMT02
                              ,DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/C.USD_LOCL_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/C.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS USD_PLAN_PERF_AMT02
                              ,DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT ) AS USD_ACCT_PERF_AMT02
                          FROM GEM_RSLT_SMRY A
                              ,GEM_OFFICE B
                              ,GEM_XCH_RT C
                              ,GEM_XCH_RT D   
                         WHERE A.RSLT_YRMON BETWEEN TO_CHAR(@[from_rslt_yrmon]-'100') AND TO_CHAR(@[to_rslt_yrmon]-'100')
                           AND A.GEN_EXPN_CD = '240601'
                           AND A.OFC_CO_DIV_CD = 'O'
                           AND A.OFC_CD = B.OFC_CD 
                           AND B.LOCL_CURR_CD = C.CURR_CD
                           AND C.ACCT_XCH_RT_YRMON = SUBSTR(@[from_rslt_yrmon], 1, 4)-'1'||'00'  
                           AND C.GEN_EXPN_XCH_RT_DIV_CD = 'I'
                           AND B.LOCL_CURR_CD = D.CURR_CD
                           AND A.RSLT_YRMON = D.ACCT_XCH_RT_YRMON
                           AND D.GEN_EXPN_XCH_RT_DIV_CD = 'M'
                           
                       ) B
                      ,( 
                        SELECT SUBSTR(@[from_rslt_yrmon], 1, 4)||SUBSTR(A.RSLT_YRMON , 5,2) RSLT_YRMON
                              ,A.OFC_CD
                              ,A.SUB_OFC_CD
                              ,A.GEN_EXPN_CD
                              ,A.OFC_CO_DIV_CD
                              ,DECODE(@[ofc_cur], 'LCL', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/B.RQST_UT_VAL)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT 
                                           , 'USD', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'KRW', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS PLAN_ASSN_AMT03
                              ,DECODE(@[ofc_cur], 'LCL', ((A.SLP_PERF_AMT/B.RQST_UT_VAL)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT ) AS SLP_PERF_AMT03
                              ,DECODE(@[ofc_cur], 'LCL', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'USD', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'KRW', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS USD_PLAN_ASSN_AMT03
                              ,DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/C.USD_LOCL_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/C.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS USD_PLAN_PERF_AMT03
                              ,DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT ) AS USD_ACCT_PERF_AMT03
                          FROM GEM_RSLT_SMRY A
                              ,GEM_OFFICE B
                              ,GEM_XCH_RT C
                              ,GEM_XCH_RT D   
                         WHERE A.RSLT_YRMON BETWEEN TO_CHAR(@[from_rslt_yrmon]-'200') AND TO_CHAR(@[to_rslt_yrmon]-'200')
                           AND A.GEN_EXPN_CD = '240601'
                           AND A.OFC_CO_DIV_CD = 'O'                 
                           AND A.OFC_CD = B.OFC_CD 
                           AND B.LOCL_CURR_CD = C.CURR_CD
                           AND C.ACCT_XCH_RT_YRMON = SUBSTR(@[from_rslt_yrmon], 1, 4)-'2'||'00'  
                           AND C.GEN_EXPN_XCH_RT_DIV_CD = 'I'
                           AND B.LOCL_CURR_CD = D.CURR_CD
                           AND A.RSLT_YRMON = D.ACCT_XCH_RT_YRMON
                           AND D.GEN_EXPN_XCH_RT_DIV_CD = 'M'
                       ) C
                      ,( 
                        SELECT SUBSTR(@[from_rslt_yrmon], 1, 4)||SUBSTR(A.RSLT_YRMON , 5,2) RSLT_YRMON
                              ,A.OFC_CD
                              ,A.SUB_OFC_CD
                              ,A.GEN_EXPN_CD 
                              ,A.OFC_CO_DIV_CD                     
                              ,DECODE(@[ofc_cur], 'LCL', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/B.RQST_UT_VAL)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT 
                                           , 'USD', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'KRW', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS PLAN_ASSN_AMT04
                              ,DECODE(@[ofc_cur], 'LCL', ((A.SLP_PERF_AMT/B.RQST_UT_VAL)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT ) AS SLP_PERF_AMT04
                              ,DECODE(@[ofc_cur], 'LCL', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'USD', (A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/C.USD_LOCL_XCH_RT
                                           , 'KRW', (((A.GEN_EXPN_INIT_AMT + A.GEN_EXPN_ADD_AMT + A.GEN_EXPN_TRNS_AMT)/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS USD_PLAN_ASSN_AMT04
                              ,DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/C.USD_LOCL_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/C.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/C.USD_LOCL_XCH_RT)*C.USD_KRW_XCH_RT ) AS USD_PLAN_PERF_AMT04
                              ,DECODE(@[ofc_cur], 'LCL', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'USD', A.SLP_PERF_AMT/D.USD_LOCL_XCH_RT
                                           , 'KRW', ((A.SLP_PERF_AMT/1000)/D.USD_LOCL_XCH_RT)*D.USD_KRW_XCH_RT ) AS USD_ACCT_PERF_AMT04
                          FROM GEM_RSLT_SMRY A
                              ,GEM_OFFICE B
                              ,GEM_XCH_RT C
                              ,GEM_XCH_RT D   
                         WHERE A.RSLT_YRMON BETWEEN TO_CHAR(@[from_rslt_yrmon]-'300') AND TO_CHAR(@[to_rslt_yrmon]-'300')
                           AND A.GEN_EXPN_CD = '240601'
                           AND A.OFC_CO_DIV_CD = 'O'                 
                           AND A.OFC_CD = B.OFC_CD 
                           AND B.LOCL_CURR_CD = C.CURR_CD
                           AND C.ACCT_XCH_RT_YRMON = SUBSTR(@[from_rslt_yrmon], 1, 4)-'3'||'00'  
                           AND C.GEN_EXPN_XCH_RT_DIV_CD = 'I'
                           AND B.LOCL_CURR_CD = D.CURR_CD
                           AND A.RSLT_YRMON = D.ACCT_XCH_RT_YRMON
                           AND D.GEN_EXPN_XCH_RT_DIV_CD = 'M'                      
                      ) D
                 WHERE 1=1
                   AND A.RSLT_YRMON  = B.RSLT_YRMON(+)
                   AND A.OFC_CD      = B.OFC_CD(+)
                   AND A.SUB_OFC_CD  = B.SUB_OFC_CD(+)
                   AND A.GEN_EXPN_CD = B.GEN_EXPN_CD(+)           
                   AND A.RSLT_YRMON  = C.RSLT_YRMON(+)
                   AND A.OFC_CD      = C.OFC_CD(+)
                   AND A.SUB_OFC_CD  = C.SUB_OFC_CD(+)
                   AND A.GEN_EXPN_CD = C.GEN_EXPN_CD(+)
                   AND A.RSLT_YRMON  = D.RSLT_YRMON(+)
                   AND A.OFC_CD      = D.OFC_CD(+)
                   AND A.SUB_OFC_CD  = D.SUB_OFC_CD(+)
                   AND A.GEN_EXPN_CD = D.GEN_EXPN_CD(+)           
               ) A 
              ,GEM_EXPENSE B 
         WHERE A.GEN_EXPN_CD = B.GEN_EXPN_CD
           AND A.AMT_TOT <> 0
#if(${auth_flg} == 'YNYN')           
           AND ( A.OFC_CD IN (SELECT OFC_CD      
                                FROM GEM_OFC_HIS
                          START WITH OFC_CD IN (@[login_office])
                    CONNECT BY PRIOR OFC_CD = BFR_OFC_CD ) 
                OR B.TIC_CD = @[login_office] )
#elseif(${auth_flg} == 'YYYN')
           AND ( A.OFC_CD IN ( SELECT OFC_CD      
                                 FROM GEM_OFC_HIS
                           START WITH OFC_CD IN ( SELECT L_4 
                                                    FROM GEM_OFC_LEVEL_V 
                                                   WHERE L_3 = @[login_office] )
                     CONNECT BY PRIOR OFC_CD = BFR_OFC_CD ) OR B.TIC_CD = @[login_office] )    
#end                     
      GROUP BY B.TIC_CD 
#if(${monthly_view} == 'Y')      
              ,A.RSLT_YRMON  
#end                          
              ,A.GEN_EXPN_CD
              ,A.OFC_CO_DIV_CD 
#end              
       ) A
      ,GEM_OFFICE B
      ,GEM_EXPN_GRP_V C 
 WHERE A.OFC_CD = B.OFC_CD(+)  
   AND A.GEN_EXPN_CD = C.GEN_EXPN_CD(+) 
   AND A.GEN_EXPN_CD BETWEEN DECODE (@[sch_expense_from], '', '111111', @[sch_expense_from]) AND DECODE (@[sch_expense_to], '', '999999', @[sch_expense_to]) -- Expense 조건
#if(${ofc_co} != '')
   AND A.OFC_CO_DIV_CD = @[ofc_co] -- Company 조건
#end
#if(${ofc_sal} != '')
   AND C.SALY_FLG = @[ofc_sal] -- Salary 조건
#end   
#if (${sch_expense_group} != '') 
   AND C.GEM_EXPN_GRP_CD1 IN (${sch_expense_group}) -- Expense Group 조건
#end  
#if(${sch_tic_cd} != '')
   AND C.TIC_CD = @[sch_tic_cd]
#end
#if(${sls_ofc_div_cd} != '' || ${ofc_expn_cd} != '')
   AND A.OFC_CD IN (
	SELECT OFC_CD      
  	FROM GEM_OFC_HIS
	START WITH OFC_CD IN (    
        SELECT DISTINCT L_4 CODE
          FROM GEM_OFC_LEVEL_V
         WHERE 1=1
		   #if(${sls_ofc_div_cd} != '')
           AND RGN_OFC_FLG LIKE @[sls_ofc_div_cd]||'%'
		   #end		
		   #if(${ofc_lvl3} != '' && ${ofc_expn_cd} != '') 
		   AND L_4 = @[ofc_lvl3]
		   #end
		   #if(${ofc_lvl1} != '' && ${ofc_lvl2} != '' && ${ofc_lvl3} != '' && ${ofc_expn_cd} == '') 
		   AND L_4 = @[ofc_lvl3] 
		   #end
		   #if(${ofc_lvl1} != '' && ${ofc_lvl2} != '' && ${ofc_lvl3} == '') 
		   AND L_3 = @[ofc_lvl2] 
		   #end
		   #if(${ofc_lvl1} != '' && ${ofc_lvl2} == '' && ${ofc_lvl3} == '') 
		   AND L_2 = @[ofc_lvl1] 
		   #end
		   #if(${ofc_lvl3} == '' && ${ofc_expn_cd} != '') 
		   AND L_4 = @[ofc_expn_cd]
		   #end
		   
		   
	)
	CONNECT BY PRIOR OFC_CD = BFR_OFC_CD
    )
#end
ORDER BY OFFICE_EXPENSE, RT_FM_MON			]]></sql>
			<params>
				<param name="ofc_cur" type="12" value="" out="N"/>
				<param name="from_rslt_yrmon" type="12" value="" out="N"/>
				<param name="to_rslt_yrmon" type="12" value="" out="N"/>
				<param name="sch_lang" type="12" value="" out="N"/>
				<param name="login_office" type="12" value="" out="N"/>
				<param name="sch_expense_from" type="12" value="" out="N"/>
				<param name="sch_expense_to" type="12" value="" out="N"/>
				<param name="ofc_co" type="12" value="" out="N"/>
				<param name="ofc_sal" type="12" value="" out="N"/>
				<param name="sch_tic_cd" type="12" value="" out="N"/>
				<param name="sls_ofc_div_cd" type="12" value="" out="N"/>
				<param name="ofc_lvl3" type="12" value="" out="N"/>
				<param name="ofc_lvl2" type="12" value="" out="N"/>
				<param name="ofc_lvl1" type="12" value="" out="N"/>
				<param name="ofc_expn_cd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
