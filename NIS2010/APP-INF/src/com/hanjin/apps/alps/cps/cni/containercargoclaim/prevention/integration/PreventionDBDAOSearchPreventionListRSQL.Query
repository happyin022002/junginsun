<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="PreventionDBDAOSearchPreventionListRSQL">
			<desc><![CDATA[Prevention list 조회]]></desc>
			<sql><![CDATA[
SELECT
    CLM_PRVE_DIV_CD
  , CLM_PRVE_DIV_NM
  , CLM_PRVE_NO
  , CLM_PRVE_SUBJ_NM
  , CRE_DT
  , CRE_DT_ORD
  , CLM_AREA_CD
  , CRE_OFC_CD
  , CRE_USR_ID
  , DECODE(FILE_CNT , 0 , 1 , 0) FILE_CNT
  , CLM_PRVE_READ_KNT
  , CLM_PRVE_DESC
FROM
    (
        SELECT
            CLM_PRVE_DIV_CD
          , CNI_GET_CLM_MISC_NM_FNC ('37', CLM_PRVE_DIV_CD, '2') CLM_PRVE_DIV_NM
          , CLM_PRVE_NO
          , CLM_PRVE_SUBJ_NM
          , TO_CHAR (CRE_DT, 'YYYYMMDD') CRE_DT
		  , CRE_DT CRE_DT_ORD
          , (
                SELECT
                    CLM_AREA_CD
                FROM
                    CNI_AREA_OFC
                WHERE
                    OFC_CD = CRE_OFC_CD
            )
            CLM_AREA_CD
          , CRE_OFC_CD
          , CRE_USR_ID
          , (
                SELECT
                    COUNT ( *)
                FROM
                    CNI_ATCH_FILE
                WHERE
                    CLM_FILE_TP_CD     = '002301'
                    AND CGO_CLM_REF_NO = CLM_PRVE_NO
            )
            FILE_CNT
          , CLM_PRVE_READ_KNT
          , CLM_PRVE_DESC
        FROM
            CNI_CLM_PRVE
        WHERE EFF_DT <= @[cur_dt]
		 AND EXP_DT >= @[cur_dt]
        UNION ALL

        SELECT
            'C' CLM_PRVE_DIV_CD
          , 'CCC' CLM_PRVE_DIV_NM
          , '' CLM_PRVE_NO
          , CGO_CLM_NO CLM_PRVE_SUBJ_NM
          , TO_CHAR (A.CRE_DT, 'YYYYMMDD') CRE_DT
		  , A.CRE_DT CRE_DT_ORD
          , (
                SELECT
                    CLM_AREA_CD
                FROM
                    CNI_AREA_OFC
                WHERE
                    OFC_CD = B.OFC_CD
            )
            CLM_AREA_CD
          , B.OFC_CD CRE_OFC_CD
          , A.CRE_USR_ID
          , 0 FILE_CNT
          , 0 CLM_PRVE_READ_KNT
          , CGO_CLM_STL_DESC CLM_PRVE_DESC
        FROM
            CNI_CGO_CLM_STL A
          , COM_USER B
        WHERE
            B.USR_ID = A.CRE_USR_ID
        AND A.CRE_DT BETWEEN TO_DATE(@[cre_dt_start],'YYYYMMDD') and TO_DATE(@[cre_dt_end],'YYYYMMDD') + 0.99999
        #if (${usr_roles} == '') 
			AND 1 = 2
		#end
    )
WHERE 1 = 1

	  #if (${clm_prve_div_cd} != '') 
    AND CLM_PRVE_DIV_CD = @[clm_prve_div_cd]
	  #end

	  #if (${clm_prve_no} != '') 
     AND CLM_PRVE_NO = @[clm_prve_no]
	  #end

	  #if (${cre_dt_start} != '') 
    AND CRE_DT BETWEEN @[cre_dt_start] and @[cre_dt_end]
	  #end

	  #if (${clm_area_cd} != '') 
	AND CLM_AREA_CD = @[clm_area_cd]
	  #end

	  #if (${cre_ofc_cd} != '') 
    AND CRE_OFC_CD  = @[cre_ofc_cd]
	  #end

	  #if (${cre_usr_id} != '') 
    AND CRE_USR_ID  = @[cre_usr_id]
	  #end

	  #if (${cond_search_text} != '') 
    AND (CLM_PRVE_DESC LIKE  '%' || @[cond_search_text] || '%'  OR
         CLM_PRVE_SUBJ_NM  LIKE  '%' || @[cond_search_text] || '%'   
    		)
	  #end

ORDER BY
    CRE_DT_ORD DESC			]]></sql>
			<params>
				<param name="cur_dt" type="12" value="" out="N"/>
				<param name="cre_dt_start" type="12" value="" out="N"/>
				<param name="cre_dt_end" type="12" value="" out="N"/>
				<param name="clm_prve_div_cd" type="12" value="" out="N"/>
				<param name="clm_prve_no" type="12" value="" out="N"/>
				<param name="clm_area_cd" type="12" value="" out="N"/>
				<param name="cre_ofc_cd" type="12" value="" out="N"/>
				<param name="cre_usr_id" type="12" value="" out="N"/>
				<param name="cond_search_text" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
