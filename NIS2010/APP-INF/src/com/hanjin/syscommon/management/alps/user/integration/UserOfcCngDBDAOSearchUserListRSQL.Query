<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="UserOfcCngDBDAOSearchUserListRSQL">
			<desc><![CDATA[user의 모든 목록을 가져온다]]></desc>
			<sql><![CDATA[
#if(${admin_page} == 'Y')

SELECT
	A.USR_ID,
	A.USR_NM,
	A.USR_LOCL_NM,
	A.OFC_CD,
	B.CNG_OFC_CD,
	NVL(C.AR_HD_QTR_OFC_CD, B.CNG_OFC_CD) RHQ,
	TO_CHAR(B.CNG_OFC_FM_DT,'YYYYMMDD') CNG_OFC_FM_DT,
	TO_CHAR(DECODE(C.DELT_FLG,'Y',C.UPD_DT,B.CNG_OFC_TO_DT),'YYYYMMDD') CNG_OFC_TO_DT,
	B.RQST_CTNT,
	B.CRE_USR_ID,
	TO_CHAR(A.CRE_DT,'YYYYMMDD') CRE_DT,
	B.UPD_USR_ID,
	TO_CHAR(B.UPD_DT,'YYYYMMDD') UPD_DT,
	DECODE(SIGN(DECODE(C.DELT_FLG,'Y',C.UPD_DT,B.CNG_OFC_TO_DT)-SYSDATE), -1, 'Y', 'N') EXPIRE
FROM COM_USER A, COM_USR_OFC_CNG B, MDM_ORGANIZATION C
WHERE A.USR_ID = B.USR_ID
AND B.CNG_OFC_CD = C.OFC_CD
AND ('ALL' = @[usr_id] OR A.USR_ID LIKE '%'||@[usr_id]||'%' )
AND ('ALL' = @[usr_nm] OR A.USR_NM LIKE '%'||@[usr_nm]||'%' )

#else

select
	default_lgin_ofc,
	usr_id,
	usr_nm,
	usr_locl_nm,             
	ofc_cd,
	cng_ofc_cd,
	rhq,
	cng_ofc_fm_dt,
	cng_ofc_to_dt,
	rqst_ctnt,
	cre_usr_id,
	cre_dt,
	upd_usr_id,
	upd_dt,
	expire,
	no
from
(
select
	1 no,
	decode(a.ofc_cd, nvl(a.lst_lgin_ofc_cd, a.ofc_cd), 1, 0) default_lgin_ofc,
	a.usr_id usr_id,
	a.usr_nm usr_nm ,
	a.usr_locl_nm  usr_locl_nm ,
	a.ofc_cd ofc_cd,
	a.ofc_cd cng_ofc_cd,
	nvl(c.AR_HD_QTR_OFC_CD, a.ofc_cd) rhq,
	'' cng_ofc_fm_dt,
	'' cng_ofc_to_dt,
	'' rqst_ctnt,
	'' cre_usr_id,
	'' cre_dt,
	'' upd_usr_id,
	'' upd_dt,
	'N' expire
from COM_USER a, mdm_organization c		  
where a.ofc_cd = c.ofc_cd
AND ('ALL' = @[usr_id] OR a.usr_id LIKE @[usr_id]||'%' )
AND ('ALL' = @[usr_nm] OR a.usr_nm LIKE @[usr_nm]||'%' )
union
SELECT 1 + (ROW_NUMBER() OVER (ORDER BY b.cng_ofc_fm_dt DESC)) no,
	decode(a.lst_lgin_ofc_cd, b.cng_ofc_cd, 1, 0) default_lgin_ofc,
	a.usr_id usr_id,
	a.usr_nm usr_nm,
	a.usr_locl_nm usr_locl_nm,                         
	a.ofc_cd ofc_cd,  
	b.cng_ofc_cd cng_ofc_cd,
	nvl(c.AR_HD_QTR_OFC_CD, b.cng_ofc_cd) rhq,
	TO_CHAR(b.cng_ofc_fm_dt,'YYYYMMDD') cng_ofc_fm_dt,              
	TO_CHAR(DECODE(C.DELT_FLG,'Y',C.UPD_DT,B.CNG_OFC_TO_DT),'YYYYMMDD') cng_ofc_to_dt,                 
	b.rqst_ctnt rqst_ctnt,                   		
	b.cre_usr_id cre_usr_id,                       
	TO_CHAR(a.cre_dt,'YYYYMMDD') cre_dt ,                         	
	b.upd_usr_id upd_usr_id,                   
	TO_CHAR(b.upd_dt,'YYYYMMDD') upd_dt,
	decode(sign(DECODE(C.DELT_FLG,'Y',C.UPD_DT,B.CNG_OFC_TO_DT)-sysdate), -1, 'Y', 'N') expire
	from COM_USER a, com_usr_ofc_cng b, mdm_organization c			
	where a.usr_id = b.usr_id						
	AND b.cng_ofc_cd = c.ofc_cd
	AND ('ALL' = @[usr_id] OR a.usr_id LIKE @[usr_id]||'%')
	AND ('ALL' = @[usr_nm] OR a.usr_nm LIKE @[usr_nm]||'%')
)

#end
order by cng_ofc_cd			]]></sql>
			<params>
				<param name="usr_id" type="12" value="" out="N"/>
				<param name="usr_nm" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
