<?xml version="1.0" encoding="UTF-8"?>
<sqls>
	<querys>
		<query name="KorCustomsTransmissionDBDAOmakeDGMNFTFlatFileRSQL">
			<desc><![CDATA[DGMNFT Flat file]]></desc>
			<sql><![CDATA[
SELECT	SUBSTR(
			MAX(TO_CHAR(VVD_SEQ, '00')||				
				'07212'||'~'||			/*	MESSAGE SEQUENCE NO		*/
				DECODE(IO_BND_CD, 'I','HJSPORT1','HJSCX050') ||'~'||	/*	SENDER ID		*/
				DECODE(PORT_CD, 'KRPUS', '020', 'KRINC', '030', 'KRKAN', '622')||'~'||	/*	수신인 코드		*/
				SUBSTR(KR_VSL_CALL_SGN_CD, 1, 9)||'~'||	/*	CALL SIGN		*/
				SUBSTR(VSL_NM, 1, 30)||'~'||	/*	VESSEL NAME		*/
				TO_CHAR(NVL(DCGO_SEQ,0),'FM0000')||'~'||	/*	???		*/
				DECODE(IO_BND_CD, 'I', '1', '2')||'~'||	/*	입출항 INDICATOR		*/
				TO_CHAR(CALL_KNT,'FM000')||'~'||	/*	입항회수		*/
				PORT_AREA_N1ST_ID||'~'||	/*	PORT AREA		*/
				PORT_AREA_N2ND_ID||'~'||	/*	PORT ANCHOR		*/
				TO_CHAR(ARR_DT,	'YYYYMMDDHH')||'~'||	/*	입항일		*/
				TML_VSL_CD||'~'||							/*	TMNL 모선코드	*/
				TML_SKD_VOY_NO||'~'							/*	TMNL  모선 항차	*/
		),	4) EDI_SND_MSG
		, MAX(VVD_SEQ) MAX_VVD_SEQ
FROM	BKG_CSTMS_KR_DG_CGO_VVD
WHERE	MRN_NO			=	SUBSTR(@[mrn_no],1,10)
AND		MRN_CHK_NO		=	SUBSTR(@[mrn_no],11,1)
AND		VSL_CD			=	SUBSTR(@[vvd], 1, 4)
AND		SKD_VOY_NO	    =	SUBSTR(@[vvd], 5, 4)
AND		SKD_DIR_CD		=	SUBSTR(@[vvd], 9, 1)
GROUP	BY	MRN_NO, MRN_CHK_NO, VSL_CD, SKD_VOY_NO, SKD_DIR_CD			]]></sql>
			<params>
				<param name="mrn_no" type="12" value="" out="N"/>
				<param name="vvd" type="12" value="" out="N"/>
			</params>
		</query>
	</querys>
</sqls>
