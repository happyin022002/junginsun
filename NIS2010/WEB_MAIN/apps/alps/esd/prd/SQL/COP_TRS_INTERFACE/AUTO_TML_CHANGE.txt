INSERT INTO PRD_PROD_CTL_ROUT_DTL
(PCTL_NO,PCTL_SEQ,ORG_NOD_CD,DEST_NOD_CD,NOD_LNK_DIV_CD,PCTL_IO_BND_CD,TRSP_MOD_CD,ORG_NOD_TP_CD,DEST_NOD_TP_CD,
MTY_YD_FLG,ARR_ST_DT,DEP_FSH_DT,TZ_DWLL_TM_HRS,N1ST_VNDR_SEQ,N2ND_VNDR_SEQ,N3RD_VNDR_SEQ,
ROUT_ORG_NOD_CD,ROUT_DEST_NOD_CD,ROUT_SEQ,
COST_ACT_GRP_SEQ,CRE_USR_ID,CRE_DT,UPD_USR_ID,UPD_DT
)
SELECT :NEW_PCTL_NO||'0001',ROW_NUMBER () OVER (ORDER BY PCTL_SEQ),
(CASE WHEN PCTL_IO_BND_CD ='O' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 1 AND :MT_PU IS NOT NULL THEN :MT_PU
      WHEN PCTL_IO_BND_CD ='O' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 2 AND :MT_PU IS NOT NULL THEN :MT_PU
      WHEN PCTL_IO_BND_CD ='O' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 3 THEN :TERM_NODE 
      WHEN PCTL_IO_BND_CD ='I' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 1 THEN :TERM_NODE
      WHEN PCTL_IO_BND_CD ='I' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 2 THEN :TERM_NODE       
      WHEN PCTL_IO_BND_CD ='I' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 3 AND :MT_RTN IS NOT NULL THEN :MT_RTN
           
      ELSE ORG_NOD_CD
 END ) ORG_NOD_CD,
(CASE WHEN PCTL_IO_BND_CD ='O' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 1 AND :MT_PU IS NOT NULL THEN :MT_PU      
      WHEN PCTL_IO_BND_CD ='O' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 2 THEN :TERM_NODE 
      WHEN PCTL_IO_BND_CD ='O' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 3 THEN :TERM_NODE
      WHEN PCTL_IO_BND_CD ='I' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 1 THEN :TERM_NODE
      WHEN PCTL_IO_BND_CD ='I' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 2 AND :MT_RTN IS NOT NULL THEN :MT_RTN
      WHEN PCTL_IO_BND_CD ='I' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 3 AND :MT_RTN IS NOT NULL THEN :MT_RTN
      ELSE DEST_NOD_CD
 END )  DEST_NOD_CD,
NOD_LNK_DIV_CD,PCTL_IO_BND_CD,TRSP_MOD_CD,
(CASE WHEN PCTL_IO_BND_CD ='O' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 1 AND :MT_PU IS NOT NULL THEN (SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD =:MT_PU)
      WHEN PCTL_IO_BND_CD ='O' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 2 AND :MT_PU IS NOT NULL THEN (SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD =:MT_PU)
      WHEN PCTL_IO_BND_CD ='O' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 3 THEN (SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD =:TERM_NODE)
      WHEN PCTL_IO_BND_CD ='I' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 1 THEN (SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD =:TERM_NODE)
      WHEN PCTL_IO_BND_CD ='I' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 2 THEN (SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD =:TERM_NODE)
      WHEN PCTL_IO_BND_CD ='I' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 3 AND :MT_RTN IS NOT NULL THEN (SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD =:MT_RTN)
      ELSE ORG_NOD_TP_CD
 END ) ORG_NOD_TP_CD,
(CASE WHEN PCTL_IO_BND_CD ='O' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 1 AND :MT_PU IS NOT NULL THEN (SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD =:MT_PU)
      WHEN PCTL_IO_BND_CD ='O' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 2 THEN (SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD =:TERM_NODE)
      WHEN PCTL_IO_BND_CD ='O' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 3 THEN (SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD =:TERM_NODE)
      WHEN PCTL_IO_BND_CD ='I' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 1 THEN (SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD =:TERM_NODE)
      WHEN PCTL_IO_BND_CD ='I' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 2 AND :MT_RTN IS NOT NULL THEN (SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD =:MT_RTN)
      WHEN PCTL_IO_BND_CD ='I' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 3 AND :MT_RTN IS NOT NULL THEN (SELECT NOD_TP_CD FROM PRD_NODE WHERE NOD_CD =:MT_RTN)
      ELSE DEST_NOD_TP_CD
 END )  DEST_NOD_TP_CD,

MTY_YD_FLG,ARR_ST_DT,DEP_FSH_DT,TZ_DWLL_TM_HRS,
(CASE WHEN PCTL_IO_BND_CD ='O' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 1 AND :MT_PU IS NOT NULL THEN (SELECT N1ST_VNDR_SEQ FROM MDM_YARD WHERE YD_CD =:MT_PU)
      WHEN PCTL_IO_BND_CD ='O' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 3 THEN (SELECT N1ST_VNDR_SEQ FROM MDM_YARD WHERE YD_CD =:TERM_NODE)
      WHEN PCTL_IO_BND_CD ='I' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 1 THEN (SELECT N1ST_VNDR_SEQ FROM MDM_YARD WHERE YD_CD =:TERM_NODE)
      WHEN PCTL_IO_BND_CD ='I' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 3 AND :MT_RTN IS NOT NULL THEN (SELECT N1ST_VNDR_SEQ FROM MDM_YARD WHERE YD_CD =:MT_RTN)
      ELSE N1ST_VNDR_SEQ
 END ) 
N1ST_VNDR_SEQ,
(CASE WHEN PCTL_IO_BND_CD ='O' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 1 AND :MT_PU IS NOT NULL THEN (SELECT N2ND_VNDR_SEQ FROM MDM_YARD WHERE YD_CD =:MT_PU)
      WHEN PCTL_IO_BND_CD ='O' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 3 THEN (SELECT N2ND_VNDR_SEQ FROM MDM_YARD WHERE YD_CD =:TERM_NODE)
      WHEN PCTL_IO_BND_CD ='I' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 1 THEN (SELECT N2ND_VNDR_SEQ FROM MDM_YARD WHERE YD_CD =:TERM_NODE)
      WHEN PCTL_IO_BND_CD ='I' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 3 AND :MT_RTN IS NOT NULL THEN (SELECT N2ND_VNDR_SEQ FROM MDM_YARD WHERE YD_CD =:MT_RTN)
      ELSE N2ND_VNDR_SEQ
 END ) 
N2ND_VNDR_SEQ,
(CASE WHEN PCTL_IO_BND_CD ='O' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 1 AND :MT_PU IS NOT NULL THEN (SELECT N3RD_VNDR_SEQ FROM MDM_YARD WHERE YD_CD =:MT_PU)
      WHEN PCTL_IO_BND_CD ='O' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 3 THEN (SELECT N3RD_VNDR_SEQ FROM MDM_YARD WHERE YD_CD =:TERM_NODE)
      WHEN PCTL_IO_BND_CD ='I' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 1 THEN (SELECT N3RD_VNDR_SEQ FROM MDM_YARD WHERE YD_CD =:TERM_NODE)
      WHEN PCTL_IO_BND_CD ='I' AND ROW_NUMBER () OVER (ORDER BY PCTL_SEQ)= 3 AND :MT_RTN IS NOT NULL THEN (SELECT N3RD_VNDR_SEQ FROM MDM_YARD WHERE YD_CD =:MT_RTN)
      ELSE N3RD_VNDR_SEQ
 END ) 
N3RD_VNDR_SEQ,
:TERM_NODE ROUT_ORG_NOD_CD,:TERM_NODE ROUT_DEST_NOD_CD, 0 ROUT_SEQ,
COST_ACT_GRP_SEQ,CRE_USR_ID,SYSDATE,UPD_USR_ID,SYSDATE
FROM PRD_PROD_CTL_ROUT_DTL
WHERE PCTL_NO =:OLD_PC
AND PCTL_IO_BND_CD = :IO_BND ;
