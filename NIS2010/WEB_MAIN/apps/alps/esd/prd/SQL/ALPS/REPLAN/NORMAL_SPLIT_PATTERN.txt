--INSERT INTO PRD_BKG_COP_MAP (COP_MAPG_SEQ,COP_NO,BKG_NO,CNTR_NO,CNTR_TPSZ_CD,PCTL_NO,COP_OP_TP_CD,CRNT_FLG,CRE_USR_ID,CRE_DT,UPD_USR_ID,UPD_DT )
SELECT :MAPG_SEQ,COP_NO,BKG_NO,CNTR_NO,CNTR_TPSZ_CD,PCTL_NO,OPT_CD,CURRENT_FLAG,'SYSTEM',SYSDATE,'SYSTEM',SYSDATE
FROM (
    SELECT 
    (CASE WHEN :OLD_BKG_NO <> :NEW_BKG_NO
                AND NVL((SELECT 'Y' 
                        FROM PRD_BKG_COP_MAP C 
                        WHERE C.BKG_NO LIKE :OLD_BKG_NO||'%' 
                        AND C.CRNT_FLG ='Y' 
                        AND C.CNTR_NO =H.CNTR_NO
                        AND C.COP_OP_TP_CD <> 'X'
                        AND ROWNUM =1 ),'X') = 'Y'                     
            THEN SCE_NEW_COP_NO_FNC (:BKG_OFC)
          ELSE COP_NO
    END) COP_NO,
    :NEW_BKG_NO BKG_NO,
    CNTR_NO, --SPLIT BKG�� ���
    CNTR_TPSZ_CD,
    PCTL_NO,
    (CASE WHEN SIGN(INSTR(:CNTR_LST,CNTR_NO)) <> '1' OR :CNTR_LST IS NULL
            THEN 'X'
          WHEN SIGN(INSTR(:CNTR_LST,CNTR_NO)) = 1 AND :OLD_BKG_NO = :NEW_BKG_NO
            THEN 'N'
          WHEN SIGN(INSTR(:CNTR_LST,CNTR_NO)) = 1 AND :OLD_BKG_NO <> :NEW_BKG_NO
                AND NVL((SELECT 'Y' 
                        FROM PRD_BKG_COP_MAP C 
                        WHERE C.BKG_NO LIKE :OLD_BKG_NO||'%' 
                        AND C.CRNT_FLG ='Y' 
                        AND C.CNTR_NO =H.CNTR_NO
                        AND C.COP_OP_TP_CD <> 'X' 
                        AND ROWNUM =1),'X') = 'Y' 
            THEN 'C'
          WHEN SIGN(INSTR(:CNTR_LST,CNTR_NO)) = 1 AND :OLD_BKG_NO <> :NEW_BKG_NO
                AND NVL((SELECT 'Y' 
                        FROM PRD_BKG_COP_MAP C 
                        WHERE C.BKG_NO LIKE :OLD_BKG_NO||'%' 
                        AND C.CRNT_FLG ='Y' 
                        AND C.CNTR_NO =H.CNTR_NO 
                        AND C.COP_OP_TP_CD <> 'X'
                        AND ROWNUM =1),'X') <> 'Y' 
            THEN 'B'
    END) OPT_CD,
    'Y' "CURRENT_FLAG",
    DECODE(:OLD_BKG_NO,:NEW_BKG_NO,'Y',(DECODE(SIGN(INSTR(:CNTR_LST,CNTR_NO)),1,'Y','X'))) CHK
     FROM SCE_COP_HDR H
    WHERE BKG_NO=:OLD_BKG_NO 
    AND NVL(COP_STS_CD,'N') <> 'X'
)
WHERE CHK ='Y'
;